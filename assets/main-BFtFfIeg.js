const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/git-extension-CYfH5R4h.js","assets/index-BahNKH7f.js","assets/index-Ci3bp9A1.css","assets/pyterminal-extension-DrY4HwKI.js","assets/xterm-CODBi7oP.js","assets/k-linuxterminal-B4WGW97X.js","assets/webllmservice-DbPCNavc.js","assets/p12-splitter-BldeLuN7.js","assets/package-manager-extension-DgBhN8r6.js","assets/notebook-extension-cUbR7N1Z.js","assets/editor.main-D4eLXyK-.js","assets/editor-BhPcksyq.css","assets/command-palette-extension-BFWQnOhi.js","assets/download-extension-BoZoNqfx.js","assets/unzip-extension-BSxZC6Fw.js","assets/md-editor-extension-BL5PAeyq.js","assets/media-viewer-extension-D1V5YstU.js","assets/monaco-editor-extension-HjR7WT8j.js","assets/memory-usage-extension-4rRqe0HI.js","assets/webdav-extension-be0hYr1D.js","assets/settings-tree-extension-oPqBcqsv.js","assets/in-browser-ml-extension-a6QUIcCr.js","assets/ai-system-extension-l5k-HLf3.js","assets/rag-system-extension-CNVAYYXa.js","assets/mapbuilder-extension-BLxLOfBN.js","assets/style-editor-extension-DAzqQgjT.js","assets/overpass-extension-BD4gemYX.js","assets/gtfs-extension-DzsnGyEV.js"])))=>i.map(i=>d[i]);
import{g as getDefaultExportFromCjs,x as x$1,B as B$1,P as PubSub$1,a as PubSubModule,o,i as i$2,b as i$3,t,n,r as r$1,c as o$1,e as e$1,E as E$1,d as n$1,f as e$2,h as i$4,j as t$1,p,v as v$1,k as r$2,M as M$1,T as T$1,m as m$1,l as registerIconLibrary,q as n$2,_ as __vitePreload,s as getAugmentedNamespace,u as fs,w as __viteBrowserExternal,y as commonjsGlobal,G as GsSourceType,z as rtUtils,A as r$3,C as GsLayerType,D as DEFAULT_GSMAP,F as ensureUuidsRecursive,H as DEFAULT_STYLES,I as DEFAULT_STYLE_RULES,J as fromLonLat,K as toGsSourceType,L as ensureUuid,N as toGsLayerType,O as toSourceUrl}from"./index-BahNKH7f.js";function _mergeNamespaces(g,a){for(var l=0;l<a.length;l++){const A=a[l];if(typeof A!="string"&&!Array.isArray(A)){for(const O in A)if(O!=="default"&&!(O in g)){const Y=Object.getOwnPropertyDescriptor(A,O);Y&&Object.defineProperty(g,O,Y.get?Y:{enumerable:!0,get:()=>A[O]})}}}return Object.freeze(Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}))}var pace$1={exports:{}};var pace=pace$1.exports,hasRequiredPace;function requirePace(){return hasRequiredPace||(hasRequiredPace=1,(function(g,a){(function(){var l,A,O,Y,R,ee,xe,ne,te,f,d,H,Z,Ye,et,tt,nt,it,ot,st,at,ct,ft,ut,_t,At,Et,Mt,Ot,kt,yt,St,Yt,Ft,ln,dn,Pt,$t,hn,_n,On,En,qt,Jt,Wt,un,fn,pn,Zt,mn,Tn=[].slice,$n={}.hasOwnProperty,Un=function(Kt,Dt){for(var Qt in Dt)$n.call(Dt,Qt)&&(Kt[Qt]=Dt[Qt]);function cn(){this.constructor=Kt}return cn.prototype=Dt.prototype,Kt.prototype=new cn,Kt.__super__=Dt.prototype,Kt},In=[].indexOf||function(Kt){for(var Dt=0,Qt=this.length;Dt<Qt;Dt++)if(Dt in this&&this[Dt]===Kt)return Dt;return-1},kn=function(Kt,Dt){return function(){return Kt.apply(Dt,arguments)}};for(ct={className:"",catchupTime:100,initialRate:.03,minTime:250,ghostTime:100,maxProgressPerFrame:20,easeFactor:1.25,startOnPageLoad:!0,restartOnPushState:!0,restartOnRequestAfter:500,target:"body",elements:{checkInterval:100,selectors:["body"]},eventLag:{minSamples:10,sampleCount:3,lagThreshold:3},ajax:{trackMethods:["GET"],trackWebSockets:!0,ignoreURLs:[]}},kt=function(){var Kt;return(Kt=typeof performance<"u"&&performance!==null&&typeof performance.now=="function"?performance.now():void 0)!=null?Kt:+new Date},St=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,at=window.cancelAnimationFrame||window.mozCancelAnimationFrame,tt=function(Kt,Dt,Qt){return typeof Kt.addEventListener=="function"?Kt.addEventListener(Dt,Qt,!1):(function(){if(typeof Kt["on"+Dt]!="function"||typeof Kt["on"+Dt].eventListeners!="object"){var cn=new ne;typeof Kt["on"+Dt]=="function"&&cn.on(Dt,Kt["on"+Dt]),Kt["on"+Dt]=function(nn){return cn.trigger(Dt,nn)},Kt["on"+Dt].eventListeners=cn}else var cn=Kt["on"+Dt].eventListeners;cn.on(Dt,Qt)})()},St==null&&(St=function(Kt){return setTimeout(Kt,50)},at=function(Kt){return clearTimeout(Kt)}),Ft=function(Kt){var Dt,Qt;return Dt=kt(),Qt=function(){var cn;return cn=kt()-Dt,cn>=33?(Dt=kt(),Kt(cn,function(){return St(Qt)})):setTimeout(Qt,33-cn)},Qt()},Yt=function(){var Kt,Dt,Qt;return Qt=arguments[0],Dt=arguments[1],Kt=3<=arguments.length?Tn.call(arguments,2):[],typeof Qt[Dt]=="function"?Qt[Dt].apply(Qt,Kt):Qt[Dt]},ft=function(){var Kt,Dt,Qt,cn,nn,gn,Cn;for(Dt=arguments[0],cn=2<=arguments.length?Tn.call(arguments,1):[],gn=0,Cn=cn.length;gn<Cn;gn++)if(Qt=cn[gn],Qt)for(Kt in Qt)$n.call(Qt,Kt)&&(nn=Qt[Kt],Dt[Kt]!=null&&typeof Dt[Kt]=="object"&&nn!=null&&typeof nn=="object"?ft(Dt[Kt],nn):Dt[Kt]=nn);return Dt},it=function(Kt){var Dt,Qt,cn,nn,gn;for(Qt=Dt=0,nn=0,gn=Kt.length;nn<gn;nn++)cn=Kt[nn],Qt+=Math.abs(cn),Dt++;return Qt/Dt},_t=function(Kt,Dt){var Qt,cn,nn;if(Kt==null&&(Kt="options"),Dt==null&&(Dt=!0),nn=document.querySelector("[data-pace-"+Kt+"]"),!!nn){if(Qt=nn.getAttribute("data-pace-"+Kt),!Dt)return Qt;try{return JSON.parse(Qt)}catch(gn){return cn=gn,typeof console<"u"&&console!==null?console.error("Error parsing inline pace options",cn):void 0}}},xe=(function(){function Kt(){}return Kt.prototype.on=function(Dt,Qt,cn,nn){var gn;return nn==null&&(nn=!1),this.bindings==null&&(this.bindings={}),(gn=this.bindings)[Dt]==null&&(gn[Dt]=[]),this.bindings[Dt].push({handler:Qt,ctx:cn,once:nn})},Kt.prototype.once=function(Dt,Qt,cn){return this.on(Dt,Qt,cn,!0)},Kt.prototype.off=function(Dt,Qt){var cn,nn,gn;if(((nn=this.bindings)!=null?nn[Dt]:void 0)!=null){if(Qt==null)return delete this.bindings[Dt];for(cn=0,gn=[];cn<this.bindings[Dt].length;)this.bindings[Dt][cn].handler===Qt?gn.push(this.bindings[Dt].splice(cn,1)):gn.push(cn++);return gn}},Kt.prototype.trigger=function(){var Dt,Qt,cn,nn,gn,Cn,Fn,Gn,Zn;if(cn=arguments[0],Dt=2<=arguments.length?Tn.call(arguments,1):[],(Fn=this.bindings)!=null&&Fn[cn]){for(gn=0,Zn=[];gn<this.bindings[cn].length;)Gn=this.bindings[cn][gn],nn=Gn.handler,Qt=Gn.ctx,Cn=Gn.once,nn.apply(Qt??this,Dt),Cn?Zn.push(this.bindings[cn].splice(gn,1)):Zn.push(gn++);return Zn}},Kt})(),f=window.Pace||{},window.Pace=f,ft(f,xe.prototype),yt=f.options=ft({},ct,window.paceOptions,_t()),pn=["ajax","document","eventLag","elements"],Jt=0,un=pn.length;Jt<un;Jt++)$t=pn[Jt],yt[$t]===!0&&(yt[$t]=ct[$t]);te=(function(Kt){Un(Dt,Kt);function Dt(){return Zt=Dt.__super__.constructor.apply(this,arguments),Zt}return Dt})(Error),A=(function(){function Kt(){this.progress=0}return Kt.prototype.getElement=function(){var Dt;if(this.el==null){if(Dt=document.querySelector(yt.target),!Dt)throw new te;this.el=document.createElement("div"),this.el.className="pace pace-active",document.body.className=document.body.className.replace(/(pace-done )|/,"pace-running ");var Qt=yt.className!==""?" "+yt.className:"";this.el.innerHTML='<div class="pace-progress'+Qt+`">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div>`,Dt.firstChild!=null?Dt.insertBefore(this.el,Dt.firstChild):Dt.appendChild(this.el)}return this.el},Kt.prototype.finish=function(){var Dt;return Dt=this.getElement(),Dt.className=Dt.className.replace("pace-active","pace-inactive"),document.body.className=document.body.className.replace("pace-running ","pace-done ")},Kt.prototype.update=function(Dt){return this.progress=Dt,f.trigger("progress",Dt),this.render()},Kt.prototype.destroy=function(){try{this.getElement().parentNode.removeChild(this.getElement())}catch(Dt){te=Dt}return this.el=void 0},Kt.prototype.render=function(){var Dt,Qt,cn,nn,gn,Cn,Fn;if(document.querySelector(yt.target)==null)return!1;for(Dt=this.getElement(),nn="translate3d("+this.progress+"%, 0, 0)",Fn=["webkitTransform","msTransform","transform"],gn=0,Cn=Fn.length;gn<Cn;gn++)Qt=Fn[gn],Dt.children[0].style[Qt]=nn;return(!this.lastRenderedProgress||this.lastRenderedProgress|this.progress!==0|0)&&(Dt.children[0].setAttribute("data-progress-text",""+(this.progress|0)+"%"),this.progress>=100?cn="99":(cn=this.progress<10?"0":"",cn+=this.progress|0),Dt.children[0].setAttribute("data-progress",""+cn)),f.trigger("change",this.progress),this.lastRenderedProgress=this.progress},Kt.prototype.done=function(){return this.progress>=100},Kt})(),ne=(function(){function Kt(){this.bindings={}}return Kt.prototype.trigger=function(Dt,Qt){var cn,nn,gn,Cn,Fn;if(this.bindings[Dt]!=null){for(Cn=this.bindings[Dt],Fn=[],nn=0,gn=Cn.length;nn<gn;nn++)cn=Cn[nn],Fn.push(cn.call(this,Qt));return Fn}},Kt.prototype.on=function(Dt,Qt){var cn;return(cn=this.bindings)[Dt]==null&&(cn[Dt]=[]),this.bindings[Dt].push(Qt)},Kt})(),qt=window.XMLHttpRequest,En=window.XDomainRequest,On=window.WebSocket,ut=function(Kt,Dt){var Qt,cn;cn=[];for(Qt in Dt.prototype)try{Kt[Qt]==null&&typeof Dt[Qt]!="function"?typeof Object.defineProperty=="function"?cn.push(Object.defineProperty(Kt,Qt,{get:(function(nn){return function(){return Dt.prototype[nn]}})(Qt),configurable:!0,enumerable:!0})):cn.push(Kt[Qt]=Dt.prototype[Qt]):cn.push(void 0)}catch{}return cn},Mt=[],f.ignore=function(){var Kt,Dt,Qt;return Dt=arguments[0],Kt=2<=arguments.length?Tn.call(arguments,1):[],Mt.unshift("ignore"),Qt=Dt.apply(null,Kt),Mt.shift(),Qt},f.track=function(){var Kt,Dt,Qt;return Dt=arguments[0],Kt=2<=arguments.length?Tn.call(arguments,1):[],Mt.unshift("track"),Qt=Dt.apply(null,Kt),Mt.shift(),Qt},Pt=function(Kt){var Dt;if(Kt==null&&(Kt="GET"),Mt[0]==="track")return"force";if(!Mt.length&&yt.ajax){if(Kt==="socket"&&yt.ajax.trackWebSockets)return!0;if(Dt=Kt.toUpperCase(),In.call(yt.ajax.trackMethods,Dt)>=0)return!0}return!1},d=(function(Kt){Un(Dt,Kt);function Dt(){var Qt,cn=this;Dt.__super__.constructor.apply(this,arguments),Qt=function(nn){var gn;return gn=nn.open,nn.open=function(Cn,Fn,Gn){return Pt(Cn)&&cn.trigger("request",{type:Cn,url:Fn,request:nn}),gn.apply(nn,arguments)}},window.XMLHttpRequest=function(nn){var gn;return gn=new qt(nn),Qt(gn),gn};try{ut(window.XMLHttpRequest,qt)}catch{}if(En!=null){window.XDomainRequest=function(){var nn;return nn=new En,Qt(nn),nn};try{ut(window.XDomainRequest,En)}catch{}}if(On!=null&&yt.ajax.trackWebSockets){window.WebSocket=function(nn,gn){var Cn;return gn!=null?Cn=new On(nn,gn):Cn=new On(nn),Pt("socket")&&cn.trigger("request",{type:"socket",url:nn,protocols:gn,request:Cn}),Cn};try{ut(window.WebSocket,On)}catch{}}}return Dt})(ne),Wt=null,At=function(){return Wt==null&&(Wt=new d),Wt},dn=function(Kt){var Dt,Qt,cn,nn;for(nn=yt.ajax.ignoreURLs,Qt=0,cn=nn.length;Qt<cn;Qt++)if(Dt=nn[Qt],typeof Dt=="string"){if(Kt.indexOf(Dt)!==-1)return!0}else if(Dt.test(Kt))return!0;return!1},At().on("request",function(Kt){var Dt,Qt,cn,nn,gn;if(nn=Kt.type,cn=Kt.request,gn=Kt.url,!dn(gn)&&!f.running&&(yt.restartOnRequestAfter!==!1||Pt(nn)==="force"))return Qt=arguments,Dt=yt.restartOnRequestAfter||0,typeof Dt=="boolean"&&(Dt=0),setTimeout(function(){var Cn,Fn,Gn,Zn,cr,bn;if(nn==="socket"?Cn=cn.readyState<1:Cn=0<(Zn=cn.readyState)&&Zn<4,Cn){for(f.restart(),cr=f.sources,bn=[],Fn=0,Gn=cr.length;Fn<Gn;Fn++)if($t=cr[Fn],$t instanceof l){$t.watch.apply($t,Qt);break}else bn.push(void 0);return bn}},Dt)}),l=(function(){function Kt(){this.complete=kn(this.complete,this);var Dt=this;this.elements=[],At().on("request",function(){return Dt.watch.apply(Dt,arguments)})}return Kt.prototype.watch=function(Dt){var Qt,cn,nn,gn;if(nn=Dt.type,Qt=Dt.request,gn=Dt.url,!dn(gn))return nn==="socket"?cn=new Ye(Qt,this.complete):cn=new et(Qt,this.complete),this.elements.push(cn)},Kt.prototype.complete=function(Dt){return this.elements=this.elements.filter(function(Qt){return Qt!==Dt})},Kt})(),et=(function(){function Kt(Dt,Qt){var cn,nn,gn,Cn,Fn,Gn=this;if(this.progress=0,window.ProgressEvent!=null)for(tt(Dt,"progress",function(Zn){return Zn.lengthComputable?Gn.progress=100*Zn.loaded/Zn.total:Gn.progress=Gn.progress+(100-Gn.progress)/2},!1),Fn=["load","abort","timeout","error"],nn=0,gn=Fn.length;nn<gn;nn++)cn=Fn[nn],tt(Dt,cn,function(){return Qt(Gn),Gn.progress=100},!1);else Cn=Dt.onreadystatechange,Dt.onreadystatechange=function(){var Zn;return(Zn=Dt.readyState)===0||Zn===4?(Qt(Gn),Gn.progress=100):Dt.readyState===3&&(Gn.progress=50),typeof Cn=="function"?Cn.apply(null,arguments):void 0}}return Kt})(),Ye=(function(){function Kt(Dt,Qt){var cn,nn,gn,Cn,Fn=this;for(this.progress=0,Cn=["error","open"],nn=0,gn=Cn.length;nn<gn;nn++)cn=Cn[nn],tt(Dt,cn,function(){return Qt(Fn),Fn.progress=100},!1)}return Kt})(),Y=(function(){function Kt(Dt){var Qt,cn,nn,gn;for(Dt==null&&(Dt={}),this.complete=kn(this.complete,this),this.elements=[],Dt.selectors==null&&(Dt.selectors=[]),gn=Dt.selectors,cn=0,nn=gn.length;cn<nn;cn++)Qt=gn[cn],this.elements.push(new R(Qt,this.complete))}return Kt.prototype.complete=function(Dt){return this.elements=this.elements.filter(function(Qt){return Qt!==Dt})},Kt})(),R=(function(){function Kt(Dt,Qt){this.selector=Dt,this.completeCallback=Qt,this.progress=0,this.check()}return Kt.prototype.check=function(){var Dt=this;return document.querySelector(this.selector)?this.done():setTimeout((function(){return Dt.check()}),yt.elements.checkInterval)},Kt.prototype.done=function(){return this.completeCallback(this),this.completeCallback=null,this.progress=100},Kt})(),O=(function(){Kt.prototype.states={loading:0,interactive:50,complete:100};function Kt(){var Dt,Qt,cn=this;this.progress=(Qt=this.states[document.readyState])!=null?Qt:100,Dt=document.onreadystatechange,document.onreadystatechange=function(){return cn.states[document.readyState]!=null&&(cn.progress=cn.states[document.readyState]),typeof Dt=="function"?Dt.apply(null,arguments):void 0}}return Kt})(),ee=(function(){function Kt(){var Dt,Qt,cn,nn,gn,Cn=this;this.progress=0,Dt=0,gn=[],nn=0,cn=kt(),Qt=setInterval(function(){var Fn;return Fn=kt()-cn-50,cn=kt(),gn.push(Fn),gn.length>yt.eventLag.sampleCount&&gn.shift(),Dt=it(gn),++nn>=yt.eventLag.minSamples&&Dt<yt.eventLag.lagThreshold?(Cn.progress=100,clearInterval(Qt)):Cn.progress=100*(3/(Dt+3))},50)}return Kt})(),Z=(function(){function Kt(Dt){this.source=Dt,this.last=this.sinceLastUpdate=0,this.rate=yt.initialRate,this.catchup=0,this.progress=this.lastProgress=0,this.source!=null&&(this.progress=Yt(this.source,"progress"))}return Kt.prototype.tick=function(Dt,Qt){var cn;return Qt==null&&(Qt=Yt(this.source,"progress")),Qt>=100&&(this.done=!0),Qt===this.last?this.sinceLastUpdate+=Dt:(this.sinceLastUpdate&&(this.rate=(Qt-this.last)/this.sinceLastUpdate),this.catchup=(Qt-this.progress)/yt.catchupTime,this.sinceLastUpdate=0,this.last=Qt),Qt>this.progress&&(this.progress+=this.catchup*Dt),cn=1-Math.pow(this.progress/100,yt.easeFactor),this.progress+=cn*this.rate*Dt,this.progress=Math.min(this.lastProgress+yt.maxProgressPerFrame,this.progress),this.progress=Math.max(0,this.progress),this.progress=Math.min(100,this.progress),this.lastProgress=this.progress,this.progress},Kt})(),hn=null,ln=null,ot=null,_n=null,nt=null,st=null,f.running=!1,Et=function(){if(yt.restartOnPushState)return f.restart()},window.history.pushState!=null&&(fn=window.history.pushState,window.history.pushState=function(){return Et(),fn.apply(window.history,arguments)}),window.history.replaceState!=null&&(mn=window.history.replaceState,window.history.replaceState=function(){return Et(),mn.apply(window.history,arguments)}),H={ajax:l,elements:Y,document:O,eventLag:ee},(Ot=function(){var Kt,Dt,Qt,cn,nn,gn,Cn,Fn;for(f.sources=hn=[],gn=["ajax","elements","document","eventLag"],Dt=0,cn=gn.length;Dt<cn;Dt++)Kt=gn[Dt],yt[Kt]!==!1&&hn.push(new H[Kt](yt[Kt]));for(Fn=(Cn=yt.extraSources)!=null?Cn:[],Qt=0,nn=Fn.length;Qt<nn;Qt++)$t=Fn[Qt],hn.push(new $t(yt));return f.bar=ot=new A,ln=[],_n=new Z})(),f.stop=function(){return f.trigger("stop"),f.running=!1,ot.destroy(),st=!0,nt!=null&&(typeof at=="function"&&at(nt),nt=null),Ot()},f.restart=function(){return f.trigger("restart"),f.stop(),f.start()},f.go=function(){var Kt;return f.running=!0,ot.render(),Kt=kt(),st=!1,nt=Ft(function(Dt,Qt){var cn,nn,gn,Cn,Fn,Gn,Zn,cr,bn,vr,Nn,ur,ir,wr,jn;for(100-ot.progress,nn=vr=0,gn=!0,Gn=Nn=0,ir=hn.length;Nn<ir;Gn=++Nn)for($t=hn[Gn],bn=ln[Gn]!=null?ln[Gn]:ln[Gn]=[],Fn=(jn=$t.elements)!=null?jn:[$t],Zn=ur=0,wr=Fn.length;ur<wr;Zn=++ur)Cn=Fn[Zn],cr=bn[Zn]!=null?bn[Zn]:bn[Zn]=new Z(Cn),gn&=cr.done,!cr.done&&(nn++,vr+=cr.tick(Dt));return cn=vr/nn,ot.update(_n.tick(Dt,cn)),ot.done()||gn||st?(ot.update(100),f.trigger("done"),setTimeout(function(){return ot.finish(),f.running=!1,f.trigger("hide")},Math.max(yt.ghostTime,Math.max(yt.minTime-(kt()-Kt),0)))):Qt()})},f.start=function(Kt){ft(yt,Kt),f.running=!0;try{ot.render()}catch(Dt){te=Dt}return document.querySelector(".pace")?(f.trigger("start"),f.go()):setTimeout(f.start,50)},g.exports=f}).call(pace)})(pace$1)),pace$1.exports}var paceExports=requirePace();const Pace=getDefaultExportFromCjs(paceExports);Pace.start();const name$2="@kispace-io/geospace",version$2="1.0.21",dependencies$1={"@kispace-io/appspace":"file:../appspace","esbuild-wasm":"^0.25.11",ol:"^10.6.1","ol-mapbox-style":"^13.1.0",osmtogeojson:"^3.0.0-beta.5","font-gis":"^1.0.6","pace-js":"^1.2.4","pubsub-js":"^1.9.5"},devDependencies$1={"@testing-library/jest-dom":"^6.9.1","@types/node":"^24.9.2","@types/pubsub-js":"^1.8.6","@types/toastify-js":"^1.12.4","@vitest/coverage-v8":"^4.0.6","@vitest/ui":"^4.0.6","happy-dom":"^20.0.10",jsdom:"^27.1.0","rollup-plugin-visualizer":"^6.0.5",typescript:"~5.9.3",vite:"^7.1.12","vite-plugin-cross-origin-isolation":"^0.1.6","vite-plugin-mkcert":"^1.17.9","vite-plugin-static-copy":"^3.1.4","vite-plugin-zip":"^1.0.1",vitest:"^4.0.6",esbuild:"^0.25.11"},geospacePackageJson={name:name$2,version:version$2,dependencies:dependencies$1,devDependencies:devDependencies$1};class DependencyContext{constructor(a){this.children=[],this.variables=a,this.proxy=new Proxy(a,this)}get(a,l){return a[l]||this.parent?.getProxy()[l]}set(a,l,A){a[l]=A}put(a,l){this.variables[a]=l}getProxy(){return this.proxy}createChild(a={}){const l=new DependencyContext(a);return l.parent=this,this.children.push(l),l}getChildren(){return this.children}getParent(){return this.parent}destroy(){const a=this.parent?.children.indexOf(this);a!==void 0&&a>=0&&this.parent?.children.splice(a,1),this.parent=void 0}}const rootContext=new DependencyContext({}),uiContext=rootContext.createChild({});uiContext.put("html",x$1);uiContext.put("render",B$1);const LogLevelPriority={debug:0,info:1,warning:2,error:3};let globalLogLevel="debug";const originalConsole={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console)};let logHandler=null;const messageBuffer=[];function formatArg(g){if(g===null)return"null";if(g===void 0)return"undefined";if(typeof g=="string")return g;if(typeof g=="number"||typeof g=="boolean")return String(g);if(g instanceof Error)return`${g.name}: ${g.message}`;try{return JSON.stringify(g)}catch{return String(g)}}class Logger{constructor(a){this.source=a}info(a){this.log(a,"info")}warning(a){this.log(a,"warning")}warn(a){this.log(a,"warning")}error(a){this.log(a,"error")}debug(a){this.log(a,"debug")}log(a,l){dispatch(this.source,a,l)}}function shouldLog(g){return LogLevelPriority[g]>=LogLevelPriority[globalLogLevel]}function dispatch(g,a,l){shouldLog(l)&&(logHandler?logHandler(g,a,l):(messageBuffer.push({source:g,message:a,level:l}),originalConsole[l==="error"?"error":l==="warning"?"warn":l==="debug"?"debug":"log"](`[${g}] ${a}`)))}function initializeConsoleInterception(){console.log=function(...g){originalConsole.log.apply(console,g),dispatch("Console",g.map(a=>formatArg(a)).join(" "),"info")},console.info=function(...g){originalConsole.info.apply(console,g),dispatch("Console",g.map(a=>formatArg(a)).join(" "),"info")},console.warn=function(...g){originalConsole.warn.apply(console,g),dispatch("Console",g.map(a=>formatArg(a)).join(" "),"warning")},console.error=function(...g){originalConsole.error.apply(console,g),dispatch("Console",g.map(a=>formatArg(a)).join(" "),"error")},console.debug=function(...g){originalConsole.debug.apply(console,g),dispatch("Console",g.map(a=>formatArg(a)).join(" "),"debug")}}initializeConsoleInterception();function registerLogHandler(g){for(logHandler=g;messageBuffer.length>0;){const a=messageBuffer.shift();a&&g(a.source,a.message,a.level)}}function unregisterLogHandler(){logHandler=null}function createLogger(g){return new Logger(g)}const defaultLogger=createLogger("System");rootContext.put("logger",defaultLogger);var __defProp$g=Object.defineProperty,__defNormalProp=(g,a,l)=>a in g?__defProp$g(g,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):g[a]=l,__publicField=(g,a,l)=>(__defNormalProp(g,typeof a!="symbol"?a+"":a,l),l),__accessCheck=(g,a,l)=>{if(!a.has(g))throw TypeError("Cannot "+l)},__privateIn=(g,a)=>{if(Object(a)!==a)throw TypeError('Cannot use the "in" operator on this value');return g.has(a)},__privateAdd=(g,a,l)=>{if(a.has(g))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(g):a.set(g,l)},__privateMethod=(g,a,l)=>(__accessCheck(g,a,"access private method"),l);function defaultEquals(g,a){return Object.is(g,a)}let activeConsumer=null,inNotificationPhase=!1,epoch=1;const SIGNAL=Symbol("SIGNAL");function setActiveConsumer(g){const a=activeConsumer;return activeConsumer=g,a}function getActiveConsumer(){return activeConsumer}function isInNotificationPhase(){return inNotificationPhase}const REACTIVE_NODE={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function producerAccessed(g){if(inNotificationPhase)throw new Error(typeof ngDevMode<"u"&&ngDevMode?"Assertion error: signal read during notification phase":"");if(activeConsumer===null)return;activeConsumer.consumerOnSignalRead(g);const a=activeConsumer.nextProducerIndex++;if(assertConsumerNode(activeConsumer),a<activeConsumer.producerNode.length&&activeConsumer.producerNode[a]!==g&&consumerIsLive(activeConsumer)){const l=activeConsumer.producerNode[a];producerRemoveLiveConsumerAtIndex(l,activeConsumer.producerIndexOfThis[a])}activeConsumer.producerNode[a]!==g&&(activeConsumer.producerNode[a]=g,activeConsumer.producerIndexOfThis[a]=consumerIsLive(activeConsumer)?producerAddLiveConsumer(g,activeConsumer,a):0),activeConsumer.producerLastReadVersion[a]=g.version}function producerIncrementEpoch(){epoch++}function producerUpdateValueVersion(g){if(!(!g.dirty&&g.lastCleanEpoch===epoch)){if(!g.producerMustRecompute(g)&&!consumerPollProducersForChange(g)){g.dirty=!1,g.lastCleanEpoch=epoch;return}g.producerRecomputeValue(g),g.dirty=!1,g.lastCleanEpoch=epoch}}function producerNotifyConsumers(g){if(g.liveConsumerNode===void 0)return;const a=inNotificationPhase;inNotificationPhase=!0;try{for(const l of g.liveConsumerNode)l.dirty||consumerMarkDirty(l)}finally{inNotificationPhase=a}}function producerUpdatesAllowed(){return activeConsumer?.consumerAllowSignalWrites!==!1}function consumerMarkDirty(g){var a;g.dirty=!0,producerNotifyConsumers(g),(a=g.consumerMarkedDirty)==null||a.call(g.wrapper??g)}function consumerBeforeComputation(g){return g&&(g.nextProducerIndex=0),setActiveConsumer(g)}function consumerAfterComputation(g,a){if(setActiveConsumer(a),!(!g||g.producerNode===void 0||g.producerIndexOfThis===void 0||g.producerLastReadVersion===void 0)){if(consumerIsLive(g))for(let l=g.nextProducerIndex;l<g.producerNode.length;l++)producerRemoveLiveConsumerAtIndex(g.producerNode[l],g.producerIndexOfThis[l]);for(;g.producerNode.length>g.nextProducerIndex;)g.producerNode.pop(),g.producerLastReadVersion.pop(),g.producerIndexOfThis.pop()}}function consumerPollProducersForChange(g){assertConsumerNode(g);for(let a=0;a<g.producerNode.length;a++){const l=g.producerNode[a],A=g.producerLastReadVersion[a];if(A!==l.version||(producerUpdateValueVersion(l),A!==l.version))return!0}return!1}function producerAddLiveConsumer(g,a,l){var A;if(assertProducerNode(g),assertConsumerNode(g),g.liveConsumerNode.length===0){(A=g.watched)==null||A.call(g.wrapper);for(let O=0;O<g.producerNode.length;O++)g.producerIndexOfThis[O]=producerAddLiveConsumer(g.producerNode[O],g,O)}return g.liveConsumerIndexOfThis.push(l),g.liveConsumerNode.push(a)-1}function producerRemoveLiveConsumerAtIndex(g,a){var l;if(assertProducerNode(g),assertConsumerNode(g),typeof ngDevMode<"u"&&ngDevMode&&a>=g.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${a} is out of bounds of ${g.liveConsumerNode.length} consumers)`);if(g.liveConsumerNode.length===1){(l=g.unwatched)==null||l.call(g.wrapper);for(let O=0;O<g.producerNode.length;O++)producerRemoveLiveConsumerAtIndex(g.producerNode[O],g.producerIndexOfThis[O])}const A=g.liveConsumerNode.length-1;if(g.liveConsumerNode[a]=g.liveConsumerNode[A],g.liveConsumerIndexOfThis[a]=g.liveConsumerIndexOfThis[A],g.liveConsumerNode.length--,g.liveConsumerIndexOfThis.length--,a<g.liveConsumerNode.length){const O=g.liveConsumerIndexOfThis[a],Y=g.liveConsumerNode[a];assertConsumerNode(Y),Y.producerIndexOfThis[O]=a}}function consumerIsLive(g){var a;return g.consumerIsAlwaysLive||(((a=g?.liveConsumerNode)==null?void 0:a.length)??0)>0}function assertConsumerNode(g){g.producerNode??(g.producerNode=[]),g.producerIndexOfThis??(g.producerIndexOfThis=[]),g.producerLastReadVersion??(g.producerLastReadVersion=[])}function assertProducerNode(g){g.liveConsumerNode??(g.liveConsumerNode=[]),g.liveConsumerIndexOfThis??(g.liveConsumerIndexOfThis=[])}function computedGet(g){if(producerUpdateValueVersion(g),producerAccessed(g),g.value===ERRORED)throw g.error;return g.value}function createComputed(g){const a=Object.create(COMPUTED_NODE);a.computation=g;const l=()=>computedGet(a);return l[SIGNAL]=a,l}const UNSET=Symbol("UNSET"),COMPUTING=Symbol("COMPUTING"),ERRORED=Symbol("ERRORED"),COMPUTED_NODE={...REACTIVE_NODE,value:UNSET,dirty:!0,error:null,equal:defaultEquals,producerMustRecompute(g){return g.value===UNSET||g.value===COMPUTING},producerRecomputeValue(g){if(g.value===COMPUTING)throw new Error("Detected cycle in computations.");const a=g.value;g.value=COMPUTING;const l=consumerBeforeComputation(g);let A,O=!1;try{A=g.computation.call(g.wrapper),O=a!==UNSET&&a!==ERRORED&&g.equal.call(g.wrapper,a,A)}catch(Y){A=ERRORED,g.error=Y}finally{consumerAfterComputation(g,l)}if(O){g.value=a;return}g.value=A,g.version++}};function defaultThrowError(){throw new Error}let throwInvalidWriteToSignalErrorFn=defaultThrowError;function throwInvalidWriteToSignalError(){throwInvalidWriteToSignalErrorFn()}function createSignal(g){const a=Object.create(SIGNAL_NODE);a.value=g;const l=()=>(producerAccessed(a),a.value);return l[SIGNAL]=a,l}function signalGetFn(){return producerAccessed(this),this.value}function signalSetFn(g,a){producerUpdatesAllowed()||throwInvalidWriteToSignalError(),g.equal.call(g.wrapper,g.value,a)||(g.value=a,signalValueChanged(g))}const SIGNAL_NODE={...REACTIVE_NODE,equal:defaultEquals,value:void 0};function signalValueChanged(g){g.version++,producerIncrementEpoch(),producerNotifyConsumers(g)}const NODE=Symbol("node");var Signal;(g=>{var a,l,A,O;class Y{constructor(xe,ne={}){__privateAdd(this,l),__publicField(this,a);const f=createSignal(xe)[SIGNAL];if(this[NODE]=f,f.wrapper=this,ne){const d=ne.equals;d&&(f.equal=d),f.watched=ne[g.subtle.watched],f.unwatched=ne[g.subtle.unwatched]}}get(){if(!(0,g.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return signalGetFn.call(this[NODE])}set(xe){if(!(0,g.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(isInNotificationPhase())throw new Error("Writes to signals not permitted during Watcher callback");const ne=this[NODE];signalSetFn(ne,xe)}}a=NODE,l=new WeakSet,g.isState=ee=>typeof ee=="object"&&__privateIn(l,ee),g.State=Y;class R{constructor(xe,ne){__privateAdd(this,O),__publicField(this,A);const f=createComputed(xe)[SIGNAL];if(f.consumerAllowSignalWrites=!0,this[NODE]=f,f.wrapper=this,ne){const d=ne.equals;d&&(f.equal=d),f.watched=ne[g.subtle.watched],f.unwatched=ne[g.subtle.unwatched]}}get(){if(!(0,g.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return computedGet(this[NODE])}}A=NODE,O=new WeakSet,g.isComputed=ee=>typeof ee=="object"&&__privateIn(O,ee),g.Computed=R,(ee=>{var xe,ne,te,f;function d(it){let ot,st=null;try{st=setActiveConsumer(null),ot=it()}finally{setActiveConsumer(st)}return ot}ee.untrack=d;function H(it){var ot;if(!(0,g.isComputed)(it)&&!(0,g.isWatcher)(it))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return((ot=it[NODE].producerNode)==null?void 0:ot.map(st=>st.wrapper))??[]}ee.introspectSources=H;function Z(it){var ot;if(!(0,g.isComputed)(it)&&!(0,g.isState)(it))throw new TypeError("Called introspectSinks without a Signal argument");return((ot=it[NODE].liveConsumerNode)==null?void 0:ot.map(st=>st.wrapper))??[]}ee.introspectSinks=Z;function Ye(it){if(!(0,g.isComputed)(it)&&!(0,g.isState)(it))throw new TypeError("Called hasSinks without a Signal argument");const ot=it[NODE].liveConsumerNode;return ot?ot.length>0:!1}ee.hasSinks=Ye;function et(it){if(!(0,g.isComputed)(it)&&!(0,g.isWatcher)(it))throw new TypeError("Called hasSources without a Computed or Watcher argument");const ot=it[NODE].producerNode;return ot?ot.length>0:!1}ee.hasSources=et;class tt{constructor(ot){__privateAdd(this,ne),__privateAdd(this,te),__publicField(this,xe);let st=Object.create(REACTIVE_NODE);st.wrapper=this,st.consumerMarkedDirty=ot,st.consumerIsAlwaysLive=!0,st.consumerAllowSignalWrites=!1,st.producerNode=[],this[NODE]=st}watch(...ot){if(!(0,g.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");__privateMethod(this,te,f).call(this,ot);const st=this[NODE];st.dirty=!1;const at=setActiveConsumer(st);for(const ct of ot)producerAccessed(ct[NODE]);setActiveConsumer(at)}unwatch(...ot){if(!(0,g.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");__privateMethod(this,te,f).call(this,ot);const st=this[NODE];assertConsumerNode(st);for(let at=st.producerNode.length-1;at>=0;at--)if(ot.includes(st.producerNode[at].wrapper)){producerRemoveLiveConsumerAtIndex(st.producerNode[at],st.producerIndexOfThis[at]);const ct=st.producerNode.length-1;if(st.producerNode[at]=st.producerNode[ct],st.producerIndexOfThis[at]=st.producerIndexOfThis[ct],st.producerNode.length--,st.producerIndexOfThis.length--,st.nextProducerIndex--,at<st.producerNode.length){const ft=st.producerIndexOfThis[at],ut=st.producerNode[at];assertProducerNode(ut),ut.liveConsumerIndexOfThis[ft]=at}}}getPending(){if(!(0,g.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[NODE].producerNode.filter(st=>st.dirty).map(st=>st.wrapper)}}xe=NODE,ne=new WeakSet,te=new WeakSet,f=function(it){for(const ot of it)if(!(0,g.isComputed)(ot)&&!(0,g.isState)(ot))throw new TypeError("Called watch/unwatch without a Computed or State argument")},g.isWatcher=it=>__privateIn(ne,it),ee.Watcher=tt;function nt(){var it;return(it=getActiveConsumer())==null?void 0:it.wrapper}ee.currentComputed=nt,ee.watched=Symbol("watched"),ee.unwatched=Symbol("unwatched")})(g.subtle||(g.subtle={}))})(Signal||(Signal={}));const i$1=Symbol("SignalWatcherBrand"),s=new FinalizationRegistry((({watcher:g,signal:a})=>{g.unwatch(a)})),h$1=new WeakMap;function e(g){return g[i$1]===!0?(console.warn("SignalWatcher should not be applied to the same class more than once."),g):class extends g{constructor(){super(...arguments),this._$St=new Signal.State(0),this._$Si=!1,this._$So=!0,this._$Sh=new Set}_$Sl(){if(this._$Su!==void 0)return;this._$Sv=new Signal.Computed((()=>{this._$St.get(),super.performUpdate()}));const a=this._$Su=new Signal.subtle.Watcher((function(){const l=h$1.get(this);l!==void 0&&(l._$Si===!1&&l.requestUpdate(),this.watch())}));h$1.set(a,this),s.register(this,{watcher:a,signal:this._$Sv}),a.watch(this._$Sv)}_$Sp(){this._$Su!==void 0&&(this._$Su.unwatch(this._$Sv),this._$Sv=void 0,this._$Su=void 0)}performUpdate(){this.isUpdatePending&&(this._$Sl(),this._$Si=!0,this._$St.set(this._$St.get()+1),this._$Si=!1,this._$Sv.get())}update(a){try{this._$So?(this._$So=!1,super.update(a)):this._$Sh.forEach((l=>l.commit()))}finally{this.isUpdatePending=!1,this._$Sh.clear()}}requestUpdate(a,l,A){this._$So=!0,super.requestUpdate(a,l,A)}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask((()=>{this.isConnected===!1&&this._$Sp()}))}_(a){this._$Sh.add(a);const l=this._$So;this.requestUpdate(),this._$So=l}m(a){this._$Sh.delete(a)}}}Signal.State;Signal.Computed;const r=(g,a)=>new Signal.State(g,a),PubSub=PubSub$1||PubSubModule,subscribe=(g,a)=>{PubSub.subscribe(g,(l,A)=>a(A))},publish=(g,a)=>{PubSub.publish(g,a)},topic=g=>function(a,l,A){const O=A.value;return O.topic=g,A};rootContext.put("subscribe",subscribe);rootContext.put("publish",publish);const TOPIC_CONTRIBUTEIONS_CHANGED="events/contributionregistry/contributionsChanged";class ContributionRegistry{constructor(){this.contributions=new Map}registerContribution(a,l){const A=this.getContributions(a);if(l.disabled instanceof Function){const O=l.disabled;l.disabled=new Signal.Computed(O)}A.push(l),publish(TOPIC_CONTRIBUTEIONS_CHANGED,{target:a,contributions:A})}getContributions(a){return this.contributions.has(a)||this.contributions.set(a,[]),this.contributions.get(a)}}const contributionRegistry=new ContributionRegistry;rootContext.put("contributionRegistry",contributionRegistry);const EMPTY_SIGNALPORT={},activePartSignal=r(null),activeEditorSignal=r(null),partDirtySignal=r(null),activeTasksSignal=r(0),activeSelectionSignal=r(void 0);r({name:"",timestamp:0});class Command{constructor(a,l,A,O,Y){this.id=a,this.name=l,this.description=A,this.parameters=O||[],this.output=Y||[]}}class CommandStack{async execute(a,l){return commandRegistry.execute(a,l)}async undo(){}async redo(){}}class CommandRegistry{constructor(){this.commands={},this.handlers=new Map}registerHandler(a,l){this.handlers.has(a)||this.handlers.set(a,[]);const A=this.handlers.get(a);A.push(l),A.sort((O,Y)=>(Y.ranking??0)-(O.ranking??0))}getHandler(a){return this.handlers.get(a)}createExecutionContext(a){return{params:a||{},activePart:activePartSignal.get(),activeEditor:activeEditorSignal.get()}}execute(a,l={}){const A=this.getHandler(a);if(!A)throw defaultLogger.debug(`[CommandRegistry] No handlers registered for command: ${a}`),new Error(`No handlers registered for command: ${a}`);const O=this.getCommand(a),Y=l.params?` params: ${JSON.stringify(l.params)}`:"";defaultLogger.debug(`[CommandRegistry] Executing command: ${a}${O?` (${O.name})`:""}${Y}`);for(const R of A)if(R.canExecute===void 0||R.canExecute(l))try{const ee=R.execute(l);return defaultLogger.debug(`[CommandRegistry] Command executed successfully: ${a} (result: ${ee})`),ee}catch(ee){const xe=ee instanceof Error?ee.message:String(ee);throw defaultLogger.error(`[CommandRegistry] Command execution failed: ${a} - ${xe}`),ee}defaultLogger.error(`[CommandRegistry] No handler found to execute command: ${a}`)}createAndRegisterCommand(a,l,A,O,Y){const R=new Command(a,l,A,O);this.registerCommand(R),Y&&this.registerHandler(a,Y)}registerCommand(a){this.commands[a.id]=a,defaultLogger.debug(`Command registered: ${a.id}`)}hasCommand(a){return a in this.commands}listCommands(a){return a?Object.values(this.commands).filter(l=>(commandRegistry.getHandler(l.id)||[]).some(O=>O.canExecute===void 0||O.canExecute(a))).reduce((l,A)=>(l[A.id]=A,l),{}):this.commands}getCommand(a){return this.commands[a]}registerAll(a){const l=a.command.id;this.registerCommand(a.command),a.handler&&this.registerHandler(l,a.handler),a.contribution&&a.contribution.target&&contributionRegistry.registerContribution(a.contribution.target,{command:l,...a.contribution})}}const commandRegistry=new CommandRegistry;rootContext.put("commandRegistry",commandRegistry);const registerAll=g=>{commandRegistry.registerAll(g)},commandregistry=Object.freeze(Object.defineProperty({__proto__:null,Command,CommandRegistry,CommandStack,commandRegistry,registerAll},Symbol.toStringTag,{value:"Module"}));class KeyBindingManager{constructor(){this.bindings=new Map,this.enabled=!0,document.addEventListener("keydown",this.handleKeyDown.bind(this),!0),this.registerExistingCommandBindings(),this.watchCommandRegistry()}registerExistingCommandBindings(){const a=commandRegistry.listCommands();Object.values(a).forEach(l=>{l.keyBinding&&this.registerKeyBinding(l.id,l.keyBinding)})}watchCommandRegistry(){const a=commandRegistry.registerCommand.bind(commandRegistry);commandRegistry.registerCommand=l=>{a(l),l.keyBinding&&this.registerKeyBinding(l.id,l.keyBinding)}}parseKeyBinding(a){if(!a||a.trim()==="")return null;const l=a.toUpperCase().split("+").map(R=>R.trim());if(l.length===0)return null;const A={ctrl:!1,alt:!1,shift:!1,meta:!1},O=l[l.length-1],Y=l.slice(0,-1);for(const R of Y)switch(R){case"CTRL":case"CONTROL":A.ctrl=!0;break;case"ALT":case"OPTION":A.alt=!0;break;case"SHIFT":A.shift=!0;break;case"META":case"CMD":case"COMMAND":case"WIN":case"WINDOWS":A.meta=!0;break;default:defaultLogger.warn(`Unknown modifier: ${R}`)}return A.key=this.normalizeKey(O),A}normalizeKey(a){return{SPACE:" ",ESC:"ESCAPE",RETURN:"ENTER",LEFT:"ARROWLEFT",RIGHT:"ARROWRIGHT",UP:"ARROWUP",DOWN:"ARROWDOWN",DEL:"DELETE",INS:"INSERT",PAGEUP:"PAGEUP",PAGEDOWN:"PAGEDOWN"}[a]||a}getBindingKey(a){const l=[];return a.ctrl&&l.push("ctrl"),a.alt&&l.push("alt"),a.shift&&l.push("shift"),a.meta&&l.push("meta"),l.sort(),`${l.join("+")}+${a.key.toUpperCase()}`}registerKeyBinding(a,l){const A=this.parseKeyBinding(l);if(!A)return defaultLogger.error(`Invalid key binding: ${l}`),!1;A.commandId=a;const O=this.getBindingKey(A);this.bindings.has(O)||this.bindings.set(O,[]);const Y=this.bindings.get(O);return Y.find(ee=>ee.commandId===a)?(defaultLogger.error(`Key binding ${l} already registered for command ${a}`),!1):(Y.push(A),defaultLogger.debug(`Key binding registered: ${l} -> ${a}`),!0)}unregisterKeyBinding(a,l){if(l){const A=this.parseKeyBinding(l);if(A){const O=this.getBindingKey(A),Y=this.bindings.get(O);if(Y){const R=Y.filter(ee=>ee.commandId!==a);R.length===0?this.bindings.delete(O):this.bindings.set(O,R)}}}else for(const[A,O]of this.bindings.entries()){const Y=O.filter(R=>R.commandId!==a);Y.length===0?this.bindings.delete(A):this.bindings.set(A,Y)}}getKeyBindingsForCommand(a){const l=[];for(const A of this.bindings.values())for(const O of A)O.commandId===a&&l.push(this.formatKeyBinding(O));return l}formatKeyBinding(a){const l=[];a.ctrl&&l.push("Ctrl"),a.alt&&l.push("Alt"),a.shift&&l.push("Shift"),a.meta&&l.push("Cmd");let A=a.key;return A.length===1?A=A.toUpperCase():A=A.charAt(0).toUpperCase()+A.slice(1).toLowerCase(),l.push(A),l.join("+")}handleKeyDown(a){if(!this.enabled)return;const l=a.target;if(l&&(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable)){const R=a.key.toUpperCase();if(!((a.ctrlKey||a.metaKey)&&a.shiftKey&&R==="P"))return}const A={commandId:"",key:this.normalizeKey(a.key.toUpperCase()),ctrl:a.ctrlKey,alt:a.altKey,shift:a.shiftKey,meta:a.metaKey},O=this.getBindingKey(A),Y=this.bindings.get(O);if(Y&&Y.length>0){const R=Y[0];try{a.preventDefault(),a.stopPropagation();const ee=commandRegistry.createExecutionContext({});commandRegistry.execute(R.commandId,ee),defaultLogger.info(`Executed command via key binding: ${R.commandId}`)}catch(ee){defaultLogger.error(`Failed to execute command ${R.commandId}: ${ee.message}`)}}}setEnabled(a){this.enabled=a}isEnabled(){return this.enabled}getAllBindings(){return new Map(this.bindings)}clearAll(){this.bindings.clear()}}defaultLogger.debug("KeyBindingManager initializing...");const keyBindingManager=new KeyBindingManager;defaultLogger.debug("KeyBindingManager initialized");rootContext.put("keyBindingManager",keyBindingManager);function L(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var T=L();function G(g){T=g}var I={exec:()=>null};function h(g,a=""){let l=typeof g=="string"?g:g.source,A={replace:(O,Y)=>{let R=typeof Y=="string"?Y:Y.source;return R=R.replace(m.caret,"$1"),l=l.replace(O,R),A},getRegex:()=>new RegExp(l,a)};return A}var m={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:g=>new RegExp(`^( {0,3}${g})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:g=>new RegExp(`^ {0,${Math.min(3,g-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:g=>new RegExp(`^ {0,${Math.min(3,g-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:g=>new RegExp(`^ {0,${Math.min(3,g-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:g=>new RegExp(`^ {0,${Math.min(3,g-1)}}#`),htmlBeginRegex:g=>new RegExp(`^ {0,${Math.min(3,g-1)}}<(?:[a-z].*>|!--)`,"i")},be=/^(?:[ \t]*(?:\n|$))+/,Re=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Te=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,E=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Oe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,F=/(?:[*+-]|\d{1,9}[.)])/,ie=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,oe=h(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),we=h(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),j=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ye=/^[^\n]+/,Q=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Pe=h(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Q).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Se=h(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,F).getRegex(),v="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",U=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,$e=h("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",U).replace("tag",v).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ae=h(j).replace("hr",E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),_e=h(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ae).getRegex(),K={blockquote:_e,code:Re,def:Pe,fences:Te,heading:Oe,hr:E,html:$e,lheading:oe,list:Se,newline:be,paragraph:ae,table:I,text:ye},re=h("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),Le={...K,lheading:we,table:re,paragraph:h(j).replace("hr",E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",re).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex()},Me={...K,html:h(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",U).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:I,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:h(j).replace("hr",E).replace("heading",` *#{1,6} *[^
]`).replace("lheading",oe).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ze=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ae=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,le=/^( {2,}|\\)\n(?!\s*$)/,Ie=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,D=/[\p{P}\p{S}]/u,W=/[\s\p{P}\p{S}]/u,ue=/[^\s\p{P}\p{S}]/u,Ee=h(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,W).getRegex(),pe=/(?!~)[\p{P}\p{S}]/u,Ce=/(?!~)[\s\p{P}\p{S}]/u,Be=/(?:[^\s\p{P}\p{S}]|~)/u,qe=h(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),ce=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ve=h(ce,"u").replace(/punct/g,D).getRegex(),De=h(ce,"u").replace(/punct/g,pe).getRegex(),he="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",He=h(he,"gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Ze=h(he,"gu").replace(/notPunctSpace/g,Be).replace(/punctSpace/g,Ce).replace(/punct/g,pe).getRegex(),Ge=h("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Ne=h(/\\(punct)/,"gu").replace(/punct/g,D).getRegex(),Fe=h(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),je=h(U).replace("(?:-->|$)","-->").getRegex(),Qe=h("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",je).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),q=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ue=h(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",q).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),de=h(/^!?\[(label)\]\[(ref)\]/).replace("label",q).replace("ref",Q).getRegex(),ke=h(/^!?\[(ref)\](?:\[\])?/).replace("ref",Q).getRegex(),Ke=h("reflink|nolink(?!\\()","g").replace("reflink",de).replace("nolink",ke).getRegex(),se=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,X={_backpedal:I,anyPunctuation:Ne,autolink:Fe,blockSkip:qe,br:le,code:Ae,del:I,emStrongLDelim:ve,emStrongRDelimAst:He,emStrongRDelimUnd:Ge,escape:ze,link:Ue,nolink:ke,punctuation:Ee,reflink:de,reflinkSearch:Ke,tag:Qe,text:Ie,url:I},We={...X,link:h(/^!?\[(label)\]\((.*?)\)/).replace("label",q).getRegex(),reflink:h(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",q).getRegex()},N={...X,emStrongRDelimAst:Ze,emStrongLDelim:De,url:h(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",se).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:h(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",se).getRegex()},Xe={...N,br:h(le).replace("{2,}","*").getRegex(),text:h(N.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},C={normal:K,gfm:Le,pedantic:Me},M={normal:X,gfm:N,breaks:Xe,pedantic:We},Je={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ge=g=>Je[g];function w(g,a){if(a){if(m.escapeTest.test(g))return g.replace(m.escapeReplace,ge)}else if(m.escapeTestNoEncode.test(g))return g.replace(m.escapeReplaceNoEncode,ge);return g}function J(g){try{g=encodeURI(g).replace(m.percentDecode,"%")}catch{return null}return g}function V(g,a){let l=g.replace(m.findPipe,(Y,R,ee)=>{let xe=!1,ne=R;for(;--ne>=0&&ee[ne]==="\\";)xe=!xe;return xe?"|":" |"}),A=l.split(m.splitPipe),O=0;if(A[0].trim()||A.shift(),A.length>0&&!A.at(-1)?.trim()&&A.pop(),a)if(A.length>a)A.splice(a);else for(;A.length<a;)A.push("");for(;O<A.length;O++)A[O]=A[O].trim().replace(m.slashPipe,"|");return A}function z(g,a,l){let A=g.length;if(A===0)return"";let O=0;for(;O<A&&g.charAt(A-O-1)===a;)O++;return g.slice(0,A-O)}function fe(g,a){if(g.indexOf(a[1])===-1)return-1;let l=0;for(let A=0;A<g.length;A++)if(g[A]==="\\")A++;else if(g[A]===a[0])l++;else if(g[A]===a[1]&&(l--,l<0))return A;return l>0?-2:-1}function me(g,a,l,A,O){let Y=a.href,R=a.title||null,ee=g[1].replace(O.other.outputLinkReplace,"$1");A.state.inLink=!0;let xe={type:g[0].charAt(0)==="!"?"image":"link",raw:l,href:Y,title:R,text:ee,tokens:A.inlineTokens(ee)};return A.state.inLink=!1,xe}function Ve(g,a,l){let A=g.match(l.other.indentCodeCompensation);if(A===null)return a;let O=A[1];return a.split(`
`).map(Y=>{let R=Y.match(l.other.beginningSpace);if(R===null)return Y;let[ee]=R;return ee.length>=O.length?Y.slice(O.length):Y}).join(`
`)}var y=class{options;rules;lexer;constructor(g){this.options=g||T}space(g){let a=this.rules.block.newline.exec(g);if(a&&a[0].length>0)return{type:"space",raw:a[0]}}code(g){let a=this.rules.block.code.exec(g);if(a){let l=a[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:a[0],codeBlockStyle:"indented",text:this.options.pedantic?l:z(l,`
`)}}}fences(g){let a=this.rules.block.fences.exec(g);if(a){let l=a[0],A=Ve(l,a[3]||"",this.rules);return{type:"code",raw:l,lang:a[2]?a[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):a[2],text:A}}}heading(g){let a=this.rules.block.heading.exec(g);if(a){let l=a[2].trim();if(this.rules.other.endingHash.test(l)){let A=z(l,"#");(this.options.pedantic||!A||this.rules.other.endingSpaceChar.test(A))&&(l=A.trim())}return{type:"heading",raw:a[0],depth:a[1].length,text:l,tokens:this.lexer.inline(l)}}}hr(g){let a=this.rules.block.hr.exec(g);if(a)return{type:"hr",raw:z(a[0],`
`)}}blockquote(g){let a=this.rules.block.blockquote.exec(g);if(a){let l=z(a[0],`
`).split(`
`),A="",O="",Y=[];for(;l.length>0;){let R=!1,ee=[],xe;for(xe=0;xe<l.length;xe++)if(this.rules.other.blockquoteStart.test(l[xe]))ee.push(l[xe]),R=!0;else if(!R)ee.push(l[xe]);else break;l=l.slice(xe);let ne=ee.join(`
`),te=ne.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");A=A?`${A}
${ne}`:ne,O=O?`${O}
${te}`:te;let f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(te,Y,!0),this.lexer.state.top=f,l.length===0)break;let d=Y.at(-1);if(d?.type==="code")break;if(d?.type==="blockquote"){let H=d,Z=H.raw+`
`+l.join(`
`),Ye=this.blockquote(Z);Y[Y.length-1]=Ye,A=A.substring(0,A.length-H.raw.length)+Ye.raw,O=O.substring(0,O.length-H.text.length)+Ye.text;break}else if(d?.type==="list"){let H=d,Z=H.raw+`
`+l.join(`
`),Ye=this.list(Z);Y[Y.length-1]=Ye,A=A.substring(0,A.length-d.raw.length)+Ye.raw,O=O.substring(0,O.length-H.raw.length)+Ye.raw,l=Z.substring(Y.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:A,tokens:Y,text:O}}}list(g){let a=this.rules.block.list.exec(g);if(a){let l=a[1].trim(),A=l.length>1,O={type:"list",raw:"",ordered:A,start:A?+l.slice(0,-1):"",loose:!1,items:[]};l=A?`\\d{1,9}\\${l.slice(-1)}`:`\\${l}`,this.options.pedantic&&(l=A?l:"[*+-]");let Y=this.rules.other.listItemRegex(l),R=!1;for(;g;){let xe=!1,ne="",te="";if(!(a=Y.exec(g))||this.rules.block.hr.test(g))break;ne=a[0],g=g.substring(ne.length);let f=a[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,tt=>" ".repeat(3*tt.length)),d=g.split(`
`,1)[0],H=!f.trim(),Z=0;if(this.options.pedantic?(Z=2,te=f.trimStart()):H?Z=a[1].length+1:(Z=a[2].search(this.rules.other.nonSpaceChar),Z=Z>4?1:Z,te=f.slice(Z),Z+=a[1].length),H&&this.rules.other.blankLine.test(d)&&(ne+=d+`
`,g=g.substring(d.length+1),xe=!0),!xe){let tt=this.rules.other.nextBulletRegex(Z),nt=this.rules.other.hrRegex(Z),it=this.rules.other.fencesBeginRegex(Z),ot=this.rules.other.headingBeginRegex(Z),st=this.rules.other.htmlBeginRegex(Z);for(;g;){let at=g.split(`
`,1)[0],ct;if(d=at,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),ct=d):ct=d.replace(this.rules.other.tabCharGlobal,"    "),it.test(d)||ot.test(d)||st.test(d)||tt.test(d)||nt.test(d))break;if(ct.search(this.rules.other.nonSpaceChar)>=Z||!d.trim())te+=`
`+ct.slice(Z);else{if(H||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||it.test(f)||ot.test(f)||nt.test(f))break;te+=`
`+d}!H&&!d.trim()&&(H=!0),ne+=at+`
`,g=g.substring(at.length+1),f=ct.slice(Z)}}O.loose||(R?O.loose=!0:this.rules.other.doubleBlankLine.test(ne)&&(R=!0));let Ye=null,et;this.options.gfm&&(Ye=this.rules.other.listIsTask.exec(te),Ye&&(et=Ye[0]!=="[ ] ",te=te.replace(this.rules.other.listReplaceTask,""))),O.items.push({type:"list_item",raw:ne,task:!!Ye,checked:et,loose:!1,text:te,tokens:[]}),O.raw+=ne}let ee=O.items.at(-1);if(ee)ee.raw=ee.raw.trimEnd(),ee.text=ee.text.trimEnd();else return;O.raw=O.raw.trimEnd();for(let xe=0;xe<O.items.length;xe++)if(this.lexer.state.top=!1,O.items[xe].tokens=this.lexer.blockTokens(O.items[xe].text,[]),!O.loose){let ne=O.items[xe].tokens.filter(f=>f.type==="space"),te=ne.length>0&&ne.some(f=>this.rules.other.anyLine.test(f.raw));O.loose=te}if(O.loose)for(let xe=0;xe<O.items.length;xe++)O.items[xe].loose=!0;return O}}html(g){let a=this.rules.block.html.exec(g);if(a)return{type:"html",block:!0,raw:a[0],pre:a[1]==="pre"||a[1]==="script"||a[1]==="style",text:a[0]}}def(g){let a=this.rules.block.def.exec(g);if(a){let l=a[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),A=a[2]?a[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",O=a[3]?a[3].substring(1,a[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):a[3];return{type:"def",tag:l,raw:a[0],href:A,title:O}}}table(g){let a=this.rules.block.table.exec(g);if(!a||!this.rules.other.tableDelimiter.test(a[2]))return;let l=V(a[1]),A=a[2].replace(this.rules.other.tableAlignChars,"").split("|"),O=a[3]?.trim()?a[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],Y={type:"table",raw:a[0],header:[],align:[],rows:[]};if(l.length===A.length){for(let R of A)this.rules.other.tableAlignRight.test(R)?Y.align.push("right"):this.rules.other.tableAlignCenter.test(R)?Y.align.push("center"):this.rules.other.tableAlignLeft.test(R)?Y.align.push("left"):Y.align.push(null);for(let R=0;R<l.length;R++)Y.header.push({text:l[R],tokens:this.lexer.inline(l[R]),header:!0,align:Y.align[R]});for(let R of O)Y.rows.push(V(R,Y.header.length).map((ee,xe)=>({text:ee,tokens:this.lexer.inline(ee),header:!1,align:Y.align[xe]})));return Y}}lheading(g){let a=this.rules.block.lheading.exec(g);if(a)return{type:"heading",raw:a[0],depth:a[2].charAt(0)==="="?1:2,text:a[1],tokens:this.lexer.inline(a[1])}}paragraph(g){let a=this.rules.block.paragraph.exec(g);if(a){let l=a[1].charAt(a[1].length-1)===`
`?a[1].slice(0,-1):a[1];return{type:"paragraph",raw:a[0],text:l,tokens:this.lexer.inline(l)}}}text(g){let a=this.rules.block.text.exec(g);if(a)return{type:"text",raw:a[0],text:a[0],tokens:this.lexer.inline(a[0])}}escape(g){let a=this.rules.inline.escape.exec(g);if(a)return{type:"escape",raw:a[0],text:a[1]}}tag(g){let a=this.rules.inline.tag.exec(g);if(a)return!this.lexer.state.inLink&&this.rules.other.startATag.test(a[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(a[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(a[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(a[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:a[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:a[0]}}link(g){let a=this.rules.inline.link.exec(g);if(a){let l=a[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(l)){if(!this.rules.other.endAngleBracket.test(l))return;let Y=z(l.slice(0,-1),"\\");if((l.length-Y.length)%2===0)return}else{let Y=fe(a[2],"()");if(Y===-2)return;if(Y>-1){let R=(a[0].indexOf("!")===0?5:4)+a[1].length+Y;a[2]=a[2].substring(0,Y),a[0]=a[0].substring(0,R).trim(),a[3]=""}}let A=a[2],O="";if(this.options.pedantic){let Y=this.rules.other.pedanticHrefTitle.exec(A);Y&&(A=Y[1],O=Y[3])}else O=a[3]?a[3].slice(1,-1):"";return A=A.trim(),this.rules.other.startAngleBracket.test(A)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(l)?A=A.slice(1):A=A.slice(1,-1)),me(a,{href:A&&A.replace(this.rules.inline.anyPunctuation,"$1"),title:O&&O.replace(this.rules.inline.anyPunctuation,"$1")},a[0],this.lexer,this.rules)}}reflink(g,a){let l;if((l=this.rules.inline.reflink.exec(g))||(l=this.rules.inline.nolink.exec(g))){let A=(l[2]||l[1]).replace(this.rules.other.multipleSpaceGlobal," "),O=a[A.toLowerCase()];if(!O){let Y=l[0].charAt(0);return{type:"text",raw:Y,text:Y}}return me(l,O,l[0],this.lexer,this.rules)}}emStrong(g,a,l=""){let A=this.rules.inline.emStrongLDelim.exec(g);if(!(!A||A[3]&&l.match(this.rules.other.unicodeAlphaNumeric))&&(!(A[1]||A[2])||!l||this.rules.inline.punctuation.exec(l))){let O=[...A[0]].length-1,Y,R,ee=O,xe=0,ne=A[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(ne.lastIndex=0,a=a.slice(-1*g.length+O);(A=ne.exec(a))!=null;){if(Y=A[1]||A[2]||A[3]||A[4]||A[5]||A[6],!Y)continue;if(R=[...Y].length,A[3]||A[4]){ee+=R;continue}else if((A[5]||A[6])&&O%3&&!((O+R)%3)){xe+=R;continue}if(ee-=R,ee>0)continue;R=Math.min(R,R+ee+xe);let te=[...A[0]][0].length,f=g.slice(0,O+A.index+te+R);if(Math.min(O,R)%2){let H=f.slice(1,-1);return{type:"em",raw:f,text:H,tokens:this.lexer.inlineTokens(H)}}let d=f.slice(2,-2);return{type:"strong",raw:f,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(g){let a=this.rules.inline.code.exec(g);if(a){let l=a[2].replace(this.rules.other.newLineCharGlobal," "),A=this.rules.other.nonSpaceChar.test(l),O=this.rules.other.startingSpaceChar.test(l)&&this.rules.other.endingSpaceChar.test(l);return A&&O&&(l=l.substring(1,l.length-1)),{type:"codespan",raw:a[0],text:l}}}br(g){let a=this.rules.inline.br.exec(g);if(a)return{type:"br",raw:a[0]}}del(g){let a=this.rules.inline.del.exec(g);if(a)return{type:"del",raw:a[0],text:a[2],tokens:this.lexer.inlineTokens(a[2])}}autolink(g){let a=this.rules.inline.autolink.exec(g);if(a){let l,A;return a[2]==="@"?(l=a[1],A="mailto:"+l):(l=a[1],A=l),{type:"link",raw:a[0],text:l,href:A,tokens:[{type:"text",raw:l,text:l}]}}}url(g){let a;if(a=this.rules.inline.url.exec(g)){let l,A;if(a[2]==="@")l=a[0],A="mailto:"+l;else{let O;do O=a[0],a[0]=this.rules.inline._backpedal.exec(a[0])?.[0]??"";while(O!==a[0]);l=a[0],a[1]==="www."?A="http://"+a[0]:A=a[0]}return{type:"link",raw:a[0],text:l,href:A,tokens:[{type:"text",raw:l,text:l}]}}}inlineText(g){let a=this.rules.inline.text.exec(g);if(a){let l=this.lexer.state.inRawBlock;return{type:"text",raw:a[0],text:a[0],escaped:l}}}},x=class Xr{tokens;options;state;tokenizer;inlineQueue;constructor(a){this.tokens=[],this.tokens.links=Object.create(null),this.options=a||T,this.options.tokenizer=this.options.tokenizer||new y,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let l={other:m,block:C.normal,inline:M.normal};this.options.pedantic?(l.block=C.pedantic,l.inline=M.pedantic):this.options.gfm&&(l.block=C.gfm,this.options.breaks?l.inline=M.breaks:l.inline=M.gfm),this.tokenizer.rules=l}static get rules(){return{block:C,inline:M}}static lex(a,l){return new Xr(l).lex(a)}static lexInline(a,l){return new Xr(l).inlineTokens(a)}lex(a){a=a.replace(m.carriageReturn,`
`),this.blockTokens(a,this.tokens);for(let l=0;l<this.inlineQueue.length;l++){let A=this.inlineQueue[l];this.inlineTokens(A.src,A.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(a,l=[],A=!1){for(this.options.pedantic&&(a=a.replace(m.tabCharGlobal,"    ").replace(m.spaceLine,""));a;){let O;if(this.options.extensions?.block?.some(R=>(O=R.call({lexer:this},a,l))?(a=a.substring(O.raw.length),l.push(O),!0):!1))continue;if(O=this.tokenizer.space(a)){a=a.substring(O.raw.length);let R=l.at(-1);O.raw.length===1&&R!==void 0?R.raw+=`
`:l.push(O);continue}if(O=this.tokenizer.code(a)){a=a.substring(O.raw.length);let R=l.at(-1);R?.type==="paragraph"||R?.type==="text"?(R.raw+=(R.raw.endsWith(`
`)?"":`
`)+O.raw,R.text+=`
`+O.text,this.inlineQueue.at(-1).src=R.text):l.push(O);continue}if(O=this.tokenizer.fences(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.heading(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.hr(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.blockquote(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.list(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.html(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.def(a)){a=a.substring(O.raw.length);let R=l.at(-1);R?.type==="paragraph"||R?.type==="text"?(R.raw+=(R.raw.endsWith(`
`)?"":`
`)+O.raw,R.text+=`
`+O.raw,this.inlineQueue.at(-1).src=R.text):this.tokens.links[O.tag]||(this.tokens.links[O.tag]={href:O.href,title:O.title},l.push(O));continue}if(O=this.tokenizer.table(a)){a=a.substring(O.raw.length),l.push(O);continue}if(O=this.tokenizer.lheading(a)){a=a.substring(O.raw.length),l.push(O);continue}let Y=a;if(this.options.extensions?.startBlock){let R=1/0,ee=a.slice(1),xe;this.options.extensions.startBlock.forEach(ne=>{xe=ne.call({lexer:this},ee),typeof xe=="number"&&xe>=0&&(R=Math.min(R,xe))}),R<1/0&&R>=0&&(Y=a.substring(0,R+1))}if(this.state.top&&(O=this.tokenizer.paragraph(Y))){let R=l.at(-1);A&&R?.type==="paragraph"?(R.raw+=(R.raw.endsWith(`
`)?"":`
`)+O.raw,R.text+=`
`+O.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=R.text):l.push(O),A=Y.length!==a.length,a=a.substring(O.raw.length);continue}if(O=this.tokenizer.text(a)){a=a.substring(O.raw.length);let R=l.at(-1);R?.type==="text"?(R.raw+=(R.raw.endsWith(`
`)?"":`
`)+O.raw,R.text+=`
`+O.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=R.text):l.push(O);continue}if(a){let R="Infinite loop on byte: "+a.charCodeAt(0);if(this.options.silent){console.error(R);break}else throw new Error(R)}}return this.state.top=!0,l}inline(a,l=[]){return this.inlineQueue.push({src:a,tokens:l}),l}inlineTokens(a,l=[]){let A=a,O=null;if(this.tokens.links){let ee=Object.keys(this.tokens.links);if(ee.length>0)for(;(O=this.tokenizer.rules.inline.reflinkSearch.exec(A))!=null;)ee.includes(O[0].slice(O[0].lastIndexOf("[")+1,-1))&&(A=A.slice(0,O.index)+"["+"a".repeat(O[0].length-2)+"]"+A.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(O=this.tokenizer.rules.inline.anyPunctuation.exec(A))!=null;)A=A.slice(0,O.index)+"++"+A.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(O=this.tokenizer.rules.inline.blockSkip.exec(A))!=null;)A=A.slice(0,O.index)+"["+"a".repeat(O[0].length-2)+"]"+A.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);A=this.options.hooks?.emStrongMask?.call({lexer:this},A)??A;let Y=!1,R="";for(;a;){Y||(R=""),Y=!1;let ee;if(this.options.extensions?.inline?.some(ne=>(ee=ne.call({lexer:this},a,l))?(a=a.substring(ee.raw.length),l.push(ee),!0):!1))continue;if(ee=this.tokenizer.escape(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.tag(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.link(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.reflink(a,this.tokens.links)){a=a.substring(ee.raw.length);let ne=l.at(-1);ee.type==="text"&&ne?.type==="text"?(ne.raw+=ee.raw,ne.text+=ee.text):l.push(ee);continue}if(ee=this.tokenizer.emStrong(a,A,R)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.codespan(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.br(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.del(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(ee=this.tokenizer.autolink(a)){a=a.substring(ee.raw.length),l.push(ee);continue}if(!this.state.inLink&&(ee=this.tokenizer.url(a))){a=a.substring(ee.raw.length),l.push(ee);continue}let xe=a;if(this.options.extensions?.startInline){let ne=1/0,te=a.slice(1),f;this.options.extensions.startInline.forEach(d=>{f=d.call({lexer:this},te),typeof f=="number"&&f>=0&&(ne=Math.min(ne,f))}),ne<1/0&&ne>=0&&(xe=a.substring(0,ne+1))}if(ee=this.tokenizer.inlineText(xe)){a=a.substring(ee.raw.length),ee.raw.slice(-1)!=="_"&&(R=ee.raw.slice(-1)),Y=!0;let ne=l.at(-1);ne?.type==="text"?(ne.raw+=ee.raw,ne.text+=ee.text):l.push(ee);continue}if(a){let ne="Infinite loop on byte: "+a.charCodeAt(0);if(this.options.silent){console.error(ne);break}else throw new Error(ne)}}return l}},P=class{options;parser;constructor(g){this.options=g||T}space(g){return""}code({text:g,lang:a,escaped:l}){let A=(a||"").match(m.notSpaceStart)?.[0],O=g.replace(m.endingNewline,"")+`
`;return A?'<pre><code class="language-'+w(A)+'">'+(l?O:w(O,!0))+`</code></pre>
`:"<pre><code>"+(l?O:w(O,!0))+`</code></pre>
`}blockquote({tokens:g}){return`<blockquote>
${this.parser.parse(g)}</blockquote>
`}html({text:g}){return g}def(g){return""}heading({tokens:g,depth:a}){return`<h${a}>${this.parser.parseInline(g)}</h${a}>
`}hr(g){return`<hr>
`}list(g){let a=g.ordered,l=g.start,A="";for(let R=0;R<g.items.length;R++){let ee=g.items[R];A+=this.listitem(ee)}let O=a?"ol":"ul",Y=a&&l!==1?' start="'+l+'"':"";return"<"+O+Y+`>
`+A+"</"+O+`>
`}listitem(g){let a="";if(g.task){let l=this.checkbox({checked:!!g.checked});g.loose?g.tokens[0]?.type==="paragraph"?(g.tokens[0].text=l+" "+g.tokens[0].text,g.tokens[0].tokens&&g.tokens[0].tokens.length>0&&g.tokens[0].tokens[0].type==="text"&&(g.tokens[0].tokens[0].text=l+" "+w(g.tokens[0].tokens[0].text),g.tokens[0].tokens[0].escaped=!0)):g.tokens.unshift({type:"text",raw:l+" ",text:l+" ",escaped:!0}):a+=l+" "}return a+=this.parser.parse(g.tokens,!!g.loose),`<li>${a}</li>
`}checkbox({checked:g}){return"<input "+(g?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:g}){return`<p>${this.parser.parseInline(g)}</p>
`}table(g){let a="",l="";for(let O=0;O<g.header.length;O++)l+=this.tablecell(g.header[O]);a+=this.tablerow({text:l});let A="";for(let O=0;O<g.rows.length;O++){let Y=g.rows[O];l="";for(let R=0;R<Y.length;R++)l+=this.tablecell(Y[R]);A+=this.tablerow({text:l})}return A&&(A=`<tbody>${A}</tbody>`),`<table>
<thead>
`+a+`</thead>
`+A+`</table>
`}tablerow({text:g}){return`<tr>
${g}</tr>
`}tablecell(g){let a=this.parser.parseInline(g.tokens),l=g.header?"th":"td";return(g.align?`<${l} align="${g.align}">`:`<${l}>`)+a+`</${l}>
`}strong({tokens:g}){return`<strong>${this.parser.parseInline(g)}</strong>`}em({tokens:g}){return`<em>${this.parser.parseInline(g)}</em>`}codespan({text:g}){return`<code>${w(g,!0)}</code>`}br(g){return"<br>"}del({tokens:g}){return`<del>${this.parser.parseInline(g)}</del>`}link({href:g,title:a,tokens:l}){let A=this.parser.parseInline(l),O=J(g);if(O===null)return A;g=O;let Y='<a href="'+g+'"';return a&&(Y+=' title="'+w(a)+'"'),Y+=">"+A+"</a>",Y}image({href:g,title:a,text:l,tokens:A}){A&&(l=this.parser.parseInline(A,this.parser.textRenderer));let O=J(g);if(O===null)return w(l);g=O;let Y=`<img src="${g}" alt="${l}"`;return a&&(Y+=` title="${w(a)}"`),Y+=">",Y}text(g){return"tokens"in g&&g.tokens?this.parser.parseInline(g.tokens):"escaped"in g&&g.escaped?g.text:w(g.text)}},$=class{strong({text:g}){return g}em({text:g}){return g}codespan({text:g}){return g}del({text:g}){return g}html({text:g}){return g}text({text:g}){return g}link({text:g}){return""+g}image({text:g}){return""+g}br(){return""}},b=class Jr{options;renderer;textRenderer;constructor(a){this.options=a||T,this.options.renderer=this.options.renderer||new P,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $}static parse(a,l){return new Jr(l).parse(a)}static parseInline(a,l){return new Jr(l).parseInline(a)}parse(a,l=!0){let A="";for(let O=0;O<a.length;O++){let Y=a[O];if(this.options.extensions?.renderers?.[Y.type]){let ee=Y,xe=this.options.extensions.renderers[ee.type].call({parser:this},ee);if(xe!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(ee.type)){A+=xe||"";continue}}let R=Y;switch(R.type){case"space":{A+=this.renderer.space(R);continue}case"hr":{A+=this.renderer.hr(R);continue}case"heading":{A+=this.renderer.heading(R);continue}case"code":{A+=this.renderer.code(R);continue}case"table":{A+=this.renderer.table(R);continue}case"blockquote":{A+=this.renderer.blockquote(R);continue}case"list":{A+=this.renderer.list(R);continue}case"html":{A+=this.renderer.html(R);continue}case"def":{A+=this.renderer.def(R);continue}case"paragraph":{A+=this.renderer.paragraph(R);continue}case"text":{let ee=R,xe=this.renderer.text(ee);for(;O+1<a.length&&a[O+1].type==="text";)ee=a[++O],xe+=`
`+this.renderer.text(ee);l?A+=this.renderer.paragraph({type:"paragraph",raw:xe,text:xe,tokens:[{type:"text",raw:xe,text:xe,escaped:!0}]}):A+=xe;continue}default:{let ee='Token with "'+R.type+'" type was not found.';if(this.options.silent)return console.error(ee),"";throw new Error(ee)}}}return A}parseInline(a,l=this.renderer){let A="";for(let O=0;O<a.length;O++){let Y=a[O];if(this.options.extensions?.renderers?.[Y.type]){let ee=this.options.extensions.renderers[Y.type].call({parser:this},Y);if(ee!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(Y.type)){A+=ee||"";continue}}let R=Y;switch(R.type){case"escape":{A+=l.text(R);break}case"html":{A+=l.html(R);break}case"link":{A+=l.link(R);break}case"image":{A+=l.image(R);break}case"strong":{A+=l.strong(R);break}case"em":{A+=l.em(R);break}case"codespan":{A+=l.codespan(R);break}case"br":{A+=l.br(R);break}case"del":{A+=l.del(R);break}case"text":{A+=l.text(R);break}default:{let ee='Token with "'+R.type+'" type was not found.';if(this.options.silent)return console.error(ee),"";throw new Error(ee)}}}return A}},S=class{options;block;constructor(g){this.options=g||T}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(g){return g}postprocess(g){return g}processAllTokens(g){return g}emStrongMask(g){return g}provideLexer(){return this.block?x.lex:x.lexInline}provideParser(){return this.block?b.parse:b.parseInline}},B=class{defaults=L();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=b;Renderer=P;TextRenderer=$;Lexer=x;Tokenizer=y;Hooks=S;constructor(...g){this.use(...g)}walkTokens(g,a){let l=[];for(let A of g)switch(l=l.concat(a.call(this,A)),A.type){case"table":{let O=A;for(let Y of O.header)l=l.concat(this.walkTokens(Y.tokens,a));for(let Y of O.rows)for(let R of Y)l=l.concat(this.walkTokens(R.tokens,a));break}case"list":{let O=A;l=l.concat(this.walkTokens(O.items,a));break}default:{let O=A;this.defaults.extensions?.childTokens?.[O.type]?this.defaults.extensions.childTokens[O.type].forEach(Y=>{let R=O[Y].flat(1/0);l=l.concat(this.walkTokens(R,a))}):O.tokens&&(l=l.concat(this.walkTokens(O.tokens,a)))}}return l}use(...g){let a=this.defaults.extensions||{renderers:{},childTokens:{}};return g.forEach(l=>{let A={...l};if(A.async=this.defaults.async||A.async||!1,l.extensions&&(l.extensions.forEach(O=>{if(!O.name)throw new Error("extension name required");if("renderer"in O){let Y=a.renderers[O.name];Y?a.renderers[O.name]=function(...R){let ee=O.renderer.apply(this,R);return ee===!1&&(ee=Y.apply(this,R)),ee}:a.renderers[O.name]=O.renderer}if("tokenizer"in O){if(!O.level||O.level!=="block"&&O.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let Y=a[O.level];Y?Y.unshift(O.tokenizer):a[O.level]=[O.tokenizer],O.start&&(O.level==="block"?a.startBlock?a.startBlock.push(O.start):a.startBlock=[O.start]:O.level==="inline"&&(a.startInline?a.startInline.push(O.start):a.startInline=[O.start]))}"childTokens"in O&&O.childTokens&&(a.childTokens[O.name]=O.childTokens)}),A.extensions=a),l.renderer){let O=this.defaults.renderer||new P(this.defaults);for(let Y in l.renderer){if(!(Y in O))throw new Error(`renderer '${Y}' does not exist`);if(["options","parser"].includes(Y))continue;let R=Y,ee=l.renderer[R],xe=O[R];O[R]=(...ne)=>{let te=ee.apply(O,ne);return te===!1&&(te=xe.apply(O,ne)),te||""}}A.renderer=O}if(l.tokenizer){let O=this.defaults.tokenizer||new y(this.defaults);for(let Y in l.tokenizer){if(!(Y in O))throw new Error(`tokenizer '${Y}' does not exist`);if(["options","rules","lexer"].includes(Y))continue;let R=Y,ee=l.tokenizer[R],xe=O[R];O[R]=(...ne)=>{let te=ee.apply(O,ne);return te===!1&&(te=xe.apply(O,ne)),te}}A.tokenizer=O}if(l.hooks){let O=this.defaults.hooks||new S;for(let Y in l.hooks){if(!(Y in O))throw new Error(`hook '${Y}' does not exist`);if(["options","block"].includes(Y))continue;let R=Y,ee=l.hooks[R],xe=O[R];S.passThroughHooks.has(Y)?O[R]=ne=>{if(this.defaults.async&&S.passThroughHooksRespectAsync.has(Y))return(async()=>{let f=await ee.call(O,ne);return xe.call(O,f)})();let te=ee.call(O,ne);return xe.call(O,te)}:O[R]=(...ne)=>{if(this.defaults.async)return(async()=>{let f=await ee.apply(O,ne);return f===!1&&(f=await xe.apply(O,ne)),f})();let te=ee.apply(O,ne);return te===!1&&(te=xe.apply(O,ne)),te}}A.hooks=O}if(l.walkTokens){let O=this.defaults.walkTokens,Y=l.walkTokens;A.walkTokens=function(R){let ee=[];return ee.push(Y.call(this,R)),O&&(ee=ee.concat(O.call(this,R))),ee}}this.defaults={...this.defaults,...A}}),this}setOptions(g){return this.defaults={...this.defaults,...g},this}lexer(g,a){return x.lex(g,a??this.defaults)}parser(g,a){return b.parse(g,a??this.defaults)}parseMarkdown(g){return(a,l)=>{let A={...l},O={...this.defaults,...A},Y=this.onError(!!O.silent,!!O.async);if(this.defaults.async===!0&&A.async===!1)return Y(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof a>"u"||a===null)return Y(new Error("marked(): input parameter is undefined or null"));if(typeof a!="string")return Y(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(a)+", string expected"));if(O.hooks&&(O.hooks.options=O,O.hooks.block=g),O.async)return(async()=>{let R=O.hooks?await O.hooks.preprocess(a):a,ee=await(O.hooks?await O.hooks.provideLexer():g?x.lex:x.lexInline)(R,O),xe=O.hooks?await O.hooks.processAllTokens(ee):ee;O.walkTokens&&await Promise.all(this.walkTokens(xe,O.walkTokens));let ne=await(O.hooks?await O.hooks.provideParser():g?b.parse:b.parseInline)(xe,O);return O.hooks?await O.hooks.postprocess(ne):ne})().catch(Y);try{O.hooks&&(a=O.hooks.preprocess(a));let R=(O.hooks?O.hooks.provideLexer():g?x.lex:x.lexInline)(a,O);O.hooks&&(R=O.hooks.processAllTokens(R)),O.walkTokens&&this.walkTokens(R,O.walkTokens);let ee=(O.hooks?O.hooks.provideParser():g?b.parse:b.parseInline)(R,O);return O.hooks&&(ee=O.hooks.postprocess(ee)),ee}catch(R){return Y(R)}}}onError(g,a){return l=>{if(l.message+=`
Please report this to https://github.com/markedjs/marked.`,g){let A="<p>An error occurred:</p><pre>"+w(l.message+"",!0)+"</pre>";return a?Promise.resolve(A):A}if(a)return Promise.reject(l);throw l}}},_=new B;function k(g,a){return _.parse(g,a)}k.options=k.setOptions=function(g){return _.setOptions(g),k.defaults=_.defaults,G(k.defaults),k};k.getDefaults=L;k.defaults=T;k.use=function(...g){return _.use(...g),k.defaults=_.defaults,G(k.defaults),k};k.walkTokens=function(g,a){return _.walkTokens(g,a)};k.parseInline=_.parseInline;k.Parser=b;k.parser=b.parse;k.Renderer=P;k.TextRenderer=$;k.Lexer=x;k.lexer=x.lex;k.Tokenizer=y;k.Hooks=S;k.parse=k;k.options;k.setOptions;k.use;k.walkTokens;k.parseInline;b.parse;x.lex;let dialogContainer=null;function getDialogContainer(){return dialogContainer||(dialogContainer=document.createElement("div"),dialogContainer.id="global-dialog-container",document.body.appendChild(dialogContainer)),dialogContainer}function showDialog(g){return new Promise(a=>{const l=getDialogContainer(),A=()=>{B$1(x$1``,l)},O=()=>{A(),a(g.confirmValue)},Y=()=>{A(),a(g.cancelValue)},R=x$1`
            <wa-dialog label="${g.title}" open @wa-request-close=${Y}>
                <style>
                    .dialog-content {
                        display: flex;
                        flex-direction: column;
                        gap: 1rem;
                        padding: 1rem;
                        min-width: 400px;
                    }
                    
                    .dialog-message {
                        margin-bottom: 0.5rem;
                        color: var(--wa-color-neutral-700);
                    }
                    
                    .markdown-content {
                        line-height: 1.6;
                    }
                    
                    .markdown-content h1,
                    .markdown-content h2,
                    .markdown-content h3 {
                        margin-top: 1rem;
                        margin-bottom: 0.5rem;
                        font-weight: 600;
                    }
                    
                    .markdown-content h1 { font-size: 1.5rem; }
                    .markdown-content h2 { font-size: 1.3rem; }
                    .markdown-content h3 { font-size: 1.1rem; }
                    
                    .markdown-content p {
                        margin: 0.5rem 0;
                    }
                    
                    .markdown-content ul,
                    .markdown-content ol {
                        margin: 0.5rem 0;
                        padding-left: 1.5rem;
                    }
                    
                    .markdown-content code {
                        background: var(--wa-color-neutral-100);
                        padding: 0.125rem 0.25rem;
                        border-radius: 3px;
                        font-family: monospace;
                        font-size: 0.9em;
                    }
                    
                    .markdown-content pre {
                        background: var(--wa-color-neutral-100);
                        padding: 0.75rem;
                        border-radius: 4px;
                        overflow-x: auto;
                    }
                    
                    .markdown-content pre code {
                        background: none;
                        padding: 0;
                    }
                    
                    .markdown-content hr {
                        border: none;
                        border-top: 1px solid var(--wa-color-neutral-300);
                        margin: 1rem 0;
                    }
                    
                    .markdown-content blockquote {
                        border-left: 3px solid var(--wa-color-neutral-300);
                        padding-left: 1rem;
                        margin: 0.5rem 0;
                        color: var(--wa-color-neutral-600);
                    }
                    
                    .dialog-actions {
                        display: flex;
                        gap: 0.5rem;
                        justify-content: flex-end;
                        margin-top: 0.5rem;
                    }
                </style>
                
                <div class="dialog-content">
                    ${g.renderContent({onConfirm:O,onCancel:Y})}
                </div>
            </wa-dialog>
        `;B$1(R,l),g.onAfterRender&&requestAnimationFrame(g.onAfterRender)})}function renderMessage(g,a=!1){if(a){const l=k.parse(g,{async:!1});return x$1`<div class="dialog-message markdown-content" style="white-space: normal;">${o(l)}</div>`}return x$1`<div class="dialog-message" style="white-space: pre-line;">${g}</div>`}const promptDialog=async(g,a="",l=!1)=>{let A=a;return showDialog({title:"Input",message:g,markdown:l,confirmValue:A,cancelValue:null,renderContent:({onConfirm:O,onCancel:Y})=>{const R=xe=>{A=xe.target.value},ee=xe=>{xe.key==="Enter"?(xe.preventDefault(),O()):xe.key==="Escape"&&(xe.preventDefault(),Y())};return x$1`
                ${renderMessage(g,l)}
                <wa-input
                    value="${a}"
                    @input=${R}
                    @keydown=${ee}
                    autofocus
                ></wa-input>
                
                <div class="dialog-actions">
                    <wa-button variant="default" @click=${Y}>
                        Cancel
                    </wa-button>
                    <wa-button variant="primary" @click=${()=>{O()}}>
                        OK
                    </wa-button>
                </div>
            `},onAfterRender:()=>{const Y=getDialogContainer().querySelector("wa-input");if(Y){const R=Y.shadowRoot?.querySelector("input");R&&(R.focus(),R.select())}}}).then(()=>A)},confirmDialog=async(g,a=!1)=>showDialog({title:"Confirm",message:g,markdown:a,confirmValue:!0,cancelValue:!1,renderContent:({onConfirm:l,onCancel:A})=>x$1`
            ${renderMessage(g,a)}
            
            <div class="dialog-actions">
                <wa-button variant="default" @click=${A}>
                    Cancel
                </wa-button>
                <wa-button variant="primary" @click=${l}>
                    OK
                </wa-button>
            </div>
        `}),infoDialog=async(g,a,l=!1)=>{await showDialog({title:g,message:a,markdown:l,confirmValue:void 0,cancelValue:void 0,renderContent:({onConfirm:A})=>x$1`
            ${renderMessage(a,l)}
            
            <div class="dialog-actions">
                <wa-button variant="primary" @click=${A}>
                    OK
                </wa-button>
            </div>
        `})},navigableInfoDialog=async(g,a,l,A=!1)=>new Promise(O=>{const Y=getDialogContainer();let R=!0;const ee=()=>{R&&(R=!1,B$1(x$1``,Y),O())},xe=(ne,te,f)=>{if(!R)return;const d=x$1`
                <wa-dialog label="${ne}" open @wa-request-close=${ee}>
                    <style>
                        .dialog-content {
                            display: flex;
                            flex-direction: column;
                            gap: 1rem;
                            padding: 1rem;
                            min-width: 400px;
                            max-width: 600px;
                            height: 500px;
                        }
                        
                        .dialog-scroller {
                            flex: 1;
                            overflow-y: auto;
                        }
                        
                        .dialog-message {
                            margin-bottom: 0.5rem;
                            color: var(--wa-color-neutral-700);
                        }
                        
                        .dialog-actions {
                            display: flex;
                            gap: 0.5rem;
                            justify-content: space-between;
                            margin-top: 0.5rem;
                        }
                        
                        .dialog-actions-left,
                        .dialog-actions-right {
                            display: flex;
                            gap: 0.5rem;
                        }
                    </style>
                    
                    <div class="dialog-content">
                        <wa-scroller class="dialog-scroller">
                            ${renderMessage(te,A)}
                        </wa-scroller>
                        
                        <div class="dialog-actions">
                            <div class="dialog-actions-left">
                                ${f.filter(H=>H.label!=="Close").map(H=>x$1`
                                    <wa-button 
                                        variant="${H.variant||"default"}"
                                        ?disabled=${H.disabled}
                                        @click=${()=>{H.callback()}}
                                    >
                                        ${H.label}
                                    </wa-button>
                                `)}
                            </div>
                            <div class="dialog-actions-right">
                                ${f.filter(H=>H.label==="Close").map(H=>x$1`
                                    <wa-button 
                                        variant="${H.variant||"primary"}"
                                        @click=${()=>{H.callback(),ee()}}
                                    >
                                        ${H.label}
                                    </wa-button>
                                `)}
                            </div>
                        </div>
                    </div>
                </wa-dialog>
            `;B$1(d,Y)};l.updateDialog=xe,xe(g,a,l)});uiContext.put("promptDialog",promptDialog);uiContext.put("confirmDialog",confirmDialog);uiContext.put("infoDialog",infoDialog);uiContext.put("navigableInfoDialog",navigableInfoDialog);var toastify$2={exports:{}};var toastify$1=toastify$2.exports,hasRequiredToastify;function requireToastify(){return hasRequiredToastify||(hasRequiredToastify=1,(function(g){(function(a,l){g.exports?g.exports=l():a.Toastify=l()})(toastify$1,function(a){var l=function(R){return new l.lib.init(R)},A="1.12.0";l.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},l.lib=l.prototype={toastify:A,constructor:l,init:function(R){return R||(R={}),this.options={},this.toastElement=null,this.options.text=R.text||l.defaults.text,this.options.node=R.node||l.defaults.node,this.options.duration=R.duration===0?0:R.duration||l.defaults.duration,this.options.selector=R.selector||l.defaults.selector,this.options.callback=R.callback||l.defaults.callback,this.options.destination=R.destination||l.defaults.destination,this.options.newWindow=R.newWindow||l.defaults.newWindow,this.options.close=R.close||l.defaults.close,this.options.gravity=R.gravity==="bottom"?"toastify-bottom":l.defaults.gravity,this.options.positionLeft=R.positionLeft||l.defaults.positionLeft,this.options.position=R.position||l.defaults.position,this.options.backgroundColor=R.backgroundColor||l.defaults.backgroundColor,this.options.avatar=R.avatar||l.defaults.avatar,this.options.className=R.className||l.defaults.className,this.options.stopOnFocus=R.stopOnFocus===void 0?l.defaults.stopOnFocus:R.stopOnFocus,this.options.onClick=R.onClick||l.defaults.onClick,this.options.offset=R.offset||l.defaults.offset,this.options.escapeMarkup=R.escapeMarkup!==void 0?R.escapeMarkup:l.defaults.escapeMarkup,this.options.ariaLive=R.ariaLive||l.defaults.ariaLive,this.options.style=R.style||l.defaults.style,R.backgroundColor&&(this.options.style.background=R.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var R=document.createElement("div");R.className="toastify on "+this.options.className,this.options.position?R.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(R.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):R.className+=" toastify-right",R.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var ee in this.options.style)R.style[ee]=this.options.style[ee];if(this.options.ariaLive&&R.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)R.appendChild(this.options.node);else if(this.options.escapeMarkup?R.innerText=this.options.text:R.innerHTML=this.options.text,this.options.avatar!==""){var xe=document.createElement("img");xe.src=this.options.avatar,xe.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?R.appendChild(xe):R.insertAdjacentElement("afterbegin",xe)}if(this.options.close===!0){var ne=document.createElement("button");ne.type="button",ne.setAttribute("aria-label","Close"),ne.className="toast-close",ne.innerHTML="&#10006;",ne.addEventListener("click",(function(et){et.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}).bind(this));var te=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&te>360?R.insertAdjacentElement("afterbegin",ne):R.appendChild(ne)}if(this.options.stopOnFocus&&this.options.duration>0){var f=this;R.addEventListener("mouseover",function(et){window.clearTimeout(R.timeOutValue)}),R.addEventListener("mouseleave",function(){R.timeOutValue=window.setTimeout(function(){f.removeElement(R)},f.options.duration)})}if(typeof this.options.destination<"u"&&R.addEventListener("click",(function(et){et.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}).bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&R.addEventListener("click",(function(et){et.stopPropagation(),this.options.onClick()}).bind(this)),typeof this.options.offset=="object"){var d=O("x",this.options),H=O("y",this.options),Z=this.options.position=="left"?d:"-"+d,Ye=this.options.gravity=="toastify-top"?H:"-"+H;R.style.transform="translate("+Z+","+Ye+")"}return R},showToast:function(){this.toastElement=this.buildToast();var R;if(typeof this.options.selector=="string"?R=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?R=this.options.selector:R=document.body,!R)throw"Root element is not defined";var ee=l.defaults.oldestFirst?R.firstChild:R.lastChild;return R.insertBefore(this.toastElement,ee),l.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((function(){this.removeElement(this.toastElement)}).bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(R){R.className=R.className.replace(" on",""),window.setTimeout((function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),R.parentNode&&R.parentNode.removeChild(R),this.options.callback.call(R),l.reposition()}).bind(this),400)}},l.reposition=function(){for(var R={top:15,bottom:15},ee={top:15,bottom:15},xe={top:15,bottom:15},ne=document.getElementsByClassName("toastify"),te,f=0;f<ne.length;f++){Y(ne[f],"toastify-top")===!0?te="toastify-top":te="toastify-bottom";var d=ne[f].offsetHeight;te=te.substr(9,te.length-1);var H=15,Z=window.innerWidth>0?window.innerWidth:screen.width;Z<=360?(ne[f].style[te]=xe[te]+"px",xe[te]+=d+H):Y(ne[f],"toastify-left")===!0?(ne[f].style[te]=R[te]+"px",R[te]+=d+H):(ne[f].style[te]=ee[te]+"px",ee[te]+=d+H)}return this};function O(R,ee){return ee.offset[R]?isNaN(ee.offset[R])?ee.offset[R]:ee.offset[R]+"px":"0px"}function Y(R,ee){return!R||typeof ee!="string"?!1:!!(R.className&&R.className.trim().split(/\s+/gi).indexOf(ee)>-1)}return l.lib.init.prototype=l.lib,l})})(toastify$2)),toastify$2.exports}var toastifyExports=requireToastify();const toastify=getDefaultExportFromCjs(toastifyExports),ToastifyModule=_mergeNamespaces({__proto__:null,default:toastify},[toastifyExports]),Toastify=toastify||ToastifyModule,toastInfo=g=>{console.info("[TOAST] INFO: ",g),Toastify({text:g,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0}).showToast()},toastError=g=>{console.error("[TOAST] ERROR: ",g),Toastify({text:g,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0,style:{background:"coral"}}).showToast()},toastWarning=g=>{console.warn("[TOAST] WARNING: ",g),Toastify({text:g,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0,style:{background:"orange"}}).showToast()};uiContext.put("toastInfo",toastInfo);uiContext.put("toastError",toastError);uiContext.put("toastWarning",toastWarning);const watchSignal=(g,a)=>{const l=new Signal.subtle.Watcher(async()=>{try{await 0,a(g.get())}finally{l.watch(g)}});return l.watch(g),g.get(),()=>{l.unwatch(g)}};Object.defineProperty(i$2.prototype,"model",{enumerable:!0,configurable:!0,writable:!0});class KWidget extends e(i$2){constructor(){super(...arguments),this.signalCleanups=new Set}connectedCallback(){const a=Object.getPrototypeOf(this);Object.getOwnPropertyNames(a).forEach(l=>{const A=a[l];if(A instanceof Function){const O=A;O.name.startsWith("on")&&"topic"in O&&this.subscribe(O.topic,O)}}),super.connectedCallback(),this.doBeforeUI()}disconnectedCallback(){super.disconnectedCallback(),this.signalCleanups.forEach(a=>a()),this.signalCleanups.clear()}subscribe(a,l){subscribe(a,l.bind(this))}showInfo(a){toastInfo(a)}showError(a){toastError(a)}nobubble(a){return l=>{l.stopPropagation(),a.bind(this)(l)}}command(a,l={}){return()=>{this.executeCommand(a,l)}}executeCommand(a,l){const A=commandRegistry.createExecutionContext(l);commandRegistry.execute(a,A)}watch(a,l){const A=watchSignal(a,l.bind(this));this.signalCleanups.add(A)}firstUpdated(a){super.firstUpdated(a),this.doInitUI()}updateIdle(){requestIdleCallback(()=>this.requestUpdate())}updateLater(){requestAnimationFrame(()=>this.requestUpdate())}doBeforeUI(){}doInitUI(){}withRefresh(a){a(),this.updateLater()}}function promisifyRequest(g){return new Promise((a,l)=>{g.oncomplete=g.onsuccess=()=>a(g.result),g.onabort=g.onerror=()=>l(g.error)})}function createStore(g,a){let l;const A=()=>{if(l)return l;const O=indexedDB.open(g);return O.onupgradeneeded=()=>O.result.createObjectStore(a),l=promisifyRequest(O),l.then(Y=>{Y.onclose=()=>l=void 0},()=>{}),l};return(O,Y)=>A().then(R=>Y(R.transaction(a,O).objectStore(a)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(g,a=defaultGetStore()){return a("readonly",l=>promisifyRequest(l.get(g)))}function set(g,a,l=defaultGetStore()){return l("readwrite",A=>(A.put(a,g),promisifyRequest(A.transaction)))}class PersistenceService{async persistObject(a,l){return set(a,l)}async getObject(a){return get(a)}}const persistenceService=new PersistenceService;rootContext.put("persistenceService",persistenceService);const SETTINGS_FILE_PATH=".geospace/settings.json",DIALOG_SETTINGS_KEY="dialogSettings",TOPIC_SETTINGS_CHANGED="events/settings/changed";class SettingsService{async checkSettings(){this.appSettings||(this.appSettings=await persistenceService.getObject(SETTINGS_FILE_PATH),this.appSettings||(this.appSettings={},await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings)),publish(TOPIC_SETTINGS_CHANGED,this.appSettings))}async get(a){return await this.checkSettings(),this.appSettings[a]}async set(a,l){await this.checkSettings(),this.appSettings[a]=l,await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings),publish(TOPIC_SETTINGS_CHANGED,this.appSettings)}async getAll(){return await this.checkSettings(),this.appSettings}async setAll(a){this.appSettings=a,await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings),publish(TOPIC_SETTINGS_CHANGED,this.appSettings)}async getDialogSetting(a){return await this.checkSettings(),(this.appSettings[DIALOG_SETTINGS_KEY]||{})[a]}async setDialogSetting(a,l){await this.checkSettings();const A=this.appSettings[DIALOG_SETTINGS_KEY]||{};A[a]=l,this.appSettings[DIALOG_SETTINGS_KEY]=A,await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings),publish(TOPIC_SETTINGS_CHANGED,this.appSettings)}}const appSettings=new SettingsService;rootContext.put("appSettings",appSettings);const settingsservice=Object.freeze(Object.defineProperty({__proto__:null,DIALOG_SETTINGS_KEY,SETTINGS_FILE_PATH,TOPIC_SETTINGS_CHANGED,appSettings},Symbol.toStringTag,{value:"Module"}));class KElement extends KWidget{constructor(){super(...arguments),this.settingsKey=null}buildDOMTreePath(){const a=[];let l=this;for(;l&&l!==document.body&&l!==document.documentElement;){const A=l.getAttribute("id");if(A){a.unshift(`#${A}`);break}const O=l.tagName.toLowerCase(),Y=l.parentElement;if(!Y)break;const ee=Array.from(Y.children).filter(xe=>xe.tagName.toLowerCase()===O).indexOf(l);ee>=0?a.unshift(`${O}:${ee}`):a.unshift(O),l=Y}return a.length>0?a.join(" > "):null}initializeSettingsKey(){if(!this.settingsKey){const a=this.tagName.toLowerCase(),l=this.getAttribute("id");if(l){this.settingsKey=`${a}:${l}`;return}const A=this.buildDOMTreePath();A&&(this.settingsKey=`${a}:${A}`)}}async getDialogSetting(){if(this.initializeSettingsKey(),!!this.settingsKey)return await appSettings.getDialogSetting(this.settingsKey)}async setDialogSetting(a){this.initializeSettingsKey(),this.settingsKey&&await appSettings.setDialogSetting(this.settingsKey,a)}}var __getOwnPropDesc$i=Object.getOwnPropertyDescriptor,__decorateClass$j=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$i(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=R(O)||O);return O};let KApp=class extends KElement{render(){return x$1`
            <slot></slot>
        `}};KApp.styles=i$3`
        :host {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            width: 100%;
            box-sizing: border-box;
        }
    `;KApp=__decorateClass$j([t("k-app")],KApp);var __defProp$f=Object.defineProperty,__getOwnPropDesc$h=Object.getOwnPropertyDescriptor,__decorateClass$i=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$h(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$f(a,l,O),O};let KToolbar=class extends KElement{constructor(){super(...arguments),this.position="start",this.isEditor=!1,this.partToolbarContent=void 0,this.partToolbarRenderer=void 0,this.contributions=[]}doBeforeUI(){const g=this.getAttribute("id");g&&this.loadContributions(g),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,a=>{if(!g)return;this.matchesTarget(g,a.target)&&(this.loadContributions(g),this.requestUpdate())})}matchesTarget(g,a){if(a===g)return!0;if(!g.includes(":"))return!1;const[l]=g.split(":");if(a===`${l}:*`)return!0;const A=a.split(":");if(A.length===2){const O=A[1];if(O==="system.editors"||O===".system.editors")return this.isEditor&&g.startsWith(`${l}:`)}return!1}loadContributions(g){const a=contributionRegistry.getContributions(g);if(!g.includes(":")){this.contributions=a;return}const[l]=g.split(":"),A=`${l}:*`,O=contributionRegistry.getContributions(A),Y=[];if(this.isEditor){const R=["system.editors",".system.editors"];for(const ee of R){const xe=`${l}:${ee}`,ne=contributionRegistry.getContributions(xe);Y.push(...ne)}}this.contributions=[...O,...Y,...a]}contributionCreator(g){if("command"in g){const a=g,l=!!a.showLabel;return x$1`
                <wa-button @click=${()=>this.executeCommand(a.command,a.params||{})}
                           title=${a.label}
                           ?disabled="${a.disabled?.get()}"
                           appearance="plain" size="small">
                    <wa-icon name=${a.icon} label="${a.label}"></wa-icon>
                    ${l?a.label:""}
                </wa-button>
            `}else if("html"in g){const a=g.html;return a instanceof Function?a():o(a)}else return x$1`<span>unknown contribution type: ${typeof g}</span>`}render(){const g=this.partToolbarRenderer?this.partToolbarRenderer():this.partToolbarContent?this.partToolbarContent:"";return x$1`
            <div class="toolbar-items" style=${o$1({"justify-content":this.position})}>
                <slot name="start">
                    ${this.contributions.filter(a=>a.slot==="start").map(this.contributionCreator.bind(this))}
                </slot>
                ${g}
                ${this.contributions.filter(a=>a.slot===void 0).map(this.contributionCreator.bind(this))}
                <slot>
                </slot>
                <slot name="end">
                    ${this.contributions.filter(a=>a.slot==="end").map(this.contributionCreator.bind(this))}
                </slot>
            </div>
        `}};KToolbar.styles=i$3`
        :host {
            display: flex;
            flex-direction: row;
        }

        .toolbar-items {
            display: flex;
            flex: 1;
        }
    `;__decorateClass$i([n()],KToolbar.prototype,"position",2);__decorateClass$i([n({type:Boolean,attribute:"is-editor"})],KToolbar.prototype,"isEditor",2);__decorateClass$i([n({attribute:!1})],KToolbar.prototype,"partToolbarContent",2);__decorateClass$i([n({attribute:!1})],KToolbar.prototype,"partToolbarRenderer",2);__decorateClass$i([r$1()],KToolbar.prototype,"contributions",2);KToolbar=__decorateClass$i([t("k-toolbar")],KToolbar);var __defProp$e=Object.defineProperty,__getOwnPropDesc$g=Object.getOwnPropertyDescriptor,__decorateClass$h=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$g(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$e(a,l,O),O};let KContextMenu=class extends KElement{constructor(){super(...arguments),this.isEditor=!1,this.partContextMenuRenderer=void 0,this.contributions=[],this.isOpen=!1,this.position={x:0,y:0},this.anchorRef=e$1(),this.dropdownRef=e$1()}doBeforeUI(){const g=this.getAttribute("id");g&&this.loadContributions(g),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,a=>{if(!g)return;this.matchesTarget(g,a.target)&&(this.loadContributions(g),this.requestUpdate())})}matchesTarget(g,a){if(a===g)return!0;if(!g.includes(":"))return!1;const[l]=g.split(":");if(a===`${l}:*`)return!0;const A=a.split(":");if(A.length===2){const O=A[1];if(O==="system.editors"||O===".system.editors")return this.isEditor&&g.startsWith(`${l}:`)}return!1}loadContributions(g){const a=contributionRegistry.getContributions(g);if(!g.includes(":")){this.contributions=a;return}const[l]=g.split(":"),A=`${l}:*`,O=contributionRegistry.getContributions(A),Y=[];if(this.isEditor){const R=["system.editors",".system.editors"];for(const ee of R){const xe=`${l}:${ee}`,ne=contributionRegistry.getContributions(xe);Y.push(...ne)}}this.contributions=[...O,...Y,...a]}getElementFromPoint(g,a){let l=document.elementFromPoint(g,a);if(!l)return null;for(;l;){const A=l.shadowRoot;if(A){const O=A.elementFromPoint(g,a);if(O&&O!==l){l=O;continue}}break}return l}triggerClickUnderCursor(g){const a=this.getElementFromPoint(g.clientX,g.clientY);if(a){const l=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,clientX:g.clientX,clientY:g.clientY,screenX:g.screenX,screenY:g.screenY,button:0,buttons:0,detail:1,which:1});a.dispatchEvent(l)}}show(g,a){a&&this.triggerClickUnderCursor(a),this.position=g,this.isOpen=!0}onClose(){this.isOpen=!1}handleCommandClick(g,a){return async()=>{this.executeCommand(g,a||{})}}renderContribution(g){if("command"in g){const a=g;return x$1`
                <wa-dropdown-item 
                    @click=${this.handleCommandClick(a.command,a.params)}
                    ?disabled="${a.disabled?.get()}">
                    ${a.icon?x$1`<wa-icon slot="icon" name=${a.icon}></wa-icon>`:""}
                    ${a.label}
                </wa-dropdown-item>
            `}else if("html"in g){const a=g.html;return a instanceof Function?a():o(a)}return E$1}render(){if(!this.isOpen)return E$1;const g=this.partContextMenuRenderer?this.partContextMenuRenderer():E$1;return x$1`
            <wa-dropdown 
                ${n$1(this.dropdownRef)}
                ?open=${this.isOpen}
                @wa-after-hide=${this.onClose}
                placement="bottom-start"
                distance="0">
                
                <div 
                    slot="trigger"
                    ${n$1(this.anchorRef)}
                    style="position: fixed; 
                           left: ${this.position.x}px; 
                           top: ${this.position.y}px; 
                           width: 1px; 
                           height: 1px; 
                           pointer-events: none;">
                </div>
                
                ${g}
                ${this.contributions.map(a=>this.renderContribution(a))}
            </wa-dropdown>
        `}};KContextMenu.styles=i$3`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 10000;
        }

        wa-dropdown {
            pointer-events: auto;
            min-width: 200px;
        }
        
        wa-dropdown::part(panel) {
            min-width: 200px;
        }
    `;__decorateClass$h([n({type:Boolean,attribute:"is-editor"})],KContextMenu.prototype,"isEditor",2);__decorateClass$h([n({attribute:!1})],KContextMenu.prototype,"partContextMenuRenderer",2);__decorateClass$h([r$1()],KContextMenu.prototype,"contributions",2);__decorateClass$h([r$1()],KContextMenu.prototype,"isOpen",2);__decorateClass$h([r$1()],KContextMenu.prototype,"position",2);KContextMenu=__decorateClass$h([t("k-contextmenu")],KContextMenu);class KContainer extends KElement{}const u=(g,a,l)=>{const A=new Map;for(let O=a;O<=l;O++)A.set(g[O],O);return A},c=e$2(class extends i$4{constructor(g){if(super(g),g.type!==t$1.CHILD)throw Error("repeat() can only be used in text expressions")}dt(g,a,l){let A;l===void 0?l=a:a!==void 0&&(A=a);const O=[],Y=[];let R=0;for(const ee of g)O[R]=A?A(ee,R):R,Y[R]=l(ee,R),R++;return{values:Y,keys:O}}render(g,a,l){return this.dt(g,a,l).values}update(g,[a,l,A]){const O=p(g),{values:Y,keys:R}=this.dt(a,l,A);if(!Array.isArray(O))return this.ut=R,Y;const ee=this.ut??=[],xe=[];let ne,te,f=0,d=O.length-1,H=0,Z=Y.length-1;for(;f<=d&&H<=Z;)if(O[f]===null)f++;else if(O[d]===null)d--;else if(ee[f]===R[H])xe[H]=v$1(O[f],Y[H]),f++,H++;else if(ee[d]===R[Z])xe[Z]=v$1(O[d],Y[Z]),d--,Z--;else if(ee[f]===R[Z])xe[Z]=v$1(O[f],Y[Z]),r$2(g,xe[Z+1],O[f]),f++,Z--;else if(ee[d]===R[H])xe[H]=v$1(O[d],Y[H]),r$2(g,O[f],O[d]),d--,H++;else if(ne===void 0&&(ne=u(R,H,Z),te=u(ee,f,d)),ne.has(ee[f]))if(ne.has(ee[d])){const Ye=te.get(R[H]),et=Ye!==void 0?O[Ye]:null;if(et===null){const tt=r$2(g,O[f]);v$1(tt,Y[H]),xe[H]=tt}else xe[H]=v$1(et,Y[H]),r$2(g,O[f],et),O[Ye]=null;H++}else M$1(O[d]),d--;else M$1(O[f]),f++;for(;H<=Z;){const Ye=r$2(g,xe[Z+1]);v$1(Ye,Y[H]),xe[H++]=Ye}for(;f<=d;){const Ye=O[f++];Ye!==null&&M$1(Ye)}return this.ut=R,m$1(g,xe),T$1}}),__vite_glob_0_0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='2'%20y='2'%20width='28'%20height='28'%20fill='%23FFCA28'/%3e%3cpath%20d='M19%2025.2879L21.0615%2023.9237C21.2231%2024.4313%2022.2462%2025.6368%2023.5385%2025.6368C24.8308%2025.6368%2025.4308%2024.931%2025.4308%2024.463C25.4308%2023.1878%2024.1112%2022.7382%2023.4774%2022.5223C23.374%2022.4871%2023.289%2022.4581%2023.2308%2022.4328C23.2009%2022.4198%2023.1558%2022.4025%2023.0979%2022.3804C22.393%2022.1111%2019.7923%2021.1175%2019.7923%2018.2373C19.7923%2015.065%2022.8538%2014.7002%2023.5462%2014.7002C23.9991%2014.7002%2026.1769%2014.7557%2027.2615%2016.7939L25.2615%2018.1898C24.8231%2017.3015%2024.0946%2017.0081%2023.6462%2017.0081C22.5385%2017.0081%2022.3077%2017.8201%2022.3077%2018.1898C22.3077%2019.227%2023.5112%2019.6919%2024.5273%2020.0844C24.7932%2020.1871%2025.0462%2020.2848%2025.2615%2020.3866C26.3692%2020.91%2028%2021.7666%2028%2024.463C28%2025.8136%2026.8672%2028.0002%2024.0154%2028.0002C20.1846%2028.0002%2019.1692%2025.7003%2019%2025.2879Z'%20fill='%233E3E3E'/%3e%3cpath%20d='M9%2025.5587L11.1487%2024.1953C11.317%2024.7026%2011.9713%2025.638%2012.9205%2025.638C13.8698%2025.638%2014.3557%2024.663%2014.3557%2024.1953V15.0002H16.9982V24.1953C17.041%2025.4636%2016.3376%2028.0002%2013.2332%2028.0002C10.379%2028.0002%209.19242%2026.3039%209%2025.5587Z'%20fill='%233E3E3E'/%3e%3c/svg%3e",__vite_glob_0_1="/assets/jupyter-C78Cpfql.svg",__vite_glob_0_2="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.0164%202C10.8193%202%209.03825%203.72453%209.03825%205.85185V8.51852H15.9235V9.25926H5.97814C3.78107%209.25926%202%2010.9838%202%2013.1111L2%2018.8889C2%2021.0162%203.78107%2022.7407%205.97814%2022.7407H8.27322V19.4815C8.27322%2017.3542%2010.0543%2015.6296%2012.2514%2015.6296H19.5956C21.4547%2015.6296%2022.9617%2014.1704%2022.9617%2012.3704V5.85185C22.9617%203.72453%2021.1807%202%2018.9836%202H13.0164ZM12.0984%206.74074C12.8589%206.74074%2013.4754%206.14378%2013.4754%205.40741C13.4754%204.67103%2012.8589%204.07407%2012.0984%204.07407C11.3378%204.07407%2010.7213%204.67103%2010.7213%205.40741C10.7213%206.14378%2011.3378%206.74074%2012.0984%206.74074Z'%20fill='url(%23paint0_linear_87_8204)'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M18.9834%2030C21.1805%2030%2022.9616%2028.2755%2022.9616%2026.1482V23.4815L16.0763%2023.4815L16.0763%2022.7408L26.0217%2022.7408C28.2188%2022.7408%2029.9998%2021.0162%2029.9998%2018.8889V13.1111C29.9998%2010.9838%2028.2188%209.25928%2026.0217%209.25928L23.7266%209.25928V12.5185C23.7266%2014.6459%2021.9455%2016.3704%2019.7485%2016.3704L12.4042%2016.3704C10.5451%2016.3704%209.03809%2017.8296%209.03809%2019.6296L9.03809%2026.1482C9.03809%2028.2755%2010.8192%2030%2013.0162%2030H18.9834ZM19.9015%2025.2593C19.1409%2025.2593%2018.5244%2025.8562%2018.5244%2026.5926C18.5244%2027.329%2019.1409%2027.9259%2019.9015%2027.9259C20.662%2027.9259%2021.2785%2027.329%2021.2785%2026.5926C21.2785%2025.8562%2020.662%2025.2593%2019.9015%2025.2593Z'%20fill='url(%23paint1_linear_87_8204)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_87_8204'%20x1='12.4809'%20y1='2'%20x2='12.4809'%20y2='22.7407'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23327EBD'/%3e%3cstop%20offset='1'%20stop-color='%231565A7'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_87_8204'%20x1='19.519'%20y1='9.25928'%20x2='19.519'%20y2='30'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFDA4B'/%3e%3cstop%20offset='1'%20stop-color='%23F9C600'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e";registerIconLibrary("k",{resolver:g=>new URL(Object.assign({"../icons/js.svg":__vite_glob_0_0,"../icons/jupyter.svg":__vite_glob_0_1,"../icons/python.svg":__vite_glob_0_2})[`../icons/${g}.svg`],import.meta.url).href,mutator:g=>{g.setAttribute("fill","currentColor"),g.setAttribute("stroke","currentColor")}});var __defProp$d=Object.defineProperty,__getOwnPropDesc$f=Object.getOwnPropertyDescriptor,__decorateClass$g=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$f(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$d(a,l,O),O};let KIcon=class extends KWidget{constructor(){super(...arguments),this.family="regular"}render(){if(!this.name)return"";const g=this.name.trim().split(/ +/),a=g.pop(),l=g.pop();return x$1`
            <wa-icon library="${l||E$1}" variant="${this.variant||E$1}"
                         family="${this.family||E$1}" name=${a} label="${this.label||this.name||E$1}"></wa-icon>`}};KIcon.styles=i$3`
        :host {
            display: contents;
        }
    `;__decorateClass$g([n()],KIcon.prototype,"name",2);__decorateClass$g([n()],KIcon.prototype,"family",2);__decorateClass$g([n()],KIcon.prototype,"variant",2);__decorateClass$g([n()],KIcon.prototype,"label",2);KIcon=__decorateClass$g([t("k-icon")],KIcon);var __defProp$c=Object.defineProperty,__decorateClass$f=(g,a,l,A)=>{for(var O=void 0,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=R(a,l,O)||O);return O&&__defProp$c(a,l,O),O};class KPart extends KContainer{constructor(){super(...arguments),this.dirty=!1,this.isEditor=!1}getCommandStack(){return this.commandStack}renderToolbar(){return E$1}updateToolbar(){this.dispatchEvent(new CustomEvent("part-toolbar-changed",{bubbles:!0,composed:!0}))}renderContextMenu(){return E$1}updateContextMenu(){this.dispatchEvent(new CustomEvent("part-contextmenu-changed",{bubbles:!0,composed:!0}))}updated(a){super.updated(a),a.has("dirty")&&a.get("dirty")!==void 0&&this.dispatchEvent(new CustomEvent("dirty",{detail:this.dirty,bubbles:!0}))}doClose(){}disconnectedCallback(){super.disconnectedCallback()}close(){this.doClose()}connectedCallback(){super.connectedCallback()}save(){}isDirty(){return this.dirty}markDirty(a){this.dirty=a,partDirtySignal.set(null),partDirtySignal.set(this),activePartSignal.set(null),activePartSignal.set(this)}}__decorateClass$f([n()],KPart.prototype,"dirty");const TOOLBAR_MAIN="app-toolbars-main",TOOLBAR_MAIN_RIGHT="app-toolbars-main-right",TOOLBAR_MAIN_CENTER="app-toolbars-main-center",TOOLBAR_BOTTOM="app-toolbars-bottom",TOOLBAR_BOTTOM_CENTER="app-toolbars-bottom-center",TOOLBAR_BOTTOM_END="app-toolbars-bottom-end",EDITOR_AREA_MAIN="editor-area-main",SIDEBAR_MAIN="sidebar-main",SIDEBAR_MAIN_BOTTOM="sidebar-main-bottom",SIDEBAR_AUXILIARY="sidebar-auxiliary",PANEL_BOTTOM="panel-bottom",HIDE_DOT_RESOURCE=!1;var MouseButton=(g=>(g[g.LEFT=0]="LEFT",g[g.MIDDLE=1]="MIDDLE",g[g.RIGHT=2]="RIGHT",g[g.BACK=3]="BACK",g[g.FORWARD=4]="FORWARD",g))(MouseButton||{});class TaskService{constructor(){this.tasks=[],this.updateCounter=0}notifyUpdate(){this.updateCounter++,activeTasksSignal.set(this.updateCounter)}run(a,l){const A=this.createProgressMonitor(a);try{this.tasks.push(A),this.notifyUpdate(),l(A)}finally{this.tasks.splice(this.tasks.indexOf(A),1),this.notifyUpdate()}}async runAsync(a,l){const A=this.createProgressMonitor(a);return this.tasks.push(A),this.notifyUpdate(),l(A).finally(()=>{this.tasks.splice(this.tasks.indexOf(A),1),this.notifyUpdate()})}createProgressMonitor(a){const l={name:a,message:"",currentStep:0,totalSteps:-1,progress:-1};return new Proxy(l,{set:(A,O,Y)=>(A[O]=Y,this.notifyUpdate(),!0)})}getActiveTasks(){return this.tasks}}const taskService=new TaskService;rootContext.put("taskService",taskService);const TOPIC_EXTENSIONS_CHANGED="events/extensionsregistry/extensionsConfigChanged",KEY_EXTENSIONS_CONFIG="extensions",KEY_EXTERNAL_EXTENSIONS="extensions.external";class ExtensionRegistry{constructor(){this.extensions={},this.loadedExtensions=new Set,this.loadingPromises=new Map,subscribe(TOPIC_SETTINGS_CHANGED,()=>{this.extensionsSettings=void 0,this.checkExtensionsConfig().then()}),this.loadPersistedExternalExtensions().then(()=>{this.checkExtensionsConfig().then(async()=>{const a=this.extensionsSettings?.filter(l=>this.isEnabled(l.id)).map(l=>this.load(l.id).catch(A=>{toastError("Extension could not be loaded: "+A.message)}))||[];await Promise.all(a)})})}async loadPersistedExternalExtensions(){try{const a=await appSettings.get(KEY_EXTERNAL_EXTENSIONS);a&&Array.isArray(a)&&(a.forEach(l=>{this.extensions[l.id]=l}),defaultLogger.debug(`Loaded ${a.length} persisted external extensions`))}catch(a){defaultLogger.error(`Failed to load persisted external extensions: ${a}`)}}async savePersistedExternalExtensions(){try{const a=Object.values(this.extensions).filter(l=>l.external);await appSettings.set(KEY_EXTERNAL_EXTENSIONS,a)}catch(a){defaultLogger.error(`Failed to save persisted external extensions: ${a}`)}}async checkExtensionsConfig(){this.extensionsSettings||(this.extensionsSettings=await appSettings.get(KEY_EXTENSIONS_CONFIG),this.extensionsSettings||(await appSettings.set(KEY_EXTENSIONS_CONFIG,[]),this.extensionsSettings=await appSettings.get(KEY_EXTENSIONS_CONFIG)),publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings))}registerExtension(a){this.extensions[a.id]=a,a.external&&this.savePersistedExternalExtensions().catch(l=>{defaultLogger.error(`Failed to persist external extension: ${l}`)}),publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings)}getExtensions(){return Object.values(this.extensions)}isEnabled(a){return this.checkExtensionsConfig(),!!this.extensionsSettings?.find(l=>l.id===a&&l.enabled)}isLoaded(a){return this.loadedExtensions.has(a)}enable(a,l=!1){this.isEnabled(a)||(defaultLogger.debug(`Loading extension: ${a}`),this.load(a).then(()=>{this.updateEnablement(a,!0,l)}).catch(A=>{defaultLogger.error(`Could not load extension: ${a}`)}))}async load(a,l=[]){if(this.loadedExtensions.has(a))return;const A=this.loadingPromises.get(a);if(A)return A;if(l.includes(a)){const R=[...l,a].join(" → ");throw new Error(`Circular dependency detected: ${R}`)}const O=this.extensions[a];if(!O)throw new Error("Extension not found: "+a);const Y=(async()=>{try{if(O.dependencies&&O.dependencies.length>0){defaultLogger.debug(`Loading dependencies for ${a}: ${O.dependencies.join(", ")}`);const ee=[...l,a];for(const xe of O.dependencies)await this.load(xe,ee),this.isEnabled(xe)||(await this.updateEnablementAsync(xe,!0,!1),defaultLogger.debug(`Auto-enabled dependency: ${xe}`))}const R=await taskService.runAsync("Loading extension: "+O.name,()=>{if(O.loader)return O.loader();if(O.url)return import(O.url)});if(this.loadedExtensions.add(a),R?.default instanceof Function){defaultLogger.debug(`Executing extension function for: ${a}`);try{R?.default(uiContext.getProxy()),defaultLogger.debug(`Extension function executed successfully: ${a}`)}catch(ee){throw defaultLogger.error(`Error executing extension function for ${a}: ${ee}`),ee}}else defaultLogger.warn(`Extension ${a} does not export a default function`);defaultLogger.debug(`Extension loaded: ${a}`)}catch(R){throw this.loadedExtensions.delete(a),R}finally{this.loadingPromises.delete(a)}})();return this.loadingPromises.set(a,Y),Y}disable(a,l=!1){this.isEnabled(a)&&this.updateEnablement(a,!1,l)}updateEnablement(a,l,A){this.checkExtensionsConfig().then(()=>{const O=this.extensionsSettings?.find(Y=>Y.id==a);O?O.enabled=l:this.extensionsSettings?.push({id:a,enabled:l}),appSettings.set(KEY_EXTENSIONS_CONFIG,this.extensionsSettings).then(()=>{if(A){const Y=this.extensions[a];toastInfo(l?Y.name+" enabled.":Y.name+" disabled  - Please restart to take effect")}publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings)})})}async updateEnablementAsync(a,l,A){await this.checkExtensionsConfig();const O=this.extensionsSettings?.find(Y=>Y.id==a);if(O?O.enabled=l:this.extensionsSettings?.push({id:a,enabled:l}),await appSettings.set(KEY_EXTENSIONS_CONFIG,this.extensionsSettings),A){const Y=this.extensions[a];toastInfo(l?Y.name+" enabled.":Y.name+" disabled  - Please restart to take effect")}publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings)}}defaultLogger.debug("ExtensionRegistry initializing...");const extensionRegistry=new ExtensionRegistry;rootContext.put("extensionRegistry",extensionRegistry);defaultLogger.debug("ExtensionRegistry initialized");const logger$7=createLogger("AppLoader");function getErrorMessage(g){return g instanceof Error?g.message:String(g)}function extractLastPathSegment(g){try{const l=new URL(g).pathname.split("/").filter(Boolean);return l.length>0?l[l.length-1]:void 0}catch{const a=g.split("/").filter(Boolean);return a.length>0?a[a.length-1]:void 0}}function extractAppIdFromPath(){const a=window.location.pathname.split("/").filter(Boolean);if(a.length===0)return;const l=a[0];if(!(!l||l==="index.html"||l.endsWith(".html")))return l}class AppLoaderService{constructor(){this.apps=new Map,this.started=!1,this.container=document.body}registerApp(a,l){this.apps.has(a.id)&&logger$7.warn(`App '${a.id}' is already registered. Overwriting.`),this.apps.set(a.id,a),logger$7.info(`Registered app: ${a.name} (${a.id}) v${a.version}`),l?.defaultAppId&&(this.defaultAppId=l.defaultAppId),l?.container&&(this.container=l.container),l?.autoStart&&!this.started&&this.start()}async loadExtensionFromUrl(a){logger$7.info(`Loading extension from URL: ${a}...`);try{const l=`url:${a}`;if(extensionRegistry.isEnabled(l)){logger$7.info(`Extension from URL ${a} is already enabled`);return}const A={id:l,name:`Extension from ${a}`,description:`Extension loaded from URL: ${a}`,url:a};extensionRegistry.registerExtension(A),logger$7.info(`Registered extension from URL: ${l}`),extensionRegistry.enable(l,!1),logger$7.info(`Successfully enabled extension from URL: ${a}`)}catch(l){throw logger$7.error(`Failed to load extension from URL ${a}: ${getErrorMessage(l)}`),l}}async loadAppFromUrl(a){logger$7.info(`Loading app from URL: ${a}...`);try{const l=await import(a);if(!l.default)throw new Error(`Module at ${a} does not have a default export`);const A=l.default;if(!A.id||!A.name||!A.version)throw new Error(`Module at ${a} does not export a valid AppDefinition`);return logger$7.info(`Successfully loaded app definition from URL: ${A.name} (${A.id})`),A}catch(l){throw logger$7.error(`Failed to load app from URL ${a}: ${getErrorMessage(l)}`),l}}async start(){if(this.started){logger$7.debug("AppLoader already started");return}document.readyState==="loading"&&await new Promise(xe=>{document.addEventListener("DOMContentLoaded",()=>xe(),{once:!0})}),this.started=!0,logger$7.info("Starting AppLoader...");const a=new URLSearchParams(window.location.search),l=a.get("app"),A=a.get("appId"),O=extractAppIdFromPath(),Y=this.apps.size;let R;if(l&&(R=extractLastPathSegment(l),R&&logger$7.info(`Extracted app ID from URL path: ${R}`)),O&&logger$7.info(`Extracted app ID from current page path: ${O}`),l)try{logger$7.info(`URL parameter 'app' found: ${l}, attempting to load extension or app`);try{await this.loadExtensionFromUrl(l),logger$7.info(`Successfully loaded extension from URL: ${l}`)}catch(xe){logger$7.info(`Failed to load as extension, trying as app definition: ${getErrorMessage(xe)}`);try{const ne=await this.loadAppFromUrl(l);this.registerApp(ne),await this.loadApp(ne.id,this.container),logger$7.info(`Successfully loaded app from URL: ${l}`);return}catch(ne){throw logger$7.error(`Failed to load from URL as both extension and app: ${getErrorMessage(ne)}`),ne}}}catch(xe){logger$7.error(`Failed to load from URL parameter, falling back to default app: ${getErrorMessage(xe)}`)}const ee=this.selectAppToLoad({appIdFromUrl:A,appIdFromPath:O,appIdFromAppUrl:R,appsBeforeExtension:Y});if(!ee)throw new Error("No apps registered");await this.loadApp(ee,this.container)}async loadApp(a,l){const A=this.apps.get(a);if(!A)throw new Error(`App '${a}' not found. Make sure it's registered.`);logger$7.info(`Loading app: ${A.name}...`),this.currentApp&&(logger$7.info(`Disposing current app: ${this.currentApp.name}`),this.currentApp.dispose&&await this.currentApp.dispose(),this.currentApp.extensions&&(logger$7.info(`Disabling ${this.currentApp.extensions.length} extensions...`),this.currentApp.extensions.forEach(O=>{extensionRegistry.disable(O)}))),A.contributions&&(logger$7.info("Registering app contributions..."),A.contributions.ui&&(A.contributions.ui.forEach(O=>{const Y=O.target;Y&&contributionRegistry.registerContribution(Y,O)}),logger$7.info(`Registered ${A.contributions.ui.length} UI contributions`)),A.contributions.extensions&&(A.contributions.extensions.forEach(O=>{extensionRegistry.registerExtension(O)}),logger$7.info(`Registered ${A.contributions.extensions.length} app extensions`))),A.extensions&&(logger$7.info(`Enabling ${A.extensions.length} extensions...`),A.extensions.forEach(O=>{extensionRegistry.enable(O)})),A.initialize&&(logger$7.info(`Initializing ${A.name}...`),await A.initialize()),this.currentApp=A,logger$7.info(`App ${A.name} loaded successfully`),this.updateDocumentMetadata(A),l&&this.renderApp(l)}updateDocumentMetadata(a){if(document.title=a.name,a.metadata?.favicon){const l=a.metadata.favicon;let A=document.querySelector("link[rel*='icon']");A||(A=document.createElement("link"),A.rel="icon",document.head.appendChild(A)),A.type="image/svg+xml",A.href=l}}renderApp(a){if(!this.currentApp)throw new Error("No app loaded. Call loadApp() first.");const l=this.currentApp.render?this.currentApp.render():x$1`<k-standard-app></k-standard-app>`;B$1(l,a),logger$7.info(`Rendered ${this.currentApp.name}`)}getCurrentApp(){return this.currentApp}getRegisteredApps(){return Array.from(this.apps.values())}selectAppToLoad(a){const{appIdFromUrl:l,appIdFromPath:A,appIdFromAppUrl:O,appsBeforeExtension:Y}=a;if(l){if(this.apps.has(l))return logger$7.info(`Loading app specified by URL parameter 'appId': ${l}`),l;logger$7.warn(`App ID '${l}' from URL parameter not found`)}if(A){if(this.apps.has(A))return logger$7.info(`Loading app from URL path: ${A}`),A;logger$7.debug(`App ID '${A}' from URL path not found, continuing search`)}if(O&&this.apps.has(O))return logger$7.info(`Loading app using ID extracted from app URL path: ${O}`),O;if(this.apps.size>Y){const ee=Array.from(this.apps.values()).slice(Y);if(ee.length>0){const xe=ee[0];return logger$7.info(`Loading app registered by extension: ${xe.name} (${xe.id})`),xe.id}}if(this.defaultAppId){if(this.apps.has(this.defaultAppId))return this.defaultAppId;logger$7.warn(`Default app '${this.defaultAppId}' not found`)}const R=this.getRegisteredApps();if(R.length>0){const ee=R[0];return logger$7.info(`Loading first registered app: ${ee.name} (${ee.id})`),ee.id}}}const appLoaderService=new AppLoaderService;rootContext.put("appLoaderService",appLoaderService);var __defProp$b=Object.defineProperty,__getOwnPropDesc$e=Object.getOwnPropertyDescriptor,__decorateClass$e=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$e(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$b(a,l,O),O};let KTabs=class extends KContainer{constructor(){super(...arguments),this.contributions=[],this.tabGroup=e$1(),this.containerId=null,this.resizeObservers=new WeakMap}doBeforeUI(){if(this.containerId=this.getAttribute("id"),!this.containerId)throw new Error("k-tabs requires an 'id' attribute to function");this.loadAndResolveContributions()}doInitUI(){this.updateComplete.then(()=>{this.activateNextAvailableTab(),this.tabGroup.value&&(this.tabGroup.value.addEventListener("wa-tab-show",g=>{const a=this.getTabPanel(g.detail.name);a&&(this.updateToolbarFromComponent(a),requestAnimationFrame(()=>{this.updateToolbarHeightVariable(a),this.setupToolbarResizeObserver(a)}),this.dispatchEvent(new CustomEvent("tab-shown",{detail:a})))}),this.tabGroup.value.addEventListener("part-toolbar-changed",g=>{const l=g.target.closest("wa-tab-panel");l&&(this.updateToolbarFromComponent(l),requestAnimationFrame(()=>this.updateToolbarHeightVariable(l)))}),this.tabGroup.value.addEventListener("part-contextmenu-changed",g=>{const l=g.target.closest("wa-tab-panel");l&&this.updateContextMenuFromComponent(l)}),this.tabGroup.value.addEventListener("click",g=>{const a=g.target,l=a.closest("wa-tab");if(l){const R=l.getAttribute("panel");if(R){const ee=this.getTabPanel(R);if(ee){const xe=ee.querySelector(".tab-content");if(xe&&xe.firstElementChild){const ne=xe.firstElementChild;ne instanceof KPart&&activePartSignal.set(ne)}}}return}const A=a.closest("wa-scroller.tab-content");if(!A)return;const O=A.closest("wa-tab-panel");if(!O)return;const Y=O.querySelector(".tab-content");if(Y&&Y.firstElementChild){const R=Y.firstElementChild;R instanceof KPart&&activePartSignal.set(R)}}),this.tabGroup.value.addEventListener("contextmenu",g=>{const a=g,l=a.target.closest("wa-scroller.tab-content");if(!l)return;a.preventDefault();const A=l.closest("wa-tab-panel");A&&requestAnimationFrame(()=>{this.updateContextMenuFromComponent(A);const O=A.querySelector("k-contextmenu");O&&O.show({x:a.clientX,y:a.clientY},a)})}))}),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,g=>{!this.containerId||g.target!==this.containerId||(this.loadAndResolveContributions(),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()}))})}updated(g){if(super.updated(g),g.has("contributions")){const a=this.containerId===EDITOR_AREA_MAIN;this.contributions.forEach(l=>{const A=this.getTabPanel(l.name);if(!A)return;const O=A.querySelector(".tab-content");if(O&&O.firstElementChild){const Y=O.firstElementChild;Y instanceof KPart&&(Y.tabContribution=l,Y.isEditor=a)}requestAnimationFrame(()=>this.updateToolbarHeightVariable(A))})}}has(g){return this.tabGroup.value?!!this.getTabPanel(g):!1}activate(g){this.tabGroup.value&&this.tabGroup.value.setAttribute("active",g)}getActiveEditor(){return this.tabGroup.value?this.tabGroup.value.getAttribute("active"):null}open(g){if(this.contributions.find(l=>l.name===g.name)){this.activate(g.name);return}this.contributions.push(g),this.requestUpdate(),this.updateComplete.then(()=>{this.activate(g.name);const l=this.getTabPanel(g.name);if(l){const A=l.querySelector(".tab-content");if(A&&A.firstElementChild){const O=A.firstElementChild;O instanceof KPart&&(O.tabContribution=g,O.isEditor=this.containerId===EDITOR_AREA_MAIN)}requestAnimationFrame(()=>{this.updateToolbarFromComponent(l),this.updateToolbarHeightVariable(l),this.setupToolbarResizeObserver(l)})}})}handleTabAuxClick(g,a){g.button===MouseButton.MIDDLE&&a.closable&&this.closeTab(g,a.name)}async closeTab(g,a){if(g.stopPropagation(),this.isDirty(a)&&!await confirmDialog("Unsaved changes will be lost: Do you really want to close?"))return;const l=this.getTabPanel(a);if(!l)return;const A=this.contributions.find(Y=>Y.name===a);if(!A)return;this.cleanupTabInstance(l);const O=this.contributions.indexOf(A);O>-1&&this.contributions.splice(O,1),this.dispatchEvent(new CustomEvent("tab-closed",{detail:l})),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()})}markDirty(g,a){this.getTab(g).classList.toggle("part-dirty",a)}isDirty(g){return this.getTab(g).classList.contains("part-dirty")}loadAndResolveContributions(){this.contributions=contributionRegistry.getContributions(this.containerId),this.requestUpdate()}cleanupTabInstance(g){const a=this.resizeObservers.get(g);a&&(a.disconnect(),this.resizeObservers.delete(g));const l=g.querySelector(".tab-content");if(l&&l.firstElementChild){const A=l.firstElementChild;"close"in A&&typeof A.close=="function"&&A.close()}}activateNextAvailableTab(){if(!this.tabGroup.value)return;const g=this.tabGroup.value.querySelectorAll("wa-tab");if(g.length>0){const a=g.item(0).getAttribute("panel");a&&this.tabGroup.value.setAttribute("active",a)}else this.tabGroup.value.removeAttribute("active")}getTabPanel(g){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab-panel[name='${g}']`):null}getTab(g){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab[panel='${g}']`):null}updateToolbarFromComponent(g){const a=g.querySelector(".tab-content");if(!a||!a.firstElementChild)return;const l=a.firstElementChild;if(!(l instanceof KPart)||!l.renderToolbar)return;const A=g.querySelector("k-toolbar");A&&(A.partToolbarRenderer=()=>l.renderToolbar(),A.requestUpdate())}updateContextMenuFromComponent(g){const a=g.querySelector(".tab-content");if(!a||!a.firstElementChild)return;const l=a.firstElementChild;if(!(l instanceof KPart)||!l.renderContextMenu)return;const A=g.querySelector("k-contextmenu");A&&(A.partContextMenuRenderer=()=>l.renderContextMenu(),A.requestUpdate())}updateToolbarHeightVariable(g){const a=g.querySelector(".tab-toolbar");if(!a)return;const l=a.offsetHeight;g.style.setProperty("--toolbar-height",`${l}px`)}setupToolbarResizeObserver(g){if(this.resizeObservers.has(g))return;const a=g.querySelector(".tab-toolbar");if(!a)return;const l=new ResizeObserver(()=>{this.updateToolbarHeightVariable(g)});l.observe(a),this.resizeObservers.set(g,l)}render(){const g=appLoaderService.getCurrentApp();return x$1`
            <wa-tab-group ${n$1(this.tabGroup)}>
                ${n$2(this.contributions.length===0,()=>x$1`
                        <div class="empty-state">
                            ${n$2(g,()=>x$1`
                                    <div class="empty-content">
                                        <h2 class="empty-title">${g.name}</h2>
                                        ${n$2(g.description,()=>x$1`<p class="empty-description">${g.description}</p>`)}
                                    </div>
                                `,()=>x$1`
                                    <wa-icon name="folder-open" class="empty-icon"></wa-icon>
                                `)}
                        </div>
                    `,()=>c(this.contributions,a=>a.name,a=>x$1`
                            <wa-tab panel="${a.name}"
                                    @auxclick="${l=>this.handleTabAuxClick(l,a)}">
                                <k-icon name="${a.icon}"></k-icon>
                                ${a.label}
                                ${n$2(a.closable,()=>x$1`
                                    <wa-icon name="xmark" label="Close"  @click="${l=>this.closeTab(l,a.name)}"></wa-icon>
                                `)}
                            </wa-tab>
                            <wa-tab-panel name="${a.name}">
                                <k-toolbar id="toolbar:${a.editorId??a.name}" 
                                           class="tab-toolbar"
                                           ?is-editor="${this.containerId===EDITOR_AREA_MAIN}"></k-toolbar>
                                <wa-scroller class="tab-content" orientation="vertical">
                                    ${a.component?a.component(a.name):E$1}
                                </wa-scroller>
                                <k-contextmenu id="contextmenu:${a.name}"
                                               ?is-editor="${this.containerId===EDITOR_AREA_MAIN}"></k-contextmenu>
                            </wa-tab-panel>
                        `))}
            </wa-tab-group>
        `}};KTabs.styles=i$3`
        :host {
            height: 100%;
            width: 100%;
        }

        wa-tab-group {
            height: 100%;
            width: 100%;
        }

        wa-tab-group::part(base) {
            display: grid;
            grid-template-rows: auto minmax(0, 1fr);
            height: 100%;
            width: 100%;
        }

        wa-tab-panel[active] {
            display: grid;
            grid-template-rows: minmax(0, 1fr);
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .tab-content {
            position: absolute;
            top: calc(var(--toolbar-height, 0px));
            right: 0;
            left: 0;
            height: calc(100% - var(--toolbar-height, 0px));
        }

        wa-tab::part(base) {
            padding: 3px 0.5rem;
        }

        wa-tab-panel {
            --padding: 0px;
        }

        .part-dirty::part(base) {
            font-style: italic;
            color: var(--wa-color-danger-fill-loud)
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            grid-row: 2;
        }

        .empty-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            gap: 0.75rem;
            opacity: 0.3;
        }

        .empty-title {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--wa-color-text-quiet);
        }

        .empty-description {
            margin: 0;
            font-size: 1rem;
            color: var(--wa-color-text-quiet);
            max-width: 500px;
        }

        .empty-icon {
            font-size: 6rem;
            opacity: 0.2;
            color: var(--wa-color-text-quiet);
        }
    `;__decorateClass$e([r$1()],KTabs.prototype,"contributions",2);KTabs=__decorateClass$e([t("k-tabs")],KTabs);var __defProp$a=Object.defineProperty,__getOwnPropDesc$d=Object.getOwnPropertyDescriptor,__decorateClass$d=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$d(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$a(a,l,O),O};let KResizableGrid=class extends KElement{constructor(){super(...arguments),this.orientation="horizontal",this.gridSizes=[],this.gridChildren=[],this.resizing=null,this.resizeOverlay=null,this.childrenLoaded=!1,this.childStylesApplied=!1,this.settingsLoaded=!1,this.handleResize=g=>{if(!this.resizing)return;const l=(this.orientation==="horizontal"?g.clientX:g.clientY)-this.resizing.startPos,A=[...this.resizing.startSizes];A[this.resizing.handleIndex]+=l,A[this.resizing.handleIndex+1]-=l;const O=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,Y=O*.05;if(A[this.resizing.handleIndex]>=Y&&A[this.resizing.handleIndex+1]>=Y){this.resizing.currentSizes=A;const R=A.map((ee,xe)=>{const te=`${(ee/O*100).toFixed(2)}%`;return xe===A.length-1?te:`${te} 4px`}).join(" ");this.orientation==="horizontal"?this.style.gridTemplateColumns=R:this.style.gridTemplateRows=R}},this.stopResize=async()=>{if(this.resizing?.currentSizes){const g=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight;this.gridSizes=this.resizing.currentSizes.map(a=>`${(a/g*100).toFixed(2)}%`),await this.saveSizes(),this.requestUpdate()}this.resizeOverlay&&(document.body.removeChild(this.resizeOverlay),this.resizeOverlay=null),this.resizing=null,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.body.style.cursor="",document.body.style.userSelect=""}}createRenderRoot(){return this}doBeforeUI(){this.childrenLoaded||(this.mutationObserver=new MutationObserver(()=>{this.childrenLoaded||this.loadChildren()}),this.mutationObserver.observe(this,{childList:!0,subtree:!1}),this.loadChildren())}async loadChildren(){const g=Array.from(this.children).filter(a=>a.tagName!=="STYLE"&&a.tagName!=="SCRIPT"&&!a.classList.contains("resize-handle"));if(g.length!==0){if(this.childrenLoaded=!0,this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.gridChildren=g,!this.settingsLoaded){this.settingsLoaded=!0;const a=await this.getDialogSetting();if(a&&Array.isArray(a.sizes)&&a.sizes.length===this.gridChildren.length){this.gridSizes=a.sizes,this.requestUpdate();return}}if(this.sizes)this.gridSizes=this.sizes.split(",").map(a=>a.trim());else{const a=`${100/this.gridChildren.length}%`;this.gridSizes=this.gridChildren.map(()=>a)}this.requestUpdate()}}async saveSizes(){this.gridSizes.length!==0&&await this.setDialogSetting({sizes:this.gridSizes,orientation:this.orientation})}updated(g){super.updated(g),g.has("gridChildren")&&!this.childStylesApplied&&this.gridChildren.length>0&&(this.childStylesApplied=!0,this.gridChildren.forEach((a,l)=>{a.style.overflow="hidden",a.style.height="100%",a.style.width="100%",a.style.gridColumn=this.orientation==="horizontal"?`${l*2+1}`:"1",a.style.gridRow=this.orientation==="vertical"?`${l*2+1}`:"1",a.style.display="flex",a.style.flexDirection="column"}))}startResize(g,a){if(g.preventDefault(),a>=this.gridChildren.length-1)return;const l=this.orientation==="horizontal"?g.clientX:g.clientY,A=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,O=this.gridSizes.map(Y=>Y.endsWith("%")?parseFloat(Y)/100*A:(Y.endsWith("px"),parseFloat(Y)));this.resizing={handleIndex:a,startPos:l,startSizes:O},this.resizeOverlay=document.createElement("div"),this.resizeOverlay.style.position="fixed",this.resizeOverlay.style.top="0",this.resizeOverlay.style.left="0",this.resizeOverlay.style.width="100%",this.resizeOverlay.style.height="100%",this.resizeOverlay.style.zIndex="9999",this.resizeOverlay.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.appendChild(this.resizeOverlay),document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"}render(){if(this.gridChildren.length===0||this.gridSizes.length===0)return E$1;const g=this.gridSizes.flatMap((a,l)=>l===this.gridSizes.length-1?[a]:[a,"4px"]).join(" ");return this.style.display="grid",this.orientation==="horizontal"?(this.style.gridTemplateColumns=g,this.style.gridTemplateRows="100%"):(this.style.gridTemplateColumns="100%",this.style.gridTemplateRows=g),this.style.overflow="hidden",x$1`
            <style>
                .resize-handle {
                    position: relative;
                    z-index: 10;
                    background-color: var(--wa-color-neutral-border-quiet);
                    transition: background-color var(--wa-transition-fast);
                }
                
                .resize-handle:hover {
                    background-color: var(--wa-color-brand-fill-normal);
                }
            </style>
            
            ${this.gridChildren.map((a,l)=>{if(l<this.gridChildren.length-1){const A=this.orientation==="horizontal"?`${l*2+2}`:"1",O=this.orientation==="vertical"?`${l*2+2}`:"1";return x$1`
                        <div 
                            class="resize-handle"
                            style="
                                cursor: ${this.orientation==="horizontal"?"col-resize":"row-resize"};
                                grid-column: ${A};
                                grid-row: ${O};
                            "
                            @mousedown=${Y=>this.startResize(Y,l)}
                        ></div>
                    `}return E$1})}
        `}disconnectedCallback(){super.disconnectedCallback(),this.resizing&&this.stopResize(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}connectedCallback(){super.connectedCallback(),this.style.height="100%",this.style.width="100%"}};__decorateClass$d([n()],KResizableGrid.prototype,"orientation",2);__decorateClass$d([n()],KResizableGrid.prototype,"sizes",2);__decorateClass$d([r$1()],KResizableGrid.prototype,"gridSizes",2);__decorateClass$d([r$1()],KResizableGrid.prototype,"gridChildren",2);KResizableGrid=__decorateClass$d([t("k-resizable-grid")],KResizableGrid);const TOPIC_WORKSPACE_CHANGED="events/filesys/workspaceChanged",TOPIC_WORKSPACE_CONNECTED="events/filesys/workspaceConnected";class Resource{constructor(){this.state={}}getWorkspacePath(){const a=[];let l=this;for(;l;)a.push(l.getName()),l=l.getParent();return a.reverse(),a.shift(),a.join("/")}getWorkspace(){let a=this;for(;a;){const l=a.getParent();if(l)a=l;else break}return a}}var FileContentType=(g=>(g[g.TEXT=0]="TEXT",g[g.BINARY=1]="BINARY",g))(FileContentType||{});class File extends Resource{}class Directory extends Resource{}class StringFile extends File{constructor(a,l){super(),this.contents=a,this.name=l}async getContents(a){return this.contents}async saveContents(a,l){this.contents=a}async size(){return this.contents.length||null}async copyTo(a){throw Error("Not supported")}delete(a,l){throw Error("Not supported")}async rename(a){throw Error("Not supported")}getName(){return this.name}getParent(){}}class FileSysFileHandleResource extends File{constructor(a,l){super(),this.fileHandle=a,this.parent=l}getName(){return this.fileHandle.name}getParent(){return this.parent}async delete(){return this.getParent().delete(this.getName())}async getContents(a){const l=await this.fileHandle.getFile();return!a||a?.contentType==0?await l.text():a?.encoding==0||a?.uri?URL.createObjectURL(l):a?.blob?l:l.stream()}async size(){try{return(await this.fileHandle.getFile()).size}catch{return null}}async saveContents(a,l){const A=await this.fileHandle.createWritable();if(a&&typeof a.pipeTo=="function")await a.pipeTo(A);else{const O=A.getWriter();try{await O.write(a)}finally{await O.close()}}}async copyTo(a){const l=await this.getContents({blob:!0});await(await this.getWorkspace().getResource(a,{create:!0})).saveContents(l)}async rename(a){const l=this.getParent();if(!l)throw new Error("Cannot rename root resource");if(this.getName()!==a){if(!("move"in this.fileHandle)||typeof this.fileHandle.move!="function")throw new Error("File rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.fileHandle.move(a)}catch(A){throw A.name==="NotAllowedError"||A.message?.includes("not allowed")||A.message?.includes("user agent")?new Error("File rename failed: The operation took too long and user activation expired. Please try again."):A}await l.listChildren(!0),publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}}}class FileSysDirHandleResource extends Directory{constructor(a,l){super(),this.dirHandle=a,this.parent=l}getHandle(){return this.dirHandle}getParent(){return this.parent}getName(){return this.dirHandle.name}async listChildren(a=!1){return a||!this.files?this.loadingPromise?this.loadingPromise:(this.loadingPromise=(async()=>{try{const l={};try{for await(const A of this.dirHandle.values()){const Y=A.kind==="file"?new FileSysFileHandleResource(A,this):new FileSysDirHandleResource(A,this);l[Y.getName()]=Y}}catch(A){if(A.name==="NotFoundError")return this.files={},[];throw A}return this.files=l,Object.values(this.files)}finally{this.loadingPromise=void 0}})(),this.loadingPromise):Object.values(this.files)}async getResource(a,l){if(!a)throw new Error("No path provided");const A=a.split("/");let O=this,Y=!1;try{for(let R=0;R<A.length;R++){let ee=A[R];if(ee&&(ee=ee.trim()),!ee)break;if(O instanceof FileSysDirHandleResource){if(await O.listChildren(),!O.files)return null;const xe=O.files[ee];if(xe)O=xe;else if(l?.create)if(Y=!0,R<A.length-1)try{const ne=await O.dirHandle.getDirectoryHandle(ee,{create:!0}),te=new FileSysDirHandleResource(ne,O);O.files[ee]=te,O=te,O instanceof FileSysDirHandleResource&&await O.listChildren();continue}catch(ne){throw ne.name==="NotFoundError"?new Error(`Directory not found or not accessible: ${A.slice(0,R+1).join("/")}`):ne}else try{const ne=await O.dirHandle.getFileHandle(ee,{create:!0}),te=new FileSysFileHandleResource(ne,O);return O.files[ee]=te,te}catch(ne){throw ne.name==="NotFoundError"?new Error(`File not found or not accessible: ${A.join("/")}`):ne}else return null}}}finally{Y&&publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}return O}touch(){publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}async delete(a,l=!0){if(!a){const A=this.getParent();return A instanceof FileSysDirHandleResource&&(await A.listChildren(),A.files&&delete A.files[this.getName()]),this.files=void 0,this.loadingPromise=void 0,A?.delete(this.getName())}return this.dirHandle.removeEntry(a,{recursive:l}).then(async()=>{this.files&&delete this.files[a],publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())})}async copyTo(a){for(const l of await this.listChildren()){const A=[a,l.getName()].join("/");await l.copyTo(A)}}async rename(a){const l=this.getParent();if(!l)throw new Error("Cannot rename workspace root");if(this.getName()!==a){if(!("move"in this.dirHandle)||typeof this.dirHandle.move!="function")throw new Error("Directory rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.dirHandle.move(a)}catch(A){throw A.name==="NotAllowedError"||A.message?.includes("not allowed")||A.message?.includes("user agent")?new Error("Directory rename failed: The operation took too long and user activation expired. Please try again."):A}await l.listChildren(!0),publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}}}class WorkspaceService{constructor(){this.contributions=new Map,this.workspace=this.loadPersistedWorkspace(),this.workspace.then(a=>{a&&publish(TOPIC_WORKSPACE_CONNECTED,a)})}registerContribution(a){this.contributions.set(a.type,a),console.log(`Workspace contribution registered: ${a.name} (${a.type})`)}getContributions(){return Array.from(this.contributions.values())}async loadPersistedWorkspace(){const a=await persistenceService.getObject("workspace_data");if(!a)return;const l=this.contributions.get(a.type);if(!l){console.warn(`No contribution found for workspace type: ${a.type}`);return}try{if(l.restore){const A=await l.restore(a.data);return A&&(this.currentType=a.type),A}}catch(A){console.error(`Failed to restore workspace of type ${a.type}:`,A)}}async connectWorkspace(a){const l=Array.from(this.contributions.values()).find(R=>R.canHandle(a));if(!l)throw new Error("No workspace contribution can handle this input");const A=await l.connect(a),O=l.persist?await l.persist(A):a,Y={type:l.type,data:O};return await persistenceService.persistObject("workspace_data",Y),this.currentType=l.type,this.workspace=Promise.resolve(A),publish(TOPIC_WORKSPACE_CONNECTED,A),A}async getWorkspace(){if(!this.workspace)throw new Error("No workspace connected.");return await this.workspace}isConnected(){return!!this.workspace}getWorkspaceType(){return this.currentType}async disconnectWorkspace(){this.workspace=void 0,this.currentType=void 0,await persistenceService.persistObject("workspace_data",null),await persistenceService.persistObject("workspace",null)}}const workspaceService=new WorkspaceService;rootContext.put("workspaceService",workspaceService);workspaceService.registerContribution({type:"filesystem",name:"Local File System",canHandle(g){return g&&"kind"in g&&g.kind==="directory"},async connect(g){return new FileSysDirHandleResource(g)},async restore(g){if(g&&"kind"in g&&g.kind==="directory")return new FileSysDirHandleResource(g,void 0)},async persist(g){return g instanceof FileSysDirHandleResource?g.getHandle():null}});const treeNodeComparator=(g,a)=>!g.leaf&&a.leaf?-1:g.leaf&&!a.leaf?1:g.label.localeCompare(a.label);class EditorRegistry{constructor(){this.editorInputHandlers=[],this.listenersAttached=!1,this.cachedIconContributions=null,subscribe(TOPIC_WORKSPACE_CONNECTED,()=>{}),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,a=>{a.target==="system.icons"&&(this.cachedIconContributions=null)})}getSortedIconContributions(){if(this.cachedIconContributions!==null)return this.cachedIconContributions;const a=contributionRegistry.getContributions("system.icons");return this.cachedIconContributions=[...a].sort((l,A)=>{const O=l.priority??0,Y=A.priority??0;return Y!==O?Y-O:l.label.localeCompare(A.label)}),this.cachedIconContributions}setupEventListeners(a){if(this.listenersAttached)return;this.listenersAttached=!0;const l=Y=>{const R=Y.detail;R&&Array.from(R.querySelectorAll("*")).filter(xe=>xe instanceof KPart).forEach(xe=>{activePartSignal.set(xe),xe.isEditor&&activeEditorSignal.set(xe)})};a.addEventListener("tab-shown",l);const A=Y=>{const R=Y.detail;Array.from(R.querySelectorAll("*")).filter(xe=>xe instanceof KPart).forEach(xe=>{activePartSignal.get()==xe&&activePartSignal.set(null),activeEditorSignal.get()==xe&&activeEditorSignal.set(null)})};a.addEventListener("tab-closed",A);const O=Y=>{const ee=Y.closest("wa-tab-panel").getAttribute("name");a.markDirty(ee,Y.isDirty())};this.signalCleanup=watchSignal(partDirtySignal,O)}registerEditorInputHandler(a){this.editorInputHandlers.push(a),this.editorInputHandlers.sort((l,A)=>(A.ranking??0)-(l.ranking??0))}async handleInput(a){for(let l=0;l<this.editorInputHandlers.length;l++){const A=this.editorInputHandlers[l];if(A.canHandle(a))return await A.handle(a)}}getEditorArea(){return document.querySelector(`k-tabs#${EDITOR_AREA_MAIN}`)}async loadEditor(a){if(!a||("widgetFactory"in a||(a=await this.handleInput(a)),!a||!("widgetFactory"in a)))return;const l=this.getEditorArea();if(!l){console.error("Editor area not found. The split pane system may not be initialized yet.");return}if(this.setupEventListeners(l),l.has(a.key)){l.activate(a.key);return}l.open({name:a.key,editorId:a.editorId,label:a.title,icon:a.icon,closable:!0,noOverflow:a.noOverflow,component:a.widgetFactory})}getFileIcon(a){const l=a.includes(".")?a.split(".").pop()?.toLowerCase()||"":a.toLowerCase(),A=this.getSortedIconContributions();if(A.length===0)return"file";for(const O of A)if(O.mappings&&O.mappings[l])return O.mappings[l];return"file"}}const editorRegistry=new EditorRegistry;rootContext.put("editorRegistry",editorRegistry);contributionRegistry.registerContribution("system.icons",{label:"Default File Icons",mappings:{pdf:"file-pdf",md:"book",txt:"file-lines",ts:"code",tsx:"code",js:"code",jsx:"code",json:"file-code",geojson:"file-code",py:"python",html:"code",htm:"code",css:"code",scss:"code",sass:"code",xml:"file-code",yaml:"file-code",yml:"file-code",sql:"database",kml:"file-code",gpx:"file-code",jpg:"image",jpeg:"image",png:"image",gif:"image",svg:"image",webp:"image",bmp:"image",ico:"image"},priority:0});var __defProp$9=Object.defineProperty,__getOwnPropDesc$c=Object.getOwnPropertyDescriptor,__decorateClass$c=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$c(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$9(a,l,O),O};let KFileBrowser=class extends KPart{constructor(){super(...arguments),this.treeRef=e$1(),this.loadingNodes=new Set}doBeforeUI(){this.initializeWorkspace(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,g=>{g.target==="system.icons"&&this.requestUpdate()})}firstUpdated(g){super.firstUpdated(g),this.setupDragAndDrop()}updated(g){super.updated(g),g.has("workspaceDir")&&this.workspaceDir&&this.setupDragAndDrop()}async initializeWorkspace(){const g=await workspaceService.getWorkspace();g?await this.loadWorkspace(g):commandRegistry.execute("help")}renderToolbar(){const g=activeSelectionSignal.get()instanceof Resource;return x$1`
            <k-command icon="folder-open" title="Connect workspace..." dropdown="filebrowser.connections"></k-command>
            <k-command cmd="reload_workspace" icon="repeat" title="Reload workspace folder"></k-command>
            <k-command cmd="create_file" icon="plus" title="Create new..." dropdown="filebrowser.create"></k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!g} title="Rename selected resource (F2)"></k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!g} title="Delete selected resource"></k-command>
        `}renderContextMenu(){const g=activeSelectionSignal.get()instanceof Resource;return x$1`
            <k-command cmd="open_editor" icon="folder-open">Open</k-command>
            <k-command cmd="create_file" icon="plus" dropdown="filebrowser.create">Create new...</k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!g}>Rename</k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!g}>Delete</k-command>
        `}async onWorkspaceChanged(g){activeSelectionSignal.set(void 0),await this.loadWorkspace(g),await this.syncTreeSelection()}async onWorkspaceConnected(g){await this.loadWorkspace(g)}async loadWorkspace(g){this.workspaceDir=g,g?this.root=await this.resourceToTreeNode(g,!0):this.root=void 0}async syncTreeSelection(){await this.updateComplete;const a=this.treeRef.value?.querySelector("wa-tree")?.selectedItems||[];a.length>0&&activeSelectionSignal.set(a[0].model?.data)}async resourceToTreeNode(g,a=!1){const l=g instanceof File,A={data:g,label:g.getName(),leaf:l,children:[]};if(g instanceof Directory&&a){for(const O of await g.listChildren(!1)){const Y=await this.resourceToTreeNode(O,!1);A.children.push(Y)}A.children.sort(treeNodeComparator)}return A}createTreeItems(g,a=!1){if(!g)return x$1``;const l=!g.leaf&&g.children.length===0,A=g.data,O=A instanceof File,Y=O?editorRegistry.getFileIcon(A.getName()):g.icon||"folder-open";return x$1`
            <wa-tree-item 
                draggable=${O}
                @dragstart=${O?this.nobubble(R=>this.onDragStart(R,A)):void 0}
                @dblclick=${this.nobubble(this.onFileDoubleClicked)}
                @wa-lazy-load=${this.nobubble(R=>this.onLazyLoad(R,g))}
                .model=${g} 
                ?expanded=${a}
                ?lazy=${l}>
                <span><wa-icon name=${Y} label="${g.leaf?"File":"Folder"}"></wa-icon> ${g.label}</span>
                ${g.children.map(R=>this.createTreeItems(R,!1))}
            </wa-tree-item>`}onDragStart(g,a){if(!g.dataTransfer)return;const l=a.getWorkspacePath(),A=a.getName();if(g.dataTransfer.effectAllowed="copy",g.dataTransfer.setData("text/plain",l),g.dataTransfer.setData("application/x-workspace-file",l),g.dataTransfer.setData("text/uri-list",l),g.dataTransfer.setDragImage){const O=document.createElement("div");O.textContent=A,O.style.position="absolute",O.style.top="-1000px",O.style.padding="4px 8px",O.style.background="var(--wa-color-neutral-10)",O.style.border="1px solid var(--wa-color-neutral-30)",O.style.borderRadius="4px",document.body.appendChild(O),g.dataTransfer.setDragImage(O,0,0),setTimeout(()=>document.body.removeChild(O),0)}}async onLazyLoad(g,a){const l=a.data;l instanceof Directory&&a.children.length===0&&await this.loadNodeChildren(a,l)}async loadNodeChildren(g,a){if(!this.loadingNodes.has(g)){this.loadingNodes.add(g);try{for(const l of await a.listChildren(!1)){HIDE_DOT_RESOURCE&&l.getName().startsWith(".");const A=await this.resourceToTreeNode(l,!1);g.children.push(A)}g.children.sort(treeNodeComparator),this.requestUpdate()}catch(l){console.error("Failed to load directory children:",l)}finally{this.loadingNodes.delete(g)}}}async onFileDoubleClicked(g){const l=g.currentTarget.model.data.getWorkspacePath();this.executeCommand("open_editor",{path:l})}onSelectionChanged(g){const a=g.detail.selection;if(a&&a.length>0){const l=a[0].model;activeSelectionSignal.set(l.data)}else activeSelectionSignal.set(void 0)}setupDragAndDrop(){const g=this.treeRef.value;if(!g)return;const a=Y=>{if(!Y.dataTransfer?.types.includes("Files"))return;Y.preventDefault(),Y.dataTransfer.dropEffect="copy",g.classList.add("drag-over");const ee=Y.target.closest("wa-tree-item");ee&&ee!==this.currentDropTarget&&(this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=ee,ee.classList.add("drop-target"))},l=Y=>{Y.dataTransfer?.types.includes("Files")&&(Y.preventDefault(),g.classList.add("drag-over"))},A=Y=>{const R=g.getBoundingClientRect(),ee=Y.clientX,xe=Y.clientY;(ee<=R.left||ee>=R.right||xe<=R.top||xe>=R.bottom)&&(g.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0)},O=async Y=>{if(Y.preventDefault(),g.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0,!Y.dataTransfer||!this.workspaceDir)return;const R=Array.from(Y.dataTransfer.files);if(R.length===0)return;const ee=await this.getDropTarget(Y);await this.handleFilesDrop(R,ee)};g.removeEventListener("dragover",a),g.removeEventListener("dragenter",l),g.removeEventListener("dragleave",A),g.removeEventListener("drop",O),g.addEventListener("dragover",a),g.addEventListener("dragenter",l),g.addEventListener("dragleave",A),g.addEventListener("drop",O)}async getDropTarget(g){const l=g.target.closest("wa-tree-item");if(l){const O=l.model.data;if(O instanceof Directory)return O;const Y=O.getParent();if(Y)return Y}return this.workspaceDir}async handleFilesDrop(g,a){const l=g.length;let A=0,O=0,Y=0;for(const R of g)try{const ee=this.buildTargetPath(a,R.name);if(await this.workspaceDir.getResource(ee)&&!await confirmDialog(`File "${R.name}" already exists. Do you want to overwrite it?`)){Y++;continue}await(await this.workspaceDir.getResource(ee,{create:!0})).saveContents(R),A++}catch(ee){console.error(`Failed to upload ${R.name}:`,ee),O++}console.log(`Uploaded ${A}/${l} files${Y>0?`, ${Y} skipped`:""}${O>0?`, ${O} failed`:""}`),await this.loadWorkspace(this.workspaceDir)}buildTargetPath(g,a){const l=g.getWorkspacePath();return l?`${l}/${a}`:a}render(){return x$1`
            <div class="tree" ${n$1(this.treeRef)}>
                ${n$2(!this.workspaceDir,()=>x$1`
                    <k-no-content message="Select a workspace."></k-no-content>`,()=>x$1`
                `)}
                <wa-tree @wa-selection-change=${this.nobubble(this.onSelectionChanged)}
                         style="--indent-guide-width: 1px;">
                    ${this.createTreeItems(this.root,!0)}
                </wa-tree>
            </div>
        `}};KFileBrowser.styles=i$3`
        :host {
        }
        
        .tree {
            height: 100%;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .tree.drag-over {
            background-color: var(--wa-color-brand-fill-quiet);
            outline: 2px dashed var(--wa-color-brand-border-normal);
            outline-offset: -4px;
            border-radius: var(--wa-border-radius-medium);
        }
        
        .tree.drag-over::before {
            content: '📁 Drop files here';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            padding: var(--wa-spacing-large);
            border-radius: var(--wa-border-radius-large);
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }
        
        wa-tree-item.drop-target {
            background-color: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            border-radius: var(--wa-border-radius-small);
            outline: 2px solid var(--wa-color-brand-border-loud);
            outline-offset: -2px;
        }
    `;__decorateClass$c([r$1()],KFileBrowser.prototype,"root",2);__decorateClass$c([topic(TOPIC_WORKSPACE_CHANGED)],KFileBrowser.prototype,"onWorkspaceChanged",1);__decorateClass$c([topic(TOPIC_WORKSPACE_CONNECTED)],KFileBrowser.prototype,"onWorkspaceConnected",1);KFileBrowser=__decorateClass$c([t("k-filebrowser")],KFileBrowser);var __getOwnPropDesc$b=Object.getOwnPropertyDescriptor,__decorateClass$b=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$b(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=R(O)||O);return O};contributionRegistry.registerContribution(TOOLBAR_BOTTOM_CENTER,{html:"<k-tasks></k-tasks>"});let KTasks=class extends KPart{doBeforeUI(){this.watch(activeTasksSignal,()=>{this.requestUpdate()})}render(){activeTasksSignal.get();const g=taskService.getActiveTasks().length;if(g!=0)return x$1`
            <wa-dropdown>
                <wa-button slot="trigger" appearance="plain" size="small" title="Active tasks: ${g}">
                    <wa-animation name="zoomIn" duration="1000" play>
                        <wa-icon name="hourglass" label="Active tasks" style="color: var(--wa-color-warning-fill-loud)"></wa-icon>
                    </wa-animation>
                    Active tasks: ${g}
                </wa-button>
                ${taskService.getActiveTasks().map(a=>{const l=a.progress>=0||a.totalSteps>0,A=a.progress>=0?a.progress:a.totalSteps>0?Math.round(a.currentStep/a.totalSteps*100):0,O=a.progress<0&&a.totalSteps>0;return x$1`
                        <wa-dropdown-item style="display: block; padding: 0.5rem 1rem;">
                            <div style="margin-bottom: 0.25rem;">
                                <strong>${a.name}</strong>: ${a.message}
                            </div>
                            ${l?x$1`
                                <wa-progress-bar value="${A}" style="--track-height: 1.25rem;">
                                    ${O?`${a.currentStep}/${a.totalSteps} - `:""}${A}%
                                </wa-progress-bar>
                            `:x$1`
                                <wa-progress-bar indeterminate style="--track-height: 1.25rem;"></wa-progress-bar>
                            `}
                        </wa-dropdown-item>
                    `})}
            </wa-dropdown>
        `}};KTasks.styles=i$3`
        wa-progress-bar::part(label) {
            text-align: center;
            width: 100%;
        }
    `;KTasks=__decorateClass$b([t("k-tasks")],KTasks);var __getOwnPropDesc$a=Object.getOwnPropertyDescriptor,__decorateClass$a=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$a(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=R(O)||O);return O};const NO_WORKSPACE_LABEL="<no workspace>";let KWorkspaceName=class extends KElement{constructor(){super(...arguments),this.workspaceName=NO_WORKSPACE_LABEL}doInitUI(){this.updateWorkspaceName(),subscribe(TOPIC_WORKSPACE_CONNECTED,()=>{this.updateWorkspaceName()})}updateWorkspaceName(){workspaceService.getWorkspace().then(g=>{this.workspaceName=g?.getName()||NO_WORKSPACE_LABEL,this.requestUpdate()})}handleLoadWorkspace(){commandRegistry.execute("load_workspace",{source:this})}render(){return x$1`
            <wa-button 
                appearance="plain"
                size="small"
                title="Load workspace"
                @click=${this.handleLoadWorkspace}>
                <wa-icon name="folder-open" slot="start" label="Workspace"></wa-icon>
                ${this.workspaceName}
            </wa-button>
        `}};KWorkspaceName=__decorateClass$a([t("k-workspace-name")],KWorkspaceName);var __getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$9(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=R(O)||O);return O};const NO_PART_LABEL="<no part>";contributionRegistry.registerContribution(TOOLBAR_BOTTOM_CENTER,{html:"<k-part-name></k-part-name>"});let KPartName=class extends KElement{doBeforeUI(){this.watch(activePartSignal,()=>{this.requestUpdate()})}getPartName(){const g=activePartSignal.get();return g&&(g.tabContribution?.label||g.getAttribute("id"))||NO_PART_LABEL}render(){const a=activePartSignal.get()?.tabContribution?.icon||"box";return x$1`
            <wa-button 
                appearance="plain"
                size="small"
                title="Active part">
                <k-icon slot="start" name="${a}" label="Part"></k-icon>
                ${this.getPartName()}
            </wa-button>
        `}};KPartName=__decorateClass$9([t("k-part-name")],KPartName);var __defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$8(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$8(a,l,O),O};let KExtensions=class extends KPart{constructor(){super(...arguments),this.filterText=""}doInitUI(){subscribe(TOPIC_EXTENSIONS_CHANGED,()=>{this.requestUpdate()})}onExtensionDblClick(){}enable(g){extensionRegistry.enable(g.id,!0),this.requestUpdate()}disable(g){extensionRegistry.disable(g.id,!0),this.requestUpdate()}isExtensionRequired(g){const a=appLoaderService.getCurrentApp();return!a||!a.extensions?!1:a.extensions.includes(g)}selectionChanged(g){const a=g.detail.selection||[];a.length>0&&a[0].model?this.selectedExtension=a[0].model:this.selectedExtension=void 0}getFilteredExtensions(){if(!this.filterText.trim())return extensionRegistry.getExtensions();const g=this.filterText.toLowerCase();return extensionRegistry.getExtensions().filter(a=>a.name.toLowerCase().includes(g)||(a.description?.toLowerCase().includes(g)??!1)||a.id.toLowerCase().includes(g))}getGroupedExtensions(){const g=this.getFilteredExtensions(),a=[],l=[];return g.forEach(A=>{extensionRegistry.isEnabled(A.id)?a.push(A):l.push(A)}),a.sort((A,O)=>A.name.localeCompare(O.name)),l.sort((A,O)=>A.name.localeCompare(O.name)),{enabled:a,available:l}}isExternalExtension(g){return g.external===!0}handleFilterInput(g){this.filterText=g.target.value,this.requestUpdate()}clearFilter(){this.filterText="",this.requestUpdate()}renderToolbar(){return x$1`
            <wa-input
                placeholder="Filter extensions..."
                .value=${this.filterText}
                @input=${g=>this.handleFilterInput(g)}
                @wa-clear=${()=>this.clearFilter()}
                with-clear
                size="small"
                style="width: 300px;">
                <wa-icon slot="start" name="magnifying-glass" label="Filter"></wa-icon>
            </wa-input>
        `}render(){const g=this.getGroupedExtensions(),a=g.enabled.length>0||g.available.length>0;return x$1`
            <wa-split-panel position="30" style="height: 100%">
                <wa-tree 
                    selection="leaf"
                    style="--indent-guide-width: 1px;" 
                    slot="start"
                    @wa-selection-change="${this.selectionChanged}">
                    ${a?x$1`
                        ${g.enabled.length>0?x$1`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="check-circle" style="color: var(--wa-color-success-50);"></wa-icon>
                                    Installed (${g.enabled.length})
                                </span>
                                ${g.enabled.map(l=>{const A=this.isExternalExtension(l);return x$1`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${l}>
                                            <span><k-icon name="${l.icon}"></k-icon></span> ${l.name}${A?x$1` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                        ${g.available.length>0?x$1`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="circle" style="color: var(--wa-color-neutral-50);"></wa-icon>
                                    Available (${g.available.length})
                                </span>
                                ${g.available.map(l=>{const A=this.isExternalExtension(l);return x$1`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${l}>
                                            <span><k-icon name="${l.icon}"></k-icon></span> ${l.name}${A?x$1` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                    `:""}
                    ${a?"":x$1`
                        <div style="padding: 1em; text-align: center; opacity: 0.7;">
                            No extensions match "${this.filterText}"
                        </div>
                    `}
                </wa-tree>
                <div slot="end" style="padding: 1em;">
                    ${n$2(this.selectedExtension,l=>{const A=this.isExternalExtension(l),O=extensionRegistry.isEnabled(l.id);return x$1`
                                <h1><k-icon name="${l.icon}"></k-icon> ${l.name}${A?" (External)":""}</h1>
                                ${n$2(A,()=>x$1`
                                    <div class="marketplace-badge">
                                        <wa-icon name="store"></wa-icon>
                                        <span>External Extension</span>
                                    </div>
                                `)}
                                <hr>
                                <div>
                                    ${n$2(O,()=>x$1`
                                        <wa-button 
                                            title="${this.isExtensionRequired(l.id)?"This extension is required by the current app and cannot be uninstalled":"Disable this extension"}" 
                                            @click="${()=>this.disable(l)}"
                                            variant="danger" 
                                            appearance="plain"
                                            ?disabled=${this.isExtensionRequired(l.id)}>
                                            <wa-icon name="xmark" label="Uninstall"></wa-icon>&nbsp;Uninstall (requires restart)
                                        </wa-button>
                                        ${n$2(this.isExtensionRequired(l.id),()=>x$1`
                                            <div class="required-hint">
                                                <wa-icon name="info-circle" style="color: var(--wa-color-primary-50);"></wa-icon>
                                                <span>This extension is required by the current app and cannot be uninstalled</span>
                                            </div>
                                        `)}
                                    `,()=>x$1`
                                        <wa-button 
                                            title="Enable this extension" 
                                            @click="${()=>this.enable(l)}"
                                            variant="brand" 
                                            appearance="plain">
                                            <wa-icon name="download" label="Install"></wa-icon>&nbsp;Install
                                        </wa-button>
                                    `)}
                                </div>

                                ${n$2(l.experimental,()=>x$1`
                                    <div style="margin-top: 1em;">
                                        <wa-button size="small" variant="warning" appearance="plain">
                                            <wa-icon name="triangle-exclamation" label="Warning"></wa-icon>
                                        </wa-button>
                                        <small><i>This is an experimental extension!</i></small>
                                    </div>
                                `)}

                                ${n$2(l.version||l.author,()=>x$1`
                                    <div style="margin-top: 1em; display: flex; flex-direction: column; gap: 0.5rem;">
                                        ${n$2(l.version,()=>x$1`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="tag" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">Version: <strong>${l.version}</strong></span>
                                            </div>
                                        `)}
                                        ${n$2(l.author,()=>x$1`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="user" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">Author: <strong>${l.author}</strong></span>
                                            </div>
                                        `)}
                                    </div>
                                `)}

                                <p style="margin-top: 1em;">${l.description}</p>

                                ${n$2(l.dependencies&&l.dependencies.length>0,()=>x$1`
                                    <div style="margin-top: 1.5em;">
                                        <h3 style="margin-bottom: 0.5em;">
                                            <wa-icon name="puzzle-piece" style="font-size: 0.9em;"></wa-icon>
                                            Dependencies
                                        </h3>
                                        <div class="dependencies-list">
                                            ${l.dependencies.map(Y=>{const R=extensionRegistry.getExtensions().find(xe=>xe.id===Y),ee=extensionRegistry.isEnabled(Y);return x$1`
                                                    <div class="dependency-item">
                                                        <wa-icon 
                                                            name="${ee?"check-circle":"circle"}" 
                                                            style="color: ${ee?"var(--wa-color-success-50)":"var(--wa-color-neutral-50)"};">
                                                        </wa-icon>
                                                        <k-icon name="${R?.icon||"puzzle-piece"}"></k-icon>
                                                        <span>${R?.name||Y}</span>
                                                        ${ee?"":x$1`
                                                            <span class="dependency-badge">Not Installed</span>
                                                        `}
                                                    </div>
                                                `})}
                                        </div>
                                        <small style="opacity: 0.7; display: block; margin-top: 0.5em;">
                                            <wa-icon name="info-circle" style="font-size: 0.9em;"></wa-icon>
                                            Dependencies are automatically installed when this extension is enabled.
                                        </small>
                                    </div>
                                `)}
                            `})}
                </div>
            </wa-split-panel>
        `}};KExtensions.styles=i$3`
        :host {
        }

        wa-tree-item > span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        wa-tree-item:has(> wa-tree-item) {
            font-weight: 500;
        }

        .dependencies-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .dependency-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-surface-variant);
        }

        .dependency-item wa-icon:first-child {
            flex-shrink: 0;
        }

        .dependency-item k-icon {
            flex-shrink: 0;
        }

        .dependency-item span:not(.dependency-badge) {
            flex: 1;
        }

        .dependency-badge {
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-warning-100);
            color: var(--wa-color-warning-900);
        }

        .required-hint {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
        }

        .required-hint wa-icon {
            flex-shrink: 0;
        }

        .required-hint span {
            line-height: 1.4;
        }

        .marketplace-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.875rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--wa-color-primary-30);
        }
    `;__decorateClass$8([r$1()],KExtensions.prototype,"selectedExtension",2);__decorateClass$8([r$1()],KExtensions.prototype,"filterText",2);KExtensions=__decorateClass$8([t("k-extensions")],KExtensions);var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$7(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$7(a,l,O),O};let KLogTerminal=class extends KPart{constructor(){super(...arguments),this.messages=[],this.autoScroll=!0,this.filter="all",this.containerRef=e$1()}connectedCallback(){super.connectedCallback(),this.loadSettings(),registerLogHandler(this.log.bind(this))}disconnectedCallback(){super.disconnectedCallback(),unregisterLogHandler()}log(g,a,l="info"){const A={timestamp:new Date,level:l,source:g,message:a};this.messages=[...this.messages,A],this.updateToolbar(),this.autoScroll&&this.updateComplete.then(()=>{const O=this.containerRef.value;O&&(O.scrollTop=O.scrollHeight)})}clear(){this.messages=[],this.updateToolbar()}getFilteredMessages(){return this.filter==="all"?this.messages:this.messages.filter(g=>g.level===this.filter)}formatTimestamp(g){return g.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}getLevelIcon(g){switch(g){case"info":return"circle-info";case"warning":return"triangle-exclamation";case"error":return"circle-xmark";case"debug":return"bug"}}getLevelColor(g){switch(g){case"info":return"var(--wa-color-primary-text, #0066cc)";case"warning":return"var(--wa-color-warning-text, #ff9800)";case"error":return"var(--wa-color-danger-text, #dc3545)";case"debug":return"var(--wa-color-neutral-text-subtle, #6c757d)"}}renderToolbar(){const g=this.messages.filter(O=>O.level==="info").length,a=this.messages.filter(O=>O.level==="warning").length,l=this.messages.filter(O=>O.level==="error").length,A=this.messages.filter(O=>O.level==="debug").length;return x$1`
            <k-command 
                icon="list"
                title="All logs"
                appearance="${this.filter==="all"?"filled":"plain"}"
                variant="${this.filter==="all"?"brand":"neutral"}"
                .action=${()=>{this.filter="all",this.saveSettings(),this.updateToolbar()}}>
                All (${this.messages.length})
            </k-command>

            <k-command 
                icon="circle-info"
                title="Info logs"
                appearance="${this.filter==="info"?"filled":"plain"}"
                variant="${this.filter==="info"?"brand":"neutral"}"
                .action=${()=>{this.filter="info",this.saveSettings(),this.updateToolbar()}}>
                Info${g>0?` (${g})`:""}
            </k-command>

            <k-command 
                icon="triangle-exclamation"
                title="Warning logs"
                appearance="${this.filter==="warning"?"filled":"plain"}"
                variant="${this.filter==="warning"?"brand":"neutral"}"
                .action=${()=>{this.filter="warning",this.saveSettings(),this.updateToolbar()}}>
                Warnings${a>0?` (${a})`:""}
            </k-command>

            <k-command 
                icon="circle-xmark"
                title="Error logs"
                appearance="${this.filter==="error"?"filled":"plain"}"
                variant="${this.filter==="error"?"brand":"neutral"}"
                .action=${()=>{this.filter="error",this.saveSettings(),this.updateToolbar()}}>
                Errors${l>0?` (${l})`:""}
            </k-command>

            <k-command 
                icon="bug"
                title="Debug logs"
                appearance="${this.filter==="debug"?"filled":"plain"}"
                variant="${this.filter==="debug"?"brand":"neutral"}"
                .action=${()=>{this.filter="debug",this.saveSettings(),this.updateToolbar()}}>
                Debug${A>0?` (${A})`:""}
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>

            <k-command 
                icon="arrow-down" 
                title="${this.autoScroll?"Auto-scroll enabled":"Auto-scroll disabled"}"
                appearance="${this.autoScroll?"filled":"plain"}"
                variant="${this.autoScroll?"brand":"neutral"}"
                .action=${()=>{this.autoScroll=!this.autoScroll,this.saveSettings(),this.updateToolbar()}}>
                ${this.autoScroll?"Auto-scroll":"Manual"}
            </k-command>

            <k-command 
                icon="trash" 
                title="Clear logs"
                .action=${()=>this.clear()}>
                Clear
            </k-command>
        `}render(){const g=this.getFilteredMessages();return x$1`
            <div class="log-terminal">
                <div class="messages" ${n$1(this.containerRef)}>
                    ${g.length===0?x$1`<div class="empty-state">No log messages</div>`:g.map(a=>x$1`
                            <div class="message" data-level="${a.level}">
                                <span class="timestamp">${this.formatTimestamp(a.timestamp)}</span>
                                <wa-icon 
                                    name="${this.getLevelIcon(a.level)}" 
                                    label="${a.level}"
                                    style="color: ${this.getLevelColor(a.level)}">
                                </wa-icon>
                                <span class="source">[${a.source}]</span>
                                <span class="text">${a.message}</span>
                            </div>
                        `)}
                </div>
            </div>
        `}async loadSettings(){const g=await this.getDialogSetting();g&&(typeof g.filter=="string"&&(g.filter==="all"||["info","warning","error","debug"].includes(g.filter))&&(this.filter=g.filter),typeof g.autoScroll=="boolean"&&(this.autoScroll=g.autoScroll),this.updateToolbar())}async saveSettings(){await this.setDialogSetting({filter:this.filter,autoScroll:this.autoScroll})}};KLogTerminal.styles=i$3`
        :host {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .log-terminal {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            font-family: var(--wa-font-mono);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .message {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            align-items: baseline;
            border-radius: var(--wa-border-radius-small);
        }

        .message:hover {
            background: var(--wa-color-neutral-background-hover);
        }

        .timestamp {
            color: var(--wa-color-neutral-text-subtle);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .source {
            color: var(--wa-color-primary-text);
            font-weight: 500;
            white-space: nowrap;
        }

        .text {
            color: var(--wa-color-neutral-text);
            word-break: break-word;
        }

        .message[data-level="error"] .text {
            color: var(--wa-color-danger-text);
        }

        .message[data-level="warning"] .text {
            color: var(--wa-color-warning-text);
        }

        .message[data-level="debug"] .text {
            color: var(--wa-color-neutral-text-subtle);
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--wa-color-neutral-text-subtle);
            font-style: italic;
        }

        wa-icon {
            flex-shrink: 0;
        }
    `;__decorateClass$7([r$1()],KLogTerminal.prototype,"messages",2);__decorateClass$7([r$1()],KLogTerminal.prototype,"autoScroll",2);__decorateClass$7([r$1()],KLogTerminal.prototype,"filter",2);KLogTerminal=__decorateClass$7([t("k-log-terminal")],KLogTerminal);var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$6(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$6(a,l,O),O};let KCommand=class extends KWidget{constructor(){super(...arguments),this.cmd="",this.title="",this.label=!1,this.disabled=!1,this.appearance="plain",this.variant="neutral",this.size="small",this.params={},this.placement="bottom-start",this.dropdownContributions=[]}handleClick(g){if(!this.disabled){if(g&&g.stopPropagation(),this.action){this.action(g);return}if(this.cmd){const a=this.closest("wa-dropdown");a&&a.open!==void 0&&(a.open=!1),this.executeCommand(this.cmd,this.params)}}}handleSelect(g){const a=g.target;a&&a.open!==void 0&&(a.open=!1)}isInDropdown(){return!!this.closest("wa-dropdown, wa-dropdown-menu")}getKeybinding(){if(!this.cmd||this.action)return null;const g=keyBindingManager.getKeyBindingsForCommand(this.cmd);return g.length>0?g[0]:null}doBeforeUI(){this.dropdown&&(this.loadDropdownContributions(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,g=>{this.dropdown&&g.target===this.dropdown&&(this.dropdownContributions=g.contributions,this.requestUpdate())}))}loadDropdownContributions(){this.dropdown&&(this.dropdownContributions=contributionRegistry.getContributions(this.dropdown),this.requestUpdate())}renderContribution(g){if("command"in g){const a=g,l=a.disabled?.get();return x$1`
                <k-command 
                    cmd="${a.command}"
                    icon="${a.icon||""}"
                    .params=${a.params||{}}
                    ?disabled="${l}">
                    ${a.label}
                </k-command>
            `}if("html"in g){const l=g.html;return l instanceof Function?l():o(l)}return E$1}render(){const g=this.getKeybinding();return this.isInDropdown()?x$1`
                <wa-dropdown-item 
                    ?disabled=${this.disabled}
                    @click=${a=>this.handleClick(a)}>
                    <k-icon name="${this.icon}" label="${this.title}" slot="icon"></k-icon>
                    <slot></slot>
                    ${g?x$1`<span class="keybinding">${g}</span>`:""}
                </wa-dropdown-item>
            `:this.dropdown?x$1`
                <wa-dropdown 
                    placement=${this.placement}
                    @wa-select=${a=>this.handleSelect(a)}>
                    <wa-button 
                        slot="trigger"
                        appearance=${this.appearance}
                        variant=${this.variant}
                        size=${this.size}
                        ?disabled=${this.disabled}
                        with-caret
                        title=${g?`${this.title} (${g})`:this.title}>
                        <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                        <slot></slot>
                        ${this.label?this.title:E$1}
                    </wa-button>
                    
                    ${this.title?x$1`
                        <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                            ${this.title}
                        </h6>
                    `:E$1}
                    
                    ${this.dropdownContributions.map(a=>this.renderContribution(a))}
                    
                    ${this.cmd?x$1`
                        <wa-divider></wa-divider>
                        <k-command 
                            cmd="${this.cmd}"
                            icon="${this.icon||""}"
                            .params=${this.params}
                            ?disabled=${this.disabled}>
                            <slot></slot>
                            ${this.title}
                        </k-command>
                    `:E$1}
                </wa-dropdown>
            `:x$1`
            <wa-button
                appearance=${this.appearance}
                variant=${this.variant}
                size=${this.size}
                ?disabled=${this.disabled}
                title=${g?`${this.title} (${g})`:this.title}
                @click=${a=>this.handleClick(a)}>
                <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                <slot></slot>
            </wa-button>
        `}};KCommand.styles=i$3`
        :host {
            display: inline-block;
        }

        .keybinding {
            margin-left: auto;
            padding: 2px 6px;
            background: var(--wa-color-neutral-15);
            border: 1px solid var(--wa-color-neutral-25);
            border-radius: 3px;
            font-size: 10px;
            font-family: monospace;
            opacity: 0.7;
        }

        :host-context(.wa-light) .keybinding {
            background: var(--wa-color-neutral-85);
            border: 1px solid var(--wa-color-neutral-75);
        }
    `;__decorateClass$6([n()],KCommand.prototype,"cmd",2);__decorateClass$6([n({type:Object,attribute:!1})],KCommand.prototype,"action",2);__decorateClass$6([n()],KCommand.prototype,"title",2);__decorateClass$6([n()],KCommand.prototype,"label",2);__decorateClass$6([n()],KCommand.prototype,"icon",2);__decorateClass$6([n({type:Boolean})],KCommand.prototype,"disabled",2);__decorateClass$6([n()],KCommand.prototype,"appearance",2);__decorateClass$6([n()],KCommand.prototype,"variant",2);__decorateClass$6([n()],KCommand.prototype,"size",2);__decorateClass$6([n({type:Object,attribute:!1})],KCommand.prototype,"params",2);__decorateClass$6([n()],KCommand.prototype,"dropdown",2);__decorateClass$6([n()],KCommand.prototype,"placement",2);__decorateClass$6([r$1()],KCommand.prototype,"dropdownContributions",2);KCommand=__decorateClass$6([t("k-command")],KCommand);var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$5(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$5(a,l,O),O};let KFastViews=class extends KWidget{constructor(){super(...arguments),this.target="",this.title="",this.disabled=!1,this.appearance="plain",this.size="small",this.placement="bottom-start",this.tabContributions=[],this.drawerOpen=!1,this.drawerSize="50vw",this.drawerRef=e$1(),this.tabsRef=e$1(),this.resizeHandleRef=e$1(),this.resizing=null}getDrawerTabsId(){return`fastviews-drawer-tabs-${this.target}`}handleTabClick(g){if(!this.disabled)if(this.containerId){const a=document.querySelector(`k-tabs#${this.containerId}`);if(!a){console.error(`k-fastviews: Tab container with id "${this.containerId}" not found`);return}a.open(g)}else this.drawerOpen=!0,this.updateComplete.then(()=>{const a=this.tabsRef.value;a&&a.open(g)})}handleDrawerHide(){this.drawerOpen=!1}startResize(g){g.preventDefault(),g.stopPropagation();const a=this.drawerRef.value;if(!a)return;let A=(()=>{const R=a.shadowRoot?.querySelector('[part="panel"]');if(R&&R.offsetWidth>0)return R.offsetWidth;const ne=(window.getComputedStyle(a).getPropertyValue("--size")||this.drawerSize).match(/^(\d+(?:\.\d+)?)(px|vw|vh|%)$/);if(ne){const te=parseFloat(ne[1]),f=ne[2];if(f==="px")return te;if(f==="vw")return te/100*window.innerWidth;if(f==="vh")return te/100*window.innerHeight;if(f==="%")return te/100*window.innerWidth}return 0})();A===0&&(A=window.innerWidth*.5);const O=R=>{this.resizing&&(R.preventDefault(),R.stopPropagation(),this.resizing.rafId!==null&&cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=requestAnimationFrame(()=>{if(!this.resizing)return;const ee=this.resizing.startX-R.clientX,xe=Math.round(this.resizing.startSize+ee),ne=200,te=Math.round(window.innerWidth*.9);if(xe>=ne&&xe<=te){this.drawerSize=`${xe}px`;const f=this.drawerRef.value;f&&(f.style.setProperty("--size",this.drawerSize),f.style.setProperty("transition","none"))}this.resizing.rafId=null}))},Y=()=>{if(this.resizing){this.resizing.rafId!==null&&(cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=null),document.removeEventListener("mousemove",this.resizing.handleMouseMove),document.removeEventListener("mouseup",this.resizing.handleMouseUp),document.body.style.cursor="",document.body.style.userSelect="";const R=this.drawerRef.value;R&&R.style.removeProperty("transition"),this.resizing=null}};this.resizing={startX:g.clientX,startSize:A,handleMouseMove:O,handleMouseUp:Y,rafId:null},document.addEventListener("mousemove",O,{passive:!1}),document.addEventListener("mouseup",Y,{passive:!1}),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}doBeforeUI(){this.target&&(this.loadTabContributions(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,g=>{this.target&&g.target===this.target&&this.loadTabContributions()}))}loadTabContributions(){if(!this.target)return;const g=contributionRegistry.getContributions(this.target);this.tabContributions=g.filter(a=>"name"in a),this.requestUpdate()}renderTabContribution(g){const a=g.disabled?.get();return x$1`
            <wa-dropdown-item 
                ?disabled=${a}
                @click=${()=>this.handleTabClick(g)}>
                <k-icon name="${g.icon||""}" label="${g.label}" slot="icon"></k-icon>
                ${g.label}
            </wa-dropdown-item>
        `}render(){return this.target?this.tabContributions.length===0?E$1:x$1`
            <wa-dropdown placement=${this.placement}>
                <wa-button 
                    slot="trigger"
                    appearance=${this.appearance}
                    size=${this.size}
                    ?disabled=${this.disabled}
                    with-caret
                    title=${this.title}>
                    <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                    <slot></slot>
                </wa-button>
                
                ${this.title?x$1`
                    <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                        ${this.title}
                    </h6>
                `:E$1}
                
                ${this.tabContributions.map(g=>this.renderTabContribution(g))}
            </wa-dropdown>

            ${this.containerId?E$1:x$1`
                <wa-drawer 
                    ${n$1(this.drawerRef)}
                    label="${this.title||"Fast Views"}"
                    placement="end"
                    ?open=${this.drawerOpen}
                    @wa-hide=${this.handleDrawerHide}
                    style="--size: ${this.drawerSize};">
                    <div 
                        ${n$1(this.resizeHandleRef)}
                        class="resize-handle"
                        @mousedown=${this.startResize}>
                    </div>
                    <k-tabs 
                        ${n$1(this.tabsRef)}
                        id="${this.getDrawerTabsId()}"
                        style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                    </k-tabs>
                </wa-drawer>
            `}
        `:E$1}};KFastViews.styles=i$3`
        :host {
            display: inline-block;
        }

        wa-drawer {
            position: relative;
        }

        wa-drawer::part(panel) {
            position: relative;
        }

        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            z-index: 1000;
            background: transparent;
            transition: background-color 0.2s;
            user-select: none;
            touch-action: none;
        }

        .resize-handle:hover {
            background: var(--wa-color-brand-fill-loud);
        }

        .resize-handle:active {
            background: var(--wa-color-brand-fill-loud);
        }
    `;__decorateClass$5([n()],KFastViews.prototype,"target",2);__decorateClass$5([n()],KFastViews.prototype,"title",2);__decorateClass$5([n()],KFastViews.prototype,"icon",2);__decorateClass$5([n({type:Boolean})],KFastViews.prototype,"disabled",2);__decorateClass$5([n()],KFastViews.prototype,"appearance",2);__decorateClass$5([n()],KFastViews.prototype,"size",2);__decorateClass$5([n()],KFastViews.prototype,"placement",2);__decorateClass$5([n()],KFastViews.prototype,"containerId",2);__decorateClass$5([r$1()],KFastViews.prototype,"tabContributions",2);__decorateClass$5([r$1()],KFastViews.prototype,"drawerOpen",2);__decorateClass$5([r$1()],KFastViews.prototype,"drawerSize",2);KFastViews=__decorateClass$5([t("k-fastviews")],KFastViews);var __defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$4(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$4(a,l,O),O};let KNoContent=class extends KWidget{constructor(){super(...arguments),this.message="No content.",this.icon="info-circle"}render(){return x$1`
            <h3>
                <wa-icon name=${this.icon} label="${this.message}"></wa-icon>
                ${this.message}
            </h3>
        `}};KNoContent.styles=i$3`
        :host {
            display: flex;
            margin: 10px;
        }

        * {
            flex: 1;
        }
    `;__decorateClass$4([n()],KNoContent.prototype,"message",2);__decorateClass$4([n()],KNoContent.prototype,"icon",2);KNoContent=__decorateClass$4([t("k-no-content")],KNoContent);extensionRegistry.registerExtension({id:"system.git",name:"Git Support",description:"Git commands and UI elements",loader:()=>__vitePreload(()=>import("./git-extension-CYfH5R4h.js"),__vite__mapDeps([0,1,2])),icon:"code-branch",experimental:!0});extensionRegistry.registerExtension({id:"system.pyterminal",name:"Python terminal",description:"Python terminal view",loader:()=>__vitePreload(()=>import("./pyterminal-extension-DrY4HwKI.js"),__vite__mapDeps([3,1,2,4])),icon:"k python",experimental:!0});extensionRegistry.registerExtension({id:"system.linuxterminal",name:"Linux terminal",description:"Linux terminal view",loader:()=>__vitePreload(()=>import("./k-linuxterminal-B4WGW97X.js"),__vite__mapDeps([5,1,2,4])),icon:"terminal",experimental:!0});extensionRegistry.registerExtension({id:"system.webllm",name:"WebLLM",description:"In-Browser LLM inference",loader:()=>__vitePreload(()=>import("./webllmservice-DbPCNavc.js"),__vite__mapDeps([6,1,2])),icon:"robot"});extensionRegistry.registerExtension({id:"system.p12splitter",name:".p12 file splitter",description:"Adds a command to split/separate a .p12 file into private/public and additional .pem files",loader:()=>__vitePreload(()=>import("./p12-splitter-BldeLuN7.js"),__vite__mapDeps([7,1,2])),icon:"certificate"});extensionRegistry.registerExtension({id:"system.pythonpackagemanager",name:"Python Package Manager",description:"Manage Python packages for notebooks and other Python-based extensions",loader:()=>__vitePreload(()=>import("./package-manager-extension-DgBhN8r6.js"),__vite__mapDeps([8,1,2])),icon:"box"});extensionRegistry.registerExtension({id:"system.notebook",name:"Jupyter-like Notebook Editor",description:"View and execute Jupyter-like notebooks (.ipynb) with Python code execution and markdown rendering",loader:()=>__vitePreload(()=>import("./notebook-extension-cUbR7N1Z.js"),__vite__mapDeps([9,1,2,10,11,8])),icon:"k jupyter",dependencies:["system.pythonpackagemanager"]});extensionRegistry.registerExtension({id:"system.commandpalette",name:"Command Palette",description:"VS Code-style command palette at the top center for quick command execution (Ctrl+Shift+P)",loader:()=>__vitePreload(()=>import("./command-palette-extension-BFWQnOhi.js"),__vite__mapDeps([12,1,2])),icon:"terminal"});extensionRegistry.registerExtension({id:"system.download",name:"Download Files",description:"Download files from URLs to the workspace",loader:()=>__vitePreload(()=>import("./download-extension-BoZoNqfx.js"),__vite__mapDeps([13,1,2])),icon:"download"});extensionRegistry.registerExtension({id:"system.unzip",name:"Unzip Archives",description:"Extract zip archives to the workspace",loader:()=>__vitePreload(()=>import("./unzip-extension-BSxZC6Fw.js"),__vite__mapDeps([14,1,2])),icon:"box-archive"});extensionRegistry.registerExtension({id:"system.mdeditor",name:"Markdown Editor",description:"View and render Markdown (.md) files",loader:()=>__vitePreload(()=>import("./md-editor-extension-BL5PAeyq.js"),__vite__mapDeps([15,1,2])),icon:"book"});extensionRegistry.registerExtension({id:"system.mediaviewer",name:"Media Viewer",description:"View PDF, image, and HTML files in the browser",loader:()=>__vitePreload(()=>import("./media-viewer-extension-D1V5YstU.js"),__vite__mapDeps([16,1,2])),icon:"image"});extensionRegistry.registerExtension({id:"system.monaco",name:"Monaco Code Editor",description:"Code editor with syntax highlighting, code completion, and Python execution support",loader:()=>__vitePreload(()=>import("./monaco-editor-extension-HjR7WT8j.js"),__vite__mapDeps([17,10,1,2,11,8])),icon:"file-pen",dependencies:["system.pythonpackagemanager"]});extensionRegistry.registerExtension({id:"system.memoryusage",name:"Memory Usage Monitor",description:"Displays JavaScript heap memory usage in the bottom toolbar",loader:()=>__vitePreload(()=>import("./memory-usage-extension-4rRqe0HI.js"),__vite__mapDeps([18,1,2])),icon:"microchip"});extensionRegistry.registerExtension({id:"system.webdav",name:"WebDAV Workspace",description:"Connect to WebDAV servers (Nextcloud, ownCloud) as workspace folders for cloud storage integration",loader:()=>__vitePreload(()=>import("./webdav-extension-be0hYr1D.js"),__vite__mapDeps([19,1,2])),icon:"cloud"});extensionRegistry.registerExtension({id:"system.settings-tree",name:"Settings Tree Editor",description:"Tree-based editor for settings with in-place editing",loader:()=>__vitePreload(()=>import("./settings-tree-extension-oPqBcqsv.js"),__vite__mapDeps([20,1,2])),icon:"sitemap"});extensionRegistry.registerExtension({id:"system.in-browser-ml",name:"In-Browser ML",description:"In-browser machine learning service using transformers.js for specialized tasks (zero-shot classification, embeddings, etc.)",loader:()=>__vitePreload(()=>import("./in-browser-ml-extension-a6QUIcCr.js"),__vite__mapDeps([21,1,2])),icon:"brain"});extensionRegistry.registerExtension({id:"system.ai-system",name:"AI System",description:"Modern AI service with streaming support and agent workflows",loader:()=>__vitePreload(()=>import("./ai-system-extension-l5k-HLf3.js"),__vite__mapDeps([22,1,2])),icon:"robot",dependencies:["system.in-browser-ml"]});extensionRegistry.registerExtension({id:"system.rag-system",name:"RAG System",description:"Retrieval-Augmented Generation system for document indexing, search and retrieval",loader:()=>__vitePreload(()=>import("./rag-system-extension-CNVAYYXa.js").then(g=>g.b),__vite__mapDeps([23,1,2])),icon:"database",experimental:!0,dependencies:["system.ai-system"]});const TOPIC_AI_STREAM_STARTED="events/aiservice/streamStarted",TOPIC_AI_STREAM_CHUNK="events/aiservice/streamChunk",TOPIC_AI_STREAM_COMPLETE="events/aiservice/streamComplete",TOPIC_AI_STREAM_ERROR="events/aiservice/streamError",TOPIC_AICONFIG_CHANGED="events/aiservice/aiConfigChanged",TOPIC_AGENT_WORKFLOW_STARTED="events/aiservice/agentWorkflowStarted",TOPIC_AGENT_WORKFLOW_COMPLETE="events/aiservice/agentWorkflowComplete",TOPIC_AGENT_WORKFLOW_ERROR="events/aiservice/agentWorkflowError",CID_AGENTS="aiservice.agents",CID_CHAT_PROVIDERS="aiservice.chatProviders",CID_PROMPT_ENHANCERS="aiservice.promptEnhancers",KEY_AI_CONFIG="aiConfig",AI_CONFIG_TEMPLATE={defaultProvider:"openai",providers:[]},MAX_TOOL_ITERATIONS=10,constants=Object.freeze(Object.defineProperty({__proto__:null,AI_CONFIG_TEMPLATE,CID_AGENTS,CID_CHAT_PROVIDERS,CID_PROMPT_ENHANCERS,KEY_AI_CONFIG,MAX_TOOL_ITERATIONS,TOPIC_AGENT_WORKFLOW_COMPLETE,TOPIC_AGENT_WORKFLOW_ERROR,TOPIC_AGENT_WORKFLOW_STARTED,TOPIC_AICONFIG_CHANGED,TOPIC_AI_STREAM_CHUNK,TOPIC_AI_STREAM_COMPLETE,TOPIC_AI_STREAM_ERROR,TOPIC_AI_STREAM_STARTED},Symbol.toStringTag,{value:"Module"}));class StreamParser{constructor(){this.decoder=new TextDecoder}*processLines(a){for(const l of a)l.trim()!==""&&(yield l)}}class SSEParser extends StreamParser{constructor(){super(...arguments),this.usage=null}async*parse(a){let l="";this.usage=null;try{for(;;){const{done:O,value:Y}=await a.read();if(O)break;l+=this.decoder.decode(Y,{stream:!0});const R=l.split(`
`);l=R.pop()||"";for(const ee of this.processLines(R))if(ee.startsWith("data: ")){const xe=ee.slice(6).trim();if(xe==="[DONE]"){const ne={type:"done",content:""};this.usage&&(ne.metadata={usage:this.usage}),yield ne;continue}try{const ne=JSON.parse(xe);if(ne.error){yield{type:"error",content:ne.error.message||"Unknown error",metadata:ne.error};continue}this.extractUsage(ne);const te=this.parseChunk(ne);te&&(yield te)}catch{continue}}}if(l.trim()&&l.startsWith("data: ")){const O=l.slice(6).trim();if(O!=="[DONE]")try{const Y=JSON.parse(O);this.extractUsage(Y);const R=this.parseChunk(Y);R&&(yield R)}catch{}}const A={type:"done",content:""};this.usage&&(A.metadata={usage:this.usage}),yield A}finally{a.releaseLock()}}extractUsage(a){if(a.usage){const l=a.usage;this.usage={promptTokens:l.prompt_tokens||0,completionTokens:l.completion_tokens||0,totalTokens:l.total_tokens||0,estimated:!1}}}parseChunk(a){const l=a.choices?.[0]?.delta,A=a.choices?.[0];if(l?.content)return{type:"token",content:l.content,message:{role:l.role||"assistant",content:A?.message?.content||l.content}};if(A?.message?.tool_calls){const O=this.parseToolCalls(A.message.tool_calls,!0);if(O.length>0)return{type:"token",content:"",toolCalls:O}}else if(l?.tool_calls||A?.delta?.tool_calls){const O=this.parseToolCalls(l?.tool_calls||A?.delta?.tool_calls||[],!1);if(O.length>0)return{type:"token",content:"",toolCalls:O}}return null}parseToolCalls(a,l=!1){return a.filter(A=>A.function!==void 0).map((A,O)=>({id:A.id||`call_${A.index!==void 0?A.index:O}_${Date.now()}`,type:"function",function:{name:A.function?.name||"",arguments:A.function?.arguments||(l?"{}":"")},_index:A.index!==void 0?A.index:O}))}}class OllamaParser extends StreamParser{constructor(){super(...arguments),this.usage=null}async*parse(a){let l="";this.usage=null;try{for(;;){const{done:O,value:Y}=await a.read();if(O)break;l+=this.decoder.decode(Y,{stream:!0});const R=l.split(`
`);l=R.pop()||"";for(const ee of this.processLines(R))try{const xe=JSON.parse(ee);if(xe.error){yield{type:"error",content:xe.error,metadata:xe};continue}if(xe.done){this.extractUsage(xe);const ne={type:"done",content:""};this.usage&&(ne.metadata={usage:this.usage}),yield ne;continue}xe.message?.content?yield{type:"token",content:xe.message.content,message:{role:xe.message.role||"assistant",content:xe.message.content}}:xe.response&&(yield{type:"token",content:xe.response,message:{role:"assistant",content:xe.response}})}catch{continue}}if(l.trim())try{const O=JSON.parse(l);O.done&&this.extractUsage(O),O.message?.content&&(yield{type:"token",content:O.message.content,message:{role:O.message.role||"assistant",content:O.message.content}})}catch{}const A={type:"done",content:""};this.usage&&(A.metadata={usage:this.usage}),yield A}finally{a.releaseLock()}}extractUsage(a){if(a.prompt_eval_count!==void 0||a.eval_count!==void 0){const l=a.prompt_eval_count||0,A=a.eval_count||0;this.usage={promptTokens:l,completionTokens:A,totalTokens:l+A,estimated:!1}}}}class BaseProvider{createParser(a,l){return a.includes("text/event-stream")||l.includes("openai")?new SSEParser:new OllamaParser}async getAvailableModels(a){if(!a.chatApiEndpoint)return[];try{const l=a.chatApiEndpoint;let A=l;if(l.includes("/v1/chat/completions"))A=l.replace("/v1/chat/completions","");else if(l.includes("/api/v1/chat/completions"))A=l.replace("/api/v1/chat/completions","");else if(l.includes("/api/chat/completion"))A=l.replace("/api/chat/completion","");else try{const ne=new URL(l);A=`${ne.protocol}//${ne.host}`}catch{return[]}const O=`${A}/v1/models`,Y={"Content-Type":"application/json"};a.apiKey&&(Y.Authorization=`Bearer ${a.apiKey}`);const R=await fetch(O,{method:"GET",headers:Y});return R.ok?((await R.json()).data||[]).map(ne=>({id:ne.id,name:ne.name||ne.id})):[]}catch{return[]}}async*stream(a){const l={model:a.model,stream:!0,messages:a.messages,...a.chatConfig.parameters};a.tools&&a.tools.length>0&&(l.tools=a.tools,l.tool_choice="auto");const A=await fetch(a.chatConfig.chatApiEndpoint,{method:"POST",headers:{Authorization:`Bearer ${a.chatConfig.apiKey}`,"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(l),signal:a.signal});if(!A.ok){const xe=await A.text().catch(()=>"Unknown error");yield{type:"error",content:`HTTP ${A.status}: ${xe}`,metadata:{status:A.status,statusText:A.statusText}};return}const O=A.headers.get("content-type")||"",Y=A.headers.get("content-length");if(!A.body){yield{type:"error",content:`Response body is null or empty (Content-Length: ${Y||"unknown"}). This may indicate: 1) The endpoint doesn't support streaming, 2) Authentication is required/invalid, 3) The endpoint URL is incorrect. For Open WebUI, ensure you're using the correct endpoint and API key.`,metadata:{status:A.status,contentType:O,contentLength:Y,endpoint:a.chatConfig.chatApiEndpoint,hasApiKey:!!a.chatConfig.apiKey}};return}const R=A.body.getReader();if(!R){yield{type:"error",content:"Response body is not readable"};return}const ee=this.createParser(O,a.chatConfig.chatApiEndpoint);try{for await(const xe of ee.parse(R))yield xe}catch(xe){yield{type:"error",content:xe instanceof Error?xe.message:"Failed to parse response stream",metadata:{error:xe,contentType:O,endpoint:a.chatConfig.chatApiEndpoint}}}}}class OpenAIProvider extends BaseProvider{constructor(){super(...arguments),this.name="openai"}canHandle(a){return a.chatApiEndpoint.includes("openai")||a.chatApiEndpoint.includes("v1/chat/completions")}}class OllamaProvider extends BaseProvider{constructor(){super(...arguments),this.name="ollama"}canHandle(a){return a.name.toLowerCase()==="ollama"||a.chatApiEndpoint.includes("ollama")||a.chatApiEndpoint.includes("localhost:11434")}}class ProviderFactory{constructor(){this.providers=[],this.registerDefaultProviders()}registerDefaultProviders(){this.providers.push(new OpenAIProvider),this.providers.push(new OllamaProvider)}registerProvider(a){this.providers.push(a)}getProvider(a){const l=this.providers.find(A=>A.canHandle(a));return l||this.providers[0]}getAllProviders(){return[...this.providers]}}class AgentRegistry{getAgentContributions(){return contributionRegistry.getContributions(CID_AGENTS)}filterAndSortAgents(a,l){return a.filter(A=>A.canHandle?A.canHandle(l):!0).sort((A,O)=>(O.priority||0)-(A.priority||0))}getMatchingAgents(a,l){const A=this.getAgentContributions();if(A.length===0)throw new Error("No agents are registered. The App Support agent should be available from the AI system extension.");let O=A.filter(Y=>l&&!l.includes(Y.role)?!1:Y.canHandle?Y.canHandle(a):!0);if(l&&l.length>0){if(O=O.sort((Y,R)=>(R.priority||0)-(Y.priority||0)),O.length===0){const Y=l.join(", ");throw new Error(`No agents found for requested roles: ${Y}. Available agents: ${A.map(R=>R.role).join(", ")}`)}}else if(O=this.filterAndSortAgents(O,a),O.length===0)throw new Error(`No agents can handle the current context. Available agents: ${A.map(Y=>Y.role).join(", ")}`);return O}}class ToolRegistry{sanitizeFunctionName(a){return a.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}commandToTool(a,l){const A={},O=[];return a.parameters?.forEach(ee=>{const xe=this.sanitizeFunctionName(ee.name);A[xe]={type:ee.type||"string",description:ee.description,...ee.allowedValues&&{enum:ee.allowedValues}},ee.required===!0&&O.push(xe)}),{type:"function",function:{name:this.sanitizeFunctionName(a.id),description:a.description||a.name,parameters:{type:"object",properties:A,required:O}}}}getAvailableTools(a,l){const A=commandRegistry.listCommands();let O=Object.values(A);return l&&(O=O.filter(Y=>l(Y,a))),O.map(Y=>this.commandToTool(Y,a))}}function dispatchCallback(g,a){g&&g(a)}function reverseDictionary(g){return Object.fromEntries(Object.entries(g).map(([a,l])=>[l,a]))}function escapeRegExp(g){return g.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Callable=class{constructor(){let g=function(...a){return g._call(...a)};return Object.setPrototypeOf(g,new.target.prototype)}_call(...g){throw Error("Must implement _call method in subclass")}};function isTypedArray(g){return g?.prototype?.__proto__?.constructor?.name==="TypedArray"}function isIntegralNumber(g){return Number.isInteger(g)||typeof g=="bigint"}function exists(g){return g!=null}function calculateDimensions(g){const a=[];let l=g;for(;Array.isArray(l);)a.push(l.length),l=l[0];return a}function pop(g,a,l=void 0){const A=g[a];if(A!==void 0)return delete g[a],A;if(l===void 0)throw Error(`Key ${a} does not exist in object.`);return l}function mergeArrays(...g){return Array.prototype.concat.apply([],g)}function product(...g){return g.reduce((a,l)=>a.flatMap(A=>l.map(O=>[A,O])))}function calculateReflectOffset(g,a){return Math.abs((g+a)%(2*a)-a)}var ortWeb_min$1={exports:{}};const backends={},backendsSortedByPriority=[],registerBackend=(g,a,l)=>{if(a&&typeof a.init=="function"&&typeof a.createSessionHandler=="function"){const A=backends[g];if(A===void 0)backends[g]={backend:a,priority:l};else{if(A.priority>l)return;if(A.priority===l&&A.backend!==a)throw new Error(`cannot register backend "${g}" using priority ${l}`)}if(l>=0){const O=backendsSortedByPriority.indexOf(g);O!==-1&&backendsSortedByPriority.splice(O,1);for(let Y=0;Y<backendsSortedByPriority.length;Y++)if(backends[backendsSortedByPriority[Y]].priority<=l){backendsSortedByPriority.splice(Y,0,g);return}backendsSortedByPriority.push(g)}return}throw new TypeError("not a valid backend")},resolveBackend=async g=>{const a=g.length===0?backendsSortedByPriority:g,l=[];for(const A of a){const O=backends[A];if(O){if(O.initialized)return O.backend;if(O.aborted)continue;const Y=!!O.initPromise;try{return Y||(O.initPromise=O.backend.init()),await O.initPromise,O.initialized=!0,O.backend}catch(R){Y||l.push({name:A,err:R}),O.aborted=!0}finally{delete O.initPromise}}}throw new Error(`no available backend found. ERR: ${l.map(A=>`[${A.name}] ${A.err}`).join(", ")}`)};class EnvImpl{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(a){if(a!==void 0){if(typeof a!="string"||["verbose","info","warning","error","fatal"].indexOf(a)===-1)throw new Error(`Unsupported logging level: ${a}`);this.logLevelInternal=a}}get logLevel(){return this.logLevelInternal}}const env$2=new EnvImpl,isBigInt64ArrayAvailable=typeof BigInt64Array<"u"&&typeof BigInt64Array.from=="function",isBigUint64ArrayAvailable=typeof BigUint64Array<"u"&&typeof BigUint64Array.from=="function",NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);isBigInt64ArrayAvailable&&(NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("int64",BigInt64Array),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigInt64Array,"int64"));isBigUint64ArrayAvailable&&(NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("uint64",BigUint64Array),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigUint64Array,"uint64"));const calculateSize=g=>{let a=1;for(let l=0;l<g.length;l++){const A=g[l];if(typeof A!="number"||!Number.isSafeInteger(A))throw new TypeError(`dims[${l}] must be an integer, got: ${A}`);if(A<0)throw new RangeError(`dims[${l}] must be a non-negative integer, got: ${A}`);a*=A}return a};let Tensor$2=class $r{constructor(a,l,A){let O,Y,R;if(typeof a=="string")if(O=a,R=A,a==="string"){if(!Array.isArray(l))throw new TypeError("A string tensor's data must be a string array.");Y=l}else{const xe=NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(a);if(xe===void 0)throw new TypeError(`Unsupported tensor type: ${a}.`);if(Array.isArray(l))Y=xe.from(l);else if(l instanceof xe)Y=l;else throw new TypeError(`A ${O} tensor's data must be type of ${xe}`)}else if(R=l,Array.isArray(a)){if(a.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const xe=typeof a[0];if(xe==="string")O="string",Y=a;else if(xe==="boolean")O="bool",Y=Uint8Array.from(a);else throw new TypeError(`Invalid element type of data array: ${xe}.`)}else{const xe=NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.get(a.constructor);if(xe===void 0)throw new TypeError(`Unsupported type for tensor data: ${a.constructor}.`);O=xe,Y=a}if(R===void 0)R=[Y.length];else if(!Array.isArray(R))throw new TypeError("A tensor's dims must be a number array");const ee=calculateSize(R);if(ee!==Y.length)throw new Error(`Tensor's size(${ee}) does not match data length(${Y.length}).`);this.dims=R,this.type=O,this.data=Y,this.size=ee}static bufferToTensor(a,l){if(a===void 0)throw new Error("Image buffer must be defined");if(l.height===void 0||l.width===void 0)throw new Error("Image height and width must be defined");const{height:A,width:O}=l,Y=l.norm;let R,ee;Y===void 0||Y.mean===void 0?R=255:R=Y.mean,Y===void 0||Y.bias===void 0?ee=0:ee=Y.bias;const xe=l.bitmapFormat!==void 0?l.bitmapFormat:"RGBA",ne=l.tensorFormat!==void 0&&l.tensorFormat!==void 0?l.tensorFormat:"RGB",te=A*O,f=ne==="RGBA"?new Float32Array(te*4):new Float32Array(te*3);let d=4,H=0,Z=1,Ye=2,et=3,tt=0,nt=te,it=te*2,ot=-1;xe==="RGB"&&(d=3,H=0,Z=1,Ye=2,et=-1),ne==="RGBA"?ot=te*3:ne==="RBG"?(tt=0,it=te,nt=te*2):ne==="BGR"&&(it=0,nt=te,tt=te*2);for(let at=0;at<te;at++,H+=d,Ye+=d,Z+=d,et+=d)f[tt++]=(a[H]+ee)/R,f[nt++]=(a[Z]+ee)/R,f[it++]=(a[Ye]+ee)/R,ot!==-1&&et!==-1&&(f[ot++]=(a[et]+ee)/R);return ne==="RGBA"?new $r("float32",f,[1,4,A,O]):new $r("float32",f,[1,3,A,O])}static async fromImage(a,l){const A=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,O=typeof ImageData<"u"&&a instanceof ImageData,Y=typeof ImageBitmap<"u"&&a instanceof ImageBitmap,R=typeof String<"u"&&(a instanceof String||typeof a=="string");let ee,xe={};if(A){const ne=document.createElement("canvas"),te=ne.getContext("2d");if(te!=null){let f=a.naturalHeight,d=a.naturalWidth;if(l!==void 0&&l.resizedHeight!==void 0&&l.resizedWidth!==void 0&&(f=l.resizedHeight,d=l.resizedWidth),l!==void 0){if(xe=l,l.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");if(xe.tensorFormat="RGBA",l.height!==void 0&&l.height!==f)throw new Error("Image input config height doesn't match HTMLImageElement height");if(xe.height=f,l.width!==void 0&&l.width!==d)throw new Error("Image input config width doesn't match HTMLImageElement width");xe.width=d}else xe.tensorFormat="RGBA",xe.height=f,xe.width=d;ne.width=d,ne.height=f,te.drawImage(a,0,0,d,f),ee=te.getImageData(0,0,d,f).data}else throw new Error("Can not access image data")}else if(O){const ne="RGBA";let te,f;if(l!==void 0&&l.resizedWidth!==void 0&&l.resizedHeight!==void 0?(te=l.resizedHeight,f=l.resizedWidth):(te=a.height,f=a.width),l!==void 0){if(xe=l,l.bitmapFormat!==void 0&&l.bitmapFormat!==ne)throw new Error("Image input config format must be RGBA for ImageData");xe.bitmapFormat="RGBA"}else xe.bitmapFormat="RGBA";if(xe.height=te,xe.width=f,l!==void 0){const d=document.createElement("canvas");d.width=f,d.height=te;const H=d.getContext("2d");if(H!=null)H.putImageData(a,0,0),ee=H.getImageData(0,0,f,te).data;else throw new Error("Can not access image data")}else ee=a.data}else if(Y){if(l===void 0)throw new Error("Please provide image config with format for Imagebitmap");if(l.bitmapFormat!==void 0)throw new Error("Image input config format must be defined for ImageBitmap");const ne=document.createElement("canvas").getContext("2d");if(ne!=null){const te=a.height,f=a.width;if(ne.drawImage(a,0,0,f,te),ee=ne.getImageData(0,0,f,te).data,l!==void 0){if(l.height!==void 0&&l.height!==te)throw new Error("Image input config height doesn't match ImageBitmap height");if(xe.height=te,l.width!==void 0&&l.width!==f)throw new Error("Image input config width doesn't match ImageBitmap width");xe.width=f}else xe.height=te,xe.width=f;return $r.bufferToTensor(ee,xe)}else throw new Error("Can not access image data")}else{if(R)return new Promise((ne,te)=>{const f=document.createElement("canvas"),d=f.getContext("2d");if(!a||!d)return te();const H=new Image;H.crossOrigin="Anonymous",H.src=a,H.onload=()=>{f.width=H.width,f.height=H.height,d.drawImage(H,0,0,f.width,f.height);const Z=d.getImageData(0,0,f.width,f.height);if(l!==void 0){if(l.height!==void 0&&l.height!==f.height)throw new Error("Image input config height doesn't match ImageBitmap height");if(xe.height=f.height,l.width!==void 0&&l.width!==f.width)throw new Error("Image input config width doesn't match ImageBitmap width");xe.width=f.width}else xe.height=f.height,xe.width=f.width;ne($r.bufferToTensor(Z.data,xe))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(ee!==void 0)return $r.bufferToTensor(ee,xe);throw new Error("Input data provided is not supported - aborted tensor creation")}toImageData(a){var l,A;const O=document.createElement("canvas").getContext("2d");let Y;if(O!=null){const R=this.dims[3],ee=this.dims[2],xe=this.dims[1],ne=a!==void 0&&a.format!==void 0?a.format:"RGB",te=a!==void 0&&((l=a.norm)===null||l===void 0?void 0:l.mean)!==void 0?a.norm.mean:255,f=a!==void 0&&((A=a.norm)===null||A===void 0?void 0:A.bias)!==void 0?a.norm.bias:0,d=ee*R;if(a!==void 0){if(a.height!==void 0&&a.height!==ee)throw new Error("Image output config height doesn't match tensor height");if(a.width!==void 0&&a.width!==R)throw new Error("Image output config width doesn't match tensor width");if(a.format!==void 0&&xe===4&&a.format!=="RGBA"||xe===3&&a.format!=="RGB"&&a.format!=="BGR")throw new Error("Tensor format doesn't match input tensor dims")}const H=4;let Z=0,Ye=1,et=2,tt=3,nt=0,it=d,ot=d*2,st=-1;ne==="RGBA"?(nt=0,it=d,ot=d*2,st=d*3):ne==="RGB"?(nt=0,it=d,ot=d*2):ne==="RBG"&&(nt=0,ot=d,it=d*2),Y=O.createImageData(R,ee);for(let at=0;at<ee*R;Z+=H,Ye+=H,et+=H,tt+=H,at++)Y.data[Z]=(this.data[nt++]-f)*te,Y.data[Ye]=(this.data[it++]-f)*te,Y.data[et]=(this.data[ot++]-f)*te,Y.data[tt]=st===-1?255:(this.data[st++]-f)*te}else throw new Error("Can not access image data");return Y}reshape(a){return new $r(this.type,this.data,a)}};const Tensor$1=Tensor$2;let InferenceSession$2=class Qr{constructor(a){this.handler=a}async run(a,l,A){const O={};let Y={};if(typeof a!="object"||a===null||a instanceof Tensor$1||Array.isArray(a))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let R=!0;if(typeof l=="object"){if(l===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(l instanceof Tensor$1)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(l)){if(l.length===0)throw new TypeError("'fetches' cannot be an empty array.");R=!1;for(const ne of l){if(typeof ne!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(ne)===-1)throw new RangeError(`'fetches' contains invalid output name: ${ne}.`);O[ne]=null}if(typeof A=="object"&&A!==null)Y=A;else if(typeof A<"u")throw new TypeError("'options' must be an object.")}else{let ne=!1;const te=Object.getOwnPropertyNames(l);for(const f of this.outputNames)if(te.indexOf(f)!==-1){const d=l[f];(d===null||d instanceof Tensor$1)&&(ne=!0,R=!1,O[f]=d)}if(ne){if(typeof A=="object"&&A!==null)Y=A;else if(typeof A<"u")throw new TypeError("'options' must be an object.")}else Y=l}}else if(typeof l<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const ne of this.inputNames)if(typeof a[ne]>"u")throw new Error(`input '${ne}' is missing in 'feeds'.`);if(R)for(const ne of this.outputNames)O[ne]=null;const ee=await this.handler.run(a,O,Y),xe={};for(const ne in ee)Object.hasOwnProperty.call(ee,ne)&&(xe[ne]=new Tensor$1(ee[ne].type,ee[ne].data,ee[ne].dims));return xe}static async create(a,l,A,O){let Y,R={};if(typeof a=="string"){if(Y=a,typeof l=="object"&&l!==null)R=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof Uint8Array){if(Y=a,typeof l=="object"&&l!==null)R=l;else if(typeof l<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&a instanceof SharedArrayBuffer){const f=a;let d=0,H=a.byteLength;if(typeof l=="object"&&l!==null)R=l;else if(typeof l=="number"){if(d=l,!Number.isSafeInteger(d))throw new RangeError("'byteOffset' must be an integer.");if(d<0||d>=f.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${f.byteLength}).`);if(H=a.byteLength-d,typeof A=="number"){if(H=A,!Number.isSafeInteger(H))throw new RangeError("'byteLength' must be an integer.");if(H<=0||d+H>f.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${f.byteLength-d}].`);if(typeof O=="object"&&O!==null)R=O;else if(typeof O<"u")throw new TypeError("'options' must be an object.")}else if(typeof A<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof l<"u")throw new TypeError("'options' must be an object.");Y=new Uint8Array(f,d,H)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const xe=(R.executionProviders||[]).map(f=>typeof f=="string"?f:f.name),te=await(await resolveBackend(xe)).createSessionHandler(Y,R);return new Qr(te)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const InferenceSession$1=InferenceSession$2,lib=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:InferenceSession$1,Tensor:Tensor$1,env:env$2,registerBackend},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(lib);var hasRequiredOrtWeb_min;function requireOrtWeb_min(){return hasRequiredOrtWeb_min||(hasRequiredOrtWeb_min=1,(function(module,exports){(function(g,a){module.exports=a(require$$0)})(self,(__WEBPACK_EXTERNAL_MODULE__1670__=>(()=>{var __webpack_modules__={3474:(g,a,l)=>{var A,O=(A=(A=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(Y){function R(){return Ft.buffer!=dn&&pn(Ft.buffer),Pt}function ee(){return Ft.buffer!=dn&&pn(Ft.buffer),$t}function xe(){return Ft.buffer!=dn&&pn(Ft.buffer),hn}function ne(){return Ft.buffer!=dn&&pn(Ft.buffer),_n}function te(){return Ft.buffer!=dn&&pn(Ft.buffer),On}var f,d,H;Y=Y||{},f||(f=Y!==void 0?Y:{}),f.ready=new Promise((function(dt,mt){d=dt,H=mt}));var Z,Ye,et,tt,nt,it,ot=Object.assign({},f),st="./this.program",at=(dt,mt)=>{throw mt},ct=typeof window=="object",ft=typeof importScripts=="function",ut=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",_t=f.ENVIRONMENT_IS_PTHREAD||!1,At="";function Et(dt){return f.locateFile?f.locateFile(dt,At):At+dt}if(ut){let dt;At=ft?l(908).dirname(At)+"/":"//",it=()=>{nt||(tt=l(1384),nt=l(908))},Z=function(mt,vt){return it(),mt=nt.normalize(mt),tt.readFileSync(mt,vt?void 0:"utf8")},et=mt=>((mt=Z(mt,!0)).buffer||(mt=new Uint8Array(mt)),mt),Ye=(mt,vt,It)=>{it(),mt=nt.normalize(mt),tt.readFile(mt,(function(Lt,jt){Lt?It(Lt):vt(jt.buffer)}))},1<process.argv.length&&(st=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(mt){if(!(mt instanceof Gn))throw mt})),process.on("unhandledRejection",(function(mt){throw mt})),at=(mt,vt)=>{if(kn())throw process.exitCode=mt,vt;vt instanceof Gn||St("exiting due to exception: "+vt),process.exit(mt)},f.inspect=function(){return"[Emscripten Module object]"};try{dt=l(9925)}catch(mt){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),mt}l.g.Worker=dt.Worker}else(ct||ft)&&(ft?At=self.location.href:typeof document<"u"&&document.currentScript&&(At=document.currentScript.src),A&&(At=A),At=At.indexOf("blob:")!==0?At.substr(0,At.replace(/[?#].*/,"").lastIndexOf("/")+1):"",ut||(Z=dt=>{var mt=new XMLHttpRequest;return mt.open("GET",dt,!1),mt.send(null),mt.responseText},ft&&(et=dt=>{var mt=new XMLHttpRequest;return mt.open("GET",dt,!1),mt.responseType="arraybuffer",mt.send(null),new Uint8Array(mt.response)}),Ye=(dt,mt,vt)=>{var It=new XMLHttpRequest;It.open("GET",dt,!0),It.responseType="arraybuffer",It.onload=()=>{It.status==200||It.status==0&&It.response?mt(It.response):vt()},It.onerror=vt,It.send(null)}));ut&&typeof performance>"u"&&(l.g.performance=l(6953).performance);var Mt=console.log.bind(console),Ot=console.warn.bind(console);ut&&(it(),Mt=dt=>tt.writeSync(1,dt+`
`),Ot=dt=>tt.writeSync(2,dt+`
`));var kt,yt=f.print||Mt,St=f.printErr||Ot;Object.assign(f,ot),ot=null,f.thisProgram&&(st=f.thisProgram),f.quit&&(at=f.quit),f.wasmBinary&&(kt=f.wasmBinary);var Yt=f.noExitRuntime||!1;typeof WebAssembly!="object"&&nn("no native wasm support detected");var Ft,ln,dn,Pt,$t,hn,_n,On,En=!1,qt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Jt(dt,mt,vt){var It=(mt>>>=0)+vt;for(vt=mt;dt[vt]&&!(vt>=It);)++vt;if(16<vt-mt&&dt.buffer&&qt)return qt.decode(dt.buffer instanceof SharedArrayBuffer?dt.slice(mt,vt):dt.subarray(mt,vt));for(It="";mt<vt;){var Lt=dt[mt++];if(128&Lt){var jt=63&dt[mt++];if((224&Lt)==192)It+=String.fromCharCode((31&Lt)<<6|jt);else{var on=63&dt[mt++];65536>(Lt=(240&Lt)==224?(15&Lt)<<12|jt<<6|on:(7&Lt)<<18|jt<<12|on<<6|63&dt[mt++])?It+=String.fromCharCode(Lt):(Lt-=65536,It+=String.fromCharCode(55296|Lt>>10,56320|1023&Lt))}}else It+=String.fromCharCode(Lt)}return It}function Wt(dt,mt){return(dt>>>=0)?Jt(ee(),dt,mt):""}function un(dt,mt,vt,It){if(!(0<It))return 0;var Lt=vt>>>=0;It=vt+It-1;for(var jt=0;jt<dt.length;++jt){var on=dt.charCodeAt(jt);if(55296<=on&&57343>=on&&(on=65536+((1023&on)<<10)|1023&dt.charCodeAt(++jt)),127>=on){if(vt>=It)break;mt[vt++>>>0]=on}else{if(2047>=on){if(vt+1>=It)break;mt[vt++>>>0]=192|on>>6}else{if(65535>=on){if(vt+2>=It)break;mt[vt++>>>0]=224|on>>12}else{if(vt+3>=It)break;mt[vt++>>>0]=240|on>>18,mt[vt++>>>0]=128|on>>12&63}mt[vt++>>>0]=128|on>>6&63}mt[vt++>>>0]=128|63&on}}return mt[vt>>>0]=0,vt-Lt}function fn(dt){for(var mt=0,vt=0;vt<dt.length;++vt){var It=dt.charCodeAt(vt);127>=It?mt++:2047>=It?mt+=2:55296<=It&&57343>=It?(mt+=4,++vt):mt+=3}return mt}function pn(dt){dn=dt,f.HEAP8=Pt=new Int8Array(dt),f.HEAP16=new Int16Array(dt),f.HEAP32=hn=new Int32Array(dt),f.HEAPU8=$t=new Uint8Array(dt),f.HEAPU16=new Uint16Array(dt),f.HEAPU32=_n=new Uint32Array(dt),f.HEAPF32=new Float32Array(dt),f.HEAPF64=On=new Float64Array(dt)}_t&&(dn=f.buffer);var Zt=f.INITIAL_MEMORY||16777216;if(_t)Ft=f.wasmMemory,dn=f.buffer;else if(f.wasmMemory)Ft=f.wasmMemory;else if(!((Ft=new WebAssembly.Memory({initial:Zt/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw St("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),ut&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");Ft&&(dn=Ft.buffer),Zt=dn.byteLength,pn(dn);var mn,Tn=[],$n=[],Un=[],In=[];function kn(){return Yt||!1}function Kt(){var dt=f.preRun.shift();Tn.unshift(dt)}var Dt,Qt=0,cn=null;function nn(dt){throw _t?postMessage({cmd:"onAbort",arg:dt}):f.onAbort&&f.onAbort(dt),St(dt="Aborted("+dt+")"),En=!0,dt=new WebAssembly.RuntimeError(dt+". Build with -sASSERTIONS for more info."),H(dt),dt}function gn(){return Dt.startsWith("data:application/octet-stream;base64,")}function Cn(){var dt=Dt;try{if(dt==Dt&&kt)return new Uint8Array(kt);if(et)return et(dt);throw"both async and sync fetching of the wasm failed"}catch(mt){nn(mt)}}Dt="ort-wasm-threaded.wasm",gn()||(Dt=Et(Dt));var Fn={};function Gn(dt){this.name="ExitStatus",this.message="Program terminated with exit("+dt+")",this.status=dt}function Zn(dt){(dt=Nn.Vb[dt])||nn(),Nn.mc(dt)}function cr(dt){var mt=Nn.Cc();if(!mt)return 6;Nn.ac.push(mt),Nn.Vb[dt.Ub]=mt,mt.Ub=dt.Ub;var vt={cmd:"run",start_routine:dt.Ic,arg:dt.zc,pthread_ptr:dt.Ub};return mt.$b=()=>{vt.time=performance.now(),mt.postMessage(vt,dt.Nc)},mt.loaded&&(mt.$b(),delete mt.$b),0}function bn(dt){if(_t)return Sn(1,1,dt);kn()||(Nn.oc(),f.onExit&&f.onExit(dt),En=!0),at(dt,new Gn(dt))}function vr(dt,mt){if(!mt&&_t)throw wr(dt),"unwind";kn()||_t||(Ar(),ur(Un),Cr(0),gr[1].length&&rr(1,10),gr[2].length&&rr(2,10),Nn.oc()),bn(dt)}var Nn={Yb:[],ac:[],qc:[],Vb:{},fc:function(){_t&&Nn.Ec()},Pc:function(){},Ec:function(){Nn.receiveObjectTransfer=Nn.Gc,Nn.threadInitTLS=Nn.pc,Nn.setExitStatus=Nn.nc,Yt=!1},nc:function(){},oc:function(){for(var dt of Object.values(Nn.Vb))Nn.mc(dt);for(dt of Nn.Yb)dt.terminate();Nn.Yb=[]},mc:function(dt){var mt=dt.Ub;delete Nn.Vb[mt],Nn.Yb.push(dt),Nn.ac.splice(Nn.ac.indexOf(dt),1),dt.Ub=0,Rr(mt)},Gc:function(){},pc:function(){Nn.qc.forEach((dt=>dt()))},Fc:function(dt,mt){dt.onmessage=vt=>{var It=(vt=vt.data).cmd;if(dt.Ub&&(Nn.Bc=dt.Ub),vt.targetThread&&vt.targetThread!=Pr()){var Lt=Nn.Vb[vt.Qc];Lt?Lt.postMessage(vt,vt.transferList):St('Internal error! Worker sent a message "'+It+'" to target pthread '+vt.targetThread+", but that thread no longer exists!")}else It==="processProxyingQueue"?Vt(vt.queue):It==="spawnThread"?cr(vt):It==="cleanupThread"?Zn(vt.thread):It==="killThread"?(vt=vt.thread,It=Nn.Vb[vt],delete Nn.Vb[vt],It.terminate(),Rr(vt),Nn.ac.splice(Nn.ac.indexOf(It),1),It.Ub=0):It==="cancelThread"?Nn.Vb[vt.thread].postMessage({cmd:"cancel"}):It==="loaded"?(dt.loaded=!0,mt&&mt(dt),dt.$b&&(dt.$b(),delete dt.$b)):It==="print"?yt("Thread "+vt.threadId+": "+vt.text):It==="printErr"?St("Thread "+vt.threadId+": "+vt.text):It==="alert"?alert("Thread "+vt.threadId+": "+vt.text):vt.target==="setimmediate"?dt.postMessage(vt):It==="onAbort"?f.onAbort&&f.onAbort(vt.arg):It&&St("worker sent an unknown command "+It);Nn.Bc=void 0},dt.onerror=vt=>{throw St("worker sent an error! "+vt.filename+":"+vt.lineno+": "+vt.message),vt},ut&&(dt.on("message",(function(vt){dt.onmessage({data:vt})})),dt.on("error",(function(vt){dt.onerror(vt)})),dt.on("detachedExit",(function(){}))),dt.postMessage({cmd:"load",urlOrBlob:f.mainScriptUrlOrBlob||A,wasmMemory:Ft,wasmModule:ln})},yc:function(){var dt=Et("ort-wasm-threaded.worker.js");Nn.Yb.push(new Worker(dt))},Cc:function(){return Nn.Yb.length==0&&(Nn.yc(),Nn.Fc(Nn.Yb[0])),Nn.Yb.pop()}};function ur(dt){for(;0<dt.length;)dt.shift()(f)}function ir(dt){var mt=Kn();return dt=dt(),Wn(mt),dt}function wr(dt){if(_t)return Sn(2,0,dt);try{vr(dt)}catch(mt){mt instanceof Gn||mt=="unwind"||at(1,mt)}}f.PThread=Nn,f.establishStackSpace=function(){var dt=Pr(),mt=xe()[dt+44>>2>>>0];dt=xe()[dt+48>>2>>>0],Ur(mt,mt-dt),Wn(mt)};var jn=[];function xt(dt){var mt=jn[dt];return mt||(dt>=jn.length&&(jn.length=dt+1),jn[dt]=mt=mn.get(dt)),mt}f.invokeEntryPoint=function(dt,mt){dt=xt(dt)(mt),kn()?Nn.nc(dt):Br(dt)};var zt,Ut,pt=[],gt=0,wt=0;function Rt(dt){this.Zb=dt,this.Sb=dt-24,this.xc=function(mt){ne()[this.Sb+4>>2>>>0]=mt},this.bc=function(){return ne()[this.Sb+4>>2>>>0]},this.wc=function(mt){ne()[this.Sb+8>>2>>>0]=mt},this.Dc=function(){return ne()[this.Sb+8>>2>>>0]},this.rc=function(){xe()[this.Sb>>2>>>0]=0},this.hc=function(mt){mt=mt?1:0,R()[this.Sb+12>>0>>>0]=mt},this.uc=function(){return R()[this.Sb+12>>0>>>0]!=0},this.ic=function(mt){mt=mt?1:0,R()[this.Sb+13>>0>>>0]=mt},this.kc=function(){return R()[this.Sb+13>>0>>>0]!=0},this.fc=function(mt,vt){this.cc(0),this.xc(mt),this.wc(vt),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(xe(),this.Sb>>2,1)},this.Hc=function(){return Atomics.sub(xe(),this.Sb>>2,1)===1},this.cc=function(mt){ne()[this.Sb+16>>2>>>0]=mt},this.tc=function(){return ne()[this.Sb+16>>2>>>0]},this.vc=function(){if(Wr(this.bc()))return ne()[this.Zb>>2>>>0];var mt=this.tc();return mt!==0?mt:this.Zb}}function Bt(dt){return Mr(new Rt(dt).Sb)}function tn(dt,mt,vt,It){return _t?Sn(3,1,dt,mt,vt,It):yn(dt,mt,vt,It)}function yn(dt,mt,vt,It){if(typeof SharedArrayBuffer>"u")return St("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var Lt=[];return _t&&Lt.length===0?tn(dt,mt,vt,It):(dt={Ic:vt,Ub:dt,zc:It,Nc:Lt},_t?(dt.Oc="spawnThread",postMessage(dt,Lt),0):cr(dt))}function An(dt,mt,vt){return _t?Sn(4,1,dt,mt,vt):0}function Mn(dt,mt){if(_t)return Sn(5,1,dt,mt)}function Xn(dt,mt){if(_t)return Sn(6,1,dt,mt)}function zn(dt,mt,vt){if(_t)return Sn(7,1,dt,mt,vt)}function Jn(dt,mt,vt){return _t?Sn(8,1,dt,mt,vt):0}function Hn(dt,mt){if(_t)return Sn(9,1,dt,mt)}function ar(dt,mt,vt){if(_t)return Sn(10,1,dt,mt,vt)}function Vn(dt,mt,vt,It){if(_t)return Sn(11,1,dt,mt,vt,It)}function sr(dt,mt,vt,It){if(_t)return Sn(12,1,dt,mt,vt,It)}function _r(dt,mt,vt,It){if(_t)return Sn(13,1,dt,mt,vt,It)}function er(dt){if(_t)return Sn(14,1,dt)}function Tt(dt,mt){if(_t)return Sn(15,1,dt,mt)}function Nt(dt,mt,vt){if(_t)return Sn(16,1,dt,mt,vt)}function Vt(dt){Atomics.store(xe(),dt>>2,1),Pr()&&zr(dt),Atomics.compareExchange(xe(),dt>>2,1,0)}function Ht(dt){return ne()[dt>>>2]+4294967296*xe()[dt+4>>>2]}function Xt(dt,mt,vt,It,Lt,jt){return _t?Sn(17,1,dt,mt,vt,It,Lt,jt):-52}function sn(dt,mt,vt,It,Lt,jt){if(_t)return Sn(18,1,dt,mt,vt,It,Lt,jt)}function vn(dt){var mt=fn(dt)+1,vt=mr(mt);return vt&&un(dt,R(),vt,mt),vt}function Dn(dt,mt,vt){function It(Rn){return(Rn=Rn.toTimeString().match(/\(([A-Za-z ]+)\)$/))?Rn[1]:"GMT"}if(_t)return Sn(19,1,dt,mt,vt);var Lt=new Date().getFullYear(),jt=new Date(Lt,0,1),on=new Date(Lt,6,1);Lt=jt.getTimezoneOffset();var wn=on.getTimezoneOffset(),Ln=Math.max(Lt,wn);xe()[dt>>2>>>0]=60*Ln,xe()[mt>>2>>>0]=+(Lt!=wn),dt=It(jt),mt=It(on),dt=vn(dt),mt=vn(mt),wn<Lt?(ne()[vt>>2>>>0]=dt,ne()[vt+4>>2>>>0]=mt):(ne()[vt>>2>>>0]=mt,ne()[vt+4>>2>>>0]=dt)}function Sn(dt,mt){var vt=arguments.length-2,It=arguments;return ir((()=>{for(var Lt=jr(8*vt),jt=Lt>>3,on=0;on<vt;on++){var wn=It[2+on];te()[jt+on>>>0]=wn}return qr(dt,vt,Lt,mt)}))}f.executeNotifiedProxyingQueue=Vt,Ut=ut?()=>{var dt=process.hrtime();return 1e3*dt[0]+dt[1]/1e6}:_t?()=>performance.now()-f.__performance_now_clock_drift:()=>performance.now();var xn,Bn=[],lr={};function fr(){if(!xn){var dt,mt={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:st||"./this.program"};for(dt in lr)lr[dt]===void 0?delete mt[dt]:mt[dt]=lr[dt];var vt=[];for(dt in mt)vt.push(dt+"="+mt[dt]);xn=vt}return xn}function en(dt,mt){if(_t)return Sn(20,1,dt,mt);var vt=0;return fr().forEach((function(It,Lt){var jt=mt+vt;for(Lt=ne()[dt+4*Lt>>2>>>0]=jt,jt=0;jt<It.length;++jt)R()[Lt++>>0>>>0]=It.charCodeAt(jt);R()[Lt>>0>>>0]=0,vt+=It.length+1})),0}function qn(dt,mt){if(_t)return Sn(21,1,dt,mt);var vt=fr();ne()[dt>>2>>>0]=vt.length;var It=0;return vt.forEach((function(Lt){It+=Lt.length+1})),ne()[mt>>2>>>0]=It,0}function nr(dt){return _t?Sn(22,1,dt):52}function Pn(dt,mt,vt,It){return _t?Sn(23,1,dt,mt,vt,It):52}function Qn(dt,mt,vt,It,Lt){return _t?Sn(24,1,dt,mt,vt,It,Lt):70}var gr=[null,[],[]];function rr(dt,mt){var vt=gr[dt];mt===0||mt===10?((dt===1?yt:St)(Jt(vt,0)),vt.length=0):vt.push(mt)}function xr(dt,mt,vt,It){if(_t)return Sn(25,1,dt,mt,vt,It);for(var Lt=0,jt=0;jt<vt;jt++){var on=ne()[mt>>2>>>0],wn=ne()[mt+4>>2>>>0];mt+=8;for(var Ln=0;Ln<wn;Ln++)rr(dt,ee()[on+Ln>>>0]);Lt+=wn}return ne()[It>>2>>>0]=Lt,0}var dr=0;function yr(dt){return dt%4==0&&(dt%100!=0||dt%400==0)}var pr=[31,29,31,30,31,30,31,31,30,31,30,31],Tr=[31,28,31,30,31,30,31,31,30,31,30,31];function Er(dt,mt,vt,It){function Lt(an,tr,br){for(an=typeof an=="number"?an.toString():an||"";an.length<tr;)an=br[0]+an;return an}function jt(an,tr){return Lt(an,tr,"0")}function on(an,tr){function br(Fr){return 0>Fr?-1:0<Fr?1:0}var Nr;return(Nr=br(an.getFullYear()-tr.getFullYear()))===0&&(Nr=br(an.getMonth()-tr.getMonth()))===0&&(Nr=br(an.getDate()-tr.getDate())),Nr}function wn(an){switch(an.getDay()){case 0:return new Date(an.getFullYear()-1,11,29);case 1:return an;case 2:return new Date(an.getFullYear(),0,3);case 3:return new Date(an.getFullYear(),0,2);case 4:return new Date(an.getFullYear(),0,1);case 5:return new Date(an.getFullYear()-1,11,31);case 6:return new Date(an.getFullYear()-1,11,30)}}function Ln(an){var tr=an.Wb;for(an=new Date(new Date(an.Xb+1900,0,1).getTime());0<tr;){var br=an.getMonth(),Nr=(yr(an.getFullYear())?pr:Tr)[br];if(!(tr>Nr-an.getDate())){an.setDate(an.getDate()+tr);break}tr-=Nr-an.getDate()+1,an.setDate(1),11>br?an.setMonth(br+1):(an.setMonth(0),an.setFullYear(an.getFullYear()+1))}return br=new Date(an.getFullYear()+1,0,4),tr=wn(new Date(an.getFullYear(),0,4)),br=wn(br),0>=on(tr,an)?0>=on(br,an)?an.getFullYear()+1:an.getFullYear():an.getFullYear()-1}var Rn=xe()[It+40>>2>>>0];for(var or in It={Lc:xe()[It>>2>>>0],Kc:xe()[It+4>>2>>>0],dc:xe()[It+8>>2>>>0],jc:xe()[It+12>>2>>>0],ec:xe()[It+16>>2>>>0],Xb:xe()[It+20>>2>>>0],Tb:xe()[It+24>>2>>>0],Wb:xe()[It+28>>2>>>0],Rc:xe()[It+32>>2>>>0],Jc:xe()[It+36>>2>>>0],Mc:Rn?Wt(Rn):""},vt=Wt(vt),Rn={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})vt=vt.replace(new RegExp(or,"g"),Rn[or]);var Ir="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),kr="January February March April May June July August September October November December".split(" ");for(or in Rn={"%a":function(an){return Ir[an.Tb].substring(0,3)},"%A":function(an){return Ir[an.Tb]},"%b":function(an){return kr[an.ec].substring(0,3)},"%B":function(an){return kr[an.ec]},"%C":function(an){return jt((an.Xb+1900)/100|0,2)},"%d":function(an){return jt(an.jc,2)},"%e":function(an){return Lt(an.jc,2," ")},"%g":function(an){return Ln(an).toString().substring(2)},"%G":function(an){return Ln(an)},"%H":function(an){return jt(an.dc,2)},"%I":function(an){return(an=an.dc)==0?an=12:12<an&&(an-=12),jt(an,2)},"%j":function(an){for(var tr=0,br=0;br<=an.ec-1;tr+=(yr(an.Xb+1900)?pr:Tr)[br++]);return jt(an.jc+tr,3)},"%m":function(an){return jt(an.ec+1,2)},"%M":function(an){return jt(an.Kc,2)},"%n":function(){return`
`},"%p":function(an){return 0<=an.dc&&12>an.dc?"AM":"PM"},"%S":function(an){return jt(an.Lc,2)},"%t":function(){return"	"},"%u":function(an){return an.Tb||7},"%U":function(an){return jt(Math.floor((an.Wb+7-an.Tb)/7),2)},"%V":function(an){var tr=Math.floor((an.Wb+7-(an.Tb+6)%7)/7);if(2>=(an.Tb+371-an.Wb-2)%7&&tr++,tr)tr==53&&((br=(an.Tb+371-an.Wb)%7)==4||br==3&&yr(an.Xb)||(tr=1));else{tr=52;var br=(an.Tb+7-an.Wb-1)%7;(br==4||br==5&&yr(an.Xb%400-1))&&tr++}return jt(tr,2)},"%w":function(an){return an.Tb},"%W":function(an){return jt(Math.floor((an.Wb+7-(an.Tb+6)%7)/7),2)},"%y":function(an){return(an.Xb+1900).toString().substring(2)},"%Y":function(an){return an.Xb+1900},"%z":function(an){var tr=0<=(an=an.Jc);return an=Math.abs(an)/60,(tr?"+":"-")+("0000"+(an/60*100+an%60)).slice(-4)},"%Z":function(an){return an.Mc},"%%":function(){return"%"}},vt=vt.replace(/%%/g,"\0\0"),Rn)vt.includes(or)&&(vt=vt.replace(new RegExp(or,"g"),Rn[or](It)));return or=(function(an){var tr=Array(fn(an)+1);return un(an,tr,0,tr.length),tr})(vt=vt.replace(/\0\0/g,"%")),or.length>mt?0:((function(an,tr){R().set(an,tr>>>0)})(or,dt),or.length-1)}Nn.fc();var hr=[null,bn,wr,tn,An,Mn,Xn,zn,Jn,Hn,ar,Vn,sr,_r,er,Tt,Nt,Xt,sn,Dn,en,qn,nr,Pn,Qn,xr],Sr={b:function(dt){return mr(dt+24)+24},n:function(dt){return(dt=new Rt(dt)).uc()||(dt.hc(!0),gt--),dt.ic(!1),pt.push(dt),dt.sc(),dt.vc()},ma:function(dt){throw St("Unexpected exception thrown, this is not properly supported - aborting"),En=!0,dt},x:function(){Yn(0);var dt=pt.pop();if(dt.Hc()&&!dt.kc()){var mt=dt.Dc();mt&&xt(mt)(dt.Zb),Bt(dt.Zb)}wt=0},e:function(){var dt=wt;if(!dt)return dr=0;var mt=new Rt(dt);mt.cc(dt);var vt=mt.bc();if(!vt)return dr=0,dt;for(var It=Array.prototype.slice.call(arguments),Lt=0;Lt<It.length;Lt++){var jt=It[Lt];if(jt===0||jt===vt)break;if(Lr(jt,vt,mt.Sb+16))return dr=jt,dt}return dr=vt,dt},l:function(){var dt=wt;if(!dt)return dr=0;var mt=new Rt(dt);mt.cc(dt);var vt=mt.bc();if(!vt)return dr=0,dt;for(var It=Array.prototype.slice.call(arguments),Lt=0;Lt<It.length;Lt++){var jt=It[Lt];if(jt===0||jt===vt)break;if(Lr(jt,vt,mt.Sb+16))return dr=jt,dt}return dr=vt,dt},h:function(){var dt=wt;if(!dt)return dr=0;var mt=new Rt(dt);mt.cc(dt);var vt=mt.bc();if(!vt)return dr=0,dt;for(var It=Array.prototype.slice.call(arguments),Lt=0;Lt<It.length;Lt++){var jt=It[Lt];if(jt===0||jt===vt)break;if(Lr(jt,vt,mt.Sb+16))return dr=jt,dt}return dr=vt,dt},t:Bt,M:function(){var dt=pt.pop();dt||nn("no exception to throw");var mt=dt.Zb;throw dt.kc()||(pt.push(dt),dt.ic(!0),dt.hc(!1),gt++),wt=mt,mt},c:function(dt,mt,vt){throw new Rt(dt).fc(mt,vt),wt=dt,gt++,dt},pa:function(){return gt},Fa:function(dt){Dr(dt,!ft,1,!ct),Nn.pc()},T:function(dt){_t?postMessage({cmd:"cleanupThread",thread:dt}):Zn(dt)},xa:yn,j:function(dt){throw wt||(wt=dt),dt},H:An,Ma:Mn,ua:Xn,wa:zn,oa:Jn,Ka:Hn,Ca:ar,Ja:Vn,V:sr,va:_r,sa:er,La:Tt,ta:Nt,Ta:function(){},X:function(){nn("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){nn("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(dt,mt,vt,It){if(dt==mt)setTimeout((()=>Vt(It)));else if(_t)postMessage({targetThread:dt,cmd:"processProxyingQueue",queue:It});else{if(!(dt=Nn.Vb[dt]))return;dt.postMessage({cmd:"processProxyingQueue",queue:It})}return 1},Ea:function(){return-1},Pa:function(dt,mt){dt=new Date(1e3*Ht(dt)),xe()[mt>>2>>>0]=dt.getUTCSeconds(),xe()[mt+4>>2>>>0]=dt.getUTCMinutes(),xe()[mt+8>>2>>>0]=dt.getUTCHours(),xe()[mt+12>>2>>>0]=dt.getUTCDate(),xe()[mt+16>>2>>>0]=dt.getUTCMonth(),xe()[mt+20>>2>>>0]=dt.getUTCFullYear()-1900,xe()[mt+24>>2>>>0]=dt.getUTCDay(),dt=(dt.getTime()-Date.UTC(dt.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,xe()[mt+28>>2>>>0]=dt},Qa:function(dt,mt){dt=new Date(1e3*Ht(dt)),xe()[mt>>2>>>0]=dt.getSeconds(),xe()[mt+4>>2>>>0]=dt.getMinutes(),xe()[mt+8>>2>>>0]=dt.getHours(),xe()[mt+12>>2>>>0]=dt.getDate(),xe()[mt+16>>2>>>0]=dt.getMonth(),xe()[mt+20>>2>>>0]=dt.getFullYear()-1900,xe()[mt+24>>2>>>0]=dt.getDay();var vt=new Date(dt.getFullYear(),0,1),It=(dt.getTime()-vt.getTime())/864e5|0;xe()[mt+28>>2>>>0]=It,xe()[mt+36>>2>>>0]=-60*dt.getTimezoneOffset(),It=new Date(dt.getFullYear(),6,1).getTimezoneOffset(),dt=0|(It!=(vt=vt.getTimezoneOffset())&&dt.getTimezoneOffset()==Math.min(vt,It)),xe()[mt+32>>2>>>0]=dt},Ra:function(dt){var mt=new Date(xe()[dt+20>>2>>>0]+1900,xe()[dt+16>>2>>>0],xe()[dt+12>>2>>>0],xe()[dt+8>>2>>>0],xe()[dt+4>>2>>>0],xe()[dt>>2>>>0],0),vt=xe()[dt+32>>2>>>0],It=mt.getTimezoneOffset(),Lt=new Date(mt.getFullYear(),0,1),jt=new Date(mt.getFullYear(),6,1).getTimezoneOffset(),on=Lt.getTimezoneOffset(),wn=Math.min(on,jt);return 0>vt?xe()[dt+32>>2>>>0]=+(jt!=on&&wn==It):0<vt!=(wn==It)&&(jt=Math.max(on,jt),mt.setTime(mt.getTime()+6e4*((0<vt?wn:jt)-It))),xe()[dt+24>>2>>>0]=mt.getDay(),vt=(mt.getTime()-Lt.getTime())/864e5|0,xe()[dt+28>>2>>>0]=vt,xe()[dt>>2>>>0]=mt.getSeconds(),xe()[dt+4>>2>>>0]=mt.getMinutes(),xe()[dt+8>>2>>>0]=mt.getHours(),xe()[dt+12>>2>>>0]=mt.getDate(),xe()[dt+16>>2>>>0]=mt.getMonth(),mt.getTime()/1e3|0},Aa:Xt,Ba:sn,Sa:function dt(mt,vt,It){dt.Ac||(dt.Ac=!0,Dn(mt,vt,It))},y:function(){nn("")},U:function(){if(!ut&&!ft){var dt="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";zt||(zt={}),zt[dt]||(zt[dt]=1,ut&&(dt="warning: "+dt),St(dt))}},ra:function(){return 4294901760},B:Ut,Ia:function(dt,mt,vt){ee().copyWithin(dt>>>0,mt>>>0,mt+vt>>>0)},F:function(){return ut?l(3993).cpus().length:navigator.hardwareConcurrency},Da:function(dt,mt,vt){Bn.length=mt,vt>>=3;for(var It=0;It<mt;It++)Bn[It]=te()[vt+It>>>0];return(0>dt?Fn[-dt-1]:hr[dt]).apply(null,Bn)},qa:function(dt){var mt=ee().length;if((dt>>>=0)<=mt||4294901760<dt)return!1;for(var vt=1;4>=vt;vt*=2){var It=mt*(1+.2/vt);It=Math.min(It,dt+100663296);var Lt=Math;It=Math.max(dt,It),Lt=Lt.min.call(Lt,4294901760,It+(65536-It%65536)%65536);e:{try{Ft.grow(Lt-dn.byteLength+65535>>>16),pn(Ft.buffer);var jt=1;break e}catch{}jt=void 0}if(jt)return!0}return!1},Na:function(){throw"unwind"},Ga:en,Ha:qn,J:vr,I:nr,S:Pn,ga:Qn,R:xr,d:function(){return dr},na:function dt(mt,vt){dt.lc||(dt.lc=(function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var Lt=new Uint8Array(1);return()=>(crypto.getRandomValues(Lt),Lt[0])}if(ut)try{var jt=l(Object((function(){var on=new Error("Cannot find module 'crypto'");throw on.code="MODULE_NOT_FOUND",on})()));return()=>jt.randomBytes(1)[0]}catch{}return()=>nn("randomDevice")})());for(var It=0;It<vt;It++)R()[mt+It>>0>>>0]=dt.lc();return 0},ia:function(dt,mt,vt){var It=Kn();try{return xt(dt)(mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},ja:function(dt,mt,vt){var It=Kn();try{return xt(dt)(mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},K:function(dt){var mt=Kn();try{return xt(dt)()}catch(vt){if(Wn(mt),vt!==vt+0)throw vt;Yn(1,0)}},f:function(dt,mt){var vt=Kn();try{return xt(dt)(mt)}catch(It){if(Wn(vt),It!==It+0)throw It;Yn(1,0)}},P:function(dt,mt,vt){var It=Kn();try{return xt(dt)(mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},Q:function(dt,mt,vt){var It=Kn();try{return xt(dt)(mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},k:function(dt,mt,vt){var It=Kn();try{return xt(dt)(mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},p:function(dt,mt,vt,It){var Lt=Kn();try{return xt(dt)(mt,vt,It)}catch(jt){if(Wn(Lt),jt!==jt+0)throw jt;Yn(1,0)}},q:function(dt,mt,vt,It,Lt){var jt=Kn();try{return xt(dt)(mt,vt,It,Lt)}catch(on){if(Wn(jt),on!==on+0)throw on;Yn(1,0)}},N:function(dt,mt,vt,It,Lt,jt){var on=Kn();try{return xt(dt)(mt,vt,It,Lt,jt)}catch(wn){if(Wn(on),wn!==wn+0)throw wn;Yn(1,0)}},s:function(dt,mt,vt,It,Lt,jt){var on=Kn();try{return xt(dt)(mt,vt,It,Lt,jt)}catch(wn){if(Wn(on),wn!==wn+0)throw wn;Yn(1,0)}},w:function(dt,mt,vt,It,Lt,jt,on){var wn=Kn();try{return xt(dt)(mt,vt,It,Lt,jt,on)}catch(Ln){if(Wn(wn),Ln!==Ln+0)throw Ln;Yn(1,0)}},L:function(dt,mt,vt,It,Lt,jt,on,wn){var Ln=Kn();try{return xt(dt)(mt,vt,It,Lt,jt,on,wn)}catch(Rn){if(Wn(Ln),Rn!==Rn+0)throw Rn;Yn(1,0)}},E:function(dt,mt,vt,It,Lt,jt,on,wn,Ln,Rn,or,Ir){var kr=Kn();try{return xt(dt)(mt,vt,It,Lt,jt,on,wn,Ln,Rn,or,Ir)}catch(an){if(Wn(kr),an!==an+0)throw an;Yn(1,0)}},aa:function(dt,mt,vt,It,Lt,jt,on,wn){var Ln=Kn();try{return Ct(dt,mt,vt,It,Lt,jt,on,wn)}catch(Rn){if(Wn(Ln),Rn!==Rn+0)throw Rn;Yn(1,0)}},_:function(dt,mt,vt,It,Lt,jt,on){var wn=Kn();try{return Kr(dt,mt,vt,It,Lt,jt,on)}catch(Ln){if(Wn(wn),Ln!==Ln+0)throw Ln;Yn(1,0)}},Z:function(dt,mt,vt,It,Lt){var jt=Kn();try{return Gt(dt,mt,vt,It,Lt)}catch(on){if(Wn(jt),on!==on+0)throw on;Yn(1,0)}},ca:function(dt,mt,vt,It){var Lt=Kn();try{return lt(dt,mt,vt,It)}catch(jt){if(Wn(Lt),jt!==jt+0)throw jt;Yn(1,0)}},$:function(dt){var mt=Kn();try{return Hr(dt)}catch(vt){if(Wn(mt),vt!==vt+0)throw vt;Yn(1,0)}},ba:function(dt,mt){var vt=Kn();try{return bt(dt,mt)}catch(It){if(Wn(vt),It!==It+0)throw It;Yn(1,0)}},Y:function(dt,mt,vt){var It=Kn();try{return Yr(dt,mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},g:function(dt){var mt=Kn();try{xt(dt)()}catch(vt){if(Wn(mt),vt!==vt+0)throw vt;Yn(1,0)}},r:function(dt,mt){var vt=Kn();try{xt(dt)(mt)}catch(It){if(Wn(vt),It!==It+0)throw It;Yn(1,0)}},i:function(dt,mt,vt){var It=Kn();try{xt(dt)(mt,vt)}catch(Lt){if(Wn(It),Lt!==Lt+0)throw Lt;Yn(1,0)}},ha:function(dt,mt,vt,It){var Lt=Kn();try{xt(dt)(mt,vt,It)}catch(jt){if(Wn(Lt),jt!==jt+0)throw jt;Yn(1,0)}},m:function(dt,mt,vt,It){var Lt=Kn();try{xt(dt)(mt,vt,It)}catch(jt){if(Wn(Lt),jt!==jt+0)throw jt;Yn(1,0)}},v:function(dt,mt,vt,It,Lt){var jt=Kn();try{xt(dt)(mt,vt,It,Lt)}catch(on){if(Wn(jt),on!==on+0)throw on;Yn(1,0)}},u:function(dt,mt,vt,It,Lt,jt){var on=Kn();try{xt(dt)(mt,vt,It,Lt,jt)}catch(wn){if(Wn(on),wn!==wn+0)throw wn;Yn(1,0)}},O:function(dt,mt,vt,It,Lt,jt,on){var wn=Kn();try{xt(dt)(mt,vt,It,Lt,jt,on)}catch(Ln){if(Wn(wn),Ln!==Ln+0)throw Ln;Yn(1,0)}},A:function(dt,mt,vt,It,Lt,jt,on,wn){var Ln=Kn();try{xt(dt)(mt,vt,It,Lt,jt,on,wn)}catch(Rn){if(Wn(Ln),Rn!==Rn+0)throw Rn;Yn(1,0)}},ka:function(dt,mt,vt,It,Lt,jt,on,wn,Ln){var Rn=Kn();try{xt(dt)(mt,vt,It,Lt,jt,on,wn,Ln)}catch(or){if(Wn(Rn),or!==or+0)throw or;Yn(1,0)}},C:function(dt,mt,vt,It,Lt,jt,on,wn,Ln,Rn,or){var Ir=Kn();try{xt(dt)(mt,vt,It,Lt,jt,on,wn,Ln,Rn,or)}catch(kr){if(Wn(Ir),kr!==kr+0)throw kr;Yn(1,0)}},D:function(dt,mt,vt,It,Lt,jt,on,wn,Ln,Rn,or,Ir,kr,an,tr,br){var Nr=Kn();try{xt(dt)(mt,vt,It,Lt,jt,on,wn,Ln,Rn,or,Ir,kr,an,tr,br)}catch(Fr){if(Wn(Nr),Fr!==Fr+0)throw Fr;Yn(1,0)}},fa:function(dt,mt,vt,It,Lt,jt,on,wn){var Ln=Kn();try{Vr(dt,mt,vt,It,Lt,jt,on,wn)}catch(Rn){if(Wn(Ln),Rn!==Rn+0)throw Rn;Yn(1,0)}},da:function(dt,mt,vt,It,Lt,jt,on,wn,Ln,Rn,or,Ir){var kr=Kn();try{rt(dt,mt,vt,It,Lt,jt,on,wn,Ln,Rn,or,Ir)}catch(an){if(Wn(kr),an!==an+0)throw an;Yn(1,0)}},ea:function(dt,mt,vt,It,Lt,jt){var on=Kn();try{ht(dt,mt,vt,It,Lt,jt)}catch(wn){if(Wn(on),wn!==wn+0)throw wn;Yn(1,0)}},o:function(dt){return dt},a:Ft||f.wasmMemory,G:function(dt){dr=dt},la:Er,z:function(dt,mt,vt,It){return Er(dt,mt,vt,It)}};(function(){function dt(Lt,jt){f.asm=Lt.exports,Nn.qc.push(f.asm.sb),mn=f.asm.ub,$n.unshift(f.asm.Va),ln=jt,_t||(Qt--,f.monitorRunDependencies&&f.monitorRunDependencies(Qt),Qt==0&&cn&&(Lt=cn,cn=null,Lt()))}function mt(Lt){dt(Lt.instance,Lt.module)}function vt(Lt){return(function(){if(!kt&&(ct||ft)){if(typeof fetch=="function"&&!Dt.startsWith("file://"))return fetch(Dt,{credentials:"same-origin"}).then((function(jt){if(!jt.ok)throw"failed to load wasm binary file at '"+Dt+"'";return jt.arrayBuffer()})).catch((function(){return Cn()}));if(Ye)return new Promise((function(jt,on){Ye(Dt,(function(wn){jt(new Uint8Array(wn))}),on)}))}return Promise.resolve().then((function(){return Cn()}))})().then((function(jt){return WebAssembly.instantiate(jt,It)})).then((function(jt){return jt})).then(Lt,(function(jt){St("failed to asynchronously prepare wasm: "+jt),nn(jt)}))}var It={a:Sr};if(_t||(Qt++,f.monitorRunDependencies&&f.monitorRunDependencies(Qt)),f.instantiateWasm)try{return f.instantiateWasm(It,dt)}catch(Lt){return St("Module.instantiateWasm callback failed with error: "+Lt),!1}(kt||typeof WebAssembly.instantiateStreaming!="function"||gn()||Dt.startsWith("file://")||ut||typeof fetch!="function"?vt(mt):fetch(Dt,{credentials:"same-origin"}).then((function(Lt){return WebAssembly.instantiateStreaming(Lt,It).then(mt,(function(jt){return St("wasm streaming compile failed: "+jt),St("falling back to ArrayBuffer instantiation"),vt(mt)}))}))).catch(H)})(),f.___wasm_call_ctors=function(){return(f.___wasm_call_ctors=f.asm.Va).apply(null,arguments)},f._OrtInit=function(){return(f._OrtInit=f.asm.Wa).apply(null,arguments)},f._OrtCreateSessionOptions=function(){return(f._OrtCreateSessionOptions=f.asm.Xa).apply(null,arguments)},f._OrtAppendExecutionProvider=function(){return(f._OrtAppendExecutionProvider=f.asm.Ya).apply(null,arguments)},f._OrtAddSessionConfigEntry=function(){return(f._OrtAddSessionConfigEntry=f.asm.Za).apply(null,arguments)},f._OrtReleaseSessionOptions=function(){return(f._OrtReleaseSessionOptions=f.asm._a).apply(null,arguments)},f._OrtCreateSession=function(){return(f._OrtCreateSession=f.asm.$a).apply(null,arguments)},f._OrtReleaseSession=function(){return(f._OrtReleaseSession=f.asm.ab).apply(null,arguments)},f._OrtGetInputCount=function(){return(f._OrtGetInputCount=f.asm.bb).apply(null,arguments)},f._OrtGetOutputCount=function(){return(f._OrtGetOutputCount=f.asm.cb).apply(null,arguments)},f._OrtGetInputName=function(){return(f._OrtGetInputName=f.asm.db).apply(null,arguments)},f._OrtGetOutputName=function(){return(f._OrtGetOutputName=f.asm.eb).apply(null,arguments)},f._OrtFree=function(){return(f._OrtFree=f.asm.fb).apply(null,arguments)},f._OrtCreateTensor=function(){return(f._OrtCreateTensor=f.asm.gb).apply(null,arguments)},f._OrtGetTensorData=function(){return(f._OrtGetTensorData=f.asm.hb).apply(null,arguments)},f._OrtReleaseTensor=function(){return(f._OrtReleaseTensor=f.asm.ib).apply(null,arguments)},f._OrtCreateRunOptions=function(){return(f._OrtCreateRunOptions=f.asm.jb).apply(null,arguments)},f._OrtAddRunConfigEntry=function(){return(f._OrtAddRunConfigEntry=f.asm.kb).apply(null,arguments)},f._OrtReleaseRunOptions=function(){return(f._OrtReleaseRunOptions=f.asm.lb).apply(null,arguments)},f._OrtRun=function(){return(f._OrtRun=f.asm.mb).apply(null,arguments)},f._OrtEndProfiling=function(){return(f._OrtEndProfiling=f.asm.nb).apply(null,arguments)};var Pr=f._pthread_self=function(){return(Pr=f._pthread_self=f.asm.ob).apply(null,arguments)},mr=f._malloc=function(){return(mr=f._malloc=f.asm.pb).apply(null,arguments)},Mr=f._free=function(){return(Mr=f._free=f.asm.qb).apply(null,arguments)},Cr=f._fflush=function(){return(Cr=f._fflush=f.asm.rb).apply(null,arguments)};f.__emscripten_tls_init=function(){return(f.__emscripten_tls_init=f.asm.sb).apply(null,arguments)};var Ar=f.___funcs_on_exit=function(){return(Ar=f.___funcs_on_exit=f.asm.tb).apply(null,arguments)},Dr=f.__emscripten_thread_init=function(){return(Dr=f.__emscripten_thread_init=f.asm.vb).apply(null,arguments)};f.__emscripten_thread_crashed=function(){return(f.__emscripten_thread_crashed=f.asm.wb).apply(null,arguments)};var Or,qr=f._emscripten_run_in_main_runtime_thread_js=function(){return(qr=f._emscripten_run_in_main_runtime_thread_js=f.asm.xb).apply(null,arguments)},zr=f.__emscripten_proxy_execute_task_queue=function(){return(zr=f.__emscripten_proxy_execute_task_queue=f.asm.yb).apply(null,arguments)},Rr=f.__emscripten_thread_free_data=function(){return(Rr=f.__emscripten_thread_free_data=f.asm.zb).apply(null,arguments)},Br=f.__emscripten_thread_exit=function(){return(Br=f.__emscripten_thread_exit=f.asm.Ab).apply(null,arguments)},Yn=f._setThrew=function(){return(Yn=f._setThrew=f.asm.Bb).apply(null,arguments)},Ur=f._emscripten_stack_set_limits=function(){return(Ur=f._emscripten_stack_set_limits=f.asm.Cb).apply(null,arguments)},Kn=f.stackSave=function(){return(Kn=f.stackSave=f.asm.Db).apply(null,arguments)},Wn=f.stackRestore=function(){return(Wn=f.stackRestore=f.asm.Eb).apply(null,arguments)},jr=f.stackAlloc=function(){return(jr=f.stackAlloc=f.asm.Fb).apply(null,arguments)},Lr=f.___cxa_can_catch=function(){return(Lr=f.___cxa_can_catch=f.asm.Gb).apply(null,arguments)},Wr=f.___cxa_is_pointer_type=function(){return(Wr=f.___cxa_is_pointer_type=f.asm.Hb).apply(null,arguments)},Hr=f.dynCall_j=function(){return(Hr=f.dynCall_j=f.asm.Ib).apply(null,arguments)},Kr=f.dynCall_iiiiij=function(){return(Kr=f.dynCall_iiiiij=f.asm.Jb).apply(null,arguments)},Yr=f.dynCall_jii=function(){return(Yr=f.dynCall_jii=f.asm.Kb).apply(null,arguments)},Vr=f.dynCall_viiiiij=function(){return(Vr=f.dynCall_viiiiij=f.asm.Lb).apply(null,arguments)},ht=f.dynCall_vjji=function(){return(ht=f.dynCall_vjji=f.asm.Mb).apply(null,arguments)},rt=f.dynCall_viiijjjii=function(){return(rt=f.dynCall_viiijjjii=f.asm.Nb).apply(null,arguments)},lt=f.dynCall_iij=function(){return(lt=f.dynCall_iij=f.asm.Ob).apply(null,arguments)},bt=f.dynCall_ji=function(){return(bt=f.dynCall_ji=f.asm.Pb).apply(null,arguments)},Ct=f.dynCall_iiiiiij=function(){return(Ct=f.dynCall_iiiiiij=f.asm.Qb).apply(null,arguments)},Gt=f.dynCall_iiij=function(){return(Gt=f.dynCall_iiij=f.asm.Rb).apply(null,arguments)};function rn(){function dt(){if(!Or&&(Or=!0,f.calledRun=!0,!En)&&(_t||ur($n),d(f),f.onRuntimeInitialized&&f.onRuntimeInitialized(),!_t)){if(f.postRun)for(typeof f.postRun=="function"&&(f.postRun=[f.postRun]);f.postRun.length;){var mt=f.postRun.shift();In.unshift(mt)}ur(In)}}if(!(0<Qt))if(_t)d(f),_t||ur($n),postMessage({cmd:"loaded"});else{if(f.preRun)for(typeof f.preRun=="function"&&(f.preRun=[f.preRun]);f.preRun.length;)Kt();ur(Tn),0<Qt||(f.setStatus?(f.setStatus("Running..."),setTimeout((function(){setTimeout((function(){f.setStatus("")}),1),dt()}),1)):dt())}}if(f.UTF8ToString=Wt,f.stringToUTF8=function(dt,mt,vt){return un(dt,ee(),mt,vt)},f.lengthBytesUTF8=fn,f.keepRuntimeAlive=kn,f.wasmMemory=Ft,f.stackSave=Kn,f.stackRestore=Wn,f.stackAlloc=jr,f.ExitStatus=Gn,f.PThread=Nn,cn=function dt(){Or||rn(),Or||(cn=dt)},f.preInit)for(typeof f.preInit=="function"&&(f.preInit=[f.preInit]);0<f.preInit.length;)f.preInit.pop()();return rn(),Y.ready});g.exports=O},932:(g,a,l)=>{var A,O=(A=(A=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(Y){var R,ee,xe;Y=Y||{},R||(R=Y!==void 0?Y:{}),R.ready=new Promise((function(Tt,Nt){ee=Tt,xe=Nt}));var ne,te,f,d,H,Z,Ye=Object.assign({},R),et="./this.program",tt=(Tt,Nt)=>{throw Nt},nt=typeof window=="object",it=typeof importScripts=="function",ot=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",st="";ot?(st=it?l(908).dirname(st)+"/":"//",Z=()=>{H||(d=l(1384),H=l(908))},ne=function(Tt,Nt){return Z(),Tt=H.normalize(Tt),d.readFileSync(Tt,Nt?void 0:"utf8")},f=Tt=>((Tt=ne(Tt,!0)).buffer||(Tt=new Uint8Array(Tt)),Tt),te=(Tt,Nt,Vt)=>{Z(),Tt=H.normalize(Tt),d.readFile(Tt,(function(Ht,Xt){Ht?Vt(Ht):Nt(Xt.buffer)}))},1<process.argv.length&&(et=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(Tt){if(!(Tt instanceof $n))throw Tt})),process.on("unhandledRejection",(function(Tt){throw Tt})),tt=(Tt,Nt)=>{if(ut||0<qt)throw process.exitCode=Tt,Nt;Nt instanceof $n||ft("exiting due to exception: "+Nt),process.exit(Tt)},R.inspect=function(){return"[Emscripten Module object]"}):(nt||it)&&(it?st=self.location.href:typeof document<"u"&&document.currentScript&&(st=document.currentScript.src),A&&(st=A),st=st.indexOf("blob:")!==0?st.substr(0,st.replace(/[?#].*/,"").lastIndexOf("/")+1):"",ne=Tt=>{var Nt=new XMLHttpRequest;return Nt.open("GET",Tt,!1),Nt.send(null),Nt.responseText},it&&(f=Tt=>{var Nt=new XMLHttpRequest;return Nt.open("GET",Tt,!1),Nt.responseType="arraybuffer",Nt.send(null),new Uint8Array(Nt.response)}),te=(Tt,Nt,Vt)=>{var Ht=new XMLHttpRequest;Ht.open("GET",Tt,!0),Ht.responseType="arraybuffer",Ht.onload=()=>{Ht.status==200||Ht.status==0&&Ht.response?Nt(Ht.response):Vt()},Ht.onerror=Vt,Ht.send(null)});var at,ct=R.print||console.log.bind(console),ft=R.printErr||console.warn.bind(console);Object.assign(R,Ye),Ye=null,R.thisProgram&&(et=R.thisProgram),R.quit&&(tt=R.quit),R.wasmBinary&&(at=R.wasmBinary);var ut=R.noExitRuntime||!1;typeof WebAssembly!="object"&&pn("no native wasm support detected");var _t,At,Et,Mt,Ot,kt,yt=!1,St=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Yt(Tt,Nt,Vt){var Ht=(Nt>>>=0)+Vt;for(Vt=Nt;Tt[Vt]&&!(Vt>=Ht);)++Vt;if(16<Vt-Nt&&Tt.buffer&&St)return St.decode(Tt.subarray(Nt,Vt));for(Ht="";Nt<Vt;){var Xt=Tt[Nt++];if(128&Xt){var sn=63&Tt[Nt++];if((224&Xt)==192)Ht+=String.fromCharCode((31&Xt)<<6|sn);else{var vn=63&Tt[Nt++];65536>(Xt=(240&Xt)==224?(15&Xt)<<12|sn<<6|vn:(7&Xt)<<18|sn<<12|vn<<6|63&Tt[Nt++])?Ht+=String.fromCharCode(Xt):(Xt-=65536,Ht+=String.fromCharCode(55296|Xt>>10,56320|1023&Xt))}}else Ht+=String.fromCharCode(Xt)}return Ht}function Ft(Tt,Nt){return(Tt>>>=0)?Yt(Mt,Tt,Nt):""}function ln(Tt,Nt,Vt,Ht){if(!(0<Ht))return 0;var Xt=Vt>>>=0;Ht=Vt+Ht-1;for(var sn=0;sn<Tt.length;++sn){var vn=Tt.charCodeAt(sn);if(55296<=vn&&57343>=vn&&(vn=65536+((1023&vn)<<10)|1023&Tt.charCodeAt(++sn)),127>=vn){if(Vt>=Ht)break;Nt[Vt++>>>0]=vn}else{if(2047>=vn){if(Vt+1>=Ht)break;Nt[Vt++>>>0]=192|vn>>6}else{if(65535>=vn){if(Vt+2>=Ht)break;Nt[Vt++>>>0]=224|vn>>12}else{if(Vt+3>=Ht)break;Nt[Vt++>>>0]=240|vn>>18,Nt[Vt++>>>0]=128|vn>>12&63}Nt[Vt++>>>0]=128|vn>>6&63}Nt[Vt++>>>0]=128|63&vn}}return Nt[Vt>>>0]=0,Vt-Xt}function dn(Tt){for(var Nt=0,Vt=0;Vt<Tt.length;++Vt){var Ht=Tt.charCodeAt(Vt);127>=Ht?Nt++:2047>=Ht?Nt+=2:55296<=Ht&&57343>=Ht?(Nt+=4,++Vt):Nt+=3}return Nt}function Pt(){var Tt=_t.buffer;At=Tt,R.HEAP8=Et=new Int8Array(Tt),R.HEAP16=new Int16Array(Tt),R.HEAP32=Ot=new Int32Array(Tt),R.HEAPU8=Mt=new Uint8Array(Tt),R.HEAPU16=new Uint16Array(Tt),R.HEAPU32=kt=new Uint32Array(Tt),R.HEAPF32=new Float32Array(Tt),R.HEAPF64=new Float64Array(Tt)}var $t,hn=[],_n=[],On=[],En=[],qt=0;function Jt(){var Tt=R.preRun.shift();hn.unshift(Tt)}var Wt,un=0,fn=null;function pn(Tt){throw R.onAbort&&R.onAbort(Tt),ft(Tt="Aborted("+Tt+")"),yt=!0,Tt=new WebAssembly.RuntimeError(Tt+". Build with -sASSERTIONS for more info."),xe(Tt),Tt}function Zt(){return Wt.startsWith("data:application/octet-stream;base64,")}if(Wt="ort-wasm.wasm",!Zt()){var mn=Wt;Wt=R.locateFile?R.locateFile(mn,st):st+mn}function Tn(){var Tt=Wt;try{if(Tt==Wt&&at)return new Uint8Array(at);if(f)return f(Tt);throw"both async and sync fetching of the wasm failed"}catch(Nt){pn(Nt)}}function $n(Tt){this.name="ExitStatus",this.message="Program terminated with exit("+Tt+")",this.status=Tt}function Un(Tt){for(;0<Tt.length;)Tt.shift()(R)}var In=[],kn=0,Kt=0;function Dt(Tt){this.Db=Tt,this.zb=Tt-24,this.Ub=function(Nt){kt[this.zb+4>>2>>>0]=Nt},this.Eb=function(){return kt[this.zb+4>>2>>>0]},this.Sb=function(Nt){kt[this.zb+8>>2>>>0]=Nt},this.Wb=function(){return kt[this.zb+8>>2>>>0]},this.Tb=function(){Ot[this.zb>>2>>>0]=0},this.Ib=function(Nt){Et[this.zb+12>>0>>>0]=Nt?1:0},this.Pb=function(){return Et[this.zb+12>>0>>>0]!=0},this.Jb=function(Nt){Et[this.zb+13>>0>>>0]=Nt?1:0},this.Lb=function(){return Et[this.zb+13>>0>>>0]!=0},this.Rb=function(Nt,Vt){this.Fb(0),this.Ub(Nt),this.Sb(Vt),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){Ot[this.zb>>2>>>0]+=1},this.Xb=function(){var Nt=Ot[this.zb>>2>>>0];return Ot[this.zb>>2>>>0]=Nt-1,Nt===1},this.Fb=function(Nt){kt[this.zb+16>>2>>>0]=Nt},this.Ob=function(){return kt[this.zb+16>>2>>>0]},this.Qb=function(){if(yn(this.Eb()))return kt[this.Db>>2>>>0];var Nt=this.Ob();return Nt!==0?Nt:this.Db}}function Qt(Tt){return zt(new Dt(Tt).zb)}var cn=[];function nn(Tt){var Nt=cn[Tt];return Nt||(Tt>=cn.length&&(cn.length=Tt+1),cn[Tt]=Nt=$t.get(Tt)),Nt}function gn(Tt){var Nt=dn(Tt)+1,Vt=xt(Nt);return Vt&&ln(Tt,Et,Vt,Nt),Vt}var Cn={};function Fn(){if(!Gn){var Tt,Nt={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:et||"./this.program"};for(Tt in Cn)Cn[Tt]===void 0?delete Nt[Tt]:Nt[Tt]=Cn[Tt];var Vt=[];for(Tt in Nt)Vt.push(Tt+"="+Nt[Tt]);Gn=Vt}return Gn}var Gn,Zn=[null,[],[]];function cr(Tt,Nt){var Vt=Zn[Tt];Nt===0||Nt===10?((Tt===1?ct:ft)(Yt(Vt,0)),Vt.length=0):Vt.push(Nt)}var bn=0;function vr(Tt){return Tt%4==0&&(Tt%100!=0||Tt%400==0)}var Nn=[31,29,31,30,31,30,31,31,30,31,30,31],ur=[31,28,31,30,31,30,31,31,30,31,30,31];function ir(Tt,Nt,Vt,Ht){function Xt(en,qn,nr){for(en=typeof en=="number"?en.toString():en||"";en.length<qn;)en=nr[0]+en;return en}function sn(en,qn){return Xt(en,qn,"0")}function vn(en,qn){function nr(Qn){return 0>Qn?-1:0<Qn?1:0}var Pn;return(Pn=nr(en.getFullYear()-qn.getFullYear()))===0&&(Pn=nr(en.getMonth()-qn.getMonth()))===0&&(Pn=nr(en.getDate()-qn.getDate())),Pn}function Dn(en){switch(en.getDay()){case 0:return new Date(en.getFullYear()-1,11,29);case 1:return en;case 2:return new Date(en.getFullYear(),0,3);case 3:return new Date(en.getFullYear(),0,2);case 4:return new Date(en.getFullYear(),0,1);case 5:return new Date(en.getFullYear()-1,11,31);case 6:return new Date(en.getFullYear()-1,11,30)}}function Sn(en){var qn=en.Bb;for(en=new Date(new Date(en.Cb+1900,0,1).getTime());0<qn;){var nr=en.getMonth(),Pn=(vr(en.getFullYear())?Nn:ur)[nr];if(!(qn>Pn-en.getDate())){en.setDate(en.getDate()+qn);break}qn-=Pn-en.getDate()+1,en.setDate(1),11>nr?en.setMonth(nr+1):(en.setMonth(0),en.setFullYear(en.getFullYear()+1))}return nr=new Date(en.getFullYear()+1,0,4),qn=Dn(new Date(en.getFullYear(),0,4)),nr=Dn(nr),0>=vn(qn,en)?0>=vn(nr,en)?en.getFullYear()+1:en.getFullYear():en.getFullYear()-1}var xn=Ot[Ht+40>>2>>>0];for(var Bn in Ht={$b:Ot[Ht>>2>>>0],Zb:Ot[Ht+4>>2>>>0],Gb:Ot[Ht+8>>2>>>0],Kb:Ot[Ht+12>>2>>>0],Hb:Ot[Ht+16>>2>>>0],Cb:Ot[Ht+20>>2>>>0],Ab:Ot[Ht+24>>2>>>0],Bb:Ot[Ht+28>>2>>>0],bc:Ot[Ht+32>>2>>>0],Yb:Ot[Ht+36>>2>>>0],ac:xn?Ft(xn):""},Vt=Ft(Vt),xn={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})Vt=Vt.replace(new RegExp(Bn,"g"),xn[Bn]);var lr="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),fr="January February March April May June July August September October November December".split(" ");for(Bn in xn={"%a":function(en){return lr[en.Ab].substring(0,3)},"%A":function(en){return lr[en.Ab]},"%b":function(en){return fr[en.Hb].substring(0,3)},"%B":function(en){return fr[en.Hb]},"%C":function(en){return sn((en.Cb+1900)/100|0,2)},"%d":function(en){return sn(en.Kb,2)},"%e":function(en){return Xt(en.Kb,2," ")},"%g":function(en){return Sn(en).toString().substring(2)},"%G":function(en){return Sn(en)},"%H":function(en){return sn(en.Gb,2)},"%I":function(en){return(en=en.Gb)==0?en=12:12<en&&(en-=12),sn(en,2)},"%j":function(en){for(var qn=0,nr=0;nr<=en.Hb-1;qn+=(vr(en.Cb+1900)?Nn:ur)[nr++]);return sn(en.Kb+qn,3)},"%m":function(en){return sn(en.Hb+1,2)},"%M":function(en){return sn(en.Zb,2)},"%n":function(){return`
`},"%p":function(en){return 0<=en.Gb&&12>en.Gb?"AM":"PM"},"%S":function(en){return sn(en.$b,2)},"%t":function(){return"	"},"%u":function(en){return en.Ab||7},"%U":function(en){return sn(Math.floor((en.Bb+7-en.Ab)/7),2)},"%V":function(en){var qn=Math.floor((en.Bb+7-(en.Ab+6)%7)/7);if(2>=(en.Ab+371-en.Bb-2)%7&&qn++,qn)qn==53&&((nr=(en.Ab+371-en.Bb)%7)==4||nr==3&&vr(en.Cb)||(qn=1));else{qn=52;var nr=(en.Ab+7-en.Bb-1)%7;(nr==4||nr==5&&vr(en.Cb%400-1))&&qn++}return sn(qn,2)},"%w":function(en){return en.Ab},"%W":function(en){return sn(Math.floor((en.Bb+7-(en.Ab+6)%7)/7),2)},"%y":function(en){return(en.Cb+1900).toString().substring(2)},"%Y":function(en){return en.Cb+1900},"%z":function(en){var qn=0<=(en=en.Yb);return en=Math.abs(en)/60,(qn?"+":"-")+("0000"+(en/60*100+en%60)).slice(-4)},"%Z":function(en){return en.ac},"%%":function(){return"%"}},Vt=Vt.replace(/%%/g,"\0\0"),xn)Vt.includes(Bn)&&(Vt=Vt.replace(new RegExp(Bn,"g"),xn[Bn](Ht)));return Bn=(function(en){var qn=Array(dn(en)+1);return ln(en,qn,0,qn.length),qn})(Vt=Vt.replace(/\0\0/g,"%")),Bn.length>Nt?0:(Et.set(Bn,Tt>>>0),Bn.length-1)}var wr={a:function(Tt){return xt(Tt+24)+24},m:function(Tt){return(Tt=new Dt(Tt)).Pb()||(Tt.Ib(!0),kn--),Tt.Jb(!1),In.push(Tt),Tt.Nb(),Tt.Qb()},ia:function(Tt){throw ft("Unexpected exception thrown, this is not properly supported - aborting"),yt=!0,Tt},w:function(){gt(0);var Tt=In.pop();if(Tt.Xb()&&!Tt.Lb()){var Nt=Tt.Wb();Nt&&nn(Nt)(Tt.Db),Qt(Tt.Db)}Kt=0},d:function(){var Tt=Kt;if(!Tt)return bn=0;var Nt=new Dt(Tt);Nt.Fb(Tt);var Vt=Nt.Eb();if(!Vt)return bn=0,Tt;for(var Ht=Array.prototype.slice.call(arguments),Xt=0;Xt<Ht.length;Xt++){var sn=Ht[Xt];if(sn===0||sn===Vt)break;if(tn(sn,Vt,Nt.zb+16))return bn=sn,Tt}return bn=Vt,Tt},k:function(){var Tt=Kt;if(!Tt)return bn=0;var Nt=new Dt(Tt);Nt.Fb(Tt);var Vt=Nt.Eb();if(!Vt)return bn=0,Tt;for(var Ht=Array.prototype.slice.call(arguments),Xt=0;Xt<Ht.length;Xt++){var sn=Ht[Xt];if(sn===0||sn===Vt)break;if(tn(sn,Vt,Nt.zb+16))return bn=sn,Tt}return bn=Vt,Tt},g:function(){var Tt=Kt;if(!Tt)return bn=0;var Nt=new Dt(Tt);Nt.Fb(Tt);var Vt=Nt.Eb();if(!Vt)return bn=0,Tt;for(var Ht=Array.prototype.slice.call(arguments),Xt=0;Xt<Ht.length;Xt++){var sn=Ht[Xt];if(sn===0||sn===Vt)break;if(tn(sn,Vt,Nt.zb+16))return bn=sn,Tt}return bn=Vt,Tt},s:Qt,L:function(){var Tt=In.pop();Tt||pn("no exception to throw");var Nt=Tt.Db;throw Tt.Lb()||(In.push(Tt),Tt.Jb(!0),Tt.Ib(!1),kn++),Kt=Nt,Nt},b:function(Tt,Nt,Vt){throw new Dt(Tt).Rb(Nt,Vt),Kt=Tt,kn++,Tt},la:function(){return kn},i:function(Tt){throw Kt||(Kt=Tt),Tt},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){pn("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){pn("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(Tt,Nt){Tt=new Date(1e3*(kt[Tt>>>2]+4294967296*Ot[Tt+4>>>2])),Ot[Nt>>2>>>0]=Tt.getUTCSeconds(),Ot[Nt+4>>2>>>0]=Tt.getUTCMinutes(),Ot[Nt+8>>2>>>0]=Tt.getUTCHours(),Ot[Nt+12>>2>>>0]=Tt.getUTCDate(),Ot[Nt+16>>2>>>0]=Tt.getUTCMonth(),Ot[Nt+20>>2>>>0]=Tt.getUTCFullYear()-1900,Ot[Nt+24>>2>>>0]=Tt.getUTCDay(),Ot[Nt+28>>2>>>0]=(Tt.getTime()-Date.UTC(Tt.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(Tt,Nt){Tt=new Date(1e3*(kt[Tt>>>2]+4294967296*Ot[Tt+4>>>2])),Ot[Nt>>2>>>0]=Tt.getSeconds(),Ot[Nt+4>>2>>>0]=Tt.getMinutes(),Ot[Nt+8>>2>>>0]=Tt.getHours(),Ot[Nt+12>>2>>>0]=Tt.getDate(),Ot[Nt+16>>2>>>0]=Tt.getMonth(),Ot[Nt+20>>2>>>0]=Tt.getFullYear()-1900,Ot[Nt+24>>2>>>0]=Tt.getDay();var Vt=new Date(Tt.getFullYear(),0,1);Ot[Nt+28>>2>>>0]=(Tt.getTime()-Vt.getTime())/864e5|0,Ot[Nt+36>>2>>>0]=-60*Tt.getTimezoneOffset();var Ht=new Date(Tt.getFullYear(),6,1).getTimezoneOffset();Vt=Vt.getTimezoneOffset(),Ot[Nt+32>>2>>>0]=0|(Ht!=Vt&&Tt.getTimezoneOffset()==Math.min(Vt,Ht))},Fa:function(Tt){var Nt=new Date(Ot[Tt+20>>2>>>0]+1900,Ot[Tt+16>>2>>>0],Ot[Tt+12>>2>>>0],Ot[Tt+8>>2>>>0],Ot[Tt+4>>2>>>0],Ot[Tt>>2>>>0],0),Vt=Ot[Tt+32>>2>>>0],Ht=Nt.getTimezoneOffset(),Xt=new Date(Nt.getFullYear(),0,1),sn=new Date(Nt.getFullYear(),6,1).getTimezoneOffset(),vn=Xt.getTimezoneOffset(),Dn=Math.min(vn,sn);return 0>Vt?Ot[Tt+32>>2>>>0]=+(sn!=vn&&Dn==Ht):0<Vt!=(Dn==Ht)&&(sn=Math.max(vn,sn),Nt.setTime(Nt.getTime()+6e4*((0<Vt?Dn:sn)-Ht))),Ot[Tt+24>>2>>>0]=Nt.getDay(),Ot[Tt+28>>2>>>0]=(Nt.getTime()-Xt.getTime())/864e5|0,Ot[Tt>>2>>>0]=Nt.getSeconds(),Ot[Tt+4>>2>>>0]=Nt.getMinutes(),Ot[Tt+8>>2>>>0]=Nt.getHours(),Ot[Tt+12>>2>>>0]=Nt.getDate(),Ot[Tt+16>>2>>>0]=Nt.getMonth(),Nt.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function Tt(Nt,Vt,Ht){Tt.Vb||(Tt.Vb=!0,(function(Xt,sn,vn){function Dn(fr){return(fr=fr.toTimeString().match(/\(([A-Za-z ]+)\)$/))?fr[1]:"GMT"}var Sn=new Date().getFullYear(),xn=new Date(Sn,0,1),Bn=new Date(Sn,6,1);Sn=xn.getTimezoneOffset();var lr=Bn.getTimezoneOffset();Ot[Xt>>2>>>0]=60*Math.max(Sn,lr),Ot[sn>>2>>>0]=+(Sn!=lr),Xt=Dn(xn),sn=Dn(Bn),Xt=gn(Xt),sn=gn(sn),lr<Sn?(kt[vn>>2>>>0]=Xt,kt[vn+4>>2>>>0]=sn):(kt[vn>>2>>>0]=sn,kt[vn+4>>2>>>0]=Xt)})(Nt,Vt,Ht))},B:function(){pn("")},ma:function(){return 4294901760},I:ot?()=>{var Tt=process.hrtime();return 1e3*Tt[0]+Tt[1]/1e6}:()=>performance.now(),xa:function(Tt,Nt,Vt){Mt.copyWithin(Tt>>>0,Nt>>>0,Nt+Vt>>>0)},G:function(Tt){var Nt=Mt.length;if(4294901760<(Tt>>>=0))return!1;for(var Vt=1;4>=Vt;Vt*=2){var Ht=Nt*(1+.2/Vt);Ht=Math.min(Ht,Tt+100663296);var Xt=Math;Ht=Math.max(Tt,Ht),Xt=Xt.min.call(Xt,4294901760,Ht+(65536-Ht%65536)%65536);e:{try{_t.grow(Xt-At.byteLength+65535>>>16),Pt();var sn=1;break e}catch{}sn=void 0}if(sn)return!0}return!1},va:function(Tt,Nt){var Vt=0;return Fn().forEach((function(Ht,Xt){var sn=Nt+Vt;for(Xt=kt[Tt+4*Xt>>2>>>0]=sn,sn=0;sn<Ht.length;++sn)Et[Xt++>>0>>>0]=Ht.charCodeAt(sn);Et[Xt>>0>>>0]=0,Vt+=Ht.length+1})),0},wa:function(Tt,Nt){var Vt=Fn();kt[Tt>>2>>>0]=Vt.length;var Ht=0;return Vt.forEach((function(Xt){Ht+=Xt.length+1})),kt[Nt>>2>>>0]=Ht,0},ba:function(Tt){ut||0<qt||(pt(),Un(On),Ut(0),Zn[1].length&&cr(1,10),Zn[2].length&&cr(2,10)),ut||0<qt||(R.onExit&&R.onExit(Tt),yt=!0),tt(Tt,new $n(Tt))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(Tt,Nt,Vt,Ht){for(var Xt=0,sn=0;sn<Vt;sn++){var vn=kt[Nt>>2>>>0],Dn=kt[Nt+4>>2>>>0];Nt+=8;for(var Sn=0;Sn<Dn;Sn++)cr(Tt,Mt[vn+Sn>>>0]);Xt+=Dn}return kt[Ht>>2>>>0]=Xt,0},c:function(){return bn},ja:function Tt(Nt,Vt){Tt.Mb||(Tt.Mb=(function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var Xt=new Uint8Array(1);return()=>(crypto.getRandomValues(Xt),Xt[0])}if(ot)try{var sn=l(Object((function(){var vn=new Error("Cannot find module 'crypto'");throw vn.code="MODULE_NOT_FOUND",vn})()));return()=>sn.randomBytes(1)[0]}catch{}return()=>pn("randomDevice")})());for(var Ht=0;Ht<Vt;Ht++)Et[Nt+Ht>>0>>>0]=Tt.Mb();return 0},ea:function(Tt,Nt,Vt){var Ht=wt();try{return nn(Tt)(Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},fa:function(Tt,Nt,Vt){var Ht=wt();try{return nn(Tt)(Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},J:function(Tt){var Nt=wt();try{return nn(Tt)()}catch(Vt){if(Rt(Nt),Vt!==Vt+0)throw Vt;gt(1,0)}},e:function(Tt,Nt){var Vt=wt();try{return nn(Tt)(Nt)}catch(Ht){if(Rt(Vt),Ht!==Ht+0)throw Ht;gt(1,0)}},N:function(Tt,Nt,Vt){var Ht=wt();try{return nn(Tt)(Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},O:function(Tt,Nt,Vt){var Ht=wt();try{return nn(Tt)(Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},j:function(Tt,Nt,Vt){var Ht=wt();try{return nn(Tt)(Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},o:function(Tt,Nt,Vt,Ht){var Xt=wt();try{return nn(Tt)(Nt,Vt,Ht)}catch(sn){if(Rt(Xt),sn!==sn+0)throw sn;gt(1,0)}},p:function(Tt,Nt,Vt,Ht,Xt){var sn=wt();try{return nn(Tt)(Nt,Vt,Ht,Xt)}catch(vn){if(Rt(sn),vn!==vn+0)throw vn;gt(1,0)}},M:function(Tt,Nt,Vt,Ht,Xt,sn){var vn=wt();try{return nn(Tt)(Nt,Vt,Ht,Xt,sn)}catch(Dn){if(Rt(vn),Dn!==Dn+0)throw Dn;gt(1,0)}},r:function(Tt,Nt,Vt,Ht,Xt,sn){var vn=wt();try{return nn(Tt)(Nt,Vt,Ht,Xt,sn)}catch(Dn){if(Rt(vn),Dn!==Dn+0)throw Dn;gt(1,0)}},v:function(Tt,Nt,Vt,Ht,Xt,sn,vn){var Dn=wt();try{return nn(Tt)(Nt,Vt,Ht,Xt,sn,vn)}catch(Sn){if(Rt(Dn),Sn!==Sn+0)throw Sn;gt(1,0)}},K:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn){var Sn=wt();try{return nn(Tt)(Nt,Vt,Ht,Xt,sn,vn,Dn)}catch(xn){if(Rt(Sn),xn!==xn+0)throw xn;gt(1,0)}},D:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn,lr){var fr=wt();try{return nn(Tt)(Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn,lr)}catch(en){if(Rt(fr),en!==en+0)throw en;gt(1,0)}},X:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn){var Sn=wt();try{return sr(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn)}catch(xn){if(Rt(Sn),xn!==xn+0)throw xn;gt(1,0)}},V:function(Tt,Nt,Vt,Ht,Xt,sn,vn){var Dn=wt();try{return Mn(Tt,Nt,Vt,Ht,Xt,sn,vn)}catch(Sn){if(Rt(Dn),Sn!==Sn+0)throw Sn;gt(1,0)}},U:function(Tt,Nt,Vt,Ht,Xt){var sn=wt();try{return _r(Tt,Nt,Vt,Ht,Xt)}catch(vn){if(Rt(sn),vn!==vn+0)throw vn;gt(1,0)}},Z:function(Tt,Nt,Vt,Ht){var Xt=wt();try{return ar(Tt,Nt,Vt,Ht)}catch(sn){if(Rt(Xt),sn!==sn+0)throw sn;gt(1,0)}},W:function(Tt){var Nt=wt();try{return An(Tt)}catch(Vt){if(Rt(Nt),Vt!==Vt+0)throw Vt;gt(1,0)}},Y:function(Tt,Nt){var Vt=wt();try{return Vn(Tt,Nt)}catch(Ht){if(Rt(Vt),Ht!==Ht+0)throw Ht;gt(1,0)}},T:function(Tt,Nt,Vt){var Ht=wt();try{return Xn(Tt,Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},f:function(Tt){var Nt=wt();try{nn(Tt)()}catch(Vt){if(Rt(Nt),Vt!==Vt+0)throw Vt;gt(1,0)}},q:function(Tt,Nt){var Vt=wt();try{nn(Tt)(Nt)}catch(Ht){if(Rt(Vt),Ht!==Ht+0)throw Ht;gt(1,0)}},h:function(Tt,Nt,Vt){var Ht=wt();try{nn(Tt)(Nt,Vt)}catch(Xt){if(Rt(Ht),Xt!==Xt+0)throw Xt;gt(1,0)}},da:function(Tt,Nt,Vt,Ht){var Xt=wt();try{nn(Tt)(Nt,Vt,Ht)}catch(sn){if(Rt(Xt),sn!==sn+0)throw sn;gt(1,0)}},l:function(Tt,Nt,Vt,Ht){var Xt=wt();try{nn(Tt)(Nt,Vt,Ht)}catch(sn){if(Rt(Xt),sn!==sn+0)throw sn;gt(1,0)}},t:function(Tt,Nt,Vt,Ht,Xt){var sn=wt();try{nn(Tt)(Nt,Vt,Ht,Xt)}catch(vn){if(Rt(sn),vn!==vn+0)throw vn;gt(1,0)}},u:function(Tt,Nt,Vt,Ht,Xt,sn){var vn=wt();try{nn(Tt)(Nt,Vt,Ht,Xt,sn)}catch(Dn){if(Rt(vn),Dn!==Dn+0)throw Dn;gt(1,0)}},x:function(Tt,Nt,Vt,Ht,Xt,sn,vn){var Dn=wt();try{nn(Tt)(Nt,Vt,Ht,Xt,sn,vn)}catch(Sn){if(Rt(Dn),Sn!==Sn+0)throw Sn;gt(1,0)}},z:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn){var Sn=wt();try{nn(Tt)(Nt,Vt,Ht,Xt,sn,vn,Dn)}catch(xn){if(Rt(Sn),xn!==xn+0)throw xn;gt(1,0)}},ga:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn,Sn){var xn=wt();try{nn(Tt)(Nt,Vt,Ht,Xt,sn,vn,Dn,Sn)}catch(Bn){if(Rt(xn),Bn!==Bn+0)throw Bn;gt(1,0)}},A:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn){var lr=wt();try{nn(Tt)(Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn)}catch(fr){if(Rt(lr),fr!==fr+0)throw fr;gt(1,0)}},C:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn,lr,fr,en,qn,nr){var Pn=wt();try{nn(Tt)(Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn,lr,fr,en,qn,nr)}catch(Qn){if(Rt(Pn),Qn!==Qn+0)throw Qn;gt(1,0)}},aa:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn){var Sn=wt();try{zn(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn)}catch(xn){if(Rt(Sn),xn!==xn+0)throw xn;gt(1,0)}},_:function(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn,lr){var fr=wt();try{Hn(Tt,Nt,Vt,Ht,Xt,sn,vn,Dn,Sn,xn,Bn,lr)}catch(en){if(Rt(fr),en!==en+0)throw en;gt(1,0)}},$:function(Tt,Nt,Vt,Ht,Xt,sn){var vn=wt();try{Jn(Tt,Nt,Vt,Ht,Xt,sn)}catch(Dn){if(Rt(vn),Dn!==Dn+0)throw Dn;gt(1,0)}},n:function(Tt){return Tt},F:function(Tt){bn=Tt},ha:ir,y:function(Tt,Nt,Vt,Ht){return ir(Tt,Nt,Vt,Ht)}};(function(){function Tt(Xt){R.asm=Xt.exports,_t=R.asm.Ka,Pt(),$t=R.asm.ib,_n.unshift(R.asm.La),un--,R.monitorRunDependencies&&R.monitorRunDependencies(un),un==0&&fn&&(Xt=fn,fn=null,Xt())}function Nt(Xt){Tt(Xt.instance)}function Vt(Xt){return(function(){if(!at&&(nt||it)){if(typeof fetch=="function"&&!Wt.startsWith("file://"))return fetch(Wt,{credentials:"same-origin"}).then((function(sn){if(!sn.ok)throw"failed to load wasm binary file at '"+Wt+"'";return sn.arrayBuffer()})).catch((function(){return Tn()}));if(te)return new Promise((function(sn,vn){te(Wt,(function(Dn){sn(new Uint8Array(Dn))}),vn)}))}return Promise.resolve().then((function(){return Tn()}))})().then((function(sn){return WebAssembly.instantiate(sn,Ht)})).then((function(sn){return sn})).then(Xt,(function(sn){ft("failed to asynchronously prepare wasm: "+sn),pn(sn)}))}var Ht={a:wr};if(un++,R.monitorRunDependencies&&R.monitorRunDependencies(un),R.instantiateWasm)try{return R.instantiateWasm(Ht,Tt)}catch(Xt){return ft("Module.instantiateWasm callback failed with error: "+Xt),!1}(at||typeof WebAssembly.instantiateStreaming!="function"||Zt()||Wt.startsWith("file://")||ot||typeof fetch!="function"?Vt(Nt):fetch(Wt,{credentials:"same-origin"}).then((function(Xt){return WebAssembly.instantiateStreaming(Xt,Ht).then(Nt,(function(sn){return ft("wasm streaming compile failed: "+sn),ft("falling back to ArrayBuffer instantiation"),Vt(Nt)}))}))).catch(xe)})(),R.___wasm_call_ctors=function(){return(R.___wasm_call_ctors=R.asm.La).apply(null,arguments)},R._OrtInit=function(){return(R._OrtInit=R.asm.Ma).apply(null,arguments)},R._OrtCreateSessionOptions=function(){return(R._OrtCreateSessionOptions=R.asm.Na).apply(null,arguments)},R._OrtAppendExecutionProvider=function(){return(R._OrtAppendExecutionProvider=R.asm.Oa).apply(null,arguments)},R._OrtAddSessionConfigEntry=function(){return(R._OrtAddSessionConfigEntry=R.asm.Pa).apply(null,arguments)},R._OrtReleaseSessionOptions=function(){return(R._OrtReleaseSessionOptions=R.asm.Qa).apply(null,arguments)},R._OrtCreateSession=function(){return(R._OrtCreateSession=R.asm.Ra).apply(null,arguments)},R._OrtReleaseSession=function(){return(R._OrtReleaseSession=R.asm.Sa).apply(null,arguments)},R._OrtGetInputCount=function(){return(R._OrtGetInputCount=R.asm.Ta).apply(null,arguments)},R._OrtGetOutputCount=function(){return(R._OrtGetOutputCount=R.asm.Ua).apply(null,arguments)},R._OrtGetInputName=function(){return(R._OrtGetInputName=R.asm.Va).apply(null,arguments)},R._OrtGetOutputName=function(){return(R._OrtGetOutputName=R.asm.Wa).apply(null,arguments)},R._OrtFree=function(){return(R._OrtFree=R.asm.Xa).apply(null,arguments)},R._OrtCreateTensor=function(){return(R._OrtCreateTensor=R.asm.Ya).apply(null,arguments)},R._OrtGetTensorData=function(){return(R._OrtGetTensorData=R.asm.Za).apply(null,arguments)},R._OrtReleaseTensor=function(){return(R._OrtReleaseTensor=R.asm._a).apply(null,arguments)},R._OrtCreateRunOptions=function(){return(R._OrtCreateRunOptions=R.asm.$a).apply(null,arguments)},R._OrtAddRunConfigEntry=function(){return(R._OrtAddRunConfigEntry=R.asm.ab).apply(null,arguments)},R._OrtReleaseRunOptions=function(){return(R._OrtReleaseRunOptions=R.asm.bb).apply(null,arguments)},R._OrtRun=function(){return(R._OrtRun=R.asm.cb).apply(null,arguments)},R._OrtEndProfiling=function(){return(R._OrtEndProfiling=R.asm.db).apply(null,arguments)};var jn,xt=R._malloc=function(){return(xt=R._malloc=R.asm.eb).apply(null,arguments)},zt=R._free=function(){return(zt=R._free=R.asm.fb).apply(null,arguments)},Ut=R._fflush=function(){return(Ut=R._fflush=R.asm.gb).apply(null,arguments)},pt=R.___funcs_on_exit=function(){return(pt=R.___funcs_on_exit=R.asm.hb).apply(null,arguments)},gt=R._setThrew=function(){return(gt=R._setThrew=R.asm.jb).apply(null,arguments)},wt=R.stackSave=function(){return(wt=R.stackSave=R.asm.kb).apply(null,arguments)},Rt=R.stackRestore=function(){return(Rt=R.stackRestore=R.asm.lb).apply(null,arguments)},Bt=R.stackAlloc=function(){return(Bt=R.stackAlloc=R.asm.mb).apply(null,arguments)},tn=R.___cxa_can_catch=function(){return(tn=R.___cxa_can_catch=R.asm.nb).apply(null,arguments)},yn=R.___cxa_is_pointer_type=function(){return(yn=R.___cxa_is_pointer_type=R.asm.ob).apply(null,arguments)},An=R.dynCall_j=function(){return(An=R.dynCall_j=R.asm.pb).apply(null,arguments)},Mn=R.dynCall_iiiiij=function(){return(Mn=R.dynCall_iiiiij=R.asm.qb).apply(null,arguments)},Xn=R.dynCall_jii=function(){return(Xn=R.dynCall_jii=R.asm.rb).apply(null,arguments)},zn=R.dynCall_viiiiij=function(){return(zn=R.dynCall_viiiiij=R.asm.sb).apply(null,arguments)},Jn=R.dynCall_vjji=function(){return(Jn=R.dynCall_vjji=R.asm.tb).apply(null,arguments)},Hn=R.dynCall_viiijjjii=function(){return(Hn=R.dynCall_viiijjjii=R.asm.ub).apply(null,arguments)},ar=R.dynCall_iij=function(){return(ar=R.dynCall_iij=R.asm.vb).apply(null,arguments)},Vn=R.dynCall_ji=function(){return(Vn=R.dynCall_ji=R.asm.wb).apply(null,arguments)},sr=R.dynCall_iiiiiij=function(){return(sr=R.dynCall_iiiiiij=R.asm.xb).apply(null,arguments)},_r=R.dynCall_iiij=function(){return(_r=R.dynCall_iiij=R.asm.yb).apply(null,arguments)};function er(){function Tt(){if(!jn&&(jn=!0,R.calledRun=!0,!yt)){if(Un(_n),ee(R),R.onRuntimeInitialized&&R.onRuntimeInitialized(),R.postRun)for(typeof R.postRun=="function"&&(R.postRun=[R.postRun]);R.postRun.length;){var Nt=R.postRun.shift();En.unshift(Nt)}Un(En)}}if(!(0<un)){if(R.preRun)for(typeof R.preRun=="function"&&(R.preRun=[R.preRun]);R.preRun.length;)Jt();Un(hn),0<un||(R.setStatus?(R.setStatus("Running..."),setTimeout((function(){setTimeout((function(){R.setStatus("")}),1),Tt()}),1)):Tt())}}if(R.UTF8ToString=Ft,R.stringToUTF8=function(Tt,Nt,Vt){return ln(Tt,Mt,Nt,Vt)},R.lengthBytesUTF8=dn,R.stackSave=wt,R.stackRestore=Rt,R.stackAlloc=Bt,fn=function Tt(){jn||er(),jn||(fn=Tt)},R.preInit)for(typeof R.preInit=="function"&&(R.preInit=[R.preInit]);0<R.preInit.length;)R.preInit.pop()();return er(),Y.ready});g.exports=O},4537:g=>{g.exports=function(a,l){for(var A=new Array(arguments.length-1),O=0,Y=2,R=!0;Y<arguments.length;)A[O++]=arguments[Y++];return new Promise((function(ee,xe){A[O]=function(ne){if(R)if(R=!1,ne)xe(ne);else{for(var te=new Array(arguments.length-1),f=0;f<te.length;)te[f++]=arguments[f];ee.apply(null,te)}};try{a.apply(l||null,A)}catch(ne){R&&(R=!1,xe(ne))}}))}},7419:(g,a)=>{var l=a;l.length=function(ee){var xe=ee.length;if(!xe)return 0;for(var ne=0;--xe%4>1&&ee.charAt(xe)==="=";)++ne;return Math.ceil(3*ee.length)/4-ne};for(var A=new Array(64),O=new Array(123),Y=0;Y<64;)O[A[Y]=Y<26?Y+65:Y<52?Y+71:Y<62?Y-4:Y-59|43]=Y++;l.encode=function(ee,xe,ne){for(var te,f=null,d=[],H=0,Z=0;xe<ne;){var Ye=ee[xe++];switch(Z){case 0:d[H++]=A[Ye>>2],te=(3&Ye)<<4,Z=1;break;case 1:d[H++]=A[te|Ye>>4],te=(15&Ye)<<2,Z=2;break;case 2:d[H++]=A[te|Ye>>6],d[H++]=A[63&Ye],Z=0}H>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,d)),H=0)}return Z&&(d[H++]=A[te],d[H++]=61,Z===1&&(d[H++]=61)),f?(H&&f.push(String.fromCharCode.apply(String,d.slice(0,H))),f.join("")):String.fromCharCode.apply(String,d.slice(0,H))};var R="invalid encoding";l.decode=function(ee,xe,ne){for(var te,f=ne,d=0,H=0;H<ee.length;){var Z=ee.charCodeAt(H++);if(Z===61&&d>1)break;if((Z=O[Z])===void 0)throw Error(R);switch(d){case 0:te=Z,d=1;break;case 1:xe[ne++]=te<<2|(48&Z)>>4,te=Z,d=2;break;case 2:xe[ne++]=(15&te)<<4|(60&Z)>>2,te=Z,d=3;break;case 3:xe[ne++]=(3&te)<<6|Z,d=0}}if(d===1)throw Error(R);return ne-f},l.test=function(ee){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(ee)}},9211:g=>{function a(){this._listeners={}}g.exports=a,a.prototype.on=function(l,A,O){return(this._listeners[l]||(this._listeners[l]=[])).push({fn:A,ctx:O||this}),this},a.prototype.off=function(l,A){if(l===void 0)this._listeners={};else if(A===void 0)this._listeners[l]=[];else for(var O=this._listeners[l],Y=0;Y<O.length;)O[Y].fn===A?O.splice(Y,1):++Y;return this},a.prototype.emit=function(l){var A=this._listeners[l];if(A){for(var O=[],Y=1;Y<arguments.length;)O.push(arguments[Y++]);for(Y=0;Y<A.length;)A[Y].fn.apply(A[Y++].ctx,O)}return this}},945:g=>{function a(R){return typeof Float32Array<"u"?(function(){var ee=new Float32Array([-0]),xe=new Uint8Array(ee.buffer),ne=xe[3]===128;function te(Z,Ye,et){ee[0]=Z,Ye[et]=xe[0],Ye[et+1]=xe[1],Ye[et+2]=xe[2],Ye[et+3]=xe[3]}function f(Z,Ye,et){ee[0]=Z,Ye[et]=xe[3],Ye[et+1]=xe[2],Ye[et+2]=xe[1],Ye[et+3]=xe[0]}function d(Z,Ye){return xe[0]=Z[Ye],xe[1]=Z[Ye+1],xe[2]=Z[Ye+2],xe[3]=Z[Ye+3],ee[0]}function H(Z,Ye){return xe[3]=Z[Ye],xe[2]=Z[Ye+1],xe[1]=Z[Ye+2],xe[0]=Z[Ye+3],ee[0]}R.writeFloatLE=ne?te:f,R.writeFloatBE=ne?f:te,R.readFloatLE=ne?d:H,R.readFloatBE=ne?H:d})():(function(){function ee(ne,te,f,d){var H=te<0?1:0;if(H&&(te=-te),te===0)ne(1/te>0?0:2147483648,f,d);else if(isNaN(te))ne(2143289344,f,d);else if(te>34028234663852886e22)ne((H<<31|2139095040)>>>0,f,d);else if(te<11754943508222875e-54)ne((H<<31|Math.round(te/1401298464324817e-60))>>>0,f,d);else{var Z=Math.floor(Math.log(te)/Math.LN2);ne((H<<31|Z+127<<23|8388607&Math.round(te*Math.pow(2,-Z)*8388608))>>>0,f,d)}}function xe(ne,te,f){var d=ne(te,f),H=2*(d>>31)+1,Z=d>>>23&255,Ye=8388607&d;return Z===255?Ye?NaN:H*(1/0):Z===0?1401298464324817e-60*H*Ye:H*Math.pow(2,Z-150)*(Ye+8388608)}R.writeFloatLE=ee.bind(null,l),R.writeFloatBE=ee.bind(null,A),R.readFloatLE=xe.bind(null,O),R.readFloatBE=xe.bind(null,Y)})(),typeof Float64Array<"u"?(function(){var ee=new Float64Array([-0]),xe=new Uint8Array(ee.buffer),ne=xe[7]===128;function te(Z,Ye,et){ee[0]=Z,Ye[et]=xe[0],Ye[et+1]=xe[1],Ye[et+2]=xe[2],Ye[et+3]=xe[3],Ye[et+4]=xe[4],Ye[et+5]=xe[5],Ye[et+6]=xe[6],Ye[et+7]=xe[7]}function f(Z,Ye,et){ee[0]=Z,Ye[et]=xe[7],Ye[et+1]=xe[6],Ye[et+2]=xe[5],Ye[et+3]=xe[4],Ye[et+4]=xe[3],Ye[et+5]=xe[2],Ye[et+6]=xe[1],Ye[et+7]=xe[0]}function d(Z,Ye){return xe[0]=Z[Ye],xe[1]=Z[Ye+1],xe[2]=Z[Ye+2],xe[3]=Z[Ye+3],xe[4]=Z[Ye+4],xe[5]=Z[Ye+5],xe[6]=Z[Ye+6],xe[7]=Z[Ye+7],ee[0]}function H(Z,Ye){return xe[7]=Z[Ye],xe[6]=Z[Ye+1],xe[5]=Z[Ye+2],xe[4]=Z[Ye+3],xe[3]=Z[Ye+4],xe[2]=Z[Ye+5],xe[1]=Z[Ye+6],xe[0]=Z[Ye+7],ee[0]}R.writeDoubleLE=ne?te:f,R.writeDoubleBE=ne?f:te,R.readDoubleLE=ne?d:H,R.readDoubleBE=ne?H:d})():(function(){function ee(ne,te,f,d,H,Z){var Ye=d<0?1:0;if(Ye&&(d=-d),d===0)ne(0,H,Z+te),ne(1/d>0?0:2147483648,H,Z+f);else if(isNaN(d))ne(0,H,Z+te),ne(2146959360,H,Z+f);else if(d>17976931348623157e292)ne(0,H,Z+te),ne((Ye<<31|2146435072)>>>0,H,Z+f);else{var et;if(d<22250738585072014e-324)ne((et=d/5e-324)>>>0,H,Z+te),ne((Ye<<31|et/4294967296)>>>0,H,Z+f);else{var tt=Math.floor(Math.log(d)/Math.LN2);tt===1024&&(tt=1023),ne(4503599627370496*(et=d*Math.pow(2,-tt))>>>0,H,Z+te),ne((Ye<<31|tt+1023<<20|1048576*et&1048575)>>>0,H,Z+f)}}}function xe(ne,te,f,d,H){var Z=ne(d,H+te),Ye=ne(d,H+f),et=2*(Ye>>31)+1,tt=Ye>>>20&2047,nt=4294967296*(1048575&Ye)+Z;return tt===2047?nt?NaN:et*(1/0):tt===0?5e-324*et*nt:et*Math.pow(2,tt-1075)*(nt+4503599627370496)}R.writeDoubleLE=ee.bind(null,l,0,4),R.writeDoubleBE=ee.bind(null,A,4,0),R.readDoubleLE=xe.bind(null,O,0,4),R.readDoubleBE=xe.bind(null,Y,4,0)})(),R}function l(R,ee,xe){ee[xe]=255&R,ee[xe+1]=R>>>8&255,ee[xe+2]=R>>>16&255,ee[xe+3]=R>>>24}function A(R,ee,xe){ee[xe]=R>>>24,ee[xe+1]=R>>>16&255,ee[xe+2]=R>>>8&255,ee[xe+3]=255&R}function O(R,ee){return(R[ee]|R[ee+1]<<8|R[ee+2]<<16|R[ee+3]<<24)>>>0}function Y(R,ee){return(R[ee]<<24|R[ee+1]<<16|R[ee+2]<<8|R[ee+3])>>>0}g.exports=a(a)},7199:module=>{function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(g){}return null}module.exports=inquire},6662:g=>{g.exports=function(a,l,A){var O=A||8192,Y=O>>>1,R=null,ee=O;return function(xe){if(xe<1||xe>Y)return a(xe);ee+xe>O&&(R=a(O),ee=0);var ne=l.call(R,ee,ee+=xe);return 7&ee&&(ee=1+(7|ee)),ne}}},4997:(g,a)=>{var l=a;l.length=function(A){for(var O=0,Y=0,R=0;R<A.length;++R)(Y=A.charCodeAt(R))<128?O+=1:Y<2048?O+=2:(64512&Y)==55296&&(64512&A.charCodeAt(R+1))==56320?(++R,O+=4):O+=3;return O},l.read=function(A,O,Y){if(Y-O<1)return"";for(var R,ee=null,xe=[],ne=0;O<Y;)(R=A[O++])<128?xe[ne++]=R:R>191&&R<224?xe[ne++]=(31&R)<<6|63&A[O++]:R>239&&R<365?(R=((7&R)<<18|(63&A[O++])<<12|(63&A[O++])<<6|63&A[O++])-65536,xe[ne++]=55296+(R>>10),xe[ne++]=56320+(1023&R)):xe[ne++]=(15&R)<<12|(63&A[O++])<<6|63&A[O++],ne>8191&&((ee||(ee=[])).push(String.fromCharCode.apply(String,xe)),ne=0);return ee?(ne&&ee.push(String.fromCharCode.apply(String,xe.slice(0,ne))),ee.join("")):String.fromCharCode.apply(String,xe.slice(0,ne))},l.write=function(A,O,Y){for(var R,ee,xe=Y,ne=0;ne<A.length;++ne)(R=A.charCodeAt(ne))<128?O[Y++]=R:R<2048?(O[Y++]=R>>6|192,O[Y++]=63&R|128):(64512&R)==55296&&(64512&(ee=A.charCodeAt(ne+1)))==56320?(R=65536+((1023&R)<<10)+(1023&ee),++ne,O[Y++]=R>>18|240,O[Y++]=R>>12&63|128,O[Y++]=R>>6&63|128,O[Y++]=63&R|128):(O[Y++]=R>>12|224,O[Y++]=R>>6&63|128,O[Y++]=63&R|128);return Y-xe}},3442:(g,a)=>{a.__esModule=!0;var l=(function(){function A(O){if(!O)throw new TypeError("Invalid argument; `value` has no value.");this.value=A.EMPTY,O&&A.isGuid(O)&&(this.value=O)}return A.isGuid=function(O){var Y=O.toString();return O&&(O instanceof A||A.validator.test(Y))},A.create=function(){return new A([A.gen(2),A.gen(1),A.gen(1),A.gen(1),A.gen(3)].join("-"))},A.createEmpty=function(){return new A("emptyguid")},A.parse=function(O){return new A(O)},A.raw=function(){return[A.gen(2),A.gen(1),A.gen(1),A.gen(1),A.gen(3)].join("-")},A.gen=function(O){for(var Y="",R=0;R<O;R++)Y+=(65536*(1+Math.random())|0).toString(16).substring(1);return Y},A.prototype.equals=function(O){return A.isGuid(O)&&this.value===O.toString()},A.prototype.isEmpty=function(){return this.value===A.EMPTY},A.prototype.toString=function(){return this.value},A.prototype.toJSON=function(){return{value:this.value}},A.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),A.EMPTY="00000000-0000-0000-0000-000000000000",A})();a.Guid=l},3720:g=>{g.exports=l;var a=null;try{a=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function l(ut,_t,At){this.low=0|ut,this.high=0|_t,this.unsigned=!!At}function A(ut){return(ut&&ut.__isLong__)===!0}l.prototype.__isLong__,Object.defineProperty(l.prototype,"__isLong__",{value:!0}),l.isLong=A;var O={},Y={};function R(ut,_t){var At,Et,Mt;return _t?(Mt=0<=(ut>>>=0)&&ut<256)&&(Et=Y[ut])?Et:(At=xe(ut,(0|ut)<0?-1:0,!0),Mt&&(Y[ut]=At),At):(Mt=-128<=(ut|=0)&&ut<128)&&(Et=O[ut])?Et:(At=xe(ut,ut<0?-1:0,!1),Mt&&(O[ut]=At),At)}function ee(ut,_t){if(isNaN(ut))return _t?tt:et;if(_t){if(ut<0)return tt;if(ut>=H)return at}else{if(ut<=-Z)return ct;if(ut+1>=Z)return st}return ut<0?ee(-ut,_t).neg():xe(ut%d|0,ut/d|0,_t)}function xe(ut,_t,At){return new l(ut,_t,At)}l.fromInt=R,l.fromNumber=ee,l.fromBits=xe;var ne=Math.pow;function te(ut,_t,At){if(ut.length===0)throw Error("empty string");if(ut==="NaN"||ut==="Infinity"||ut==="+Infinity"||ut==="-Infinity")return et;if(typeof _t=="number"?(At=_t,_t=!1):_t=!!_t,(At=At||10)<2||36<At)throw RangeError("radix");var Et;if((Et=ut.indexOf("-"))>0)throw Error("interior hyphen");if(Et===0)return te(ut.substring(1),_t,At).neg();for(var Mt=ee(ne(At,8)),Ot=et,kt=0;kt<ut.length;kt+=8){var yt=Math.min(8,ut.length-kt),St=parseInt(ut.substring(kt,kt+yt),At);if(yt<8){var Yt=ee(ne(At,yt));Ot=Ot.mul(Yt).add(ee(St))}else Ot=(Ot=Ot.mul(Mt)).add(ee(St))}return Ot.unsigned=_t,Ot}function f(ut,_t){return typeof ut=="number"?ee(ut,_t):typeof ut=="string"?te(ut,_t):xe(ut.low,ut.high,typeof _t=="boolean"?_t:ut.unsigned)}l.fromString=te,l.fromValue=f;var d=4294967296,H=d*d,Z=H/2,Ye=R(1<<24),et=R(0);l.ZERO=et;var tt=R(0,!0);l.UZERO=tt;var nt=R(1);l.ONE=nt;var it=R(1,!0);l.UONE=it;var ot=R(-1);l.NEG_ONE=ot;var st=xe(-1,2147483647,!1);l.MAX_VALUE=st;var at=xe(-1,-1,!0);l.MAX_UNSIGNED_VALUE=at;var ct=xe(0,-2147483648,!1);l.MIN_VALUE=ct;var ft=l.prototype;ft.toInt=function(){return this.unsigned?this.low>>>0:this.low},ft.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},ft.toString=function(ut){if((ut=ut||10)<2||36<ut)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ct)){var _t=ee(ut),At=this.div(_t),Et=At.mul(_t).sub(this);return At.toString(ut)+Et.toInt().toString(ut)}return"-"+this.neg().toString(ut)}for(var Mt=ee(ne(ut,6),this.unsigned),Ot=this,kt="";;){var yt=Ot.div(Mt),St=(Ot.sub(yt.mul(Mt)).toInt()>>>0).toString(ut);if((Ot=yt).isZero())return St+kt;for(;St.length<6;)St="0"+St;kt=""+St+kt}},ft.getHighBits=function(){return this.high},ft.getHighBitsUnsigned=function(){return this.high>>>0},ft.getLowBits=function(){return this.low},ft.getLowBitsUnsigned=function(){return this.low>>>0},ft.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ct)?64:this.neg().getNumBitsAbs();for(var ut=this.high!=0?this.high:this.low,_t=31;_t>0&&(ut&1<<_t)==0;_t--);return this.high!=0?_t+33:_t+1},ft.isZero=function(){return this.high===0&&this.low===0},ft.eqz=ft.isZero,ft.isNegative=function(){return!this.unsigned&&this.high<0},ft.isPositive=function(){return this.unsigned||this.high>=0},ft.isOdd=function(){return(1&this.low)==1},ft.isEven=function(){return(1&this.low)==0},ft.equals=function(ut){return A(ut)||(ut=f(ut)),(this.unsigned===ut.unsigned||this.high>>>31!=1||ut.high>>>31!=1)&&this.high===ut.high&&this.low===ut.low},ft.eq=ft.equals,ft.notEquals=function(ut){return!this.eq(ut)},ft.neq=ft.notEquals,ft.ne=ft.notEquals,ft.lessThan=function(ut){return this.comp(ut)<0},ft.lt=ft.lessThan,ft.lessThanOrEqual=function(ut){return this.comp(ut)<=0},ft.lte=ft.lessThanOrEqual,ft.le=ft.lessThanOrEqual,ft.greaterThan=function(ut){return this.comp(ut)>0},ft.gt=ft.greaterThan,ft.greaterThanOrEqual=function(ut){return this.comp(ut)>=0},ft.gte=ft.greaterThanOrEqual,ft.ge=ft.greaterThanOrEqual,ft.compare=function(ut){if(A(ut)||(ut=f(ut)),this.eq(ut))return 0;var _t=this.isNegative(),At=ut.isNegative();return _t&&!At?-1:!_t&&At?1:this.unsigned?ut.high>>>0>this.high>>>0||ut.high===this.high&&ut.low>>>0>this.low>>>0?-1:1:this.sub(ut).isNegative()?-1:1},ft.comp=ft.compare,ft.negate=function(){return!this.unsigned&&this.eq(ct)?ct:this.not().add(nt)},ft.neg=ft.negate,ft.add=function(ut){A(ut)||(ut=f(ut));var _t=this.high>>>16,At=65535&this.high,Et=this.low>>>16,Mt=65535&this.low,Ot=ut.high>>>16,kt=65535&ut.high,yt=ut.low>>>16,St=0,Yt=0,Ft=0,ln=0;return Ft+=(ln+=Mt+(65535&ut.low))>>>16,Yt+=(Ft+=Et+yt)>>>16,St+=(Yt+=At+kt)>>>16,St+=_t+Ot,xe((Ft&=65535)<<16|(ln&=65535),(St&=65535)<<16|(Yt&=65535),this.unsigned)},ft.subtract=function(ut){return A(ut)||(ut=f(ut)),this.add(ut.neg())},ft.sub=ft.subtract,ft.multiply=function(ut){if(this.isZero())return et;if(A(ut)||(ut=f(ut)),a)return xe(a.mul(this.low,this.high,ut.low,ut.high),a.get_high(),this.unsigned);if(ut.isZero())return et;if(this.eq(ct))return ut.isOdd()?ct:et;if(ut.eq(ct))return this.isOdd()?ct:et;if(this.isNegative())return ut.isNegative()?this.neg().mul(ut.neg()):this.neg().mul(ut).neg();if(ut.isNegative())return this.mul(ut.neg()).neg();if(this.lt(Ye)&&ut.lt(Ye))return ee(this.toNumber()*ut.toNumber(),this.unsigned);var _t=this.high>>>16,At=65535&this.high,Et=this.low>>>16,Mt=65535&this.low,Ot=ut.high>>>16,kt=65535&ut.high,yt=ut.low>>>16,St=65535&ut.low,Yt=0,Ft=0,ln=0,dn=0;return ln+=(dn+=Mt*St)>>>16,Ft+=(ln+=Et*St)>>>16,ln&=65535,Ft+=(ln+=Mt*yt)>>>16,Yt+=(Ft+=At*St)>>>16,Ft&=65535,Yt+=(Ft+=Et*yt)>>>16,Ft&=65535,Yt+=(Ft+=Mt*kt)>>>16,Yt+=_t*St+At*yt+Et*kt+Mt*Ot,xe((ln&=65535)<<16|(dn&=65535),(Yt&=65535)<<16|(Ft&=65535),this.unsigned)},ft.mul=ft.multiply,ft.divide=function(ut){if(A(ut)||(ut=f(ut)),ut.isZero())throw Error("division by zero");var _t,At,Et;if(a)return this.unsigned||this.high!==-2147483648||ut.low!==-1||ut.high!==-1?xe((this.unsigned?a.div_u:a.div_s)(this.low,this.high,ut.low,ut.high),a.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?tt:et;if(this.unsigned){if(ut.unsigned||(ut=ut.toUnsigned()),ut.gt(this))return tt;if(ut.gt(this.shru(1)))return it;Et=tt}else{if(this.eq(ct))return ut.eq(nt)||ut.eq(ot)?ct:ut.eq(ct)?nt:(_t=this.shr(1).div(ut).shl(1)).eq(et)?ut.isNegative()?nt:ot:(At=this.sub(ut.mul(_t)),Et=_t.add(At.div(ut)));if(ut.eq(ct))return this.unsigned?tt:et;if(this.isNegative())return ut.isNegative()?this.neg().div(ut.neg()):this.neg().div(ut).neg();if(ut.isNegative())return this.div(ut.neg()).neg();Et=et}for(At=this;At.gte(ut);){_t=Math.max(1,Math.floor(At.toNumber()/ut.toNumber()));for(var Mt=Math.ceil(Math.log(_t)/Math.LN2),Ot=Mt<=48?1:ne(2,Mt-48),kt=ee(_t),yt=kt.mul(ut);yt.isNegative()||yt.gt(At);)yt=(kt=ee(_t-=Ot,this.unsigned)).mul(ut);kt.isZero()&&(kt=nt),Et=Et.add(kt),At=At.sub(yt)}return Et},ft.div=ft.divide,ft.modulo=function(ut){return A(ut)||(ut=f(ut)),a?xe((this.unsigned?a.rem_u:a.rem_s)(this.low,this.high,ut.low,ut.high),a.get_high(),this.unsigned):this.sub(this.div(ut).mul(ut))},ft.mod=ft.modulo,ft.rem=ft.modulo,ft.not=function(){return xe(~this.low,~this.high,this.unsigned)},ft.and=function(ut){return A(ut)||(ut=f(ut)),xe(this.low&ut.low,this.high&ut.high,this.unsigned)},ft.or=function(ut){return A(ut)||(ut=f(ut)),xe(this.low|ut.low,this.high|ut.high,this.unsigned)},ft.xor=function(ut){return A(ut)||(ut=f(ut)),xe(this.low^ut.low,this.high^ut.high,this.unsigned)},ft.shiftLeft=function(ut){return A(ut)&&(ut=ut.toInt()),(ut&=63)==0?this:ut<32?xe(this.low<<ut,this.high<<ut|this.low>>>32-ut,this.unsigned):xe(0,this.low<<ut-32,this.unsigned)},ft.shl=ft.shiftLeft,ft.shiftRight=function(ut){return A(ut)&&(ut=ut.toInt()),(ut&=63)==0?this:ut<32?xe(this.low>>>ut|this.high<<32-ut,this.high>>ut,this.unsigned):xe(this.high>>ut-32,this.high>=0?0:-1,this.unsigned)},ft.shr=ft.shiftRight,ft.shiftRightUnsigned=function(ut){if(A(ut)&&(ut=ut.toInt()),(ut&=63)==0)return this;var _t=this.high;return ut<32?xe(this.low>>>ut|_t<<32-ut,_t>>>ut,this.unsigned):xe(ut===32?_t:_t>>>ut-32,0,this.unsigned)},ft.shru=ft.shiftRightUnsigned,ft.shr_u=ft.shiftRightUnsigned,ft.toSigned=function(){return this.unsigned?xe(this.low,this.high,!1):this},ft.toUnsigned=function(){return this.unsigned?this:xe(this.low,this.high,!0)},ft.toBytes=function(ut){return ut?this.toBytesLE():this.toBytesBE()},ft.toBytesLE=function(){var ut=this.high,_t=this.low;return[255&_t,_t>>>8&255,_t>>>16&255,_t>>>24,255&ut,ut>>>8&255,ut>>>16&255,ut>>>24]},ft.toBytesBE=function(){var ut=this.high,_t=this.low;return[ut>>>24,ut>>>16&255,ut>>>8&255,255&ut,_t>>>24,_t>>>16&255,_t>>>8&255,255&_t]},l.fromBytes=function(ut,_t,At){return At?l.fromBytesLE(ut,_t):l.fromBytesBE(ut,_t)},l.fromBytesLE=function(ut,_t){return new l(ut[0]|ut[1]<<8|ut[2]<<16|ut[3]<<24,ut[4]|ut[5]<<8|ut[6]<<16|ut[7]<<24,_t)},l.fromBytesBE=function(ut,_t){return new l(ut[4]<<24|ut[5]<<16|ut[6]<<8|ut[7],ut[0]<<24|ut[1]<<16|ut[2]<<8|ut[3],_t)}},1446:(g,a,l)=>{var A,O,Y,R=l(2100),ee=R.Reader,xe=R.Writer,ne=R.util,te=R.roots.default||(R.roots.default={});te.onnx=((Y={}).Version=(A={},(O=Object.create(A))[A[0]="_START_VERSION"]=0,O[A[1]="IR_VERSION_2017_10_10"]=1,O[A[2]="IR_VERSION_2017_10_30"]=2,O[A[3]="IR_VERSION_2017_11_3"]=3,O[A[4]="IR_VERSION_2019_1_22"]=4,O[A[5]="IR_VERSION"]=5,O),Y.AttributeProto=(function(){function f(d){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.name="",f.prototype.refAttrName="",f.prototype.docString="",f.prototype.type=0,f.prototype.f=0,f.prototype.i=ne.Long?ne.Long.fromBits(0,0,!1):0,f.prototype.s=ne.newBuffer([]),f.prototype.t=null,f.prototype.g=null,f.prototype.floats=ne.emptyArray,f.prototype.ints=ne.emptyArray,f.prototype.strings=ne.emptyArray,f.prototype.tensors=ne.emptyArray,f.prototype.graphs=ne.emptyArray,f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.name!=null&&d.hasOwnProperty("name")&&H.uint32(10).string(d.name),d.f!=null&&d.hasOwnProperty("f")&&H.uint32(21).float(d.f),d.i!=null&&d.hasOwnProperty("i")&&H.uint32(24).int64(d.i),d.s!=null&&d.hasOwnProperty("s")&&H.uint32(34).bytes(d.s),d.t!=null&&d.hasOwnProperty("t")&&te.onnx.TensorProto.encode(d.t,H.uint32(42).fork()).ldelim(),d.g!=null&&d.hasOwnProperty("g")&&te.onnx.GraphProto.encode(d.g,H.uint32(50).fork()).ldelim(),d.floats!=null&&d.floats.length){H.uint32(58).fork();for(var Z=0;Z<d.floats.length;++Z)H.float(d.floats[Z]);H.ldelim()}if(d.ints!=null&&d.ints.length){for(H.uint32(66).fork(),Z=0;Z<d.ints.length;++Z)H.int64(d.ints[Z]);H.ldelim()}if(d.strings!=null&&d.strings.length)for(Z=0;Z<d.strings.length;++Z)H.uint32(74).bytes(d.strings[Z]);if(d.tensors!=null&&d.tensors.length)for(Z=0;Z<d.tensors.length;++Z)te.onnx.TensorProto.encode(d.tensors[Z],H.uint32(82).fork()).ldelim();if(d.graphs!=null&&d.graphs.length)for(Z=0;Z<d.graphs.length;++Z)te.onnx.GraphProto.encode(d.graphs[Z],H.uint32(90).fork()).ldelim();return d.docString!=null&&d.hasOwnProperty("docString")&&H.uint32(106).string(d.docString),d.type!=null&&d.hasOwnProperty("type")&&H.uint32(160).int32(d.type),d.refAttrName!=null&&d.hasOwnProperty("refAttrName")&&H.uint32(170).string(d.refAttrName),H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.AttributeProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.name=d.string();break;case 21:Ye.refAttrName=d.string();break;case 13:Ye.docString=d.string();break;case 20:Ye.type=d.int32();break;case 2:Ye.f=d.float();break;case 3:Ye.i=d.int64();break;case 4:Ye.s=d.bytes();break;case 5:Ye.t=te.onnx.TensorProto.decode(d,d.uint32());break;case 6:Ye.g=te.onnx.GraphProto.decode(d,d.uint32());break;case 7:if(Ye.floats&&Ye.floats.length||(Ye.floats=[]),(7&et)==2)for(var tt=d.uint32()+d.pos;d.pos<tt;)Ye.floats.push(d.float());else Ye.floats.push(d.float());break;case 8:if(Ye.ints&&Ye.ints.length||(Ye.ints=[]),(7&et)==2)for(tt=d.uint32()+d.pos;d.pos<tt;)Ye.ints.push(d.int64());else Ye.ints.push(d.int64());break;case 9:Ye.strings&&Ye.strings.length||(Ye.strings=[]),Ye.strings.push(d.bytes());break;case 10:Ye.tensors&&Ye.tensors.length||(Ye.tensors=[]),Ye.tensors.push(te.onnx.TensorProto.decode(d,d.uint32()));break;case 11:Ye.graphs&&Ye.graphs.length||(Ye.graphs=[]),Ye.graphs.push(te.onnx.GraphProto.decode(d,d.uint32()));break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.name!=null&&d.hasOwnProperty("name")&&!ne.isString(d.name))return"name: string expected";if(d.refAttrName!=null&&d.hasOwnProperty("refAttrName")&&!ne.isString(d.refAttrName))return"refAttrName: string expected";if(d.docString!=null&&d.hasOwnProperty("docString")&&!ne.isString(d.docString))return"docString: string expected";if(d.type!=null&&d.hasOwnProperty("type"))switch(d.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}if(d.f!=null&&d.hasOwnProperty("f")&&typeof d.f!="number")return"f: number expected";if(d.i!=null&&d.hasOwnProperty("i")&&!(ne.isInteger(d.i)||d.i&&ne.isInteger(d.i.low)&&ne.isInteger(d.i.high)))return"i: integer|Long expected";if(d.s!=null&&d.hasOwnProperty("s")&&!(d.s&&typeof d.s.length=="number"||ne.isString(d.s)))return"s: buffer expected";if(d.t!=null&&d.hasOwnProperty("t")&&(Z=te.onnx.TensorProto.verify(d.t)))return"t."+Z;if(d.g!=null&&d.hasOwnProperty("g")&&(Z=te.onnx.GraphProto.verify(d.g)))return"g."+Z;if(d.floats!=null&&d.hasOwnProperty("floats")){if(!Array.isArray(d.floats))return"floats: array expected";for(var H=0;H<d.floats.length;++H)if(typeof d.floats[H]!="number")return"floats: number[] expected"}if(d.ints!=null&&d.hasOwnProperty("ints")){if(!Array.isArray(d.ints))return"ints: array expected";for(H=0;H<d.ints.length;++H)if(!(ne.isInteger(d.ints[H])||d.ints[H]&&ne.isInteger(d.ints[H].low)&&ne.isInteger(d.ints[H].high)))return"ints: integer|Long[] expected"}if(d.strings!=null&&d.hasOwnProperty("strings")){if(!Array.isArray(d.strings))return"strings: array expected";for(H=0;H<d.strings.length;++H)if(!(d.strings[H]&&typeof d.strings[H].length=="number"||ne.isString(d.strings[H])))return"strings: buffer[] expected"}if(d.tensors!=null&&d.hasOwnProperty("tensors")){if(!Array.isArray(d.tensors))return"tensors: array expected";for(H=0;H<d.tensors.length;++H)if(Z=te.onnx.TensorProto.verify(d.tensors[H]))return"tensors."+Z}if(d.graphs!=null&&d.hasOwnProperty("graphs")){if(!Array.isArray(d.graphs))return"graphs: array expected";for(H=0;H<d.graphs.length;++H){var Z;if(Z=te.onnx.GraphProto.verify(d.graphs[H]))return"graphs."+Z}}return null},f.fromObject=function(d){if(d instanceof te.onnx.AttributeProto)return d;var H=new te.onnx.AttributeProto;switch(d.name!=null&&(H.name=String(d.name)),d.refAttrName!=null&&(H.refAttrName=String(d.refAttrName)),d.docString!=null&&(H.docString=String(d.docString)),d.type){case"UNDEFINED":case 0:H.type=0;break;case"FLOAT":case 1:H.type=1;break;case"INT":case 2:H.type=2;break;case"STRING":case 3:H.type=3;break;case"TENSOR":case 4:H.type=4;break;case"GRAPH":case 5:H.type=5;break;case"FLOATS":case 6:H.type=6;break;case"INTS":case 7:H.type=7;break;case"STRINGS":case 8:H.type=8;break;case"TENSORS":case 9:H.type=9;break;case"GRAPHS":case 10:H.type=10}if(d.f!=null&&(H.f=Number(d.f)),d.i!=null&&(ne.Long?(H.i=ne.Long.fromValue(d.i)).unsigned=!1:typeof d.i=="string"?H.i=parseInt(d.i,10):typeof d.i=="number"?H.i=d.i:typeof d.i=="object"&&(H.i=new ne.LongBits(d.i.low>>>0,d.i.high>>>0).toNumber())),d.s!=null&&(typeof d.s=="string"?ne.base64.decode(d.s,H.s=ne.newBuffer(ne.base64.length(d.s)),0):d.s.length&&(H.s=d.s)),d.t!=null){if(typeof d.t!="object")throw TypeError(".onnx.AttributeProto.t: object expected");H.t=te.onnx.TensorProto.fromObject(d.t)}if(d.g!=null){if(typeof d.g!="object")throw TypeError(".onnx.AttributeProto.g: object expected");H.g=te.onnx.GraphProto.fromObject(d.g)}if(d.floats){if(!Array.isArray(d.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");H.floats=[];for(var Z=0;Z<d.floats.length;++Z)H.floats[Z]=Number(d.floats[Z])}if(d.ints){if(!Array.isArray(d.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");for(H.ints=[],Z=0;Z<d.ints.length;++Z)ne.Long?(H.ints[Z]=ne.Long.fromValue(d.ints[Z])).unsigned=!1:typeof d.ints[Z]=="string"?H.ints[Z]=parseInt(d.ints[Z],10):typeof d.ints[Z]=="number"?H.ints[Z]=d.ints[Z]:typeof d.ints[Z]=="object"&&(H.ints[Z]=new ne.LongBits(d.ints[Z].low>>>0,d.ints[Z].high>>>0).toNumber())}if(d.strings){if(!Array.isArray(d.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");for(H.strings=[],Z=0;Z<d.strings.length;++Z)typeof d.strings[Z]=="string"?ne.base64.decode(d.strings[Z],H.strings[Z]=ne.newBuffer(ne.base64.length(d.strings[Z])),0):d.strings[Z].length&&(H.strings[Z]=d.strings[Z])}if(d.tensors){if(!Array.isArray(d.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");for(H.tensors=[],Z=0;Z<d.tensors.length;++Z){if(typeof d.tensors[Z]!="object")throw TypeError(".onnx.AttributeProto.tensors: object expected");H.tensors[Z]=te.onnx.TensorProto.fromObject(d.tensors[Z])}}if(d.graphs){if(!Array.isArray(d.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");for(H.graphs=[],Z=0;Z<d.graphs.length;++Z){if(typeof d.graphs[Z]!="object")throw TypeError(".onnx.AttributeProto.graphs: object expected");H.graphs[Z]=te.onnx.GraphProto.fromObject(d.graphs[Z])}}return H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.floats=[],Z.ints=[],Z.strings=[],Z.tensors=[],Z.graphs=[]),H.defaults){if(Z.name="",Z.f=0,ne.Long){var Ye=new ne.Long(0,0,!1);Z.i=H.longs===String?Ye.toString():H.longs===Number?Ye.toNumber():Ye}else Z.i=H.longs===String?"0":0;H.bytes===String?Z.s="":(Z.s=[],H.bytes!==Array&&(Z.s=ne.newBuffer(Z.s))),Z.t=null,Z.g=null,Z.docString="",Z.type=H.enums===String?"UNDEFINED":0,Z.refAttrName=""}if(d.name!=null&&d.hasOwnProperty("name")&&(Z.name=d.name),d.f!=null&&d.hasOwnProperty("f")&&(Z.f=H.json&&!isFinite(d.f)?String(d.f):d.f),d.i!=null&&d.hasOwnProperty("i")&&(typeof d.i=="number"?Z.i=H.longs===String?String(d.i):d.i:Z.i=H.longs===String?ne.Long.prototype.toString.call(d.i):H.longs===Number?new ne.LongBits(d.i.low>>>0,d.i.high>>>0).toNumber():d.i),d.s!=null&&d.hasOwnProperty("s")&&(Z.s=H.bytes===String?ne.base64.encode(d.s,0,d.s.length):H.bytes===Array?Array.prototype.slice.call(d.s):d.s),d.t!=null&&d.hasOwnProperty("t")&&(Z.t=te.onnx.TensorProto.toObject(d.t,H)),d.g!=null&&d.hasOwnProperty("g")&&(Z.g=te.onnx.GraphProto.toObject(d.g,H)),d.floats&&d.floats.length){Z.floats=[];for(var et=0;et<d.floats.length;++et)Z.floats[et]=H.json&&!isFinite(d.floats[et])?String(d.floats[et]):d.floats[et]}if(d.ints&&d.ints.length)for(Z.ints=[],et=0;et<d.ints.length;++et)typeof d.ints[et]=="number"?Z.ints[et]=H.longs===String?String(d.ints[et]):d.ints[et]:Z.ints[et]=H.longs===String?ne.Long.prototype.toString.call(d.ints[et]):H.longs===Number?new ne.LongBits(d.ints[et].low>>>0,d.ints[et].high>>>0).toNumber():d.ints[et];if(d.strings&&d.strings.length)for(Z.strings=[],et=0;et<d.strings.length;++et)Z.strings[et]=H.bytes===String?ne.base64.encode(d.strings[et],0,d.strings[et].length):H.bytes===Array?Array.prototype.slice.call(d.strings[et]):d.strings[et];if(d.tensors&&d.tensors.length)for(Z.tensors=[],et=0;et<d.tensors.length;++et)Z.tensors[et]=te.onnx.TensorProto.toObject(d.tensors[et],H);if(d.graphs&&d.graphs.length)for(Z.graphs=[],et=0;et<d.graphs.length;++et)Z.graphs[et]=te.onnx.GraphProto.toObject(d.graphs[et],H);return d.docString!=null&&d.hasOwnProperty("docString")&&(Z.docString=d.docString),d.type!=null&&d.hasOwnProperty("type")&&(Z.type=H.enums===String?te.onnx.AttributeProto.AttributeType[d.type]:d.type),d.refAttrName!=null&&d.hasOwnProperty("refAttrName")&&(Z.refAttrName=d.refAttrName),Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f.AttributeType=(function(){var d={},H=Object.create(d);return H[d[0]="UNDEFINED"]=0,H[d[1]="FLOAT"]=1,H[d[2]="INT"]=2,H[d[3]="STRING"]=3,H[d[4]="TENSOR"]=4,H[d[5]="GRAPH"]=5,H[d[6]="FLOATS"]=6,H[d[7]="INTS"]=7,H[d[8]="STRINGS"]=8,H[d[9]="TENSORS"]=9,H[d[10]="GRAPHS"]=10,H})(),f})(),Y.ValueInfoProto=(function(){function f(d){if(d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.name="",f.prototype.type=null,f.prototype.docString="",f.create=function(d){return new f(d)},f.encode=function(d,H){return H||(H=xe.create()),d.name!=null&&d.hasOwnProperty("name")&&H.uint32(10).string(d.name),d.type!=null&&d.hasOwnProperty("type")&&te.onnx.TypeProto.encode(d.type,H.uint32(18).fork()).ldelim(),d.docString!=null&&d.hasOwnProperty("docString")&&H.uint32(26).string(d.docString),H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.ValueInfoProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.name=d.string();break;case 2:Ye.type=te.onnx.TypeProto.decode(d,d.uint32());break;case 3:Ye.docString=d.string();break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.name!=null&&d.hasOwnProperty("name")&&!ne.isString(d.name))return"name: string expected";if(d.type!=null&&d.hasOwnProperty("type")){var H=te.onnx.TypeProto.verify(d.type);if(H)return"type."+H}return d.docString!=null&&d.hasOwnProperty("docString")&&!ne.isString(d.docString)?"docString: string expected":null},f.fromObject=function(d){if(d instanceof te.onnx.ValueInfoProto)return d;var H=new te.onnx.ValueInfoProto;if(d.name!=null&&(H.name=String(d.name)),d.type!=null){if(typeof d.type!="object")throw TypeError(".onnx.ValueInfoProto.type: object expected");H.type=te.onnx.TypeProto.fromObject(d.type)}return d.docString!=null&&(H.docString=String(d.docString)),H},f.toObject=function(d,H){H||(H={});var Z={};return H.defaults&&(Z.name="",Z.type=null,Z.docString=""),d.name!=null&&d.hasOwnProperty("name")&&(Z.name=d.name),d.type!=null&&d.hasOwnProperty("type")&&(Z.type=te.onnx.TypeProto.toObject(d.type,H)),d.docString!=null&&d.hasOwnProperty("docString")&&(Z.docString=d.docString),Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y.NodeProto=(function(){function f(d){if(this.input=[],this.output=[],this.attribute=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.input=ne.emptyArray,f.prototype.output=ne.emptyArray,f.prototype.name="",f.prototype.opType="",f.prototype.domain="",f.prototype.attribute=ne.emptyArray,f.prototype.docString="",f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.input!=null&&d.input.length)for(var Z=0;Z<d.input.length;++Z)H.uint32(10).string(d.input[Z]);if(d.output!=null&&d.output.length)for(Z=0;Z<d.output.length;++Z)H.uint32(18).string(d.output[Z]);if(d.name!=null&&d.hasOwnProperty("name")&&H.uint32(26).string(d.name),d.opType!=null&&d.hasOwnProperty("opType")&&H.uint32(34).string(d.opType),d.attribute!=null&&d.attribute.length)for(Z=0;Z<d.attribute.length;++Z)te.onnx.AttributeProto.encode(d.attribute[Z],H.uint32(42).fork()).ldelim();return d.docString!=null&&d.hasOwnProperty("docString")&&H.uint32(50).string(d.docString),d.domain!=null&&d.hasOwnProperty("domain")&&H.uint32(58).string(d.domain),H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.NodeProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.input&&Ye.input.length||(Ye.input=[]),Ye.input.push(d.string());break;case 2:Ye.output&&Ye.output.length||(Ye.output=[]),Ye.output.push(d.string());break;case 3:Ye.name=d.string();break;case 4:Ye.opType=d.string();break;case 7:Ye.domain=d.string();break;case 5:Ye.attribute&&Ye.attribute.length||(Ye.attribute=[]),Ye.attribute.push(te.onnx.AttributeProto.decode(d,d.uint32()));break;case 6:Ye.docString=d.string();break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.input!=null&&d.hasOwnProperty("input")){if(!Array.isArray(d.input))return"input: array expected";for(var H=0;H<d.input.length;++H)if(!ne.isString(d.input[H]))return"input: string[] expected"}if(d.output!=null&&d.hasOwnProperty("output")){if(!Array.isArray(d.output))return"output: array expected";for(H=0;H<d.output.length;++H)if(!ne.isString(d.output[H]))return"output: string[] expected"}if(d.name!=null&&d.hasOwnProperty("name")&&!ne.isString(d.name))return"name: string expected";if(d.opType!=null&&d.hasOwnProperty("opType")&&!ne.isString(d.opType))return"opType: string expected";if(d.domain!=null&&d.hasOwnProperty("domain")&&!ne.isString(d.domain))return"domain: string expected";if(d.attribute!=null&&d.hasOwnProperty("attribute")){if(!Array.isArray(d.attribute))return"attribute: array expected";for(H=0;H<d.attribute.length;++H){var Z=te.onnx.AttributeProto.verify(d.attribute[H]);if(Z)return"attribute."+Z}}return d.docString!=null&&d.hasOwnProperty("docString")&&!ne.isString(d.docString)?"docString: string expected":null},f.fromObject=function(d){if(d instanceof te.onnx.NodeProto)return d;var H=new te.onnx.NodeProto;if(d.input){if(!Array.isArray(d.input))throw TypeError(".onnx.NodeProto.input: array expected");H.input=[];for(var Z=0;Z<d.input.length;++Z)H.input[Z]=String(d.input[Z])}if(d.output){if(!Array.isArray(d.output))throw TypeError(".onnx.NodeProto.output: array expected");for(H.output=[],Z=0;Z<d.output.length;++Z)H.output[Z]=String(d.output[Z])}if(d.name!=null&&(H.name=String(d.name)),d.opType!=null&&(H.opType=String(d.opType)),d.domain!=null&&(H.domain=String(d.domain)),d.attribute){if(!Array.isArray(d.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");for(H.attribute=[],Z=0;Z<d.attribute.length;++Z){if(typeof d.attribute[Z]!="object")throw TypeError(".onnx.NodeProto.attribute: object expected");H.attribute[Z]=te.onnx.AttributeProto.fromObject(d.attribute[Z])}}return d.docString!=null&&(H.docString=String(d.docString)),H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.input=[],Z.output=[],Z.attribute=[]),H.defaults&&(Z.name="",Z.opType="",Z.docString="",Z.domain=""),d.input&&d.input.length){Z.input=[];for(var Ye=0;Ye<d.input.length;++Ye)Z.input[Ye]=d.input[Ye]}if(d.output&&d.output.length)for(Z.output=[],Ye=0;Ye<d.output.length;++Ye)Z.output[Ye]=d.output[Ye];if(d.name!=null&&d.hasOwnProperty("name")&&(Z.name=d.name),d.opType!=null&&d.hasOwnProperty("opType")&&(Z.opType=d.opType),d.attribute&&d.attribute.length)for(Z.attribute=[],Ye=0;Ye<d.attribute.length;++Ye)Z.attribute[Ye]=te.onnx.AttributeProto.toObject(d.attribute[Ye],H);return d.docString!=null&&d.hasOwnProperty("docString")&&(Z.docString=d.docString),d.domain!=null&&d.hasOwnProperty("domain")&&(Z.domain=d.domain),Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y.ModelProto=(function(){function f(d){if(this.opsetImport=[],this.metadataProps=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.irVersion=ne.Long?ne.Long.fromBits(0,0,!1):0,f.prototype.opsetImport=ne.emptyArray,f.prototype.producerName="",f.prototype.producerVersion="",f.prototype.domain="",f.prototype.modelVersion=ne.Long?ne.Long.fromBits(0,0,!1):0,f.prototype.docString="",f.prototype.graph=null,f.prototype.metadataProps=ne.emptyArray,f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.irVersion!=null&&d.hasOwnProperty("irVersion")&&H.uint32(8).int64(d.irVersion),d.producerName!=null&&d.hasOwnProperty("producerName")&&H.uint32(18).string(d.producerName),d.producerVersion!=null&&d.hasOwnProperty("producerVersion")&&H.uint32(26).string(d.producerVersion),d.domain!=null&&d.hasOwnProperty("domain")&&H.uint32(34).string(d.domain),d.modelVersion!=null&&d.hasOwnProperty("modelVersion")&&H.uint32(40).int64(d.modelVersion),d.docString!=null&&d.hasOwnProperty("docString")&&H.uint32(50).string(d.docString),d.graph!=null&&d.hasOwnProperty("graph")&&te.onnx.GraphProto.encode(d.graph,H.uint32(58).fork()).ldelim(),d.opsetImport!=null&&d.opsetImport.length)for(var Z=0;Z<d.opsetImport.length;++Z)te.onnx.OperatorSetIdProto.encode(d.opsetImport[Z],H.uint32(66).fork()).ldelim();if(d.metadataProps!=null&&d.metadataProps.length)for(Z=0;Z<d.metadataProps.length;++Z)te.onnx.StringStringEntryProto.encode(d.metadataProps[Z],H.uint32(114).fork()).ldelim();return H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.ModelProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.irVersion=d.int64();break;case 8:Ye.opsetImport&&Ye.opsetImport.length||(Ye.opsetImport=[]),Ye.opsetImport.push(te.onnx.OperatorSetIdProto.decode(d,d.uint32()));break;case 2:Ye.producerName=d.string();break;case 3:Ye.producerVersion=d.string();break;case 4:Ye.domain=d.string();break;case 5:Ye.modelVersion=d.int64();break;case 6:Ye.docString=d.string();break;case 7:Ye.graph=te.onnx.GraphProto.decode(d,d.uint32());break;case 14:Ye.metadataProps&&Ye.metadataProps.length||(Ye.metadataProps=[]),Ye.metadataProps.push(te.onnx.StringStringEntryProto.decode(d,d.uint32()));break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.irVersion!=null&&d.hasOwnProperty("irVersion")&&!(ne.isInteger(d.irVersion)||d.irVersion&&ne.isInteger(d.irVersion.low)&&ne.isInteger(d.irVersion.high)))return"irVersion: integer|Long expected";if(d.opsetImport!=null&&d.hasOwnProperty("opsetImport")){if(!Array.isArray(d.opsetImport))return"opsetImport: array expected";for(var H=0;H<d.opsetImport.length;++H)if(Z=te.onnx.OperatorSetIdProto.verify(d.opsetImport[H]))return"opsetImport."+Z}if(d.producerName!=null&&d.hasOwnProperty("producerName")&&!ne.isString(d.producerName))return"producerName: string expected";if(d.producerVersion!=null&&d.hasOwnProperty("producerVersion")&&!ne.isString(d.producerVersion))return"producerVersion: string expected";if(d.domain!=null&&d.hasOwnProperty("domain")&&!ne.isString(d.domain))return"domain: string expected";if(d.modelVersion!=null&&d.hasOwnProperty("modelVersion")&&!(ne.isInteger(d.modelVersion)||d.modelVersion&&ne.isInteger(d.modelVersion.low)&&ne.isInteger(d.modelVersion.high)))return"modelVersion: integer|Long expected";if(d.docString!=null&&d.hasOwnProperty("docString")&&!ne.isString(d.docString))return"docString: string expected";if(d.graph!=null&&d.hasOwnProperty("graph")&&(Z=te.onnx.GraphProto.verify(d.graph)))return"graph."+Z;if(d.metadataProps!=null&&d.hasOwnProperty("metadataProps")){if(!Array.isArray(d.metadataProps))return"metadataProps: array expected";for(H=0;H<d.metadataProps.length;++H){var Z;if(Z=te.onnx.StringStringEntryProto.verify(d.metadataProps[H]))return"metadataProps."+Z}}return null},f.fromObject=function(d){if(d instanceof te.onnx.ModelProto)return d;var H=new te.onnx.ModelProto;if(d.irVersion!=null&&(ne.Long?(H.irVersion=ne.Long.fromValue(d.irVersion)).unsigned=!1:typeof d.irVersion=="string"?H.irVersion=parseInt(d.irVersion,10):typeof d.irVersion=="number"?H.irVersion=d.irVersion:typeof d.irVersion=="object"&&(H.irVersion=new ne.LongBits(d.irVersion.low>>>0,d.irVersion.high>>>0).toNumber())),d.opsetImport){if(!Array.isArray(d.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");H.opsetImport=[];for(var Z=0;Z<d.opsetImport.length;++Z){if(typeof d.opsetImport[Z]!="object")throw TypeError(".onnx.ModelProto.opsetImport: object expected");H.opsetImport[Z]=te.onnx.OperatorSetIdProto.fromObject(d.opsetImport[Z])}}if(d.producerName!=null&&(H.producerName=String(d.producerName)),d.producerVersion!=null&&(H.producerVersion=String(d.producerVersion)),d.domain!=null&&(H.domain=String(d.domain)),d.modelVersion!=null&&(ne.Long?(H.modelVersion=ne.Long.fromValue(d.modelVersion)).unsigned=!1:typeof d.modelVersion=="string"?H.modelVersion=parseInt(d.modelVersion,10):typeof d.modelVersion=="number"?H.modelVersion=d.modelVersion:typeof d.modelVersion=="object"&&(H.modelVersion=new ne.LongBits(d.modelVersion.low>>>0,d.modelVersion.high>>>0).toNumber())),d.docString!=null&&(H.docString=String(d.docString)),d.graph!=null){if(typeof d.graph!="object")throw TypeError(".onnx.ModelProto.graph: object expected");H.graph=te.onnx.GraphProto.fromObject(d.graph)}if(d.metadataProps){if(!Array.isArray(d.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");for(H.metadataProps=[],Z=0;Z<d.metadataProps.length;++Z){if(typeof d.metadataProps[Z]!="object")throw TypeError(".onnx.ModelProto.metadataProps: object expected");H.metadataProps[Z]=te.onnx.StringStringEntryProto.fromObject(d.metadataProps[Z])}}return H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.opsetImport=[],Z.metadataProps=[]),H.defaults){if(ne.Long){var Ye=new ne.Long(0,0,!1);Z.irVersion=H.longs===String?Ye.toString():H.longs===Number?Ye.toNumber():Ye}else Z.irVersion=H.longs===String?"0":0;Z.producerName="",Z.producerVersion="",Z.domain="",ne.Long?(Ye=new ne.Long(0,0,!1),Z.modelVersion=H.longs===String?Ye.toString():H.longs===Number?Ye.toNumber():Ye):Z.modelVersion=H.longs===String?"0":0,Z.docString="",Z.graph=null}if(d.irVersion!=null&&d.hasOwnProperty("irVersion")&&(typeof d.irVersion=="number"?Z.irVersion=H.longs===String?String(d.irVersion):d.irVersion:Z.irVersion=H.longs===String?ne.Long.prototype.toString.call(d.irVersion):H.longs===Number?new ne.LongBits(d.irVersion.low>>>0,d.irVersion.high>>>0).toNumber():d.irVersion),d.producerName!=null&&d.hasOwnProperty("producerName")&&(Z.producerName=d.producerName),d.producerVersion!=null&&d.hasOwnProperty("producerVersion")&&(Z.producerVersion=d.producerVersion),d.domain!=null&&d.hasOwnProperty("domain")&&(Z.domain=d.domain),d.modelVersion!=null&&d.hasOwnProperty("modelVersion")&&(typeof d.modelVersion=="number"?Z.modelVersion=H.longs===String?String(d.modelVersion):d.modelVersion:Z.modelVersion=H.longs===String?ne.Long.prototype.toString.call(d.modelVersion):H.longs===Number?new ne.LongBits(d.modelVersion.low>>>0,d.modelVersion.high>>>0).toNumber():d.modelVersion),d.docString!=null&&d.hasOwnProperty("docString")&&(Z.docString=d.docString),d.graph!=null&&d.hasOwnProperty("graph")&&(Z.graph=te.onnx.GraphProto.toObject(d.graph,H)),d.opsetImport&&d.opsetImport.length){Z.opsetImport=[];for(var et=0;et<d.opsetImport.length;++et)Z.opsetImport[et]=te.onnx.OperatorSetIdProto.toObject(d.opsetImport[et],H)}if(d.metadataProps&&d.metadataProps.length)for(Z.metadataProps=[],et=0;et<d.metadataProps.length;++et)Z.metadataProps[et]=te.onnx.StringStringEntryProto.toObject(d.metadataProps[et],H);return Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y.StringStringEntryProto=(function(){function f(d){if(d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.key="",f.prototype.value="",f.create=function(d){return new f(d)},f.encode=function(d,H){return H||(H=xe.create()),d.key!=null&&d.hasOwnProperty("key")&&H.uint32(10).string(d.key),d.value!=null&&d.hasOwnProperty("value")&&H.uint32(18).string(d.value),H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.StringStringEntryProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.key=d.string();break;case 2:Ye.value=d.string();break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){return typeof d!="object"||d===null?"object expected":d.key!=null&&d.hasOwnProperty("key")&&!ne.isString(d.key)?"key: string expected":d.value!=null&&d.hasOwnProperty("value")&&!ne.isString(d.value)?"value: string expected":null},f.fromObject=function(d){if(d instanceof te.onnx.StringStringEntryProto)return d;var H=new te.onnx.StringStringEntryProto;return d.key!=null&&(H.key=String(d.key)),d.value!=null&&(H.value=String(d.value)),H},f.toObject=function(d,H){H||(H={});var Z={};return H.defaults&&(Z.key="",Z.value=""),d.key!=null&&d.hasOwnProperty("key")&&(Z.key=d.key),d.value!=null&&d.hasOwnProperty("value")&&(Z.value=d.value),Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y.TensorAnnotation=(function(){function f(d){if(this.quantParameterTensorNames=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.tensorName="",f.prototype.quantParameterTensorNames=ne.emptyArray,f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.tensorName!=null&&d.hasOwnProperty("tensorName")&&H.uint32(10).string(d.tensorName),d.quantParameterTensorNames!=null&&d.quantParameterTensorNames.length)for(var Z=0;Z<d.quantParameterTensorNames.length;++Z)te.onnx.StringStringEntryProto.encode(d.quantParameterTensorNames[Z],H.uint32(18).fork()).ldelim();return H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.TensorAnnotation;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.tensorName=d.string();break;case 2:Ye.quantParameterTensorNames&&Ye.quantParameterTensorNames.length||(Ye.quantParameterTensorNames=[]),Ye.quantParameterTensorNames.push(te.onnx.StringStringEntryProto.decode(d,d.uint32()));break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.tensorName!=null&&d.hasOwnProperty("tensorName")&&!ne.isString(d.tensorName))return"tensorName: string expected";if(d.quantParameterTensorNames!=null&&d.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(d.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var H=0;H<d.quantParameterTensorNames.length;++H){var Z=te.onnx.StringStringEntryProto.verify(d.quantParameterTensorNames[H]);if(Z)return"quantParameterTensorNames."+Z}}return null},f.fromObject=function(d){if(d instanceof te.onnx.TensorAnnotation)return d;var H=new te.onnx.TensorAnnotation;if(d.tensorName!=null&&(H.tensorName=String(d.tensorName)),d.quantParameterTensorNames){if(!Array.isArray(d.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");H.quantParameterTensorNames=[];for(var Z=0;Z<d.quantParameterTensorNames.length;++Z){if(typeof d.quantParameterTensorNames[Z]!="object")throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");H.quantParameterTensorNames[Z]=te.onnx.StringStringEntryProto.fromObject(d.quantParameterTensorNames[Z])}}return H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.quantParameterTensorNames=[]),H.defaults&&(Z.tensorName=""),d.tensorName!=null&&d.hasOwnProperty("tensorName")&&(Z.tensorName=d.tensorName),d.quantParameterTensorNames&&d.quantParameterTensorNames.length){Z.quantParameterTensorNames=[];for(var Ye=0;Ye<d.quantParameterTensorNames.length;++Ye)Z.quantParameterTensorNames[Ye]=te.onnx.StringStringEntryProto.toObject(d.quantParameterTensorNames[Ye],H)}return Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y.GraphProto=(function(){function f(d){if(this.node=[],this.initializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.node=ne.emptyArray,f.prototype.name="",f.prototype.initializer=ne.emptyArray,f.prototype.docString="",f.prototype.input=ne.emptyArray,f.prototype.output=ne.emptyArray,f.prototype.valueInfo=ne.emptyArray,f.prototype.quantizationAnnotation=ne.emptyArray,f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.node!=null&&d.node.length)for(var Z=0;Z<d.node.length;++Z)te.onnx.NodeProto.encode(d.node[Z],H.uint32(10).fork()).ldelim();if(d.name!=null&&d.hasOwnProperty("name")&&H.uint32(18).string(d.name),d.initializer!=null&&d.initializer.length)for(Z=0;Z<d.initializer.length;++Z)te.onnx.TensorProto.encode(d.initializer[Z],H.uint32(42).fork()).ldelim();if(d.docString!=null&&d.hasOwnProperty("docString")&&H.uint32(82).string(d.docString),d.input!=null&&d.input.length)for(Z=0;Z<d.input.length;++Z)te.onnx.ValueInfoProto.encode(d.input[Z],H.uint32(90).fork()).ldelim();if(d.output!=null&&d.output.length)for(Z=0;Z<d.output.length;++Z)te.onnx.ValueInfoProto.encode(d.output[Z],H.uint32(98).fork()).ldelim();if(d.valueInfo!=null&&d.valueInfo.length)for(Z=0;Z<d.valueInfo.length;++Z)te.onnx.ValueInfoProto.encode(d.valueInfo[Z],H.uint32(106).fork()).ldelim();if(d.quantizationAnnotation!=null&&d.quantizationAnnotation.length)for(Z=0;Z<d.quantizationAnnotation.length;++Z)te.onnx.TensorAnnotation.encode(d.quantizationAnnotation[Z],H.uint32(114).fork()).ldelim();return H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.GraphProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.node&&Ye.node.length||(Ye.node=[]),Ye.node.push(te.onnx.NodeProto.decode(d,d.uint32()));break;case 2:Ye.name=d.string();break;case 5:Ye.initializer&&Ye.initializer.length||(Ye.initializer=[]),Ye.initializer.push(te.onnx.TensorProto.decode(d,d.uint32()));break;case 10:Ye.docString=d.string();break;case 11:Ye.input&&Ye.input.length||(Ye.input=[]),Ye.input.push(te.onnx.ValueInfoProto.decode(d,d.uint32()));break;case 12:Ye.output&&Ye.output.length||(Ye.output=[]),Ye.output.push(te.onnx.ValueInfoProto.decode(d,d.uint32()));break;case 13:Ye.valueInfo&&Ye.valueInfo.length||(Ye.valueInfo=[]),Ye.valueInfo.push(te.onnx.ValueInfoProto.decode(d,d.uint32()));break;case 14:Ye.quantizationAnnotation&&Ye.quantizationAnnotation.length||(Ye.quantizationAnnotation=[]),Ye.quantizationAnnotation.push(te.onnx.TensorAnnotation.decode(d,d.uint32()));break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.node!=null&&d.hasOwnProperty("node")){if(!Array.isArray(d.node))return"node: array expected";for(var H=0;H<d.node.length;++H)if(Z=te.onnx.NodeProto.verify(d.node[H]))return"node."+Z}if(d.name!=null&&d.hasOwnProperty("name")&&!ne.isString(d.name))return"name: string expected";if(d.initializer!=null&&d.hasOwnProperty("initializer")){if(!Array.isArray(d.initializer))return"initializer: array expected";for(H=0;H<d.initializer.length;++H)if(Z=te.onnx.TensorProto.verify(d.initializer[H]))return"initializer."+Z}if(d.docString!=null&&d.hasOwnProperty("docString")&&!ne.isString(d.docString))return"docString: string expected";if(d.input!=null&&d.hasOwnProperty("input")){if(!Array.isArray(d.input))return"input: array expected";for(H=0;H<d.input.length;++H)if(Z=te.onnx.ValueInfoProto.verify(d.input[H]))return"input."+Z}if(d.output!=null&&d.hasOwnProperty("output")){if(!Array.isArray(d.output))return"output: array expected";for(H=0;H<d.output.length;++H)if(Z=te.onnx.ValueInfoProto.verify(d.output[H]))return"output."+Z}if(d.valueInfo!=null&&d.hasOwnProperty("valueInfo")){if(!Array.isArray(d.valueInfo))return"valueInfo: array expected";for(H=0;H<d.valueInfo.length;++H)if(Z=te.onnx.ValueInfoProto.verify(d.valueInfo[H]))return"valueInfo."+Z}if(d.quantizationAnnotation!=null&&d.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(d.quantizationAnnotation))return"quantizationAnnotation: array expected";for(H=0;H<d.quantizationAnnotation.length;++H){var Z;if(Z=te.onnx.TensorAnnotation.verify(d.quantizationAnnotation[H]))return"quantizationAnnotation."+Z}}return null},f.fromObject=function(d){if(d instanceof te.onnx.GraphProto)return d;var H=new te.onnx.GraphProto;if(d.node){if(!Array.isArray(d.node))throw TypeError(".onnx.GraphProto.node: array expected");H.node=[];for(var Z=0;Z<d.node.length;++Z){if(typeof d.node[Z]!="object")throw TypeError(".onnx.GraphProto.node: object expected");H.node[Z]=te.onnx.NodeProto.fromObject(d.node[Z])}}if(d.name!=null&&(H.name=String(d.name)),d.initializer){if(!Array.isArray(d.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");for(H.initializer=[],Z=0;Z<d.initializer.length;++Z){if(typeof d.initializer[Z]!="object")throw TypeError(".onnx.GraphProto.initializer: object expected");H.initializer[Z]=te.onnx.TensorProto.fromObject(d.initializer[Z])}}if(d.docString!=null&&(H.docString=String(d.docString)),d.input){if(!Array.isArray(d.input))throw TypeError(".onnx.GraphProto.input: array expected");for(H.input=[],Z=0;Z<d.input.length;++Z){if(typeof d.input[Z]!="object")throw TypeError(".onnx.GraphProto.input: object expected");H.input[Z]=te.onnx.ValueInfoProto.fromObject(d.input[Z])}}if(d.output){if(!Array.isArray(d.output))throw TypeError(".onnx.GraphProto.output: array expected");for(H.output=[],Z=0;Z<d.output.length;++Z){if(typeof d.output[Z]!="object")throw TypeError(".onnx.GraphProto.output: object expected");H.output[Z]=te.onnx.ValueInfoProto.fromObject(d.output[Z])}}if(d.valueInfo){if(!Array.isArray(d.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");for(H.valueInfo=[],Z=0;Z<d.valueInfo.length;++Z){if(typeof d.valueInfo[Z]!="object")throw TypeError(".onnx.GraphProto.valueInfo: object expected");H.valueInfo[Z]=te.onnx.ValueInfoProto.fromObject(d.valueInfo[Z])}}if(d.quantizationAnnotation){if(!Array.isArray(d.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");for(H.quantizationAnnotation=[],Z=0;Z<d.quantizationAnnotation.length;++Z){if(typeof d.quantizationAnnotation[Z]!="object")throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");H.quantizationAnnotation[Z]=te.onnx.TensorAnnotation.fromObject(d.quantizationAnnotation[Z])}}return H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.node=[],Z.initializer=[],Z.input=[],Z.output=[],Z.valueInfo=[],Z.quantizationAnnotation=[]),H.defaults&&(Z.name="",Z.docString=""),d.node&&d.node.length){Z.node=[];for(var Ye=0;Ye<d.node.length;++Ye)Z.node[Ye]=te.onnx.NodeProto.toObject(d.node[Ye],H)}if(d.name!=null&&d.hasOwnProperty("name")&&(Z.name=d.name),d.initializer&&d.initializer.length)for(Z.initializer=[],Ye=0;Ye<d.initializer.length;++Ye)Z.initializer[Ye]=te.onnx.TensorProto.toObject(d.initializer[Ye],H);if(d.docString!=null&&d.hasOwnProperty("docString")&&(Z.docString=d.docString),d.input&&d.input.length)for(Z.input=[],Ye=0;Ye<d.input.length;++Ye)Z.input[Ye]=te.onnx.ValueInfoProto.toObject(d.input[Ye],H);if(d.output&&d.output.length)for(Z.output=[],Ye=0;Ye<d.output.length;++Ye)Z.output[Ye]=te.onnx.ValueInfoProto.toObject(d.output[Ye],H);if(d.valueInfo&&d.valueInfo.length)for(Z.valueInfo=[],Ye=0;Ye<d.valueInfo.length;++Ye)Z.valueInfo[Ye]=te.onnx.ValueInfoProto.toObject(d.valueInfo[Ye],H);if(d.quantizationAnnotation&&d.quantizationAnnotation.length)for(Z.quantizationAnnotation=[],Ye=0;Ye<d.quantizationAnnotation.length;++Ye)Z.quantizationAnnotation[Ye]=te.onnx.TensorAnnotation.toObject(d.quantizationAnnotation[Ye],H);return Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y.TensorProto=(function(){function f(d){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.dims=ne.emptyArray,f.prototype.dataType=0,f.prototype.segment=null,f.prototype.floatData=ne.emptyArray,f.prototype.int32Data=ne.emptyArray,f.prototype.stringData=ne.emptyArray,f.prototype.int64Data=ne.emptyArray,f.prototype.name="",f.prototype.docString="",f.prototype.rawData=ne.newBuffer([]),f.prototype.externalData=ne.emptyArray,f.prototype.dataLocation=0,f.prototype.doubleData=ne.emptyArray,f.prototype.uint64Data=ne.emptyArray,f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.dims!=null&&d.dims.length){H.uint32(10).fork();for(var Z=0;Z<d.dims.length;++Z)H.int64(d.dims[Z]);H.ldelim()}if(d.dataType!=null&&d.hasOwnProperty("dataType")&&H.uint32(16).int32(d.dataType),d.segment!=null&&d.hasOwnProperty("segment")&&te.onnx.TensorProto.Segment.encode(d.segment,H.uint32(26).fork()).ldelim(),d.floatData!=null&&d.floatData.length){for(H.uint32(34).fork(),Z=0;Z<d.floatData.length;++Z)H.float(d.floatData[Z]);H.ldelim()}if(d.int32Data!=null&&d.int32Data.length){for(H.uint32(42).fork(),Z=0;Z<d.int32Data.length;++Z)H.int32(d.int32Data[Z]);H.ldelim()}if(d.stringData!=null&&d.stringData.length)for(Z=0;Z<d.stringData.length;++Z)H.uint32(50).bytes(d.stringData[Z]);if(d.int64Data!=null&&d.int64Data.length){for(H.uint32(58).fork(),Z=0;Z<d.int64Data.length;++Z)H.int64(d.int64Data[Z]);H.ldelim()}if(d.name!=null&&d.hasOwnProperty("name")&&H.uint32(66).string(d.name),d.rawData!=null&&d.hasOwnProperty("rawData")&&H.uint32(74).bytes(d.rawData),d.doubleData!=null&&d.doubleData.length){for(H.uint32(82).fork(),Z=0;Z<d.doubleData.length;++Z)H.double(d.doubleData[Z]);H.ldelim()}if(d.uint64Data!=null&&d.uint64Data.length){for(H.uint32(90).fork(),Z=0;Z<d.uint64Data.length;++Z)H.uint64(d.uint64Data[Z]);H.ldelim()}if(d.docString!=null&&d.hasOwnProperty("docString")&&H.uint32(98).string(d.docString),d.externalData!=null&&d.externalData.length)for(Z=0;Z<d.externalData.length;++Z)te.onnx.StringStringEntryProto.encode(d.externalData[Z],H.uint32(106).fork()).ldelim();return d.dataLocation!=null&&d.hasOwnProperty("dataLocation")&&H.uint32(112).int32(d.dataLocation),H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.TensorProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:if(Ye.dims&&Ye.dims.length||(Ye.dims=[]),(7&et)==2)for(var tt=d.uint32()+d.pos;d.pos<tt;)Ye.dims.push(d.int64());else Ye.dims.push(d.int64());break;case 2:Ye.dataType=d.int32();break;case 3:Ye.segment=te.onnx.TensorProto.Segment.decode(d,d.uint32());break;case 4:if(Ye.floatData&&Ye.floatData.length||(Ye.floatData=[]),(7&et)==2)for(tt=d.uint32()+d.pos;d.pos<tt;)Ye.floatData.push(d.float());else Ye.floatData.push(d.float());break;case 5:if(Ye.int32Data&&Ye.int32Data.length||(Ye.int32Data=[]),(7&et)==2)for(tt=d.uint32()+d.pos;d.pos<tt;)Ye.int32Data.push(d.int32());else Ye.int32Data.push(d.int32());break;case 6:Ye.stringData&&Ye.stringData.length||(Ye.stringData=[]),Ye.stringData.push(d.bytes());break;case 7:if(Ye.int64Data&&Ye.int64Data.length||(Ye.int64Data=[]),(7&et)==2)for(tt=d.uint32()+d.pos;d.pos<tt;)Ye.int64Data.push(d.int64());else Ye.int64Data.push(d.int64());break;case 8:Ye.name=d.string();break;case 12:Ye.docString=d.string();break;case 9:Ye.rawData=d.bytes();break;case 13:Ye.externalData&&Ye.externalData.length||(Ye.externalData=[]),Ye.externalData.push(te.onnx.StringStringEntryProto.decode(d,d.uint32()));break;case 14:Ye.dataLocation=d.int32();break;case 10:if(Ye.doubleData&&Ye.doubleData.length||(Ye.doubleData=[]),(7&et)==2)for(tt=d.uint32()+d.pos;d.pos<tt;)Ye.doubleData.push(d.double());else Ye.doubleData.push(d.double());break;case 11:if(Ye.uint64Data&&Ye.uint64Data.length||(Ye.uint64Data=[]),(7&et)==2)for(tt=d.uint32()+d.pos;d.pos<tt;)Ye.uint64Data.push(d.uint64());else Ye.uint64Data.push(d.uint64());break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.dims!=null&&d.hasOwnProperty("dims")){if(!Array.isArray(d.dims))return"dims: array expected";for(var H=0;H<d.dims.length;++H)if(!(ne.isInteger(d.dims[H])||d.dims[H]&&ne.isInteger(d.dims[H].low)&&ne.isInteger(d.dims[H].high)))return"dims: integer|Long[] expected"}if(d.dataType!=null&&d.hasOwnProperty("dataType")&&!ne.isInteger(d.dataType))return"dataType: integer expected";if(d.segment!=null&&d.hasOwnProperty("segment")&&(Z=te.onnx.TensorProto.Segment.verify(d.segment)))return"segment."+Z;if(d.floatData!=null&&d.hasOwnProperty("floatData")){if(!Array.isArray(d.floatData))return"floatData: array expected";for(H=0;H<d.floatData.length;++H)if(typeof d.floatData[H]!="number")return"floatData: number[] expected"}if(d.int32Data!=null&&d.hasOwnProperty("int32Data")){if(!Array.isArray(d.int32Data))return"int32Data: array expected";for(H=0;H<d.int32Data.length;++H)if(!ne.isInteger(d.int32Data[H]))return"int32Data: integer[] expected"}if(d.stringData!=null&&d.hasOwnProperty("stringData")){if(!Array.isArray(d.stringData))return"stringData: array expected";for(H=0;H<d.stringData.length;++H)if(!(d.stringData[H]&&typeof d.stringData[H].length=="number"||ne.isString(d.stringData[H])))return"stringData: buffer[] expected"}if(d.int64Data!=null&&d.hasOwnProperty("int64Data")){if(!Array.isArray(d.int64Data))return"int64Data: array expected";for(H=0;H<d.int64Data.length;++H)if(!(ne.isInteger(d.int64Data[H])||d.int64Data[H]&&ne.isInteger(d.int64Data[H].low)&&ne.isInteger(d.int64Data[H].high)))return"int64Data: integer|Long[] expected"}if(d.name!=null&&d.hasOwnProperty("name")&&!ne.isString(d.name))return"name: string expected";if(d.docString!=null&&d.hasOwnProperty("docString")&&!ne.isString(d.docString))return"docString: string expected";if(d.rawData!=null&&d.hasOwnProperty("rawData")&&!(d.rawData&&typeof d.rawData.length=="number"||ne.isString(d.rawData)))return"rawData: buffer expected";if(d.externalData!=null&&d.hasOwnProperty("externalData")){if(!Array.isArray(d.externalData))return"externalData: array expected";for(H=0;H<d.externalData.length;++H){var Z;if(Z=te.onnx.StringStringEntryProto.verify(d.externalData[H]))return"externalData."+Z}}if(d.dataLocation!=null&&d.hasOwnProperty("dataLocation"))switch(d.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:}if(d.doubleData!=null&&d.hasOwnProperty("doubleData")){if(!Array.isArray(d.doubleData))return"doubleData: array expected";for(H=0;H<d.doubleData.length;++H)if(typeof d.doubleData[H]!="number")return"doubleData: number[] expected"}if(d.uint64Data!=null&&d.hasOwnProperty("uint64Data")){if(!Array.isArray(d.uint64Data))return"uint64Data: array expected";for(H=0;H<d.uint64Data.length;++H)if(!(ne.isInteger(d.uint64Data[H])||d.uint64Data[H]&&ne.isInteger(d.uint64Data[H].low)&&ne.isInteger(d.uint64Data[H].high)))return"uint64Data: integer|Long[] expected"}return null},f.fromObject=function(d){if(d instanceof te.onnx.TensorProto)return d;var H=new te.onnx.TensorProto;if(d.dims){if(!Array.isArray(d.dims))throw TypeError(".onnx.TensorProto.dims: array expected");H.dims=[];for(var Z=0;Z<d.dims.length;++Z)ne.Long?(H.dims[Z]=ne.Long.fromValue(d.dims[Z])).unsigned=!1:typeof d.dims[Z]=="string"?H.dims[Z]=parseInt(d.dims[Z],10):typeof d.dims[Z]=="number"?H.dims[Z]=d.dims[Z]:typeof d.dims[Z]=="object"&&(H.dims[Z]=new ne.LongBits(d.dims[Z].low>>>0,d.dims[Z].high>>>0).toNumber())}if(d.dataType!=null&&(H.dataType=0|d.dataType),d.segment!=null){if(typeof d.segment!="object")throw TypeError(".onnx.TensorProto.segment: object expected");H.segment=te.onnx.TensorProto.Segment.fromObject(d.segment)}if(d.floatData){if(!Array.isArray(d.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");for(H.floatData=[],Z=0;Z<d.floatData.length;++Z)H.floatData[Z]=Number(d.floatData[Z])}if(d.int32Data){if(!Array.isArray(d.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");for(H.int32Data=[],Z=0;Z<d.int32Data.length;++Z)H.int32Data[Z]=0|d.int32Data[Z]}if(d.stringData){if(!Array.isArray(d.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");for(H.stringData=[],Z=0;Z<d.stringData.length;++Z)typeof d.stringData[Z]=="string"?ne.base64.decode(d.stringData[Z],H.stringData[Z]=ne.newBuffer(ne.base64.length(d.stringData[Z])),0):d.stringData[Z].length&&(H.stringData[Z]=d.stringData[Z])}if(d.int64Data){if(!Array.isArray(d.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");for(H.int64Data=[],Z=0;Z<d.int64Data.length;++Z)ne.Long?(H.int64Data[Z]=ne.Long.fromValue(d.int64Data[Z])).unsigned=!1:typeof d.int64Data[Z]=="string"?H.int64Data[Z]=parseInt(d.int64Data[Z],10):typeof d.int64Data[Z]=="number"?H.int64Data[Z]=d.int64Data[Z]:typeof d.int64Data[Z]=="object"&&(H.int64Data[Z]=new ne.LongBits(d.int64Data[Z].low>>>0,d.int64Data[Z].high>>>0).toNumber())}if(d.name!=null&&(H.name=String(d.name)),d.docString!=null&&(H.docString=String(d.docString)),d.rawData!=null&&(typeof d.rawData=="string"?ne.base64.decode(d.rawData,H.rawData=ne.newBuffer(ne.base64.length(d.rawData)),0):d.rawData.length&&(H.rawData=d.rawData)),d.externalData){if(!Array.isArray(d.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");for(H.externalData=[],Z=0;Z<d.externalData.length;++Z){if(typeof d.externalData[Z]!="object")throw TypeError(".onnx.TensorProto.externalData: object expected");H.externalData[Z]=te.onnx.StringStringEntryProto.fromObject(d.externalData[Z])}}switch(d.dataLocation){case"DEFAULT":case 0:H.dataLocation=0;break;case"EXTERNAL":case 1:H.dataLocation=1}if(d.doubleData){if(!Array.isArray(d.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");for(H.doubleData=[],Z=0;Z<d.doubleData.length;++Z)H.doubleData[Z]=Number(d.doubleData[Z])}if(d.uint64Data){if(!Array.isArray(d.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");for(H.uint64Data=[],Z=0;Z<d.uint64Data.length;++Z)ne.Long?(H.uint64Data[Z]=ne.Long.fromValue(d.uint64Data[Z])).unsigned=!0:typeof d.uint64Data[Z]=="string"?H.uint64Data[Z]=parseInt(d.uint64Data[Z],10):typeof d.uint64Data[Z]=="number"?H.uint64Data[Z]=d.uint64Data[Z]:typeof d.uint64Data[Z]=="object"&&(H.uint64Data[Z]=new ne.LongBits(d.uint64Data[Z].low>>>0,d.uint64Data[Z].high>>>0).toNumber(!0))}return H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.dims=[],Z.floatData=[],Z.int32Data=[],Z.stringData=[],Z.int64Data=[],Z.doubleData=[],Z.uint64Data=[],Z.externalData=[]),H.defaults&&(Z.dataType=0,Z.segment=null,Z.name="",H.bytes===String?Z.rawData="":(Z.rawData=[],H.bytes!==Array&&(Z.rawData=ne.newBuffer(Z.rawData))),Z.docString="",Z.dataLocation=H.enums===String?"DEFAULT":0),d.dims&&d.dims.length){Z.dims=[];for(var Ye=0;Ye<d.dims.length;++Ye)typeof d.dims[Ye]=="number"?Z.dims[Ye]=H.longs===String?String(d.dims[Ye]):d.dims[Ye]:Z.dims[Ye]=H.longs===String?ne.Long.prototype.toString.call(d.dims[Ye]):H.longs===Number?new ne.LongBits(d.dims[Ye].low>>>0,d.dims[Ye].high>>>0).toNumber():d.dims[Ye]}if(d.dataType!=null&&d.hasOwnProperty("dataType")&&(Z.dataType=d.dataType),d.segment!=null&&d.hasOwnProperty("segment")&&(Z.segment=te.onnx.TensorProto.Segment.toObject(d.segment,H)),d.floatData&&d.floatData.length)for(Z.floatData=[],Ye=0;Ye<d.floatData.length;++Ye)Z.floatData[Ye]=H.json&&!isFinite(d.floatData[Ye])?String(d.floatData[Ye]):d.floatData[Ye];if(d.int32Data&&d.int32Data.length)for(Z.int32Data=[],Ye=0;Ye<d.int32Data.length;++Ye)Z.int32Data[Ye]=d.int32Data[Ye];if(d.stringData&&d.stringData.length)for(Z.stringData=[],Ye=0;Ye<d.stringData.length;++Ye)Z.stringData[Ye]=H.bytes===String?ne.base64.encode(d.stringData[Ye],0,d.stringData[Ye].length):H.bytes===Array?Array.prototype.slice.call(d.stringData[Ye]):d.stringData[Ye];if(d.int64Data&&d.int64Data.length)for(Z.int64Data=[],Ye=0;Ye<d.int64Data.length;++Ye)typeof d.int64Data[Ye]=="number"?Z.int64Data[Ye]=H.longs===String?String(d.int64Data[Ye]):d.int64Data[Ye]:Z.int64Data[Ye]=H.longs===String?ne.Long.prototype.toString.call(d.int64Data[Ye]):H.longs===Number?new ne.LongBits(d.int64Data[Ye].low>>>0,d.int64Data[Ye].high>>>0).toNumber():d.int64Data[Ye];if(d.name!=null&&d.hasOwnProperty("name")&&(Z.name=d.name),d.rawData!=null&&d.hasOwnProperty("rawData")&&(Z.rawData=H.bytes===String?ne.base64.encode(d.rawData,0,d.rawData.length):H.bytes===Array?Array.prototype.slice.call(d.rawData):d.rawData),d.doubleData&&d.doubleData.length)for(Z.doubleData=[],Ye=0;Ye<d.doubleData.length;++Ye)Z.doubleData[Ye]=H.json&&!isFinite(d.doubleData[Ye])?String(d.doubleData[Ye]):d.doubleData[Ye];if(d.uint64Data&&d.uint64Data.length)for(Z.uint64Data=[],Ye=0;Ye<d.uint64Data.length;++Ye)typeof d.uint64Data[Ye]=="number"?Z.uint64Data[Ye]=H.longs===String?String(d.uint64Data[Ye]):d.uint64Data[Ye]:Z.uint64Data[Ye]=H.longs===String?ne.Long.prototype.toString.call(d.uint64Data[Ye]):H.longs===Number?new ne.LongBits(d.uint64Data[Ye].low>>>0,d.uint64Data[Ye].high>>>0).toNumber(!0):d.uint64Data[Ye];if(d.docString!=null&&d.hasOwnProperty("docString")&&(Z.docString=d.docString),d.externalData&&d.externalData.length)for(Z.externalData=[],Ye=0;Ye<d.externalData.length;++Ye)Z.externalData[Ye]=te.onnx.StringStringEntryProto.toObject(d.externalData[Ye],H);return d.dataLocation!=null&&d.hasOwnProperty("dataLocation")&&(Z.dataLocation=H.enums===String?te.onnx.TensorProto.DataLocation[d.dataLocation]:d.dataLocation),Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f.DataType=(function(){var d={},H=Object.create(d);return H[d[0]="UNDEFINED"]=0,H[d[1]="FLOAT"]=1,H[d[2]="UINT8"]=2,H[d[3]="INT8"]=3,H[d[4]="UINT16"]=4,H[d[5]="INT16"]=5,H[d[6]="INT32"]=6,H[d[7]="INT64"]=7,H[d[8]="STRING"]=8,H[d[9]="BOOL"]=9,H[d[10]="FLOAT16"]=10,H[d[11]="DOUBLE"]=11,H[d[12]="UINT32"]=12,H[d[13]="UINT64"]=13,H[d[14]="COMPLEX64"]=14,H[d[15]="COMPLEX128"]=15,H[d[16]="BFLOAT16"]=16,H})(),f.Segment=(function(){function d(H){if(H)for(var Z=Object.keys(H),Ye=0;Ye<Z.length;++Ye)H[Z[Ye]]!=null&&(this[Z[Ye]]=H[Z[Ye]])}return d.prototype.begin=ne.Long?ne.Long.fromBits(0,0,!1):0,d.prototype.end=ne.Long?ne.Long.fromBits(0,0,!1):0,d.create=function(H){return new d(H)},d.encode=function(H,Z){return Z||(Z=xe.create()),H.begin!=null&&H.hasOwnProperty("begin")&&Z.uint32(8).int64(H.begin),H.end!=null&&H.hasOwnProperty("end")&&Z.uint32(16).int64(H.end),Z},d.encodeDelimited=function(H,Z){return this.encode(H,Z).ldelim()},d.decode=function(H,Z){H instanceof ee||(H=ee.create(H));for(var Ye=Z===void 0?H.len:H.pos+Z,et=new te.onnx.TensorProto.Segment;H.pos<Ye;){var tt=H.uint32();switch(tt>>>3){case 1:et.begin=H.int64();break;case 2:et.end=H.int64();break;default:H.skipType(7&tt)}}return et},d.decodeDelimited=function(H){return H instanceof ee||(H=new ee(H)),this.decode(H,H.uint32())},d.verify=function(H){return typeof H!="object"||H===null?"object expected":H.begin!=null&&H.hasOwnProperty("begin")&&!(ne.isInteger(H.begin)||H.begin&&ne.isInteger(H.begin.low)&&ne.isInteger(H.begin.high))?"begin: integer|Long expected":H.end!=null&&H.hasOwnProperty("end")&&!(ne.isInteger(H.end)||H.end&&ne.isInteger(H.end.low)&&ne.isInteger(H.end.high))?"end: integer|Long expected":null},d.fromObject=function(H){if(H instanceof te.onnx.TensorProto.Segment)return H;var Z=new te.onnx.TensorProto.Segment;return H.begin!=null&&(ne.Long?(Z.begin=ne.Long.fromValue(H.begin)).unsigned=!1:typeof H.begin=="string"?Z.begin=parseInt(H.begin,10):typeof H.begin=="number"?Z.begin=H.begin:typeof H.begin=="object"&&(Z.begin=new ne.LongBits(H.begin.low>>>0,H.begin.high>>>0).toNumber())),H.end!=null&&(ne.Long?(Z.end=ne.Long.fromValue(H.end)).unsigned=!1:typeof H.end=="string"?Z.end=parseInt(H.end,10):typeof H.end=="number"?Z.end=H.end:typeof H.end=="object"&&(Z.end=new ne.LongBits(H.end.low>>>0,H.end.high>>>0).toNumber())),Z},d.toObject=function(H,Z){Z||(Z={});var Ye={};if(Z.defaults){if(ne.Long){var et=new ne.Long(0,0,!1);Ye.begin=Z.longs===String?et.toString():Z.longs===Number?et.toNumber():et}else Ye.begin=Z.longs===String?"0":0;ne.Long?(et=new ne.Long(0,0,!1),Ye.end=Z.longs===String?et.toString():Z.longs===Number?et.toNumber():et):Ye.end=Z.longs===String?"0":0}return H.begin!=null&&H.hasOwnProperty("begin")&&(typeof H.begin=="number"?Ye.begin=Z.longs===String?String(H.begin):H.begin:Ye.begin=Z.longs===String?ne.Long.prototype.toString.call(H.begin):Z.longs===Number?new ne.LongBits(H.begin.low>>>0,H.begin.high>>>0).toNumber():H.begin),H.end!=null&&H.hasOwnProperty("end")&&(typeof H.end=="number"?Ye.end=Z.longs===String?String(H.end):H.end:Ye.end=Z.longs===String?ne.Long.prototype.toString.call(H.end):Z.longs===Number?new ne.LongBits(H.end.low>>>0,H.end.high>>>0).toNumber():H.end),Ye},d.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},d})(),f.DataLocation=(function(){var d={},H=Object.create(d);return H[d[0]="DEFAULT"]=0,H[d[1]="EXTERNAL"]=1,H})(),f})(),Y.TensorShapeProto=(function(){function f(d){if(this.dim=[],d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.dim=ne.emptyArray,f.create=function(d){return new f(d)},f.encode=function(d,H){if(H||(H=xe.create()),d.dim!=null&&d.dim.length)for(var Z=0;Z<d.dim.length;++Z)te.onnx.TensorShapeProto.Dimension.encode(d.dim[Z],H.uint32(10).fork()).ldelim();return H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.TensorShapeProto;d.pos<Z;){var et=d.uint32();et>>>3==1?(Ye.dim&&Ye.dim.length||(Ye.dim=[]),Ye.dim.push(te.onnx.TensorShapeProto.Dimension.decode(d,d.uint32()))):d.skipType(7&et)}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){if(typeof d!="object"||d===null)return"object expected";if(d.dim!=null&&d.hasOwnProperty("dim")){if(!Array.isArray(d.dim))return"dim: array expected";for(var H=0;H<d.dim.length;++H){var Z=te.onnx.TensorShapeProto.Dimension.verify(d.dim[H]);if(Z)return"dim."+Z}}return null},f.fromObject=function(d){if(d instanceof te.onnx.TensorShapeProto)return d;var H=new te.onnx.TensorShapeProto;if(d.dim){if(!Array.isArray(d.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");H.dim=[];for(var Z=0;Z<d.dim.length;++Z){if(typeof d.dim[Z]!="object")throw TypeError(".onnx.TensorShapeProto.dim: object expected");H.dim[Z]=te.onnx.TensorShapeProto.Dimension.fromObject(d.dim[Z])}}return H},f.toObject=function(d,H){H||(H={});var Z={};if((H.arrays||H.defaults)&&(Z.dim=[]),d.dim&&d.dim.length){Z.dim=[];for(var Ye=0;Ye<d.dim.length;++Ye)Z.dim[Ye]=te.onnx.TensorShapeProto.Dimension.toObject(d.dim[Ye],H)}return Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f.Dimension=(function(){function d(Z){if(Z)for(var Ye=Object.keys(Z),et=0;et<Ye.length;++et)Z[Ye[et]]!=null&&(this[Ye[et]]=Z[Ye[et]])}var H;return d.prototype.dimValue=ne.Long?ne.Long.fromBits(0,0,!1):0,d.prototype.dimParam="",d.prototype.denotation="",Object.defineProperty(d.prototype,"value",{get:ne.oneOfGetter(H=["dimValue","dimParam"]),set:ne.oneOfSetter(H)}),d.create=function(Z){return new d(Z)},d.encode=function(Z,Ye){return Ye||(Ye=xe.create()),Z.dimValue!=null&&Z.hasOwnProperty("dimValue")&&Ye.uint32(8).int64(Z.dimValue),Z.dimParam!=null&&Z.hasOwnProperty("dimParam")&&Ye.uint32(18).string(Z.dimParam),Z.denotation!=null&&Z.hasOwnProperty("denotation")&&Ye.uint32(26).string(Z.denotation),Ye},d.encodeDelimited=function(Z,Ye){return this.encode(Z,Ye).ldelim()},d.decode=function(Z,Ye){Z instanceof ee||(Z=ee.create(Z));for(var et=Ye===void 0?Z.len:Z.pos+Ye,tt=new te.onnx.TensorShapeProto.Dimension;Z.pos<et;){var nt=Z.uint32();switch(nt>>>3){case 1:tt.dimValue=Z.int64();break;case 2:tt.dimParam=Z.string();break;case 3:tt.denotation=Z.string();break;default:Z.skipType(7&nt)}}return tt},d.decodeDelimited=function(Z){return Z instanceof ee||(Z=new ee(Z)),this.decode(Z,Z.uint32())},d.verify=function(Z){if(typeof Z!="object"||Z===null)return"object expected";var Ye={};if(Z.dimValue!=null&&Z.hasOwnProperty("dimValue")&&(Ye.value=1,!(ne.isInteger(Z.dimValue)||Z.dimValue&&ne.isInteger(Z.dimValue.low)&&ne.isInteger(Z.dimValue.high))))return"dimValue: integer|Long expected";if(Z.dimParam!=null&&Z.hasOwnProperty("dimParam")){if(Ye.value===1)return"value: multiple values";if(Ye.value=1,!ne.isString(Z.dimParam))return"dimParam: string expected"}return Z.denotation!=null&&Z.hasOwnProperty("denotation")&&!ne.isString(Z.denotation)?"denotation: string expected":null},d.fromObject=function(Z){if(Z instanceof te.onnx.TensorShapeProto.Dimension)return Z;var Ye=new te.onnx.TensorShapeProto.Dimension;return Z.dimValue!=null&&(ne.Long?(Ye.dimValue=ne.Long.fromValue(Z.dimValue)).unsigned=!1:typeof Z.dimValue=="string"?Ye.dimValue=parseInt(Z.dimValue,10):typeof Z.dimValue=="number"?Ye.dimValue=Z.dimValue:typeof Z.dimValue=="object"&&(Ye.dimValue=new ne.LongBits(Z.dimValue.low>>>0,Z.dimValue.high>>>0).toNumber())),Z.dimParam!=null&&(Ye.dimParam=String(Z.dimParam)),Z.denotation!=null&&(Ye.denotation=String(Z.denotation)),Ye},d.toObject=function(Z,Ye){Ye||(Ye={});var et={};return Ye.defaults&&(et.denotation=""),Z.dimValue!=null&&Z.hasOwnProperty("dimValue")&&(typeof Z.dimValue=="number"?et.dimValue=Ye.longs===String?String(Z.dimValue):Z.dimValue:et.dimValue=Ye.longs===String?ne.Long.prototype.toString.call(Z.dimValue):Ye.longs===Number?new ne.LongBits(Z.dimValue.low>>>0,Z.dimValue.high>>>0).toNumber():Z.dimValue,Ye.oneofs&&(et.value="dimValue")),Z.dimParam!=null&&Z.hasOwnProperty("dimParam")&&(et.dimParam=Z.dimParam,Ye.oneofs&&(et.value="dimParam")),Z.denotation!=null&&Z.hasOwnProperty("denotation")&&(et.denotation=Z.denotation),et},d.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},d})(),f})(),Y.TypeProto=(function(){function f(H){if(H)for(var Z=Object.keys(H),Ye=0;Ye<Z.length;++Ye)H[Z[Ye]]!=null&&(this[Z[Ye]]=H[Z[Ye]])}var d;return f.prototype.tensorType=null,f.prototype.denotation="",Object.defineProperty(f.prototype,"value",{get:ne.oneOfGetter(d=["tensorType"]),set:ne.oneOfSetter(d)}),f.create=function(H){return new f(H)},f.encode=function(H,Z){return Z||(Z=xe.create()),H.tensorType!=null&&H.hasOwnProperty("tensorType")&&te.onnx.TypeProto.Tensor.encode(H.tensorType,Z.uint32(10).fork()).ldelim(),H.denotation!=null&&H.hasOwnProperty("denotation")&&Z.uint32(50).string(H.denotation),Z},f.encodeDelimited=function(H,Z){return this.encode(H,Z).ldelim()},f.decode=function(H,Z){H instanceof ee||(H=ee.create(H));for(var Ye=Z===void 0?H.len:H.pos+Z,et=new te.onnx.TypeProto;H.pos<Ye;){var tt=H.uint32();switch(tt>>>3){case 1:et.tensorType=te.onnx.TypeProto.Tensor.decode(H,H.uint32());break;case 6:et.denotation=H.string();break;default:H.skipType(7&tt)}}return et},f.decodeDelimited=function(H){return H instanceof ee||(H=new ee(H)),this.decode(H,H.uint32())},f.verify=function(H){if(typeof H!="object"||H===null)return"object expected";if(H.tensorType!=null&&H.hasOwnProperty("tensorType")){var Z=te.onnx.TypeProto.Tensor.verify(H.tensorType);if(Z)return"tensorType."+Z}return H.denotation!=null&&H.hasOwnProperty("denotation")&&!ne.isString(H.denotation)?"denotation: string expected":null},f.fromObject=function(H){if(H instanceof te.onnx.TypeProto)return H;var Z=new te.onnx.TypeProto;if(H.tensorType!=null){if(typeof H.tensorType!="object")throw TypeError(".onnx.TypeProto.tensorType: object expected");Z.tensorType=te.onnx.TypeProto.Tensor.fromObject(H.tensorType)}return H.denotation!=null&&(Z.denotation=String(H.denotation)),Z},f.toObject=function(H,Z){Z||(Z={});var Ye={};return Z.defaults&&(Ye.denotation=""),H.tensorType!=null&&H.hasOwnProperty("tensorType")&&(Ye.tensorType=te.onnx.TypeProto.Tensor.toObject(H.tensorType,Z),Z.oneofs&&(Ye.value="tensorType")),H.denotation!=null&&H.hasOwnProperty("denotation")&&(Ye.denotation=H.denotation),Ye},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f.Tensor=(function(){function H(Z){if(Z)for(var Ye=Object.keys(Z),et=0;et<Ye.length;++et)Z[Ye[et]]!=null&&(this[Ye[et]]=Z[Ye[et]])}return H.prototype.elemType=0,H.prototype.shape=null,H.create=function(Z){return new H(Z)},H.encode=function(Z,Ye){return Ye||(Ye=xe.create()),Z.elemType!=null&&Z.hasOwnProperty("elemType")&&Ye.uint32(8).int32(Z.elemType),Z.shape!=null&&Z.hasOwnProperty("shape")&&te.onnx.TensorShapeProto.encode(Z.shape,Ye.uint32(18).fork()).ldelim(),Ye},H.encodeDelimited=function(Z,Ye){return this.encode(Z,Ye).ldelim()},H.decode=function(Z,Ye){Z instanceof ee||(Z=ee.create(Z));for(var et=Ye===void 0?Z.len:Z.pos+Ye,tt=new te.onnx.TypeProto.Tensor;Z.pos<et;){var nt=Z.uint32();switch(nt>>>3){case 1:tt.elemType=Z.int32();break;case 2:tt.shape=te.onnx.TensorShapeProto.decode(Z,Z.uint32());break;default:Z.skipType(7&nt)}}return tt},H.decodeDelimited=function(Z){return Z instanceof ee||(Z=new ee(Z)),this.decode(Z,Z.uint32())},H.verify=function(Z){if(typeof Z!="object"||Z===null)return"object expected";if(Z.elemType!=null&&Z.hasOwnProperty("elemType")&&!ne.isInteger(Z.elemType))return"elemType: integer expected";if(Z.shape!=null&&Z.hasOwnProperty("shape")){var Ye=te.onnx.TensorShapeProto.verify(Z.shape);if(Ye)return"shape."+Ye}return null},H.fromObject=function(Z){if(Z instanceof te.onnx.TypeProto.Tensor)return Z;var Ye=new te.onnx.TypeProto.Tensor;if(Z.elemType!=null&&(Ye.elemType=0|Z.elemType),Z.shape!=null){if(typeof Z.shape!="object")throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");Ye.shape=te.onnx.TensorShapeProto.fromObject(Z.shape)}return Ye},H.toObject=function(Z,Ye){Ye||(Ye={});var et={};return Ye.defaults&&(et.elemType=0,et.shape=null),Z.elemType!=null&&Z.hasOwnProperty("elemType")&&(et.elemType=Z.elemType),Z.shape!=null&&Z.hasOwnProperty("shape")&&(et.shape=te.onnx.TensorShapeProto.toObject(Z.shape,Ye)),et},H.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},H})(),f})(),Y.OperatorSetIdProto=(function(){function f(d){if(d)for(var H=Object.keys(d),Z=0;Z<H.length;++Z)d[H[Z]]!=null&&(this[H[Z]]=d[H[Z]])}return f.prototype.domain="",f.prototype.version=ne.Long?ne.Long.fromBits(0,0,!1):0,f.create=function(d){return new f(d)},f.encode=function(d,H){return H||(H=xe.create()),d.domain!=null&&d.hasOwnProperty("domain")&&H.uint32(10).string(d.domain),d.version!=null&&d.hasOwnProperty("version")&&H.uint32(16).int64(d.version),H},f.encodeDelimited=function(d,H){return this.encode(d,H).ldelim()},f.decode=function(d,H){d instanceof ee||(d=ee.create(d));for(var Z=H===void 0?d.len:d.pos+H,Ye=new te.onnx.OperatorSetIdProto;d.pos<Z;){var et=d.uint32();switch(et>>>3){case 1:Ye.domain=d.string();break;case 2:Ye.version=d.int64();break;default:d.skipType(7&et)}}return Ye},f.decodeDelimited=function(d){return d instanceof ee||(d=new ee(d)),this.decode(d,d.uint32())},f.verify=function(d){return typeof d!="object"||d===null?"object expected":d.domain!=null&&d.hasOwnProperty("domain")&&!ne.isString(d.domain)?"domain: string expected":d.version!=null&&d.hasOwnProperty("version")&&!(ne.isInteger(d.version)||d.version&&ne.isInteger(d.version.low)&&ne.isInteger(d.version.high))?"version: integer|Long expected":null},f.fromObject=function(d){if(d instanceof te.onnx.OperatorSetIdProto)return d;var H=new te.onnx.OperatorSetIdProto;return d.domain!=null&&(H.domain=String(d.domain)),d.version!=null&&(ne.Long?(H.version=ne.Long.fromValue(d.version)).unsigned=!1:typeof d.version=="string"?H.version=parseInt(d.version,10):typeof d.version=="number"?H.version=d.version:typeof d.version=="object"&&(H.version=new ne.LongBits(d.version.low>>>0,d.version.high>>>0).toNumber())),H},f.toObject=function(d,H){H||(H={});var Z={};if(H.defaults)if(Z.domain="",ne.Long){var Ye=new ne.Long(0,0,!1);Z.version=H.longs===String?Ye.toString():H.longs===Number?Ye.toNumber():Ye}else Z.version=H.longs===String?"0":0;return d.domain!=null&&d.hasOwnProperty("domain")&&(Z.domain=d.domain),d.version!=null&&d.hasOwnProperty("version")&&(typeof d.version=="number"?Z.version=H.longs===String?String(d.version):d.version:Z.version=H.longs===String?ne.Long.prototype.toString.call(d.version):H.longs===Number?new ne.LongBits(d.version.low>>>0,d.version.high>>>0).toNumber():d.version),Z},f.prototype.toJSON=function(){return this.constructor.toObject(this,R.util.toJSONOptions)},f})(),Y),g.exports=te},2100:(g,a,l)=>{g.exports=l(9482)},9482:(g,a,l)=>{var A=a;function O(){A.util._configure(),A.Writer._configure(A.BufferWriter),A.Reader._configure(A.BufferReader)}A.build="minimal",A.Writer=l(1173),A.BufferWriter=l(3155),A.Reader=l(1408),A.BufferReader=l(593),A.util=l(9693),A.rpc=l(5994),A.roots=l(5054),A.configure=O,O()},1408:(g,a,l)=>{g.exports=xe;var A,O=l(9693),Y=O.LongBits,R=O.utf8;function ee(Ye,et){return RangeError("index out of range: "+Ye.pos+" + "+(et||1)+" > "+Ye.len)}function xe(Ye){this.buf=Ye,this.pos=0,this.len=Ye.length}var ne,te=typeof Uint8Array<"u"?function(Ye){if(Ye instanceof Uint8Array||Array.isArray(Ye))return new xe(Ye);throw Error("illegal buffer")}:function(Ye){if(Array.isArray(Ye))return new xe(Ye);throw Error("illegal buffer")},f=function(){return O.Buffer?function(Ye){return(xe.create=function(et){return O.Buffer.isBuffer(et)?new A(et):te(et)})(Ye)}:te};function d(){var Ye=new Y(0,0),et=0;if(!(this.len-this.pos>4)){for(;et<3;++et){if(this.pos>=this.len)throw ee(this);if(Ye.lo=(Ye.lo|(127&this.buf[this.pos])<<7*et)>>>0,this.buf[this.pos++]<128)return Ye}return Ye.lo=(Ye.lo|(127&this.buf[this.pos++])<<7*et)>>>0,Ye}for(;et<4;++et)if(Ye.lo=(Ye.lo|(127&this.buf[this.pos])<<7*et)>>>0,this.buf[this.pos++]<128)return Ye;if(Ye.lo=(Ye.lo|(127&this.buf[this.pos])<<28)>>>0,Ye.hi=(Ye.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return Ye;if(et=0,this.len-this.pos>4){for(;et<5;++et)if(Ye.hi=(Ye.hi|(127&this.buf[this.pos])<<7*et+3)>>>0,this.buf[this.pos++]<128)return Ye}else for(;et<5;++et){if(this.pos>=this.len)throw ee(this);if(Ye.hi=(Ye.hi|(127&this.buf[this.pos])<<7*et+3)>>>0,this.buf[this.pos++]<128)return Ye}throw Error("invalid varint encoding")}function H(Ye,et){return(Ye[et-4]|Ye[et-3]<<8|Ye[et-2]<<16|Ye[et-1]<<24)>>>0}function Z(){if(this.pos+8>this.len)throw ee(this,8);return new Y(H(this.buf,this.pos+=4),H(this.buf,this.pos+=4))}xe.create=f(),xe.prototype._slice=O.Array.prototype.subarray||O.Array.prototype.slice,xe.prototype.uint32=(ne=4294967295,function(){if(ne=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(ne=(ne|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(ne=(ne|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(ne=(ne|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(ne=(ne|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return ne;if((this.pos+=5)>this.len)throw this.pos=this.len,ee(this,10);return ne}),xe.prototype.int32=function(){return 0|this.uint32()},xe.prototype.sint32=function(){var Ye=this.uint32();return Ye>>>1^-(1&Ye)|0},xe.prototype.bool=function(){return this.uint32()!==0},xe.prototype.fixed32=function(){if(this.pos+4>this.len)throw ee(this,4);return H(this.buf,this.pos+=4)},xe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ee(this,4);return 0|H(this.buf,this.pos+=4)},xe.prototype.float=function(){if(this.pos+4>this.len)throw ee(this,4);var Ye=O.float.readFloatLE(this.buf,this.pos);return this.pos+=4,Ye},xe.prototype.double=function(){if(this.pos+8>this.len)throw ee(this,4);var Ye=O.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,Ye},xe.prototype.bytes=function(){var Ye=this.uint32(),et=this.pos,tt=this.pos+Ye;if(tt>this.len)throw ee(this,Ye);return this.pos+=Ye,Array.isArray(this.buf)?this.buf.slice(et,tt):et===tt?new this.buf.constructor(0):this._slice.call(this.buf,et,tt)},xe.prototype.string=function(){var Ye=this.bytes();return R.read(Ye,0,Ye.length)},xe.prototype.skip=function(Ye){if(typeof Ye=="number"){if(this.pos+Ye>this.len)throw ee(this,Ye);this.pos+=Ye}else do if(this.pos>=this.len)throw ee(this);while(128&this.buf[this.pos++]);return this},xe.prototype.skipType=function(Ye){switch(Ye){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(Ye=7&this.uint32())!=4;)this.skipType(Ye);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+Ye+" at offset "+this.pos)}return this},xe._configure=function(Ye){A=Ye,xe.create=f(),A._configure();var et=O.Long?"toLong":"toNumber";O.merge(xe.prototype,{int64:function(){return d.call(this)[et](!1)},uint64:function(){return d.call(this)[et](!0)},sint64:function(){return d.call(this).zzDecode()[et](!1)},fixed64:function(){return Z.call(this)[et](!0)},sfixed64:function(){return Z.call(this)[et](!1)}})}},593:(g,a,l)=>{g.exports=Y;var A=l(1408);(Y.prototype=Object.create(A.prototype)).constructor=Y;var O=l(9693);function Y(R){A.call(this,R)}Y._configure=function(){O.Buffer&&(Y.prototype._slice=O.Buffer.prototype.slice)},Y.prototype.string=function(){var R=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+R,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+R,this.len))},Y._configure()},5054:g=>{g.exports={}},5994:(g,a,l)=>{a.Service=l(7948)},7948:(g,a,l)=>{g.exports=O;var A=l(9693);function O(Y,R,ee){if(typeof Y!="function")throw TypeError("rpcImpl must be a function");A.EventEmitter.call(this),this.rpcImpl=Y,this.requestDelimited=!!R,this.responseDelimited=!!ee}(O.prototype=Object.create(A.EventEmitter.prototype)).constructor=O,O.prototype.rpcCall=function Y(R,ee,xe,ne,te){if(!ne)throw TypeError("request must be specified");var f=this;if(!te)return A.asPromise(Y,f,R,ee,xe,ne);if(f.rpcImpl)try{return f.rpcImpl(R,ee[f.requestDelimited?"encodeDelimited":"encode"](ne).finish(),(function(d,H){if(d)return f.emit("error",d,R),te(d);if(H!==null){if(!(H instanceof xe))try{H=xe[f.responseDelimited?"decodeDelimited":"decode"](H)}catch(Z){return f.emit("error",Z,R),te(Z)}return f.emit("data",H,R),te(null,H)}f.end(!0)}))}catch(d){return f.emit("error",d,R),void setTimeout((function(){te(d)}),0)}else setTimeout((function(){te(Error("already ended"))}),0)},O.prototype.end=function(Y){return this.rpcImpl&&(Y||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:(g,a,l)=>{g.exports=O;var A=l(9693);function O(xe,ne){this.lo=xe>>>0,this.hi=ne>>>0}var Y=O.zero=new O(0,0);Y.toNumber=function(){return 0},Y.zzEncode=Y.zzDecode=function(){return this},Y.length=function(){return 1};var R=O.zeroHash="\0\0\0\0\0\0\0\0";O.fromNumber=function(xe){if(xe===0)return Y;var ne=xe<0;ne&&(xe=-xe);var te=xe>>>0,f=(xe-te)/4294967296>>>0;return ne&&(f=~f>>>0,te=~te>>>0,++te>4294967295&&(te=0,++f>4294967295&&(f=0))),new O(te,f)},O.from=function(xe){if(typeof xe=="number")return O.fromNumber(xe);if(A.isString(xe)){if(!A.Long)return O.fromNumber(parseInt(xe,10));xe=A.Long.fromString(xe)}return xe.low||xe.high?new O(xe.low>>>0,xe.high>>>0):Y},O.prototype.toNumber=function(xe){if(!xe&&this.hi>>>31){var ne=1+~this.lo>>>0,te=~this.hi>>>0;return ne||(te=te+1>>>0),-(ne+4294967296*te)}return this.lo+4294967296*this.hi},O.prototype.toLong=function(xe){return A.Long?new A.Long(0|this.lo,0|this.hi,!!xe):{low:0|this.lo,high:0|this.hi,unsigned:!!xe}};var ee=String.prototype.charCodeAt;O.fromHash=function(xe){return xe===R?Y:new O((ee.call(xe,0)|ee.call(xe,1)<<8|ee.call(xe,2)<<16|ee.call(xe,3)<<24)>>>0,(ee.call(xe,4)|ee.call(xe,5)<<8|ee.call(xe,6)<<16|ee.call(xe,7)<<24)>>>0)},O.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},O.prototype.zzEncode=function(){var xe=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^xe)>>>0,this.lo=(this.lo<<1^xe)>>>0,this},O.prototype.zzDecode=function(){var xe=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^xe)>>>0,this.hi=(this.hi>>>1^xe)>>>0,this},O.prototype.length=function(){var xe=this.lo,ne=(this.lo>>>28|this.hi<<4)>>>0,te=this.hi>>>24;return te===0?ne===0?xe<16384?xe<128?1:2:xe<2097152?3:4:ne<16384?ne<128?5:6:ne<2097152?7:8:te<128?9:10}},9693:function(g,a,l){var A=a;function O(R,ee,xe){for(var ne=Object.keys(ee),te=0;te<ne.length;++te)R[ne[te]]!==void 0&&xe||(R[ne[te]]=ee[ne[te]]);return R}function Y(R){function ee(xe,ne){if(!(this instanceof ee))return new ee(xe,ne);Object.defineProperty(this,"message",{get:function(){return xe}}),Error.captureStackTrace?Error.captureStackTrace(this,ee):Object.defineProperty(this,"stack",{value:new Error().stack||""}),ne&&O(this,ne)}return(ee.prototype=Object.create(Error.prototype)).constructor=ee,Object.defineProperty(ee.prototype,"name",{get:function(){return R}}),ee.prototype.toString=function(){return this.name+": "+this.message},ee}A.asPromise=l(4537),A.base64=l(7419),A.EventEmitter=l(9211),A.float=l(945),A.inquire=l(7199),A.utf8=l(4997),A.pool=l(6662),A.LongBits=l(1945),A.isNode=!!(l.g!==void 0&&l.g&&l.g.process&&l.g.process.versions&&l.g.process.versions.node),A.global=A.isNode&&l.g||typeof window<"u"&&window||typeof self<"u"&&self||this,A.emptyArray=Object.freeze?Object.freeze([]):[],A.emptyObject=Object.freeze?Object.freeze({}):{},A.isInteger=Number.isInteger||function(R){return typeof R=="number"&&isFinite(R)&&Math.floor(R)===R},A.isString=function(R){return typeof R=="string"||R instanceof String},A.isObject=function(R){return R&&typeof R=="object"},A.isset=A.isSet=function(R,ee){var xe=R[ee];return!(xe==null||!R.hasOwnProperty(ee))&&(typeof xe!="object"||(Array.isArray(xe)?xe.length:Object.keys(xe).length)>0)},A.Buffer=(function(){try{var R=A.inquire("buffer").Buffer;return R.prototype.utf8Write?R:null}catch{return null}})(),A._Buffer_from=null,A._Buffer_allocUnsafe=null,A.newBuffer=function(R){return typeof R=="number"?A.Buffer?A._Buffer_allocUnsafe(R):new A.Array(R):A.Buffer?A._Buffer_from(R):typeof Uint8Array>"u"?R:new Uint8Array(R)},A.Array=typeof Uint8Array<"u"?Uint8Array:Array,A.Long=A.global.dcodeIO&&A.global.dcodeIO.Long||A.global.Long||A.inquire("long"),A.key2Re=/^true|false|0|1$/,A.key32Re=/^-?(?:0|[1-9][0-9]*)$/,A.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,A.longToHash=function(R){return R?A.LongBits.from(R).toHash():A.LongBits.zeroHash},A.longFromHash=function(R,ee){var xe=A.LongBits.fromHash(R);return A.Long?A.Long.fromBits(xe.lo,xe.hi,ee):xe.toNumber(!!ee)},A.merge=O,A.lcFirst=function(R){return R.charAt(0).toLowerCase()+R.substring(1)},A.newError=Y,A.ProtocolError=Y("ProtocolError"),A.oneOfGetter=function(R){for(var ee={},xe=0;xe<R.length;++xe)ee[R[xe]]=1;return function(){for(var ne=Object.keys(this),te=ne.length-1;te>-1;--te)if(ee[ne[te]]===1&&this[ne[te]]!==void 0&&this[ne[te]]!==null)return ne[te]}},A.oneOfSetter=function(R){return function(ee){for(var xe=0;xe<R.length;++xe)R[xe]!==ee&&delete this[R[xe]]}},A.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},A._configure=function(){var R=A.Buffer;R?(A._Buffer_from=R.from!==Uint8Array.from&&R.from||function(ee,xe){return new R(ee,xe)},A._Buffer_allocUnsafe=R.allocUnsafe||function(ee){return new R(ee)}):A._Buffer_from=A._Buffer_allocUnsafe=null}},1173:(g,a,l)=>{g.exports=f;var A,O=l(9693),Y=O.LongBits,R=O.base64,ee=O.utf8;function xe(nt,it,ot){this.fn=nt,this.len=it,this.next=void 0,this.val=ot}function ne(){}function te(nt){this.head=nt.head,this.tail=nt.tail,this.len=nt.len,this.next=nt.states}function f(){this.len=0,this.head=new xe(ne,0,0),this.tail=this.head,this.states=null}var d=function(){return O.Buffer?function(){return(f.create=function(){return new A})()}:function(){return new f}};function H(nt,it,ot){it[ot]=255&nt}function Z(nt,it){this.len=nt,this.next=void 0,this.val=it}function Ye(nt,it,ot){for(;nt.hi;)it[ot++]=127&nt.lo|128,nt.lo=(nt.lo>>>7|nt.hi<<25)>>>0,nt.hi>>>=7;for(;nt.lo>127;)it[ot++]=127&nt.lo|128,nt.lo=nt.lo>>>7;it[ot++]=nt.lo}function et(nt,it,ot){it[ot]=255&nt,it[ot+1]=nt>>>8&255,it[ot+2]=nt>>>16&255,it[ot+3]=nt>>>24}f.create=d(),f.alloc=function(nt){return new O.Array(nt)},O.Array!==Array&&(f.alloc=O.pool(f.alloc,O.Array.prototype.subarray)),f.prototype._push=function(nt,it,ot){return this.tail=this.tail.next=new xe(nt,it,ot),this.len+=it,this},Z.prototype=Object.create(xe.prototype),Z.prototype.fn=function(nt,it,ot){for(;nt>127;)it[ot++]=127&nt|128,nt>>>=7;it[ot]=nt},f.prototype.uint32=function(nt){return this.len+=(this.tail=this.tail.next=new Z((nt>>>=0)<128?1:nt<16384?2:nt<2097152?3:nt<268435456?4:5,nt)).len,this},f.prototype.int32=function(nt){return nt<0?this._push(Ye,10,Y.fromNumber(nt)):this.uint32(nt)},f.prototype.sint32=function(nt){return this.uint32((nt<<1^nt>>31)>>>0)},f.prototype.uint64=function(nt){var it=Y.from(nt);return this._push(Ye,it.length(),it)},f.prototype.int64=f.prototype.uint64,f.prototype.sint64=function(nt){var it=Y.from(nt).zzEncode();return this._push(Ye,it.length(),it)},f.prototype.bool=function(nt){return this._push(H,1,nt?1:0)},f.prototype.fixed32=function(nt){return this._push(et,4,nt>>>0)},f.prototype.sfixed32=f.prototype.fixed32,f.prototype.fixed64=function(nt){var it=Y.from(nt);return this._push(et,4,it.lo)._push(et,4,it.hi)},f.prototype.sfixed64=f.prototype.fixed64,f.prototype.float=function(nt){return this._push(O.float.writeFloatLE,4,nt)},f.prototype.double=function(nt){return this._push(O.float.writeDoubleLE,8,nt)};var tt=O.Array.prototype.set?function(nt,it,ot){it.set(nt,ot)}:function(nt,it,ot){for(var st=0;st<nt.length;++st)it[ot+st]=nt[st]};f.prototype.bytes=function(nt){var it=nt.length>>>0;if(!it)return this._push(H,1,0);if(O.isString(nt)){var ot=f.alloc(it=R.length(nt));R.decode(nt,ot,0),nt=ot}return this.uint32(it)._push(tt,it,nt)},f.prototype.string=function(nt){var it=ee.length(nt);return it?this.uint32(it)._push(ee.write,it,nt):this._push(H,1,0)},f.prototype.fork=function(){return this.states=new te(this),this.head=this.tail=new xe(ne,0,0),this.len=0,this},f.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new xe(ne,0,0),this.len=0),this},f.prototype.ldelim=function(){var nt=this.head,it=this.tail,ot=this.len;return this.reset().uint32(ot),ot&&(this.tail.next=nt.next,this.tail=it,this.len+=ot),this},f.prototype.finish=function(){for(var nt=this.head.next,it=this.constructor.alloc(this.len),ot=0;nt;)nt.fn(nt.val,it,ot),ot+=nt.len,nt=nt.next;return it},f._configure=function(nt){A=nt,f.create=d(),A._configure()}},3155:(g,a,l)=>{g.exports=Y;var A=l(1173);(Y.prototype=Object.create(A.prototype)).constructor=Y;var O=l(9693);function Y(){A.call(this)}function R(ee,xe,ne){ee.length<40?O.utf8.write(ee,xe,ne):xe.utf8Write?xe.utf8Write(ee,ne):xe.write(ee,ne)}Y._configure=function(){Y.alloc=O._Buffer_allocUnsafe,Y.writeBytesBuffer=O.Buffer&&O.Buffer.prototype instanceof Uint8Array&&O.Buffer.prototype.set.name==="set"?function(ee,xe,ne){xe.set(ee,ne)}:function(ee,xe,ne){if(ee.copy)ee.copy(xe,ne,0,ee.length);else for(var te=0;te<ee.length;)xe[ne++]=ee[te++]}},Y.prototype.bytes=function(ee){O.isString(ee)&&(ee=O._Buffer_from(ee,"base64"));var xe=ee.length>>>0;return this.uint32(xe),xe&&this._push(Y.writeBytesBuffer,xe,ee),this},Y.prototype.string=function(ee){var xe=O.Buffer.byteLength(ee);return this.uint32(xe),xe&&this._push(R,xe,ee),this},Y._configure()},7714:(g,a,l)=>{a.R=void 0;const A=l(6919),O=l(7448);a.R=new class{async init(){}async createSessionHandler(Y,R){const ee=new A.Session(R);return await ee.loadModel(Y),new O.OnnxjsSessionHandler(ee)}}},4200:(g,a,l)=>{a.c8=a.rX=void 0;const A=l(1670),O=l(5381),Y=l(2157),R=l(2306);a.rX=()=>{if((typeof A.env.wasm.initTimeout!="number"||A.env.wasm.initTimeout<0)&&(A.env.wasm.initTimeout=0),typeof A.env.wasm.simd!="boolean"&&(A.env.wasm.simd=!0),typeof A.env.wasm.proxy!="boolean"&&(A.env.wasm.proxy=!1),typeof A.env.wasm.numThreads!="number"||!Number.isInteger(A.env.wasm.numThreads)||A.env.wasm.numThreads<=0){const ee=typeof navigator>"u"?(0,O.cpus)().length:navigator.hardwareConcurrency;A.env.wasm.numThreads=Math.min(4,Math.ceil((ee||1)/2))}},a.c8=new class{async init(){(0,a.rX)(),await(0,Y.initWasm)()}async createSessionHandler(ee,xe){const ne=new R.OnnxruntimeWebAssemblySessionHandler;return await ne.loadModel(ee,xe),Promise.resolve(ne)}}},6018:function(g,a,l){var A=this&&this.__createBinding||(Object.create?function(R,ee,xe,ne){ne===void 0&&(ne=xe);var te=Object.getOwnPropertyDescriptor(ee,xe);te&&!("get"in te?!ee.__esModule:te.writable||te.configurable)||(te={enumerable:!0,get:function(){return ee[xe]}}),Object.defineProperty(R,ne,te)}:function(R,ee,xe,ne){ne===void 0&&(ne=xe),R[ne]=ee[xe]}),O=this&&this.__exportStar||function(R,ee){for(var xe in R)xe==="default"||Object.prototype.hasOwnProperty.call(ee,xe)||A(ee,R,xe)};Object.defineProperty(a,"__esModule",{value:!0}),O(l(1670),a);const Y=l(1670);{const R=l(7714).R;(0,Y.registerBackend)("webgl",R,-10)}{const R=l(4200).c8;(0,Y.registerBackend)("cpu",R,10),(0,Y.registerBackend)("wasm",R,10),(0,Y.registerBackend)("xnnpack",R,9)}},246:(g,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createAttributeWithCacheKey=void 0;class l{constructor(O){Object.assign(this,O)}get cacheKey(){return this._cacheKey||(this._cacheKey=Object.getOwnPropertyNames(this).sort().map((O=>`${this[O]}`)).join(";")),this._cacheKey}}a.createAttributeWithCacheKey=A=>new l(A)},7778:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Attribute=void 0;const A=l(1446),O=l(9395),Y=l(9162),R=l(2517);var ee=O.onnxruntime.experimental.fbs;class xe{constructor(te){if(this._attributes=new Map,te!=null){for(const f of te)f instanceof A.onnx.AttributeProto?this._attributes.set(f.name,[xe.getValue(f),xe.getType(f)]):f instanceof ee.Attribute&&this._attributes.set(f.name(),[xe.getValue(f),xe.getType(f)]);if(this._attributes.size<te.length)throw new Error("duplicated attribute names")}}set(te,f,d){this._attributes.set(te,[d,f])}delete(te){this._attributes.delete(te)}getFloat(te,f){return this.get(te,"float",f)}getInt(te,f){return this.get(te,"int",f)}getString(te,f){return this.get(te,"string",f)}getTensor(te,f){return this.get(te,"tensor",f)}getFloats(te,f){return this.get(te,"floats",f)}getInts(te,f){return this.get(te,"ints",f)}getStrings(te,f){return this.get(te,"strings",f)}getTensors(te,f){return this.get(te,"tensors",f)}get(te,f,d){const H=this._attributes.get(te);if(H===void 0){if(d!==void 0)return d;throw new Error(`required attribute not found: ${te}`)}if(H[1]!==f)throw new Error(`type mismatch: expected ${f} but got ${H[1]}`);return H[0]}static getType(te){const f=te instanceof A.onnx.AttributeProto?te.type:te.type();switch(f){case A.onnx.AttributeProto.AttributeType.FLOAT:return"float";case A.onnx.AttributeProto.AttributeType.INT:return"int";case A.onnx.AttributeProto.AttributeType.STRING:return"string";case A.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case A.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case A.onnx.AttributeProto.AttributeType.INTS:return"ints";case A.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case A.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw new Error(`attribute type is not supported yet: ${A.onnx.AttributeProto.AttributeType[f]}`)}}static getValue(te){const f=te instanceof A.onnx.AttributeProto?te.type:te.type();if(f===A.onnx.AttributeProto.AttributeType.GRAPH||f===A.onnx.AttributeProto.AttributeType.GRAPHS)throw new Error("graph attribute is not supported yet");const d=this.getValueNoCheck(te);if(f===A.onnx.AttributeProto.AttributeType.INT&&R.LongUtil.isLong(d))return R.LongUtil.longToNumber(d);if(f===A.onnx.AttributeProto.AttributeType.INTS){const H=d,Z=new Array(H.length);for(let Ye=0;Ye<H.length;Ye++){const et=H[Ye];Z[Ye]=R.LongUtil.longToNumber(et)}return Z}if(f===A.onnx.AttributeProto.AttributeType.TENSOR)return te instanceof A.onnx.AttributeProto?Y.Tensor.fromProto(d):Y.Tensor.fromOrtTensor(d);if(f===A.onnx.AttributeProto.AttributeType.TENSORS){if(te instanceof A.onnx.AttributeProto)return d.map((H=>Y.Tensor.fromProto(H)));if(te instanceof ee.Attribute)return d.map((H=>Y.Tensor.fromOrtTensor(H)))}if(f===A.onnx.AttributeProto.AttributeType.STRING&&te instanceof A.onnx.AttributeProto){const H=d;return(0,R.decodeUtf8String)(H)}return f===A.onnx.AttributeProto.AttributeType.STRINGS&&te instanceof A.onnx.AttributeProto?d.map(R.decodeUtf8String):d}static getValueNoCheck(te){return te instanceof A.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(te):this.getValueNoCheckFromOrtFormat(te)}static getValueNoCheckFromOnnxFormat(te){switch(te.type){case A.onnx.AttributeProto.AttributeType.FLOAT:return te.f;case A.onnx.AttributeProto.AttributeType.INT:return te.i;case A.onnx.AttributeProto.AttributeType.STRING:return te.s;case A.onnx.AttributeProto.AttributeType.TENSOR:return te.t;case A.onnx.AttributeProto.AttributeType.GRAPH:return te.g;case A.onnx.AttributeProto.AttributeType.FLOATS:return te.floats;case A.onnx.AttributeProto.AttributeType.INTS:return te.ints;case A.onnx.AttributeProto.AttributeType.STRINGS:return te.strings;case A.onnx.AttributeProto.AttributeType.TENSORS:return te.tensors;case A.onnx.AttributeProto.AttributeType.GRAPHS:return te.graphs;default:throw new Error(`unsupported attribute type: ${A.onnx.AttributeProto.AttributeType[te.type]}`)}}static getValueNoCheckFromOrtFormat(te){switch(te.type()){case ee.AttributeType.FLOAT:return te.f();case ee.AttributeType.INT:return te.i();case ee.AttributeType.STRING:return te.s();case ee.AttributeType.TENSOR:return te.t();case ee.AttributeType.GRAPH:return te.g();case ee.AttributeType.FLOATS:return te.floatsArray();case ee.AttributeType.INTS:{const f=[];for(let d=0;d<te.intsLength();d++)f.push(te.ints(d));return f}case ee.AttributeType.STRINGS:{const f=[];for(let d=0;d<te.stringsLength();d++)f.push(te.strings(d));return f}case ee.AttributeType.TENSORS:{const f=[];for(let d=0;d<te.tensorsLength();d++)f.push(te.tensors(d));return f}default:throw new Error(`unsupported attribute type: ${ee.AttributeType[te.type()]}`)}}}a.Attribute=xe},7091:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.resolveBackend=a.backend=void 0;const A=l(5038),O=new Map;async function Y(R){const ee=a.backend;if(ee[R]!==void 0&&(function(xe){const ne=xe;return"initialize"in ne&&typeof ne.initialize=="function"&&"createSessionHandler"in ne&&typeof ne.createSessionHandler=="function"&&"dispose"in ne&&typeof ne.dispose=="function"})(ee[R])){const xe=ee[R];let ne=xe.initialize();if(typeof ne=="object"&&"then"in ne&&(ne=await ne),ne)return O.set(R,xe),xe}}a.backend={webgl:new A.WebGLBackend},a.resolveBackend=async function R(ee){if(!ee)return R(["webgl"]);{const xe=typeof ee=="string"?[ee]:ee;for(const ne of xe){const te=O.get(ne);if(te)return te;const f=await Y(ne);if(f)return f}}throw new Error("no available backend to use")}},5038:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.WebGLBackend=void 0;const A=l(1670),O=l(6231),Y=l(6416),R=l(7305);a.WebGLBackend=class{get contextId(){return A.env.webgl.contextId}set contextId(ee){A.env.webgl.contextId=ee}get matmulMaxBatchSize(){return A.env.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(ee){A.env.webgl.matmulMaxBatchSize=ee}get textureCacheMode(){return A.env.webgl.textureCacheMode}set textureCacheMode(ee){A.env.webgl.textureCacheMode=ee}get pack(){return A.env.webgl.pack}set pack(ee){A.env.webgl.pack=ee}get async(){return A.env.webgl.async}set async(ee){A.env.webgl.async=ee}initialize(){try{return this.glContext=(0,R.createWebGLContext)(this.contextId),typeof this.matmulMaxBatchSize!="number"&&(this.matmulMaxBatchSize=16),typeof this.textureCacheMode!="string"&&(this.textureCacheMode="full"),typeof this.pack!="boolean"&&(this.pack=!1),typeof this.async!="boolean"&&(this.async=!1),O.Logger.setWithEnv(A.env),O.Logger.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(ee){return O.Logger.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${ee}`),!1}}createSessionHandler(ee){return new Y.WebGLSessionHandler(this,ee)}dispose(){this.glContext.dispose()}}},5107:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CoordsGlslLib=void 0;const A=l(2517),O=l(8520),Y=l(5060),R=l(7859),ee=l(9390);class xe extends O.GlslLib{constructor(te){super(te)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.offsetToCoords()),this.coordsToOffset()),this.toVec()),this.valueFrom()),this.getCommonUtilFuncs()),this.getInputsSamplingSnippets()),this.getOutputSamplingSnippet())}getCustomTypes(){return{}}offsetToCoords(){return{offsetToCoords:new O.GlslLibRoutine(`
      vec2 offsetToCoords(int offset, int width, int height) {
        int t = offset / width;
        int s = offset - t*width;
        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);
        return coords;
      }
      `)}}coordsToOffset(){return{coordsToOffset:new O.GlslLibRoutine(`
      int coordsToOffset(vec2 coords, int width, int height) {
        float s = coords.s * float(width);
        float t = coords.t * float(height);
        int offset = int(t) * width + int(s);
        return offset;
      }
      `)}}getOutputSamplingSnippet(){const te=this.context.outputTextureLayout;return te.isPacked?this.getPackedOutputSamplingSnippet(te):this.getUnpackedOutputSamplingSnippet(te)}getPackedOutputSamplingSnippet(te){const f=te.unpackedShape,d=[te.width,te.height],H={},Z="getOutputCoords";switch(f.length){case 0:H[Z]=this.getOutputScalarCoords();break;case 1:H[Z]=this.getOutputPacked1DCoords(f,d);break;case 2:H[Z]=this.getOutputPacked2DCoords(f,d);break;case 3:H[Z]=this.getOutputPacked3DCoords(f,d);break;default:H[Z]=this.getOutputPackedNDCoords(f,d)}const Ye=`
      void setOutput(vec4 val) {
        ${(0,Y.getGlsl)(this.context.glContext.version).output} = val;
      }
    `;return H.floatTextureSetRGBA=new O.GlslLibRoutine(Ye),H}getUnpackedOutputSamplingSnippet(te){const f=te.unpackedShape,d=[te.width,te.height],H={},Z="getOutputCoords";switch(f.length){case 0:H[Z]=this.getOutputScalarCoords();break;case 1:H[Z]=this.getOutputUnpacked1DCoords(f,d);break;case 2:H[Z]=this.getOutputUnpacked2DCoords(f,d);break;case 3:H[Z]=this.getOutputUnpacked3DCoords(f,d);break;case 4:H[Z]=this.getOutputUnpacked4DCoords(f,d);break;case 5:H[Z]=this.getOutputUnpacked5DCoords(f,d);break;case 6:H[Z]=this.getOutputUnpacked6DCoords(f,d);break;default:throw new Error(`Unsupported output dimensionality: ${f.length}`)}const Ye=`
        void setOutput(float val) {
          ${(0,Y.getGlsl)(this.context.glContext.version).output} = vec4(val, 0, 0, 0);
        }
    `;return H.floatTextureSetR=new O.GlslLibRoutine(Ye),H}getOutputScalarCoords(){return new O.GlslLibRoutine(`
      int getOutputCoords() {
        return 0;
      }
    `)}getOutputPacked1DCoords(te,f){const d=f;let H="";return d[0]===1?(H=`
          int getOutputCoords() {
            return 2 * int(TexCoords.y * ${d[1]}.0);
          }
        `,new O.GlslLibRoutine(H)):d[1]===1?(H=`
          int getOutputCoords() {
            return 2 * int(TexCoords.x * ${d[0]}.0);
          }
        `,new O.GlslLibRoutine(H)):(H=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                 vec2(${d[0]}, ${d[1]}));
          return 2 * (resTexRC.y * ${d[0]} + resTexRC.x);
        }
      `,new O.GlslLibRoutine(H))}getOutputPacked2DCoords(te,f){let d="";if(A.ArrayUtil.arraysEqual(te,f))return d=`
        ivec2 getOutputCoords() {
          return 2 * ivec2(TexCoords.xy * vec2(${f[0]}, ${f[1]}));
        }
      `,new O.GlslLibRoutine(d);const H=f,Z=Math.ceil(te[1]/2);return d=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${H[0]}, ${H[1]}));

          int index = resTexRC.y * ${H[0]} + resTexRC.x;

          // reverse r and c order for packed texture
          int r = imod(index, ${Z}) * 2;
          int c = 2 * (index / ${Z});

          return ivec2(r, c);
        }
      `,new O.GlslLibRoutine(d)}getOutputPacked3DCoords(te,f){const d=[f[0],f[1]],H=Math.ceil(te[2]/2),Z=H*Math.ceil(te[1]/2),Ye=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${d[0]}, ${d[1]}));
          int index = resTexRC.y * ${d[0]} + resTexRC.x;

          int b = index / ${Z};
          index -= b * ${Z};

          // reverse r and c order for packed texture
          int r = imod(index, ${H}) * 2;
          int c = 2 * (index / ${H});

          return ivec3(b, r, c);
        }
      `;return new O.GlslLibRoutine(Ye)}getOutputPackedNDCoords(te,f){const d=[f[0],f[1]],H=Math.ceil(te[te.length-1]/2),Z=H*Math.ceil(te[te.length-2]/2);let Ye=Z,et="",tt="b, r, c";for(let it=2;it<te.length-1;it++)Ye*=te[te.length-it-1],et=`
      int b${it} = index / ${Ye};
      index -= b${it} * ${Ye};
    `+et,tt=`b${it}, `+tt;const nt=`
      ivec${te.length} getOutputCoords() {
        ivec2 resTexRC = ivec2(TexCoords.xy *
                              vec2(${d[0]}, ${d[1]}));
        int index = resTexRC.y * ${d[0]} + resTexRC.x;

        ${et}

        int b = index / ${Z};
        index -= b * ${Z};

        // reverse r and c order for packed texture
        int r = imod(index, ${H}) * 2;
        int c = 2 * (index / ${H});

        return ivec${te.length}(${tt});
      }
    `;return new O.GlslLibRoutine(nt)}getOutputUnpacked1DCoords(te,f){const d=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${f[0]}, ${f[1]}));
          return resTexRC.y * ${f[0]} + resTexRC.x;
        }
      `;return new O.GlslLibRoutine(d)}getOutputUnpacked2DCoords(te,f){const d=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${f[0]}, ${f[1]}));
          int index = resTexRC.y * ${f[0]} + resTexRC.x;
          int r = index / ${te[1]};
          int c = index - r * ${te[1]};
          return ivec2(r, c);
        }
      `;return new O.GlslLibRoutine(d)}getOutputUnpacked3DCoords(te,f){let d="";const H=te.length;let Z=null;H<2&&(Z=[]),Z=new Array(H-1),Z[H-2]=te[H-1];for(let tt=H-3;tt>=0;--tt)Z[tt]=Z[tt+1]*te[tt+1];const Ye=["r","c","d"],et=Z.map(((tt,nt)=>`int ${Ye[nt]} = index / ${tt}; ${nt===Z.length-1?`int ${Ye[nt+1]} = index - ${Ye[nt]} * ${tt}`:`index -= ${Ye[nt]} * ${tt}`};`)).join("");return d=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${f[0]}, ${f[1]}));
          int index = resTexRC.y * ${f[0]} + resTexRC.x;
          ${et}
          return ivec3(r, c, d);
        }
      `,new O.GlslLibRoutine(d)}getOutputUnpacked4DCoords(te,f){let d="";const H=te.length;let Z=null;H<2&&(Z=[]),Z=new Array(H-1),Z[H-2]=te[H-1];for(let tt=H-3;tt>=0;--tt)Z[tt]=Z[tt+1]*te[tt+1];const Ye=["r","c","d","d2"],et=Z.map(((tt,nt)=>`int ${Ye[nt]} = index / ${tt}; ${nt===Z.length-1?`int ${Ye[nt+1]} = index - ${Ye[nt]} * ${tt}`:`index -= ${Ye[nt]} * ${tt}`};`)).join("");return d=`
      ivec4 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${f[0]}, ${f[1]}));
          int index = resTexRC.y * ${f[0]} + resTexRC.x;
          ${et}
          return ivec4(r, c, d, d2);
        }
      `,new O.GlslLibRoutine(d)}getOutputUnpacked5DCoords(te,f){let d="";const H=te.length;let Z=null;H<2&&(Z=[]),Z=new Array(H-1),Z[H-2]=te[H-1];for(let tt=H-3;tt>=0;--tt)Z[tt]=Z[tt+1]*te[tt+1];const Ye=["r","c","d","d2","d3"],et=Z.map(((tt,nt)=>`int ${Ye[nt]} = index / ${tt}; ${nt===Z.length-1?`int ${Ye[nt+1]} = index - ${Ye[nt]} * ${tt}`:`index -= ${Ye[nt]} * ${tt}`};`)).join("");return d=`
      ivec5 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${f[0]}, ${f[1]}));
          int index = resTexRC.y * ${f[0]} + resTexRC.x;
          ${et}
          return ivec5(r, c, d, d2, d3);
        }
      `,new O.GlslLibRoutine(d)}getOutputUnpacked6DCoords(te,f){let d="";const H=te.length;let Z=null;H<2&&(Z=[]),Z=new Array(H-1),Z[H-2]=te[H-1];for(let tt=H-3;tt>=0;--tt)Z[tt]=Z[tt+1]*te[tt+1];const Ye=["r","c","d","d2","d3","d4"],et=Z.map(((tt,nt)=>`int ${Ye[nt]} = index / ${tt}; ${nt===Z.length-1?`int ${Ye[nt+1]} = index - ${Ye[nt]} * ${tt}`:`index -= ${Ye[nt]} * ${tt}`};`)).join("");return d=`
     ivec6 getOutputCoords() {
         ivec2 resTexRC = ivec2(TexCoords.xy *
                               vec2(${f[0]}, ${f[1]}));
         int index = resTexRC.y * ${f[0]} + resTexRC.x;
         ${et}
         return ivec6(r, c, d, d2, d3, d4);
       }
     `,new O.GlslLibRoutine(d)}getCommonUtilFuncs(){const te={};let f="uvFromFlat";te[f]=new O.GlslLibRoutine(`
    vec2 uvFromFlat(int texNumR, int texNumC, int index) {
      int texC = index / texNumR;
      int texR = index - texC * texNumR;
      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to
      //       v.
      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);
    }
    `),f="packedUVfrom1D",te[f]=new O.GlslLibRoutine(`
      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
        int texelIndex = index / 2;
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),f="packedUVfrom2D",te[f]=new O.GlslLibRoutine(`
      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {
        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),f="packedUVfrom3D",te[f]=new O.GlslLibRoutine(`
      vec2 packedUVfrom3D(int texNumR, int texNumC,
          int texelsInBatch, int texelsInLogicalRow, int b,
          int row, int col) {
        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = index / texNumC;
        int texC = index - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),f="sampleTexture";const d=(0,Y.getGlsl)(this.context.glContext.version);return te[f]=new O.GlslLibRoutine(`
        float sampleTexture(sampler2D textureSampler, vec2 uv) {
            return ${d.texture2D}(textureSampler, uv).r;
        }`),te}getInputsSamplingSnippets(){const te={},f=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach(((d,H)=>{const Z=this.context.inputTextureLayouts[H],Ye=(0,ee.generateShaderFuncNameFromInputSamplerName)(d);Z.isPacked?te[Ye]=this.getPackedSamplerFromInput(Ye,d,Z):te[Ye]=this.getUnpackedSamplerFromInput(Ye,d,Z);const et=(0,ee.generateShaderFuncNameFromInputSamplerNameAtOutCoords)(d);Z.unpackedShape.length<=f.unpackedShape.length&&(Z.isPacked?te[et]=this.getPackedSamplerAtOutputCoords(et,Z,f,d):te[et]=this.getUnpackedSamplerAtOutputCoords(et,Z,f,d))})),te}getPackedSamplerAtOutputCoords(te,f,d,H){const Z=f.unpackedShape,Ye=d.unpackedShape,et=H,tt=(0,ee.generateShaderFuncNameFromInputSamplerName)(et),nt=Z.length,it=Ye.length,ot=A.BroadcastUtil.getBroadcastDims(Z,Ye),st=(0,ee.getCoordsDataType)(it),at=it-nt;let ct;const ft=(0,ee.getGlChannels)();ct=nt===0?"":it<2&&ot.length>=1?"coords = 0;":ot.map((Ot=>`coords.${ft[Ot+at]} = 0;`)).join(`
`);let ut="";ut=it<2&&nt>0?"coords":Z.map(((Ot,kt)=>`coords.${ft[kt+at]}`)).join(", ");let _t="return outputValue;";const At=A.ShapeUtil.size(Z)===1,Et=A.ShapeUtil.size(Ye)===1;if(nt!==1||At||Et){if(At&&!Et)_t=it===1?`
          return vec4(outputValue.x, outputValue.x, 0., 0.);
        `:`
          return vec4(outputValue.x);
        `;else if(ot.length){const Ot=nt-2,kt=nt-1;ot.indexOf(Ot)>-1&&ot.indexOf(kt)>-1?_t="return vec4(outputValue.x);":ot.indexOf(Ot)>-1?_t="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":ot.indexOf(kt)>-1&&(_t="return vec4(outputValue.xx, outputValue.zz);")}}else _t=`
        return vec4(outputValue.xy, outputValue.xy);
      `;const Mt=`
      vec4 ${te}() {
        ${st} coords = getOutputCoords();
        
        int lastDim = coords.${ft[it-1]};
        coords.${ft[it-1]} = coords.${ft[it-2]};
        coords.${ft[it-2]} = lastDim;
      
        ${ct}
        vec4 outputValue = ${tt}(${ut});
        ${_t}
      }
    `;return new O.GlslLibRoutine(Mt,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(te,f,d,H){const Z=[d.width,d.height],Ye=[f.width,f.height],et=f.unpackedShape.length,tt=d.unpackedShape.length,nt=f.unpackedShape,it=d.unpackedShape,ot=(0,ee.generateShaderFuncNameFromInputSamplerName)(H);if(et===tt&&A.ArrayUtil.arraysEqual(Ye,Z)){const Et=`
          float ${te}() {
            return sampleTexture(${H}, TexCoords);
          }
        `;return new O.GlslLibRoutine(Et,["coordinates.sampleTexture"])}const st=(0,ee.getCoordsDataType)(tt),at=A.BroadcastUtil.getBroadcastDims(nt,it),ct=tt-et;let ft;const ut=(0,ee.getGlChannels)();ft=et===0?"":tt<2&&at.length>=1?"coords = 0;":at.map((Et=>`coords.${ut[Et+ct]} = 0;`)).join(`
`);let _t="";_t=tt<2&&et>0?"coords":f.unpackedShape.map(((Et,Mt)=>`coords.${ut[Mt+ct]}`)).join(", ");const At=`
        float ${te}() {
          ${st} coords = getOutputCoords();
          ${ft}
          return ${ot}(${_t});
        }
      `;return new O.GlslLibRoutine(At,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(te,f,d){switch(d.unpackedShape.length){case 0:return this.getPackedSamplerScalar(te,f);case 1:return this.getPackedSampler1D(te,f,d);case 2:return this.getPackedSampler2D(te,f,d);case 3:return this.getPackedSampler3D(te,f,d);default:return this.getPackedSamplerND(te,f,d)}}getUnpackedSamplerFromInput(te,f,d){const H=d.unpackedShape;switch(H.length){case 0:return this.getUnpackedSamplerScalar(te,f,d);case 1:return this.getUnpackedSampler1D(te,f,d);case 2:return this.getUnpackedSampler2D(te,f,d);case 3:return this.getUnpackedSampler3D(te,f,d);case 4:return this.getUnpackedSampler4D(te,f,d);case 5:return this.getUnpackedSampler5D(te,f,d);case 6:return this.getUnpackedSampler6D(te,f,d);default:throw new Error(`Unsupported dimension ${H.length}-D`)}}getPackedSamplerScalar(te,f){const d=`
          vec4 ${te}() {
            return ${(0,Y.getGlsl)(this.context.glContext.version).texture2D}(${f}, halfCR);
          }
        `;return new O.GlslLibRoutine(d)}getPackedSampler1D(te,f,d){const H=[d.width,d.height],Z=[H[1],H[0]],Ye=(0,Y.getGlsl)(this.context.glContext.version),et=`vec4 ${te}(int index) {
      vec2 uv = packedUVfrom1D(
      ${Z[0]}, ${Z[1]}, index);
      return ${Ye.texture2D}(${f}, uv);
    }`;return new O.GlslLibRoutine(et,["coordinates.packedUVfrom1D"])}getPackedSampler2D(te,f,d){const H=d.unpackedShape,Z=[d.width,d.height],Ye=(0,Y.getGlsl)(this.context.glContext.version),et=Z[0],tt=Z[1];if(Z!=null&&A.ArrayUtil.arraysEqual(H,Z)){const st=`vec4 ${te}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${tt}.0, ${et}.0);
        return ${Ye.texture2D}(${f}, uv);
      }`;return new O.GlslLibRoutine(st)}const nt=Z,it=Math.ceil(H[1]/2),ot=`vec4 ${te}(int row, int col) {
      vec2 uv = packedUVfrom2D(${nt[1]}, ${nt[0]}, ${it}, row, col);
      return ${Ye.texture2D}(${f}, uv);
    }`;return new O.GlslLibRoutine(ot,["coordinates.packedUVfrom2D"])}getPackedSampler3D(te,f,d){const H=d.unpackedShape,Z=[d.width,d.height],Ye=[Z[0],Z[1]],et=(0,Y.getGlsl)(this.context.glContext.version);if(H[0]===1){const st=H.slice(1),at=[1,2],ct=(0,ee.squeezeInputShape)(H,st),ft=["b","row","col"],ut=JSON.parse(JSON.stringify(d));ut.unpackedShape=ct;const _t=this.getPackedSamplerFromInput(te,f,ut),At=`${_t.routineBody}
      vec4 ${te}(int b, int row, int col) {
        return ${te}(${(0,ee.getSqueezedParams)(ft,at)});
      } `;return new O.GlslLibRoutine(At,_t.dependencies)}const tt=Ye[0],nt=Ye[1],it=Math.ceil(H[2]/2),ot=`vec4 ${te}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${nt}, ${tt}, ${it*Math.ceil(H[1]/2)}, ${it}, b, row, col);
      return ${et.texture2D}(${f}, uv);}`;return new O.GlslLibRoutine(ot,["coordinates.packedUVfrom3D"])}getPackedSamplerND(te,f,d){const H=d.unpackedShape,Z=H.length,Ye=[d.width,d.height],et=(0,Y.getGlsl)(this.context.glContext.version),tt=[Ye[0],Ye[1]],nt=tt[1],it=tt[0],ot=Math.ceil(H[Z-1]/2);let st=ot*Math.ceil(H[Z-2]/2),at="int b, int row, int col",ct=`b * ${st} + (row / 2) * ${ot} + (col / 2)`;for(let ut=2;ut<Z-1;ut++)at=`int b${ut}, `+at,st*=H[Z-ut-1],ct=`b${ut} * ${st} + `+ct;const ft=`vec4 ${te}(${at}) {
      int index = ${ct};
      int texR = index / ${it};
      int texC = index - texR * ${it};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${it}, ${nt});
      return ${et.texture2D}(${f}, uv);
    }`;return new O.GlslLibRoutine(ft)}getUnpackedSamplerScalar(te,f,d){const[H,Z]=[d.width,d.height];if(H===1&&Z===1){const et=`
          float ${te}() {
            return sampleTexture(${f}, halfCR);
          }
        `;return new O.GlslLibRoutine(et,["coordinates.sampleTexture"])}const Ye=`
        float ${te}() {
          int offset_${f} = coordsToOffset(TexCoords, ${H}, ${Z});
          vec2 uv = uvFromFlat(${H}, ${Z}, offset_${f});
          return sampleTexture(${f}, uv);
        }
      `;return new O.GlslLibRoutine(Ye,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(te,f,d){const H=d.width,Z=d.height;if(Z===1&&H===1){const et=`
        float ${te}(int index) {
          return sampleTexture(${f}, halfCR);
        }
      `;return new O.GlslLibRoutine(et,["coordinates.sampleTexture"])}if(Z===1){const et=`
          float ${te}(int index) {
            vec2 uv = vec2((float(index) + 0.5) / ${H}.0, 0.5);
            return sampleTexture(${f}, uv);
          }
        `;return new O.GlslLibRoutine(et,["coordinates.sampleTexture"])}if(H===1){const et=`
          float ${te}(int index) {
            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${Z}.0);
            return sampleTexture(${f}, uv);
          }
        `;return new O.GlslLibRoutine(et,["coordinates.sampleTexture"])}const Ye=`
        float ${te}(int index) {
          vec2 uv = uvFromFlat(${H}, ${Z}, index);
          return sampleTexture(${f}, uv);
        }
      `;return new O.GlslLibRoutine(Ye,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(te,f,d){const H=d.unpackedShape,Z=[d.height,d.width];if(Z!=null&&A.ArrayUtil.arraysEqual(H,Z)){const st=`
          float ${te}(int row, int col) {
            vec2 uv = (vec2(row, col) + halfCR) / vec2(${Z[1]}.0, ${Z[0]}.0);
            return sampleTexture(${f}, uv);
          }
        `;return new O.GlslLibRoutine(st,["coordinates.sampleTexture"])}const{newShape:Ye,keptDims:et}=(0,R.squeezeShape)(H),tt=Ye;if(tt.length<H.length){const st=(0,ee.squeezeInputShape)(H,tt),at=JSON.parse(JSON.stringify(d));at.unpackedShape=st;const ct=["col","row"],ft=`
          ${this.getUnpackedSamplerFromInput(te,f,at).routineBody}
          float ${te}(int row, int col) {
            return ${te}(${(0,ee.getSqueezedParams)(ct,et)});
          }
        `;return new O.GlslLibRoutine(ft,["coordinates.sampleTexture"])}const nt=Z[1],it=Z[0];if(it===1){const st=`
          float ${te}(int row, int col) {
            int offset_${f} = coordsToOffset(TexCoords, ${nt}, ${it});
            float index = dot(vec3(row, col, offset_${f}), vec3(${H[1]}, 1, 1));
            vec2 uv = vec2(0.5, (index + 0.5) / ${nt}.0);
            return sampleTexture(${f}, uv);
          }
        `;return new O.GlslLibRoutine(st,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(nt===1){const st=`
          float ${te}(int row, int col) {
            int offset_${f} = coordsToOffset(TexCoords, ${nt}, ${it});
            float index = dot(vec3(row, col, offset_${f}), vec3(${H[1]}, 1, 1));
            vec2 uv = vec2((index + 0.5) / ${it}.0, 0.5);
            return sampleTexture(${f}, uv);
          }
        `;return new O.GlslLibRoutine(st,["coordinates.sampleTexture","coordinates.coordsToOffset"])}const ot=`
        float ${te}(int row, int col) {
          int index = col * ${H[1]} + row;
          vec2 uv = uvFromFlat(${nt}, ${it}, index);
          return sampleTexture(${f}, uv);
        }
      `;return new O.GlslLibRoutine(ot,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(te,f,d){const H=d.unpackedShape,Z=H[1]*H[2],Ye=H[2],{newShape:et,keptDims:tt}=(0,R.squeezeShape)(H),nt=et;if(nt.length<H.length){const ot=(0,ee.squeezeInputShape)(H,nt),st=["batch","col","row"],at=JSON.parse(JSON.stringify(d));at.unpackedShape=ot;const ct=this.getUnpackedSamplerFromInput(te,f,at),ft=tt.reverse(),ut=`
          ${ct.routineBody}
          float ${te}(int batch, int row, int col) {
            return ${te}(${(0,ee.getSqueezedParams)(st,ft)});
          }
        `;return new O.GlslLibRoutine(ut,ct.dependencies)}const it=`
          float ${te}(int depth, int row, int col) {
            // Explicitly use integer operations as dot() only works on floats.
            int index = depth * ${Z} + col * ${Ye} + row;
            vec2 uv = uvFromFlat(${d.width}, ${d.height}, index);
            return sampleTexture(${f}, uv);
          }
      `;return new O.GlslLibRoutine(it,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(te,f,d){const H=d.unpackedShape,Z=H[3],Ye=H[2]*Z,et=`
        float ${te}(int row, int col, int depth, int depth2) {
          int index = row * ${H[1]*Ye} + col * ${Ye} +
              depth2 * ${Z} + depth;
          vec2 uv = uvFromFlat(${d.width}, ${d.height}, index);
          return sampleTexture(${f}, uv);
        }
      `;return new O.GlslLibRoutine(et,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(te,f,d){const H=d.unpackedShape,Z=H[4],Ye=H[3]*Z,et=H[2]*Ye,tt=H[1]*et,{newShape:nt,keptDims:it}=(0,R.squeezeShape)(H);if(nt.length<H.length){const st=(0,ee.squeezeInputShape)(H,nt),at=["row","col","depth","depth2","depth3"],ct=JSON.parse(JSON.stringify(d));ct.unpackedShape=st;const ft=`
          ${this.getUnpackedSamplerFromInput(te,f,ct).routineBody}
          float ${te}(int row, int col, int depth, int depth2, int depth3) {
            return ${te}(${(0,ee.getSqueezedParams)(at,it)});
          }
        `;return new O.GlslLibRoutine(ft,["coordinates.sampleTexture","coordinates.uvFromFlat"])}const ot=`
        float ${te}(int row, int col, int depth, int depth2, int depth3) {
          int index = row * ${tt} + col * ${et} + depth * ${Ye} +
          depth3 * ${Z} + depth2;
          vec2 uv = uvFromFlat(${d.width}, ${d.height}, index);
          return sampleTexture(${f}, uv);
        }
      `;return new O.GlslLibRoutine(ot,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(te,f,d){const H=d.unpackedShape,Z=H[5],Ye=H[4]*Z,et=H[3]*Ye,tt=H[2]*et,nt=H[1]*tt,{newShape:it,keptDims:ot}=(0,R.squeezeShape)(H);if(it.length<H.length){const at=(0,ee.squeezeInputShape)(H,it),ct=["row","col","depth","depth2","depth3","depth4"],ft=JSON.parse(JSON.stringify(d));ft.unpackedShape=at;const ut=`
            ${this.getUnpackedSamplerFromInput(te,f,ft).routineBody}
            float ${te}(int row, int col, int depth,
              int depth2, int depth3, int depth4) {
              return ${te}(${(0,ee.getSqueezedParams)(ct,ot)});
            }
          `;return new O.GlslLibRoutine(ut,["coordinates.sampleTexture","coordinates.uvFromFlat"])}const st=`
          float ${te}(int row, int col, int depth,
            int depth2, int depth3, int depth4) {
            int index = row * ${nt} + col * ${tt} + depth * ${et} +
            depth2 * ${Ye} + depth3 * ${Z} + depth4;
            vec2 uv = uvFromFlat(${d.width}, ${d.height}, index);
            return sampleTexture(${f}, uv);
          }
        `;return new O.GlslLibRoutine(st,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){const te=this.context.outputTextureLayout,f=te.shape.length,d=te.strides,H=te.width,Z=te.height,Ye=[];for(let tt=0;tt<f-1;++tt)Ye.push(`
        c[${tt}] = offset / ${d[tt]};`),Ye.push(`
        offset -= c[${tt}] * ${d[tt]};`);Ye.push(`
        c[${f-1}] = offset;`);const et=`
      void toVec(vec2 texCoords, out int c[${f}]) {
        int offset = coordsToOffset(texCoords, ${H}, ${Z});
        ${Ye.join("")}
      }
      void toVec(int offset, out int c[${f}]) {
        ${Ye.join("")}
      }
    `;return{toVec:new O.GlslLibRoutine(et,["coordinates.coordsToOffset"])}}valueFrom(){const te={};return this.context.programInfo.inputNames.forEach(((f,d)=>{const H=this.context.inputTextureLayouts[d],Z=(H.unpackedShape.length>0?H.unpackedShape:H.shape).length;let Ye=`_${f}`;te[Ye]=new O.GlslLibRoutine(this.getValueFromSingle(f,Z,H.width,H.height,!1),[`shapeUtils.indicesToOffset${Ye}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),Ye+="_T",te[Ye]=new O.GlslLibRoutine(this.getValueFromSingle(f,Z,H.width,H.height,!0),[`shapeUtils.indicesToOffset${Ye}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])})),te}getValueFromSingle(te,f,d,H,Z){let Ye=`_${te}`;return Z&&(Ye+="_T"),`
        float ${Ye}(int m[${f}]) {
          int offset = indicesToOffset${Ye}(m);
          vec2 coords = offsetToCoords(offset, ${d}, ${H});
          float value = getColorAsFloat(${(0,Y.getGlsl)(this.context.glContext.version).texture2D}(${te}, coords));
          return value;
        }
        `}getPackedValueFrom(te,f,d,H,Z){let Ye=`_${te}_Pack`;return Z&&(Ye+="_T"),`
        vec4 ${Ye}(int m[${f}]) {
          int offset = indicesToOffset_${te}(m);
          vec2 coords = offsetToCoords(offset, ${d}, ${H});
          return ${(0,Y.getGlsl)(this.context.glContext.version).texture2D}(${te}, coords);
        }
        `}}a.CoordsGlslLib=xe},8520:(g,a)=>{var l;Object.defineProperty(a,"__esModule",{value:!0}),a.TopologicalSortGlslRoutines=a.GlslLibRoutineNode=a.GlslLibRoutine=a.GlslLib=a.GlslContext=a.FunctionType=void 0,(l=a.FunctionType||(a.FunctionType={}))[l.ValueBased=0]="ValueBased",l[l.Positional=1]="Positional",a.GlslContext=class{constructor(A,O,Y,R){this.glContext=A,this.programInfo=O,this.inputTextureLayouts=Y,this.outputTextureLayout=R}},a.GlslLib=class{constructor(A){this.context=A}},a.GlslLibRoutine=class{constructor(A,O){this.routineBody=A,this.dependencies=O}},a.GlslLibRoutineNode=class{constructor(A,O,Y){this.name=A,this.dependencies=Y||[],O&&(this.routineBody=O)}addDependency(A){A&&this.dependencies.push(A)}},a.TopologicalSortGlslRoutines=class{static returnOrderedNodes(A){if(!A||A.length===0)return[];if(A.length===1)return A;const O=new Set,Y=new Set,R=new Array;return this.createOrderedNodes(A,O,Y,R),R}static createOrderedNodes(A,O,Y,R){for(let ee=0;ee<A.length;++ee)this.dfsTraverse(A[ee],O,Y,R)}static dfsTraverse(A,O,Y,R){if(!A||Y.has(A.name))return;if(O.has(A.name))throw new Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");O.add(A.name);const ee=A.dependencies;if(ee&&ee.length>0)for(let xe=0;xe<ee.length;++xe)this.dfsTraverse(ee[xe],O,Y,R);R.push(A),Y.add(A.name),O.delete(A.name)}}},7341:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.EncodingGlslLib=void 0;const A=l(8520);class O extends A.GlslLib{constructor(R){super(R)}getFunctions(){return Object.assign(Object.assign({},this.encodeFloat32()),this.decodeFloat32())}getCustomTypes(){return{}}encodeFloat32(){return{encode:new A.GlslLibRoutine(`highp vec4 encode(highp float f) {
        return vec4(f, 0.0, 0.0, 0.0);
      }
        `)}}decodeFloat32(){return{decode:new A.GlslLibRoutine(`highp float decode(highp vec4 rgba) {
        return rgba.r;
      }
        `)}}encodeUint8(){const R=O.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new A.GlslLibRoutine(`
      highp vec4 encode(highp float f) {
        highp float F = abs(f);
        highp float Sign = step(0.0,-f);
        highp float Exponent = floor(log2(F));
        highp float Mantissa = (exp2(- Exponent) * F);
        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));
        highp vec4 rgba;
        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));
        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);
        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));
        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));
        ${R}
        rgba = rgba / 255.0; // values need to be normalized to [0,1]
        return rgba;
    }
        `)}}decodeUint8(){const R=O.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new A.GlslLibRoutine(`
        highp float decode(highp vec4 rgba) {
          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]
          ${R}
          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;
          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;
          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);
          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));
          return Result;
      }
        `)}}static isLittleEndian(){const R=new ArrayBuffer(4),ee=new Uint32Array(R),xe=new Uint8Array(R);if(ee[0]=3735928559,xe[0]===239)return!0;if(xe[0]===222)return!1;throw new Error("unknown endianness")}}a.EncodingGlslLib=O},9894:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.FragColorGlslLib=void 0;const A=l(8520),O=l(5060);class Y extends A.GlslLib{constructor(ee){super(ee)}getFunctions(){return Object.assign(Object.assign({},this.setFragColor()),this.getColorAsFloat())}getCustomTypes(){return{}}setFragColor(){const ee=(0,O.getGlsl)(this.context.glContext.version);return{setFragColor:new A.GlslLibRoutine(`
        void setFragColor(float value) {
            ${ee.output} = encode(value);
        }
        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new A.GlslLibRoutine(`
        float getColorAsFloat(vec4 color) {
            return decode(color);
        }
        `,["encoding.decode"])}}}a.FragColorGlslLib=Y},2848:(g,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.replaceInlines=void 0;const l=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm;a.replaceInlines=function(A){const O={};let Y;for(;(Y=l.exec(A))!==null;){const R=Y[3].split(",").map((ee=>{const xe=ee.trim().split(" ");return xe&&xe.length===2?{type:xe[0],name:xe[1]}:null})).filter((ee=>ee!==null));O[Y[2]]={params:R,body:Y[4]}}for(const R in O){const ee="(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;".replace("__FUNC__",R),xe=new RegExp(ee,"gm");for(;(Y=xe.exec(A))!==null;){const ne=Y[1],te=Y[2],f=Y[3].split(","),d=ne?`${ne} ${te};`:"";let H=O[R].body,Z="";O[R].params.forEach(((et,tt)=>{et&&(Z+=`${et.type} ${et.name} = ${f[tt]};
`)})),H=`${Z}
 ${H}`,H=H.replace("return",`${te} = `);const Ye=`
      ${d}
      {
        ${H}
      }
      `;A=A.replace(Y[0],Ye)}}return A.replace(l,"")}},8879:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.GlslPreprocessor=void 0;const A=l(8520),O=l(2848),Y=l(5483),R=l(5060);a.GlslPreprocessor=class{constructor(ee,xe,ne,te){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new A.GlslContext(ee,xe,ne,te),Object.keys(Y.glslRegistry).forEach((d=>{const H=new Y.glslRegistry[d](this.context);this.libs[d]=H}));const f=this.glslLibRoutineDependencyGraph;for(const d in this.libs){const H=this.libs[d].getFunctions();for(const Z in H){const Ye=d+"."+Z;let et;f[Ye]?(et=f[Ye],et.routineBody=H[Z].routineBody):(et=new A.GlslLibRoutineNode(Ye,H[Z].routineBody),f[Ye]=et);const tt=H[Z].dependencies;if(tt)for(let nt=0;nt<tt.length;++nt)if(f[tt[nt]])et.addDependency(f[tt[nt]]);else{const it=new A.GlslLibRoutineNode(tt[nt]);f[tt[nt]]=it,et.addDependency(it)}}}}preprocess(){const ee=this.context.programInfo;let xe=ee.shaderSource;return this.context.programInfo.hasMain||(xe=`${xe}
      ${(0,R.getDefaultFragShaderMain)(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),xe=(0,O.replaceInlines)(xe),`${(0,R.getFragShaderPreamble)(this.context.glContext.version)}
    ${this.getUniforms(ee.inputNames,ee.variables)}
    ${this.getImports(xe)}
    ${xe}`}getImports(ee){const xe=this.selectGlslLibRoutinesToBeIncluded(ee);if(xe.length===0)return"";let ne="";for(let te=0;te<xe.length;++te){if(!xe[te].routineBody)throw new Error(`Missing body for the Glsl Library routine: ${xe[te].name}`);ne+=xe[te].routineBody+`
`}return ne}selectGlslLibRoutinesToBeIncluded(ee){const xe=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach((ne=>{const te=ne.split(".")[1];ee.indexOf(te)!==-1&&xe.push(this.glslLibRoutineDependencyGraph[ne])})),A.TopologicalSortGlslRoutines.returnOrderedNodes(xe)}getUniforms(ee,xe){const ne=[];if(ee)for(const te of ee)ne.push(`uniform sampler2D ${te};`);if(xe)for(const te of xe)ne.push(`uniform ${te.type} ${te.name}${te.arrayLength?`[${te.arrayLength}]`:""};`);return ne.join(`
`)}}},5483:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.glslRegistry=void 0;const A=l(5107),O=l(7341),Y=l(9894),R=l(2655),ee=l(3891);a.glslRegistry={encoding:O.EncodingGlslLib,fragcolor:Y.FragColorGlslLib,vec:ee.VecGlslLib,shapeUtils:R.ShapeUtilsGlslLib,coordinates:A.CoordsGlslLib}},2655:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ShapeUtilsGlslLib=void 0;const A=l(8520);class O extends A.GlslLib{constructor(R){super(R)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.bcastIndex()),this.bcastMatmulIndex()),this.offsetToIndices()),this.indicesToOffset()),this.incrementIndices())}getCustomTypes(){return{}}bcastIndex(){const R=this.context.outputTextureLayout.shape.length,ee={};return this.context.programInfo.inputNames.forEach(((xe,ne)=>{const te=this.context.inputTextureLayouts[ne].unpackedShape;if(te.length<=R){const f=te.length,d=R-f,H=`bcastIndices_${xe}`;let Z="";for(let et=0;et<f;++et)Z+=`
          realIndices[${et}] = int( mod(float(bcastedIndices[${d+et}]), ${te[et]}.0) );
          `;const Ye=`
        void ${H} (int bcastedIndices[${R}], out int realIndices[${f}]) {
          ${Z}
        }
        `;ee[H]=new A.GlslLibRoutine(Ye)}})),ee}bcastMatmulIndex(){const R=this.context.outputTextureLayout.shape.length,ee={};return this.context.programInfo.inputNames.forEach(((xe,ne)=>{const te=this.context.inputTextureLayouts[ne].shape;if(!(te.length<2||te.length>R)){const f=te.length,d=R-f,H=`bcastMatmulIndices_${xe}`;let Z="";for(let et=0;et<f-2;++et)Z+=`
          realIndices[${et}] = int( mod(float(bcastedIndices[${d+et}]), ${te[et]}.0) );
          `;const Ye=`
        void ${H}(int bcastedIndices[${R}], out int realIndices[${f}]) {
          ${Z}
          realIndices[${f-1}] = bcastedIndices[${R-1}];
          realIndices[${f-2}] = bcastedIndices[${R-2}];
        }
        `;ee[H]=new A.GlslLibRoutine(Ye)}})),ee}indicesToOffset(){const R={};return this.context.programInfo.inputNames.forEach(((ee,xe)=>{const ne=this.context.inputTextureLayouts[xe].shape,te=this.context.inputTextureLayouts[xe].strides,f=ne.length;let d=`indicesToOffset_${ee}`;R[d]=new A.GlslLibRoutine(O.indexToOffsetSingle(d,f,te)),d=`indicesToOffset_${ee}_T`,R[d]=new A.GlslLibRoutine(O.indexToOffsetSingle(d,f,te.slice().reverse()))})),R}static indexToOffsetSingle(R,ee,xe){let ne="";for(let te=ee-1;te>=0;--te)ne+=`
        offset += indices[${te}] * ${xe[te]};
        `;return`
      int ${R}(int indices[${ee}]) {
        int offset = 0;
        ${ne}
        return offset;
      }
      `}offsetToIndices(){const R={};return this.context.programInfo.inputNames.forEach(((ee,xe)=>{const ne=this.context.inputTextureLayouts[xe].shape,te=this.context.inputTextureLayouts[xe].strides,f=ne.length;let d=`offsetToIndices_${ee}`;R[d]=new A.GlslLibRoutine(O.offsetToIndicesSingle(d,f,te)),d=`offsetToIndices_${ee}_T`,R[d]=new A.GlslLibRoutine(O.offsetToIndicesSingle(d,f,te.slice().reverse()))})),R}static offsetToIndicesSingle(R,ee,xe){const ne=[];for(let te=0;te<ee-1;++te)ne.push(`
      indices[${te}] = offset / ${xe[te]};`),ne.push(`
        offset -= indices[${te}] * ${xe[te]};`);return ne.push(`
      indices[${ee-1}] = offset;`),`
      void ${R}(int offset, out int indices[${ee}]) {
        ${ne.join("")}
      }
      `}incrementIndices(){const R={};return this.context.programInfo.inputNames.forEach(((ee,xe)=>{const ne=this.context.inputTextureLayouts[xe].shape,te=ne.length,f=`incrementIndices_${ee}`;let d="";for(let Z=0;Z<te;++Z)d+=`
        shape[${Z}] = ${ne[Z]};`;const H=`
        void ${f}(int axis, out int indices[${te}]) {
          int shape[${te}];
          ${d};
          for(int i = ${te} -1 ; i >= 0; --i) {
            if(i > axis) continue;
            indices[i] += 1;
            if(indices[i] < shape[i]) {
              break;
            }
            indices[i] = 0;
          }
        }
        `;R[f]=new A.GlslLibRoutine(H)})),R}}a.ShapeUtilsGlslLib=O},5060:(g,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.getDefaultFragShaderMain=a.getFragShaderPreamble=a.getVertexShaderSource=a.getGlsl=void 0;const l={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},A={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"};function O(Y){return Y===1?l:A}a.getGlsl=O,a.getVertexShaderSource=function(Y){const R=O(Y);return`${R.version}
      precision highp float;
      ${R.attribute} vec3 position;
      ${R.attribute} vec2 textureCoord;

      ${R.varyingVertex} vec2 TexCoords;

      void main()
      {
          gl_Position = vec4(position, 1.0);
          TexCoords = textureCoord;
      }`},a.getFragShaderPreamble=function(Y){const R=O(Y);return`${R.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${R.varyingFrag} vec2 TexCoords;
    ${R.outputDeclaration}
    const vec2 halfCR = vec2(0.5, 0.5);

    // Custom vector types to handle higher dimenalities.
    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    `},a.getDefaultFragShaderMain=function(Y,R){return`
  void main() {
    int indices[${R}];
    toVec(TexCoords, indices);
    vec4 result = vec4(process(indices));
    ${O(Y).output} = result;
  }
  `}},3891:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.VecGlslLib=void 0;const A=l(8520);class O extends A.GlslLib{constructor(R){super(R)}getCustomTypes(){return{}}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign({},this.binaryVecFunctions()),this.copyVec()),this.setVecItem()),this.getVecItem())}binaryVecFunctions(){const R=this.context.outputTextureLayout.shape.length,ee={add:"+=",sub:"-=",mul:"*=",div:"/="},xe={};for(const ne in ee){const te=`${ne}Vec`;let f="";for(let H=0;H<R;++H)f+=`
          dest[${H}] ${ee[ne]} src[${H}];
          `;const d=`
        void ${te}(int src[${R}], out int dest[${R}]) {
          ${f}
        }
        `;xe[te]=new A.GlslLibRoutine(d)}return xe}copyVec(){const R=this.context.outputTextureLayout.shape.length;let ee="";for(let ne=0;ne<R;++ne)ee+=`
        dest[${ne}] = src[${ne}];
        `;const xe=`
      void copyVec(int src[${R}], out int dest[${R}]) {
        ${ee}
      }
      `;return{copyVec:new A.GlslLibRoutine(xe)}}setVecItem(){const R=this.context.outputTextureLayout.shape.length;let ee=`
        if(index < 0)
            index =${R} + index;
        if (index == 0)
            m[0] = value;
        `;for(let ne=1;ne<R-1;++ne)ee+=`
        else if (index == ${ne})
            m[${ne}] = value;
            `;ee+=`
        else
            m[${R-1}] = value;
        `;const xe=`
      void setVecItem(out int m[${R}], int index, int value) {
        ${ee}
      }
        `;return{setVecItem:new A.GlslLibRoutine(xe)}}getVecItem(){const R=this.context.outputTextureLayout.shape.length;let ee=`
        if(index < 0)
            index = ${R} + index;
        if (index == 0)
            return m[0];
      `;for(let ne=1;ne<R-1;++ne)ee+=`
        else if (index == ${ne})
            return m[${ne}];
      `;ee+=`
        else
            return m[${R-1}];
        `;const xe=`
      int getVecItem(int m[${R}], int index) {
        ${ee}
      }
    `;return{getVecItem:new A.GlslLibRoutine(xe)}}}a.VecGlslLib=O},8316:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.WebGLInferenceHandler=void 0;const A=l(6231),O=l(9162),Y=l(2517),R=l(2403),ee=l(7019),xe=l(8710),ne=l(5611),te=l(4057),f=l(2039);a.WebGLInferenceHandler=class{constructor(d){this.session=d,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(d,H){return(0,te.calculateTextureWidthAndHeight)(this.session.layoutStrategy,d,H)}executeProgram(d,H){if(H.length<d.inputNames.length)throw new Error(`Input size mustn't be less than ${d.inputNames.length}.`);if(d.inputNames.length!==d.inputTypes.length)throw new Error("input names size does not match input types");const Z=[];for(let ot=0;ot<d.inputNames.length;++ot)Z[ot]=this.getOrCreateTextureData(H[ot],d.inputTypes[ot]);const Ye=((ot,st)=>{const at=st.map((ft=>`${ft.unpackedShape.join(",")};${ft.width}x${ft.height}`)).join("_");let ct=ot.name;return ot.cacheHint&&(ct+="["+ot.cacheHint+"]"),ct+=":"+at,ct})(d,Z);let et=this.session.programManager.getArtifact(Ye);const tt=et?et.programInfo:typeof d.get=="function"?d.get():d,nt=(0,te.createTextureLayoutFromTextureType)(this.session.layoutStrategy,tt.output.dims,tt.output.textureType),it=this.createTextureData(nt,tt.output.type);return et||(et=this.session.programManager.build(tt,Z,it),this.session.programManager.setArtifact(Ye,et)),this.runProgram(et,Z,it),it}run(d,H){return this.executeProgram(d,H).tensor}runProgram(d,H,Z){for(let Ye=0;Ye<H.length;++Ye)if(!!H[Ye].isPacked!=(d.programInfo.inputTypes[Ye]===f.TextureType.packed))throw new Error(`input[${Ye}] property packed inconsistent`);if(!!Z.isPacked!=(d.programInfo.output.textureType===f.TextureType.packed))throw new Error("output property packed inconsistent");this.session.programManager.run(d,H,Z)}getOrCreateTextureData(d,H){let Z=this.getTextureData(d.dataId,H===f.TextureType.packed);if(!Z&&(Z=this.getTextureData(d.dataId,H!==f.TextureType.packed),Z))return H===f.TextureType.packed?this.pack(Z):this.unpack(Z);if(!Z){const Ye=(0,te.createTextureLayoutFromTextureType)(this.session.layoutStrategy,d.dims,H);if(H===f.TextureType.packedLastDimension){const nt=d.dims;if(nt.length===4){const it=[nt[0],Math.ceil(nt[1]*nt[2]*nt[3]/4)],ot=(0,te.createTextureLayoutFromTextureType)(this.session.layoutStrategy,it,H);let st=d.numberData;if(nt[1]*nt[2]*nt[3]%4!=0){const at=nt[0],ct=nt[1]*nt[2]*nt[3],ft=Math.ceil(ct*1/4)*4;st=new Float32Array(at*ft);for(let ut=0;ut<at;++ut){const _t=ut*ct,At=ut*ft+ut%1*ct;st.set(d.numberData.subarray(_t,_t+ct),At)}}return this.createTextureData(ot,d.type,st,d,1)}}if(H===f.TextureType.packed){const et=(0,te.createTextureLayoutFromShape)(this.session.layoutStrategy,d.dims,1,[],{reverseWH:!0}),tt=this.createTextureData(et,d.type,d.numberData,d,1);Z=this.pack(tt)}else Z=this.createTextureData(Ye,d.type,d.numberData,d,1)}return Z}createTextureDataFromLayoutBindTensor(d,H,Z,Ye){return this.createTextureData(d,H,Z,Ye,1)}createTextureData(d,H,Z,Ye,et){A.Logger.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(d)}]`);const tt=this.session.textureManager.createTextureFromLayout(H,d,Z,et);return this.createTextureDataFromTexture(d,H,tt,Ye)}reshapeUnpacked(d,H){const Z=this.getOrCreateTextureData(d,f.TextureType.unpacked),Ye={channels:Z.channels,height:Z.height,width:Z.width,shape:H.length!==0?H:[1],strides:Y.ShapeUtil.computeStrides(H),unpackedShape:H};return this.createTextureDataFromTexture(Ye,d.type,Z.texture).tensor}reshapePacked(d,H){const Z=this.getOrCreateTextureData(d,f.TextureType.packed);if((0,ee.isReshapeCheap)(d.dims,H)){const it={channels:Z.channels,height:Z.height,width:Z.width,shape:H.length!==0?H:[1],strides:Y.ShapeUtil.computeStrides(H),unpackedShape:H,isPacked:!0};return this.createTextureDataFromTexture(it,d.type,Z.texture).tensor}const Ye=(0,ee.processDims3D)(d.dims),et=(0,ee.processDims3D)(H),tt=this.reshapePacked(d,Ye),nt=this.run((0,ee.createPackedReshape3DProgramInfoLoader)(this,tt,et),[tt]);return this.reshapePacked(nt,H)}cast(d,H){const Z=this.getOrCreateTextureData(d,f.TextureType.unpacked);return this.createTextureDataFromTexture(Z,H,Z.texture).tensor}createTextureDataFromTexture(d,H,Z,Ye,et){const tt=Object.assign(Object.assign({},d),{tensor:Ye||new O.Tensor(d.unpackedShape,H,(nt=>this.readTexture(tt)),(async nt=>this.readTextureAsync(tt)),void 0,et),texture:Z});return this.setTextureData(tt.tensor.dataId,tt,d.isPacked),tt}getTextureData(d,H=!1){return this.session.isInitializer(d)?this.session.getTextureData(d,H):H?this.packedTextureDataCache.get(d):this.unpackedTextureDataCache.get(d)}setTextureData(d,H,Z=!1){this.session.isInitializer(d)?this.session.setTextureData(d,H,Z):(Z?this.packedTextureDataCache:this.unpackedTextureDataCache).set(d,H)}isTextureLayoutCached(d,H=!1){return!!this.getTextureData(d.dataId,H)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((d=>this.session.textureManager.releaseTexture(d))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((d=>this.session.textureManager.releaseTexture(d))),this.unpackedTextureDataCache=new Map}readTexture(d){return d.isPacked?this.readTexture(this.unpack(d)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(d,d.tensor.type,d.channels):this.session.textureManager.readUint8TextureAsFloat((0,xe.encodeAsUint8)(this,d))}async readTextureAsync(d){return d.isPacked?this.readTextureAsync(this.unpack(d)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(d,d.tensor.type,d.channels):this.session.textureManager.readUint8TextureAsFloat((0,xe.encodeAsUint8)(this,d))}pack(d){return this.executeProgram((0,R.createPackProgramInfoLoader)(this,d.tensor),[d.tensor])}unpack(d){return this.executeProgram((0,ne.createUnpackProgramInfoLoader)(this,d.tensor),[d.tensor])}}},1640:function(g,a,l){var A=this&&this.__createBinding||(Object.create?function(Ft,ln,dn,Pt){Pt===void 0&&(Pt=dn);var $t=Object.getOwnPropertyDescriptor(ln,dn);$t&&!("get"in $t?!ln.__esModule:$t.writable||$t.configurable)||($t={enumerable:!0,get:function(){return ln[dn]}}),Object.defineProperty(Ft,Pt,$t)}:function(Ft,ln,dn,Pt){Pt===void 0&&(Pt=dn),Ft[Pt]=ln[dn]}),O=this&&this.__setModuleDefault||(Object.create?function(Ft,ln){Object.defineProperty(Ft,"default",{enumerable:!0,value:ln})}:function(Ft,ln){Ft.default=ln}),Y=this&&this.__importStar||function(Ft){if(Ft&&Ft.__esModule)return Ft;var ln={};if(Ft!=null)for(var dn in Ft)dn!=="default"&&Object.prototype.hasOwnProperty.call(Ft,dn)&&A(ln,Ft,dn);return O(ln,Ft),ln};Object.defineProperty(a,"__esModule",{value:!0}),a.WEBGL_OP_RESOLVE_RULES=void 0;const R=l(2898),ee=Y(l(7839)),xe=l(4196),ne=l(2069),te=l(8138),f=l(9663),d=l(5193),H=l(7992),Z=l(1253),Ye=l(4776),et=l(6572),tt=l(3346),nt=l(5623),it=l(2870),ot=l(2143),st=l(4939),at=l(718),ct=l(2268),ft=l(8117),ut=l(2278),_t=l(5524),At=l(5975),Et=l(3933),Mt=l(6558),Ot=l(5723),kt=l(3738),yt=Y(l(4909)),St=l(8428),Yt=l(9793);a.WEBGL_OP_RESOLVE_RULES=[["Abs","","6+",yt.abs],["Acos","","7+",yt.acos],["Add","","7+",ee.add],["And","","7+",ee.and],["Asin","","7+",yt.asin],["Atan","","7+",yt.atan],["AveragePool","","7+",ot.averagePool,ot.parseAveragePoolAttributes],["BatchNormalization","","7+",R.batchNormalization,R.parseBatchNormalizationAttributes],["Cast","","6+",xe.cast,xe.parseCastAttributes],["Ceil","","6+",yt.ceil],["Clip","","6-10",yt.clip,yt.parseClipAttributes],["Clip","","11+",yt.clipV11],["Concat","","4+",ne.concat,ne.parseConcatAttributes],["Conv","","1+",te.conv,te.parseConvAttributes],["ConvTranspose","","1+",f.convTranspose,f.parseConvTransposeAttributes],["Cos","","7+",yt.cos],["Div","","7+",ee.div],["Dropout","","7+",yt.identity],["DepthToSpace","","1+",d.depthToSpace,d.parseDepthToSpaceAttributes],["Equal","","7+",ee.equal],["Elu","","6+",yt.elu,yt.parseEluAttributes],["Exp","","6+",yt.exp],["Flatten","","1+",H.flatten,H.parseFlattenAttributes],["Floor","","6+",yt.floor],["FusedConv","com.microsoft","1+",te.conv,te.parseConvAttributes],["Gather","","1+",Z.gather,Z.parseGatherAttributes],["Gemm","","7-10",Ye.gemm,Ye.parseGemmAttributesV7],["Gemm","","11+",Ye.gemm,Ye.parseGemmAttributesV11],["GlobalAveragePool","","1+",ot.globalAveragePool,ot.parseGlobalAveragePoolAttributes],["GlobalMaxPool","","1+",ot.globalMaxPool],["Greater","","7+",ee.greater],["Identity","","1+",yt.identity],["ImageScaler","","1+",et.imageScaler,et.parseImageScalerAttributes],["InstanceNormalization","","6+",tt.instanceNormalization,tt.parseInstanceNormalizationAttributes],["LeakyRelu","","6+",yt.leakyRelu,yt.parseLeakyReluAttributes],["Less","","7+",ee.less],["Log","","6+",yt.log],["MatMul","","1+",nt.matMul,nt.parseMatMulAttributes],["MaxPool","","1+",ot.maxPool,ot.parseMaxPoolAttributes],["Mul","","7+",ee.mul],["Neg","","6+",yt.neg],["Not","","1+",yt.not],["Or","","7+",ee.or],["Pad","","2-10",it.padV2,it.parsePadAttributesV2],["Pad","","11+",it.padV11,it.parsePadAttributesV11],["Pow","","7+",ee.pow],["PRelu","","7+",ee.pRelu],["ReduceLogSum","","1+",st.reduceLogSum,st.parseReduceAttributes],["ReduceMax","","1+",st.reduceMax,st.parseReduceAttributes],["ReduceMean","","1+",st.reduceMean,st.parseReduceAttributes],["ReduceMin","","1+",st.reduceMin,st.parseReduceAttributes],["ReduceProd","","1+",st.reduceProd,st.parseReduceAttributes],["ReduceSum","","1-12",st.reduceSum,st.parseReduceAttributes],["ReduceSumSquare","","1+",st.reduceLogSumSquare,st.parseReduceAttributes],["Relu","","6+",yt.relu],["Reshape","","5+",at.reshape],["Resize","","10",ct.resize,ct.parseResizeAttributesV10],["Resize","","11+",ct.resize,ct.parseResizeAttributesV11],["Shape","","1+",ft.shape],["Sigmoid","","6+",yt.sigmoid],["Sin","","7+",yt.sin],["Slice","","10+",ut.sliceV10],["Slice","","1-9",ut.slice,ut.parseSliceAttributes],["Softmax","","1-12",_t.softmax,_t.parseSoftmaxAttributes],["Softmax","","13+",_t.softmaxV13,_t.parseSoftmaxAttributesV13],["Split","","2-12",At.split,At.parseSplitAttributes],["Sqrt","","6+",yt.sqrt],["Squeeze","","1-12",Et.squeeze,Et.parseSqueezeAttributes],["Squeeze","","13+",Et.squeezeV13],["Sub","","7+",ee.sub],["Sum","","6+",Mt.sum],["Tan","","7+",yt.tan],["Tanh","","6+",yt.tanh],["Tile","","6+",Ot.tile],["Transpose","","1+",kt.transpose,kt.parseTransposeAttributes],["Upsample","","7-8",Yt.upsample,Yt.parseUpsampleAttributesV7],["Upsample","","9",Yt.upsample,Yt.parseUpsampleAttributesV9],["Unsqueeze","","1-12",St.unsqueeze,St.parseUnsqueezeAttributes],["Unsqueeze","","13+",St.unsqueezeV13],["Xor","","7+",ee.xor]]},2898:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseBatchNormalizationAttributes=a.batchNormalization=void 0;const A=l(246),O=l(5060),Y=l(2039),R={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[Y.TextureType.unpacked,Y.TextureType.unpacked,Y.TextureType.unpacked,Y.TextureType.unpacked,Y.TextureType.unpacked]};a.batchNormalization=(ne,te,f)=>(xe(te),[ne.run(Object.assign(Object.assign({},R),{cacheHint:f.cacheKey,get:()=>ee(ne,te,f)}),te)]),a.parseBatchNormalizationAttributes=ne=>{const te=ne.attributes.getFloat("epsilon",1e-5),f=ne.attributes.getFloat("momentum",.9),d=ne.attributes.getInt("spatial",1);return(0,A.createAttributeWithCacheKey)({epsilon:te,momentum:f,spatial:d})};const ee=(ne,te,f)=>{const d=(0,O.getGlsl)(ne.session.backend.glContext.version),H=te[0].dims.length,[Z,Ye]=ne.calculateTextureWidthAndHeight(te[1].dims,Y.TextureType.unpacked),et=`
  float process(int[${H}] indices) {
    vec2 position = offsetToCoords(indices[1], ${Z}, ${Ye});
    float scale = getColorAsFloat(${d.texture2D}(Scale, position));
    float mean = getColorAsFloat(${d.texture2D}(Mean, position));
    float variance = getColorAsFloat(${d.texture2D}(Variance, position));
    float b = getColorAsFloat(${d.texture2D}(B, position));

    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${f.epsilon})) ) + b;
  }`;return Object.assign(Object.assign({},R),{output:{dims:te[0].dims,type:te[0].type,textureType:Y.TextureType.unpacked},shaderSource:et})},xe=ne=>{if(!ne||ne.length!==5)throw new Error("BatchNormalization requires 5 inputs.");const te=ne[0],f=ne[1],d=ne[2],H=ne[3],Z=ne[4];if(te.dims.length<3||f.dims.length!==1||d.dims.length!==1||H.dims.length!==1||Z.dims.length!==1)throw new Error("invalid input shape.");if(f.dims[0]!==te.dims[1]||d.dims[0]!==te.dims[1]||H.dims[0]!==te.dims[1]||Z.dims[0]!==te.dims[1])throw new Error("invalid input shape.");if(te.type!=="float32"&&te.type!=="float64"||f.type!=="float32"&&f.type!=="float64"||d.type!=="float32"&&d.type!=="float64"||H.type!=="float32"&&H.type!=="float64"||Z.type!=="float32"&&Z.type!=="float64")throw new Error("invalid input tensor types.")}},7839:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.xor=a.sub=a.pRelu=a.pow=a.or=a.mul=a.less=a.greater=a.equal=a.div=a.and=a.add=a.glslPRelu=a.glslPow=a.glslXor=a.glslOr=a.glslAnd=a.glslLess=a.glslGreater=a.glslEqual=a.glslSub=a.glslMul=a.glslDiv=a.glslAdd=void 0;const A=l(2517),O=l(8520),Y=l(5060),R=l(2039);function ee(){const st="add_";return{body:`
  float ${st}(float a, float b) {
    return a + b;
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return v1 + v2;
  }
  `,name:st,type:O.FunctionType.ValueBased}}function xe(){const st="div_";return{body:`
  float ${st}(float a, float b) {
    return a / b;
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return v1 / v2;
  }
  `,name:st,type:O.FunctionType.ValueBased}}function ne(){const st="mul_";return{body:`
  float ${st}(float a, float b) {
    return a * b;
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return v1 * v2;
  }
  `,name:st,type:O.FunctionType.ValueBased}}function te(){const st="sub_";return{body:`
  float ${st}(float a, float b) {
    return a - b;
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return v1 - v2;
  }
  `,name:st,type:O.FunctionType.ValueBased}}function f(){const st="equal_";return{body:`
  float ${st}(float a, float b) {
    return float(a == b);
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return vec4(equal(v1, v2));
  }
  `,name:st,type:O.FunctionType.ValueBased}}function d(){const st="greater_";return{body:`
  float ${st}(float a, float b) {
    return float(a > b);
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return vec4( v1.r > v2.r ,
      v1.g > v2.g,
      v1.b > v2.b,
      v1.a > v2.a );
  }
  `,name:st,type:O.FunctionType.ValueBased}}function H(){const st="less_";return{body:`
  float ${st}(float a, float b) {
    return float(a < b);
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return vec4( v1.r < v2.r ,
                v1.g < v2.g,
                v1.b < v2.b,
                v1.a < v2.a );
  }
  `,name:st,type:O.FunctionType.ValueBased}}function Z(){const st="and_";return{body:`
  float ${st}(float a, float b) {
    return float( bool(a) && bool(b) );
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r && b2.r ,
                b1.g && b2.g,
                b1.b && b2.b,
                b1.a && b2.a );
  }
  `,name:st,type:O.FunctionType.ValueBased}}function Ye(){return{body:`
  float or_(float a, float b) {
    return float( bool(a) || bool(b) );
  }
  vec4 or_(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r || b2.r ,
                b1.g || b2.g,
                b1.b || b2.b,
                b1.a || b2.a );
  }
  `,name:"or_",type:O.FunctionType.ValueBased}}function et(){const st="xor_";return{body:`
  float ${st}(float a, float b) {
    return float( bool(a) ^^ bool(b) );
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r ^^ b2.r ,
                b1.g ^^ b2.g,
                b1.b ^^ b2.b,
                b1.a ^^ b2.a );
  }
  `,name:st,type:O.FunctionType.ValueBased}}function tt(){return(function(st){const at=`${st}_`;return{body:`
  float ${at}(float a, float b) {
    return ${st}(a, b);
  }
  vec4 ${at}(vec4 v1, vec4 v2) {
    return ${st}(v1, v2);
  }
  `,name:at,type:O.FunctionType.ValueBased}})("pow")}function nt(){const st="prelu_";return{body:`
  float ${st}(float a, float b) {
    return a < 0.0 ? a * b: a;
  }
  vec4 ${st}(vec4 v1, vec4 v2) {
    return vec4(
      v1.r < 0.0 ? v1.r * v2.r: v1.r,
      v1.g < 0.0 ? v1.g * v2.g: v1.g,
      v1.b < 0.0 ? v1.b * v2.b: v1.b,
      v1.a < 0.0 ? v1.a * v2.a: v1.a
      );
  }
  `,name:st,type:O.FunctionType.ValueBased}}a.glslAdd=ee,a.glslDiv=xe,a.glslMul=ne,a.glslSub=te,a.glslEqual=f,a.glslGreater=d,a.glslLess=H,a.glslAnd=Z,a.glslOr=Ye,a.glslXor=et,a.glslPow=tt,a.glslPRelu=nt;const it=(st,at,ct,ft=at[0].type,ut)=>{const _t=st.session.pack?R.TextureType.packed:R.TextureType.unpacked;return{name:ct.name,inputNames:["A","B"],inputTypes:[_t,_t],cacheHint:ut,get:()=>ot(st,at,ct,ft)}},ot=(st,at,ct,ft=at[0].type)=>{const ut=st.session.pack?R.TextureType.packed:R.TextureType.unpacked,_t=!A.ShapeUtil.areEqual(at[0].dims,at[1].dims);let At=at[0].dims;const Et=st.session.pack;if(_t){const kt=A.BroadcastUtil.calcShape(at[0].dims,at[1].dims,!1);if(!kt)throw new Error("Can't perform binary op on the given tensors");At=kt;const yt=At.length,St=at[0].dims.length!==0?at[0].dims.length:1,Yt=at[1].dims.length!==0?at[1].dims.length:1,Ft=at[0].dims.length!==0?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",ln=at[1].dims.length!==0?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",dn=(0,Y.getGlsl)(st.session.backend.glContext.version),Pt=Et?`
      ${ct.body}
      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        vec4 result = ${ct.name}(a, b);
        ${dn.output} = result;
      }`:`
      ${ct.body}
      float process(int indices[${yt}]) {
        int aindices[${St}];
        int bindices[${Yt}];
        ${Ft}
        ${ln}
        return ${ct.name}(_A(aindices), _B(bindices));
      }`;return{name:ct.name,inputNames:["A","B"],inputTypes:[ut,ut],output:{dims:At,type:ft,textureType:ut},shaderSource:Pt,hasMain:Et}}const Mt=(0,Y.getGlsl)(st.session.backend.glContext.version),Ot=`
    ${ct.body}
    void main() {
      vec4 v1 = ${Mt.texture2D}(A, TexCoords);
      vec4 v2 = ${Mt.texture2D}(B, TexCoords);
      vec4 result = ${ct.name}(v1, v2);
      ${Mt.output} = result;
    }
    `;return{name:ct.name,inputNames:["A","B"],inputTypes:[ut,ut],output:{dims:at[0].dims,type:ft,textureType:ut},shaderSource:Ot,hasMain:!0}};a.add=(st,at)=>[st.run(it(st,at,ee()),at)],a.and=(st,at)=>[st.run(it(st,at,Z(),"bool"),at)],a.div=(st,at)=>[st.run(it(st,at,xe()),at)],a.equal=(st,at)=>[st.run(it(st,at,f(),"bool"),at)],a.greater=(st,at)=>[st.run(it(st,at,d(),"bool"),at)],a.less=(st,at)=>[st.run(it(st,at,H(),"bool"),at)],a.mul=(st,at)=>[st.run(it(st,at,ne()),at)],a.or=(st,at)=>[st.run(it(st,at,Ye(),"bool"),at)],a.pow=(st,at)=>[st.run(it(st,at,tt()),at)],a.pRelu=(st,at)=>[st.run(it(st,at,nt()),at)],a.sub=(st,at)=>[st.run(it(st,at,te()),at)],a.xor=(st,at)=>[st.run(it(st,at,et(),"bool"),at)]},4196:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseCastAttributes=a.cast=void 0;const A=l(2517);a.cast=(Y,R,ee)=>(O(R),[Y.cast(R[0],ee)]),a.parseCastAttributes=Y=>A.ProtoUtil.tensorDataTypeFromProto(Y.attributes.getInt("to"));const O=Y=>{if(!Y||Y.length!==1)throw new Error("Cast requires 1 input.");if(Y[0].type==="string")throw new Error("Invalid input type.")}},1163:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createPackedConcatProgramInfoLoader=void 0;const A=l(5060),O=l(2039),Y=l(9390),R=l(2827);a.createPackedConcatProgramInfoLoader=(xe,ne,te)=>{const f=(d=ne.length,H=te.cacheKey,{name:"Concat (packed)",inputNames:Array.from({length:d},((Z,Ye)=>`X${Ye}`)),inputTypes:Array(d).fill(O.TextureType.packed),cacheHint:H});var d,H;return Object.assign(Object.assign({},f),{get:()=>((Z,Ye,et,tt)=>{const nt=et[0].dims.slice();if(tt>=nt.length||tt<-1*nt.length)throw new Error("axis specified for concat doesn't match input dimensionality");tt<0&&(tt=nt.length+tt);const it=nt.slice(0);for(let Ft=1;Ft<et.length;Ft++){const ln=et[Ft].dims.slice();for(let dn=0;dn<nt.length;dn++)if(dn===tt)it[tt]+=ln[dn];else if(nt[dn]!==ln[dn])throw new Error("non concat dimensions must match")}const ot=it.length,st=(0,R.getChannels)("coords",ot),at=(0,Y.getCoordsDataType)(ot),ct=(0,R.unpackFromChannel)(),ft=et.map((Ft=>Ft.dims)),ut=(0,Y.getGlChannels)(ot),_t=new Array(ft.length-1);_t[0]=ft[0][tt];for(let Ft=1;Ft<_t.length;Ft++)_t[Ft]=_t[Ft-1]+ft[Ft][tt];const At=ut[tt],Et=ut.slice(-2),Mt=ut.join();let Ot=`if (${At} < ${_t[0]}) {
        return getChannel(
            getX0(${Mt}), vec2(${Et.join()}));
        }`;for(let Ft=1;Ft<_t.length;Ft++){const ln=_t[Ft-1];Ot+=`
            if (${At} < ${_t[Ft]}  && ${At} >= ${_t[Ft-1]}) {
              return getChannel(
                getX${Ft}(${ee(ut,At,ln)}),
                vec2(${ee(Et,At,ln)}));
            }`}const kt=_t.length,yt=_t[_t.length-1];Ot+=`
            return getChannel(
              getX${kt}(${ee(ut,At,yt)}),
              vec2(${ee(Et,At,yt)}));`;const St=(0,A.getGlsl)(Z.session.backend.glContext.version),Yt=`
          ${ct}
          float getValue(${ut.map((Ft=>"int "+Ft))}) {
            ${Ot}
          }

          void main() {
            ${at} coords = getOutputCoords();
            int lastDim = coords.${ut[ot-1]};
            coords.${ut[ot-1]} = coords.${ut[ot-2]};
            coords.${ut[ot-2]} = lastDim;

            vec4 result = vec4(getValue(${st}), 0., 0., 0.);

            ${st[ot-1]} = ${st[ot-1]} + 1;
            if (${st[ot-1]} < ${it[ot-1]}) {
              result.g = getValue(${st});
            }

            ${st[ot-2]} = ${st[ot-2]} + 1;
            if (${st[ot-2]} < ${it[ot-2]}) {
              result.a = getValue(${st});
            }

            ${st[ot-1]} = ${st[ot-1]} - 1;
            if (${st[ot-2]} < ${it[ot-2]} &&
                ${st[ot-1]} < ${it[ot-1]}) {
              result.b = getValue(${st});
            }
            ${St.output} = result;
          }
        `;return Object.assign(Object.assign({},Ye),{output:{dims:it,type:et[0].type,textureType:O.TextureType.packed},shaderSource:Yt,hasMain:!0})})(xe,f,ne,te.axis)})};const ee=(xe,ne,te)=>{const f=xe.indexOf(ne);return xe.map(((d,H)=>H===f?`${d} - ${te}`:d)).join()}},2069:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseConcatAttributes=a.concat=void 0;const A=l(246),O=l(2039),Y=l(1163);a.concat=(d,H,Z)=>(f(H),d.session.pack&&H[0].dims.length>1?[d.run((0,Y.createPackedConcatProgramInfoLoader)(d,H,Z),H)]:[d.run(R(d,H,Z),H)]);const R=(d,H,Z)=>{const Ye=(et=H.length,tt=Z.cacheKey,{name:"Concat",inputNames:Array.from({length:et},((nt,it)=>`X${it}`)),inputTypes:Array(et).fill(O.TextureType.unpacked),cacheHint:tt});var et,tt;return Object.assign(Object.assign({},Ye),{get:()=>((nt,it,ot,st)=>{const at=ot[0].dims.slice();if(st>=at.length||st<-1*at.length)throw new Error("axis specified for concat doesn't match input dimensionality");st<0&&(st=at.length+st);const ct=at.slice(0);for(let Mt=1;Mt<ot.length;Mt++){const Ot=ot[Mt].dims.slice();for(let kt=0;kt<at.length;kt++)if(kt===st)ct[st]+=Ot[kt];else if(at[kt]!==Ot[kt])throw new Error("non concat dimensions must match")}const ft=ct.length,ut=new Array(ot.length);let _t=0;for(let Mt=0;Mt<ut.length;++Mt)_t+=ot[Mt].dims[st],ut[Mt]=_t;let At="";At=ot.length<5?ee(ut):xe(ut);const Et=`
        ${ne(ot.length,ft)}
        ${te(ut)}
        ${At}
        float process(int indices[${ft}]) {
          int textureIndex = getTextureWhereDataResides (indices[${st}]);

          if(textureIndex != 0) {
            indices[${st}] = indices[${st}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));
          }

          return fetchDataFromCorrectTexture(textureIndex, indices);
        }`;return Object.assign(Object.assign({},it),{output:{dims:ct,type:ot[0].type,textureType:O.TextureType.unpacked},shaderSource:Et})})(0,Ye,H,Z.axis)})},ee=d=>`int getTextureWhereDataResides(int index) {
      ${d.map(((H,Z)=>`if(index<${H}) {return ${Z};}
`)).join("")}
    }`,xe=d=>ee(d),ne=(d,H)=>{const Z=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${H}]) {`];for(let Ye=0;Ye<d;++Ye)Ye===0?Z.push(`	if (textureIndex == ${Ye}) { return _X${Ye}(indices); }`):Ye===d-1?Z.push(`	else { return _X${Ye}(indices); }`):Z.push(`	else if (textureIndex == ${Ye}) { return _X${Ye}(indices); }`);return Z.push("	}"),Z.join(`
`)},te=d=>{const H=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let Z=0;Z<d.length;++Z)Z===0?H.push(`	if (index == ${Z}) { return ${d[Z]}; }`):Z===d.length-1?H.push(`	else { return ${d[Z]}; }`):H.push(`	else if (index == ${Z}) { return ${d[Z]}; }`);return H.push("	}"),H.join(`
`)};a.parseConcatAttributes=d=>(0,A.createAttributeWithCacheKey)({axis:d.attributes.getInt("axis")});const f=d=>{if(!d||d.length<1)throw new Error("too few inputs");const H=d[0].type,Z=d[0].dims.length;if(H==="string")throw new Error("string tensor is not supported yet");for(const Ye of d){if(Ye.type!==H)throw new Error("input tensors should be one type");if(Ye.dims.length!==Z)throw new Error("input tensors should have the same shape")}}},4770:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createUnpackedGroupedConvProgramInfoLoader=void 0;const A=l(6231),O=l(5060),Y=l(2039),R=l(8138),ee=l(2823);a.createUnpackedGroupedConvProgramInfoLoader=(xe,ne,te)=>{const f=(d=ne.length>2,H=te.cacheKey,{name:"GroupedConv",inputNames:d?["X","W","Bias"]:["X","W"],inputTypes:d?[Y.TextureType.unpacked,Y.TextureType.unpacked,Y.TextureType.unpacked]:[Y.TextureType.unpacked,Y.TextureType.unpacked],cacheHint:H});var d,H;return Object.assign(Object.assign({},f),{get:()=>((Z,Ye,et,tt)=>{const nt=Ye.length>2?"value += getBias(output_channel);":"",it=Ye[0].dims.slice(),ot=Ye[1].dims.slice(),st=ot[0]/tt.group;A.Logger.verbose("GroupedConv",`autpPad:${tt.autoPad}, dilations:${tt.dilations}, group:${tt.group}, kernelShape:${tt.kernelShape}, pads:${tt.pads}, strides:${tt.strides}`);const at=(0,R.calculateOutputShape)(it,ot,tt.dilations,tt.pads,tt.strides),ct=(0,O.getGlsl)(Z.session.backend.glContext.version),{activationFunction:ft,applyActivation:ut}=(0,ee.getActivationSnippet)(tt),_t=`
  const ivec2 strides = ivec2(${tt.strides[0]}, ${tt.strides[1]});
  const ivec2 pads = ivec2(${tt.pads[0]}, ${tt.pads[1]});
  ${ft}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;
    ivec2 xRCCorner = coords.zw * strides - pads;
    int group_id = output_channel / ${st};

    float value = 0.0;
    for (int wInChannel = 0; wInChannel < ${ot[1]}; wInChannel++) {
      int input_channel = group_id * ${ot[1]} + wInChannel;
      for (int wHeight = 0; wHeight < ${ot[2]}; wHeight++) {
        int xHeight = xRCCorner.x + wHeight * ${tt.dilations[0]};

        if (xHeight < 0 || xHeight >= ${it[2]}) {
          continue;
        }

        for (int wWidth = 0; wWidth < ${ot[3]}; wWidth++) {
          int xWidth = xRCCorner.y + wWidth * ${tt.dilations[1]};
          if (xWidth < 0 || xWidth >= ${it[3]}) {
            continue;
          }

          float xVal = getX(batch, input_channel, xWidth, xHeight);
          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);
          value += xVal*wVal;
        }
      }
    }
    ${nt}
    ${ut}
    ${ct.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},et),{output:{dims:at,type:Ye[0].type,textureType:Y.TextureType.unpacked},shaderSource:_t,hasMain:!0})})(xe,ne,f,te)})}},1386:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.conv2DPacked=a.conv2DPackedPointwise=void 0;const A=l(8138),O=l(8555),Y=l(708);a.conv2DPackedPointwise=(R,ee,xe)=>{const ne=ee[0].dims,te=ee[1].dims,f=(0,A.calculateOutputShape)(ne,te,xe.dilations,xe.pads,xe.strides),d=R.reshapePacked(ee[0],[ne[1],ne[2]*ne[3]]),H=R.reshapePacked(ee[1],[te[0],te[1]]),Z=ee.length>2?[H,d,ee[2]]:[H,d],Ye=R.run((0,Y.createPackedMatmulProgramInfoLoader)(R,Z,xe),Z);return R.reshapePacked(Ye,f)},a.conv2DPacked=(R,ee,xe)=>{const ne=ee[0].dims,te=ee[1].dims,f=(0,A.calculateOutputShape)(ne,te,xe.dilations,xe.pads,xe.strides),d=R.run((0,O.createPackedIm2ColProgramInfoLoader)(R,ee[0],ee[1],f,xe),[ee[0]]),H=R.reshapePacked(ee[1],[te[0],te[1]*te[2]*te[3]]),Z=ee.length===3?[H,d,ee[2]]:[H,d],Ye=R.run((0,Y.createPackedMatmulProgramInfoLoader)(R,Z,xe),Z);return R.reshapePacked(Ye,f)}},9663:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseConvTransposeAttributes=a.convTranspose=void 0;const A=l(246),O=l(5060),Y=l(2039),R=l(2823),ee=(H,Z,Ye,et,tt,nt)=>(H-1)*Z+Ye+(et-1)*tt+1-nt,xe=(H,Z,Ye,et,tt)=>{const nt=Math.floor(H/2);Z==="SAME_UPPER"?(Ye[et]=nt,Ye[tt]=H-nt):Z==="SAME_LOWER"&&(Ye[et]=H-nt,Ye[tt]=nt)};a.convTranspose=(H,Z,Ye)=>(d(Z,Ye),ne(H,Z,Ye));const ne=(H,Z,Ye)=>{const et=f(Ye,Z);return[te(H,Z,et)]},te=(H,Z,Ye)=>H.run(((et,tt,nt)=>{const it=(ot=tt.length>2,st=nt.cacheKey,{name:"ConvTranspose",inputNames:ot?["X","W","B"]:["X","W"],inputTypes:ot?[Y.TextureType.unpacked,Y.TextureType.unpacked,Y.TextureType.unpacked]:[Y.TextureType.unpacked,Y.TextureType.unpacked],cacheHint:st});var ot,st;return Object.assign(Object.assign({},it),{get:()=>((at,ct,ft,ut)=>{const _t=ct.length>2?"getB(output_channel)":"0.0",At=ct[0].dims,Et=ct[1].dims,Mt=Et[1],Ot=Et[0]/ut.group,kt=[ct[0].dims[0],ct[1].dims[1]*ut.group,...ut.outputShape],yt=(0,O.getGlsl)(at.session.backend.glContext.version),{activationFunction:St,applyActivation:Yt}=(0,R.getActivationSnippet)(ut),Ft=`
  const ivec2 strides = ivec2(${ut.strides[0]}, ${ut.strides[1]});
  const ivec2 pads = ivec2(${ut.pads[0]}, ${ut.pads[1]});
  ${St}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;

    ivec2 loc = coords.zw + pads;

    int group_id = output_channel / ${Mt};
    int wOutChannel = output_channel - group_id * ${Mt};

    float value = ${_t};
    for (int inChannelOffset = 0; inChannelOffset < ${Ot}; inChannelOffset++) {
      int input_channel = group_id * ${Ot} + inChannelOffset;
      for (int wWOff = 0; wWOff < ${Et[2]}; wWOff++) {
        for (int wHOff = 0; wHOff < ${Et[3]}; wHOff++) {
          ivec2 wOff = ivec2(wWOff * ${ut.dilations[0]}, wHOff * ${ut.dilations[1]});
          ivec2 wLoc = loc - wOff;
          ivec2 wLocIn = wLoc / strides;
          if (
            wLocIn * strides == wLoc &&
            wLocIn.x >= 0 && wLocIn.x < ${At[2]} &&
            wLocIn.y >= 0 && wLocIn.y < ${At[3]}
          ) {
            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);
            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);
            value += xVal * wVal;
          }
        }
      }
    }
    ${Yt}
    ${yt.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},ft),{output:{dims:kt,type:ct[0].type,textureType:Y.TextureType.unpacked},shaderSource:Ft,hasMain:!0})})(et,tt,it,nt)})})(H,Z,Ye),Z),f=(H,Z)=>{const Ye=H.kernelShape.slice();if(H.kernelShape.length===0)for(let it=2;it<Z[1].dims.length;++it)Ye.push(Z[1].dims[it]);const et=H.pads.slice(),tt=H.outputShape.slice();((it,ot,st,at,ct,ft,ut,_t)=>{const At=it.length-2,Et=_t.length===0;for(let Mt=0;Mt<At;++Mt){const Ot=Et?it[Mt+2]*ft[Mt]:_t[Mt],kt=ee(it[Mt+2],ft[Mt],ct[Mt],ot[Mt],st[Mt],Ot);xe(kt,at,ct,Mt,Mt+At),Et&&_t.push(ft[Mt]*(it[Mt+2]-1)+ut[Mt]+(ot[Mt]-1)*st[Mt]+1-ct[Mt]-ct[Mt+At])}})(Z[0].dims,Ye,H.dilations,H.autoPad,et,H.strides,H.outputPadding,tt);const nt=Object.assign({},H);return Object.assign(nt,{kernelShape:Ye,pads:et,outputShape:tt,cacheKey:H.cacheKey}),nt};a.parseConvTransposeAttributes=H=>{const Z=H.attributes,Ye=(0,R.parseInternalActivationAttributes)(Z),et=Z.getString("auto_pad","NOTSET"),tt=Z.getInts("dilations",[1,1]),nt=Z.getInt("group",1),it=Z.getInts("kernel_shape",[]),ot=Z.getInts("output_padding",[0,0]),st=Z.getInts("output_shape",[]),at=Z.getInts("pads",[0,0,0,0]),ct=Z.getInts("strides",[1,1]);return(0,A.createAttributeWithCacheKey)(Object.assign({autoPad:et,dilations:tt,group:nt,kernelShape:it,outputPadding:ot,outputShape:st,pads:at,strides:ct},Ye))};const d=(H,Z)=>{if(!H||H.length!==2&&H.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(H[0].dims.length!==4||H[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(H[0].dims[1]!==H[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");const Ye=H[1].dims[1]*Z.group;if(H.length===3&&(H[2].dims.length!==1||H[2].dims[0]!==Ye))throw new Error("invalid bias");const et=H[0].dims.length-2;if(Z.dilations.length!==et)throw new Error(`dilations should be ${et}D`);if(Z.strides.length!==et)throw new Error(`strides should be ${et}D`);if(Z.pads.length!==2*et)throw new Error(`pads should be ${2*et}D`);if(Z.outputPadding.length!==et)throw new Error(`output_padding should be ${et}D`);if(Z.kernelShape.length!==0&&Z.kernelShape.length!==H[1].dims.length-2)throw new Error("invalid kernel shape");if(Z.outputShape.length!==0&&Z.outputShape.length!==H[0].dims.length-2)throw new Error("invalid output shape");if(H[0].type!=="float32"||H[1].type!=="float32")throw new Error("ConvTranspose input(X,W) should be float tensor");if(H.length===3&&H[2].type!=="float32")throw new Error("ConvTranspose input(bias) should be float tensor")}},8138:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseConvAttributes=a.conv=a.calculateOutputShape=void 0;const A=l(246),O=l(2517),Y=l(4770),R=l(1386),ee=l(9828),xe=l(2823),ne=l(3248),te=l(5623);a.calculateOutputShape=(et,tt,nt,it,ot)=>{const st=et[0],at=et.slice(2),ct=at.length,ft=tt[0],ut=tt.slice(2).map(((At,Et)=>At+(At-1)*(nt[Et]-1))),_t=at.map(((At,Et)=>At+it[Et]+it[Et+ct])).map(((At,Et)=>Math.floor((At-ut[Et]+ot[Et])/ot[Et])));return[st,ft].concat(..._t)},a.conv=(et,tt,nt)=>(Ye(tt,nt),f(et,tt,nt));const f=(et,tt,nt)=>{const it=Z(nt,tt),ot=et.session.pack,st=it.kernelShape[0]===1&&it.kernelShape[1]===1;return it.group>1?[et.run((0,Y.createUnpackedGroupedConvProgramInfoLoader)(et,tt,it),tt)]:st&&ot?[d(et,tt,it)]:ot&&tt[0].dims.length===4&&tt[0].dims[0]===1&&!st?[(0,R.conv2DPacked)(et,tt,it)]:[H(et,tt,it)]},d=(et,tt,nt)=>{const it=tt[0].dims,ot=tt[1].dims,st=(0,a.calculateOutputShape)(it,ot,nt.dilations,nt.pads,nt.strides),at=et.reshapeUnpacked(tt[0],[it[1],it[2]*it[3]]),ct=et.reshapeUnpacked(tt[1],[ot[0],ot[1]]),ft=tt.length>2?[ct,at,tt[2]]:[ct,at],ut=et.run((0,te.createMatmulProgramInfoLoader)(ft,nt),ft);return et.reshapeUnpacked(ut,st)},H=(et,tt,nt)=>{const it=tt[0].dims,ot=tt[1].dims,st=(0,a.calculateOutputShape)(it,ot,nt.dilations,nt.pads,nt.strides),at=et.run((0,ne.createIm2ColProgramInfoLoader)(et,tt[0],tt[1],st,nt),[tt[0]]),ct=tt.length===3?[at,tt[1],tt[2]]:[at,tt[1]];return et.run((0,ee.createDotProductProgramInfoLoader)(et,tt,st,nt),ct)},Z=(et,tt)=>{const nt=et.kernelShape.slice();if(et.kernelShape.length===0)for(let st=2;st<tt[1].dims.length;++st)nt.push(tt[1].dims[st]);const it=et.pads.slice();O.PoolConvUtil.adjustPadsBasedOnAutoPad(tt[0].dims,et.strides,et.dilations,nt,it,et.autoPad);const ot=Object.assign({},et);return Object.assign(ot,{kernelShape:nt,pads:it,cacheKey:et.cacheKey}),ot};a.parseConvAttributes=et=>{const tt=et.attributes,nt=(0,xe.parseInternalActivationAttributes)(tt),it=tt.getString("auto_pad","NOTSET"),ot=tt.getInts("dilations",[1,1]),st=tt.getInt("group",1),at=tt.getInts("kernel_shape",[]),ct=tt.getInts("pads",[0,0,0,0]),ft=tt.getInts("strides",[1,1]);return(0,A.createAttributeWithCacheKey)(Object.assign({autoPad:it,dilations:ot,group:st,kernelShape:at,pads:ct,strides:ft},nt))};const Ye=(et,tt)=>{if(!et||et.length!==2&&et.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(et[0].dims.length!==4||et[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(et[0].dims[1]!==et[1].dims[1]*tt.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(et.length===3&&(et[2].dims.length!==1||et[1].dims[0]!==et[2].dims[0]))throw new Error("invalid bias");const nt=et[0].dims.length-2;if(tt.dilations.length!==nt)throw new Error(`dilations should be ${nt}D`);if(tt.strides.length!==nt)throw new Error(`strides should be ${nt}D`);if(tt.pads.length!==2*nt)throw new Error(`pads should be ${2*nt}D`);if(tt.kernelShape.length!==0&&tt.kernelShape.length!==et[1].dims.length-2)throw new Error("invalid kernel shape");if(et[0].type!=="float32"||et[1].type!=="float32")throw new Error("Conv input(X,W) should be float tensor");if(et.length===3&&et[2].type!=="float32")throw new Error("Conv input(bias) should be float tensor")}},5193:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseDepthToSpaceAttributes=a.depthToSpace=void 0;const A=l(3738);a.depthToSpace=(Y,R,ee)=>{O(R);const xe=ee.blocksize,ne=xe*xe,te=ee.mode==="DCR"?[0,3,4,1,5,2]:[0,1,4,2,5,3],f=ee.mode==="DCR"?[R[0].dims[0],xe,xe,R[0].dims[1]/ne,R[0].dims[2],R[0].dims[3]]:[R[0].dims[0],R[0].dims[1]/ne,xe,xe,R[0].dims[2],R[0].dims[3]],d=Y.reshapeUnpacked(R[0],f),H={perm:te,cacheKey:`${te}`},[Z]=(0,A.transpose)(Y,[d],H),Ye=[R[0].dims[0],R[0].dims[1]/ne,R[0].dims[2]*xe,R[0].dims[3]*xe];return[Y.reshapeUnpacked(Z,Ye)]},a.parseDepthToSpaceAttributes=Y=>{const R=Y.attributes.getInt("blocksize");if(R<1)throw new Error(`blocksize must be >= 1, but got : ${R} for DepthToSpace`);const ee=Y.attributes.getString("mode","DCR");if(ee!=="DCR"&&ee!=="CRD")throw new Error(`unrecognized mode: ${ee} for DepthToSpace`);return{mode:ee,blocksize:R}};const O=Y=>{if(Y.length!==1)throw new Error(`DepthToSpace expect 1 inputs, but got ${Y.length}`);if(Y[0].type==="string"||Y[0].dims.length!==4)throw new TypeError("DepthToSpace input should be a 4-D numeric tensor")}},9828:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createDotProductProgramInfoLoader=void 0;const A=l(2517),O=l(5060),Y=l(2039),R=l(2823),ee=l(3248);a.createDotProductProgramInfoLoader=(xe,ne,te,f)=>{const d=((H,Z)=>({name:"ConvDotProduct",inputNames:H?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:H?[Y.TextureType.unpacked,Y.TextureType.packedLastDimension,Y.TextureType.unpacked]:[Y.TextureType.unpacked,Y.TextureType.packedLastDimension],cacheKey:Z.activationCacheKey}))(ne.length>2,f);return Object.assign(Object.assign({},d),{get:()=>((H,Z,Ye,et,tt)=>{const nt=Ye[0].dims,it=Ye[1].dims,ot=[it[0],Math.ceil(nt[1]*it[2]*it[3]/4)],st=(0,ee.calculateIm2ColDims)(nt,it,et),[at,ct]=H.calculateTextureWidthAndHeight(ot,Y.TextureType.packedLastDimension),ft=A.ShapeUtil.computeStrides(st),[ut,_t]=H.calculateTextureWidthAndHeight(st,Y.TextureType.packedLastDimension),At=et.length,Et=Ye.length<3?"0.0":"_B(b)",Mt=Math.ceil(nt[1]*it[2]*it[3]/4),{activationFunction:Ot,applyActivation:kt}=(0,R.getActivationSnippet)(tt),yt=(0,O.getGlsl)(H.session.backend.glContext.version),St=`
${Ot}
float process(int indices[${At}]) {
  int b[1];
  b[0] = indices[1];
  int im2col[4];
  im2col[0] = indices[0];
  im2col[1] = indices[2];
  im2col[2] = indices[3];
  int im2colOffset = im2col[0] * ${ft[0]} + im2col[1] * ${ft[1]} + im2col[2] * ${ft[2]};
  int kernelOffset = indices[1] * ${ot[1]};
  float value = ${Et};
  for (int i = 0; i < ${Mt}; ++i) {
    vec2 im2colCoords = offsetToCoords(im2colOffset, ${ut}, ${_t});
    vec2 kernelCoords = offsetToCoords(kernelOffset, ${at}, ${ct});
    value += dot(${yt.texture2D}(Im2Col, im2colCoords), ${yt.texture2D}(K, kernelCoords));
    ++im2colOffset;
    ++kernelOffset;
  }
  ${kt}
  return value;
}`;return Object.assign(Object.assign({},Z),{output:{dims:et,type:Ye[0].type,textureType:Y.TextureType.unpacked},shaderSource:St})})(xe,d,ne,te,f)})}},7992:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseFlattenAttributes=a.flatten=void 0;const A=l(2517);a.flatten=(Y,R,ee)=>{O(R,ee);const xe=A.ShapeUtil.flattenShape(R[0].dims,ee);return[Y.reshapeUnpacked(R[0],xe)]},a.parseFlattenAttributes=Y=>Y.attributes.getInt("axis",1);const O=(Y,R)=>{if(!Y||Y.length!==1)throw new Error("Flatten requires 1 input.");const ee=Y[0].dims.length;if(ee===0)throw new Error("scalar tensor is not supported.");if(R<-ee||R>ee)throw new Error("Invalid axis");if(Y[0].type==="string")throw new Error("string tensor is not supported.")}},2823:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseInternalActivationAttributes=a.getActivationSnippet=void 0;const A=l(2517),O=l(4909);a.getActivationSnippet=function(Y){let R;switch(Y.activation){case"Relu":R=(0,O.glslRelu)();break;case"Sigmoid":R=(0,O.glslSigmoid)();break;case"Clip":R=(0,O.glslClip)(Y.clipMin,Y.clipMax);break;default:return{activationFunction:"",applyActivation:""}}const ee=R.name;return{activationFunction:R.body,applyActivation:`value = ${ee}_(value);`}},a.parseInternalActivationAttributes=Y=>{const R=Y.getString("activation","");if(R==="Clip"){const[ee,xe]=Y.getFloats("activation_params",[A.MIN_CLIP,A.MAX_CLIP]);return{activation:R,clipMax:xe,clipMin:ee,activationCacheKey:`${R}:${ee},${xe}`}}return{activation:R,activationCacheKey:R}}},1253:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseGatherAttributes=a.gather=void 0;const A=l(246),O=l(782),Y=l(2517),R=l(2039);a.gather=(te,f,d)=>(ne(f,d.axis),[te.run(xe(te,f,d),f)]),a.parseGatherAttributes=te=>(0,A.createAttributeWithCacheKey)({axis:te.attributes.getInt("axis",0)});const ee={name:"Gather",inputNames:["A","B"],inputTypes:[R.TextureType.unpacked,R.TextureType.unpacked]},xe=(te,f,d)=>{const H=Object.assign(Object.assign({},ee),{cacheHint:d.cacheKey});return Object.assign(Object.assign({},H),{get:()=>((Z,Ye,et,tt)=>{const nt=et[0].dims.slice(),it=et[1].dims.slice(),ot=new Array(nt.length+it.length-1);tt=Y.ShapeUtil.normalizeAxis(tt,nt.length);const st=[];for(let ct=0;ct<ot.length;ct++)ct<tt?(ot[ct]=nt[ct],st.push(`inputIdx[${ct}] = outputIdx[${ct}];`)):ct<tt+it.length?(ot[ct]=it[ct-tt],st.push(`indexDataIdx[${ct-tt}] = outputIdx[${ct}];`)):(ot[ct]=nt[ct-it.length+1],st.push(`inputIdx[${ct-it.length+1}] = outputIdx[${ct}];`));const at=`
      float process(int outputIdx[${ot.length||1}]) {
        int inputIdx[${nt.length}];
        int indexDataIdx[${it.length||1}];
        indexDataIdx[0] = 0;
        ${st.join(`
        `)}
        int idx = int(_B(indexDataIdx));
        inputIdx[${tt}] = idx < 0 ? idx + ${nt[tt]} : idx;
        return _A(inputIdx);
      }`;return Object.assign(Object.assign({},Ye),{output:{dims:ot,type:et[0].type,textureType:R.TextureType.unpacked},shaderSource:at})})(0,H,f,d.axis)})},ne=(te,f)=>{if(!te||te.length!==2)throw new Error("Gather requires 2 inputs.");const d=te[0].dims.length;if(d<1)throw new Error("Invalid input shape.");if(f<-d||f>d-1)throw new Error("Invalid axis.");if(O.NUMBER_TYPES.indexOf(te[0].type)===-1)throw new Error("Invaid input type.");if(te[1].type!=="int32"&&te[1].type!=="int16")throw new Error("Invaid input type.")}},4776:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseGemmAttributesV11=a.parseGemmAttributesV7=a.gemm=void 0;const A=l(246),O=l(2517),Y=l(2039);a.gemm=(te,f,d)=>(ne(f,d),[te.run(ee(f,d),f)]);const R=(te,f)=>{const d=te.attributes.getInt("transA",0)!==0,H=te.attributes.getInt("transB",0)!==0,Z=te.attributes.getFloat("alpha",1),Ye=te.attributes.getFloat("beta",1);return(0,A.createAttributeWithCacheKey)({transA:d,transB:H,alpha:Z,beta:Ye,isOptionalC:f})};a.parseGemmAttributesV7=te=>R(te,!1),a.parseGemmAttributesV11=te=>R(te,!0);const ee=(te,f)=>{const d={name:"Gemm",inputNames:te.length===3?["A","B","C"]:["A","B"],inputTypes:te.length===3?[Y.TextureType.unpacked,Y.TextureType.unpacked,Y.TextureType.unpacked]:[Y.TextureType.unpacked,Y.TextureType.unpacked],key:f.cacheKey};return Object.assign(Object.assign({},d),{get:()=>xe(d,te,f)})},xe=(te,f,d)=>{const H=f[0].dims.slice(),Z=f[1].dims.slice(),[Ye,et]=O.GemmUtil.getShapeOfGemmResult(H,d.transA,Z,d.transB,f.length===3?f[2].dims:void 0),tt=[Ye,et];if(!tt)throw new Error("Can't use gemm on the given tensors");let nt=H[H.length-1],it="";d.transA&&(nt=H[0]),d.transA&&d.transB?it="value += _A_T(a) * _B_T(b);":d.transA&&!d.transB?it="value += _A_T(a) * _B(b);":!d.transA&&d.transB?it="value += _A(a) * _B_T(b);":d.transA||d.transB||(it="value += _A(a) * _B(b);");const ot=tt.length,st=`
      float process(int indices[${ot}]) {
          int a[${ot}];
          int b[${ot}];
          ${f.length===3?`int c[${f[2].dims.length}];`:""}

          copyVec(indices, a);
          copyVec(indices, b);
          ${f.length===3?"bcastIndices_C(indices, c);":""}

          float value = 0.0;
          for (int k=0; k<${nt}; ++k) {
              a[${ot-1}] = k;
              b[${ot-2}] = k;
              ${it}
          }

          value = value * alpha;
          ${f.length===3?"value += beta * _C(c);":""}
          return value;
      }`;return Object.assign(Object.assign({},te),{output:{dims:tt,type:f[0].type,textureType:Y.TextureType.unpacked},variables:[{name:"alpha",type:"float",data:d.alpha},{name:"beta",type:"float",data:d.beta}],shaderSource:st})},ne=(te,f)=>{if(!te)throw new Error("Input is missing");if(f.isOptionalC&&(te.length<2||te.length>3))throw new Error("Invaid input shape.");if(!f.isOptionalC&&te.length!==3)throw new Error("Gemm requires 3 inputs");if(te.length===3&&te[2].dims.length!==1&&te[2].dims.length!==2)throw new Error("Invalid input shape of C");if(te[0].type!=="float32"&&te[0].type!=="float64"||te[1].type!=="float32"&&te[1].type!=="float64"||te.length===3&&te[2].type!=="float32"&&te[2].type!=="float64")throw new Error("Invalid input type.");if(te[0].type!==te[1].type||te.length===3&&te[0].type!==te[2].type)throw new Error("Input types are mismatched")}},8555:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createPackedIm2ColProgramInfoLoader=void 0;const A=l(5060),O=l(2039),Y=l(2827);a.createPackedIm2ColProgramInfoLoader=(R,ee,xe,ne,te)=>{const f=(d=te.cacheKey,{name:"Im2Col (packed)",inputNames:["A"],inputTypes:[O.TextureType.packed],cacheHint:d});var d;return Object.assign(Object.assign({},f),{get:()=>((H,Z,Ye,et,tt,nt)=>{const it=Ye.dims,ot=et.dims,st=tt.length,at=[ot[1]*ot[2]*ot[3],tt[2]*tt[3]],ct=ot[2]*ot[3],ft=(0,Y.unpackFromChannel)(),ut=(0,A.getGlsl)(H.session.backend.glContext.version);let _t="";for(let Et=0;Et<=1;Et++)for(let Mt=0;Mt<=1;Mt++)_t+=`
            blockIndex = rc.x + ${Mt};
            pos = rc.y + ${Et};

            if(blockIndex < ${at[1]} && pos < ${at[0]}) {
              offsetY = int(blockIndex / (${tt[st-1]})) * ${nt.strides[0]} -
                ${nt.pads[0]};
              d0 = offsetY + ${nt.dilations[0]} * (imod(pos, ${ct}) / ${ot[2]});

              if(d0 < ${it[2]} && d0 >= 0) {
                offsetX = imod(blockIndex, ${tt[st-1]}) * ${nt.strides[1]} -
                  ${nt.pads[1]};
                d1 = offsetX + ${nt.dilations[1]} * imod(imod(pos, ${ct}), ${ot[2]});

                if(d1 < ${it[3]} && d1 >= 0) {

                  ch = int(float(pos)/ ${ct}.);
                    innerDims = vec2(d0, d1);
                    result[${2*Et+Mt}] = getChannel(
                      getA(0, ch, int(innerDims.x),
                      int(innerDims.y)), innerDims);
                }
              }
            }

          `;const At=`
      ${ft}

      void main() {
        ivec2 rc = getOutputCoords();
          vec4 result = vec4(0.0);
          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
          vec2 innerDims;
          ${_t}
          ${ut.output} = result;
      }
            `;return Object.assign(Object.assign({},Z),{output:{dims:at,type:Ye.type,textureType:O.TextureType.packed},shaderSource:At,hasMain:!0})})(R,f,ee,xe,ne,te)})}},3248:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.calculateIm2ColDims=a.createIm2ColProgramInfoLoader=void 0;const A=l(2039);a.createIm2ColProgramInfoLoader=(O,Y,R,ee,xe)=>{const ne=(te=xe.cacheKey,{name:"Im2Col",inputNames:["X"],inputTypes:[A.TextureType.unpacked],cacheHint:te});var te;return Object.assign(Object.assign({},ne),{get:()=>((f,d,H,Z,Ye,et)=>{const tt=H.dims,nt=Z.dims,it=Ye.length,ot=(0,a.calculateIm2ColDims)(tt,nt,Ye,4),st=`
        const int XC = ${tt[1]};
        const int XH = ${tt[2]};
        const int XW = ${tt[3]};
        const int KH = ${et.kernelShape[0]};
        const int KW = ${et.kernelShape[1]};
        const int dilationH = ${et.dilations[0]};
        const int dilationW = ${et.dilations[1]};
        const int strideH = ${et.strides[0]};
        const int strideW = ${et.strides[1]};
        const int padH = ${et.pads[0]};
        const int padW = ${et.pads[1]};
        const int KHKW = KH*KW;
        const int XCKHKW = XC * KHKW;
        const int outputChannels = 4;
        vec4 process(int indices[${it}]) {
          int b  = indices[0]; // batch size
          int oh = indices[1] * strideH - padH; //output height
          int ow = indices[2] * strideW - padW; //output width
          int p = indices[3] * outputChannels; //patch
          vec4 value = vec4(0.0);
          for(int i=0; i < outputChannels; ++i) {
            if(p < XCKHKW) {
              int patchC = p / KHKW;
              int patchH = (p - patchC*KHKW) / KW;
              int patchW = (p - patchC*KHKW) - patchH * KW;
              int xh2 = oh + patchH * dilationH;
              int xw2 = ow + patchW * dilationW;
              int x[${tt.length}];
              x[0] = b;
              x[1] = patchC;
              x[2] = xh2;
              x[3] = xw2;
              if(xh2 >= 0 &&
                  xh2 < XH &&
                  xw2 >= 0 &&
                  xw2 < XW) {
                value[i] = _X(x);
              }
            }
            ++p;
          }
          return value;
        }
        `;return Object.assign(Object.assign({},d),{output:{dims:ot,type:H.type,textureType:A.TextureType.packedLastDimension},shaderSource:st})})(0,ne,Y,R,ee,xe)})},a.calculateIm2ColDims=(O,Y,R,ee=4)=>[R[0],R[2],R[3],Math.ceil(O[1]*Y[2]*Y[3]/ee)]},6572:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseImageScalerAttributes=a.imageScaler=void 0;const A=l(246),O=l(2039);a.imageScaler=(ne,te,f)=>(xe(te),[ne.run(R(ne,te,f),te)]),a.parseImageScalerAttributes=ne=>{const te=ne.attributes.getFloat("scale"),f=ne.attributes.getFloats("bias");return(0,A.createAttributeWithCacheKey)({scale:te,bias:f})};const Y={name:"ImageScaler",inputNames:["X"],inputTypes:[O.TextureType.unpacked]},R=(ne,te,f)=>{const d=Object.assign(Object.assign({},Y),{cacheHint:f.cacheKey});return Object.assign(Object.assign({},d),{get:()=>((H,Z,Ye,et)=>{const tt=Ye[0].dims.slice(),nt=tt.length,it=`
      ${ee(et.bias.length)}
      float process(int indices[${nt}]) {
        return _X(indices) * scale + getBias(bias, indices[1]);
      }`;return Object.assign(Object.assign({},Z),{output:{dims:tt,type:Ye[0].type,textureType:O.TextureType.unpacked},variables:[{name:"bias",type:"float",arrayLength:et.bias.length,data:et.bias},{name:"scale",type:"float",data:et.scale}],shaderSource:it})})(0,d,te,f)})},ee=ne=>{const te=[`float getBias(float bias[${ne}], int channel) {`];for(let f=0;f<ne;++f)f===0?te.push(`	if (channel == ${f}) { return bias[${f}]; }`):f===ne-1?te.push(`	else { return bias[${f}]; }`):te.push(`	else if (channel == ${f}) { return bias[${f}]; }`);return te.push("	}"),te.join(`
`)},xe=ne=>{if(!ne||ne.length!==1)throw new Error("ImageScaler requires 1 input.");if(ne[0].dims.length!==4)throw new Error("Invalid input shape.");if(ne[0].type!=="float32"&&ne[0].type!=="float64")throw new Error("Invalid input type.")}},3346:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseInstanceNormalizationAttributes=a.instanceNormalization=void 0;const A=l(5060),O=l(2039);a.instanceNormalization=(te,f,d)=>{ne(f);const H=te.run(R(f[0]),f);return[te.run(xe(te,f[0],d,H.dims),[f[0],H,f[1],f[2]])]},a.parseInstanceNormalizationAttributes=te=>te.attributes.getFloat("epsilon",1e-5);const Y={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[O.TextureType.unpacked]},R=te=>Object.assign(Object.assign({},Y),{get:()=>((f,d)=>{const H=d.dims.slice(),Z=H[1],Ye=H[2]*H[3],et=[H[0],Z],tt=`
      vec4 process(int[2] indices) {
        vec4 v = vec4(0.0);
        int a[4];
        a[0] = indices[0];
        a[1] = indices[1];
        float temp = 0.0;
        for(int a2=0; a2<${H[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${H[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += x;
          }
        }
        float mean = temp / float(${Ye});
        temp = 0.0;
        for(int a2=0; a2<${H[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${H[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += (x - mean) * (x - mean);
          }
        }
        v.r = mean;
        v.g = temp / float(${Ye});

        return v;
      }`;return Object.assign(Object.assign({},f),{output:{dims:et,type:d.type,textureType:O.TextureType.packedLastDimension},shaderSource:tt})})(Y,te)}),ee={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[O.TextureType.unpacked,O.TextureType.packedLastDimension,O.TextureType.unpacked,O.TextureType.unpacked]},xe=(te,f,d,H)=>{const Z=Object.assign(Object.assign({},ee),{cacheHint:`${d}`});return Object.assign(Object.assign({},Z),{get:()=>((Ye,et,tt,nt,it)=>{const ot=(0,A.getGlsl)(Ye.session.backend.glContext.version),[st,at]=Ye.calculateTextureWidthAndHeight(it,O.TextureType.packedLastDimension),[ct,ft]=[st/4,at],ut=`
      vec4 get_MeanAndVariance(int[2] mv) {
        int offset = indicesToOffset_MeanAndVariance(mv);
        vec2 coords = offsetToCoords(offset, ${ct}, ${ft});
        return ${ot.texture2D}(MeanAndVariance, coords);
      }

      float process(int[4] indices) {
        int mv[2];
        mv[0] = indices[0];
        mv[1] = indices[1];
        vec4 mean_and_variance = get_MeanAndVariance(mv);
        float mean = mean_and_variance.r;
        float variance = mean_and_variance.g;

        int sb[1];
        sb[0] = indices[1];
        float scale = _Scale(sb);
        float b = _B(sb);

        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;
      }`;return Object.assign(Object.assign({},et),{output:{dims:tt.dims,type:tt.type,textureType:O.TextureType.unpacked},variables:[{name:"epsilon",type:"float",data:nt}],shaderSource:ut})})(te,Z,f,d,H)})},ne=te=>{if(!te||te.length!==3)throw new Error("InstanceNormalization requires 3 inputs.");const f=te[0],d=te[1],H=te[2];if(f.dims.length<3||d.dims.length!==1||H.dims.length!==1)throw new Error("Invalid input shape.");if(d.dims[0]!==f.dims[1]||H.dims[0]!==f.dims[1])throw new Error("Input shapes are mismatched.");if(f.type!=="float32"&&f.type!=="float64"||d.type!=="float32"&&d.type!=="float64"||H.type!=="float32"&&H.type!=="float64")throw new Error("Invalid input type.");if(te[0].dims.length!==4)throw new Error("Only support 4-D input shape.")}},708:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createPackedMatmulProgramInfoLoader=void 0;const A=l(2517),O=l(5060),Y=l(2039),R=l(9390),ee=l(2823),xe=l(5623);a.createPackedMatmulProgramInfoLoader=(ne,te,f)=>{const d=(H=te.length>2,Z=f.activationCacheKey,{name:"MatMul (packed)",inputNames:H?["A","B","Bias"]:["A","B"],inputTypes:H?[Y.TextureType.packed,Y.TextureType.packed,Y.TextureType.packed]:[Y.TextureType.packed,Y.TextureType.packed],cacheHint:Z});var H,Z;return Object.assign(Object.assign({},d),{get:()=>((Ye,et,tt,nt)=>{const it=tt.length>2,ot=it?"value += getBiasForMatmul();":"",st=tt[0].dims,at=tt[1].dims,ct=A.BroadcastUtil.calcShape(st,at,!0),ft=!A.ShapeUtil.areEqual(tt[0].dims,tt[1].dims);if(!ct)throw new Error("Can't use matmul on the given tensors");const ut=st[st.length-1],_t=Math.ceil(ut/2),At=st.length,Et=at.length,Mt=(0,O.getGlsl)(Ye.session.backend.glContext.version),Ot=(0,R.getCoordsDataType)(ct.length),kt=ct.length,yt=(0,R.getGlChannels)(),{activationFunction:St,applyActivation:Yt}=(0,ee.getActivationSnippet)(nt),Ft=it?`${(0,xe.getBiasForMatmul)(Ot,yt,tt[2].dims,ct,!0)}`:"",ln=ft?`${(function(hn,_n,On,En){let qt=[],Jt=[];const Wt=On[0].dims,un=On[1].dims,fn=Wt.length,pn=un.length,Zt=En.length,mn=Zt-fn,Tn=Zt-pn;qt=Wt.map(((Dt,Qt)=>`coords.${_n[Qt+mn]}`)),qt[fn-1]="i*2",qt.join(", "),Jt=un.map(((Dt,Qt)=>`coords.${_n[Qt+Tn]}`)),Jt[pn-2]="i*2",Jt.join(", ");const $n=A.BroadcastUtil.getBroadcastDims(Wt,En),Un=A.BroadcastUtil.getBroadcastDims(un,En),In=$n.map((Dt=>`coords.${_n[Dt+mn]} = 0;`)).join(`
`),kn=Un.map((Dt=>`coords.${_n[Dt+Tn]} = 0;`)).join(`
`),Kt=`int lastDim = coords.${_n[Zt-1]};
  coords.${_n[Zt-1]} = coords.${_n[Zt-2]};
  coords.${_n[Zt-2]} = lastDim;`;return`
vec4 getAAtOutCoordsMatmul(int i) {
  ${hn} coords = getOutputCoords();
  ${Kt}
  ${In}
  vec4 outputValue = getA(${qt});
  return outputValue;
}

vec4 getBAtOutCoordsMatmul(int i) {
  ${hn} coords = getOutputCoords();
  ${Kt}
  ${kn}
  vec4 outputValue = getB(${Jt});
  return outputValue;
}`})(Ot,yt,tt,ct)}`:"",dn=ft?"getAAtOutCoordsMatmul(i)":`getA(${(function(hn,_n){let On="";for(let En=0;En<_n-2;En++)On+=`rc.${hn[En]}, `;return On+=`rc.${hn[_n-2]}, i*2`,On})(yt,At)})`,Pt=ft?"getBAtOutCoordsMatmul(i)":`getB(${(function(hn,_n){let On="";for(let En=0;En<_n-2;En++)On+=`rc.${hn[En]}, `;return On+=`i*2, rc.${hn[_n-1]}`,On})(yt,Et)})`,$t=`
            ${ln}
            ${Ft}
            ${St}
            void main() {
              ${ft?"":`${Ot} rc =
          getOutputCoords(); int lastDim = rc.${yt[kt-1]}; rc.${yt[kt-1]} =
          rc.${yt[kt-2]}; rc.${yt[kt-2]} = lastDim;
      `}

              vec4 value = vec4(0);
              for (int i = 0; i < ${_t}; i++) {
                vec4 a = ${dn};
                vec4 b = ${Pt};

                value += (a.rrbb * b.rgrg);
                value += (a.ggaa * b.baba);
              }
              ${ot}
              ${Yt}
              ${Mt.output} = value;
            }`;return Object.assign(Object.assign({},et),{output:{dims:ct,type:tt[0].type,textureType:Y.TextureType.packed},shaderSource:$t,hasMain:!0})})(ne,d,te,f)})}},5623:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.getBiasForMatmul=a.createMatmulProgramInfoLoader=a.parseMatMulAttributes=a.matMul=void 0;const A=l(2517),O=l(2039),Y=l(9390),R=l(2823),ee=l(708);function xe(f,d){const H=(Z=f.length>2,Ye=d.activationCacheKey,{name:"MatMul",inputNames:Z?["A","B","Bias"]:["A","B"],inputTypes:Z?[O.TextureType.unpacked,O.TextureType.unpacked,O.TextureType.unpacked]:[O.TextureType.unpacked,O.TextureType.unpacked],cacheHint:Ye});var Z,Ye;return Object.assign(Object.assign({},H),{get:()=>(function(et,tt,nt){const it=tt[0].dims,ot=tt[1].dims,st=A.BroadcastUtil.calcShape(it,ot,!0);if(!st)throw new Error("Can't use matmul on the given tensors");const at=(0,Y.getCoordsDataType)(st.length),ct=(0,Y.getGlChannels)(),{activationFunction:ft,applyActivation:ut}=(0,R.getActivationSnippet)(nt),_t=tt.length>2,At=_t?"value += getBiasForMatmul();":"",Et=_t?`${te(at,ct,tt[2].dims,st,!1)}`:"",Mt=st.length,Ot=it.length,kt=ot.length,yt=`
    ${ft}
    ${Et}
    float process(int indices[${Mt}]) {
        int a[${Ot}];
        int b[${kt}];
        bcastMatmulIndices_A(indices, a);
        bcastMatmulIndices_B(indices, b);

        float value;
        for (int k=0; k<${it[it.length-1]}; ++k) {
            a[${Ot-1}] = k;
            b[${kt-2}] = k;
            value += _A(a) * _B(b);
        }
        ${At}
        ${ut}
        return value;
    }`;return Object.assign(Object.assign({},et),{output:{dims:st,type:tt[0].type,textureType:O.TextureType.unpacked},shaderSource:yt})})(H,f,d)})}a.matMul=(f,d,H)=>(ne(d),f.session.pack?[f.run((0,ee.createPackedMatmulProgramInfoLoader)(f,d,H),d)]:[f.run(xe(d,H),d)]),a.parseMatMulAttributes=f=>(0,R.parseInternalActivationAttributes)(f.attributes),a.createMatmulProgramInfoLoader=xe;const ne=f=>{if(!f||f.length!==2)throw new Error("MatMul requires 2 inputs.");if(f[0].dims[f[0].dims.length-1]!==f[1].dims[f[1].dims.length-2])throw new Error("shared dimension does not match.");if(f[0].type!=="float32"&&f[0].type!=="float64"||f[1].type!=="float32"&&f[1].type!=="float64")throw new Error("inputs should be float type");if(f[0].type!==f[1].type)throw new Error("inputs types should match")};function te(f,d,H,Z,Ye){let et="";const tt=H.length,nt=Z.length,it=nt-tt;et=nt<2&&tt>0?"coords":H.map(((at,ct)=>`coords.${d[ct+it]}`)).join(", ");const ot=A.BroadcastUtil.getBroadcastDims(H,Z).map((at=>`coords.${d[at+it]} = 0;`)).join(`
`);let st="vec4(outputValue.xx, outputValue.yy)";return A.ShapeUtil.size(H)===1&&(st="vec4(outputValue.x)"),Ye?`
vec4 getBiasForMatmul() {
  ${f} coords = getOutputCoords();
  ${ot}
  vec4 outputValue = getBias(${et});
  return ${st};
}`:`
float getBiasForMatmul() {
  ${f} coords = getOutputCoords();
  ${ot}
  return getBias(coords.x);
}`}a.getBiasForMatmul=te},2403:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createPackProgramInfoLoader=void 0;const A=l(5060),O=l(2039),Y=l(9390),R=l(2827),ee={name:"pack",inputNames:["A"],inputTypes:[O.TextureType.unpackedReversed]};a.createPackProgramInfoLoader=(xe,ne)=>Object.assign(Object.assign({},ee),{get:()=>((te,f)=>{const d=(0,A.getGlsl)(te.session.backend.glContext.version),H=f.dims,Z=H.length,Ye=f.dims.length,et=(0,Y.getCoordsDataType)(Ye),tt=(0,R.getChannels)("rc",Ye),nt=(it=Ye,ot=tt,st=H[H.length-2],at=H[H.length-1],it===0||it===1?"":`
    int r = ${ot[it-2]};
    int c = ${ot[it-1]};
    int rp1 = ${ot[it-2]} + 1;
    int cp1 = ${ot[it-1]} + 1;
    bool rEdge = rp1 >= ${at};
    bool cEdge = cp1 >= ${st};
    `);var it,ot,st,at;let ct;ct=Z===0?[1,1]:Z===1?[H[0],1]:[H[Ye-1],H[Ye-2]];const ft=(function(At,Et,Mt){if(At===0)return"false";if(At===1)return`rc > ${Et[0]}`;let Ot="";for(let kt=At-2;kt<At;kt++)Ot+=`${Mt[kt]} >= ${Et[kt-At+2]}`,kt<At-1&&(Ot+="||");return Ot})(Ye,ct,tt),ut=(function(At,Et){const Mt=At.length;if(Mt===0)return"getA(), 0, 0, 0";if(Mt===1)return`getA(rc),
            rc + 1 >= ${At[0]} ? 0. : getA(rc + 1),
            0, 0`;let Ot="";if(Mt>2)for(let kt=0;kt<Mt-2;++kt)Ot+=`${Et[kt]},`;return`getA(${Ot}r, c),
          rEdge ? 0. : getA(${Ot}rp1, c),
          cEdge ? 0. : getA(${Ot}r, cp1),
          rEdge || cEdge ? 0. : getA(${Ot}rp1, cp1)`})(H,tt),_t=`
        void main() {
          ${et} rc = getOutputCoords();

          if(${ft}) {
            ${d.output} = vec4(0);
          } else {
            ${nt}

            ${d.output} = vec4(${ut});
          }
        }
      `;return Object.assign(Object.assign({},ee),{hasMain:!0,output:{dims:f.dims,type:f.type,textureType:O.TextureType.packed},shaderSource:_t})})(xe,ne)})},2827:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.unpackFromChannel=a.getChannels=a.getVecChannels=void 0;const A=l(9390);function O(Y,R){return(0,A.getGlChannels)(R).map((ee=>`${Y}.${ee}`))}a.getVecChannels=O,a.getChannels=function(Y,R){return R===1?[Y]:O(Y,R)},a.unpackFromChannel=function(){return`
    float getChannel(vec4 frag, int dim) {
      int modCoord = imod(dim, 2);
      return modCoord == 0 ? frag.r : frag.g;
    }

    float getChannel(vec4 frag, vec2 innerDims) {
      vec2 modCoord = mod(innerDims, 2.);
      return modCoord.x == 0. ?
        (modCoord.y == 0. ? frag.r : frag.g) :
        (modCoord.y == 0. ? frag.b : frag.a);
    }
  `}},2870:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parsePadAttributesV11=a.padV11=a.parsePadAttributesV2=a.padV2=void 0;const A=l(246),O=l(2517),Y=l(5060),R=l(2039),ee={name:"Pad",inputNames:["A"],inputTypes:[R.TextureType.unpacked]};a.padV2=(et,tt,nt)=>(te(tt),[et.run(Object.assign(Object.assign({},ee),{cacheHint:nt.cacheKey,get:()=>ne(et,tt[0],nt)}),tt)]),a.parsePadAttributesV2=et=>{const tt=et.attributes.getString("mode","constant"),nt=et.attributes.getFloat("value",0),it=et.attributes.getInts("pads");return(0,A.createAttributeWithCacheKey)({mode:tt,value:nt,pads:it})},a.padV11=(et,tt,nt)=>{f(tt);const it=xe(et,tt,nt);return(0,a.padV2)(et,[tt[0]],it)},a.parsePadAttributesV11=et=>et.attributes.getString("mode","constant");const xe=(et,tt,nt)=>{if(!et.session.isInitializer(tt[1].dataId)||tt.length>=3&&!et.session.isInitializer(tt[2].dataId))throw new Error("dynamic pad attributes are not allowed");const it=Array.from(tt[1].integerData),ot=tt.length>=3?tt[2].floatData[0]:0;return(0,A.createAttributeWithCacheKey)({mode:nt,pads:it,value:ot})},ne=(et,tt,nt)=>{const it=O.ShapeUtil.padShape(tt.dims.slice(),nt.pads),ot=it.length,st=`
      ${d(et,tt,nt)}
      float process(int[${ot}] indices) {
          return padA(indices);
      }`;return{name:"Pad",inputNames:["A"],inputTypes:[R.TextureType.unpacked],output:{dims:it,type:tt.type,textureType:R.TextureType.unpacked},shaderSource:st}},te=et=>{if(!et||et.length!==1)throw new Error("Pad requires 1 input");if(et[0].type!=="float32"&&et[0].type!=="float64")throw new Error("Invalid input type.")},f=et=>{if(!et||et.length!==2&&et.length!==3)throw new Error("Pad requires 2 or 3 inputs");if(et[1].type!=="int32")throw new Error("Invalid input type.");if(et.length>=3&&et[2].type==="string")throw new Error("Invalid input type.")},d=(et,tt,nt)=>{const it=(0,Y.getGlsl)(et.session.backend.glContext.version),[ot,st]=et.calculateTextureWidthAndHeight(tt.dims,R.TextureType.unpacked),at=O.ShapeUtil.computeStrides(tt.dims);switch(nt.mode){case"constant":return H(it,tt.dims,at,ot,st,nt.pads,nt.value);case"reflect":return Z(it,tt.dims,at,ot,st,nt.pads);case"edge":return Ye(it,tt.dims,at,ot,st,nt.pads);default:throw new Error("Invalid mode")}},H=(et,tt,nt,it,ot,st,at)=>{const ct=tt.length;let ft="";for(let ut=ct-1;ut>=0;--ut)ft+=`
        k = m[${ut}] - ${st[ut]};
        if (k < 0)  return constant;
        if (k >= ${tt[ut]}) return constant;
        offset += k * ${nt[ut]};
        `;return`
      float padA(int m[${ct}]) {
        const float constant = float(${at});
        int offset = 0;
        int k = 0;
        ${ft}
        vec2 coords = offsetToCoords(offset, ${it}, ${ot});
        float value = getColorAsFloat(${et.texture2D}(A, coords));
        return value;
      }
      `},Z=(et,tt,nt,it,ot,st)=>{const at=tt.length;let ct="";for(let ft=at-1;ft>=0;--ft)ct+=`
        k = m[${ft}] - ${st[ft]};
        if (k < 0) { k = -k; }
        {
          const int _2n_1 = ${2*(tt[ft]-1)};
          k = int( mod( float(k), float(_2n_1) ) ) ;
          if(k >= ${tt[ft]}) { k = _2n_1 - k; }
        }
        offset += k * ${nt[ft]};
        `;return`
      float padA(int m[${at}]) {
        int offset = 0;
        int k = 0;
        ${ct}
        vec2 coords = offsetToCoords(offset, ${it}, ${ot});
        float value = getColorAsFloat(${et.texture2D}(A, coords));
        return value;
      }
      `},Ye=(et,tt,nt,it,ot,st)=>{const at=tt.length;let ct="";for(let ft=at-1;ft>=0;--ft)ct+=`
        k = m[${ft}] - ${st[ft]};
        if (k < 0)  k = 0;
        if (k >= ${tt[ft]}) k = ${tt[ft]-1};
        offset += k * ${nt[ft]};
      `;return`
      float padA(int m[${at}]) {
        int offset = 0;
        int k = 0;
        ${ct}
        vec2 coords = offsetToCoords(offset, ${it}, ${ot});
        float value = getColorAsFloat(${et.texture2D}(A, coords));
        return value;
      }
      `}},2143:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.globalMaxPool=a.parseMaxPoolAttributes=a.maxPool=a.parseGlobalAveragePoolAttributes=a.globalAveragePool=a.parseAveragePoolAttributes=a.averagePool=void 0;const A=l(246),O=l(2517),Y=l(2039);a.averagePool=(Ye,et,tt)=>{f(et);const nt={name:"AveragePool",inputNames:["X"],inputTypes:[Y.TextureType.unpacked],cacheHint:tt.cacheKey};return[Ye.run(Object.assign(Object.assign({},nt),{get:()=>R(et,nt,!1,tt)}),et)]},a.parseAveragePoolAttributes=Ye=>{const et=Ye.attributes.getString("auto_pad","NOTSET"),tt=Ye.attributes.getInt("ceil_mode",0),nt=Ye.attributes.getInt("count_include_pad",0)!==0,it=Ye.attributes.getInts("kernel_shape"),ot=Ye.attributes.getInts("strides",[]),st=Ye.attributes.getInts("pads",[]);if(tt!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");return(0,A.createAttributeWithCacheKey)({autoPad:et,ceilMode:tt,countIncludePad:nt,kernelShape:it,strides:ot,pads:st})};const R=(Ye,et,tt,nt)=>{const[it,ot]=xe(Ye,nt,tt),st=O.ShapeUtil.size(it.kernelShape);let at="";it.countIncludePad?at+=`value /= float(${st});`:at+=`value /= float(${st} - pad);`;const ct=`
        ${d(Ye[0].dims,it,"value += _X(x);",at,"0.0")}
      `;return Object.assign(Object.assign({},et),{output:{dims:ot,type:Ye[0].type,textureType:Y.TextureType.unpacked},shaderSource:ct})};a.globalAveragePool=(Ye,et,tt)=>{f(et);const nt={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[Y.TextureType.unpacked],cacheHint:`${tt.countIncludePad}`};return[Ye.run(Object.assign(Object.assign({},nt),{get:()=>R(et,nt,!0,tt)}),et)]},a.parseGlobalAveragePoolAttributes=Ye=>{const et=Ye.attributes.getInt("count_include_pad",0)!==0;return(0,A.createAttributeWithCacheKey)({autoPad:"",ceilMode:0,countIncludePad:et,kernelShape:[],strides:[],pads:[]})},a.maxPool=(Ye,et,tt)=>{f(et);const nt={name:"MaxPool",inputNames:["X"],inputTypes:[Y.TextureType.unpacked],cacheHint:tt.cacheKey};return[Ye.run(Object.assign(Object.assign({},nt),{get:()=>ee(et,nt,!1,tt)}),et)]},a.parseMaxPoolAttributes=Ye=>{const et=Ye.attributes.getString("auto_pad","NOTSET"),tt=Ye.attributes.getInt("ceil_mode",0),nt=Ye.attributes.getInts("kernel_shape"),it=Ye.attributes.getInts("strides",[]),ot=Ye.attributes.getInts("pads",[]),st=Ye.attributes.getInt("storage_order",0),at=Ye.attributes.getInts("dilations",[]);if(st!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(tt!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");return(0,A.createAttributeWithCacheKey)({autoPad:et,ceilMode:tt,countIncludePad:!1,kernelShape:nt,strides:it,pads:ot,storageOrder:st,dilations:at})};const ee=(Ye,et,tt,nt)=>{const[it,ot]=xe(Ye,nt,tt),st=`
      ${d(Ye[0].dims,it,`
      value = max(_X(x), value);
    `,"","-1e5")}
    `;return Object.assign(Object.assign({},et),{output:{dims:ot,type:Ye[0].type,textureType:Y.TextureType.unpacked},shaderSource:st})},xe=(Ye,et,tt)=>{const nt=Ye[0].dims.slice(),it=Object.hasOwnProperty.call(et,"dilations"),ot=et.kernelShape.slice(),st=et.strides.slice(),at=it?et.dilations.slice():[],ct=et.pads.slice();O.PoolConvUtil.adjustPoolAttributes(tt,nt,ot,st,at,ct);const ft=O.PoolConvUtil.computePoolOutputShape(tt,nt,st,at,ot,ct,et.autoPad),ut=Object.assign({},et);return it?Object.assign(ut,{kernelShape:ot,strides:st,pads:ct,dilations:at,cacheKey:et.cacheKey}):Object.assign(ut,{kernelShape:ot,strides:st,pads:ct,cacheKey:et.cacheKey}),[ut,ft]},ne={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},te={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[Y.TextureType.unpacked]};a.globalMaxPool=(Ye,et)=>(f(et),[Ye.run(Object.assign(Object.assign({},te),{get:()=>ee(et,te,!0,ne)}),et)]);const f=Ye=>{if(!Ye||Ye.length!==1)throw new Error("Pool ops requires 1 input.");if(Ye[0].type!=="float32"&&Ye[0].type!=="float64")throw new Error("Invalid input type.")},d=(Ye,et,tt,nt,it)=>{const ot=Ye.length;if(et.kernelShape.length<=2){const st=et.kernelShape[et.kernelShape.length-1],at=et.strides[et.strides.length-1],ct=et.pads[et.pads.length/2-1],ft=et.pads[et.pads.length-1],ut=Ye[ot-1];let _t="",At="",Et="";if(_t=ct+ft!==0?`
          for (int i = 0; i < ${st}; i++) {
            x[${ot} - 1] = indices[${ot} - 1] * ${at} - ${ct} + i;
            if (x[${ot} - 1] < 0 || x[${ot} - 1] >= ${ut}) {
              pad++;
              continue;
            }
            ${tt}
          }`:`
          for (int i = 0; i < ${st}; i++) {
            x[${ot} - 1] = indices[${ot} - 1] * ${at} - ${ct} + i;
            ${tt}
          }`,et.kernelShape.length===2){const Mt=et.kernelShape[et.kernelShape.length-2],Ot=et.strides[et.strides.length-2],kt=et.pads[et.pads.length/2-2],yt=et.pads[et.pads.length-2],St=Ye[ot-2];At=kt+yt!==0?`
            for (int j = 0; j < ${Mt}; j++) {
              x[${ot} - 2] = indices[${ot} - 2] * ${Ot} - ${kt} + j;
              if (x[${ot} - 2] < 0 || x[${ot} - 2] >= ${St}) {
                pad+= ${st};
                continue;
              }
          `:`
            for (int j = 0; j < ${Mt}; j++) {
              x[${ot} - 2] = indices[${ot} - 2] * ${Ot} - ${kt} + j;
            `,Et=`
          }
        `}return`
        float process(int indices[${ot}]) {
          int x[${ot}];
          copyVec(indices, x);

          float value = ${it};
          int pad = 0;
          ${At}
          ${_t}
          ${Et}
          ${nt}
          return value;
        }
      `}{const st=O.ShapeUtil.size(et.kernelShape),at=O.ShapeUtil.computeStrides(et.kernelShape),ct=at.length,ft=et.pads.length,ut=Z(ct),_t=H(Ye,"inputDims"),At=H(et.pads,"pads"),Et=H(at,"kernelStrides"),Mt=H(et.strides,"strides");let Ot="";return Ot=et.pads.reduce(((kt,yt)=>kt+yt))?`
            if (x[j] >= inputDims[j] || x[j] < 0) {
              pad++;
              isPad = true;
              break;
            }
          }
          if (!isPad) {
            ${tt}
          }`:`
          }
          ${tt}
        `,`
        ${ut}
        float process(int indices[${ot}]) {
          int x[${ot}];
          copyVec(indices, x);
          int offset[${ct}];
          int pads[${ft}];
          int inputDims[${ot}];
          int kernelStrides[${ct}];
          int strides[${ct}];
          ${At}
          ${_t}
          ${Mt}
          ${Et}

          float value = ${it};
          int pad = 0;
          bool isPad = false;
          for (int i = 0; i < ${st}; i++) {
            offsetToIndices(i, kernelStrides, offset);
            isPad = false;
            for (int j = ${ot} - ${ct}; j < ${ot}; j++) {
              x[j] = indices[j] * strides[j - ${ot} + ${ct}]
                + offset[j - ${ot} + ${ct}] - pads[j - 2];
              ${Ot}
          }
          ${nt}

          return value;
        }
      `}},H=(Ye,et)=>{let tt="";for(let nt=0;nt<Ye.length;nt++)tt+=`
      ${et}[${nt}] = ${Ye[nt]};
    `;return tt},Z=Ye=>`
  void offsetToIndices(int offset, int[${Ye}] strides, out int[${Ye}] indices) {
    if (${Ye} == 0) {
      return;
    }
    for (int i = 0; i < ${Ye} - 1; ++i) {
      indices[i] = offset / strides[i];
      offset -= indices[i] * strides[i];
    }
    indices[${Ye} - 1] = offset;
  }`},4939:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.reduceLogSumSquare=a.reduceLogSum=a.reduceProd=a.reduceMin=a.reduceMax=a.reduceMean=a.reduceSum=a.parseReduceAttributes=void 0;const A=l(246),O=l(782),Y=l(2517),R=l(2039),ee=(te,f,d,H,Z)=>{ne(f);const Ye={name:H,inputNames:["A"],inputTypes:[R.TextureType.unpacked]};return[te.run(Object.assign(Object.assign({},Ye),{cacheHint:d.cacheKey,get:()=>xe(te,f,d,H,Z,Ye)}),f)]};a.parseReduceAttributes=te=>{const f=te.attributes.getInts("axes",[]),d=te.attributes.getInt("keepdims",1)===1;return(0,A.createAttributeWithCacheKey)({axes:f,keepDims:d})};const xe=(te,f,d,H,Z,Ye)=>{const et=[],tt=f[0].dims.length||1,nt=[],it=Y.ShapeUtil.normalizeAxes(d.axes,f[0].dims.length),ot=Z(f,it);let st=ot[1];for(let ct=0;ct<f[0].dims.length;ct++)it.indexOf(ct)>=0||it.length===0?(d.keepDims&&et.push(1),st=`
          for(int j${ct} = 0; j${ct} < ${f[0].dims[ct]}; j${ct}++) {
            inputIdx[${ct}] = j${ct};
            ${st}
          }`):(nt.push(`inputIdx[${ct}] = outputIdx[${et.length}];`),et.push(f[0].dims[ct]));const at=`
      float process(int outputIdx[${et.length||1}]) {
        float value;                 // final result
        int inputIdx[${tt}];      // addressing input data
        ${nt.join(`
`)}
        ${ot[0]}       // init ops for reduce max/min
        ${st}
        ${ot[2]}       // final computation for reduce mean
        return value;
      }`;return Object.assign(Object.assign({},Ye),{output:{dims:et,type:f[0].type,textureType:R.TextureType.unpacked},shaderSource:at})},ne=te=>{if(!te||te.length!==1)throw new Error("Reduce op requires 1 input.");if(O.NUMBER_TYPES.indexOf(te[0].type)===-1)throw new Error("Invalid input type.")};a.reduceSum=(te,f,d)=>ee(te,f,d,"ReduceSum",(()=>["value = 0.0;","value += _A(inputIdx);",""])),a.reduceMean=(te,f,d)=>ee(te,f,d,"ReduceMean",((H,Z)=>{let Ye=1;for(let et=0;et<H[0].dims.length;et++)(Z.indexOf(et)>=0||Z.length===0)&&(Ye*=H[0].dims[et]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${Ye}.;`]})),a.reduceMax=(te,f,d)=>ee(te,f,d,"ReduceMax",((H,Z)=>{const Ye=[];for(let et=0;et<H[0].dims.length;et++)(Z.indexOf(et)>=0||Z.length===0)&&Ye.push(`inputIdx[${et}] = 0;`);return[`${Ye.join(`
`)}
value = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]})),a.reduceMin=(te,f,d)=>ee(te,f,d,"ReduceMin",((H,Z)=>{const Ye=[];for(let et=0;et<H[0].dims.length;et++)(Z.indexOf(et)>=0||Z.length===0)&&Ye.push(`inputIdx[${et}] = 0;`);return[`${Ye.join(`
`)}
value = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]})),a.reduceProd=(te,f,d)=>ee(te,f,d,"ReduceProd",(()=>["value = 1.0;","value *= _A(inputIdx);",""])),a.reduceLogSum=(te,f,d)=>ee(te,f,d,"ReduceLogSum",(()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"])),a.reduceLogSumSquare=(te,f,d)=>ee(te,f,d,"ReduceLogSumSquare",(()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""]))},7019:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.isReshapeCheap=a.processDims3D=a.createPackedReshape3DProgramInfoLoader=void 0;const A=l(2517),O=l(5060),Y=l(2039),R=l(2827);a.createPackedReshape3DProgramInfoLoader=(ee,xe,ne)=>{const te=(f=>({name:"Reshape (packed)",inputTypes:[Y.TextureType.packed],inputNames:["A"],cacheHint:`${f}`}))(ne);return Object.assign(Object.assign({},te),{get:()=>((f,d,H,Z)=>{const Ye=d.dims,et=Z;let tt="";for(let ot=0;ot<4;ot++){let st="";switch(ot){case 0:st="outputCoords = rc;";break;case 1:st="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:st="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:st="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw new Error}tt+=`
        ${st}
        ${ot>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}
          int flattenedIndex = getFlattenedIndex(outputCoords);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);
          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${ot}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);

        ${ot>0?"}":""}
      `}const nt=(0,O.getGlsl)(f.session.backend.glContext.version),it=`
      ${(function(ot){const st=A.ShapeUtil.computeStrides(ot),at=["b","r","c"],ct="index";return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${st.map(((ft,ut)=>`int ${at[ut]} = ${ct} / ${ft}; ${ut===st.length-1?`int ${at[ut+1]} = ${ct} - ${at[ut]} * ${ft}`:`index -= ${at[ut]} * ${ft}`};`)).join("")}
      return ivec3(b, r, c);
    }
  `})(Ye)}
      ${(function(ot){const st=A.ShapeUtil.computeStrides(ot);return`
  int getFlattenedIndex(ivec3 coords) {
    // reverse y, z order
    return coords.x * ${st[0]} + coords.z * ${st[1]} + coords.y;
  }
`})(et)}
      ${(0,R.unpackFromChannel)()}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.0);

        ivec3 outputCoords;
        int rows = ${et[2]};
        int cols = ${et[1]};

        ${tt}
        ${nt.output} = result;
      }
    `;return Object.assign(Object.assign({},H),{output:{dims:et,type:d.type,textureType:Y.TextureType.packed},shaderSource:it,hasMain:!0})})(ee,xe,te,ne)})},a.processDims3D=function(ee){if(ee.length===0)return[1,1,1];let xe=1;for(let ne=0;ne<ee.length-2;++ne)xe*=ee[ne];return[xe,ee.length>1?ee[ee.length-2]:1,ee[ee.length-1]]},a.isReshapeCheap=function(ee,xe){let ne=!1;return ne=ee.length===0||xe.length===0||(ee.length<2||xe.length<2?ee[ee.length-1]===xe[xe.length-1]:ee[ee.length-1]===xe[xe.length-1]&&ee[ee.length-2]===xe[xe.length-2]),ne}},718:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.reshape=void 0;const A=l(2517);a.reshape=(O,Y)=>{const R=A.ShapeUtil.calculateReshapedDims(Y[0].dims,Y[1].integerData);return O.session.pack?[O.reshapePacked(Y[0],R)]:[O.reshapeUnpacked(Y[0],R)]}},2268:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseResizeAttributesV11=a.parseResizeAttributesV10=a.resize=void 0;const A=l(5060),O=l(2039),Y=l(9390),R=l(2827),ee=l(9793),xe={name:"Resize",inputNames:["A"],inputTypes:[O.TextureType.packed]};a.resize=(H,Z,Ye)=>((0,ee.validateInputs)(Z,Ye),[H.run(Object.assign(Object.assign({},xe),{cacheHint:Ye.cacheKey,get:()=>ne(H,Z,Ye)}),Z)]),a.parseResizeAttributesV10=H=>(0,ee.parseUpsampleAttributes)(H,10),a.parseResizeAttributesV11=H=>(0,ee.parseUpsampleAttributes)(H,11);const ne=(H,Z,Ye)=>{const et=(0,A.getGlsl)(H.session.backend.glContext.version),[tt,nt]=te(Z,Ye);if(tt.every((Ot=>Ot===1))&&Ye.coordinateTransformMode!=="tf_crop_and_resize")return Object.assign(Object.assign({},xe),{output:{dims:nt,type:Z[0].type,textureType:O.TextureType.packed},hasMain:!0,shaderSource:`void main() {
                    vec4 v = ${et.texture2D}(X, TexCoords);
                    ${et.output} = v;
                }`});const it=nt.length;if(it<2)throw new Error(`output dimension should be at least 2, but got ${it}`);const ot=nt[it-2],st=nt[it-1],at=Z[0].dims;if(it!==at.length)throw new Error(`output dimension should match input ${at.length}, but got ${it}`);const ct=at[it-2],ft=at[it-1],ut=tt[it-2],_t=tt[it-1];let At="";if(Ye.mode!=="linear")throw new Error(`resize (packed) does not support mode: '${Ye.mode}'`);switch(Ye.coordinateTransformMode){case"asymmetric":At=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return vec4(coords) / scaleWHWH;
                    }
                `;break;case"half_pixel":At=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;
                    }
                `;break;case"pytorch_half_pixel":At=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 fcoords = vec4(coords);
                        return vec4(
                            ${st}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,
                            ${ot}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,
                            ${st}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,
                            ${ot}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0
                          );
                    }
                `;break;case"align_corners":At=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 resized = vec4(${st}.0 - 1.0, ${ot}.0 - 1.0, ${st}.0 - 1.0,
                            ${ot}.0 - 1.0);
                        vec4 original = vec4(${ft}.0 - 1.0, ${ct}.0 - 1.0, ${ft}.0 - 1.0,
                            ${ct}.0 - 1.0);
                        vec4 new_scale = original / resized;
                        return vec4(coords) * new_scale;
                    }
                `;break;default:throw new Error(`resize (packed) does not support coordinateTransformMode:                                 '${Ye.coordinateTransformMode}'`)}const Et=(0,Y.getCoordsDataType)(it),Mt=`
            const vec2 inputWH = vec2(${ct}.0, ${ft}.0);
            const vec4 scaleWHWH = vec4(float(${ut}), float(${_t}), float(${ut}), float(${_t}));
            ${(0,R.unpackFromChannel)()}
            ${At}
            float getAValue(int x10, int r, int c, int d) {
                return getChannel(getA(x10, r, c, d), vec2(c, d));
            }
            void main() {
                ${Et} rc = getOutputCoords();

                int batch = rc[0];
                int depth = rc[1];

                // retrieve the 4 coordinates that is used in the 4 packed output values.
                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);

                // calculate the source index in fraction
                vec4 sourceFrac = getSourceFracIndex(coords);

                // get the lower and upper bound of the 4 values that will be packed into one texel.
                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));
                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));
                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));
                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));

                bool hasNextRow = rc.w < ${ot-1};
                bool hasNextCol = rc.z < ${st-1};

                // pack x00, x01, x10, x11's top-left corner into one vec4 structure
                vec4 topLeft = vec4(
                    getAValue(batch, depth, x00.x, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);

                // pack x00, x01, x10, x11's top-right corner into one vec4 structure
                vec4 topRight = vec4(
                    getAValue(batch, depth, x00.x, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);

                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure
                vec4 bottomLeft = vec4(
                    getAValue(batch, depth, x00.z, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);

                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure
                vec4 bottomRight = vec4(
                    getAValue(batch, depth, x00.z, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);

                // calculate the interpolation fraction on u and v direction
                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);
                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));

                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);
                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);
                vec4 newValue = mix(top, bottom, clampFrac.xxzz);

                ${et.output} = vec4(newValue);
            }
        `;return Object.assign(Object.assign({},xe),{output:{dims:nt,type:Z[0].type,textureType:O.TextureType.packed},hasMain:!0,shaderSource:Mt})},te=(H,Z)=>{const Ye=H[0].dims;let et,tt=Z.scales;if(tt.length===0){const it=H[Z.scalesInputIdx];if(it&&it.size!==0){if(H[Z.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");tt=f(it,Z.mode,Z.isResize)}else{const ot=H[Z.sizesInputIdx];if(!ot||ot.size===0)throw new Error("Either scales or sizes MUST be provided as input.");et=Array.from(ot.integerData),tt=d(et,Ye,Z.mode,Z.isResize)}}else if(H[Z.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");const nt=et||Ye.map(((it,ot)=>Math.floor(it*tt[ot])));return[tt,nt]},f=(H,Z,Ye)=>{const et=Array.from(H.floatData);return(0,ee.scalesValidation)(et,Z,Ye),et},d=(H,Z,Ye,et)=>{const tt=Z.length,nt=new Array(tt);for(let it=0,ot=tt;it<ot;it++)if(Z[it]===0){if(H[it]!==0)throw new Error("Input dim is zero but required output dim is non-zero.");nt[it]=1}else nt[it]=H[it]/Z[it];return(0,ee.scalesValidation)(nt,Ye,et),nt}},8117:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.shape=void 0;const A=l(9162);a.shape=(Y,R)=>(O(R),[new A.Tensor([R[0].dims.length],"int32",void 0,void 0,new Int32Array(R[0].dims))]);const O=Y=>{if(!Y||Y.length!==1)throw new Error("Shape requires 1 input.")}},2278:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.sliceV10=a.parseSliceAttributes=a.slice=void 0;const A=l(246),O=l(782),Y=l(2517),R=l(2039),ee={name:"Slice",inputNames:["A"],inputTypes:[R.TextureType.unpacked]};a.slice=(d,H,Z)=>(ne(H),[d.run(Object.assign(Object.assign({},ee),{cacheHint:Z.cacheKey,get:()=>xe(d,H[0],Z)}),H)]),a.parseSliceAttributes=d=>{const H=d.attributes.getInts("starts"),Z=d.attributes.getInts("ends"),Ye=d.attributes.getInts("axes",[]);return(0,A.createAttributeWithCacheKey)({starts:H,ends:Z,axes:Ye})};const xe=(d,H,Z)=>{const Ye=Z.axes.length===0?H.dims.slice(0).map(((at,ct)=>ct)):Z.axes,et=Y.ShapeUtil.normalizeAxes(Ye,H.dims.length),tt=Z.starts.map(((at,ct)=>at>H.dims[et[ct]]-1?H.dims[et[ct]]:Y.ShapeUtil.normalizeAxis(at,H.dims[et[ct]]))),nt=Z.ends.map(((at,ct)=>at>H.dims[et[ct]]-1?H.dims[et[ct]]:Y.ShapeUtil.normalizeAxis(at,H.dims[et[ct]]))),it=H.dims.slice(),ot=[];for(let at=0;at<et.length;at++)it[et[at]]=nt[at]-tt[at],tt[at]>0&&ot.push(`outputIdx[${et[at]}] += ${tt[at]};`);const st=`
      float process(int outputIdx[${it.length}]) {
        ${ot.join(`
      `)}
        return _A(outputIdx);
      }`;return Object.assign(Object.assign({},ee),{output:{dims:it,type:H.type,textureType:R.TextureType.unpacked},shaderSource:st})},ne=d=>{if(!d||d.length!==1)throw new Error("Slice requires 1 input.");if(O.NUMBER_TYPES.indexOf(d[0].type)===-1)throw new Error("Invalid input type.")};a.sliceV10=(d,H)=>{f(H);const Z=te(d,H);return[d.run(Object.assign(Object.assign({},ee),{cacheHint:Z.cacheKey,get:()=>xe(d,H[0],Z)}),[H[0]])]};const te=(d,H)=>{if(!d.session.isInitializer(H[1].dataId)||!d.session.isInitializer(H[2].dataId)||H.length>=4&&!d.session.isInitializer(H[3].dataId)||H.length>=5&&!d.session.isInitializer(H[4].dataId))throw new Error("dynamic slice attributes are not allowed");if(H.length>=5&&H[4].integerData.some((tt=>tt!==1)))throw new Error("currently non-1 steps is not supported for Slice");const Z=Array.from(H[1].integerData),Ye=Array.from(H[2].integerData),et=H.length>=4?Array.from(H[3].integerData):[];return{starts:Z,ends:Ye,axes:et,cacheKey:`${et};${Z};${Ye}`}},f=d=>{if(!d||d.length<3||d.length>5)throw new Error("Invalid input number.");if(d[1].type!=="int32"||d[1].dims.length!==1)throw new Error("Invalid input type.");if(d[2].type!=="int32"||d[2].dims.length!==1)throw new Error("Invalid input type.");if(d.length>=4&&(d[3].type!=="int32"||d[3].dims.length!==1))throw new Error("Invalid input type.");if(d.length>=5&&(d[4].type!=="int32"||d[4].dims.length!==1))throw new Error("Invalid input type.")}},5524:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.softmaxV13=a.parseSoftmaxAttributesV13=a.parseSoftmaxAttributes=a.softmax=void 0;const A=l(246),O=l(2517),Y=l(5060),R=l(2039),ee=l(3738),xe={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[R.TextureType.unpacked]},ne={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[R.TextureType.unpacked,R.TextureType.unpacked]},te={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[R.TextureType.unpacked,R.TextureType.unpacked,R.TextureType.unpacked]};a.softmax=(et,tt,nt)=>{Ye(tt);const it=tt[0].dims.slice(),ot=O.ShapeUtil.normalizeAxis(nt.axis,it.length),st=O.ShapeUtil.sizeToDimension(it,ot),at=O.ShapeUtil.sizeFromDimension(it,ot);return f(et,tt,nt,st,at)},a.parseSoftmaxAttributes=et=>(0,A.createAttributeWithCacheKey)({axis:et.attributes.getInt("axis",1)}),a.parseSoftmaxAttributesV13=et=>(0,A.createAttributeWithCacheKey)({axis:et.attributes.getInt("axis",-1)}),a.softmaxV13=(et,tt,nt)=>{Ye(tt);const it=tt[0].dims.slice(),ot=O.ShapeUtil.normalizeAxis(nt.axis,it.length),st=it.length,at=ot!==st-1,ct=[];let ft,ut=[],_t=[];at&&(ut=Array.from({length:st}).map(((Ot,kt)=>kt)),ut[ot]=st-1,ut[st-1]=ot,ut.map((Ot=>ct.push(it[Ot]))),ft=(0,A.createAttributeWithCacheKey)({perm:ut}),_t=(0,ee.transpose)(et,tt,ft));const At=at?O.ShapeUtil.sizeToDimension(ct,st-1):O.ShapeUtil.sizeToDimension(it,st-1),Et=at?O.ShapeUtil.sizeFromDimension(ct,st-1):O.ShapeUtil.sizeFromDimension(it,st-1),Mt=f(et,at?_t:tt,nt,At,Et);return at?(0,ee.transpose)(et,Mt,ft):Mt};const f=(et,tt,nt,it,ot)=>{const st=d(et,tt[0],it,ot,[it]),at=et.run(Object.assign(Object.assign({},xe),{cacheHint:nt.cacheKey,get:()=>st}),tt),ct=H(et,tt[0],it,ot,st.output.dims,[it]),ft=et.run(Object.assign(Object.assign({},ne),{cacheHint:nt.cacheKey,get:()=>ct}),[tt[0],at]),ut=Z(et,tt[0],it,ot,st.output.dims,ct.output.dims);return[et.run(Object.assign(Object.assign({},te),{cacheHint:nt.cacheKey,get:()=>ut}),[tt[0],at,ft])]},d=(et,tt,nt,it,ot)=>{const[st,at]=et.calculateTextureWidthAndHeight(tt.dims,R.TextureType.unpacked),ct=ot.length;if(nt<1||it<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(ot.length!==1)throw new Error("Dimensionality of the output should be 1");if(ot[0]!==nt)throw new Error("Shape of the output should be equal to logical row count");const ft=(0,Y.getGlsl)(et.session.backend.glContext.version),ut=`
      float process(int[${ct}] indices) {
        int logical_row_start_offset = indices[0] * ${it};

        float max = getColorAsFloat(${ft.texture2D}(A, offsetToCoords(logical_row_start_offset, ${st},
        ${at} )));
        for(int i=1; i<${it}; ++i)
        {
          float current = getColorAsFloat(${ft.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${st}, ${at})));
          if(current > max)
          max = current;
        }

        return max;
      }`;return Object.assign(Object.assign({},xe),{output:{dims:ot,type:tt.type,textureType:R.TextureType.unpacked},shaderSource:ut})},H=(et,tt,nt,it,ot,st)=>{const[at,ct]=et.calculateTextureWidthAndHeight(tt.dims,R.TextureType.unpacked),ft=st.length;if(nt<1||it<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(st.length!==1)throw new Error("Dimensionality of the output should be 1");if(st[0]!==nt)throw new Error("Shape of the output should be equal to logical row count");if(ot.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(ot[0]!==nt)throw new Error("Shape of the intermediate results should be equal to logical row count");const ut=`
      float process(int[${ft}] indices) {
        int logical_row_start_offset = indices[0] * ${it};

        float norm_factor = 0.0;
        float max = _Max(indices);
        for(int i=0; i<${it}; ++i)
        {
          norm_factor += exp(getColorAsFloat(${(0,Y.getGlsl)(et.session.backend.glContext.version).texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${at}, ${ct}))) - max);
        }

        return norm_factor;
      }`;return Object.assign(Object.assign({},ne),{output:{dims:st,type:tt.type,textureType:R.TextureType.unpacked},shaderSource:ut})},Z=(et,tt,nt,it,ot,st)=>{const[at,ct]=et.calculateTextureWidthAndHeight(tt.dims,R.TextureType.unpacked),ft=tt.dims.length;if(nt<1||it<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(ot.length!==1||st.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(ot[0]!==nt||st[0]!==nt)throw new Error("Shape of the intermediate results should be equal to logical row count");const ut=`
      float process(int[${ft}] indices) {

      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)
      int offset = coordsToOffset(TexCoords, ${at}, ${ct});

      //determine the logical row for this index
      int logical_row_index[1];
      logical_row_index[0] = offset / ${it};

      float norm_factor = _Norm(logical_row_index);

      // avoid possible division by 0
      // if norm_facor is 0, all elements are zero
      // if so, return 0
      if(norm_factor == 0.0)
        return 0.0;

      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;
    }`;return Object.assign(Object.assign({},te),{output:{dims:tt.dims,type:tt.type,textureType:R.TextureType.unpacked},shaderSource:ut})},Ye=et=>{if(!et||et.length!==1)throw new Error("Softmax requires 1 input.");if(et[0].type!=="float32"&&et[0].type!=="float64")throw new Error("Invalid input type")}},5975:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseSplitAttributes=a.split=void 0;const A=l(246),O=l(2517),Y=l(2039),R={name:"Split",inputNames:["A"],inputTypes:[Y.TextureType.unpacked]};a.split=(te,f,d)=>{ne(f);const H=O.ShapeUtil.normalizeAxis(d.axis,f[0].dims.length),Z=ee(te,f,H,d),Ye=[];for(let et=0;et<Z;++et)Ye.push(te.run(Object.assign(Object.assign({},R),{cacheHint:`${d.cacheKey};${et}`,get:()=>xe(te,f[0],d,H,et)}),f));return Ye},a.parseSplitAttributes=te=>{const f=te.attributes.getInt("axis",0),d=te.attributes.getInts("split",[]),H=te.outputs.length;return(0,A.createAttributeWithCacheKey)({axis:f,split:d,numOutputs:H})};const ee=(te,f,d,H)=>{const[,Z]=O.SplitUtil.splitShape(f[0].dims,d,H.split,H.numOutputs);return Z.length},xe=(te,f,d,H,Z)=>{const[Ye,et]=O.SplitUtil.splitShape(f.dims,H,d.split,d.numOutputs),tt=et[Z],nt=Ye[Z],it=`
      float process(int indices[${nt.length}]) {
        indices[${H}] += ${tt};
        return _A(indices);
      }
    `;return Object.assign(Object.assign({},R),{cacheHint:`${d.cacheKey}:${Z}`,output:{dims:nt,type:f.type,textureType:Y.TextureType.unpacked},shaderSource:it})},ne=te=>{if(!te||te.length!==1)throw new Error("Split requires one input.");if(te[0].type!=="int8"&&te[0].type!=="uint8"&&te[0].type!=="int16"&&te[0].type!=="uint16"&&te[0].type!=="int32"&&te[0].type!=="uint32"&&te[0].type!=="float32"&&te[0].type!=="float64"&&te[0].type!=="bool")throw new Error("Invalid input type.")}},3933:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseSqueezeAttributes=a.squeezeV13=a.squeeze=void 0;const A=l(2517);a.squeeze=(R,ee,xe)=>{O(ee);const ne=A.ShapeUtil.squeezeShape(ee[0].dims,xe);return[R.reshapeUnpacked(ee[0],ne)]},a.squeezeV13=(R,ee)=>(Y(ee),(0,a.squeeze)(R,[ee[0]],Array.from(ee[1].integerData))),a.parseSqueezeAttributes=R=>R.attributes.getInts("axes");const O=R=>{if(!R||R.length!==1)throw new Error("Squeeze requires 1 input.");if(R[0].type==="string")throw new Error("invalid input tensor types.")},Y=R=>{if(!R||R.length!==2)throw new Error("Squeeze requires 2 inputs.");if(R[1].type!=="int32")throw new Error("Invalid input type.")}},6558:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.sum=void 0;const A=l(5060),O=l(2039);a.sum=(ee,xe)=>{R(xe);const ne={name:"Sum",inputNames:xe.map(((te,f)=>`X${f}`)),inputTypes:new Array(xe.length).fill(O.TextureType.unpacked)};return[ee.run(Object.assign(Object.assign({},ne),{get:()=>Y(ee,xe,ne)}),xe)]};const Y=(ee,xe,ne)=>{const te=(0,A.getGlsl)(ee.session.backend.glContext.version),f=xe[0].dims.slice(),d=`
      void main() {
        vec4 result = ${xe.map(((H,Z)=>`${te.texture2D}(X${Z},TexCoords)`)).join(" + ")};
        ${te.output} = result;
      }
    `;return Object.assign(Object.assign({},ne),{output:{dims:f,type:xe[0].type,textureType:O.TextureType.unpacked},hasMain:!0,shaderSource:d})},R=ee=>{if(!ee||ee.length===0)throw new Error("Sum requires inputs.");const xe=ee[0].dims.length;for(let ne=1;ne<ee.length;ne++){if(xe!==ee[ne].dims.length)throw new Error("Input shapes are mismatched.");for(let te=0;te<xe;te++)if(ee[0].dims[te]!==ee[ne].dims[te])throw new Error("Input shapes are not matched.")}if(ee[0].type!=="float32"&&ee[0].type!=="float64")throw new Error("Invalid input type.");for(let ne=1;ne<ee.length;ne++)if(ee[0].type!==ee[ne].type)throw new Error("Input types are not matched.")}},5723:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.tile=void 0;const A=l(782),O=l(2039);a.tile=(ee,xe)=>{R(xe);const ne={name:"Tile",inputNames:["A"],inputTypes:[O.TextureType.unpacked]};return[ee.run(Object.assign(Object.assign({},ne),{get:()=>Y(ee,xe,ne)}),xe)]};const Y=(ee,xe,ne)=>{const te=xe[0].dims.slice(),f=new Array(te.length),d=[];for(let Ye=0;Ye<te.length;Ye++)f[Ye]=te[Ye]*xe[1].numberData[Ye],d.push(`inputIdx[${Ye}] = int(mod(float(outputIdx[${Ye}]), ${te[Ye]}.));`);const H=f.length,Z=`
      float process(int outputIdx[${H}]) {
        int inputIdx[${H}];
        ${d.join(`
`)}
        return _A(inputIdx);
      }
    `;return Object.assign(Object.assign({},ne),{output:{dims:f,type:xe[0].type,textureType:O.TextureType.unpacked},shaderSource:Z})},R=ee=>{if(!ee||ee.length!==2)throw new Error("Tile requires 2 input.");if(ee[1].dims.length!==1)throw new Error("The second input shape must 1 dimension.");if(ee[1].dims[0]!==ee[0].dims.length)throw new Error("Invalid input shape.");if(A.NUMBER_TYPES.indexOf(ee[0].type)===-1)throw new Error("Invalid input type.");if(ee[1].type!=="int32"&&ee[1].type!=="int16")throw new Error("Invalid repeat type.")}},3738:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseTransposeAttributes=a.transpose=void 0;const A=l(246),O=l(2517),Y=l(2039),R={name:"Transpose",inputNames:["A"],inputTypes:[Y.TextureType.unpacked]};a.transpose=(d,H,Z)=>(f(H),[d.run(Object.assign(Object.assign({},R),{cacheHint:Z.cacheKey,get:()=>ee(d,H[0],Z.perm)}),H)]),a.parseTransposeAttributes=d=>(0,A.createAttributeWithCacheKey)({perm:d.attributes.getInts("perm",[])});const ee=(d,H,Z)=>{const Ye=H.dims;Z=xe(Ye,Z);const et=ne(Ye,Z),tt=Ye.length,nt=`
      ${te("perm",Z,tt)}
      float process(int indices[${tt}]) {
        int a[${tt}];
        perm(a, indices);
        return _A(a);
      }`;return Object.assign(Object.assign({},R),{output:{dims:et,type:H.type,textureType:Y.TextureType.unpacked},shaderSource:nt})},xe=(d,H)=>(H&&H.length!==d.length&&(H=[...d.keys()].reverse()),H),ne=(d,H)=>(H=xe(d,H),O.ShapeUtil.sortBasedOnPerm(d,H)),te=(d,H,Z)=>{const Ye=[];Ye.push(`void ${d}(out int a[${Z}], int src[${Z}]) {`);for(let et=0;et<Z;++et)Ye.push(`	a[${H[et]}]=src[${et}];`);return Ye.push("	}"),Ye.join(`
`)},f=d=>{if(!d||d.length!==1)throw new Error("Transpose requires 1 input.");if(d[0].type!=="float32"&&d[0].type!=="float64")throw new Error("input should be float tensor")}},8710:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.encodeAsUint8=void 0;const A=l(5060),O=l(2039);a.encodeAsUint8=(Y,R)=>{const ee=R.shape,xe=(0,A.getGlsl)(Y.session.backend.glContext.version),ne=`
    const float FLOAT_MAX = 1.70141184e38;
    const float FLOAT_MIN = 1.17549435e-38;

    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    highp vec4 encodeAsUint8(highp float v) {
      if (isNaN(v)) {
        return vec4(255, 255, 255, 255);
      }

      highp float av = abs(v);

      if(av < FLOAT_MIN) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      } else if(v > FLOAT_MAX) {
        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
      } else if(v < -FLOAT_MAX) {
        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
      }

      highp vec4 c = vec4(0,0,0,0);

      highp float e = floor(log2(av));
      highp float m = exp2(fract(log2(av))) - 1.0;

      c[2] = floor(128.0 * m);
      m -= c[2] / 128.0;
      c[1] = floor(32768.0 * m);
      m -= c[1] / 32768.0;
      c[0] = floor(8388608.0 * m);

      highp float ebias = e + 127.0;
      c[3] = floor(ebias / 2.0);
      ebias -= c[3] * 2.0;
      c[2] += floor(ebias) * 128.0;

      c[3] += 128.0 * step(0.0, -v);

      return c / 255.0;
    }

    void main() {
      float value = ${xe.texture2D}(X,TexCoords).r;
      ${xe.output} = encodeAsUint8(value);
    }`,te={name:"Uint8Encode",inputTypes:[O.TextureType.unpacked],inputNames:["X"],output:{dims:ee,type:R.tensor.type,textureType:O.TextureType.downloadUint8AsFloat},shaderSource:ne,hasMain:!0};return Y.executeProgram(te,[R.tensor])}},4909:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.tanh=a.tan=a.sqrt=a.sin=a.sigmoid=a.relu=a.not=a.neg=a.log=a.parseLeakyReluAttributes=a.leakyRelu=a.identity=a.floor=a.exp=a.parseEluAttributes=a.elu=a.cos=a.ceil=a.clipV11=a.parseClipAttributes=a.clip=a.atan=a.asin=a.acos=a.abs=a.glslTanh=a.glslTan=a.glslSqrt=a.glslSigmoid=a.glslRelu=a.glslSin=a.glslNot=a.glslNeg=a.glslLog=a.glslLeakyRelu=a.glslIdentity=a.glslClip=a.glslFloor=a.glslExp=a.glslElu=a.glslCos=a.glslCeil=a.glslAtan=a.glslAsin=a.glslAcos=a.glslAbs=void 0;const A=l(246),O=l(2517),Y=l(8520),R=l(5060),ee=l(2039);function xe(){return Mt("abs")}function ne(){return Mt("acos")}function te(){return Mt("asin")}function f(){return Mt("atan")}function d(){return Mt("ceil")}function H(){return Mt("cos")}function Z(yt){return{body:`
  const float alpha = float(${yt});

  float elu_(float a) {
    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;
  }
  vec4 elu_(vec4 v) {
    return vec4(elu_(v.x), elu_(v.y), elu_(v.z), elu_(v.w));
  }
  `,name:"elu",type:Y.FunctionType.ValueBased}}function Ye(){return Mt("exp")}function et(){return Mt("floor")}function tt(yt,St){const Yt="clip";return{body:`
  const float min = float(${yt});
  const float max = float(${St});

  float ${Yt}_(float a) {
    return clamp(a, min, max);
  }
  vec4 ${Yt}_(vec4 v) {
    return clamp(v, min, max);
  }
  `,name:Yt,type:Y.FunctionType.ValueBased}}function nt(){const yt="indentity";return{body:`
  float ${yt}_(float a) {
    return a;
  }
  vec4 ${yt}_(vec4 v) {
    return v;
  }
  `,name:yt,type:Y.FunctionType.ValueBased}}function it(yt){const St="leakyRelu";return{body:`
  const float alpha = float(${yt});

  float ${St}_(float a) {
    return a < 0.0 ? a * alpha : a;
  }
  vec4 ${St}_(vec4 v) {
    return vec4(${St}_(v.x), ${St}_(v.y), ${St}_(v.z), ${St}_(v.w));
  }
  `,name:St,type:Y.FunctionType.ValueBased}}function ot(){return Mt("log")}function st(){return{body:`
  float neg_(float a) {
    return -a;
  }
  vec4 neg_(vec4 v) {
    return -v;
  }
  `,name:"neg",type:Y.FunctionType.ValueBased}}function at(){return{body:`
  float not_(float a) {
    return float( ! bool(a) );
  }
  bool not_(bool a) {
    return !a;
  }
  vec4 not_(vec4 v) {
    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));
  }
  bvec4 not_(bvec4 v) {
    return bvec4(!v.x, !v.y, !v.z, !v.w);
  }
  `,name:"not",type:Y.FunctionType.ValueBased}}function ct(){return Mt("sin")}function ft(){const yt="relu";return{body:`
  float ${yt}_(float a) {
    return max( a, 0.0 );
  }
  vec4 ${yt}_(vec4 v) {
    return max( v, 0.0 );
  }
  `,name:yt,type:Y.FunctionType.ValueBased}}function ut(){const yt="sigmoid";return{body:`
  float ${yt}_(float a) {
    return 1.0 / (1.0 + exp(-a));
  }
  vec4 ${yt}_(vec4 v) {
    return 1.0 / (1.0 + exp(-v));
  }
  `,name:yt,type:Y.FunctionType.ValueBased}}function _t(){return Mt("sqrt")}function At(){return Mt("tan")}function Et(){const yt="tanh";return{body:`
  float ${yt}_(float a) {
    a = clamp(a, -10., 10.);
    a = exp(2.*a);
    return (a - 1.) / (a + 1.);
  }
  vec4 ${yt}_(vec4 v) {
    v = clamp(v, -10., 10.);
    v = exp(2.*v);
    return (v - 1.) / (v + 1.);
  }
  `,name:yt,type:Y.FunctionType.ValueBased}}function Mt(yt){return{body:`
  float ${yt}_(float a) {
    return ${yt}(a);
  }
  vec4 ${yt}_(vec4 v) {
    return ${yt}(v);
  }
  `,name:yt,type:Y.FunctionType.ValueBased}}a.glslAbs=xe,a.glslAcos=ne,a.glslAsin=te,a.glslAtan=f,a.glslCeil=d,a.glslCos=H,a.glslElu=Z,a.glslExp=Ye,a.glslFloor=et,a.glslClip=tt,a.glslIdentity=nt,a.glslLeakyRelu=it,a.glslLog=ot,a.glslNeg=st,a.glslNot=at,a.glslSin=ct,a.glslRelu=ft,a.glslSigmoid=ut,a.glslSqrt=_t,a.glslTan=At,a.glslTanh=Et;const Ot=(yt,St,Yt,Ft)=>{const ln=yt.session.pack?ee.TextureType.packed:ee.TextureType.unpacked,dn={name:Yt.name,inputTypes:[ln],inputNames:["A"],cacheHint:Ft};return Object.assign(Object.assign({},dn),{get:()=>((Pt,$t,hn,_n)=>{const On=Pt.session.pack?ee.TextureType.packed:ee.TextureType.unpacked,En=(0,R.getGlsl)(Pt.session.backend.glContext.version);return Object.assign(Object.assign({},$t),{output:{dims:hn.dims,type:hn.type,textureType:On},shaderSource:`
     ${_n.body}
     void main() {
       vec4 v = ${En.texture2D}(A, TexCoords);
       v = ${_n.name}_(v);
       ${En.output} = v;
     }
     `,hasMain:!0})})(yt,dn,St,Yt)})};a.abs=(yt,St)=>[yt.run(Ot(yt,St[0],xe()),St)],a.acos=(yt,St)=>[yt.run(Ot(yt,St[0],ne()),St)],a.asin=(yt,St)=>[yt.run(Ot(yt,St[0],te()),St)],a.atan=(yt,St)=>[yt.run(Ot(yt,St[0],f()),St)],a.clip=(yt,St,Yt)=>[yt.run(Ot(yt,St[0],tt(Yt.min,Yt.max),Yt.cacheKey),St)],a.parseClipAttributes=yt=>(0,A.createAttributeWithCacheKey)({min:yt.attributes.getFloat("min",O.MIN_CLIP),max:yt.attributes.getFloat("max",O.MAX_CLIP)}),a.clipV11=(yt,St)=>{const Yt=kt(yt,St);return(0,a.clip)(yt,[St[0]],Yt)};const kt=(yt,St)=>{if(St.length>=3&&(!yt.session.isInitializer(St[1].dataId)||!yt.session.isInitializer(St[2].dataId)))throw new Error("dynamic clip attributes are not allowed");const Yt=St.length>=3?St[1].numberData[0]:O.MIN_CLIP,Ft=St.length>=3?St[2].numberData[0]:O.MAX_CLIP;return(0,A.createAttributeWithCacheKey)({min:Yt,max:Ft})};a.ceil=(yt,St)=>[yt.run(Ot(yt,St[0],d()),St)],a.cos=(yt,St)=>[yt.run(Ot(yt,St[0],H()),St)],a.elu=(yt,St,Yt)=>[yt.run(Ot(yt,St[0],Z(Yt.alpha),Yt.cacheKey),St)],a.parseEluAttributes=yt=>(0,A.createAttributeWithCacheKey)({alpha:yt.attributes.getFloat("alpha",1)}),a.exp=(yt,St)=>[yt.run(Ot(yt,St[0],Ye()),St)],a.floor=(yt,St)=>[yt.run(Ot(yt,St[0],et()),St)],a.identity=(yt,St)=>[yt.run(Ot(yt,St[0],nt()),St)],a.leakyRelu=(yt,St,Yt)=>[yt.run(Ot(yt,St[0],it(Yt.alpha),Yt.cacheKey),St)],a.parseLeakyReluAttributes=yt=>(0,A.createAttributeWithCacheKey)({alpha:yt.attributes.getFloat("alpha",.01)}),a.log=(yt,St)=>[yt.run(Ot(yt,St[0],ot()),St)],a.neg=(yt,St)=>[yt.run(Ot(yt,St[0],st()),St)],a.not=(yt,St)=>[yt.run(Ot(yt,St[0],at()),St)],a.relu=(yt,St)=>[yt.run(Ot(yt,St[0],ft()),St)],a.sigmoid=(yt,St)=>[yt.run(Ot(yt,St[0],ut()),St)],a.sin=(yt,St)=>[yt.run(Ot(yt,St[0],ct()),St)],a.sqrt=(yt,St)=>[yt.run(Ot(yt,St[0],_t()),St)],a.tan=(yt,St)=>[yt.run(Ot(yt,St[0],At()),St)],a.tanh=(yt,St)=>[yt.run(Ot(yt,St[0],Et()),St)]},5611:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createUnpackProgramInfoLoader=a.createUnpackProgramInfo=void 0;const A=l(5060),O=l(2039),Y=l(9390),R=l(2827),ee={name:"unpack",inputNames:["A"],inputTypes:[O.TextureType.packed]};a.createUnpackProgramInfo=(xe,ne)=>{const te=ne.dims.length,f=(0,R.getChannels)("rc",te),d=f.slice(-2),H=(0,Y.getCoordsDataType)(te),Z=(0,R.unpackFromChannel)(),Ye=ne.dims.length===0?"":(function(nt,it){if(nt===1)return"rc";let ot="";for(let st=0;st<nt;st++)ot+=it[st],st<nt-1&&(ot+=",");return ot})(te,f),et=te<=1?"rc":`vec2(${d.join(",")})`,tt=`
    ${Z}
    void main() {
      ${H} rc = getOutputCoords();

       // Sample the texture with the coords to get the rgba channel value.
       vec4 packedInput = getA(${Ye});

       ${(0,A.getGlsl)(xe.session.backend.glContext.version).output} = vec4(getChannel(packedInput, ${et}), 0, 0, 0);
     }
   `;return Object.assign(Object.assign({},ee),{hasMain:!0,output:{dims:ne.dims,type:ne.type,textureType:O.TextureType.unpacked},shaderSource:tt})},a.createUnpackProgramInfoLoader=(xe,ne)=>Object.assign(Object.assign({},ee),{get:()=>(0,a.createUnpackProgramInfo)(xe,ne)})},8428:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.parseUnsqueezeAttributes=a.unsqueezeV13=a.unsqueeze=void 0;const A=l(2517);a.unsqueeze=(R,ee,xe)=>{O(ee);const ne=A.ShapeUtil.unsqueezeShape(ee[0].dims,xe);return[R.reshapeUnpacked(ee[0],ne)]},a.unsqueezeV13=(R,ee)=>(Y(ee),(0,a.unsqueeze)(R,[ee[0]],Array.from(ee[1].integerData))),a.parseUnsqueezeAttributes=R=>R.attributes.getInts("axes");const O=R=>{if(!R||R.length!==1)throw new Error("Unsqueeze requires 1 input.");if(R[0].type==="string")throw new Error("invalid input tensor types.")},Y=R=>{if(!R||R.length!==2)throw new Error("Unsqueeze requires 2 inputs.");if(R[1].type!=="int32")throw new Error("Invalid input type.")}},9793:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.scalesValidation=a.validateInputs=a.parseUpsampleAttributes=a.parseUpsampleAttributesV9=a.parseUpsampleAttributesV7=a.upsample=void 0;const A=l(246),O=l(5060),Y=l(2039),R={name:"Upsample",inputNames:["X"],inputTypes:[Y.TextureType.unpacked]};a.upsample=(xe,ne,te)=>((0,a.validateInputs)(ne,te),[xe.run(Object.assign(Object.assign({},R),{cacheHint:te.cacheKey,get:()=>ee(xe,ne,te)}),ne)]),a.parseUpsampleAttributesV7=xe=>(0,a.parseUpsampleAttributes)(xe,7),a.parseUpsampleAttributesV9=xe=>(0,a.parseUpsampleAttributes)(xe,9),a.parseUpsampleAttributes=(xe,ne)=>{const te=ne>=10,f=xe.attributes.getString("mode","nearest");if(f!=="nearest"&&f!=="linear"&&(ne<11||f!=="cubic"))throw new Error(`unrecognized mode: ${f}`);let d=[];ne<9&&(d=xe.attributes.getFloats("scales"),(0,a.scalesValidation)(d,f,te));const H=xe.attributes.getFloat("extrapolation_value",0),Z=ne>10?xe.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(Z)===-1)throw new Error(`coordinate_transform_mode '${Z}' is not supported`);const Ye=Z==="tf_crop_and_resize",et=Ye,tt=f==="nearest"&&ne>=11?xe.attributes.getString("nearest_mode","round_prefer_floor"):"";if(["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(tt)===-1)throw new Error(`nearest_mode '${tt}' is not supported`);const nt=xe.attributes.getFloat("cubic_coeff_a",-.75),it=xe.attributes.getInt("exclude_outside",0)!==0;if(it&&f!=="cubic")throw new Error("exclude_outside can be set to 1 only when mode is CUBIC.");const ot=ne<11||f==="nearest"&&Z==="asymmetric"&&tt==="floor";let st=0,at=0,ct=0;return ne>10?xe.inputs.length>2?(st=1,at=2,ct=3):(at=1,ct=2):ne===9&&(at=1),(0,A.createAttributeWithCacheKey)({opset:ne,isResize:te,mode:f,scales:d,extrapolationValue:H,coordinateTransformMode:Z,useExtrapolation:et,needRoiInput:Ye,nearestMode:tt,cubicCoefficientA:nt,excludeOutside:it,useNearest2xOptimization:ot,roiInputIdx:st,scalesInputIdx:at,sizesInputIdx:ct})};const ee=(xe,ne,te)=>{const f=(0,O.getGlsl)(xe.session.backend.glContext.version),[d,H]=xe.calculateTextureWidthAndHeight(ne[0].dims,Y.TextureType.unpacked),Z=ne[0].dims.map(((ct,ft)=>Math.floor(ct*te.scales[ft]))),[Ye,et]=xe.calculateTextureWidthAndHeight(Z,Y.TextureType.unpacked),tt=Z.length,nt=new Array(tt),it=new Array(tt);let ot=`
      int output_pitches[${tt}];
      int input_pitches[${tt}];
      `;for(let ct=tt-1;ct>=0;ct--)nt[ct]=ct===tt-1?1:nt[ct+1]*Z[ct+1],it[ct]=ct===tt-1?1:it[ct+1]*ne[0].dims[ct+1],ot+=`
        output_pitches[${ct}] = ${nt[ct]};
        input_pitches[${ct}] = ${it[ct]};
        `;const st=`
      float getInputFloat(int index) {
        vec2 coords = offsetToCoords(index, ${d}, ${H});
        float value = getColorAsFloat(${f.texture2D}(X, coords));
        return value;
      }
      `,at=te.mode==="nearest"?`
    ${st}
    float process(int indices[${tt}]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${Ye}, ${et});

      ${ot}

      int d, m;
      for (int dim = 0; dim < ${tt}; ++dim) {
        d = output_index / output_pitches[dim];
        m = output_index - d * output_pitches[dim];
        output_index = m;

        if (scales[dim] != 1 && d > 0) {
          int d2 = d / scales[dim];
          m = d - d2 * scales[dim];
          d = d2;
        }
        input_index += input_pitches[dim] * d;
      }

      return getInputFloat(input_index);
    }`:tt===4?`
    ${st}
    float process(int indices[4]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${Ye}, ${et});

      ${ot}

      int m;
      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m / output_pitches[1];
      m = m - index_of_dim1 * output_pitches[1];
      index_of_dim2 = m / output_pitches[2];
      m = m - index_of_dim2 * output_pitches[2];
      index_of_dim3 = m;

      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;
      index_of_input_dim2 = index_of_dim2 / scales[2];
      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];
      index_of_input_dim3 = index_of_dim3 / scales[3];
      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];

      input_index = index_of_dim0 * input_pitches[0] +
            index_of_dim1 * input_pitches[1] +
            index_of_input_dim2 * input_pitches[2] +
            index_of_input_dim3;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim2 = false;
      if (index_of_input_dim2 == (${ne[0].dims[2]} - 1)) {
        // It's the end in dimension 2
        x01 = x00;
        end_of_dim2 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[2]);
      }

      if (index_of_input_dim3 == (input_pitches[2] - 1)) {
        // It's the end in dimension 3
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);
    }`:`
    ${st}
    float process(int indices[2]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${Ye}, ${et});

      ${ot}

      int m;
      int index_of_dim0, index_of_dim1;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m;

      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;
      index_of_input_dim0 = index_of_dim0 / scales[0];
      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];
      index_of_input_dim1 = index_of_dim1 / scales[1];
      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];

      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim0 = false;
      if (index_of_input_dim0 == (${ne[0].dims[0]} - 1)) {
        // It's the end in dimension 0
        x01 = x00;
        end_of_dim0 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[0]);
      }

      if (index_of_input_dim1 == (input_pitches[0] - 1)) {
        // It's the end in dimension 1
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);
    }`;return Object.assign(Object.assign({},R),{output:{dims:Z,type:ne[0].type,textureType:Y.TextureType.unpacked},shaderSource:at,variables:[{name:"scales",type:"int",arrayLength:te.scales.length,data:te.scales.map((ct=>Math.ceil(ct)))}]})};a.validateInputs=(xe,ne)=>{if(!xe||ne.opset<9&&xe.length!==1||ne.opset>=9&&ne.opset<11&&xe.length!==2||ne.opset>=11&&xe.length<2)throw new Error("invalid inputs.");if(ne.scales.length>0&&xe[0].dims.length!==ne.scales.length)throw new Error("Invalid input shape.");if(xe[0].type==="string")throw new Error("Invalid input tensor types.")},a.scalesValidation=(xe,ne,te)=>{if(te){for(const f of xe)if(f<=0)throw new Error("Scale value should be greater than 0.")}else for(const f of xe)if(f<1)throw new Error("Scale value should be greater than or equal to 1.");if(!(ne!=="linear"&&ne!=="cubic"||xe.length===2||xe.length===4&&xe[0]===1&&xe[1]===1))throw new Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${te?"Resize":"Upsample"} opeartor.`)}},1958:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ProgramManager=void 0;const A=l(1670),O=l(6231),Y=l(8879),R=l(5060);a.ProgramManager=class{constructor(ee,xe,ne){this.profiler=ee,this.glContext=xe,this.textureLayoutStrategy=ne,this.repo=new Map,this.attributesBound=!1}getArtifact(ee){return this.repo.get(ee)}setArtifact(ee,xe){this.repo.set(ee,xe)}run(ee,xe,ne){var te;this.profiler.event("op",`ProgramManager.run ${(te=ee.programInfo.name)!==null&&te!==void 0?te:"unknown kernel"}`,(()=>{var f;const d=this.glContext.gl,H=ee.program;d.useProgram(H);try{this.bindOutput(ne),this.attributesBound||this.bindAttributes(ee.attribLocations),this.bindUniforms(ee.uniformLocations,(f=ee.programInfo.variables)!==null&&f!==void 0?f:[],xe)}catch(Z){throw O.Logger.error("ProgramManager",ee.programInfo.shaderSource),Z}this.profiler.event("backend","GlContext.draw()",(()=>{this.glContext.draw()}))}),this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach((ee=>this.glContext.deleteProgram(ee.program)))}build(ee,xe,ne){return this.profiler.event("backend","ProgramManager.build",(()=>{const te=new Y.GlslPreprocessor(this.glContext,ee,xe,ne),f=te.preprocess(),d=this.compile(f);return{programInfo:ee,program:d,uniformLocations:this.getUniformLocations(d,te.context.programInfo.inputNames,te.context.programInfo.variables),attribLocations:this.getAttribLocations(d)}}))}compile(ee){if(!this.vertexShader){O.Logger.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");const te=(0,R.getVertexShaderSource)(this.glContext.version);this.vertexShader=this.glContext.compileShader(te,this.glContext.gl.VERTEX_SHADER)}A.env.debug&&O.Logger.verbose("ProrgramManager",`FragShader:
${ee}
`);const xe=this.glContext.compileShader(ee,this.glContext.gl.FRAGMENT_SHADER),ne=this.glContext.createProgram(this.vertexShader,xe);return this.glContext.deleteShader(xe),ne}bindOutput(ee){const xe=ee.width,ne=ee.height;O.Logger.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${xe}/${ne}, shape=${ee.shape}, type=${ee.tensor.type}`),this.glContext.attachFramebuffer(ee.texture,xe,ne)}bindAttributes(ee){const xe=ee.position,ne=ee.textureCoord;this.glContext.setVertexAttributes(xe,ne),this.attributesBound=!0}bindUniforms(ee,xe,ne){var te;const f=this.glContext.gl;let d=0;for(const{name:H,type:Z,location:Ye,arrayLength:et}of ee){const tt=(te=xe.find((nt=>nt.name===H)))===null||te===void 0?void 0:te.data;if(Z!=="sampler2D"&&!tt)throw new Error(`variable '${H}' does not have data defined in program info`);switch(Z){case"sampler2D":this.bindTexture(ne[d],Ye,d),d++;break;case"float":et?f.uniform1fv(Ye,tt):f.uniform1f(Ye,tt);break;case"int":et?f.uniform1iv(Ye,tt):f.uniform1i(Ye,tt);break;default:throw new Error(`Uniform not implemented: ${Z}`)}}}bindTexture(ee,xe,ne){this.glContext.bindTextureToUniform(ee.texture,ne,xe)}getAttribLocations(ee){return{position:this.getAttribLocation(ee,"position"),textureCoord:this.getAttribLocation(ee,"textureCoord")}}getUniformLocations(ee,xe,ne){const te=[];if(xe)for(const f of xe)te.push({name:f,type:"sampler2D",location:this.getUniformLocation(ee,f)});if(ne)for(const f of ne)te.push(Object.assign(Object.assign({},f),{location:this.getUniformLocation(ee,f.name)}));return te}getUniformLocation(ee,xe){const ne=this.glContext.gl.getUniformLocation(ee,xe);if(ne===null)throw new Error(`Uniform ${xe} not found.`);return ne}getAttribLocation(ee,xe){return this.glContext.gl.getAttribLocation(ee,xe)}}},6416:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.WebGLSessionHandler=void 0;const A=l(6231),O=l(1047),Y=l(8316),R=l(1640),ee=l(1958),xe=l(7859),ne=l(5702);a.WebGLSessionHandler=class{constructor(te,f){this.backend=te,this.context=f,this.layoutStrategy=new xe.PreferLogicalStrategy(te.glContext.maxTextureSize),this.programManager=new ee.ProgramManager(this.context.profiler,te.glContext,this.layoutStrategy),this.textureManager=new ne.TextureManager(te.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:te.textureCacheMode==="full"}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=te.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new Y.WebGLInferenceHandler(this)}onGraphInitialized(te){const f=te.getValues().filter((d=>d.from===-1&&d.tensor)).map((d=>d.tensor.dataId));this.initializers=new Set(f)}isInitializer(te){return!!this.initializers&&this.initializers.has(te)}addInitializer(te){this.initializers.add(te)}getTextureData(te,f){return f?this.packedTextureDataCache.get(te):this.unpackedTextureDataCache.get(te)}setTextureData(te,f,d=!1){A.Logger.verbose("WebGLSessionHandler","Storing Texture data in cache"),d?this.packedTextureDataCache.set(te,f):this.unpackedTextureDataCache.set(te,f)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((te=>this.textureManager.releaseTexture(te,!0))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((te=>this.textureManager.releaseTexture(te,!0))),this.unpackedTextureDataCache=new Map}resolve(te,f,d){const H=(0,O.resolveOperator)(te,f,R.WEBGL_OP_RESOLVE_RULES);return{impl:H.opImpl,context:H.opInit?H.opInit(te,d):te}}}},7769:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Uint8DataEncoder=a.RGBAFloatDataEncoder=a.RedFloat32DataEncoder=void 0;const A=l(6231);a.RedFloat32DataEncoder=class{constructor(O,Y=1){if(Y===1)this.internalFormat=O.R32F,this.format=O.RED,this.textureType=O.FLOAT,this.channelSize=Y;else{if(Y!==4)throw new Error(`Invalid number of channels: ${Y}`);this.internalFormat=O.RGBA32F,this.format=O.RGBA,this.textureType=O.FLOAT,this.channelSize=Y}}encode(O,Y){let R,ee;return O.constructor!==Float32Array&&(A.Logger.warning("Encoder","data was not of type Float32; creating new Float32Array"),ee=new Float32Array(O)),Y*this.channelSize>O.length?(A.Logger.warning("Encoder","Source data too small. Allocating larger array"),ee=O,R=this.allocate(Y*this.channelSize),ee.forEach(((xe,ne)=>R[ne]=xe))):(ee=O,R=ee),R}allocate(O){return new Float32Array(4*O)}decode(O,Y){return this.channelSize===1?O.filter(((R,ee)=>ee%4==0)).subarray(0,Y):O.subarray(0,Y)}},a.RGBAFloatDataEncoder=class{constructor(O,Y=1,R){if(Y!==1&&Y!==4)throw new Error(`Invalid number of channels: ${Y}`);this.internalFormat=O.RGBA,this.format=O.RGBA,this.channelSize=Y,this.textureType=R||O.FLOAT}encode(O,Y){let R=O;return this.channelSize===1&&(A.Logger.verbose("Encoder","Exploding into a larger array"),R=this.allocate(Y),O.forEach(((ee,xe)=>R[4*xe]=ee))),R}allocate(O){return new Float32Array(4*O)}decode(O,Y){return this.channelSize===1?O.filter(((R,ee)=>ee%4==0)).subarray(0,Y):O.subarray(0,Y)}},a.Uint8DataEncoder=class{constructor(O,Y=1){if(this.channelSize=4,Y===1)this.internalFormat=O.ALPHA,this.format=O.ALPHA,this.textureType=O.UNSIGNED_BYTE,this.channelSize=Y;else{if(Y!==4)throw new Error(`Invalid number of channels: ${Y}`);this.internalFormat=O.RGBA,this.format=O.RGBA,this.textureType=O.UNSIGNED_BYTE,this.channelSize=Y}}encode(O,Y){return new Uint8Array(O.buffer,O.byteOffset,O.byteLength)}allocate(O){return new Uint8Array(O*this.channelSize)}decode(O,Y){if(O instanceof Uint8Array)return O.subarray(0,Y);throw new Error(`Invalid array type: ${O.constructor}`)}}},7859:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.getBatchDim=a.sizeToSquarishShape=a.getRowsCols=a.sizeFromShape=a.isInt=a.parseAxisParam=a.squeezeShape=a.PreferLogicalStrategy=a.AlwaysKeepOriginalSizeStrategy=void 0;const A=l(6231),O=l(2517);function Y(te,f){const d=[],H=[],Z=f!=null&&Array.isArray(f)&&f.length===0,Ye=f==null||Z?null:R(f,te).sort();let et=0;for(let tt=0;tt<te.length;++tt){if(Ye!=null){if(Ye[et]===tt&&te[tt]!==1)throw new Error(`Can't squeeze axis ${tt} since its dim '${te[tt]}' is not 1`);(Ye[et]==null||Ye[et]>tt)&&te[tt]===1&&(d.push(te[tt]),H.push(tt)),Ye[et]<=tt&&et++}te[tt]!==1&&(d.push(te[tt]),H.push(tt))}return{newShape:d,keptDims:H}}function R(te,f){const d=f.length;return te=te==null?f.map(((H,Z)=>Z)):[].concat(te),(0,O.assert)(te.every((H=>H>=-d&&H<d)),(()=>`All values in axis param must be in range [-${d}, ${d}) but got axis ${te}`)),(0,O.assert)(te.every(ee),(()=>`All values in axis param must be integers but got axis ${te}`)),te.map((H=>H<0?d+H:H))}function ee(te){return te%1==0}function xe(te){if(te.length===0)return 1;let f=te[0];for(let d=1;d<te.length;d++)f*=te[d];return f}function ne(te){const f=Math.ceil(Math.sqrt(te));return[f,Math.ceil(te/f)]}a.AlwaysKeepOriginalSizeStrategy=class{constructor(te){this.maxTextureSize=te}computeTextureWH(te,f){if(te.length===0)return[1,1];const d=this.maxTextureSize;if(f&&f.breakAxis!==void 0){const Ye=f.breakAxis>=te.length?1:te.slice(f.breakAxis).reduce(((tt,nt)=>tt*nt)),et=f.breakAxis<=0?1:te.slice(0,f.breakAxis).reduce(((tt,nt)=>tt*nt));if(!(Ye>d||et>d))return[Ye,et];A.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${te}, breakAxis:${f.breakAxis}`)}const H=te.reduce(((Ye,et)=>Ye*et));let Z=Math.floor(Math.sqrt(H));for(;Z<d&&Z<H&&H%Z!=0;Z++);if(Z>=d||H%Z!=0)throw new Error(`The given dimensions are outside this GPU's boundaries: ${te}`);return[Z,H/Z]}},a.PreferLogicalStrategy=class{constructor(te){this.maxTextureSize=te}computeTextureWH(te,f){const d=this.computeTexture(te,f);return f&&f.isPacked&&(d[0]/=2,d[1]/=2),f&&f.reverseWH?[d[1],d[0]]:d}computeTexture(te,f){const d=f&&f.isPacked;if(te.length===0)return d?[2,2]:[1,1];let H=this.maxTextureSize;if(f&&f.breakAxis!==void 0){const et=f.breakAxis>=te.length?1:te.slice(f.breakAxis).reduce(((nt,it)=>nt*it)),tt=f.breakAxis<=0?1:te.slice(0,f.breakAxis).reduce(((nt,it)=>nt*it));if(!(et>H||tt>H))return[et,tt];A.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${te}, breakAxis:${f.breakAxis}`)}let Z=te.slice(0);d&&(H*=2,Z=Z.map(((et,tt)=>tt>=Z.length-2?Z[tt]%2==0?Z[tt]:Z[tt]+1:Z[tt])),Z.length===1&&(Z=[2,Z[0]])),Z.length!==2&&(Z=Y(Z).newShape);const Ye=xe(Z);return Z.length<=1&&Ye<=H?[1,Ye]:Z.length===2&&Z[0]<=H&&Z[1]<=H?Z:Z.length===3&&Z[0]*Z[1]<=H&&Z[2]<=H?[Z[0]*Z[1],Z[2]]:Z.length===3&&Z[0]<=H&&Z[1]*Z[2]<=H?[Z[0],Z[1]*Z[2]]:Z.length===4&&Z[0]*Z[1]*Z[2]<=H&&Z[3]<=H?[Z[0]*Z[1]*Z[2],Z[3]]:Z.length===4&&Z[0]<=H&&Z[1]*Z[2]*Z[3]<=H?[Z[0],Z[1]*Z[2]*Z[3]]:d?ne(Ye/4).map((et=>2*et)):ne(Ye)}},a.squeezeShape=Y,a.parseAxisParam=R,a.isInt=ee,a.sizeFromShape=xe,a.getRowsCols=function(te){if(te.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[te.length>1?te[te.length-2]:1,te[te.length-1]]},a.sizeToSquarishShape=ne,a.getBatchDim=function(te,f=2){return xe(te.slice(0,te.length-f))}},4057:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createTextureLayoutFromShape=a.calculateTextureWidthAndHeight=a.createTextureLayoutFromTextureType=void 0;const A=l(2517),O=l(2039);a.createTextureLayoutFromTextureType=(Y,R,ee)=>{const xe=ee===O.TextureType.unpacked||ee===O.TextureType.unpackedReversed?1:4,ne=ee===O.TextureType.packed,te=ee===O.TextureType.unpackedReversed||ee===O.TextureType.packed,f=ee===O.TextureType.packedLastDimension?R.length-1:void 0,d=ee===O.TextureType.packedLastDimension?R.map(((H,Z)=>Z===R.length-1?4*H:H)):void 0;return(0,a.createTextureLayoutFromShape)(Y,R,xe,d,{isPacked:ne,reverseWH:te,breakAxis:f})},a.calculateTextureWidthAndHeight=(Y,R,ee)=>{const xe=(0,a.createTextureLayoutFromTextureType)(Y,R,ee);return[xe.width,xe.height]},a.createTextureLayoutFromShape=(Y,R,ee=1,xe,ne)=>{const te=!(!ne||!ne.isPacked),[f,d]=Y.computeTextureWH(te&&xe||R,ne),H=R.length;let Z=R.slice(0);if(H===0&&(Z=[1]),ee===1)xe=R;else if(te){if(ee!==4)throw new Error("a packed texture must be 4-channel");xe=R,H>0&&(Z[H-1]=Math.ceil(Z[H-1]/2)),H>1&&(Z[H-2]=Math.ceil(Z[H-2]/2))}else if(!xe)throw new Error("Unpacked shape is needed when using channels > 1");return{width:f,height:d,channels:ee,isPacked:te,shape:Z,strides:A.ShapeUtil.computeStrides(Z),unpackedShape:xe,reversedWH:ne&&ne.reverseWH}}},5702:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.TextureManager=void 0;const A=l(6231);a.TextureManager=class{constructor(O,Y,R,ee){this.glContext=O,this.layoutStrategy=Y,this.profiler=R,this.config=ee,this.pendingRead=new Map,ee.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(O,Y,R,ee){const xe=this.toEncoderType(O),ne=this.glContext.getEncoder(xe,Y.channels||1,ee);if(Y.isPacked&&ee===1)throw new Error("not implemented");const te=Y.width,f=Y.height;let d,H;if(this.config.reuseTextures){d=`${te}x${f}_${ne.format}_${ne.internalFormat}_${ne.textureType}`,H=this.inUseTextures.get(d),H||(H=[],this.inUseTextures.set(d,H));const Ye=this.idleTextures.get(d);if(Ye&&Ye.length>0){const et=Ye.pop();return H.push(et),ee===1&&this.glContext.updateTexture(et,te,f,ne,this.toTextureData(O,R)),et}}A.Logger.verbose("TextureManager",`Creating new texture of size ${Y.width}x${Y.height}`);const Z=this.glContext.allocateTexture(te,f,ne,this.toTextureData(O,R));return this.config.reuseTextures&&(H.push(Z),this.textureLookup.set(Z,d)),Z}readTexture(O,Y,R){return R||(R=1),this.profiler.event("backend","TextureManager.readTexture",(()=>{const ee=O.shape.reduce(((ne,te)=>ne*te))*R,xe=this.glContext.readTexture(O.texture,O.width,O.height,ee,this.toEncoderType(Y),R);return this.toTensorData(Y,xe)}))}async readTextureAsync(O,Y,R){const ee=O.tensor.dataId;if(R||(R=1),this.pendingRead.has(ee)){const xe=this.pendingRead.get(ee);return new Promise((ne=>xe?.push(ne)))}return this.profiler.event("backend","TextureManager.readTextureAsync",(async()=>{this.pendingRead.set(ee,[]);const xe=O.shape.reduce(((d,H)=>d*H))*R;await this.glContext.createAndWaitForFence();const ne=this.glContext.readTexture(O.texture,O.width,O.height,xe,this.toEncoderType(Y),R),te=this.toTensorData(Y,ne),f=this.pendingRead.get(ee);return this.pendingRead.delete(ee),f?.forEach((d=>d(te))),te}))}readUint8TextureAsFloat(O){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",(()=>{const Y=O.shape.reduce(((ee,xe)=>ee*xe)),R=this.glContext.readTexture(O.texture,O.width,O.height,4*Y,"byte",4);return new Float32Array(R.buffer,R.byteOffset,Y)}))}releaseTexture(O,Y){let R;if(this.config.reuseTextures&&(R=this.textureLookup.get(O.texture),R)){Y&&this.textureLookup.delete(R);const ee=this.inUseTextures.get(R);if(ee){const xe=ee.indexOf(O.texture);if(xe!==-1){ee.splice(xe,1);let ne=this.idleTextures.get(R);ne||(ne=[],this.idleTextures.set(R,ne)),ne.push(O.texture)}}}R&&!Y||(A.Logger.verbose("TextureManager",`Deleting texture of size ${O.width}x${O.height}`),this.glContext.deleteTexture(O.texture))}toTensorData(O,Y){switch(O){case"int16":return Y instanceof Int16Array?Y:Int16Array.from(Y);case"int32":return Y instanceof Int32Array?Y:Int32Array.from(Y);case"int8":return Y instanceof Int8Array?Y:Int8Array.from(Y);case"uint16":return Y instanceof Uint16Array?Y:Uint16Array.from(Y);case"uint32":return Y instanceof Uint32Array?Y:Uint32Array.from(Y);case"uint8":case"bool":return Y instanceof Uint8Array?Y:Uint8Array.from(Y);case"float32":return Y instanceof Float32Array?Y:Float32Array.from(Y);case"float64":return Y instanceof Float64Array?Y:Float64Array.from(Y);default:throw new Error(`TensorData type ${O} is not supported`)}}toTextureData(O,Y){if(Y)return Y instanceof Float32Array?Y:new Float32Array(Y)}toEncoderType(O){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}},2039:(g,a)=>{var l;Object.defineProperty(a,"__esModule",{value:!0}),a.TextureType=void 0,(l=a.TextureType||(a.TextureType={}))[l.unpacked=0]="unpacked",l[l.unpackedReversed=1]="unpackedReversed",l[l.packed=2]="packed",l[l.downloadUint8AsFloat=3]="downloadUint8AsFloat",l[l.packedLastDimension=4]="packedLastDimension"},9390:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.getGlChannels=a.getCoordsDataType=a.getSqueezedParams=a.squeezeInputShape=a.generateShaderFuncNameFromInputSamplerNameAtOutCoords=a.generateShaderFuncNameFromInputSamplerName=a.repeatedTry=a.getPackedShape=void 0;const A=l(2517);a.getPackedShape=function(O){const Y=O.length;return O.slice(0,Y-1).concat(O[Y-1]/4)},a.repeatedTry=async function(O,Y=(ee=>0),R){return new Promise(((ee,xe)=>{let ne=0;const te=()=>{if(O())return void ee();ne++;const f=Y(ne);R!=null&&ne>=R?xe():setTimeout(te,f)};te()}))},a.generateShaderFuncNameFromInputSamplerName=function(O){return(0,A.assert)(O!==void 0&&O.length!==0,(()=>"empty string found for sampler name")),"get"+O.charAt(0).toUpperCase()+O.slice(1)},a.generateShaderFuncNameFromInputSamplerNameAtOutCoords=function(O){return(0,A.assert)(O!==void 0&&O.length!==0,(()=>"empty string found for sampler name")),"get"+O.charAt(0).toUpperCase()+O.slice(1)+"AtOutCoords"},a.squeezeInputShape=function(O,Y){let R=JSON.parse(JSON.stringify(O));return R=Y,R},a.getSqueezedParams=function(O,Y){return Y.map((R=>O[R])).join(", ")},a.getCoordsDataType=function(O){if(O<=1)return"int";if(O===2)return"ivec2";if(O===3)return"ivec3";if(O===4)return"ivec4";if(O===5)return"ivec5";if(O===6)return"ivec6";throw Error(`GPU for rank ${O} is not yet supported`)},a.getGlChannels=function(O=6){return["x","y","z","w","u","v"].slice(0,O)}},7305:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createNewWebGLContext=a.createWebGLContext=void 0;const A=l(6231),O=l(1713),Y={};function R(ee){const xe=(function(){if(typeof document>"u"){if(typeof OffscreenCanvas>"u")throw new TypeError("failed to create canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}const f=document.createElement("canvas");return f.width=1,f.height=1,f})();let ne;const te={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1};if((!ee||ee==="webgl2")&&(ne=xe.getContext("webgl2",te),ne))try{return new O.WebGLContext(ne,2)}catch(f){A.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${f}`)}if((!ee||ee==="webgl")&&(ne=xe.getContext("webgl",te)||xe.getContext("experimental-webgl",te),ne))try{return new O.WebGLContext(ne,1)}catch(f){A.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${f}`)}throw new Error("WebGL is not supported")}a.createWebGLContext=function ee(xe){let ne;xe&&xe!=="webgl2"||!("webgl2"in Y)?xe&&xe!=="webgl"||!("webgl"in Y)||(ne=Y.webgl):ne=Y.webgl2,ne=ne||R(xe),xe=xe||ne.version===1?"webgl":"webgl2";const te=ne.gl;return Y[xe]=ne,te.isContextLost()?(delete Y[xe],ee(xe)):(te.disable(te.DEPTH_TEST),te.disable(te.STENCIL_TEST),te.disable(te.BLEND),te.disable(te.DITHER),te.disable(te.POLYGON_OFFSET_FILL),te.disable(te.SAMPLE_COVERAGE),te.enable(te.SCISSOR_TEST),te.enable(te.CULL_FACE),te.cullFace(te.BACK),ne)},a.createNewWebGLContext=R},1713:function(g,a,l){var A=this&&this.__createBinding||(Object.create?function(te,f,d,H){H===void 0&&(H=d);var Z=Object.getOwnPropertyDescriptor(f,d);Z&&!("get"in Z?!f.__esModule:Z.writable||Z.configurable)||(Z={enumerable:!0,get:function(){return f[d]}}),Object.defineProperty(te,H,Z)}:function(te,f,d,H){H===void 0&&(H=d),te[H]=f[d]}),O=this&&this.__setModuleDefault||(Object.create?function(te,f){Object.defineProperty(te,"default",{enumerable:!0,value:f})}:function(te,f){te.default=f}),Y=this&&this.__importStar||function(te){if(te&&te.__esModule)return te;var f={};if(te!=null)for(var d in te)d!=="default"&&Object.prototype.hasOwnProperty.call(te,d)&&A(f,te,d);return O(f,te),f};Object.defineProperty(a,"__esModule",{value:!0}),a.WebGLContext=a.linearSearchLastTrue=void 0;const R=l(1670),ee=Y(l(7769)),xe=l(9390);function ne(te){let f=0;for(;f<te.length&&te[f]();++f);return f-1}a.linearSearchLastTrue=ne,a.WebGLContext=class{constructor(te,f){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=te,this.version=f,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(te,f,d,H){const Z=this.gl,Ye=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,Ye),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.NEAREST),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.NEAREST),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE);const et=H?d.encode(H,te*f):null;return Z.texImage2D(Z.TEXTURE_2D,0,d.internalFormat,te,f,0,d.format,d.textureType,et),this.checkError(),Ye}updateTexture(te,f,d,H,Z){const Ye=this.gl;Ye.bindTexture(Ye.TEXTURE_2D,te);const et=H.encode(Z,f*d);Ye.texSubImage2D(Ye.TEXTURE_2D,0,0,0,f,d,H.format,H.textureType,et),this.checkError()}attachFramebuffer(te,f,d){const H=this.gl;H.bindTexture(H.TEXTURE_2D,te),H.bindFramebuffer(H.FRAMEBUFFER,this.framebuffer),H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_2D,te,0),this.checkError(),H.viewport(0,0,f,d),H.scissor(0,0,f,d)}readTexture(te,f,d,H,Z,Ye){const et=this.gl;Ye||(Ye=1),this.frameBufferBound||this.attachFramebuffer(te,f,d);const tt=this.getEncoder(Z,Ye),nt=tt.allocate(f*d);return et.bindTexture(et.TEXTURE_2D,te),et.framebufferTexture2D(et.FRAMEBUFFER,et.COLOR_ATTACHMENT0,et.TEXTURE_2D,te,0),et.readPixels(0,0,f,d,et.RGBA,tt.textureType,nt),this.checkError(),tt.decode(nt,H)}isFramebufferReady(){return!0}getActiveTexture(){const te=this.gl;return"TEXTURE"+(te.getParameter(this.gl.ACTIVE_TEXTURE)-te.TEXTURE0)}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(te,f){const d=this.gl;d.vertexAttribPointer(te,3,d.FLOAT,!1,20,0),d.enableVertexAttribArray(te),f!==-1&&(d.vertexAttribPointer(f,2,d.FLOAT,!1,20,12),d.enableVertexAttribArray(f)),this.checkError()}createProgram(te,f){const d=this.gl,H=d.createProgram();return d.attachShader(H,te),d.attachShader(H,f),d.linkProgram(H),H}compileShader(te,f){const d=this.gl,H=d.createShader(f);if(!H)throw new Error(`createShader() returned null with type ${f}`);if(d.shaderSource(H,te),d.compileShader(H),d.getShaderParameter(H,d.COMPILE_STATUS)===!1)throw new Error(`Failed to compile shader: ${d.getShaderInfoLog(H)}
Shader source:
${te}`);return H}deleteShader(te){this.gl.deleteShader(te)}bindTextureToUniform(te,f,d){const H=this.gl;H.activeTexture(H.TEXTURE0+f),this.checkError(),H.bindTexture(H.TEXTURE_2D,te),this.checkError(),H.uniform1i(d,f),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if(R.env.debug){const te=this.gl,f=te.getError();let d="";switch(f){case te.NO_ERROR:return;case te.INVALID_ENUM:d="INVALID_ENUM";break;case te.INVALID_VALUE:d="INVALID_VALUE";break;case te.INVALID_OPERATION:d="INVALID_OPERATION";break;case te.INVALID_FRAMEBUFFER_OPERATION:d="INVALID_FRAMEBUFFER_OPERATION";break;case te.OUT_OF_MEMORY:d="OUT_OF_MEMORY";break;case te.CONTEXT_LOST_WEBGL:d="CONTEXT_LOST_WEBGL";break;default:d=`Unknown WebGL Error: ${f.toString(16)}`}throw new Error(d)}}deleteTexture(te){this.gl.deleteTexture(te)}deleteProgram(te){this.gl.deleteProgram(te)}getEncoder(te,f,d=0){if(this.version===2)return new ee.RedFloat32DataEncoder(this.gl,f);switch(te){case"float":return d===1||this.isRenderFloat32Supported?new ee.RGBAFloatDataEncoder(this.gl,f):new ee.RGBAFloatDataEncoder(this.gl,f,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw new Error("not implemented");case"byte":return new ee.Uint8DataEncoder(this.gl,f);default:throw new Error(`Invalid dataType: ${te}`)}}clearActiveTextures(){const te=this.gl;for(let f=0;f<this.maxTextureImageUnits;++f)te.activeTexture(te.TEXTURE0+f),te.bindTexture(te.TEXTURE_2D,null)}dispose(){if(this.disposed)return;const te=this.gl;te.bindFramebuffer(te.FRAMEBUFFER,null),te.deleteFramebuffer(this.framebuffer),te.bindBuffer(te.ARRAY_BUFFER,null),te.deleteBuffer(this.vertexbuffer),te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,null),te.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){const te=this.gl,f=te.createBuffer();if(!f)throw new Error("createBuffer() returned null");const d=this.createDefaultGeometry();return te.bindBuffer(te.ARRAY_BUFFER,f),te.bufferData(te.ARRAY_BUFFER,d,te.STATIC_DRAW),this.checkError(),f}createFramebuffer(){const te=this.gl.createFramebuffer();if(!te)throw new Error("createFramebuffer returned null");return te}queryVitalParameters(){const te=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),this.version===1&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw new Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=te.getParameter(te.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=te.getParameter(te.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){this.version===2?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){const te=this.gl,f=te.createTexture();te.bindTexture(te.TEXTURE_2D,f);const d=this.version===2?te.RGBA32F:te.RGBA;te.texImage2D(te.TEXTURE_2D,0,d,1,1,0,te.RGBA,te.FLOAT,null);const H=te.createFramebuffer();te.bindFramebuffer(te.FRAMEBUFFER,H),te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,f,0);const Z=te.checkFramebufferStatus(te.FRAMEBUFFER)===te.FRAMEBUFFER_COMPLETE;return te.bindTexture(te.TEXTURE_2D,null),te.bindFramebuffer(te.FRAMEBUFFER,null),te.deleteTexture(f),te.deleteFramebuffer(H),Z}checkRenderFloat32(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){const te=this.gl;let f,d,H,Z,Ye;try{f=te.createTexture(),d=te.createFramebuffer(),te.bindTexture(te.TEXTURE_2D,f);const et=this.version===2?te.RGBA32F:te.RGBA;return te.texImage2D(te.TEXTURE_2D,0,et,1,1,0,te.RGBA,te.FLOAT,null),te.bindFramebuffer(te.FRAMEBUFFER,d),te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,f,0),te.enable(te.BLEND),H=te.createShader(te.VERTEX_SHADER),!!H&&(te.shaderSource(H,"void main(){}"),te.compileShader(H),Z=te.createShader(te.FRAGMENT_SHADER),!!Z&&(te.shaderSource(Z,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),te.compileShader(Z),Ye=te.createProgram(),!!Ye&&(te.attachShader(Ye,H),te.attachShader(Ye,Z),te.linkProgram(Ye),te.useProgram(Ye),te.drawArrays(te.POINTS,0,1),te.getError()===te.NO_ERROR)))}finally{te.disable(te.BLEND),Ye&&te.deleteProgram(Ye),H&&te.deleteShader(H),Z&&te.deleteShader(Z),d&&(te.bindFramebuffer(te.FRAMEBUFFER,null),te.deleteFramebuffer(d)),f&&(te.bindTexture(te.TEXTURE_2D,null),te.deleteTexture(f))}}beginTimer(){if(this.version===2&&this.disjointTimerQueryWebgl2Extension){const te=this.gl,f=this.disjointTimerQueryWebgl2Extension,d=te.createQuery();return te.beginQuery(f.TIME_ELAPSED_EXT,d),d}throw new Error("WebGL1 profiling currently not supported.")}endTimer(){if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{const te=this.gl,f=this.disjointTimerQueryWebgl2Extension;te.endQuery(f.TIME_ELAPSED_EXT)}}isTimerResultAvailable(te){let f=!1,d=!1;if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{const H=this.gl,Z=this.disjointTimerQueryWebgl2Extension;f=H.getQueryParameter(te,H.QUERY_RESULT_AVAILABLE),d=H.getParameter(Z.GPU_DISJOINT_EXT)}return f&&!d}getTimerResult(te){let f=0;if(this.version!==2)throw new Error("WebGL1 profiling currently not supported");{const d=this.gl;f=d.getQueryParameter(te,d.QUERY_RESULT),d.deleteQuery(te)}return f/1e6}async waitForQueryAndGetTime(te){return await(0,xe.repeatedTry)((()=>this.isTimerResultAvailable(te))),this.getTimerResult(te)}async createAndWaitForFence(){const te=this.createFence(this.gl);return this.pollFence(te)}createFence(te){let f;const d=te,H=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);return te.flush(),f=H===null?()=>!0:()=>{const Z=d.clientWaitSync(H,0,0);return Z===d.ALREADY_SIGNALED||Z===d.CONDITION_SATISFIED},{query:H,isFencePassed:f}}async pollFence(te){return new Promise((f=>{this.addItemToPoll((()=>te.isFencePassed()),(()=>f()))}))}pollItems(){const te=ne(this.itemsToPoll.map((f=>f.isDoneFn)));for(let f=0;f<=te;++f){const{resolveFn:d}=this.itemsToPoll[f];d()}this.itemsToPoll=this.itemsToPoll.slice(te+1)}async addItemToPoll(te,f){this.itemsToPoll.push({isDoneFn:te,resolveFn:f}),this.itemsToPoll.length>1||await(0,xe.repeatedTry)((()=>(this.pollItems(),this.itemsToPoll.length===0)))}}},1036:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ExecutionPlan=void 0;const A=l(6231);class O{constructor(R,ee){this.op=R,this.node=ee}}a.ExecutionPlan=class{constructor(Y,R,ee){this.graph=Y,this.profiler=ee,this.initialize(R)}initialize(Y){this.profiler.event("session","ExecutionPlan.initialize",(()=>{const R=this.graph.getNodes();if(R.length!==Y.length)throw new Error("The size of nodes and OPs do not match.");this._ops=Y.map(((ee,xe)=>new O(ee,R[xe]))),this.reset(),this._starter=[],this._ops.forEach(((ee,xe)=>{let ne=!0;for(const te of ee.node.inputs)if(!this._values[te]&&this.graph.getInputIndices().indexOf(te)===-1){ne=!1;break}ne&&this._starter.push(xe)}))}))}reset(){this._values=this.graph.getValues().map((Y=>Y.tensor))}async execute(Y,R){return this.profiler.event("session","ExecutionPlan.execute",(async()=>{this.reset();const ee=Y.createInferenceHandler(),xe=this.graph.getInputIndices();if(R.length!==xe.length)throw new Error(`number of input tensors don't match the number of inputs to the model: actual: ${R.length} expected: ${xe.length}`);R.forEach(((Z,Ye)=>{const et=xe[Ye];this._values[et]=Z}));const ne=this._starter.slice(0),te=this.graph.getValues(),f=this.graph.getNodes();let d=0;for(;d<ne.length;){const Z=ne[d++],Ye=this._ops[Z],et=Ye.node.inputs.map((ot=>this._values[ot]));if(et.indexOf(void 0)!==-1)throw new Error(`unresolved input detected: op: ${Ye.node}`);const tt=et;A.Logger.verbose("ExecPlan",`Runing op:${Ye.node.name} (${tt.map(((ot,st)=>`'${Ye.node.inputs[st]}': ${ot.type}[${ot.dims.join(",")}]`)).join(", ")})`);const nt=await this.profiler.event("node",Ye.node.name,(async()=>Ye.op.impl(ee,tt,Ye.op.context)));if(nt.length!==Ye.node.outputs.length)throw new Error("the size of output does not match model definition.");nt.forEach(((ot,st)=>{const at=Ye.node.outputs[st];if(this._values[at])throw new Error(`output [${at}] already has value: op:${Ye.node.name}`);this._values[at]=ot}));const it=new Set;nt.forEach(((ot,st)=>{const at=Ye.node.outputs[st];for(const ct of te[at].to){const ft=f[ct];let ut=!0;for(const _t of ft.inputs)if(!this._values[_t]){ut=!1;break}ut&&it.add(ct)}})),ne.push(...it)}const H=[];for(let Z=0;Z<this.graph.getOutputIndices().length;Z++){const Ye=this.graph.getOutputIndices()[Z],et=this._values[Ye];if(et===void 0)throw new Error(`required output [${Ye}] does not have value`);Ye===0?await et.getData():et.data,H.push(et)}return A.Logger.verbose("ExecPlan","disposing of inferenceHandler"),ee.dispose(),H}))}}},7070:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Graph=void 0;const A=l(1446),O=l(7778),Y=l(9395),R=l(9162),ee=l(2517);var xe=Y.onnxruntime.experimental.fbs;a.Graph={from:(d,H)=>new f(d,H)};class ne{constructor(H){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,H&&(this.type=ee.ProtoUtil.tensorValueTypeFromProto(H.type.tensorType))}get from(){return this._from}get to(){return this._to}}class te{constructor(H,Z){H instanceof A.onnx.NodeProto?(this.name=H.name,this.opType=H.opType,this.attributes=new O.Attribute(H.attribute)):H instanceof xe.Node&&(this.name=Z??H.name(),this.opType=H.opType(),this.attributes=new O.Attribute(ee.ProtoUtil.tensorAttributesFromORTFormat(H))),this.inputs=[],this.outputs=[],this.executeNode=!0}}class f{constructor(H,Z){if(!H)throw new TypeError("graph is empty");this.buildGraph(H),this.transformGraph(Z),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(H){if(H instanceof A.onnx.GraphProto)this.buildGraphFromOnnxFormat(H);else{if(!(H instanceof xe.Graph))throw new TypeError("Graph type is not supported.");this.buildGraphFromOrtFormat(H)}}buildGraphFromOnnxFormat(H){const Z=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];const Ye=new Map;if(!H.input)throw new Error("missing information in graph: input");const et=[];for(const tt of H.input){if(Z.has(tt.name))throw new Error(`duplicated input name: ${tt.name}`);const nt=this._allData.push(new ne(tt))-1;Z.set(tt.name,nt),et.push(tt.name)}if(!H.initializer)throw new Error("missing information in graph: initializer");for(const tt of H.initializer){let nt=Z.get(tt.name);if(nt===void 0){const it=new ne;it.type={shape:{dims:ee.ProtoUtil.tensorDimsFromProto(tt.dims)},tensorType:ee.ProtoUtil.tensorDataTypeFromProto(tt.dataType)},nt=this._allData.push(it)-1,Z.set(tt.name,nt)}this._allData[nt]._from=-1,this._allData[nt].tensor=R.Tensor.fromProto(tt)}for(let tt=0;tt<this._allData.length;tt++)this._allData[tt].tensor||(this._allInputIndices.push(tt),this._allInputNames.push(et[tt]));if(!H.output)throw new Error("missing information in graph: output");for(const tt of H.output){if(Z.has(tt.name))throw new Error(`duplicated output name: ${tt.name}`);const nt=this._allData.push(new ne(tt))-1;Z.set(tt.name,nt),this._allOutputIndices.push(nt),this._allOutputNames.push(tt.name)}if(!H.node)throw new Error("missing information in graph: node");for(const tt of H.node){if(!tt.name)for(let it=0;;it++){const ot=`unnamed_${tt.opType}_${it}`;if(!Ye.has(ot)){tt.name=ot;break}}if(Ye.has(tt.name))throw new Error(`duplicated node name: ${tt.name}`);const nt=this._nodes.push(new te(tt))-1;Ye.set(tt.name,nt)}for(let tt=0;tt<this._nodes.length;tt++){const nt=this._nodes[tt],it=H.node[tt];if(!it.output)throw new Error(`missing output for node: ${it.name}`);for(const ot of it.output){let st=Z.get(ot);if(st===void 0&&(st=this._allData.push(new ne)-1,Z.set(ot,st)),nt.outputs.push(st),this._allData[st]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${st}`);if(this._allData[st]._from=tt,it.opType==="Constant"){if(!it.attribute||it.attribute.length!==1||!it.attribute[0].t)throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!it.output||it.output.length!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");nt.outputs.pop(),nt.executeNode=!1,this._allData[st]._from=-1,this._allData[st].tensor=R.Tensor.fromProto(it.attribute[0].t)}}}for(let tt=0;tt<this._nodes.length;tt++){const nt=this._nodes[tt],it=H.node[tt];if(!it.input)throw new Error(`missing input for node: ${it.name}`);for(const ot of it.input){const st=Z.get(ot);if(st===void 0){if(ot===""&&it.input.length===3&&it.opType==="Resize")continue;throw new Error(`unrecognized input '${ot}' for node: ${it.name}`)}nt.inputs.push(st),this._allData[st]._to.push(tt)}}return!0}buildGraphFromOrtFormat(H){var Z,Ye,et;const tt=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];const nt=new Map,it=[];for(let ot=0;ot<H.inputsLength();ot++){const st=H.inputs(ot);if(tt.has(st))throw new Error(`duplicated input name: ${st}`);for(let at=0;at<H.nodeArgsLength();at++)if(((Z=H.nodeArgs(at))===null||Z===void 0?void 0:Z.name())===st){const ct=new ne;if(((et=(Ye=H.nodeArgs(at))===null||Ye===void 0?void 0:Ye.type())===null||et===void 0?void 0:et.valueType())!==xe.TypeInfoValue.tensor_type)throw new Error("Unexpected value type for the nodeArg.");const ft=H.nodeArgs(at).type().value(new xe.TensorTypeAndShape),ut=ee.ProtoUtil.tensorDataTypeFromProto(ft.elemType()),_t=ft.shape(),At=[];for(let Mt=0;Mt<_t.dimLength();Mt++)At.push(ee.LongUtil.longToNumber(_t.dim(Mt).value().dimValue()));ct.type={shape:{dims:At},tensorType:ut};const Et=this._allData.push(ct)-1;tt.set(st,Et),it.push(st)}}for(let ot=0;ot<H.initializersLength();ot++){const st=H.initializers(ot);let at=tt.get(st.name());if(at===void 0){const ct=new ne,ft=ee.ProtoUtil.tensorDimsFromORTFormat(st),ut=ee.ProtoUtil.tensorDataTypeFromProto(st.dataType());ct.type={shape:{dims:ft},tensorType:ut},at=this._allData.push(ct)-1,tt.set(st.name(),at)}this._allData[at]._from=-1,this._allData[at].tensor=R.Tensor.fromOrtTensor(st)}for(let ot=0;ot<this._allData.length;ot++)this._allData[ot].tensor||(this._allInputIndices.push(ot),this._allInputNames.push(it[ot]));for(let ot=0;ot<H.outputsLength();ot++){const st=H.outputs(ot);if(tt.has(st))throw new Error(`duplicated output name: ${st}`);const at=this._allData.push(new ne)-1;tt.set(st,at),this._allOutputIndices.push(at),this._allOutputNames.push(st)}if(!H.nodes)throw new Error("missing information in graph: node");for(let ot=0;ot<H.nodesLength();ot++){const st=H.nodes(ot);let at=st.name();if(!at)for(let ft=0;at=`unnamed_${st.opType()}_${ft}`,nt.has(at);ft++);if(nt.has(at))throw new Error(`duplicated node name: ${at}`);const ct=this._nodes.push(new te(st,at))-1;nt.set(at,ct)}for(let ot=0;ot<this._nodes.length;ot++){const st=this._nodes[ot],at=H.nodes(ot);if(at==null)throw new Error(`No node exists at index ${ot}`);if(at?.outputsLength()===0)throw new Error(`missing output for node: ${at.name}`);for(let ct=0;ct<at?.outputsLength();ct++){const ft=at?.outputs(ct);let ut=tt.get(ft);if(ut===void 0&&(ut=this._allData.push(new ne)-1,tt.set(ft,ut)),st.outputs.push(ut),this._allData[ut]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${ut}`);if(this._allData[ut]._from=ot,at.opType()==="Constant"){if(at.attributesLength()!==1||!at.attributes(0).t())throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(at.outputsLength()!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");st.outputs.pop(),st.executeNode=!1,this._allData[ut]._from=-1,this._allData[ut].tensor=R.Tensor.fromOrtTensor(at.attributes(0).t())}}}for(let ot=0;ot<this._nodes.length;ot++){const st=this._nodes[ot],at=H.nodes(ot);if(at.inputsLength()===0)throw new Error(`missing input for node: ${at.name}`);for(let ct=0;ct<at.inputsLength();ct++){const ft=at.inputs(ct),ut=tt.get(ft);if(ut===void 0)throw new Error(`unrecognized input '${ft}' for node: ${at.name()}`);st.inputs.push(ut),this._allData[ut]._to.push(ot)}}}checkIsAcyclic(){const H=new Set;this._allInputIndices.forEach((et=>{this._allData[et]._to.forEach((tt=>{H.add(tt)}))}));const Z=Array.from(H),Ye=new Array(this._nodes.length).fill("white");for(;Z.length>0;){const et=Z.pop();Ye[et]==="gray"?Ye[et]="black":(Z.push(et),Ye[et]="gray",this._nodes[et].outputs.forEach((tt=>{const nt=this._allData[tt];if(nt.tensor!==void 0)throw new Error("node outputs should not be initialized");if(nt._from!==et)throw new Error("from property of the Value object doesn't match index of Node being processed");nt._to.forEach((it=>{if(Ye[it]==="gray")throw new Error("model graph is cyclic");Ye[it]==="white"&&Z.push(it)}))})))}}transformGraph(H){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),H&&H.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let H=0;for(let Z=0;Z<this._nodes.length;Z++)this._nodes[Z].executeNode?H>0&&(this._nodes[Z].inputs.forEach((Ye=>{const et=this._allData[Ye]._to.indexOf(Z+H);et!==-1&&(this._allData[Ye]._to[et]=Z)})),this._nodes[Z].outputs.forEach((Ye=>{this._allData[Ye]._from&&this._allData[Ye]._from===Z+H&&(this._allData[Ye]._from=Z)}))):(H++,this._nodes[Z].outputs.forEach((Ye=>{this._allData[Ye]._from=-2})),this._nodes.splice(Z,1),Z--);H=0;for(let Z=0;Z<this._allData.length;Z++)if(this._allData[Z].from!==-2||this._allOutputIndices.indexOf(Z+H)!==-1){if(H>0){let Ye=-1;this._allData[Z].from!==void 0&&this._allData[Z].from!==-1?(Ye=this._nodes[this._allData[Z].from].outputs.indexOf(Z+H),Ye!==-1&&(this._nodes[this._allData[Z].from].outputs[Ye]=Z)):(Ye=this._allInputIndices.indexOf(Z+H),Ye!==-1&&(this._allInputIndices[Ye]=Z)),this._allData[Z].to.forEach((et=>{Ye=this._nodes[et].inputs.indexOf(Z+H),Ye!==-1&&(this._nodes[et].inputs[Ye]=Z)})),this._allData[Z].to.length===0&&(Ye=this._allOutputIndices.indexOf(Z+H),Ye!==-1&&(this._allOutputIndices[Ye]=Z))}}else H++,this._allData.splice(Z,1),Z--}deleteNode(H){const Z=this._nodes[H];if(Z.outputs.length>1){for(let ot=1;ot<Z.outputs.length;ot++)if(this._allData[Z.outputs[ot]].to.length>0)throw new Error("Node deletion with more than one output connected to other nodes is not supported. ")}Z.executeNode=!1;const Ye=Z.inputs[0],et=Z.outputs[0],tt=this._allData[et].to,nt=this._allData[Ye].to.indexOf(H);if(nt===-1)throw new Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[Ye].to.splice(nt,1),this._allData[et]._to=[];const it=this._allOutputIndices.indexOf(et);if(it!==-1&&(this._allOutputIndices[it]=Ye),tt&&tt.length>0)for(const ot of tt){const st=this._nodes[ot].inputs.indexOf(et);if(st===-1)throw new Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[ot].inputs[st]=Ye,this._allData[Ye].to.push(ot)}}removeAllDropoutNodes(){let H=0;for(const Z of this._nodes){if(Z.opType==="Dropout"){if(Z.inputs.length!==1)throw new Error("Dropout nodes should only contain one input. ");if(Z.outputs.length!==1&&Z.outputs.length!==2)throw new Error("Dropout nodes should contain either 1 or 2 output(s)");if(Z.outputs.length===2&&this._allData[Z.outputs[1]]._to.length!==0)throw new Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(H)}H++}}removeAllIdentityNodes(){let H=0;for(const Z of this._nodes)Z.opType==="Identity"&&this.deleteNode(H),H++}isActivation(H){switch(H.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(const H of this._nodes)if(H.opType==="Conv"){const Z=this._allData[H.outputs[0]]._to;if(Z.length===1&&this.isActivation(this._nodes[Z[0]])){const Ye=this._nodes[Z[0]];if(Ye.opType==="Clip")if(Ye.inputs.length===1)try{H.attributes.set("activation_params","floats",[Ye.attributes.getFloat("min"),Ye.attributes.getFloat("max")])}catch{H.attributes.set("activation_params","floats",[ee.MIN_CLIP,ee.MAX_CLIP])}else{if(!(Ye.inputs.length>=3&&this._allData[Ye.inputs[1]].tensor!==void 0&&this._allData[Ye.inputs[2]].tensor!==void 0))continue;H.attributes.set("activation_params","floats",[this._allData[Ye.inputs[1]].tensor.floatData[0],this._allData[Ye.inputs[2]].tensor.floatData[0]])}H.attributes.set("activation","string",Ye.opType),this.deleteNode(Z[0])}}}}},6231:(g,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.now=a.Profiler=a.Logger=void 0;const l={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},A={none:new class{log(te,f,d){}},console:new class{log(te,f,d){console.log(`${this.color(te)} ${d?"\x1B[35m"+d+"\x1B[0m ":""}${f}`)}color(te){switch(te){case"verbose":return"\x1B[34;40mv\x1B[0m";case"info":return"\x1B[32mi\x1B[0m";case"warning":return"\x1B[30;43mw\x1B[0m";case"error":return"\x1B[31;40me\x1B[0m";case"fatal":return"\x1B[101mf\x1B[0m";default:throw new Error(`unsupported severity: ${te}`)}}}},O={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1};let Y={"":O};function R(te,f,d,H){if(f===void 0)return Z=te,{verbose:R.verbose.bind(null,Z),info:R.info.bind(null,Z),warning:R.warning.bind(null,Z),error:R.error.bind(null,Z),fatal:R.fatal.bind(null,Z)};if(d===void 0)ee(te,f);else if(typeof d=="number"&&H===void 0)ee(te,f);else if(typeof d=="string"&&H===void 0)ee(te,d,0,f);else{if(typeof d!="string"||typeof H!="number")throw new TypeError("input is valid");ee(te,d,0,f)}var Z}function ee(te,f,d,H){const Z=Y[H||""]||Y[""];l[te]<l[Z.minimalSeverity]||(Z.logDateTime&&(f=`${new Date().toISOString()}|${f}`),Z.logSourceLocation,A[Z.provider].log(te,f,H))}(function(te){function f(H){Y={},d("",H||{})}function d(H,Z){if(H==="*")f(Z);else{const Ye=Y[H]||O;Y[H]={provider:Z.provider||Ye.provider,minimalSeverity:Z.minimalSeverity||Ye.minimalSeverity,logDateTime:Z.logDateTime===void 0?Ye.logDateTime:Z.logDateTime,logSourceLocation:Z.logSourceLocation===void 0?Ye.logSourceLocation:Z.logSourceLocation}}}te.verbose=function(H,Z){te("verbose",H,Z)},te.info=function(H,Z){te("info",H,Z)},te.warning=function(H,Z){te("warning",H,Z)},te.error=function(H,Z){te("error",H,Z)},te.fatal=function(H,Z){te("fatal",H,Z)},te.reset=f,te.set=d,te.setWithEnv=function(H){const Z={};H.logLevel&&(Z.minimalSeverity=H.logLevel),d("",Z)}})(R||(R={})),a.Logger=R;class xe{constructor(f,d,H,Z,Ye,et){this.category=f,this.name=d,this.startTime=H,this.endCallback=Z,this.timer=Ye,this.ctx=et}end(){return this.endCallback(this)}async checkTimer(){if(this.ctx===void 0||this.timer===void 0)throw new Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}}class ne{constructor(f,d,H,Z){this.category=f,this.name=d,this.startTime=H,this.endTime=Z}}a.Profiler=class{static create(te){return te===void 0?new this:new this(te.maxNumberEvents,te.flushBatchSize,te.flushIntervalInMilliseconds)}constructor(te,f,d){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=te===void 0?1e4:te,this._flushBatchSize=f===void 0?10:f,this._flushIntervalInMilliseconds=d===void 0?5e3:d}start(){this._started=!0,this._timingEvents=[],this._flushTime=(0,a.now)(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(te,f,d,H){const Z=this._started?this.begin(te,f,H):void 0;let Ye=!1;const et=d();if(et&&typeof et.then=="function")return Ye=!0,new Promise(((tt,nt)=>{et.then((async it=>{Z&&await Z.end(),tt(it)}),(async it=>{Z&&await Z.end(),nt(it)}))}));if(!Ye&&Z){const tt=Z.end();if(tt&&typeof tt.then=="function")return new Promise(((nt,it)=>{tt.then((()=>{nt(et)}),(ot=>{it(ot)}))}))}return et}begin(te,f,d){if(!this._started)throw new Error("profiler is not started yet");if(d===void 0){const H=(0,a.now)();return this.flush(H),new xe(te,f,H,(Z=>this.endSync(Z)))}{const H=d.beginTimer();return new xe(te,f,0,(async Z=>this.end(Z)),H,d)}}async end(te){const f=await te.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new ne(te.category,te.name,te.startTime,f)),this.flush(f))}endSync(te){const f=(0,a.now)();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new ne(te.category,te.name,te.startTime,f)),this.flush(f))}logOneEvent(te){a.Logger.verbose(`Profiler.${te.category}`,`${(te.endTime-te.startTime).toFixed(2)}ms on event '${te.name}' at ${te.endTime.toFixed(2)}`)}flush(te){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||te-this._flushTime>=this._flushIntervalInMilliseconds){for(const f=this._flushPointer;this._flushPointer<f+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=(0,a.now)()}}get started(){return this._started}},a.now=typeof performance<"u"&&performance.now?()=>performance.now():Date.now},2644:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Model=void 0;const A=l(5686),O=l(1446),Y=l(7070),R=l(9395),ee=l(2517);var xe=R.onnxruntime.experimental.fbs;a.Model=class{constructor(){}load(ne,te,f){if(!f)try{return void this.loadFromOnnxFormat(ne,te)}catch(d){if(f!==void 0)throw d}this.loadFromOrtFormat(ne,te)}loadFromOnnxFormat(ne,te){const f=O.onnx.ModelProto.decode(ne);if(ee.LongUtil.longToNumber(f.irVersion)<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=f.opsetImport.map((d=>({domain:d.domain,version:ee.LongUtil.longToNumber(d.version)}))),this._graph=Y.Graph.from(f.graph,te)}loadFromOrtFormat(ne,te){const f=new A.flatbuffers.ByteBuffer(ne),d=xe.InferenceSession.getRootAsInferenceSession(f).model();if(ee.LongUtil.longToNumber(d.irVersion())<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let H=0;H<d.opsetImportLength();H++){const Z=d.opsetImport(H);this._opsets.push({domain:Z?.domain(),version:ee.LongUtil.longToNumber(Z.version())})}this._graph=Y.Graph.from(d.graph(),te)}get graph(){return this._graph}get opsets(){return this._opsets}}},782:(g,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.FLOAT_TYPES=a.INT_TYPES=a.NUMBER_TYPES=void 0,a.NUMBER_TYPES=["float32","float64","int32","int16","int8","uint16","uint32","uint8"],a.INT_TYPES=["int32","int16","int8","uint16","uint32","uint8"],a.FLOAT_TYPES=["float32","float64"]},1047:(g,a)=>{function l(A,O){if(O.endsWith("+")){const Y=Number.parseInt(O.substring(0,O.length-1),10);return!isNaN(Y)&&Y<=A}if(O.split("-").length===2){const Y=O.split("-"),R=Number.parseInt(Y[0],10),ee=Number.parseInt(Y[1],10);return!isNaN(R)&&!isNaN(ee)&&R<=A&&A<=ee}return Number.parseInt(O,10)===A}Object.defineProperty(a,"__esModule",{value:!0}),a.resolveOperator=void 0,a.resolveOperator=function(A,O,Y){for(const R of Y){const ee=R[0],xe=R[1],ne=R[2],te=R[3],f=R[4];if(A.opType===ee){for(const d of O)if((d.domain===xe||d.domain==="ai.onnx"&&xe==="")&&l(d.version,ne))return{opImpl:te,opInit:f}}}throw new TypeError(`cannot resolve operator '${A.opType}' with opsets: ${O.map((R=>`${R.domain||"ai.onnx"} v${R.version}`)).join(", ")}`)}},9395:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.onnxruntime=void 0;const A=l(5686);var O,Y;O=a.onnxruntime||(a.onnxruntime={}),(function(R){(function(ee){ee[ee.UNDEFINED=0]="UNDEFINED",ee[ee.FLOAT=1]="FLOAT",ee[ee.INT=2]="INT",ee[ee.STRING=3]="STRING",ee[ee.TENSOR=4]="TENSOR",ee[ee.GRAPH=5]="GRAPH",ee[ee.FLOATS=6]="FLOATS",ee[ee.INTS=7]="INTS",ee[ee.STRINGS=8]="STRINGS",ee[ee.TENSORS=9]="TENSORS",ee[ee.GRAPHS=10]="GRAPHS",ee[ee.SPARSE_TENSOR=11]="SPARSE_TENSOR",ee[ee.SPARSE_TENSORS=12]="SPARSE_TENSORS"})(R.AttributeType||(R.AttributeType={}))})((Y=O.experimental||(O.experimental={})).fbs||(Y.fbs={})),(function(R){(function(ee){(function(xe){(function(ne){ne[ne.UNKNOWN=0]="UNKNOWN",ne[ne.VALUE=1]="VALUE",ne[ne.PARAM=2]="PARAM"})(xe.DimensionValueType||(xe.DimensionValueType={}))})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){(function(ne){ne[ne.UNDEFINED=0]="UNDEFINED",ne[ne.FLOAT=1]="FLOAT",ne[ne.UINT8=2]="UINT8",ne[ne.INT8=3]="INT8",ne[ne.UINT16=4]="UINT16",ne[ne.INT16=5]="INT16",ne[ne.INT32=6]="INT32",ne[ne.INT64=7]="INT64",ne[ne.STRING=8]="STRING",ne[ne.BOOL=9]="BOOL",ne[ne.FLOAT16=10]="FLOAT16",ne[ne.DOUBLE=11]="DOUBLE",ne[ne.UINT32=12]="UINT32",ne[ne.UINT64=13]="UINT64",ne[ne.COMPLEX64=14]="COMPLEX64",ne[ne.COMPLEX128=15]="COMPLEX128",ne[ne.BFLOAT16=16]="BFLOAT16"})(xe.TensorDataType||(xe.TensorDataType={}))})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){(function(ne){ne[ne.Primitive=0]="Primitive",ne[ne.Fused=1]="Fused"})(xe.NodeType||(xe.NodeType={}))})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){(function(ne){ne[ne.NONE=0]="NONE",ne[ne.tensor_type=1]="tensor_type",ne[ne.sequence_type=2]="sequence_type",ne[ne.map_type=3]="map_type"})(xe.TypeInfoValue||(xe.TypeInfoValue={}))})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsShape(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsShape(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}dim(f,d){let H=this.bb.__offset(this.bb_pos,4);return H?(d||new R.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}dimLength(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.__vector_len(this.bb_pos+f):0}static startShape(f){f.startObject(1)}static addDim(f,d){f.addFieldOffset(0,d,0)}static createDimVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startDimVector(f,d){f.startVector(4,d,4)}static endShape(f){return f.endObject()}static createShape(f,d){return ne.startShape(f),ne.addDim(f,d),ne.endShape(f)}}xe.Shape=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsDimension(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsDimension(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}value(f){let d=this.bb.__offset(this.bb_pos,4);return d?(f||new R.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}denotation(f){let d=this.bb.__offset(this.bb_pos,6);return d?this.bb.__string(this.bb_pos+d,f):null}static startDimension(f){f.startObject(2)}static addValue(f,d){f.addFieldOffset(0,d,0)}static addDenotation(f,d){f.addFieldOffset(1,d,0)}static endDimension(f){return f.endObject()}static createDimension(f,d,H){return ne.startDimension(f),ne.addValue(f,d),ne.addDenotation(f,H),ne.endDimension(f)}}xe.Dimension=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsDimensionValue(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsDimensionValue(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}dimType(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.readInt8(this.bb_pos+f):R.experimental.fbs.DimensionValueType.UNKNOWN}dimValue(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.readInt64(this.bb_pos+f):this.bb.createLong(0,0)}dimParam(f){let d=this.bb.__offset(this.bb_pos,8);return d?this.bb.__string(this.bb_pos+d,f):null}static startDimensionValue(f){f.startObject(3)}static addDimType(f,d){f.addFieldInt8(0,d,R.experimental.fbs.DimensionValueType.UNKNOWN)}static addDimValue(f,d){f.addFieldInt64(1,d,f.createLong(0,0))}static addDimParam(f,d){f.addFieldOffset(2,d,0)}static endDimensionValue(f){return f.endObject()}static createDimensionValue(f,d,H,Z){return ne.startDimensionValue(f),ne.addDimType(f,d),ne.addDimValue(f,H),ne.addDimParam(f,Z),ne.endDimensionValue(f)}}xe.DimensionValue=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsTensorTypeAndShape(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsTensorTypeAndShape(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}elemType(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.readInt32(this.bb_pos+f):R.experimental.fbs.TensorDataType.UNDEFINED}shape(f){let d=this.bb.__offset(this.bb_pos,6);return d?(f||new R.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}static startTensorTypeAndShape(f){f.startObject(2)}static addElemType(f,d){f.addFieldInt32(0,d,R.experimental.fbs.TensorDataType.UNDEFINED)}static addShape(f,d){f.addFieldOffset(1,d,0)}static endTensorTypeAndShape(f){return f.endObject()}static createTensorTypeAndShape(f,d,H){return ne.startTensorTypeAndShape(f),ne.addElemType(f,d),ne.addShape(f,H),ne.endTensorTypeAndShape(f)}}xe.TensorTypeAndShape=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsMapType(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsMapType(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}keyType(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.readInt32(this.bb_pos+f):R.experimental.fbs.TensorDataType.UNDEFINED}valueType(f){let d=this.bb.__offset(this.bb_pos,6);return d?(f||new R.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}static startMapType(f){f.startObject(2)}static addKeyType(f,d){f.addFieldInt32(0,d,R.experimental.fbs.TensorDataType.UNDEFINED)}static addValueType(f,d){f.addFieldOffset(1,d,0)}static endMapType(f){return f.endObject()}static createMapType(f,d,H){return ne.startMapType(f),ne.addKeyType(f,d),ne.addValueType(f,H),ne.endMapType(f)}}xe.MapType=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsSequenceType(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsSequenceType(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}elemType(f){let d=this.bb.__offset(this.bb_pos,4);return d?(f||new R.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}static startSequenceType(f){f.startObject(1)}static addElemType(f,d){f.addFieldOffset(0,d,0)}static endSequenceType(f){return f.endObject()}static createSequenceType(f,d){return ne.startSequenceType(f),ne.addElemType(f,d),ne.endSequenceType(f)}}xe.SequenceType=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(ee.fbs||(ee.fbs={})).EdgeEnd=class{constructor(){this.bb=null,this.bb_pos=0}__init(xe,ne){return this.bb_pos=xe,this.bb=ne,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(xe,ne,te,f){return xe.prep(4,12),xe.writeInt32(f),xe.writeInt32(te),xe.writeInt32(ne),xe.offset()}}})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsNodeEdge(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsNodeEdge(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}nodeIndex(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.readUint32(this.bb_pos+f):0}inputEdges(f,d){let H=this.bb.__offset(this.bb_pos,6);return H?(d||new R.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+H)+12*f,this.bb):null}inputEdgesLength(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.__vector_len(this.bb_pos+f):0}outputEdges(f,d){let H=this.bb.__offset(this.bb_pos,8);return H?(d||new R.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+H)+12*f,this.bb):null}outputEdgesLength(){let f=this.bb.__offset(this.bb_pos,8);return f?this.bb.__vector_len(this.bb_pos+f):0}static startNodeEdge(f){f.startObject(3)}static addNodeIndex(f,d){f.addFieldInt32(0,d,0)}static addInputEdges(f,d){f.addFieldOffset(1,d,0)}static startInputEdgesVector(f,d){f.startVector(12,d,4)}static addOutputEdges(f,d){f.addFieldOffset(2,d,0)}static startOutputEdgesVector(f,d){f.startVector(12,d,4)}static endNodeEdge(f){return f.endObject()}static createNodeEdge(f,d,H,Z){return ne.startNodeEdge(f),ne.addNodeIndex(f,d),ne.addInputEdges(f,H),ne.addOutputEdges(f,Z),ne.endNodeEdge(f)}}xe.NodeEdge=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsNode(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsNode(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}name(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}docString(f){let d=this.bb.__offset(this.bb_pos,6);return d?this.bb.__string(this.bb_pos+d,f):null}domain(f){let d=this.bb.__offset(this.bb_pos,8);return d?this.bb.__string(this.bb_pos+d,f):null}sinceVersion(){let f=this.bb.__offset(this.bb_pos,10);return f?this.bb.readInt32(this.bb_pos+f):0}index(){let f=this.bb.__offset(this.bb_pos,12);return f?this.bb.readUint32(this.bb_pos+f):0}opType(f){let d=this.bb.__offset(this.bb_pos,14);return d?this.bb.__string(this.bb_pos+d,f):null}type(){let f=this.bb.__offset(this.bb_pos,16);return f?this.bb.readInt32(this.bb_pos+f):R.experimental.fbs.NodeType.Primitive}executionProviderType(f){let d=this.bb.__offset(this.bb_pos,18);return d?this.bb.__string(this.bb_pos+d,f):null}inputs(f,d){let H=this.bb.__offset(this.bb_pos,20);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}inputsLength(){let f=this.bb.__offset(this.bb_pos,20);return f?this.bb.__vector_len(this.bb_pos+f):0}outputs(f,d){let H=this.bb.__offset(this.bb_pos,22);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}outputsLength(){let f=this.bb.__offset(this.bb_pos,22);return f?this.bb.__vector_len(this.bb_pos+f):0}attributes(f,d){let H=this.bb.__offset(this.bb_pos,24);return H?(d||new R.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}attributesLength(){let f=this.bb.__offset(this.bb_pos,24);return f?this.bb.__vector_len(this.bb_pos+f):0}inputArgCounts(f){let d=this.bb.__offset(this.bb_pos,26);return d?this.bb.readInt32(this.bb.__vector(this.bb_pos+d)+4*f):0}inputArgCountsLength(){let f=this.bb.__offset(this.bb_pos,26);return f?this.bb.__vector_len(this.bb_pos+f):0}inputArgCountsArray(){let f=this.bb.__offset(this.bb_pos,26);return f?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+f),this.bb.__vector_len(this.bb_pos+f)):null}implicitInputs(f,d){let H=this.bb.__offset(this.bb_pos,28);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}implicitInputsLength(){let f=this.bb.__offset(this.bb_pos,28);return f?this.bb.__vector_len(this.bb_pos+f):0}static startNode(f){f.startObject(13)}static addName(f,d){f.addFieldOffset(0,d,0)}static addDocString(f,d){f.addFieldOffset(1,d,0)}static addDomain(f,d){f.addFieldOffset(2,d,0)}static addSinceVersion(f,d){f.addFieldInt32(3,d,0)}static addIndex(f,d){f.addFieldInt32(4,d,0)}static addOpType(f,d){f.addFieldOffset(5,d,0)}static addType(f,d){f.addFieldInt32(6,d,R.experimental.fbs.NodeType.Primitive)}static addExecutionProviderType(f,d){f.addFieldOffset(7,d,0)}static addInputs(f,d){f.addFieldOffset(8,d,0)}static createInputsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startInputsVector(f,d){f.startVector(4,d,4)}static addOutputs(f,d){f.addFieldOffset(9,d,0)}static createOutputsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startOutputsVector(f,d){f.startVector(4,d,4)}static addAttributes(f,d){f.addFieldOffset(10,d,0)}static createAttributesVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startAttributesVector(f,d){f.startVector(4,d,4)}static addInputArgCounts(f,d){f.addFieldOffset(11,d,0)}static createInputArgCountsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addInt32(d[H]);return f.endVector()}static startInputArgCountsVector(f,d){f.startVector(4,d,4)}static addImplicitInputs(f,d){f.addFieldOffset(12,d,0)}static createImplicitInputsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startImplicitInputsVector(f,d){f.startVector(4,d,4)}static endNode(f){return f.endObject()}static createNode(f,d,H,Z,Ye,et,tt,nt,it,ot,st,at,ct,ft){return ne.startNode(f),ne.addName(f,d),ne.addDocString(f,H),ne.addDomain(f,Z),ne.addSinceVersion(f,Ye),ne.addIndex(f,et),ne.addOpType(f,tt),ne.addType(f,nt),ne.addExecutionProviderType(f,it),ne.addInputs(f,ot),ne.addOutputs(f,st),ne.addAttributes(f,at),ne.addInputArgCounts(f,ct),ne.addImplicitInputs(f,ft),ne.endNode(f)}}xe.Node=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsValueInfo(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsValueInfo(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}name(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}docString(f){let d=this.bb.__offset(this.bb_pos,6);return d?this.bb.__string(this.bb_pos+d,f):null}type(f){let d=this.bb.__offset(this.bb_pos,8);return d?(f||new R.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}static startValueInfo(f){f.startObject(3)}static addName(f,d){f.addFieldOffset(0,d,0)}static addDocString(f,d){f.addFieldOffset(1,d,0)}static addType(f,d){f.addFieldOffset(2,d,0)}static endValueInfo(f){return f.endObject()}static createValueInfo(f,d,H,Z){return ne.startValueInfo(f),ne.addName(f,d),ne.addDocString(f,H),ne.addType(f,Z),ne.endValueInfo(f)}}xe.ValueInfo=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsTypeInfo(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsTypeInfo(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}denotation(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}valueType(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.readUint8(this.bb_pos+f):R.experimental.fbs.TypeInfoValue.NONE}value(f){let d=this.bb.__offset(this.bb_pos,8);return d?this.bb.__union(f,this.bb_pos+d):null}static startTypeInfo(f){f.startObject(3)}static addDenotation(f,d){f.addFieldOffset(0,d,0)}static addValueType(f,d){f.addFieldInt8(1,d,R.experimental.fbs.TypeInfoValue.NONE)}static addValue(f,d){f.addFieldOffset(2,d,0)}static endTypeInfo(f){return f.endObject()}static createTypeInfo(f,d,H,Z){return ne.startTypeInfo(f),ne.addDenotation(f,d),ne.addValueType(f,H),ne.addValue(f,Z),ne.endTypeInfo(f)}}xe.TypeInfo=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsOperatorSetId(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsOperatorSetId(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}domain(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}version(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.readInt64(this.bb_pos+f):this.bb.createLong(0,0)}static startOperatorSetId(f){f.startObject(2)}static addDomain(f,d){f.addFieldOffset(0,d,0)}static addVersion(f,d){f.addFieldInt64(1,d,f.createLong(0,0))}static endOperatorSetId(f){return f.endObject()}static createOperatorSetId(f,d,H){return ne.startOperatorSetId(f),ne.addDomain(f,d),ne.addVersion(f,H),ne.endOperatorSetId(f)}}xe.OperatorSetId=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsTensor(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsTensor(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}name(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}docString(f){let d=this.bb.__offset(this.bb_pos,6);return d?this.bb.__string(this.bb_pos+d,f):null}dims(f){let d=this.bb.__offset(this.bb_pos,8);return d?this.bb.readInt64(this.bb.__vector(this.bb_pos+d)+8*f):this.bb.createLong(0,0)}dimsLength(){let f=this.bb.__offset(this.bb_pos,8);return f?this.bb.__vector_len(this.bb_pos+f):0}dataType(){let f=this.bb.__offset(this.bb_pos,10);return f?this.bb.readInt32(this.bb_pos+f):R.experimental.fbs.TensorDataType.UNDEFINED}rawData(f){let d=this.bb.__offset(this.bb_pos,12);return d?this.bb.readUint8(this.bb.__vector(this.bb_pos+d)+f):0}rawDataLength(){let f=this.bb.__offset(this.bb_pos,12);return f?this.bb.__vector_len(this.bb_pos+f):0}rawDataArray(){let f=this.bb.__offset(this.bb_pos,12);return f?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+f),this.bb.__vector_len(this.bb_pos+f)):null}stringData(f,d){let H=this.bb.__offset(this.bb_pos,14);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}stringDataLength(){let f=this.bb.__offset(this.bb_pos,14);return f?this.bb.__vector_len(this.bb_pos+f):0}static startTensor(f){f.startObject(6)}static addName(f,d){f.addFieldOffset(0,d,0)}static addDocString(f,d){f.addFieldOffset(1,d,0)}static addDims(f,d){f.addFieldOffset(2,d,0)}static createDimsVector(f,d){f.startVector(8,d.length,8);for(let H=d.length-1;H>=0;H--)f.addInt64(d[H]);return f.endVector()}static startDimsVector(f,d){f.startVector(8,d,8)}static addDataType(f,d){f.addFieldInt32(3,d,R.experimental.fbs.TensorDataType.UNDEFINED)}static addRawData(f,d){f.addFieldOffset(4,d,0)}static createRawDataVector(f,d){f.startVector(1,d.length,1);for(let H=d.length-1;H>=0;H--)f.addInt8(d[H]);return f.endVector()}static startRawDataVector(f,d){f.startVector(1,d,1)}static addStringData(f,d){f.addFieldOffset(5,d,0)}static createStringDataVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startStringDataVector(f,d){f.startVector(4,d,4)}static endTensor(f){return f.endObject()}static createTensor(f,d,H,Z,Ye,et,tt){return ne.startTensor(f),ne.addName(f,d),ne.addDocString(f,H),ne.addDims(f,Z),ne.addDataType(f,Ye),ne.addRawData(f,et),ne.addStringData(f,tt),ne.endTensor(f)}}xe.Tensor=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsSparseTensor(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsSparseTensor(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}values(f){let d=this.bb.__offset(this.bb_pos,4);return d?(f||new R.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}indices(f){let d=this.bb.__offset(this.bb_pos,6);return d?(f||new R.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}dims(f){let d=this.bb.__offset(this.bb_pos,8);return d?this.bb.readInt64(this.bb.__vector(this.bb_pos+d)+8*f):this.bb.createLong(0,0)}dimsLength(){let f=this.bb.__offset(this.bb_pos,8);return f?this.bb.__vector_len(this.bb_pos+f):0}static startSparseTensor(f){f.startObject(3)}static addValues(f,d){f.addFieldOffset(0,d,0)}static addIndices(f,d){f.addFieldOffset(1,d,0)}static addDims(f,d){f.addFieldOffset(2,d,0)}static createDimsVector(f,d){f.startVector(8,d.length,8);for(let H=d.length-1;H>=0;H--)f.addInt64(d[H]);return f.endVector()}static startDimsVector(f,d){f.startVector(8,d,8)}static endSparseTensor(f){return f.endObject()}static createSparseTensor(f,d,H,Z){return ne.startSparseTensor(f),ne.addValues(f,d),ne.addIndices(f,H),ne.addDims(f,Z),ne.endSparseTensor(f)}}xe.SparseTensor=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsAttribute(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsAttribute(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}name(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}docString(f){let d=this.bb.__offset(this.bb_pos,6);return d?this.bb.__string(this.bb_pos+d,f):null}type(){let f=this.bb.__offset(this.bb_pos,8);return f?this.bb.readInt32(this.bb_pos+f):R.experimental.fbs.AttributeType.UNDEFINED}f(){let f=this.bb.__offset(this.bb_pos,10);return f?this.bb.readFloat32(this.bb_pos+f):0}i(){let f=this.bb.__offset(this.bb_pos,12);return f?this.bb.readInt64(this.bb_pos+f):this.bb.createLong(0,0)}s(f){let d=this.bb.__offset(this.bb_pos,14);return d?this.bb.__string(this.bb_pos+d,f):null}t(f){let d=this.bb.__offset(this.bb_pos,16);return d?(f||new R.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}g(f){let d=this.bb.__offset(this.bb_pos,18);return d?(f||new R.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}floats(f){let d=this.bb.__offset(this.bb_pos,20);return d?this.bb.readFloat32(this.bb.__vector(this.bb_pos+d)+4*f):0}floatsLength(){let f=this.bb.__offset(this.bb_pos,20);return f?this.bb.__vector_len(this.bb_pos+f):0}floatsArray(){let f=this.bb.__offset(this.bb_pos,20);return f?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+f),this.bb.__vector_len(this.bb_pos+f)):null}ints(f){let d=this.bb.__offset(this.bb_pos,22);return d?this.bb.readInt64(this.bb.__vector(this.bb_pos+d)+8*f):this.bb.createLong(0,0)}intsLength(){let f=this.bb.__offset(this.bb_pos,22);return f?this.bb.__vector_len(this.bb_pos+f):0}strings(f,d){let H=this.bb.__offset(this.bb_pos,24);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}stringsLength(){let f=this.bb.__offset(this.bb_pos,24);return f?this.bb.__vector_len(this.bb_pos+f):0}tensors(f,d){let H=this.bb.__offset(this.bb_pos,26);return H?(d||new R.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}tensorsLength(){let f=this.bb.__offset(this.bb_pos,26);return f?this.bb.__vector_len(this.bb_pos+f):0}graphs(f,d){let H=this.bb.__offset(this.bb_pos,28);return H?(d||new R.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}graphsLength(){let f=this.bb.__offset(this.bb_pos,28);return f?this.bb.__vector_len(this.bb_pos+f):0}static startAttribute(f){f.startObject(13)}static addName(f,d){f.addFieldOffset(0,d,0)}static addDocString(f,d){f.addFieldOffset(1,d,0)}static addType(f,d){f.addFieldInt32(2,d,R.experimental.fbs.AttributeType.UNDEFINED)}static addF(f,d){f.addFieldFloat32(3,d,0)}static addI(f,d){f.addFieldInt64(4,d,f.createLong(0,0))}static addS(f,d){f.addFieldOffset(5,d,0)}static addT(f,d){f.addFieldOffset(6,d,0)}static addG(f,d){f.addFieldOffset(7,d,0)}static addFloats(f,d){f.addFieldOffset(8,d,0)}static createFloatsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addFloat32(d[H]);return f.endVector()}static startFloatsVector(f,d){f.startVector(4,d,4)}static addInts(f,d){f.addFieldOffset(9,d,0)}static createIntsVector(f,d){f.startVector(8,d.length,8);for(let H=d.length-1;H>=0;H--)f.addInt64(d[H]);return f.endVector()}static startIntsVector(f,d){f.startVector(8,d,8)}static addStrings(f,d){f.addFieldOffset(10,d,0)}static createStringsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startStringsVector(f,d){f.startVector(4,d,4)}static addTensors(f,d){f.addFieldOffset(11,d,0)}static createTensorsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startTensorsVector(f,d){f.startVector(4,d,4)}static addGraphs(f,d){f.addFieldOffset(12,d,0)}static createGraphsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startGraphsVector(f,d){f.startVector(4,d,4)}static endAttribute(f){return f.endObject()}static createAttribute(f,d,H,Z,Ye,et,tt,nt,it,ot,st,at,ct,ft){return ne.startAttribute(f),ne.addName(f,d),ne.addDocString(f,H),ne.addType(f,Z),ne.addF(f,Ye),ne.addI(f,et),ne.addS(f,tt),ne.addT(f,nt),ne.addG(f,it),ne.addFloats(f,ot),ne.addInts(f,st),ne.addStrings(f,at),ne.addTensors(f,ct),ne.addGraphs(f,ft),ne.endAttribute(f)}}xe.Attribute=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsGraph(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsGraph(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}initializers(f,d){let H=this.bb.__offset(this.bb_pos,4);return H?(d||new R.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}initializersLength(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.__vector_len(this.bb_pos+f):0}nodeArgs(f,d){let H=this.bb.__offset(this.bb_pos,6);return H?(d||new R.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}nodeArgsLength(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.__vector_len(this.bb_pos+f):0}nodes(f,d){let H=this.bb.__offset(this.bb_pos,8);return H?(d||new R.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}nodesLength(){let f=this.bb.__offset(this.bb_pos,8);return f?this.bb.__vector_len(this.bb_pos+f):0}maxNodeIndex(){let f=this.bb.__offset(this.bb_pos,10);return f?this.bb.readUint32(this.bb_pos+f):0}nodeEdges(f,d){let H=this.bb.__offset(this.bb_pos,12);return H?(d||new R.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}nodeEdgesLength(){let f=this.bb.__offset(this.bb_pos,12);return f?this.bb.__vector_len(this.bb_pos+f):0}inputs(f,d){let H=this.bb.__offset(this.bb_pos,14);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}inputsLength(){let f=this.bb.__offset(this.bb_pos,14);return f?this.bb.__vector_len(this.bb_pos+f):0}outputs(f,d){let H=this.bb.__offset(this.bb_pos,16);return H?this.bb.__string(this.bb.__vector(this.bb_pos+H)+4*f,d):null}outputsLength(){let f=this.bb.__offset(this.bb_pos,16);return f?this.bb.__vector_len(this.bb_pos+f):0}sparseInitializers(f,d){let H=this.bb.__offset(this.bb_pos,18);return H?(d||new R.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}sparseInitializersLength(){let f=this.bb.__offset(this.bb_pos,18);return f?this.bb.__vector_len(this.bb_pos+f):0}static startGraph(f){f.startObject(8)}static addInitializers(f,d){f.addFieldOffset(0,d,0)}static createInitializersVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startInitializersVector(f,d){f.startVector(4,d,4)}static addNodeArgs(f,d){f.addFieldOffset(1,d,0)}static createNodeArgsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startNodeArgsVector(f,d){f.startVector(4,d,4)}static addNodes(f,d){f.addFieldOffset(2,d,0)}static createNodesVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startNodesVector(f,d){f.startVector(4,d,4)}static addMaxNodeIndex(f,d){f.addFieldInt32(3,d,0)}static addNodeEdges(f,d){f.addFieldOffset(4,d,0)}static createNodeEdgesVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startNodeEdgesVector(f,d){f.startVector(4,d,4)}static addInputs(f,d){f.addFieldOffset(5,d,0)}static createInputsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startInputsVector(f,d){f.startVector(4,d,4)}static addOutputs(f,d){f.addFieldOffset(6,d,0)}static createOutputsVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startOutputsVector(f,d){f.startVector(4,d,4)}static addSparseInitializers(f,d){f.addFieldOffset(7,d,0)}static createSparseInitializersVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startSparseInitializersVector(f,d){f.startVector(4,d,4)}static endGraph(f){return f.endObject()}static createGraph(f,d,H,Z,Ye,et,tt,nt,it){return ne.startGraph(f),ne.addInitializers(f,d),ne.addNodeArgs(f,H),ne.addNodes(f,Z),ne.addMaxNodeIndex(f,Ye),ne.addNodeEdges(f,et),ne.addInputs(f,tt),ne.addOutputs(f,nt),ne.addSparseInitializers(f,it),ne.endGraph(f)}}xe.Graph=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsModel(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsModel(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}irVersion(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.readInt64(this.bb_pos+f):this.bb.createLong(0,0)}opsetImport(f,d){let H=this.bb.__offset(this.bb_pos,6);return H?(d||new R.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}opsetImportLength(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.__vector_len(this.bb_pos+f):0}producerName(f){let d=this.bb.__offset(this.bb_pos,8);return d?this.bb.__string(this.bb_pos+d,f):null}producerVersion(f){let d=this.bb.__offset(this.bb_pos,10);return d?this.bb.__string(this.bb_pos+d,f):null}domain(f){let d=this.bb.__offset(this.bb_pos,12);return d?this.bb.__string(this.bb_pos+d,f):null}modelVersion(){let f=this.bb.__offset(this.bb_pos,14);return f?this.bb.readInt64(this.bb_pos+f):this.bb.createLong(0,0)}docString(f){let d=this.bb.__offset(this.bb_pos,16);return d?this.bb.__string(this.bb_pos+d,f):null}graph(f){let d=this.bb.__offset(this.bb_pos,18);return d?(f||new R.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}graphDocString(f){let d=this.bb.__offset(this.bb_pos,20);return d?this.bb.__string(this.bb_pos+d,f):null}static startModel(f){f.startObject(9)}static addIrVersion(f,d){f.addFieldInt64(0,d,f.createLong(0,0))}static addOpsetImport(f,d){f.addFieldOffset(1,d,0)}static createOpsetImportVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startOpsetImportVector(f,d){f.startVector(4,d,4)}static addProducerName(f,d){f.addFieldOffset(2,d,0)}static addProducerVersion(f,d){f.addFieldOffset(3,d,0)}static addDomain(f,d){f.addFieldOffset(4,d,0)}static addModelVersion(f,d){f.addFieldInt64(5,d,f.createLong(0,0))}static addDocString(f,d){f.addFieldOffset(6,d,0)}static addGraph(f,d){f.addFieldOffset(7,d,0)}static addGraphDocString(f,d){f.addFieldOffset(8,d,0)}static endModel(f){return f.endObject()}static createModel(f,d,H,Z,Ye,et,tt,nt,it,ot){return ne.startModel(f),ne.addIrVersion(f,d),ne.addOpsetImport(f,H),ne.addProducerName(f,Z),ne.addProducerVersion(f,Ye),ne.addDomain(f,et),ne.addModelVersion(f,tt),ne.addDocString(f,nt),ne.addGraph(f,it),ne.addGraphDocString(f,ot),ne.endModel(f)}}xe.Model=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsKernelCreateInfos(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsKernelCreateInfos(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}nodeIndices(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.readUint32(this.bb.__vector(this.bb_pos+d)+4*f):0}nodeIndicesLength(){let f=this.bb.__offset(this.bb_pos,4);return f?this.bb.__vector_len(this.bb_pos+f):0}nodeIndicesArray(){let f=this.bb.__offset(this.bb_pos,4);return f?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+f),this.bb.__vector_len(this.bb_pos+f)):null}kernelDefHashes(f){let d=this.bb.__offset(this.bb_pos,6);return d?this.bb.readUint64(this.bb.__vector(this.bb_pos+d)+8*f):this.bb.createLong(0,0)}kernelDefHashesLength(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.__vector_len(this.bb_pos+f):0}static startKernelCreateInfos(f){f.startObject(2)}static addNodeIndices(f,d){f.addFieldOffset(0,d,0)}static createNodeIndicesVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addInt32(d[H]);return f.endVector()}static startNodeIndicesVector(f,d){f.startVector(4,d,4)}static addKernelDefHashes(f,d){f.addFieldOffset(1,d,0)}static createKernelDefHashesVector(f,d){f.startVector(8,d.length,8);for(let H=d.length-1;H>=0;H--)f.addInt64(d[H]);return f.endVector()}static startKernelDefHashesVector(f,d){f.startVector(8,d,8)}static endKernelCreateInfos(f){return f.endObject()}static createKernelCreateInfos(f,d,H){return ne.startKernelCreateInfos(f),ne.addNodeIndices(f,d),ne.addKernelDefHashes(f,H),ne.endKernelCreateInfos(f)}}xe.KernelCreateInfos=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsSubGraphSessionState(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsSubGraphSessionState(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}graphId(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}sessionState(f){let d=this.bb.__offset(this.bb_pos,6);return d?(f||new R.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}static startSubGraphSessionState(f){f.startObject(2)}static addGraphId(f,d){f.addFieldOffset(0,d,0)}static addSessionState(f,d){f.addFieldOffset(1,d,0)}static endSubGraphSessionState(f){let d=f.endObject();return f.requiredField(d,4),d}static createSubGraphSessionState(f,d,H){return ne.startSubGraphSessionState(f),ne.addGraphId(f,d),ne.addSessionState(f,H),ne.endSubGraphSessionState(f)}}xe.SubGraphSessionState=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsSessionState(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsSessionState(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}kernels(f){let d=this.bb.__offset(this.bb_pos,4);return d?(f||new R.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}subGraphSessionStates(f,d){let H=this.bb.__offset(this.bb_pos,6);return H?(d||new R.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+H)+4*f),this.bb):null}subGraphSessionStatesLength(){let f=this.bb.__offset(this.bb_pos,6);return f?this.bb.__vector_len(this.bb_pos+f):0}static startSessionState(f){f.startObject(2)}static addKernels(f,d){f.addFieldOffset(0,d,0)}static addSubGraphSessionStates(f,d){f.addFieldOffset(1,d,0)}static createSubGraphSessionStatesVector(f,d){f.startVector(4,d.length,4);for(let H=d.length-1;H>=0;H--)f.addOffset(d[H]);return f.endVector()}static startSubGraphSessionStatesVector(f,d){f.startVector(4,d,4)}static endSessionState(f){return f.endObject()}static createSessionState(f,d,H){return ne.startSessionState(f),ne.addKernels(f,d),ne.addSubGraphSessionStates(f,H),ne.endSessionState(f)}}xe.SessionState=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={})),(function(R){(function(ee){(function(xe){class ne{constructor(){this.bb=null,this.bb_pos=0}__init(f,d){return this.bb_pos=f,this.bb=d,this}static getRootAsInferenceSession(f,d){return(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static getSizePrefixedRootAsInferenceSession(f,d){return f.setPosition(f.position()+A.flatbuffers.SIZE_PREFIX_LENGTH),(d||new ne).__init(f.readInt32(f.position())+f.position(),f)}static bufferHasIdentifier(f){return f.__has_identifier("ORTM")}ortVersion(f){let d=this.bb.__offset(this.bb_pos,4);return d?this.bb.__string(this.bb_pos+d,f):null}model(f){let d=this.bb.__offset(this.bb_pos,6);return d?(f||new R.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}sessionState(f){let d=this.bb.__offset(this.bb_pos,8);return d?(f||new R.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+d),this.bb):null}static startInferenceSession(f){f.startObject(3)}static addOrtVersion(f,d){f.addFieldOffset(0,d,0)}static addModel(f,d){f.addFieldOffset(1,d,0)}static addSessionState(f,d){f.addFieldOffset(2,d,0)}static endInferenceSession(f){return f.endObject()}static finishInferenceSessionBuffer(f,d){f.finish(d,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(f,d){f.finish(d,"ORTM",!0)}static createInferenceSession(f,d,H,Z){return ne.startInferenceSession(f),ne.addOrtVersion(f,d),ne.addModel(f,H),ne.addSessionState(f,Z),ne.endInferenceSession(f)}}xe.InferenceSession=ne})(ee.fbs||(ee.fbs={}))})(R.experimental||(R.experimental={}))})(a.onnxruntime||(a.onnxruntime={}))},7448:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.OnnxjsSessionHandler=void 0;const A=l(1670),O=l(9162);a.OnnxjsSessionHandler=class{constructor(Y){this.session=Y,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(Y,R,ee){const xe=new Map;for(const f in Y)if(Object.hasOwnProperty.call(Y,f)){const d=Y[f];xe.set(f,new O.Tensor(d.dims,d.type,void 0,void 0,d.data))}const ne=await this.session.run(xe),te={};return ne.forEach(((f,d)=>{te[d]=new A.Tensor(f.type,f.data,f.dims)})),te}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}},6919:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Session=void 0;const A=l(7067),O=l(1296),Y=l(7091),R=l(1036),ee=l(6231),xe=l(2644);a.Session=class{constructor(ne={}){this._initialized=!1,this.backendHint=ne.backendHint,this.profiler=ee.Profiler.create(ne.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(ne,te,f){await this.profiler.event("session","Session.loadModel",(async()=>{const d=await(0,Y.resolveBackend)(this.backendHint);if(this.sessionHandler=d.createSessionHandler(this.context),this._model=new xe.Model,typeof ne=="string"){const H=ne.endsWith(".ort");if(typeof fetch>"u"){const Z=await(0,O.promisify)(A.readFile)(ne);this.initialize(Z,H)}else{const Z=await fetch(ne),Ye=await Z.arrayBuffer();this.initialize(new Uint8Array(Ye),H)}}else if(ArrayBuffer.isView(ne))this.initialize(ne);else{const H=new Uint8Array(ne,te||0,f||ne.byteLength);this.initialize(H)}}))}initialize(ne,te){if(this._initialized)throw new Error("already initialized");this.profiler.event("session","Session.initialize",(()=>{const f=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(ne,f,te),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new R.ExecutionPlan(this._model.graph,this._ops,this.profiler)})),this._initialized=!0}async run(ne){if(!this._initialized)throw new Error("session not initialized yet");return this.profiler.event("session","Session.run",(async()=>{const te=this.normalizeAndValidateInputs(ne),f=await this._executionPlan.execute(this.sessionHandler,te);return this.createOutput(f)}))}normalizeAndValidateInputs(ne){const te=this._model.graph.getInputNames();if(Array.isArray(ne)){if(ne.length!==te.length)throw new Error(`incorrect input array length: expected ${te.length} but got ${ne.length}`)}else{if(ne.size!==te.length)throw new Error(`incorrect input map size: expected ${te.length} but got ${ne.size}`);const f=new Array(ne.size);let d=0;for(let H=0;H<te.length;++H){const Z=ne.get(te[H]);if(!Z)throw new Error(`missing input tensor for: '${name}'`);f[d++]=Z}ne=f}if(this.context.graphInputTypes&&this.context.graphInputTypes.length!==0&&this.context.graphInputDims&&this.context.graphInputDims.length!==0)this.validateInputTensorDims(this.context.graphInputDims,ne,!1);else{const f=this._model.graph.getInputIndices(),d=this._model.graph.getValues(),H=new Array(f.length);for(let Z=0;Z<f.length;++Z){const Ye=d[f[Z]];H[Z]=Ye.type.shape.dims,this.context.graphInputTypes.push(Ye.type.tensorType),this.context.graphInputDims.push(ne[Z].dims)}this.validateInputTensorDims(H,ne,!0)}return this.validateInputTensorTypes(this.context.graphInputTypes,ne),ne}validateInputTensorTypes(ne,te){for(let f=0;f<te.length;f++){const d=ne[f],H=te[f].type;if(d!==H)throw new Error(`input tensor[${f}] check failed: expected type '${d}' but got ${H}`)}}validateInputTensorDims(ne,te,f){for(let d=0;d<te.length;d++){const H=ne[d],Z=te[d].dims;if(!this.compareTensorDims(H,Z,f))throw new Error(`input tensor[${d}] check failed: expected shape '[${H.join(",")}]' but got [${Z.join(",")}]`)}}compareTensorDims(ne,te,f){if(ne.length!==te.length)return!1;for(let d=0;d<ne.length;++d)if(ne[d]!==te[d]&&(!f||ne[d]!==0))return!1;return!0}createOutput(ne){const te=this._model.graph.getOutputNames();if(ne.length!==te.length)throw new Error("expected number of outputs do not match number of generated outputs");const f=new Map;for(let d=0;d<te.length;++d)f.set(te[d],ne[d]);return f}initializeOps(ne){const te=ne.getNodes();this._ops=new Array(te.length);for(let f=0;f<te.length;f++)this._ops[f]=this.sessionHandler.resolve(te[f],this._model.opsets,ne)}}},9162:function(g,a,l){var A=this&&this.__importDefault||function(Ye){return Ye&&Ye.__esModule?Ye:{default:Ye}};Object.defineProperty(a,"__esModule",{value:!0}),a.Tensor=void 0;const O=l(3442),Y=A(l(3720)),R=l(1446),ee=l(9395),xe=l(2517);var ne=ee.onnxruntime.experimental.fbs;class te{get data(){if(this.cache===void 0){const et=this.dataProvider(this.dataId);if(et.length!==this.size)throw new Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=et}return this.cache}get stringData(){if(this.type!=="string")throw new TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw new TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw new TypeError("data type is not float (float32, float64)")}}get numberData(){if(this.type!=="string")return this.data;throw new TypeError("type cannot be non-number (string)")}get(et){return this.data[xe.ShapeUtil.indicesToOffset(et,this.strides)]}set(et,tt){this.data[xe.ShapeUtil.indicesToOffset(et,this.strides)]=tt}async getData(){return this.cache===void 0&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=xe.ShapeUtil.computeStrides(this.dims)),this._strides}constructor(et,tt,nt,it,ot,st=O.Guid.create()){this.dims=et,this.type=tt,this.dataProvider=nt,this.asyncDataProvider=it,this.cache=ot,this.dataId=st,this.size=xe.ShapeUtil.validateDimsAndCalcSize(et);const at=this.size,ct=nt===void 0&&it===void 0&&ot===void 0;if(ot!==void 0&&ot.length!==at)throw new RangeError("Input dims doesn't match data length.");if(tt==="string"){if(!(ot===void 0||Array.isArray(ot)&&ot.every((ft=>typeof ft=="string"))))throw new TypeError("cache should be a string array");ct&&(this.cache=new Array(at))}else{if(ot!==void 0){const ft=d(tt);if(!(ot instanceof ft))throw new TypeError(`cache should be type ${ft.name}`)}if(ct){const ft=new ArrayBuffer(at*(function(ut){switch(ut){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw new Error(`cannot calculate sizeof() on type ${ut}`)}})(tt));this.cache=(function(ut,_t){return new(d(_t))(ut)})(ft,tt)}}}static fromProto(et){if(!et)throw new Error("cannot construct Value from an empty tensor");const tt=xe.ProtoUtil.tensorDataTypeFromProto(et.dataType),nt=xe.ProtoUtil.tensorDimsFromProto(et.dims),it=new te(nt,tt);if(tt==="string")et.stringData.forEach(((ot,st)=>{it.data[st]=(0,xe.decodeUtf8String)(ot)}));else if(et.rawData&&typeof et.rawData.byteLength=="number"&&et.rawData.byteLength>0){const ot=it.data,st=new DataView(et.rawData.buffer,et.rawData.byteOffset,et.rawData.byteLength),at=f(et.dataType),ct=et.rawData.byteLength/at;if(et.rawData.byteLength%at!=0)throw new Error("invalid buffer length");if(ot.length!==ct)throw new Error("buffer length mismatch");for(let ft=0;ft<ct;ft++){const ut=Z(st,et.dataType,ft*at);ot[ft]=ut}}else{let ot;switch(et.dataType){case R.onnx.TensorProto.DataType.FLOAT:ot=et.floatData;break;case R.onnx.TensorProto.DataType.INT32:case R.onnx.TensorProto.DataType.INT16:case R.onnx.TensorProto.DataType.UINT16:case R.onnx.TensorProto.DataType.INT8:case R.onnx.TensorProto.DataType.UINT8:case R.onnx.TensorProto.DataType.BOOL:ot=et.int32Data;break;case R.onnx.TensorProto.DataType.INT64:ot=et.int64Data;break;case R.onnx.TensorProto.DataType.DOUBLE:ot=et.doubleData;break;case R.onnx.TensorProto.DataType.UINT32:case R.onnx.TensorProto.DataType.UINT64:ot=et.uint64Data;break;default:throw new Error("unspecific error")}if(ot==null)throw new Error("failed to populate data from a tensorproto value");const st=it.data;if(st.length!==ot.length)throw new Error("array length mismatch");for(let at=0;at<ot.length;at++){const ct=ot[at];Y.default.isLong(ct)?st[at]=H(ct,et.dataType):st[at]=ct}}return it}static fromData(et,tt,nt){return new te(tt,nt,void 0,void 0,et)}static fromOrtTensor(et){if(!et)throw new Error("cannot construct Value from an empty tensor");const tt=xe.ProtoUtil.tensorDimsFromORTFormat(et),nt=xe.ProtoUtil.tensorDataTypeFromProto(et.dataType()),it=new te(tt,nt);if(nt==="string")for(let ot=0;ot<et.stringDataLength();ot++)it.data[ot]=et.stringData(ot);else if(et.rawDataArray()&&typeof et.rawDataLength()=="number"&&et.rawDataLength()>0){const ot=it.data,st=new DataView(et.rawDataArray().buffer,et.rawDataArray().byteOffset,et.rawDataLength()),at=f(et.dataType()),ct=et.rawDataLength()/at;if(et.rawDataLength()%at!=0)throw new Error("invalid buffer length");if(ot.length!==ct)throw new Error("buffer length mismatch");for(let ft=0;ft<ct;ft++){const ut=Z(st,et.dataType(),ft*at);ot[ft]=ut}}return it}}function f(Ye){switch(Ye){case R.onnx.TensorProto.DataType.UINT8:case R.onnx.TensorProto.DataType.INT8:case R.onnx.TensorProto.DataType.BOOL:return 1;case R.onnx.TensorProto.DataType.UINT16:case R.onnx.TensorProto.DataType.INT16:return 2;case R.onnx.TensorProto.DataType.FLOAT:case R.onnx.TensorProto.DataType.INT32:case R.onnx.TensorProto.DataType.UINT32:return 4;case R.onnx.TensorProto.DataType.INT64:case R.onnx.TensorProto.DataType.DOUBLE:case R.onnx.TensorProto.DataType.UINT64:return 8;default:throw new Error(`cannot calculate sizeof() on type ${R.onnx.TensorProto.DataType[Ye]}`)}}function d(Ye){switch(Ye){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw new Error("unspecified error")}}function H(Ye,et){if(et===R.onnx.TensorProto.DataType.INT64||et===ne.TensorDataType.INT64){if(Ye.greaterThanOrEqual(2147483648)||Ye.lessThan(-2147483648))throw new TypeError("int64 is not supported")}else{if(et!==R.onnx.TensorProto.DataType.UINT32&&et!==ne.TensorDataType.UINT32&&et!==R.onnx.TensorProto.DataType.UINT64&&et!==ne.TensorDataType.UINT64)throw new TypeError(`not a LONG type: ${R.onnx.TensorProto.DataType[et]}`);if(Ye.greaterThanOrEqual(4294967296)||Ye.lessThan(0))throw new TypeError("uint64 is not supported")}return Ye.toNumber()}function Z(Ye,et,tt){switch(et){case R.onnx.TensorProto.DataType.BOOL:case R.onnx.TensorProto.DataType.UINT8:return Ye.getUint8(tt);case R.onnx.TensorProto.DataType.INT8:return Ye.getInt8(tt);case R.onnx.TensorProto.DataType.UINT16:return Ye.getUint16(tt,!0);case R.onnx.TensorProto.DataType.INT16:return Ye.getInt16(tt,!0);case R.onnx.TensorProto.DataType.FLOAT:return Ye.getFloat32(tt,!0);case R.onnx.TensorProto.DataType.INT32:return Ye.getInt32(tt,!0);case R.onnx.TensorProto.DataType.UINT32:return Ye.getUint32(tt,!0);case R.onnx.TensorProto.DataType.INT64:return H(Y.default.fromBits(Ye.getUint32(tt,!0),Ye.getUint32(tt+4,!0),!1),et);case R.onnx.TensorProto.DataType.DOUBLE:return Ye.getFloat64(tt,!0);case R.onnx.TensorProto.DataType.UINT64:return H(Y.default.fromBits(Ye.getUint32(tt,!0),Ye.getUint32(tt+4,!0),!0),et);default:throw new Error(`cannot read from DataView for type ${R.onnx.TensorProto.DataType[et]}`)}}a.Tensor=te},2517:function(g,a,l){var A=this&&this.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(a,"__esModule",{value:!0}),a.decodeUtf8String=a.MAX_CLIP=a.MIN_CLIP=a.PoolConvUtil=a.ReduceUtil=a.SplitUtil=a.MathUtil=a.ShapeUtil=a.LongUtil=a.ProtoUtil=a.GemmUtil=a.arrayCopyHelper=a.BroadcastUtil=a.MatMulUtil=a.ArrayUtil=a.assert=a.checkInputsShape=void 0;const O=l(5686),Y=A(l(3720)),R=l(1446),ee=l(9162);a.checkInputsShape=function(et,...tt){if(!et||et.length!==tt.length)return!1;for(let nt=0;nt<et.length;nt++)if(!et[nt].dims||et[nt].dims.length!==tt[nt])return!1;return!0},a.assert=function(et,tt){if(!et)throw new Error(typeof tt=="string"?tt:tt())},a.ArrayUtil=class{static arraysEqual(et,tt){if(et.length!==tt.length)return!1;for(let nt=0;nt<et.length;nt++)if(et[nt]!==tt[nt])return!1;return!0}};class xe{static preprocessInputShapes(tt,nt){return[tt.length===1?[1,tt[0]]:tt,nt.length===1?[nt[0],1]:nt]}static postprocessOutputShape(tt,nt,it){nt===1&&tt.splice(tt.length-2,1),it===1&&tt.pop()}static calcMatMulShape(tt,nt){return tt[1]!==nt[0]?void 0:[tt[0],nt[1]]}}a.MatMulUtil=xe;class ne{static calcShape(tt,nt,it=!1){const ot=tt.length,st=nt.length;if(ot===0)return nt;if(st===0)return tt;const at=Math.max(tt.length,nt.length),ct=new Array(at);if(it){if(ot<2||st<2)return;const ft=xe.calcMatMulShape([tt[ot-2],tt[ot-1]],[nt[st-2],nt[st-1]]);if(ft===void 0)return;[ct[at-2],ct[at-1]]=ft}for(let ft=it?3:1;ft<=at;ft++){const ut=ot-ft<0?1:tt[ot-ft],_t=st-ft<0?1:nt[st-ft];if(ut!==_t&&ut>1&&_t>1)return;ct[at-ft]=Math.max(ut,_t)}return ct}static index(tt,nt){const it=new Array(nt.length);return ne.fillIndex(tt,nt,it),it}static fillIndex(tt,nt,it){const ot=tt.length-nt.length;for(let st=0;st<nt.length;st++)it[st]=tt[ot+st]%nt[st]}static calc(tt,nt,it,ot,st){const at=ne.calcShape(tt.dims,nt.dims);if(at){if(ot&&!d.areEqual(at,tt.dims))return;const ct=d.size(at),ft=ot?tt:new ee.Tensor(at,st||tt.type);if(at.length===0)ft.set([],it(tt.get([]),nt.get([])));else{const ut=new Array(at.length),_t=new Array(tt.dims.length),At=new Array(nt.dims.length);let Et,Mt=0,Ot=0,kt=!1,yt=!1;tt.dims.length===0&&(Mt=tt.get([]),kt=!0),nt.dims.length===0&&(Ot=nt.get([]),yt=!0);for(let St=0;St<ct;St++){Et=St;for(let Yt=at.length-1;Yt>=0;Yt--)ut[Yt]=Et%at[Yt],Et=Math.floor(Et/at[Yt]);kt||(ne.fillIndex(ut,tt.dims,_t),Mt=tt.get(_t)),yt||(ne.fillIndex(ut,nt.dims,At),Ot=nt.get(At)),ft.set(ut,it(Mt,Ot))}}return ft}}static isValidBroadcast(tt,nt){const it=tt.length,ot=nt.length;if(it>ot)return!1;for(let st=1;st<=it;st++)if(tt[it-st]!==1&&tt[it-st]!==nt[ot-st])return!1;return!0}static getBroadcastDims(tt,nt){const it=tt.length,ot=[];for(let st=0;st<it;st++){const at=it-1-st,ct=tt[at]||1;(nt[nt.length-1-st]||1)>1&&ct===1&&ot.unshift(at)}return ot}}a.BroadcastUtil=ne,a.arrayCopyHelper=function(et,tt,nt,it,ot){if(it<0||it>=tt.length)throw new Error("sourceIndex out of bounds");if(nt<0||nt>=et.length)throw new Error("targetIndex out of bounds");if(it+ot>tt.length)throw new Error("source indices to be copied are outside bounds");if(nt+ot>et.length)throw new Error("target array is too small to hold result");for(let st=0;st<ot;st++)et[nt+st]=tt[it+st]},a.GemmUtil=class{static getShapeOfGemmResult(et,tt,nt,it,ot){if(et.length!==2||nt.length!==2)throw new Error("shape need to be of size 2");let st,at,ct;tt?(st=et[1],at=et[0]):(st=et[0],at=et[1]);let ft=-1;if(it?(ct=nt[0],ft=1):(ct=nt[1],ft=0),nt[ft]!==at)throw new Error("dimension mismatch");if(st<=0||ct<=0||at<=0)throw new Error("invalid shape specified");if(ot&&!ne.isValidBroadcast(ot,[st,ct]))throw new Error("gemm: invalid bias shape for broadcast");return[st,ct,at]}};class te{static tensorDataTypeFromProto(tt){switch(tt){case R.onnx.TensorProto.DataType.INT8:return"int8";case R.onnx.TensorProto.DataType.UINT8:return"uint8";case R.onnx.TensorProto.DataType.BOOL:return"bool";case R.onnx.TensorProto.DataType.INT16:return"int16";case R.onnx.TensorProto.DataType.UINT16:return"uint16";case R.onnx.TensorProto.DataType.INT32:return"int32";case R.onnx.TensorProto.DataType.UINT32:return"uint32";case R.onnx.TensorProto.DataType.FLOAT:return"float32";case R.onnx.TensorProto.DataType.DOUBLE:return"float64";case R.onnx.TensorProto.DataType.STRING:return"string";case R.onnx.TensorProto.DataType.INT64:return"int32";case R.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw new Error(`unsupported data type: ${R.onnx.TensorProto.DataType[tt]}`)}}static tensorDataTypeStringToEnum(tt){switch(tt){case"int8":return R.onnx.TensorProto.DataType.INT8;case"uint8":return R.onnx.TensorProto.DataType.UINT8;case"bool":return R.onnx.TensorProto.DataType.BOOL;case"int16":return R.onnx.TensorProto.DataType.INT16;case"uint16":return R.onnx.TensorProto.DataType.UINT16;case"int32":return R.onnx.TensorProto.DataType.INT32;case"uint32":return R.onnx.TensorProto.DataType.UINT32;case"float32":return R.onnx.TensorProto.DataType.FLOAT;case"float64":return R.onnx.TensorProto.DataType.DOUBLE;case"string":return R.onnx.TensorProto.DataType.STRING;case"int64":return R.onnx.TensorProto.DataType.INT64;case"uint64":return R.onnx.TensorProto.DataType.UINT64;default:throw new Error(`unsupported data type: ${tt}`)}}static tensorDimsFromProto(tt){return tt.map((nt=>Y.default.isLong(nt)?nt.toNumber():nt))}static tensorValueTypeFromProto(tt){return{tensorType:te.tensorDataTypeFromProto(tt.elemType),shape:{dims:te.tensorDimsFromProto(tt.shape.dim.map((nt=>nt.dimValue)))}}}static tensorDimsFromORTFormat(tt){const nt=[];for(let it=0;it<tt.dimsLength();it++)nt.push(f.longToNumber(tt.dims(it)));return nt}static tensorAttributesFromORTFormat(tt){const nt=[];for(let it=0;it<tt.attributesLength();it++)nt.push(tt.attributes(it));return nt}}a.ProtoUtil=te;class f{static longToNumber(tt,nt){return Y.default.isLong(tt)?tt.toNumber():tt instanceof O.flatbuffers.Long?Y.default.fromValue({low:tt.low,high:tt.high,unsigned:nt!=null&&nt}).toNumber():tt}static isLong(tt){return Y.default.isLong(tt)||tt instanceof O.flatbuffers.Long}}a.LongUtil=f;class d{static size(tt){return d.getSizeFromDimensionRange(tt,0,tt.length)}static sizeFromDimension(tt,nt){if(nt<0||nt>tt.length)throw new Error(`invalid dimension of ${nt} for sizeFromDimension as Tensor has ${tt.length} dimensions.`);return d.getSizeFromDimensionRange(tt,nt,tt.length)}static sizeToDimension(tt,nt){if(nt<0||nt>tt.length)throw new Error(`invalid dimension of ${nt} for sizeToDimension as Tensor has ${tt.length} dimensions.`);return d.getSizeFromDimensionRange(tt,0,nt)}static getSizeFromDimensionRange(tt,nt,it){let ot=1;for(let st=nt;st<it;st++){if(tt[st]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");ot*=tt[st]}return ot}static computeStrides(tt){const nt=tt.length;if(nt===0)return[];if(nt===1)return[1];const it=new Array(nt);it[nt-1]=1,it[nt-2]=tt[nt-1];for(let ot=nt-3;ot>=0;--ot)it[ot]=it[ot+1]*tt[ot+1];return it}static transpose(tt){return tt.slice().reverse()}static indicesToOffset(tt,nt,it){it===void 0&&(it=tt.length);let ot=0;for(let st=0;st<it;++st)ot+=nt[st]*tt[st];return ot}static offsetToIndices(tt,nt){const it=nt.length;if(it===0)return[];if(it===1)return[tt*nt[0]];const ot=new Array(nt.length);for(let st=0;st<ot.length-1;++st)ot[st]=Math.floor(tt/nt[st]),tt-=ot[st]*nt[st];return ot[ot.length-1]=tt,ot}static normalizeAxis(tt,nt){if(tt<-nt&&tt>=nt)throw new Error("unsupported axis for this operation.");return tt<0?tt+nt:tt}static normalizeAxes(tt,nt){return tt.map((it=>this.normalizeAxis(it,nt)))}static incrementIndex(tt,nt,it){if(nt.length===0||tt.length===0)throw new Error("Index incrementing unsupported for scalar Tensor");if(it===void 0)it=nt.length;else if(it<=0||it>nt.length)throw new Error("Incorrect axis to increment on");for(let ot=it-1;ot>=0&&(tt[ot]++,!(tt[ot]<nt[ot]));--ot)tt[ot]=0}static calculateReshapedDims(tt,nt){if(nt.length===0){if(tt.length===0||d.size(tt)===1)return[];throw new Error("cannot reshape to a scalar Tensor")}const it=nt.length,ot=new Array(it);let st=-1,at=1;for(let ft=0;ft<it;ft++){if(nt[ft]<-1)throw new Error("a dimension in shape hints cannot be less than -1");if(nt[ft]===-1){if(st!==-1)throw new Error("at most one dimension in shape hints can be -1");st=ft}else{if(nt[ft]===0){if(ft>=tt.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");ot[ft]=tt[ft]}else ot[ft]=nt[ft];at*=ot[ft]}}const ct=d.size(tt);if(st!==-1){if(ct%at!=0)throw new Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${tt}] Output shape: [${nt}]`);ot[st]=ct/at}else if(at!==ct)throw new Error("reshapedDims and originalDims don't have matching sizes");return ot}static sortBasedOnPerm(tt,nt){return nt?nt.map((it=>tt[it])):tt.slice().reverse()}static padShape(tt,nt){const it=tt.length;return tt.map(((ot,st)=>ot+nt[st]+nt[st+it]))}static areEqual(tt,nt){return tt.length===nt.length&&tt.every(((it,ot)=>it===nt[ot]))}static validateDimsAndCalcSize(tt){if(tt.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");let nt=1;for(const it of tt){if(!Number.isInteger(it))throw new TypeError(`Invalid shape: ${it} is not an integer`);if(it<0||it>2147483647)throw new TypeError(`Invalid shape: length ${it} is not allowed`);nt*=it}return nt}static flattenShape(tt,nt){nt<0&&(nt+=tt.length);const it=tt.reduce(((st,at)=>st*at),1),ot=tt.slice(nt).reduce(((st,at)=>st*at),1);return[it/ot,ot]}static squeezeShape(tt,nt){const it=new Array;nt=d.normalizeAxes(nt,tt.length);for(let ot=0;ot<tt.length;ot++){const st=nt.indexOf(ot)>=0;if(st&&tt[ot]!==1)throw new Error("squeeze an axis of size different than 1");(nt.length===0&&tt[ot]>1||nt.length>0&&!st)&&it.push(tt[ot])}return it}static unsqueezeShape(tt,nt){const it=new Array(tt.length+nt.length);it.fill(0);for(let st=0;st<nt.length;st++){const at=d.normalizeAxis(nt[st],it.length);if(at>=it.length)throw new Error("'axes' has an out of range axis");if(it[at]!==0)throw new Error("'axes' has a duplicate axis");it[at]=1}let ot=0;for(let st=0;st<it.length;st++)it[st]===0&&(it[st]=tt[ot++]);if(ot!==tt.length)throw new Error("the unsqueezed dimension could not be established");return it}}a.ShapeUtil=d,a.MathUtil=class{static sqr(et,tt,nt,it,ot){if(it<0||it>=tt.length)throw new Error("sourceIndex out of bounds");if(nt<0||nt>=et.length)throw new Error("targetIndex out of bounds");if(it+ot>tt.length)throw new Error("source indices to be copied are outside bounds");if(nt+ot>et.length)throw new Error("target array is too small to hold result");for(let st=0;st<ot;st++)et[nt+st]+=Math.pow(tt[it+st],2)}static axpy(et,tt,nt,it,ot,st){if(it<0||it>=tt.length)throw new Error("sourceIndex out of bounds");if(nt<0||nt>=et.length)throw new Error("targetIndex out of bounds");if(it+ot>tt.length)throw new Error("source indices to be copied are outside bounds");if(nt+ot>et.length)throw new Error("target array is too small to hold result");for(let at=0;at<ot;at++)et[nt+at]+=st*tt[it+at]}static powx(et,tt,nt,it,ot,st){if(it<0||it>=tt.length)throw new Error("sourceIndex out of bounds");if(nt<0||nt>=et.length)throw new Error("targetIndex out of bounds");if(it+ot>tt.length)throw new Error("source indices to be copied are outside bounds");if(nt+ot>et.length)throw new Error("target array is too small to hold result");for(let at=0;at<ot;at++)et[nt+at]=Math.pow(tt[it+at],st)}static mul(et,tt,nt,it,ot){if(it<0||it>=tt.length)throw new Error("sourceIndex out of bounds");if(nt<0||nt>=et.length)throw new Error("targetIndex out of bounds");if(it+ot>tt.length)throw new Error("source indices to be copied are outside bounds");if(nt+ot>et.length)throw new Error("target array is too small to hold result");for(let st=0;st<ot;st++)et[nt+st]=tt[it+st]*et[nt+st]}};class H{static splitShape(tt,nt,it,ot){if(it.length===0){if(!ot)throw new Error("need to know number of outputs when the 'split' attribute is not specified");H.determineSplit(tt[nt],ot,it)}const st=[],at=[0];for(let ct=0;ct<it.length;++ct){ct!==0&&at.push(at[ct-1]+it[ct-1]);const ft=tt.slice();ft[nt]=it[ct],st.push(ft)}return[st,at]}static determineSplit(tt,nt,it){if(tt%nt!=0)throw new Error("cannot split tensor to equal sized parts");for(let ot=0;ot<nt;++ot)it.push(tt/nt)}}a.SplitUtil=H;class Z{static calcReduce(tt,nt,it,ot,st){const at=tt.dims.slice(0);nt.length===0&&at.forEach(((Mt,Ot)=>nt.push(Ot)));const ct=Z.calcReduceShape(at,nt,!0),ft=d.size(ct),ut=new ee.Tensor(ct,tt.type),_t=d.computeStrides(ct),At=d.computeStrides(at),Et=new Array(at.length);for(let Mt=0;Mt<ft;Mt++){const Ot=d.offsetToIndices(Mt,_t);ne.fillIndex(Ot,at,Et),ut.set(Ot,Z.calcReduceByAxis(tt.numberData,nt,at,0,d.indicesToOffset(Et,At),ot,st))}return it?ut:new ee.Tensor(Z.calcReduceShape(at,nt,it),ut.type,void 0,void 0,ut.data,ut.dataId)}static calcReduceByAxis(tt,nt,it,ot,st,at,ct){let ft=0;if(ot>=nt.length)return at(tt[st]);const ut=nt[ot],_t=ut>=it.length?1:d.size(it.slice(ut+1));for(let At=0;At<it[ut];At++)ft=At===0?Z.calcReduceByAxis(tt,nt,it,ot+1,st,at,ct):ct(ft,Z.calcReduceByAxis(tt,nt,it,ot+1,st,at,ct)),st+=_t;return ft}static calcReduceShape(tt,nt,it){const ot=tt.slice();for(let st=0;st<nt.length;st++)ot[nt[st]]=it?1:0;return ot.filter((st=>st!==0))}}a.ReduceUtil=Z;class Ye{static adjustPoolAttributes(tt,nt,it,ot,st,at){if(!tt&&it.length!==nt.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(tt)for(let ct=0;ct<nt.length-2;ct++)ct>=it.length?it.push(nt[ct+2]):it[ct]=nt[ct+2];for(let ct=0;ct<it.length;ct++)if(ct<ot.length){if(ot[ct]<0)throw new Error("strides should be greater than or equal to 1")}else ot.push(1);for(let ct=0;ct<it.length;ct++)if(ct<st.length){if(st[ct]<0)throw new Error("dilations should be greater than or equal to 1")}else st.push(1);for(let ct=0;ct<2*it.length;ct++)if(ct<at.length){if(at[ct]<0)throw new Error("pad should be greater than or equal to 1")}else at.push(0);for(let ct=0;ct<it.length;ct++){if(it[ct]<=0)throw new Error("kernel shapes need to be greater than 0");if(at[ct]>=it[ct]||at[ct+it.length]>=it[ct])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(tt,nt,it,ot,st,at){if(at){if(st.length!==2*(tt.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(nt.length!==tt.length-2)throw new Error("length of strides should be the length of data dimensions");if(ot.length!==tt.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let ct=0;ct<tt.length-2;ct++)Ye.adjustPadAndReturnShape(tt[ct+2],nt[ct],it[ct],ot[ct],st,ct,ct+tt.length-2,at)}}static computePoolOutputShape(tt,nt,it,ot,st,at,ct){if(nt.length<=0)throw new Error("input shape must be of size greater than 0");const ft=[nt[0],nt[1]];return Ye.computeShapeHelper(tt,nt,ft,it,ot,st,at,ct),ft}static computeConvOutputShape(tt,nt,it,ot,st,at,ct){if(tt.length<=0||nt.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");const ft=[tt[0],nt[0]];return Ye.computeShapeHelper(!1,tt,ft,it,ot,st,at,ct),ft}static computeShapeHelper(tt,nt,it,ot,st,at,ct,ft){if(tt)for(let ut=0;ut<nt.length-2;ut++)it.push(1);else for(let ut=0;ut<nt.length-2;ut++)it.push(Ye.adjustPadAndReturnShape(nt[ut+2],ot[ut],st[ut],at[ut],ct,ut,ut+nt.length-2,ft))}static adjustPadAndReturnShape(tt,nt,it,ot,st,at,ct,ft){const ut=it*(ot-1)+1;if(!ft||ft==="NOTSET")return Math.floor((tt+st[at]+st[ct]-ut)/nt+1);switch(ft){case"VALID":return st[at]=0,st[ct]=0,Math.floor((tt-ut)/nt+1);case"SAME_LOWER":case"SAME_UPPER":if(it!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{const _t=((tt+nt-1)/nt-1)*nt+ot-tt;return st[at]=Math.floor(ft==="SAME_LOWER"?(_t+1)/2:_t/2),st[ct]=_t-st[at],Math.floor((tt+_t-ot)/nt+1)}default:throw new Error("Unsupported AutoPad type")}}}a.PoolConvUtil=Ye,a.MIN_CLIP=-34028234663852886e22,a.MAX_CLIP=34028234663852886e22,a.decodeUtf8String=function(et){return new TextDecoder().decode(et)}},7967:(g,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.iterateExtraOptions=void 0,a.iterateExtraOptions=(l,A,O,Y)=>{if(typeof l=="object"&&l!==null){if(O.has(l))throw new Error("Circular reference in options");O.add(l)}Object.entries(l).forEach((([R,ee])=>{const xe=A?A+R:R;if(typeof ee=="object")(0,a.iterateExtraOptions)(ee,xe+".",O,Y);else if(typeof ee=="string"||typeof ee=="number")Y(xe,ee.toString());else{if(typeof ee!="boolean")throw new Error("Can't handle extra config type: "+typeof ee);Y(xe,ee?"1":"0")}}))}},2157:function(g,a,l){var A,O=this&&this.__createBinding||(Object.create?function(_t,At,Et,Mt){Mt===void 0&&(Mt=Et);var Ot=Object.getOwnPropertyDescriptor(At,Et);Ot&&!("get"in Ot?!At.__esModule:Ot.writable||Ot.configurable)||(Ot={enumerable:!0,get:function(){return At[Et]}}),Object.defineProperty(_t,Mt,Ot)}:function(_t,At,Et,Mt){Mt===void 0&&(Mt=Et),_t[Mt]=At[Et]}),Y=this&&this.__setModuleDefault||(Object.create?function(_t,At){Object.defineProperty(_t,"default",{enumerable:!0,value:At})}:function(_t,At){_t.default=At}),R=this&&this.__importStar||function(_t){if(_t&&_t.__esModule)return _t;var At={};if(_t!=null)for(var Et in _t)Et!=="default"&&Object.prototype.hasOwnProperty.call(_t,Et)&&O(At,_t,Et);return Y(At,_t),At};Object.defineProperty(a,"__esModule",{value:!0}),a.endProfiling=a.run=a.releaseSession=a.createSession=a.createSessionFinalize=a.createSessionAllocate=a.initOrt=a.initWasm=void 0;const ee=l(1670),xe=R(l(349)),ne=l(6361),te=()=>!!ee.env.wasm.proxy&&typeof document<"u";let f,d,H,Z=!1,Ye=!1,et=!1;const tt=[],nt=[],it=[],ot=[],st=[],at=[],ct=()=>{if(Z||!Ye||et||!f)throw new Error("worker not ready")},ft=_t=>{switch(_t.data.type){case"init-wasm":Z=!1,_t.data.err?(et=!0,d[1](_t.data.err)):(Ye=!0,d[0]());break;case"init-ort":_t.data.err?H[1](_t.data.err):H[0]();break;case"create_allocate":_t.data.err?tt.shift()[1](_t.data.err):tt.shift()[0](_t.data.out);break;case"create_finalize":_t.data.err?nt.shift()[1](_t.data.err):nt.shift()[0](_t.data.out);break;case"create":_t.data.err?it.shift()[1](_t.data.err):it.shift()[0](_t.data.out);break;case"release":_t.data.err?ot.shift()[1](_t.data.err):ot.shift()[0]();break;case"run":_t.data.err?st.shift()[1](_t.data.err):st.shift()[0](_t.data.out);break;case"end-profiling":_t.data.err?at.shift()[1](_t.data.err):at.shift()[0]()}},ut=typeof document<"u"?(A=document?.currentScript)===null||A===void 0?void 0:A.src:void 0;a.initWasm=async()=>{if(te()){if(Ye)return;if(Z)throw new Error("multiple calls to 'initWasm()' detected.");if(et)throw new Error("previous call to 'initWasm()' failed.");return Z=!0,ee.env.wasm.wasmPaths===void 0&&ut&&ut.indexOf("blob:")!==0&&(ee.env.wasm.wasmPaths=ut.substr(0,+ut.lastIndexOf("/")+1)),new Promise(((_t,At)=>{f?.terminate(),f=l(9710).Z(),f.onmessage=ft,d=[_t,At];const Et={type:"init-wasm",in:ee.env.wasm};f.postMessage(Et)}))}return(0,ne.initializeWebAssembly)(ee.env.wasm)},a.initOrt=async(_t,At)=>{if(te())return ct(),new Promise(((Et,Mt)=>{H=[Et,Mt];const Ot={type:"init-ort",in:{numThreads:_t,loggingLevel:At}};f.postMessage(Ot)}));xe.initOrt(_t,At)},a.createSessionAllocate=async _t=>te()?(ct(),new Promise(((At,Et)=>{tt.push([At,Et]);const Mt={type:"create_allocate",in:{model:_t}};f.postMessage(Mt,[_t.buffer])}))):xe.createSessionAllocate(_t),a.createSessionFinalize=async(_t,At)=>te()?(ct(),new Promise(((Et,Mt)=>{nt.push([Et,Mt]);const Ot={type:"create_finalize",in:{modeldata:_t,options:At}};f.postMessage(Ot)}))):xe.createSessionFinalize(_t,At),a.createSession=async(_t,At)=>te()?(ct(),new Promise(((Et,Mt)=>{it.push([Et,Mt]);const Ot={type:"create",in:{model:_t,options:At}};f.postMessage(Ot,[_t.buffer])}))):xe.createSession(_t,At),a.releaseSession=async _t=>{if(te())return ct(),new Promise(((At,Et)=>{ot.push([At,Et]);const Mt={type:"release",in:_t};f.postMessage(Mt)}));xe.releaseSession(_t)},a.run=async(_t,At,Et,Mt,Ot)=>te()?(ct(),new Promise(((kt,yt)=>{st.push([kt,yt]);const St={type:"run",in:{sessionId:_t,inputIndices:At,inputs:Et,outputIndices:Mt,options:Ot}};f.postMessage(St,xe.extractTransferableBuffers(Et))}))):xe.run(_t,At,Et,Mt,Ot),a.endProfiling=async _t=>{if(te())return ct(),new Promise(((At,Et)=>{at.push([At,Et]);const Mt={type:"end-profiling",in:_t};f.postMessage(Mt)}));xe.endProfiling(_t)}},586:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.setRunOptions=void 0;const A=l(7967),O=l(4983),Y=l(6361);a.setRunOptions=R=>{const ee=(0,Y.getInstance)();let xe=0;const ne=[],te=R||{};try{if(R?.logSeverityLevel===void 0)te.logSeverityLevel=2;else if(typeof R.logSeverityLevel!="number"||!Number.isInteger(R.logSeverityLevel)||R.logSeverityLevel<0||R.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${R.logSeverityLevel}`);if(R?.logVerbosityLevel===void 0)te.logVerbosityLevel=0;else if(typeof R.logVerbosityLevel!="number"||!Number.isInteger(R.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${R.logVerbosityLevel}`);R?.terminate===void 0&&(te.terminate=!1);let f=0;if(R?.tag!==void 0&&(f=(0,O.allocWasmString)(R.tag,ne)),xe=ee._OrtCreateRunOptions(te.logSeverityLevel,te.logVerbosityLevel,!!te.terminate,f),xe===0)throw new Error("Can't create run options");return R?.extra!==void 0&&(0,A.iterateExtraOptions)(R.extra,"",new WeakSet,((d,H)=>{const Z=(0,O.allocWasmString)(d,ne),Ye=(0,O.allocWasmString)(H,ne);if(ee._OrtAddRunConfigEntry(xe,Z,Ye)!==0)throw new Error(`Can't set a run config entry: ${d} - ${H}`)})),[xe,ne]}catch(f){throw xe!==0&&ee._OrtReleaseRunOptions(xe),ne.forEach(ee._free),f}}},2306:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.OnnxruntimeWebAssemblySessionHandler=void 0;const A=l(2806),O=l(1670),Y=l(2850),R=l(2157);let ee;a.OnnxruntimeWebAssemblySessionHandler=class{async createSessionAllocate(xe){const ne=await fetch(xe),te=await ne.arrayBuffer();return(0,R.createSessionAllocate)(new Uint8Array(te))}async loadModel(xe,ne){if(ee||(await(0,R.initOrt)(O.env.wasm.numThreads,(te=>{switch(te){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${te}`)}})(O.env.logLevel)),ee=!0),typeof xe=="string")if(typeof fetch>"u"){const te=await(0,Y.promisify)(A.readFile)(xe);[this.sessionId,this.inputNames,this.outputNames]=await(0,R.createSession)(te,ne)}else{const te=await this.createSessionAllocate(xe);[this.sessionId,this.inputNames,this.outputNames]=await(0,R.createSessionFinalize)(te,ne)}else[this.sessionId,this.inputNames,this.outputNames]=await(0,R.createSession)(xe,ne)}async dispose(){return(0,R.releaseSession)(this.sessionId)}async run(xe,ne,te){const f=[],d=[];Object.entries(xe).forEach((et=>{const tt=et[0],nt=et[1],it=this.inputNames.indexOf(tt);if(it===-1)throw new Error(`invalid input '${tt}'`);f.push(nt),d.push(it)}));const H=[];Object.entries(ne).forEach((et=>{const tt=et[0],nt=this.outputNames.indexOf(tt);if(nt===-1)throw new Error(`invalid output '${tt}'`);H.push(nt)}));const Z=await(0,R.run)(this.sessionId,d,f.map((et=>[et.type,et.dims,et.data])),H,te),Ye={};for(let et=0;et<Z.length;et++)Ye[this.outputNames[H[et]]]=new O.Tensor(Z[et][0],Z[et][2],Z[et][1]);return Ye}startProfiling(){}endProfiling(){(0,R.endProfiling)(this.sessionId)}}},4919:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.setSessionOptions=void 0;const A=l(7967),O=l(4983),Y=l(6361);a.setSessionOptions=R=>{const ee=(0,Y.getInstance)();let xe=0;const ne=[],te=R||{};(f=>{f.extra||(f.extra={}),f.extra.session||(f.extra.session={});const d=f.extra.session;d.use_ort_model_bytes_directly||(d.use_ort_model_bytes_directly="1")})(te);try{R?.graphOptimizationLevel===void 0&&(te.graphOptimizationLevel="all");const f=(Z=>{switch(Z){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${Z}`)}})(te.graphOptimizationLevel);R?.enableCpuMemArena===void 0&&(te.enableCpuMemArena=!0),R?.enableMemPattern===void 0&&(te.enableMemPattern=!0),R?.executionMode===void 0&&(te.executionMode="sequential");const d=(Z=>{switch(Z){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${Z}`)}})(te.executionMode);let H=0;if(R?.logId!==void 0&&(H=(0,O.allocWasmString)(R.logId,ne)),R?.logSeverityLevel===void 0)te.logSeverityLevel=2;else if(typeof R.logSeverityLevel!="number"||!Number.isInteger(R.logSeverityLevel)||R.logSeverityLevel<0||R.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${R.logSeverityLevel}`);if(R?.logVerbosityLevel===void 0)te.logVerbosityLevel=0;else if(typeof R.logVerbosityLevel!="number"||!Number.isInteger(R.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${R.logVerbosityLevel}`);if(R?.enableProfiling===void 0&&(te.enableProfiling=!1),xe=ee._OrtCreateSessionOptions(f,!!te.enableCpuMemArena,!!te.enableMemPattern,d,!!te.enableProfiling,0,H,te.logSeverityLevel,te.logVerbosityLevel),xe===0)throw new Error("Can't create session options");return R?.executionProviders&&((Z,Ye,et)=>{for(const tt of Ye){let nt=typeof tt=="string"?tt:tt.name;switch(nt){case"xnnpack":nt="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${nt}`)}const it=(0,O.allocWasmString)(nt,et);if((0,Y.getInstance)()._OrtAppendExecutionProvider(Z,it)!==0)throw new Error(`Can't append execution provider: ${nt}`)}})(xe,R.executionProviders,ne),R?.extra!==void 0&&(0,A.iterateExtraOptions)(R.extra,"",new WeakSet,((Z,Ye)=>{const et=(0,O.allocWasmString)(Z,ne),tt=(0,O.allocWasmString)(Ye,ne);if(ee._OrtAddSessionConfigEntry(xe,et,tt)!==0)throw new Error(`Can't set a session config entry: ${Z} - ${Ye}`)})),[xe,ne]}catch(f){throw xe!==0&&ee._OrtReleaseSessionOptions(xe),ne.forEach(ee._free),f}}},4983:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.allocWasmString=void 0;const A=l(6361);a.allocWasmString=(O,Y)=>{const R=(0,A.getInstance)(),ee=R.lengthBytesUTF8(O)+1,xe=R._malloc(ee);return R.stringToUTF8(O,xe,ee),Y.push(xe),xe}},349:(g,a,l)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.extractTransferableBuffers=a.endProfiling=a.run=a.releaseSession=a.createSession=a.createSessionFinalize=a.createSessionAllocate=a.initOrt=void 0;const A=l(586),O=l(4919),Y=l(4983),R=l(6361);a.initOrt=(f,d)=>{const H=(0,R.getInstance)()._OrtInit(f,d);if(H!==0)throw new Error(`Can't initialize onnxruntime. error code = ${H}`)};const ee=new Map;a.createSessionAllocate=f=>{const d=(0,R.getInstance)(),H=d._malloc(f.byteLength);return d.HEAPU8.set(f,H),[H,f.byteLength]},a.createSessionFinalize=(f,d)=>{const H=(0,R.getInstance)();let Z=0,Ye=0,et=[];try{if([Ye,et]=(0,O.setSessionOptions)(d),Z=H._OrtCreateSession(f[0],f[1],Ye),Z===0)throw new Error("Can't create a session")}finally{H._free(f[0]),H._OrtReleaseSessionOptions(Ye),et.forEach(H._free)}const tt=H._OrtGetInputCount(Z),nt=H._OrtGetOutputCount(Z),it=[],ot=[],st=[],at=[];for(let ct=0;ct<tt;ct++){const ft=H._OrtGetInputName(Z,ct);if(ft===0)throw new Error("Can't get an input name");ot.push(ft),it.push(H.UTF8ToString(ft))}for(let ct=0;ct<nt;ct++){const ft=H._OrtGetOutputName(Z,ct);if(ft===0)throw new Error("Can't get an output name");at.push(ft),st.push(H.UTF8ToString(ft))}return ee.set(Z,[Z,ot,at]),[Z,it,st]},a.createSession=(f,d)=>{const H=(0,a.createSessionAllocate)(f);return(0,a.createSessionFinalize)(H,d)},a.releaseSession=f=>{const d=(0,R.getInstance)(),H=ee.get(f);if(!H)throw new Error("invalid session id");const Z=H[0],Ye=H[1],et=H[2];Ye.forEach(d._OrtFree),et.forEach(d._OrtFree),d._OrtReleaseSession(Z),ee.delete(f)};const xe=f=>{switch(f){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${f}`)}},ne=f=>{switch(f){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${f}`)}},te=f=>{switch(f){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${f}`)}};a.run=(f,d,H,Z,Ye)=>{const et=(0,R.getInstance)(),tt=ee.get(f);if(!tt)throw new Error("invalid session id");const nt=tt[0],it=tt[1],ot=tt[2],st=d.length,at=Z.length;let ct=0,ft=[];const ut=[],_t=[];try{[ct,ft]=(0,A.setRunOptions)(Ye);for(let yt=0;yt<st;yt++){const St=H[yt][0],Yt=H[yt][1],Ft=H[yt][2];let ln,dn;if(Array.isArray(Ft)){dn=4*Ft.length,ln=et._malloc(dn),_t.push(ln);let hn=ln/4;for(let _n=0;_n<Ft.length;_n++){if(typeof Ft[_n]!="string")throw new TypeError(`tensor data at index ${_n} is not a string`);et.HEAPU32[hn++]=(0,Y.allocWasmString)(Ft[_n],_t)}}else dn=Ft.byteLength,ln=et._malloc(dn),_t.push(ln),et.HEAPU8.set(new Uint8Array(Ft.buffer,Ft.byteOffset,dn),ln);const Pt=et.stackSave(),$t=et.stackAlloc(4*Yt.length);try{let hn=$t/4;Yt.forEach((On=>et.HEAP32[hn++]=On));const _n=et._OrtCreateTensor(xe(St),ln,dn,$t,Yt.length);if(_n===0)throw new Error("Can't create a tensor");ut.push(_n)}finally{et.stackRestore(Pt)}}const At=et.stackSave(),Et=et.stackAlloc(4*st),Mt=et.stackAlloc(4*st),Ot=et.stackAlloc(4*at),kt=et.stackAlloc(4*at);try{let yt=Et/4,St=Mt/4,Yt=Ot/4,Ft=kt/4;for(let Pt=0;Pt<st;Pt++)et.HEAPU32[yt++]=ut[Pt],et.HEAPU32[St++]=it[d[Pt]];for(let Pt=0;Pt<at;Pt++)et.HEAPU32[Yt++]=0,et.HEAPU32[Ft++]=ot[Z[Pt]];let ln=et._OrtRun(nt,Mt,Et,st,kt,at,Ot,ct);const dn=[];if(ln===0)for(let Pt=0;Pt<at;Pt++){const $t=et.HEAPU32[Ot/4+Pt],hn=et.stackSave(),_n=et.stackAlloc(16);let On,En=0;try{if(ln=et._OrtGetTensorData($t,_n,_n+4,_n+8,_n+12),ln!==0)throw new Error(`Can't access output tensor data. error code = ${ln}`);let qt=_n/4;const Jt=et.HEAPU32[qt++];En=et.HEAPU32[qt++];const Wt=et.HEAPU32[qt++],un=et.HEAPU32[qt++],fn=[];for(let Zt=0;Zt<un;Zt++)fn.push(et.HEAPU32[Wt/4+Zt]);et._OrtFree(Wt);const pn=fn.length===0?1:fn.reduce(((Zt,mn)=>Zt*mn));if(On=ne(Jt),On==="string"){const Zt=[];let mn=En/4;for(let Tn=0;Tn<pn;Tn++){const $n=et.HEAPU32[mn++],Un=Tn===pn-1?void 0:et.HEAPU32[mn]-$n;Zt.push(et.UTF8ToString($n,Un))}dn.push([On,fn,Zt])}else{const Zt=new(te(On))(pn);new Uint8Array(Zt.buffer,Zt.byteOffset,Zt.byteLength).set(et.HEAPU8.subarray(En,En+Zt.byteLength)),dn.push([On,fn,Zt])}}finally{et.stackRestore(hn),On==="string"&&En&&et._free(En),et._OrtReleaseTensor($t)}}if(ln===0)return dn;throw new Error(`failed to call OrtRun(). error code = ${ln}.`)}finally{et.stackRestore(At)}}finally{ut.forEach(et._OrtReleaseTensor),_t.forEach(et._free),et._OrtReleaseRunOptions(ct),ft.forEach(et._free)}},a.endProfiling=f=>{const d=(0,R.getInstance)(),H=ee.get(f);if(!H)throw new Error("invalid session id");const Z=H[0],Ye=d._OrtEndProfiling(Z);if(Ye===0)throw new Error("Can't get an profile file name");d._OrtFree(Ye)},a.extractTransferableBuffers=f=>{const d=[];for(const H of f){const Z=H[2];!Array.isArray(Z)&&Z.buffer&&d.push(Z.buffer)}return d}},6361:function(g,a,l){var A=this&&this.__createBinding||(Object.create?function(Ye,et,tt,nt){nt===void 0&&(nt=tt);var it=Object.getOwnPropertyDescriptor(et,tt);it&&!("get"in it?!et.__esModule:it.writable||it.configurable)||(it={enumerable:!0,get:function(){return et[tt]}}),Object.defineProperty(Ye,nt,it)}:function(Ye,et,tt,nt){nt===void 0&&(nt=tt),Ye[nt]=et[tt]}),O=this&&this.__setModuleDefault||(Object.create?function(Ye,et){Object.defineProperty(Ye,"default",{enumerable:!0,value:et})}:function(Ye,et){Ye.default=et}),Y=this&&this.__importStar||function(Ye){if(Ye&&Ye.__esModule)return Ye;var et={};if(Ye!=null)for(var tt in Ye)tt!=="default"&&Object.prototype.hasOwnProperty.call(Ye,tt)&&A(et,Ye,tt);return O(et,Ye),et},R=this&&this.__importDefault||function(Ye){return Ye&&Ye.__esModule?Ye:{default:Ye}};Object.defineProperty(a,"__esModule",{value:!0}),a.dispose=a.getInstance=a.initializeWebAssembly=void 0;const ee=Y(l(6449)),xe=R(l(932)),ne=l(3474);let te,f=!1,d=!1,H=!1;const Z=(Ye,et)=>et?Ye?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":Ye?"ort-wasm-simd.wasm":"ort-wasm.wasm";a.initializeWebAssembly=async Ye=>{if(f)return Promise.resolve();if(d)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(H)throw new Error("previous call to 'initializeWebAssembly()' failed.");d=!0;const et=Ye.initTimeout,tt=Ye.numThreads,nt=Ye.simd,it=tt>1&&(()=>{try{return typeof SharedArrayBuffer<"u"&&(typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch{return!1}})(),ot=nt&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}})(),st=typeof Ye.wasmPaths=="string"?Ye.wasmPaths:void 0,at=Z(!1,it),ct=Z(ot,it),ft=typeof Ye.wasmPaths=="object"?Ye.wasmPaths[ct]:void 0;let ut=!1;const _t=[];if(et>0&&_t.push(new Promise((At=>{setTimeout((()=>{ut=!0,At()}),et)}))),_t.push(new Promise(((At,Et)=>{const Mt=it?ne:xe.default,Ot={locateFile:(kt,yt)=>it&&kt.endsWith(".worker.js")&&typeof Blob<"u"?URL.createObjectURL(new Blob([l(4154)],{type:"text/javascript"})):kt===at?ft??(st??yt)+ct:yt+kt};if(it)if(typeof Blob>"u")Ot.mainScriptUrlOrBlob=ee.join("/","ort-wasm-threaded.js");else{const kt=`var ortWasmThreaded=(function(){var _scriptDir;return ${Mt.toString()}})();`;Ot.mainScriptUrlOrBlob=new Blob([kt],{type:"text/javascript"})}Mt(Ot).then((kt=>{d=!1,f=!0,te=kt,At()}),(kt=>{d=!1,H=!0,Et(kt)}))}))),await Promise.race(_t),ut)throw new Error(`WebAssembly backend initializing failed due to timeout: ${et}ms`)},a.getInstance=()=>{if(f&&te)return te;throw new Error("WebAssembly is not initialized yet.")},a.dispose=()=>{var Ye;!f||d||H||(d=!0,(Ye=te.PThread)===null||Ye===void 0||Ye.terminateAllThreads(),te=void 0,d=!1,f=!1,H=!0)}},9710:(g,a,l)=>{l.d(a,{Z:()=>Y});var A=l(477),O=l.n(A);function Y(){return O()('/*!\n* ONNX Runtime Web v1.14.0\n* Copyright (c) Microsoft Corporation. All rights reserved.\n* Licensed under the MIT License.\n*/\n(()=>{var t={474:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){function e(){return j.buffer!=D&&N(j.buffer),P}function r(){return j.buffer!=D&&N(j.buffer),U}function a(){return j.buffer!=D&&N(j.buffer),F}function i(){return j.buffer!=D&&N(j.buffer),I}function o(){return j.buffer!=D&&N(j.buffer),W}var u,c,s;t=t||{},u||(u=void 0!==t?t:{}),u.ready=new Promise((function(t,e){c=t,s=e}));var l,f,p,h,d,y,b=Object.assign({},u),m="./this.program",g=(t,e)=>{throw e},v="object"==typeof window,w="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,O=u.ENVIRONMENT_IS_PTHREAD||!1,A="";function S(t){return u.locateFile?u.locateFile(t,A):A+t}if(_){let e;A=w?n(908).dirname(A)+"/":"//",y=()=>{d||(h=n(384),d=n(908))},l=function(t,e){return y(),t=d.normalize(t),h.readFileSync(t,e?void 0:"utf8")},p=t=>((t=l(t,!0)).buffer||(t=new Uint8Array(t)),t),f=(t,e,n)=>{y(),t=d.normalize(t),h.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(m=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof ct))throw t})),process.on("unhandledRejection",(function(t){throw t})),g=(t,e)=>{if(Q())throw process.exitCode=t,e;e instanceof ct||x("exiting due to exception: "+e),process.exit(t)},u.inspect=function(){return"[Emscripten Module object]"};try{e=n(925)}catch(t){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),t}n.g.Worker=e.Worker}else(v||w)&&(w?A=self.location.href:"undefined"!=typeof document&&document.currentScript&&(A=document.currentScript.src),_scriptDir&&(A=_scriptDir),A=0!==A.indexOf("blob:")?A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):"",_||(l=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},w&&(p=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)}));_&&"undefined"==typeof performance&&(n.g.performance=n(953).performance);var T=console.log.bind(console),E=console.warn.bind(console);_&&(y(),T=t=>h.writeSync(1,t+"\\n"),E=t=>h.writeSync(2,t+"\\n"));var M,C=u.print||T,x=u.printErr||E;Object.assign(u,b),b=null,u.thisProgram&&(m=u.thisProgram),u.quit&&(g=u.quit),u.wasmBinary&&(M=u.wasmBinary);var R=u.noExitRuntime||!1;"object"!=typeof WebAssembly&&at("no native wasm support detected");var j,k,D,P,U,F,I,W,H=!1,L="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function z(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&L)return L.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,n):t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function Y(t,e){return(t>>>=0)?z(r(),t,e):""}function B(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function G(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function N(t){D=t,u.HEAP8=P=new Int8Array(t),u.HEAP16=new Int16Array(t),u.HEAP32=F=new Int32Array(t),u.HEAPU8=U=new Uint8Array(t),u.HEAPU16=new Uint16Array(t),u.HEAPU32=I=new Uint32Array(t),u.HEAPF32=new Float32Array(t),u.HEAPF64=W=new Float64Array(t)}O&&(D=u.buffer);var V=u.INITIAL_MEMORY||16777216;if(O)j=u.wasmMemory,D=u.buffer;else if(u.wasmMemory)j=u.wasmMemory;else if(!((j=new WebAssembly.Memory({initial:V/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw x("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");j&&(D=j.buffer),V=D.byteLength,N(D);var $,q=[],X=[],J=[],Z=[];function Q(){return R||!1}function K(){var t=u.preRun.shift();q.unshift(t)}var tt,et=0,nt=null,rt=null;function at(t){throw O?postMessage({cmd:"onAbort",arg:t}):u.onAbort&&u.onAbort(t),x(t="Aborted("+t+")"),H=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),s(t),t}function it(){return tt.startsWith("data:application/octet-stream;base64,")}function ot(){var t=tt;try{if(t==tt&&M)return new Uint8Array(M);if(p)return p(t);throw"both async and sync fetching of the wasm failed"}catch(t){at(t)}}tt="ort-wasm-threaded.wasm",it()||(tt=S(tt));var ut={};function ct(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function st(t){(t=ht.Vb[t])||at(),ht.mc(t)}function lt(t){var e=ht.Cc();if(!e)return 6;ht.ac.push(e),ht.Vb[t.Ub]=e,e.Ub=t.Ub;var n={cmd:"run",start_routine:t.Ic,arg:t.zc,pthread_ptr:t.Ub};return e.$b=()=>{n.time=performance.now(),e.postMessage(n,t.Nc)},e.loaded&&(e.$b(),delete e.$b),0}function ft(t){if(O)return $t(1,1,t);Q()||(ht.oc(),u.onExit&&u.onExit(t),H=!0),g(t,new ct(t))}function pt(t,e){if(!e&&O)throw bt(t),"unwind";Q()||O||(me(),dt(J),be(0),re[1].length&&ae(1,10),re[2].length&&ae(2,10),ht.oc()),ft(t)}var ht={Yb:[],ac:[],qc:[],Vb:{},fc:function(){O&&ht.Ec()},Pc:function(){},Ec:function(){ht.receiveObjectTransfer=ht.Gc,ht.threadInitTLS=ht.pc,ht.setExitStatus=ht.nc,R=!1},nc:function(){},oc:function(){for(var t of Object.values(ht.Vb))ht.mc(t);for(t of ht.Yb)t.terminate();ht.Yb=[]},mc:function(t){var e=t.Ub;delete ht.Vb[e],ht.Yb.push(t),ht.ac.splice(ht.ac.indexOf(t),1),t.Ub=0,Oe(e)},Gc:function(){},pc:function(){ht.qc.forEach((t=>t()))},Fc:function(t,e){t.onmessage=n=>{var r=(n=n.data).cmd;if(t.Ub&&(ht.Bc=t.Ub),n.targetThread&&n.targetThread!=he()){var a=ht.Vb[n.Qc];a?a.postMessage(n,n.transferList):x(\'Internal error! Worker sent a message "\'+r+\'" to target pthread \'+n.targetThread+", but that thread no longer exists!")}else"processProxyingQueue"===r?zt(n.queue):"spawnThread"===r?lt(n):"cleanupThread"===r?st(n.thread):"killThread"===r?(n=n.thread,r=ht.Vb[n],delete ht.Vb[n],r.terminate(),Oe(n),ht.ac.splice(ht.ac.indexOf(r),1),r.Ub=0):"cancelThread"===r?ht.Vb[n.thread].postMessage({cmd:"cancel"}):"loaded"===r?(t.loaded=!0,e&&e(t),t.$b&&(t.$b(),delete t.$b)):"print"===r?C("Thread "+n.threadId+": "+n.text):"printErr"===r?x("Thread "+n.threadId+": "+n.text):"alert"===r?alert("Thread "+n.threadId+": "+n.text):"setimmediate"===n.target?t.postMessage(n):"onAbort"===r?u.onAbort&&u.onAbort(n.arg):r&&x("worker sent an unknown command "+r);ht.Bc=void 0},t.onerror=t=>{throw x("worker sent an error! "+t.filename+":"+t.lineno+": "+t.message),t},_&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){}))),t.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||_scriptDir,wasmMemory:j,wasmModule:k})},yc:function(){var t=S("ort-wasm-threaded.worker.js");ht.Yb.push(new Worker(t))},Cc:function(){return 0==ht.Yb.length&&(ht.yc(),ht.Fc(ht.Yb[0])),ht.Yb.pop()}};function dt(t){for(;0<t.length;)t.shift()(u)}function yt(t){var e=Ee();return t=t(),Me(e),t}function bt(t){if(O)return $t(2,0,t);try{pt(t)}catch(t){t instanceof ct||"unwind"==t||g(1,t)}}u.PThread=ht,u.establishStackSpace=function(){var t=he(),e=a()[t+44>>2>>>0];t=a()[t+48>>2>>>0],Te(e,e-t),Me(e)};var mt=[];function gt(t){var e=mt[t];return e||(t>=mt.length&&(mt.length=t+1),mt[t]=e=$.get(t)),e}u.invokeEntryPoint=function(t,e){t=gt(t)(e),Q()?ht.nc(t):Ae(t)};var vt,wt,_t=[],Ot=0,At=0;function St(t){this.Zb=t,this.Sb=t-24,this.xc=function(t){i()[this.Sb+4>>2>>>0]=t},this.bc=function(){return i()[this.Sb+4>>2>>>0]},this.wc=function(t){i()[this.Sb+8>>2>>>0]=t},this.Dc=function(){return i()[this.Sb+8>>2>>>0]},this.rc=function(){a()[this.Sb>>2>>>0]=0},this.hc=function(t){t=t?1:0,e()[this.Sb+12>>0>>>0]=t},this.uc=function(){return 0!=e()[this.Sb+12>>0>>>0]},this.ic=function(t){t=t?1:0,e()[this.Sb+13>>0>>>0]=t},this.kc=function(){return 0!=e()[this.Sb+13>>0>>>0]},this.fc=function(t,e){this.cc(0),this.xc(t),this.wc(e),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(a(),this.Sb>>2,1)},this.Hc=function(){return 1===Atomics.sub(a(),this.Sb>>2,1)},this.cc=function(t){i()[this.Sb+16>>2>>>0]=t},this.tc=function(){return i()[this.Sb+16>>2>>>0]},this.vc=function(){if(Re(this.bc()))return i()[this.Zb>>2>>>0];var t=this.tc();return 0!==t?t:this.Zb}}function Tt(t){return ye(new St(t).Sb)}function Et(t,e,n,r){return O?$t(3,1,t,e,n,r):Mt(t,e,n,r)}function Mt(t,e,n,r){if("undefined"==typeof SharedArrayBuffer)return x("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];return O&&0===a.length?Et(t,e,n,r):(t={Ic:n,Ub:t,zc:r,Nc:a},O?(t.Oc="spawnThread",postMessage(t,a),0):lt(t))}function Ct(t,e,n){return O?$t(4,1,t,e,n):0}function xt(t,e){if(O)return $t(5,1,t,e)}function Rt(t,e){if(O)return $t(6,1,t,e)}function jt(t,e,n){if(O)return $t(7,1,t,e,n)}function kt(t,e,n){return O?$t(8,1,t,e,n):0}function Dt(t,e){if(O)return $t(9,1,t,e)}function Pt(t,e,n){if(O)return $t(10,1,t,e,n)}function Ut(t,e,n,r){if(O)return $t(11,1,t,e,n,r)}function Ft(t,e,n,r){if(O)return $t(12,1,t,e,n,r)}function It(t,e,n,r){if(O)return $t(13,1,t,e,n,r)}function Wt(t){if(O)return $t(14,1,t)}function Ht(t,e){if(O)return $t(15,1,t,e)}function Lt(t,e,n){if(O)return $t(16,1,t,e,n)}function zt(t){Atomics.store(a(),t>>2,1),he()&&_e(t),Atomics.compareExchange(a(),t>>2,1,0)}function Yt(t){return i()[t>>>2]+4294967296*a()[t+4>>>2]}function Bt(t,e,n,r,a,i){return O?$t(17,1,t,e,n,r,a,i):-52}function Gt(t,e,n,r,a,i){if(O)return $t(18,1,t,e,n,r,a,i)}function Nt(t){var n=G(t)+1,r=de(n);return r&&B(t,e(),r,n),r}function Vt(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}if(O)return $t(19,1,t,e,n);var o=(new Date).getFullYear(),u=new Date(o,0,1),c=new Date(o,6,1);o=u.getTimezoneOffset();var s=c.getTimezoneOffset(),l=Math.max(o,s);a()[t>>2>>>0]=60*l,a()[e>>2>>>0]=Number(o!=s),t=r(u),e=r(c),t=Nt(t),e=Nt(e),s<o?(i()[n>>2>>>0]=t,i()[n+4>>2>>>0]=e):(i()[n>>2>>>0]=e,i()[n+4>>2>>>0]=t)}function $t(t,e){var n=arguments.length-2,r=arguments;return yt((()=>{for(var a=Ce(8*n),i=a>>3,u=0;u<n;u++){var c=r[2+u];o()[i+u>>>0]=c}return we(t,n,a,e)}))}u.executeNotifiedProxyingQueue=zt,wt=_?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:O?()=>performance.now()-u.__performance_now_clock_drift:()=>performance.now();var qt,Xt=[],Jt={};function Zt(){if(!qt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in Jt)void 0===Jt[t]?delete e[t]:e[t]=Jt[t];var n=[];for(t in e)n.push(t+"="+e[t]);qt=n}return qt}function Qt(t,n){if(O)return $t(20,1,t,n);var r=0;return Zt().forEach((function(a,o){var u=n+r;for(o=i()[t+4*o>>2>>>0]=u,u=0;u<a.length;++u)e()[o++>>0>>>0]=a.charCodeAt(u);e()[o>>0>>>0]=0,r+=a.length+1})),0}function Kt(t,e){if(O)return $t(21,1,t,e);var n=Zt();i()[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),i()[e>>2>>>0]=r,0}function te(t){return O?$t(22,1,t):52}function ee(t,e,n,r){return O?$t(23,1,t,e,n,r):52}function ne(t,e,n,r,a){return O?$t(24,1,t,e,n,r,a):70}var re=[null,[],[]];function ae(t,e){var n=re[t];0===e||10===e?((1===t?C:x)(z(n,0)),n.length=0):n.push(e)}function ie(t,e,n,a){if(O)return $t(25,1,t,e,n,a);for(var o=0,u=0;u<n;u++){var c=i()[e>>2>>>0],s=i()[e+4>>2>>>0];e+=8;for(var l=0;l<s;l++)ae(t,r()[c+l>>>0]);o+=s}return i()[a>>2>>>0]=o,0}var oe=0;function ue(t){return 0==t%4&&(0!=t%100||0==t%400)}var ce=[31,29,31,30,31,30,31,31,30,31,30,31],se=[31,28,31,30,31,30,31,31,30,31,30,31];function le(t,n,r,i){function o(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function u(t,e){return o(t,e,"0")}function c(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function s(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function l(t){var e=t.Wb;for(t=new Date(new Date(t.Xb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(ue(t.getFullYear())?ce:se)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=s(new Date(t.getFullYear(),0,4)),n=s(n),0>=c(e,t)?0>=c(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var f=a()[i+40>>2>>>0];for(var p in i={Lc:a()[i>>2>>>0],Kc:a()[i+4>>2>>>0],dc:a()[i+8>>2>>>0],jc:a()[i+12>>2>>>0],ec:a()[i+16>>2>>>0],Xb:a()[i+20>>2>>>0],Tb:a()[i+24>>2>>>0],Wb:a()[i+28>>2>>>0],Rc:a()[i+32>>2>>>0],Jc:a()[i+36>>2>>>0],Mc:f?Y(f):""},r=Y(r),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(p,"g"),f[p]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="January February March April May June July August September October November December".split(" ");for(p in f={"%a":function(t){return h[t.Tb].substring(0,3)},"%A":function(t){return h[t.Tb]},"%b":function(t){return d[t.ec].substring(0,3)},"%B":function(t){return d[t.ec]},"%C":function(t){return u((t.Xb+1900)/100|0,2)},"%d":function(t){return u(t.jc,2)},"%e":function(t){return o(t.jc,2," ")},"%g":function(t){return l(t).toString().substring(2)},"%G":function(t){return l(t)},"%H":function(t){return u(t.dc,2)},"%I":function(t){return 0==(t=t.dc)?t=12:12<t&&(t-=12),u(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.ec-1;e+=(ue(t.Xb+1900)?ce:se)[n++]);return u(t.jc+e,3)},"%m":function(t){return u(t.ec+1,2)},"%M":function(t){return u(t.Kc,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.dc&&12>t.dc?"AM":"PM"},"%S":function(t){return u(t.Lc,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Tb||7},"%U":function(t){return u(Math.floor((t.Wb+7-t.Tb)/7),2)},"%V":function(t){var e=Math.floor((t.Wb+7-(t.Tb+6)%7)/7);if(2>=(t.Tb+371-t.Wb-2)%7&&e++,e)53==e&&(4==(n=(t.Tb+371-t.Wb)%7)||3==n&&ue(t.Xb)||(e=1));else{e=52;var n=(t.Tb+7-t.Wb-1)%7;(4==n||5==n&&ue(t.Xb%400-1))&&e++}return u(e,2)},"%w":function(t){return t.Tb},"%W":function(t){return u(Math.floor((t.Wb+7-(t.Tb+6)%7)/7),2)},"%y":function(t){return(t.Xb+1900).toString().substring(2)},"%Y":function(t){return t.Xb+1900},"%z":function(t){var e=0<=(t=t.Jc);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.Mc},"%%":function(){return"%"}},r=r.replace(/%%/g,"\\0\\0"),f)r.includes(p)&&(r=r.replace(new RegExp(p,"g"),f[p](i)));return p=function(t){var e=Array(G(t)+1);return B(t,e,0,e.length),e}(r=r.replace(/\\0\\0/g,"%")),p.length>n?0:(function(t,n){e().set(t,n>>>0)}(p,t),p.length-1)}ht.fc();var fe=[null,ft,bt,Et,Ct,xt,Rt,jt,kt,Dt,Pt,Ut,Ft,It,Wt,Ht,Lt,Bt,Gt,Vt,Qt,Kt,te,ee,ne,ie],pe={b:function(t){return de(t+24)+24},n:function(t){return(t=new St(t)).uc()||(t.hc(!0),Ot--),t.ic(!1),_t.push(t),t.sc(),t.vc()},ma:function(t){throw x("Unexpected exception thrown, this is not properly supported - aborting"),H=!0,t},x:function(){Se(0);var t=_t.pop();if(t.Hc()&&!t.kc()){var e=t.Dc();e&&gt(e)(t.Zb),Tt(t.Zb)}At=0},e:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},l:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},h:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},t:Tt,M:function(){var t=_t.pop();t||at("no exception to throw");var e=t.Zb;throw t.kc()||(_t.push(t),t.ic(!0),t.hc(!1),Ot++),At=e,e},c:function(t,e,n){throw new St(t).fc(e,n),At=t,Ot++,t},pa:function(){return Ot},Fa:function(t){ge(t,!w,1,!v),ht.pc()},T:function(t){O?postMessage({cmd:"cleanupThread",thread:t}):st(t)},xa:Mt,j:function(t){throw At||(At=t),t},H:Ct,Ma:xt,ua:Rt,wa:jt,oa:kt,Ka:Dt,Ca:Pt,Ja:Ut,V:Ft,va:It,sa:Wt,La:Ht,ta:Lt,Ta:function(){},X:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(t,e,n,r){if(t==e)setTimeout((()=>zt(r)));else if(O)postMessage({targetThread:t,cmd:"processProxyingQueue",queue:r});else{if(!(t=ht.Vb[t]))return;t.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},Ea:function(){return-1},Pa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getUTCSeconds(),a()[e+4>>2>>>0]=t.getUTCMinutes(),a()[e+8>>2>>>0]=t.getUTCHours(),a()[e+12>>2>>>0]=t.getUTCDate(),a()[e+16>>2>>>0]=t.getUTCMonth(),a()[e+20>>2>>>0]=t.getUTCFullYear()-1900,a()[e+24>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,a()[e+28>>2>>>0]=t},Qa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getSeconds(),a()[e+4>>2>>>0]=t.getMinutes(),a()[e+8>>2>>>0]=t.getHours(),a()[e+12>>2>>>0]=t.getDate(),a()[e+16>>2>>>0]=t.getMonth(),a()[e+20>>2>>>0]=t.getFullYear()-1900,a()[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1),r=(t.getTime()-n.getTime())/864e5|0;a()[e+28>>2>>>0]=r,a()[e+36>>2>>>0]=-60*t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset(),t=0|(r!=(n=n.getTimezoneOffset())&&t.getTimezoneOffset()==Math.min(n,r)),a()[e+32>>2>>>0]=t},Ra:function(t){var e=new Date(a()[t+20>>2>>>0]+1900,a()[t+16>>2>>>0],a()[t+12>>2>>>0],a()[t+8>>2>>>0],a()[t+4>>2>>>0],a()[t>>2>>>0],0),n=a()[t+32>>2>>>0],r=e.getTimezoneOffset(),i=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),c=Math.min(u,o);return 0>n?a()[t+32>>2>>>0]=Number(o!=u&&c==r):0<n!=(c==r)&&(o=Math.max(u,o),e.setTime(e.getTime()+6e4*((0<n?c:o)-r))),a()[t+24>>2>>>0]=e.getDay(),n=(e.getTime()-i.getTime())/864e5|0,a()[t+28>>2>>>0]=n,a()[t>>2>>>0]=e.getSeconds(),a()[t+4>>2>>>0]=e.getMinutes(),a()[t+8>>2>>>0]=e.getHours(),a()[t+12>>2>>>0]=e.getDate(),a()[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},Aa:Bt,Ba:Gt,Sa:function t(e,n,r){t.Ac||(t.Ac=!0,Vt(e,n,r))},y:function(){at("")},U:function(){if(!_&&!w){var t="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";vt||(vt={}),vt[t]||(vt[t]=1,_&&(t="warning: "+t),x(t))}},ra:function(){return 4294901760},B:wt,Ia:function(t,e,n){r().copyWithin(t>>>0,e>>>0,e+n>>>0)},F:function(){return _?n(993).cpus().length:navigator.hardwareConcurrency},Da:function(t,e,n){Xt.length=e,n>>=3;for(var r=0;r<e;r++)Xt[r]=o()[n+r>>>0];return(0>t?ut[-t-1]:fe[t]).apply(null,Xt)},qa:function(t){var e=r().length;if((t>>>=0)<=e||4294901760<t)return!1;for(var n=1;4>=n;n*=2){var a=e*(1+.2/n);a=Math.min(a,t+100663296);var i=Math;a=Math.max(t,a),i=i.min.call(i,4294901760,a+(65536-a%65536)%65536);t:{try{j.grow(i-D.byteLength+65535>>>16),N(j.buffer);var o=1;break t}catch(t){}o=void 0}if(o)return!0}return!1},Na:function(){throw"unwind"},Ga:Qt,Ha:Kt,J:pt,I:te,S:ee,ga:ne,R:ie,d:function(){return oe},na:function t(r,a){t.lc||(t.lc=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(_)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>at("randomDevice")}());for(var i=0;i<a;i++)e()[r+i>>0>>>0]=t.lc();return 0},ia:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ja:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},K:function(t){var e=Ee();try{return gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},f:function(t,e){var n=Ee();try{return gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},P:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},Q:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},k:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},p:function(t,e,n,r){var a=Ee();try{return gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},q:function(t,e,n,r,a){var i=Ee();try{return gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},N:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},s:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},w:function(t,e,n,r,a,i,o){var u=Ee();try{return gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},L:function(t,e,n,r,a,i,o,u){var c=Ee();try{return gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},E:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{return gt(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=Ee();try{return He(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},_:function(t,e,n,r,a,i,o){var u=Ee();try{return ke(t,e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},Z:function(t,e,n,r,a){var i=Ee();try{return Le(t,e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},ca:function(t,e,n,r){var a=Ee();try{return Ie(t,e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},$:function(t){var e=Ee();try{return je(t)}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},ba:function(t,e){var n=Ee();try{return We(t,e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},Y:function(t,e,n){var r=Ee();try{return De(t,e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},g:function(t){var e=Ee();try{gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},r:function(t,e){var n=Ee();try{gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},i:function(t,e,n){var r=Ee();try{gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ha:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},m:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},v:function(t,e,n,r,a){var i=Ee();try{gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},u:function(t,e,n,r,a,i){var o=Ee();try{gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},O:function(t,e,n,r,a,i,o){var u=Ee();try{gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},A:function(t,e,n,r,a,i,o,u){var c=Ee();try{gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},ka:function(t,e,n,r,a,i,o,u,c){var s=Ee();try{gt(t)(e,n,r,a,i,o,u,c)}catch(t){if(Me(s),t!==t+0)throw t;Se(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l){var f=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(Me(f),t!==t+0)throw t;Se(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(Me(b),t!==t+0)throw t;Se(1,0)}},fa:function(t,e,n,r,a,i,o,u){var c=Ee();try{Pe(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},da:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{Fe(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},ea:function(t,e,n,r,a,i){var o=Ee();try{Ue(t,e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},o:function(t){return t},a:j||u.wasmMemory,G:function(t){oe=t},la:le,z:function(t,e,n,r){return le(t,e,n,r)}};!function(){function t(t,e){u.asm=t.exports,ht.qc.push(u.asm.sb),$=u.asm.ub,X.unshift(u.asm.Va),k=e,O||(et--,u.monitorRunDependencies&&u.monitorRunDependencies(et),0==et&&(null!==nt&&(clearInterval(nt),nt=null),rt&&(t=rt,rt=null,t())))}function e(e){t(e.instance,e.module)}function n(t){return function(){if(!M&&(v||w)){if("function"==typeof fetch&&!tt.startsWith("file://"))return fetch(tt,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+tt+"\'";return t.arrayBuffer()})).catch((function(){return ot()}));if(f)return new Promise((function(t,e){f(tt,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return ot()}))}().then((function(t){return WebAssembly.instantiate(t,r)})).then((function(t){return t})).then(t,(function(t){x("failed to asynchronously prepare wasm: "+t),at(t)}))}var r={a:pe};if(O||(et++,u.monitorRunDependencies&&u.monitorRunDependencies(et)),u.instantiateWasm)try{return u.instantiateWasm(r,t)}catch(t){return x("Module.instantiateWasm callback failed with error: "+t),!1}(M||"function"!=typeof WebAssembly.instantiateStreaming||it()||tt.startsWith("file://")||_||"function"!=typeof fetch?n(e):fetch(tt,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,r).then(e,(function(t){return x("wasm streaming compile failed: "+t),x("falling back to ArrayBuffer instantiation"),n(e)}))}))).catch(s)}(),u.___wasm_call_ctors=function(){return(u.___wasm_call_ctors=u.asm.Va).apply(null,arguments)},u._OrtInit=function(){return(u._OrtInit=u.asm.Wa).apply(null,arguments)},u._OrtCreateSessionOptions=function(){return(u._OrtCreateSessionOptions=u.asm.Xa).apply(null,arguments)},u._OrtAppendExecutionProvider=function(){return(u._OrtAppendExecutionProvider=u.asm.Ya).apply(null,arguments)},u._OrtAddSessionConfigEntry=function(){return(u._OrtAddSessionConfigEntry=u.asm.Za).apply(null,arguments)},u._OrtReleaseSessionOptions=function(){return(u._OrtReleaseSessionOptions=u.asm._a).apply(null,arguments)},u._OrtCreateSession=function(){return(u._OrtCreateSession=u.asm.$a).apply(null,arguments)},u._OrtReleaseSession=function(){return(u._OrtReleaseSession=u.asm.ab).apply(null,arguments)},u._OrtGetInputCount=function(){return(u._OrtGetInputCount=u.asm.bb).apply(null,arguments)},u._OrtGetOutputCount=function(){return(u._OrtGetOutputCount=u.asm.cb).apply(null,arguments)},u._OrtGetInputName=function(){return(u._OrtGetInputName=u.asm.db).apply(null,arguments)},u._OrtGetOutputName=function(){return(u._OrtGetOutputName=u.asm.eb).apply(null,arguments)},u._OrtFree=function(){return(u._OrtFree=u.asm.fb).apply(null,arguments)},u._OrtCreateTensor=function(){return(u._OrtCreateTensor=u.asm.gb).apply(null,arguments)},u._OrtGetTensorData=function(){return(u._OrtGetTensorData=u.asm.hb).apply(null,arguments)},u._OrtReleaseTensor=function(){return(u._OrtReleaseTensor=u.asm.ib).apply(null,arguments)},u._OrtCreateRunOptions=function(){return(u._OrtCreateRunOptions=u.asm.jb).apply(null,arguments)},u._OrtAddRunConfigEntry=function(){return(u._OrtAddRunConfigEntry=u.asm.kb).apply(null,arguments)},u._OrtReleaseRunOptions=function(){return(u._OrtReleaseRunOptions=u.asm.lb).apply(null,arguments)},u._OrtRun=function(){return(u._OrtRun=u.asm.mb).apply(null,arguments)},u._OrtEndProfiling=function(){return(u._OrtEndProfiling=u.asm.nb).apply(null,arguments)};var he=u._pthread_self=function(){return(he=u._pthread_self=u.asm.ob).apply(null,arguments)},de=u._malloc=function(){return(de=u._malloc=u.asm.pb).apply(null,arguments)},ye=u._free=function(){return(ye=u._free=u.asm.qb).apply(null,arguments)},be=u._fflush=function(){return(be=u._fflush=u.asm.rb).apply(null,arguments)};u.__emscripten_tls_init=function(){return(u.__emscripten_tls_init=u.asm.sb).apply(null,arguments)};var me=u.___funcs_on_exit=function(){return(me=u.___funcs_on_exit=u.asm.tb).apply(null,arguments)},ge=u.__emscripten_thread_init=function(){return(ge=u.__emscripten_thread_init=u.asm.vb).apply(null,arguments)};u.__emscripten_thread_crashed=function(){return(u.__emscripten_thread_crashed=u.asm.wb).apply(null,arguments)};var ve,we=u._emscripten_run_in_main_runtime_thread_js=function(){return(we=u._emscripten_run_in_main_runtime_thread_js=u.asm.xb).apply(null,arguments)},_e=u.__emscripten_proxy_execute_task_queue=function(){return(_e=u.__emscripten_proxy_execute_task_queue=u.asm.yb).apply(null,arguments)},Oe=u.__emscripten_thread_free_data=function(){return(Oe=u.__emscripten_thread_free_data=u.asm.zb).apply(null,arguments)},Ae=u.__emscripten_thread_exit=function(){return(Ae=u.__emscripten_thread_exit=u.asm.Ab).apply(null,arguments)},Se=u._setThrew=function(){return(Se=u._setThrew=u.asm.Bb).apply(null,arguments)},Te=u._emscripten_stack_set_limits=function(){return(Te=u._emscripten_stack_set_limits=u.asm.Cb).apply(null,arguments)},Ee=u.stackSave=function(){return(Ee=u.stackSave=u.asm.Db).apply(null,arguments)},Me=u.stackRestore=function(){return(Me=u.stackRestore=u.asm.Eb).apply(null,arguments)},Ce=u.stackAlloc=function(){return(Ce=u.stackAlloc=u.asm.Fb).apply(null,arguments)},xe=u.___cxa_can_catch=function(){return(xe=u.___cxa_can_catch=u.asm.Gb).apply(null,arguments)},Re=u.___cxa_is_pointer_type=function(){return(Re=u.___cxa_is_pointer_type=u.asm.Hb).apply(null,arguments)},je=u.dynCall_j=function(){return(je=u.dynCall_j=u.asm.Ib).apply(null,arguments)},ke=u.dynCall_iiiiij=function(){return(ke=u.dynCall_iiiiij=u.asm.Jb).apply(null,arguments)},De=u.dynCall_jii=function(){return(De=u.dynCall_jii=u.asm.Kb).apply(null,arguments)},Pe=u.dynCall_viiiiij=function(){return(Pe=u.dynCall_viiiiij=u.asm.Lb).apply(null,arguments)},Ue=u.dynCall_vjji=function(){return(Ue=u.dynCall_vjji=u.asm.Mb).apply(null,arguments)},Fe=u.dynCall_viiijjjii=function(){return(Fe=u.dynCall_viiijjjii=u.asm.Nb).apply(null,arguments)},Ie=u.dynCall_iij=function(){return(Ie=u.dynCall_iij=u.asm.Ob).apply(null,arguments)},We=u.dynCall_ji=function(){return(We=u.dynCall_ji=u.asm.Pb).apply(null,arguments)},He=u.dynCall_iiiiiij=function(){return(He=u.dynCall_iiiiiij=u.asm.Qb).apply(null,arguments)},Le=u.dynCall_iiij=function(){return(Le=u.dynCall_iiij=u.asm.Rb).apply(null,arguments)};function ze(){function t(){if(!ve&&(ve=!0,u.calledRun=!0,!H)&&(O||dt(X),c(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),!O)){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;){var t=u.postRun.shift();Z.unshift(t)}dt(Z)}}if(!(0<et))if(O)c(u),O||dt(X),postMessage({cmd:"loaded"});else{if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)K();dt(q),0<et||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t())}}if(u.UTF8ToString=Y,u.stringToUTF8=function(t,e,n){return B(t,r(),e,n)},u.lengthBytesUTF8=G,u.keepRuntimeAlive=Q,u.wasmMemory=j,u.stackSave=Ee,u.stackRestore=Me,u.stackAlloc=Ce,u.ExitStatus=ct,u.PThread=ht,rt=function t(){ve||ze(),ve||(rt=t)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();return ze(),t.ready});t.exports=r},932:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){var e,r,a;t=t||{},e||(e=void 0!==t?t:{}),e.ready=new Promise((function(t,e){r=t,a=e}));var i,o,u,c,s,l,f=Object.assign({},e),p="./this.program",h=(t,e)=>{throw e},d="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";b?(m=y?n(908).dirname(m)+"/":"//",l=()=>{s||(c=n(384),s=n(908))},i=function(t,e){return l(),t=s.normalize(t),c.readFileSync(t,e?void 0:"utf8")},u=t=>((t=i(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,n)=>{l(),t=s.normalize(t),c.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(p=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof J))throw t})),process.on("unhandledRejection",(function(t){throw t})),h=(t,e)=>{if(_||0<L)throw process.exitCode=t,e;e instanceof J||w("exiting due to exception: "+e),process.exit(t)},e.inspect=function(){return"[Emscripten Module object]"}):(d||y)&&(y?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),_scriptDir&&(m=_scriptDir),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},y&&(u=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)});var g,v=e.print||console.log.bind(console),w=e.printErr||console.warn.bind(console);Object.assign(e,f),f=null,e.thisProgram&&(p=e.thisProgram),e.quit&&(h=e.quit),e.wasmBinary&&(g=e.wasmBinary);var _=e.noExitRuntime||!1;"object"!=typeof WebAssembly&&V("no native wasm support detected");var O,A,S,T,E,M,C=!1,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&x)return x.decode(t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function j(t,e){return(t>>>=0)?R(T,t,e):""}function k(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function D(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function P(){var t=O.buffer;A=t,e.HEAP8=S=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAP32=E=new Int32Array(t),e.HEAPU8=T=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}var U,F=[],I=[],W=[],H=[],L=0;function z(){var t=e.preRun.shift();F.unshift(t)}var Y,B=0,G=null,N=null;function V(t){throw e.onAbort&&e.onAbort(t),w(t="Aborted("+t+")"),C=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),a(t),t}function $(){return Y.startsWith("data:application/octet-stream;base64,")}if(Y="ort-wasm.wasm",!$()){var q=Y;Y=e.locateFile?e.locateFile(q,m):m+q}function X(){var t=Y;try{if(t==Y&&g)return new Uint8Array(g);if(u)return u(t);throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function J(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function Z(t){for(;0<t.length;)t.shift()(e)}var Q=[],K=0,tt=0;function et(t){this.Db=t,this.zb=t-24,this.Ub=function(t){M[this.zb+4>>2>>>0]=t},this.Eb=function(){return M[this.zb+4>>2>>>0]},this.Sb=function(t){M[this.zb+8>>2>>>0]=t},this.Wb=function(){return M[this.zb+8>>2>>>0]},this.Tb=function(){E[this.zb>>2>>>0]=0},this.Ib=function(t){S[this.zb+12>>0>>>0]=t?1:0},this.Pb=function(){return 0!=S[this.zb+12>>0>>>0]},this.Jb=function(t){S[this.zb+13>>0>>>0]=t?1:0},this.Lb=function(){return 0!=S[this.zb+13>>0>>>0]},this.Rb=function(t,e){this.Fb(0),this.Ub(t),this.Sb(e),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){E[this.zb>>2>>>0]+=1},this.Xb=function(){var t=E[this.zb>>2>>>0];return E[this.zb>>2>>>0]=t-1,1===t},this.Fb=function(t){M[this.zb+16>>2>>>0]=t},this.Ob=function(){return M[this.zb+16>>2>>>0]},this.Qb=function(){if(Mt(this.Eb()))return M[this.Db>>2>>>0];var t=this.Ob();return 0!==t?t:this.Db}}function nt(t){return vt(new et(t).zb)}var rt=[];function at(t){var e=rt[t];return e||(t>=rt.length&&(rt.length=t+1),rt[t]=e=U.get(t)),e}function it(t){var e=D(t)+1,n=gt(e);return n&&k(t,S,n,e),n}var ot={};function ut(){if(!ct){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(t in ot)void 0===ot[t]?delete e[t]:e[t]=ot[t];var n=[];for(t in e)n.push(t+"="+e[t]);ct=n}return ct}var ct,st=[null,[],[]];function lt(t,e){var n=st[t];0===e||10===e?((1===t?v:w)(R(n,0)),n.length=0):n.push(e)}var ft=0;function pt(t){return 0==t%4&&(0!=t%100||0==t%400)}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function yt(t,e,n,r){function a(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function i(t,e){return a(t,e,"0")}function o(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function u(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function c(t){var e=t.Bb;for(t=new Date(new Date(t.Cb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(pt(t.getFullYear())?ht:dt)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=u(new Date(t.getFullYear(),0,4)),n=u(n),0>=o(e,t)?0>=o(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var s=E[r+40>>2>>>0];for(var l in r={$b:E[r>>2>>>0],Zb:E[r+4>>2>>>0],Gb:E[r+8>>2>>>0],Kb:E[r+12>>2>>>0],Hb:E[r+16>>2>>>0],Cb:E[r+20>>2>>>0],Ab:E[r+24>>2>>>0],Bb:E[r+28>>2>>>0],bc:E[r+32>>2>>>0],Yb:E[r+36>>2>>>0],ac:s?j(s):""},n=j(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),s[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(l in s={"%a":function(t){return f[t.Ab].substring(0,3)},"%A":function(t){return f[t.Ab]},"%b":function(t){return p[t.Hb].substring(0,3)},"%B":function(t){return p[t.Hb]},"%C":function(t){return i((t.Cb+1900)/100|0,2)},"%d":function(t){return i(t.Kb,2)},"%e":function(t){return a(t.Kb,2," ")},"%g":function(t){return c(t).toString().substring(2)},"%G":function(t){return c(t)},"%H":function(t){return i(t.Gb,2)},"%I":function(t){return 0==(t=t.Gb)?t=12:12<t&&(t-=12),i(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.Hb-1;e+=(pt(t.Cb+1900)?ht:dt)[n++]);return i(t.Kb+e,3)},"%m":function(t){return i(t.Hb+1,2)},"%M":function(t){return i(t.Zb,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.Gb&&12>t.Gb?"AM":"PM"},"%S":function(t){return i(t.$b,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Ab||7},"%U":function(t){return i(Math.floor((t.Bb+7-t.Ab)/7),2)},"%V":function(t){var e=Math.floor((t.Bb+7-(t.Ab+6)%7)/7);if(2>=(t.Ab+371-t.Bb-2)%7&&e++,e)53==e&&(4==(n=(t.Ab+371-t.Bb)%7)||3==n&&pt(t.Cb)||(e=1));else{e=52;var n=(t.Ab+7-t.Bb-1)%7;(4==n||5==n&&pt(t.Cb%400-1))&&e++}return i(e,2)},"%w":function(t){return t.Ab},"%W":function(t){return i(Math.floor((t.Bb+7-(t.Ab+6)%7)/7),2)},"%y":function(t){return(t.Cb+1900).toString().substring(2)},"%Y":function(t){return t.Cb+1900},"%z":function(t){var e=0<=(t=t.Yb);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.ac},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),s)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),s[l](r)));return l=function(t){var e=Array(D(t)+1);return k(t,e,0,e.length),e}(n=n.replace(/\\0\\0/g,"%")),l.length>e?0:(S.set(l,t>>>0),l.length-1)}var bt={a:function(t){return gt(t+24)+24},m:function(t){return(t=new et(t)).Pb()||(t.Ib(!0),K--),t.Jb(!1),Q.push(t),t.Nb(),t.Qb()},ia:function(t){throw w("Unexpected exception thrown, this is not properly supported - aborting"),C=!0,t},w:function(){Ot(0);var t=Q.pop();if(t.Xb()&&!t.Lb()){var e=t.Wb();e&&at(e)(t.Db),nt(t.Db)}tt=0},d:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},k:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},g:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},s:nt,L:function(){var t=Q.pop();t||V("no exception to throw");var e=t.Db;throw t.Lb()||(Q.push(t),t.Jb(!0),t.Ib(!1),K++),tt=e,e},b:function(t,e,n){throw new et(t).Rb(e,n),tt=t,K++,t},la:function(){return K},i:function(t){throw tt||(tt=t),t},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getUTCSeconds(),E[e+4>>2>>>0]=t.getUTCMinutes(),E[e+8>>2>>>0]=t.getUTCHours(),E[e+12>>2>>>0]=t.getUTCDate(),E[e+16>>2>>>0]=t.getUTCMonth(),E[e+20>>2>>>0]=t.getUTCFullYear()-1900,E[e+24>>2>>>0]=t.getUTCDay(),E[e+28>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getSeconds(),E[e+4>>2>>>0]=t.getMinutes(),E[e+8>>2>>>0]=t.getHours(),E[e+12>>2>>>0]=t.getDate(),E[e+16>>2>>>0]=t.getMonth(),E[e+20>>2>>>0]=t.getFullYear()-1900,E[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1);E[e+28>>2>>>0]=(t.getTime()-n.getTime())/864e5|0,E[e+36>>2>>>0]=-60*t.getTimezoneOffset();var r=new Date(t.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),E[e+32>>2>>>0]=0|(r!=n&&t.getTimezoneOffset()==Math.min(n,r))},Fa:function(t){var e=new Date(E[t+20>>2>>>0]+1900,E[t+16>>2>>>0],E[t+12>>2>>>0],E[t+8>>2>>>0],E[t+4>>2>>>0],E[t>>2>>>0],0),n=E[t+32>>2>>>0],r=e.getTimezoneOffset(),a=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),u=Math.min(o,i);return 0>n?E[t+32>>2>>>0]=Number(i!=o&&u==r):0<n!=(u==r)&&(i=Math.max(o,i),e.setTime(e.getTime()+6e4*((0<n?u:i)-r))),E[t+24>>2>>>0]=e.getDay(),E[t+28>>2>>>0]=(e.getTime()-a.getTime())/864e5|0,E[t>>2>>>0]=e.getSeconds(),E[t+4>>2>>>0]=e.getMinutes(),E[t+8>>2>>>0]=e.getHours(),E[t+12>>2>>>0]=e.getDate(),E[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function t(e,n,r){t.Vb||(t.Vb=!0,function(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}var a=(new Date).getFullYear(),i=new Date(a,0,1),o=new Date(a,6,1);a=i.getTimezoneOffset();var u=o.getTimezoneOffset();E[t>>2>>>0]=60*Math.max(a,u),E[e>>2>>>0]=Number(a!=u),t=r(i),e=r(o),t=it(t),e=it(e),u<a?(M[n>>2>>>0]=t,M[n+4>>2>>>0]=e):(M[n>>2>>>0]=e,M[n+4>>2>>>0]=t)}(e,n,r))},B:function(){V("")},ma:function(){return 4294901760},I:b?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:()=>performance.now(),xa:function(t,e,n){T.copyWithin(t>>>0,e>>>0,e+n>>>0)},G:function(t){var e=T.length;if(4294901760<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var a=Math;r=Math.max(t,r),a=a.min.call(a,4294901760,r+(65536-r%65536)%65536);t:{try{O.grow(a-A.byteLength+65535>>>16),P();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},va:function(t,e){var n=0;return ut().forEach((function(r,a){var i=e+n;for(a=M[t+4*a>>2>>>0]=i,i=0;i<r.length;++i)S[a++>>0>>>0]=r.charCodeAt(i);S[a>>0>>>0]=0,n+=r.length+1})),0},wa:function(t,e){var n=ut();M[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),M[e>>2>>>0]=r,0},ba:function(t){_||0<L||(_t(),Z(W),wt(0),st[1].length&&lt(1,10),st[2].length&&lt(2,10)),_||0<L||(e.onExit&&e.onExit(t),C=!0),h(t,new J(t))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(t,e,n,r){for(var a=0,i=0;i<n;i++){var o=M[e>>2>>>0],u=M[e+4>>2>>>0];e+=8;for(var c=0;c<u;c++)lt(t,T[o+c>>>0]);a+=u}return M[r>>2>>>0]=a,0},c:function(){return ft},ja:function t(e,r){t.Mb||(t.Mb=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(b)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>V("randomDevice")}());for(var a=0;a<r;a++)S[e+a>>0>>>0]=t.Mb();return 0},ea:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},fa:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},J:function(t){var e=At();try{return at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},e:function(t,e){var n=At();try{return at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},N:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},O:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},j:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},o:function(t,e,n,r){var a=At();try{return at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},p:function(t,e,n,r,a){var i=At();try{return at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},M:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},r:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},v:function(t,e,n,r,a,i,o){var u=At();try{return at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},K:function(t,e,n,r,a,i,o,u){var c=At();try{return at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{return at(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},X:function(t,e,n,r,a,i,o,u){var c=At();try{return Ft(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},V:function(t,e,n,r,a,i,o){var u=At();try{return xt(t,e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},U:function(t,e,n,r,a){var i=At();try{return It(t,e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},Z:function(t,e,n,r){var a=At();try{return Pt(t,e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},W:function(t){var e=At();try{return Ct(t)}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},Y:function(t,e){var n=At();try{return Ut(t,e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},T:function(t,e,n){var r=At();try{return Rt(t,e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},f:function(t){var e=At();try{at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},q:function(t,e){var n=At();try{at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},h:function(t,e,n){var r=At();try{at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},da:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},l:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},t:function(t,e,n,r,a){var i=At();try{at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},u:function(t,e,n,r,a,i){var o=At();try{at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},x:function(t,e,n,r,a,i,o){var u=At();try{at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},z:function(t,e,n,r,a,i,o,u){var c=At();try{at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},ga:function(t,e,n,r,a,i,o,u,c){var s=At();try{at(t)(e,n,r,a,i,o,u,c)}catch(t){if(St(s),t!==t+0)throw t;Ot(1,0)}},A:function(t,e,n,r,a,i,o,u,c,s,l){var f=At();try{at(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(St(f),t!==t+0)throw t;Ot(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=At();try{at(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(St(b),t!==t+0)throw t;Ot(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=At();try{jt(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},_:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{Dt(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},$:function(t,e,n,r,a,i){var o=At();try{kt(t,e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},n:function(t){return t},F:function(t){ft=t},ha:yt,y:function(t,e,n,r){return yt(t,e,n,r)}};!function(){function t(t){e.asm=t.exports,O=e.asm.Ka,P(),U=e.asm.ib,I.unshift(e.asm.La),B--,e.monitorRunDependencies&&e.monitorRunDependencies(B),0==B&&(null!==G&&(clearInterval(G),G=null),N&&(t=N,N=null,t()))}function n(e){t(e.instance)}function r(t){return function(){if(!g&&(d||y)){if("function"==typeof fetch&&!Y.startsWith("file://"))return fetch(Y,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+Y+"\'";return t.arrayBuffer()})).catch((function(){return X()}));if(o)return new Promise((function(t,e){o(Y,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return X()}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){w("failed to asynchronously prepare wasm: "+t),V(t)}))}var i={a:bt};if(B++,e.monitorRunDependencies&&e.monitorRunDependencies(B),e.instantiateWasm)try{return e.instantiateWasm(i,t)}catch(t){return w("Module.instantiateWasm callback failed with error: "+t),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||$()||Y.startsWith("file://")||b||"function"!=typeof fetch?r(n):fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(n,(function(t){return w("wasm streaming compile failed: "+t),w("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.La).apply(null,arguments)},e._OrtInit=function(){return(e._OrtInit=e.asm.Ma).apply(null,arguments)},e._OrtCreateSessionOptions=function(){return(e._OrtCreateSessionOptions=e.asm.Na).apply(null,arguments)},e._OrtAppendExecutionProvider=function(){return(e._OrtAppendExecutionProvider=e.asm.Oa).apply(null,arguments)},e._OrtAddSessionConfigEntry=function(){return(e._OrtAddSessionConfigEntry=e.asm.Pa).apply(null,arguments)},e._OrtReleaseSessionOptions=function(){return(e._OrtReleaseSessionOptions=e.asm.Qa).apply(null,arguments)},e._OrtCreateSession=function(){return(e._OrtCreateSession=e.asm.Ra).apply(null,arguments)},e._OrtReleaseSession=function(){return(e._OrtReleaseSession=e.asm.Sa).apply(null,arguments)},e._OrtGetInputCount=function(){return(e._OrtGetInputCount=e.asm.Ta).apply(null,arguments)},e._OrtGetOutputCount=function(){return(e._OrtGetOutputCount=e.asm.Ua).apply(null,arguments)},e._OrtGetInputName=function(){return(e._OrtGetInputName=e.asm.Va).apply(null,arguments)},e._OrtGetOutputName=function(){return(e._OrtGetOutputName=e.asm.Wa).apply(null,arguments)},e._OrtFree=function(){return(e._OrtFree=e.asm.Xa).apply(null,arguments)},e._OrtCreateTensor=function(){return(e._OrtCreateTensor=e.asm.Ya).apply(null,arguments)},e._OrtGetTensorData=function(){return(e._OrtGetTensorData=e.asm.Za).apply(null,arguments)},e._OrtReleaseTensor=function(){return(e._OrtReleaseTensor=e.asm._a).apply(null,arguments)},e._OrtCreateRunOptions=function(){return(e._OrtCreateRunOptions=e.asm.$a).apply(null,arguments)},e._OrtAddRunConfigEntry=function(){return(e._OrtAddRunConfigEntry=e.asm.ab).apply(null,arguments)},e._OrtReleaseRunOptions=function(){return(e._OrtReleaseRunOptions=e.asm.bb).apply(null,arguments)},e._OrtRun=function(){return(e._OrtRun=e.asm.cb).apply(null,arguments)},e._OrtEndProfiling=function(){return(e._OrtEndProfiling=e.asm.db).apply(null,arguments)};var mt,gt=e._malloc=function(){return(gt=e._malloc=e.asm.eb).apply(null,arguments)},vt=e._free=function(){return(vt=e._free=e.asm.fb).apply(null,arguments)},wt=e._fflush=function(){return(wt=e._fflush=e.asm.gb).apply(null,arguments)},_t=e.___funcs_on_exit=function(){return(_t=e.___funcs_on_exit=e.asm.hb).apply(null,arguments)},Ot=e._setThrew=function(){return(Ot=e._setThrew=e.asm.jb).apply(null,arguments)},At=e.stackSave=function(){return(At=e.stackSave=e.asm.kb).apply(null,arguments)},St=e.stackRestore=function(){return(St=e.stackRestore=e.asm.lb).apply(null,arguments)},Tt=e.stackAlloc=function(){return(Tt=e.stackAlloc=e.asm.mb).apply(null,arguments)},Et=e.___cxa_can_catch=function(){return(Et=e.___cxa_can_catch=e.asm.nb).apply(null,arguments)},Mt=e.___cxa_is_pointer_type=function(){return(Mt=e.___cxa_is_pointer_type=e.asm.ob).apply(null,arguments)},Ct=e.dynCall_j=function(){return(Ct=e.dynCall_j=e.asm.pb).apply(null,arguments)},xt=e.dynCall_iiiiij=function(){return(xt=e.dynCall_iiiiij=e.asm.qb).apply(null,arguments)},Rt=e.dynCall_jii=function(){return(Rt=e.dynCall_jii=e.asm.rb).apply(null,arguments)},jt=e.dynCall_viiiiij=function(){return(jt=e.dynCall_viiiiij=e.asm.sb).apply(null,arguments)},kt=e.dynCall_vjji=function(){return(kt=e.dynCall_vjji=e.asm.tb).apply(null,arguments)},Dt=e.dynCall_viiijjjii=function(){return(Dt=e.dynCall_viiijjjii=e.asm.ub).apply(null,arguments)},Pt=e.dynCall_iij=function(){return(Pt=e.dynCall_iij=e.asm.vb).apply(null,arguments)},Ut=e.dynCall_ji=function(){return(Ut=e.dynCall_ji=e.asm.wb).apply(null,arguments)},Ft=e.dynCall_iiiiiij=function(){return(Ft=e.dynCall_iiiiiij=e.asm.xb).apply(null,arguments)},It=e.dynCall_iiij=function(){return(It=e.dynCall_iiij=e.asm.yb).apply(null,arguments)};function Wt(){function t(){if(!mt&&(mt=!0,e.calledRun=!0,!C)){if(Z(I),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();H.unshift(t)}Z(H)}}if(!(0<B)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)z();Z(F),0<B||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t())}}if(e.UTF8ToString=j,e.stringToUTF8=function(t,e,n){return k(t,T,e,n)},e.lengthBytesUTF8=D,e.stackSave=At,e.stackRestore=St,e.stackAlloc=Tt,N=function t(){mt||Wt(),mt||(N=t)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Wt(),t.ready});t.exports=r},967:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,n,r,a)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{const o=n?n+t:t;if("object"==typeof i)(0,e.iterateExtraOptions)(i,o+".",r,a);else if("string"==typeof i||"number"==typeof i)a(o,i.toString());else{if("boolean"!=typeof i)throw new Error("Can\'t handle extra config type: "+typeof i);a(o,i?"1":"0")}}))}},586:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setRunOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};try{if(void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===(null==t?void 0:t.terminate)&&(u.terminate=!1);let i=0;if(void 0!==(null==t?void 0:t.tag)&&(i=(0,a.allocWasmString)(t.tag,o)),n=e._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,i),0===n)throw new Error("Can\'t create run options");return void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddRunConfigEntry(n,i,u))throw new Error(`Can\'t set a run config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseRunOptions(n),o.forEach(e._free),t}}},919:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setSessionOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};(t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});const e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1")})(u);try{void 0===(null==t?void 0:t.graphOptimizationLevel)&&(u.graphOptimizationLevel="all");const c=(t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}})(u.graphOptimizationLevel);void 0===(null==t?void 0:t.enableCpuMemArena)&&(u.enableCpuMemArena=!0),void 0===(null==t?void 0:t.enableMemPattern)&&(u.enableMemPattern=!0),void 0===(null==t?void 0:t.executionMode)&&(u.executionMode="sequential");const s=(t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}})(u.executionMode);let l=0;if(void 0!==(null==t?void 0:t.logId)&&(l=(0,a.allocWasmString)(t.logId,o)),void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);if(void 0===(null==t?void 0:t.enableProfiling)&&(u.enableProfiling=!1),n=e._OrtCreateSessionOptions(c,!!u.enableCpuMemArena,!!u.enableMemPattern,s,!!u.enableProfiling,0,l,u.logSeverityLevel,u.logVerbosityLevel),0===n)throw new Error("Can\'t create session options");return(null==t?void 0:t.executionProviders)&&((t,e,n)=>{for(const r of e){let e="string"==typeof r?r:r.name;switch(e){case"xnnpack":e="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${e}`)}const o=(0,a.allocWasmString)(e,n);if(0!==(0,i.getInstance)()._OrtAppendExecutionProvider(t,o))throw new Error(`Can\'t append execution provider: ${e}`)}})(n,t.executionProviders,o),void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddSessionConfigEntry(n,i,u))throw new Error(`Can\'t set a session config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseSessionOptions(n),o.forEach(e._free),t}}},983:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;const r=n(361);e.allocWasmString=(t,e)=>{const n=(0,r.getInstance)(),a=n.lengthBytesUTF8(t)+1,i=n._malloc(a);return n.stringToUTF8(t,i,a),e.push(i),i}},349:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;const r=n(586),a=n(919),i=n(983),o=n(361);e.initOrt=(t,e)=>{const n=(0,o.getInstance)()._OrtInit(t,e);if(0!==n)throw new Error(`Can\'t initialize onnxruntime. error code = ${n}`)};const u=new Map;e.createSessionAllocate=t=>{const e=(0,o.getInstance)(),n=e._malloc(t.byteLength);return e.HEAPU8.set(t,n),[n,t.byteLength]},e.createSessionFinalize=(t,e)=>{const n=(0,o.getInstance)();let r=0,i=0,c=[];try{if([i,c]=(0,a.setSessionOptions)(e),r=n._OrtCreateSession(t[0],t[1],i),0===r)throw new Error("Can\'t create a session")}finally{n._free(t[0]),n._OrtReleaseSessionOptions(i),c.forEach(n._free)}const s=n._OrtGetInputCount(r),l=n._OrtGetOutputCount(r),f=[],p=[],h=[],d=[];for(let t=0;t<s;t++){const e=n._OrtGetInputName(r,t);if(0===e)throw new Error("Can\'t get an input name");p.push(e),f.push(n.UTF8ToString(e))}for(let t=0;t<l;t++){const e=n._OrtGetOutputName(r,t);if(0===e)throw new Error("Can\'t get an output name");d.push(e),h.push(n.UTF8ToString(e))}return u.set(r,[r,p,d]),[r,f,h]},e.createSession=(t,n)=>{const r=(0,e.createSessionAllocate)(t);return(0,e.createSessionFinalize)(r,n)},e.releaseSession=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=n[1],i=n[2];a.forEach(e._OrtFree),i.forEach(e._OrtFree),e._OrtReleaseSession(r),u.delete(t)};const c=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},s=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},l=t=>{switch(t){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}};e.run=(t,e,n,a,f)=>{const p=(0,o.getInstance)(),h=u.get(t);if(!h)throw new Error("invalid session id");const d=h[0],y=h[1],b=h[2],m=e.length,g=a.length;let v=0,w=[];const _=[],O=[];try{[v,w]=(0,r.setRunOptions)(f);for(let t=0;t<m;t++){const e=n[t][0],r=n[t][1],a=n[t][2];let o,u;if(Array.isArray(a)){u=4*a.length,o=p._malloc(u),O.push(o);let t=o/4;for(let e=0;e<a.length;e++){if("string"!=typeof a[e])throw new TypeError(`tensor data at index ${e} is not a string`);p.HEAPU32[t++]=(0,i.allocWasmString)(a[e],O)}}else u=a.byteLength,o=p._malloc(u),O.push(o),p.HEAPU8.set(new Uint8Array(a.buffer,a.byteOffset,u),o);const s=p.stackSave(),l=p.stackAlloc(4*r.length);try{let t=l/4;r.forEach((e=>p.HEAP32[t++]=e));const n=p._OrtCreateTensor(c(e),o,u,l,r.length);if(0===n)throw new Error("Can\'t create a tensor");_.push(n)}finally{p.stackRestore(s)}}const t=p.stackSave(),o=p.stackAlloc(4*m),u=p.stackAlloc(4*m),h=p.stackAlloc(4*g),A=p.stackAlloc(4*g);try{let n=o/4,r=u/4,i=h/4,c=A/4;for(let t=0;t<m;t++)p.HEAPU32[n++]=_[t],p.HEAPU32[r++]=y[e[t]];for(let t=0;t<g;t++)p.HEAPU32[i++]=0,p.HEAPU32[c++]=b[a[t]];let f=p._OrtRun(d,u,o,m,A,g,h,v);const w=[];if(0===f)for(let t=0;t<g;t++){const e=p.HEAPU32[h/4+t],n=p.stackSave(),r=p.stackAlloc(16);let a,i=0;try{if(f=p._OrtGetTensorData(e,r,r+4,r+8,r+12),0!==f)throw new Error(`Can\'t access output tensor data. error code = ${f}`);let t=r/4;const o=p.HEAPU32[t++];i=p.HEAPU32[t++];const u=p.HEAPU32[t++],c=p.HEAPU32[t++],h=[];for(let t=0;t<c;t++)h.push(p.HEAPU32[u/4+t]);p._OrtFree(u);const d=0===h.length?1:h.reduce(((t,e)=>t*e));if(a=s(o),"string"===a){const t=[];let e=i/4;for(let n=0;n<d;n++){const r=p.HEAPU32[e++],a=n===d-1?void 0:p.HEAPU32[e]-r;t.push(p.UTF8ToString(r,a))}w.push([a,h,t])}else{const t=new(l(a))(d);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(p.HEAPU8.subarray(i,i+t.byteLength)),w.push([a,h,t])}}finally{p.stackRestore(n),"string"===a&&i&&p._free(i),p._OrtReleaseTensor(e)}}if(0===f)return w;throw new Error(`failed to call OrtRun(). error code = ${f}.`)}finally{p.stackRestore(t)}}finally{_.forEach(p._OrtReleaseTensor),O.forEach(p._free),p._OrtReleaseRunOptions(v),w.forEach(p._free)}},e.endProfiling=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=e._OrtEndProfiling(r);if(0===a)throw new Error("Can\'t get an profile file name");e._OrtFree(a)},e.extractTransferableBuffers=t=>{const e=[];for(const n of t){const t=n[2];!Array.isArray(t)&&t.buffer&&e.push(t.buffer)}return e}},361:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return a(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;const u=i(n(449)),c=o(n(932)),s=n(474);let l,f=!1,p=!1,h=!1;const d=(t,e)=>e?t?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":t?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async t=>{if(f)return Promise.resolve();if(p)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(h)throw new Error("previous call to \'initializeWebAssembly()\' failed.");p=!0;const e=t.initTimeout,r=t.numThreads,a=t.simd,i=r>1&&(()=>{try{return"undefined"!=typeof SharedArrayBuffer&&("undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch(t){return!1}})(),o=a&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(t){return!1}})(),y="string"==typeof t.wasmPaths?t.wasmPaths:void 0,b=d(!1,i),m=d(o,i),g="object"==typeof t.wasmPaths?t.wasmPaths[m]:void 0;let v=!1;const w=[];if(e>0&&w.push(new Promise((t=>{setTimeout((()=>{v=!0,t()}),e)}))),w.push(new Promise(((t,e)=>{const r=i?s:c.default,a={locateFile:(t,e)=>i&&t.endsWith(".worker.js")&&"undefined"!=typeof Blob?URL.createObjectURL(new Blob([n(154)],{type:"text/javascript"})):t===b?null!=g?g:(null!=y?y:e)+m:e+t};if(i)if("undefined"==typeof Blob)a.mainScriptUrlOrBlob=u.join("/","ort-wasm-threaded.js");else{const t=`var ortWasmThreaded=(function(){var _scriptDir;return ${r.toString()}})();`;a.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}r(a).then((e=>{p=!1,f=!0,l=e,t()}),(t=>{p=!1,h=!0,e(t)}))}))),await Promise.race(w),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},e.getInstance=()=>{if(f&&l)return l;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var t;!f||p||h||(p=!0,null===(t=l.PThread)||void 0===t||t.terminateAllThreads(),l=void 0,p=!1,f=!1,h=!0)}},154:t=>{"use strict";t.exports=\'"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};\\n\'},384:()=>{},993:()=>{},908:()=>{},953:()=>{},925:()=>{},449:()=>{}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=n(349),e=n(361);self.onmessage=n=>{switch(n.data.type){case"init-wasm":(0,e.initializeWebAssembly)(n.data.in).then((()=>postMessage({type:"init-wasm"})),(t=>postMessage({type:"init-wasm",err:t})));break;case"init-ort":try{const{numThreads:e,loggingLevel:r}=n.data.in;(0,t.initOrt)(e,r),postMessage({type:"init-ort"})}catch(t){postMessage({type:"init-ort",err:t})}break;case"create_allocate":try{const{model:e}=n.data.in,r=(0,t.createSessionAllocate)(e);postMessage({type:"create_allocate",out:r})}catch(t){postMessage({type:"create_allocate",err:t})}break;case"create_finalize":try{const{modeldata:e,options:r}=n.data.in,a=(0,t.createSessionFinalize)(e,r);postMessage({type:"create_finalize",out:a})}catch(t){postMessage({type:"create_finalize",err:t})}break;case"create":try{const{model:e,options:r}=n.data.in,a=(0,t.createSession)(e,r);postMessage({type:"create",out:a})}catch(t){postMessage({type:"create",err:t})}break;case"release":try{const e=n.data.in;(0,t.releaseSession)(e),postMessage({type:"release"})}catch(t){postMessage({type:"release",err:t})}break;case"run":try{const{sessionId:e,inputIndices:r,inputs:a,outputIndices:i,options:o}=n.data.in,u=(0,t.run)(e,r,a,i,o);postMessage({type:"run",out:u},(0,t.extractTransferableBuffers)(u))}catch(t){postMessage({type:"run",err:t})}break;case"end-profiling":try{const e=n.data.in;(0,t.endProfiling)(e),postMessage({type:"end-profiling"})}catch(t){postMessage({type:"end-profiling",err:t})}}}})()})();\n',"Worker",void 0,void 0)}},477:g=>{g.exports=function(a,l,A,O){var Y=self||window;try{try{var R;try{R=new Y.Blob([a])}catch{(R=new(Y.BlobBuilder||Y.WebKitBlobBuilder||Y.MozBlobBuilder||Y.MSBlobBuilder)).append(a),R=R.getBlob()}var ee=Y.URL||Y.webkitURL,xe=ee.createObjectURL(R),ne=new Y[l](xe,A);return ee.revokeObjectURL(xe),ne}catch{return new Y[l]("data:application/javascript,".concat(encodeURIComponent(a)),A)}}catch{if(!O)throw Error("Inline worker is not supported");return new Y[l](O,A)}}},4154:g=>{g.exports=`"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};
`},1670:g=>{g.exports=__WEBPACK_EXTERNAL_MODULE__1670__},7067:()=>{},1296:()=>{},1384:()=>{},3993:()=>{},908:()=>{},6953:()=>{},9925:()=>{},2806:()=>{},6449:()=>{},2850:()=>{},5381:()=>{},5686:(g,a,l)=>{l.r(a),l.d(a,{flatbuffers:()=>A});var A={};A.Offset,A.Table,A.SIZEOF_SHORT=2,A.SIZEOF_INT=4,A.FILE_IDENTIFIER_LENGTH=4,A.SIZE_PREFIX_LENGTH=4,A.Encoding={UTF8_BYTES:1,UTF16_STRING:2},A.int32=new Int32Array(2),A.float32=new Float32Array(A.int32.buffer),A.float64=new Float64Array(A.int32.buffer),A.isLittleEndian=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1,A.Long=function(O,Y){this.low=0|O,this.high=0|Y},A.Long.create=function(O,Y){return O==0&&Y==0?A.Long.ZERO:new A.Long(O,Y)},A.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},A.Long.prototype.equals=function(O){return this.low==O.low&&this.high==O.high},A.Long.ZERO=new A.Long(0,0),A.Builder=function(O){if(O)Y=O;else var Y=1024;this.bb=A.ByteBuffer.allocate(Y),this.space=Y,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},A.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},A.Builder.prototype.forceDefaults=function(O){this.force_defaults=O},A.Builder.prototype.dataBuffer=function(){return this.bb},A.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},A.Builder.prototype.prep=function(O,Y){O>this.minalign&&(this.minalign=O);for(var R=1+~(this.bb.capacity()-this.space+Y)&O-1;this.space<R+O+Y;){var ee=this.bb.capacity();this.bb=A.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-ee}this.pad(R)},A.Builder.prototype.pad=function(O){for(var Y=0;Y<O;Y++)this.bb.writeInt8(--this.space,0)},A.Builder.prototype.writeInt8=function(O){this.bb.writeInt8(this.space-=1,O)},A.Builder.prototype.writeInt16=function(O){this.bb.writeInt16(this.space-=2,O)},A.Builder.prototype.writeInt32=function(O){this.bb.writeInt32(this.space-=4,O)},A.Builder.prototype.writeInt64=function(O){this.bb.writeInt64(this.space-=8,O)},A.Builder.prototype.writeFloat32=function(O){this.bb.writeFloat32(this.space-=4,O)},A.Builder.prototype.writeFloat64=function(O){this.bb.writeFloat64(this.space-=8,O)},A.Builder.prototype.addInt8=function(O){this.prep(1,0),this.writeInt8(O)},A.Builder.prototype.addInt16=function(O){this.prep(2,0),this.writeInt16(O)},A.Builder.prototype.addInt32=function(O){this.prep(4,0),this.writeInt32(O)},A.Builder.prototype.addInt64=function(O){this.prep(8,0),this.writeInt64(O)},A.Builder.prototype.addFloat32=function(O){this.prep(4,0),this.writeFloat32(O)},A.Builder.prototype.addFloat64=function(O){this.prep(8,0),this.writeFloat64(O)},A.Builder.prototype.addFieldInt8=function(O,Y,R){(this.force_defaults||Y!=R)&&(this.addInt8(Y),this.slot(O))},A.Builder.prototype.addFieldInt16=function(O,Y,R){(this.force_defaults||Y!=R)&&(this.addInt16(Y),this.slot(O))},A.Builder.prototype.addFieldInt32=function(O,Y,R){(this.force_defaults||Y!=R)&&(this.addInt32(Y),this.slot(O))},A.Builder.prototype.addFieldInt64=function(O,Y,R){!this.force_defaults&&Y.equals(R)||(this.addInt64(Y),this.slot(O))},A.Builder.prototype.addFieldFloat32=function(O,Y,R){(this.force_defaults||Y!=R)&&(this.addFloat32(Y),this.slot(O))},A.Builder.prototype.addFieldFloat64=function(O,Y,R){(this.force_defaults||Y!=R)&&(this.addFloat64(Y),this.slot(O))},A.Builder.prototype.addFieldOffset=function(O,Y,R){(this.force_defaults||Y!=R)&&(this.addOffset(Y),this.slot(O))},A.Builder.prototype.addFieldStruct=function(O,Y,R){Y!=R&&(this.nested(Y),this.slot(O))},A.Builder.prototype.nested=function(O){if(O!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},A.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},A.Builder.prototype.slot=function(O){this.vtable[O]=this.offset()},A.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},A.Builder.growByteBuffer=function(O){var Y=O.capacity();if(3221225472&Y)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var R=Y<<1,ee=A.ByteBuffer.allocate(R);return ee.setPosition(R-Y),ee.bytes().set(O.bytes(),R-Y),ee},A.Builder.prototype.addOffset=function(O){this.prep(A.SIZEOF_INT,0),this.writeInt32(this.offset()-O+A.SIZEOF_INT)},A.Builder.prototype.startObject=function(O){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=O;for(var Y=0;Y<O;Y++)this.vtable[Y]=0;this.isNested=!0,this.object_start=this.offset()},A.Builder.prototype.endObject=function(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var O=this.offset(),Y=this.vtable_in_use-1;Y>=0&&this.vtable[Y]==0;Y--);for(var R=Y+1;Y>=0;Y--)this.addInt16(this.vtable[Y]!=0?O-this.vtable[Y]:0);this.addInt16(O-this.object_start);var ee=(R+2)*A.SIZEOF_SHORT;this.addInt16(ee);var xe=0,ne=this.space;e:for(Y=0;Y<this.vtables.length;Y++){var te=this.bb.capacity()-this.vtables[Y];if(ee==this.bb.readInt16(te)){for(var f=A.SIZEOF_SHORT;f<ee;f+=A.SIZEOF_SHORT)if(this.bb.readInt16(ne+f)!=this.bb.readInt16(te+f))continue e;xe=this.vtables[Y];break}}return xe?(this.space=this.bb.capacity()-O,this.bb.writeInt32(this.space,xe-O)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-O,this.offset()-O)),this.isNested=!1,O},A.Builder.prototype.finish=function(O,Y,R){var ee=R?A.SIZE_PREFIX_LENGTH:0;if(Y){var xe=Y;if(this.prep(this.minalign,A.SIZEOF_INT+A.FILE_IDENTIFIER_LENGTH+ee),xe.length!=A.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+A.FILE_IDENTIFIER_LENGTH);for(var ne=A.FILE_IDENTIFIER_LENGTH-1;ne>=0;ne--)this.writeInt8(xe.charCodeAt(ne))}this.prep(this.minalign,A.SIZEOF_INT+ee),this.addOffset(O),ee&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},A.Builder.prototype.finishSizePrefixed=function(O,Y){this.finish(O,Y,!0)},A.Builder.prototype.requiredField=function(O,Y){var R=this.bb.capacity()-O,ee=R-this.bb.readInt32(R);if(this.bb.readInt16(ee+Y)==0)throw new Error("FlatBuffers: field "+Y+" must be set")},A.Builder.prototype.startVector=function(O,Y,R){this.notNested(),this.vector_num_elems=Y,this.prep(A.SIZEOF_INT,O*Y),this.prep(R,O*Y)},A.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},A.Builder.prototype.createString=function(O){if(O instanceof Uint8Array)var Y=O;else{Y=[];for(var R=0;R<O.length;){var ee,xe=O.charCodeAt(R++);(ee=xe<55296||xe>=56320?xe:(xe<<10)+O.charCodeAt(R++)+-56613888)<128?Y.push(ee):(ee<2048?Y.push(ee>>6&31|192):(ee<65536?Y.push(ee>>12&15|224):Y.push(ee>>18&7|240,ee>>12&63|128),Y.push(ee>>6&63|128)),Y.push(63&ee|128))}}this.addInt8(0),this.startVector(1,Y.length,1),this.bb.setPosition(this.space-=Y.length),R=0;for(var ne=this.space,te=this.bb.bytes();R<Y.length;R++)te[ne++]=Y[R];return this.endVector()},A.Builder.prototype.createLong=function(O,Y){return A.Long.create(O,Y)},A.ByteBuffer=function(O){this.bytes_=O,this.position_=0},A.ByteBuffer.allocate=function(O){return new A.ByteBuffer(new Uint8Array(O))},A.ByteBuffer.prototype.clear=function(){this.position_=0},A.ByteBuffer.prototype.bytes=function(){return this.bytes_},A.ByteBuffer.prototype.position=function(){return this.position_},A.ByteBuffer.prototype.setPosition=function(O){this.position_=O},A.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},A.ByteBuffer.prototype.readInt8=function(O){return this.readUint8(O)<<24>>24},A.ByteBuffer.prototype.readUint8=function(O){return this.bytes_[O]},A.ByteBuffer.prototype.readInt16=function(O){return this.readUint16(O)<<16>>16},A.ByteBuffer.prototype.readUint16=function(O){return this.bytes_[O]|this.bytes_[O+1]<<8},A.ByteBuffer.prototype.readInt32=function(O){return this.bytes_[O]|this.bytes_[O+1]<<8|this.bytes_[O+2]<<16|this.bytes_[O+3]<<24},A.ByteBuffer.prototype.readUint32=function(O){return this.readInt32(O)>>>0},A.ByteBuffer.prototype.readInt64=function(O){return new A.Long(this.readInt32(O),this.readInt32(O+4))},A.ByteBuffer.prototype.readUint64=function(O){return new A.Long(this.readUint32(O),this.readUint32(O+4))},A.ByteBuffer.prototype.readFloat32=function(O){return A.int32[0]=this.readInt32(O),A.float32[0]},A.ByteBuffer.prototype.readFloat64=function(O){return A.int32[A.isLittleEndian?0:1]=this.readInt32(O),A.int32[A.isLittleEndian?1:0]=this.readInt32(O+4),A.float64[0]},A.ByteBuffer.prototype.writeInt8=function(O,Y){this.bytes_[O]=Y},A.ByteBuffer.prototype.writeUint8=function(O,Y){this.bytes_[O]=Y},A.ByteBuffer.prototype.writeInt16=function(O,Y){this.bytes_[O]=Y,this.bytes_[O+1]=Y>>8},A.ByteBuffer.prototype.writeUint16=function(O,Y){this.bytes_[O]=Y,this.bytes_[O+1]=Y>>8},A.ByteBuffer.prototype.writeInt32=function(O,Y){this.bytes_[O]=Y,this.bytes_[O+1]=Y>>8,this.bytes_[O+2]=Y>>16,this.bytes_[O+3]=Y>>24},A.ByteBuffer.prototype.writeUint32=function(O,Y){this.bytes_[O]=Y,this.bytes_[O+1]=Y>>8,this.bytes_[O+2]=Y>>16,this.bytes_[O+3]=Y>>24},A.ByteBuffer.prototype.writeInt64=function(O,Y){this.writeInt32(O,Y.low),this.writeInt32(O+4,Y.high)},A.ByteBuffer.prototype.writeUint64=function(O,Y){this.writeUint32(O,Y.low),this.writeUint32(O+4,Y.high)},A.ByteBuffer.prototype.writeFloat32=function(O,Y){A.float32[0]=Y,this.writeInt32(O,A.int32[0])},A.ByteBuffer.prototype.writeFloat64=function(O,Y){A.float64[0]=Y,this.writeInt32(O,A.int32[A.isLittleEndian?0:1]),this.writeInt32(O+4,A.int32[A.isLittleEndian?1:0])},A.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+A.SIZEOF_INT+A.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var O="",Y=0;Y<A.FILE_IDENTIFIER_LENGTH;Y++)O+=String.fromCharCode(this.readInt8(this.position_+A.SIZEOF_INT+Y));return O},A.ByteBuffer.prototype.__offset=function(O,Y){var R=O-this.readInt32(O);return Y<this.readInt16(R)?this.readInt16(R+Y):0},A.ByteBuffer.prototype.__union=function(O,Y){return O.bb_pos=Y+this.readInt32(Y),O.bb=this,O},A.ByteBuffer.prototype.__string=function(O,Y){O+=this.readInt32(O);var R=this.readInt32(O),ee="",xe=0;if(O+=A.SIZEOF_INT,Y===A.Encoding.UTF8_BYTES)return this.bytes_.subarray(O,O+R);for(;xe<R;){var ne,te=this.readUint8(O+xe++);if(te<192)ne=te;else{var f=this.readUint8(O+xe++);if(te<224)ne=(31&te)<<6|63&f;else{var d=this.readUint8(O+xe++);ne=te<240?(15&te)<<12|(63&f)<<6|63&d:(7&te)<<18|(63&f)<<12|(63&d)<<6|63&this.readUint8(O+xe++)}}ne<65536?ee+=String.fromCharCode(ne):(ne-=65536,ee+=String.fromCharCode(55296+(ne>>10),56320+(1023&ne)))}return ee},A.ByteBuffer.prototype.__indirect=function(O){return O+this.readInt32(O)},A.ByteBuffer.prototype.__vector=function(O){return O+this.readInt32(O)+A.SIZEOF_INT},A.ByteBuffer.prototype.__vector_len=function(O){return this.readInt32(O+this.readInt32(O))},A.ByteBuffer.prototype.__has_identifier=function(O){if(O.length!=A.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+A.FILE_IDENTIFIER_LENGTH);for(var Y=0;Y<A.FILE_IDENTIFIER_LENGTH;Y++)if(O.charCodeAt(Y)!=this.readInt8(this.position_+A.SIZEOF_INT+Y))return!1;return!0},A.ByteBuffer.prototype.createLong=function(O,Y){return A.Long.create(O,Y)}}},__webpack_module_cache__={};function __webpack_require__(g){var a=__webpack_module_cache__[g];if(a!==void 0)return a.exports;var l=__webpack_module_cache__[g]={exports:{}};return __webpack_modules__[g].call(l.exports,l,l.exports,__webpack_require__),l.exports}__webpack_require__.n=g=>{var a=g&&g.__esModule?()=>g.default:()=>g;return __webpack_require__.d(a,{a}),a},__webpack_require__.d=(g,a)=>{for(var l in a)__webpack_require__.o(a,l)&&!__webpack_require__.o(g,l)&&Object.defineProperty(g,l,{enumerable:!0,get:a[l]})},__webpack_require__.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),__webpack_require__.o=(g,a)=>Object.prototype.hasOwnProperty.call(g,a),__webpack_require__.r=g=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(6018);return __webpack_exports__})()))})(ortWeb_min$1)),ortWeb_min$1.exports}var ortWeb_minExports=requireOrtWeb_min();const ortWeb_min=getDefaultExportFromCjs(ortWeb_minExports),ONNX_WEB=_mergeNamespaces({__proto__:null,default:ortWeb_min},[ortWeb_minExports]);let ONNX;const executionProviders=["wasm"];typeof process<"u"&&process?.release?.name==="node"?(ONNX=fs??__viteBrowserExternal,executionProviders.unshift("cpu")):(ONNX=ortWeb_min??ONNX_WEB,typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(ONNX.env.wasm.simd=!1));const{env:onnx_env}=ONNX,VERSION="2.17.2",WEB_CACHE_AVAILABLE=typeof self<"u"&&"caches"in self,FS_AVAILABLE=!isEmpty(fs),PATH_AVAILABLE=!isEmpty(fs),RUNNING_LOCALLY=FS_AVAILABLE&&PATH_AVAILABLE,__dirname=RUNNING_LOCALLY?fs.dirname(fs.dirname(fs.fileURLToPath(import.meta.url))):"./",DEFAULT_CACHE_DIR=RUNNING_LOCALLY?fs.join(__dirname,"/.cache/"):null,DEFAULT_LOCAL_MODEL_PATH="/models/",localModelPath=RUNNING_LOCALLY?fs.join(__dirname,DEFAULT_LOCAL_MODEL_PATH):DEFAULT_LOCAL_MODEL_PATH;onnx_env?.wasm&&(onnx_env.wasm.wasmPaths=RUNNING_LOCALLY?fs.join(__dirname,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${VERSION}/dist/`);const env$1={version:VERSION,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath,useFS:FS_AVAILABLE,useBrowserCache:WEB_CACHE_AVAILABLE,useFSCache:FS_AVAILABLE,cacheDir:DEFAULT_CACHE_DIR};function isEmpty(g){return Object.keys(g).length===0}var define_process_env_default={};class FileResponse{_CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(a){if(this.filePath=a,this.headers=new Headers,this.exists=fs.existsSync(a),this.exists){this.status=200,this.statusText="OK";let l=fs.statSync(a);this.headers.set("content-length",l.size.toString()),this.updateContentType();let A=this;this.body=new ReadableStream({start(O){A.arrayBuffer().then(Y=>{O.enqueue(new Uint8Array(Y)),O.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const a=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[a]??"application/octet-stream")}clone(){let a=new FileResponse(this.filePath);return a.exists=this.exists,a.status=this.status,a.statusText=this.statusText,a.headers=new Headers(this.headers),a}async arrayBuffer(){return(await fs.promises.readFile(this.filePath)).buffer}async blob(){const a=await fs.promises.readFile(this.filePath);return new Blob([a],{type:this.headers.get("content-type")})}async text(){return await fs.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function isValidUrl(g,a=null,l=null){let A;try{A=new URL(g)}catch{return!1}return!(a&&!a.includes(A.protocol)||l&&!l.includes(A.hostname))}async function getFile(g){if(env$1.useFS&&!isValidUrl(g,["http:","https:","blob:"]))return new FileResponse(g);if(typeof process<"u"&&process?.release?.name==="node"){const a=!!define_process_env_default?.TESTING_REMOTELY,l=env$1.version,A=new Headers;if(A.set("User-Agent",`transformers.js/${l}; is_ci/${a};`),isValidUrl(g,["http:","https:"],["huggingface.co","hf.co"])){const Y=define_process_env_default?.HF_TOKEN??define_process_env_default?.HF_ACCESS_TOKEN;Y&&A.set("Authorization",`Bearer ${Y}`)}return fetch(g,{headers:A})}else return fetch(g)}const ERROR_MAPPING={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function handleError(g,a,l){if(!l)return null;const A=ERROR_MAPPING[g]??`Error (${g}) occurred while trying to load file`;throw Error(`${A}: "${a}".`)}class FileCache{constructor(a){this.path=a}async match(a){let l=fs.join(this.path,a),A=new FileResponse(l);if(A.exists)return A}async put(a,l){const A=Buffer.from(await l.arrayBuffer());let O=fs.join(this.path,a);try{await fs.promises.mkdir(fs.dirname(O),{recursive:!0}),await fs.promises.writeFile(O,A)}catch(Y){console.warn("An error occurred while writing the file to cache:",Y)}}}async function tryCache(g,...a){for(let l of a)try{let A=await g.match(l);if(A)return A}catch{continue}}async function getModelFile(g,a,l=!0,A={}){if(!env$1.allowLocalModels){if(A.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!env$1.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}dispatchCallback(A.progress_callback,{status:"initiate",name:g,file:a});let O;if(!O&&env$1.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{O=await caches.open("transformers-cache")}catch(tt){console.warn("An error occurred while opening the browser cache:",tt)}}!O&&env$1.useFSCache&&(O=new FileCache(A.cache_dir??env$1.cacheDir));const Y=A.revision??"main";let R=pathJoin(g,a),ee=pathJoin(env$1.localModelPath,R),xe=pathJoin(env$1.remoteHost,env$1.remotePathTemplate.replaceAll("{model}",g).replaceAll("{revision}",encodeURIComponent(Y)),a),ne=Y==="main"?R:pathJoin(g,Y,a),te,f=O instanceof FileCache?ne:xe,d=!1,H;O&&(H=await tryCache(O,ee,f));const Z=H!==void 0;if(H===void 0){if(env$1.allowLocalModels)if(isValidUrl(R,["http:","https:"])){if(A.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${R}.`);if(!env$1.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${R}.`)}else try{H=await getFile(ee),te=ee}catch(nt){console.warn(`Unable to load from local path "${ee}": "${nt}"`)}if(H===void 0||H.status===404){if(A.local_files_only||!env$1.allowRemoteModels){if(l)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${ee}".`);return null}if(H=await getFile(xe),H.status!==200)return handleError(H.status,xe,l);te=f}d=O&&typeof Response<"u"&&H instanceof Response&&H.status===200}dispatchCallback(A.progress_callback,{status:"download",name:g,file:a});const Ye={status:"progress",name:g,file:a};let et;return A.progress_callback?Z&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(et=new Uint8Array(await H.arrayBuffer()),dispatchCallback(A.progress_callback,{...Ye,progress:100,loaded:et.length,total:et.length})):et=await readResponse(H,tt=>{dispatchCallback(A.progress_callback,{...Ye,...tt})}):et=new Uint8Array(await H.arrayBuffer()),d&&te&&await O.match(te)===void 0&&await O.put(te,new Response(et,{headers:H.headers})).catch(tt=>{console.warn(`Unable to add response to browser cache: ${tt}.`)}),dispatchCallback(A.progress_callback,{status:"done",name:g,file:a}),et}async function getModelJSON(g,a,l=!0,A={}){let O=await getModelFile(g,a,l,A);if(O===null)return{};let R=new TextDecoder("utf-8").decode(O);return JSON.parse(R)}async function readResponse(g,a){const l=g.headers.get("Content-Length");l===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let A=parseInt(l??"0"),O=new Uint8Array(A),Y=0;const R=g.body.getReader();async function ee(){const{done:xe,value:ne}=await R.read();if(xe)return;let te=Y+ne.length;if(te>A){A=te;let d=new Uint8Array(A);d.set(O),O=d}O.set(ne,Y),Y=te;const f=Y/A*100;return a({progress:f,loaded:Y,total:A}),ee()}return await ee(),O}function pathJoin(...g){return g=g.map((a,l)=>(l&&(a=a.replace(new RegExp("^/"),"")),l!==g.length-1&&(a=a.replace(new RegExp("/$"),"")),a)),g.join("/")}function interpolate_data(g,[a,l,A],[O,Y],R="bilinear",ee=!1){const xe=Y/A,ne=O/l,te=new g.constructor(O*Y*a),f=l*A,d=O*Y;for(let H=0;H<O;++H)for(let Z=0;Z<Y;++Z){const Ye=H*Y+Z,et=(Z+.5)/xe-.5,tt=(H+.5)/ne-.5;let nt=Math.floor(et),it=Math.floor(tt);const ot=Math.min(nt+1,A-1),st=Math.min(it+1,l-1);nt=Math.max(nt,0),it=Math.max(it,0);const at=et-nt,ct=tt-it,ft=(1-at)*(1-ct),ut=at*(1-ct),_t=(1-at)*ct,At=at*ct,Et=it*A,Mt=st*A,Ot=Et+nt,kt=Et+ot,yt=Mt+nt,St=Mt+ot;for(let Yt=0;Yt<a;++Yt){const Ft=Yt*f;te[Yt*d+Ye]=ft*g[Ft+Ot]+ut*g[Ft+kt]+_t*g[Ft+yt]+At*g[Ft+St]}}return te}function permute_data(g,a,l){const A=new Array(l.length),O=new Array(l.length);for(let ee=l.length-1,xe=1;ee>=0;--ee)O[ee]=xe,A[ee]=a[l[ee]],xe*=A[ee];const Y=l.map((ee,xe)=>O[l.indexOf(xe)]),R=new g.constructor(g.length);for(let ee=0;ee<g.length;++ee){let xe=0;for(let ne=a.length-1,te=ee;ne>=0;--ne)xe+=te%a[ne]*Y[ne],te=Math.floor(te/a[ne]);R[xe]=g[ee]}return[R,A]}function softmax(g){const a=max(g)[0],l=g.map(Y=>Math.exp(Y-a)),A=l.reduce((Y,R)=>Y+R,0);return l.map(Y=>Y/A)}function log_softmax(g){return softmax(g).map(A=>Math.log(A))}function getTopItems(g,a=0){return g=Array.from(g).map((l,A)=>[A,l]).sort((l,A)=>A[1]-l[1]),a!==null&&a>0&&(g=g.slice(0,a)),g}function min(g){if(g.length===0)throw Error("Array must not be empty");let a=g[0],l=0;for(let A=1;A<g.length;++A)g[A]<a&&(a=g[A],l=A);return[a,l]}function max(g){if(g.length===0)throw Error("Array must not be empty");let a=g[0],l=0;for(let A=1;A<g.length;++A)g[A]>a&&(a=g[A],l=A);return[Number(a),l]}function isPowerOfTwo(g){return g>0&&(g&g-1)===0}class P2FFT{constructor(a){if(this.size=a|0,this.size<=1||!isPowerOfTwo(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=a<<1,this.table=new Float64Array(this.size*2);for(let A=0;A<this.table.length;A+=2){const O=Math.PI*A/this.size;this.table[A]=Math.cos(O),this.table[A+1]=-Math.sin(O)}let l=0;for(let A=1;this.size>A;A<<=1)++l;this._width=l%2===0?l-1:l,this._bitrev=new Int32Array(1<<this._width);for(let A=0;A<this._bitrev.length;++A){this._bitrev[A]=0;for(let O=0;O<this._width;O+=2){const Y=this._width-O-2;this._bitrev[A]|=(A>>>O&3)<<Y}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(a,l){const A=l||new Array(a.length>>>1);for(let O=0;O<a.length;O+=2)A[O>>>1]=a[O];return A}toComplexArray(a,l){const A=l||this.createComplexArray();for(let O=0;O<A.length;O+=2)A[O]=a[O>>>1],A[O+1]=0;return A}transform(a,l){if(a===l)throw new Error("Input and output buffers must be different");this._transform4(a,l,1)}realTransform(a,l){if(a===l)throw new Error("Input and output buffers must be different");this._realTransform4(a,l,1)}inverseTransform(a,l){if(a===l)throw new Error("Input and output buffers must be different");this._transform4(a,l,-1);for(let A=0;A<a.length;++A)a[A]/=this.size}_transform4(a,l,A){const O=this._csize;let R=1<<this._width,ee=O/R<<1,xe,ne;const te=this._bitrev;if(ee===4)for(xe=0,ne=0;xe<O;xe+=ee,++ne){const d=te[ne];this._singleTransform2(l,a,xe,d,R)}else for(xe=0,ne=0;xe<O;xe+=ee,++ne){const d=te[ne];this._singleTransform4(l,a,xe,d,R,A)}const f=this.table;for(R>>=2;R>=2;R>>=2){ee=O/R<<1;const d=ee>>>2;for(xe=0;xe<O;xe+=ee){const H=xe+d-1;for(let Z=xe,Ye=0;Z<H;Z+=2,Ye+=R){const et=Z,tt=et+d,nt=tt+d,it=nt+d,ot=a[et],st=a[et+1],at=a[tt],ct=a[tt+1],ft=a[nt],ut=a[nt+1],_t=a[it],At=a[it+1],Et=f[Ye],Mt=A*f[Ye+1],Ot=at*Et-ct*Mt,kt=at*Mt+ct*Et,yt=f[2*Ye],St=A*f[2*Ye+1],Yt=ft*yt-ut*St,Ft=ft*St+ut*yt,ln=f[3*Ye],dn=A*f[3*Ye+1],Pt=_t*ln-At*dn,$t=_t*dn+At*ln,hn=ot+Yt,_n=st+Ft,On=ot-Yt,En=st-Ft,qt=Ot+Pt,Jt=kt+$t,Wt=A*(Ot-Pt),un=A*(kt-$t);a[et]=hn+qt,a[et+1]=_n+Jt,a[tt]=On+un,a[tt+1]=En-Wt,a[nt]=hn-qt,a[nt+1]=_n-Jt,a[it]=On-un,a[it+1]=En+Wt}}}}_singleTransform2(a,l,A,O,Y){const R=a[O],ee=a[O+1],xe=a[O+Y],ne=a[O+Y+1];l[A]=R+xe,l[A+1]=ee+ne,l[A+2]=R-xe,l[A+3]=ee-ne}_singleTransform4(a,l,A,O,Y,R){const ee=Y*2,xe=Y*3,ne=a[O],te=a[O+1],f=a[O+Y],d=a[O+Y+1],H=a[O+ee],Z=a[O+ee+1],Ye=a[O+xe],et=a[O+xe+1],tt=ne+H,nt=te+Z,it=ne-H,ot=te-Z,st=f+Ye,at=d+et,ct=R*(f-Ye),ft=R*(d-et);l[A]=tt+st,l[A+1]=nt+at,l[A+2]=it+ft,l[A+3]=ot-ct,l[A+4]=tt-st,l[A+5]=nt-at,l[A+6]=it-ft,l[A+7]=ot+ct}_realTransform4(a,l,A){const O=this._csize;let R=1<<this._width,ee=O/R<<1,xe,ne;const te=this._bitrev;if(ee===4)for(xe=0,ne=0;xe<O;xe+=ee,++ne){const H=te[ne];this._singleRealTransform2(l,a,xe,H>>>1,R>>>1)}else for(xe=0,ne=0;xe<O;xe+=ee,++ne){const H=te[ne];this._singleRealTransform4(l,a,xe,H>>>1,R>>>1,A)}const f=this.table;for(R>>=2;R>=2;R>>=2){ee=O/R<<1;const H=ee>>>1,Z=H>>>1,Ye=Z>>>1;for(xe=0;xe<O;xe+=ee)for(let et=0,tt=0;et<=Ye;et+=2,tt+=R){const nt=xe+et,it=nt+Z,ot=it+Z,st=ot+Z,at=a[nt],ct=a[nt+1],ft=a[it],ut=a[it+1],_t=a[ot],At=a[ot+1],Et=a[st],Mt=a[st+1],Ot=at,kt=ct,yt=f[tt],St=A*f[tt+1],Yt=ft*yt-ut*St,Ft=ft*St+ut*yt,ln=f[2*tt],dn=A*f[2*tt+1],Pt=_t*ln-At*dn,$t=_t*dn+At*ln,hn=f[3*tt],_n=A*f[3*tt+1],On=Et*hn-Mt*_n,En=Et*_n+Mt*hn,qt=Ot+Pt,Jt=kt+$t,Wt=Ot-Pt,un=kt-$t,fn=Yt+On,pn=Ft+En,Zt=A*(Yt-On),mn=A*(Ft-En);if(a[nt]=qt+fn,a[nt+1]=Jt+pn,a[it]=Wt+mn,a[it+1]=un-Zt,et===0){a[ot]=qt-fn,a[ot+1]=Jt-pn;continue}if(et===Ye)continue;const Tn=xe+Z-et,$n=xe+H-et;a[Tn]=Wt-A*mn,a[Tn+1]=-un-A*Zt,a[$n]=qt-A*fn,a[$n+1]=-Jt+A*pn}}const d=O>>>1;for(let H=2;H<d;H+=2)a[O-H]=a[H],a[O-H+1]=-a[H+1]}_singleRealTransform2(a,l,A,O,Y){const R=a[O],ee=a[O+Y];l[A]=R+ee,l[A+1]=0,l[A+2]=R-ee,l[A+3]=0}_singleRealTransform4(a,l,A,O,Y,R){const ee=Y*2,xe=Y*3,ne=a[O],te=a[O+Y],f=a[O+ee],d=a[O+xe],H=ne+f,Z=ne-f,Ye=te+d,et=R*(te-d);l[A]=H+Ye,l[A+1]=0,l[A+2]=Z,l[A+3]=-et,l[A+4]=H-Ye,l[A+5]=0,l[A+6]=Z,l[A+7]=et}}class NP2FFT{constructor(a){const l=2*(a-1),A=2*(2*a-1),O=2**Math.ceil(Math.log2(A));this.bufferSize=O,this._a=l;const Y=new Float64Array(A),R=new Float64Array(O);this._chirpBuffer=new Float64Array(O),this._buffer1=new Float64Array(O),this._buffer2=new Float64Array(O),this._outBuffer1=new Float64Array(O),this._outBuffer2=new Float64Array(O);const ee=-2*Math.PI/a,xe=Math.cos(ee),ne=Math.sin(ee);for(let te=0;te<A>>1;++te){const f=(te+1-a)**2/2,d=Math.sqrt(xe**2+ne**2)**f,H=f*Math.atan2(ne,xe),Z=2*te;Y[Z]=d*Math.cos(H),Y[Z+1]=d*Math.sin(H),R[Z]=Y[Z],R[Z+1]=-Y[Z+1]}this._slicedChirpBuffer=Y.subarray(l,A),this._f=new P2FFT(O>>1),this._f.transform(this._chirpBuffer,R)}_transform(a,l,A){const O=this._buffer1,Y=this._buffer2,R=this._outBuffer1,ee=this._outBuffer2,xe=this._chirpBuffer,ne=this._slicedChirpBuffer,te=this._a;if(A)for(let f=0;f<ne.length;f+=2){const d=f+1,H=f>>1,Z=l[H];O[f]=Z*ne[f],O[d]=Z*ne[d]}else for(let f=0;f<ne.length;f+=2){const d=f+1;O[f]=l[f]*ne[f]-l[d]*ne[d],O[d]=l[f]*ne[d]+l[d]*ne[f]}this._f.transform(R,O);for(let f=0;f<xe.length;f+=2){const d=f+1;Y[f]=R[f]*xe[f]-R[d]*xe[d],Y[d]=R[f]*xe[d]+R[d]*xe[f]}this._f.inverseTransform(ee,Y);for(let f=0;f<ee.length;f+=2){const d=ee[f+te],H=ee[f+te+1],Z=ne[f],Ye=ne[f+1];a[f]=d*Z-H*Ye,a[f+1]=d*Ye+H*Z}}transform(a,l){this._transform(a,l,!1)}realTransform(a,l){this._transform(a,l,!0)}}class FFT{constructor(a){this.fft_length=a,this.isPowerOfTwo=isPowerOfTwo(a),this.isPowerOfTwo?(this.fft=new P2FFT(a),this.outputBufferSize=2*a):(this.fft=new NP2FFT(a),this.outputBufferSize=this.fft.bufferSize)}realTransform(a,l){this.fft.realTransform(a,l)}transform(a,l){this.fft.transform(a,l)}}function medianFilter(g,a){if(a%2===0||a<=0)throw new Error("Window size must be a positive odd number");const l=new g.constructor(g.length),A=new g.constructor(a),O=Math.floor(a/2);for(let Y=0;Y<g.length;++Y){let R=0;for(let ee=-O;ee<=O;++ee){let xe=Y+ee;xe<0?xe=Math.abs(xe):xe>=g.length&&(xe=2*(g.length-1)-xe),A[R++]=g[xe]}A.sort(),l[Y]=A[O]}return l}function round(g,a){const l=Math.pow(10,a);return Math.round(g*l)/l}function bankers_round(g){const a=Math.round(g);return Math.abs(g)%1===.5?a%2===0?a:a-1:a}const DataTypeMap=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),ONNXTensor$1=ONNX.Tensor;class Tensor{dims;type;data;size;constructor(...a){return a[0]instanceof ONNXTensor$1?Object.assign(this,a[0]):Object.assign(this,new ONNXTensor$1(a[0],a[1],a[2])),new Proxy(this,{get:(l,A)=>{if(typeof A=="string"){let O=Number(A);if(Number.isInteger(O))return l._getitem(O)}return l[A]},set:(l,A,O)=>l[A]=O})}*[Symbol.iterator](){const[a,...l]=this.dims;if(l.length>0){const A=l.reduce((O,Y)=>O*Y);for(let O=0;O<a;++O)yield this._subarray(O,A,l)}else yield*this.data}_getitem(a){const[l,...A]=this.dims;if(a=safeIndex(a,l),A.length>0){const O=A.reduce((Y,R)=>Y*R);return this._subarray(a,O,A)}else return new Tensor(this.type,[this.data[a]],A)}indexOf(a){for(let l=0;l<this.data.length;++l)if(this.data[l]==a)return l;return-1}_subarray(a,l,A){const O=a*l,Y=(a+1)*l,R="subarray"in this.data?this.data.subarray(O,Y):this.data.slice(O,Y);return new Tensor(this.type,R,A)}item(){if(this.data.length!==1)throw new Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return reshape(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let a=0;a<this.data.length;++a)this.data[a]=1/(1+Math.exp(-this.data[a]));return this}mul(a){return this.clone().mul_(a)}mul_(a){for(let l=0;l<this.data.length;++l)this.data[l]*=a;return this}add(a){return this.clone().add_(a)}add_(a){for(let l=0;l<this.data.length;++l)this.data[l]+=a;return this}clone(){return new Tensor(this.type,this.data.slice(),this.dims.slice())}slice(...a){let l=[],A=[];for(let xe=0;xe<this.dims.length;++xe){let ne=a[xe];if(ne==null)A.push([0,this.dims[xe]]),l.push(this.dims[xe]);else if(typeof ne=="number")ne=safeIndex(ne,this.dims[xe],xe),A.push([ne,ne+1]);else if(Array.isArray(ne)&&ne.length===2){if(ne[0]>ne[1])throw new Error(`Invalid slice: ${ne}`);let te=[Math.max(ne[0],0),Math.min(ne[1],this.dims[xe])];A.push(te),l.push(te[1]-te[0])}else throw new Error(`Invalid slice: ${ne}`)}let O=A.map(([xe,ne])=>ne-xe),Y=O.reduce((xe,ne)=>xe*ne),R=new this.data.constructor(Y);const ee=this.stride();for(let xe=0;xe<Y;++xe){let ne=0;for(let te=O.length-1,f=xe;te>=0;--te){const d=O[te];ne+=(f%d+A[te][0])*ee[te],f=Math.floor(f/d)}R[xe]=this.data[ne]}return new Tensor(this.type,R,l)}permute(...a){return permute(this,a)}transpose(...a){return this.permute(...a)}sum(a=null,l=!1){return this.norm(1,a,l)}norm(a="fro",l=null,A=!1){if(a==="fro")a=2;else if(typeof a=="string")throw Error(`Unsupported norm: ${a}`);if(l===null){let R=this.data.reduce((ee,xe)=>ee+xe**a,0)**(1/a);return new Tensor(this.type,[R],[])}l=safeIndex(l,this.dims.length);const O=this.dims.slice();O[l]=1;const Y=new this.data.constructor(this.data.length/this.dims[l]);for(let R=0;R<this.data.length;++R){let ee=0;for(let xe=this.dims.length-1,ne=R,te=1;xe>=0;--xe){const f=this.dims[xe];if(xe!==l){const d=ne%f;ee+=d*te,te*=O[xe]}ne=Math.floor(ne/f)}Y[ee]+=this.data[R]**a}if(a!==1)for(let R=0;R<Y.length;++R)Y[R]=Y[R]**(1/a);return A||O.splice(l,1),new Tensor(this.type,Y,O)}normalize_(a=2,l=1){l=safeIndex(l,this.dims.length);const A=this.norm(a,l,!0);for(let O=0;O<this.data.length;++O){let Y=0;for(let R=this.dims.length-1,ee=O,xe=1;R>=0;--R){const ne=this.dims[R];if(R!==l){const te=ee%ne;Y+=te*xe,xe*=this.dims[R]}ee=Math.floor(ee/ne)}this.data[O]/=A.data[Y]}return this}normalize(a=2,l=1){return this.clone().normalize_(a,l)}stride(){return dimsToStride(this.dims)}squeeze(a=null){return new Tensor(this.type,this.data,calc_squeeze_dims(this.dims,a))}squeeze_(a=null){return this.dims=calc_squeeze_dims(this.dims,a),this}unsqueeze(a=null){return new Tensor(this.type,this.data,calc_unsqueeze_dims(this.dims,a))}unsqueeze_(a=null){return this.dims=calc_unsqueeze_dims(this.dims,a),this}flatten_(a=0,l=-1){l=(l+this.dims.length)%this.dims.length;let A=this.dims.slice(0,a),O=this.dims.slice(a,l+1),Y=this.dims.slice(l+1);return this.dims=[...A,O.reduce((R,ee)=>R*ee,1),...Y],this}flatten(a=0,l=-1){return this.clone().flatten_(a,l)}view(...a){let l=-1;for(let A=0;A<a.length;++A)if(a[A]===-1){if(l!==-1)throw new Error("Only one dimension can be inferred");l=A}if(l!==-1){const A=a.reduce((O,Y,R)=>R!==l?O*Y:O,1);a[l]=this.data.length/A}return new Tensor(this.type,this.data,a)}neg_(){for(let a=0;a<this.data.length;++a)this.data[a]=-this.data[a];return this}neg(){return this.clone().neg_()}clamp_(a,l){for(let A=0;A<this.data.length;++A)this.data[A]=Math.min(Math.max(this.data[A],a),l);return this}clamp(a,l){return this.clone().clamp_(a,l)}round_(){for(let a=0;a<this.data.length;++a)this.data[a]=Math.round(this.data[a]);return this}round(){return this.clone().round_()}to(a){if(this.type===a)return this;if(!DataTypeMap.hasOwnProperty(a))throw new Error(`Unsupported type: ${a}`);return new Tensor(a,DataTypeMap[a].from(this.data),this.dims)}}function reshape(g,a){const l=g.length,A=a.reduce((Y,R)=>Y*R);if(l!==A)throw Error(`cannot reshape array of size ${l} into shape (${a})`);let O=g;for(let Y=a.length-1;Y>=0;Y--)O=O.reduce((R,ee)=>{let xe=R[R.length-1];return xe.length<a[Y]?xe.push(ee):R.push([ee]),R},[[]]);return O[0]}function permute(g,a){const[l,A]=permute_data(g.data,g.dims,a);return new Tensor(g.type,l,A)}function interpolate(g,[a,l],A="bilinear",O=!1){const Y=g.dims.at(-3)??1,R=g.dims.at(-2),ee=g.dims.at(-1);let xe=interpolate_data(g.data,[Y,R,ee],[a,l],A,O);return new Tensor(g.type,xe,[Y,a,l])}function mean_pooling(g,a){let l=[g.dims[0],g.dims[2]],A=new g.data.constructor(l[0]*l[1]),[O,Y,R]=g.dims,ee=0;for(let xe=0;xe<O;++xe){let ne=xe*R*Y;for(let te=0;te<R;++te){let f=0,d=0,H=xe*Y,Z=ne+te;for(let et=0;et<Y;++et){let tt=Number(a.data[H+et]);d+=tt,f+=g.data[Z+et*R]*tt}let Ye=f/d;A[ee++]=Ye}}return new Tensor(g.type,A,l)}function calc_squeeze_dims(g,a){return g=g.slice(),a===null?g=g.filter(l=>l!==1):typeof a=="number"?g[a]===1&&g.splice(a,1):Array.isArray(a)&&(g=g.filter((l,A)=>l!==1||!a.includes(A))),g}function calc_unsqueeze_dims(g,a){return a=safeIndex(a,g.length+1),g=g.slice(),g.splice(a,0,1),g}function safeIndex(g,a,l=null){if(g<-a||g>=a)throw new Error(`IndexError: index ${g} is out of bounds for dimension${l===null?"":" "+l} with size ${a}`);return g<0&&(g=(g%a+a)%a),g}function cat(g,a=0){a=safeIndex(a,g[0].dims.length);const l=g[0].dims.slice();l[a]=g.reduce((R,ee)=>R+ee.dims[a],0);const A=l.reduce((R,ee)=>R*ee,1),O=new g[0].data.constructor(A),Y=g[0].type;if(a===0){let R=0;for(let ee of g)O.set(ee.data,R),R+=ee.data.length}else{let R=0;for(let ee=0;ee<g.length;++ee){let xe=g[ee];for(let ne=0;ne<xe.data.length;++ne){let te=0;for(let f=xe.dims.length-1,d=ne,H=1;f>=0;--f){const Z=xe.dims[f];let Ye=d%Z;f===a&&(Ye+=R),te+=Ye*H,H*=l[f],d=Math.floor(d/Z)}O[te]=xe.data[ne]}R+=xe.dims[a]}}return new Tensor(Y,O,l)}function stack(g,a=0){return cat(g.map(l=>l.unsqueeze(a)),a)}function std_mean(g,a=null,l=1,A=!1){if(a===null){const ne=g.data.reduce((H,Z)=>H+Z,0)/g.data.length,te=Math.sqrt(g.data.reduce((H,Z)=>H+(Z-ne)**2,0)/(g.data.length-l)),f=new Tensor(g.type,[ne],[]);return[new Tensor(g.type,[te],[]),f]}a=safeIndex(a,g.dims.length);const O=mean(g,a,A),Y=g.dims.slice();Y[a]=1;const R=new g.data.constructor(g.data.length/g.dims[a]);for(let xe=0;xe<g.data.length;++xe){let ne=0;for(let te=g.dims.length-1,f=xe,d=1;te>=0;--te){const H=g.dims[te];if(te!==a){const Z=f%H;ne+=Z*d,d*=Y[te]}f=Math.floor(f/H)}R[ne]+=(g.data[xe]-O.data[ne])**2}for(let xe=0;xe<R.length;++xe)R[xe]=Math.sqrt(R[xe]/(g.dims[a]-l));return A||Y.splice(a,1),[new Tensor(g.type,R,Y),O]}function mean(g,a=null,l=!1){if(a===null){let Y=g.data.reduce((R,ee)=>R+ee,0);return new Tensor(g.type,[Y/g.data.length],[])}a=safeIndex(a,g.dims.length);const A=g.dims.slice();A[a]=1;const O=new g.data.constructor(g.data.length/g.dims[a]);for(let Y=0;Y<g.data.length;++Y){let R=0;for(let ee=g.dims.length-1,xe=Y,ne=1;ee>=0;--ee){const te=g.dims[ee];if(ee!==a){const f=xe%te;R+=f*ne,ne*=A[ee]}xe=Math.floor(xe/te)}O[R]+=g.data[Y]}if(g.dims[a]!==1)for(let Y=0;Y<O.length;++Y)O[Y]=O[Y]/g.dims[a];return l||A.splice(a,1),new Tensor(g.type,O,A)}function dynamicTimeWarping(g){const[a,l]=g.dims,A=[a+1,l+1],O=new Tensor("float32",new Float32Array(A[0]*A[1]).fill(1/0),A),Y=new Tensor("float32",new Float32Array(A[0]*A[1]).fill(-1),A);O[0].data[0]=0;for(let te=1;te<l+1;++te)for(let f=1;f<a+1;++f){const d=O[f-1][te-1].item(),H=O[f-1][te].item(),Z=O[f][te-1].item();let Ye,et;d<H&&d<Z?(Ye=d,et=0):H<d&&H<Z?(Ye=H,et=1):(Ye=Z,et=2),O[f].data[te]=g[f-1][te-1].item()+Ye,Y[f].data[te]=et}let R=a,ee=l;Y.data.fill(2,0,A[1]);for(let te=0;te<A[0];++te)Y[te].data[0]=1;let xe=[],ne=[];for(;R>0||ee>0;)switch(xe.push(R-1),ne.push(ee-1),Y[R][ee].item()){case 0:--R,--ee;break;case 1:--R;break;case 2:--ee;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${R}, ${ee}]. Please file a bug report.`)}return xe.reverse(),ne.reverse(),[xe,ne]}function dimsToStride(g){const a=new Array(g.length);for(let l=g.length-1,A=1;l>=0;--l)a[l]=A,A*=g[l];return a}function ones(g){const a=g.reduce((l,A)=>l*A,1);return new Tensor("int64",new BigInt64Array(a).fill(1n),g)}function ones_like(g){return ones(g.dims)}function quantize_embeddings(g,a){if(g.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(g.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(a))throw new Error("The precision must be either 'binary' or 'ubinary'");const l=a==="binary",A=l?"int8":"uint8",O=l?Int8Array:Uint8Array,Y=g.data,R=new O(Y.length/8);for(let ee=0;ee<Y.length;++ee){const xe=Y[ee]>0?1:0,ne=Math.floor(ee/8),te=ee%8;R[ne]|=xe<<7-te,l&&te===0&&(R[ne]-=128)}return new Tensor(A,R,[g.dims[0],g.dims[1]/8])}class PriorityQueue{constructor(a=(l,A)=>l>A){this._heap=[],this._comparator=a}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...a){return this.extend(a)}extend(a){for(const l of a)this._heap.push(l),this._siftUp();return this.size}pop(){const a=this.peek(),l=this.size-1;return l>0&&this._swap(0,l),this._heap.pop(),this._siftDown(),a}replace(a){const l=this.peek();return this._heap[0]=a,this._siftDown(),l}_parent(a){return(a+1>>>1)-1}_left(a){return(a<<1)+1}_right(a){return a+1<<1}_greater(a,l){return this._comparator(this._heap[a],this._heap[l])}_swap(a,l){const A=this._heap[a];this._heap[a]=this._heap[l],this._heap[l]=A}_siftUp(){let a=this.size-1;for(;a>0&&this._greater(a,this._parent(a));)this._swap(a,this._parent(a)),a=this._parent(a)}_siftDown(){let a=0;for(;this._left(a)<this.size&&this._greater(this._left(a),a)||this._right(a)<this.size&&this._greater(this._right(a),a);){const l=this._right(a)<this.size&&this._greater(this._right(a),this._left(a))?this._right(a):this._left(a);this._swap(a,l),a=l}}}class CharTrie{constructor(){this.root=CharTrieNode.default()}extend(a){for(let l of a)this.push(l)}push(a){let l=this.root;for(let A of a){let O=l.children.get(A);O===void 0&&(O=CharTrieNode.default(),l.children.set(A,O)),l=O}l.isLeaf=!0}*commonPrefixSearch(a){let l=this.root,A="";for(let O=0;O<a.length&&l!==void 0;++O){const Y=a[O];A+=Y,l=l.children.get(Y),l!==void 0&&l.isLeaf&&(yield A)}}}class CharTrieNode{constructor(a,l){this.isLeaf=a,this.children=l}static default(){return new CharTrieNode(!1,new Map)}}class TokenLattice{constructor(a,l,A){this.sentence=a,this.len=a.length,this.bosTokenId=l,this.eosTokenId=A,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const O=new TokenLatticeNode(this.bosTokenId,0,0,0,0),Y=new TokenLatticeNode(this.eosTokenId,1,this.len,0,0);this.nodes.push(O.clone()),this.nodes.push(Y.clone()),this.beginNodes[this.len].push(Y),this.endNodes[0].push(O)}insert(a,l,A,O){const Y=this.nodes.length,R=new TokenLatticeNode(O,Y,a,l,A);this.beginNodes[a].push(R),this.endNodes[a+l].push(R),this.nodes.push(R)}viterbi(){const a=this.len;let l=0;for(;l<=a;){if(this.beginNodes[l].length==0)return[];for(let ee of this.beginNodes[l]){ee.prev=null;let xe=0,ne=null;for(let te of this.endNodes[l]){const f=te.backtraceScore+ee.score;(ne===null||f>xe)&&(ne=te.clone(),xe=f)}if(ne!==null)ee.prev=ne,ee.backtraceScore=xe;else return[]}++l}const A=[],Y=this.beginNodes[a][0].prev;if(Y===null)return[];let R=Y.clone();for(;R.prev!==null;)A.push(R.clone()),R=R.clone().prev.clone();return A.reverse(),A}piece(a){return this.sentence.slice(a.pos,a.pos+a.length)}tokens(){return this.viterbi().map(l=>this.piece(l))}tokenIds(){return this.viterbi().map(l=>l.tokenId)}}class TokenLatticeNode{constructor(a,l,A,O,Y){this.tokenId=a,this.nodeId=l,this.pos=A,this.length=O,this.score=Y,this.prev=null,this.backtraceScore=0}clone(){const a=new TokenLatticeNode(this.tokenId,this.nodeId,this.pos,this.length,this.score);return a.prev=this.prev,a.backtraceScore=this.backtraceScore,a}}var TOKEN_TYPES=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),KEYWORDS=Object.freeze({set:TOKEN_TYPES.Set,for:TOKEN_TYPES.For,in:TOKEN_TYPES.In,is:TOKEN_TYPES.Is,if:TOKEN_TYPES.If,else:TOKEN_TYPES.Else,endif:TOKEN_TYPES.EndIf,elif:TOKEN_TYPES.ElseIf,endfor:TOKEN_TYPES.EndFor,and:TOKEN_TYPES.And,or:TOKEN_TYPES.Or,not:TOKEN_TYPES.Not,"not in":TOKEN_TYPES.NotIn,true:TOKEN_TYPES.BooleanLiteral,false:TOKEN_TYPES.BooleanLiteral}),Token=class{constructor(g,a){this.value=g,this.type=a}};function isWord(g){return/\w/.test(g)}function isInteger(g){return/[0-9]/.test(g)}var ORDERED_MAPPING_TABLE=[["{%",TOKEN_TYPES.OpenStatement],["%}",TOKEN_TYPES.CloseStatement],["{{",TOKEN_TYPES.OpenExpression],["}}",TOKEN_TYPES.CloseExpression],["(",TOKEN_TYPES.OpenParen],[")",TOKEN_TYPES.CloseParen],["{",TOKEN_TYPES.OpenCurlyBracket],["}",TOKEN_TYPES.CloseCurlyBracket],["[",TOKEN_TYPES.OpenSquareBracket],["]",TOKEN_TYPES.CloseSquareBracket],[",",TOKEN_TYPES.Comma],[".",TOKEN_TYPES.Dot],[":",TOKEN_TYPES.Colon],["|",TOKEN_TYPES.Pipe],["<=",TOKEN_TYPES.ComparisonBinaryOperator],[">=",TOKEN_TYPES.ComparisonBinaryOperator],["==",TOKEN_TYPES.ComparisonBinaryOperator],["!=",TOKEN_TYPES.ComparisonBinaryOperator],["<",TOKEN_TYPES.ComparisonBinaryOperator],[">",TOKEN_TYPES.ComparisonBinaryOperator],["+",TOKEN_TYPES.AdditiveBinaryOperator],["-",TOKEN_TYPES.AdditiveBinaryOperator],["*",TOKEN_TYPES.MultiplicativeBinaryOperator],["/",TOKEN_TYPES.MultiplicativeBinaryOperator],["%",TOKEN_TYPES.MultiplicativeBinaryOperator],["=",TOKEN_TYPES.Equals]],ESCAPE_CHARACTERS=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function preprocess(g,a={}){return g.endsWith(`
`)&&(g=g.slice(0,-1)),g=g.replace(/{#.*?#}/gs,"{##}"),a.lstrip_blocks&&(g=g.replace(/^[ \t]*({[#%])/gm,"$1")),a.trim_blocks&&(g=g.replace(/([#%]})\n/g,"$1")),g.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function tokenize(g,a={}){const l=[],A=preprocess(g,a);let O=0;const Y=R=>{let ee="";for(;R(A[O]);){if(A[O]==="\\"){if(++O,O>=A.length)throw new SyntaxError("Unexpected end of input");const xe=A[O++],ne=ESCAPE_CHARACTERS.get(xe);if(ne===void 0)throw new SyntaxError(`Unexpected escaped character: ${xe}`);ee+=ne;continue}if(ee+=A[O++],O>=A.length)throw new SyntaxError("Unexpected end of input")}return ee};e:for(;O<A.length;){const R=l.at(-1)?.type;if(R===void 0||R===TOKEN_TYPES.CloseStatement||R===TOKEN_TYPES.CloseExpression){let xe="";for(;O<A.length&&!(A[O]==="{"&&(A[O+1]==="%"||A[O+1]==="{"));)xe+=A[O++];if(xe.length>0){l.push(new Token(xe,TOKEN_TYPES.Text));continue}}Y(xe=>/\s/.test(xe));const ee=A[O];if(ee==="-"||ee==="+"){const xe=l.at(-1)?.type;if(xe===TOKEN_TYPES.Text||xe===void 0)throw new SyntaxError(`Unexpected character: ${ee}`);switch(xe){case TOKEN_TYPES.Identifier:case TOKEN_TYPES.NumericLiteral:case TOKEN_TYPES.BooleanLiteral:case TOKEN_TYPES.StringLiteral:case TOKEN_TYPES.CloseParen:case TOKEN_TYPES.CloseSquareBracket:break;default:{++O;const ne=Y(isInteger);l.push(new Token(`${ee}${ne}`,ne.length>0?TOKEN_TYPES.NumericLiteral:TOKEN_TYPES.UnaryOperator));continue}}}for(const[xe,ne]of ORDERED_MAPPING_TABLE)if(A.slice(O,O+xe.length)===xe){l.push(new Token(xe,ne)),O+=xe.length;continue e}if(ee==="'"||ee==='"'){++O;const xe=Y(ne=>ne!==ee);l.push(new Token(xe,TOKEN_TYPES.StringLiteral)),++O;continue}if(isInteger(ee)){const xe=Y(isInteger);l.push(new Token(xe,TOKEN_TYPES.NumericLiteral));continue}if(isWord(ee)){const xe=Y(isWord),ne=Object.hasOwn(KEYWORDS,xe)?KEYWORDS[xe]:TOKEN_TYPES.Identifier;ne===TOKEN_TYPES.In&&l.at(-1)?.type===TOKEN_TYPES.Not?(l.pop(),l.push(new Token("not in",TOKEN_TYPES.NotIn))):l.push(new Token(xe,ne));continue}throw new SyntaxError(`Unexpected character: ${ee}`)}return l}var Statement=class{type="Statement"},Program=class extends Statement{constructor(g){super(),this.body=g}type="Program"},If=class extends Statement{constructor(g,a,l){super(),this.test=g,this.body=a,this.alternate=l}type="If"},For=class extends Statement{constructor(g,a,l){super(),this.loopvar=g,this.iterable=a,this.body=l}type="For"},SetStatement=class extends Statement{constructor(g,a){super(),this.assignee=g,this.value=a}type="Set"},Expression=class extends Statement{type="Expression"},MemberExpression=class extends Expression{constructor(g,a,l){super(),this.object=g,this.property=a,this.computed=l}type="MemberExpression"},CallExpression=class extends Expression{constructor(g,a){super(),this.callee=g,this.args=a}type="CallExpression"},Identifier=class extends Expression{constructor(g){super(),this.value=g}type="Identifier"},Literal=class extends Expression{constructor(g){super(),this.value=g}type="Literal"},NumericLiteral=class extends Literal{type="NumericLiteral"},StringLiteral=class extends Literal{type="StringLiteral"},BooleanLiteral=class extends Literal{type="BooleanLiteral"},ArrayLiteral=class extends Literal{type="ArrayLiteral"},TupleLiteral=class extends Literal{type="TupleLiteral"},ObjectLiteral=class extends Literal{type="ObjectLiteral"},BinaryExpression=class extends Expression{constructor(g,a,l){super(),this.operator=g,this.left=a,this.right=l}type="BinaryExpression"},FilterExpression=class extends Expression{constructor(g,a){super(),this.operand=g,this.filter=a}type="FilterExpression"},TestExpression=class extends Expression{constructor(g,a,l){super(),this.operand=g,this.negate=a,this.test=l}type="TestExpression"},UnaryExpression=class extends Expression{constructor(g,a){super(),this.operator=g,this.argument=a}type="UnaryExpression"},SliceExpression=class extends Expression{constructor(g=void 0,a=void 0,l=void 0){super(),this.start=g,this.stop=a,this.step=l}type="SliceExpression"},KeywordArgumentExpression=class extends Expression{constructor(g,a){super(),this.key=g,this.value=a}type="KeywordArgumentExpression"};function parse(g){const a=new Program([]);let l=0;function A(kt,yt){const St=g[l++];if(!St||St.type!==kt)throw new Error(`Parser Error: ${yt}. ${St.type} !== ${kt}.`);return St}function O(){switch(g[l].type){case TOKEN_TYPES.Text:return ee();case TOKEN_TYPES.OpenStatement:return xe();case TOKEN_TYPES.OpenExpression:return ne();default:throw new SyntaxError(`Unexpected token type: ${g[l].type}`)}}function Y(...kt){return l+kt.length<=g.length&&kt.some((yt,St)=>yt!==g[l+St].type)}function R(...kt){return l+kt.length<=g.length&&kt.every((yt,St)=>yt===g[l+St].type)}function ee(){return new StringLiteral(A(TOKEN_TYPES.Text,"Expected text token").value)}function xe(){A(TOKEN_TYPES.OpenStatement,"Expected opening statement token");let kt;switch(g[l].type){case TOKEN_TYPES.Set:++l,kt=te(),A(TOKEN_TYPES.CloseStatement,"Expected closing statement token");break;case TOKEN_TYPES.If:++l,kt=f(),A(TOKEN_TYPES.OpenStatement,"Expected {% token"),A(TOKEN_TYPES.EndIf,"Expected endif token"),A(TOKEN_TYPES.CloseStatement,"Expected %} token");break;case TOKEN_TYPES.For:++l,kt=H(),A(TOKEN_TYPES.OpenStatement,"Expected {% token"),A(TOKEN_TYPES.EndFor,"Expected endfor token"),A(TOKEN_TYPES.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${g[l].type}`)}return kt}function ne(){A(TOKEN_TYPES.OpenExpression,"Expected opening expression token");const kt=Z();return A(TOKEN_TYPES.CloseExpression,"Expected closing expression token"),kt}function te(){const kt=Z();if(R(TOKEN_TYPES.Equals)){++l;const yt=te();return new SetStatement(kt,yt)}return kt}function f(){const kt=Z();A(TOKEN_TYPES.CloseStatement,"Expected closing statement token");const yt=[],St=[];for(;!(g[l]?.type===TOKEN_TYPES.OpenStatement&&(g[l+1]?.type===TOKEN_TYPES.ElseIf||g[l+1]?.type===TOKEN_TYPES.Else||g[l+1]?.type===TOKEN_TYPES.EndIf));)yt.push(O());if(g[l]?.type===TOKEN_TYPES.OpenStatement&&g[l+1]?.type!==TOKEN_TYPES.EndIf)if(++l,R(TOKEN_TYPES.ElseIf))A(TOKEN_TYPES.ElseIf,"Expected elseif token"),St.push(f());else for(A(TOKEN_TYPES.Else,"Expected else token"),A(TOKEN_TYPES.CloseStatement,"Expected closing statement token");!(g[l]?.type===TOKEN_TYPES.OpenStatement&&g[l+1]?.type===TOKEN_TYPES.EndIf);)St.push(O());return new If(kt,yt,St)}function d(kt=!1){const yt=kt?Ot:Z,St=[yt()],Yt=R(TOKEN_TYPES.Comma);for(;Yt&&(++l,St.push(yt()),!!R(TOKEN_TYPES.Comma)););return Yt?new TupleLiteral(St):St[0]}function H(){const kt=d(!0);if(!(kt instanceof Identifier||kt instanceof TupleLiteral))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${kt.type} instead`);A(TOKEN_TYPES.In,"Expected `in` keyword following loop variable");const yt=Z();A(TOKEN_TYPES.CloseStatement,"Expected closing statement token");const St=[];for(;Y(TOKEN_TYPES.OpenStatement,TOKEN_TYPES.EndFor);)St.push(O());return new For(kt,yt,St)}function Z(){return Ye()}function Ye(){const kt=et();if(R(TOKEN_TYPES.If)){++l;const yt=et();A(TOKEN_TYPES.Else,"Expected else token");const St=et();return new If(yt,[kt],[St])}return kt}function et(){let kt=tt();for(;R(TOKEN_TYPES.Or);){const yt=g[l];++l;const St=tt();kt=new BinaryExpression(yt,kt,St)}return kt}function tt(){let kt=nt();for(;R(TOKEN_TYPES.And);){const yt=g[l];++l;const St=nt();kt=new BinaryExpression(yt,kt,St)}return kt}function nt(){let kt;for(;R(TOKEN_TYPES.Not);){const yt=g[l];++l;const St=nt();kt=new UnaryExpression(yt,St)}return kt??it()}function it(){let kt=ot();for(;R(TOKEN_TYPES.ComparisonBinaryOperator)||R(TOKEN_TYPES.In)||R(TOKEN_TYPES.NotIn);){const yt=g[l];++l;const St=ot();kt=new BinaryExpression(yt,kt,St)}return kt}function ot(){let kt=At();for(;R(TOKEN_TYPES.AdditiveBinaryOperator);){const yt=g[l];++l;const St=At();kt=new BinaryExpression(yt,kt,St)}return kt}function st(){const kt=_t();return R(TOKEN_TYPES.OpenParen)?at(kt):kt}function at(kt){let yt=new CallExpression(kt,ct());return R(TOKEN_TYPES.OpenParen)&&(yt=at(yt)),yt}function ct(){A(TOKEN_TYPES.OpenParen,"Expected opening parenthesis for arguments list");const kt=ft();return A(TOKEN_TYPES.CloseParen,"Expected closing parenthesis for arguments list"),kt}function ft(){const kt=[];for(;!R(TOKEN_TYPES.CloseParen);){let yt=Z();if(R(TOKEN_TYPES.Equals)){if(++l,!(yt instanceof Identifier))throw new SyntaxError("Expected identifier for keyword argument");const St=Z();yt=new KeywordArgumentExpression(yt,St)}kt.push(yt),R(TOKEN_TYPES.Comma)&&++l}return kt}function ut(){const kt=[];let yt=!1;for(;!R(TOKEN_TYPES.CloseSquareBracket);)R(TOKEN_TYPES.Colon)?(kt.push(void 0),++l,yt=!0):(kt.push(Z()),R(TOKEN_TYPES.Colon)&&(++l,yt=!0));if(kt.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(yt){if(kt.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new SliceExpression(...kt)}return kt[0]}function _t(){let kt=Ot();for(;R(TOKEN_TYPES.Dot)||R(TOKEN_TYPES.OpenSquareBracket);){const yt=g[l];++l;let St;const Yt=yt.type!==TOKEN_TYPES.Dot;if(Yt)St=ut(),A(TOKEN_TYPES.CloseSquareBracket,"Expected closing square bracket");else if(St=Ot(),St.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");kt=new MemberExpression(kt,St,Yt)}return kt}function At(){let kt=Et();for(;R(TOKEN_TYPES.MultiplicativeBinaryOperator);){const yt=g[l];++l;const St=Et();kt=new BinaryExpression(yt,kt,St)}return kt}function Et(){let kt=Mt();for(;R(TOKEN_TYPES.Is);){++l;const yt=R(TOKEN_TYPES.Not);yt&&++l;let St=Ot();if(St instanceof BooleanLiteral&&(St=new Identifier(St.value.toString())),!(St instanceof Identifier))throw new SyntaxError("Expected identifier for the test");kt=new TestExpression(kt,yt,St)}return kt}function Mt(){let kt=st();for(;R(TOKEN_TYPES.Pipe);){++l;let yt=Ot();if(!(yt instanceof Identifier))throw new SyntaxError("Expected identifier for the filter");R(TOKEN_TYPES.OpenParen)&&(yt=at(yt)),kt=new FilterExpression(kt,yt)}return kt}function Ot(){const kt=g[l];switch(kt.type){case TOKEN_TYPES.NumericLiteral:return++l,new NumericLiteral(Number(kt.value));case TOKEN_TYPES.StringLiteral:return++l,new StringLiteral(kt.value);case TOKEN_TYPES.BooleanLiteral:return++l,new BooleanLiteral(kt.value==="true");case TOKEN_TYPES.Identifier:return++l,new Identifier(kt.value);case TOKEN_TYPES.OpenParen:{++l;const yt=d();if(g[l].type!==TOKEN_TYPES.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${g[l].type} instead`);return++l,yt}case TOKEN_TYPES.OpenSquareBracket:{++l;const yt=[];for(;!R(TOKEN_TYPES.CloseSquareBracket);)yt.push(Z()),R(TOKEN_TYPES.Comma)&&++l;return++l,new ArrayLiteral(yt)}case TOKEN_TYPES.OpenCurlyBracket:{++l;const yt=new Map;for(;!R(TOKEN_TYPES.CloseCurlyBracket);){const St=Z();A(TOKEN_TYPES.Colon,"Expected colon between key and value in object literal");const Yt=Z();yt.set(St,Yt),R(TOKEN_TYPES.Comma)&&++l}return++l,new ObjectLiteral(yt)}default:throw new SyntaxError(`Unexpected token: ${kt.type}`)}}for(;l<g.length;)a.body.push(O());return a}function range(g,a,l=1){a===void 0&&(a=g,g=0);const A=[];for(let O=g;O<a;O+=l)A.push(O);return A}function slice(g,a,l,A=1){const O=Math.sign(A);O>=0?(a=(a??=0)<0?Math.max(g.length+a,0):Math.min(a,g.length),l=(l??=g.length)<0?Math.max(g.length+l,0):Math.min(l,g.length)):(a=(a??=g.length-1)<0?Math.max(g.length+a,-1):Math.min(a,g.length-1),l=(l??=-1)<-1?Math.max(g.length+l,-1):Math.min(l,g.length-1));const Y=[];for(let R=a;O*R<O*l;R+=A)Y.push(g[R]);return Y}function titleCase(g){return g.replace(/\b\w/g,a=>a.toUpperCase())}var RuntimeValue=class{type="RuntimeValue";value;builtins=new Map;constructor(g=void 0){this.value=g}__bool__(){return new BooleanValue(!!this.value)}},NumericValue=class extends RuntimeValue{type="NumericValue"},StringValue=class extends RuntimeValue{type="StringValue";builtins=new Map([["upper",new FunctionValue(()=>new StringValue(this.value.toUpperCase()))],["lower",new FunctionValue(()=>new StringValue(this.value.toLowerCase()))],["strip",new FunctionValue(()=>new StringValue(this.value.trim()))],["title",new FunctionValue(()=>new StringValue(titleCase(this.value)))],["length",new NumericValue(this.value.length)]])},BooleanValue=class extends RuntimeValue{type="BooleanValue"},ObjectValue=class extends RuntimeValue{type="ObjectValue";__bool__(){return new BooleanValue(this.value.size>0)}builtins=new Map([["get",new FunctionValue(([g,a])=>{if(!(g instanceof StringValue))throw new Error(`Object key must be a string: got ${g.type}`);return this.value.get(g.value)??a??new NullValue})],["items",new FunctionValue(()=>new ArrayValue(Array.from(this.value.entries()).map(([g,a])=>new ArrayValue([new StringValue(g),a]))))]])},ArrayValue=class extends RuntimeValue{type="ArrayValue";builtins=new Map([["length",new NumericValue(this.value.length)]]);__bool__(){return new BooleanValue(this.value.length>0)}},TupleValue=class extends ArrayValue{type="TupleValue"},FunctionValue=class extends RuntimeValue{type="FunctionValue"},NullValue=class extends RuntimeValue{type="NullValue"},UndefinedValue=class extends RuntimeValue{type="UndefinedValue"},Environment=class{constructor(g){this.parent=g}variables=new Map([["namespace",new FunctionValue(g=>{if(g.length===0)return new ObjectValue(new Map);if(g.length!==1||!(g[0]instanceof ObjectValue))throw new Error("`namespace` expects either zero arguments or a single object argument");return g[0]})]]);tests=new Map([["boolean",g=>g.type==="BooleanValue"],["callable",g=>g instanceof FunctionValue],["odd",g=>{if(g.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${g.type}`);return g.value%2!==0}],["even",g=>{if(g.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${g.type}`);return g.value%2===0}],["false",g=>g.type==="BooleanValue"&&!g.value],["true",g=>g.type==="BooleanValue"&&g.value],["number",g=>g.type==="NumericValue"],["integer",g=>g.type==="NumericValue"&&Number.isInteger(g.value)],["iterable",g=>g instanceof ArrayValue||g instanceof StringValue],["lower",g=>{const a=g.value;return g.type==="StringValue"&&a===a.toLowerCase()}],["upper",g=>{const a=g.value;return g.type==="StringValue"&&a===a.toUpperCase()}],["none",g=>g.type==="NullValue"],["defined",g=>g.type!=="UndefinedValue"],["undefined",g=>g.type==="UndefinedValue"],["equalto",(g,a)=>g.value===a.value]]);set(g,a){return this.declareVariable(g,convertToRuntimeValues(a))}declareVariable(g,a){if(this.variables.has(g))throw new SyntaxError(`Variable already declared: ${g}`);return this.variables.set(g,a),a}setVariable(g,a){return this.variables.set(g,a),a}resolve(g){if(this.variables.has(g))return this;if(this.parent)return this.parent.resolve(g);throw new Error(`Unknown variable: ${g}`)}lookupVariable(g){try{return this.resolve(g).variables.get(g)??new UndefinedValue}catch{return new UndefinedValue}}},Interpreter=class{global;constructor(g){this.global=g??new Environment}run(g){return this.evaluate(g,this.global)}evaluateBinaryExpression(g,a){const l=this.evaluate(g.left,a);switch(g.operator.value){case"and":return l.__bool__().value?this.evaluate(g.right,a):l;case"or":return l.__bool__().value?l:this.evaluate(g.right,a)}const A=this.evaluate(g.right,a);switch(g.operator.value){case"==":return new BooleanValue(l.value==A.value);case"!=":return new BooleanValue(l.value!=A.value)}if(l instanceof UndefinedValue||A instanceof UndefinedValue)throw new Error("Cannot perform operation on undefined values");if(l instanceof NullValue||A instanceof NullValue)throw new Error("Cannot perform operation on null values");if(l instanceof NumericValue&&A instanceof NumericValue)switch(g.operator.value){case"+":return new NumericValue(l.value+A.value);case"-":return new NumericValue(l.value-A.value);case"*":return new NumericValue(l.value*A.value);case"/":return new NumericValue(l.value/A.value);case"%":return new NumericValue(l.value%A.value);case"<":return new BooleanValue(l.value<A.value);case">":return new BooleanValue(l.value>A.value);case">=":return new BooleanValue(l.value>=A.value);case"<=":return new BooleanValue(l.value<=A.value)}else if(l instanceof ArrayValue&&A instanceof ArrayValue)switch(g.operator.value){case"+":return new ArrayValue(l.value.concat(A.value))}else if(A instanceof ArrayValue){const O=A.value.find(Y=>Y.value===l.value)!==void 0;switch(g.operator.value){case"in":return new BooleanValue(O);case"not in":return new BooleanValue(!O)}}if(l instanceof StringValue||A instanceof StringValue)switch(g.operator.value){case"+":return new StringValue(l.value.toString()+A.value.toString())}if(l instanceof StringValue&&A instanceof StringValue)switch(g.operator.value){case"in":return new BooleanValue(A.value.includes(l.value));case"not in":return new BooleanValue(!A.value.includes(l.value))}if(l instanceof StringValue&&A instanceof ObjectValue)switch(g.operator.value){case"in":return new BooleanValue(A.value.has(l.value));case"not in":return new BooleanValue(!A.value.has(l.value))}throw new SyntaxError(`Unknown operator "${g.operator.value}" between ${l.type} and ${A.type}`)}evaluateFilterExpression(g,a){const l=this.evaluate(g.operand,a);if(g.filter.type==="Identifier"){const A=g.filter;if(l instanceof ArrayValue)switch(A.value){case"list":return l;case"first":return l.value[0];case"last":return l.value[l.value.length-1];case"length":return new NumericValue(l.value.length);case"reverse":return new ArrayValue(l.value.reverse());case"sort":return new ArrayValue(l.value.sort((O,Y)=>{if(O.type!==Y.type)throw new Error(`Cannot compare different types: ${O.type} and ${Y.type}`);switch(O.type){case"NumericValue":return O.value-Y.value;case"StringValue":return O.value.localeCompare(Y.value);default:throw new Error(`Cannot compare type: ${O.type}`)}}));default:throw new Error(`Unknown ArrayValue filter: ${A.value}`)}else if(l instanceof StringValue)switch(A.value){case"length":return new NumericValue(l.value.length);case"upper":return new StringValue(l.value.toUpperCase());case"lower":return new StringValue(l.value.toLowerCase());case"title":return new StringValue(titleCase(l.value));case"capitalize":return new StringValue(l.value.charAt(0).toUpperCase()+l.value.slice(1));case"trim":return new StringValue(l.value.trim());default:throw new Error(`Unknown StringValue filter: ${A.value}`)}else if(l instanceof NumericValue)switch(A.value){case"abs":return new NumericValue(Math.abs(l.value));default:throw new Error(`Unknown NumericValue filter: ${A.value}`)}else if(l instanceof ObjectValue)switch(A.value){case"items":return new ArrayValue(Array.from(l.value.entries()).map(([O,Y])=>new ArrayValue([new StringValue(O),Y])));case"length":return new NumericValue(l.value.size);default:throw new Error(`Unknown ObjectValue filter: ${A.value}`)}throw new Error(`Cannot apply filter "${A.value}" to type: ${l.type}`)}else if(g.filter.type==="CallExpression"){const A=g.filter;if(A.callee.type!=="Identifier")throw new Error(`Unknown filter: ${A.callee.type}`);const O=A.callee.value;if(l instanceof ArrayValue){switch(O){case"selectattr":{if(l.value.some(te=>!(te instanceof ObjectValue)))throw new Error("`selectattr` can only be applied to array of objects");if(A.args.some(te=>te.type!=="StringLiteral"))throw new Error("arguments of `selectattr` must be strings");const[Y,R,ee]=A.args.map(te=>this.evaluate(te,a));let xe;if(R){const te=a.tests.get(R.value);if(!te)throw new Error(`Unknown test: ${R.value}`);xe=te}else xe=(...te)=>te[0].__bool__().value;const ne=l.value.filter(te=>{const f=te.value.get(Y.value);return f?xe(f,ee):!1});return new ArrayValue(ne)}}throw new Error(`Unknown ArrayValue filter: ${O}`)}else throw new Error(`Cannot apply filter "${O}" to type: ${l.type}`)}throw new Error(`Unknown filter: ${g.filter.type}`)}evaluateTestExpression(g,a){const l=this.evaluate(g.operand,a),A=a.tests.get(g.test.value);if(!A)throw new Error(`Unknown test: ${g.test.value}`);const O=A(l);return new BooleanValue(g.negate?!O:O)}evaluateUnaryExpression(g,a){const l=this.evaluate(g.argument,a);switch(g.operator.value){case"not":return new BooleanValue(!l.value);default:throw new SyntaxError(`Unknown operator: ${g.operator.value}`)}}evalProgram(g,a){return this.evaluateBlock(g.body,a)}evaluateBlock(g,a){let l="";for(const A of g){const O=this.evaluate(A,a);O.type!=="NullValue"&&O.type!=="UndefinedValue"&&(l+=O.value)}return new StringValue(l)}evaluateIdentifier(g,a){return a.lookupVariable(g.value)}evaluateCallExpression(g,a){const l=[],A=new Map;for(const Y of g.args)if(Y.type==="KeywordArgumentExpression"){const R=Y;A.set(R.key.value,this.evaluate(R.value,a))}else l.push(this.evaluate(Y,a));A.size>0&&l.push(new ObjectValue(A));const O=this.evaluate(g.callee,a);if(O.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${O.type}`);return O.value(l,a)}evaluateSliceExpression(g,a,l){if(!(g instanceof ArrayValue||g instanceof StringValue))throw new Error("Slice object must be an array or string");const A=this.evaluate(a.start,l),O=this.evaluate(a.stop,l),Y=this.evaluate(a.step,l);if(!(A instanceof NumericValue||A instanceof UndefinedValue))throw new Error("Slice start must be numeric or undefined");if(!(O instanceof NumericValue||O instanceof UndefinedValue))throw new Error("Slice stop must be numeric or undefined");if(!(Y instanceof NumericValue||Y instanceof UndefinedValue))throw new Error("Slice step must be numeric or undefined");return g instanceof ArrayValue?new ArrayValue(slice(g.value,A.value,O.value,Y.value)):new StringValue(slice(Array.from(g.value),A.value,O.value,Y.value).join(""))}evaluateMemberExpression(g,a){const l=this.evaluate(g.object,a);let A;if(g.computed){if(g.property.type==="SliceExpression")return this.evaluateSliceExpression(l,g.property,a);A=this.evaluate(g.property,a)}else A=new StringValue(g.property.value);let O;if(l instanceof ObjectValue){if(!(A instanceof StringValue))throw new Error(`Cannot access property with non-string: got ${A.type}`);O=l.value.get(A.value)??l.builtins.get(A.value)}else if(l instanceof ArrayValue||l instanceof StringValue)if(A instanceof NumericValue)O=l.value.at(A.value),l instanceof StringValue&&(O=new StringValue(l.value.at(A.value)));else if(A instanceof StringValue)O=l.builtins.get(A.value);else throw new Error(`Cannot access property with non-string/non-number: got ${A.type}`);else{if(!(A instanceof StringValue))throw new Error(`Cannot access property with non-string: got ${A.type}`);O=l.builtins.get(A.value)}return O instanceof RuntimeValue?O:new UndefinedValue}evaluateSet(g,a){const l=this.evaluate(g.value,a);if(g.assignee.type==="Identifier"){const A=g.assignee.value;a.setVariable(A,l)}else if(g.assignee.type==="MemberExpression"){const A=g.assignee,O=this.evaluate(A.object,a);if(!(O instanceof ObjectValue))throw new Error("Cannot assign to member of non-object");if(A.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");O.value.set(A.property.value,l)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(g.assignee)}`);return new NullValue}evaluateIf(g,a){const l=this.evaluate(g.test,a);return this.evaluateBlock(l.__bool__().value?g.body:g.alternate,a)}evaluateFor(g,a){const l=new Environment(a),A=this.evaluate(g.iterable,l);if(!(A instanceof ArrayValue))throw new Error(`Expected iterable type in for loop: got ${A.type}`);let O="";for(let Y=0;Y<A.value.length;++Y){const R=new Map([["index",new NumericValue(Y+1)],["index0",new NumericValue(Y)],["revindex",new NumericValue(A.value.length-Y)],["revindex0",new NumericValue(A.value.length-Y-1)],["first",new BooleanValue(Y===0)],["last",new BooleanValue(Y===A.value.length-1)],["length",new NumericValue(A.value.length)],["previtem",Y>0?A.value[Y-1]:new UndefinedValue],["nextitem",Y<A.value.length-1?A.value[Y+1]:new UndefinedValue]]);l.setVariable("loop",new ObjectValue(R));const ee=A.value[Y];if(g.loopvar.type==="Identifier")l.setVariable(g.loopvar.value,ee);else if(g.loopvar.type==="TupleLiteral"){const ne=g.loopvar;if(ee.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${ee.type}`);const te=ee;if(ne.value.length!==te.value.length)throw new Error(`Too ${ne.value.length>te.value.length?"few":"many"} items to unpack`);for(let f=0;f<ne.value.length;++f){if(ne.value[f].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${ne.value[f].type}`);l.setVariable(ne.value[f].value,te.value[f])}}const xe=this.evaluateBlock(g.body,l);O+=xe.value}return new StringValue(O)}evaluate(g,a){if(g===void 0)return new UndefinedValue;switch(g.type){case"Program":return this.evalProgram(g,a);case"Set":return this.evaluateSet(g,a);case"If":return this.evaluateIf(g,a);case"For":return this.evaluateFor(g,a);case"NumericLiteral":return new NumericValue(Number(g.value));case"StringLiteral":return new StringValue(g.value);case"BooleanLiteral":return new BooleanValue(g.value);case"ArrayLiteral":return new ArrayValue(g.value.map(l=>this.evaluate(l,a)));case"TupleLiteral":return new TupleValue(g.value.map(l=>this.evaluate(l,a)));case"ObjectLiteral":{const l=new Map;for(const[A,O]of g.value){const Y=this.evaluate(A,a);if(!(Y instanceof StringValue))throw new Error(`Object keys must be strings: got ${Y.type}`);l.set(Y.value,this.evaluate(O,a))}return new ObjectValue(l)}case"Identifier":return this.evaluateIdentifier(g,a);case"CallExpression":return this.evaluateCallExpression(g,a);case"MemberExpression":return this.evaluateMemberExpression(g,a);case"UnaryExpression":return this.evaluateUnaryExpression(g,a);case"BinaryExpression":return this.evaluateBinaryExpression(g,a);case"FilterExpression":return this.evaluateFilterExpression(g,a);case"TestExpression":return this.evaluateTestExpression(g,a);default:throw new SyntaxError(`Unknown node type: ${g.type}`)}}};function convertToRuntimeValues(g){switch(typeof g){case"number":return new NumericValue(g);case"string":return new StringValue(g);case"boolean":return new BooleanValue(g);case"object":return g===null?new NullValue:Array.isArray(g)?new ArrayValue(g.map(convertToRuntimeValues)):new ObjectValue(new Map(Object.entries(g).map(([a,l])=>[a,convertToRuntimeValues(l)])));case"function":return new FunctionValue((a,l)=>{const A=g(...a.map(O=>O.value))??null;return convertToRuntimeValues(A)});default:throw new Error(`Cannot convert to runtime value: ${g}`)}}var Template=class{parsed;constructor(g){const a=tokenize(g,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=parse(a)}render(g){const a=new Environment;a.set("false",!1),a.set("true",!0),a.set("raise_exception",O=>{throw new Error(O)}),a.set("range",range);for(const[O,Y]of Object.entries(g))a.set(O,Y);return new Interpreter(a).run(this.parsed).value}};async function loadTokenizer(g,a){const l=await Promise.all([getModelJSON(g,"tokenizer.json",!0,a),getModelJSON(g,"tokenizer_config.json",!0,a)]);return a.legacy!==null&&(l[1].legacy=a.legacy),l}function regexSplit(g,a){const l=[];let A=0;for(const O of g.matchAll(a)){const Y=O[0];A<O.index&&l.push(g.slice(A,O.index)),Y.length>0&&l.push(Y),A=O.index+Y.length}return A<g.length&&l.push(g.slice(A)),l}function createPattern(g,a=!0){if(g.Regex!==void 0){let l=g.Regex.replace(/\\([#&~])/g,"$1");for(const[A,O]of PROBLEMATIC_REGEX_MAP)l=l.replaceAll(A,O);return new RegExp(l,"gu")}else if(g.String!==void 0){const l=escapeRegExp(g.String);return new RegExp(a?l:`(${l})`,"gu")}else return console.warn("Unknown pattern type:",g),null}function objectToMap(g){return new Map(Object.entries(g))}function prepareTensorForDecode(g){const a=g.dims;switch(a.length){case 1:return g.tolist();case 2:if(a[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return g.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${a.length}.`)}}function clean_up_tokenization(g){return g.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function remove_accents(g){return g.replace(/[\u0300-\u036f]/g,"")}function lowercase_and_remove_accent(g){return remove_accents(g.toLowerCase())}function fuse(g,a,l){const A=[];let O=0;for(;O<g.length;){if(A.push(g[O]),(l.get(g[O])??a)!==a){++O;continue}for(;O<g.length&&(l.get(g[O])??a)===a;)++O}return A}function whitespace_split(g){return g.match(/\S+/g)||[]}const PUNCTUATION_REGEX="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",PROBLEMATIC_REGEX_MAP=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"]]);class AddedToken{constructor(a){this.content=a.content,this.id=a.id,this.single_word=a.single_word??!1,this.lstrip=a.lstrip??!1,this.rstrip=a.rstrip??!1,this.special=a.special??!1,this.normalized=a.normalized??null}}class TokenizerModel extends Callable{constructor(a){super(),this.config=a,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(a,...l){switch(a.type){case"WordPiece":return new WordPieceTokenizer(a);case"Unigram":return new Unigram(a,...l);case"BPE":return new BPE(a);default:if(a.vocab)return new LegacyTokenizerModel(a,...l);throw new Error(`Unknown TokenizerModel type: ${a.type}`)}}_call(a){let l=this.encode(a);return this.fuse_unk&&(l=fuse(l,this.unk_token_id,this.tokens_to_ids)),l}encode(a){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(a){return a.map(l=>this.tokens_to_ids.get(l)??this.unk_token_id)}convert_ids_to_tokens(a){return a.map(l=>this.vocab[l]??this.unk_token)}}class WordPieceTokenizer extends TokenizerModel{constructor(a){super(a),this.tokens_to_ids=objectToMap(a.vocab),this.unk_token_id=this.tokens_to_ids.get(a.unk_token),this.unk_token=a.unk_token,this.max_input_chars_per_word=a.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[l,A]of this.tokens_to_ids)this.vocab[A]=l}encode(a){const l=[];for(const A of a){const O=[...A];if(O.length>this.max_input_chars_per_word){l.push(this.unk_token);continue}let Y=!1,R=0;const ee=[];for(;R<O.length;){let xe=O.length,ne=null;for(;R<xe;){let te=O.slice(R,xe).join("");if(R>0&&(te=this.config.continuing_subword_prefix+te),this.tokens_to_ids.has(te)){ne=te;break}--xe}if(ne===null){Y=!0;break}ee.push(ne),R=xe}Y?l.push(this.unk_token):l.push(...ee)}return l}}class Unigram extends TokenizerModel{constructor(a,l){super(a);const A=a.vocab.length;this.vocab=new Array(A),this.scores=new Array(A);for(let O=0;O<A;++O){const Y=a.vocab[O];this.vocab[O]=Y[0],this.scores[O]=Y[1]}this.unk_token_id=a.unk_id,this.unk_token=this.vocab[a.unk_id],this.tokens_to_ids=new Map(this.vocab.map((O,Y)=>[O,Y])),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=l.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=min(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(a){const l=a.sentence,A=l.length;let O=0;for(;O<A;){let R=!1;for(let ee of this.trie.commonPrefixSearch(l.slice(O))){const xe=this.tokens_to_ids.get(ee),ne=this.scores[xe],te=ee.length;a.insert(O,te,ne,xe),!R&&te===1&&(R=!0)}R||a.insert(O,1,this.unkScore,this.unk_token_id),O+=1}}tokenize(a){const l=new TokenLattice(a,this.bosTokenId,this.eosTokenId);return this.populateNodes(l),l.tokens()}encode(a){const l=[];for(const A of a){const O=this.tokenize(A);l.push(...O)}return l}}const BYTES_TO_UNICODE=(()=>{const g=[...Array.from({length:94},(O,Y)=>Y+33),...Array.from({length:12},(O,Y)=>Y+161),...Array.from({length:82},(O,Y)=>Y+174)],a=g.slice();let l=0;for(let O=0;O<256;++O)g.includes(O)||(g.push(O),a.push(256+l),l+=1);const A=a.map(O=>String.fromCharCode(O));return Object.fromEntries(g.map((O,Y)=>[O,A[Y]]))})(),UNICODE_TO_BYTES=reverseDictionary(BYTES_TO_UNICODE);class BPE extends TokenizerModel{constructor(a){super(a),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=objectToMap(a.vocab),this.unk_token_id=this.tokens_to_ids.get(a.unk_token),this.unk_token=a.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[l,A]of this.tokens_to_ids)this.vocab[A]=l;this.bpe_ranks=new Map(a.merges.map((l,A)=>[l,A])),this.merges=a.merges.map(l=>l.split(this.BPE_SPLIT_TOKEN)),this.end_of_word_suffix=a.end_of_word_suffix,this.continuing_subword_suffix=a.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.cache=new Map}bpe(a){if(a.length===0)return[];const l=this.cache.get(a);if(l!==void 0)return l;const A=Array.from(a);this.end_of_word_suffix&&(A[A.length-1]+=this.end_of_word_suffix);let O=[];if(A.length>1){const Y=new PriorityQueue((xe,ne)=>xe.score<ne.score);let R={token:A[0],bias:0,prev:null,next:null},ee=R;for(let xe=1;xe<A.length;++xe){const ne={bias:xe/A.length,token:A[xe],prev:ee,next:null};ee.next=ne,this._add_node(Y,ee),ee=ne}for(;!Y.isEmpty();){const xe=Y.pop();if(xe.deleted||!xe.next||xe.next.deleted)continue;if(xe.deleted=!0,xe.next.deleted=!0,xe.prev){const te={...xe.prev};xe.prev.deleted=!0,xe.prev=te,te.prev?te.prev.next=te:R=te}const ne={token:xe.token+xe.next.token,bias:xe.bias,prev:xe.prev,next:xe.next.next};ne.prev?(ne.prev.next=ne,this._add_node(Y,ne.prev)):R=ne,ne.next&&(ne.next.prev=ne,this._add_node(Y,ne))}for(let xe=R;xe!==null;xe=xe.next)O.push(xe.token)}else O=A;if(this.continuing_subword_suffix)for(let Y=0;Y<O.length-1;++Y)O[Y]+=this.continuing_subword_suffix;return this.cache.set(a,O),O}_add_node(a,l){const A=this.bpe_ranks.get(l.token+this.BPE_SPLIT_TOKEN+l.next.token);A!==void 0&&(l.score=A+l.bias,a.push(l))}encode(a){const l=[];for(const A of a){if(this.ignore_merges&&this.tokens_to_ids.has(A)){l.push(A);continue}const O=this.bpe(A);for(const Y of O)this.tokens_to_ids.has(Y)?l.push(Y):this.byte_fallback?l.push(...Array.from(this.text_encoder.encode(Y)).map(R=>`<0x${R.toString(16).toUpperCase().padStart(2,"0")}>`)):l.push(this.unk_token)}return l}}class LegacyTokenizerModel extends TokenizerModel{constructor(a,l){super(a),this.tokens_to_ids=objectToMap(l.target_lang?a.vocab[l.target_lang]:a.vocab),this.bos_token=l.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=l.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=l.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=l.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[A,O]of this.tokens_to_ids)this.vocab[O]=A}encode(a){return a}}class Normalizer extends Callable{constructor(a){super(),this.config=a}static fromConfig(a){if(a===null)return null;switch(a.type){case"BertNormalizer":return new BertNormalizer(a);case"Precompiled":return new Precompiled(a);case"Sequence":return new NormalizerSequence(a);case"Replace":return new Replace(a);case"NFC":return new NFC(a);case"NFKC":return new NFKC(a);case"NFKD":return new NFKD(a);case"Strip":return new StripNormalizer(a);case"StripAccents":return new StripAccents(a);case"Lowercase":return new Lowercase(a);case"Prepend":return new Prepend(a);default:throw new Error(`Unknown Normalizer type: ${a.type}`)}}normalize(a){throw Error("normalize should be implemented in subclass.")}_call(a){return this.normalize(a)}}class Replace extends Normalizer{normalize(a){const l=createPattern(this.config.pattern);return l===null?a:a.replaceAll(l,this.config.content)}}class NFC extends Normalizer{normalize(a){return a=a.normalize("NFC"),a}}class NFKC extends Normalizer{normalize(a){return a=a.normalize("NFKC"),a}}class NFKD extends Normalizer{normalize(a){return a=a.normalize("NFKD"),a}}class StripNormalizer extends Normalizer{normalize(a){return this.config.strip_left&&this.config.strip_right?a=a.trim():(this.config.strip_left&&(a=a.trimStart()),this.config.strip_right&&(a=a.trimEnd())),a}}class StripAccents extends Normalizer{normalize(a){return a=remove_accents(a),a}}class Lowercase extends Normalizer{normalize(a){return a=a.toLowerCase(),a}}class Prepend extends Normalizer{normalize(a){return a=this.config.prepend+a,a}}class NormalizerSequence extends Normalizer{constructor(a){super(a),this.normalizers=a.normalizers.map(l=>Normalizer.fromConfig(l))}normalize(a){return this.normalizers.reduce((l,A)=>A.normalize(l),a)}}class BertNormalizer extends Normalizer{_tokenize_chinese_chars(a){const l=[];for(let A=0;A<a.length;++A){const O=a[A],Y=O.charCodeAt(0);this._is_chinese_char(Y)?(l.push(" "),l.push(O),l.push(" ")):l.push(O)}return l.join("")}_is_chinese_char(a){return a>=19968&&a<=40959||a>=13312&&a<=19903||a>=131072&&a<=173791||a>=173824&&a<=177983||a>=177984&&a<=178207||a>=178208&&a<=183983||a>=63744&&a<=64255||a>=194560&&a<=195103}stripAccents(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}_is_control(a){switch(a){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(a)}}_clean_text(a){const l=[];for(const A of a){const O=A.charCodeAt(0);O===0||O===65533||this._is_control(A)||(/^\s$/.test(A)?l.push(" "):l.push(A))}return l.join("")}normalize(a){return this.config.clean_text&&(a=this._clean_text(a)),this.config.handle_chinese_chars&&(a=this._tokenize_chinese_chars(a)),this.config.lowercase?(a=a.toLowerCase(),this.config.strip_accents!==!1&&(a=this.stripAccents(a))):this.config.strip_accents&&(a=this.stripAccents(a)),a}}class PreTokenizer extends Callable{static fromConfig(a){if(a===null)return null;switch(a.type){case"BertPreTokenizer":return new BertPreTokenizer(a);case"Sequence":return new PreTokenizerSequence(a);case"Whitespace":return new WhitespacePreTokenizer(a);case"WhitespaceSplit":return new WhitespaceSplit(a);case"Metaspace":return new MetaspacePreTokenizer(a);case"ByteLevel":return new ByteLevelPreTokenizer(a);case"Split":return new SplitPreTokenizer(a);case"Punctuation":return new PunctuationPreTokenizer(a);case"Digits":return new DigitsPreTokenizer(a);case"Replace":return new ReplacePreTokenizer(a);default:throw new Error(`Unknown PreTokenizer type: ${a.type}`)}}pre_tokenize_text(a,l){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(a,l){return(Array.isArray(a)?a.map(A=>this.pre_tokenize_text(A,l)):this.pre_tokenize_text(a,l)).flat()}_call(a,l){return this.pre_tokenize(a,l)}}class BertPreTokenizer extends PreTokenizer{constructor(a){super(),this.pattern=new RegExp(`[^\\s${PUNCTUATION_REGEX}]+|[${PUNCTUATION_REGEX}]`,"gu")}pre_tokenize_text(a,l){return a.trim().match(this.pattern)||[]}}class ByteLevelPreTokenizer extends PreTokenizer{constructor(a){super(),this.config=a,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=BYTES_TO_UNICODE,this.text_encoder=new TextEncoder}pre_tokenize_text(a,l){return this.add_prefix_space&&!a.startsWith(" ")&&(a=" "+a),(this.use_regex?a.match(this.pattern)||[]:[a]).map(O=>Array.from(this.text_encoder.encode(O),Y=>this.byte_encoder[Y]).join(""))}}class SplitPreTokenizer extends PreTokenizer{constructor(a){super(),this.config=a,this.pattern=createPattern(this.config.pattern,this.config.invert)}pre_tokenize_text(a,l){return this.pattern===null?[]:this.config.invert?a.match(this.pattern)||[]:regexSplit(a,this.pattern)}}class PunctuationPreTokenizer extends PreTokenizer{constructor(a){super(),this.config=a,this.pattern=new RegExp(`[^${PUNCTUATION_REGEX}]+|[${PUNCTUATION_REGEX}]+`,"gu")}pre_tokenize_text(a,l){return a.match(this.pattern)||[]}}class DigitsPreTokenizer extends PreTokenizer{constructor(a){super(),this.config=a;const l=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(l,"gu")}pre_tokenize_text(a,l){return a.match(this.pattern)||[]}}class PostProcessor extends Callable{constructor(a){super(),this.config=a}static fromConfig(a){if(a===null)return null;switch(a.type){case"TemplateProcessing":return new TemplateProcessing(a);case"ByteLevel":return new ByteLevelPostProcessor(a);case"RobertaProcessing":return new RobertaProcessing(a);case"BertProcessing":return new BertProcessing(a);case"Sequence":return new PostProcessorSequence(a);default:throw new Error(`Unknown PostProcessor type: ${a.type}`)}}post_process(a,...l){throw Error("post_process should be implemented in subclass.")}_call(a,...l){return this.post_process(a,...l)}}class BertProcessing extends PostProcessor{constructor(a){super(a),this.cls=a.cls[0],this.sep=a.sep[0]}post_process(a,l=null,{add_special_tokens:A=!0}={}){A&&(a=mergeArrays([this.cls],a,[this.sep]));let O=new Array(a.length).fill(0);if(l!==null){const Y=A&&this instanceof RobertaProcessing?[this.sep]:[],R=A?[this.sep]:[];a=mergeArrays(a,Y,l,R),O=mergeArrays(O,new Array(l.length+Y.length+R.length).fill(1))}return{tokens:a,token_type_ids:O}}}class RobertaProcessing extends BertProcessing{}class TemplateProcessing extends PostProcessor{constructor(a){super(a),this.single=a.single,this.pair=a.pair}post_process(a,l=null,{add_special_tokens:A=!0}={}){const O=l===null?this.single:this.pair;let Y=[],R=[];for(const ee of O)"SpecialToken"in ee?A&&(Y.push(ee.SpecialToken.id),R.push(ee.SpecialToken.type_id)):"Sequence"in ee&&(ee.Sequence.id==="A"?(Y=mergeArrays(Y,a),R=mergeArrays(R,new Array(a.length).fill(ee.Sequence.type_id))):ee.Sequence.id==="B"&&(Y=mergeArrays(Y,l),R=mergeArrays(R,new Array(l.length).fill(ee.Sequence.type_id))));return{tokens:Y,token_type_ids:R}}}class ByteLevelPostProcessor extends PostProcessor{post_process(a,l=null){return l&&(a=mergeArrays(a,l)),{tokens:a}}}class PostProcessorSequence extends PostProcessor{constructor(a){super(a),this.processors=a.processors.map(l=>PostProcessor.fromConfig(l))}post_process(a,l=null,A={}){let O;for(const Y of this.processors)if(Y instanceof ByteLevelPostProcessor)a=Y.post_process(a).tokens,l&&(l=Y.post_process(l).tokens);else{const R=Y.post_process(a,l,A);a=R.tokens,O=R.token_type_ids}return{tokens:a,token_type_ids:O}}}class Decoder extends Callable{constructor(a){super(),this.config=a,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=a.trim_offsets}static fromConfig(a){if(a===null)return null;switch(a.type){case"WordPiece":return new WordPieceDecoder(a);case"Metaspace":return new MetaspaceDecoder(a);case"ByteLevel":return new ByteLevelDecoder(a);case"Replace":return new ReplaceDecoder(a);case"ByteFallback":return new ByteFallback(a);case"Fuse":return new FuseDecoder(a);case"Strip":return new StripDecoder(a);case"Sequence":return new DecoderSequence(a);case"CTC":return new CTCDecoder(a);case"BPEDecoder":return new BPEDecoder(a);default:throw new Error(`Unknown Decoder type: ${a.type}`)}}_call(a){return this.decode(a)}decode(a){return this.decode_chain(a).join("")}decode_chain(a){throw Error("`decode_chain` should be implemented in subclass.")}}class ReplaceDecoder extends Decoder{decode_chain(a){const l=createPattern(this.config.pattern);return l===null?a:a.map(A=>A.replaceAll(l,this.config.content))}}class ByteFallback extends Decoder{constructor(a){super(a),this.text_decoder=new TextDecoder}decode_chain(a){const l=[];let A=[];for(const O of a){let Y=null;if(O.length===6&&O.startsWith("<0x")&&O.endsWith(">")){const R=parseInt(O.slice(3,5),16);isNaN(R)||(Y=R)}if(Y!==null)A.push(Y);else{if(A.length>0){const R=this.text_decoder.decode(Uint8Array.from(A));l.push(R),A=[]}l.push(O)}}if(A.length>0){const O=this.text_decoder.decode(Uint8Array.from(A));l.push(O),A=[]}return l}}class FuseDecoder extends Decoder{decode_chain(a){return[a.join("")]}}class StripDecoder extends Decoder{constructor(a){super(a),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(a){return a.map(l=>{let A=0;for(let Y=0;Y<this.start&&l[Y]===this.content;++Y){A=Y+1;continue}let O=l.length;for(let Y=0;Y<this.stop;++Y){const R=l.length-Y-1;if(l[R]===this.content){O=R;continue}else break}return l.slice(A,O)})}}class WordPieceDecoder extends Decoder{constructor(a){super(a),this.cleanup=a.cleanup}decode_chain(a){return a.map((l,A)=>(A!==0&&(l.startsWith(this.config.prefix)?l=l.replace(this.config.prefix,""):l=" "+l),this.cleanup&&(l=clean_up_tokenization(l)),l))}}class ByteLevelDecoder extends Decoder{constructor(a){super(a),this.byte_decoder=UNICODE_TO_BYTES,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(a){const l=a.join(""),A=new Uint8Array([...l].map(Y=>this.byte_decoder[Y]));return this.text_decoder.decode(A)}decode_chain(a){const l=[];let A=[];for(const O of a)this.added_tokens.find(Y=>Y.content===O)!==void 0?(A.length>0&&(l.push(this.convert_tokens_to_string(A)),A=[]),l.push(O)):A.push(O);return A.length>0&&l.push(this.convert_tokens_to_string(A)),l}}class CTCDecoder extends Decoder{constructor(a){super(a),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(a){if(a.length===0)return"";const l=[a[0]];for(let Y=1;Y<a.length;++Y)a[Y]!==l.at(-1)&&l.push(a[Y]);let O=l.filter(Y=>Y!==this.pad_token).join("");return this.cleanup&&(O=clean_up_tokenization(O).replaceAll(this.word_delimiter_token," ").trim()),O}decode_chain(a){return[this.convert_tokens_to_string(a)]}}class DecoderSequence extends Decoder{constructor(a){super(a),this.decoders=a.decoders.map(l=>Decoder.fromConfig(l))}decode_chain(a){return this.decoders.reduce((l,A)=>A.decode_chain(l),a)}}class BPEDecoder extends Decoder{constructor(a){super(a),this.suffix=this.config.suffix}decode_chain(a){return a.map((l,A)=>l.replaceAll(this.suffix,A===a.length-1?"":" "))}}class VitsDecoder extends Decoder{decode_chain(a){let l="";for(let A=1;A<a.length;A+=2)l+=a[A];return[l]}}class MetaspacePreTokenizer extends PreTokenizer{constructor(a){super(),this.addPrefixSpace=a.add_prefix_space,this.replacement=a.replacement,this.strRep=a.str_rep||this.replacement,this.prepend_scheme=a.prepend_scheme??"always"}pre_tokenize_text(a,{section_index:l=void 0}={}){let A=a.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!A.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&l===0)&&(A=this.strRep+A),[A]}}class MetaspaceDecoder extends Decoder{constructor(a){super(a),this.addPrefixSpace=a.add_prefix_space,this.replacement=a.replacement}decode_chain(a){const l=[];for(let A=0;A<a.length;++A){let O=a[A].replaceAll(this.replacement," ");this.addPrefixSpace&&A==0&&O.startsWith(" ")&&(O=O.substring(1)),l.push(O)}return l}}class Precompiled extends Normalizer{constructor(a){super(a),this.charsmap=a.precompiled_charsmap}normalize(a){return a=a.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),a=a.replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," "),a.includes("～")?a=a.split("～").map(A=>A.normalize("NFKC")).join("～"):a=a.normalize("NFKC"),a}}class PreTokenizerSequence extends PreTokenizer{constructor(a){super(),this.tokenizers=a.pretokenizers.map(l=>PreTokenizer.fromConfig(l))}pre_tokenize_text(a,l){return this.tokenizers.reduce((A,O)=>O.pre_tokenize(A,l),[a])}}class WhitespacePreTokenizer extends PreTokenizer{constructor(a){super()}pre_tokenize_text(a,l){return a.match(/\w+|[^\w\s]+/g)||[]}}class WhitespaceSplit extends PreTokenizer{constructor(a){super()}pre_tokenize_text(a,l){return whitespace_split(a)}}class ReplacePreTokenizer extends PreTokenizer{constructor(a){super(),this.config=a,this.pattern=createPattern(this.config.pattern),this.content=this.config.content}pre_tokenize_text(a,l){return this.pattern===null?[a]:[a.replaceAll(this.pattern,this.config.content)]}}const SPECIAL_TOKEN_ATTRIBUTES=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function padHelper(g,a,l,A){for(const O of Object.keys(g)){const Y=a-g[O].length,R=l(O),ee=new Array(Y).fill(R);g[O]=A==="right"?mergeArrays(g[O],ee):mergeArrays(ee,g[O])}}function truncateHelper(g,a){for(const l of Object.keys(g))g[l].length=a}class PreTrainedTokenizer extends Callable{return_token_type_ids=!1;_default_chat_template=`{% for message in messages %}{{'<|im_start|>' + message['role'] + '
' + message['content'] + '<|im_end|>' + '
'}}{% endfor %}{% if add_generation_prompt %}{{ '<|im_start|>assistant
' }}{% endif %}`;constructor(a,l){super(),this._tokenizer_config=l,this.normalizer=Normalizer.fromConfig(a.normalizer),this.pre_tokenizer=PreTokenizer.fromConfig(a.pre_tokenizer),this.model=TokenizerModel.fromConfig(a.model,l),this.post_processor=PostProcessor.fromConfig(a.post_processor),this.decoder=Decoder.fromConfig(a.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const A of a.added_tokens){const O=new AddedToken(A);this.added_tokens.push(O),this.model.tokens_to_ids.set(O.content,O.id),this.model.vocab[O.id]=O.content,O.special&&(this.special_tokens.push(O.content),this.all_special_ids.push(O.id))}if(this.additional_special_tokens=l.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.map(A=>`${A.lstrip?"\\s*":""}(${escapeRegExp(A.content)})${A.rstrip?"\\s*":""}`).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.model_max_length=l.model_max_length,this.remove_space=l.remove_space,this.clean_up_tokenization_spaces=l.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=l.do_lowercase_and_remove_accent??!1,this.padding_side="right",this.legacy=!1,this.chat_template=l.chat_template??null,Array.isArray(this.chat_template)){const A=Object.create(null);for(const{name:O,template:Y}of this.chat_template){if(typeof O!="string"||typeof Y!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');A[O]=Y}this.chat_template=A}this._compiled_template_cache=new Map}getToken(...a){for(const l of a){const A=this._tokenizer_config[l];if(A)if(typeof A=="object"){if(A.__type==="AddedToken")return A.content;throw Error(`Unknown token: ${A}`)}else return A}return null}static async from_pretrained(a,{progress_callback:l=null,config:A=null,cache_dir:O=null,local_files_only:Y=!1,revision:R="main",legacy:ee=null}={}){const xe=await loadTokenizer(a,{progress_callback:l,cache_dir:O,local_files_only:Y,revision:R,legacy:ee});return new this(...xe)}_call(a,{text_pair:l=null,add_special_tokens:A=!0,padding:O=!1,truncation:Y=null,max_length:R=null,return_tensor:ee=!0,return_token_type_ids:xe=null}={}){const ne=Array.isArray(a);let te;if(ne){if(a.length===0)throw Error("text array must be non-empty");if(l!==null){if(Array.isArray(l)){if(a.length!==l.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");te=a.map((d,H)=>this._encode_plus(d,l[H],{add_special_tokens:A,return_token_type_ids:xe}))}else te=a.map(d=>this._encode_plus(d,null,{add_special_tokens:A,return_token_type_ids:xe}))}else{if(a==null)throw Error("text may not be null or undefined");if(Array.isArray(l))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");te=[this._encode_plus(a,l,{add_special_tokens:A,return_token_type_ids:xe})]}if(R===null?O==="max_length"?R=this.model_max_length:R=max(te.map(d=>d.input_ids.length))[0]:Y||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),R=Math.min(R,this.model_max_length),O||Y)for(let d=0;d<te.length;++d)te[d].input_ids.length!==R&&(te[d].input_ids.length>R?Y&&truncateHelper(te[d],R):O&&padHelper(te[d],R,H=>H==="input_ids"?this.pad_token_id:0,this.padding_side));const f={};if(ee){if(!(O&&Y)&&te.some(H=>{for(const Z of Object.keys(H))if(H[Z].length!==te[0][Z]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const d=[te.length,te[0].input_ids.length];for(const H of Object.keys(te[0]))f[H]=new Tensor("int64",BigInt64Array.from(te.flatMap(Z=>Z[H]).map(BigInt)),d)}else{for(const d of Object.keys(te[0]))f[d]=te.map(H=>H[d]);if(!ne)for(const d of Object.keys(f))f[d]=f[d][0]}return f}_encode_text(a){return a===null?null:(this.added_tokens_regex?a.split(this.added_tokens_regex).filter(O=>O):[a]).map((O,Y)=>{if(this.added_tokens.find(ee=>ee.content===O)!==void 0)return O;{if(this.remove_space===!0&&(O=O.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(O=lowercase_and_remove_accent(O)),this.normalizer!==null&&(O=this.normalizer(O)),O.length===0)return[];const ee=this.pre_tokenizer!==null?this.pre_tokenizer(O,{section_index:Y}):[O];return this.model(ee)}}).flat()}_encode_plus(a,l=null,{add_special_tokens:A=!0,return_token_type_ids:O=null}={}){const Y=this._encode_text(a),R=this._encode_text(l),ee=this.post_processor?this.post_processor(Y,R,{add_special_tokens:A}):{tokens:mergeArrays(Y??[],R??[])},xe=this.model.convert_tokens_to_ids(ee.tokens),ne={input_ids:xe,attention_mask:new Array(xe.length).fill(1)};return(O??this.return_token_type_ids)&&ee.token_type_ids&&(ne.token_type_ids=ee.token_type_ids),ne}encode(a,l=null,{add_special_tokens:A=!0,return_token_type_ids:O=null}={}){const{input_ids:Y}=this._encode_plus(a,l,{add_special_tokens:A,return_token_type_ids:O});return Y}batch_decode(a,l={}){return a instanceof Tensor&&(a=a.tolist()),a.map(A=>this.decode(A,l))}decode(a,l={}){if(a instanceof Tensor&&(a=prepareTensorForDecode(a)),!Array.isArray(a)||a.length===0||!isIntegralNumber(a[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(a,l)}decode_single(a,{skip_special_tokens:l=!1,clean_up_tokenization_spaces:A=null}){let O=this.model.convert_ids_to_tokens(a);l&&(O=O.filter(R=>!this.special_tokens.includes(R)));let Y=this.decoder?this.decoder(O):O.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(Y=Y.replaceAll(this.decoder.end_of_word_suffix," "),l&&(Y=Y.trim())),(A??this.clean_up_tokenization_spaces)&&(Y=clean_up_tokenization(Y)),Y}get default_chat_template(){return this._warned_about_chat_template||(console.warn("No chat template is defined for this tokenizer - using a default chat template that implements the ChatML format. If the default is not appropriate for your model, please set `tokenizer.chat_template` to an appropriate template. See https://huggingface.co/docs/transformers/main/chat_templating for more information."),this._warned_about_chat_template=!0),this._default_chat_template}apply_chat_template(a,{chat_template:l=null,add_generation_prompt:A=!1,tokenize:O=!0,padding:Y=!1,truncation:R=!1,max_length:ee=null,return_tensor:xe=!0,tokenizer_kwargs:ne={},...te}={}){if(this.chat_template&&typeof this.chat_template=="object"||this.chat_template===null&&this.default_chat_template&&typeof this.default_chat_template=="object"){const Z=this.chat_template??this.default_chat_template;if(l!==null&&Object.hasOwn(Z,l))l=Z[l];else if(l===null&&"default"in Z)l=Z.default;else if(l===null)throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(Z).sort()}.`)}else l??=this.chat_template??this.default_chat_template;if(typeof l!="string")throw Error(`chat_template must be a string, but got ${typeof l}`);let f=this._compiled_template_cache.get(l);f===void 0&&(f=new Template(l),this._compiled_template_cache.set(l,f));const d=Object.create(null);for(const Z of SPECIAL_TOKEN_ATTRIBUTES){const Ye=this.getToken(Z);Ye&&(d[Z]=Ye)}const H=f.render({messages:a,add_generation_prompt:A,...d,...te});return O?this._call(H,{add_special_tokens:!1,padding:Y,truncation:R,max_length:ee,return_tensor:xe,...ne}).input_ids:H}}class BertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class AlbertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class MobileBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class SqueezeBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DebertaTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DebertaV2Tokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class HerbertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class ConvBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class RoFormerTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DistilBertTokenizer extends PreTrainedTokenizer{}class CamembertTokenizer extends PreTrainedTokenizer{}class XLMTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0;constructor(a,l){super(a,l),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class ElectraTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class T5Tokenizer extends PreTrainedTokenizer{}class GPT2Tokenizer extends PreTrainedTokenizer{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}'}class BartTokenizer extends PreTrainedTokenizer{}class MBartTokenizer extends PreTrainedTokenizer{constructor(a,l){super(a,l),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(A=>this.languageRegex.test(A)),this.lang_to_token=A=>A}_build_translation_inputs(a,l,A){return _build_translation_inputs(this,a,l,A)}}class MBart50Tokenizer extends MBartTokenizer{}class RobertaTokenizer extends PreTrainedTokenizer{}class BloomTokenizer extends GPT2Tokenizer{constructor(a,l){const A=".,!?…。，、।۔،",O=a.pre_tokenizer?.pretokenizers[0]?.pattern;O&&O.Regex===` ?[^(\\s|[${A}])]+`&&(O.Regex=` ?[^\\s${A}]+`),super(a,l)}}const SPIECE_UNDERLINE="▁";class LlamaTokenizer extends PreTrainedTokenizer{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{% set loop_messages = messages[1:] %}{% set system_message = messages[0]['content'] %}{% elif USE_DEFAULT_PROMPT == true and not '<<SYS>>' in messages[0]['content'] %}{% set loop_messages = messages %}{% set system_message = 'DEFAULT_SYSTEM_MESSAGE' %}{% else %}{% set loop_messages = messages %}{% set system_message = false %}{% endif %}{% for message in loop_messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if loop.index0 == 0 and system_message != false %}{% set content = '<<SYS>>
' + system_message + '
<</SYS>>

' + message['content'] %}{% else %}{% set content = message['content'] %}{% endif %}{% if message['role'] == 'user' %}{{ bos_token + '[INST] ' + content.strip() + ' [/INST]' }}{% elif message['role'] == 'system' %}{{ '<<SYS>>
' + content.strip() + '
<</SYS>>

' }}{% elif message['role'] == 'assistant' %}{{ ' '  + content.strip() + ' ' + eos_token }}{% endif %}{% endfor %}`;DEFAULT_SYSTEM_PROMPT=`You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.

If a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information.`;constructor(a,l){super(a,l),this.use_default_system_prompt=l.use_default_system_prompt??!1,this.legacy=l.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new MetaspacePreTokenizer({replacement:SPIECE_UNDERLINE,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(a){if(a===null)return null;if(this.legacy||a.length===0)return super._encode_text(a);let l=super._encode_text(SPIECE_UNDERLINE+a.replaceAll(SPIECE_UNDERLINE," "));return l.length>1&&l[0]===SPIECE_UNDERLINE&&this.special_tokens.includes(l[1])&&(l=l.slice(1)),l}get default_chat_template(){return super.default_chat_template.replaceAll("USE_DEFAULT_PROMPT",this.use_default_system_prompt?"true":"false").replaceAll("DEFAULT_SYSTEM_MESSAGE",this.DEFAULT_SYSTEM_PROMPT.replaceAll(`
`,"\\n").replaceAll("'","\\'"))}}class CodeLlamaTokenizer extends LlamaTokenizer{}class XLMRobertaTokenizer extends PreTrainedTokenizer{}class MPNetTokenizer extends PreTrainedTokenizer{}class FalconTokenizer extends PreTrainedTokenizer{}class GPTNeoXTokenizer extends PreTrainedTokenizer{}class EsmTokenizer extends PreTrainedTokenizer{}class Qwen2Tokenizer extends PreTrainedTokenizer{}class GemmaTokenizer extends PreTrainedTokenizer{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{{ raise_exception('System role not supported') }}{% endif %}{% for message in messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if (message['role'] == 'assistant') %}{% set role = 'model' %}{% else %}{% set role = message['role'] %}{% endif %}{{ '<start_of_turn>' + role + '
' + message['content'] | trim + '<end_of_turn>
' }}{% endfor %}{% if add_generation_prompt %}{{'<start_of_turn>model
'}}{% endif %}`}class Grok1Tokenizer extends PreTrainedTokenizer{}function _build_translation_inputs(g,a,l,A){if(!("language_codes"in g)||!Array.isArray(g.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in g)||!(g.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in g)||typeof g.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const O=A.src_lang,Y=A.tgt_lang;if(!g.language_codes.includes(Y))throw new Error(`Target language code "${Y}" is not valid. Must be one of: {${g.language_codes.join(", ")}}`);if(O!==void 0){if(!g.language_codes.includes(O))throw new Error(`Source language code "${O}" is not valid. Must be one of: {${g.language_codes.join(", ")}}`);for(const R of g.post_processor.config.single)if("SpecialToken"in R&&g.languageRegex.test(R.SpecialToken.id)){R.SpecialToken.id=g.lang_to_token(O);break}}return A.forced_bos_token_id=g.model.convert_tokens_to_ids([g.lang_to_token(Y)])[0],g._call(a,l)}class NllbTokenizer extends PreTrainedTokenizer{constructor(a,l){super(a,l),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(A=>this.languageRegex.test(A)),this.lang_to_token=A=>A}_build_translation_inputs(a,l,A){return _build_translation_inputs(this,a,l,A)}}class M2M100Tokenizer extends PreTrainedTokenizer{constructor(a,l){super(a,l),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(A=>this.languageRegex.test(A)).map(A=>A.slice(2,-2)),this.lang_to_token=A=>`__${A}__`}_build_translation_inputs(a,l,A){return _build_translation_inputs(this,a,l,A)}}const WHISPER_LANGUAGES=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],WHISPER_LANGUAGE_MAPPING=new Map(WHISPER_LANGUAGES),WHISPER_TO_LANGUAGE_CODE_MAPPING=new Map([...WHISPER_LANGUAGES.map(([g,a])=>[a,g]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);class WhisperTokenizer extends PreTrainedTokenizer{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}';_decode_asr(a,{return_timestamps:l=!1,return_language:A=!1,time_precision:O=null,force_full_sequences:Y=!0}={}){if(O===null)throw Error("Must specify time_precision");let R=null;const ee=l==="word";function xe(){return{language:R,timestamp:[null,null],text:""}}const ne=[];let te=xe(),f=0;const d=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1;let H=[],Z=[],Ye=!1,et=null;const tt=new Set(this.all_special_ids);for(const ot of a){const st=ot.tokens,at=ee?ot.token_timestamps:null;let ct=null,ft=d;if("stride"in ot){const[At,Et,Mt]=ot.stride;if(f-=Et,et=At-Mt,Et&&(ft=Et/O+d),Mt)for(let Ot=st.length-1;Ot>=0;--Ot){const kt=st[Ot];if(kt>=d){if(ct!==null&&(kt-d)*O<et)break;ct=kt}}}let ut=[],_t=[];for(let At=0;At<st.length;++At){const Et=st[At];if(tt.has(Et)){const Mt=this.decode([Et]),Ot=WHISPER_LANGUAGE_MAPPING.get(Mt.slice(2,-2));if(Ot!==void 0){if(R!==null&&Ot!==R&&!l){H.push(ut);const kt=this.findLongestCommonSequence(H)[0],yt=this.decode(kt);te.text=yt,ne.push(te),H=[],ut=[],te=xe()}R=te.language=Ot}}else if(Et>=d){const Mt=(Et-d)*O+f,Ot=round(Mt,2);if(ct!==null&&Et>=ct)Ye=!0;else if(Ye||H.length>0&&Et<ft)Ye=!1;else if(te.timestamp[0]===null)te.timestamp[0]=Ot;else if(Ot!==te.timestamp[0]){te.timestamp[1]=Ot,H.push(ut),ee&&Z.push(_t);const[kt,yt]=this.findLongestCommonSequence(H,Z),St=this.decode(kt);te.text=St,ee&&(te.words=this.collateWordTimestamps(kt,yt,R)),ne.push(te),H=[],ut=[],Z=[],_t=[],te=xe()}}else if(ut.push(Et),ee){let Mt=round(at[At]+f,2),Ot;At+1<at.length?Ot=round(at[At+1]+f,2):Ot=null,_t.push([Mt,Ot])}}if("stride"in ot){const[At,Et,Mt]=ot.stride;f+=At-Mt}ut.length>0?(H.push(ut),ee&&Z.push(_t)):H.every(At=>At.length===0)&&(te=xe(),H=[],ut=[],Z=[],_t=[])}if(H.length>0){if(Y&&l)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[ot,st]=this.findLongestCommonSequence(H,Z),at=this.decode(ot);te.text=at,ee&&(te.words=this.collateWordTimestamps(ot,st,R)),ne.push(te)}let nt=Object.create(null);const it=ne.map(ot=>ot.text).join("");if(l||A){for(let ot=0;ot<ne.length;++ot){const st=ne[ot];l||delete st.timestamp,A||delete st.language}if(ee){const ot=[];for(const st of ne)for(const at of st.words)ot.push(at);nt={chunks:ot}}else nt={chunks:ne}}return[it,nt]}findLongestCommonSequence(a,l=null){let A=a[0],O=A.length,Y=[];const R=Array.isArray(l)&&l.length>0;let ee=R?[]:null,xe=R?l[0]:null;for(let ne=1;ne<a.length;++ne){const te=a[ne];let f=0,d=[O,O,0,0];const H=te.length;for(let ot=1;ot<O+H;++ot){const st=ot/1e4,at=Math.max(0,O-ot),ct=Math.min(O,O+H-ot),ft=A.slice(at,ct),ut=Math.max(0,ot-O),_t=Math.min(H,ot),At=te.slice(ut,_t);if(ft.length!==At.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");const Et=ft.filter((Ot,kt)=>Ot===At[kt]).length,Mt=Et/ot+st;Et>1&&Mt>f&&(f=Mt,d=[at,ct,ut,_t])}const[Z,Ye,et,tt]=d,nt=Math.floor((Ye+Z)/2),it=Math.floor((tt+et)/2);Y.push(...A.slice(0,nt)),A=te.slice(it),O=A.length,R&&(ee.push(...xe.slice(0,nt)),xe=l[ne].slice(it))}return Y.push(...A),R?(ee.push(...xe),[Y,ee]):[Y,[]]}collateWordTimestamps(a,l,A){const[O,Y,R]=this.combineTokensIntoWords(a,A),ee=[];for(let xe=0;xe<O.length;++xe){const ne=R[xe];ee.push({text:O[xe],timestamp:[l[ne.at(0)][0],l[ne.at(-1)][1]]})}return ee}combineTokensIntoWords(a,l,A=`"'“¡¿([{-`,O=`"'.。,，!！?？:：”)]}、`){l=l??"english";let Y,R,ee;return["chinese","japanese","thai","lao","myanmar"].includes(l)?[Y,R,ee]=this.splitTokensOnUnicode(a):[Y,R,ee]=this.splitTokensOnSpaces(a),this.mergePunctuations(Y,R,ee,A,O)}decode(a,l){let A;return l&&l.decode_with_timestamps?(a instanceof Tensor&&(a=prepareTensorForDecode(a)),A=this.decodeWithTimestamps(a,l)):A=super.decode(a,l),A}decodeWithTimestamps(a,l){const A=l?.time_precision??.02,O=Array.from(this.all_special_ids).at(-1)+1;let Y=[[]];for(const R of a)if(R>=O){const ee=round((R-O)*A,2);Y.push(`<|${ee}|>`),Y.push([])}else Y[Y.length-1].push(R);return Y=Y.map(R=>typeof R=="string"?R:super.decode(R,l)),Y.join("")}splitTokensOnUnicode(a){const l=this.decode(a,{decode_with_timestamps:!0}),A="�",O=[],Y=[],R=[];let ee=[],xe=[],ne=0;for(let te=0;te<a.length;++te){const f=a[te];ee.push(f),xe.push(te);const d=this.decode(ee,{decode_with_timestamps:!0});(!d.includes(A)||l[ne+d.indexOf(A)]===A)&&(O.push(d),Y.push(ee),R.push(xe),ee=[],xe=[],ne+=d.length)}return[O,Y,R]}splitTokensOnSpaces(a){const[l,A,O]=this.splitTokensOnUnicode(a),Y=[],R=[],ee=[],xe=new RegExp(`^[${PUNCTUATION_REGEX}]$`,"gu");for(let ne=0;ne<l.length;++ne){const te=l[ne],f=A[ne],d=O[ne],H=f[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),Z=te.startsWith(" "),Ye=te.trim(),et=xe.test(Ye);if(H||Z||et||Y.length===0)Y.push(te),R.push(f),ee.push(d);else{const tt=Y.length-1;Y[tt]+=te,R[tt].push(...f),ee[tt].push(...d)}}return[Y,R,ee]}mergePunctuations(a,l,A,O,Y){const R=structuredClone(a),ee=structuredClone(l),xe=structuredClone(A);let ne=R.length-2,te=R.length-1;for(;ne>=0;)R[ne].startsWith(" ")&&O.includes(R[ne].trim())?(R[te]=R[ne]+R[te],ee[te]=mergeArrays(ee[ne],ee[te]),xe[te]=mergeArrays(xe[ne],xe[te]),R[ne]="",ee[ne]=[],xe[ne]=[]):te=ne,--ne;for(ne=0,te=1;te<R.length;)!R[ne].endsWith(" ")&&Y.includes(R[te])?(R[ne]+=R[te],ee[ne]=mergeArrays(ee[ne],ee[te]),xe[ne]=mergeArrays(xe[ne],xe[te]),R[te]="",ee[te]=[],xe[te]=[]):ne=te,++te;return[R.filter(f=>f),ee.filter(f=>f.length>0),xe.filter(f=>f.length>0)]}get_decoder_prompt_ids({language:a=null,task:l=null,no_timestamps:A=!0}={}){const O=[];if(a){a=a.toLowerCase();let Y=WHISPER_TO_LANGUAGE_CODE_MAPPING.get(a);if(Y===void 0)if(WHISPER_LANGUAGE_MAPPING.has(a))Y=a;else{const xe=a.length===2?WHISPER_LANGUAGE_MAPPING.keys():WHISPER_LANGUAGE_MAPPING.values();throw new Error(`Language "${a}" is not supported. Must be one of: ${JSON.stringify(xe)}`)}const R=this.model.tokens_to_ids.get(`<|${Y}|>`);if(R===void 0)throw new Error(`Unable to find language "${Y}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);O.push(R)}else O.push(null);if(l){if(l=l.toLowerCase(),l!=="transcribe"&&l!=="translate")throw new Error(`Task "${l}" is not supported. Must be one of: ["transcribe", "translate"]`);const Y=this.model.tokens_to_ids.get(`<|${l}|>`);if(Y===void 0)throw new Error(`Unable to find task "${l}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);O.push(Y)}else O.push(null);if(A){const Y=this.model.tokens_to_ids.get("<|notimestamps|>");if(Y===void 0)throw new Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');O.push(Y)}return O.map((Y,R)=>[R+1,Y]).filter(Y=>Y[1]!==null)}}class CodeGenTokenizer extends PreTrainedTokenizer{}class CLIPTokenizer extends PreTrainedTokenizer{}class SiglipTokenizer extends PreTrainedTokenizer{}class MarianTokenizer extends PreTrainedTokenizer{constructor(a,l){super(a,l),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(A=>this.languageRegex.test(A)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(a){if(a===null)return null;const[l,...A]=a.trim().split(this.languageRegex);if(A.length===0)return super._encode_text(l);if(A.length===2){const[O,Y]=A;return this.supported_language_codes.includes(O)||console.warn(`Unsupported language code "${O}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),mergeArrays([O],super._encode_text(Y))}}}class Wav2Vec2CTCTokenizer extends PreTrainedTokenizer{}class BlenderbotTokenizer extends PreTrainedTokenizer{_default_chat_template="{% for message in messages %}{% if message['role'] == 'user' %}{{ ' ' }}{% endif %}{{ message['content'] }}{% if not loop.last %}{{ '  ' }}{% endif %}{% endfor %}{{ eos_token }}"}class BlenderbotSmallTokenizer extends BlenderbotTokenizer{}class SpeechT5Tokenizer extends PreTrainedTokenizer{}class NougatTokenizer extends PreTrainedTokenizer{}class VitsTokenizer extends PreTrainedTokenizer{constructor(a,l){super(a,l),this.decoder=new VitsDecoder({})}}class CohereTokenizer extends PreTrainedTokenizer{}class AutoTokenizer{static TOKENIZER_CLASS_MAPPING={T5Tokenizer,DistilBertTokenizer,CamembertTokenizer,DebertaTokenizer,DebertaV2Tokenizer,BertTokenizer,HerbertTokenizer,ConvBertTokenizer,RoFormerTokenizer,XLMTokenizer,ElectraTokenizer,MobileBertTokenizer,SqueezeBertTokenizer,AlbertTokenizer,GPT2Tokenizer,BartTokenizer,MBartTokenizer,MBart50Tokenizer,RobertaTokenizer,WhisperTokenizer,CodeGenTokenizer,CLIPTokenizer,SiglipTokenizer,MarianTokenizer,BloomTokenizer,NllbTokenizer,M2M100Tokenizer,LlamaTokenizer,CodeLlamaTokenizer,XLMRobertaTokenizer,MPNetTokenizer,FalconTokenizer,GPTNeoXTokenizer,EsmTokenizer,Wav2Vec2CTCTokenizer,BlenderbotTokenizer,BlenderbotSmallTokenizer,SpeechT5Tokenizer,NougatTokenizer,VitsTokenizer,Qwen2Tokenizer,GemmaTokenizer,Grok1Tokenizer,CohereTokenizer,PreTrainedTokenizer};static async from_pretrained(a,{quantized:l=!0,progress_callback:A=null,config:O=null,cache_dir:Y=null,local_files_only:R=!1,revision:ee="main",legacy:xe=null}={}){const[ne,te]=await loadTokenizer(a,{progress_callback:A,cache_dir:Y,local_files_only:R,revision:ee,legacy:xe}),f=te.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer";let d=this.TOKENIZER_CLASS_MAPPING[f];return d||(console.warn(`Unknown tokenizer class "${f}", attempting to construct from base class.`),d=PreTrainedTokenizer),new d(ne,te)}}async function loadConfig(g,a){return await getModelJSON(g,"config.json",!0,a)}class PretrainedConfig{constructor(a){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,a)}static async from_pretrained(a,{progress_callback:l=null,config:A=null,cache_dir:O=null,local_files_only:Y=!1,revision:R="main"}={}){let ee=A??await loadConfig(a,{progress_callback:l,cache_dir:O,local_files_only:Y,revision:R});return new this(ee)}}class AutoConfig{static async from_pretrained(...a){return PretrainedConfig.from_pretrained(...a)}}class LogitsProcessorList extends Callable{constructor(){super(),this.processors=[]}push(a){this.processors.push(a)}extend(a){this.processors.push(...a)}_call(a,l){for(let A of l)this.processors.forEach(O=>O(a,A))}[Symbol.iterator](){return this.processors.values()}}class LogitsProcessor extends Callable{_call(a,l){throw Error("`_call` should be implemented in a subclass")}}class ForceTokensLogitsProcessor extends LogitsProcessor{constructor(a){super(),this.force_token_map=Object.fromEntries(a??[])}_call(a,l){let A=this.force_token_map[a.length];return exists(A)&&(l.data.fill(-1/0),l.data[A]=0),l}}class ForcedBOSTokenLogitsProcessor extends LogitsProcessor{constructor(a){super(),this.bos_token_id=a}_call(a,l){return a.length===1&&(l.data.fill(-1/0),l.data[this.bos_token_id]=0),l}}class ForcedEOSTokenLogitsProcessor extends LogitsProcessor{constructor(a,l){super(),this.max_length=a,this.forced_eos_token_id=l}_call(a,l){}}class SuppressTokensAtBeginLogitsProcessor extends LogitsProcessor{constructor(a,l){super(),this.begin_suppress_tokens=a,this.begin_index=l}_call(a,l){if(a.length===this.begin_index)for(let A of this.begin_suppress_tokens)l.data[A]=-1/0;return l}}class WhisperTimeStampLogitsProcessor extends LogitsProcessor{constructor(a){super(),this.eos_token_id=a.eos_token_id,this.no_timestamps_token_id=a.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(a.forced_decoder_ids||[]).length+2,a.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=a.max_initial_timestamp_index}_call(a,l){const A=l.data;if(A[this.no_timestamps_token_id]=-1/0,a.length===this.begin_index-1)return A.fill(-1/0),A[this.timestamp_begin]=0,l;const O=a.slice(this.begin_index),Y=O.length>=1&&O[O.length-1]>=this.timestamp_begin,R=O.length<2||O[O.length-2]>=this.timestamp_begin;if(Y&&(R?A.subarray(this.timestamp_begin).fill(-1/0):A.subarray(0,this.eos_token_id).fill(-1/0)),a.length===this.begin_index&&this.max_initial_timestamp_index!==null){const te=this.timestamp_begin+this.max_initial_timestamp_index;A.subarray(te+1).fill(-1/0)}const ee=log_softmax(A),xe=Math.log(ee.subarray(this.timestamp_begin).map(Math.exp).reduce((te,f)=>te+f)),ne=max(ee.subarray(0,this.timestamp_begin))[0];return xe>ne&&A.subarray(0,this.timestamp_begin).fill(-1/0),l}}class NoRepeatNGramLogitsProcessor extends LogitsProcessor{constructor(a){super(),this.no_repeat_ngram_size=a}getNgrams(a){const l=a.length,A=[];for(let Y=0;Y<l+1-this.no_repeat_ngram_size;++Y){const R=[];for(let ee=0;ee<this.no_repeat_ngram_size;++ee)R.push(a[Y+ee]);A.push(R)}const O=new Map;for(const Y of A){const R=Y.slice(0,Y.length-1),ee=JSON.stringify(R),xe=O.get(ee)??[];xe.push(Y[Y.length-1]),O.set(ee,xe)}return O}getGeneratedNgrams(a,l){const A=l.slice(l.length+1-this.no_repeat_ngram_size,l.length);return a.get(JSON.stringify(A))??[]}calcBannedNgramTokens(a){const l=[];if(a.length+1<this.no_repeat_ngram_size)return l;{const A=this.getNgrams(a);return this.getGeneratedNgrams(A,a)}}_call(a,l){const A=this.calcBannedNgramTokens(a);for(const O of A)l.data[O]=-1/0;return l}}class RepetitionPenaltyLogitsProcessor extends LogitsProcessor{constructor(a){super(),this.penalty=a}_call(a,l){for(const A of a)l.data[A]<0?l.data[A]*=this.penalty:l.data[A]/=this.penalty;return l}}class MinLengthLogitsProcessor extends LogitsProcessor{constructor(a,l){super(),this.min_length=a,this.eos_token_id=Array.isArray(l)?l:[l]}_call(a,l){if(a.length<this.min_length)for(const A of this.eos_token_id)l.data[A]=-1/0;return l}}class MinNewTokensLengthLogitsProcessor extends LogitsProcessor{constructor(a,l,A){super(),this.prompt_length_to_skip=a,this.min_new_tokens=l,this.eos_token_id=Array.isArray(A)?A:[A]}_call(a,l){if(a.length-this.prompt_length_to_skip<this.min_new_tokens)for(const O of this.eos_token_id)l.data[O]=-1/0;return l}}class NoBadWordsLogitsProcessor extends LogitsProcessor{constructor(a,l){super(),this.bad_words_ids=a,this.eos_token_id=Array.isArray(l)?l:[l]}_call(a,l){for(const A of this.bad_words_ids){let O=!0;for(let Y=1;Y<=A.length-1&&A.length<a.length;++Y)if(A.at(-Y-1)!==a.at(-Y)){O=!1;break}O&&(l.data[A.at(-1)]=-1/0)}return l}}const GenerationConfig=class{constructor(g={}){this.max_length=g.max_length??20,this.max_new_tokens=g.max_new_tokens??null,this.min_length=g.min_length??0,this.min_new_tokens=g.min_new_tokens??null,this.early_stopping=g.early_stopping??!1,this.max_time=g.max_time??null,this.do_sample=g.do_sample??!1,this.num_beams=g.num_beams??1,this.num_beam_groups=g.num_beam_groups??1,this.penalty_alpha=g.penalty_alpha??null,this.use_cache=g.use_cache??!0,this.temperature=g.temperature??1,this.top_k=g.top_k??50,this.top_p=g.top_p??1,this.typical_p=g.typical_p??1,this.epsilon_cutoff=g.epsilon_cutoff??0,this.eta_cutoff=g.eta_cutoff??0,this.diversity_penalty=g.diversity_penalty??0,this.repetition_penalty=g.repetition_penalty??1,this.encoder_repetition_penalty=g.encoder_repetition_penalty??1,this.length_penalty=g.length_penalty??1,this.no_repeat_ngram_size=g.no_repeat_ngram_size??0,this.bad_words_ids=g.bad_words_ids??null,this.force_words_ids=g.force_words_ids??null,this.renormalize_logits=g.renormalize_logits??!1,this.constraints=g.constraints??null,this.forced_bos_token_id=g.forced_bos_token_id??null,this.forced_eos_token_id=g.forced_eos_token_id??null,this.remove_invalid_values=g.remove_invalid_values??!1,this.exponential_decay_length_penalty=g.exponential_decay_length_penalty??null,this.suppress_tokens=g.suppress_tokens??null,this.begin_suppress_tokens=g.begin_suppress_tokens??null,this.forced_decoder_ids=g.forced_decoder_ids??null,this.num_return_sequences=g.num_return_sequences??1,this.output_attentions=g.output_attentions??!1,this.output_hidden_states=g.output_hidden_states??!1,this.output_scores=g.output_scores??!1,this.return_dict_in_generate=g.return_dict_in_generate??!1,this.pad_token_id=g.pad_token_id??null,this.bos_token_id=g.bos_token_id??null,this.eos_token_id=g.eos_token_id??null,this.encoder_no_repeat_ngram_size=g.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=g.decoder_start_token_id??null,this.generation_kwargs=g.generation_kwargs??{}}};class Sampler extends Callable{constructor(a){super(),this.generation_config=a}_call(a,l=-1){return this.sample(a,l)}sample(a,l){throw Error("sample should be implemented in subclasses.")}getLogits(a,l){let A=a.dims.at(-1),O=a.data;if(l===-1)O=O.slice(-A);else{let Y=l*A;O=O.slice(Y,Y+A)}return this.generation_config.temperature>0&&(O=O.map(Y=>Y/this.generation_config.temperature)),O}randomSelect(a){let l=a.reduce((O,Y)=>O+Y,0),A=Math.random()*l;for(let O=0;O<a.length;++O)if(A-=a[O],A<=0)return O;return 0}static getSampler(a){if(a.do_sample)return new MultinomialSampler(a);if(a.num_beams>1)return new BeamSearchSampler(a);if(a.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${a.num_return_sequences}.`);return new GreedySampler(a)}}class GreedySampler extends Sampler{sample(a,l=-1){let A=this.getLogits(a,l);return[[max(A)[1],0]]}}class MultinomialSampler extends Sampler{sample(a,l=-1){let A=a.dims.at(-1);this.generation_config.top_k>0&&(A=Math.min(this.generation_config.top_k,A));const O=this.getLogits(a,l),Y=getTopItems(O,A),R=softmax(Y.map(ee=>ee[1]));return Array.from({length:this.generation_config.num_beams},()=>{const ee=this.randomSelect(R);return[Y[ee][0],Math.log(R[ee])]})}}class BeamSearchSampler extends Sampler{sample(a,l=-1){let A=a.dims.at(-1);this.generation_config.top_k>0&&(A=Math.min(this.generation_config.top_k,A));const O=this.getLogits(a,l),Y=getTopItems(O,A),R=softmax(Y.map(ee=>ee[1]));return Array.from({length:this.generation_config.num_beams},(ee,xe)=>[Y[xe][0],Math.log(R[xe])])}}const{InferenceSession,Tensor:ONNXTensor,env}=ONNX,MODEL_TYPES={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5},MODEL_TYPE_MAPPING=new Map,MODEL_NAME_TO_CLASS_MAPPING=new Map,MODEL_CLASS_TO_NAME_MAPPING=new Map;async function constructSession(g,a,l){let A=`onnx/${a}${l.quantized?"_quantized":""}.onnx`,O=await getModelFile(g,A,!0,l);try{return await InferenceSession.create(O,{executionProviders})}catch(Y){if(executionProviders.length===1&&executionProviders[0]==="wasm")throw Y;return console.warn(Y),console.warn("Something went wrong during model construction (most likely a missing operation). Using `wasm` as a fallback. "),await InferenceSession.create(O,{executionProviders:["wasm"]})}}function validateInputs(g,a){const l=Object.create(null),A=[];for(const R of g.inputNames){const ee=a[R];if(!(ee instanceof Tensor)){A.push(R);continue}l[R]=env.wasm.proxy?ee.clone():ee}if(A.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${A.join(", ")}.`);const O=Object.keys(a).length,Y=g.inputNames.length;if(O>Y){let R=Object.keys(a).filter(ee=>!g.inputNames.includes(ee));console.warn(`WARNING: Too many inputs were provided (${O} > ${Y}). The following inputs will be ignored: "${R.join(", ")}".`)}return l}async function sessionRun(g,a){const l=validateInputs(g,a);try{let A=await g.run(l);return A=replaceTensors(A),A}catch(A){throw console.error(`An error occurred during model execution: "${A}".`),console.error("Inputs given to model:",l),A}}function replaceTensors(g){for(let a in g)g[a]instanceof ONNXTensor?g[a]=new Tensor(g[a]):typeof g[a]=="object"&&replaceTensors(g[a]);return g}function toI64Tensor(g){if(g instanceof Tensor)return g;if(g.length===0)throw Error("items must be non-empty");if(Array.isArray(g[0])){if(g.some(a=>a.length!==g[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new Tensor("int64",BigInt64Array.from(g.flat().map(a=>BigInt(a))),[g.length,g[0].length])}else return new Tensor("int64",BigInt64Array.from(g.map(a=>BigInt(a))),[1,g.length])}function prepareAttentionMask(g,a){let l=g.config.pad_token_id??null,A=g.config.eos_token_id??null;isIntegralNumber(A)&&(A=[A]);let O=a.indexOf(l)!==-1,Y=A===null||!A.includes(l);if(O&&Y){let R=BigInt64Array.from(a.data.map(ee=>ee!=l));return new Tensor("int64",R,a.dims)}else return ones_like(a)}function preparePositionIds(g,a,l){if(!g.inputNames.includes("position_ids"))return;const A=new BigInt64Array(a.attention_mask.data.length);for(let O=0;O<a.attention_mask.dims[0];++O){let Y=O*a.attention_mask.dims[1],R=BigInt(0);for(let ee=0;ee<a.attention_mask.dims[1];++ee){const xe=Y+ee;a.attention_mask.data[xe]===0n?A[xe]=BigInt(1):(A[xe]=R,R+=a.attention_mask.data[xe])}}a.position_ids=new Tensor("int64",A,a.attention_mask.dims),l&&(a.position_ids=a.position_ids.slice(null,-1).unsqueeze_(-1))}function boolTensor(g){return new Tensor("bool",[g],[1])}async function seq2seqForward(g,a){let{encoder_outputs:l,past_key_values:A}=a;l||(l=(await encoderForward(g,a)).last_hidden_state);let O={input_ids:a.decoder_input_ids,encoder_hidden_states:l};const Y=!!A;g.decoder_merged_session.inputNames.includes("use_cache_branch")&&(O.use_cache_branch=boolTensor(Y)),g.decoder_merged_session.inputNames.includes("encoder_attention_mask")&&(O.encoder_attention_mask=a.attention_mask),preparePositionIds(g.decoder_merged_session,O,Y),g.addPastKeyValues(O,A);const R=await sessionRun(g.decoder_merged_session,O);let ee=R.logits;A=g.getPastKeyValues(R,A);const xe=g.getAttentions(R);return new Seq2SeqLMOutput({logits:ee,past_key_values:A,encoder_outputs:l,...xe})}function seq2seqStartBeams(g,a,l,A){let O=[],Y=0;const R=g.requires_attention_mask??!0;let ee=l.decoder_input_ids??l.decoder_start_token_id??l.bos_token_id??l.eos_token_id;ee instanceof Tensor?ee=ee.tolist().flat():Array.isArray(ee)||(ee=[ee]);for(let xe of a){xe.dims=[1,...xe.dims];let ne={inputs:xe,encoder_outputs:null,prev_model_outputs:null,output_token_ids:ee,done:!1,score:0,id:Y++};R&&(ne.attention_mask=prepareAttentionMask(g,xe)),O.push(ne)}return O}async function seq2seqRunBeam(g,a){const l=g.main_input_name;let A=a.output_token_ids;a.prev_model_outputs&&(A=A.slice(-1));let O={[l]:a.inputs,decoder_input_ids:toI64Tensor(A),encoder_outputs:a.encoder_outputs,past_key_values:a.prev_model_outputs?.past_key_values};a.attention_mask&&(O.attention_mask=a.attention_mask);let Y=await g.forward(O);return a.prev_model_outputs=Y,a.encoder_outputs=Y.encoder_outputs,Y}function seq2seqUpdatebeam(g,a){g.output_token_ids=[...g.output_token_ids,a]}async function encoderForward(g,a){const l=Object.create(null);for(const A of g.session.inputNames)l[A]=a[A];return g.session.inputNames.includes("token_type_ids")&&!l.token_type_ids&&(l.token_type_ids=new Tensor("int64",new BigInt64Array(l.input_ids.data.length),l.input_ids.dims)),await sessionRun(g.session,l)}async function decoderForward(g,a){let{input_ids:l,past_key_values:A,attention_mask:O}=a,Y={input_ids:l,attention_mask:O??prepareAttentionMask(g,l)};const R=!!A;g.session.inputNames.includes("use_cache_branch")&&(Y.use_cache_branch=boolTensor(R)),preparePositionIds(g.session,Y,R),g.addPastKeyValues(Y,A);let ee=await sessionRun(g.session,Y),xe=ee.logits;return A=g.getPastKeyValues(ee,A),{logits:xe,past_key_values:A}}function decoderStartBeams(g,a,l,A,O){let Y=[],R=0;for(let ee of a){let xe=ee.tolist().map(Number);ee.dims=[1,...ee.dims];let ne;O?(ne=O[R],ne.dims=[1,...ne.dims]):ne=prepareAttentionMask(g,ee);let te={input:ee,model_input_ids:ee,attention_mask:ne,prev_model_outputs:null,output_token_ids:xe,num_output_tokens:A,done:!1,score:0,id:R++};Y.push(te)}return Y}async function decoderRunBeam(g,a){let l=new BigInt64Array(a.output_token_ids.length).fill(1n),A={input_ids:a.model_input_ids,attention_mask:new Tensor("int64",l,[1,l.length]),past_key_values:a.prev_model_outputs?.past_key_values},O=await g.forward(A);return a.prev_model_outputs=O,O}function decoderUpdatebeam(g,a){g.output_token_ids=[...g.output_token_ids,a],g.model_input_ids=new Tensor("int64",[BigInt(a)],[1,1])}class PreTrainedModel extends Callable{main_input_name="input_ids";constructor(a,l){super(),this.config=a,this.session=l;const A=MODEL_CLASS_TO_NAME_MAPPING.get(this.constructor),O=MODEL_TYPE_MAPPING.get(A);this.can_generate=!1,this._runBeam=null,this._getStartBeams=null,this._updateBeam=null,this._forward=null,O===MODEL_TYPES.DecoderOnly?(this.can_generate=!0,this._runBeam=decoderRunBeam,this._getStartBeams=decoderStartBeams,this._updateBeam=decoderUpdatebeam,this._forward=decoderForward):O===MODEL_TYPES.Seq2Seq||O===MODEL_TYPES.Vision2Seq?(this.can_generate=!0,this._runBeam=seq2seqRunBeam,this._getStartBeams=seq2seqStartBeams,this._updateBeam=seq2seqUpdatebeam,this._forward=seq2seqForward):O===MODEL_TYPES.EncoderDecoder?this._forward=encoderForward:this._forward=encoderForward}async dispose(){const a=[];for(let l of Object.keys(this)){const A=this[l];A instanceof InferenceSession&&a.push(A.handler.dispose())}return await Promise.all(a)}static async from_pretrained(a,{quantized:l=!0,progress_callback:A=null,config:O=null,cache_dir:Y=null,local_files_only:R=!1,revision:ee="main",model_file_name:xe=null}={}){let ne={quantized:l,progress_callback:A,config:O,cache_dir:Y,local_files_only:R,revision:ee,model_file_name:xe};const te=MODEL_CLASS_TO_NAME_MAPPING.get(this),f=MODEL_TYPE_MAPPING.get(te);let d;return f===MODEL_TYPES.DecoderOnly?d=await Promise.all([AutoConfig.from_pretrained(a,ne),constructSession(a,ne.model_file_name??"decoder_model_merged",ne),getModelJSON(a,"generation_config.json",!1,ne)]):f===MODEL_TYPES.Seq2Seq||f===MODEL_TYPES.Vision2Seq?d=await Promise.all([AutoConfig.from_pretrained(a,ne),constructSession(a,"encoder_model",ne),constructSession(a,"decoder_model_merged",ne),getModelJSON(a,"generation_config.json",!1,ne)]):f===MODEL_TYPES.MaskGeneration?d=await Promise.all([AutoConfig.from_pretrained(a,ne),constructSession(a,"vision_encoder",ne),constructSession(a,"prompt_encoder_mask_decoder",ne)]):f===MODEL_TYPES.EncoderDecoder?d=await Promise.all([AutoConfig.from_pretrained(a,ne),constructSession(a,"encoder_model",ne),constructSession(a,"decoder_model_merged",ne)]):(f!==MODEL_TYPES.EncoderOnly&&console.warn(`Model type for '${te??O?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),d=await Promise.all([AutoConfig.from_pretrained(a,ne),constructSession(a,ne.model_file_name??"model",ne)])),new this(...d)}async _call(a){return await this.forward(a)}async forward(a){return await this._forward(this,a)}_get_logits_processor(a,l,A=null){const O=new LogitsProcessorList;if(a.repetition_penalty!==null&&a.repetition_penalty!==1&&O.push(new RepetitionPenaltyLogitsProcessor(a.repetition_penalty)),a.no_repeat_ngram_size!==null&&a.no_repeat_ngram_size>0&&O.push(new NoRepeatNGramLogitsProcessor(a.no_repeat_ngram_size)),a.bad_words_ids!==null&&O.push(new NoBadWordsLogitsProcessor(a.bad_words_ids,a.eos_token_id)),a.min_length!==null&&a.eos_token_id!==null&&a.min_length>0&&O.push(new MinLengthLogitsProcessor(a.min_length,a.eos_token_id)),a.min_new_tokens!==null&&a.eos_token_id!==null&&a.min_new_tokens>0&&O.push(new MinNewTokensLengthLogitsProcessor(l,a.min_new_tokens,a.eos_token_id)),a.forced_bos_token_id!==null&&O.push(new ForcedBOSTokenLogitsProcessor(a.forced_bos_token_id)),a.forced_eos_token_id!==null&&O.push(new ForcedEOSTokenLogitsProcessor(a.max_length,a.forced_eos_token_id)),a.begin_suppress_tokens!==null){let Y=l>1||a.forced_bos_token_id===null?l:l+1;a.forced_decoder_ids!==null&&(Y+=a.forced_decoder_ids[a.forced_decoder_ids.length-1][0]),O.push(new SuppressTokensAtBeginLogitsProcessor(a.begin_suppress_tokens,Y))}return a.forced_decoder_ids!==null&&O.push(new ForceTokensLogitsProcessor(a.forced_decoder_ids)),A!==null&&O.extend(A),O}_get_generation_config(a){let l=new GenerationConfig(this.config);return"generation_config"in this&&Object.assign(l,this.generation_config),a!==null&&Object.assign(l,a),l}async generate(a,l=null,A=null,{inputs_attention_mask:O=null}={}){if(!this.can_generate){let et=`The current model class (${MODEL_CLASS_TO_NAME_MAPPING.get(this.constructor)}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;const tt=this.config.model_type,nt=MODEL_WITH_LM_HEAD_MAPPING_NAMES.get(tt)??MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES.get(tt)??MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES.get(tt)??MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES.get(tt);throw nt&&(et+=` Please use the following class instead: '${nt[0]}'`),Error(et)}if(!(a instanceof Tensor)&&!isTypedArray(a)&&!Array.isArray(a))throw Error(`\`inputs\` must be a Tensor, TypedArray, or Array, but is "${a.constructor.name}".`);let Y;if(this.config.is_encoder_decoder)Y=0;else if(Y=a instanceof Tensor?a.dims.at(-1):a.length,Y===0)throw Error("Must supply a non-empty array of input token ids.");l=this._get_generation_config(l),A=A??new LogitsProcessorList,A=this._get_logits_processor(l,Y,A);let R=l.eos_token_id;R!==null&&!Array.isArray(R)&&(R=[R]);let ee=1;const xe=ee+(l.max_new_tokens??1/0),ne=Number.isInteger(l.max_length)&&(l.max_new_tokens??null)===null;let te=Sampler.getSampler(l),f=this.getStartBeams(a,l,ee,O);for(;f.some(Ye=>!Ye.done)&&ee<xe;){let Ye=[];for(let et of f){if(et.done){Ye.push(et);continue}if(ne&&et.output_token_ids.length>=l.max_length){et.done=!0,Ye.push(et);continue}let tt=await this.runBeam(et);l.output_attentions&&this.addAttentionsToBeam(et,tt),l.output_scores;let nt=tt.logits.slice(null,-1,null);A(et.output_token_ids,nt);let it=te(nt);for(let[ot,st]of it){let at={...et};this.updateBeam(at,ot),at.score+=st,R&&R.includes(ot)&&(at.done=!0),Ye.push(at)}}++ee,Ye=this.groupBeams(Ye).map(et=>et.sort((tt,nt)=>nt.score-tt.score).slice(0,l.num_beams)),f=Ye.flat(),l.callback_function&&l.callback_function(f)}const d=this.groupBeams(f),H=Ye=>d.map(et=>l.num_return_sequences>1?et.slice(0,l.num_return_sequences).map(tt=>tt[Ye]):[et[0][Ye]]).flat(),Z=H("output_token_ids");if(l.return_dict_in_generate){const Ye=H("decoder_attentions"),et=H("cross_attentions");return{sequences:Z,decoder_attentions:Ye,cross_attentions:et}}else return Z}addAttentionsToBeam(a,l){if(this.config.is_encoder_decoder){if(!l.cross_attentions||l.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");a.cross_attentions||(a.cross_attentions=[]),a.cross_attentions.push(l.cross_attentions)}if(!l.decoder_attentions||l.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");a.decoder_attentions||(a.decoder_attentions=[]),a.decoder_attentions.push(l.decoder_attentions)}groupBeams(a){const l=Object.create(null);for(const A of a)l[A.id]===void 0?l[A.id]=[A]:l[A.id].push(A);return Object.values(l)}getPastKeyValues(a,l){const A=Object.create(null);for(const O in a)if(O.startsWith("present")){let Y=O.replace("present","past_key_values");l&&O.includes("encoder")?A[Y]=l[Y]:A[Y]=a[O]}return A}getAttentions(a){const l=Object.create(null);for(const A of["cross_attentions","decoder_attentions"]){const O=[];for(const Y in a)if(Y.startsWith(A)){const R=Y.split(".").pop();O[R]=a[Y]}l[A]=O}return l}addPastKeyValues(a,l){if(l)Object.assign(a,l);else if(this.config.is_encoder_decoder&&(this.add_encoder_pkv??!0)){let O=[1,this.num_encoder_heads,0,this.encoder_dim_kv],Y=[1,this.num_decoder_heads,0,this.decoder_dim_kv];for(let R=0;R<this.num_decoder_layers;++R)a[`past_key_values.${R}.encoder.key`]=new Tensor("float32",[],O),a[`past_key_values.${R}.encoder.value`]=new Tensor("float32",[],O),a[`past_key_values.${R}.decoder.key`]=new Tensor("float32",[],Y),a[`past_key_values.${R}.decoder.value`]=new Tensor("float32",[],Y)}else if(this.config.model_type==="falcon"){let O=[1*this.num_heads,0,this.dim_kv];for(let Y=0;Y<this.num_layers;++Y)a[`past_key_values.${Y}.key`]=new Tensor("float32",[],O),a[`past_key_values.${Y}.value`]=new Tensor("float32",[],O)}else if(this.config.multi_query){let O=[1*this.num_heads,0,2*this.dim_kv];for(let Y=0;Y<this.num_layers;++Y)a[`past_key_values.${Y}.key_value`]=new Tensor("float32",[],O)}else if(this.config.model_type==="bloom"){let O=[1*this.num_heads,this.dim_kv,0],Y=[1*this.num_heads,0,this.dim_kv];for(let R=0;R<this.num_layers;++R)a[`past_key_values.${R}.key`]=new Tensor("float32",[],O),a[`past_key_values.${R}.value`]=new Tensor("float32",[],Y)}else{let O=[1,this.num_heads,0,this.dim_kv];for(let Y=0;Y<this.num_layers;++Y)a[`past_key_values.${Y}.key`]=new Tensor("float32",[],O),a[`past_key_values.${Y}.value`]=new Tensor("float32",[],O)}}getStartBeams(a,l,A,O){return this._getStartBeams(this,a,l,A,O)}async runBeam(a){return await this._runBeam(this,a)}updateBeam(a,l){return this._updateBeam(a,l)}}class ModelOutput{}class BertPreTrainedModel extends PreTrainedModel{}class BertModel extends BertPreTrainedModel{}class BertForMaskedLM extends BertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class BertForSequenceClassification extends BertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class BertForTokenClassification extends BertPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class BertForQuestionAnswering extends BertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class NomicBertPreTrainedModel extends PreTrainedModel{}class NomicBertModel extends NomicBertPreTrainedModel{}class RoFormerPreTrainedModel extends PreTrainedModel{}class RoFormerModel extends RoFormerPreTrainedModel{}class RoFormerForMaskedLM extends RoFormerPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class RoFormerForSequenceClassification extends RoFormerPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class RoFormerForTokenClassification extends RoFormerPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class RoFormerForQuestionAnswering extends RoFormerPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class ConvBertPreTrainedModel extends PreTrainedModel{}class ConvBertModel extends ConvBertPreTrainedModel{}class ConvBertForMaskedLM extends ConvBertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class ConvBertForSequenceClassification extends ConvBertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class ConvBertForTokenClassification extends ConvBertPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class ConvBertForQuestionAnswering extends ConvBertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class ElectraPreTrainedModel extends PreTrainedModel{}class ElectraModel extends ElectraPreTrainedModel{}class ElectraForMaskedLM extends ElectraPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class ElectraForSequenceClassification extends ElectraPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class ElectraForTokenClassification extends ElectraPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class ElectraForQuestionAnswering extends ElectraPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class CamembertPreTrainedModel extends PreTrainedModel{}class CamembertModel extends CamembertPreTrainedModel{}class CamembertForMaskedLM extends CamembertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class CamembertForSequenceClassification extends CamembertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class CamembertForTokenClassification extends CamembertPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class CamembertForQuestionAnswering extends CamembertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class DebertaPreTrainedModel extends PreTrainedModel{}class DebertaModel extends DebertaPreTrainedModel{}class DebertaForMaskedLM extends DebertaPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class DebertaForSequenceClassification extends DebertaPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class DebertaForTokenClassification extends DebertaPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class DebertaForQuestionAnswering extends DebertaPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class DebertaV2PreTrainedModel extends PreTrainedModel{}class DebertaV2Model extends DebertaV2PreTrainedModel{}class DebertaV2ForMaskedLM extends DebertaV2PreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class DebertaV2ForSequenceClassification extends DebertaV2PreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class DebertaV2ForTokenClassification extends DebertaV2PreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class DebertaV2ForQuestionAnswering extends DebertaV2PreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class DistilBertPreTrainedModel extends PreTrainedModel{}class DistilBertModel extends DistilBertPreTrainedModel{}class DistilBertForSequenceClassification extends DistilBertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class DistilBertForTokenClassification extends DistilBertPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class DistilBertForQuestionAnswering extends DistilBertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class DistilBertForMaskedLM extends DistilBertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class EsmPreTrainedModel extends PreTrainedModel{}class EsmModel extends EsmPreTrainedModel{}class EsmForMaskedLM extends EsmPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class EsmForSequenceClassification extends EsmPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class EsmForTokenClassification extends EsmPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class MobileBertPreTrainedModel extends PreTrainedModel{}class MobileBertModel extends MobileBertPreTrainedModel{}class MobileBertForMaskedLM extends MobileBertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class MobileBertForSequenceClassification extends MobileBertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class MobileBertForQuestionAnswering extends MobileBertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class MPNetPreTrainedModel extends PreTrainedModel{}class MPNetModel extends MPNetPreTrainedModel{}class MPNetForMaskedLM extends MPNetPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class MPNetForSequenceClassification extends MPNetPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class MPNetForTokenClassification extends MPNetPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class MPNetForQuestionAnswering extends MPNetPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class SqueezeBertPreTrainedModel extends PreTrainedModel{}class SqueezeBertModel extends SqueezeBertPreTrainedModel{}class SqueezeBertForMaskedLM extends SqueezeBertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class SqueezeBertForSequenceClassification extends SqueezeBertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class SqueezeBertForQuestionAnswering extends SqueezeBertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class AlbertPreTrainedModel extends PreTrainedModel{}class AlbertModel extends AlbertPreTrainedModel{}class AlbertForSequenceClassification extends AlbertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class AlbertForQuestionAnswering extends AlbertPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class AlbertForMaskedLM extends AlbertPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class T5PreTrainedModel extends PreTrainedModel{}class T5Model extends T5PreTrainedModel{}class T5ForConditionalGeneration extends T5PreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class LongT5PreTrainedModel extends PreTrainedModel{}class LongT5Model extends LongT5PreTrainedModel{}class LongT5ForConditionalGeneration extends LongT5PreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class MT5PreTrainedModel extends PreTrainedModel{}class MT5Model extends MT5PreTrainedModel{}class MT5ForConditionalGeneration extends MT5PreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class BartPretrainedModel extends PreTrainedModel{}class BartModel extends BartPretrainedModel{}class BartForConditionalGeneration extends BartPretrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BartForSequenceClassification extends BartPretrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class MBartPreTrainedModel extends PreTrainedModel{}class MBartModel extends MBartPreTrainedModel{}class MBartForConditionalGeneration extends MBartPreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class MBartForSequenceClassification extends MBartPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class MBartForCausalLM extends MBartPreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BlenderbotPreTrainedModel extends PreTrainedModel{}class BlenderbotModel extends BlenderbotPreTrainedModel{}class BlenderbotForConditionalGeneration extends BlenderbotPreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BlenderbotSmallPreTrainedModel extends PreTrainedModel{}class BlenderbotSmallModel extends BlenderbotSmallPreTrainedModel{}class BlenderbotSmallForConditionalGeneration extends BlenderbotSmallPreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class RobertaPreTrainedModel extends PreTrainedModel{}class RobertaModel extends RobertaPreTrainedModel{}class RobertaForMaskedLM extends RobertaPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class RobertaForSequenceClassification extends RobertaPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class RobertaForTokenClassification extends RobertaPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class RobertaForQuestionAnswering extends RobertaPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class XLMPreTrainedModel extends PreTrainedModel{}class XLMModel extends XLMPreTrainedModel{}class XLMWithLMHeadModel extends XLMPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class XLMForSequenceClassification extends XLMPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class XLMForTokenClassification extends XLMPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class XLMForQuestionAnswering extends XLMPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class XLMRobertaPreTrainedModel extends PreTrainedModel{}class XLMRobertaModel extends XLMRobertaPreTrainedModel{}class XLMRobertaForMaskedLM extends XLMRobertaPreTrainedModel{async _call(a){return new MaskedLMOutput(await super._call(a))}}class XLMRobertaForSequenceClassification extends XLMRobertaPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class XLMRobertaForTokenClassification extends XLMRobertaPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class XLMRobertaForQuestionAnswering extends XLMRobertaPreTrainedModel{async _call(a){return new QuestionAnsweringModelOutput(await super._call(a))}}class ASTPreTrainedModel extends PreTrainedModel{}class ASTModel extends ASTPreTrainedModel{}class ASTForAudioClassification extends ASTPreTrainedModel{}class WhisperPreTrainedModel extends PreTrainedModel{}class WhisperModel extends WhisperPreTrainedModel{}class WhisperForConditionalGeneration extends WhisperPreTrainedModel{requires_attention_mask=!1;main_input_name="input_features";constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}async generate(a,l=null,A=null){if(l=this._get_generation_config(l),l.return_timestamps??=!1,l.return_timestamps&&(A=[new WhisperTimeStampLogitsProcessor(l)]),l.return_token_timestamps&&(l.output_attentions=!0,l.return_dict_in_generate=!0,l.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),!l.alignment_heads))throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");const O=await super.generate(a,l,A);return l.return_token_timestamps&&l.alignment_heads&&(O.token_timestamps=this._extract_token_timestamps(O,l.alignment_heads,l.num_frames)),O}_extract_token_timestamps(a,l,A=null,O=.02){if(!a.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let Y=this.config.median_filter_width;Y===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),Y=7);const R=a.cross_attentions.map(ne=>{let te=Array.from({length:this.config.decoder_layers},(et,tt)=>cat(ne.map(nt=>nt[tt]),2)),f=stack(l.map(([et,tt])=>A?te[et].slice(null,tt,null,[0,A]):te[et].slice(null,tt)));f=f.transpose(1,0,2,3);let[d,H]=std_mean(f,-2,0,!0),Z=f.clone();for(let et=0;et<Z.dims[0];++et){let tt=Z[et];for(let nt=0;nt<tt.dims[0];++nt){let it=tt[nt];const ot=d[et][nt][0],st=H[et][nt][0];for(let at=0;at<it.dims[0];++at){let ct=it[at];for(let ft=0;ft<ct.data.length;++ft)ct.data[ft]=(ct.data[ft]-st.data[ft])/ot.data[ft];ct.data.set(medianFilter(ct.data,Y))}}}return mean(Z,1)}),ee=[a.sequences.length,a.sequences[0].length],xe=new Tensor("float32",new Float32Array(ee[0]*ee[1]),ee);for(let ne=0;ne<ee[0];++ne){const te=R[ne].neg().squeeze_(0);let[f,d]=dynamicTimeWarping(te),H=Array.from({length:f.length-1},(et,tt)=>f[tt+1]-f[tt]),Z=mergeArrays([1],H).map(et=>!!et),Ye=[];for(let et=0;et<Z.length;++et)Z[et]&&Ye.push(d[et]*O);xe[ne].data.set(Ye,1)}return xe}}class VisionEncoderDecoderModel extends PreTrainedModel{main_input_name="pixel_values";constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O;const Y=this.config.encoder,R=this.config.decoder,ee=Y.model_type;(MODEL_MAPPING_NAMES_ENCODER_ONLY.get(ee)??MODEL_MAPPING_NAMES_ENCODER_DECODER.get(ee))||console.warn(`Model type for encoder '${ee}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`);const ne=MODEL_WITH_LM_HEAD_MAPPING_NAMES.get(R.model_type);if(!ne)throw new Error(`Unable to construct \`VisionEncoderDecoder\` due to unsupported decoder: "${this.config.decoder.model_type}"`);const te=ne[1],f=new te(R,A,O);this.add_encoder_pkv="num_decoder_layers"in f,this.add_encoder_pkv?(this.num_decoder_layers=f.num_decoder_layers,this.num_decoder_heads=f.num_decoder_heads,this.decoder_dim_kv=f.decoder_dim_kv,this.num_encoder_layers=f.num_encoder_layers,this.num_encoder_heads=f.num_encoder_heads,this.encoder_dim_kv=f.encoder_dim_kv):(this.num_layers=f.num_layers,this.num_heads=f.num_heads,this.dim_kv=f.dim_kv)}}class CLIPPreTrainedModel extends PreTrainedModel{}class CLIPModel extends CLIPPreTrainedModel{}class CLIPTextModelWithProjection extends CLIPPreTrainedModel{static async from_pretrained(a,l={}){return l.model_file_name??="text_model",super.from_pretrained(a,l)}}class CLIPVisionModelWithProjection extends CLIPPreTrainedModel{static async from_pretrained(a,l={}){return l.model_file_name??="vision_model",super.from_pretrained(a,l)}}class SiglipPreTrainedModel extends PreTrainedModel{}class SiglipModel extends SiglipPreTrainedModel{}class SiglipTextModel extends SiglipPreTrainedModel{static async from_pretrained(a,l={}){return l.model_file_name??="text_model",super.from_pretrained(a,l)}}class SiglipVisionModel extends CLIPPreTrainedModel{static async from_pretrained(a,l={}){return l.model_file_name??="vision_model",super.from_pretrained(a,l)}}class ChineseCLIPPreTrainedModel extends PreTrainedModel{}class ChineseCLIPModel extends ChineseCLIPPreTrainedModel{}class CLIPSegPreTrainedModel extends PreTrainedModel{}class CLIPSegModel extends CLIPSegPreTrainedModel{}class CLIPSegForImageSegmentation extends CLIPSegPreTrainedModel{}class GPT2PreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPT2Model extends GPT2PreTrainedModel{}class GPT2LMHeadModel extends GPT2PreTrainedModel{}class GPTNeoPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_heads,this.num_layers=this.config.num_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class GPTNeoModel extends GPTNeoPreTrainedModel{}class GPTNeoForCausalLM extends GPTNeoPreTrainedModel{}class GPTNeoXPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class GPTNeoXModel extends GPTNeoXPreTrainedModel{}class GPTNeoXForCausalLM extends GPTNeoXPreTrainedModel{}class GPTJPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPTJModel extends GPTJPreTrainedModel{}class GPTJForCausalLM extends GPTJPreTrainedModel{}class GPTBigCodePreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPTBigCodeModel extends GPTBigCodePreTrainedModel{}class GPTBigCodeForCausalLM extends GPTBigCodePreTrainedModel{}class CodeGenPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class CodeGenModel extends CodeGenPreTrainedModel{}class CodeGenForCausalLM extends CodeGenPreTrainedModel{}class LlamaPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class LlamaModel extends LlamaPreTrainedModel{}class LlamaForCausalLM extends LlamaPreTrainedModel{}class Qwen2PreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Qwen2Model extends Qwen2PreTrainedModel{}class Qwen2ForCausalLM extends Qwen2PreTrainedModel{}class PhiPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class PhiModel extends PhiPreTrainedModel{}class PhiForCausalLM extends PhiPreTrainedModel{}class BloomPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.hidden_size/this.num_heads}}class BloomModel extends BloomPreTrainedModel{}class BloomForCausalLM extends BloomPreTrainedModel{}class MptPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_heads,this.num_layers=this.config.n_layers,this.dim_kv=this.config.d_model/this.num_heads}}class MptModel extends MptPreTrainedModel{}class MptForCausalLM extends MptPreTrainedModel{}class OPTPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class OPTModel extends OPTPreTrainedModel{}class OPTForCausalLM extends OPTPreTrainedModel{}class ViTPreTrainedModel extends PreTrainedModel{}class ViTModel extends ViTPreTrainedModel{}class ViTForImageClassification extends ViTPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class FastViTPreTrainedModel extends PreTrainedModel{}class FastViTModel extends FastViTPreTrainedModel{}class FastViTForImageClassification extends FastViTPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class VitMattePreTrainedModel extends PreTrainedModel{}class VitMatteForImageMatting extends VitMattePreTrainedModel{async _call(a){return new ImageMattingOutput(await super._call(a))}}class MobileViTPreTrainedModel extends PreTrainedModel{}class MobileViTModel extends MobileViTPreTrainedModel{}class MobileViTForImageClassification extends MobileViTPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class MobileViTV2PreTrainedModel extends PreTrainedModel{}class MobileViTV2Model extends MobileViTV2PreTrainedModel{}class MobileViTV2ForImageClassification extends MobileViTV2PreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class OwlViTPreTrainedModel extends PreTrainedModel{}class OwlViTModel extends OwlViTPreTrainedModel{}class OwlViTForObjectDetection extends OwlViTPreTrainedModel{}class Owlv2PreTrainedModel extends PreTrainedModel{}class Owlv2Model extends Owlv2PreTrainedModel{}class Owlv2ForObjectDetection extends Owlv2PreTrainedModel{}class BeitPreTrainedModel extends PreTrainedModel{}class BeitModel extends BeitPreTrainedModel{}class BeitForImageClassification extends BeitPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class DetrPreTrainedModel extends PreTrainedModel{}class DetrModel extends DetrPreTrainedModel{}class DetrForObjectDetection extends DetrPreTrainedModel{async _call(a){return new DetrObjectDetectionOutput(await super._call(a))}}class DetrForSegmentation extends DetrPreTrainedModel{async _call(a){return new DetrSegmentationOutput(await super._call(a))}}class DetrObjectDetectionOutput extends ModelOutput{constructor({logits:a,pred_boxes:l}){super(),this.logits=a,this.pred_boxes=l}}class DetrSegmentationOutput extends ModelOutput{constructor({logits:a,pred_boxes:l,pred_masks:A}){super(),this.logits=a,this.pred_boxes=l,this.pred_masks=A}}class TableTransformerPreTrainedModel extends PreTrainedModel{}class TableTransformerModel extends TableTransformerPreTrainedModel{}class TableTransformerForObjectDetection extends TableTransformerPreTrainedModel{async _call(a){return new TableTransformerObjectDetectionOutput(await super._call(a))}}class TableTransformerObjectDetectionOutput extends DetrObjectDetectionOutput{}class DeiTPreTrainedModel extends PreTrainedModel{}class DeiTModel extends DeiTPreTrainedModel{}class DeiTForImageClassification extends DeiTPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class ResNetPreTrainedModel extends PreTrainedModel{}class ResNetModel extends ResNetPreTrainedModel{}class ResNetForImageClassification extends ResNetPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class SwinPreTrainedModel extends PreTrainedModel{}class SwinModel extends SwinPreTrainedModel{}class SwinForImageClassification extends SwinPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class Swin2SRPreTrainedModel extends PreTrainedModel{}class Swin2SRModel extends Swin2SRPreTrainedModel{}class Swin2SRForImageSuperResolution extends Swin2SRPreTrainedModel{}class DPTPreTrainedModel extends PreTrainedModel{}class DPTModel extends DPTPreTrainedModel{}class DPTForDepthEstimation extends DPTPreTrainedModel{}class DepthAnythingPreTrainedModel extends PreTrainedModel{}class DepthAnythingForDepthEstimation extends DepthAnythingPreTrainedModel{}class GLPNPreTrainedModel extends PreTrainedModel{}class GLPNModel extends GLPNPreTrainedModel{}class GLPNForDepthEstimation extends GLPNPreTrainedModel{}class DonutSwinPreTrainedModel extends PreTrainedModel{}class DonutSwinModel extends DonutSwinPreTrainedModel{}class ConvNextPreTrainedModel extends PreTrainedModel{}class ConvNextModel extends ConvNextPreTrainedModel{}class ConvNextForImageClassification extends ConvNextPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class ConvNextV2PreTrainedModel extends PreTrainedModel{}class ConvNextV2Model extends ConvNextV2PreTrainedModel{}class ConvNextV2ForImageClassification extends ConvNextV2PreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class Dinov2PreTrainedModel extends PreTrainedModel{}class Dinov2Model extends Dinov2PreTrainedModel{}class Dinov2ForImageClassification extends Dinov2PreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class YolosPreTrainedModel extends PreTrainedModel{}class YolosModel extends YolosPreTrainedModel{}class YolosForObjectDetection extends YolosPreTrainedModel{async _call(a){return new YolosObjectDetectionOutput(await super._call(a))}}class YolosObjectDetectionOutput extends ModelOutput{constructor({logits:a,pred_boxes:l}){super(),this.logits=a,this.pred_boxes=l}}class SamPreTrainedModel extends PreTrainedModel{}class SamModel extends SamPreTrainedModel{constructor(a,l,A){super(a,l),this.prompt_encoder_mask_decoder=A}async get_image_embeddings({pixel_values:a}){return await encoderForward(this,{pixel_values:a})}async forward(a){if((!a.image_embeddings||!a.image_positional_embeddings)&&(a={...a,...await this.get_image_embeddings(a)}),!a.input_labels){const l=a.input_points.dims.slice(0,-1),A=l.reduce((O,Y)=>O*Y,1);a.input_labels=new Tensor("int64",new BigInt64Array(A).fill(1n),l)}return await sessionRun(this.prompt_encoder_mask_decoder,{input_points:a.input_points,input_labels:a.input_labels,image_embeddings:a.image_embeddings,image_positional_embeddings:a.image_positional_embeddings})}async _call(a){return new SamImageSegmentationOutput(await super._call(a))}}class SamImageSegmentationOutput extends ModelOutput{constructor({iou_scores:a,pred_masks:l}){super(),this.iou_scores=a,this.pred_masks=l}}class MarianPreTrainedModel extends PreTrainedModel{}class MarianModel extends MarianPreTrainedModel{}class MarianMTModel extends MarianPreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class M2M100PreTrainedModel extends PreTrainedModel{}class M2M100Model extends M2M100PreTrainedModel{}class M2M100ForConditionalGeneration extends M2M100PreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Wav2Vec2PreTrainedModel extends PreTrainedModel{}class Wav2Vec2Model extends Wav2Vec2PreTrainedModel{}class Wav2Vec2ForCTC extends Wav2Vec2PreTrainedModel{async _call(a){return new CausalLMOutput(await super._call(a))}}class Wav2Vec2ForSequenceClassification extends Wav2Vec2PreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class Wav2Vec2ForAudioFrameClassification extends Wav2Vec2PreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class UniSpeechPreTrainedModel extends PreTrainedModel{}class UniSpeechModel extends UniSpeechPreTrainedModel{}class UniSpeechForCTC extends UniSpeechPreTrainedModel{async _call(a){return new CausalLMOutput(await super._call(a))}}class UniSpeechForSequenceClassification extends UniSpeechPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class UniSpeechSatPreTrainedModel extends PreTrainedModel{}class UniSpeechSatModel extends UniSpeechSatPreTrainedModel{}class UniSpeechSatForCTC extends UniSpeechSatPreTrainedModel{async _call(a){return new CausalLMOutput(await super._call(a))}}class UniSpeechSatForSequenceClassification extends UniSpeechSatPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class UniSpeechSatForAudioFrameClassification extends UniSpeechSatPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class Wav2Vec2BertPreTrainedModel extends PreTrainedModel{}class Wav2Vec2BertModel extends Wav2Vec2BertPreTrainedModel{}class Wav2Vec2BertForCTC extends Wav2Vec2BertPreTrainedModel{async _call(a){return new CausalLMOutput(await super._call(a))}}class Wav2Vec2BertForSequenceClassification extends Wav2Vec2BertPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class HubertModel extends Wav2Vec2PreTrainedModel{}class HubertForCTC extends Wav2Vec2PreTrainedModel{async _call(a){return new CausalLMOutput(await super._call(a))}}class HubertForSequenceClassification extends Wav2Vec2PreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class WavLMPreTrainedModel extends PreTrainedModel{}class WavLMModel extends WavLMPreTrainedModel{}class WavLMForCTC extends WavLMPreTrainedModel{async _call(a){return new CausalLMOutput(await super._call(a))}}class WavLMForSequenceClassification extends WavLMPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class WavLMForXVector extends WavLMPreTrainedModel{async _call(a){return new XVectorOutput(await super._call(a))}}class WavLMForAudioFrameClassification extends WavLMPreTrainedModel{async _call(a){return new TokenClassifierOutput(await super._call(a))}}class SpeechT5PreTrainedModel extends PreTrainedModel{}class SpeechT5ForSpeechToText extends SpeechT5PreTrainedModel{}class SpeechT5ForTextToSpeech extends SpeechT5PreTrainedModel{constructor(a,l,A,O){super(a,l),this.decoder_merged_session=A,this.generation_config=O,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.hidden_size/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.hidden_size/this.num_encoder_heads}async generate_speech(a,l,{threshold:A=.5,minlenratio:O=0,maxlenratio:Y=20,vocoder:R=null}={}){const ee={input_ids:a},{encoder_outputs:xe,encoder_attention_mask:ne}=await encoderForward(this,ee),te=xe.dims[1]/this.config.reduction_factor,f=Math.floor(te*Y),d=Math.floor(te*O),H=this.config.num_mel_bins;let Z=[],Ye=null,et=null,tt=0;for(;;){++tt;const ot=boolTensor(!!et);let st;et?st=et.output_sequence_out:st=new Tensor("float32",new Float32Array(H),[1,1,H]);let at={use_cache_branch:ot,output_sequence:st,encoder_attention_mask:ne,speaker_embeddings:l,encoder_hidden_states:xe};this.addPastKeyValues(at,Ye),et=await sessionRun(this.decoder_merged_session,at),Ye=this.getPastKeyValues(et,Ye);const{prob:ct,spectrum:ft}=et;if(Z.push(ft),tt>=d&&(Array.from(ct.data).filter(ut=>ut>=A).length>0||tt>=f))break}const nt=cat(Z),{waveform:it}=await sessionRun(R.session,{spectrogram:nt});return{spectrogram:nt,waveform:it}}}class SpeechT5HifiGan extends PreTrainedModel{main_input_name="spectrogram"}class TrOCRPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_encoder_layers=this.num_decoder_layers=this.config.decoder_layers,this.num_encoder_heads=this.num_decoder_heads=this.config.decoder_attention_heads,this.encoder_dim_kv=this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads}}class TrOCRForCausalLM extends TrOCRPreTrainedModel{}class MistralPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class MistralModel extends MistralPreTrainedModel{}class MistralForCausalLM extends MistralPreTrainedModel{}class Starcoder2PreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Starcoder2Model extends Starcoder2PreTrainedModel{}class Starcoder2ForCausalLM extends Starcoder2PreTrainedModel{}class FalconPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class FalconModel extends FalconPreTrainedModel{}class FalconForCausalLM extends FalconPreTrainedModel{}class ClapPreTrainedModel extends PreTrainedModel{}class ClapModel extends ClapPreTrainedModel{}class ClapTextModelWithProjection extends ClapPreTrainedModel{static async from_pretrained(a,l={}){return l.model_file_name??="text_model",super.from_pretrained(a,l)}}class ClapAudioModelWithProjection extends ClapPreTrainedModel{static async from_pretrained(a,l={}){return l.model_file_name??="audio_model",super.from_pretrained(a,l)}}class VitsPreTrainedModel extends PreTrainedModel{}class VitsModel extends VitsPreTrainedModel{async _call(a){return new VitsModelOutput(await super._call(a))}}class SegformerPreTrainedModel extends PreTrainedModel{}class SegformerForImageClassification extends SegformerPreTrainedModel{}class SegformerForSemanticSegmentation extends SegformerPreTrainedModel{}class StableLmPreTrainedModel extends PreTrainedModel{constructor(a,l,A){super(a,l),this.generation_config=A,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class StableLmForCausalLM extends StableLmPreTrainedModel{}class EfficientNetPreTrainedModel extends PreTrainedModel{}class EfficientNetModel extends EfficientNetPreTrainedModel{}class EfficientNetForImageClassification extends EfficientNetPreTrainedModel{async _call(a){return new SequenceClassifierOutput(await super._call(a))}}class PretrainedMixin{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(a,{quantized:l=!0,progress_callback:A=null,config:O=null,cache_dir:Y=null,local_files_only:R=!1,revision:ee="main",model_file_name:xe=null}={}){let ne={quantized:l,progress_callback:A,config:O,cache_dir:Y,local_files_only:R,revision:ee,model_file_name:xe};if(O=await AutoConfig.from_pretrained(a,ne),ne.config||(ne.config=O),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let te of this.MODEL_CLASS_MAPPINGS){const f=te.get(O.model_type);if(f)return await f[1].from_pretrained(a,ne)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${O.model_type}", attempting to construct from base class.`),await PreTrainedModel.from_pretrained(a,ne);throw Error(`Unsupported model type: ${O.model_type}`)}}const MODEL_MAPPING_NAMES_ENCODER_ONLY=new Map([["bert",["BertModel",BertModel]],["nomic_bert",["NomicBertModel",NomicBertModel]],["roformer",["RoFormerModel",RoFormerModel]],["electra",["ElectraModel",ElectraModel]],["esm",["EsmModel",EsmModel]],["convbert",["ConvBertModel",ConvBertModel]],["camembert",["CamembertModel",CamembertModel]],["deberta",["DebertaModel",DebertaModel]],["deberta-v2",["DebertaV2Model",DebertaV2Model]],["mpnet",["MPNetModel",MPNetModel]],["albert",["AlbertModel",AlbertModel]],["distilbert",["DistilBertModel",DistilBertModel]],["roberta",["RobertaModel",RobertaModel]],["xlm",["XLMModel",XLMModel]],["xlm-roberta",["XLMRobertaModel",XLMRobertaModel]],["clap",["ClapModel",ClapModel]],["clip",["CLIPModel",CLIPModel]],["clipseg",["CLIPSegModel",CLIPSegModel]],["chinese_clip",["ChineseCLIPModel",ChineseCLIPModel]],["siglip",["SiglipModel",SiglipModel]],["mobilebert",["MobileBertModel",MobileBertModel]],["squeezebert",["SqueezeBertModel",SqueezeBertModel]],["wav2vec2",["Wav2Vec2Model",Wav2Vec2Model]],["wav2vec2-bert",["Wav2Vec2BertModel",Wav2Vec2BertModel]],["unispeech",["UniSpeechModel",UniSpeechModel]],["unispeech-sat",["UniSpeechSatModel",UniSpeechSatModel]],["hubert",["HubertModel",HubertModel]],["wavlm",["WavLMModel",WavLMModel]],["audio-spectrogram-transformer",["ASTModel",ASTModel]],["vits",["VitsModel",VitsModel]],["detr",["DetrModel",DetrModel]],["table-transformer",["TableTransformerModel",TableTransformerModel]],["vit",["ViTModel",ViTModel]],["fastvit",["FastViTModel",FastViTModel]],["mobilevit",["MobileViTModel",MobileViTModel]],["mobilevitv2",["MobileViTV2Model",MobileViTV2Model]],["owlvit",["OwlViTModel",OwlViTModel]],["owlv2",["Owlv2Model",Owlv2Model]],["beit",["BeitModel",BeitModel]],["deit",["DeiTModel",DeiTModel]],["convnext",["ConvNextModel",ConvNextModel]],["convnextv2",["ConvNextV2Model",ConvNextV2Model]],["dinov2",["Dinov2Model",Dinov2Model]],["resnet",["ResNetModel",ResNetModel]],["swin",["SwinModel",SwinModel]],["swin2sr",["Swin2SRModel",Swin2SRModel]],["donut-swin",["DonutSwinModel",DonutSwinModel]],["yolos",["YolosModel",YolosModel]],["dpt",["DPTModel",DPTModel]],["glpn",["GLPNModel",GLPNModel]],["hifigan",["SpeechT5HifiGan",SpeechT5HifiGan]],["efficientnet",["EfficientNetModel",EfficientNetModel]]]),MODEL_MAPPING_NAMES_ENCODER_DECODER=new Map([["t5",["T5Model",T5Model]],["longt5",["LongT5Model",LongT5Model]],["mt5",["MT5Model",MT5Model]],["bart",["BartModel",BartModel]],["mbart",["MBartModel",MBartModel]],["marian",["MarianModel",MarianModel]],["whisper",["WhisperModel",WhisperModel]],["m2m_100",["M2M100Model",M2M100Model]],["blenderbot",["BlenderbotModel",BlenderbotModel]],["blenderbot-small",["BlenderbotSmallModel",BlenderbotSmallModel]]]),MODEL_MAPPING_NAMES_DECODER_ONLY=new Map([["bloom",["BloomModel",BloomModel]],["gpt2",["GPT2Model",GPT2Model]],["gptj",["GPTJModel",GPTJModel]],["gpt_bigcode",["GPTBigCodeModel",GPTBigCodeModel]],["gpt_neo",["GPTNeoModel",GPTNeoModel]],["gpt_neox",["GPTNeoXModel",GPTNeoXModel]],["codegen",["CodeGenModel",CodeGenModel]],["llama",["LlamaModel",LlamaModel]],["qwen2",["Qwen2Model",Qwen2Model]],["phi",["PhiModel",PhiModel]],["mpt",["MptModel",MptModel]],["opt",["OPTModel",OPTModel]],["mistral",["MistralModel",MistralModel]],["starcoder2",["Starcoder2Model",Starcoder2Model]],["falcon",["FalconModel",FalconModel]]]),MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES=new Map([["speecht5",["SpeechT5ForSpeechToText",SpeechT5ForSpeechToText]],["whisper",["WhisperForConditionalGeneration",WhisperForConditionalGeneration]]]),MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES=new Map([["speecht5",["SpeechT5ForTextToSpeech",SpeechT5ForTextToSpeech]]]),MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES=new Map([["vits",["VitsModel",VitsModel]]]),MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES=new Map([["bert",["BertForSequenceClassification",BertForSequenceClassification]],["roformer",["RoFormerForSequenceClassification",RoFormerForSequenceClassification]],["electra",["ElectraForSequenceClassification",ElectraForSequenceClassification]],["esm",["EsmForSequenceClassification",EsmForSequenceClassification]],["convbert",["ConvBertForSequenceClassification",ConvBertForSequenceClassification]],["camembert",["CamembertForSequenceClassification",CamembertForSequenceClassification]],["deberta",["DebertaForSequenceClassification",DebertaForSequenceClassification]],["deberta-v2",["DebertaV2ForSequenceClassification",DebertaV2ForSequenceClassification]],["mpnet",["MPNetForSequenceClassification",MPNetForSequenceClassification]],["albert",["AlbertForSequenceClassification",AlbertForSequenceClassification]],["distilbert",["DistilBertForSequenceClassification",DistilBertForSequenceClassification]],["roberta",["RobertaForSequenceClassification",RobertaForSequenceClassification]],["xlm",["XLMForSequenceClassification",XLMForSequenceClassification]],["xlm-roberta",["XLMRobertaForSequenceClassification",XLMRobertaForSequenceClassification]],["bart",["BartForSequenceClassification",BartForSequenceClassification]],["mbart",["MBartForSequenceClassification",MBartForSequenceClassification]],["mobilebert",["MobileBertForSequenceClassification",MobileBertForSequenceClassification]],["squeezebert",["SqueezeBertForSequenceClassification",SqueezeBertForSequenceClassification]]]),MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES=new Map([["bert",["BertForTokenClassification",BertForTokenClassification]],["roformer",["RoFormerForTokenClassification",RoFormerForTokenClassification]],["electra",["ElectraForTokenClassification",ElectraForTokenClassification]],["esm",["EsmForTokenClassification",EsmForTokenClassification]],["convbert",["ConvBertForTokenClassification",ConvBertForTokenClassification]],["camembert",["CamembertForTokenClassification",CamembertForTokenClassification]],["deberta",["DebertaForTokenClassification",DebertaForTokenClassification]],["deberta-v2",["DebertaV2ForTokenClassification",DebertaV2ForTokenClassification]],["mpnet",["MPNetForTokenClassification",MPNetForTokenClassification]],["distilbert",["DistilBertForTokenClassification",DistilBertForTokenClassification]],["roberta",["RobertaForTokenClassification",RobertaForTokenClassification]],["xlm",["XLMForTokenClassification",XLMForTokenClassification]],["xlm-roberta",["XLMRobertaForTokenClassification",XLMRobertaForTokenClassification]]]),MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES=new Map([["t5",["T5ForConditionalGeneration",T5ForConditionalGeneration]],["longt5",["LongT5ForConditionalGeneration",LongT5ForConditionalGeneration]],["mt5",["MT5ForConditionalGeneration",MT5ForConditionalGeneration]],["bart",["BartForConditionalGeneration",BartForConditionalGeneration]],["mbart",["MBartForConditionalGeneration",MBartForConditionalGeneration]],["marian",["MarianMTModel",MarianMTModel]],["m2m_100",["M2M100ForConditionalGeneration",M2M100ForConditionalGeneration]],["blenderbot",["BlenderbotForConditionalGeneration",BlenderbotForConditionalGeneration]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",BlenderbotSmallForConditionalGeneration]]]),MODEL_WITH_LM_HEAD_MAPPING_NAMES=new Map([["bloom",["BloomForCausalLM",BloomForCausalLM]],["gpt2",["GPT2LMHeadModel",GPT2LMHeadModel]],["gptj",["GPTJForCausalLM",GPTJForCausalLM]],["gpt_bigcode",["GPTBigCodeForCausalLM",GPTBigCodeForCausalLM]],["gpt_neo",["GPTNeoForCausalLM",GPTNeoForCausalLM]],["gpt_neox",["GPTNeoXForCausalLM",GPTNeoXForCausalLM]],["codegen",["CodeGenForCausalLM",CodeGenForCausalLM]],["llama",["LlamaForCausalLM",LlamaForCausalLM]],["qwen2",["Qwen2ForCausalLM",Qwen2ForCausalLM]],["phi",["PhiForCausalLM",PhiForCausalLM]],["mpt",["MptForCausalLM",MptForCausalLM]],["opt",["OPTForCausalLM",OPTForCausalLM]],["mbart",["MBartForCausalLM",MBartForCausalLM]],["mistral",["MistralForCausalLM",MistralForCausalLM]],["starcoder2",["Starcoder2ForCausalLM",Starcoder2ForCausalLM]],["falcon",["FalconForCausalLM",FalconForCausalLM]],["trocr",["TrOCRForCausalLM",TrOCRForCausalLM]],["stablelm",["StableLmForCausalLM",StableLmForCausalLM]]]),MODEL_FOR_MASKED_LM_MAPPING_NAMES=new Map([["bert",["BertForMaskedLM",BertForMaskedLM]],["roformer",["RoFormerForMaskedLM",RoFormerForMaskedLM]],["electra",["ElectraForMaskedLM",ElectraForMaskedLM]],["esm",["EsmForMaskedLM",EsmForMaskedLM]],["convbert",["ConvBertForMaskedLM",ConvBertForMaskedLM]],["camembert",["CamembertForMaskedLM",CamembertForMaskedLM]],["deberta",["DebertaForMaskedLM",DebertaForMaskedLM]],["deberta-v2",["DebertaV2ForMaskedLM",DebertaV2ForMaskedLM]],["mpnet",["MPNetForMaskedLM",MPNetForMaskedLM]],["albert",["AlbertForMaskedLM",AlbertForMaskedLM]],["distilbert",["DistilBertForMaskedLM",DistilBertForMaskedLM]],["roberta",["RobertaForMaskedLM",RobertaForMaskedLM]],["xlm",["XLMWithLMHeadModel",XLMWithLMHeadModel]],["xlm-roberta",["XLMRobertaForMaskedLM",XLMRobertaForMaskedLM]],["mobilebert",["MobileBertForMaskedLM",MobileBertForMaskedLM]],["squeezebert",["SqueezeBertForMaskedLM",SqueezeBertForMaskedLM]]]),MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES=new Map([["bert",["BertForQuestionAnswering",BertForQuestionAnswering]],["roformer",["RoFormerForQuestionAnswering",RoFormerForQuestionAnswering]],["electra",["ElectraForQuestionAnswering",ElectraForQuestionAnswering]],["convbert",["ConvBertForQuestionAnswering",ConvBertForQuestionAnswering]],["camembert",["CamembertForQuestionAnswering",CamembertForQuestionAnswering]],["deberta",["DebertaForQuestionAnswering",DebertaForQuestionAnswering]],["deberta-v2",["DebertaV2ForQuestionAnswering",DebertaV2ForQuestionAnswering]],["mpnet",["MPNetForQuestionAnswering",MPNetForQuestionAnswering]],["albert",["AlbertForQuestionAnswering",AlbertForQuestionAnswering]],["distilbert",["DistilBertForQuestionAnswering",DistilBertForQuestionAnswering]],["roberta",["RobertaForQuestionAnswering",RobertaForQuestionAnswering]],["xlm",["XLMForQuestionAnswering",XLMForQuestionAnswering]],["xlm-roberta",["XLMRobertaForQuestionAnswering",XLMRobertaForQuestionAnswering]],["mobilebert",["MobileBertForQuestionAnswering",MobileBertForQuestionAnswering]],["squeezebert",["SqueezeBertForQuestionAnswering",SqueezeBertForQuestionAnswering]]]),MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",VisionEncoderDecoderModel]]]),MODEL_FOR_DOCUMENT_QUESTION_ANSWERING_MAPPING_NAMES=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",VisionEncoderDecoderModel]]]),MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES=new Map([["vit",["ViTForImageClassification",ViTForImageClassification]],["fastvit",["FastViTForImageClassification",FastViTForImageClassification]],["mobilevit",["MobileViTForImageClassification",MobileViTForImageClassification]],["mobilevitv2",["MobileViTV2ForImageClassification",MobileViTV2ForImageClassification]],["beit",["BeitForImageClassification",BeitForImageClassification]],["deit",["DeiTForImageClassification",DeiTForImageClassification]],["convnext",["ConvNextForImageClassification",ConvNextForImageClassification]],["convnextv2",["ConvNextV2ForImageClassification",ConvNextV2ForImageClassification]],["dinov2",["Dinov2ForImageClassification",Dinov2ForImageClassification]],["resnet",["ResNetForImageClassification",ResNetForImageClassification]],["swin",["SwinForImageClassification",SwinForImageClassification]],["segformer",["SegformerForImageClassification",SegformerForImageClassification]],["efficientnet",["EfficientNetForImageClassification",EfficientNetForImageClassification]]]),MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES=new Map([["detr",["DetrForObjectDetection",DetrForObjectDetection]],["table-transformer",["TableTransformerForObjectDetection",TableTransformerForObjectDetection]],["yolos",["YolosForObjectDetection",YolosForObjectDetection]]]),MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES=new Map([["owlvit",["OwlViTForObjectDetection",OwlViTForObjectDetection]],["owlv2",["Owlv2ForObjectDetection",Owlv2ForObjectDetection]]]),MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES=new Map([["detr",["DetrForSegmentation",DetrForSegmentation]],["clipseg",["CLIPSegForImageSegmentation",CLIPSegForImageSegmentation]]]),MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES=new Map([["segformer",["SegformerForSemanticSegmentation",SegformerForSemanticSegmentation]]]),MODEL_FOR_MASK_GENERATION_MAPPING_NAMES=new Map([["sam",["SamModel",SamModel]]]),MODEL_FOR_CTC_MAPPING_NAMES=new Map([["wav2vec2",["Wav2Vec2ForCTC",Wav2Vec2ForCTC]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Wav2Vec2BertForCTC]],["unispeech",["UniSpeechForCTC",UniSpeechForCTC]],["unispeech-sat",["UniSpeechSatForCTC",UniSpeechSatForCTC]],["wavlm",["WavLMForCTC",WavLMForCTC]],["hubert",["HubertForCTC",HubertForCTC]]]),MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Wav2Vec2ForSequenceClassification]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Wav2Vec2BertForSequenceClassification]],["unispeech",["UniSpeechForSequenceClassification",UniSpeechForSequenceClassification]],["unispeech-sat",["UniSpeechSatForSequenceClassification",UniSpeechSatForSequenceClassification]],["wavlm",["WavLMForSequenceClassification",WavLMForSequenceClassification]],["hubert",["HubertForSequenceClassification",HubertForSequenceClassification]],["audio-spectrogram-transformer",["ASTForAudioClassification",ASTForAudioClassification]]]),MODEL_FOR_AUDIO_XVECTOR_MAPPING_NAMES=new Map([["wavlm",["WavLMForXVector",WavLMForXVector]]]),MODEL_FOR_AUDIO_FRAME_CLASSIFICATION_MAPPING_NAMES=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",UniSpeechSatForAudioFrameClassification]],["wavlm",["WavLMForAudioFrameClassification",WavLMForAudioFrameClassification]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Wav2Vec2ForAudioFrameClassification]]]),MODEL_FOR_IMAGE_MATTING_MAPPING_NAMES=new Map([["vitmatte",["VitMatteForImageMatting",VitMatteForImageMatting]]]),MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES=new Map([["swin2sr",["Swin2SRForImageSuperResolution",Swin2SRForImageSuperResolution]]]),MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES=new Map([["dpt",["DPTForDepthEstimation",DPTForDepthEstimation]],["depth_anything",["DepthAnythingForDepthEstimation",DepthAnythingForDepthEstimation]],["glpn",["GLPNForDepthEstimation",GLPNForDepthEstimation]]]),MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES=new Map([["clip",["CLIPVisionModelWithProjection",CLIPVisionModelWithProjection]],["siglip",["SiglipVisionModel",SiglipVisionModel]]]),MODEL_CLASS_TYPE_MAPPING=[[MODEL_MAPPING_NAMES_ENCODER_ONLY,MODEL_TYPES.EncoderOnly],[MODEL_MAPPING_NAMES_ENCODER_DECODER,MODEL_TYPES.EncoderDecoder],[MODEL_MAPPING_NAMES_DECODER_ONLY,MODEL_TYPES.DecoderOnly],[MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_WITH_LM_HEAD_MAPPING_NAMES,MODEL_TYPES.DecoderOnly],[MODEL_FOR_MASKED_LM_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES,MODEL_TYPES.Vision2Seq],[MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_MATTING_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_MASK_GENERATION_MAPPING_NAMES,MODEL_TYPES.MaskGeneration],[MODEL_FOR_CTC_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_XVECTOR_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_FRAME_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly]];for(const[g,a]of MODEL_CLASS_TYPE_MAPPING)for(const[l,A]of g.values())MODEL_TYPE_MAPPING.set(l,a),MODEL_CLASS_TO_NAME_MAPPING.set(A,l),MODEL_NAME_TO_CLASS_MAPPING.set(l,A);const CUSTOM_MAPPING=[["CLIPTextModelWithProjection",CLIPTextModelWithProjection,MODEL_TYPES.EncoderOnly],["SiglipTextModel",SiglipTextModel,MODEL_TYPES.EncoderOnly],["ClapTextModelWithProjection",ClapTextModelWithProjection,MODEL_TYPES.EncoderOnly],["ClapAudioModelWithProjection",ClapAudioModelWithProjection,MODEL_TYPES.EncoderOnly]];for(const[g,a,l]of CUSTOM_MAPPING)MODEL_TYPE_MAPPING.set(g,l),MODEL_CLASS_TO_NAME_MAPPING.set(a,g),MODEL_NAME_TO_CLASS_MAPPING.set(g,a);class AutoModel extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=MODEL_CLASS_TYPE_MAPPING.map(a=>a[0]);static BASE_IF_FAIL=!0}class AutoModelForSequenceClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForTokenClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForSeq2SeqLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES]}class AutoModelForSpeechSeq2Seq extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES]}class AutoModelForTextToSpectrogram extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES]}class AutoModelForTextToWaveform extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES]}class AutoModelForCausalLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_WITH_LM_HEAD_MAPPING_NAMES]}class AutoModelForMaskedLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_MASKED_LM_MAPPING_NAMES]}class AutoModelForQuestionAnswering extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES]}class AutoModelForVision2Seq extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES]}class AutoModelForImageClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForImageSegmentation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES]}class AutoModelForSemanticSegmentation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES]}class AutoModelForObjectDetection extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES]}class AutoModelForZeroShotObjectDetection extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES]}class AutoModelForCTC extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_CTC_MAPPING_NAMES]}class AutoModelForAudioClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForDocumentQuestionAnswering extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_DOCUMENT_QUESTION_ANSWERING_MAPPING_NAMES]}class AutoModelForImageToImage extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES]}class AutoModelForDepthEstimation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES]}class AutoModelForImageFeatureExtraction extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES]}class Seq2SeqLMOutput extends ModelOutput{constructor({logits:a,past_key_values:l,encoder_outputs:A,decoder_attentions:O=null,cross_attentions:Y=null}){super(),this.logits=a,this.past_key_values=l,this.encoder_outputs=A,this.decoder_attentions=O,this.cross_attentions=Y}}class SequenceClassifierOutput extends ModelOutput{constructor({logits:a}){super(),this.logits=a}}class XVectorOutput extends ModelOutput{constructor({logits:a,embeddings:l}){super(),this.logits=a,this.embeddings=l}}class TokenClassifierOutput extends ModelOutput{constructor({logits:a}){super(),this.logits=a}}class MaskedLMOutput extends ModelOutput{constructor({logits:a}){super(),this.logits=a}}class QuestionAnsweringModelOutput extends ModelOutput{constructor({start_logits:a,end_logits:l}){super(),this.start_logits=a,this.end_logits=l}}class CausalLMOutput extends ModelOutput{constructor({logits:a}){super(),this.logits=a}}class ImageMattingOutput extends ModelOutput{constructor({alphas:a}){super(),this.alphas=a}}class VitsModelOutput extends ModelOutput{constructor({waveform:a,spectrogram:l}){super(),this.waveform=a,this.spectrogram=l}}const BROWSER_ENV=typeof self<"u",WEBWORKER_ENV=BROWSER_ENV&&self.constructor.name==="DedicatedWorkerGlobalScope";let createCanvasFunction,ImageDataClass,loadImageFunction;if(BROWSER_ENV)createCanvasFunction=(g,a)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(g,a)},loadImageFunction=self.createImageBitmap,ImageDataClass=self.ImageData;else if(fs)loadImageFunction=async g=>{const l=(await g.metadata()).channels;let{data:A,info:O}=await g.rotate().raw().toBuffer({resolveWithObject:!0});const Y=new RawImage(new Uint8ClampedArray(A),O.width,O.height,O.channels);return l!==void 0&&l!==O.channels&&Y.convert(l),Y};else throw new Error("Unable to load image processing library.");const RESAMPLING_MAPPING={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},CONTENT_TYPE_MAP=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class RawImage{constructor(a,l,A,O){this.data=a,this.width=l,this.height=A,this.channels=O}get size(){return[this.width,this.height]}static async read(a){if(a instanceof RawImage)return a;if(typeof a=="string"||a instanceof URL)return await this.fromURL(a);throw new Error(`Unsupported input type: ${typeof a}`)}static async fromURL(a){let l=await getFile(a);if(l.status!==200)throw new Error(`Unable to read image from "${a}" (${l.status} ${l.statusText})`);let A=await l.blob();return this.fromBlob(A)}static async fromBlob(a){if(BROWSER_ENV){let l=await loadImageFunction(a);const A=createCanvasFunction(l.width,l.height).getContext("2d");return A.drawImage(l,0,0),new this(A.getImageData(0,0,l.width,l.height).data,l.width,l.height,4)}else{let l=fs(await a.arrayBuffer());return await loadImageFunction(l)}}static fromTensor(a,l="CHW"){if(a.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${a.dims.length} dimensions.`);if(l==="CHW")a=a.transpose(1,2,0);else if(l!=="HWC")throw new Error(`Unsupported channel format: ${l}`);if(!(a.data instanceof Uint8ClampedArray||a.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${a.type}`);switch(a.dims[2]){case 1:case 2:case 3:case 4:return new RawImage(a.data,a.dims[1],a.dims[0],a.dims[2]);default:throw new Error(`Unsupported number of channels: ${a.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let a=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let l=0,A=0;l<this.data.length;l+=this.channels){const O=this.data[l],Y=this.data[l+1],R=this.data[l+2];a[A++]=Math.round(.2989*O+.587*Y+.114*R)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(a,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let a=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let l=0,A=0;l<this.data.length;++l)a[A++]=this.data[l],a[A++]=this.data[l],a[A++]=this.data[l];break;case 4:for(let l=0,A=0;l<this.data.length;l+=4)a[A++]=this.data[l],a[A++]=this.data[l+1],a[A++]=this.data[l+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(a,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let a=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let l=0,A=0;l<this.data.length;++l)a[A++]=this.data[l],a[A++]=this.data[l],a[A++]=this.data[l],a[A++]=255;break;case 3:for(let l=0,A=0;l<this.data.length;l+=3)a[A++]=this.data[l],a[A++]=this.data[l+1],a[A++]=this.data[l+2],a[A++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(a,this.width,this.height,4)}async resize(a,l,{resample:A=2}={}){let O=RESAMPLING_MAPPING[A]??A;if(BROWSER_ENV){let Y=this.channels,R=this.toCanvas();const ee=createCanvasFunction(a,l).getContext("2d");return ee.drawImage(R,0,0,a,l),new RawImage(ee.getImageData(0,0,a,l).data,a,l,4).convert(Y)}else{let Y=this.toSharp();switch(O){case"box":case"hamming":(O==="box"||O==="hamming")&&(console.warn(`Resampling method ${O} is not yet supported. Using bilinear instead.`),O="bilinear");case"nearest":case"bilinear":case"bicubic":Y=Y.affine([a/this.width,0,0,l/this.height],{interpolator:O});break;case"lanczos":Y=Y.resize({width:a,height:l,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${O} is not supported.`)}return await loadImageFunction(Y)}}async pad([a,l,A,O]){if(a=Math.max(a,0),l=Math.max(l,0),A=Math.max(A,0),O=Math.max(O,0),a===0&&l===0&&A===0&&O===0)return this;if(BROWSER_ENV){let Y=this.channels,R=this.toCanvas(),ee=this.width+a+l,xe=this.height+A+O;const ne=createCanvasFunction(ee,xe).getContext("2d");return ne.drawImage(R,0,0,this.width,this.height,a,A,ee,xe),new RawImage(ne.getImageData(0,0,ee,xe).data,ee,xe,4).convert(Y)}else{let Y=this.toSharp().extend({left:a,right:l,top:A,bottom:O});return await loadImageFunction(Y)}}async crop([a,l,A,O]){if(a=Math.max(a,0),l=Math.max(l,0),A=Math.min(A,this.width-1),O=Math.min(O,this.height-1),a===0&&l===0&&A===this.width-1&&O===this.height-1)return this;const Y=A-a+1,R=O-l+1;if(BROWSER_ENV){const ee=this.channels,xe=this.toCanvas(),ne=createCanvasFunction(Y,R).getContext("2d");return ne.drawImage(xe,a,l,Y,R,0,0,Y,R),new RawImage(ne.getImageData(0,0,Y,R).data,Y,R,4).convert(ee)}else{const ee=this.toSharp().extract({left:a,top:l,width:Y,height:R});return await loadImageFunction(ee)}}async center_crop(a,l){if(this.width===a&&this.height===l)return this;let A=(this.width-a)/2,O=(this.height-l)/2;if(BROWSER_ENV){let Y=this.channels,R=this.toCanvas();const ee=createCanvasFunction(a,l).getContext("2d");let xe=0,ne=0,te=0,f=0;return A>=0?xe=A:te=-A,O>=0?ne=O:f=-O,ee.drawImage(R,xe,ne,a,l,te,f,a,l),new RawImage(ee.getImageData(0,0,a,l).data,a,l,4).convert(Y)}else{let Y=this.toSharp();if(A>=0&&O>=0)Y=Y.extract({left:Math.floor(A),top:Math.floor(O),width:a,height:l});else if(A<=0&&O<=0){let R=Math.floor(-O),ee=Math.floor(-A);Y=Y.extend({top:R,left:ee,right:a-this.width-ee,bottom:l-this.height-R})}else{let R=[0,0],ee=0;O<0?(R[0]=Math.floor(-O),R[1]=l-this.height-R[0]):ee=Math.floor(O);let xe=[0,0],ne=0;A<0?(xe[0]=Math.floor(-A),xe[1]=a-this.width-xe[0]):ne=Math.floor(A),Y=Y.extend({top:R[0],bottom:R[1],left:xe[0],right:xe[1]}).extract({left:ne,top:ee,width:a,height:l})}return await loadImageFunction(Y)}}async toBlob(a="image/png",l=1){if(!BROWSER_ENV)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:a,quality:l})}toTensor(a="CHW"){let l=new Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(a!=="HWC")if(a==="CHW")l=l.permute(2,0,1);else throw new Error(`Unsupported channel format: ${a}`);return l}toCanvas(){if(!BROWSER_ENV)throw new Error("toCanvas() is only supported in browser environments.");let a=this.clone().rgba(),l=createCanvasFunction(a.width,a.height),A=new ImageDataClass(a.data,a.width,a.height);return l.getContext("2d").putImageData(A,0,0),l}_update(a,l,A,O=null){return this.data=a,this.width=l,this.height=A,O!==null&&(this.channels=O),this}clone(){return new RawImage(this.data.slice(),this.width,this.height,this.channels)}convert(a){if(this.channels===a)return this;switch(a){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(a){if(BROWSER_ENV){if(WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const l=a.split(".").pop().toLowerCase(),A=CONTENT_TYPE_MAP.get(l)??"image/png",O=await this.toBlob(A),Y=URL.createObjectURL(O),R=document.createElement("a");R.href=Y,R.download=a,R.click(),R.remove()}else{if(env$1.useFS)return await this.toSharp().toFile(a);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(BROWSER_ENV)throw new Error("toSharp() is only supported in server-side environments.");return fs(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}async function read_audio(g,a){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const l=await(await getFile(g)).arrayBuffer(),A=new AudioContext({sampleRate:a});typeof a>"u"&&console.warn(`No sampling rate provided, using default of ${A.sampleRate}Hz.`);const O=await A.decodeAudioData(l);let Y;if(O.numberOfChannels===2){const R=Math.sqrt(2),ee=O.getChannelData(0),xe=O.getChannelData(1);Y=new Float32Array(ee.length);for(let ne=0;ne<O.length;++ne)Y[ne]=R*(ee[ne]+xe[ne])/2}else Y=O.getChannelData(0);return Y}function hanning(g){if(g<1)return new Float64Array;if(g===1)return new Float64Array([1]);const a=g-1,l=Math.PI/a,A=new Float64Array(g);for(let O=0;O<g;++O){const Y=2*O-a;A[O]=.5+.5*Math.cos(l*Y)}return A}const HERTZ_TO_MEL_MAPPING={htk:g=>2595*Math.log10(1+g/700),kaldi:g=>1127*Math.log(1+g/700),slaney:(g,a=1e3,l=15,A=27/Math.log(6.4))=>g>=a?l+Math.log(g/a)*A:3*g/200};function hertz_to_mel(g,a="htk"){const l=HERTZ_TO_MEL_MAPPING[a];if(!l)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof g=="number"?l(g):g.map(A=>l(A))}const MEL_TO_HERTZ_MAPPING={htk:g=>700*(10**(g/2595)-1),kaldi:g=>700*(Math.exp(g/1127)-1),slaney:(g,a=1e3,l=15,A=Math.log(6.4)/27)=>g>=l?a*Math.exp(A*(g-l)):200*g/3};function mel_to_hertz(g,a="htk"){const l=MEL_TO_HERTZ_MAPPING[a];if(!l)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof g=="number"?l(g):g.map(A=>l(A))}function _create_triangular_filter_bank(g,a){const l=Float64Array.from({length:a.length-1},(R,ee)=>a[ee+1]-a[ee]),A=Array.from({length:g.length},()=>new Array(a.length));for(let R=0;R<g.length;++R){const ee=A[R];for(let xe=0;xe<a.length;++xe)ee[xe]=a[xe]-g[R]}const O=a.length-2,Y=Array.from({length:O},()=>new Array(g.length));for(let R=0;R<g.length;++R){const ee=A[R];for(let xe=0;xe<O;++xe){const ne=-ee[xe]/l[xe],te=ee[xe+2]/l[xe+1];Y[xe][R]=Math.max(0,Math.min(ne,te))}}return Y}function linspace(g,a,l){const A=(a-g)/(l-1);return Float64Array.from({length:l},(O,Y)=>g+A*Y)}function mel_filter_bank(g,a,l,A,O,Y=null,R="htk",ee=!1){if(Y!==null&&Y!=="slaney")throw new Error('norm must be one of null or "slaney"');const xe=hertz_to_mel(l,R),ne=hertz_to_mel(A,R),te=linspace(xe,ne,a+2);let f=mel_to_hertz(te,R),d;if(ee){const Z=O/(g*2);d=hertz_to_mel(Float64Array.from({length:g},(Ye,et)=>et*Z),R),f=te}else d=linspace(0,Math.floor(O/2),g);const H=_create_triangular_filter_bank(d,f);if(Y!==null&&Y==="slaney")for(let Z=0;Z<a;++Z){const Ye=H[Z],et=2/(f[Z+2]-f[Z]);for(let tt=0;tt<g;++tt)Ye[tt]*=et}return H}function padReflect(g,a,l){const A=new g.constructor(g.length+a+l),O=g.length-1;for(let Y=0;Y<g.length;++Y)A[a+Y]=g[Y];for(let Y=1;Y<=a;++Y)A[a-Y]=g[calculateReflectOffset(Y,O)];for(let Y=1;Y<=l;++Y)A[O+a+Y]=g[calculateReflectOffset(O-Y,O)];return A}function _db_conversion_helper(g,a,l,A,O){if(l<=0)throw new Error("reference must be greater than zero");if(A<=0)throw new Error("min_value must be greater than zero");l=Math.max(A,l);const Y=Math.log10(l);for(let R=0;R<g.length;++R)g[R]=a*Math.log10(Math.max(A,g[R])-Y);if(O!==null){if(O<=0)throw new Error("db_range must be greater than zero");const R=max(g)[0]-O;for(let ee=0;ee<g.length;++ee)g[ee]=Math.max(g[ee],R)}return g}function amplitude_to_db(g,a=1,l=1e-5,A=null){return _db_conversion_helper(g,20,a,l,A)}function power_to_db(g,a=1,l=1e-10,A=null){return _db_conversion_helper(g,10,a,l,A)}function spectrogram(g,a,l,A,{fft_length:O=null,power:Y=1,center:R=!0,pad_mode:ee="reflect",onesided:xe=!0,preemphasis:ne=null,mel_filters:te=null,mel_floor:f=1e-10,log_mel:d=null,reference:H=1,min_value:Z=1e-10,db_range:Ye=null,remove_dc_offset:et=null,max_num_frames:tt=null,do_pad:nt=!0,transpose:it=!1}={}){const ot=a.length;if(O===null&&(O=l),l>O)throw Error(`frame_length (${l}) may not be larger than fft_length (${O})`);if(ot!==l)throw new Error(`Length of the window (${ot}) must equal frame_length (${l})`);if(A<=0)throw new Error("hop_length must be greater than zero");if(Y===null&&te!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(R){if(ee!=="reflect")throw new Error(`pad_mode="${ee}" not implemented yet.`);const yt=Math.floor((O-1)/2)+1;g=padReflect(g,yt,yt)}const st=Math.floor(1+Math.floor((g.length-l)/A)),at=xe?Math.floor(O/2)+1:O;let ct=st,ft=st;tt!==null&&(tt>st?nt&&(ft=tt):ft=ct=tt);const ut=new FFT(O),_t=new Float64Array(O),At=new Float64Array(ut.outputBufferSize),Et=new Array(ct);for(let yt=0;yt<ct;++yt){const St=yt*A;for(let Ft=0;Ft<l;++Ft)_t[Ft]=g[St+Ft];if(et){let Ft=0;for(let dn=0;dn<l;++dn)Ft+=_t[dn];const ln=Ft/l;for(let dn=0;dn<l;++dn)_t[dn]-=ln}if(ne!==null){for(let Ft=l-1;Ft>=1;--Ft)_t[Ft]-=ne*_t[Ft-1];_t[0]*=1-ne}for(let Ft=0;Ft<a.length;++Ft)_t[Ft]*=a[Ft];ut.realTransform(At,_t);const Yt=new Array(at);for(let Ft=0;Ft<Yt.length;++Ft){const ln=Ft<<1;Yt[Ft]=At[ln]**2+At[ln+1]**2}Et[yt]=Yt}if(Y!==null&&Y!==2){const yt=2/Y;for(let St=0;St<Et.length;++St){const Yt=Et[St];for(let Ft=0;Ft<Yt.length;++Ft)Yt[Ft]**=yt}}const Mt=te.length,Ot=new Float32Array(Mt*ft),kt=it?[ft,Mt]:[Mt,ft];for(let yt=0;yt<Mt;++yt){const St=te[yt];for(let Yt=0;Yt<ct;++Yt){const Ft=Et[Yt];let ln=0;for(let dn=0;dn<at;++dn)ln+=St[dn]*Ft[dn];Ot[it?Yt*Mt+yt:yt*ct+Yt]=Math.max(f,ln)}}if(Y!==null&&d!==null){const yt=Math.min(Ot.length,ct*Mt);switch(d){case"log":for(let St=0;St<yt;++St)Ot[St]=Math.log(Ot[St]);break;case"log10":for(let St=0;St<yt;++St)Ot[St]=Math.log10(Ot[St]);break;case"dB":if(Y===1)amplitude_to_db(Ot,H,Z,Ye);else if(Y===2)power_to_db(Ot,H,Z,Ye);else throw new Error(`Cannot use log_mel option '${d}' with power ${Y}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${d}'`)}}return{data:Ot,dims:kt}}function window_function(g,a,{periodic:l=!0,frame_length:A=null,center:O=!0}={}){const Y=l?g+1:g;let R;switch(a){case"boxcar":R=new Float64Array(Y).fill(1);break;case"hann":case"hann_window":R=hanning(Y);break;case"povey":R=hanning(Y).map(ee=>Math.pow(ee,.85));break;default:throw new Error(`Unknown window type ${a}.`)}if(l&&(R=R.subarray(0,g)),A===null)return R;if(g>A)throw new Error(`Length of the window (${g}) may not be larger than frame_length (${A})`);return R}function center_to_corners_format([g,a,l,A]){return[g-l/2,a-A/2,g+l/2,a+A/2]}function post_process_object_detection(g,a=.5,l=null,A=!1){const O=g.logits,Y=g.pred_boxes,[R,ee,xe]=O.dims;if(l!==null&&l.length!==R)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ne=[];for(let te=0;te<R;++te){let f=l!==null?l[te]:null,d={boxes:[],classes:[],scores:[]},H=O[te],Z=Y[te];for(let Ye=0;Ye<ee;++Ye){let et=H[Ye],tt=[],nt;if(A){nt=et.sigmoid().data;for(let it=0;it<nt.length;++it)nt[it]>a&&tt.push(it)}else{let it=max(et.data)[1];if(it===xe-1)continue;tt.push(it),nt=softmax(et.data)}for(const it of tt){let ot=Z[Ye].data;ot=center_to_corners_format(ot),f!==null&&(ot=ot.map((st,at)=>st*f[(at+1)%2])),d.boxes.push(ot),d.classes.push(it),d.scores.push(nt[it])}}ne.push(d)}return ne}function validate_audio_inputs(g,a){if(!(g instanceof Float32Array||g instanceof Float64Array))throw new Error(`${a} expects input to be a Float32Array or a Float64Array, but got ${g?.constructor?.name??typeof g} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function constraint_to_multiple_of(g,a,l=0,A=null){const O=g/a;let Y=bankers_round(O)*a;return A!==null&&Y>A&&(Y=Math.floor(O)*a),Y<l&&(Y=Math.ceil(O)*a),Y}function enforce_size_divisibility([g,a],l){return[Math.max(Math.floor(g/l),1)*l,Math.max(Math.floor(a/l),1)*l]}class FeatureExtractor extends Callable{constructor(a){super(),this.config=a}}class ImageFeatureExtractor extends FeatureExtractor{constructor(a){super(a),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??!1}async thumbnail(a,l,A=2){const O=a.height,Y=a.width,R=l.height,ee=l.width;let xe=Math.min(O,R),ne=Math.min(Y,ee);return xe===O&&ne===Y?a:(O>Y?ne=Math.floor(Y*xe/O):Y>O&&(xe=Math.floor(O*ne/Y)),await a.resize(ne,xe,{resample:A}))}async crop_margin(a,l=200){const A=a.clone().grayscale(),O=min(A.data)[0],R=max(A.data)[0]-O;if(R===0)return a;const ee=l/255;let xe=A.width,ne=A.height,te=0,f=0;for(let d=0;d<A.height;++d){const H=d*A.width;for(let Z=0;Z<A.width;++Z)(A.data[H+Z]-O)/R<ee&&(xe=Math.min(xe,Z),ne=Math.min(ne,d),te=Math.max(te,Z),f=Math.max(f,d))}return a=await a.crop([xe,ne,te,f]),a}pad_image(a,l,A,{mode:O="constant",center:Y=!1,constant_values:R=0}={}){const[ee,xe,ne]=l;let te,f;if(typeof A=="number"?(te=A,f=A):(te=A.width,f=A.height),te!==xe||f!==ee){const d=new Float32Array(te*f*ne);if(Array.isArray(R))for(let Ye=0;Ye<d.length;++Ye)d[Ye]=R[Ye%ne];else R!==0&&d.fill(R);const[H,Z]=Y?[Math.floor((te-xe)/2),Math.floor((f-ee)/2)]:[0,0];for(let Ye=0;Ye<ee;++Ye){const et=(Ye+Z)*te,tt=Ye*xe;for(let nt=0;nt<xe;++nt){const it=(et+nt+H)*ne,ot=(tt+nt)*ne;for(let st=0;st<ne;++st)d[it+st]=a[ot+st]}}if(O==="symmetric"){if(Y)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const Ye=ee-1,et=xe-1;for(let tt=0;tt<f;++tt){const nt=tt*te,it=calculateReflectOffset(tt,Ye)*xe;for(let ot=0;ot<te;++ot){if(tt<ee&&ot<xe)continue;const st=(nt+ot)*ne,at=(it+calculateReflectOffset(ot,et))*ne;for(let ct=0;ct<ne;++ct)d[st+ct]=a[at+ct]}}}a=d,l=[f,te,ne]}return[a,l]}rescale(a){for(let l=0;l<a.length;++l)a[l]=this.rescale_factor*a[l]}get_resize_output_image_size(a,l){const[A,O]=a.size;let Y,R;if(this.do_thumbnail){const{height:ee,width:xe}=l;Y=Math.min(ee,xe)}else Number.isInteger(l)?(Y=l,R=this.config.max_size??Y):l!==void 0&&(Y=l.shortest_edge,R=l.longest_edge);if(Y!==void 0||R!==void 0){const ee=Y===void 0?1:Math.max(Y/A,Y/O),xe=A*ee,ne=O*ee,te=R===void 0?1:Math.min(R/xe,R/ne);let f=Math.floor(Number((xe*te).toFixed(2))),d=Math.floor(Number((ne*te).toFixed(2)));return this.size_divisibility!==void 0&&([f,d]=enforce_size_divisibility([f,d],this.size_divisibility)),[f,d]}else if(l!==void 0&&l.width!==void 0&&l.height!==void 0){let ee=l.width,xe=l.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let ne=xe/O,te=ee/A;Math.abs(1-te)<Math.abs(1-ne)?ne=te:te=ne,xe=constraint_to_multiple_of(ne*O,this.config.ensure_multiple_of),ee=constraint_to_multiple_of(te*A,this.config.ensure_multiple_of)}return[ee,xe]}else{if(this.size_divisibility!==void 0)return enforce_size_divisibility([A,O],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(l)}`)}}async resize(a){const[l,A]=this.get_resize_output_image_size(a,this.size);return await a.resize(l,A,{resample:this.resample})}async preprocess(a,{do_normalize:l=null,do_pad:A=null,do_convert_rgb:O=null,do_convert_grayscale:Y=null,do_flip_channel_order:R=null}={}){this.do_crop_margin&&(a=await this.crop_margin(a));const[ee,xe]=a.size;if(O??this.do_convert_rgb?a=a.rgb():Y&&(a=a.grayscale()),this.do_resize&&(a=await this.resize(a)),this.do_thumbnail&&(a=await this.thumbnail(a,this.size,this.resample)),this.do_center_crop){let H,Z;Number.isInteger(this.crop_size)?(H=this.crop_size,Z=this.crop_size):(H=this.crop_size.width,Z=this.crop_size.height),a=await a.center_crop(H,Z)}const ne=[a.height,a.width];let te=Float32Array.from(a.data),f=[a.height,a.width,a.channels];if(this.do_rescale&&this.rescale(te),l??this.do_normalize){let H=this.image_mean;Array.isArray(this.image_mean)||(H=new Array(a.channels).fill(H));let Z=this.image_std;if(Array.isArray(this.image_std)||(Z=new Array(a.channels).fill(H)),H.length!==a.channels||Z.length!==a.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${H.length}) and \`image_std\` (${Z.length}) must match the number of channels in the image (${a.channels}).`);for(let Ye=0;Ye<te.length;Ye+=a.channels)for(let et=0;et<a.channels;++et)te[Ye+et]=(te[Ye+et]-H[et])/Z[et]}if(A??this.do_pad){if(this.pad_size)[te,f]=this.pad_image(te,[a.height,a.width,a.channels],this.pad_size);else if(this.size_divisibility){const[H,Z]=enforce_size_divisibility([f[1],f[0]],this.size_divisibility);[te,f]=this.pad_image(te,f,{width:H,height:Z})}}if(R??this.do_flip_channel_order){if(f[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let H=0;H<te.length;H+=3){const Z=te[H];te[H]=te[H+2],te[H+2]=Z}}const d=new Tensor("float32",te,f).permute(2,0,1);return{original_size:[xe,ee],reshaped_input_size:ne,pixel_values:d}}async _call(a,...l){Array.isArray(a)||(a=[a]);const A=await Promise.all(a.map(Y=>this.preprocess(Y)));return{pixel_values:stack(A.map(Y=>Y.pixel_values),0),original_sizes:A.map(Y=>Y.original_size),reshaped_input_sizes:A.map(Y=>Y.reshaped_input_size)}}}class SegformerFeatureExtractor extends ImageFeatureExtractor{post_process_semantic_segmentation(a,l=null){const A=a.logits,O=A.dims[0];if(l!==null&&l.length!==O)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const Y=[];for(let R=0;R<O;++R){const ee=l!==null?l[R]:null;let xe=A[R];ee!==null&&(xe=interpolate(xe,ee,"bilinear",!1));const[ne,te]=ee??xe.dims.slice(-2),f=new Tensor("int32",new Int32Array(ne*te),[ne,te]),d=xe[0].data;for(let et=1;et<xe.dims[0];++et){const tt=xe[et].data;for(let nt=0;nt<tt.length;++nt)tt[nt]>d[nt]&&(d[nt]=tt[nt],f.data[nt]=et)}const H=new Array(xe.dims[0]),Z=f.data;for(let et=0;et<Z.length;++et){const tt=Z[et];H[tt]=tt}const Ye=H.filter(et=>et!==void 0);Y.push({segmentation:f,labels:Ye})}return Y}}class DPTFeatureExtractor extends ImageFeatureExtractor{}class DPTImageProcessor extends DPTFeatureExtractor{}class BitImageProcessor extends ImageFeatureExtractor{}class GLPNFeatureExtractor extends ImageFeatureExtractor{}class CLIPFeatureExtractor extends ImageFeatureExtractor{}class ChineseCLIPFeatureExtractor extends ImageFeatureExtractor{}class SiglipImageProcessor extends ImageFeatureExtractor{}class ConvNextFeatureExtractor extends ImageFeatureExtractor{constructor(a){super(a),this.crop_pct=this.config.crop_pct??224/256}async resize(a){const l=this.size?.shortest_edge;if(l===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(l<384){const A=Math.floor(l/this.crop_pct),[O,Y]=this.get_resize_output_image_size(a,{shortest_edge:A});a=await a.resize(O,Y,{resample:this.resample}),a=await a.center_crop(l,l)}else a=await a.resize(l,l,{resample:this.resample});return a}}class ConvNextImageProcessor extends ConvNextFeatureExtractor{}class ViTFeatureExtractor extends ImageFeatureExtractor{}class ViTImageProcessor extends ImageFeatureExtractor{}class EfficientNetImageProcessor extends ImageFeatureExtractor{constructor(a){super(a),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(l=>l*l))}}class MobileViTFeatureExtractor extends ImageFeatureExtractor{}class MobileViTImageProcessor extends MobileViTFeatureExtractor{}class OwlViTFeatureExtractor extends ImageFeatureExtractor{post_process_object_detection(...a){return post_process_object_detection(...a)}}class Owlv2ImageProcessor extends OwlViTFeatureExtractor{}class DeiTFeatureExtractor extends ImageFeatureExtractor{}class BeitFeatureExtractor extends ImageFeatureExtractor{}class DonutFeatureExtractor extends ImageFeatureExtractor{pad_image(a,l,A,O={}){const[Y,R,ee]=l;let xe=this.image_mean;Array.isArray(this.image_mean)||(xe=new Array(ee).fill(xe));let ne=this.image_std;Array.isArray(ne)||(ne=new Array(ee).fill(xe));const te=xe.map((f,d)=>-f/ne[d]);return super.pad_image(a,l,A,{center:!0,constant_values:te,...O})}}class NougatImageProcessor extends DonutFeatureExtractor{}class DetrFeatureExtractor extends ImageFeatureExtractor{async _call(a){const l=await super._call(a),A=[l.pixel_values.dims[0],64,64],O=new Tensor("int64",new BigInt64Array(A.reduce((Y,R)=>Y*R)).fill(1n),A);return{...l,pixel_mask:O}}post_process_object_detection(...a){return post_process_object_detection(...a)}remove_low_and_no_objects(a,l,A,O){let Y=[],R=[],ee=[];for(let xe=0;xe<a.dims[0];++xe){let ne=a[xe],te=l[xe],f=max(ne.data)[1];if(f===O)continue;let H=softmax(ne.data)[f];H>A&&(Y.push(te),R.push(H),ee.push(f))}return[Y,R,ee]}check_segment_validity(a,l,A,O=.5,Y=.8){let R=[],ee=0,xe=0;for(let te=0;te<a.length;++te)a[te]===A&&(R.push(te),++ee),l[A].data[te]>=O&&++xe;let ne=ee>0&&xe>0;return ne&&(ne=ee/xe>Y),[ne,R]}compute_segments(a,l,A,O,Y,R=null,ee=null){let[xe,ne]=ee??a[0].dims,te=new Tensor("int32",new Int32Array(xe*ne),[xe,ne]),f=[];if(ee!==null)for(let Ye=0;Ye<a.length;++Ye)a[Ye]=interpolate(a[Ye],ee,"bilinear",!1);let d=new Int32Array(a[0].data.length),H=new Float32Array(a[0].data.length);for(let Ye=0;Ye<a.length;++Ye){let et=l[Ye];for(let tt=0;tt<a[Ye].data.length;++tt)a[Ye].data[tt]*=et,a[Ye].data[tt]>H[tt]&&(d[tt]=Ye,H[tt]=a[Ye].data[tt])}let Z=0;for(let Ye=0;Ye<A.length;++Ye){let et=A[Ye],[tt,nt]=this.check_segment_validity(d,a,Ye,O,Y);if(tt){++Z;for(let it of nt)te.data[it]=Z;f.push({id:Z,label_id:et,score:l[Ye]})}}return[te,f]}post_process_panoptic_segmentation(a,l=.5,A=.5,O=.8,Y=null,R=null){Y===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),Y=new Set);const ee=a.logits,ne=a.pred_masks.sigmoid();let[te,f,d]=ee.dims;if(d-=1,R!==null&&R.length!==te)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let H=[];for(let Z=0;Z<te;++Z){let Ye=R!==null?R[Z]:null,et=ee[Z],tt=ne[Z],[nt,it,ot]=this.remove_low_and_no_objects(et,tt,l,d);if(ot.length===0){let[ct,ft]=Ye??tt.dims.slice(-2),ut=new Tensor("int32",new Int32Array(ct*ft).fill(-1),[ct,ft]);H.push({segmentation:ut,segments_info:[]});continue}let[st,at]=this.compute_segments(nt,it,ot,A,O,Y,Ye);H.push({segmentation:st,segments_info:at})}return H}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class YolosFeatureExtractor extends ImageFeatureExtractor{post_process_object_detection(...a){return post_process_object_detection(...a)}}class SamImageProcessor extends ImageFeatureExtractor{reshape_input_points(a,l,A){a=structuredClone(a);let O=calculateDimensions(a);if(O.length===3)O=[1,...O],a=[a];else if(O.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let Y=0;Y<a.length;++Y){let R=l[Y],ee=A[Y],xe=[ee[0]/R[0],ee[1]/R[1]];for(let ne=0;ne<a[Y].length;++ne)for(let te=0;te<a[Y][ne].length;++te)for(let f=0;f<a[Y][ne][te].length;++f)a[Y][ne][te][f]*=xe[f]}return new Tensor("float32",Float32Array.from(a.flat(1/0)),O)}add_input_labels(a,l){let A=calculateDimensions(a);if(A.length===2)A=[1,...A],a=[a];else if(A.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(A.some((O,Y)=>O!==l.dims[Y]))throw Error(`The first ${A.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new Tensor("int64",a.flat(1/0).map(BigInt),A)}async _call(a,l=null,A=null){const O=await super._call(a);if(l&&(O.input_points=this.reshape_input_points(l,O.original_sizes,O.reshaped_input_sizes)),A){if(!O.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");O.input_labels=this.add_input_labels(A,O.input_points)}return O}post_process_masks(a,l,A,{mask_threshold:O=0,binarize:Y=!0,pad_size:R=null}={}){const ee=[];R=R??this.pad_size;const xe=[R.height,R.width];for(let ne=0;ne<l.length;++ne){const te=l[ne],f=A[ne],d=a[ne],H=[];for(let Z=0;Z<d.dims[0];++Z){const Ye=d[Z];let et=interpolate(Ye,xe,"bilinear",!1);if(et=et.slice(null,[0,f[0]],[0,f[1]]),et=interpolate(et,te,"bilinear",!1),Y){const tt=new Uint8Array(et.data.length);for(let nt=0;nt<et.data.length;++nt)et.data[nt]>O&&(tt[nt]=1);et=new Tensor("bool",tt,et.dims)}H.push(et)}ee.push(stack(H))}return ee}}class Swin2SRImageProcessor extends ImageFeatureExtractor{pad_image(a,l,A,O={}){const[Y,R,ee]=l;return super.pad_image(a,l,{width:R+(A-R%A)%A,height:Y+(A-Y%A)%A},{mode:"symmetric",center:!1,constant_values:-1,...O})}}class VitMatteImageProcessor extends ImageFeatureExtractor{async _call(a,l){Array.isArray(a)||(a=[a]),Array.isArray(l)||(l=[l]);const A=await Promise.all(a.map(R=>this.preprocess(R))),O=await Promise.all(l.map(R=>this.preprocess(R,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:stack(A.map((R,ee)=>cat([R.pixel_values,O[ee].pixel_values],0)),0),original_sizes:A.map(R=>R.original_size),reshaped_input_sizes:A.map(R=>R.reshaped_input_size)}}}class WhisperFeatureExtractor extends FeatureExtractor{constructor(a){super(a),this.config.mel_filters??=mel_filter_bank(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=window_function(this.config.n_fft,"hann")}_extract_fbank_features(a){const{data:l,dims:A}=spectrogram(a,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),O=max(l)[0];for(let Y=0;Y<l.length;++Y)l[Y]=(Math.max(l[Y],O-8)+4)/4;return{data:l,dims:A}}async _call(a){validate_audio_inputs(a,"WhisperFeatureExtractor");let l;a.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),l=a.slice(0,this.config.n_samples)):(l=new Float32Array(this.config.n_samples),l.set(a));const{data:A,dims:O}=this._extract_fbank_features(l);return{input_features:new Tensor("float32",A,[1,...O])}}}class Wav2Vec2FeatureExtractor extends FeatureExtractor{_zero_mean_unit_var_norm(a){const A=a.reduce((Y,R)=>Y+R,0)/a.length,O=a.reduce((Y,R)=>Y+(R-A)**2,0)/a.length;return a.map(Y=>(Y-A)/Math.sqrt(O+1e-7))}async _call(a){validate_audio_inputs(a,"Wav2Vec2FeatureExtractor"),a instanceof Float64Array&&(a=new Float32Array(a));let l=a;this.config.do_normalize&&(l=this._zero_mean_unit_var_norm(l));const A=[1,l.length];return{input_values:new Tensor("float32",l,A),attention_mask:new Tensor("int64",new BigInt64Array(l.length).fill(1n),A)}}}class SeamlessM4TFeatureExtractor extends FeatureExtractor{constructor(a){super(a);const l=this.config.sampling_rate,A=mel_filter_bank(256,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);for(let O=0;O<A.length;++O)A[O].push(0);this.mel_filters=A,this.window=window_function(400,"povey",{periodic:!1})}_extract_fbank_features(a,l){return a=a.map(A=>A*32768),spectrogram(a,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:l,transpose:!0})}async _call(a,{padding:l=!0,pad_to_multiple_of:A=2,do_normalize_per_mel_bins:O=!0,return_attention_mask:Y=!0}={}){validate_audio_inputs(a,"SeamlessM4TFeatureExtractor");let R=this._extract_fbank_features(a,this.config.max_length);if(O){const[Z,Ye]=R.dims;for(let et=0;et<Ye;++et){let tt=0;for(let st=0;st<Z;++st)tt+=R.data[st*Ye+et];const nt=tt/Z;let it=0;for(let st=0;st<Z;++st)it+=(R.data[st*Ye+et]-nt)**2;it/=Z-1;const ot=Math.sqrt(it+1e-7);for(let st=0;st<Z;++st){const at=st*Ye+et;R.data[at]=(R.data[at]-nt)/ot}}}let ee;if(l){const[Z,Ye]=R.dims,et=Z%A;if(et>0){const tt=new Float32Array(Ye*(Z+et));tt.set(R.data),tt.fill(this.config.padding_value,R.data.length);const nt=Z+et;R={data:tt,dims:[nt,Ye]},Y&&(ee=new Tensor("int64",new BigInt64Array(nt),[1,nt]),ee.data.fill(1n,0,Z))}}const[xe,ne]=R.dims,te=this.config.stride;if(xe%te!==0)throw new Error(`The number of frames (${xe}) must be a multiple of the stride (${te}).`);const d=new Tensor("float32",R.data,R.dims).view(1,Math.floor(xe/te),ne*te),H={input_features:d};if(Y){const Z=d.dims[1],Ye=new Tensor("int64",new BigInt64Array(Z),[1,Z]);if(ee)for(let et=1,tt=0;et<xe;et+=te,++tt)Ye.data[tt]=ee.data[et];else Ye.data.fill(1n);H.attention_mask=Ye}return H}}class ASTFeatureExtractor extends FeatureExtractor{constructor(a){super(a);const l=this.config.sampling_rate,A=mel_filter_bank(256,this.config.num_mel_bins,20,Math.floor(l/2),l,null,"kaldi",!0);for(let O=0;O<A.length;++O)A[O].push(0);this.mel_filters=A,this.window=window_function(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}_extract_fbank_features(a,l){return spectrogram(a,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:l,transpose:!0})}async _call(a){validate_audio_inputs(a,"ASTFeatureExtractor");const l=this._extract_fbank_features(a,this.config.max_length);if(this.config.do_normalize){const A=this.std*2;for(let O=0;O<l.data.length;++O)l.data[O]=(l.data[O]-this.mean)/A}return{input_values:new Tensor("float32",l.data,[1,...l.dims])}}}class ClapFeatureExtractor extends FeatureExtractor{constructor(a){super(a),this.mel_filters=mel_filter_bank(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=mel_filter_bank(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=window_function(this.config.fft_window_size,"hann")}_get_input_mel(a,l,A,O){let Y,R=!1;const ee=a.length-l;if(ee>0)if(A==="rand_trunc"){R=!0;const xe=Math.floor(Math.random()*(ee+1));a=a.subarray(xe,xe+l),Y=this._extract_fbank_features(a,this.mel_filters_slaney,this.config.nb_max_samples),Y.dims=[1,...Y.dims]}else throw new Error(`Truncation strategy "${A}" not implemented`);else{if(ee<0){let xe=new Float64Array(l);if(xe.set(a),O==="repeat")for(let ne=a.length;ne<l;ne+=a.length)xe.set(a.subarray(0,Math.min(a.length,l-ne)),ne);else if(O==="repeatpad")for(let ne=a.length;ne<-ee;ne+=a.length)xe.set(a,ne);a=xe}if(A==="fusion")throw new Error(`Truncation strategy "${A}" not implemented`);Y=this._extract_fbank_features(a,this.mel_filters_slaney,this.config.nb_max_samples),Y.dims=[1,...Y.dims]}return{...Y,longer:R}}_extract_fbank_features(a,l,A=null){return spectrogram(a,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:l,log_mel:"dB",max_num_frames:A,do_pad:!1,transpose:!0})}async _call(a,{max_length:l=null}={}){validate_audio_inputs(a,"ClapFeatureExtractor");const A=this._get_input_mel(a,l??this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new Tensor("float32",A.data,[1,...A.dims])}}}class SpeechT5FeatureExtractor extends FeatureExtractor{}class Processor extends Callable{constructor(a){super(),this.feature_extractor=a}async _call(a,...l){return await this.feature_extractor(a,...l)}}class SamProcessor extends Processor{async _call(...a){return await this.feature_extractor(...a)}post_process_masks(...a){return this.feature_extractor.post_process_masks(...a)}reshape_input_points(...a){return this.feature_extractor.reshape_input_points(...a)}}class WhisperProcessor extends Processor{async _call(a){return await this.feature_extractor(a)}}class Wav2Vec2ProcessorWithLM extends Processor{async _call(a){return await this.feature_extractor(a)}}class SpeechT5Processor extends Processor{async _call(a){return await this.feature_extractor(a)}}class OwlViTProcessor extends Processor{}class AutoProcessor{static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor,WhisperFeatureExtractor,ViTFeatureExtractor,MobileViTFeatureExtractor,MobileViTImageProcessor,OwlViTFeatureExtractor,Owlv2ImageProcessor,CLIPFeatureExtractor,ChineseCLIPFeatureExtractor,SiglipImageProcessor,ConvNextFeatureExtractor,ConvNextImageProcessor,SegformerFeatureExtractor,BitImageProcessor,DPTImageProcessor,DPTFeatureExtractor,GLPNFeatureExtractor,BeitFeatureExtractor,DeiTFeatureExtractor,DetrFeatureExtractor,YolosFeatureExtractor,DonutFeatureExtractor,NougatImageProcessor,EfficientNetImageProcessor,ViTImageProcessor,VitMatteImageProcessor,SamImageProcessor,Swin2SRImageProcessor,Wav2Vec2FeatureExtractor,SeamlessM4TFeatureExtractor,SpeechT5FeatureExtractor,ASTFeatureExtractor,ClapFeatureExtractor};static PROCESSOR_CLASS_MAPPING={WhisperProcessor,Wav2Vec2ProcessorWithLM,SamProcessor,SpeechT5Processor,OwlViTProcessor};static async from_pretrained(a,{progress_callback:l=null,config:A=null,cache_dir:O=null,local_files_only:Y=!1,revision:R="main"}={}){let ee=A??await getModelJSON(a,"preprocessor_config.json",!0,{progress_callback:l,cache_dir:O,local_files_only:Y,revision:R}),xe=ee.feature_extractor_type??ee.image_processor_type,ne=this.FEATURE_EXTRACTOR_CLASS_MAPPING[xe];if(!ne)if(ee.size!==void 0)console.warn(`Feature extractor type "${xe}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),ne=ImageFeatureExtractor;else throw new Error(`Unknown Feature Extractor type: ${xe}`);let te=this.PROCESSOR_CLASS_MAPPING[ee.processor_class]??Processor,f=new ne(ee);return new te(f)}}async function prepareImages(g){return Array.isArray(g)||(g=[g]),await Promise.all(g.map(a=>RawImage.read(a)))}async function prepareAudios(g,a){return Array.isArray(g)||(g=[g]),await Promise.all(g.map(l=>typeof l=="string"||l instanceof URL?read_audio(l,a):l instanceof Float64Array?new Float32Array(l):l))}function get_bounding_box(g,a){a&&(g=g.map(R=>R|0));const[l,A,O,Y]=g;return{xmin:l,ymin:A,xmax:O,ymax:Y}}class Pipeline extends Callable{constructor({task:a,model:l,tokenizer:A=null,processor:O=null}){super(),this.task=a,this.model=l,this.tokenizer=A,this.processor=O}async dispose(){await this.model.dispose()}}class TextClassificationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{topk:l=1}={}){const A=this.tokenizer(a,{padding:!0,truncation:!0}),O=await this.model(A),Y=this.model.config.problem_type==="multi_label_classification"?xe=>xe.sigmoid().data:xe=>softmax(xe.data),R=this.model.config.id2label,ee=[];for(const xe of O.logits){const ne=Y(xe),f=getTopItems(ne,l).map(d=>({label:R[d[0]],score:d[1]}));l===1?ee.push(...f):ee.push(f)}return Array.isArray(a)||l===1?ee:ee[0]}}class TokenClassificationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{ignore_labels:l=["O"]}={}){const A=Array.isArray(a),O=this.tokenizer(A?a:[a],{padding:!0,truncation:!0}),R=(await this.model(O)).logits,ee=this.model.config.id2label,xe=[];for(let ne=0;ne<R.dims[0];++ne){const te=O.input_ids[ne],f=R[ne],d=[];for(let H=0;H<f.dims[0];++H){const Z=f[H],Ye=max(Z.data)[1],et=ee?ee[Ye]:`LABEL_${Ye}`;if(l.includes(et))continue;const tt=this.tokenizer.decode([te[H].item()],{skip_special_tokens:!0});if(tt==="")continue;const nt=softmax(Z.data);d.push({entity:et,score:nt[Ye],index:H,word:tt,start:null,end:null})}xe.push(d)}return A?xe:xe[0]}}class QuestionAnsweringPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l,{topk:A=1}={}){const O=this.tokenizer(a,{text_pair:l,padding:!0,truncation:!0}),Y=await this.model(O),R=[];for(let ee=0;ee<Y.start_logits.dims[0];++ee){const xe=O.input_ids[ee],ne=xe.indexOf(this.tokenizer.sep_token_id),te=Array.from(softmax(Y.start_logits[ee].data)).map((H,Z)=>[H,Z]).filter(H=>H[1]>ne),f=Array.from(softmax(Y.end_logits[ee].data)).map((H,Z)=>[H,Z]).filter(H=>H[1]>ne),d=product(te,f).filter(H=>H[0][1]<=H[1][1]).map(H=>[H[0][1],H[1][1],H[0][0]*H[1][0]]).sort((H,Z)=>Z[2]-H[2]);for(let H=0;H<Math.min(d.length,A);++H){const[Z,Ye,et]=d[H],tt=[...xe].slice(Z,Ye+1),nt=this.tokenizer.decode(tt,{skip_special_tokens:!0});R.push({answer:nt,score:et})}}return A===1?R[0]:R}}class FillMaskPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{topk:l=5}={}){const A=this.tokenizer(a,{padding:!0,truncation:!0}),O=await this.model(A),Y=[];for(let R=0;R<A.input_ids.dims[0];++R){const ee=A.input_ids[R],xe=ee.indexOf(this.tokenizer.mask_token_id);if(xe===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const te=O.logits[R][xe],f=getTopItems(softmax(te.data),l);Y.push(f.map(d=>{const H=[...ee];return H[xe]=d[0],{score:d[1],token:d[0],token_str:this.tokenizer.model.vocab[d[0]],sequence:this.tokenizer.decode(H,{skip_special_tokens:!0})}}))}return Array.isArray(a)?Y:Y[0]}}class Text2TextGenerationPipeline extends Pipeline{_key="generated_text";constructor(a){super(a)}async _call(a,l={}){Array.isArray(a)||(a=[a]),this.model.config.prefix&&(a=a.map(xe=>this.model.config.prefix+xe));const A=this.model.config.task_specific_params;A&&A[this.task]&&A[this.task].prefix&&(a=a.map(xe=>A[this.task].prefix+xe));const O=this.tokenizer,Y={padding:!0,truncation:!0};let R;this instanceof TranslationPipeline&&"_build_translation_inputs"in O?R=O._build_translation_inputs(a,Y,l).input_ids:R=O(a,Y).input_ids;const ee=await this.model.generate(R,l);return O.batch_decode(ee,{skip_special_tokens:!0}).map(xe=>({[this._key]:xe}))}}class SummarizationPipeline extends Text2TextGenerationPipeline{_key="summary_text";constructor(a){super(a)}}class TranslationPipeline extends Text2TextGenerationPipeline{_key="translation_text";constructor(a){super(a)}}function isChat(g){return Array.isArray(g)&&g.every(a=>"role"in a&&"content"in a)}class TextGenerationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l={}){let A=!1,O=!1,Y;if(typeof a=="string")Y=a=[a];else if(Array.isArray(a)&&a.every(Z=>typeof Z=="string"))A=!0,Y=a;else{if(isChat(a))a=[a];else if(Array.isArray(a)&&a.every(isChat))A=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");O=!0,Y=a.map(Z=>this.tokenizer.apply_chat_template(Z,{tokenize:!1,add_generation_prompt:!0}))}const R=l.add_special_tokens??!1,ee=O?!1:l.return_full_text??!0;this.tokenizer.padding_side="left";const{input_ids:xe,attention_mask:ne}=this.tokenizer(Y,{add_special_tokens:R,padding:!0,truncation:!0}),te=await this.model.generate(xe,l,null,{inputs_attention_mask:ne});let f=this.tokenizer.batch_decode(te,{skip_special_tokens:!0}),d;!ee&&xe.dims.at(-1)>0&&(d=this.tokenizer.batch_decode(xe,{skip_special_tokens:!0}).map(Z=>Z.length));const H=Array.from({length:a.length},Z=>[]);for(let Z=0;Z<f.length;++Z){const Ye=Math.floor(Z/te.length*a.length);d&&(f[Z]=f[Z].slice(d[Ye])),H[Ye].push({generated_text:O?[...a[Ye],{role:"assistant",content:f[Z]}]:f[Z]})}return!A&&H.length===1?H[0]:H}}class ZeroShotClassificationPipeline extends Pipeline{constructor(a){super(a),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([l,A])=>[l.toLowerCase(),A])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(a,l,{hypothesis_template:A="This example is {}.",multi_label:O=!1}={}){const Y=Array.isArray(a);Y||(a=[a]),Array.isArray(l)||(l=[l]);const R=l.map(ne=>A.replace("{}",ne)),ee=O||l.length===1,xe=[];for(const ne of a){const te=[];for(const H of R){const Z=this.tokenizer(ne,{text_pair:H,padding:!0,truncation:!0}),Ye=await this.model(Z);ee?te.push([Ye.logits.data[this.contradiction_id],Ye.logits.data[this.entailment_id]]):te.push(Ye.logits.data[this.entailment_id])}const d=(ee?te.map(H=>softmax(H)[1]):softmax(te)).map((H,Z)=>[H,Z]).sort((H,Z)=>Z[0]-H[0]);xe.push({sequence:ne,labels:d.map(H=>l[H[1]]),scores:d.map(H=>H[0])})}return Y?xe:xe[0]}}class FeatureExtractionPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{pooling:l="none",normalize:A=!1,quantize:O=!1,precision:Y="binary"}={}){const R=this.tokenizer(a,{padding:!0,truncation:!0}),ee=await this.model(R);let xe=ee.last_hidden_state??ee.logits??ee.token_embeddings;if(l!=="none")if(l==="mean")xe=mean_pooling(xe,R.attention_mask);else if(l==="cls")xe=xe.slice(null,0);else throw Error(`Pooling method '${l}' not supported.`);return A&&(xe=xe.normalize(2,-1)),O&&(xe=quantize_embeddings(xe,Y)),xe}}class ImageFeatureExtractionPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{pool:l=null}={}){const A=await prepareImages(a),{pixel_values:O}=await this.processor(A),Y=await this.model({pixel_values:O});let R;if(l){if(!("pooler_output"in Y))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");R=Y.pooler_output}else R=Y.last_hidden_state??Y.logits??Y.image_embeds;return R}}class AudioClassificationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{topk:l=null}={}){const A=!Array.isArray(a),O=this.processor.feature_extractor.config.sampling_rate,Y=await prepareAudios(a,O),R=this.model.config.id2label,ee=[];for(const xe of Y){const ne=await this.processor(xe),f=(await this.model(ne)).logits[0],H=getTopItems(softmax(f.data),l).map(Z=>({label:R[Z[0]],score:Z[1]}));l===1?ee.push(...H):ee.push(H)}return!A||l===1?ee:ee[0]}}class ZeroShotAudioClassificationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l,{hypothesis_template:A="This is a sound of {}."}={}){const O=!Array.isArray(a);O&&(a=[a]);const Y=l.map(te=>A.replace("{}",te)),R=this.tokenizer(Y,{padding:!0,truncation:!0}),ee=this.processor.feature_extractor.config.sampling_rate,xe=await prepareAudios(a,ee),ne=[];for(const te of xe){const f=await this.processor(te),d=await this.model({...R,...f}),H=softmax(d.logits_per_audio.data);ne.push([...H].map((Z,Ye)=>({score:Z,label:l[Ye]})))}return O?ne[0]:ne}}class AutomaticSpeechRecognitionPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(a,l);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(a,l);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(a,l={}){l.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),l.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const A=!Array.isArray(a);A&&(a=[a]);const O=this.processor.feature_extractor.config.sampling_rate,Y=await prepareAudios(a,O),R=[];for(const ee of Y){const xe=await this.processor(ee),te=(await this.model(xe)).logits[0],f=[];for(const H of te)f.push(max(H.data)[1]);const d=this.tokenizer.decode(f);R.push({text:d})}return A?R[0]:R}async _call_whisper(a,l={}){const A=l.return_timestamps??!1,O=l.chunk_length_s??0,Y=l.chunk_callback??null,R=l.force_full_sequences??!1;let ee=l.stride_length_s??null;A==="word"&&(l.return_token_timestamps=!0);const xe=pop(l,"language",null),ne=pop(l,"task",null);if(xe||ne||A){if(l.forced_decoder_ids)throw new Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");const et=this.tokenizer.get_decoder_prompt_ids({language:xe,task:ne,no_timestamps:!A});et.length>0&&(l.forced_decoder_ids=et)}const te=!Array.isArray(a);te&&(a=[a]);const f=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,d=this.processor.feature_extractor.config.hop_length,H=this.processor.feature_extractor.config.sampling_rate,Z=await prepareAudios(a,H),Ye=[];for(const et of Z){let tt=[];if(O>0){if(ee===null)ee=O/6;else if(O<=ee)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const ot=H*O,st=H*ee,at=ot-2*st;let ct=0;for(;ct<et.length;){const ft=et.subarray(ct,ct+ot),ut=await this.processor(ft),_t=ct===0,At=ct+at>=et.length;tt.push({stride:[ft.length,_t?0:st,At?0:st],input_features:ut.input_features,is_last:At}),ct+=at}}else tt=[{stride:[et.length,0,0],input_features:(await this.processor(et)).input_features,is_last:!0}];for(const ot of tt){l.num_frames=Math.floor(ot.stride[0]/d);const st=await this.model.generate(ot.input_features,l);A==="word"?(ot.tokens=st.sequences[0],ot.token_timestamps=st.token_timestamps.tolist()[0].map(at=>round(at,2))):ot.tokens=st[0],ot.stride=ot.stride.map(at=>at/H),Y!==null&&Y(ot)}const[nt,it]=this.tokenizer._decode_asr(tt,{time_precision:f,return_timestamps:A,force_full_sequences:R});Ye.push({text:nt,...it})}return te?Ye[0]:Ye}}class ImageToTextPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l={}){const A=Array.isArray(a),O=await prepareImages(a),{pixel_values:Y}=await this.processor(O),R=[];for(const ee of Y){ee.dims=[1,...ee.dims];const xe=await this.model.generate(ee,l),ne=this.tokenizer.batch_decode(xe,{skip_special_tokens:!0}).map(te=>({generated_text:te.trim()}));R.push(ne)}return A?R:R[0]}}class ImageClassificationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{topk:l=1}={}){const A=Array.isArray(a),O=await prepareImages(a),{pixel_values:Y}=await this.processor(O),R=await this.model({pixel_values:Y}),ee=this.model.config.id2label,xe=[];for(const ne of R.logits){const f=getTopItems(softmax(ne.data),l).map(d=>({label:ee[d[0]],score:d[1]}));l===1?xe.push(...f):xe.push(f)}return A||l===1?xe:xe[0]}}class ImageSegmentationPipeline extends Pipeline{constructor(a){super(a),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(a,{threshold:l=.5,mask_threshold:A=.5,overlap_mask_area_threshold:O=.8,label_ids_to_fuse:Y=null,target_sizes:R=null,subtask:ee=null}={}){if(Array.isArray(a)&&a.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const ne=await prepareImages(a),te=ne.map(tt=>[tt.height,tt.width]),{pixel_values:f,pixel_mask:d}=await this.processor(ne),H=await this.model({pixel_values:f,pixel_mask:d});let Z=null;if(ee!==null)Z=this.subtasks_mapping[ee];else for(let[tt,nt]of Object.entries(this.subtasks_mapping))if(nt in this.processor.feature_extractor){Z=this.processor.feature_extractor[nt].bind(this.processor.feature_extractor),ee=tt;break}const Ye=this.model.config.id2label,et=[];if(ee==="panoptic"||ee==="instance"){const tt=Z(H,l,A,O,Y,R??te)[0],nt=tt.segmentation;for(const it of tt.segments_info){const ot=new Uint8ClampedArray(nt.data.length);for(let at=0;at<nt.data.length;++at)nt.data[at]===it.id&&(ot[at]=255);const st=new RawImage(ot,nt.dims[1],nt.dims[0],1);et.push({score:it.score,label:Ye[it.label_id],mask:st})}}else if(ee==="semantic"){const{segmentation:tt,labels:nt}=Z(H,R??te)[0];for(const it of nt){const ot=new Uint8ClampedArray(tt.data.length);for(let at=0;at<tt.data.length;++at)tt.data[at]===it&&(ot[at]=255);const st=new RawImage(ot,tt.dims[1],tt.dims[0],1);et.push({score:null,label:Ye[it],mask:st})}}else throw Error(`Subtask ${ee} not supported.`);return et}}class ZeroShotImageClassificationPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l,{hypothesis_template:A="This is a photo of {}"}={}){const O=Array.isArray(a),Y=await prepareImages(a),R=l.map(d=>A.replace("{}",d)),ee=this.tokenizer(R,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:xe}=await this.processor(Y),ne=await this.model({...ee,pixel_values:xe}),te=this.model.config.model_type==="siglip"?d=>d.sigmoid().data:d=>softmax(d.data),f=[];for(const d of ne.logits_per_image){const Z=[...te(d)].map((Ye,et)=>({score:Ye,label:l[et]}));Z.sort((Ye,et)=>et.score-Ye.score),f.push(Z)}return O?f:f[0]}}class ObjectDetectionPipeline extends Pipeline{constructor(a){super(a)}async _call(a,{threshold:l=.9,percentage:A=!1}={}){const O=Array.isArray(a);if(O&&a.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Y=await prepareImages(a),R=A?null:Y.map(H=>[H.height,H.width]),{pixel_values:ee,pixel_mask:xe}=await this.processor(Y),ne=await this.model({pixel_values:ee,pixel_mask:xe}),te=this.processor.feature_extractor.post_process_object_detection(ne,l,R),f=this.model.config.id2label,d=te.map(H=>H.boxes.map((Z,Ye)=>({score:H.scores[Ye],label:f[H.classes[Ye]],box:get_bounding_box(Z,!A)})));return O?d:d[0]}}class ZeroShotObjectDetectionPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l,{threshold:A=.1,topk:O=null,percentage:Y=!1}={}){const R=Array.isArray(a),ee=await prepareImages(a),xe=this.tokenizer(l,{padding:!0,truncation:!0}),ne=await this.processor(ee),te=[];for(let f=0;f<ee.length;++f){const d=ee[f],H=Y?null:[[d.height,d.width]],Z=ne.pixel_values[f].unsqueeze_(0),Ye=await this.model({...xe,pixel_values:Z}),et=this.processor.feature_extractor.post_process_object_detection(Ye,A,H,!0)[0];let tt=et.boxes.map((nt,it)=>({score:et.scores[it],label:l[et.classes[it]],box:get_bounding_box(nt,!Y)})).sort((nt,it)=>it.score-nt.score);O!==null&&(tt=tt.slice(0,O)),te.push(tt)}return R?te:te[0]}}class DocumentQuestionAnsweringPipeline extends Pipeline{constructor(a){super(a)}async _call(a,l,A={}){const O=(await prepareImages(a))[0],{pixel_values:Y}=await this.processor(O),R=`<s_docvqa><s_question>${l}</s_question><s_answer>`,ee=this.tokenizer(R,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,xe=await this.model.generate(Y,{...A,decoder_input_ids:ee,max_length:this.model.config.decoder.max_position_embeddings}),te=this.tokenizer.batch_decode(xe)[0].match(/<s_answer>(.*?)<\/s_answer>/);let f=null;return te&&te.length>=2&&(f=te[1].trim()),[{answer:f}]}}class TextToAudioPipeline extends Pipeline{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(a){super(a),this.vocoder=a.vocoder??null}async _call(a,{speaker_embeddings:l=null}={}){return this.processor?this._call_text_to_spectrogram(a,{speaker_embeddings:l}):this._call_text_to_waveform(a)}async _call_text_to_waveform(a){const l=this.tokenizer(a,{padding:!0,truncation:!0}),{waveform:A}=await this.model(l),O=this.model.config.sampling_rate;return{audio:A.data,sampling_rate:O}}async _call_text_to_spectrogram(a,{speaker_embeddings:l}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),(typeof l=="string"||l instanceof URL)&&(l=new Float32Array(await(await fetch(l)).arrayBuffer())),l instanceof Float32Array)l=new Tensor("float32",l,[1,l.length]);else if(!(l instanceof Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");const{input_ids:A}=this.tokenizer(a,{padding:!0,truncation:!0}),{waveform:O}=await this.model.generate_speech(A,l,{vocoder:this.vocoder}),Y=this.processor.feature_extractor.config.sampling_rate;return{audio:O.data,sampling_rate:Y}}}class ImageToImagePipeline extends Pipeline{constructor(a){super(a)}async _call(a){const l=await prepareImages(a),A=await this.processor(l),O=await this.model(A),Y=[];for(const R of O.reconstruction){const ee=R.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Y.push(RawImage.fromTensor(ee))}return Y.length>1?Y:Y[0]}}class DepthEstimationPipeline extends Pipeline{constructor(a){super(a)}async _call(a){const l=await prepareImages(a),A=await this.processor(l),{predicted_depth:O}=await this.model(A),Y=[];for(let R=0;R<l.length;++R){const ee=interpolate(O[R],l[R].size.reverse(),"bilinear",!1),xe=ee.mul_(255/max(ee.data)[0]).to("uint8");Y.push({predicted_depth:O[R],depth:RawImage.fromTensor(xe)})}return Y.length>1?Y:Y[0]}}const SUPPORTED_TASKS=Object.freeze({"text-classification":{tokenizer:AutoTokenizer,pipeline:TextClassificationPipeline,model:AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:AutoTokenizer,pipeline:TokenClassificationPipeline,model:AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:AutoTokenizer,pipeline:QuestionAnsweringPipeline,model:AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:AutoTokenizer,pipeline:FillMaskPipeline,model:AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:AutoTokenizer,pipeline:SummarizationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:AutoTokenizer,pipeline:TranslationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:AutoTokenizer,pipeline:Text2TextGenerationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:AutoTokenizer,pipeline:TextGenerationPipeline,model:AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotClassificationPipeline,model:AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:AudioClassificationPipeline,model:AutoModelForAudioClassification,processor:AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotAudioClassificationPipeline,model:AutoModel,processor:AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:AutoTokenizer,pipeline:AutomaticSpeechRecognitionPipeline,model:[AutoModelForSpeechSeq2Seq,AutoModelForCTC],processor:AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:AutoTokenizer,pipeline:TextToAudioPipeline,model:[AutoModelForTextToWaveform,AutoModelForTextToSpectrogram],processor:[AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:AutoTokenizer,pipeline:ImageToTextPipeline,model:AutoModelForVision2Seq,processor:AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:ImageClassificationPipeline,model:AutoModelForImageClassification,processor:AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ImageSegmentationPipeline,model:[AutoModelForImageSegmentation,AutoModelForSemanticSegmentation],processor:AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotImageClassificationPipeline,model:AutoModel,processor:AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:ObjectDetectionPipeline,model:AutoModelForObjectDetection,processor:AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:AutoTokenizer,pipeline:ZeroShotObjectDetectionPipeline,model:AutoModelForZeroShotObjectDetection,processor:AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:AutoTokenizer,pipeline:DocumentQuestionAnsweringPipeline,model:AutoModelForDocumentQuestionAnswering,processor:AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:ImageToImagePipeline,model:AutoModelForImageToImage,processor:AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:DepthEstimationPipeline,model:AutoModelForDepthEstimation,processor:AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:AutoTokenizer,pipeline:FeatureExtractionPipeline,model:AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:AutoProcessor,pipeline:ImageFeatureExtractionPipeline,model:[AutoModelForImageFeatureExtraction,AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),TASK_ALIASES=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function pipeline(g,a=null,{quantized:l=!0,progress_callback:A=null,config:O=null,cache_dir:Y=null,local_files_only:R=!1,revision:ee="main",model_file_name:xe=null}={}){g=TASK_ALIASES[g]??g;const ne=SUPPORTED_TASKS[g.split("_",1)[0]];if(!ne)throw Error(`Unsupported pipeline: ${g}. Must be one of [${Object.keys(SUPPORTED_TASKS)}]`);a||(a=ne.default.model,console.log(`No model specified. Using default model: "${a}".`));const te={quantized:l,progress_callback:A,config:O,cache_dir:Y,local_files_only:R,revision:ee,model_file_name:xe},f=new Map([["tokenizer",ne.tokenizer],["model",ne.model],["processor",ne.processor]]),d=await loadItems(f,a,te);d.task=g,dispatchCallback(A,{status:"ready",task:g,model:a});const H=ne.pipeline;return new H(d)}async function loadItems(g,a,l){const A=Object.create(null),O=[];for(let[Y,R]of g.entries()){if(!R)continue;let ee;Array.isArray(R)?ee=new Promise(async(xe,ne)=>{let te;for(let f of R){if(f===null){xe(null);return}try{xe(await f.from_pretrained(a,l));return}catch(d){te=d}}ne(te)}):ee=R.from_pretrained(a,l),A[Y]=ee,O.push(ee)}await Promise.all(O);for(let[Y,R]of Object.entries(A))A[Y]=await R;return A}var MLModel=(g=>(g.ZERO_SHOT_CLASSIFICATION="Xenova/distilbert-base-uncased-mnli",g.FEATURE_EXTRACTION="Xenova/all-MiniLM-L6-v2",g.TEXT_CLASSIFICATION="Xenova/distilbert-base-uncased-finetuned-sst-2-english",g.QUESTION_ANSWERING="Xenova/distilbert-base-cased-distilled-squad",g.SUMMARIZATION="Xenova/distilbart-cnn-6-6",g.TRANSLATION_EN_FR="Xenova/opus-mt-en-fr",g.FILL_MASK="Xenova/distilbert-base-uncased",g.SENTENCE_SIMILARITY="Xenova/all-MiniLM-L6-v2",g.TOKEN_CLASSIFICATION="Xenova/distilbert-base-uncased-finetuned-conll03-english",g.IMAGE_CLASSIFICATION="Xenova/vit-base-patch16-224",g.OBJECT_DETECTION="Xenova/detr-resnet-50",g.AUTOMATIC_SPEECH_RECOGNITION="Xenova/whisper-tiny",g.AUDIO_CLASSIFICATION="Xenova/wav2vec2-base",g))(MLModel||{}),MLTask=(g=>(g.ZERO_SHOT_CLASSIFICATION="zero-shot-classification",g.FEATURE_EXTRACTION="feature-extraction",g.TEXT_CLASSIFICATION="text-classification",g.SENTIMENT_ANALYSIS="sentiment-analysis",g.QUESTION_ANSWERING="question-answering",g.SUMMARIZATION="summarization",g.TRANSLATION="translation",g.FILL_MASK="fill-mask",g.SENTENCE_SIMILARITY="sentence-similarity",g.TOKEN_CLASSIFICATION="token-classification",g.IMAGE_CLASSIFICATION="image-classification",g.OBJECT_DETECTION="object-detection",g.AUTOMATIC_SPEECH_RECOGNITION="automatic-speech-recognition",g.AUDIO_CLASSIFICATION="audio-classification",g.IMAGE_TO_TEXT="image-to-text",g.TEXT_TO_IMAGE="text-to-image",g.IMAGE_SEGMENTATION="image-segmentation",g.DEPTH_ESTIMATION="depth-estimation",g))(MLTask||{});function getModelForTask(g){switch(g){case"zero-shot-classification":return"Xenova/distilbert-base-uncased-mnli";case"feature-extraction":return"Xenova/all-MiniLM-L6-v2";case"text-classification":case"sentiment-analysis":return"Xenova/distilbert-base-uncased-finetuned-sst-2-english";case"question-answering":return"Xenova/distilbert-base-cased-distilled-squad";case"summarization":return"Xenova/distilbart-cnn-6-6";case"translation":return"Xenova/opus-mt-en-fr";case"fill-mask":return"Xenova/distilbert-base-uncased";case"sentence-similarity":return"Xenova/all-MiniLM-L6-v2";case"token-classification":return"Xenova/distilbert-base-uncased-finetuned-conll03-english";case"image-classification":return"Xenova/vit-base-patch16-224";case"object-detection":return"Xenova/detr-resnet-50";case"automatic-speech-recognition":return"Xenova/whisper-tiny";case"audio-classification":return"Xenova/wav2vec2-base";default:return null}}const logger$6=createLogger("InBrowserMLService");class InBrowserMLService{constructor(){this.pipelines=new Map,this.loadingPipelines=new Set,env$1.allowRemoteModels=!0,env$1.allowLocalModels=!1,env$1.remoteHost="https://huggingface.co"}static getInstance(){return InBrowserMLService.instance||(InBrowserMLService.instance=new InBrowserMLService),InBrowserMLService.instance}setAuthToken(a){a&&a.trim()?(env$1.useAuthToken=a.trim(),logger$6.info("Hugging Face token set for authenticated model access")):env$1.useAuthToken=null}async getPipeline(a,l,A={}){if(!l&&typeof a!="string"){const ee=getModelForTask(a);ee&&(l=ee)}const O=a,Y=l,R=`${O}:${Y}`;if(this.pipelines.has(R))return this.pipelines.get(R);if(this.loadingPipelines.has(R)){for(;this.loadingPipelines.has(R);)await new Promise(ee=>setTimeout(ee,100));return this.pipelines.get(R)}this.loadingPipelines.add(R);try{logger$6.info(`Loading transformers.js pipeline: ${O} with model ${Y}...`);const ee=await pipeline(O,Y,{quantized:!0,...A});return this.pipelines.set(R,ee),logger$6.info(`Pipeline ${R} loaded successfully`),ee}catch(ee){const xe=ee instanceof Error?ee.message:String(ee);throw logger$6.error(`Failed to load pipeline ${R}: ${xe}`),ee}finally{this.loadingPipelines.delete(R)}}clearPipeline(a,l){const Y=`${a}:${l}`;this.pipelines.delete(Y)}clearAllPipelines(){this.pipelines.clear()}}const inBrowserMLService=InBrowserMLService.getInstance(),logger$5=createLogger("ToolDetector");class ToolDetector{constructor(){this.classifier=null,this.loading=!1,this.loadPromise=null}async ensureLoaded(){if(!this.classifier)return this.loading&&this.loadPromise?this.loadPromise:(this.loading=!0,this.loadPromise=(async()=>{try{logger$5.info("Loading ML model for tool detection..."),this.classifier=await inBrowserMLService.getPipeline(MLTask.ZERO_SHOT_CLASSIFICATION,MLModel.ZERO_SHOT_CLASSIFICATION,{quantized:!0}),logger$5.info("ML model loaded successfully - will use for tool detection")}catch(a){const l=a instanceof Error?a.message:String(a);logger$5.warn(`Failed to load ML model, will use keyword-based detection fallback: ${l}`),this.classifier=null}finally{this.loading=!1}})(),this.loadPromise)}async needsTools(a){if(!a||a.trim().length===0)return!1;const l=a.toLowerCase().trim();if(["hello","hi","hey","thanks","thank you","bye","goodbye"].some(Y=>l===Y||l.startsWith(Y+" ")))return!1;try{if(await this.ensureLoaded(),this.classifier){logger$5.info(`Using ML model to classify prompt: "${l.substring(0,50)}${l.length>50?"...":""}"`);const Y=await this.classifier(l,["requires executing commands or actions","is a simple greeting or question"]),R=Y.labels[0]==="requires executing commands or actions"&&Y.scores[0]>.6;return logger$5.info(`ML classification result: ${Y.labels[0]} (confidence: ${(Y.scores[0]*100).toFixed(1)}%) - needsTools: ${R}`),R}}catch(Y){const R=Y instanceof Error?Y.message:String(Y);logger$5.warn(`ML classification failed, using keyword fallback: ${R}`)}logger$5.info("Using keyword-based detection (ML model not available)");const O=this.keywordBasedDetection(l);return logger$5.info(`Keyword detection result: needsTools=${O}`),O}keywordBasedDetection(a){const l=["create","open","delete","read","write","edit","save","rename","move","copy","list","show","display","run","execute","build","add","remove","update","modify","change","set","get","find","search","filter","sort","install","uninstall","load","import","export","generate","make","do","perform","call","invoke"],A=["file","folder","directory","workspace","editor","map","layer","command","tool","extension","script","code","project"],O=l.some(R=>a.includes(R)),Y=A.some(R=>a.includes(R));return O&&(Y||a.length>20)}dispose(){this.classifier=null,this.loading=!1,this.loadPromise=null}}const toolDetector=new ToolDetector;class PromptBuilder{constructor(){this.toolRegistry=new ToolRegistry,this.enhancers=[]}addEnhancer(a){this.enhancers.push(a)}async getSysPrompt(a,l){let A=a.sysPrompt;if(typeof A=="function"&&(A=A()),!A||typeof A!="string")throw new Error(`Agent "${a.role}" (${a.label}) is missing a system prompt. All agents must provide a sysPrompt.`);const O=[...a.promptEnhancers||[],...this.enhancers,...this.getContributedEnhancers()].sort((R,ee)=>(ee.priority||0)-(R.priority||0));let Y=A;for(const R of O)try{Y=await R.enhance(Y,l),(!Y||typeof Y!="string")&&(Y=A)}catch(ee){console.warn("[PromptBuilder] Enhancer failed:",ee)}return Y}rewriteChatHistoryForAgent(a,l){return a.map(A=>A.role==="user"?{role:A.role,content:A.content}:A.role===l?{role:"assistant",content:A.content}:{role:"user",content:`***Agent '${A.role}' replied:***
${A.content}`})}getContributedEnhancers(){return contributionRegistry.getContributions(CID_PROMPT_ENHANCERS).map(l=>({...l.enhancer,priority:l.priority??l.enhancer.priority}))}async build(a,l,A,O){O?.beforeSend&&await O.beforeSend(l,A);const Y=this.sanitizeMessagesForAPI(l),R=this.rewriteChatHistoryForAgent(Y,a.role);let ee=a.tools;typeof ee=="function"&&(ee=await ee());let xe;if(ee?.enabled)if(ee.smartToolDetection){const d=l[l.length-1]?.content||"";await toolDetector.needsTools(d)&&(xe=this.toolRegistry.getAvailableTools(A,ee.commandFilter))}else xe=this.toolRegistry.getAvailableTools(A,ee.commandFilter);const ne=await this.getSysPrompt(a,A);R.unshift({role:"system",content:ne});const te=R.length-1;return{messages:R,userPromptIndex:te,tools:xe}}sanitizeMessageForAPI(a){const l={role:a.role,content:a.content};return"tool_call_id"in a&&a.tool_call_id&&(l.tool_call_id=a.tool_call_id),"tool_calls"in a&&a.tool_calls&&(l.tool_calls=a.tool_calls),l}sanitizeMessagesForAPI(a){return a.map(l=>this.sanitizeMessageForAPI(l))}}class MessageProcessorService{constructor(){this.processors=[]}addProcessor(a){this.processors.push(a)}getSortedProcessors(){return[...this.processors].sort((a,l)=>(l.priority||0)-(a.priority||0))}async process(a,l,A){let O={...a};const Y=[...l.messageProcessors||[],...this.processors].sort((ee,xe)=>(xe.priority||0)-(ee.priority||0));for(const ee of Y)O=await ee.process(O,A);const R=O.actions?.some(ee=>ee.requiresAttention)||O.attentionRequests?.some(ee=>ee.requiresAction)||!1;return{...O,requiresAttention:R}}checkRequiresAttention(a){return a.actions?.some(l=>l.requiresAttention)||a.attentionRequests?.some(l=>l.requiresAction)||!1}}class ToolCallAccumulator{constructor(){this.accumulatedToolCalls=new Map,this.toolCallIndexMap=new Map}processChunk(a){if(a.type==="token"&&a.toolCalls&&a.toolCalls.length>0)for(const l of a.toolCalls){const A=l._index,O=l.id;let Y,R;if(A!==void 0&&this.toolCallIndexMap.has(A)?(R=this.toolCallIndexMap.get(A),Y=this.accumulatedToolCalls.get(R)):O&&this.accumulatedToolCalls.has(O)?(R=O,Y=this.accumulatedToolCalls.get(R)):(R=O||`call_${A!==void 0?A:Date.now()}_${Math.random()}`,Y=void 0),Y){const ee=Y.function.arguments||"",xe=l.function.arguments||"",ne=ee+xe;this.accumulatedToolCalls.set(R,{id:R,type:l.type||Y.type,function:{name:l.function.name||Y.function.name,arguments:ne}}),A!==void 0&&!this.toolCallIndexMap.has(A)&&this.toolCallIndexMap.set(A,R)}else this.accumulatedToolCalls.set(R,{...l,id:R}),A!==void 0&&this.toolCallIndexMap.set(A,R)}}getFinalToolCalls(){return Array.from(this.accumulatedToolCalls.values()).filter(a=>a.function.name&&a.function.name.trim().length>0).map(a=>{let l=a.function.arguments||"";return(!l||l.trim()==="")&&(l="{}"),{...a,function:{...a.function,arguments:l}}})}reset(){this.accumulatedToolCalls.clear(),this.toolCallIndexMap.clear()}}class ToolExecutor{sanitizeFunctionName(a){return a.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}findCommand(a,l){const A=a.function.name,O=commandRegistry.getCommand(A);if(O)return O;const Y=commandRegistry.listCommands();for(const[R,ee]of Object.entries(Y))if(this.sanitizeFunctionName(R)===A)return ee;return null}parseArguments(a){if(!a||a.trim()===""||a==="{}")return{};try{const l=JSON.parse(a);return l&&typeof l=="object"?l:{}}catch(l){const A=l instanceof Error?l.message:String(l);return console.error(`[ToolExecutor] Failed to parse arguments: ${a} - ${A}`),{}}}sanitizeArguments(a,l){if(!l||!l.parameters||!a||typeof a!="object")return a||{};const A={};return l.parameters.forEach(O=>{const Y=this.sanitizeFunctionName(O.name);Y in a&&(A[O.name]=a[Y])}),A}async executeToolCall(a,l){try{const A=this.findCommand(a,l),O=A?.id||a.function.name,Y=a.function.arguments||"{}",R=this.parseArguments(Y),ee=this.sanitizeArguments(R,A),xe=commandRegistry.createExecutionContext(ee),ne={...l,...xe,params:ee};let te=await commandRegistry.execute(O,ne);const d={success:!0,message:`Command "${A?.name||O}" executed successfully`,command:O};if(ee&&typeof ee=="object"&&Object.keys(ee).length>0&&(d.parameters=ee),te){let H=te;if(H instanceof Promise&&(H=await H),d.result=H,A?.output&&A.output.length>0){const Z=A.output.map(Ye=>`${Ye.name}: ${Ye.description||Ye.type||"value"}`).join(", ");d.output=Z}}return{id:a.id,result:d}}catch(A){const O=A instanceof Error?A.message:String(A);let Y=null;try{Y=this.findCommand(a,l)}catch{Y=null}const R=Y?.name||a.function.name;let ee=O;return O.includes("No handler found")||O.includes("No handlers registered")?ee=`Command "${R}" cannot be executed. ${O}. This usually means the command is not available in the current context (e.g., a map editor may not be open or active).`:(O.includes("not available")||O.includes("GsMapEditor"))&&(ee=`Command "${R}" cannot be executed: ${O}. Please ensure the required editor or component is open and active.`),{id:a.id,result:null,error:ee}}}async executeToolCalls(a,l){const A=[];for(const O of a){const Y=await this.executeToolCall(O,l);A.push(Y)}return A}createToolCallAccumulator(){return new ToolCallAccumulator}createToolCallSignature(a){const l=a.function.arguments||"{}";let A={};try{const Y=JSON.parse(l);A=Y&&typeof Y=="object"?Y:{}}catch{A={}}const O=A&&typeof A=="object"?Object.keys(A).sort().reduce((Y,R)=>(Y[R]=A[R],Y),{}):{};return`${a.function.name}:${JSON.stringify(O)}`}}const toolExecutor=Object.freeze(Object.defineProperty({__proto__:null,ToolExecutor},Symbol.toStringTag,{value:"Module"}));class ParallelWorkflowStrategy{async execute(a,l,A,O){const Y=l.chatConfig;if(!Y)throw new Error("Chat config is required");const R=a.map(async ee=>{try{await O(ee,l.chatContext.history,A.sharedState,Y,l,A)}catch(xe){const ne=xe instanceof Error?xe:new Error(String(xe));A.errors.set(ee.role,ne),l.onAgentError?.(ee.role,ne)}});await Promise.all(R)}}class SequentialWorkflowStrategy{async execute(a,l,A,O){const Y=l.chatConfig;if(!Y)throw new Error("Chat config is required");let R=[...l.chatContext.history],ee={...A.sharedState};for(const xe of a)try{const ne=this.createAgentContextWithPreviousAgents(ee,l,A),te=await O(xe,R,ee,Y,l,A);if(!te)break;const f=this.updateWorkflowState(te,R,ee,ne,A);R=f.currentMessages,ee=f.accumulatedState}catch(ne){const te=ne instanceof Error?ne:new Error(String(ne));A.errors.set(xe.role,te),l.onAgentError?.(xe.role,te);break}}createAgentContextWithPreviousAgents(a,l,A){return{...a,...l.callContext.getProxy(),previousAgents:Array.from(A.messages.entries()).map(([O,Y])=>({role:O,content:Y.content}))}}updateWorkflowState(a,l,A,O,Y){return l.push(a),A={...A,...O,message:a},Y.sharedState=A,{currentMessages:l,accumulatedState:A}}}class ConditionalWorkflowStrategy{async execute(a,l,A,O){const Y=l.chatConfig;if(!Y)throw new Error("Chat config is required");let R=[...l.chatContext.history],ee={...A.sharedState};for(const xe of a)try{const ne=this.createAgentContextWithPreviousAgents(ee,l,A);if(xe.canHandle&&!xe.canHandle(ne))continue;const te=await O(xe,R,ee,Y,l,A);if(!te)break;const f=this.updateWorkflowState(te,R,ee,ne,A);R=f.currentMessages,ee=f.accumulatedState}catch(ne){const te=ne instanceof Error?ne:new Error(String(ne));A.errors.set(xe.role,te),l.onAgentError?.(xe.role,te)}}createAgentContextWithPreviousAgents(a,l,A){return{...a,...l.callContext.getProxy(),previousAgents:Array.from(A.messages.entries()).map(([O,Y])=>({role:O,content:Y.content}))}}updateWorkflowState(a,l,A,O,Y){return l.push(a),A={...A,...O,message:a},Y.sharedState=A,{currentMessages:l,accumulatedState:A}}}class WorkflowEngine{constructor(){this.strategies=new Map([["parallel",new ParallelWorkflowStrategy],["sequential",new SequentialWorkflowStrategy],["conditional",new ConditionalWorkflowStrategy]])}registerStrategy(a,l){this.strategies.set(a,l)}async execute(a,l,A){const O=`workflow-${Date.now()}-${Math.random()}`,Y=l.execution||"parallel",R=l.sharedState||{},ee={messages:new Map,sharedState:{...R},errors:new Map};publish(TOPIC_AGENT_WORKFLOW_STARTED,{workflowId:O,options:l});try{const xe=this.strategies.get(Y);if(!xe)throw new Error(`Unknown workflow execution strategy: ${Y}`);return await xe.execute(a,l,ee,A),publish(TOPIC_AGENT_WORKFLOW_COMPLETE,{workflowId:O,results:ee}),ee}catch(xe){const ne=xe instanceof Error?xe:new Error(String(xe));throw publish(TOPIC_AGENT_WORKFLOW_ERROR,{workflowId:O,error:ne}),ne}}}const Gr=class Gr{static estimateTokens(a){if(!a||a.trim().length===0)return 0;const l=a.trim(),A=l.length,O=l.split(/\s+/).filter(R=>R.length>0).length,Y=Math.ceil(A/this.AVERAGE_CHARS_PER_TOKEN+O*.3);return Math.max(1,Y)}static estimateMessageTokens(a){let l=this.MESSAGE_OVERHEAD;if(a.content&&(l+=this.estimateTokens(a.content)),a.role&&(l+=this.estimateTokens(a.role)),a.tool_calls)for(const A of a.tool_calls)l+=this.estimateTokens(A.function.name||""),l+=this.estimateTokens(A.function.arguments||"{}"),l+=10;return a.tool_call_id&&(l+=this.estimateTokens(a.tool_call_id)),l}static estimatePromptTokens(a,l){let A=0;for(const O of a)A+=this.estimateMessageTokens(O);if(l&&l.length>0){for(const O of l)if(A+=this.TOOL_DEFINITION_OVERHEAD,A+=this.estimateTokens(O.function.name||""),A+=this.estimateTokens(O.function.description||""),O.function.parameters){const Y=JSON.stringify(O.function.parameters);A+=this.estimateTokens(Y)}}return A}static estimateCompletionTokens(a,l){let A=this.estimateTokens(a);if(l&&l.length>0)for(const O of l)A+=10,A+=this.estimateTokens(O.function?.name||""),A+=this.estimateTokens(O.function?.arguments||"{}");return A}};Gr.AVERAGE_CHARS_PER_TOKEN=4,Gr.TOOL_DEFINITION_OVERHEAD=50,Gr.MESSAGE_OVERHEAD=4;let TokenEstimator=Gr;const TOKEN_USAGE_KEY="ai_token_usage";class TokenUsageTracker{constructor(){this.data=null,this.loadPromise=null}async loadData(){return this.data?this.data:this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{const a=await persistenceService.getObject(TOKEN_USAGE_KEY);return a?this.data=a:(this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()),this.loadPromise=null,this.data})(),this.loadPromise)}async saveData(){this.data&&(this.data.lastUpdated=Date.now(),await persistenceService.persistObject(TOKEN_USAGE_KEY,this.data))}async recordUsage(a,l){if(await this.loadData(),!this.data)return;this.data.providers[a]||(this.data.providers[a]={promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0});const A=this.data.providers[a];A.promptTokens+=l.promptTokens,A.completionTokens+=l.completionTokens,A.totalTokens+=l.totalTokens,A.requestCount+=1,this.data.total.promptTokens+=l.promptTokens,this.data.total.completionTokens+=l.completionTokens,this.data.total.totalTokens+=l.totalTokens,this.data.total.requestCount+=1,await this.saveData()}async getProviderUsage(a){return await this.loadData(),this.data?.providers[a]||null}async getAllProviderUsage(){return await this.loadData(),this.data?.providers||{}}async getTotalUsage(){return await this.loadData(),this.data?.total||{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0}}async reset(){this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()}async resetProvider(a){if(await this.loadData(),!this.data)return;const l=this.data.providers[a];l&&(this.data.total.promptTokens-=l.promptTokens,this.data.total.completionTokens-=l.completionTokens,this.data.total.totalTokens-=l.totalTokens,this.data.total.requestCount-=l.requestCount,delete this.data.providers[a],await this.saveData())}}const tokenUsageTracker=new TokenUsageTracker;class AIService{constructor(){this.activeRequests=new Map,this.providerFactory=new ProviderFactory,this.agentRegistry=new AgentRegistry,this.promptBuilder=new PromptBuilder,this.messageProcessor=new MessageProcessorService,this.toolExecutor=new ToolExecutor,this.workflowEngine=new WorkflowEngine,this.toolRegistry=new ToolRegistry,subscribe(TOPIC_SETTINGS_CHANGED,()=>{this.aiConfig=void 0,this.configCheckPromise=void 0,this.checkAIConfig().then()}),this.checkAIConfig().then()}getAgentContributions(){return this.agentRegistry.getAgentContributions()}async getProviders(){return await this.checkAIConfig(),this.aiConfig?.providers||[]}async getDefaultProvider(){await this.checkAIConfig();const a=await this.getProviders();if(this.aiConfig?.defaultProvider){const l=a.find(A=>A.name===this.aiConfig?.defaultProvider);if(l)return l}return a[0]}async setDefaultProvider(a){return await this.checkAIConfig(),this.aiConfig&&(this.aiConfig.defaultProvider=a,await appSettings.set(KEY_AI_CONFIG,this.aiConfig)),this.getDefaultProvider()}createMessage(a){return{role:"user",content:a}}registerStreamingFetcher(a){this.providerFactory.registerProvider(a)}getContributedProviders(){return contributionRegistry.getContributions(CID_CHAT_PROVIDERS).map(l=>l.provider)}mergeProviders(a,l){const A=new Set(a.map(Y=>Y.name)),O=l.filter(Y=>!A.has(Y.name));return O.length>0?[...a,...O]:a}async createInitialConfig(){const a=this.getContributedProviders(),l={...AI_CONFIG_TEMPLATE,providers:a};return await appSettings.set(KEY_AI_CONFIG,l),await appSettings.get(KEY_AI_CONFIG)}async updateConfigWithMissingProviders(a){const l=this.getContributedProviders(),A=this.mergeProviders(a.providers,l);if(A.length!==a.providers.length){const O={...a,providers:A};return await appSettings.set(KEY_AI_CONFIG,O),O}return a}async checkAIConfig(){if(!this.aiConfig)return this.configCheckPromise?this.configCheckPromise:(this.configCheckPromise=this.performConfigCheck(),this.configCheckPromise)}async performConfigCheck(){try{this.aiConfig=await appSettings.get(KEY_AI_CONFIG),this.aiConfig?this.aiConfig=await this.updateConfigWithMissingProviders(this.aiConfig):this.aiConfig=await this.createInitialConfig(),publish(TOPIC_AICONFIG_CHANGED,this.aiConfig)}finally{this.configCheckPromise=void 0}}createAgentContext(a,l,A={}){return{...a,...l.getProxy(),...A}}createFinalMessage(a,l){return{role:a.role,content:l.content,actions:l.actions,requiresAttention:l.requiresAttention,attentionRequests:l.attentionRequests,canContinue:l.canContinue}}async handleUserAttention(a,l,A,O){if(!l.requiresAttention||!A.userAttentionHandler)return!0;const Y=[];if(l.attentionRequests&&Y.push(...l.attentionRequests),l.actions)for(const xe of l.actions)xe.requiresAttention&&xe.attentionRequest&&Y.push(xe.attentionRequest);if(Y.length===0)return!0;if(O.pendingAttention||(O.pendingAttention=new Map),O.pendingAttention.set(a,Y),A.onAttentionRequest)for(const xe of Y)A.onAttentionRequest(a,xe);if(A.pauseOnAttention)return O.paused=!0,O.continuationToken=`${a}-${Date.now()}-${Math.random()}`,!1;const R=A.userAttentionHandler,ee=this.createAgentContext(A.sharedState||{},A.callContext,{message:l});for(const xe of Y)if(R.onAttentionRequest){const ne=await R.onAttentionRequest(xe,ee);if(xe.requiresAction&&(ne===!1||ne===null))return!1;ne&&typeof ne=="string"&&(ee[`attention_${xe.type}_result`]=ne)}else switch(xe.type){case"confirmation":if(R.onConfirmation&&!await R.onConfirmation(xe.message,ee)&&xe.requiresAction)return!1;break;case"input":if(R.onInput){const ne=await R.onInput(xe.message,void 0,ee);if(!ne&&xe.requiresAction)return!1;ne&&(ee.attention_input_result=ne)}break}return!0}async*streamCompletion(a){const l=`${Date.now()}-${Math.random()}`,A=new AbortController;this.activeRequests.set(l,A),a.signal&&a.signal.addEventListener("abort",()=>{A.abort()});const O=a.signal||A.signal;try{a.onStatus?.("starting"),publish(TOPIC_AI_STREAM_STARTED,{requestId:l,options:a});const Y=a.chatConfig||await this.getDefaultProvider(),R=this.sanitizeMessagesForAPI(a.chatContext.history),ee=this.providerFactory.getProvider(Y),xe=this.toolExecutor.createToolCallAccumulator();let ne="",te={role:"assistant",content:""},f;for await(const Z of ee.stream({model:Y.model,messages:R,chatConfig:Y,tools:a.tools,signal:O})){if(Z.type==="error"){a.onStatus?.("error"),publish(TOPIC_AI_STREAM_ERROR,{requestId:l,chunk:Z}),yield Z;break}if(Z.type==="token")xe.processChunk(Z),(!Z.toolCalls||Z.toolCalls.length===0)&&(ne+=Z.content,te.content=ne),Z.message?.role&&(te.role=Z.message.role),Z.content&&a.onToken?.(Z.content),a.onStatus?.("streaming"),a.onProgress?.({received:ne.length}),publish(TOPIC_AI_STREAM_CHUNK,{requestId:l,chunk:Z}),yield Z;else if(Z.type==="done"){Z.metadata?.usage&&(f=Z.metadata.usage),a.onStatus?.("complete"),publish(TOPIC_AI_STREAM_COMPLETE,{requestId:l}),yield Z;break}else yield Z}const d=xe.getFinalToolCalls(),H={role:te.role||"assistant",content:ne||"",...d.length>0&&{toolCalls:d}};if(!f){const Z=TokenEstimator.estimatePromptTokens(R,a.tools),Ye=TokenEstimator.estimateCompletionTokens(ne,d);f={promptTokens:Z,completionTokens:Ye,totalTokens:Z+Ye,estimated:!0}}return tokenUsageTracker.recordUsage(Y.name,f).catch(Z=>{defaultLogger.error(`Failed to record token usage: ${Z instanceof Error?Z.message:String(Z)}`)}),{message:H,tokenUsage:f}}catch(Y){if(Y instanceof Error&&Y.name==="AbortError")throw a.onStatus?.("error"),publish(TOPIC_AI_STREAM_ERROR,{requestId:l,error:"Request cancelled"}),Y;a.onStatus?.("error");const R=Y instanceof Error?Y.message:String(Y);throw publish(TOPIC_AI_STREAM_ERROR,{requestId:l,error:R}),yield{type:"error",content:R,metadata:{error:Y}},Y}finally{this.activeRequests.delete(l)}}async handleStreamingPromptDirect(a){const l=this.streamCompletion(a);let A;for(;;){if(A=await l.next(),A.done)return A.value.message;const O=A.value;if(O.type==="error")throw new Error(O.content);if(O.type==="done"){const Y=await l.next();if(Y.done&&Y.value)return Y.value.message;if(!Y.done)continue;throw new Error("Stream completed without return value")}}}sanitizeMessageForAPI(a){const l={role:a.role,content:a.content};return"tool_call_id"in a&&a.tool_call_id&&(l.tool_call_id=a.tool_call_id),"tool_calls"in a&&a.tool_calls&&(l.tool_calls=a.tool_calls),l}sanitizeMessagesForAPI(a){return a.map(l=>this.sanitizeMessageForAPI(l))}async handleStreamingPrompt(a){const l=a.callContext||rootContext.createChild({}),A=this.createAgentContext({},l,{userPrompt:a.chatContext.history[a.chatContext.history.length-1]?.content||""}),O=this.agentRegistry.getMatchingAgents(A),Y=O.length>0?O.map(xe=>xe.role):["assistant"],R=await this.executeAgentWorkflow({chatContext:a.chatContext,chatConfig:a.chatConfig,callContext:l,execution:"parallel",stream:a.stream,signal:a.signal,onToken:(xe,ne)=>{a.onToken?.(ne)},onStatus:(xe,ne)=>{a.onStatus?.(ne)},roles:Y}),ee=Array.from(R.messages.values());return ee.length===1?ee[0]:ee}async continueWorkflow(a,l,A){const O={sharedState:{...A.sharedState,...Object.fromEntries(l)}},Y={...A,sharedState:O.sharedState,pauseOnAttention:!1};return this.executeAgentWorkflow(Y)}cancelRequest(a){const l=this.activeRequests.get(a);return l?(l.abort(),this.activeRequests.delete(a),!0):!1}async executeAgentWorkflow(a){const l=this.createAgentContext(a.sharedState||{},a.callContext),A=this.agentRegistry.getMatchingAgents(l,a.roles);return this.workflowEngine.execute(A,a,async(O,Y,R,ee,xe,ne)=>this.executeAgent(O,Y,R,ee,xe,ne))}async executeAgent(a,l,A,O,Y,R){Y.onAgentStart?.(a.role);const ee=this.createAgentContext(A,Y.callContext,{userPrompt:l[l.length-1]?.content||""}),{messages:xe,tools:ne}=await this.promptBuilder.build(a,l,ee,a.hooks),te=xe.map(tt=>{const nt={role:tt.role,content:tt.content};return tt.tool_call_id&&(nt.tool_call_id=tt.tool_call_id),tt.tool_calls&&(nt.tool_calls=tt.tool_calls),nt});let f=await this.handleStreamingPromptDirect({chatContext:{history:te},chatConfig:O,callContext:Y.callContext,stream:Y.stream??!0,signal:Y.signal,tools:ne}),d=0;const H=[...xe];for(;f.toolCalls&&f.toolCalls.length>0;){if(d++,d>MAX_TOOL_ITERATIONS){console.warn(`[AIService] Maximum tool call iterations (${MAX_TOOL_ITERATIONS}) reached`);break}let tt=[];if(Y.requireToolApproval&&Y.onToolApprovalRequest){const ct=f.toolCalls.map(_t=>{const At=_t.function.arguments||"{}";let Et={};try{Et=JSON.parse(At)}catch{Et={}}return`${_t.function.name}(${Object.entries(Et).map(([Mt,Ot])=>`${Mt}=${Ot}`).join(", ")})`}).join(", "),ft={toolCalls:f.toolCalls,message:`The AI wants to execute: ${ct}`};await Y.onToolApprovalRequest(a.role,ft)?tt=await this.toolExecutor.executeToolCalls(f.toolCalls,ee):tt=f.toolCalls.map(_t=>({id:_t.id,result:{success:!1,message:"Tool execution cancelled by user",cancelled:!0}}))}else tt=await this.toolExecutor.executeToolCalls(f.toolCalls,ee);const nt=tt.map(ct=>({role:"tool",content:ct.error?JSON.stringify({error:ct.error}):JSON.stringify(ct.result),tool_call_id:ct.id})),it={role:"assistant",content:f.content||""};f.toolCalls&&f.toolCalls.length>0&&(it.tool_calls=f.toolCalls.filter(ct=>ct.function.name&&ct.function.name.trim().length>0).map(ct=>({id:ct.id,type:ct.type,function:{name:ct.function.name,arguments:ct.function.arguments||"{}"}}))),H.push(it,...nt);const ot=H;f=await this.handleStreamingPromptDirect({chatContext:{history:ot.map(ct=>({role:ct.role,content:ct.content,...ct.tool_call_id&&{tool_call_id:ct.tool_call_id},...ct.tool_calls&&{tool_calls:ct.tool_calls}}))},chatConfig:O,callContext:Y.callContext,stream:Y.stream??!0,signal:Y.signal,tools:ne});const st=f.content&&f.content.trim().length>0,at=f.toolCalls&&f.toolCalls.length>0;if(st&&!at)break;if(st&&at){console.warn("[AIService] Model provided content but also called tools - treating as completion");break}}const Z=await this.messageProcessor.process(f,a,this.createAgentContext(A,Y.callContext,{message:f}));a.hooks?.afterReceive&&await a.hooks.afterReceive(Z,this.createAgentContext(A,Y.callContext));const Ye=this.createFinalMessage(a,Z);return!await this.handleUserAttention(a.role,Ye,Y,R)&&Y.pauseOnAttention?null:(R.messages.set(a.role,Ye),Y.onAgentComplete?.(a.role,Ye),Ye)}}const aiService=new AIService;contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Ollama (Local)",provider:{name:"ollama",model:"gemma3:12b",chatApiEndpoint:"https://<your-server>/v1/chat/completions",apiKey:""}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"OpenWebUI (Self Hosted)",provider:{name:"openwebui",model:"gemma3:12b",chatApiEndpoint:"https://<your-server>/api/v1/chat/completion",apiKey:""}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"OpenAI",provider:{name:"openai",model:"gpt-4.1",chatApiEndpoint:"https://api.openai.com/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Groq",provider:{name:"groq",model:"llama-3.1-8b-instant",chatApiEndpoint:"https://api.groq.com/openai/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Cerebras",provider:{name:"cerebras",model:"llama3.1-8b",chatApiEndpoint:"https://api.cerebras.ai/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"WebLLM",provider:{name:"webllm",model:"gemma-2-9b-it-q4f16_1-MLC",chatApiEndpoint:"",apiKey:"",parameters:{context_window_size:4096}}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Mistral",provider:{name:"mistral",model:"mistral-large-latest",chatApiEndpoint:"https://api.mistral.ai/v1/chat/completions",apiKey:"<your api key>",ocrApiEndpoint:"https://api.mistral.ai/v1/ocr",ocrModel:"mistral-ocr-latest"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"LiteLLM",provider:{name:"litellm",model:"gpt-3.5-turbo",chatApiEndpoint:"https://<your-server>/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(SIDEBAR_MAIN,{name:"filebrowser",label:"Workspace",icon:"folder-open",component:g=>x$1`<k-filebrowser id="${g}"></k-filebrowser>`});contributionRegistry.registerContribution(SIDEBAR_AUXILIARY,{name:"aiview",label:"AI",icon:"robot",component:g=>x$1`<k-aiview id="${g}"></k-aiview>`});contributionRegistry.registerContribution("system.fastviews-bottomend",{name:"log-terminal",label:"Log Messages",icon:"list",component:g=>x$1`<k-log-terminal id="${g}"></k-log-terminal>`});contributionRegistry.registerContribution(TOOLBAR_BOTTOM,{slot:"start",label:"Workspace",html:"<k-workspace-name></k-workspace-name>"});contributionRegistry.registerContribution(TOOLBAR_BOTTOM_END,{label:"Info",icon:"circle-info",command:"show_version_info",showLabel:!0});contributionRegistry.registerContribution(TOOLBAR_BOTTOM_END,{label:"Fast Views",html:'<k-fastviews target="system.fastviews-bottomend" icon="bolt" title="Fast Views"></k-fastviews>'});const logger$4=createLogger("MarketplaceRegistry"),TOPIC_MARKETPLACE_CHANGED="events/marketplaceregistry/changed",KEY_CATALOG_URLS="marketplace.catalogUrls";class MarketplaceRegistry{constructor(){this.catalogUrls=[],this.loadingPromises=new Map,this.loadCatalogUrls().then(()=>{this.refreshCatalogs().catch(a=>{logger$4.error(`Failed to refresh catalogs on init: ${a.message}`)})}),subscribe(TOPIC_MARKETPLACE_CHANGED,()=>{this.registerMarketplaceExtensions()})}async loadCatalogUrls(){try{const a=await appSettings.get(KEY_CATALOG_URLS);this.catalogUrls=Array.isArray(a)?a:[],logger$4.debug(`Loaded ${this.catalogUrls.length} catalog URLs`)}catch(a){logger$4.error(`Failed to load catalog URLs: ${a}`),this.catalogUrls=[]}}async saveCatalogUrls(){await appSettings.set(KEY_CATALOG_URLS,this.catalogUrls),publish(TOPIC_MARKETPLACE_CHANGED,{type:"catalogs",urls:this.catalogUrls})}async addCatalogUrl(a){if(!this.isValidUrl(a))throw new Error(`Invalid catalog URL: ${a}`);if(this.catalogUrls.includes(a)){logger$4.debug(`Catalog URL already exists: ${a}`);return}this.catalogUrls.push(a),await this.saveCatalogUrls(),logger$4.info(`Added catalog URL: ${a}`);try{await this.fetchCatalog(a),this.registerMarketplaceExtensions()}catch(l){logger$4.warn(`Failed to fetch catalog immediately after adding: ${l}`)}}async removeCatalogUrl(a){const l=this.catalogUrls.indexOf(a);l!==-1&&(this.catalogUrls.splice(l,1),await this.saveCatalogUrls(),logger$4.info(`Removed catalog URL: ${a}`))}getCatalogUrls(){return[...this.catalogUrls]}isValidUrl(a){try{const l=new URL(a);return l.protocol==="http:"||l.protocol==="https:"}catch{return!1}}async fetchCatalog(a){const l=this.loadingPromises.get(a);if(l)return l;const A=(async()=>{try{logger$4.debug(`Fetching catalog from: ${a}`);const O=await fetch(a,{method:"GET",headers:{Accept:"application/json"}});if(!O.ok)throw new Error(`HTTP ${O.status}: ${O.statusText}`);const Y=await O.json();if(!Y.extensions||!Array.isArray(Y.extensions))throw new Error("Invalid catalog format: extensions array is required");const R={name:Y.name,description:Y.description,extensions:Y.extensions};return logger$4.debug(`Successfully fetched catalog from ${a}: ${R.extensions.length} extensions`),R}catch(O){throw logger$4.error(`Failed to fetch catalog from ${a}: ${O}`),O}finally{this.loadingPromises.delete(a)}})();return this.loadingPromises.set(a,A),A}async refreshCatalogs(){logger$4.info(`Refreshing ${this.catalogUrls.length} catalogs...`);const a=this.catalogUrls.map(A=>this.fetchCatalog(A).catch(O=>(logger$4.warn(`Failed to refresh catalog ${A}: ${O.message}`),null)));(await Promise.allSettled(a)).forEach((A,O)=>{A.status==="fulfilled"&&A.value&&A.value.extensions.forEach(R=>{if(!extensionRegistry.getExtensions().find(ee=>ee.id===R.id)){const ee={...R,external:!0};extensionRegistry.registerExtension(ee),logger$4.debug(`Registered marketplace extension: ${R.id}`)}})}),publish(TOPIC_MARKETPLACE_CHANGED,{type:"refreshed"}),logger$4.info("Catalog refresh completed")}registerMarketplaceExtensions(){}getMarketplaceExtensions(){return[]}getMarketplaceExtension(a){const l=extensionRegistry.getExtensions().find(A=>A.id===a);if(l&&l.external)return l}getCatalogsWithExtensions(){return[]}async installExtension(a){if(extensionRegistry.isEnabled(a.id)){logger$4.info(`Extension ${a.id} is already installed`);return}logger$4.info(`Installing marketplace extension: ${a.name} from ${a.url}`);const l={...a,external:!0};extensionRegistry.registerExtension(l),await appLoaderService.loadExtensionFromUrl(a.url),logger$4.info(`Successfully installed marketplace extension: ${a.id}`)}isMarketplaceExtension(a){const l=extensionRegistry.getExtensions().find(A=>A.id===a);return l!==void 0&&l.external===!0}}const marketplaceRegistry=new MarketplaceRegistry;rootContext.put("marketplaceRegistry",marketplaceRegistry);const logger$3=createLogger("MarketplaceCatalogContributions");marketplaceRegistry.addCatalogUrl("https://marketplace.kispace.de/externals.json").catch(g=>{logger$3.warn(`Failed to add commercial catalog: ${g}`)});const appStateEnhancer={enhance:async(g,a)=>{try{const l=await workspaceService.getWorkspace(),A=editorRegistry.getEditorArea()?.getActiveEditor(),O={workspace:l?.getName()||null,activeEditor:A?{title:A.input?.title||null,editorId:A.input?.editorId||null}:null},Y=`***App's state:***
${JSON.stringify(O,null,2)}`;return`${g}

${Y}`}catch{return g}},priority:20};contributionRegistry.registerContribution(CID_PROMPT_ENHANCERS,{label:"App State Enhancer",enhancer:appStateEnhancer});async function getWorkspaceAndPath(g,a=!0){const l=await workspaceService.getWorkspace();if(!l)return null;const A=g?.path;return a&&!A?null:{workspace:l,path:A||""}}function isEditorContentProvider(g){return g&&typeof g.getContent=="function"&&typeof g.getSelection=="function"&&typeof g.getSnippet=="function"&&typeof g.getLanguage=="function"&&typeof g.getFilePath=="function"}async function getResourceFromContext(g,a){let l;const A=g.params?.path;if(A){const O=await workspaceService.getWorkspace();O&&(l=await O.getResource(A))}return l||(l=activeSelectionSignal.get()),l}async function readTextFile(g){try{const a=await g.getContents();return typeof a!="string"?(toastError("File is not a text file"),null):a}catch(a){return toastError(`Failed to read file: ${a.message}`),null}}function createNullEditorResponse(g=!1){const a={filePath:null,language:null};return g?{...a,snippet:null,cursorLine:null}:a}async function getWorkspaceAndFile(g,a=!0){const l=await getWorkspaceAndPath(g,a);if(!l)return null;const{workspace:A,path:O}=l;if(!O)return null;try{const Y=await A.getResource(O);return!Y||!(Y instanceof File)?null:{workspace:A,path:O,file:Y}}catch{return null}}registerAll({command:{id:"create_file",name:"Create new file",description:"Creates a new file within the workspace. For .geospace map files, use create_map_file instead.",keyBinding:"CTRL+N",parameters:[{name:"path",description:"the path including name of the file to be created, must be relative to the workspace",required:!1},{name:"contents",description:"the textual contents of the file",required:!1},{name:"ask",description:"whether to prompt the user for the file path",required:!1},{name:"extension",description:"required file extension (e.g., '.geospace'), will be appended if missing",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async({params:g})=>{let a=g?.path;const l=g?.contents,A=g?.ask,O=g?.extension;if((A||!a)&&(a=await promptDialog("Enter path to new file (directories will be created if not exist):",a||""),!a))return;O&&!a.endsWith(O)&&(a+=O);const Y=await getWorkspaceAndPath({path:a},!0);if(!Y)return;const{workspace:R}=Y;if(await R.getResource(a)&&!await confirmDialog(`File "${a}" already exists. Do you want to overwrite it?`))return;const xe=await R.getResource(a,{create:!0});return xe?(l&&await xe.saveContents(l),defaultLogger.info("File created: "+a)):toastError("Could not create file: "+a),a}}});registerAll({command:{id:"rename_resource",name:"Rename a resource (file or directory)",description:"Renames a resource (file or directory)",keyBinding:"F2",parameters:[{name:"path",description:"the path of the resource within the workspace to rename or the currently active selection",required:!1},{name:"newName",description:"the new name for the resource",required:!1}]},handler:{execute:async g=>{const a=await getResourceFromContext(g);if(!a){toastError("No resource to rename provided!");return}const l=a.getName(),A=g.params?.newName||await promptDialog(`Enter new name for "${l}":`,l);if(!(!A||A===l))try{await a.rename(A),toastInfo(`Resource renamed to: ${A}`)}catch(O){toastError(`Failed to rename ${l}: ${O.message}`)}}}});registerAll({command:{id:"delete_resource",name:"Delete a resource (file or directory)",description:"Deletes a resource (file or directory)",parameters:[{name:"path",description:"the path of the resource within the workspace to delete or the currently active selection",required:!1},{name:"confirm",description:"whether to ask the user to confirm the deletion, true by default",required:!1}]},handler:{execute:async g=>{const a=await getResourceFromContext(g);if(!a){toastError("No resource to delete provided!");return}const l=a.getWorkspacePath(),A=g.params&&g.params.confirm;let O=!0;if((A===void 0||A===!0)&&(O=await confirmDialog(`Are you sure you want to delete ${l}?`)),O)try{await a.delete(),toastInfo("Resource deleted: "+l)}catch(Y){toastError(`Resource ${l} could not be deleted: ${Y.message||Y}`)}}}});registerAll({command:{id:"load_workspace",name:"Local Folder",description:"Connect to a local folder using File System Access API",parameters:[]},handler:{execute:async g=>{await window.showDirectoryPicker({mode:"readwrite"}).then(a=>workspaceService.connectWorkspace(a)).catch(a=>{toastError(a.message)})}},contribution:{target:"filebrowser.connections",label:"Local Folder",icon:"folder-open"}});registerAll({command:{id:"reload_workspace",name:"Reload workspace folder",description:"Reloads the active workspace folder",parameters:[]},handler:{execute:async g=>{const a=await workspaceService.getWorkspace();a||toastError("No workspace selected."),a.touch()}}});registerAll({command:{id:"open_editor",name:"Open editor",description:"Opens a file in an editor",parameters:[{name:"path",description:"tha path of the file to open within the workspace",required:!0}]},handler:{execute:async g=>{const a=await getWorkspaceAndFile({path:g.params?.path});if(!a)return;const{file:l}=a;await editorRegistry.loadEditor(l)}}});registerAll({command:{id:"head_file",name:"Head - Show first lines",description:"Shows the first N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the beginning (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the first N lines of the file"}]},handler:{execute:async({params:g})=>{const a=await getWorkspaceAndFile(g);if(!a)return;const{file:l}=a,A=g?.lines?parseInt(g.lines,10):10;if(isNaN(A)||A<1){toastError("Number of lines must be a positive integer");return}const O=await readTextFile(l);return O?O.split(`
`).slice(0,A).join(`
`):void 0}}});registerAll({command:{id:"tail_file",name:"Tail - Show last lines",description:"Shows the last N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the end (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the last N lines of the file"}]},handler:{execute:async({params:g})=>{const a=await getWorkspaceAndFile(g);if(!a)return;const{file:l}=a,A=g?.lines?parseInt(g.lines,10):10;if(isNaN(A)||A<1){toastError("Number of lines must be a positive integer");return}const O=await readTextFile(l);return O?O.split(`
`).slice(-A).join(`
`):void 0}}});registerAll({command:{id:"cat_file",name:"Cat - Show file contents",description:"Shows the complete contents of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0}],output:[{name:"content",description:"the complete contents of the file"}]},handler:{execute:async({params:g})=>{const a=await getWorkspaceAndFile(g);if(!a)return;const{file:l}=a;return await readTextFile(l)}}});registerAll({command:{id:"wc_file",name:"Word count",description:"Counts lines, words, and characters in a file",parameters:[{name:"path",description:"the path of the file to analyze",required:!0}],output:[{name:"lines",description:"number of lines in the file"},{name:"words",description:"number of words in the file"},{name:"characters",description:"number of characters in the file"}]},handler:{execute:async({params:g})=>{const a=await getWorkspaceAndFile(g);if(!a)return;const{file:l}=a,A=await readTextFile(l);if(!A)return;const Y=A.split(`
`).length,R=A.trim()===""?0:A.trim().split(/\s+/).filter(xe=>xe.length>0).length,ee=A.length;return{lines:Y,words:R,characters:ee}}}});registerAll({command:{id:"file_exists",name:"Check if file exists",description:"Checks if a file exists at the given path",parameters:[{name:"path",description:"the path of the file to check, relative to the workspace",required:!0}],output:[{name:"exists",description:"true if the file exists, false otherwise"}]},handler:{execute:async({params:g})=>{const a=await getWorkspaceAndPath(g);if(!a)return!1;const{workspace:l,path:A}=a;try{return await l.getResource(A)instanceof File}catch{return!1}}}});async function collectFilesRecursive(g){const a=[],l=await g.listChildren(!0);for(const A of l)if(A instanceof File)a.push(A.getWorkspacePath());else if(A instanceof Directory){const O=await collectFilesRecursive(A);a.push(...O)}return a}registerAll({command:{id:"ls",name:"List files",description:"Lists files from a directory. If recursive is provided, it traverses from the provided directory down to all leaves. If no directory is provided, it will traverse from the workspace root.",parameters:[{name:"path",description:"the path of the directory to list, relative to the workspace. If not provided, uses workspace root",required:!1},{name:"recursive",description:"whether to recursively traverse all subdirectories",type:"boolean",required:!1}],output:[{name:"files",description:"array of file objects with path and size information"}]},handler:{execute:async({params:g})=>{const a=await getWorkspaceAndPath(g,!1);if(!a)return toastError("No workspace available"),[];const{workspace:l,path:A}=a,O=g?.recursive===!0||g?.recursive==="true";try{let Y=l;if(A){const R=await l.getResource(A);if(!R)return toastError(`Path not found: ${A}`),[];if(!(R instanceof Directory))return toastError(`Path is not a directory: ${A}`),[];Y=R}if(O){const R=await collectFilesRecursive(Y),ee=[];for(const xe of R){const ne=await l.getResource(xe);if(ne instanceof File){const te=await ne.size();ee.push({path:xe,size:te})}}return ee}else{const R=await Y.listChildren(!0),ee=[];for(const xe of R)if(xe instanceof File){const ne=await xe.size();ee.push({path:xe.getWorkspacePath(),size:ne})}return ee}}catch(Y){return toastError(`Failed to list files: ${Y.message}`),[]}}}});registerAll({command:{id:"get_active_editor_content",name:"Get active editor content",description:"Gets the complete contents of the currently active editor. Returns null if no editor is active or if the editor is not a code editor.",parameters:[],output:[{name:"content",description:"the complete contents of the active editor, or null if no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"}]},handler:{execute:async g=>{const a=g.activeEditor;if(!isEditorContentProvider(a))return{...createNullEditorResponse(),content:null};try{return{content:a.getContent(),filePath:a.getFilePath(),language:a.getLanguage()}}catch{return{...createNullEditorResponse(),content:null}}}}});registerAll({command:{id:"get_active_editor_selection",name:"Get active editor selection",description:"Gets the currently selected text in the active editor. Returns null if no editor is active, no selection exists, or if the editor is not a code editor.",parameters:[],output:[{name:"selection",description:"the selected text in the active editor, or null if no selection exists or no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"}]},handler:{execute:async g=>{const a=g.activeEditor;if(!isEditorContentProvider(a))return{...createNullEditorResponse(),selection:null};try{return{selection:a.getSelection(),filePath:a.getFilePath(),language:a.getLanguage()}}catch{return{...createNullEditorResponse(),selection:null}}}}});registerAll({command:{id:"get_active_editor_snippet",name:"Get active editor snippet around cursor",description:"Gets a code snippet from the active editor with n lines before and n lines after the cursor position. Useful for getting context around the cursor without loading the entire file.",parameters:[{name:"lines",description:"number of lines to include before and after the cursor position (default: 5)",type:"number",required:!1}],output:[{name:"snippet",description:"the code snippet with n lines before and after the cursor, or null if no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"},{name:"cursorLine",description:"the line number where the cursor is positioned (1-based), or null if no editor is active"}]},handler:{execute:async g=>{const a=g.activeEditor;if(!isEditorContentProvider(a))return createNullEditorResponse(!0);try{const l=g.params?.lines?parseInt(g.params.lines,10):5;if(isNaN(l)||l<0)return createNullEditorResponse(!0);const A=a.getSnippet(l);return A?{snippet:A.snippet,filePath:a.getFilePath(),language:a.getLanguage(),cursorLine:A.cursorLine}:createNullEditorResponse(!0)}catch{return createNullEditorResponse(!0)}}}});var dist={},ohm={},hasRequiredOhm;function requireOhm(){if(hasRequiredOhm)return ohm;hasRequiredOhm=1,Object.defineProperty(ohm,"__esModule",{value:!0});function g(ht){const rt=ht||"";return function(){throw new Error("this method "+rt+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function a(ht,rt){if(!ht)throw new Error(rt||"Assertion failed")}function l(ht,rt,lt){let bt;Object.defineProperty(ht,rt,{get(){return bt||(bt=lt.call(this)),bt}})}function A(ht){return ht&&Object.assign({},ht)}function O(ht,rt){const lt=[];for(;rt-- >0;)lt.push(ht());return lt}function Y(ht,rt){return new Array(rt+1).join(ht)}function R(ht,rt){return O(()=>ht,rt)}function ee(ht){const rt=[];for(let lt=0;lt<ht.length;lt++){const bt=ht[lt];ht.lastIndexOf(bt)!==lt&&rt.indexOf(bt)<0&&rt.push(bt)}return rt}function xe(ht){const rt=[];return ht.forEach(lt=>{rt.indexOf(lt)<0&&rt.push(lt)}),rt}function ne(ht){const rt=ht[0];return rt===rt.toUpperCase()}function te(ht){return!ne(ht)}function f(ht,rt,lt){const bt=lt||" ";return ht.length<rt?Y(bt,rt-ht.length)+ht:ht}function d(){this.strings=[]}d.prototype.append=function(ht){this.strings.push(ht)},d.prototype.contents=function(){return this.strings.join("")};const H=ht=>String.fromCodePoint(parseInt(ht,16));function Z(ht){if(ht.charAt(0)==="\\")switch(ht.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return H(ht.slice(2,4));case"u":return ht.charAt(2)==="{"?H(ht.slice(3,-1)):H(ht.slice(2,6));default:return ht.charAt(1)}else return ht}function Ye(ht){if(ht==null)return String(ht);const rt=Object.prototype.toString.call(ht);try{let lt;return ht.constructor&&ht.constructor.name?lt=ht.constructor.name:rt.indexOf("[object ")===0?lt=rt.slice(8,-1):lt=typeof ht,lt+": "+JSON.stringify(String(ht))}catch{return rt}}var et=Object.freeze({__proto__:null,abstract:g,assert:a,defineLazyProperty:l,clone:A,repeatFn:O,repeatStr:Y,repeat:R,getDuplicates:ee,copyWithoutDuplicates:xe,isSyntactic:ne,isLexical:te,padLeft:f,StringBuffer:d,unescapeCodePoint:Z,unexpectedObjToString:Ye});const tt={Lu:new RegExp("\\p{Lu}","u"),Ll:new RegExp("\\p{Ll}","u"),Lt:new RegExp("\\p{Lt}","u"),Lm:new RegExp("\\p{Lm}","u"),Lo:new RegExp("\\p{Lo}","u"),Nl:new RegExp("\\p{Nl}","u"),Nd:new RegExp("\\p{Nd}","u"),Mn:new RegExp("\\p{Mn}","u"),Mc:new RegExp("\\p{Mc}","u"),Pc:new RegExp("\\p{Pc}","u"),Zs:new RegExp("\\p{Zs}","u"),L:new RegExp("\\p{Letter}","u"),Ltmo:new RegExp("\\p{Lt}|\\p{Lm}|\\p{Lo}","u")};class nt{constructor(){if(this.constructor===nt)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(rt){return rt&&(this.source=rt.trimmed()),this}}const it=Object.create(nt.prototype),ot=Object.create(nt.prototype);class st extends nt{constructor(rt){super(),this.obj=rt}}class at extends nt{constructor(rt,lt){super(),this.from=rt,this.to=lt,this.matchCodePoint=rt.length>1||lt.length>1}}class ct extends nt{constructor(rt){super(),this.index=rt}}class ft extends nt{constructor(rt){super(),this.terms=rt}}class ut extends ft{constructor(rt,lt,bt){const Ct=rt.rules[lt].body;super([bt,Ct]),this.superGrammar=rt,this.name=lt,this.body=bt}}class _t extends ft{constructor(rt,lt,bt,Ct){const Gt=rt.rules[lt].body;super([...bt,Gt,...Ct]),this.superGrammar=rt,this.ruleName=lt,this.expansionPos=bt.length}}class At extends nt{constructor(rt){super(),this.factors=rt}}class Et extends nt{constructor(rt){super(),this.expr=rt}}class Mt extends Et{}class Ot extends Et{}class kt extends Et{}Mt.prototype.operator="*",Ot.prototype.operator="+",kt.prototype.operator="?",Mt.prototype.minNumMatches=0,Ot.prototype.minNumMatches=1,kt.prototype.minNumMatches=0,Mt.prototype.maxNumMatches=Number.POSITIVE_INFINITY,Ot.prototype.maxNumMatches=Number.POSITIVE_INFINITY,kt.prototype.maxNumMatches=1;class yt extends nt{constructor(rt){super(),this.expr=rt}}class St extends nt{constructor(rt){super(),this.expr=rt}}class Yt extends nt{constructor(rt){super(),this.expr=rt}}class Ft extends nt{constructor(rt,lt=[]){super(),this.ruleName=rt,this.args=lt}isSyntactic(){return ne(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class ln extends nt{constructor(rt){super(),this.category=rt,this.pattern=tt[rt]}}function dn(ht,rt){let lt;return rt?(lt=new Error(rt.getLineAndColumnMessage()+ht),lt.shortMessage=ht,lt.interval=rt):lt=new Error(ht),lt}function Pt(){return dn("Interval sources don't match")}function $t(ht){const rt=new Error;return Object.defineProperty(rt,"message",{enumerable:!0,get(){return ht.message}}),Object.defineProperty(rt,"shortMessage",{enumerable:!0,get(){return"Expected "+ht.getExpectedText()}}),rt.interval=ht.getInterval(),rt}function hn(ht,rt,lt){const bt=rt?`Grammar ${ht} is not declared in namespace '${rt}'`:"Undeclared grammar "+ht;return dn(bt,lt)}function _n(ht,rt){return dn("Grammar "+ht.name+" is already declared in this namespace")}function On(ht){return dn(`Grammar '${ht.name}' does not support incremental parsing`)}function En(ht,rt,lt){return dn("Rule "+ht+" is not declared in grammar "+rt,lt)}function qt(ht,rt,lt){return dn("Cannot override rule "+ht+" because it is not declared in "+rt,lt)}function Jt(ht,rt,lt){return dn("Cannot extend rule "+ht+" because it is not declared in "+rt,lt)}function Wt(ht,rt,lt,bt){let Ct="Duplicate declaration for rule '"+ht+"' in grammar '"+rt+"'";return rt!==lt&&(Ct+=" (originally declared in '"+lt+"')"),dn(Ct,bt)}function un(ht,rt,lt,bt){return dn("Wrong number of parameters for rule "+ht+" (expected "+rt+", got "+lt+")",bt)}function fn(ht,rt,lt,bt){return dn("Wrong number of arguments for rule "+ht+" (expected "+rt+", got "+lt+")",bt)}function pn(ht,rt,lt){return dn("Duplicate parameter names in rule "+ht+": "+rt.join(", "),lt)}function Zt(ht,rt){return dn("Invalid parameter to rule "+ht+": "+rt+" has arity "+rt.getArity()+", but parameter expressions must have arity 1",rt.source)}const mn="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function Tn(ht,rt){return dn("Cannot apply syntactic rule "+ht+" from here (inside a lexical context)",rt.source)}function $n(ht){const{ruleName:rt}=ht;return dn(`applySyntactic is for syntactic rules, but '${rt}' is a lexical rule. `+mn,ht.source)}function Un(ht){return dn("applySyntactic is not required here (in a syntactic context)",ht.source)}function In(ht,rt){return dn("Incorrect argument type: expected "+ht,rt.source)}function kn(ht){return dn("'...' can appear at most once in a rule body",ht.source)}function Kt(ht){const rt=ht._node;a(rt&&rt.isNonterminal()&&rt.ctorName==="escapeChar_unicodeCodePoint");const lt=ht.children.slice(1,-1).map(Ct=>Ct.source),bt=lt[0].coverageWith(...lt.slice(1));return dn(`U+${bt.contents} is not a valid Unicode code point`,bt)}function Dt(ht,rt){const lt=rt.length>0?rt[rt.length-1].args:[];let Ct="Nullable expression "+ht.expr.substituteParams(lt)+" is not allowed inside '"+ht.operator+"' (possible infinite loop)";if(rt.length>0){const Gt=rt.map(rn=>new Ft(rn.ruleName,rn.args)).join(`
`);Ct+=`
Application stack (most recent application last):
`+Gt}return dn(Ct,ht.expr.source)}function Qt(ht,rt,lt,bt){return dn("Rule "+ht+" involves an alternation which has inconsistent arity (expected "+rt+", got "+lt+")",bt.source)}function cn(ht){const rt=ht.map(lt=>lt.message);return dn(["Errors:"].concat(rt).join(`
- `),ht[0].interval)}function nn(ht,rt,lt,bt){let Ct=bt.slice(0,-1).map(mt=>{const vt="  "+mt[0].name+" > "+mt[1];return mt.length===3?vt+" for '"+mt[2]+"'":vt}).join(`
`);Ct+=`
  `+rt+" > "+ht;let Gt="";ht==="_iter"&&(Gt=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes — see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));const rn=[`Missing semantic action for '${ht}' in ${lt} '${rt}'.${Gt}`,"Action stack (most recent call last):",Ct].join(`
`),dt=dn(rn);return dt.name="missingSemanticAction",dt}function gn(ht){if(ht.length===1)throw ht[0];if(ht.length>1)throw cn(ht)}function Cn(ht){let rt=0;return ht.map(bt=>{const Ct=bt.toString();return rt=Math.max(rt,Ct.length),Ct}).map(bt=>f(bt,rt))}function Fn(ht,rt,lt){const bt=ht.length,Ct=ht.slice(0,lt),Gt=ht.slice(lt+rt.length);return(Ct+rt+Gt).substr(0,bt)}function Gn(...ht){const rt=this,{offset:lt}=rt,{repeatStr:bt}=et,Ct=new d;Ct.append("Line "+rt.lineNum+", col "+rt.colNum+`:
`);const Gt=Cn([rt.prevLine==null?0:rt.lineNum-1,rt.lineNum,rt.nextLine==null?0:rt.lineNum+1]),rn=(It,Lt,jt)=>{Ct.append(jt+Gt[It]+" | "+Lt+`
`)};rt.prevLine!=null&&rn(0,rt.prevLine,"  "),rn(1,rt.line,"> ");const dt=rt.line.length;let mt=bt(" ",dt+1);for(let It=0;It<ht.length;++It){let Lt=ht[It][0],jt=ht[It][1];a(Lt>=0&&Lt<=jt,"range start must be >= 0 and <= end");const on=lt-rt.colNum+1;Lt=Math.max(0,Lt-on),jt=Math.min(jt-on,dt),mt=Fn(mt,bt("~",jt-Lt),Lt)}const vt=2+Gt[1].length+3;return Ct.append(bt(" ",vt)),mt=Fn(mt,"^",rt.colNum-1),Ct.append(mt.replace(/ +$/,"")+`
`),rt.nextLine!=null&&rn(2,rt.nextLine,"  "),Ct.contents()}let Zn=[];function cr(ht){Zn.push(ht)}function bn(ht){Zn.forEach(rt=>{rt(ht)}),Zn=null}function vr(ht,rt){let lt=1,bt=1,Ct=0,Gt=0,rn=null,dt=null,mt=-1;for(;Ct<rt;){const Lt=ht.charAt(Ct++);Lt===`
`?(lt++,bt=1,mt=Gt,Gt=Ct):Lt!=="\r"&&bt++}let vt=ht.indexOf(`
`,Gt);if(vt===-1)vt=ht.length;else{const Lt=ht.indexOf(`
`,vt+1);rn=Lt===-1?ht.slice(vt):ht.slice(vt,Lt),rn=rn.replace(/^\r?\n/,"").replace(/\r$/,"")}mt>=0&&(dt=ht.slice(mt,Gt).replace(/\r?\n$/,""));const It=ht.slice(Gt,vt).replace(/\r$/,"");return{offset:rt,lineNum:lt,colNum:bt,line:It,prevLine:dt,nextLine:rn,toString:Gn}}function Nn(ht,rt,...lt){return vr(ht,rt).toString(...lt)}const ur=(()=>{let ht=0;return rt=>""+rt+ht++})();class ir{constructor(rt,lt,bt){this.sourceString=rt,this.startIdx=lt,this.endIdx=bt}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...rt){return ir.coverage(...rt,this)}collapsedLeft(){return new ir(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new ir(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return vr(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const rt=[this.startIdx,this.endIdx];return Nn(this.sourceString,this.startIdx,rt)}minus(rt){if(this.sourceString!==rt.sourceString)throw Pt();return this.startIdx===rt.startIdx&&this.endIdx===rt.endIdx?[]:this.startIdx<rt.startIdx&&rt.endIdx<this.endIdx?[new ir(this.sourceString,this.startIdx,rt.startIdx),new ir(this.sourceString,rt.endIdx,this.endIdx)]:this.startIdx<rt.endIdx&&rt.endIdx<this.endIdx?[new ir(this.sourceString,rt.endIdx,this.endIdx)]:this.startIdx<rt.startIdx&&rt.startIdx<this.endIdx?[new ir(this.sourceString,this.startIdx,rt.startIdx)]:[this]}relativeTo(rt){if(this.sourceString!==rt.sourceString)throw Pt();return a(this.startIdx>=rt.startIdx&&this.endIdx<=rt.endIdx,"other interval does not cover this one"),new ir(this.sourceString,this.startIdx-rt.startIdx,this.endIdx-rt.startIdx)}trimmed(){const{contents:rt}=this,lt=this.startIdx+rt.match(/^\s*/)[0].length,bt=this.endIdx-rt.match(/\s*$/)[0].length;return new ir(this.sourceString,lt,bt)}subInterval(rt,lt){const bt=this.startIdx+rt;return new ir(this.sourceString,bt,bt+lt)}}ir.coverage=function(ht,...rt){let{startIdx:lt,endIdx:bt}=ht;for(const Ct of rt){if(Ct.sourceString!==ht.sourceString)throw Pt();lt=Math.min(lt,Ct.startIdx),bt=Math.max(bt,Ct.endIdx)}return new ir(ht.sourceString,lt,bt)};const wr=65535;class jn{constructor(rt){this.source=rt,this.pos=0,this.examinedLength=0}atEnd(){const rt=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),rt}next(){const rt=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),rt}nextCharCode(){const rt=this.next();return rt&&rt.charCodeAt(0)}nextCodePoint(){const rt=this.source.slice(this.pos++).codePointAt(0);return rt>wr&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),rt}matchString(rt,lt){let bt;if(lt){for(bt=0;bt<rt.length;bt++){const Ct=this.next(),Gt=rt[bt];if(Ct==null||Ct.toUpperCase()!==Gt.toUpperCase())return!1}return!0}for(bt=0;bt<rt.length;bt++)if(this.next()!==rt[bt])return!1;return!0}sourceSlice(rt,lt){return this.source.slice(rt,lt)}interval(rt,lt){return new ir(this.source,rt,lt||this.pos)}}class xt{constructor(rt,lt,bt,Ct,Gt,rn,dt){this.matcher=rt,this.input=lt,this.startExpr=bt,this._cst=Ct,this._cstOffset=Gt,this._rightmostFailurePosition=rn,this._rightmostFailures=dt,this.failed()&&(l(this,"message",function(){const mt="Expected "+this.getExpectedText();return Nn(this.input,this.getRightmostFailurePosition())+mt}),l(this,"shortMessage",function(){const mt="expected "+this.getExpectedText(),vt=vr(this.input,this.getRightmostFailurePosition());return"Line "+vt.lineNum+", col "+vt.colNum+": "+mt}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const rt=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=rt.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const rt=new d;let lt=this.getRightmostFailures();lt=lt.filter(bt=>!bt.isFluffy());for(let bt=0;bt<lt.length;bt++)bt>0&&(bt===lt.length-1?rt.append(lt.length>2?", or ":" or "):rt.append(", ")),rt.append(lt[bt].toString());return rt.contents()}getInterval(){const rt=this.getRightmostFailurePosition();return new ir(this.input,rt,rt)}}class zt{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(rt){return this.applicationMemoKeyStack.indexOf(rt.toMemoKey())>=0}enter(rt){this.applicationMemoKeyStack.push(rt.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(rt,lt){lt.isLeftRecursion=!0,lt.headApplication=rt,lt.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=lt;const{applicationMemoKeyStack:bt}=this,Ct=bt.indexOf(rt.toMemoKey())+1,Gt=bt.slice(Ct);lt.isInvolved=function(rn){return Gt.indexOf(rn)>=0},lt.updateInvolvedApplicationMemoKeys=function(){for(let rn=Ct;rn<bt.length;rn++){const dt=bt[rn];this.isInvolved(dt)||Gt.push(dt)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(rt){if(!rt.isLeftRecursion)return!0;const{applicationMemoKeyStack:lt}=this;for(let bt=0;bt<lt.length;bt++){const Ct=lt[bt];if(rt.isInvolved(Ct))return!1}return!0}memoize(rt,lt){return this.memo[rt]=lt,this.maxExaminedLength=Math.max(this.maxExaminedLength,lt.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,lt.rightmostFailureOffset),lt}clearObsoleteEntries(rt,lt){if(rt+this.maxExaminedLength<=lt)return;const{memo:bt}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(bt).forEach(Ct=>{const Gt=bt[Ct];rt+Gt.examinedLength>lt?delete bt[Ct]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,Gt.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,Gt.rightmostFailureOffset))})}}const Ut="✗",pt="✓",gt="⋅",wt="⇒",Rt="␉",Bt="␊",tn="␍",yn={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function An(ht){return R(" ",ht).join("")}function Mn(ht,rt,lt){const bt=Xn(ht.slice(rt,rt+lt));return bt.length<lt?bt+R(" ",lt-bt.length).join(""):bt}function Xn(ht){return typeof ht=="string"?ht.replace(/ /g,gt).replace(/\t/g,Rt).replace(/\n/g,Bt).replace(/\r/g,tn):String(ht)}class zn{constructor(rt,lt,bt,Ct,Gt,rn,dt){this.input=rt,this.pos=this.pos1=lt,this.pos2=bt,this.source=new ir(rt,lt,bt),this.expr=Ct,this.bindings=rn,this.children=dt||[],this.terminatingLREntry=null,this._flags=Gt?yn.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(rt){const lt=new zn(this.input,this.pos,this.pos2,rt,this.succeeded,this.bindings,this.children);return lt.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,lt.isImplicitSpaces=this.isImplicitSpaces,lt.isMemoized=this.isMemoized,lt.isRootNode=this.isRootNode,lt.terminatesLR=this.terminatesLR,lt.terminatingLREntry=this.terminatingLREntry,lt}recordLRTermination(rt,lt){this.terminatingLREntry=new zn(this.input,this.pos,this.pos2,this.expr,!1,[lt],[rt]),this.terminatingLREntry.terminatesLR=!0}walk(rt,lt){let bt=rt;typeof bt=="function"&&(bt={enter:bt});function Ct(Gt,rn,dt){let mt=!0;bt.enter&&bt.enter.call(lt,Gt,rn,dt)===zn.prototype.SKIP&&(mt=!1),mt&&(Gt.children.forEach(vt=>{Ct(vt,Gt,dt+1)}),bt.exit&&bt.exit.call(lt,Gt,rn,dt))}this.isRootNode?this.children.forEach(Gt=>{Ct(Gt,null,0)}):Ct(this,null,0)}toString(){const rt=new d;return this.walk((lt,bt,Ct)=>{if(!lt)return this.SKIP;if(lt.expr.constructor.name!=="Alt"){if(rt.append(Mn(lt.input,lt.pos,10)+An(Ct*2+1)),rt.append((lt.succeeded?pt:Ut)+" "+lt.displayString),lt.isHeadOfLeftRecursion&&rt.append(" (LR)"),lt.succeeded){const rn=Xn(lt.source.contents);rt.append(" "+wt+"  "),rt.append(typeof rn=="string"?'"'+rn+'"':rn)}rt.append(`
`)}}),rt.contents()}}zn.prototype.SKIP={},Object.keys(yn).forEach(ht=>{const rt=yn[ht];Object.defineProperty(zn.prototype,ht,{get(){return(this._flags&rt)!==0},set(lt){lt?this._flags|=rt:this._flags&=~rt}})}),nt.prototype.allowsSkippingPrecedingSpace=g("allowsSkippingPrecedingSpace"),it.allowsSkippingPrecedingSpace=ot.allowsSkippingPrecedingSpace=Ft.prototype.allowsSkippingPrecedingSpace=st.prototype.allowsSkippingPrecedingSpace=at.prototype.allowsSkippingPrecedingSpace=ln.prototype.allowsSkippingPrecedingSpace=function(){return!0},ft.prototype.allowsSkippingPrecedingSpace=Et.prototype.allowsSkippingPrecedingSpace=Yt.prototype.allowsSkippingPrecedingSpace=St.prototype.allowsSkippingPrecedingSpace=yt.prototype.allowsSkippingPrecedingSpace=ct.prototype.allowsSkippingPrecedingSpace=At.prototype.allowsSkippingPrecedingSpace=function(){return!1};let Jn;cr(ht=>{Jn=ht});let Hn;nt.prototype.assertAllApplicationsAreValid=function(ht,rt){Hn=0,this._assertAllApplicationsAreValid(ht,rt)},nt.prototype._assertAllApplicationsAreValid=g("_assertAllApplicationsAreValid"),it._assertAllApplicationsAreValid=ot._assertAllApplicationsAreValid=st.prototype._assertAllApplicationsAreValid=at.prototype._assertAllApplicationsAreValid=ct.prototype._assertAllApplicationsAreValid=ln.prototype._assertAllApplicationsAreValid=function(ht,rt){},Yt.prototype._assertAllApplicationsAreValid=function(ht,rt){Hn++,this.expr._assertAllApplicationsAreValid(ht,rt),Hn--},ft.prototype._assertAllApplicationsAreValid=function(ht,rt){for(let lt=0;lt<this.terms.length;lt++)this.terms[lt]._assertAllApplicationsAreValid(ht,rt)},At.prototype._assertAllApplicationsAreValid=function(ht,rt){for(let lt=0;lt<this.factors.length;lt++)this.factors[lt]._assertAllApplicationsAreValid(ht,rt)},Et.prototype._assertAllApplicationsAreValid=yt.prototype._assertAllApplicationsAreValid=St.prototype._assertAllApplicationsAreValid=function(ht,rt){this.expr._assertAllApplicationsAreValid(ht,rt)},Ft.prototype._assertAllApplicationsAreValid=function(ht,rt,lt=!1){const bt=rt.rules[this.ruleName],Ct=ne(ht)&&Hn===0;if(!bt)throw En(this.ruleName,rt.name,this.source);if(!lt&&ne(this.ruleName)&&!Ct)throw Tn(this.ruleName,this);const Gt=this.args.length,rn=bt.formals.length;if(Gt!==rn)throw fn(this.ruleName,rn,Gt,this.source);const dt=Jn&&bt===Jn.rules.applySyntactic;if(Jn&&bt===Jn.rules.caseInsensitive&&!(this.args[0]instanceof st))throw In('a Terminal (e.g. "abc")',this.args[0]);if(dt){const vt=this.args[0];if(!(vt instanceof Ft))throw In("a syntactic rule application",vt);if(!ne(vt.ruleName))throw $n(vt);if(Ct)throw Un(this)}this.args.forEach(vt=>{if(vt._assertAllApplicationsAreValid(ht,rt,dt),vt.getArity()!==1)throw Zt(this.ruleName,vt)})},nt.prototype.assertChoicesHaveUniformArity=g("assertChoicesHaveUniformArity"),it.assertChoicesHaveUniformArity=ot.assertChoicesHaveUniformArity=st.prototype.assertChoicesHaveUniformArity=at.prototype.assertChoicesHaveUniformArity=ct.prototype.assertChoicesHaveUniformArity=Yt.prototype.assertChoicesHaveUniformArity=ln.prototype.assertChoicesHaveUniformArity=function(ht){},ft.prototype.assertChoicesHaveUniformArity=function(ht){if(this.terms.length===0)return;const rt=this.terms[0].getArity();for(let lt=0;lt<this.terms.length;lt++){const bt=this.terms[lt];bt.assertChoicesHaveUniformArity();const Ct=bt.getArity();if(rt!==Ct)throw Qt(ht,rt,Ct,bt)}},ut.prototype.assertChoicesHaveUniformArity=function(ht){const rt=this.terms[0].getArity(),lt=this.terms[1].getArity();if(rt!==lt)throw Qt(ht,lt,rt,this.terms[0])},At.prototype.assertChoicesHaveUniformArity=function(ht){for(let rt=0;rt<this.factors.length;rt++)this.factors[rt].assertChoicesHaveUniformArity(ht)},Et.prototype.assertChoicesHaveUniformArity=function(ht){this.expr.assertChoicesHaveUniformArity(ht)},yt.prototype.assertChoicesHaveUniformArity=function(ht){},St.prototype.assertChoicesHaveUniformArity=function(ht){this.expr.assertChoicesHaveUniformArity(ht)},Ft.prototype.assertChoicesHaveUniformArity=function(ht){},nt.prototype.assertIteratedExprsAreNotNullable=g("assertIteratedExprsAreNotNullable"),it.assertIteratedExprsAreNotNullable=ot.assertIteratedExprsAreNotNullable=st.prototype.assertIteratedExprsAreNotNullable=at.prototype.assertIteratedExprsAreNotNullable=ct.prototype.assertIteratedExprsAreNotNullable=ln.prototype.assertIteratedExprsAreNotNullable=function(ht){},ft.prototype.assertIteratedExprsAreNotNullable=function(ht){for(let rt=0;rt<this.terms.length;rt++)this.terms[rt].assertIteratedExprsAreNotNullable(ht)},At.prototype.assertIteratedExprsAreNotNullable=function(ht){for(let rt=0;rt<this.factors.length;rt++)this.factors[rt].assertIteratedExprsAreNotNullable(ht)},Et.prototype.assertIteratedExprsAreNotNullable=function(ht){if(this.expr.assertIteratedExprsAreNotNullable(ht),this.expr.isNullable(ht))throw Dt(this,[])},kt.prototype.assertIteratedExprsAreNotNullable=yt.prototype.assertIteratedExprsAreNotNullable=St.prototype.assertIteratedExprsAreNotNullable=Yt.prototype.assertIteratedExprsAreNotNullable=function(ht){this.expr.assertIteratedExprsAreNotNullable(ht)},Ft.prototype.assertIteratedExprsAreNotNullable=function(ht){this.args.forEach(rt=>{rt.assertIteratedExprsAreNotNullable(ht)})};class ar{constructor(rt){this.matchLength=rt}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(rt){if(this.children)return this.children[rt]}indexOfChild(rt){return this.children.indexOf(rt)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(rt){const lt=this.indexOfChild(rt);if(lt<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(lt===0)throw new Error("cannot get child before first child");return this.childAt(lt-1)}childAfter(rt){const lt=this.indexOfChild(rt);if(lt<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(lt===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(lt+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class Vn extends ar{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class sr extends ar{constructor(rt,lt,bt,Ct){super(Ct),this.ruleName=rt,this.children=lt,this.childOffsets=bt}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return te(this.ctorName)}isSyntactic(){return ne(this.ctorName)}}class _r extends ar{constructor(rt,lt,bt,Ct){super(bt),this.children=rt,this.childOffsets=lt,this.optional=Ct}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}nt.prototype.eval=g("eval"),it.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos,bt=rt.nextCodePoint();return bt!==void 0?(ht.pushBinding(new Vn(String.fromCodePoint(bt).length),lt),!0):(ht.processFailure(lt,this),!1)},ot.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos;return rt.atEnd()?(ht.pushBinding(new Vn(0),lt),!0):(ht.processFailure(lt,this),!1)},st.prototype.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos;return rt.matchString(this.obj)?(ht.pushBinding(new Vn(this.obj.length),lt),!0):(ht.processFailure(lt,this),!1)},at.prototype.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos,bt=this.matchCodePoint?rt.nextCodePoint():rt.nextCharCode();return bt!==void 0&&this.from.codePointAt(0)<=bt&&bt<=this.to.codePointAt(0)?(ht.pushBinding(new Vn(String.fromCodePoint(bt).length),lt),!0):(ht.processFailure(lt,this),!1)},ct.prototype.eval=function(ht){return ht.eval(ht.currentApplication().args[this.index])},Yt.prototype.eval=function(ht){ht.enterLexifiedContext();const rt=ht.eval(this.expr);return ht.exitLexifiedContext(),rt},ft.prototype.eval=function(ht){for(let rt=0;rt<this.terms.length;rt++)if(ht.eval(this.terms[rt]))return!0;return!1},At.prototype.eval=function(ht){for(let rt=0;rt<this.factors.length;rt++){const lt=this.factors[rt];if(!ht.eval(lt))return!1}return!0},Et.prototype.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos,bt=this.getArity(),Ct=[],Gt=[];for(;Ct.length<bt;)Ct.push([]),Gt.push([]);let rn=0,dt=lt,mt;for(;rn<this.maxNumMatches&&ht.eval(this.expr);){if(rt.pos===dt)throw Dt(this,ht._applicationStack);dt=rt.pos,rn++;const jt=ht._bindings.splice(ht._bindings.length-bt,bt),on=ht._bindingOffsets.splice(ht._bindingOffsets.length-bt,bt);for(mt=0;mt<jt.length;mt++)Ct[mt].push(jt[mt]),Gt[mt].push(on[mt])}if(rn<this.minNumMatches)return!1;let vt=ht.posToOffset(lt),It=0;if(rn>0){const jt=Ct[bt-1],on=Gt[bt-1],wn=on[on.length-1]+jt[jt.length-1].matchLength;vt=Gt[0][0],It=wn-vt}const Lt=this instanceof kt;for(mt=0;mt<Ct.length;mt++)ht._bindings.push(new _r(Ct[mt],Gt[mt],It,Lt)),ht._bindingOffsets.push(vt);return!0},yt.prototype.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos;ht.pushFailuresInfo();const bt=ht.eval(this.expr);return ht.popFailuresInfo(),bt?(ht.processFailure(lt,this),!1):(rt.pos=lt,!0)},St.prototype.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos;return ht.eval(this.expr)?(rt.pos=lt,!0):!1},Ft.prototype.eval=function(ht){const rt=ht.currentApplication(),lt=rt?rt.args:[],bt=this.substituteParams(lt),Ct=ht.getCurrentPosInfo();if(Ct.isActive(bt))return bt.handleCycle(ht);const Gt=bt.toMemoKey(),rn=Ct.memo[Gt];if(rn&&Ct.shouldUseMemoizedResult(rn)){if(ht.hasNecessaryInfo(rn))return ht.useMemoizedResult(ht.inputStream.pos,rn);delete Ct.memo[Gt]}return bt.reallyEval(ht)},Ft.prototype.handleCycle=function(ht){const rt=ht.getCurrentPosInfo(),{currentLeftRecursion:lt}=rt,bt=this.toMemoKey();let Ct=rt.memo[bt];return lt&&lt.headApplication.toMemoKey()===bt?Ct.updateInvolvedApplicationMemoKeys():Ct||(Ct=rt.memoize(bt,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),rt.startLeftRecursion(this,Ct)),ht.useMemoizedResult(ht.inputStream.pos,Ct)},Ft.prototype.reallyEval=function(ht){const{inputStream:rt}=ht,lt=rt.pos,bt=ht.getCurrentPosInfo(),Ct=ht.grammar.rules[this.ruleName],{body:Gt}=Ct,{description:rn}=Ct;ht.enterApplication(bt,this),rn&&ht.pushFailuresInfo();const dt=rt.examinedLength;rt.examinedLength=0;let mt=this.evalOnce(Gt,ht);const vt=bt.currentLeftRecursion,It=this.toMemoKey(),Lt=vt&&vt.headApplication.toMemoKey()===It;let jt;ht.doNotMemoize?ht.doNotMemoize=!1:Lt?(mt=this.growSeedResult(Gt,ht,lt,vt,mt),bt.endLeftRecursion(),jt=vt,jt.examinedLength=rt.examinedLength-lt,jt.rightmostFailureOffset=ht._getRightmostFailureOffset(),bt.memoize(It,jt)):(!vt||!vt.isInvolved(It))&&(jt=bt.memoize(It,{matchLength:rt.pos-lt,examinedLength:rt.examinedLength-lt,value:mt,failuresAtRightmostPosition:ht.cloneRecordedFailures(),rightmostFailureOffset:ht._getRightmostFailureOffset()}));const on=!!mt;if(rn&&(ht.popFailuresInfo(),on||ht.processFailure(lt,this),jt&&(jt.failuresAtRightmostPosition=ht.cloneRecordedFailures())),ht.isTracing()&&jt){const wn=ht.getTraceEntry(lt,this,on,on?[mt]:[]);Lt&&(a(wn.terminatingLREntry!=null||!on),wn.isHeadOfLeftRecursion=!0),jt.traceEntry=wn}return rt.examinedLength=Math.max(rt.examinedLength,dt),ht.exitApplication(bt,mt),on},Ft.prototype.evalOnce=function(ht,rt){const{inputStream:lt}=rt,bt=lt.pos;if(rt.eval(ht)){const Ct=ht.getArity(),Gt=rt._bindings.splice(rt._bindings.length-Ct,Ct),rn=rt._bindingOffsets.splice(rt._bindingOffsets.length-Ct,Ct),dt=lt.pos-bt;return new sr(this.ruleName,Gt,rn,dt)}else return!1},Ft.prototype.growSeedResult=function(ht,rt,lt,bt,Ct){if(!Ct)return!1;const{inputStream:Gt}=rt;for(;;){if(bt.matchLength=Gt.pos-lt,bt.value=Ct,bt.failuresAtRightmostPosition=rt.cloneRecordedFailures(),rt.isTracing()){const rn=rt.trace[rt.trace.length-1];bt.traceEntry=new zn(rt.input,lt,Gt.pos,this,!0,[Ct],[rn.clone()])}if(Gt.pos=lt,Ct=this.evalOnce(ht,rt),Gt.pos-lt<=bt.matchLength)break;rt.isTracing()&&rt.trace.splice(-2,1)}return rt.isTracing()&&bt.traceEntry.recordLRTermination(rt.trace.pop(),Ct),Gt.pos=lt+bt.matchLength,bt.value},ln.prototype.eval=function(ht){const{inputStream:rt}=ht,lt=rt.pos,bt=rt.next();return bt&&this.pattern.test(bt)?(ht.pushBinding(new Vn(bt.length),lt),!0):(ht.processFailure(lt,this),!1)},nt.prototype.getArity=g("getArity"),it.getArity=ot.getArity=st.prototype.getArity=at.prototype.getArity=ct.prototype.getArity=Ft.prototype.getArity=ln.prototype.getArity=function(){return 1},ft.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()},At.prototype.getArity=function(){let ht=0;for(let rt=0;rt<this.factors.length;rt++)ht+=this.factors[rt].getArity();return ht},Et.prototype.getArity=function(){return this.expr.getArity()},yt.prototype.getArity=function(){return 0},St.prototype.getArity=Yt.prototype.getArity=function(){return this.expr.getArity()};function er(ht,rt){const lt={};if(ht.source&&rt){const bt=ht.source.relativeTo(rt);lt.sourceInterval=[bt.startIdx,bt.endIdx]}return lt}nt.prototype.outputRecipe=g("outputRecipe"),it.outputRecipe=function(ht,rt){return["any",er(this,rt)]},ot.outputRecipe=function(ht,rt){return["end",er(this,rt)]},st.prototype.outputRecipe=function(ht,rt){return["terminal",er(this,rt),this.obj]},at.prototype.outputRecipe=function(ht,rt){return["range",er(this,rt),this.from,this.to]},ct.prototype.outputRecipe=function(ht,rt){return["param",er(this,rt),this.index]},ft.prototype.outputRecipe=function(ht,rt){return["alt",er(this,rt)].concat(this.terms.map(lt=>lt.outputRecipe(ht,rt)))},ut.prototype.outputRecipe=function(ht,rt){return this.terms[0].outputRecipe(ht,rt)},_t.prototype.outputRecipe=function(ht,rt){const lt=this.terms.slice(0,this.expansionPos),bt=this.terms.slice(this.expansionPos+1);return["splice",er(this,rt),lt.map(Ct=>Ct.outputRecipe(ht,rt)),bt.map(Ct=>Ct.outputRecipe(ht,rt))]},At.prototype.outputRecipe=function(ht,rt){return["seq",er(this,rt)].concat(this.factors.map(lt=>lt.outputRecipe(ht,rt)))},Mt.prototype.outputRecipe=Ot.prototype.outputRecipe=kt.prototype.outputRecipe=yt.prototype.outputRecipe=St.prototype.outputRecipe=Yt.prototype.outputRecipe=function(ht,rt){return[this.constructor.name.toLowerCase(),er(this,rt),this.expr.outputRecipe(ht,rt)]},Ft.prototype.outputRecipe=function(ht,rt){return["app",er(this,rt),this.ruleName,this.args.map(lt=>lt.outputRecipe(ht,rt))]},ln.prototype.outputRecipe=function(ht,rt){return["unicodeChar",er(this,rt),this.category]},nt.prototype.introduceParams=g("introduceParams"),it.introduceParams=ot.introduceParams=st.prototype.introduceParams=at.prototype.introduceParams=ct.prototype.introduceParams=ln.prototype.introduceParams=function(ht){return this},ft.prototype.introduceParams=function(ht){return this.terms.forEach((rt,lt,bt)=>{bt[lt]=rt.introduceParams(ht)}),this},At.prototype.introduceParams=function(ht){return this.factors.forEach((rt,lt,bt)=>{bt[lt]=rt.introduceParams(ht)}),this},Et.prototype.introduceParams=yt.prototype.introduceParams=St.prototype.introduceParams=Yt.prototype.introduceParams=function(ht){return this.expr=this.expr.introduceParams(ht),this},Ft.prototype.introduceParams=function(ht){const rt=ht.indexOf(this.ruleName);if(rt>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new ct(rt).withSource(this.source)}else return this.args.forEach((lt,bt,Ct)=>{Ct[bt]=lt.introduceParams(ht)}),this},nt.prototype.isNullable=function(ht){return this._isNullable(ht,Object.create(null))},nt.prototype._isNullable=g("_isNullable"),it._isNullable=at.prototype._isNullable=ct.prototype._isNullable=Ot.prototype._isNullable=ln.prototype._isNullable=function(ht,rt){return!1},ot._isNullable=function(ht,rt){return!0},st.prototype._isNullable=function(ht,rt){return typeof this.obj=="string"?this.obj==="":!1},ft.prototype._isNullable=function(ht,rt){return this.terms.length===0||this.terms.some(lt=>lt._isNullable(ht,rt))},At.prototype._isNullable=function(ht,rt){return this.factors.every(lt=>lt._isNullable(ht,rt))},Mt.prototype._isNullable=kt.prototype._isNullable=yt.prototype._isNullable=St.prototype._isNullable=function(ht,rt){return!0},Yt.prototype._isNullable=function(ht,rt){return this.expr._isNullable(ht,rt)},Ft.prototype._isNullable=function(ht,rt){const lt=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(rt,lt)){const{body:bt}=ht.rules[this.ruleName],Ct=bt.substituteParams(this.args);rt[lt]=!1,rt[lt]=Ct._isNullable(ht,rt)}return rt[lt]},nt.prototype.substituteParams=g("substituteParams"),it.substituteParams=ot.substituteParams=st.prototype.substituteParams=at.prototype.substituteParams=ln.prototype.substituteParams=function(ht){return this},ct.prototype.substituteParams=function(ht){return ht[this.index]},ft.prototype.substituteParams=function(ht){return new ft(this.terms.map(rt=>rt.substituteParams(ht)))},At.prototype.substituteParams=function(ht){return new At(this.factors.map(rt=>rt.substituteParams(ht)))},Et.prototype.substituteParams=yt.prototype.substituteParams=St.prototype.substituteParams=Yt.prototype.substituteParams=function(ht){return new this.constructor(this.expr.substituteParams(ht))},Ft.prototype.substituteParams=function(ht){if(this.args.length===0)return this;{const rt=this.args.map(lt=>lt.substituteParams(ht));return new Ft(this.ruleName,rt)}};function Tt(ht){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(ht)}function Nt(ht){const rt=Object.create(null);ht.forEach(lt=>{rt[lt]=(rt[lt]||0)+1}),Object.keys(rt).forEach(lt=>{if(rt[lt]<=1)return;let bt=1;ht.forEach((Ct,Gt)=>{Ct===lt&&(ht[Gt]=Ct+"_"+bt++)})})}nt.prototype.toArgumentNameList=g("toArgumentNameList"),it.toArgumentNameList=function(ht,rt){return["any"]},ot.toArgumentNameList=function(ht,rt){return["end"]},st.prototype.toArgumentNameList=function(ht,rt){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+ht]},at.prototype.toArgumentNameList=function(ht,rt){let lt=this.from+"_to_"+this.to;return Tt(lt)||(lt="_"+lt),Tt(lt)||(lt="$"+ht),[lt]},ft.prototype.toArgumentNameList=function(ht,rt){const lt=this.terms.map(Gt=>Gt.toArgumentNameList(ht,!0)),bt=[],Ct=lt[0].length;for(let Gt=0;Gt<Ct;Gt++){const rn=[];for(let mt=0;mt<this.terms.length;mt++)rn.push(lt[mt][Gt]);const dt=xe(rn);bt.push(dt.join("_or_"))}return rt||Nt(bt),bt},At.prototype.toArgumentNameList=function(ht,rt){let lt=[];return this.factors.forEach(bt=>{const Ct=bt.toArgumentNameList(ht,!0);lt=lt.concat(Ct),ht+=Ct.length}),rt||Nt(lt),lt},Et.prototype.toArgumentNameList=function(ht,rt){const lt=this.expr.toArgumentNameList(ht,rt).map(bt=>bt[bt.length-1]==="s"?bt+"es":bt+"s");return rt||Nt(lt),lt},kt.prototype.toArgumentNameList=function(ht,rt){return this.expr.toArgumentNameList(ht,rt).map(lt=>"opt"+lt[0].toUpperCase()+lt.slice(1))},yt.prototype.toArgumentNameList=function(ht,rt){return[]},St.prototype.toArgumentNameList=Yt.prototype.toArgumentNameList=function(ht,rt){return this.expr.toArgumentNameList(ht,rt)},Ft.prototype.toArgumentNameList=function(ht,rt){return[this.ruleName]},ln.prototype.toArgumentNameList=function(ht,rt){return["$"+ht]},ct.prototype.toArgumentNameList=function(ht,rt){return["param"+this.index]},nt.prototype.toDisplayString=g("toDisplayString"),ft.prototype.toDisplayString=At.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"},it.toDisplayString=ot.toDisplayString=Et.prototype.toDisplayString=yt.prototype.toDisplayString=St.prototype.toDisplayString=Yt.prototype.toDisplayString=st.prototype.toDisplayString=at.prototype.toDisplayString=ct.prototype.toDisplayString=function(){return this.toString()},Ft.prototype.toDisplayString=function(){if(this.args.length>0){const ht=this.args.map(rt=>rt.toDisplayString());return this.ruleName+"<"+ht.join(",")+">"}else return this.ruleName},ln.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function Vt(ht){return ht==="description"||ht==="string"||ht==="code"}class Ht{constructor(rt,lt,bt){if(!Vt(bt))throw new Error("invalid Failure type: "+bt);this.pexpr=rt,this.text=lt,this.type=bt,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(rt){return this.getText()===rt.getText()&&this.type===rt.type&&(!this.isFluffy()||this.isFluffy()&&rt.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){const rt=new Ht(this.pexpr,this.text,this.type);return this.isFluffy()&&rt.makeFluffy(),rt}toKey(){return this.toString()+"#"+this.type}}nt.prototype.toFailure=g("toFailure"),it.toFailure=function(ht){return new Ht(this,"any object","description")},ot.toFailure=function(ht){return new Ht(this,"end of input","description")},st.prototype.toFailure=function(ht){return new Ht(this,this.obj,"string")},at.prototype.toFailure=function(ht){return new Ht(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")},yt.prototype.toFailure=function(ht){const rt=this.expr===it?"nothing":"not "+this.expr.toFailure(ht);return new Ht(this,rt,"description")},St.prototype.toFailure=function(ht){return this.expr.toFailure(ht)},Ft.prototype.toFailure=function(ht){let{description:rt}=ht.rules[this.ruleName];return rt||(rt=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new Ht(this,rt,"description")},ln.prototype.toFailure=function(ht){return new Ht(this,"a Unicode ["+this.category+"] character","description")},ft.prototype.toFailure=function(ht){const lt="("+this.terms.map(bt=>bt.toFailure(ht)).join(" or ")+")";return new Ht(this,lt,"description")},At.prototype.toFailure=function(ht){const lt="("+this.factors.map(bt=>bt.toFailure(ht)).join(" ")+")";return new Ht(this,lt,"description")},Et.prototype.toFailure=function(ht){const rt="("+this.expr.toFailure(ht)+this.operator+")";return new Ht(this,rt,"description")},nt.prototype.toString=g("toString"),it.toString=function(){return"any"},ot.toString=function(){return"end"},st.prototype.toString=function(){return JSON.stringify(this.obj)},at.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)},ct.prototype.toString=function(){return"$"+this.index},Yt.prototype.toString=function(){return"#("+this.expr.toString()+")"},ft.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(ht=>ht.toString()).join(" | ")+")"},At.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(ht=>ht.toString()).join(" ")+")"},Et.prototype.toString=function(){return this.expr+this.operator},yt.prototype.toString=function(){return"~"+this.expr},St.prototype.toString=function(){return"&"+this.expr},Ft.prototype.toString=function(){if(this.args.length>0){const ht=this.args.map(rt=>rt.toString());return this.ruleName+"<"+ht.join(",")+">"}else return this.ruleName},ln.prototype.toString=function(){return"\\p{"+this.category+"}"};class Xt extends nt{constructor(rt){super(),this.obj=rt}_getString(rt){const lt=rt.currentApplication().args[this.obj.index];return a(lt instanceof st,"expected a Terminal expression"),lt.obj}allowsSkippingPrecedingSpace(){return!0}eval(rt){const{inputStream:lt}=rt,bt=lt.pos,Ct=this._getString(rt);return lt.matchString(Ct,!0)?(rt.pushBinding(new Vn(Ct.length),bt),!0):(rt.processFailure(bt,this),!1)}getArity(){return 1}substituteParams(rt){return new Xt(this.obj.substituteParams(rt))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(rt){return new Ht(this,this.obj.toFailure(rt)+" (case-insensitive)","description")}_isNullable(rt,lt){return this.obj._isNullable(rt,lt)}}var sn=Object.freeze({__proto__:null,CaseInsensitiveTerminal:Xt,PExpr:nt,any:it,end:ot,Terminal:st,Range:at,Param:ct,Alt:ft,Extend:ut,Splice:_t,Seq:At,Iter:Et,Star:Mt,Plus:Ot,Opt:kt,Not:yt,Lookahead:St,Lex:Yt,Apply:Ft,UnicodeChar:ln});let vn;cr(ht=>{vn=ht.rules.applySyntactic.body});const Dn=new Ft("spaces");class Sn{constructor(rt,lt,bt){this.matcher=rt,this.startExpr=lt,this.grammar=rt.grammar,this.input=rt.getInput(),this.inputStream=new jn(this.input),this.memoTable=rt._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],bt!==void 0&&(this.positionToRecordFailures=bt,this.recordedFailures=Object.create(null))}posToOffset(rt){return rt-this._posStack[this._posStack.length-1]}enterApplication(rt,lt){this._posStack.push(this.inputStream.pos),this._applicationStack.push(lt),this.inLexifiedContextStack.push(!1),rt.enter(lt),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(rt,lt){const bt=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),rt.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),lt&&this.pushBinding(lt,bt)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const rt=this.currentApplication();return rt?rt.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(Dn),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(rt){return rt.allowsSkippingPrecedingSpace()&&rt!==Dn?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(rt,lt){this._bindings.push(rt),this._bindingOffsets.push(this.posToOffset(lt))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(rt){for(;this._bindings.length>rt;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(rt){let lt=this.memoTable[rt];return lt||(lt=this.memoTable[rt]=new zt),lt}processFailure(rt,lt){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,rt),this.recordedFailures&&rt===this.positionToRecordFailures){const bt=this.currentApplication();bt&&(lt=lt.substituteParams(bt.args)),this.recordFailure(lt.toFailure(this.grammar),!1)}}recordFailure(rt,lt){const bt=rt.toKey();this.recordedFailures[bt]?this.recordedFailures[bt].isFluffy()&&!rt.isFluffy()&&this.recordedFailures[bt].clearFluffy():this.recordedFailures[bt]=lt?rt.clone():rt}recordFailures(rt,lt){Object.keys(rt).forEach(bt=>{this.recordFailure(rt[bt],lt)})}cloneRecordedFailures(){if(!this.recordedFailures)return;const rt=Object.create(null);return Object.keys(this.recordedFailures).forEach(lt=>{rt[lt]=this.recordedFailures[lt].clone()}),rt}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(rt,lt){const bt=this.memoTable[rt];if(bt&&lt instanceof Ft){const Ct=bt.memo[lt.toMemoKey()];if(Ct&&Ct.traceEntry){const Gt=Ct.traceEntry.cloneWithExpr(lt);return Gt.isMemoized=!0,Gt}}return null}getTraceEntry(rt,lt,bt,Ct){if(lt instanceof Ft){const Gt=this.currentApplication(),rn=Gt?Gt.args:[];lt=lt.substituteParams(rn)}return this.getMemoizedTraceEntry(rt,lt)||new zn(this.input,rt,this.inputStream.pos,lt,bt,Ct,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(rt){return this.trace&&!rt.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+rt.rightmostFailureOffset===this.positionToRecordFailures?!!rt.failuresAtRightmostPosition:!0}useMemoizedResult(rt,lt){this.trace&&this.trace.push(lt.traceEntry);const bt=this.inputStream.pos+lt.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,bt),this.recordedFailures&&this.positionToRecordFailures===bt&&lt.failuresAtRightmostPosition&&this.recordFailures(lt.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,lt.examinedLength+rt),lt.value?(this.inputStream.pos+=lt.matchLength,this.pushBinding(lt.value,rt),!0):!1}eval(rt){const{inputStream:lt}=this,bt=this._bindings.length,Ct=this.userData;let Gt;this.recordedFailures&&(Gt=this.recordedFailures,this.recordedFailures=Object.create(null));const rn=lt.pos,dt=this.maybeSkipSpacesBefore(rt);let mt;this.trace&&(mt=this.trace,this.trace=[]);const vt=rt.eval(this);if(this.trace){const It=this._bindings.slice(bt),Lt=this.getTraceEntry(dt,rt,vt,It);Lt.isImplicitSpaces=rt===Dn,Lt.isRootNode=rt===this.startExpr,mt.push(Lt),this.trace=mt}return vt?this.recordedFailures&&lt.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(It=>{this.recordedFailures[It].makeFluffy()}):(lt.pos=rn,this.truncateBindings(bt),this.userData=Ct),this.recordedFailures&&this.recordFailures(Gt,!1),rt===vn&&this.skipSpaces(),vt}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let rt;this.recordedFailures&&(rt=Object.keys(this.recordedFailures).map(bt=>this.recordedFailures[bt]));const lt=this._bindings[0];return lt&&(lt.grammar=this.grammar),new xt(this.matcher,this.input,this.startExpr,lt,this._bindingOffsets[0],this.rightmostFailurePosition,rt)}getTrace(){this.trace=[];const rt=this.getMatchResult(),lt=this.trace[this.trace.length-1];return lt.result=rt,lt}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class xn{constructor(rt){this.grammar=rt,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(rt){return this._input!==rt&&this.replaceInputRange(0,this._input.length,rt),this}replaceInputRange(rt,lt,bt){const Ct=this._input,Gt=this._memoTable;if(rt<0||rt>Ct.length||lt<0||lt>Ct.length||rt>lt)throw new Error("Invalid indices: "+rt+" and "+lt);this._input=Ct.slice(0,rt)+bt+Ct.slice(lt),this._input!==Ct&&Gt.length>0&&(this._isMemoTableStale=!0);const rn=Gt.slice(lt);Gt.length=rt;for(let dt=0;dt<bt.length;dt++)Gt.push(void 0);for(const dt of rn)Gt.push(dt);for(let dt=0;dt<rt;dt++){const mt=Gt[dt];mt&&mt.clearObsoleteEntries(dt,rt)}return this}match(rt,lt={incremental:!0}){return this._match(this._getStartExpr(rt),{incremental:lt.incremental,tracing:!1})}trace(rt,lt={incremental:!0}){return this._match(this._getStartExpr(rt),{incremental:lt.incremental,tracing:!0})}_match(rt,lt={}){const bt={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...lt};if(!bt.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw On(this.grammar);const Ct=new Sn(this,rt,bt.positionToRecordFailures);return bt.tracing?Ct.getTrace():Ct.getMatchResult()}_getStartExpr(rt){const lt=rt||this.grammar.defaultStartRule;if(!lt)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const bt=this.grammar.parseApplication(lt);return new At([bt,ot])}}const Bn=[],lr=(ht,rt)=>Object.prototype.hasOwnProperty.call(ht,rt);class fr{constructor(rt,lt,bt){this._node=rt,this.source=lt,this._baseInterval=bt,rt.isNonterminal()&&a(lt===bt),this._childWrappers=[]}_forgetMemoizedResultFor(rt){delete this._node[this._semantics.attributeKeys[rt]],this.children.forEach(lt=>{lt._forgetMemoizedResultFor(rt)})}child(rt){if(!(0<=rt&&rt<this._node.numChildren()))return;let lt=this._childWrappers[rt];if(!lt){const bt=this._node.childAt(rt),Ct=this._node.childOffsets[rt],Gt=this._baseInterval.subInterval(Ct,bt.matchLength),rn=bt.isNonterminal()?Gt:this._baseInterval;lt=this._childWrappers[rt]=this._semantics.wrap(bt,Gt,rn)}return lt}_children(){for(let rt=0;rt<this._node.numChildren();rt++)this.child(rt);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(rt){const lt=rt||[],bt=lt.map(rn=>rn._node),Ct=new _r(bt,[],-1,!1),Gt=this._semantics.wrap(Ct,null,null);return Gt._childWrappers=lt,Gt}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class en{constructor(rt,lt){const bt=this;if(this.grammar=rt,this.checkedActionDicts=!1,this.Wrapper=class extends(lt?lt.Wrapper:fr){constructor(Ct,Gt,rn){super(Ct,Gt,rn),bt.checkActionDictsIfHaventAlready(),this._semantics=bt}toString(){return"[semantics wrapper for "+bt.grammar.name+"]"}},this.super=lt,lt){if(!(rt.equals(this.super.grammar)||rt._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+rt.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const Ct in this.attributes)Object.defineProperty(this.attributeKeys,Ct,{value:ur(Ct)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let rt;for(rt in this.operations)this.operations[rt].checkActionDict(this.grammar);for(rt in this.attributes)this.attributes[rt].checkActionDict(this.grammar)}toRecipe(rt){function lt(Ct){return Ct.super!==en.BuiltInSemantics._getSemantics()}let bt=`(function(g) {
`;if(lt(this)){bt+="  var semantics = "+this.super.toRecipe(!0)+"(g";const Ct=this.super.grammar;let Gt=this.grammar;for(;Gt!==Ct;)bt+=".superGrammar",Gt=Gt.superGrammar;bt+=`);
`,bt+="  return g.extendSemantics(semantics)"}else bt+="  return g.createSemantics()";return["Operation","Attribute"].forEach(Ct=>{const Gt=this[Ct.toLowerCase()+"s"];Object.keys(Gt).forEach(rn=>{const{actionDict:dt,formals:mt,builtInDefault:vt}=Gt[rn];let It=rn;mt.length>0&&(It+="("+mt.join(", ")+")");let Lt;lt(this)&&this.super[Ct.toLowerCase()+"s"][rn]?Lt="extend"+Ct:Lt="add"+Ct,bt+=`
    .`+Lt+"("+JSON.stringify(It)+", {";const jt=[];Object.keys(dt).forEach(on=>{if(dt[on]!==vt){let wn=dt[on].toString().trim();wn=wn.replace(/^.*\(/,"function("),jt.push(`
      `+JSON.stringify(on)+": "+wn)}}),bt+=jt.join(",")+`
    })`})}),bt+=`;
  })`,rt||(bt=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+bt+`(grammar);
  return semantics;
});
`),bt}addOperationOrAttribute(rt,lt,bt){const Ct=rt+"s",Gt=qn(lt,rt),{name:rn}=Gt,{formals:dt}=Gt;this.assertNewName(rn,rt);const mt=nr(rt,rn,Lt),vt={_default:mt};Object.keys(bt).forEach(jt=>{vt[jt]=bt[jt]});const It=rt==="operation"?new Pn(rn,dt,vt,mt):new Qn(rn,vt,mt);It.checkActionDict(this.grammar),this[Ct][rn]=It;function Lt(...jt){const on=this._semantics[Ct][rn];if(arguments.length!==on.formals.length)throw new Error("Invalid number of arguments passed to "+rn+" "+rt+" (expected "+on.formals.length+", got "+arguments.length+")");const wn=Object.create(null);for(const[or,Ir]of Object.entries(jt)){const kr=on.formals[or];wn[kr]=Ir}const Ln=this.args;this.args=wn;const Rn=on.execute(this._semantics,this);return this.args=Ln,Rn}rt==="operation"?(this.Wrapper.prototype[rn]=Lt,this.Wrapper.prototype[rn].toString=function(){return"["+rn+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,rn,{get:Lt,configurable:!0}),Object.defineProperty(this.attributeKeys,rn,{value:ur(rn)}))}extendOperationOrAttribute(rt,lt,bt){const Ct=rt+"s";if(qn(lt,"attribute"),!(this.super&&lt in this.super[Ct]))throw new Error("Cannot extend "+rt+" '"+lt+"': did not inherit an "+rt+" with that name");if(lr(this[Ct],lt))throw new Error("Cannot extend "+rt+" '"+lt+"' again");const Gt=this[Ct][lt].formals,rn=this[Ct][lt].actionDict,dt=Object.create(rn);Object.keys(bt).forEach(mt=>{dt[mt]=bt[mt]}),this[Ct][lt]=rt==="operation"?new Pn(lt,Gt,dt):new Qn(lt,dt),this[Ct][lt].checkActionDict(this.grammar)}assertNewName(rt,lt){if(lr(fr.prototype,rt))throw new Error("Cannot add "+lt+" '"+rt+"': that's a reserved name");if(rt in this.operations)throw new Error("Cannot add "+lt+" '"+rt+"': an operation with that name already exists");if(rt in this.attributes)throw new Error("Cannot add "+lt+" '"+rt+"': an attribute with that name already exists")}wrap(rt,lt,bt){const Ct=bt||lt;return rt instanceof this.Wrapper?rt:new this.Wrapper(rt,lt,Ct)}}function qn(ht,rt){if(!en.prototypeGrammar)return a(ht.indexOf("(")===-1),{name:ht,formals:[]};const lt=en.prototypeGrammar.match(ht,rt==="operation"?"OperationSignature":"AttributeSignature");if(lt.failed())throw new Error(lt.message);return en.prototypeGrammarSemantics(lt).parse()}function nr(ht,rt,lt){return function(...bt){const Gt=(this._semantics.operations[rt]||this._semantics.attributes[rt]).formals.map(rn=>this.args[rn]);if(!this.isIteration()&&bt.length===1)return lt.apply(bt[0],Gt);throw nn(this.ctorName,rt,ht,Bn)}}en.createSemantics=function(ht,rt){const lt=new en(ht,rt!==void 0?rt:en.BuiltInSemantics._getSemantics()),bt=function(Gt){if(!(Gt instanceof xt))throw new TypeError("Semantics expected a MatchResult, but got "+Ye(Gt));if(Gt.failed())throw new TypeError("cannot apply Semantics to "+Gt.toString());const rn=Gt._cst;if(rn.grammar!==ht)throw new Error("Cannot use a MatchResult from grammar '"+rn.grammar.name+"' with a semantics for '"+ht.name+"'");const dt=new jn(Gt.input);return lt.wrap(rn,dt.interval(Gt._cstOffset,Gt.input.length))};return bt.addOperation=function(Ct,Gt){return lt.addOperationOrAttribute("operation",Ct,Gt),bt},bt.extendOperation=function(Ct,Gt){return lt.extendOperationOrAttribute("operation",Ct,Gt),bt},bt.addAttribute=function(Ct,Gt){return lt.addOperationOrAttribute("attribute",Ct,Gt),bt},bt.extendAttribute=function(Ct,Gt){return lt.extendOperationOrAttribute("attribute",Ct,Gt),bt},bt._getActionDict=function(Ct){const Gt=lt.operations[Ct]||lt.attributes[Ct];if(!Gt)throw new Error('"'+Ct+'" is not a valid operation or attribute name in this semantics for "'+ht.name+'"');return Gt.actionDict},bt._remove=function(Ct){let Gt;return Ct in lt.operations?(Gt=lt.operations[Ct],delete lt.operations[Ct]):Ct in lt.attributes&&(Gt=lt.attributes[Ct],delete lt.attributes[Ct]),delete lt.Wrapper.prototype[Ct],Gt},bt.getOperationNames=function(){return Object.keys(lt.operations)},bt.getAttributeNames=function(){return Object.keys(lt.attributes)},bt.getGrammar=function(){return lt.grammar},bt.toRecipe=function(Ct){return lt.toRecipe(Ct)},bt.toString=lt.toString.bind(lt),bt._getSemantics=function(){return lt},bt};class Pn{constructor(rt,lt,bt,Ct){this.name=rt,this.formals=lt,this.actionDict=bt,this.builtInDefault=Ct}checkActionDict(rt){rt._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(rt,lt){try{const{ctorName:bt}=lt._node;let Ct=this.actionDict[bt];return Ct?(Bn.push([this,bt]),Ct.apply(lt,lt._children())):lt.isNonterminal()&&(Ct=this.actionDict._nonterminal,Ct)?(Bn.push([this,"_nonterminal",bt]),Ct.apply(lt,lt._children())):(Bn.push([this,"default action",bt]),this.actionDict._default.apply(lt,lt._children()))}finally{Bn.pop()}}}Pn.prototype.typeName="operation";class Qn extends Pn{constructor(rt,lt,bt){super(rt,[],lt,bt)}execute(rt,lt){const bt=lt._node,Ct=rt.attributeKeys[this.name];return lr(bt,Ct)||(bt[Ct]=Pn.prototype.execute.call(this,rt,lt)),bt[Ct]}}Qn.prototype.typeName="attribute";const gr=["_iter","_terminal","_nonterminal","_default"];function rr(ht){return Object.keys(ht.rules).sort().map(rt=>ht.rules[rt])}const xr=ht=>ht.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");let dr,yr;class pr{constructor(rt,lt,bt,Ct){if(this.name=rt,this.superGrammar=lt,this.rules=bt,Ct){if(!(Ct in bt))throw new Error("Invalid start rule: '"+Ct+"' is not a rule in grammar '"+rt+"'");this.defaultStartRule=Ct}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new xn(this)}isBuiltIn(){return this===pr.ProtoBuiltInRules||this===pr.BuiltInRules}equals(rt){if(this===rt)return!0;if(rt==null||this.name!==rt.name||this.defaultStartRule!==rt.defaultStartRule||!(this.superGrammar===rt.superGrammar||this.superGrammar.equals(rt.superGrammar)))return!1;const lt=rr(this),bt=rr(rt);return lt.length===bt.length&&lt.every((Ct,Gt)=>Ct.description===bt[Gt].description&&Ct.formals.join(",")===bt[Gt].formals.join(",")&&Ct.body.toString()===bt[Gt].body.toString())}match(rt,lt){const bt=this.matcher();return bt.replaceInputRange(0,0,rt),bt.match(lt)}trace(rt,lt){const bt=this.matcher();return bt.replaceInputRange(0,0,rt),bt.trace(lt)}createSemantics(){return en.createSemantics(this)}extendSemantics(rt){return en.createSemantics(this,rt._getSemantics())}_checkTopDownActionDict(rt,lt,bt){const Ct=[];for(const Gt in bt){const rn=bt[Gt];if(!gr.includes(Gt)&&!(Gt in this.rules)){Ct.push(`'${Gt}' is not a valid semantic action for '${this.name}'`);continue}if(typeof rn!="function"){Ct.push(`'${Gt}' must be a function in an action dictionary for '${this.name}'`);continue}const mt=rn.length,vt=this._topDownActionArity(Gt);if(mt!==vt){let It;Gt==="_iter"||Gt==="_nonterminal"?It=`it should use a rest parameter, e.g. \`${Gt}(...children) {}\`. NOTE: this is new in Ohm v16 — see https://ohmjs.org/d/ati for details.`:It=`expected ${vt}, got ${mt}`,Ct.push(`Semantic action '${Gt}' has the wrong arity: ${It}`)}}if(Ct.length>0){const Gt=Ct.map(dt=>"- "+dt),rn=new Error([`Found errors in the action dictionary of the '${lt}' ${rt}:`,...Gt].join(`
`));throw rn.problems=Ct,rn}}_topDownActionArity(rt){return gr.includes(rt)?0:this.rules[rt].body.getArity()}_inheritsFrom(rt){let lt=this.superGrammar;for(;lt;){if(lt.equals(rt,!0))return!0;lt=lt.superGrammar}return!1}toRecipe(rt=void 0){const lt={};this.source&&(lt.source=this.source.contents);let bt=null;this.defaultStartRule&&(bt=this.defaultStartRule);const Ct={};Object.keys(this.rules).forEach(dt=>{const mt=this.rules[dt],{body:vt}=mt,It=!this.superGrammar||!this.superGrammar.rules[dt];let Lt;It?Lt="define":Lt=vt instanceof ut?"extend":"override";const jt={};if(mt.source&&this.source){const Ln=mt.source.relativeTo(this.source);jt.sourceInterval=[Ln.startIdx,Ln.endIdx]}const on=It?mt.description:null,wn=vt.outputRecipe(mt.formals,this.source);Ct[dt]=[Lt,jt,on,mt.formals,wn]});let Gt="null";rt?Gt=rt:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(Gt=this.superGrammar.toRecipe());const rn=[...["grammar",lt,this.name].map(JSON.stringify),Gt,...[bt,Ct].map(JSON.stringify)];return xr(`[${rn.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const rt=new d;rt.append("{");let lt=!0;for(const bt in this.rules){const{body:Ct}=this.rules[bt];lt?lt=!1:rt.append(","),rt.append(`
`),rt.append("  "),this.addSemanticActionTemplate(bt,Ct,rt)}return rt.append(`
}`),rt.contents()}addSemanticActionTemplate(rt,lt,bt){bt.append(rt),bt.append(": function(");const Ct=this._topDownActionArity(rt);bt.append(R("_",Ct).join(", ")),bt.append(`) {
`),bt.append("  }")}parseApplication(rt){let lt;if(rt.indexOf("<")===-1)lt=new Ft(rt);else{const Ct=dr.match(rt,"Base_application");lt=yr(Ct,{})}if(!(lt.ruleName in this.rules))throw En(lt.ruleName,this.name);const{formals:bt}=this.rules[lt.ruleName];if(bt.length!==lt.args.length){const{source:Ct}=this.rules[lt.ruleName];throw un(lt.ruleName,bt.length,lt.args.length,Ct)}return lt}_setUpMatchState(rt){this._matchStateInitializer&&this._matchStateInitializer(rt)}}pr.ProtoBuiltInRules=new pr("ProtoBuiltInRules",void 0,{any:{body:it,formals:[],description:"any character",primitive:!0},end:{body:ot,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new Xt(new ct(0)),formals:["str"],primitive:!0},lower:{body:new ln("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new ln("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new ln("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new Mt(new Ft("space")),formals:[]},space:{body:new at("\0"," "),formals:[],description:"a space"}}),pr.initApplicationParser=function(ht,rt){dr=ht,yr=rt};class Tr{constructor(rt){this.name=rt}sourceInterval(rt,lt){return this.source.subInterval(rt,lt-rt)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?pr.ProtoBuiltInRules:pr.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(rt,lt){const bt=this.ensureSuperGrammar().rules[rt];if(!bt)throw qt(rt,this.superGrammar.name,lt);return bt}installOverriddenOrExtendedRule(rt,lt,bt,Ct){const Gt=ee(lt);if(Gt.length>0)throw pn(rt,Gt,Ct);const rn=this.ensureSuperGrammar().rules[rt],dt=rn.formals,mt=dt?dt.length:0;if(lt.length!==mt)throw un(rt,mt,lt.length,Ct);return this.install(rt,lt,bt,rn.description,Ct)}install(rt,lt,bt,Ct,Gt,rn=!1){return this.rules[rt]={body:bt.introduceParams(lt),formals:lt,description:Ct,source:Gt,primitive:rn},this}withSuperGrammar(rt){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=rt,this.rules=Object.create(rt.rules),rt.isBuiltIn()||(this.defaultStartRule=rt.defaultStartRule),this}withDefaultStartRule(rt){return this.defaultStartRule=rt,this}withSource(rt){return this.source=new jn(rt).interval(0,rt.length),this}build(){const rt=new pr(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);rt._matchStateInitializer=rt.superGrammar._matchStateInitializer,rt.supportsIncrementalParsing=rt.superGrammar.supportsIncrementalParsing;const lt=[];let bt=!1;return Object.keys(rt.rules).forEach(Ct=>{const{body:Gt}=rt.rules[Ct];try{Gt.assertChoicesHaveUniformArity(Ct)}catch(rn){lt.push(rn)}try{Gt.assertAllApplicationsAreValid(Ct,rt)}catch(rn){lt.push(rn),bt=!0}}),bt||Object.keys(rt.rules).forEach(Ct=>{const{body:Gt}=rt.rules[Ct];try{Gt.assertIteratedExprsAreNotNullable(rt,[])}catch(rn){lt.push(rn)}}),lt.length>0&&gn(lt),this.source&&(rt.source=this.source),rt}define(rt,lt,bt,Ct,Gt,rn){if(this.ensureSuperGrammar(),this.superGrammar.rules[rt])throw Wt(rt,this.name,this.superGrammar.name,Gt);if(this.rules[rt])throw Wt(rt,this.name,this.name,Gt);const dt=ee(lt);if(dt.length>0)throw pn(rt,dt,Gt);return this.install(rt,lt,bt,Ct,Gt,rn)}override(rt,lt,bt,Ct,Gt){return this.ensureSuperGrammarRuleForOverriding(rt,Gt),this.installOverriddenOrExtendedRule(rt,lt,bt,Gt),this}extend(rt,lt,bt,Ct,Gt){if(!this.ensureSuperGrammar().rules[rt])throw Jt(rt,this.superGrammar.name,Gt);const dt=new ut(this.superGrammar,rt,bt);return dt.source=bt.source,this.installOverriddenOrExtendedRule(rt,lt,dt,Gt),this}}class Er{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(rt){return new Tr(rt)}grammar(rt,lt,bt,Ct,Gt){const rn=new Tr(lt);return bt&&rn.withSuperGrammar(bt instanceof pr?bt:this.fromRecipe(bt)),Ct&&rn.withDefaultStartRule(Ct),rt&&rt.source&&rn.withSource(rt.source),this.currentDecl=rn,Object.keys(Gt).forEach(dt=>{this.currentRuleName=dt;const mt=Gt[dt],vt=mt[0],It=mt[1],Lt=mt[2],jt=mt[3],on=this.fromRecipe(mt[4]);let wn;rn.source&&It&&It.sourceInterval&&(wn=rn.source.subInterval(It.sourceInterval[0],It.sourceInterval[1]-It.sourceInterval[0])),rn[vt](dt,jt,on,Lt,wn)}),this.currentRuleName=this.currentDecl=null,rn.build()}terminal(rt){return new st(rt)}range(rt,lt){return new at(rt,lt)}param(rt){return new ct(rt)}alt(...rt){let lt=[];for(let bt of rt)bt instanceof nt||(bt=this.fromRecipe(bt)),bt instanceof ft?lt=lt.concat(bt.terms):lt.push(bt);return lt.length===1?lt[0]:new ft(lt)}seq(...rt){let lt=[];for(let bt of rt)bt instanceof nt||(bt=this.fromRecipe(bt)),bt instanceof At?lt=lt.concat(bt.factors):lt.push(bt);return lt.length===1?lt[0]:new At(lt)}star(rt){return rt instanceof nt||(rt=this.fromRecipe(rt)),new Mt(rt)}plus(rt){return rt instanceof nt||(rt=this.fromRecipe(rt)),new Ot(rt)}opt(rt){return rt instanceof nt||(rt=this.fromRecipe(rt)),new kt(rt)}not(rt){return rt instanceof nt||(rt=this.fromRecipe(rt)),new yt(rt)}lookahead(rt){return rt instanceof nt||(rt=this.fromRecipe(rt)),new St(rt)}lex(rt){return rt instanceof nt||(rt=this.fromRecipe(rt)),new Yt(rt)}app(rt,lt){return lt&&lt.length>0&&(lt=lt.map(function(bt){return bt instanceof nt?bt:this.fromRecipe(bt)},this)),new Ft(rt,lt)}splice(rt,lt){return new _t(this.currentDecl.superGrammar,this.currentRuleName,rt.map(bt=>this.fromRecipe(bt)),lt.map(bt=>this.fromRecipe(bt)))}fromRecipe(rt){const lt=rt[0]==="grammar"?rt.slice(1):rt.slice(2),bt=this[rt[0]](...lt),Ct=rt[1];return Ct&&Ct.sourceInterval&&this.currentDecl&&bt.withSource(this.currentDecl.sourceInterval(...Ct.sourceInterval)),bt}}function hr(ht){return typeof ht=="function"?ht.call(new Er):(typeof ht=="string"&&(ht=JSON.parse(ht)),new Er().fromRecipe(ht))}var Sr=hr(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);pr.BuiltInRules=Sr,bn(pr.BuiltInRules);var Pr=hr(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0","􏿿"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]);const mr=Object.create(nt.prototype);function Mr(ht,rt){for(const lt in ht)if(lt===rt)return!0;return!1}function Cr(ht,rt,lt){const bt=new Er;let Ct,Gt,rn,dt=!1;return(lt||Pr).createSemantics().addOperation("visit",{Grammars(It){return It.children.map(Lt=>Lt.visit())},Grammar(It,Lt,jt,on,wn){const Ln=It.visit();Ct=bt.newGrammar(Ln),Lt.child(0)&&Lt.child(0).visit(),on.children.map(or=>or.visit());const Rn=Ct.build();if(Rn.source=this.source.trimmed(),Mr(rt,Ln))throw _n(Rn);return rt[Ln]=Rn,Rn},SuperGrammar(It,Lt){const jt=Lt.visit();if(jt==="null")Ct.withSuperGrammar(null);else{if(!rt||!Mr(rt,jt))throw hn(jt,rt,Lt.source);Ct.withSuperGrammar(rt[jt])}},Rule_define(It,Lt,jt,on,wn){Gt=It.visit(),rn=Lt.children.map(Ir=>Ir.visit())[0]||[],!Ct.defaultStartRule&&Ct.ensureSuperGrammar()!==pr.ProtoBuiltInRules&&Ct.withDefaultStartRule(Gt);const Ln=wn.visit(),Rn=jt.children.map(Ir=>Ir.visit())[0],or=this.source.trimmed();return Ct.define(Gt,rn,Ln,Rn,or)},Rule_override(It,Lt,jt,on){Gt=It.visit(),rn=Lt.children.map(Rn=>Rn.visit())[0]||[];const wn=this.source.trimmed();Ct.ensureSuperGrammarRuleForOverriding(Gt,wn),dt=!0;const Ln=on.visit();return dt=!1,Ct.override(Gt,rn,Ln,null,wn)},Rule_extend(It,Lt,jt,on){Gt=It.visit(),rn=Lt.children.map(Rn=>Rn.visit())[0]||[];const wn=on.visit(),Ln=this.source.trimmed();return Ct.extend(Gt,rn,wn,null,Ln)},RuleBody(It,Lt){return bt.alt(...Lt.visit()).withSource(this.source)},OverrideRuleBody(It,Lt){const jt=Lt.visit(),on=jt.indexOf(mr);if(on>=0){const wn=jt.slice(0,on),Ln=jt.slice(on+1);return Ln.forEach(Rn=>{if(Rn===mr)throw kn(Rn)}),new _t(Ct.superGrammar,Gt,wn,Ln).withSource(this.source)}else return bt.alt(...jt).withSource(this.source)},Formals(It,Lt,jt){return Lt.visit()},Params(It,Lt,jt){return Lt.visit()},Alt(It){return bt.alt(...It.visit()).withSource(this.source)},TopLevelTerm_inline(It,Lt){const jt=Gt+"_"+Lt.visit(),on=It.visit(),wn=this.source.trimmed(),Ln=!(Ct.superGrammar&&Ct.superGrammar.rules[jt]);dt&&!Ln?Ct.override(jt,rn,on,null,wn):Ct.define(jt,rn,on,null,wn);const Rn=rn.map(or=>bt.app(or));return bt.app(jt,Rn).withSource(on.source)},OverrideTopLevelTerm_superSplice(It){return mr},Seq(It){return bt.seq(...It.children.map(Lt=>Lt.visit())).withSource(this.source)},Iter_star(It,Lt){return bt.star(It.visit()).withSource(this.source)},Iter_plus(It,Lt){return bt.plus(It.visit()).withSource(this.source)},Iter_opt(It,Lt){return bt.opt(It.visit()).withSource(this.source)},Pred_not(It,Lt){return bt.not(Lt.visit()).withSource(this.source)},Pred_lookahead(It,Lt){return bt.lookahead(Lt.visit()).withSource(this.source)},Lex_lex(It,Lt){return bt.lex(Lt.visit()).withSource(this.source)},Base_application(It,Lt){const jt=Lt.children.map(on=>on.visit())[0]||[];return bt.app(It.visit(),jt).withSource(this.source)},Base_range(It,Lt,jt){return bt.range(It.visit(),jt.visit()).withSource(this.source)},Base_terminal(It){return bt.terminal(It.visit()).withSource(this.source)},Base_paren(It,Lt,jt){return Lt.visit()},ruleDescr(It,Lt,jt){return Lt.visit()},ruleDescrText(It){return this.sourceString.trim()},caseName(It,Lt,jt,on,wn){return jt.visit()},name(It,Lt){return this.sourceString},nameFirst(It){},nameRest(It){},terminal(It,Lt,jt){return Lt.children.map(on=>on.visit()).join("")},oneCharTerminal(It,Lt,jt){return Lt.visit()},escapeChar(It){try{return Z(this.sourceString)}catch(Lt){throw Lt instanceof RangeError&&Lt.message.startsWith("Invalid code point ")?Kt(It):Lt}},NonemptyListOf(It,Lt,jt){return[It.visit()].concat(jt.children.map(on=>on.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(ht).visit()}var Ar=hr(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);Dr(pr.BuiltInRules),Or(Ar);function Dr(ht){const rt={empty(){return this.iteration()},nonEmpty(lt,bt,Ct){return this.iteration([lt].concat(Ct.children))}};en.BuiltInSemantics=en.createSemantics(ht,null).addOperation("asIteration",{emptyListOf:rt.empty,nonemptyListOf:rt.nonEmpty,EmptyListOf:rt.empty,NonemptyListOf:rt.nonEmpty})}function Or(ht){en.prototypeGrammarSemantics=ht.createSemantics().addOperation("parse",{AttributeSignature(rt){return{name:rt.parse(),formals:[]}},OperationSignature(rt,lt){return{name:rt.parse(),formals:lt.children.map(bt=>bt.parse())[0]||[]}},Formals(rt,lt,bt){return lt.asIteration().children.map(Ct=>Ct.parse())},name(rt,lt){return this.sourceString}}),en.prototypeGrammar=ht}function qr(ht){let rt=0;const lt=[0],bt=()=>lt[lt.length-1],Ct={},Gt=/( *).*(?:$|\r?\n|\r)/g;let rn;for(;(rn=Gt.exec(ht))!=null;){const[dt,mt]=rn;if(dt.length===0)break;const vt=mt.length,It=bt(),Lt=rt+vt;if(vt>It)lt.push(vt),Ct[Lt]=1;else if(vt<It){const jt=lt.length;for(;bt()!==vt;)lt.pop();Ct[Lt]=-1*(jt-lt.length)}rt+=dt.length}return lt.length>1&&(Ct[rt]=1-lt.length),Ct}const zr="an indented block",Rr="a dedent",Br=1114112;class Yn extends jn{constructor(rt){super(rt.input),this.state=rt}_indentationAt(rt){return this.state.userData[rt]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Br):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Br):super.nextCodePoint()}}class Ur extends nt{constructor(rt=!0){super(),this.isIndent=rt}allowsSkippingPrecedingSpace(){return!0}eval(rt){const{inputStream:lt}=rt,bt=rt.userData;rt.doNotMemoize=!0;const Ct=lt.pos,Gt=this.isIndent?1:-1;return(bt[Ct]||0)*Gt>0?(rt.userData=Object.create(bt),rt.userData[Ct]-=Gt,rt.pushBinding(new Vn(0),Ct),!0):(rt.processFailure(Ct,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(rt,lt){}_isNullable(rt,lt){return!1}assertChoicesHaveUniformArity(rt){}assertIteratedExprsAreNotNullable(rt){}introduceParams(rt){return this}substituteParams(rt){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(rt){const lt=this.isIndent?zr:Rr;return new Ht(this,lt,"description")}}const Kn=new Ft("indent"),Wn=new Ft("dedent"),jr=new _t(Sr,"any",[Kn,Wn],[]),Lr=new Er().newGrammar("IndentationSensitive").withSuperGrammar(Sr).define("indent",[],new Ur(!0),zr,void 0,!0).define("dedent",[],new Ur(!1),Rr,void 0,!0).extend("any",[],jr,"any character",void 0).build();Object.assign(Lr,{_matchStateInitializer(ht){ht.userData=qr(ht.input),ht.inputStream=new Yn(ht)},supportsIncrementalParsing:!1});const Wr="17.1.0";pr.initApplicationParser(Pr,Cr);const Hr=ht=>!!ht.constructor&&typeof ht.constructor.isBuffer=="function"&&ht.constructor.isBuffer(ht);function Kr(ht,rt){const lt=Pr.match(ht,"Grammars");if(lt.failed())throw $t(lt);return Cr(lt,rt)}function Yr(ht,rt){const lt=Vr(ht,rt),bt=Object.keys(lt);if(bt.length===0)throw new Error("Missing grammar definition");if(bt.length>1){const Gt=lt[bt[1]].source;throw new Error(Nn(Gt.sourceString,Gt.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return lt[bt[0]]}function Vr(ht,rt){const lt=Object.create(rt||{});if(typeof ht!="string")if(Hr(ht))ht=ht.toString();else throw new TypeError("Expected string as first argument, got "+Ye(ht));return Kr(ht,lt),lt}return ohm.ExperimentalIndentationSensitive=Lr,ohm._buildGrammar=Cr,ohm.grammar=Yr,ohm.grammars=Vr,ohm.makeRecipe=hr,ohm.ohmGrammar=Pr,ohm.pexprs=sn,ohm.version=Wr,ohm}var pep508_ohmBundle,hasRequiredPep508_ohmBundle;function requirePep508_ohmBundle(){if(hasRequiredPep508_ohmBundle)return pep508_ohmBundle;hasRequiredPep508_ohmBundle=1;const{makeRecipe:g}=requireOhm();return pep508_ohmBundle=g(["grammar",{source:`PEP508 {
    // Grammar adapted from https://peps.python.org/pep-0508/#complete-grammar
    // (naming retained, just reordered and camelCased)
    File = ListOf<Line, "\\n">
    Line = Req? comment?
    Req = UrlReq | NameReq | RequirementsReq | ConstraintsReq

    NameReq = Name Extras? VersionSpec QuotedMarker?
    UrlReq  = Name Extras? UrlSpec (space QuotedMarker)?
    Extras  = "[" ListOf<identifier, ","> "]"
    Name    = identifier
    identifier    = alnum identifierEnd*
    identifierEnd = alnum -- single
                  | (("-" | "_" | "." )* alnum) -- multi

    // Requirements based on other requirements files (not in PEP 508, but supported by pip)
    RequirementsReq = "-r" filePath
    ConstraintsReq  = "-c" filePath
    filePath        = (~("\\n" | "#") any)+

    UrlSpec      = "@" uriReference
    uriReference = uri | relativeRef
    uri          = scheme ":" hierPart? ("?" query )? ("#" fragment)?
    hierPart     = ("//" authority pathAbempty) -- abempty
                 | pathAbsolute -- absolute
                 | pathRootless -- rootless
    absoluteUri  = scheme ":" hierPart? ("?" query )?
    relativeRef  = relativePart? ("?" query )? ("#" fragment )?
    relativePart = "//" authority pathAbempty -- abempty
                 | pathAbsolute -- absolute
                 | pathNoscheme -- noscheme
    scheme       = letter (alnum | "+" | "-" | ".")*
    authority    = (userinfo "@" )? host (":" port )?
    userinfo     = (unreserved | pctEncoded | subDelims | ":")*
    host         = ipLiteral | ipv4Address | regName
    port         = digit*
    ipLiteral    = "[" (ipv6Address | ipvFuture) "]"
    ipvFuture    = "v" hexdig+ "." (unreserved | subDelims | ":")+
    ipv6Address  = (hexdig | ":" | ".")+ // dumbed down a lot, mostly due to lack of quantifier support in Ohm
    ipv4Address  = decOctet "." decOctet "." decOctet "." decOctet
    nz           = ~"0" digit
    decOctet     = digit -- zeroToNine
                 | nz digit -- tenToNinetyNine
                 | "1" digit digit -- oneHundredToOneNinetyNine
                 | "2" ("0" | "1" | "2" | "3" | "4") digit -- twoHundredToTwoFortyNine
                 | "25" ("0" | "1" | "2" | "3" | "4" | "5") -- twoFiftyToTwoFiftyFive
    regName      = (unreserved | pctEncoded | subDelims)*
    path         = pathAbempty // begins with "/" or is empty
                 | pathAbsolute // begins with "/" but not "//"
                 | pathNoscheme // begins with a non-colon segment
                 | pathRootless // begins with a segment
    pathAbempty  = ("/" segment)*
    pathAbsolute = "/" (segmentNz ("/" segment)* )?
    pathNoscheme = segmentNzNc ("/" segment)*
    pathRootless = segmentNz ("/" segment)*
    segment      = pchar*
    segmentNz    = pchar+
    segmentNzNc  = (unreserved | pctEncoded | subDelims | "@")+ // non-zero-length segment without any colon ":"
    pchar        = unreserved | pctEncoded | subDelims | ":" | "@"
    query        = (pchar | "/" | "?")*
    fragment     = (pchar | "/" | "?")*
    pctEncoded   = "%" hexdig
    unreserved   = alnum | "-" | "." | "_" | "~"
    reserved     = genDelims | subDelims
    genDelims    = ":" | "/" | "?" | "#" | "(" | ")?" | "@"
    subDelims    = "!" | "$" | "&" | "'" | "(" | ")" | "*" | "+" | "," | ";" | "="
    hexdig       = digit | "a" | "A" | "b" | "B" | "c" | "C" | "d" | "D" | "e" | "E" | "f" | "F"

    // Environment markers
    QuotedMarker  = ";" Marker
    Marker        = MarkerOr
    MarkerOr      = MarkerAnd "or" MarkerAnd -- node
                  | MarkerAnd -- leaf
    MarkerAnd     = MarkerExpr "and" MarkerExpr -- node
                  | MarkerExpr -- leaf
    MarkerExpr    = MarkerVar markerOp MarkerVar -- leaf
                  | "(" Marker ")" -- node
    MarkerVar     = envVar | pythonStr
    markerOp      = versionCmp -- versionCmp
                  | "in" -- in
                  | ("not" space+ "in") -- notIn
    pythonStr     = "'" (pythonStrChar | "\\"")* "'"
                  | "\\"" (pythonStrChar | "'")* "\\""
    pythonStrChar = space | alnum | "(" | ")" | "." | "{" | "}" | "-" | "_" | "*" | "#" | ":" | ";" | "," | "/" | "?"
                  | "[" | "]" | "!" | "~" | "\`" | "@" | "$" | "%" | "^" | "&" | "=" | "+" | "|" | "<" | ">"
    envVar        = "python_version" | "python_full_version" | "os_name" | "sys_platform" | "platform_release"
                  | "platform_system" | "platform_version" | "platform_machine" | "platform_python_implementation"
                  | "implementation_name" | "implementation_version" | "extra" // ONLY when defined by a containing layer

    // Version specifiers, defined in PEP 440 (https://peps.python.org/pep-0440/)
    VersionSpec   = "(" VersionMany ")" -- parenthesized
                  | VersionMany -- direct
    VersionMany   = ListOf<VersionOne, ",">
    VersionOne    = versionCmp version
    versionCmp    = "<=" | "<" | "!=" | "==" | ">=" | ">" | "~=" | "==="
    version       = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+

    comment = "#" (~"\\n" any)*

    space := " " | "\\t" // Overriding Ohm's definition of whitespace to kick out newlines and other Unicode whitespace

    // Loose grammar for parsing unfinished requirements - focused on extracting the name, extras, and version spec
    LooseFile         = ListOf<LooseLine, "\\n">
    LooseLine         = LooseReq comment?
    LooseReq          = LooseNonNameReq | LooseNameReq
    LooseNameReq      = Name LooseExtras? LooseVersionSpec LooseQuotedMarker?
    LooseNonNameReq   = (~(~(Name "@") Name) looseAnything) // Non-name req can start with Name only if followed by "@"
    LooseExtras       = "[" ListOf<identifier, ","> ","* "]"?
    LooseQuotedMarker = ";" looseAnything
    LooseVersionSpec  = "(" LooseVersionMany ")"? -- parenthesized
                      | LooseVersionMany -- direct
    LooseVersionMany  = ListOf<LooseVersionOne, ","> ","*
    LooseVersionOne   = looseVersionCmp looseVersion?
    looseVersionCmp   = ("<" | "=" | "!" | ">" | "~")+
    looseVersion      = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+
    looseAnything     = (~("\\n" | "#") any)* // Any non-comment line content
}`},"PEP508",null,"File",{File:["define",{sourceInterval:[148,173]},null,[],["app",{sourceInterval:[155,173]},"ListOf",[["app",{sourceInterval:[162,166]},"Line",[]],["terminal",{sourceInterval:[168,172]},`
`]]]],Line:["define",{sourceInterval:[178,198]},null,[],["seq",{sourceInterval:[185,198]},["opt",{sourceInterval:[185,189]},["app",{sourceInterval:[185,188]},"Req",[]]],["opt",{sourceInterval:[190,198]},["app",{sourceInterval:[190,197]},"comment",[]]]]],Req:["define",{sourceInterval:[203,260]},null,[],["alt",{sourceInterval:[209,260]},["app",{sourceInterval:[209,215]},"UrlReq",[]],["app",{sourceInterval:[218,225]},"NameReq",[]],["app",{sourceInterval:[228,243]},"RequirementsReq",[]],["app",{sourceInterval:[246,260]},"ConstraintsReq",[]]]],NameReq:["define",{sourceInterval:[266,314]},null,[],["seq",{sourceInterval:[276,314]},["app",{sourceInterval:[276,280]},"Name",[]],["opt",{sourceInterval:[281,288]},["app",{sourceInterval:[281,287]},"Extras",[]]],["app",{sourceInterval:[289,300]},"VersionSpec",[]],["opt",{sourceInterval:[301,314]},["app",{sourceInterval:[301,313]},"QuotedMarker",[]]]]],UrlReq:["define",{sourceInterval:[319,371]},null,[],["seq",{sourceInterval:[329,371]},["app",{sourceInterval:[329,333]},"Name",[]],["opt",{sourceInterval:[334,341]},["app",{sourceInterval:[334,340]},"Extras",[]]],["app",{sourceInterval:[342,349]},"UrlSpec",[]],["opt",{sourceInterval:[350,371]},["seq",{sourceInterval:[351,369]},["app",{sourceInterval:[351,356]},"space",[]],["app",{sourceInterval:[357,369]},"QuotedMarker",[]]]]]],Extras:["define",{sourceInterval:[376,417]},null,[],["seq",{sourceInterval:[386,417]},["terminal",{sourceInterval:[386,389]},"["],["app",{sourceInterval:[390,413]},"ListOf",[["app",{sourceInterval:[397,407]},"identifier",[]],["terminal",{sourceInterval:[409,412]},","]]],["terminal",{sourceInterval:[414,417]},"]"]]],Name:["define",{sourceInterval:[422,442]},null,[],["app",{sourceInterval:[432,442]},"identifier",[]]],identifier:["define",{sourceInterval:[447,483]},null,[],["seq",{sourceInterval:[463,483]},["app",{sourceInterval:[463,468]},"alnum",[]],["star",{sourceInterval:[469,483]},["app",{sourceInterval:[469,482]},"identifierEnd",[]]]]],identifierEnd_single:["define",{sourceInterval:[504,519]},null,[],["app",{sourceInterval:[504,509]},"alnum",[]]],identifierEnd_multi:["define",{sourceInterval:[540,576]},null,[],["seq",{sourceInterval:[540,567]},["star",{sourceInterval:[541,560]},["alt",{sourceInterval:[542,557]},["terminal",{sourceInterval:[542,545]},"-"],["terminal",{sourceInterval:[548,551]},"_"],["terminal",{sourceInterval:[554,557]},"."]]],["app",{sourceInterval:[561,566]},"alnum",[]]]],identifierEnd:["define",{sourceInterval:[488,576]},null,[],["alt",{sourceInterval:[504,576]},["app",{sourceInterval:[504,509]},"identifierEnd_single",[]],["app",{sourceInterval:[540,567]},"identifierEnd_multi",[]]]],RequirementsReq:["define",{sourceInterval:[675,706]},null,[],["seq",{sourceInterval:[693,706]},["terminal",{sourceInterval:[693,697]},"-r"],["app",{sourceInterval:[698,706]},"filePath",[]]]],ConstraintsReq:["define",{sourceInterval:[711,742]},null,[],["seq",{sourceInterval:[729,742]},["terminal",{sourceInterval:[729,733]},"-c"],["app",{sourceInterval:[734,742]},"filePath",[]]]],filePath:["define",{sourceInterval:[747,785]},null,[],["plus",{sourceInterval:[765,785]},["seq",{sourceInterval:[766,783]},["not",{sourceInterval:[766,779]},["alt",{sourceInterval:[768,778]},["terminal",{sourceInterval:[768,772]},`
`],["terminal",{sourceInterval:[775,778]},"#"]]],["app",{sourceInterval:[780,783]},"any",[]]]]],UrlSpec:["define",{sourceInterval:[791,822]},null,[],["seq",{sourceInterval:[806,822]},["terminal",{sourceInterval:[806,809]},"@"],["app",{sourceInterval:[810,822]},"uriReference",[]]]],uriReference:["define",{sourceInterval:[827,859]},null,[],["alt",{sourceInterval:[842,859]},["app",{sourceInterval:[842,845]},"uri",[]],["app",{sourceInterval:[848,859]},"relativeRef",[]]]],uri:["define",{sourceInterval:[864,929]},null,[],["seq",{sourceInterval:[879,929]},["app",{sourceInterval:[879,885]},"scheme",[]],["terminal",{sourceInterval:[886,889]},":"],["opt",{sourceInterval:[890,899]},["app",{sourceInterval:[890,898]},"hierPart",[]]],["opt",{sourceInterval:[900,913]},["seq",{sourceInterval:[901,910]},["terminal",{sourceInterval:[901,904]},"?"],["app",{sourceInterval:[905,910]},"query",[]]]],["opt",{sourceInterval:[914,929]},["seq",{sourceInterval:[915,927]},["terminal",{sourceInterval:[915,918]},"#"],["app",{sourceInterval:[919,927]},"fragment",[]]]]]],hierPart_abempty:["define",{sourceInterval:[949,988]},null,[],["seq",{sourceInterval:[949,977]},["terminal",{sourceInterval:[950,954]},"//"],["app",{sourceInterval:[955,964]},"authority",[]],["app",{sourceInterval:[965,976]},"pathAbempty",[]]]],hierPart_absolute:["define",{sourceInterval:[1008,1032]},null,[],["app",{sourceInterval:[1008,1020]},"pathAbsolute",[]]],hierPart_rootless:["define",{sourceInterval:[1052,1076]},null,[],["app",{sourceInterval:[1052,1064]},"pathRootless",[]]],hierPart:["define",{sourceInterval:[934,1076]},null,[],["alt",{sourceInterval:[949,1076]},["app",{sourceInterval:[949,977]},"hierPart_abempty",[]],["app",{sourceInterval:[1008,1020]},"hierPart_absolute",[]],["app",{sourceInterval:[1052,1064]},"hierPart_rootless",[]]]],absoluteUri:["define",{sourceInterval:[1081,1130]},null,[],["seq",{sourceInterval:[1096,1130]},["app",{sourceInterval:[1096,1102]},"scheme",[]],["terminal",{sourceInterval:[1103,1106]},":"],["opt",{sourceInterval:[1107,1116]},["app",{sourceInterval:[1107,1115]},"hierPart",[]]],["opt",{sourceInterval:[1117,1130]},["seq",{sourceInterval:[1118,1127]},["terminal",{sourceInterval:[1118,1121]},"?"],["app",{sourceInterval:[1122,1127]},"query",[]]]]]],relativeRef:["define",{sourceInterval:[1135,1194]},null,[],["seq",{sourceInterval:[1150,1194]},["opt",{sourceInterval:[1150,1163]},["app",{sourceInterval:[1150,1162]},"relativePart",[]]],["opt",{sourceInterval:[1164,1177]},["seq",{sourceInterval:[1165,1174]},["terminal",{sourceInterval:[1165,1168]},"?"],["app",{sourceInterval:[1169,1174]},"query",[]]]],["opt",{sourceInterval:[1178,1194]},["seq",{sourceInterval:[1179,1191]},["terminal",{sourceInterval:[1179,1182]},"#"],["app",{sourceInterval:[1183,1191]},"fragment",[]]]]]],relativePart_abempty:["define",{sourceInterval:[1214,1251]},null,[],["seq",{sourceInterval:[1214,1240]},["terminal",{sourceInterval:[1214,1218]},"//"],["app",{sourceInterval:[1219,1228]},"authority",[]],["app",{sourceInterval:[1229,1240]},"pathAbempty",[]]]],relativePart_absolute:["define",{sourceInterval:[1271,1295]},null,[],["app",{sourceInterval:[1271,1283]},"pathAbsolute",[]]],relativePart_noscheme:["define",{sourceInterval:[1315,1339]},null,[],["app",{sourceInterval:[1315,1327]},"pathNoscheme",[]]],relativePart:["define",{sourceInterval:[1199,1339]},null,[],["alt",{sourceInterval:[1214,1339]},["app",{sourceInterval:[1214,1240]},"relativePart_abempty",[]],["app",{sourceInterval:[1271,1283]},"relativePart_absolute",[]],["app",{sourceInterval:[1315,1327]},"relativePart_noscheme",[]]]],scheme:["define",{sourceInterval:[1344,1392]},null,[],["seq",{sourceInterval:[1359,1392]},["app",{sourceInterval:[1359,1365]},"letter",[]],["star",{sourceInterval:[1366,1392]},["alt",{sourceInterval:[1367,1390]},["app",{sourceInterval:[1367,1372]},"alnum",[]],["terminal",{sourceInterval:[1375,1378]},"+"],["terminal",{sourceInterval:[1381,1384]},"-"],["terminal",{sourceInterval:[1387,1390]},"."]]]]],authority:["define",{sourceInterval:[1397,1446]},null,[],["seq",{sourceInterval:[1412,1446]},["opt",{sourceInterval:[1412,1428]},["seq",{sourceInterval:[1413,1425]},["app",{sourceInterval:[1413,1421]},"userinfo",[]],["terminal",{sourceInterval:[1422,1425]},"@"]]],["app",{sourceInterval:[1429,1433]},"host",[]],["opt",{sourceInterval:[1434,1446]},["seq",{sourceInterval:[1435,1443]},["terminal",{sourceInterval:[1435,1438]},":"],["app",{sourceInterval:[1439,1443]},"port",[]]]]]],userinfo:["define",{sourceInterval:[1451,1510]},null,[],["star",{sourceInterval:[1466,1510]},["alt",{sourceInterval:[1467,1508]},["app",{sourceInterval:[1467,1477]},"unreserved",[]],["app",{sourceInterval:[1480,1490]},"pctEncoded",[]],["app",{sourceInterval:[1493,1502]},"subDelims",[]],["terminal",{sourceInterval:[1505,1508]},":"]]]],host:["define",{sourceInterval:[1515,1563]},null,[],["alt",{sourceInterval:[1530,1563]},["app",{sourceInterval:[1530,1539]},"ipLiteral",[]],["app",{sourceInterval:[1542,1553]},"ipv4Address",[]],["app",{sourceInterval:[1556,1563]},"regName",[]]]],port:["define",{sourceInterval:[1568,1589]},null,[],["star",{sourceInterval:[1583,1589]},["app",{sourceInterval:[1583,1588]},"digit",[]]]],ipLiteral:["define",{sourceInterval:[1594,1642]},null,[],["seq",{sourceInterval:[1609,1642]},["terminal",{sourceInterval:[1609,1612]},"["],["alt",{sourceInterval:[1614,1637]},["app",{sourceInterval:[1614,1625]},"ipv6Address",[]],["app",{sourceInterval:[1628,1637]},"ipvFuture",[]]],["terminal",{sourceInterval:[1639,1642]},"]"]]],ipvFuture:["define",{sourceInterval:[1647,1709]},null,[],["seq",{sourceInterval:[1662,1709]},["terminal",{sourceInterval:[1662,1665]},"v"],["plus",{sourceInterval:[1666,1673]},["app",{sourceInterval:[1666,1672]},"hexdig",[]]],["terminal",{sourceInterval:[1674,1677]},"."],["plus",{sourceInterval:[1678,1709]},["alt",{sourceInterval:[1679,1707]},["app",{sourceInterval:[1679,1689]},"unreserved",[]],["app",{sourceInterval:[1692,1701]},"subDelims",[]],["terminal",{sourceInterval:[1704,1707]},":"]]]]],ipv6Address:["define",{sourceInterval:[1714,1750]},null,[],["plus",{sourceInterval:[1729,1750]},["alt",{sourceInterval:[1730,1748]},["app",{sourceInterval:[1730,1736]},"hexdig",[]],["terminal",{sourceInterval:[1739,1742]},":"],["terminal",{sourceInterval:[1745,1748]},"."]]]],ipv4Address:["define",{sourceInterval:[1825,1887]},null,[],["seq",{sourceInterval:[1840,1887]},["app",{sourceInterval:[1840,1848]},"decOctet",[]],["terminal",{sourceInterval:[1849,1852]},"."],["app",{sourceInterval:[1853,1861]},"decOctet",[]],["terminal",{sourceInterval:[1862,1865]},"."],["app",{sourceInterval:[1866,1874]},"decOctet",[]],["terminal",{sourceInterval:[1875,1878]},"."],["app",{sourceInterval:[1879,1887]},"decOctet",[]]]],nz:["define",{sourceInterval:[1892,1917]},null,[],["seq",{sourceInterval:[1907,1917]},["not",{sourceInterval:[1907,1911]},["terminal",{sourceInterval:[1908,1911]},"0"]],["app",{sourceInterval:[1912,1917]},"digit",[]]]],decOctet_zeroToNine:["define",{sourceInterval:[1937,1956]},null,[],["app",{sourceInterval:[1937,1942]},"digit",[]]],decOctet_tenToNinetyNine:["define",{sourceInterval:[1976,2003]},null,[],["seq",{sourceInterval:[1976,1984]},["app",{sourceInterval:[1976,1978]},"nz",[]],["app",{sourceInterval:[1979,1984]},"digit",[]]]],decOctet_oneHundredToOneNinetyNine:["define",{sourceInterval:[2023,2067]},null,[],["seq",{sourceInterval:[2023,2038]},["terminal",{sourceInterval:[2023,2026]},"1"],["app",{sourceInterval:[2027,2032]},"digit",[]],["app",{sourceInterval:[2033,2038]},"digit",[]]]],decOctet_twoHundredToTwoFortyNine:["define",{sourceInterval:[2087,2154]},null,[],["seq",{sourceInterval:[2087,2126]},["terminal",{sourceInterval:[2087,2090]},"2"],["alt",{sourceInterval:[2092,2119]},["terminal",{sourceInterval:[2092,2095]},"0"],["terminal",{sourceInterval:[2098,2101]},"1"],["terminal",{sourceInterval:[2104,2107]},"2"],["terminal",{sourceInterval:[2110,2113]},"3"],["terminal",{sourceInterval:[2116,2119]},"4"]],["app",{sourceInterval:[2121,2126]},"digit",[]]]],decOctet_twoFiftyToTwoFiftyFive:["define",{sourceInterval:[2174,2240]},null,[],["seq",{sourceInterval:[2174,2214]},["terminal",{sourceInterval:[2174,2178]},"25"],["alt",{sourceInterval:[2180,2213]},["terminal",{sourceInterval:[2180,2183]},"0"],["terminal",{sourceInterval:[2186,2189]},"1"],["terminal",{sourceInterval:[2192,2195]},"2"],["terminal",{sourceInterval:[2198,2201]},"3"],["terminal",{sourceInterval:[2204,2207]},"4"],["terminal",{sourceInterval:[2210,2213]},"5"]]]],decOctet:["define",{sourceInterval:[1922,2240]},null,[],["alt",{sourceInterval:[1937,2240]},["app",{sourceInterval:[1937,1942]},"decOctet_zeroToNine",[]],["app",{sourceInterval:[1976,1984]},"decOctet_tenToNinetyNine",[]],["app",{sourceInterval:[2023,2038]},"decOctet_oneHundredToOneNinetyNine",[]],["app",{sourceInterval:[2087,2126]},"decOctet_twoHundredToTwoFortyNine",[]],["app",{sourceInterval:[2174,2214]},"decOctet_twoFiftyToTwoFiftyFive",[]]]],regName:["define",{sourceInterval:[2245,2298]},null,[],["star",{sourceInterval:[2260,2298]},["alt",{sourceInterval:[2261,2296]},["app",{sourceInterval:[2261,2271]},"unreserved",[]],["app",{sourceInterval:[2274,2284]},"pctEncoded",[]],["app",{sourceInterval:[2287,2296]},"subDelims",[]]]]],path:["define",{sourceInterval:[2303,2523]},null,[],["alt",{sourceInterval:[2318,2523]},["app",{sourceInterval:[2318,2329]},"pathAbempty",[]],["app",{sourceInterval:[2380,2392]},"pathAbsolute",[]],["app",{sourceInterval:[2444,2456]},"pathNoscheme",[]],["app",{sourceInterval:[2511,2523]},"pathRootless",[]]]],pathAbempty:["define",{sourceInterval:[2553,2582]},null,[],["star",{sourceInterval:[2568,2582]},["seq",{sourceInterval:[2569,2580]},["terminal",{sourceInterval:[2569,2572]},"/"],["app",{sourceInterval:[2573,2580]},"segment",[]]]]],pathAbsolute:["define",{sourceInterval:[2587,2634]},null,[],["seq",{sourceInterval:[2602,2634]},["terminal",{sourceInterval:[2602,2605]},"/"],["opt",{sourceInterval:[2606,2634]},["seq",{sourceInterval:[2607,2631]},["app",{sourceInterval:[2607,2616]},"segmentNz",[]],["star",{sourceInterval:[2617,2631]},["seq",{sourceInterval:[2618,2629]},["terminal",{sourceInterval:[2618,2621]},"/"],["app",{sourceInterval:[2622,2629]},"segment",[]]]]]]]],pathNoscheme:["define",{sourceInterval:[2639,2680]},null,[],["seq",{sourceInterval:[2654,2680]},["app",{sourceInterval:[2654,2665]},"segmentNzNc",[]],["star",{sourceInterval:[2666,2680]},["seq",{sourceInterval:[2667,2678]},["terminal",{sourceInterval:[2667,2670]},"/"],["app",{sourceInterval:[2671,2678]},"segment",[]]]]]],pathRootless:["define",{sourceInterval:[2685,2724]},null,[],["seq",{sourceInterval:[2700,2724]},["app",{sourceInterval:[2700,2709]},"segmentNz",[]],["star",{sourceInterval:[2710,2724]},["seq",{sourceInterval:[2711,2722]},["terminal",{sourceInterval:[2711,2714]},"/"],["app",{sourceInterval:[2715,2722]},"segment",[]]]]]],segment:["define",{sourceInterval:[2729,2750]},null,[],["star",{sourceInterval:[2744,2750]},["app",{sourceInterval:[2744,2749]},"pchar",[]]]],segmentNz:["define",{sourceInterval:[2755,2776]},null,[],["plus",{sourceInterval:[2770,2776]},["app",{sourceInterval:[2770,2775]},"pchar",[]]]],segmentNzNc:["define",{sourceInterval:[2781,2840]},null,[],["plus",{sourceInterval:[2796,2840]},["alt",{sourceInterval:[2797,2838]},["app",{sourceInterval:[2797,2807]},"unreserved",[]],["app",{sourceInterval:[2810,2820]},"pctEncoded",[]],["app",{sourceInterval:[2823,2832]},"subDelims",[]],["terminal",{sourceInterval:[2835,2838]},"@"]]]],pchar:["define",{sourceInterval:[2894,2956]},null,[],["alt",{sourceInterval:[2909,2956]},["app",{sourceInterval:[2909,2919]},"unreserved",[]],["app",{sourceInterval:[2922,2932]},"pctEncoded",[]],["app",{sourceInterval:[2935,2944]},"subDelims",[]],["terminal",{sourceInterval:[2947,2950]},":"],["terminal",{sourceInterval:[2953,2956]},"@"]]],query:["define",{sourceInterval:[2961,2996]},null,[],["star",{sourceInterval:[2976,2996]},["alt",{sourceInterval:[2977,2994]},["app",{sourceInterval:[2977,2982]},"pchar",[]],["terminal",{sourceInterval:[2985,2988]},"/"],["terminal",{sourceInterval:[2991,2994]},"?"]]]],fragment:["define",{sourceInterval:[3001,3036]},null,[],["star",{sourceInterval:[3016,3036]},["alt",{sourceInterval:[3017,3034]},["app",{sourceInterval:[3017,3022]},"pchar",[]],["terminal",{sourceInterval:[3025,3028]},"/"],["terminal",{sourceInterval:[3031,3034]},"?"]]]],pctEncoded:["define",{sourceInterval:[3041,3066]},null,[],["seq",{sourceInterval:[3056,3066]},["terminal",{sourceInterval:[3056,3059]},"%"],["app",{sourceInterval:[3060,3066]},"hexdig",[]]]],unreserved:["define",{sourceInterval:[3071,3115]},null,[],["alt",{sourceInterval:[3086,3115]},["app",{sourceInterval:[3086,3091]},"alnum",[]],["terminal",{sourceInterval:[3094,3097]},"-"],["terminal",{sourceInterval:[3100,3103]},"."],["terminal",{sourceInterval:[3106,3109]},"_"],["terminal",{sourceInterval:[3112,3115]},"~"]]],reserved:["define",{sourceInterval:[3120,3156]},null,[],["alt",{sourceInterval:[3135,3156]},["app",{sourceInterval:[3135,3144]},"genDelims",[]],["app",{sourceInterval:[3147,3156]},"subDelims",[]]]],genDelims:["define",{sourceInterval:[3161,3216]},null,[],["alt",{sourceInterval:[3176,3216]},["terminal",{sourceInterval:[3176,3179]},":"],["terminal",{sourceInterval:[3182,3185]},"/"],["terminal",{sourceInterval:[3188,3191]},"?"],["terminal",{sourceInterval:[3194,3197]},"#"],["terminal",{sourceInterval:[3200,3203]},"("],["terminal",{sourceInterval:[3206,3210]},")?"],["terminal",{sourceInterval:[3213,3216]},"@"]]],subDelims:["define",{sourceInterval:[3221,3299]},null,[],["alt",{sourceInterval:[3236,3299]},["terminal",{sourceInterval:[3236,3239]},"!"],["terminal",{sourceInterval:[3242,3245]},"$"],["terminal",{sourceInterval:[3248,3251]},"&"],["terminal",{sourceInterval:[3254,3257]},"'"],["terminal",{sourceInterval:[3260,3263]},"("],["terminal",{sourceInterval:[3266,3269]},")"],["terminal",{sourceInterval:[3272,3275]},"*"],["terminal",{sourceInterval:[3278,3281]},"+"],["terminal",{sourceInterval:[3284,3287]},","],["terminal",{sourceInterval:[3290,3293]},";"],["terminal",{sourceInterval:[3296,3299]},"="]]],hexdig:["define",{sourceInterval:[3304,3396]},null,[],["alt",{sourceInterval:[3319,3396]},["app",{sourceInterval:[3319,3324]},"digit",[]],["terminal",{sourceInterval:[3327,3330]},"a"],["terminal",{sourceInterval:[3333,3336]},"A"],["terminal",{sourceInterval:[3339,3342]},"b"],["terminal",{sourceInterval:[3345,3348]},"B"],["terminal",{sourceInterval:[3351,3354]},"c"],["terminal",{sourceInterval:[3357,3360]},"C"],["terminal",{sourceInterval:[3363,3366]},"d"],["terminal",{sourceInterval:[3369,3372]},"D"],["terminal",{sourceInterval:[3375,3378]},"e"],["terminal",{sourceInterval:[3381,3384]},"E"],["terminal",{sourceInterval:[3387,3390]},"f"],["terminal",{sourceInterval:[3393,3396]},"F"]]],QuotedMarker:["define",{sourceInterval:[3429,3455]},null,[],["seq",{sourceInterval:[3445,3455]},["terminal",{sourceInterval:[3445,3448]},";"],["app",{sourceInterval:[3449,3455]},"Marker",[]]]],Marker:["define",{sourceInterval:[3460,3484]},null,[],["app",{sourceInterval:[3476,3484]},"MarkerOr",[]]],MarkerOr_node:["define",{sourceInterval:[3505,3537]},null,[],["seq",{sourceInterval:[3505,3529]},["app",{sourceInterval:[3505,3514]},"MarkerAnd",[]],["terminal",{sourceInterval:[3515,3519]},"or"],["app",{sourceInterval:[3520,3529]},"MarkerAnd",[]]]],MarkerOr_leaf:["define",{sourceInterval:[3558,3575]},null,[],["app",{sourceInterval:[3558,3567]},"MarkerAnd",[]]],MarkerOr:["define",{sourceInterval:[3489,3575]},null,[],["alt",{sourceInterval:[3505,3575]},["app",{sourceInterval:[3505,3529]},"MarkerOr_node",[]],["app",{sourceInterval:[3558,3567]},"MarkerOr_leaf",[]]]],MarkerAnd_node:["define",{sourceInterval:[3596,3631]},null,[],["seq",{sourceInterval:[3596,3623]},["app",{sourceInterval:[3596,3606]},"MarkerExpr",[]],["terminal",{sourceInterval:[3607,3612]},"and"],["app",{sourceInterval:[3613,3623]},"MarkerExpr",[]]]],MarkerAnd_leaf:["define",{sourceInterval:[3652,3670]},null,[],["app",{sourceInterval:[3652,3662]},"MarkerExpr",[]]],MarkerAnd:["define",{sourceInterval:[3580,3670]},null,[],["alt",{sourceInterval:[3596,3670]},["app",{sourceInterval:[3596,3623]},"MarkerAnd_node",[]],["app",{sourceInterval:[3652,3662]},"MarkerAnd_leaf",[]]]],MarkerExpr_leaf:["define",{sourceInterval:[3691,3727]},null,[],["seq",{sourceInterval:[3691,3719]},["app",{sourceInterval:[3691,3700]},"MarkerVar",[]],["app",{sourceInterval:[3701,3709]},"markerOp",[]],["app",{sourceInterval:[3710,3719]},"MarkerVar",[]]]],MarkerExpr_node:["define",{sourceInterval:[3748,3770]},null,[],["seq",{sourceInterval:[3748,3762]},["terminal",{sourceInterval:[3748,3751]},"("],["app",{sourceInterval:[3752,3758]},"Marker",[]],["terminal",{sourceInterval:[3759,3762]},")"]]],MarkerExpr:["define",{sourceInterval:[3675,3770]},null,[],["alt",{sourceInterval:[3691,3770]},["app",{sourceInterval:[3691,3719]},"MarkerExpr_leaf",[]],["app",{sourceInterval:[3748,3762]},"MarkerExpr_node",[]]]],MarkerVar:["define",{sourceInterval:[3775,3809]},null,[],["alt",{sourceInterval:[3791,3809]},["app",{sourceInterval:[3791,3797]},"envVar",[]],["app",{sourceInterval:[3800,3809]},"pythonStr",[]]]],markerOp_versionCmp:["define",{sourceInterval:[3830,3854]},null,[],["app",{sourceInterval:[3830,3840]},"versionCmp",[]]],markerOp_in:["define",{sourceInterval:[3875,3885]},null,[],["terminal",{sourceInterval:[3875,3879]},"in"]],markerOp_notIn:["define",{sourceInterval:[3906,3934]},null,[],["seq",{sourceInterval:[3906,3925]},["terminal",{sourceInterval:[3907,3912]},"not"],["plus",{sourceInterval:[3913,3919]},["app",{sourceInterval:[3913,3918]},"space",[]]],["terminal",{sourceInterval:[3920,3924]},"in"]]],markerOp:["define",{sourceInterval:[3814,3934]},null,[],["alt",{sourceInterval:[3830,3934]},["app",{sourceInterval:[3830,3840]},"markerOp_versionCmp",[]],["app",{sourceInterval:[3875,3879]},"markerOp_in",[]],["app",{sourceInterval:[3906,3925]},"markerOp_notIn",[]]]],pythonStr:["define",{sourceInterval:[3939,4039]},null,[],["alt",{sourceInterval:[3955,4039]},["seq",{sourceInterval:[3955,3986]},["terminal",{sourceInterval:[3955,3958]},"'"],["star",{sourceInterval:[3959,3982]},["alt",{sourceInterval:[3960,3980]},["app",{sourceInterval:[3960,3973]},"pythonStrChar",[]],["terminal",{sourceInterval:[3976,3980]},'"']]],["terminal",{sourceInterval:[3983,3986]},"'"]],["seq",{sourceInterval:[4007,4039]},["terminal",{sourceInterval:[4007,4011]},'"'],["star",{sourceInterval:[4012,4034]},["alt",{sourceInterval:[4013,4032]},["app",{sourceInterval:[4013,4026]},"pythonStrChar",[]],["terminal",{sourceInterval:[4029,4032]},"'"]]],["terminal",{sourceInterval:[4035,4039]},'"']]]],pythonStrChar:["define",{sourceInterval:[4044,4265]},null,[],["alt",{sourceInterval:[4060,4265]},["app",{sourceInterval:[4060,4065]},"space",[]],["app",{sourceInterval:[4068,4073]},"alnum",[]],["terminal",{sourceInterval:[4076,4079]},"("],["terminal",{sourceInterval:[4082,4085]},")"],["terminal",{sourceInterval:[4088,4091]},"."],["terminal",{sourceInterval:[4094,4097]},"{"],["terminal",{sourceInterval:[4100,4103]},"}"],["terminal",{sourceInterval:[4106,4109]},"-"],["terminal",{sourceInterval:[4112,4115]},"_"],["terminal",{sourceInterval:[4118,4121]},"*"],["terminal",{sourceInterval:[4124,4127]},"#"],["terminal",{sourceInterval:[4130,4133]},":"],["terminal",{sourceInterval:[4136,4139]},";"],["terminal",{sourceInterval:[4142,4145]},","],["terminal",{sourceInterval:[4148,4151]},"/"],["terminal",{sourceInterval:[4154,4157]},"?"],["terminal",{sourceInterval:[4178,4181]},"["],["terminal",{sourceInterval:[4184,4187]},"]"],["terminal",{sourceInterval:[4190,4193]},"!"],["terminal",{sourceInterval:[4196,4199]},"~"],["terminal",{sourceInterval:[4202,4205]},"`"],["terminal",{sourceInterval:[4208,4211]},"@"],["terminal",{sourceInterval:[4214,4217]},"$"],["terminal",{sourceInterval:[4220,4223]},"%"],["terminal",{sourceInterval:[4226,4229]},"^"],["terminal",{sourceInterval:[4232,4235]},"&"],["terminal",{sourceInterval:[4238,4241]},"="],["terminal",{sourceInterval:[4244,4247]},"+"],["terminal",{sourceInterval:[4250,4253]},"|"],["terminal",{sourceInterval:[4256,4259]},"<"],["terminal",{sourceInterval:[4262,4265]},">"]]],envVar:["define",{sourceInterval:[4270,4570]},null,[],["alt",{sourceInterval:[4286,4570]},["terminal",{sourceInterval:[4286,4302]},"python_version"],["terminal",{sourceInterval:[4305,4326]},"python_full_version"],["terminal",{sourceInterval:[4329,4338]},"os_name"],["terminal",{sourceInterval:[4341,4355]},"sys_platform"],["terminal",{sourceInterval:[4358,4376]},"platform_release"],["terminal",{sourceInterval:[4397,4414]},"platform_system"],["terminal",{sourceInterval:[4417,4435]},"platform_version"],["terminal",{sourceInterval:[4438,4456]},"platform_machine"],["terminal",{sourceInterval:[4459,4491]},"platform_python_implementation"],["terminal",{sourceInterval:[4512,4533]},"implementation_name"],["terminal",{sourceInterval:[4536,4560]},"implementation_version"],["terminal",{sourceInterval:[4563,4570]},"extra"]]],VersionSpec_parenthesized:["define",{sourceInterval:[4717,4753]},null,[],["seq",{sourceInterval:[4717,4736]},["terminal",{sourceInterval:[4717,4720]},"("],["app",{sourceInterval:[4721,4732]},"VersionMany",[]],["terminal",{sourceInterval:[4733,4736]},")"]]],VersionSpec_direct:["define",{sourceInterval:[4774,4795]},null,[],["app",{sourceInterval:[4774,4785]},"VersionMany",[]]],VersionSpec:["define",{sourceInterval:[4701,4795]},null,[],["alt",{sourceInterval:[4717,4795]},["app",{sourceInterval:[4717,4736]},"VersionSpec_parenthesized",[]],["app",{sourceInterval:[4774,4785]},"VersionSpec_direct",[]]]],VersionMany:["define",{sourceInterval:[4800,4839]},null,[],["app",{sourceInterval:[4816,4839]},"ListOf",[["app",{sourceInterval:[4823,4833]},"VersionOne",[]],["terminal",{sourceInterval:[4835,4838]},","]]]],VersionOne:["define",{sourceInterval:[4844,4878]},null,[],["seq",{sourceInterval:[4860,4878]},["app",{sourceInterval:[4860,4870]},"versionCmp",[]],["app",{sourceInterval:[4871,4878]},"version",[]]]],versionCmp:["define",{sourceInterval:[4883,4951]},null,[],["alt",{sourceInterval:[4899,4951]},["terminal",{sourceInterval:[4899,4903]},"<="],["terminal",{sourceInterval:[4906,4909]},"<"],["terminal",{sourceInterval:[4912,4916]},"!="],["terminal",{sourceInterval:[4919,4923]},"=="],["terminal",{sourceInterval:[4926,4930]},">="],["terminal",{sourceInterval:[4933,4936]},">"],["terminal",{sourceInterval:[4939,4943]},"~="],["terminal",{sourceInterval:[4946,4951]},"==="]]],version:["define",{sourceInterval:[4956,5017]},null,[],["plus",{sourceInterval:[4972,5017]},["alt",{sourceInterval:[4973,5014]},["app",{sourceInterval:[4973,4978]},"alnum",[]],["terminal",{sourceInterval:[4981,4984]},"-"],["terminal",{sourceInterval:[4987,4990]},"_"],["terminal",{sourceInterval:[4993,4996]},"."],["terminal",{sourceInterval:[4999,5002]},"*"],["terminal",{sourceInterval:[5005,5008]},"+"],["terminal",{sourceInterval:[5011,5014]},"!"]]]],comment:["define",{sourceInterval:[5023,5049]},null,[],["seq",{sourceInterval:[5033,5049]},["terminal",{sourceInterval:[5033,5036]},"#"],["star",{sourceInterval:[5037,5049]},["seq",{sourceInterval:[5038,5047]},["not",{sourceInterval:[5038,5043]},["terminal",{sourceInterval:[5039,5043]},`
`]],["app",{sourceInterval:[5044,5047]},"any",[]]]]]],space:["override",{sourceInterval:[5055,5074]},null,[],["alt",{sourceInterval:[5064,5074]},["terminal",{sourceInterval:[5064,5067]}," "],["terminal",{sourceInterval:[5070,5074]},"	"]]],LooseFile:["define",{sourceInterval:[5291,5334]},null,[],["app",{sourceInterval:[5311,5334]},"ListOf",[["app",{sourceInterval:[5318,5327]},"LooseLine",[]],["terminal",{sourceInterval:[5329,5333]},`
`]]]],LooseLine:["define",{sourceInterval:[5339,5376]},null,[],["seq",{sourceInterval:[5359,5376]},["app",{sourceInterval:[5359,5367]},"LooseReq",[]],["opt",{sourceInterval:[5368,5376]},["app",{sourceInterval:[5368,5375]},"comment",[]]]]],LooseReq:["define",{sourceInterval:[5381,5431]},null,[],["alt",{sourceInterval:[5401,5431]},["app",{sourceInterval:[5401,5416]},"LooseNonNameReq",[]],["app",{sourceInterval:[5419,5431]},"LooseNameReq",[]]]],LooseNameReq:["define",{sourceInterval:[5436,5509]},null,[],["seq",{sourceInterval:[5456,5509]},["app",{sourceInterval:[5456,5460]},"Name",[]],["opt",{sourceInterval:[5461,5473]},["app",{sourceInterval:[5461,5472]},"LooseExtras",[]]],["app",{sourceInterval:[5474,5490]},"LooseVersionSpec",[]],["opt",{sourceInterval:[5491,5509]},["app",{sourceInterval:[5491,5508]},"LooseQuotedMarker",[]]]]],LooseNonNameReq:["define",{sourceInterval:[5514,5569]},null,[],["seq",{sourceInterval:[5534,5569]},["not",{sourceInterval:[5535,5554]},["seq",{sourceInterval:[5537,5553]},["not",{sourceInterval:[5537,5548]},["seq",{sourceInterval:[5539,5547]},["app",{sourceInterval:[5539,5543]},"Name",[]],["terminal",{sourceInterval:[5544,5547]},"@"]]],["app",{sourceInterval:[5549,5553]},"Name",[]]]],["app",{sourceInterval:[5555,5568]},"looseAnything",[]]]],LooseExtras:["define",{sourceInterval:[5634,5691]},null,[],["seq",{sourceInterval:[5654,5691]},["terminal",{sourceInterval:[5654,5657]},"["],["app",{sourceInterval:[5658,5681]},"ListOf",[["app",{sourceInterval:[5665,5675]},"identifier",[]],["terminal",{sourceInterval:[5677,5680]},","]]],["star",{sourceInterval:[5682,5686]},["terminal",{sourceInterval:[5682,5685]},","]],["opt",{sourceInterval:[5687,5691]},["terminal",{sourceInterval:[5687,5690]},"]"]]]],LooseQuotedMarker:["define",{sourceInterval:[5696,5733]},null,[],["seq",{sourceInterval:[5716,5733]},["terminal",{sourceInterval:[5716,5719]},";"],["app",{sourceInterval:[5720,5733]},"looseAnything",[]]]],LooseVersionSpec_parenthesized:["define",{sourceInterval:[5758,5800]},null,[],["seq",{sourceInterval:[5758,5783]},["terminal",{sourceInterval:[5758,5761]},"("],["app",{sourceInterval:[5762,5778]},"LooseVersionMany",[]],["opt",{sourceInterval:[5779,5783]},["terminal",{sourceInterval:[5779,5782]},")"]]]],LooseVersionSpec_direct:["define",{sourceInterval:[5825,5851]},null,[],["app",{sourceInterval:[5825,5841]},"LooseVersionMany",[]]],LooseVersionSpec:["define",{sourceInterval:[5738,5851]},null,[],["alt",{sourceInterval:[5758,5851]},["app",{sourceInterval:[5758,5783]},"LooseVersionSpec_parenthesized",[]],["app",{sourceInterval:[5825,5841]},"LooseVersionSpec_direct",[]]]],LooseVersionMany:["define",{sourceInterval:[5856,5909]},null,[],["seq",{sourceInterval:[5876,5909]},["app",{sourceInterval:[5876,5904]},"ListOf",[["app",{sourceInterval:[5883,5898]},"LooseVersionOne",[]],["terminal",{sourceInterval:[5900,5903]},","]]],["star",{sourceInterval:[5905,5909]},["terminal",{sourceInterval:[5905,5908]},","]]]],LooseVersionOne:["define",{sourceInterval:[5914,5963]},null,[],["seq",{sourceInterval:[5934,5963]},["app",{sourceInterval:[5934,5949]},"looseVersionCmp",[]],["opt",{sourceInterval:[5950,5963]},["app",{sourceInterval:[5950,5962]},"looseVersion",[]]]]],looseVersionCmp:["define",{sourceInterval:[5968,6018]},null,[],["plus",{sourceInterval:[5988,6018]},["alt",{sourceInterval:[5989,6016]},["terminal",{sourceInterval:[5989,5992]},"<"],["terminal",{sourceInterval:[5995,5998]},"="],["terminal",{sourceInterval:[6001,6004]},"!"],["terminal",{sourceInterval:[6007,6010]},">"],["terminal",{sourceInterval:[6013,6016]},"~"]]]],looseVersion:["define",{sourceInterval:[6023,6088]},null,[],["plus",{sourceInterval:[6043,6088]},["alt",{sourceInterval:[6044,6085]},["app",{sourceInterval:[6044,6049]},"alnum",[]],["terminal",{sourceInterval:[6052,6055]},"-"],["terminal",{sourceInterval:[6058,6061]},"_"],["terminal",{sourceInterval:[6064,6067]},"."],["terminal",{sourceInterval:[6070,6073]},"*"],["terminal",{sourceInterval:[6076,6079]},"+"],["terminal",{sourceInterval:[6082,6085]},"!"]]]],looseAnything:["define",{sourceInterval:[6093,6133]},null,[],["star",{sourceInterval:[6113,6133]},["seq",{sourceInterval:[6114,6131]},["not",{sourceInterval:[6114,6127]},["alt",{sourceInterval:[6116,6126]},["terminal",{sourceInterval:[6116,6120]},`
`],["terminal",{sourceInterval:[6123,6126]},"#"]]],["app",{sourceInterval:[6128,6131]},"any",[]]]]]}]),pep508_ohmBundle}var semantics={},hasRequiredSemantics;function requireSemantics(){return hasRequiredSemantics||(hasRequiredSemantics=1,(function(g){var a=semantics&&semantics.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(g,"__esModule",{value:!0}),g.RequirementsSyntaxError=g.semantics=void 0;const l=a(requirePep508_ohmBundle());g.semantics=l.default.createSemantics();function A(R){return{startIdx:R.source.startIdx,endIdx:R.source.endIdx}}function O(R,ee){return{data:ee,location:A(R)}}g.semantics.addOperation("extract",{File:R=>R.asIteration().children.map(ee=>ee.extract()).filter(Boolean),Line:(R,ee)=>{var xe;return((xe=R.child(0))===null||xe===void 0?void 0:xe.extract())||null},NameReq:(R,ee,xe,ne)=>{var te,f;return{type:"ProjectName",name:R.sourceString,versionSpec:xe.extract(),extras:(te=ee.child(0))===null||te===void 0?void 0:te.extract(),environmentMarkerTree:(f=ne.child(0))===null||f===void 0?void 0:f.extract()}},UrlReq:(R,ee,xe,ne,te)=>{var f,d;return{type:"ProjectURL",name:R.sourceString,url:xe.extract(),extras:(f=ee.child(0))===null||f===void 0?void 0:f.extract(),environmentMarkerTree:(d=te.child(0))===null||d===void 0?void 0:d.extract()}},Extras:(R,ee,xe)=>ee.asIteration().children.map(ne=>ne.sourceString),RequirementsReq:(R,ee)=>({type:"RequirementsFile",path:ee.sourceString}),ConstraintsReq:(R,ee)=>({type:"ConstraintsFile",path:ee.sourceString}),UrlSpec:(R,ee)=>ee.sourceString,QuotedMarker:(R,ee)=>ee.extract(),MarkerOr_node:(R,ee,xe)=>({operator:"or",left:R.extract(),right:xe.extract()}),MarkerAnd_node:(R,ee,xe)=>({operator:"and",left:R.extract(),right:xe.extract()}),MarkerExpr_leaf:(R,ee,xe)=>({left:R.sourceString,operator:ee.sourceString,right:xe.sourceString}),MarkerExpr_node:(R,ee,xe)=>ee.extract(),VersionSpec_parenthesized:(R,ee,xe)=>ee.extract()||[],VersionMany:R=>{const ee=R.asIteration().children;if(ee.length!==0)return ee.map(xe=>xe.extract())},VersionOne:(R,ee)=>({operator:R.sourceString,version:ee.sourceString})}),g.semantics.addOperation("extractLoosely",{LooseFile:R=>R.asIteration().children.map(ee=>ee.extractLoosely()).filter(Boolean),LooseLine:(R,ee)=>{var xe;return((xe=R.child(0))===null||xe===void 0?void 0:xe.extractLoosely())||null},LooseNameReq:(R,ee,xe,ne)=>{var te;return{type:"ProjectName",name:R.sourceString,extras:(te=ee.child(0))===null||te===void 0?void 0:te.extractLoosely(),versionSpec:xe.extractLoosely()}},LooseNonNameReq:R=>null,LooseExtras:(R,ee,xe,ne)=>ee.asIteration().children.map(te=>te.sourceString),LooseVersionSpec_parenthesized:(R,ee,xe)=>ee.extractLoosely()||[],LooseVersionMany:(R,ee)=>{const xe=R.asIteration().children;if(xe.length!==0)return xe.map(ne=>ne.extractLoosely())},LooseVersionOne:(R,ee)=>{const xe={operator:R.sourceString};return ee.sourceString&&(xe.version=ee.sourceString),xe}}),g.semantics.addOperation("extractWithLocation",{File:R=>R.asIteration().children.map(ee=>ee.extractWithLocation()).filter(Boolean),Line:(R,ee)=>{var xe;return((xe=R.child(0))===null||xe===void 0?void 0:xe.extractWithLocation())||null},NameReq:function(R,ee,xe,ne){var te,f;return O(this,{type:"ProjectName",name:O(R,R.sourceString),versionSpec:xe.extractWithLocation(),extras:(te=ee.child(0))===null||te===void 0?void 0:te.extractWithLocation(),environmentMarkerTree:(f=ne.child(0))===null||f===void 0?void 0:f.extractWithLocation()})},UrlReq:function(R,ee,xe,ne,te){var f,d;return O(this,{type:"ProjectURL",name:O(R,R.sourceString),url:xe.extractWithLocation(),extras:(f=ee.child(0))===null||f===void 0?void 0:f.extractWithLocation(),environmentMarkerTree:(d=te.child(0))===null||d===void 0?void 0:d.extractWithLocation()})},Extras:function(R,ee,xe){return ee.asIteration().children.map(ne=>O(ne,ne.sourceString))},RequirementsReq:function(R,ee){return O(this,{type:"RequirementsFile",path:ee.sourceString})},ConstraintsReq:function(R,ee){return O(this,{type:"ConstraintsFile",path:ee.sourceString})},UrlSpec:function(R,ee){return O(ee,ee.sourceString)},QuotedMarker:(R,ee)=>O(ee,ee.extract()),VersionSpec_parenthesized:(R,ee,xe)=>ee.extractWithLocation()||[],VersionMany:R=>{const ee=R.asIteration().children;if(ee.length!==0)return ee.map(xe=>xe.extractWithLocation())},VersionOne:function(R,ee){return O(this,{operator:O(R,R.sourceString),version:O(ee,ee.sourceString)})}}),g.semantics.addOperation("extractLooselyWithLocation",{LooseFile:R=>R.asIteration().children.map(ee=>ee.extractLooselyWithLocation()).filter(Boolean),LooseLine:(R,ee)=>{var xe;return((xe=R.child(0))===null||xe===void 0?void 0:xe.extractLooselyWithLocation())||null},LooseNameReq:function(R,ee,xe,ne){var te;return O(this,{type:"ProjectName",name:O(R,R.sourceString),extras:(te=ee.child(0))===null||te===void 0?void 0:te.extractLooselyWithLocation(),versionSpec:xe.extractLooselyWithLocation()})},LooseNonNameReq:R=>null,LooseExtras:function(R,ee,xe,ne){return ee.asIteration().children.map(te=>O(te,te.sourceString))},LooseVersionSpec_parenthesized:(R,ee,xe)=>ee.extractLooselyWithLocation()||[],LooseVersionMany:(R,ee)=>{const xe=R.asIteration().children;if(xe.length!==0)return xe.map(ne=>ne.extractLooselyWithLocation())},LooseVersionOne:function(R,ee){return O(this,{operator:O(R,R.sourceString),...ee.sourceString?{version:O(ee,ee.sourceString)}:{}})}});class Y extends Error{}g.RequirementsSyntaxError=Y})(semantics)),semantics}var types={},hasRequiredTypes;function requireTypes(){if(hasRequiredTypes)return types;hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0}),types.VersionOperator=types.EnvironmentMarkerVariable=void 0;var g;(function(l){l.PythonVersion="python_version",l.PythonFullVersion="python_full_version",l.OsName="os_name",l.SysPlatform="sys_platform",l.PlatformRelease="platform_release",l.PlatformSystem="platform_system",l.PlatformVersion="platform_version",l.PlatformMachine="platform_machine",l.PlatformPythonImplementation="platform_python_implementation",l.ImplementationName="implementation_name",l.ImplementationVersion="implementation_version",l.Extra="extra"})(g||(types.EnvironmentMarkerVariable=g={}));var a;return(function(l){l.CompatibleRelease="~=",l.VersionMatching="==",l.VersionExclusion="!=",l.LessThanOrMatching="<=",l.GreaterThanOrMatching=">=",l.LessThan="<",l.GreaterThan=">",l.ArbitrarilyEqual="==="})(a||(types.VersionOperator=a={})),types}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(g){var a=dist&&dist.__createBinding||(Object.create?(function(f,d,H,Z){Z===void 0&&(Z=H);var Ye=Object.getOwnPropertyDescriptor(d,H);(!Ye||("get"in Ye?!d.__esModule:Ye.writable||Ye.configurable))&&(Ye={enumerable:!0,get:function(){return d[H]}}),Object.defineProperty(f,Z,Ye)}):(function(f,d,H,Z){Z===void 0&&(Z=H),f[Z]=d[H]})),l=dist&&dist.__exportStar||function(f,d){for(var H in f)H!=="default"&&!Object.prototype.hasOwnProperty.call(d,H)&&a(d,f,H)},A=dist&&dist.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(g,"__esModule",{value:!0}),g.parsePipRequirementsLineLoosely=g.parsePipRequirementsFileLoosely=g.parsePipRequirementsLine=g.parsePipRequirementsFile=g.RequirementsSyntaxError=void 0;const O=A(requirePep508_ohmBundle()),Y=requireSemantics();var R=requireSemantics();Object.defineProperty(g,"RequirementsSyntaxError",{enumerable:!0,get:function(){return R.RequirementsSyntaxError}}),l(requireTypes(),g);function ee(f,d){const H=O.default.match(f,"File");if(H.failed())throw new Y.RequirementsSyntaxError(`Failed to parse requirements file. ${H.shortMessage}`);return d?.includeLocations?(0,Y.semantics)(H).extractWithLocation():(0,Y.semantics)(H).extract()}g.parsePipRequirementsFile=ee;function xe(f,d){const H=O.default.match(f,"Line");if(H.failed())throw new Y.RequirementsSyntaxError(`Failed to parse requirements line. ${H.shortMessage}`);return d?.includeLocations?(0,Y.semantics)(H).extractWithLocation():(0,Y.semantics)(H).extract()}g.parsePipRequirementsLine=xe;function ne(f,d){const H=O.default.match(f,"LooseFile");if(H.failed())throw new Y.RequirementsSyntaxError(`Failed to loosely parse requirements file. ${H.shortMessage}`);return d?.includeLocations?(0,Y.semantics)(H).extractLooselyWithLocation():(0,Y.semantics)(H).extractLoosely()}g.parsePipRequirementsFileLoosely=ne;function te(f,d){const H=O.default.match(f,"LooseLine");if(H.failed())throw new Y.RequirementsSyntaxError(`Failed to loosely parse requirements line. ${H.shortMessage}`);return d?.includeLocations?(0,Y.semantics)(H).extractLooselyWithLocation():(0,Y.semantics)(H).extractLoosely()}g.parsePipRequirementsLineLoosely=te})(dist)),dist}var distExports=requireDist();const index=getDefaultExportFromCjs(distExports),pipRequirements=_mergeNamespaces({__proto__:null,default:index},[distExports]);function WorkerWrapper(g){return new Worker("/assets/pyworker-Drd8fvVW.js",{type:"module",name:g?.name})}const{parsePipRequirementsFile}=pipRequirements;let messageId=0;class PyEnv{constructor(){this.pendingMessages=new Map}async init(a,l){this.workspace=a,this.vars=l??{},this.worker=new WorkerWrapper,this.worker.onmessage=A=>{this.handleWorkerMessage(A.data)},this.worker.onerror=A=>{console.error("Python Worker error:",A)},await this.sendMessage("init",{vars:this.vars}),await this.mountWorkspace(),await this.installDependencies()}handleWorkerMessage(a){if(a.id==="interrupt-buffer"){a.type==="success"?this.interruptBuffer=new Uint8Array(a.payload):this.interruptBuffer=void 0;return}if(a.type==="inputRequest"){const A=a.payload.prompt||"Input:",O=window.prompt(A);this.worker.postMessage({id:a.id,type:"inputResponse",payload:{value:O,cancelled:O===null}});return}if(a.type==="stdout"){this.stdoutCallback?this.stdoutCallback(a.payload):console.info(a.payload);return}if(a.type==="stderr"){this.stderrCallback?this.stderrCallback(a.payload):console.error(a.payload);return}if(a.type==="console"){const{level:A,message:O}=a.payload;typeof window<"u"&&window.logToTerminal&&window.logToTerminal("Python Worker",O,A);return}const l=this.pendingMessages.get(a.id);l&&(this.pendingMessages.delete(a.id),a.type==="success"?l.resolve(a.payload):a.type==="error"&&l.reject(new Error(a.payload.message)))}async sendMessage(a,l){if(!this.worker)throw new Error("PyEnv not initialized yet: see init()");const A=`msg-${messageId++}`,O={id:A,type:a,payload:l};return new Promise((Y,R)=>{this.pendingMessages.set(A,{resolve:Y,reject:R}),this.worker.postMessage(O)})}setStdoutCallback(a){this.stdoutCallback=a}setStderrCallback(a){this.stderrCallback=a}async runFunction(a,l){const A=await this.sendMessage("runFunction",{name:a,args:l});return publish(TOPIC_WORKSPACE_CHANGED,this.workspace),A}async setGlobal(a,l){await this.sendMessage("setGlobal",{key:a,value:l})}async mountWorkspace(a="/workspace"){const l=await workspaceService.getWorkspace();await this.sendMessage("mountWorkspace",{handle:l.getHandle(),mountPoint:a})}async installDependencies(){const a=await this.workspace?.getResource("requirements.txt");if(a){const l=(await a.getContents()).replaceAll("\r",""),A=parsePipRequirementsFile(l).filter(O=>"name"in O).map(O=>O.name);await this.loadPackages(A)}}async loadPackages(a){a.length>0&&await this.sendMessage("loadPackages",{packages:a})}async syncWorkspace(){await this.sendMessage("syncWorkspace"),publish(TOPIC_WORKSPACE_CHANGED,this.workspace)}async execCode(a){const l=await this.sendMessage("execCode",{code:a});return publish(TOPIC_WORKSPACE_CHANGED,this.workspace),l}async execScript(a){const l=a.split(".")[0],A=a.includes(":")?a.split(":").reverse()[0]:void 0;return await this.execModule(l,A)}async execModule(a,l){const A=await this.sendMessage("execModule",{moduleName:a,entryName:l,vars:this.vars});return publish(TOPIC_WORKSPACE_CHANGED,this.workspace),A}async getVersion(){return await this.sendMessage("getVersion")}canInterrupt(){return this.interruptBuffer!==void 0}interrupt(){this.interruptBuffer&&(this.interruptBuffer[0]=2)}close(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.pendingMessages.clear()}}class PackageInfoService{constructor(){this.packages=[]}addPackage(a){this.packages.push(a)}hasPackages(){return this.packages.length>0&&this.packages.some(a=>a.dependencies&&Object.keys(a.dependencies).length>0)}renderTree(){return this.packages.length===0?x$1``:x$1`
            <wa-tree style="--indent-guide-width: 1px;">
                ${this.packages.map(a=>{const l=a.dependencies||{},A=Object.entries(l);return A.length===0?x$1``:x$1`
                        <wa-tree-item expanded>
                            <span>${a.name}</span>
                            ${A.map(([O,Y])=>x$1`
                                <wa-tree-item>
                                    <span>${O} <small>${Y}</small></span>
                                </wa-tree-item>
                            `)}
                        </wa-tree-item>
                    `})}
            </wa-tree>
        `}}const packageInfoService=new PackageInfoService,GITHUB_API_BASE="https://api.github.com";function getGitHubConfig(){const g=appLoaderService.getCurrentApp();if(g?.metadata?.github){const a=g.metadata.github;if(a.owner&&a.repo)return{owner:a.owner,repo:a.repo}}throw new Error("GitHub repository not configured. Specify metadata.github in AppDefinition.")}async function fetchReleases(g=100){try{const a=getGitHubConfig(),l=await fetch(`${GITHUB_API_BASE}/repos/${a.owner}/${a.repo}/releases?per_page=${g}`);return l.ok?await l.json():[]}catch(a){return console.error("Failed to fetch releases:",a),[]}}function isNewerVersion(g,a){const l=g.replace(/^v/,""),A=a.replace(/^v/,""),O=l.split(".").map(Number),Y=A.split(".").map(Number);for(let R=0;R<Math.max(O.length,Y.length);R++){const ee=O[R]||0,xe=Y[R]||0;if(xe>ee)return!0;if(xe<ee)return!1}return!1}registerAll({command:{id:"show_version_info",name:"Show Version Info",description:"Shows application version information",parameters:[]},handler:{execute:async g=>{const a=appLoaderService.getCurrentApp();if(!a){toastError("No app loaded");return}const l=packageInfoService.hasPackages(),A=packageInfoService.renderTree();let O=null;const Y=()=>(O||(O=document.getElementById("global-dialog-container")||document.createElement("div"),O.id||(O.id="global-dialog-container",document.body.appendChild(O))),O),R=()=>{O&&B$1(x$1``,O)},ee=Ye=>{const et=k.parse(Ye,{async:!1});return x$1`${o(et)}`};let xe=[];try{xe=await fetchReleases()}catch{xe=[]}const ne=a.version==="0.0.0",te=xe.length>0?xe.findIndex(Ye=>Ye.tag_name===a.version):-1,f=te>=0?te:0;let d=f;const H=Ye=>{if(ne)return`**Development Build**

${a.description||""}`;if(xe.length===0)return`**Version:** ${a.version}

${a.description||""}`;const et=xe[Ye],tt=et.tag_name===a.version;let nt=`**Version:** ${et.tag_name}`;tt&&(nt+=" (Current)"),nt+=`

`;const it=new Date(et.published_at).toLocaleDateString();return nt+=`**Released:** ${it}

`,!tt&&isNewerVersion(a.version,et.tag_name)&&(nt+=`⚠️ **Update available**

`),et.body&&(nt+=`---

${et.body}`),nt},Z=Ye=>{const et=H(Ye),tt=xe.length>0,nt=x$1`
                    <wa-dialog label="${a.name}" open @wa-request-close=${R}>
                        <style>
                            .dialog-content {
                                width: 600px;
                                height: 600px;
                            }
                            
                            wa-tree-item > span small {
                                color: var(--wa-color-neutral-60);
                                font-size: 0.875em;
                                margin-left: 0.5rem;
                            }
                        </style>
                        <div class="dialog-content">
                            <wa-tab-group>
                                <wa-tab slot="nav" panel="release">Release Info</wa-tab>
                                ${l?x$1`<wa-tab slot="nav" panel="packages">NPM Packages</wa-tab>`:""}
                                
                                <wa-tab-panel name="release">
                                    ${ee(et)}
                                </wa-tab-panel>
                                
                                ${l?x$1`
                                    <wa-tab-panel name="packages">
                                        ${A}
                                    </wa-tab-panel>
                                `:""}
                            </wa-tab-group>
                        </div>
                        <div slot="footer">
                            ${tt?x$1`
                                <wa-button 
                                    variant="default"
                                    ?disabled=${Ye===xe.length-1}
                                    @click=${()=>{Ye<xe.length-1&&(d=Ye+1,Z(d))}}
                                >
                                    ← Previous
                                </wa-button>
                                <wa-button 
                                    variant="default"
                                    ?disabled=${Ye===0}
                                    @click=${()=>{Ye>0&&(d=Ye-1,Z(d))}}
                                >
                                    Next →
                                </wa-button>
                            `:""}
                            <wa-button variant="primary" @click=${R}>Close</wa-button>
                        </div>
                    </wa-dialog>
                `;B$1(nt,Y())};return Z(f),new Promise(Ye=>{const et=()=>{O?.querySelector("wa-dialog[open]")?setTimeout(et,100):Ye()};et()})}}});registerAll({command:{id:"python",name:"Run Python Script",description:"Executes a Python script given its file path",parameters:[{name:"script",description:"the path to a Python script to run",required:!1}]},handler:{execute:async g=>{const a=g.params.script;if(!a)return;const l=new PyEnv,A=await workspaceService.getWorkspace();await l.init(A,g),await l.installDependencies(),await l.execScript(a)}}});registerAll({command:{id:"js",name:"Run JavaScript file",description:"Executes a JavaScript file given its path",parameters:[{name:"script",description:"the path to a JavaScript file to run",required:!1}]}});registerAll({command:{id:"save",name:"Save editor",description:"Saves the active/focused editor",keyBinding:"CTRL+S",parameters:[]},handler:{execute:async g=>{const a=activeEditorSignal.get()||activePartSignal.get();a&&a.isDirty()&&a.save()}},contribution:{target:"toolbar:.system.editors",icon:"floppy-disk",label:"Save active editor",slot:"start",disabled:()=>{const g=activePartSignal.get();return!g||!g.isDirty()}}});registerAll({command:{id:"run_python",name:"Run Python Cell",description:"Runs active Python code in a supporting context (e.g. notebook, terminal, etc.)",keyBinding:"CTRL+R",parameters:[]}});const THEME_SETTINGS_KEY="theme";async function applyTheme(g){const a=document.documentElement;a.classList.remove("wa-dark","wa-light"),a.classList.add(g)}async function loadTheme(){const g=await appSettings.get(THEME_SETTINGS_KEY);await applyTheme(g||"wa-dark")}async function saveTheme(g){await appSettings.set(THEME_SETTINGS_KEY,g)}registerAll({command:{id:"switch_theme",name:"Switch theme",description:"Switches between dark and light theme",parameters:[]},handler:{execute:async g=>{const l=document.documentElement.classList.contains("wa-dark")?"wa-light":"wa-dark";await applyTheme(l),await saveTheme(l)}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"circle-half-stroke",label:"Theme Switcher"}});loadTheme().catch(g=>{console.error("Failed to load theme preference:",g)});registerAll({command:{id:"fullscreen",name:"Toggle fullscreen",description:"Toggles fullscreen mode",parameters:[]},handler:{execute:async g=>{document.fullscreenElement===document.body?await document.exitFullscreen():await document.body.requestFullscreen()}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"expand",label:"Fullscreen"}});registerAll({command:{id:"open_settings",name:"Open Settings",description:"Opens the settings file in an editor",parameters:[]},handler:{execute:g=>{const a={title:"settings.json",data:{async getContents(){const l=await appSettings.getAll();return JSON.stringify(l,void 0,2)},getName(){return a.key},saveContents(l){const A=JSON.parse(l);return appSettings.setAll(A)}},key:"setting.json",editorId:"monaco-editor",icon:"gear",state:{}};a.widgetFactory=()=>x$1`
                <k-monaco-editor .input=${a}></k-monaco-editor>`,editorRegistry.loadEditor(a).then()}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"gear",label:"Open Settings"}});registerAll({command:{id:"open_extensions",name:"Open Extensions",description:"Opens the extensions registry",parameters:[]},handler:{execute:g=>{const a={title:"Extensions",data:{},key:"system.extensions",editorId:"extensions-editor",icon:"puzzle-piece",state:{},noOverflow:!0};a.widgetFactory=()=>x$1`
                <k-extensions></k-extensions>`,editorRegistry.loadEditor(a).then()}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"puzzle-piece",label:"Open Extensions"}});registerAll({command:{id:"list_extensions",name:"List extensions",description:"Lists all available extensions with their status (enabled/disabled)",parameters:[],output:[{name:"extensions",description:"array of extension objects with id, name, description, experimental flag, and enabled status"}]},handler:{execute:async g=>extensionRegistry.getExtensions().map(l=>({id:l.id,name:l.name,description:l.description,experimental:l.experimental,enabled:extensionRegistry.isEnabled(l.id)}))}});registerAll({command:{id:"toast_message",name:"Toast message to user",description:"Shows a toast message",parameters:[{name:"message",description:"the message to toast",required:!0},{name:"type",description:"the toast type: info (default), or error",required:!1}]},handler:{execute:({params:{message:g,type:a}})=>{g&&(a==="error"?toastError(g):toastInfo(g))}}});const name$1="@kispace-io/appspace",version$1="1.0.21",dependencies={lit:"^3.2.1",marked:"^12.0.0 || ^16.4.1","@lit-labs/signals":"^0.1.3","@awesome.me/webawesome":"^3.0.0","@fortawesome/fontawesome-free":"^7.1.0","@fortawesome/fontawesome-svg-core":"^7.1.0","@fortawesome/free-solid-svg-icons":"^7.1.0","@langchain/textsplitters":"^1.0.0","@mlc-ai/web-llm":"^0.2.79","@xenova/transformers":"^2.17.2","@xterm/xterm":"^5.5.0",axios:"^1.13.1",dotenv:"^17.2.3","idb-keyval":"^6.2.2",jsonata:"^2.1.0",jszip:"^3.10.1","monaco-editor":"^0.54.0","pace-js":"^1.2.4","pdfjs-dist":"^4.0.0","pip-requirements-js":"^1.0.2","pubsub-js":"^1.9.5",pyodide:"^0.27.7",rxdb:"^15.0.0","toastify-js":"^1.12.0",uuid:"^13.0.0","wasm-git":"^0.0.13"},devDependencies={typescript:"^5.9.3",vite:"^7.1.12","vite-plugin-dts":"^4.5.4"},appspacePackageJson={name:name$1,version:version$1,dependencies,devDependencies};packageInfoService.addPackage({name:appspacePackageJson.name,version:appspacePackageJson.version,dependencies:appspacePackageJson.dependencies,devDependencies:appspacePackageJson.devDependencies});var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$3(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$3(a,l,O),O};let KStandardApp=class extends KContainer{constructor(){super(...arguments),this.showBottomSidebar=!0,this.showBottomPanel=!1}createRenderRoot(){return this}render(){return x$1`
            <style>
                *, *::before, *::after {
                    box-sizing: border-box;
                }
                
                html {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                }
                
                body {
                    height: 100%;
                    width: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                }
                
                k-standard-app {
                    display: flex;
                    flex-direction: column;
                    height: 100vh;
                    width: 100%;
                }
                
                k-standard-app .toolbar-top {
                    width: 100%;
                    display: grid;
                    grid-template-columns: 1fr 2fr 1fr;
                    align-items: center;
                    border-bottom: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    flex-shrink: 0;
                }
                
                k-standard-app .toolbar-bottom {
                    width: 100%;
                    border-top: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    display: grid;
                    grid-template-columns: 1fr 2fr auto;
                    align-items: center;
                    flex-shrink: 0;
                    min-height: 32px;
                    padding: 0 var(--wa-space-s);
                    box-sizing: border-box;
                }
                
                k-standard-app .main-layout {
                    flex: 1;
                    min-height: 0;
                }
                
                k-standard-app .toolbar-end {
                    justify-self: end;
                }
            </style>
            
            <div class="toolbar-top">
                <k-toolbar id=${TOOLBAR_MAIN}></k-toolbar>
                <k-toolbar id=${TOOLBAR_MAIN_CENTER}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${TOOLBAR_MAIN_RIGHT}></k-toolbar>
            </div>
            
            <k-resizable-grid 
                class="main-layout"
                id="main-layout" 
                orientation="horizontal" 
                sizes="15%, 65%, 20%">
                
                ${this.showBottomSidebar?x$1`
                        <k-resizable-grid 
                            id="left-sidebar-split" 
                            orientation="vertical" 
                            sizes="50%, 50%">
                            <k-tabs id="${SIDEBAR_MAIN}"></k-tabs>
                            <k-tabs id="${SIDEBAR_MAIN_BOTTOM}"></k-tabs>
                        </k-resizable-grid>
                    `:x$1`<k-tabs id="${SIDEBAR_MAIN}"></k-tabs>`}
                
                ${this.showBottomPanel?x$1`
                        <k-resizable-grid 
                            id="editor-area-split" 
                            orientation="vertical" 
                            sizes="70%, 30%">
                            <k-tabs id="${EDITOR_AREA_MAIN}"></k-tabs>
                            <k-tabs id="${PANEL_BOTTOM}"></k-tabs>
                        </k-resizable-grid>
                    `:x$1`<k-tabs id="${EDITOR_AREA_MAIN}"></k-tabs>`}
                
                <k-tabs id="${SIDEBAR_AUXILIARY}"></k-tabs>
            </k-resizable-grid>
            
            <div class="toolbar-bottom">
                <k-toolbar id=${TOOLBAR_BOTTOM}></k-toolbar>
                <k-toolbar id=${TOOLBAR_BOTTOM_CENTER}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${TOOLBAR_BOTTOM_END}></k-toolbar>
            </div>
        `}};__decorateClass$3([n({type:Boolean,attribute:"show-bottom-sidebar"})],KStandardApp.prototype,"showBottomSidebar",2);__decorateClass$3([n({type:Boolean,attribute:"show-bottom-panel"})],KStandardApp.prototype,"showBottomPanel",2);KStandardApp=__decorateClass$3([t("k-standard-app")],KStandardApp);function commonjsRequire(g){throw new Error('Could not dynamically require "'+g+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jsonata$1={exports:{}},hasRequiredJsonata;function requireJsonata(){return hasRequiredJsonata||(hasRequiredJsonata=1,(function(g,a){(function(l){g.exports=l()})(function(){return(function(){function l(A,O,Y){function R(ne,te){if(!O[ne]){if(!A[ne]){var f=typeof commonjsRequire=="function"&&commonjsRequire;if(!te&&f)return f(ne,!0);if(ee)return ee(ne,!0);var d=new Error("Cannot find module '"+ne+"'");throw d.code="MODULE_NOT_FOUND",d}var H=O[ne]={exports:{}};A[ne][0].call(H.exports,function(Z){var Ye=A[ne][1][Z];return R(Ye||Z)},H,H.exports,l,A,O,Y)}return O[ne].exports}for(var ee=typeof commonjsRequire=="function"&&commonjsRequire,xe=0;xe<Y.length;xe++)R(Y[xe]);return R}return l})()({1:[function(l,A,O){const Y=l("./utils"),R=(function(){const ee=Y.stringToArray,xe=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],ne=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],te=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],f=["Thousand","Million","Billion","Trillion"];function d(qt,Jt){var Wt=function(fn,pn,Zt){var mn="";if(fn<=19)mn=(pn?" and ":"")+(Zt?ne[fn]:xe[fn]);else if(fn<100){const $n=Math.floor(fn/10),Un=fn%10;mn=(pn?" and ":"")+te[$n-2],Un>0?mn+="-"+Wt(Un,!1,Zt):Zt&&(mn=mn.substring(0,mn.length-1)+"ieth")}else if(fn<1e3){const $n=Math.floor(fn/100),Un=fn%100;mn=(pn?", ":"")+xe[$n]+" Hundred",Un>0?mn+=Wt(Un,!0,Zt):Zt&&(mn+="th")}else{var Tn=Math.floor(Math.log10(fn)/3);Tn>f.length&&(Tn=f.length);const $n=Math.pow(10,Tn*3),Un=Math.floor(fn/$n),In=fn-Un*$n;mn=(pn?", ":"")+Wt(Un,!1,!1)+" "+f[Tn-1],In>0?mn+=Wt(In,!0,Zt):Zt&&(mn+="th")}return mn},un=Wt(qt,!1,Jt);return un}const H={};xe.forEach(function(qt,Jt){H[qt.toLowerCase()]=Jt}),ne.forEach(function(qt,Jt){H[qt.toLowerCase()]=Jt}),te.forEach(function(qt,Jt){const Wt=qt.toLowerCase();H[Wt]=(Jt+2)*10,H[Wt.substring(0,qt.length-1)+"ieth"]=H[Wt]}),H.hundredth=100,f.forEach(function(qt,Jt){const Wt=qt.toLowerCase(),un=Math.pow(10,(Jt+1)*3);H[Wt]=un,H[Wt+"th"]=un});function Z(qt){const Wt=qt.split(/,\s|\sand\s|[\s\\-]/).map(pn=>H[pn]);let un=[0];return Wt.forEach(pn=>{if(pn<100){let Zt=un.pop();Zt>=1e3&&(un.push(Zt),Zt=0),un.push(Zt+pn)}else un.push(un.pop()*pn)}),un.reduce((pn,Zt)=>pn+Zt,0)}const Ye=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],et={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function tt(qt){for(var Jt=0;Jt<Ye.length;Jt++){const Wt=Ye[Jt];if(qt>=Wt[0])return Wt[1]+tt(qt-Wt[0])}return""}function nt(qt){for(var Jt=0,Wt=1,un=qt.length-1;un>=0;un--){const fn=qt[un],pn=et[fn];pn<Wt?Jt-=pn:(Wt=pn,Jt+=pn)}return Jt}function it(qt,Jt){for(var Wt=[],un=Jt.charCodeAt(0);qt>0;)Wt.unshift(String.fromCharCode((qt-1)%26+un)),qt=Math.floor((qt-1)/26);return Wt.join("")}function ot(qt,Jt){for(var Wt=Jt.charCodeAt(0),un=0,fn=0;fn<qt.length;fn++)un+=(qt.charCodeAt(qt.length-fn-1)-Wt+1)*Math.pow(26,fn);return un}function st(qt,Jt){if(typeof qt>"u")return;qt=Math.floor(qt);const Wt=_t(Jt);return ft(qt,Wt)}const at={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},ct={UPPER:"upper",LOWER:"lower",TITLE:"title"};function ft(qt,Jt){let Wt;const un=qt<0;switch(qt=Math.abs(qt),Jt.primary){case at.LETTERS:Wt=it(qt,Jt.case===ct.UPPER?"A":"a");break;case at.ROMAN:Wt=tt(qt),Jt.case===ct.UPPER&&(Wt=Wt.toUpperCase());break;case at.WORDS:Wt=d(qt,Jt.ordinal),Jt.case===ct.UPPER?Wt=Wt.toUpperCase():Jt.case===ct.LOWER&&(Wt=Wt.toLowerCase());break;case at.DECIMAL:Wt=""+qt;var fn=Jt.mandatoryDigits-Wt.length;if(fn>0){var pn=new Array(fn+1).join("0");Wt=pn+Wt}if(Jt.zeroCode!==48&&(Wt=ee(Wt).map($n=>String.fromCodePoint($n.codePointAt(0)+Jt.zeroCode-48)).join("")),Jt.regular){const $n=Math.floor((Wt.length-1)/Jt.groupingSeparators.position);for(let Un=$n;Un>0;Un--){const In=Wt.length-Un*Jt.groupingSeparators.position;Wt=Wt.substr(0,In)+Jt.groupingSeparators.character+Wt.substr(In)}}else Jt.groupingSeparators.reverse().forEach($n=>{const Un=Wt.length-$n.position;Wt=Wt.substr(0,Un)+$n.character+Wt.substr(Un)});if(Jt.ordinal){var Zt={1:"st",2:"nd",3:"rd"},mn=Wt[Wt.length-1],Tn=Zt[mn];(!Tn||Wt.length>1&&Wt[Wt.length-2]==="1")&&(Tn="th"),Wt=Wt+Tn}break;case at.SEQUENCE:throw{code:"D3130",value:Jt.token}}return un&&(Wt="-"+Wt),Wt}const ut=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function _t(qt){const Jt={type:"integer",primary:at.DECIMAL,case:ct.LOWER,ordinal:!1};let Wt,un;const fn=qt.lastIndexOf(";");switch(fn===-1?Wt=qt:(Wt=qt.substring(0,fn),un=qt.substring(fn+1),un[0]==="o"&&(Jt.ordinal=!0)),Wt){case"A":Jt.case=ct.UPPER;case"a":Jt.primary=at.LETTERS;break;case"I":Jt.case=ct.UPPER;case"i":Jt.primary=at.ROMAN;break;case"W":Jt.case=ct.UPPER,Jt.primary=at.WORDS;break;case"Ww":Jt.case=ct.TITLE,Jt.primary=at.WORDS;break;case"w":Jt.primary=at.WORDS;break;default:{let pn=null,Zt=0,mn=0,Tn=[],$n=0;if(ee(Wt).map(In=>In.codePointAt(0)).reverse().forEach(In=>{let kn=!1;for(let Kt=0;Kt<ut.length;Kt++){const Dt=ut[Kt];if(In>=Dt&&In<=Dt+9){if(kn=!0,Zt++,$n++,pn===null)pn=Dt;else if(Dt!==pn)throw{code:"D3131"};break}}kn||(In===35?($n++,mn++):Tn.push({position:$n,character:String.fromCodePoint(In)}))}),Zt>0){Jt.primary=at.DECIMAL,Jt.zeroCode=pn,Jt.mandatoryDigits=Zt,Jt.optionalDigits=mn;const kn=function(Kt){if(Kt.length===0)return 0;const Dt=Kt[0].character;for(let gn=1;gn<Kt.length;gn++)if(Kt[gn].character!==Dt)return 0;const Qt=Kt.map(gn=>gn.position),cn=function(gn,Cn){return Cn===0?gn:cn(Cn,gn%Cn)},nn=Qt.reduce(cn);for(let gn=1;gn<=Qt.length;gn++)if(Qt.indexOf(gn*nn)===-1)return 0;return nn}(Tn);kn>0?(Jt.regular=!0,Jt.groupingSeparators={position:kn,character:Tn[0].character}):(Jt.regular=!1,Jt.groupingSeparators=Tn)}else Jt.primary=at.SEQUENCE,Jt.token=Wt}}return Jt}const At={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function Et(qt){var Jt=[];const Wt={type:"datetime",parts:Jt},un=function(kn,Kt){if(Kt>kn){let Dt=qt.substring(kn,Kt);Dt=Dt.split("]]").join("]"),Jt.push({type:"literal",value:Dt})}};for(var fn=0,pn=0;pn<qt.length;){if(qt.charAt(pn)==="["){if(qt.charAt(pn+1)==="["){un(fn,pn),Jt.push({type:"literal",value:"["}),pn+=2,fn=pn;continue}if(un(fn,pn),fn=pn,pn=qt.indexOf("]",fn),pn===-1)throw{code:"D3135"};let kn=qt.substring(fn+1,pn);kn=kn.split(/\s+/).join("");var Zt={type:"marker",component:kn.charAt(0)},mn=kn.lastIndexOf(","),Tn;if(mn!==-1){const Kt=kn.substring(mn+1),Dt=Kt.indexOf("-");let Qt,cn;const nn=function(Cn){if(!(typeof Cn>"u"||Cn==="*"))return parseInt(Cn)};Dt===-1?Qt=Kt:(Qt=Kt.substring(0,Dt),cn=Kt.substring(Dt+1));const gn={min:nn(Qt),max:nn(cn)};Zt.width=gn,Tn=kn.substring(1,mn)}else Tn=kn.substring(1);if(Tn.length===1)Zt.presentation1=Tn;else if(Tn.length>1){var $n=Tn.charAt(Tn.length-1);"atco".indexOf($n)!==-1?(Zt.presentation2=$n,$n==="o"&&(Zt.ordinal=!0),Zt.presentation1=Tn.substring(0,Tn.length-1)):Zt.presentation1=Tn}else Zt.presentation1=At[Zt.component];if(typeof Zt.presentation1>"u")throw{code:"D3132",value:Zt.component};if(Zt.presentation1[0]==="n")Zt.names=ct.LOWER;else if(Zt.presentation1[0]==="N")Zt.presentation1[1]==="n"?Zt.names=ct.TITLE:Zt.names=ct.UPPER;else if("YMDdFWwXxHhmsf".indexOf(Zt.component)!==-1){var Un=Zt.presentation1;if(Zt.presentation2&&(Un+=";"+Zt.presentation2),Zt.integerFormat=_t(Un),Zt.width&&Zt.width.min!==void 0&&Zt.integerFormat.mandatoryDigits<Zt.width.min&&(Zt.integerFormat.mandatoryDigits=Zt.width.min),Zt.component==="Y")if(Zt.n=-1,Zt.width&&Zt.width.max!==void 0)Zt.n=Zt.width.max,Zt.integerFormat.mandatoryDigits=Zt.n;else{var In=Zt.integerFormat.mandatoryDigits+Zt.integerFormat.optionalDigits;In>=2&&(Zt.n=In)}const Kt=Jt[Jt.length-1];Kt&&Kt.integerFormat&&(Kt.integerFormat.parseWidth=Kt.integerFormat.mandatoryDigits)}(Zt.component==="Z"||Zt.component==="z")&&(Zt.integerFormat=_t(Zt.presentation1)),Jt.push(Zt),fn=pn+1}pn++}return un(fn,pn),Wt}const Mt=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ot=["January","February","March","April","May","June","July","August","September","October","November","December"],kt=1e3*60*60*24,yt=function(qt){const Jt=Date.UTC(qt.year,qt.month);var Wt=new Date(Jt).getUTCDay();return Wt===0&&(Wt=7),Wt>4?Jt+(8-Wt)*kt:Jt-(Wt-1)*kt},St=function(qt,Jt){return{year:qt,month:Jt,nextMonth:function(){return Jt===11?St(qt+1,0):St(qt,Jt+1)},previousMonth:function(){return Jt===0?St(qt-1,11):St(qt,Jt-1)},nextYear:function(){return St(qt+1,Jt)},previousYear:function(){return St(qt-1,Jt)}}},Yt=function(qt,Jt){return(Jt-qt)/(kt*7)+1},Ft=(qt,Jt)=>{let Wt;switch(Jt){case"Y":Wt=qt.getUTCFullYear();break;case"M":Wt=qt.getUTCMonth()+1;break;case"D":Wt=qt.getUTCDate();break;case"d":{const un=Date.UTC(qt.getUTCFullYear(),qt.getUTCMonth(),qt.getUTCDate()),fn=Date.UTC(qt.getUTCFullYear(),0);Wt=(un-fn)/kt+1;break}case"F":Wt=qt.getUTCDay(),Wt===0&&(Wt=7);break;case"W":{const un=St(qt.getUTCFullYear(),0),fn=yt(un),pn=Date.UTC(un.year,qt.getUTCMonth(),qt.getUTCDate());let Zt=Yt(fn,pn);if(Zt>52){const mn=yt(un.nextYear());pn>=mn&&(Zt=1)}else if(Zt<1){const mn=yt(un.previousYear());Zt=Yt(mn,pn)}Wt=Math.floor(Zt);break}case"w":{const un=St(qt.getUTCFullYear(),qt.getUTCMonth()),fn=yt(un),pn=Date.UTC(un.year,un.month,qt.getUTCDate());let Zt=Yt(fn,pn);if(Zt>4){const mn=yt(un.nextMonth());pn>=mn&&(Zt=1)}else if(Zt<1){const mn=yt(un.previousMonth());Zt=Yt(mn,pn)}Wt=Math.floor(Zt);break}case"X":{const un=St(qt.getUTCFullYear(),0),fn=yt(un),pn=yt(un.nextYear()),Zt=qt.getTime();Zt<fn?Wt=un.year-1:Zt>=pn?Wt=un.year+1:Wt=un.year;break}case"x":{const un=St(qt.getUTCFullYear(),qt.getUTCMonth()),fn=yt(un),pn=un.nextMonth(),Zt=yt(pn),mn=qt.getTime();mn<fn?Wt=un.previousMonth().month+1:mn>=Zt?Wt=pn.month+1:Wt=un.month+1;break}case"H":Wt=qt.getUTCHours();break;case"h":Wt=qt.getUTCHours(),Wt=Wt%12,Wt===0&&(Wt=12);break;case"P":Wt=qt.getUTCHours()>=12?"pm":"am";break;case"m":Wt=qt.getUTCMinutes();break;case"s":Wt=qt.getUTCSeconds();break;case"f":Wt=qt.getUTCMilliseconds();break;case"Z":case"z":break;case"C":Wt="ISO";break;case"E":Wt="ISO";break}return Wt};let ln=null;function dn(qt,Jt,Wt){var un=0,fn=0;if(typeof Wt<"u"){const Un=parseInt(Wt);un=Math.floor(Un/100),fn=Un%100}var pn=function(Un,In){var kn=Ft(Un,In.component);if("YMDdFWwXxHhms".indexOf(In.component)!==-1)if(In.component==="Y"&&In.n!==-1&&(kn=kn%Math.pow(10,In.n)),In.names){if(In.component==="M"||In.component==="x")kn=Ot[kn-1];else if(In.component==="F")kn=Mt[kn];else throw{code:"D3133",value:In.component};In.names===ct.UPPER?kn=kn.toUpperCase():In.names===ct.LOWER&&(kn=kn.toLowerCase()),In.width&&kn.length>In.width.max&&(kn=kn.substring(0,In.width.max))}else kn=ft(kn,In.integerFormat);else if(In.component==="f")kn=ft(kn,In.integerFormat);else if(In.component==="Z"||In.component==="z"){const Kt=un*100+fn;if(In.integerFormat.regular)kn=ft(Kt,In.integerFormat);else{const Dt=In.integerFormat.mandatoryDigits;if(Dt===1||Dt===2)kn=ft(un,In.integerFormat),fn!==0&&(kn+=":"+st(fn,"00"));else if(Dt===3||Dt===4)kn=ft(Kt,In.integerFormat);else throw{code:"D3134",value:Dt}}Kt>=0&&(kn="+"+kn),In.component==="z"&&(kn="GMT"+kn),Kt===0&&In.presentation2==="t"&&(kn="Z")}else In.component==="P"&&In.names===ct.UPPER&&(kn=kn.toUpperCase());return kn};let Zt;typeof Jt>"u"?(ln===null&&(ln=Et("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),Zt=ln):Zt=Et(Jt);const mn=(60*un+fn)*60*1e3,Tn=new Date(qt+mn);let $n="";return Zt.parts.forEach(function(Un){Un.type==="literal"?$n+=Un.value:$n+=pn(Tn,Un)}),$n}function Pt(qt){var Jt={};if(qt.type==="datetime")Jt.type="datetime",Jt.parts=qt.parts.map(function(Wt){var un={};if(Wt.type==="literal")un.regex=Wt.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(Wt.component==="Z"||Wt.component==="z"){let pn;Array.isArray(Wt.integerFormat.groupingSeparators)||(pn=Wt.integerFormat.groupingSeparators),un.regex="",Wt.component==="z"&&(un.regex="GMT"),un.regex+="[-+][0-9]+",pn&&(un.regex+=pn.character+"[0-9]+"),un.parse=function(Zt){Wt.component==="z"&&(Zt=Zt.substring(3));let mn=0,Tn=0;return pn?(mn=Number.parseInt(Zt.substring(0,Zt.indexOf(pn.character))),Tn=Number.parseInt(Zt.substring(Zt.indexOf(pn.character)+1))):Zt.length-1<=2?mn=Number.parseInt(Zt):(mn=Number.parseInt(Zt.substring(0,3)),Tn=Number.parseInt(Zt.substring(3))),mn*60+Tn}}else if(Wt.integerFormat)un=Pt(Wt.integerFormat);else{un.regex="[a-zA-Z]+";var fn={};if(Wt.component==="M"||Wt.component==="x")Ot.forEach(function(pn,Zt){Wt.width&&Wt.width.max?fn[pn.substring(0,Wt.width.max)]=Zt+1:fn[pn]=Zt+1});else if(Wt.component==="F")Mt.forEach(function(pn,Zt){Zt>0&&(Wt.width&&Wt.width.max?fn[pn.substring(0,Wt.width.max)]=Zt:fn[pn]=Zt)});else if(Wt.component==="P")fn={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:Wt.component};un.parse=function(pn){return fn[pn]}}return un.component=Wt.component,un});else{Jt.type="integer";const Wt=qt.case===ct.UPPER;switch(qt.primary){case at.LETTERS:Jt.regex=Wt?"[A-Z]+":"[a-z]+",Jt.parse=function(un){return ot(un,Wt?"A":"a")};break;case at.ROMAN:Jt.regex=Wt?"[MDCLXVI]+":"[mdclxvi]+",Jt.parse=function(un){return nt(Wt?un:un.toUpperCase())};break;case at.WORDS:Jt.regex="(?:"+Object.keys(H).concat("and","[\\-, ]").join("|")+")+",Jt.parse=function(un){return Z(un.toLowerCase())};break;case at.DECIMAL:Jt.regex="[0-9]",qt.parseWidth?Jt.regex+=`{${qt.parseWidth}}`:Jt.regex+="+",qt.ordinal&&(Jt.regex+="(?:th|st|nd|rd)"),Jt.parse=function(un){let fn=un;return qt.ordinal&&(fn=un.substring(0,un.length-2)),qt.regular?fn=fn.split(",").join(""):qt.groupingSeparators.forEach(pn=>{fn=fn.split(pn.character).join("")}),qt.zeroCode!==48&&(fn=fn.split("").map(pn=>String.fromCodePoint(pn.codePointAt(0)-qt.zeroCode+48)).join("")),parseInt(fn)};break;case at.SEQUENCE:throw{code:"D3130",value:qt.token}}}return Jt}function $t(qt,Jt){if(typeof qt>"u")return;const Wt=_t(Jt);return Pt(Wt).parse(qt)}function hn(qt,Jt){const Wt=Et(Jt),un=Pt(Wt),fn="^"+un.parts.map(Tn=>"("+Tn.regex+")").join("")+"$";var Zt=new RegExp(fn,"i").exec(qt);if(Zt!==null){const Dt={};for(let jn=1;jn<Zt.length;jn++){const xt=un.parts[jn-1];xt.parse&&(Dt[xt.component]=xt.parse(Zt[jn]))}if(Object.getOwnPropertyNames(Dt).length===0)return;let Qt=0;const cn=jn=>{Qt<<=1,Qt+=jn?1:0},nn=jn=>!(~jn&Qt)&&!!(jn&Qt);"YXMxWwdD".split("").forEach(jn=>cn(Dt[jn]));const Cn=!nn(161)&&nn(130),Fn=nn(84),Gn=!Fn&&nn(72);Qt=0,"PHhmsf".split("").forEach(jn=>cn(Dt[jn]));const cr=!nn(23)&&nn(47),Nn=(Cn?"YD":Fn?"XxwF":Gn?"XWF":"YMD")+(cr?"Phmsf":"Hmsf"),ur=this.environment.timestamp;let ir=!1,wr=!1;if(Nn.split("").forEach(jn=>{if(typeof Dt[jn]>"u")ir?(Dt[jn]="MDd".indexOf(jn)!==-1?1:0,wr=!0):Dt[jn]=Ft(ur,jn);else if(ir=!0,wr)throw{code:"D3136"}}),Dt.M>0?Dt.M-=1:Dt.M=0,Cn){const jn=Date.UTC(Dt.Y,0),xt=(Dt.d-1)*1e3*60*60*24,zt=new Date(jn+xt);Dt.M=zt.getUTCMonth(),Dt.D=zt.getUTCDate()}if(Fn)throw{code:"D3136"};if(Gn)throw{code:"D3136"};cr&&(Dt.H=Dt.h===12?0:Dt.h,Dt.P===1&&(Dt.H+=12));var mn=Date.UTC(Dt.Y,Dt.M,Dt.D,Dt.H,Dt.m,Dt.s,Dt.f);return(Dt.Z||Dt.z)&&(mn-=(Dt.Z||Dt.z)*60*1e3),mn}}var _n=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function On(qt,Jt){if(!(typeof qt>"u"))if(typeof Jt>"u"){if(!_n.test(qt))throw{stack:new Error().stack,code:"D3110",value:qt};return Date.parse(qt)}else return hn.call(this,qt,Jt)}function En(qt,Jt,Wt){if(!(typeof qt>"u"))return dn.call(this,qt,Jt,Wt)}return{formatInteger:st,parseInteger:$t,fromMillis:En,toMillis:On}})();A.exports=R},{"./utils":6}],2:[function(l,A,O){(function(Y){(function(){var R=l("./utils");const ee=(()=>{var xe=R.isNumeric,ne=R.isArrayOfStrings,te=R.isArrayOfNumbers,f=R.createSequence,d=R.isSequence,H=R.isFunction,Z=R.isLambda,Ye=R.isPromise,et=R.getFunctionArity,tt=R.isDeepEqual,nt=R.stringToArray;function it(pt){if(!(typeof pt>"u")){var gt=0;return pt.forEach(function(wt){gt+=wt}),gt}}function ot(pt){return typeof pt>"u"?0:pt.length}function st(pt){if(!(typeof pt>"u"||pt.length===0))return Math.max.apply(Math,pt)}function at(pt){if(!(typeof pt>"u"||pt.length===0))return Math.min.apply(Math,pt)}function ct(pt){if(!(typeof pt>"u"||pt.length===0)){var gt=0;return pt.forEach(function(wt){gt+=wt}),gt/pt.length}}function ft(pt,gt=!1){if(!(typeof pt>"u")){var wt;if(typeof pt=="string")wt=pt;else if(H(pt))wt="";else{if(typeof pt=="number"&&!isFinite(pt))throw{code:"D3001",value:pt,stack:new Error().stack};var Rt=gt?2:0;Array.isArray(pt)&&pt.outerWrapper&&(pt=pt[0]),wt=JSON.stringify(pt,function(Bt,tn){return typeof tn<"u"&&tn!==null&&tn.toPrecision&&xe(tn)?Number(tn.toPrecision(15)):tn&&H(tn)?"":tn},Rt)}return wt}}function ut(pt,gt,wt){if(!(typeof pt>"u")){var Rt=nt(pt),Bt=Rt.length;if(Bt+gt<0&&(gt=0),typeof wt<"u"){if(wt<=0)return"";var tn=gt>=0?gt+wt:Bt+gt+wt;return Rt.slice(gt,tn).join("")}return Rt.slice(gt).join("")}}function _t(pt,gt){if(!(typeof pt>"u")){var wt=pt.indexOf(gt);return wt>-1?pt.substr(0,wt):pt}}function At(pt,gt){if(!(typeof pt>"u")){var wt=pt.indexOf(gt);return wt>-1?pt.substr(wt+gt.length):pt}}function Et(pt){if(!(typeof pt>"u"))return pt.toLowerCase()}function Mt(pt){if(!(typeof pt>"u"))return pt.toUpperCase()}function Ot(pt){if(!(typeof pt>"u"))return nt(pt).length}function kt(pt){if(!(typeof pt>"u")){var gt=pt.replace(/[ \t\n\r]+/gm," ");return gt.charAt(0)===" "&&(gt=gt.substring(1)),gt.charAt(gt.length-1)===" "&&(gt=gt.substring(0,gt.length-1)),gt}}function yt(pt,gt,wt){if(!(typeof pt>"u")){(typeof wt>"u"||wt.length===0)&&(wt=" ");var Rt;gt=Math.trunc(gt);var Bt=Math.abs(gt)-Ot(pt);if(Bt>0){var tn=new Array(Bt+1).join(wt);wt.length>1&&(tn=ut(tn,0,Bt)),gt>0?Rt=pt+tn:Rt=tn+pt}else Rt=pt;return Rt}}async function St(pt,gt){var wt=pt.apply(this,[gt]);if(Ye(wt)&&(wt=await wt),wt&&!(typeof wt.start=="number"||wt.end==="number"||Array.isArray(wt.groups)||H(wt.next)))throw{code:"T1010",stack:new Error().stack};return wt}async function Yt(pt,gt){if(!(typeof pt>"u")){var wt;if(typeof gt=="string")wt=pt.indexOf(gt)!==-1;else{var Rt=await St(gt,pt);wt=typeof Rt<"u"}return wt}}async function Ft(pt,gt,wt){if(!(typeof pt>"u")){if(wt<0)throw{stack:new Error().stack,value:wt,code:"D3040",index:3};var Rt=f();if(typeof wt>"u"||wt>0){var Bt=0,tn=await St(gt,pt);if(typeof tn<"u")for(;typeof tn<"u"&&(typeof wt>"u"||Bt<wt);)Rt.push({match:tn.match,index:tn.start,groups:tn.groups}),tn=await St(tn.next),Bt++}return Rt}}async function ln(pt,gt,wt,Rt){if(!(typeof pt>"u")){var Bt=this;if(gt==="")throw{code:"D3010",stack:new Error().stack,value:gt,index:2};if(Rt<0)throw{code:"D3011",stack:new Error().stack,value:Rt,index:4};var tn;typeof wt=="string"?tn=function(Hn){for(var ar="",Vn=0,sr=wt.indexOf("$",Vn);sr!==-1&&Vn<wt.length;){ar+=wt.substring(Vn,sr),Vn=sr+1;var _r=wt.charAt(Vn);if(_r==="$")ar+="$",Vn++;else if(_r==="0")ar+=Hn.match,Vn++;else{var er;if(Hn.groups.length===0?er=1:er=Math.floor(Math.log(Hn.groups.length)*Math.LOG10E)+1,sr=parseInt(wt.substring(Vn,Vn+er),10),er>1&&sr>Hn.groups.length&&(sr=parseInt(wt.substring(Vn,Vn+er-1),10)),isNaN(sr))ar+="$";else{if(Hn.groups.length>0){var Tt=Hn.groups[sr-1];typeof Tt<"u"&&(ar+=Tt)}Vn+=sr.toString().length}}sr=wt.indexOf("$",Vn)}return ar+=wt.substring(Vn),ar}:tn=wt;var yn="",An=0;if(typeof Rt>"u"||Rt>0){var Mn=0;if(typeof gt=="string"){for(var Xn=pt.indexOf(gt,An);Xn!==-1&&(typeof Rt>"u"||Mn<Rt);)yn+=pt.substring(An,Xn),yn+=wt,An=Xn+gt.length,Mn++,Xn=pt.indexOf(gt,An);yn+=pt.substring(An)}else{var zn=await St(gt,pt);if(typeof zn<"u"){for(;typeof zn<"u"&&(typeof Rt>"u"||Mn<Rt);){yn+=pt.substring(An,zn.start);var Jn=tn.apply(Bt,[zn]);if(Ye(Jn)&&(Jn=await Jn),typeof Jn=="string")yn+=Jn;else throw{code:"D3012",stack:new Error().stack,value:Jn};An=zn.start+zn.match.length,Mn++,zn=await St(zn.next)}yn+=pt.substring(An)}else yn=pt}}else yn=pt;return yn}}function dn(pt){if(!(typeof pt>"u")){var gt=typeof window<"u"?window.btoa:function(wt){return new Y.Buffer.from(wt,"binary").toString("base64")};return gt(pt)}}function Pt(pt){if(!(typeof pt>"u")){var gt=typeof window<"u"?window.atob:function(wt){return new Y.Buffer.from(wt,"base64").toString("binary")};return gt(pt)}}function $t(pt){if(!(typeof pt>"u")){var gt;try{gt=encodeURIComponent(pt)}catch{throw{code:"D3140",stack:new Error().stack,value:pt,functionName:"encodeUrlComponent"}}return gt}}function hn(pt){if(!(typeof pt>"u")){var gt;try{gt=encodeURI(pt)}catch{throw{code:"D3140",stack:new Error().stack,value:pt,functionName:"encodeUrl"}}return gt}}function _n(pt){if(!(typeof pt>"u")){var gt;try{gt=decodeURIComponent(pt)}catch{throw{code:"D3140",stack:new Error().stack,value:pt,functionName:"decodeUrlComponent"}}return gt}}function On(pt){if(!(typeof pt>"u")){var gt;try{gt=decodeURI(pt)}catch{throw{code:"D3140",stack:new Error().stack,value:pt,functionName:"decodeUrl"}}return gt}}async function En(pt,gt,wt){if(!(typeof pt>"u")){if(wt<0)throw{code:"D3020",stack:new Error().stack,value:wt,index:3};var Rt=[];if(typeof wt>"u"||wt>0)if(typeof gt=="string")Rt=pt.split(gt,wt);else{var Bt=0,tn=await St(gt,pt);if(typeof tn<"u"){for(var yn=0;typeof tn<"u"&&(typeof wt>"u"||Bt<wt);)Rt.push(pt.substring(yn,tn.start)),yn=tn.end,tn=await St(tn.next),Bt++;(typeof wt>"u"||Bt<wt)&&Rt.push(pt.substring(yn))}else Rt.push(pt)}return Rt}}function qt(pt,gt){if(!(typeof pt>"u"))return typeof gt>"u"&&(gt=""),pt.join(gt)}function Jt(pt,gt,wt){if(!(typeof pt>"u")){var Rt={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"‰","zero-digit":"0",digit:"#","pattern-separator":";"},Bt=Rt;typeof wt<"u"&&Object.keys(wt).forEach(function(Pn){Bt[Pn]=wt[Pn]});for(var tn=[],yn=Bt["zero-digit"].charCodeAt(0),An=yn;An<yn+10;An++)tn.push(String.fromCharCode(An));var Mn=tn.concat([Bt["decimal-separator"],Bt["exponent-separator"],Bt["grouping-separator"],Bt.digit,Bt["pattern-separator"]]),Xn=gt.split(Bt["pattern-separator"]);if(Xn.length>2)throw{code:"D3080",stack:new Error().stack};var zn=function(Pn){var Qn=(function(){for(var hr,Sr=0;Sr<Pn.length;Sr++)if(hr=Pn.charAt(Sr),Mn.indexOf(hr)!==-1&&hr!==Bt["exponent-separator"])return Pn.substring(0,Sr)})(),gr=(function(){for(var hr,Sr=Pn.length-1;Sr>=0;Sr--)if(hr=Pn.charAt(Sr),Mn.indexOf(hr)!==-1&&hr!==Bt["exponent-separator"])return Pn.substring(Sr+1)})(),rr=Pn.substring(Qn.length,Pn.length-gr.length),xr,dr,yr,pr,Tr=Pn.indexOf(Bt["exponent-separator"],Qn.length);Tr===-1||Tr>Pn.length-gr.length?(xr=rr,dr=void 0):(xr=rr.substring(0,Tr),dr=rr.substring(Tr+1));var Er=xr.indexOf(Bt["decimal-separator"]);return Er===-1?(yr=xr,pr=gr):(yr=xr.substring(0,Er),pr=xr.substring(Er+1)),{prefix:Qn,suffix:gr,activePart:rr,mantissaPart:xr,exponentPart:dr,integerPart:yr,fractionalPart:pr,subpicture:Pn}},Jn=function(Pn){var Qn,gr,rr=Pn.subpicture,xr=rr.indexOf(Bt["decimal-separator"]);xr!==rr.lastIndexOf(Bt["decimal-separator"])&&(Qn="D3081"),rr.indexOf(Bt.percent)!==rr.lastIndexOf(Bt.percent)&&(Qn="D3082"),rr.indexOf(Bt["per-mille"])!==rr.lastIndexOf(Bt["per-mille"])&&(Qn="D3083"),rr.indexOf(Bt.percent)!==-1&&rr.indexOf(Bt["per-mille"])!==-1&&(Qn="D3084");var dr=!1;for(gr=0;gr<Pn.mantissaPart.length;gr++){var yr=Pn.mantissaPart.charAt(gr);if(tn.indexOf(yr)!==-1||yr===Bt.digit){dr=!0;break}}dr||(Qn="D3085");var pr=Pn.activePart.split("").map(function(hr){return Mn.indexOf(hr)===-1?"p":"a"}).join("");pr.indexOf("p")!==-1&&(Qn="D3086"),xr!==-1?(rr.charAt(xr-1)===Bt["grouping-separator"]||rr.charAt(xr+1)===Bt["grouping-separator"])&&(Qn="D3087"):Pn.integerPart.charAt(Pn.integerPart.length-1)===Bt["grouping-separator"]&&(Qn="D3088"),rr.indexOf(Bt["grouping-separator"]+Bt["grouping-separator"])!==-1&&(Qn="D3089");var Tr=Pn.integerPart.indexOf(Bt.digit);Tr!==-1&&Pn.integerPart.substring(0,Tr).split("").filter(function(hr){return tn.indexOf(hr)>-1}).length>0&&(Qn="D3090"),Tr=Pn.fractionalPart.lastIndexOf(Bt.digit),Tr!==-1&&Pn.fractionalPart.substring(Tr).split("").filter(function(hr){return tn.indexOf(hr)>-1}).length>0&&(Qn="D3091");var Er=typeof Pn.exponentPart=="string";if(Er&&Pn.exponentPart.length>0&&(rr.indexOf(Bt.percent)!==-1||rr.indexOf(Bt["per-mille"])!==-1)&&(Qn="D3092"),Er&&(Pn.exponentPart.length===0||Pn.exponentPart.split("").filter(function(hr){return tn.indexOf(hr)===-1}).length>0)&&(Qn="D3093"),Qn)throw{code:Qn,stack:new Error().stack}},Hn=function(Pn){var Qn=function(mr,Mr){for(var Cr=[],Ar=mr.indexOf(Bt["grouping-separator"]);Ar!==-1;){var Dr=(Mr?mr.substring(0,Ar):mr.substring(Ar)).split("").filter(function(Or){return tn.indexOf(Or)!==-1||Or===Bt.digit}).length;Cr.push(Dr),Ar=Pn.integerPart.indexOf(Bt["grouping-separator"],Ar+1)}return Cr},gr=Qn(Pn.integerPart),rr=function(mr){if(mr.length===0)return 0;for(var Mr=function(Dr,Or){return Or===0?Dr:Mr(Or,Dr%Or)},Cr=mr.reduce(Mr),Ar=1;Ar<=mr.length;Ar++)if(mr.indexOf(Ar*Cr)===-1)return 0;return Cr},xr=rr(gr),dr=Qn(Pn.fractionalPart,!0),yr=Pn.integerPart.split("").filter(function(mr){return tn.indexOf(mr)!==-1}).length,pr=yr,Tr=Pn.fractionalPart.split(""),Er=Tr.filter(function(mr){return tn.indexOf(mr)!==-1}).length,hr=Tr.filter(function(mr){return tn.indexOf(mr)!==-1||mr===Bt.digit}).length,Sr=typeof Pn.exponentPart=="string";yr===0&&hr===0&&(Sr?(Er=1,hr=1):yr=1),Sr&&yr===0&&Pn.integerPart.indexOf(Bt.digit)!==-1&&(yr=1),yr===0&&Er===0&&(Er=1);var Pr=0;return Sr&&(Pr=Pn.exponentPart.split("").filter(function(mr){return tn.indexOf(mr)!==-1}).length),{integerPartGroupingPositions:gr,regularGrouping:xr,minimumIntegerPartSize:yr,scalingFactor:pr,prefix:Pn.prefix,fractionalPartGroupingPositions:dr,minimumFactionalPartSize:Er,maximumFactionalPartSize:hr,minimumExponentSize:Pr,suffix:Pn.suffix,picture:Pn.subpicture}},ar=Xn.map(zn);ar.forEach(Jn);var Vn=ar.map(Hn),sr=Bt["minus-sign"],_r=Bt["zero-digit"],er=Bt["decimal-separator"],Tt=Bt["grouping-separator"];Vn.length===1&&(Vn.push(JSON.parse(JSON.stringify(Vn[0]))),Vn[1].prefix=sr+Vn[1].prefix);var Nt;pt>=0?Nt=Vn[0]:Nt=Vn[1];var Vt;Nt.picture.indexOf(Bt.percent)!==-1?Vt=pt*100:Nt.picture.indexOf(Bt["per-mille"])!==-1?Vt=pt*1e3:Vt=pt;var Ht,Xt;if(Nt.minimumExponentSize===0)Ht=Vt;else{var sn=Math.pow(10,Nt.scalingFactor),vn=Math.pow(10,Nt.scalingFactor-1);for(Ht=Vt,Xt=0;Ht<vn;)Ht*=10,Xt-=1;for(;Ht>sn;)Ht/=10,Xt+=1}var Dn=mn(Ht,Nt.maximumFactionalPartSize),Sn=function(Pn,Qn){var gr=Math.abs(Pn).toFixed(Qn);return _r!=="0"&&(gr=gr.split("").map(function(rr){return rr>="0"&&rr<="9"?tn[rr.charCodeAt(0)-48]:rr}).join("")),gr},xn=Sn(Dn,Nt.maximumFactionalPartSize),Bn=xn.indexOf(".");for(Bn===-1?xn=xn+er:xn=xn.replace(".",er);xn.charAt(0)===_r;)xn=xn.substring(1);for(;xn.charAt(xn.length-1)===_r;)xn=xn.substring(0,xn.length-1);Bn=xn.indexOf(er);var lr=Nt.minimumIntegerPartSize-Bn,fr=Nt.minimumFactionalPartSize-(xn.length-Bn-1);if(xn=(lr>0?new Array(lr+1).join(_r):"")+xn,xn=xn+(fr>0?new Array(fr+1).join(_r):""),Bn=xn.indexOf(er),Nt.regularGrouping>0)for(var en=Math.floor((Bn-1)/Nt.regularGrouping),qn=1;qn<=en;qn++)xn=[xn.slice(0,Bn-qn*Nt.regularGrouping),Tt,xn.slice(Bn-qn*Nt.regularGrouping)].join("");else Nt.integerPartGroupingPositions.forEach(function(Pn){xn=[xn.slice(0,Bn-Pn),Tt,xn.slice(Bn-Pn)].join(""),Bn++});if(Bn=xn.indexOf(er),Nt.fractionalPartGroupingPositions.forEach(function(Pn){xn=[xn.slice(0,Pn+Bn+1),Tt,xn.slice(Pn+Bn+1)].join("")}),Bn=xn.indexOf(er),(Nt.picture.indexOf(er)===-1||Bn===xn.length-1)&&(xn=xn.substring(0,xn.length-1)),typeof Xt<"u"){var nr=Sn(Xt,0);lr=Nt.minimumExponentSize-nr.length,lr>0&&(nr=new Array(lr+1).join(_r)+nr),xn=xn+Bt["exponent-separator"]+(Xt<0?sr:"")+nr}return xn=Nt.prefix+xn+Nt.suffix,xn}}function Wt(pt,gt){if(!(typeof pt>"u")){if(pt=mn(pt),typeof gt>"u"?gt=10:gt=mn(gt),gt<2||gt>36)throw{code:"D3100",stack:new Error().stack,value:gt};var wt=pt.toString(gt);return wt}}function un(pt){var gt;if(!(typeof pt>"u")){if(typeof pt=="number")gt=pt;else if(typeof pt=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(pt)&&!isNaN(parseFloat(pt))&&isFinite(pt))gt=parseFloat(pt);else if(typeof pt=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(pt))gt=Number(pt);else if(pt===!0)gt=1;else if(pt===!1)gt=0;else throw{code:"D3030",value:pt,stack:new Error().stack,index:1};return gt}}function fn(pt){var gt;if(!(typeof pt>"u"))return gt=Math.abs(pt),gt}function pn(pt){var gt;if(!(typeof pt>"u"))return gt=Math.floor(pt),gt}function Zt(pt){var gt;if(!(typeof pt>"u"))return gt=Math.ceil(pt),gt}function mn(pt,gt){var wt;if(!(typeof pt>"u")){if(gt){var Rt=pt.toString().split("e");pt=+(Rt[0]+"e"+(Rt[1]?+Rt[1]+gt:gt))}wt=Math.round(pt);var Bt=wt-pt;return Math.abs(Bt)===.5&&Math.abs(wt%2)===1&&(wt=wt-1),gt&&(Rt=wt.toString().split("e"),wt=+(Rt[0]+"e"+(Rt[1]?+Rt[1]-gt:-gt))),Object.is(wt,-0)&&(wt=0),wt}}function Tn(pt){var gt;if(!(typeof pt>"u")){if(pt<0)throw{stack:new Error().stack,code:"D3060",index:1,value:pt};return gt=Math.sqrt(pt),gt}}function $n(pt,gt){var wt;if(!(typeof pt>"u")){if(wt=Math.pow(pt,gt),!isFinite(wt))throw{stack:new Error().stack,code:"D3061",index:1,value:pt,exp:gt};return wt}}function Un(){return Math.random()}function In(pt){if(!(typeof pt>"u")){var gt=!1;if(Array.isArray(pt)){if(pt.length===1)gt=In(pt[0]);else if(pt.length>1){var wt=pt.filter(function(Rt){return In(Rt)});gt=wt.length>0}}else typeof pt=="string"?pt.length>0&&(gt=!0):xe(pt)?pt!==0&&(gt=!0):pt!==null&&typeof pt=="object"&&!H(pt)?Object.keys(pt).length>0&&(gt=!0):typeof pt=="boolean"&&pt===!0&&(gt=!0);return gt}}function kn(pt){if(!(typeof pt>"u"))return!In(pt)}function Kt(pt,gt,wt,Rt){var Bt=[gt],tn=et(pt);return tn>=2&&Bt.push(wt),tn>=3&&Bt.push(Rt),Bt}async function Dt(pt,gt){if(!(typeof pt>"u")){for(var wt=f(),Rt=0;Rt<pt.length;Rt++){var Bt=Kt(gt,pt[Rt],Rt,pt),tn=await gt.apply(this,Bt);typeof tn<"u"&&wt.push(tn)}return wt}}async function Qt(pt,gt){if(!(typeof pt>"u")){for(var wt=f(),Rt=0;Rt<pt.length;Rt++){var Bt=pt[Rt],tn=Kt(gt,Bt,Rt,pt),yn=await gt.apply(this,tn);In(yn)&&wt.push(Bt)}return wt}}async function cn(pt,gt){if(!(typeof pt>"u")){for(var wt=!1,Rt,Bt=0;Bt<pt.length;Bt++){var tn=pt[Bt],yn=!0;if(typeof gt<"u"){var An=Kt(gt,tn,Bt,pt),Mn=await gt.apply(this,An);yn=In(Mn)}if(yn)if(!wt)Rt=tn,wt=!0;else throw{stack:new Error().stack,code:"D3138",index:Bt}}if(!wt)throw{stack:new Error().stack,code:"D3139"};return Rt}}function nn(){for(var pt=[],gt=Array.prototype.slice.call(arguments),wt=Math.min.apply(Math,gt.map(function(tn){return Array.isArray(tn)?tn.length:0})),Rt=0;Rt<wt;Rt++){var Bt=gt.map(tn=>tn[Rt]);pt.push(Bt)}return pt}async function gn(pt,gt,wt){if(!(typeof pt>"u")){var Rt,Bt=et(gt);if(Bt<2)throw{stack:new Error().stack,code:"D3050",index:1};var tn;for(typeof wt>"u"&&pt.length>0?(Rt=pt[0],tn=1):(Rt=wt,tn=0);tn<pt.length;){var yn=[Rt,pt[tn]];Bt>=3&&yn.push(tn),Bt>=4&&yn.push(pt),Rt=await gt.apply(this,yn),tn++}return Rt}}function Cn(pt){var gt=f();if(Array.isArray(pt)){var wt={};pt.forEach(function(Rt){var Bt=Cn(Rt);Bt.forEach(function(tn){wt[tn]=!0})}),gt=Cn(wt)}else pt!==null&&typeof pt=="object"&&!H(pt)&&Object.keys(pt).forEach(Rt=>gt.push(Rt));return gt}function Fn(pt,gt){var wt;if(Array.isArray(pt)){wt=f();for(var Rt=0;Rt<pt.length;Rt++){var Bt=Fn(pt[Rt],gt);typeof Bt<"u"&&(Array.isArray(Bt)?Bt.forEach(tn=>wt.push(tn)):wt.push(Bt))}}else pt!==null&&typeof pt=="object"&&!H(pt)&&(wt=pt[gt]);return wt}function Gn(pt,gt){return typeof pt>"u"?gt:typeof gt>"u"?pt:(Array.isArray(pt)||(pt=f(pt)),Array.isArray(gt)||(gt=[gt]),pt.concat(gt))}function Zn(pt){return!(typeof pt>"u")}function cr(pt){var gt=f();if(Array.isArray(pt))pt.forEach(function(Bt){gt=Gn(gt,cr(Bt))});else if(pt!==null&&typeof pt=="object"&&!Z(pt))for(var wt in pt){var Rt={};Rt[wt]=pt[wt],gt.push(Rt)}else gt=pt;return gt}function bn(pt){if(!(typeof pt>"u")){var gt={};return pt.forEach(function(wt){for(var Rt in wt)gt[Rt]=wt[Rt]}),gt}}function vr(pt){if(!(typeof pt>"u")){if(pt.length<=1)return pt;for(var gt=pt.length,wt=new Array(gt),Rt=0;Rt<gt;Rt++)wt[gt-Rt-1]=pt[Rt];return wt}}async function Nn(pt,gt){var wt=f();for(var Rt in pt){var Bt=Kt(gt,pt[Rt],Rt,pt),tn=await gt.apply(this,Bt);typeof tn<"u"&&wt.push(tn)}return wt}function ur(pt){throw{code:"D3137",stack:new Error().stack,message:pt||"$error() function evaluated"}}function ir(pt,gt){if(!pt)throw{code:"D3141",stack:new Error().stack,message:gt||"$assert() statement failed"}}function wr(pt){if(pt!==void 0)return pt===null?"null":xe(pt)?"number":typeof pt=="string"?"string":typeof pt=="boolean"?"boolean":Array.isArray(pt)?"array":H(pt)?"function":"object"}async function jn(pt,gt){if(!(typeof pt>"u")){if(pt.length<=1)return pt;var wt;if(typeof gt>"u"){if(!te(pt)&&!ne(pt))throw{stack:new Error().stack,code:"D3070",index:1};wt=async function(yn,An){return yn>An}}else wt=gt;var Rt=async function(yn,An){var Mn=async function(zn,Jn,Hn){Jn.length===0?Array.prototype.push.apply(zn,Hn):Hn.length===0?Array.prototype.push.apply(zn,Jn):await wt(Jn[0],Hn[0])?(zn.push(Hn[0]),await Mn(zn,Jn,Hn.slice(1))):(zn.push(Jn[0]),await Mn(zn,Jn.slice(1),Hn))},Xn=[];return await Mn(Xn,yn,An),Xn},Bt=async function(yn){if(!Array.isArray(yn)||yn.length<=1)return yn;var An=Math.floor(yn.length/2),Mn=yn.slice(0,An),Xn=yn.slice(An);return Mn=await Bt(Mn),Xn=await Bt(Xn),await Rt(Mn,Xn)},tn=await Bt(pt);return tn}}function xt(pt){if(!(typeof pt>"u")){if(pt.length<=1)return pt;for(var gt=new Array(pt.length),wt=0;wt<pt.length;wt++){var Rt=Math.floor(Math.random()*(wt+1));wt!==Rt&&(gt[wt]=gt[Rt]),gt[Rt]=pt[wt]}return gt}}function zt(pt){if(!(typeof pt>"u")){if(!Array.isArray(pt)||pt.length<=1)return pt;for(var gt=d(pt)?f():[],wt=0;wt<pt.length;wt++){for(var Rt=pt[wt],Bt=!1,tn=0;tn<gt.length;tn++)if(tt(Rt,gt[tn])){Bt=!0;break}Bt||gt.push(Rt)}return gt}}async function Ut(pt,gt){var wt={};for(var Rt in pt){var Bt=pt[Rt],tn=Kt(gt,Bt,Rt,pt),yn=await gt.apply(this,tn);In(yn)&&(wt[Rt]=Bt)}return Object.keys(wt).length===0&&(wt=void 0),wt}return{sum:it,count:ot,max:st,min:at,average:ct,string:ft,substring:ut,substringBefore:_t,substringAfter:At,lowercase:Et,uppercase:Mt,length:Ot,trim:kt,pad:yt,match:Ft,contains:Yt,replace:ln,split:En,join:qt,formatNumber:Jt,formatBase:Wt,number:un,floor:pn,ceil:Zt,round:mn,abs:fn,sqrt:Tn,power:$n,random:Un,boolean:In,not:kn,map:Dt,zip:nn,filter:Qt,single:cn,foldLeft:gn,sift:Ut,keys:Cn,lookup:Fn,append:Gn,exists:Zn,spread:cr,merge:bn,reverse:vr,each:Nn,error:ur,assert:ir,type:wr,sort:jn,shuffle:xt,distinct:zt,base64encode:dn,base64decode:Pt,encodeUrlComponent:$t,encodeUrl:hn,decodeUrlComponent:_n,decodeUrl:On}})();A.exports=ee}).call(this)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(l,A,O){var Y=l("./datetime"),R=l("./functions"),ee=l("./utils"),xe=l("./parser"),ne=l("./signature"),te=(function(){var f=ee.isNumeric,d=ee.isArrayOfStrings,H=ee.isArrayOfNumbers,Z=ee.createSequence,Ye=ee.isSequence,et=ee.isFunction,tt=ee.isLambda,nt=ee.isIterable,it=ee.isPromise,ot=ee.getFunctionArity,st=ee.isDeepEqual,at=ur(null);async function ct(xt,zt,Ut){var pt,gt=Ut.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(gt&&await gt(xt,zt,Ut),xt.type){case"path":pt=await ft(xt,zt,Ut);break;case"binary":pt=await Ot(xt,zt,Ut);break;case"unary":pt=await kt(xt,zt,Ut);break;case"name":pt=yt(xt,zt);break;case"string":case"number":case"value":pt=St(xt);break;case"wildcard":pt=Yt(xt,zt);break;case"descendant":pt=ln(xt,zt);break;case"parent":pt=Ut.lookup(xt.slot.label);break;case"condition":pt=await pn(xt,zt,Ut);break;case"block":pt=await Zt(xt,zt,Ut);break;case"bind":pt=await fn(xt,zt,Ut);break;case"regex":pt=mn(xt);break;case"function":pt=await Kt(xt,zt,Ut);break;case"variable":pt=Tn(xt,zt,Ut);break;case"lambda":pt=cn(xt,zt,Ut);break;case"partial":pt=await nn(xt,zt,Ut);break;case"apply":pt=await kn(xt,zt,Ut);break;case"transform":pt=Un(xt,zt,Ut);break}if(Object.prototype.hasOwnProperty.call(xt,"predicate"))for(var wt=0;wt<xt.predicate.length;wt++)pt=await Mt(xt.predicate[wt].expr,pt,Ut);xt.type!=="path"&&Object.prototype.hasOwnProperty.call(xt,"group")&&(pt=await Jt(xt.group,pt,Ut));var Rt=Ut.lookup(Symbol.for("jsonata.__evaluate_exit"));return Rt&&await Rt(xt,zt,Ut,pt),pt&&Ye(pt)&&!pt.tupleStream&&(xt.keepArray&&(pt.keepSingleton=!0),pt.length===0?pt=void 0:pt.length===1&&(pt=pt.keepSingleton?pt:pt[0])),pt}async function ft(xt,zt,Ut){var pt;Array.isArray(zt)&&xt.steps[0].type!=="variable"?pt=zt:pt=Z(zt);for(var gt,wt=!1,Rt=void 0,Bt=0;Bt<xt.steps.length;Bt++){var tn=xt.steps[Bt];if(tn.tuple&&(wt=!0),Bt===0&&tn.consarray?gt=await ct(tn,pt,Ut):wt?Rt=await Et(tn,pt,Rt,Ut):gt=await _t(tn,pt,Ut,Bt===xt.steps.length-1),!wt&&(typeof gt>"u"||gt.length===0))break;typeof tn.focus>"u"&&(pt=gt)}if(wt)if(xt.tuple)gt=Rt;else for(gt=Z(),Bt=0;Bt<Rt.length;Bt++)gt.push(Rt[Bt]["@"]);return xt.keepSingletonArray&&(Array.isArray(gt)&&gt.cons&&!gt.sequence&&(gt=Z(gt)),gt.keepSingleton=!0),xt.hasOwnProperty("group")&&(gt=await Jt(xt.group,wt?Rt:gt,Ut)),gt}function ut(xt,zt){var Ut=ur(xt);for(const pt in zt)Ut.bind(pt,zt[pt]);return Ut}async function _t(xt,zt,Ut,pt){var gt;if(xt.type==="sort")return gt=await $n(xt,zt,Ut),xt.stages&&(gt=await At(xt.stages,gt,Ut)),gt;gt=Z();for(var wt=0;wt<zt.length;wt++){var Rt=await ct(xt,zt[wt],Ut);if(xt.stages)for(var Bt=0;Bt<xt.stages.length;Bt++)Rt=await Mt(xt.stages[Bt].expr,Rt,Ut);typeof Rt<"u"&&gt.push(Rt)}var tn=Z();return pt&&gt.length===1&&Array.isArray(gt[0])&&!Ye(gt[0])?tn=gt[0]:gt.forEach(function(yn){!Array.isArray(yn)||yn.cons?tn.push(yn):yn.forEach(An=>tn.push(An))}),tn}async function At(xt,zt,Ut){for(var pt=zt,gt=0;gt<xt.length;gt++){var wt=xt[gt];switch(wt.type){case"filter":pt=await Mt(wt.expr,pt,Ut);break;case"index":for(var Rt=0;Rt<pt.length;Rt++){var Bt=pt[Rt];Bt[wt.value]=Rt}break}}return pt}async function Et(xt,zt,Ut,pt){var gt;if(xt.type==="sort"){if(Ut)gt=await $n(xt,Ut,pt);else{var wt=await $n(xt,zt,pt);gt=Z(),gt.tupleStream=!0;for(var Rt=0;Rt<wt.length;Rt++){var Bt={"@":wt[Rt]};Bt[xt.index]=Rt,gt.push(Bt)}}return xt.stages&&(gt=await At(xt.stages,gt,pt)),gt}gt=Z(),gt.tupleStream=!0;var tn=pt;Ut===void 0&&(Ut=zt.map(Xn=>({"@":Xn})));for(var yn=0;yn<Ut.length;yn++){tn=ut(pt,Ut[yn]);var An=await ct(xt,Ut[yn]["@"],tn);if(typeof An<"u"){Array.isArray(An)||(An=[An]);for(var Mn=0;Mn<An.length;Mn++)Bt={},Object.assign(Bt,Ut[yn]),An.tupleStream?Object.assign(Bt,An[Mn]):(xt.focus?(Bt[xt.focus]=An[Mn],Bt["@"]=Ut[yn]["@"]):Bt["@"]=An[Mn],xt.index&&(Bt[xt.index]=Mn),xt.ancestor&&(Bt[xt.ancestor.label]=Ut[yn]["@"])),gt.push(Bt)}}return xt.stages&&(gt=await At(xt.stages,gt,pt)),gt}async function Mt(xt,zt,Ut){var pt=Z();if(zt&&zt.tupleStream&&(pt.tupleStream=!0),Array.isArray(zt)||(zt=Z(zt)),xt.type==="number"){var gt=Math.floor(xt.value);gt<0&&(gt=zt.length+gt);var wt=await zt[gt];typeof wt<"u"&&(Array.isArray(wt)?pt=wt:pt.push(wt))}else for(gt=0;gt<zt.length;gt++){var wt=zt[gt],Rt=wt,Bt=Ut;zt.tupleStream&&(Rt=wt["@"],Bt=ut(Ut,wt));var tn=await ct(xt,Rt,Bt);f(tn)&&(tn=[tn]),H(tn)?tn.forEach(function(An){var Mn=Math.floor(An);Mn<0&&(Mn=zt.length+Mn),Mn===gt&&pt.push(wt)}):R.boolean(tn)&&pt.push(wt)}return pt}async function Ot(xt,zt,Ut){var pt,gt=await ct(xt.lhs,zt,Ut),wt=xt.value,Rt=async()=>await ct(xt.rhs,zt,Ut);if(wt==="and"||wt==="or")try{return await On(gt,Rt,wt)}catch(tn){throw tn.position=xt.position,tn.token=wt,tn}var Bt=await Rt();try{switch(wt){case"+":case"-":case"*":case"/":case"%":pt=Pt(gt,Bt,wt);break;case"=":case"!=":pt=$t(gt,Bt,wt);break;case"<":case"<=":case">":case">=":pt=hn(gt,Bt,wt);break;case"&":pt=qt(gt,Bt);break;case"..":pt=un(gt,Bt);break;case"in":pt=_n(gt,Bt);break}}catch(tn){throw tn.position=xt.position,tn.token=wt,tn}return pt}async function kt(xt,zt,Ut){var pt;switch(xt.value){case"-":if(pt=await ct(xt.expression,zt,Ut),typeof pt>"u")pt=void 0;else if(f(pt))pt=-pt;else throw{code:"D1002",stack:new Error().stack,position:xt.position,token:xt.value,value:pt};break;case"[":pt=[];let Rt=await Promise.all(xt.expressions.map(async(Bt,tn)=>(Ut.isParallelCall=tn>0,[Bt,await ct(Bt,zt,Ut)])));for(let Bt of Rt){var[gt,wt]=Bt;typeof wt<"u"&&(gt.value==="["?pt.push(wt):pt=R.append(pt,wt))}xt.consarray&&Object.defineProperty(pt,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":pt=await Jt(xt,zt,Ut);break}return pt}function yt(xt,zt,Ut){return R.lookup(zt,xt.value)}function St(xt){return xt.value}function Yt(xt,zt){var Ut=Z();return Array.isArray(zt)&&zt.outerWrapper&&zt.length>0&&(zt=zt[0]),zt!==null&&typeof zt=="object"&&Object.keys(zt).forEach(function(pt){var gt=zt[pt];Array.isArray(gt)?(gt=Ft(gt),Ut=R.append(Ut,gt)):Ut.push(gt)}),Ut}function Ft(xt,zt){return typeof zt>"u"&&(zt=[]),Array.isArray(xt)?xt.forEach(function(Ut){Ft(Ut,zt)}):zt.push(xt),zt}function ln(xt,zt){var Ut,pt=Z();return typeof zt<"u"&&(dn(zt,pt),pt.length===1?Ut=pt[0]:Ut=pt),Ut}function dn(xt,zt){Array.isArray(xt)||zt.push(xt),Array.isArray(xt)?xt.forEach(function(Ut){dn(Ut,zt)}):xt!==null&&typeof xt=="object"&&Object.keys(xt).forEach(function(Ut){dn(xt[Ut],zt)})}function Pt(xt,zt,Ut){var pt;if(typeof xt<"u"&&!f(xt))throw{code:"T2001",stack:new Error().stack,value:xt};if(typeof zt<"u"&&!f(zt))throw{code:"T2002",stack:new Error().stack,value:zt};if(typeof xt>"u"||typeof zt>"u")return pt;switch(Ut){case"+":pt=xt+zt;break;case"-":pt=xt-zt;break;case"*":pt=xt*zt;break;case"/":pt=xt/zt;break;case"%":pt=xt%zt;break}return pt}function $t(xt,zt,Ut){var pt,gt=typeof xt,wt=typeof zt;if(gt==="undefined"||wt==="undefined")return!1;switch(Ut){case"=":pt=st(xt,zt);break;case"!=":pt=!st(xt,zt);break}return pt}function hn(xt,zt,Ut){var pt,gt=typeof xt,wt=typeof zt,Rt=gt==="undefined"||gt==="string"||gt==="number",Bt=wt==="undefined"||wt==="string"||wt==="number";if(!Rt||!Bt)throw{code:"T2010",stack:new Error().stack,value:gt==="string"||gt==="number"?zt:xt};if(!(gt==="undefined"||wt==="undefined")){if(gt!==wt)throw{code:"T2009",stack:new Error().stack,value:xt,value2:zt};switch(Ut){case"<":pt=xt<zt;break;case"<=":pt=xt<=zt;break;case">":pt=xt>zt;break;case">=":pt=xt>=zt;break}return pt}}function _n(xt,zt){var Ut=!1;if(typeof xt>"u"||typeof zt>"u")return!1;Array.isArray(zt)||(zt=[zt]);for(var pt=0;pt<zt.length;pt++)if(zt[pt]===xt){Ut=!0;break}return Ut}async function On(xt,zt,Ut){var pt,gt=En(xt);switch(Ut){case"and":pt=gt&&En(await zt());break;case"or":pt=gt||En(await zt());break}return pt}function En(xt){var zt=R.boolean(xt);return typeof zt>"u"?!1:zt}function qt(xt,zt){var Ut,pt="",gt="";return typeof xt<"u"&&(pt=R.string(xt)),typeof zt<"u"&&(gt=R.string(zt)),Ut=pt.concat(gt),Ut}async function Jt(xt,zt,Ut){var pt={},gt={},wt=!!(zt&&zt.tupleStream);Array.isArray(zt)||(zt=Z(zt)),zt.length===0&&zt.push(void 0);for(var Rt=0;Rt<zt.length;Rt++)for(var Bt=zt[Rt],tn=wt?ut(Ut,Bt):Ut,yn=0;yn<xt.lhs.length;yn++){var An=xt.lhs[yn],Mn=await ct(An[0],wt?Bt["@"]:Bt,tn);if(typeof Mn!="string"&&Mn!==void 0)throw{code:"T1003",stack:new Error().stack,position:xt.position,value:Mn};if(Mn!==void 0){var Xn={data:Bt,exprIndex:yn};if(gt.hasOwnProperty(Mn)){if(gt[Mn].exprIndex!==yn)throw{code:"D1009",stack:new Error().stack,position:xt.position,value:Mn};gt[Mn].data=R.append(gt[Mn].data,Bt)}else gt[Mn]=Xn}}let zn=await Promise.all(Object.keys(gt).map(async(Hn,ar)=>{let Vn=gt[Hn];var sr=Vn.data,_r=Ut;if(wt){var er=Wt(Vn.data);sr=er["@"],delete er["@"],_r=ut(Ut,er)}return Ut.isParallelCall=ar>0,[Hn,await ct(xt.lhs[Vn.exprIndex][1],sr,_r)]}));for(let Hn of zn){var[Mn,Jn]=await Hn;typeof Jn<"u"&&(pt[Mn]=Jn)}return pt}function Wt(xt){if(!Array.isArray(xt))return xt;var zt={};Object.assign(zt,xt[0]);for(var Ut=1;Ut<xt.length;Ut++)for(const pt in xt[Ut])zt[pt]=R.append(zt[pt],xt[Ut][pt]);return zt}function un(xt,zt){var Ut;if(typeof xt<"u"&&!Number.isInteger(xt))throw{code:"T2003",stack:new Error().stack,value:xt};if(typeof zt<"u"&&!Number.isInteger(zt))throw{code:"T2004",stack:new Error().stack,value:zt};if(typeof xt>"u"||typeof zt>"u"||xt>zt)return Ut;var pt=zt-xt+1;if(pt>1e7)throw{code:"D2014",stack:new Error().stack,value:pt};Ut=new Array(pt);for(var gt=xt,wt=0;gt<=zt;gt++,wt++)Ut[wt]=gt;return Ut.sequence=!0,Ut}async function fn(xt,zt,Ut){var pt=await ct(xt.rhs,zt,Ut);return Ut.bind(xt.lhs.value,pt),pt}async function pn(xt,zt,Ut){var pt,gt=await ct(xt.condition,zt,Ut);return R.boolean(gt)?pt=await ct(xt.then,zt,Ut):typeof xt.else<"u"&&(pt=await ct(xt.else,zt,Ut)),pt}async function Zt(xt,zt,Ut){for(var pt,gt=ur(Ut),wt=0;wt<xt.expressions.length;wt++)pt=await ct(xt.expressions[wt],zt,gt);return pt}function mn(xt){var zt=new jn.RegexEngine(xt.value),Ut=function(pt,gt){var wt;zt.lastIndex=gt||0;var Rt=zt.exec(pt);if(Rt!==null){if(wt={match:Rt[0],start:Rt.index,end:Rt.index+Rt[0].length,groups:[]},Rt.length>1)for(var Bt=1;Bt<Rt.length;Bt++)wt.groups.push(Rt[Bt]);wt.next=function(){if(!(zt.lastIndex>=pt.length)){var tn=Ut(pt,zt.lastIndex);if(tn&&tn.match==="")throw{code:"D1004",stack:new Error().stack,position:xt.position,value:xt.value.source};return tn}}}return wt};return Ut}function Tn(xt,zt,Ut){var pt;return xt.value===""?pt=zt&&zt.outerWrapper?zt[0]:zt:pt=Ut.lookup(xt.value),pt}async function $n(xt,zt,Ut){var pt,gt=zt,wt=!!zt.tupleStream,Rt=async function(tn,yn){for(var An=0,Mn=0;An===0&&Mn<xt.terms.length;Mn++){var Xn=xt.terms[Mn],zn=tn,Jn=Ut;wt&&(zn=tn["@"],Jn=ut(Ut,tn));var Hn=await ct(Xn.expression,zn,Jn);zn=yn,Jn=Ut,wt&&(zn=yn["@"],Jn=ut(Ut,yn));var ar=await ct(Xn.expression,zn,Jn),Vn=typeof Hn,sr=typeof ar;if(Vn==="undefined"){An=sr==="undefined"?0:1;continue}if(sr==="undefined"){An=-1;continue}if(!(Vn==="string"||Vn==="number")||!(sr==="string"||sr==="number"))throw{code:"T2008",stack:new Error().stack,position:xt.position,value:Vn==="string"||Vn==="number"?ar:Hn};if(Vn!==sr)throw{code:"T2007",stack:new Error().stack,position:xt.position,value:Hn,value2:ar};Hn!==ar&&(Hn<ar?An=-1:An=1,Xn.descending===!0&&(An=-An))}return An===1},Bt={environment:Ut,input:zt};return pt=await R.sort.apply(Bt,[gt,Rt]),pt}function Un(xt,zt,Ut){var pt=async function(gt){if(!(typeof gt>"u")){var wt=Ut.lookup("clone");if(!et(wt))throw{code:"T2013",stack:new Error().stack,position:xt.position};var Rt=await Dt(wt,[gt],null,Ut),Bt=await ct(xt.pattern,Rt,Ut);if(typeof Bt<"u"){Array.isArray(Bt)||(Bt=[Bt]);for(var tn=0;tn<Bt.length;tn++){var yn=Bt[tn];if(yn&&(yn.isPrototypeOf(Rt)||yn instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:xt.position};var An=await ct(xt.update,yn,Ut),Mn=typeof An;if(Mn!=="undefined"){if(Mn!=="object"||An===null||Array.isArray(An))throw{code:"T2011",stack:new Error().stack,position:xt.update.position,value:An};for(var Xn in An)yn[Xn]=An[Xn]}if(typeof xt.delete<"u"){var zn=await ct(xt.delete,yn,Ut);if(typeof zn<"u"){var Jn=zn;if(Array.isArray(zn)||(zn=[zn]),!d(zn))throw{code:"T2012",stack:new Error().stack,position:xt.delete.position,value:Jn};for(var Hn=0;Hn<zn.length;Hn++)typeof yn=="object"&&yn!==null&&delete yn[zn[Hn]]}}}}return Rt}};return bn(pt,"<(oa):o>")}var In=xe("function($f, $g) { function($x){ $g($f($x)) } }");async function kn(xt,zt,Ut){var pt,gt=await ct(xt.lhs,zt,Ut);if(xt.rhs.type==="function")pt=await Kt(xt.rhs,zt,Ut,{context:gt});else{var wt=await ct(xt.rhs,zt,Ut);if(!et(wt))throw{code:"T2006",stack:new Error().stack,position:xt.position,value:wt};if(et(gt)){var Rt=await ct(In,null,Ut);pt=await Dt(Rt,[gt,wt],null,Ut)}else pt=await Dt(wt,[gt],null,Ut)}return pt}async function Kt(xt,zt,Ut,pt){var gt,wt=await ct(xt.procedure,zt,Ut);if(typeof wt>"u"&&xt.procedure.type==="path"&&Ut.lookup(xt.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:xt.position,token:xt.procedure.steps[0].value};var Rt=[];typeof pt<"u"&&Rt.push(pt.context);for(var Bt=0;Bt<xt.arguments.length;Bt++){const yn=await ct(xt.arguments[Bt],zt,Ut);if(et(yn)){const An=async function(...Mn){return await Dt(yn,Mn,null,Ut)};An.arity=ot(yn),Rt.push(An)}else Rt.push(yn)}var tn=xt.procedure.type==="path"?xt.procedure.steps[0].value:xt.procedure.value;try{typeof wt=="object"&&(wt.token=tn,wt.position=xt.position),gt=await Dt(wt,Rt,zt,Ut)}catch(yn){throw yn.position||(yn.position=xt.position),yn.token||(yn.token=tn),yn}return gt}async function Dt(xt,zt,Ut,pt){var gt;for(gt=await Qt(xt,zt,Ut,pt);tt(gt)&&gt.thunk===!0;){var wt=await ct(gt.body.procedure,gt.input,gt.environment);gt.body.procedure.type==="variable"&&(wt.token=gt.body.procedure.value),wt.position=gt.body.procedure.position;for(var Rt=[],Bt=0;Bt<gt.body.arguments.length;Bt++)Rt.push(await ct(gt.body.arguments[Bt],gt.input,gt.environment));gt=await Qt(wt,Rt,Ut,pt)}return gt}async function Qt(xt,zt,Ut,pt){var gt;try{var wt=zt;if(xt&&(wt=gn(xt.signature,zt,Ut)),tt(xt))gt=await Cn(xt,wt);else if(xt&&xt._jsonata_function===!0){var Rt={environment:pt,input:Ut};gt=xt.implementation.apply(Rt,wt),nt(gt)&&(gt=gt.next().value),it(gt)&&(gt=await gt)}else if(typeof xt=="function")gt=xt.apply(Ut,wt),it(gt)&&(gt=await gt);else throw{code:"T1006",stack:new Error().stack}}catch(Bt){throw xt&&(typeof Bt.token>"u"&&typeof xt.token<"u"&&(Bt.token=xt.token),Bt.position=xt.position||Bt.position),Bt}return gt}function cn(xt,zt,Ut){var pt={_jsonata_lambda:!0,input:zt,environment:Ut,arguments:xt.arguments,signature:xt.signature,body:xt.body};return xt.thunk===!0&&(pt.thunk=!0),pt.apply=async function(gt,wt){return await Dt(pt,wt,zt,gt?gt.environment:Ut)},pt}async function nn(xt,zt,Ut){for(var pt,gt=[],wt=0;wt<xt.arguments.length;wt++){var Rt=xt.arguments[wt];Rt.type==="operator"&&Rt.value==="?"?gt.push(Rt):gt.push(await ct(Rt,zt,Ut))}var Bt=await ct(xt.procedure,zt,Ut);if(typeof Bt>"u"&&xt.procedure.type==="path"&&Ut.lookup(xt.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:xt.position,token:xt.procedure.steps[0].value};if(tt(Bt))pt=Fn(Bt,gt);else if(Bt&&Bt._jsonata_function===!0)pt=Gn(Bt.implementation,gt);else if(typeof Bt=="function")pt=Gn(Bt,gt);else throw{code:"T1008",stack:new Error().stack,position:xt.position,token:xt.procedure.type==="path"?xt.procedure.steps[0].value:xt.procedure.value};return pt}function gn(xt,zt,Ut){if(typeof xt>"u")return zt;var pt=xt.validate(zt,Ut);return pt}async function Cn(xt,zt){var Ut,pt=ur(xt.environment);return xt.arguments.forEach(function(gt,wt){pt.bind(gt.value,zt[wt])}),typeof xt.body=="function"?Ut=await Zn(xt.body,pt):Ut=await ct(xt.body,xt.input,pt),Ut}function Fn(xt,zt){var Ut=ur(xt.environment),pt=[];xt.arguments.forEach(function(wt,Rt){var Bt=zt[Rt];Bt&&Bt.type==="operator"&&Bt.value==="?"?pt.push(wt):Ut.bind(wt.value,Bt)});var gt={_jsonata_lambda:!0,input:xt.input,environment:Ut,arguments:pt,body:xt.body};return gt}function Gn(xt,zt){var Ut=cr(xt);Ut=Ut.map(function(Rt){return"$"+Rt.trim()});var pt="function("+Ut.join(", ")+"){ _ }",gt=xe(pt);gt.body=xt;var wt=Fn(gt,zt);return wt}async function Zn(xt,zt){var Ut=cr(xt),pt=Ut.map(function(Rt){return zt.lookup(Rt.trim())}),gt={environment:zt},wt=xt.apply(gt,pt);return it(wt)&&(wt=await wt),wt}function cr(xt){var zt=xt.toString(),Ut=/\(([^)]*)\)/.exec(zt)[1],pt=Ut.split(",");return pt}function bn(xt,zt){var Ut={_jsonata_function:!0,implementation:xt};return typeof zt<"u"&&(Ut.signature=ne(zt)),Ut}async function vr(xt,zt){if(!(typeof xt>"u")){var Ut=this.input;typeof zt<"u"&&(Ut=zt,Array.isArray(Ut)&&!Ye(Ut)&&(Ut=Z(Ut),Ut.outerWrapper=!0));try{var pt=xe(xt,!1)}catch(wt){throw wr(wt),{stack:new Error().stack,code:"D3120",value:wt.message,error:wt}}try{var gt=await ct(pt,Ut,this.environment)}catch(wt){throw wr(wt),{stack:new Error().stack,code:"D3121",value:wt.message,error:wt}}return gt}}function Nn(xt){if(!(typeof xt>"u"))return JSON.parse(R.string(xt))}function ur(xt){var zt={};const Ut={bind:function(gt,wt){zt[gt]=wt},lookup:function(gt){var wt;return zt.hasOwnProperty(gt)?wt=zt[gt]:xt&&(wt=xt.lookup(gt)),wt},timestamp:xt?xt.timestamp:null,async:xt?xt.async:!1,isParallelCall:xt?xt.isParallelCall:!1,global:xt?xt.global:{ancestry:[null]}};if(xt){var pt=xt.lookup(Symbol.for("jsonata.__createFrame_push"));pt&&pt(xt,Ut)}return Ut}at.bind("sum",bn(R.sum,"<a<n>:n>")),at.bind("count",bn(R.count,"<a:n>")),at.bind("max",bn(R.max,"<a<n>:n>")),at.bind("min",bn(R.min,"<a<n>:n>")),at.bind("average",bn(R.average,"<a<n>:n>")),at.bind("string",bn(R.string,"<x-b?:s>")),at.bind("substring",bn(R.substring,"<s-nn?:s>")),at.bind("substringBefore",bn(R.substringBefore,"<s-s:s>")),at.bind("substringAfter",bn(R.substringAfter,"<s-s:s>")),at.bind("lowercase",bn(R.lowercase,"<s-:s>")),at.bind("uppercase",bn(R.uppercase,"<s-:s>")),at.bind("length",bn(R.length,"<s-:n>")),at.bind("trim",bn(R.trim,"<s-:s>")),at.bind("pad",bn(R.pad,"<s-ns?:s>")),at.bind("match",bn(R.match,"<s-f<s:o>n?:a<o>>")),at.bind("contains",bn(R.contains,"<s-(sf):b>")),at.bind("replace",bn(R.replace,"<s-(sf)(sf)n?:s>")),at.bind("split",bn(R.split,"<s-(sf)n?:a<s>>")),at.bind("join",bn(R.join,"<a<s>s?:s>")),at.bind("formatNumber",bn(R.formatNumber,"<n-so?:s>")),at.bind("formatBase",bn(R.formatBase,"<n-n?:s>")),at.bind("formatInteger",bn(Y.formatInteger,"<n-s:s>")),at.bind("parseInteger",bn(Y.parseInteger,"<s-s:n>")),at.bind("number",bn(R.number,"<(nsb)-:n>")),at.bind("floor",bn(R.floor,"<n-:n>")),at.bind("ceil",bn(R.ceil,"<n-:n>")),at.bind("round",bn(R.round,"<n-n?:n>")),at.bind("abs",bn(R.abs,"<n-:n>")),at.bind("sqrt",bn(R.sqrt,"<n-:n>")),at.bind("power",bn(R.power,"<n-n:n>")),at.bind("random",bn(R.random,"<:n>")),at.bind("boolean",bn(R.boolean,"<x-:b>")),at.bind("not",bn(R.not,"<x-:b>")),at.bind("map",bn(R.map,"<af>")),at.bind("zip",bn(R.zip,"<a+>")),at.bind("filter",bn(R.filter,"<af>")),at.bind("single",bn(R.single,"<af?>")),at.bind("reduce",bn(R.foldLeft,"<afj?:j>")),at.bind("sift",bn(R.sift,"<o-f?:o>")),at.bind("keys",bn(R.keys,"<x-:a<s>>")),at.bind("lookup",bn(R.lookup,"<x-s:x>")),at.bind("append",bn(R.append,"<xx:a>")),at.bind("exists",bn(R.exists,"<x:b>")),at.bind("spread",bn(R.spread,"<x-:a<o>>")),at.bind("merge",bn(R.merge,"<a<o>:o>")),at.bind("reverse",bn(R.reverse,"<a:a>")),at.bind("each",bn(R.each,"<o-f:a>")),at.bind("error",bn(R.error,"<s?:x>")),at.bind("assert",bn(R.assert,"<bs?:x>")),at.bind("type",bn(R.type,"<x:s>")),at.bind("sort",bn(R.sort,"<af?:a>")),at.bind("shuffle",bn(R.shuffle,"<a:a>")),at.bind("distinct",bn(R.distinct,"<x:x>")),at.bind("base64encode",bn(R.base64encode,"<s-:s>")),at.bind("base64decode",bn(R.base64decode,"<s-:s>")),at.bind("encodeUrlComponent",bn(R.encodeUrlComponent,"<s-:s>")),at.bind("encodeUrl",bn(R.encodeUrl,"<s-:s>")),at.bind("decodeUrlComponent",bn(R.decodeUrlComponent,"<s-:s>")),at.bind("decodeUrl",bn(R.decodeUrl,"<s-:s>")),at.bind("eval",bn(vr,"<sx?:x>")),at.bind("toMillis",bn(Y.toMillis,"<s-s?:n>")),at.bind("fromMillis",bn(Y.fromMillis,"<n-s?s?:s>")),at.bind("clone",bn(Nn,"<(oa)-:o>"));var ir={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function wr(xt){var zt=ir[xt.code];if(typeof zt<"u"){var Ut=zt.replace(/\{\{\{([^}]+)}}}/g,function(){return xt[arguments[1]]});Ut=Ut.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(xt[arguments[1]])}),xt.message=Ut}}function jn(xt,zt){var Ut,pt;try{Ut=xe(xt,zt&&zt.recover),pt=Ut.errors,delete Ut.errors}catch(Rt){throw wr(Rt),Rt}var gt=ur(at),wt=new Date;return gt.bind("now",bn(function(Rt,Bt){return Y.fromMillis(wt.getTime(),Rt,Bt)},"<s?s?:s>")),gt.bind("millis",bn(function(){return wt.getTime()},"<:n>")),zt&&zt.RegexEngine?jn.RegexEngine=zt.RegexEngine:jn.RegexEngine=RegExp,{evaluate:async function(Rt,Bt,tn){if(typeof pt<"u"){var yn={code:"S0500",position:0};throw wr(yn),yn}if(typeof Bt<"u"){var An;An=ur(gt);for(var Mn in Bt)An.bind(Mn,Bt[Mn])}else An=gt;An.bind("$",Rt),wt=new Date,An.timestamp=wt,Array.isArray(Rt)&&!Ye(Rt)&&(Rt=Z(Rt),Rt.outerWrapper=!0);var Xn;try{return Xn=await ct(Ut,Rt,An),typeof tn=="function"&&tn(null,Xn),Xn}catch(zn){throw wr(zn),zn}},assign:function(Rt,Bt){gt.bind(Rt,Bt)},registerFunction:function(Rt,Bt,tn){var yn=bn(Bt,tn);gt.bind(Rt,yn)},ast:function(){return Ut},errors:function(){return pt}}}return jn.parser=xe,jn})();A.exports=te},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(l,A,O){var Y=l("./signature");const R=(()=>{var ee={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},xe={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},ne=function(f){var d=0,H=f.length,Z=function(tt,nt){var it={type:tt,value:nt,position:d};return it},Ye=function(){for(var tt=d,nt=0,it,ot,st=function(ct){if(f.charAt(ct)==="/"&&nt===0){for(var ft=0;f.charAt(ct-(ft+1))==="\\";)ft++;if(ft%2===0)return!0}return!1};d<H;){var at=f.charAt(d);if(st(d)){if(it=f.substring(tt,d),it==="")throw{code:"S0301",stack:new Error().stack,position:d};for(d++,at=f.charAt(d),tt=d;at==="i"||at==="m";)d++,at=f.charAt(d);return ot=f.substring(tt,d)+"g",new RegExp(it,ot)}(at==="("||at==="["||at==="{")&&f.charAt(d-1)!=="\\"&&nt++,(at===")"||at==="]"||at==="}")&&f.charAt(d-1)!=="\\"&&nt--,d++}throw{code:"S0302",stack:new Error().stack,position:d}},et=function(tt){if(d>=H)return null;for(var nt=f.charAt(d);d<H&&` 	
\r\v`.indexOf(nt)>-1;)d++,nt=f.charAt(d);if(nt==="/"&&f.charAt(d+1)==="*"){var it=d;for(d+=2,nt=f.charAt(d);!(nt==="*"&&f.charAt(d+1)==="/");)if(nt=f.charAt(++d),d>=H)throw{code:"S0106",stack:new Error().stack,position:it};return d+=2,nt=f.charAt(d),et(tt)}if(tt!==!0&&nt==="/")return d++,Z("regex",Ye());if(nt==="."&&f.charAt(d+1)===".")return d+=2,Z("operator","..");if(nt===":"&&f.charAt(d+1)==="=")return d+=2,Z("operator",":=");if(nt==="!"&&f.charAt(d+1)==="=")return d+=2,Z("operator","!=");if(nt===">"&&f.charAt(d+1)==="=")return d+=2,Z("operator",">=");if(nt==="<"&&f.charAt(d+1)==="=")return d+=2,Z("operator","<=");if(nt==="*"&&f.charAt(d+1)==="*")return d+=2,Z("operator","**");if(nt==="~"&&f.charAt(d+1)===">")return d+=2,Z("operator","~>");if(nt==="?"&&f.charAt(d+1)===":")return d+=2,Z("operator","?:");if(nt==="?"&&f.charAt(d+1)==="?")return d+=2,Z("operator","??");if(Object.prototype.hasOwnProperty.call(ee,nt))return d++,Z("operator",nt);if(nt==='"'||nt==="'"){var ot=nt;d++;for(var st="";d<H;){if(nt=f.charAt(d),nt==="\\")if(d++,nt=f.charAt(d),Object.prototype.hasOwnProperty.call(xe,nt))st+=xe[nt];else if(nt==="u"){var at=f.substr(d+1,4);if(/^[0-9a-fA-F]+$/.test(at)){var ct=parseInt(at,16);st+=String.fromCharCode(ct),d+=4}else throw{code:"S0104",stack:new Error().stack,position:d}}else throw{code:"S0103",stack:new Error().stack,position:d,token:nt};else{if(nt===ot)return d++,Z("string",st);st+=nt}d++}throw{code:"S0101",stack:new Error().stack,position:d}}var ft=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,ut=ft.exec(f.substring(d));if(ut!==null){var _t=parseFloat(ut[0]);if(!isNaN(_t)&&isFinite(_t))return d+=ut[0].length,Z("number",_t);throw{code:"S0102",stack:new Error().stack,position:d,token:ut[0]}}var At;if(nt==="`"){d++;var Et=f.indexOf("`",d);if(Et!==-1)return At=f.substring(d,Et),d=Et+1,Z("name",At);throw d=H,{code:"S0105",stack:new Error().stack,position:d}}for(var Mt=d,Ot;;)if(Ot=f.charAt(Mt),Mt===H||` 	
\r\v`.indexOf(Ot)>-1||Object.prototype.hasOwnProperty.call(ee,Ot)){if(f.charAt(d)==="$")return At=f.substring(d+1,Mt),d=Mt,Z("variable",At);switch(At=f.substring(d,Mt),d=Mt,At){case"or":case"in":case"and":return Z("operator",At);case"true":return Z("value",!0);case"false":return Z("value",!1);case"null":return Z("value",null);default:return d===H&&At===""?null:Z("name",At)}}else Mt++};return et},te=function(f,d){var H,Z,Ye={},et=[],tt=function(){var Pt=[];H.id!=="(end)"&&Pt.push({type:H.type,value:H.value,position:H.position});for(var $t=Z();$t!==null;)Pt.push($t),$t=Z();return Pt},nt={nud:function(){var Pt={code:"S0211",token:this.value,position:this.position};if(d)return Pt.remaining=tt(),Pt.type="error",et.push(Pt),Pt;throw Pt.stack=new Error().stack,Pt}},it=function(Pt,$t){var hn=Ye[Pt];return $t=$t||0,hn?$t>=hn.lbp&&(hn.lbp=$t):(hn=Object.create(nt),hn.id=hn.value=Pt,hn.lbp=$t,Ye[Pt]=hn),hn},ot=function(Pt){if(d){Pt.remaining=tt(),et.push(Pt);var $t=Ye["(error)"];return H=Object.create($t),H.error=Pt,H.type="(error)",H}else throw Pt.stack=new Error().stack,Pt},st=function(Pt,$t){if(Pt&&H.id!==Pt){var hn;H.id==="(end)"?hn="S0203":hn="S0202";var _n={code:hn,position:H.position,token:H.value,value:Pt};return ot(_n)}var On=Z($t);if(On===null)return H=Ye["(end)"],H.position=f.length,H;var En=On.value,qt=On.type,Jt;switch(qt){case"name":case"variable":Jt=Ye["(name)"];break;case"operator":if(Jt=Ye[En],!Jt)return ot({code:"S0204",stack:new Error().stack,position:On.position,token:En});break;case"string":case"number":case"value":Jt=Ye["(literal)"];break;case"regex":qt="regex",Jt=Ye["(regex)"];break;default:return ot({code:"S0205",stack:new Error().stack,position:On.position,token:En})}return H=Object.create(Jt),H.value=En,H.type=qt,H.position=On.position,H},at=function(Pt){var $t,hn=H;for(st(null,!0),$t=hn.nud();Pt<H.lbp;)hn=H,st(),$t=hn.led($t);return $t},ct=function(Pt){var $t=it(Pt,0);$t.nud=function(){return this}},ft=function(Pt,$t,hn){var _n=$t||ee[Pt],On=it(Pt,_n);return On.led=hn||function(En){return this.lhs=En,this.rhs=at(_n),this.type="binary",this},On},ut=function(Pt,$t,hn){var _n=it(Pt,$t);return _n.led=hn,_n},_t=function(Pt,$t){var hn=it(Pt);return hn.nud=$t||function(){return this.expression=at(70),this.type="unary",this},hn};ct("(end)"),ct("(name)"),ct("(literal)"),ct("(regex)"),it(":"),it(";"),it(","),it(")"),it("]"),it("}"),it(".."),ft("."),ft("+"),ft("-"),ft("*"),ft("/"),ft("%"),ft("="),ft("<"),ft(">"),ft("!="),ft("<="),ft(">="),ft("&"),ft("and"),ft("or"),ft("in"),ct("and"),ct("or"),ct("in"),_t("-"),ft("~>"),ft("??",ee["??"],function(Pt){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[Pt]},this.then=Pt,this.else=at(0),this}),ut("(error)",10,function(Pt){return this.lhs=Pt,this.error=H.error,this.remaining=tt(),this.type="error",this}),_t("*",function(){return this.type="wildcard",this}),_t("**",function(){return this.type="descendant",this}),_t("%",function(){return this.type="parent",this}),ft("(",ee["("],function(Pt){if(this.procedure=Pt,this.type="function",this.arguments=[],H.id!==")")for(;H.type==="operator"&&H.id==="?"?(this.type="partial",this.arguments.push(H),st("?")):this.arguments.push(at(0)),H.id===",";)st(",");if(st(")",!0),Pt.type==="name"&&(Pt.value==="function"||Pt.value==="λ")){if(this.arguments.forEach(function(En,qt){if(En.type!=="variable")return ot({code:"S0208",stack:new Error().stack,position:En.position,token:En.value,value:qt+1})}),this.type="lambda",H.id==="<"){for(var $t=H.position,hn=1,_n="<";hn>0&&H.id!=="{"&&H.id!=="(end)";){var On=st();On.id===">"?hn--:On.id==="<"&&hn++,_n+=On.value}st(">");try{this.signature=Y(_n)}catch(En){return En.position=$t+En.offset,ot(En)}}st("{"),this.body=at(0),st("}")}return this}),_t("(",function(){for(var Pt=[];H.id!==")"&&(Pt.push(at(0)),H.id===";");)st(";");return st(")",!0),this.type="block",this.expressions=Pt,this}),_t("[",function(){var Pt=[];if(H.id!=="]")for(;;){var $t=at(0);if(H.id===".."){var hn={type:"binary",value:"..",position:H.position,lhs:$t};st(".."),hn.rhs=at(0),$t=hn}if(Pt.push($t),H.id!==",")break;st(",")}return st("]",!0),this.expressions=Pt,this.type="unary",this}),ft("[",ee["["],function(Pt){if(H.id==="]"){for(var $t=Pt;$t&&$t.type==="binary"&&$t.value==="[";)$t=$t.lhs;return $t.keepArray=!0,st("]"),Pt}else return this.lhs=Pt,this.rhs=at(ee["]"]),this.type="binary",st("]",!0),this}),ft("^",ee["^"],function(Pt){st("(");for(var $t=[];;){var hn={descending:!1};if(H.id==="<"?st("<"):H.id===">"&&(hn.descending=!0,st(">")),hn.expression=at(0),$t.push(hn),H.id!==",")break;st(",")}return st(")"),this.lhs=Pt,this.rhs=$t,this.type="binary",this});var At=function(Pt){var $t=[];if(H.id!=="}")for(;;){var hn=at(0);st(":");var _n=at(0);if($t.push([hn,_n]),H.id!==",")break;st(",")}return st("}",!0),typeof Pt>"u"?(this.lhs=$t,this.type="unary"):(this.lhs=Pt,this.rhs=$t,this.type="binary"),this};_t("{",At),ft("{",ee["{"],At),ut(":=",ee[":="],function(Pt){return Pt.type!=="variable"?ot({code:"S0212",stack:new Error().stack,position:Pt.position,token:Pt.value}):(this.lhs=Pt,this.rhs=at(ee[":="]-1),this.type="binary",this)}),ft("@",ee["@"],function(Pt){return this.lhs=Pt,this.rhs=at(ee["@"]),this.rhs.type!=="variable"?ot({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),ft("#",ee["#"],function(Pt){return this.lhs=Pt,this.rhs=at(ee["#"]),this.rhs.type!=="variable"?ot({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),ft("?",ee["?"],function(Pt){return this.type="condition",this.condition=Pt,this.then=at(0),H.id===":"&&(st(":"),this.else=at(0)),this}),ft("?:",ee["?:"],function(Pt){return this.type="condition",this.condition=Pt,this.then=Pt,this.else=at(0),this}),_t("|",function(){return this.type="transform",this.pattern=at(0),st("|"),this.update=at(0),H.id===","&&(st(","),this.delete=at(0)),st("|"),this});var Et=function(Pt){var $t;if(Pt.type==="function"&&!Pt.predicate){var hn={type:"lambda",thunk:!0,arguments:[],position:Pt.position};hn.body=Pt,$t=hn}else if(Pt.type==="condition")Pt.then=Et(Pt.then),typeof Pt.else<"u"&&(Pt.else=Et(Pt.else)),$t=Pt;else if(Pt.type==="block"){var _n=Pt.expressions.length;_n>0&&(Pt.expressions[_n-1]=Et(Pt.expressions[_n-1])),$t=Pt}else $t=Pt;return $t},Mt=0,Ot=0,kt=[],yt=function(Pt,$t){switch(Pt.type){case"name":case"wildcard":$t.level--,$t.level===0&&(typeof Pt.ancestor>"u"||(kt[$t.index].slot.label=Pt.ancestor.label),Pt.ancestor=$t,Pt.tuple=!0);break;case"parent":$t.level++;break;case"block":Pt.expressions.length>0&&(Pt.tuple=!0,$t=yt(Pt.expressions[Pt.expressions.length-1],$t));break;case"path":Pt.tuple=!0;var hn=Pt.steps.length-1;for($t=yt(Pt.steps[hn--],$t);$t.level>0&&hn>=0;)$t=yt(Pt.steps[hn--],$t);break;default:throw{code:"S0217",token:Pt.type,position:Pt.position}}return $t},St=function(Pt,$t){if(typeof $t.seekingParent<"u"||$t.type==="parent"){var hn=typeof $t.seekingParent<"u"?$t.seekingParent:[];$t.type==="parent"&&hn.push($t.slot),typeof Pt.seekingParent>"u"?Pt.seekingParent=hn:Array.prototype.push.apply(Pt.seekingParent,hn)}},Yt=function(Pt){var $t=Pt.steps.length-1,hn=Pt.steps[$t],_n=typeof hn.seekingParent<"u"?hn.seekingParent:[];hn.type==="parent"&&_n.push(hn.slot);for(var On=0;On<_n.length;On++){var En=_n[On];for($t=Pt.steps.length-2;En.level>0;){if($t<0){typeof Pt.seekingParent>"u"?Pt.seekingParent=[En]:Pt.seekingParent.push(En);break}for(var qt=Pt.steps[$t--];$t>=0&&qt.focus&&Pt.steps[$t].focus;)qt=Pt.steps[$t--];En=yt(qt,En)}}},Ft=function(Pt){var $t;switch(Pt.type){case"binary":switch(Pt.value){case".":var hn=Ft(Pt.lhs);hn.type==="path"?$t=hn:$t={type:"path",steps:[hn]},hn.type==="parent"&&($t.seekingParent=[hn.slot]);var _n=Ft(Pt.rhs);_n.type==="function"&&_n.procedure.type==="path"&&_n.procedure.steps.length===1&&_n.procedure.steps[0].type==="name"&&$t.steps[$t.steps.length-1].type==="function"&&($t.steps[$t.steps.length-1].nextFunction=_n.procedure.steps[0].value),_n.type==="path"?Array.prototype.push.apply($t.steps,_n.steps):(typeof _n.predicate<"u"&&(_n.stages=_n.predicate,delete _n.predicate),$t.steps.push(_n)),$t.steps.filter(function(mn){if(mn.type==="number"||mn.type==="value")throw{code:"S0213",stack:new Error().stack,position:mn.position,value:mn.value};return mn.type==="string"}).forEach(function(mn){mn.type="name"}),$t.steps.filter(function(mn){return mn.keepArray===!0}).length>0&&($t.keepSingletonArray=!0);var On=$t.steps[0];On.type==="unary"&&On.value==="["&&(On.consarray=!0);var En=$t.steps[$t.steps.length-1];En.type==="unary"&&En.value==="["&&(En.consarray=!0),Yt($t);break;case"[":$t=Ft(Pt.lhs);var qt=$t,Jt="predicate";if($t.type==="path"&&(qt=$t.steps[$t.steps.length-1],Jt="stages"),typeof qt.group<"u")throw{code:"S0209",stack:new Error().stack,position:Pt.position};typeof qt[Jt]>"u"&&(qt[Jt]=[]);var Wt=Ft(Pt.rhs);typeof Wt.seekingParent<"u"&&(Wt.seekingParent.forEach(mn=>{mn.level===1?yt(qt,mn):mn.level--}),St(qt,Wt)),qt[Jt].push({type:"filter",expr:Wt,position:Pt.position});break;case"{":if($t=Ft(Pt.lhs),typeof $t.group<"u")throw{code:"S0210",stack:new Error().stack,position:Pt.position};$t.group={lhs:Pt.rhs.map(function(mn){return[Ft(mn[0]),Ft(mn[1])]}),position:Pt.position};break;case"^":$t=Ft(Pt.lhs),$t.type!=="path"&&($t={type:"path",steps:[$t]});var un={type:"sort",position:Pt.position};un.terms=Pt.rhs.map(function(mn){var Tn=Ft(mn.expression);return St(un,Tn),{descending:mn.descending,expression:Tn}}),$t.steps.push(un),Yt($t);break;case":=":$t={type:"bind",value:Pt.value,position:Pt.position},$t.lhs=Ft(Pt.lhs),$t.rhs=Ft(Pt.rhs),St($t,$t.rhs);break;case"@":if($t=Ft(Pt.lhs),qt=$t,$t.type==="path"&&(qt=$t.steps[$t.steps.length-1]),typeof qt.stages<"u"||typeof qt.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:Pt.position};if(qt.type==="sort")throw{code:"S0216",stack:new Error().stack,position:Pt.position};Pt.keepArray&&(qt.keepArray=!0),qt.focus=Pt.rhs.value,qt.tuple=!0;break;case"#":$t=Ft(Pt.lhs),qt=$t,$t.type==="path"?qt=$t.steps[$t.steps.length-1]:($t={type:"path",steps:[$t]},typeof qt.predicate<"u"&&(qt.stages=qt.predicate,delete qt.predicate)),typeof qt.stages>"u"?qt.index=Pt.rhs.value:qt.stages.push({type:"index",value:Pt.rhs.value,position:Pt.position}),qt.tuple=!0;break;case"~>":$t={type:"apply",value:Pt.value,position:Pt.position},$t.lhs=Ft(Pt.lhs),$t.rhs=Ft(Pt.rhs),$t.keepArray=$t.lhs.keepArray||$t.rhs.keepArray;break;default:$t={type:Pt.type,value:Pt.value,position:Pt.position},$t.lhs=Ft(Pt.lhs),$t.rhs=Ft(Pt.rhs),St($t,$t.lhs),St($t,$t.rhs)}break;case"unary":$t={type:Pt.type,value:Pt.value,position:Pt.position},Pt.value==="["?$t.expressions=Pt.expressions.map(function(mn){var Tn=Ft(mn);return St($t,Tn),Tn}):Pt.value==="{"?$t.lhs=Pt.lhs.map(function(mn){var Tn=Ft(mn[0]);St($t,Tn);var $n=Ft(mn[1]);return St($t,$n),[Tn,$n]}):($t.expression=Ft(Pt.expression),Pt.value==="-"&&$t.expression.type==="number"?($t=$t.expression,$t.value=-$t.value):St($t,$t.expression));break;case"function":case"partial":$t={type:Pt.type,name:Pt.name,value:Pt.value,position:Pt.position},$t.arguments=Pt.arguments.map(function(mn){var Tn=Ft(mn);return St($t,Tn),Tn}),$t.procedure=Ft(Pt.procedure);break;case"lambda":$t={type:Pt.type,arguments:Pt.arguments,signature:Pt.signature,position:Pt.position};var fn=Ft(Pt.body);$t.body=Et(fn);break;case"condition":$t={type:Pt.type,position:Pt.position},$t.condition=Ft(Pt.condition),St($t,$t.condition),$t.then=Ft(Pt.then),St($t,$t.then),typeof Pt.else<"u"&&($t.else=Ft(Pt.else),St($t,$t.else));break;case"transform":$t={type:Pt.type,position:Pt.position},$t.pattern=Ft(Pt.pattern),$t.update=Ft(Pt.update),typeof Pt.delete<"u"&&($t.delete=Ft(Pt.delete));break;case"block":$t={type:Pt.type,position:Pt.position},$t.expressions=Pt.expressions.map(function(mn){var Tn=Ft(mn);return St($t,Tn),(Tn.consarray||Tn.type==="path"&&Tn.steps[0].consarray)&&($t.consarray=!0),Tn});break;case"name":$t={type:"path",steps:[Pt]},Pt.keepArray&&($t.keepSingletonArray=!0);break;case"parent":$t={type:"parent",slot:{label:"!"+Mt++,level:1,index:Ot++}},kt.push($t);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":$t=Pt;break;case"operator":if(Pt.value==="and"||Pt.value==="or"||Pt.value==="in")Pt.type="name",$t=Ft(Pt);else if(Pt.value==="?")$t=Pt;else throw{code:"S0201",stack:new Error().stack,position:Pt.position,token:Pt.value};break;case"error":$t=Pt,Pt.lhs&&($t=Ft(Pt.lhs));break;default:var pn="S0206";Pt.id==="(end)"&&(pn="S0207");var Zt={code:pn,position:Pt.position,token:Pt.value};if(d)return et.push(Zt),{type:"error",error:Zt};throw Zt.stack=new Error().stack,Zt}return Pt.keepArray&&($t.keepArray=!0),$t};Z=ne(f),st();var ln=at(0);if(H.id!=="(end)"){var dn={code:"S0201",position:H.position,token:H.value};ot(dn)}if(ln=Ft(ln),ln.type==="parent"||typeof ln.seekingParent<"u")throw{code:"S0217",token:ln.type,position:ln.position};return et.length>0&&(ln.errors=et),ln};return te})();A.exports=R},{"./signature":5}],5:[function(l,A,O){var Y=l("./utils");const R=(()=>{var ee={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function xe(ne){for(var te=1,f=[],d={},H=d;te<ne.length;){var Z=ne.charAt(te);if(Z===":")break;var Ye=function(){f.push(d),H=d,d={}},et=function(ft,ut,_t,At){for(var Et=1,Mt=ut;Mt<ft.length;)if(Mt++,Z=ft.charAt(Mt),Z===At){if(Et--,Et===0)break}else Z===_t&&Et++;return Mt};switch(Z){case"s":case"n":case"b":case"l":case"o":d.regex="["+Z+"m]",d.type=Z,Ye();break;case"a":d.regex="[asnblfom]",d.type=Z,d.array=!0,Ye();break;case"f":d.regex="f",d.type=Z,Ye();break;case"j":d.regex="[asnblom]",d.type=Z,Ye();break;case"x":d.regex="[asnblfom]",d.type=Z,Ye();break;case"-":H.context=!0,H.contextRegex=new RegExp(H.regex),H.regex+="?";break;case"?":case"+":H.regex+=Z;break;case"(":var tt=et(ne,te,"(",")"),nt=ne.substring(te+1,tt);if(nt.indexOf("<")===-1)d.regex="["+nt+"m]";else throw{code:"S0402",stack:new Error().stack,value:nt,offset:te};d.type="("+nt+")",te=tt,Ye();break;case"<":if(H.type==="a"||H.type==="f"){var it=et(ne,te,"<",">");H.subtype=ne.substring(te+1,it),te=it}else throw{code:"S0401",stack:new Error().stack,value:H.type,offset:te};break}te++}var ot="^"+f.map(function(ft){return"("+ft.regex+")"}).join("")+"$",st=new RegExp(ot),at=function(ft){var ut;if(Y.isFunction(ft))ut="f";else{var _t=typeof ft;switch(_t){case"string":ut="s";break;case"number":ut="n";break;case"boolean":ut="b";break;case"object":ft===null?ut="l":Array.isArray(ft)?ut="a":ut="o";break;case"undefined":default:ut="m"}}return ut},ct=function(ft,ut){for(var _t="^",At=0,Et=0;Et<f.length;Et++){_t+=f[Et].regex;var Mt=ut.match(_t);if(Mt===null)throw{code:"T0410",stack:new Error().stack,value:ft[At],index:At+1};At=Mt[0].length}throw{code:"T0410",stack:new Error().stack,value:ft[At],index:At+1}};return{definition:ne,validate:function(ft,ut){var _t="";ft.forEach(function(Ot){_t+=at(Ot)});var At=st.exec(_t);if(At){var Et=[],Mt=0;return f.forEach(function(Ot,kt){var yt=ft[Mt],St=At[kt+1];if(St==="")if(Ot.context&&Ot.contextRegex){var Yt=at(ut);if(Ot.contextRegex.test(Yt))Et.push(ut);else throw{code:"T0411",stack:new Error().stack,value:ut,index:Mt+1}}else Et.push(yt),Mt++;else St.split("").forEach(function(Ft){if(Ot.type==="a"){if(Ft==="m")yt=void 0;else{yt=ft[Mt];var ln=!0;if(typeof Ot.subtype<"u"){if(Ft!=="a"&&St!==Ot.subtype)ln=!1;else if(Ft==="a"&&yt.length>0){var dn=at(yt[0]);if(dn!==Ot.subtype.charAt(0))ln=!1;else{var Pt=yt.filter(function($t){return at($t)!==dn});ln=Pt.length===0}}}if(!ln)throw{code:"T0412",stack:new Error().stack,value:yt,index:Mt+1,type:ee[Ot.subtype]};Ft!=="a"&&(yt=[yt])}Et.push(yt),Mt++}else Et.push(yt),Mt++})}),Et}ct(ft,_t)}}}return xe})();A.exports=R},{"./utils":6}],6:[function(l,A,O){const Y=(()=>{function R(it){var ot=!1;if(typeof it=="number"&&(ot=!isNaN(it),ot&&!isFinite(it)))throw{code:"D1001",value:it,stack:new Error().stack};return ot}function ee(it){var ot=!1;return Array.isArray(it)&&(ot=it.filter(function(st){return typeof st!="string"}).length===0),ot}function xe(it){var ot=!1;return Array.isArray(it)&&(ot=it.filter(function(st){return!R(st)}).length===0),ot}function ne(){var it=[];return it.sequence=!0,arguments.length===1&&it.push(arguments[0]),it}function te(it){return it.sequence===!0&&Array.isArray(it)}function f(it){return it&&(it._jsonata_function===!0||it._jsonata_lambda===!0)||typeof it=="function"}function d(it){var ot=typeof it.arity=="number"?it.arity:typeof it.implementation=="function"?it.implementation.length:typeof it.length=="number"?it.length:it.arguments.length;return ot}function H(it){return it&&it._jsonata_lambda===!0}var Z=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function Ye(it){return typeof it=="object"&&it!==null&&Z in it&&"next"in it&&typeof it.next=="function"}function et(it,ot){if(it===ot)return!0;if(typeof it=="object"&&typeof ot=="object"&&it!==null&&ot!==null){if(Array.isArray(it)&&Array.isArray(ot)){if(it.length!==ot.length)return!1;for(var st=0;st<it.length;st++)if(!et(it[st],ot[st]))return!1;return!0}var at=Object.getOwnPropertyNames(it),ct=Object.getOwnPropertyNames(ot);if(at.length!==ct.length)return!1;for(at=at.sort(),ct=ct.sort(),st=0;st<at.length;st++)if(at[st]!==ct[st])return!1;for(st=0;st<at.length;st++){var ft=at[st];if(!et(it[ft],ot[ft]))return!1}return!0}return!1}function tt(it){return typeof it=="object"&&it!==null&&"then"in it&&typeof it.then=="function"}function nt(it){var ot=[];for(let st of it)ot.push(st);return ot}return{isNumeric:R,isArrayOfStrings:ee,isArrayOfNumbers:xe,createSequence:ne,isSequence:te,isFunction:f,isLambda:H,isIterable:Ye,getFunctionArity:d,isDeepEqual:et,stringToArray:nt,isPromise:tt}})();A.exports=Y},{}]},{},[3])(3)})})(jsonata$1)),jsonata$1.exports}var jsonataExports=requireJsonata();const jsonata=getDefaultExportFromCjs(jsonataExports);var main={exports:{}};const require$$3=getAugmentedNamespace(__viteBrowserExternal),version="17.2.3",require$$4={version};var hasRequiredMain;function requireMain(){if(hasRequiredMain)return main.exports;hasRequiredMain=1;var g={};const a=require$$3,l=require$$3,A=require$$3,O=require$$3,R=require$$4.version,ee=["🔐 encrypt with Dotenvx: https://dotenvx.com","🔐 prevent committing .env to code: https://dotenvx.com/precommit","🔐 prevent building .env in docker: https://dotenvx.com/prebuild","📡 add observability to secrets: https://dotenvx.com/ops","👥 sync secrets across teammates & machines: https://dotenvx.com/ops","🗂️ backup and recover secrets: https://dotenvx.com/ops","✅ audit secrets and track compliance: https://dotenvx.com/ops","🔄 add secrets lifecycle management: https://dotenvx.com/ops","🔑 add access controls to secrets: https://dotenvx.com/ops","🛠️  run anywhere with `dotenvx run -- yourcommand`","⚙️  specify custom .env file path with { path: '/custom/path/.env' }","⚙️  enable debug logging with { debug: true }","⚙️  override existing env vars with { override: true }","⚙️  suppress all logs with { quiet: true }","⚙️  write to custom object with { processEnv: myObject }","⚙️  load multiple .env files with { path: ['.env.local', '.env'] }"];function xe(){return ee[Math.floor(Math.random()*ee.length)]}function ne(Et){return typeof Et=="string"?!["false","0","no","off",""].includes(Et.toLowerCase()):!!Et}function te(){return process.stdout.isTTY}function f(Et){return te()?`\x1B[2m${Et}\x1B[0m`:Et}const d=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function H(Et){const Mt={};let Ot=Et.toString();Ot=Ot.replace(/\r\n?/mg,`
`);let kt;for(;(kt=d.exec(Ot))!=null;){const yt=kt[1];let St=kt[2]||"";St=St.trim();const Yt=St[0];St=St.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),Yt==='"'&&(St=St.replace(/\\n/g,`
`),St=St.replace(/\\r/g,"\r")),Mt[yt]=St}return Mt}function Z(Et){Et=Et||{};const Mt=ot(Et);Et.path=Mt;const Ot=At.configDotenv(Et);if(!Ot.parsed){const Yt=new Error(`MISSING_DATA: Cannot parse ${Mt} for an unknown reason`);throw Yt.code="MISSING_DATA",Yt}const kt=nt(Et).split(","),yt=kt.length;let St;for(let Yt=0;Yt<yt;Yt++)try{const Ft=kt[Yt].trim(),ln=it(Ot,Ft);St=At.decrypt(ln.ciphertext,ln.key);break}catch(Ft){if(Yt+1>=yt)throw Ft}return At.parse(St)}function Ye(Et){console.error(`[dotenv@${R}][WARN] ${Et}`)}function et(Et){console.log(`[dotenv@${R}][DEBUG] ${Et}`)}function tt(Et){console.log(`[dotenv@${R}] ${Et}`)}function nt(Et){return Et&&Et.DOTENV_KEY&&Et.DOTENV_KEY.length>0?Et.DOTENV_KEY:g.DOTENV_KEY&&g.DOTENV_KEY.length>0?g.DOTENV_KEY:""}function it(Et,Mt){let Ot;try{Ot=new URL(Mt)}catch(Ft){if(Ft.code==="ERR_INVALID_URL"){const ln=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw ln.code="INVALID_DOTENV_KEY",ln}throw Ft}const kt=Ot.password;if(!kt){const Ft=new Error("INVALID_DOTENV_KEY: Missing key part");throw Ft.code="INVALID_DOTENV_KEY",Ft}const yt=Ot.searchParams.get("environment");if(!yt){const Ft=new Error("INVALID_DOTENV_KEY: Missing environment part");throw Ft.code="INVALID_DOTENV_KEY",Ft}const St=`DOTENV_VAULT_${yt.toUpperCase()}`,Yt=Et.parsed[St];if(!Yt){const Ft=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${St} in your .env.vault file.`);throw Ft.code="NOT_FOUND_DOTENV_ENVIRONMENT",Ft}return{ciphertext:Yt,key:kt}}function ot(Et){let Mt=null;if(Et&&Et.path&&Et.path.length>0)if(Array.isArray(Et.path))for(const Ot of Et.path)a.existsSync(Ot)&&(Mt=Ot.endsWith(".vault")?Ot:`${Ot}.vault`);else Mt=Et.path.endsWith(".vault")?Et.path:`${Et.path}.vault`;else Mt=l.resolve(process.cwd(),".env.vault");return a.existsSync(Mt)?Mt:null}function st(Et){return Et[0]==="~"?l.join(A.homedir(),Et.slice(1)):Et}function at(Et){const Mt=ne(g.DOTENV_CONFIG_DEBUG||Et&&Et.debug),Ot=ne(g.DOTENV_CONFIG_QUIET||Et&&Et.quiet);(Mt||!Ot)&&tt("Loading env from encrypted .env.vault");const kt=At._parseVault(Et);let yt=g;return Et&&Et.processEnv!=null&&(yt=Et.processEnv),At.populate(yt,kt,Et),{parsed:kt}}function ct(Et){const Mt=l.resolve(process.cwd(),".env");let Ot="utf8",kt=g;Et&&Et.processEnv!=null&&(kt=Et.processEnv);let yt=ne(kt.DOTENV_CONFIG_DEBUG||Et&&Et.debug),St=ne(kt.DOTENV_CONFIG_QUIET||Et&&Et.quiet);Et&&Et.encoding?Ot=Et.encoding:yt&&et("No encoding is specified. UTF-8 is used by default");let Yt=[Mt];if(Et&&Et.path)if(!Array.isArray(Et.path))Yt=[st(Et.path)];else{Yt=[];for(const Pt of Et.path)Yt.push(st(Pt))}let Ft;const ln={};for(const Pt of Yt)try{const $t=At.parse(a.readFileSync(Pt,{encoding:Ot}));At.populate(ln,$t,Et)}catch($t){yt&&et(`Failed to load ${Pt} ${$t.message}`),Ft=$t}const dn=At.populate(kt,ln,Et);if(yt=ne(kt.DOTENV_CONFIG_DEBUG||yt),St=ne(kt.DOTENV_CONFIG_QUIET||St),yt||!St){const Pt=Object.keys(dn).length,$t=[];for(const hn of Yt)try{const _n=l.relative(process.cwd(),hn);$t.push(_n)}catch(_n){yt&&et(`Failed to load ${hn} ${_n.message}`),Ft=_n}tt(`injecting env (${Pt}) from ${$t.join(",")} ${f(`-- tip: ${xe()}`)}`)}return Ft?{parsed:ln,error:Ft}:{parsed:ln}}function ft(Et){if(nt(Et).length===0)return At.configDotenv(Et);const Mt=ot(Et);return Mt?At._configVault(Et):(Ye(`You set DOTENV_KEY but you are missing a .env.vault file at ${Mt}. Did you forget to build it?`),At.configDotenv(Et))}function ut(Et,Mt){const Ot=Buffer.from(Mt.slice(-64),"hex");let kt=Buffer.from(Et,"base64");const yt=kt.subarray(0,12),St=kt.subarray(-16);kt=kt.subarray(12,-16);try{const Yt=O.createDecipheriv("aes-256-gcm",Ot,yt);return Yt.setAuthTag(St),`${Yt.update(kt)}${Yt.final()}`}catch(Yt){const Ft=Yt instanceof RangeError,ln=Yt.message==="Invalid key length",dn=Yt.message==="Unsupported state or unable to authenticate data";if(Ft||ln){const Pt=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw Pt.code="INVALID_DOTENV_KEY",Pt}else if(dn){const Pt=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw Pt.code="DECRYPTION_FAILED",Pt}else throw Yt}}function _t(Et,Mt,Ot={}){const kt=!!(Ot&&Ot.debug),yt=!!(Ot&&Ot.override),St={};if(typeof Mt!="object"){const Yt=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw Yt.code="OBJECT_REQUIRED",Yt}for(const Yt of Object.keys(Mt))Object.prototype.hasOwnProperty.call(Et,Yt)?(yt===!0&&(Et[Yt]=Mt[Yt],St[Yt]=Mt[Yt]),kt&&et(yt===!0?`"${Yt}" is already defined and WAS overwritten`:`"${Yt}" is already defined and was NOT overwritten`)):(Et[Yt]=Mt[Yt],St[Yt]=Mt[Yt]);return St}const At={configDotenv:ct,_configVault:at,_parseVault:Z,config:ft,decrypt:ut,parse:H,populate:_t};return main.exports.configDotenv=At.configDotenv,main.exports._configVault=At._configVault,main.exports._parseVault=At._parseVault,main.exports.config=At.config,main.exports.decrypt=At.decrypt,main.exports.parse=At.parse,main.exports.populate=At.populate,main.exports=At,main.exports}var mainExports=requireMain();const FILE_EXTENSION_TO_SOURCE_TYPE={".geojson":GsSourceType.GeoJSON,".json":GsSourceType.GeoJSON,".kml":GsSourceType.KML,".gpx":GsSourceType.GPX,".tif":GsSourceType.GeoTIFF,".tiff":GsSourceType.GeoTIFF,".geotiff":GsSourceType.GeoTIFF},getSourceTypeFromFile=g=>{const a=g.getName().toLowerCase();for(const[l,A]of Object.entries(FILE_EXTENSION_TO_SOURCE_TYPE))if(a.endsWith(l))return A;return null},isSupportedSpatialFile=g=>getSourceTypeFromFile(g)!==null,toBlobUri=async g=>{const a=await workspaceService.getWorkspace();if(!a)throw new Error("No workspace available");const l=await a.getResource(g);if(!l)throw new Error("Invalid URL: "+g);return await l.getContents({uri:!0})},isAbsoluteResource$1=g=>g.startsWith("blob:")||g.startsWith("http:")||g.startsWith("https:"),_blobsLookup={},replaceUris=async(g,a,l)=>{const A=await jsonata(`[**[${a}!='']]`).evaluate(g);for(const O of A){const Y=O[a];if(isAbsoluteResource$1(Y))continue;let R;if(a==="src"&&l)try{R=(await l.resolveWorkspaceModule(Y)).blobUrl}catch{R=await toBlobUri(Y)}else R=await toBlobUri(Y);_blobsLookup[R]=O[a],O[a]=R}},getOriginalUri=g=>_blobsLookup[g],revertBlobUris=async(g,a)=>{const l=await jsonata(`[**[${a}!='']]`).evaluate(g);for(const A of l){const O=A[a];!O||!O.startsWith("blob:")||(A[a]=_blobsLookup[O])}},registerCatalog=g=>{contributionRegistry.registerContribution("catalog.root",{label:g.label,icon:g.icon,contributionId:g.contributionId});const a=g.contributionId??g.label;g.items?.forEach(l=>{contributionRegistry.registerContribution(a,{label:l.label,icon:l.icon,contributionId:l.contributionId});const O=import.meta.resolve("/.");l.items.forEach(Y=>{const R={label:Y.label,icon:Y.icon,state:{...Y.state}};R.state?.url&&(R.state.url=R.state.url.replace("${baseURL}/",O)),contributionRegistry.registerContribution(l.contributionId,R)})})},replaceVars=g=>{Object.entries(g).forEach(([a,l])=>{const A=/\${([a-zA-Z0-9_]+)}/g;g[a]=l.replace(A,(O,Y)=>{const R=g[Y];return R!==void 0?R:O})})},loadEnvs=async(...g)=>{const a=await workspaceService.getWorkspace(),l={};for(const A of g){const O=await a?.getResource(A);if(!O)continue;const Y=await O.getContents(),R=mainExports.parse(Y||"");replaceVars(R),Object.assign(l,R)}return replaceVars(l),l},utils=Object.freeze(Object.defineProperty({__proto__:null,FILE_EXTENSION_TO_SOURCE_TYPE,_blobsLookup,getOriginalUri,getSourceTypeFromFile,isAbsoluteResource:isAbsoluteResource$1,isSupportedSpatialFile,loadEnvs,registerCatalog,replaceUris,replaceVars,revertBlobUris,toBlobUri},Symbol.toStringTag,{value:"Module"}));rtUtils.resolveUrl=g=>toBlobUri(g);editorRegistry.registerEditorInputHandler({canHandle:g=>g instanceof File&&g.getName().endsWith(".geospace"),handle:async g=>{const a={title:g.getName(),data:g,key:g.getName(),editorId:"map-editor",icon:"location-dot",state:{}};return a.widgetFactory=l=>x$1`
            <gs-map id="${l}" .input="${a}"></gs-map>`,a}});const i=e$2(class extends i$4{constructor(){super(...arguments),this.key=E$1}render(g,a){return this.key=g,a}update(g,[a,l]){return a!==this.key&&(m$1(g),this.key=a),l}});function findLayerByUuid(g,a){return g.layers.find(l=>l.uuid===a)}function findLayerIndexByUuid(g,a){return g.layers.findIndex(l=>l.uuid===a)}function findControlIndexByUuid(g,a){return g.controls.findIndex(l=>l.uuid===a)}function findOverlayIndexByUuid(g,a){return g.overlays.findIndex(l=>l.uuid===a)}const createProxy=g=>new Proxy({},{get:(a,l)=>async(...A)=>{for(const O of g)await O[l](...A)}});var MapEvents=(g=>(g[g.LOADED=0]="LOADED",g[g.LAYER_ADDED=1]="LAYER_ADDED",g[g.LAYER_DELETED=2]="LAYER_DELETED",g[g.LAYER_UPDATED=3]="LAYER_UPDATED",g[g.FEATURE_SELECTED=4]="FEATURE_SELECTED",g))(MapEvents||{});const mapChangedSignal=r(EMPTY_SIGNALPORT),olCSS=`:root,
:host {
  --ol-background-color: white;
  --ol-accent-background-color: #F5F5F5;
  --ol-subtle-background-color: rgba(128, 128, 128, 0.25);
  --ol-partial-background-color: rgba(255, 255, 255, 0.75);
  --ol-foreground-color: #333333;
  --ol-subtle-foreground-color: #666666;
  --ol-brand-color: #00AAFF;
}

.ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.ol-scale-bar-inner {
  display: flex;
}

.ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);
}

.ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);
}

.ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.ol-unsupported {
  display: none;
}

.ol-viewport,
.ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.ol-viewport canvas {
  all: unset;
  overflow: hidden;
}

.ol-viewport {
  touch-action: pan-x pan-y;
}

.ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.ol-zoom {
  top: .5em;
  left: .5em;
}

.ol-rotate {
  top: .5em;
  right: .5em;
  transition: opacity .25s linear, visibility 0s linear;
}

.ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition: opacity .25s linear, visibility 0s linear .25s;
}

.ol-zoom-extent {
  top: 4.643em;
  left: .5em;
}

.ol-full-screen {
  right: .5em;
  top: .5em;
}

.ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: .4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.ol-zoom-extent button {
  line-height: 1.4em;
}

.ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.ol-touch .ol-control button {
  font-size: 1.5em;
}

.ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.ol-control button:hover,
.ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.ol-attribution {
  text-align: right;
  bottom: .5em;
  right: .5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.ol-attribution ul {
  margin: 0;
  padding: 1px .5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.ol-attribution li {
  display: inline;
  list-style: none;
}

.ol-attribution li:not(:last-child):after {
  content: " ";
}

.ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.ol-attribution button {
  flex-shrink: 0;
}

.ol-attribution.ol-collapsed ul {
  display: none;
}

.ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.ol-attribution.ol-uncollapsible img {
  margin-top: -.2em;
  max-height: 1.6em;
}

.ol-attribution.ol-uncollapsible button {
  display: none;
}

.ol-zoomslider {
  top: 4.5em;
  left: .5em;
  height: 200px;
}

.ol-zoomslider button {
  position: relative;
  height: 10px;
}

.ol-touch .ol-zoomslider {
  top: 5.5em;
}

.ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.ol-overviewmap .ol-overviewmap-map,
.ol-overviewmap button {
  display: block;
}

.ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.ol-overviewmap-box {
  border: 1.5px dotted var(--ol-subtle-foreground-color);
}

.ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

.ol-overviewmap .ol-viewport:hover {
  cursor: pointer;
}
`;function isAbsoluteResource(g){return g.startsWith("blob:")||g.startsWith("http:")||g.startsWith("https:")}function resolveWorkspacePath(g,a){if(g.startsWith("/"))return g.slice(1);const l=a.split("/").filter(Y=>Y),A=g.split("/").filter(Y=>Y);if(g.startsWith("./")||g.startsWith("../")||!g.startsWith("/")){const Y=l.slice(0,-1);l.length=0,l.push(...Y)}for(const Y of A)Y!=="."&&(Y===".."?l.length>0&&l.pop():l.push(Y));return l.join("/")}function findImportStatements(g){const a=[],l=/import\s+(?:type\s+)?(?:[\w*{}\s,]+?\s+from\s+)?["']([^"']+)["']/g,A=/export\s+(?:type\s+)?(?:[\w*{}\s,]+?\s+from\s+)?["']([^"']+)["']/g,O=/import\s*\(\s*["']([^"']+)["']\s*\)/g;let Y;for(;(Y=l.exec(g))!==null;)a.push({fullMatch:Y[0],importPath:Y[1],isDynamic:!1,startIndex:Y.index,endIndex:Y.index+Y[0].length});for(;(Y=A.exec(g))!==null;)a.push({fullMatch:Y[0],importPath:Y[1],isDynamic:!1,startIndex:Y.index,endIndex:Y.index+Y[0].length});for(;(Y=O.exec(g))!==null;)a.push({fullMatch:Y[0],importPath:Y[1],isDynamic:!0,startIndex:Y.index,endIndex:Y.index+Y[0].length});return a.sort((R,ee)=>ee.startIndex-R.startIndex)}class WorkspaceModuleResolver{constructor(){this.blobUrlCache=new Map,this.moduleCache=new Map,this.resolvingModules=new Set,this.resolvingPromises=new Map}async resolveModuleRecursive(a){if(!await workspaceService.getWorkspace())throw new Error("Workspace not available");if(this.blobUrlCache.has(a))return this.blobUrlCache.get(a);if(this.resolvingPromises.has(a))return await this.resolvingPromises.get(a);if(this.resolvingModules.has(a))throw new Error(`Circular dependency detected: ${a}`);this.resolvingModules.add(a);const A=this.doResolveModule(a);this.resolvingPromises.set(a,A);try{return await A}finally{this.resolvingPromises.delete(a)}}async doResolveModule(a){const l=await workspaceService.getWorkspace();if(!l)throw new Error("Workspace not available");try{let A=await l.getResource(a);if(A||(await l.listChildren(!0),A=await l.getResource(a)),!A)throw new Error(`Module not found: ${a}`);let O=await A.getContents();const Y=findImportStatements(O);for(const xe of Y){const ne=xe.importPath;if(!isAbsoluteResource(ne))try{const te=resolveWorkspacePath(ne,a),f=await this.resolveModuleRecursive(te);let d;if(xe.isDynamic)d=`import("${f}")`;else{const H=xe.fullMatch.search(/["']/);if(H===-1)d=xe.fullMatch;else{const Z=xe.fullMatch[H],Ye=xe.fullMatch.lastIndexOf(Z);Ye!==-1&&Ye>H?d=xe.fullMatch.slice(0,H+1)+f+xe.fullMatch.slice(Ye):d=xe.fullMatch}}O=O.slice(0,xe.startIndex)+d+O.slice(xe.endIndex)}catch{}}const R=new Blob([O],{type:"application/javascript"}),ee=URL.createObjectURL(R);return this.blobUrlCache.set(a,ee),this.moduleCache.set(a,{code:O,workspacePath:a,blobUrl:ee}),ee}catch(A){throw A}finally{this.resolvingModules.delete(a)}}async resolveWorkspaceModule(a,l){const A=l?resolveWorkspacePath(a,l):a;if(this.moduleCache.has(A))return this.moduleCache.get(A);await this.resolveModuleRecursive(A);const O=this.moduleCache.get(A);if(!O)throw new Error(`Failed to resolve module: ${A}`);return O}clear(){for(const a of this.blobUrlCache.values())a.startsWith("blob:")&&URL.revokeObjectURL(a);this.blobUrlCache.clear(),this.moduleCache.clear(),this.resolvingModules.clear()}}const iframeSrc="iframe-map-renderer.html";class IFrameMapRenderer{constructor(a,l){this.messageId=0,this.pendingMessages=new Map,this.isMobileView=!1,this.gsMap=a,this.env=l,this.operations=this.createProxy(this)}createProxy(a){return new Proxy({},{get(l,A){return async(...O)=>await a.sendMessage(A,{...O})}})}async reattached(){if(!this.targetElement){console.warn("No target element stored, cannot reattach");return}this.iframe&&this.iframe.parentElement&&this.iframe.remove(),await this.render(this.targetElement)}async render(a){if(this.iframe=document.createElement("iframe"),this.iframe.style.overflow="hidden",this.updateIframeStyles(),this.iframe.src=iframeSrc,this.targetElement=typeof a=="string"?document.querySelector(a):a,!this.targetElement)throw new Error("Container element not found");this.targetElement.innerHTML="",this.targetElement.appendChild(this.iframe),await this.waitRendererReady(),this.setupMessageListener(),await this.sendMessage("render",{gsMap:this.gsMap,env:this.env})}async modelToUI(a){await this.sendMessage("modelToUI",a??this.gsMap)}getOperations(){return this.operations}async getViewExtent(){return(await this.sendMessage("getViewExtent",{}))?.extent||[0,0,0,0]}setOnDirty(a){this.onDirtyCallback=a}triggerDirty(){this.onDirtyCallback&&this.onDirtyCallback()}setOnSync(a){this.onSyncCallback=a}setOnClick(a){this.onClickCallback=a}triggerSync(a){this.onSyncCallback&&this.onSyncCallback(a)}toggleMobileView(){this.isMobileView=!this.isMobileView,this.updateIframeStyles()}isInMobileView(){return this.isMobileView}updateIframeStyles(){this.iframe&&(this.isMobileView?(this.iframe.style.width="375px",this.iframe.style.height="667px",this.iframe.style.border="2px solid rgb(168, 168, 168)",this.iframe.style.borderRadius="20px",this.iframe.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.51)",this.iframe.style.margin="20px auto",this.iframe.style.display="block"):(this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.border="none",this.iframe.style.borderRadius="0",this.iframe.style.boxShadow="none",this.iframe.style.margin="0"))}async handleAssetResolution(a,l){try{const{toBlobUri:A}=await __vitePreload(async()=>{const{toBlobUri:Y}=await Promise.resolve().then(()=>utils);return{toBlobUri:Y}},void 0),O=await A(l);this.iframe.contentWindow.postMessage({id:a,success:!0,assetUrl:O},"*")}catch(A){this.iframe.contentWindow.postMessage({id:a,success:!1,error:A instanceof Error?A.message:"Unknown error"},"*")}}destroy(){this.messageListener&&(window.removeEventListener("message",this.messageListener),this.messageListener=void 0),this.iframe&&(this.iframe.remove(),this.iframe=void 0),this.pendingMessages.clear()}setupMessageListener(){this.messageListener=a=>{if(a.source!==this.iframe?.contentWindow)return;const{id:l,result:A,error:O,type:Y,event:R}=a.data;if(l!==void 0&&this.pendingMessages.has(l)){const{resolve:ee,reject:xe}=this.pendingMessages.get(l);if(this.pendingMessages.delete(l),O)xe(new Error(O));else{const ne=A??Object.fromEntries(Object.entries(a.data).filter(([te])=>!["id","type","event","error"].includes(te)));ee(ne)}}Y==="dirty"?this.onDirtyCallback?.():Y==="sync"?this.onSyncCallback?.(R):Y==="iframeClicked"?this.onClickCallback?.():Y==="resolveAsset"&&this.handleAssetResolution(l,a.data.path)},window.addEventListener("message",this.messageListener)}async waitRendererReady(){return new Promise(a=>{const l=A=>{A.source===this.iframe?.contentWindow&&A.data.type==="rendererReady"&&(window.removeEventListener("message",l),a())};window.addEventListener("message",l)})}async sendMessage(a,l){if(!this.iframe)throw new Error("Iframe not initialized");const A=++this.messageId;return new Promise((O,Y)=>{this.pendingMessages.set(A,{resolve:O,reject:Y}),this.iframe.contentWindow.postMessage({id:A,method:a,params:l},"*"),setTimeout(()=>{this.pendingMessages.has(A)&&(this.pendingMessages.delete(A),Y(new Error("Message timeout")))},5e3)})}}class DomainMapOperations{constructor(a,l){this.gsMap=a,this.renderer=l}triggerDirty(){this.renderer.triggerDirty()}async setZoom(a){this.gsMap.view.zoom=a,this.triggerDirty()}async setCenter(a){this.gsMap.view.center=a,this.triggerDirty()}async switchColorMode(a){this.gsMap.view.colorMode=a,this.triggerDirty()}async addLayer(a,l){l?this.gsMap.layers.unshift(a):this.gsMap.layers.push(a),this.triggerDirty()}async deleteLayer(a){const l=findLayerIndexByUuid(this.gsMap,a);l>=0&&(this.gsMap.layers.splice(l,1),this.triggerDirty())}async renameLayer(a,l){const A=findLayerByUuid(this.gsMap,a);A&&(A.name=l,this.triggerDirty())}async moveLayer(a,l){const A=findLayerIndexByUuid(this.gsMap,a);if(A<0)return;let O;if(l){if(O=findLayerIndexByUuid(this.gsMap,l),O<0||A===O)return}else O=A>0?A-1:A+1;if(O>=0&&O<this.gsMap.layers.length&&A!==O){const[Y]=this.gsMap.layers.splice(A,1);this.gsMap.layers.splice(O,0,Y),this.triggerDirty()}}async setLayerVisible(a,l){const A=findLayerByUuid(this.gsMap,a);A&&(A.visible=l,this.triggerDirty())}async addControlFromModule(a){this.gsMap.controls.push({src:a,type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeControl(a){const l=findControlIndexByUuid(this.gsMap,a);l>=0&&(this.gsMap.controls.splice(l,1),this.triggerDirty(),await this.renderer.modelToUI())}async addOverlayFromModule(a,l){this.gsMap.overlays.push({src:a,position:l||"bottom-left",type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeOverlay(a){const l=findOverlayIndexByUuid(this.gsMap,a);l>=0&&(this.gsMap.overlays.splice(l,1),this.triggerDirty(),await this.renderer.modelToUI())}async enableDrawing(a,l){}async disableDrawing(){}async enableFeatureSelection(){}async disableSelection(){}async deleteSelectedFeatures(){this.triggerDirty()}}class SignalingMapOperations{constructor(a){this.source=a}async setZoom(a){}async setCenter(a){}async switchColorMode(a){}async addLayer(a,l){mapChangedSignal.set({part:this.source,event:MapEvents.LAYER_ADDED})}async deleteLayer(a){mapChangedSignal.set({part:this.source,event:MapEvents.LAYER_DELETED})}async renameLayer(a,l){mapChangedSignal.set({part:this.source,event:MapEvents.LAYER_UPDATED})}async moveLayer(a,l){mapChangedSignal.set({part:this.source,event:MapEvents.LAYER_UPDATED})}async setLayerVisible(a,l){}async addControlFromModule(a){}async removeControl(a){}async addOverlayFromModule(a,l){}async removeOverlay(a){}async enableDrawing(a,l){}async disableDrawing(){}async enableFeatureSelection(){}async disableSelection(){}async deleteSelectedFeatures(){mapChangedSignal.set({part:this.source,event:MapEvents.LAYER_UPDATED})}}var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$2(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$2(a,l,O),O};const logger$2=createLogger("GsMapEditor");let GsMapEditor=class extends KPart{constructor(){super(),this.mapContainer=e$1(),this.isFirstConnection=!0,this.moduleResolver=new WorkspaceModuleResolver,this.interactionMode="none",this.commandStack=new CommandStack}getRenderer(){return this.renderer}getOperations(){return this.operations}doBeforeUI(){this.watch(mapChangedSignal,({part:g,event:a})=>{this.onMapChanged({part:g,event:a})})}onMapChanged({part:g,event:a}){g===this&&(a===MapEvents.LAYER_ADDED||a===MapEvents.LAYER_DELETED||a===MapEvents.LAYER_UPDATED)&&this.updateToolbar()}renderToolbar(){const a=this.getGsMap()?.layers.filter(A=>{const O=A.type===GsLayerType.VECTOR,Y=A.source?.type===GsSourceType.Features;return O&&Y})||[],l=this.activeDrawingLayerUuid!==void 0;return x$1`
            <k-command cmd="zoom_in" icon="magnifying-glass-plus" title="Zoom in"></k-command>
            <k-command cmd="zoom_out" icon="magnifying-glass-minus" title="Zoom out"></k-command>
            <k-command cmd="reset_view" icon="house" title="Reset view"></k-command>
            <k-command cmd="refresh_map" icon="rotate" title="Refresh map"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command cmd="capture_map_screenshot" icon="camera" title="Capture screenshot"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command cmd="toggle_color_mode" icon="circle-half-stroke" title="Toggle dark/light mode"></k-command>
            <k-command cmd="toggle_mobile_view" icon="mobile" title="Toggle mobile view"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command icon="plus" 
                      title="Create Drawing Layer"
                      .action=${()=>this.handleCreateDrawingLayer()}>
            </k-command>
            
            ${n$2(a.length>0,()=>{const A=a.map(O=>`${O.uuid}:${O.name}`).join("|");return x$1`
                ${i(A,x$1`
                    <wa-select 
                        placeholder="Drawing layer"
                        size="small"
                        value="${this.activeDrawingLayerUuid??""}"
                        @change=${O=>{const Y=O.target.value||void 0;this.activeDrawingLayerUuid=Y,(Y===void 0||O.target.value==="")&&(this.operations?.disableDrawing(),this.interactionMode="none"),this.updateToolbar()}}>
                        <wa-option value="">Select layer</wa-option>
                        ${a.map(O=>x$1`
                            <wa-option value="${O.uuid}">${O.name||"Layer"}</wa-option>
                        `)}
                    </wa-select>
                `)}
                
                <k-command icon="location-dot" 
                          title="Draw Point"
                          ?disabled=${!l}
                          .action=${()=>this.handleDrawPoint()}>
                </k-command>
                <k-command icon="minus" 
                          title="Draw LineString"
                          ?disabled=${!l}
                          .action=${()=>this.handleDrawLine()}>
                </k-command>
                <k-command icon="draw-polygon" 
                          title="Draw Polygon"
                          ?disabled=${!l}
                          .action=${()=>this.handleDrawPolygon()}>
                </k-command>
                
                <k-command icon="trash" 
                          title="Delete Selected Features"
                          ?disabled=${this.interactionMode!=="select"}
                          .action=${()=>this.handleDeleteSelected()}>
                </k-command>

                <wa-divider orientation="vertical"></wa-divider>
            `})}
            
            <k-command icon="hand-pointer" 
                      title="Select Features"
                      .action=${()=>this.handleSelectFeatures()}>
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>
        `}async connectedCallback(){if(super.connectedCallback(),this.isFirstConnection){this.isFirstConnection=!1;return}this.renderer?.reattached&&(await this.renderer.reattached(),this.renderer.setOnClick&&this.renderer.setOnClick(()=>{activePartSignal.set(this)}))}async doInitUI(){const g=this.input?.data,a=await loadEnvs(".env");a.BUILD_TIME=new Date;const l=await g.getContents();let A=l&&l.trim()?JSON.parse(l):DEFAULT_GSMAP;A=this.migrateGsMap(A),ensureUuidsRecursive(A),await replaceUris(A,"url"),await replaceUris(A,"src",this.moduleResolver),this.gsMap=A,A.view&&(this.initialView={center:[...A.view.center],zoom:A.view.zoom}),this.renderer=new IFrameMapRenderer(A,a);const O=this.renderer.getOperations(),Y=new DomainMapOperations(A,this.renderer),R=new SignalingMapOperations(this);this.operations=createProxy([Y,O,R]);try{if(!this.mapContainer.value)throw new Error("Map container not available");await this.renderer.render(this.mapContainer.value),this.renderer.setOnDirty(()=>this.markDirty(!0)),this.renderer.setOnSync(ee=>{if(this.gsMap){switch(ee.type){case"viewChanged":this.gsMap.view.center=ee.view.center,this.gsMap.view.zoom=ee.view.zoom,ee.view.rotation!==void 0&&ee.view.rotation!==0&&(this.gsMap.view.rotation=ee.view.rotation);break;case"featuresChanged":const xe=findLayerByUuid(this.gsMap,ee.layerUuid);xe&&xe.source?.type===GsSourceType.Features&&(xe.source.features=ee.features);break;case"featureSelected":const ne={feature:ee.feature,layerUuid:ee.layerUuid,metrics:ee.metrics};console.info("Feature metrics:",ne.metrics),mapChangedSignal.set({part:this,event:MapEvents.FEATURE_SELECTED,payload:ne});break;case"featureDeselected":console.info("Feature deselected"),mapChangedSignal.set({part:this,event:MapEvents.FEATURE_SELECTED,payload:null}),this.interactionMode==="select"&&(this.interactionMode="none",this.updateToolbar());break;case"drawingDisabled":this.interactionMode==="draw"&&(this.interactionMode="none",this.updateToolbar());break}this.markDirty(!0)}}),this.renderer.setOnClick?.(()=>{activePartSignal.set(this)}),this.updateToolbar(),mapChangedSignal.set({part:this,event:MapEvents.LOADED})}catch(ee){console.error("Failed to render map:",ee),toastError(`Failed to render map: ${ee.message}`)}}migrateGsMap(g){const a={...g};let l=!1;return g.view||(console.log("Creating view field and migrating old properties..."),l=!0,a.view={},g.center!==void 0&&(a.view.center=g.center,delete a.center),g.zoom!==void 0&&(a.view.zoom=g.zoom,delete a.zoom),g.projection!==void 0&&(a.view.projection=g.projection,delete a.projection),a.view.center===void 0&&(a.view.center=[0,0]),a.view.zoom===void 0&&(a.view.zoom=0),a.view.projection===void 0&&(a.view.projection="EPSG:3857")),(!g.styles||Object.keys(g.styles).length===0)&&(console.log("Adding default styles to map..."),l=!0,a.styles={...DEFAULT_STYLES}),(!g.styleRules||g.styleRules.length===0)&&(console.log("Adding default style rules to map..."),l=!0,a.styleRules=[...DEFAULT_STYLE_RULES]),l&&console.log("Map migration completed"),a}getGsMap(){return this.gsMap}async save(){if(!this.renderer){toastError("Map not initialized");return}try{if(!this.gsMap){toastError("Map not initialized");return}const g=JSON.parse(JSON.stringify(this.gsMap));await revertBlobUris(g,"url"),await revertBlobUris(g,"src"),this.input?.data.saveContents(JSON.stringify(g,null,2)),this.markDirty(!1)}catch(g){toastError(`Save failed: ${g.message}`)}}get mapOperations(){return this.operations}edit(){toastInfo("not yet implemented")}async refresh(){if(!this.renderer||!this.gsMap){logger$2.error("Map not initialized");return}await revertBlobUris(this.gsMap,"url"),await revertBlobUris(this.gsMap,"src"),this.moduleResolver.clear(),await replaceUris(this.gsMap,"url"),await replaceUris(this.gsMap,"src",this.moduleResolver),await this.renderer.modelToUI(this.gsMap)}async resetView(){!this.operations||!this.initialView||(await this.operations.setCenter(this.initialView.center),await this.operations.setZoom(this.initialView.zoom))}async handleDrawPoint(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("Point",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleDrawLine(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("LineString",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleDrawPolygon(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("Polygon",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleSelectFeatures(){await this.operations?.enableFeatureSelection(),this.interactionMode="select",this.updateToolbar()}async handleDeleteSelected(){if(this.interactionMode==="select")try{await this.operations?.deleteSelectedFeatures(),toastInfo("Selected features deleted")}catch(g){toastError(g.message)}}async handleCreateDrawingLayer(){if(!this.gsMap){toastError("Map not initialized");return}const g=await promptDialog("Enter name for new drawing layer:","Drawing Layer");if(!g)return;const a=ensureUuidsRecursive({name:g,type:GsLayerType.VECTOR,source:{type:GsSourceType.Features,features:[]},visible:!0});await this.operations?.addLayer(a,!1);const l=this.gsMap?.layers.find(A=>A.uuid===a.uuid);l?.uuid&&(this.activeDrawingLayerUuid=l.uuid),await this.updateComplete,this.updateToolbar(),toastInfo(`Created drawing layer: ${g}`)}doClose(){this.renderer?.destroy(),this.renderer=void 0,this.input=void 0,this.moduleResolver.clear()}render(){return x$1`
            <div class="gc-map-container" ${n$1(this.mapContainer)}>
            </div>
        `}};GsMapEditor.styles=[r$3(olCSS),i$3`
        :host {
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .gc-map-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
    `];__decorateClass$2([n({attribute:!1})],GsMapEditor.prototype,"input",2);__decorateClass$2([n({type:String})],GsMapEditor.prototype,"activeDrawingLayerUuid",2);__decorateClass$2([n({type:String})],GsMapEditor.prototype,"interactionMode",2);GsMapEditor=__decorateClass$2([t("gs-map")],GsMapEditor);var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc$1(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp$1(a,l,O),O};let GsMapProps=class extends KPart{doBeforeUI(){this.watch(activeEditorSignal,g=>{this.onPartChanged(g)}),this.watch(mapChangedSignal,({part:g})=>{this.onMapChanged({part:g})})}onPartChanged(g){if(!(g==this||g==this.mapEditor)){if(!(g instanceof GsMapEditor)){this.mapEditor=void 0,this.requestUpdate();return}this.mapEditor=g,this.requestUpdate()}}onMapChanged({part:g}){g==this.mapEditor&&this.requestUpdate()}toggleVisible(g){const a=this.mapEditor.getGsMap(),l=findLayerByUuid(a,g);if(!l)return;const O=!(l.visible!==!1);this.mapEditor?.mapOperations?.setLayerVisible(g,O),this.updateLater()}async confirmAction(g,a){await confirmDialog(g)&&a()}selectLayer(g){this.selectedLayerUuid=g,this.updateToolbar(),this.updateContextMenu()}renameLayer(g){if(!this.mapEditor)return;const a=g||this.selectedLayerUuid;if(!a)return;const l=this.mapEditor.getGsMap();if(!findLayerByUuid(l,a))return;const O=findLayerIndexByUuid(l,a),Y=commandRegistry.createExecutionContext({index:O+1});commandRegistry.execute("rename_layer",Y)}deleteLayer(g){if(!this.mapEditor)return;const a=g||this.selectedLayerUuid;if(!a)return;const l=this.mapEditor.getGsMap(),A=findLayerByUuid(l,a);A&&this.confirmAction(`Delete layer "${A.name||"Layer"}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.deleteLayer(a)))}moveLayerUp(g){if(!this.mapEditor)return;const a=this.mapEditor.getGsMap();if(!a)return;const l=findLayerIndexByUuid(a,g);if(l<=0)return;const A=a.layers[l-1]?.uuid;A&&(this.withRefresh(()=>this.mapEditor?.mapOperations?.moveLayer(g,A)),this.selectedLayerUuid=A)}moveLayerDown(g){if(!this.mapEditor)return;const a=this.mapEditor.getGsMap();if(!a)return;const l=findLayerIndexByUuid(a,g);if(l<0||l>=a.layers.length-1)return;const A=a.layers[l+1]?.uuid;A&&(this.withRefresh(()=>this.mapEditor?.mapOperations?.moveLayer(g,A)),this.selectedLayerUuid=A)}renderToolbar(){const g=this.selectedLayerUuid!==void 0;return x$1`
            <k-command ?disabled=${!g} 
                      title="Rename selected layer" 
                      icon="pen"
                      .action=${()=>this.renameLayer()}>
            </k-command>
            <k-command ?disabled=${!g} 
                      title="Delete selected layer" 
                      icon="trash"
                      .action=${()=>this.deleteLayer()}>
            </k-command>
        `}renderContextMenu(){const g=this.selectedLayerUuid!==void 0;return x$1`
            <k-command ?disabled=${!g} 
                      icon="pen"
                      .action=${()=>this.renameLayer()}>
                Rename
            </k-command>
            <k-command ?disabled=${!g} 
                      icon="trash"
                      .action=${()=>this.deleteLayer()}>
                Delete
            </k-command>
        `}render(){return n$2(!this.mapEditor,()=>x$1`
                    <k-no-content message="Select a map."></k-no-content>`,()=>x$1`
                <wa-tree>
                    <wa-tree-item expanded>
                        <k-icon name="fg layers"></k-icon> Layers
                        ${this.mapEditor.getGsMap()?.layers.map((g,a)=>x$1`
                            <wa-tree-item @click="${()=>g.uuid&&this.selectLayer(g.uuid)}" 
                                          class="${this.selectedLayerUuid===g.uuid?"selected":""}">
                                <div class="layer-item">
                                    <div class="layer-name">
                                        <span>${g.name??`Layer ${a+1}`}${a==0?x$1`
                                            <small>(basemap)</small>`:""}</span>
                                    </div>
                                    <div class="layer-actions">
                                        <k-command size="small"
                                                  icon="${g.visible!==!1?"eye":"eye-slash"}"
                                                  title="${g.visible!==!1?"Hide layer":"Show layer"}"
                                                  .action=${()=>g.uuid&&this.toggleVisible(g.uuid)}>
                                        </k-command>
                                        <k-command size="small"
                                                  icon="arrow-up"
                                                  title="Move layer up"
                                                  ?disabled="${a===0}"
                                                  .action=${()=>g.uuid&&this.moveLayerUp(g.uuid)}>
                                        </k-command>
                                        <k-command size="small"
                                                  icon="arrow-down"
                                                  title="Move layer down"
                                                  ?disabled="${a===this.mapEditor.getGsMap().layers.length-1}"
                                                  .action=${()=>g.uuid&&this.moveLayerDown(g.uuid)}>
                                        </k-command>
                                    </div>
                                </div>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="fg map-control"></k-icon> Controls
                        ${this.mapEditor?.getGsMap()?.controls.map(g=>x$1`
                            <wa-tree-item>
                                <span>${getOriginalUri(g.src)}</span>
                                <k-command size="small"
                                          icon="trash"
                                          title="Delete control"
                                          .action=${()=>{g.uuid&&this.confirmAction(`Delete control "${getOriginalUri(g.src)}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.removeControl(g.uuid)))}}>
                                </k-command>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="fg map-poi"></k-icon> Overlays
                        ${this.mapEditor?.getGsMap()?.overlays.map(g=>x$1`
                            <wa-tree-item>
                                <span>${getOriginalUri(g.src)}</span>
                                <k-command size="small"
                                          icon="trash"
                                          title="Delete overlay"
                                          .action=${()=>{g.uuid&&this.confirmAction(`Delete overlay "${getOriginalUri(g.src)}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.removeOverlay(g.uuid)))}}>
                                </k-command>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="highlighter"></k-icon> Styles
                        <wa-tree-item>
                            <span>Defined Styles: ${Object.keys(this.mapEditor.getGsMap()?.styles||{}).length}</span>
                        </wa-tree-item>
                        <wa-tree-item>
                            <span>Style Rules: ${this.mapEditor.getGsMap()?.styleRules?.length||0}</span>
                        </wa-tree-item>
                    </wa-tree-item>
                </wa-tree>
            `)}};GsMapProps.styles=i$3`
        :host {
            display: flex;
            flex-direction: column;
        }
        
        wa-tree-item.selected {
            background-color: var(--wa-color-primary-50);
        }
        
        .layer-item {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 4px;
        }
        
        .layer-name {
            flex: 1;
        }
        
        .layer-actions {
            display: flex;
            gap: 2px;
        }
    `;__decorateClass$1([r$1()],GsMapProps.prototype,"selectedLayerUuid",2);GsMapProps=__decorateClass$1([t("gs-map-props")],GsMapProps);var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(g,a,l,A)=>{for(var O=A>1?void 0:A?__getOwnPropDesc(a,l):a,Y=g.length-1,R;Y>=0;Y--)(R=g[Y])&&(O=(A?R(a,l,O):R(O))||O);return A&&O&&__defProp(a,l,O),O};const CID_CATALOG_ROOT="catalog.root";let GsCatalog=class extends KPart{constructor(){super(...arguments),this.treeRef=e$1()}doBeforeUI(){const g=contributionRegistry.getContributions(CID_CATALOG_ROOT);this.rootNodes=this.toTreeNodes(g)}renderToolbar(){const g=activePartSignal.get()instanceof GsCatalog&&activeSelectionSignal.get()!==void 0;return x$1`
            <k-command cmd="checkout" icon="file-arrow-down" ?disabled=${!g} title="Checkout"></k-command>
            <k-command cmd="refresh_catalog" icon="arrows-rotate" title="Refresh Catalog"></k-command>
            <k-command cmd="catalog_expand_all" icon="angles-down" slot="end" title="Expand All"></k-command>
            <k-command cmd="catalog_collapse_all" icon="angles-up" slot="end" title="Collapse All"></k-command>
        `}toTreeNodes(g){return g.map(a=>{const l={data:a.state,icon:a.icon,label:a.label,leaf:!1};if(a.contributionId){const A=contributionRegistry.getContributions(a.contributionId);l.leaf=A.length===0,l.children=this.toTreeNodes(A)}return l})}onItemDblClicked(g){const a=g.currentTarget.model.data.url;this.executeCommand("checkout",{url:a})}onSelectionChanged(g){const a=g.detail.selection[0].model;activeSelectionSignal.set(a.data)}setAllExpanded(g){const a=this.treeRef.value;a&&a.querySelectorAll("wa-tree-item").forEach(l=>{l.expanded=g})}refresh(){this.requestUpdate()}createTreeItems(g,a=!1){return g?x$1`
            <wa-tree-item
                    @dblclick=${this.nobubble(this.onItemDblClicked)} .model=${g} ?expanded=${a}>
                <span><k-icon name="${g.icon}"></k-icon> ${g.label}</span>
                ${g.children?.map(l=>this.createTreeItems(l))}
            </wa-tree-item>`:x$1``}render(){return x$1`
            <wa-tree ${n$1(this.treeRef)} @wa-selection-change=${this.nobubble(this.onSelectionChanged)} style="--indent-guide-width: 1px;">
                ${this.rootNodes?.map(g=>this.createTreeItems(g,!0))}
            </wa-tree>
        `}};GsCatalog.styles=i$3`
        :host {
            display: flex;
            flex-direction: column;
        }
    `;__decorateClass([r$1()],GsCatalog.prototype,"rootNodes",2);GsCatalog=__decorateClass([t("gs-catalog")],GsCatalog);const label="geo!space catalog",icon="earth",contributionId="catalog.root.geospace",items=[{contributionId:"catalog.root.notebooks",label:"Notebooks",icon:"book",items:[{label:"Welcome to Jupyter Notebooks",icon:"graduation-cap",state:{url:"${baseURL}/notebooks/welcome.ipynb",type:"file"}},{label:"Simple Notebook",icon:"circle-info",state:{url:"${baseURL}/notebooks/simple-notebook.ipynb",type:"file"}}]},{contributionId:"catalog.root.datasets",label:"Datasets",icon:"clone",items:[{label:"countries.geojson",icon:"fg geojson-file",state:{url:"${baseURL}/datasets/countries.geojson",type:"file"}}]},{contributionId:"catalog.root.maps",label:"Maps",icon:"map-location",items:[{label:"OpenStreetMap basemap",icon:"earth",state:{url:"${baseURL}/maps/osm.geospace",type:"file"}},{label:"basemap.de basemap",icon:"earth",state:{url:"${baseURL}/maps/bm.geospace",type:"file"}},{label:"basemap.de WMS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms.geospace",type:"file"}},{label:"basemap.de WMS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms-gray.geospace",type:"file"}},{label:"basemap.de WMTS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts.geospace",type:"file"}},{label:"basemap.de WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts.geospace",type:"file"}},{label:"TopPlusOpen WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light-gray.geospace",type:"file"}},{label:"Esri World Imagery (Satellite)",icon:"satellite",state:{url:"${baseURL}/maps/esri-world-imagery.geospace",type:"file"}},{label:"Sentinel-2 Cloudless (Satellite)",icon:"satellite",state:{url:"${baseURL}/maps/sentinel2-cloudless.geospace",type:"file"}}]},{contributionId:"catalog.root.overlays",label:"Overlays",icon:"fg map-poi",items:[]},{contributionId:"catalog.root.controls",label:"Controls",icon:"fg map-control",items:[]},{contributionId:"catalog.root.icons",label:"Icons",icon:"icons",items:[{label:"marker.png",icon:"file",state:{url:"${baseURL}/icons/marker.png",type:"file"}},{label:"location-user-24.png",icon:"file",state:{url:"${baseURL}/icons/location-user-24.png",type:"file"}}]},{contributionId:"catalog.root.packages",label:"Asset Packages",icon:"box-archive",items:[]}],gsCatalog={label,icon,contributionId,items};registerAll({command:{id:"checkout",name:"Checkout",description:"Checkout a catalog item into the workspace",parameters:[{name:"url",description:"the url of the resource to checkout, if not provided, the current selection in the catalog will be used",required:!1}]},handler:{execute:async g=>{let a=g.params&&g.params.url;if(!a){const A=activeSelectionSignal.get();if(!A||!("url"in A))return;a=A.url}const l=await workspaceService.getWorkspace();if(!l){toastError("No workspace selected.");return}fetch(a,{method:"GET"}).then(A=>A.blob()).then(A=>{const O=new URL(a).pathname.split("/"),Y=O[O.length-1];return l.getResource(Y,{create:!0}).then(R=>R.saveContents(A,{contentType:FileContentType.BINARY}).then(()=>{toastInfo("File checked out: "+Y)}))}).catch(A=>{toastError(A)})}}});registerAll({command:{id:"refresh_catalog",name:"Refresh Catalog",description:"Refreshes the catalog view",parameters:[]},handler:{execute:async g=>{const a=activePartSignal.get();a instanceof GsCatalog&&a.refresh()}}});registerAll({command:{id:"catalog_expand_all",name:"Expand All Catalog Items",description:"Expands all items in the catalog tree",parameters:[]},handler:{execute:async g=>{const a=activePartSignal.get();a instanceof GsCatalog&&a.setAllExpanded(!0)}}});registerAll({command:{id:"catalog_collapse_all",name:"Collapse All Catalog Items",description:"Collapses all items in the catalog tree",parameters:[]},handler:{execute:async g=>{const a=activePartSignal.get();a instanceof GsCatalog&&a.setAllExpanded(!1)}}});registerCatalog(gsCatalog);const logger$1=createLogger("GsCommandHandlers"),canExecute=g=>g.activeEditor instanceof GsMapEditor,getMapOperations=g=>{const a=g.activeEditor;if(!(a instanceof GsMapEditor)||!a.getOperations())throw logger$1.error("GsMapEditor with renderer not available in context.activeEditor"),new Error("GsMapEditor with renderer not available in context.activeEditor");return a.getOperations()};commandRegistry.registerAll({command:{id:"zoom_to_level",name:"Zoom to Level",description:"Zooms the map to the provided level",parameters:[{name:"zoom",description:"the zoom level (typically 0-20, where 0=world view, 5-9=country/region, 10-12=city, 13-15=street, 16-20=building detail)",required:!0}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),l=Number(g.params.zoom).valueOf();return await a.setZoom(l),{zoom:l}}}});commandRegistry.registerAll({command:{id:"zoom_in",name:"Zoom In",description:"Zooms the map in by one level",parameters:[],output:[{name:"zoom",description:"the new zoom level",type:"number"}]},handler:{canExecute:g=>activePartSignal.get()instanceof GsMapEditor,execute:async g=>{const a=activePartSignal.get(),l=a.getGsMap();if(l?.view?.zoom!==void 0){const A=a.mapOperations,O=l.view.zoom+1;return await A?.setZoom(O),O}return l?.view?.zoom}}});commandRegistry.registerAll({command:{id:"zoom_out",name:"Zoom Out",description:"Zooms the map out by one level",parameters:[],output:[{name:"zoom",description:"the new zoom level",type:"number"}]},handler:{canExecute:g=>activePartSignal.get()instanceof GsMapEditor,execute:async g=>{const a=activePartSignal.get(),l=a.getGsMap();if(l?.view?.zoom!==void 0){const A=a.mapOperations,O=l.view.zoom-1;return await A?.setZoom(O),O}return l?.view?.zoom}}});commandRegistry.registerAll({command:{id:"center_location",name:"Center to a location",description:"Centers the map to the provided location coordinates",parameters:[{name:"lat",description:"the latitude of the location (e.g., 52.52 for Berlin). Use your knowledge of city coordinates or approximate values.",type:"number",required:!0},{name:"lon",description:"the longitude of the location (e.g., 13.405 for Berlin). Use your knowledge of city coordinates or approximate values.",type:"number",required:!0}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),l=fromLonLat([Number(g.params.lon).valueOf(),Number(g.params.lat).valueOf()]);await a.setCenter([l[0],l[1]])}}});commandRegistry.registerAll({command:{id:"add_layer",name:"Add new layer",description:"Adds a new layer to the map or set the basemap",parameters:[{name:"source",description:`the source of the layer, one of: ${Object.values(GsSourceType).join(", ")}`,required:!0},{name:"basemap",description:"if set to true, the new layer will be used as the basemap or basemap layer",required:!1},{name:"url",description:"the URL or path within the workspace to load the features/geometries from",required:!1},{name:"stylePath",description:"the path within the workspace to the style json file if source is of type vector, for example, geojson",required:!1}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),l=g.params.source?.trim().toLowerCase(),A=g.params.url,O=toGsSourceType(l),Y=g?.params&&g.params.basemap==!0;let R;A&&(R=A.split("/").pop()),!R&&O&&(R=O);const ee=ensureUuid({name:R,type:toGsLayerType(l),source:ensureUuid({type:O,url:A??toSourceUrl(O)})});await replaceUris(ee,"url"),await a.addLayer(ee,Y)}}});commandRegistry.registerAll({command:{id:"delete_layer",name:"Delete a layer",description:"Delete a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to delete, starts with 1 for the first layer",required:!0}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),A=g.activeEditor.getGsMap(),O=parseInt(g.params.index)-1;if(O<0||!A||O>=A.layers.length)return;const Y=A.layers[O];Y?.uuid&&await a.deleteLayer(Y.uuid)}}});commandRegistry.registerAll({command:{id:"rename_layer",name:"Rename a layer",description:"Rename a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to rename, starts with 1 for the first layer",required:!0},{name:"newName",description:"the new name for the layer",required:!1}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),A=g.activeEditor.getGsMap(),O=parseInt(g.params.index)-1;if(O<0||!A||O>=A.layers.length)return;const Y=A.layers[O];if(!Y?.uuid)return;const R=Y.name||`Layer ${O+1}`,ee=g.params?.newName||await promptDialog(`Enter new name for "${R}":`,R);!ee||ee===R||await a.renameLayer(Y.uuid,ee)}}});commandRegistry.registerAll({command:{id:"switch_color_mode",name:"Switch color mode",description:"Switches the current color mode to either dark or light (default)",parameters:[{name:"mode",description:"the mode to switch to, will be toggled if not provided",required:!1}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),l=g.params?.mode;await a.switchColorMode(l)}}});commandRegistry.registerAll({command:{id:"add_overlay",name:"Add overlay",description:"Adds an overlay JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),l=g.params.src,A=g.params.position;await a.addOverlayFromModule(l,A)}}});commandRegistry.registerAll({command:{id:"add_control",name:"Add control",description:"Adds a control JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute,execute:async g=>{const a=getMapOperations(g),l=g.params.src;await a.addControlFromModule(l)}}});commandRegistry.registerAll({command:{id:"view_extents",name:"View extents",description:"Stores the extent of the current view as a variable",parameters:[{name:"latlon",description:"set to true to reverse coordinates to lat/lon instead of lon/lat; useful for various external services such as OpenStreetMap Overpass API",required:!1}],output:[{name:"viewExtent",description:"the current view's extent as lat/lon coordinates in WGS84 (EPSG:4326) format",type:"number[]"}]},handler:{canExecute,execute:async g=>{const a=g.activeEditor,l=g.params.latlon,O=await a.getRenderer().getViewExtent();if(!O)throw new Error("Failed to get view extent");let Y=O;if(l||l===void 0){const{transformExtent:R}=await __vitePreload(async()=>{const{transformExtent:ee}=await import("./index-BahNKH7f.js").then(xe=>xe.ah);return{transformExtent:ee}},__vite__mapDeps([1,2]));Y=R(O,"EPSG:3857","EPSG:4326"),[Y[0],Y[1]]=[Y[1],Y[0]],[Y[2],Y[3]]=[Y[3],Y[2]]}return g.viewExtent=Y,Y}}});commandRegistry.registerAll({command:{id:"toggle_mobile_view",name:"Toggle Mobile View",description:"Toggles between desktop and mobile view for the map",parameters:[]},handler:{canExecute:g=>activePartSignal.get()instanceof GsMapEditor,execute:async g=>{const a=activePartSignal.get().renderer;if(!a||!("toggleMobileView"in a))throw new Error("Mobile view toggle not available on this renderer");a.toggleMobileView()}}});commandRegistry.registerAll({command:{id:"refresh_map",name:"Refresh Map",description:"Refreshes the currently active map editor",parameters:[]},handler:{canExecute:g=>activePartSignal.get()instanceof GsMapEditor,execute:async g=>{const a=activePartSignal.get();a instanceof GsMapEditor&&await a.refresh()}}});commandRegistry.registerAll({command:{id:"reset_view",name:"Reset View",description:"Resets the map view to the initial center and zoom level",parameters:[]},handler:{canExecute:g=>activePartSignal.get()instanceof GsMapEditor,execute:async g=>{const a=activePartSignal.get();a instanceof GsMapEditor&&await a.resetView()}}});commandRegistry.registerAll({command:{id:"toggle_color_mode",name:"Toggle Color Mode",description:"Toggles between dark and light mode for the map",parameters:[]},handler:{canExecute:g=>activePartSignal.get()instanceof GsMapEditor,execute:async g=>{const l=activePartSignal.get().mapOperations;l&&await l.switchColorMode()}}});commandRegistry.registerAll({command:{id:"capture_map_screenshot",name:"Capture map screenshot",description:"Takes a screenshot of the currently visible OpenLayers map and returns it as a base64-encoded data URL. Useful for analyzing map imagery with ML tools.",parameters:[{name:"filePath",description:"Optional path for the screenshot file. If provided, the screenshot will be saved to this path. If not provided, a unique filename based on date and time will be generated and the screenshot will be saved (e.g., 'screenshot-2024-01-15-14-30-45.png').",type:"string",required:!1}],output:[{name:"dataUrl",description:"Base64-encoded data URL of the map screenshot (format: data:image/png;base64,...)",type:"string"},{name:"width",description:"Width of the captured image in pixels",type:"number"},{name:"height",description:"Height of the captured image in pixels",type:"number"},{name:"filePath",description:"Path of the saved file (always present as screenshot is always saved)",type:"string"}]},handler:{canExecute:g=>g.activeEditor instanceof GsMapEditor,execute:async g=>{try{const a=g.activeEditor;if(!(a instanceof GsMapEditor))return{error:"Active editor is not a map editor"};const l=a.getRenderer();return!l||!(l instanceof IFrameMapRenderer)?{error:"Map renderer not available"}:await taskService.runAsync("Capturing map screenshot",async A=>{try{A.message="Capturing screenshot from map...",A.progress=10,logger$1.info("Capturing map screenshot...");const O=await l.sendMessage("captureScreenshot",{});if(!O)throw logger$1.error("No result from captureScreenshot"),toastError("Failed to capture screenshot: No result from iframe"),new Error("No result from screenshot capture");if(!O.success)throw logger$1.error(`Screenshot capture failed: ${O.error||"Unknown error"}`),toastError(`Failed to capture screenshot: ${O.error||"Unknown error"}`),new Error(O.error||"Failed to capture screenshot");A.message="Preparing to save screenshot...",A.progress=50,logger$1.info("Screenshot captured, saving to workspace...");const Y=await workspaceService.getWorkspace();if(!Y)throw logger$1.error("No workspace available"),toastError("Failed to save screenshot: No workspace available"),new Error("No workspace available");let R=g.params?.filePath;if(!R){let d="map";a.input?.data instanceof File&&(d=a.input.data.getName().replace(/\.geospace$/i,""),d=d.replace(/[^a-zA-Z0-9_-]/g,"_"));const H=new Date,Z=H.getFullYear(),Ye=String(H.getMonth()+1).padStart(2,"0"),et=String(H.getDate()).padStart(2,"0"),tt=String(H.getHours()).padStart(2,"0"),nt=String(H.getMinutes()).padStart(2,"0"),it=String(H.getSeconds()).padStart(2,"0");R=`${d}-screenshot-${Z}-${Ye}-${et}-${tt}-${nt}-${it}.png`}const ee=R.endsWith(".png")?R:`${R}.png`;if(A.message=`Saving screenshot to ${ee}...`,A.progress=70,logger$1.info(`Saving screenshot to: ${ee}`),!O.dataUrl)throw logger$1.error("No dataUrl in screenshot result"),toastError("Failed to save screenshot: No image data received"),new Error("No image data in screenshot result");const xe=O.dataUrl.split(",")[1];if(!xe)throw logger$1.error("Invalid dataUrl format"),toastError("Failed to save screenshot: Invalid image data format"),new Error("Invalid image data format");A.message="Converting image data...",A.progress=80;const ne=Uint8Array.from(atob(xe),d=>d.charCodeAt(0)),te=new Blob([ne],{type:"image/png"}),f=await Y.getResource(ee,{create:!0});if(!f)throw logger$1.error(`Failed to create file resource: ${ee}`),toastError(`Failed to save screenshot: Could not create file ${ee}`),new Error(`Failed to create file: ${ee}`);return A.message="Writing file to workspace...",A.progress=90,logger$1.info(`Saving blob (size: ${te.size} bytes) to file...`),await f.saveContents(te,{contentType:FileContentType.BINARY}),A.message="Screenshot saved successfully",A.progress=100,logger$1.info(`Screenshot saved successfully to: ${ee}`),toastInfo(`Screenshot saved: ${ee}`),{dataUrl:O.dataUrl,width:O.width,height:O.height,filePath:ee}}catch(O){throw logger$1.error(`Screenshot capture failed: ${O.message}`),toastError(`Failed to capture screenshot: ${O.message}`),O}})}catch(a){return logger$1.error(`Failed to capture map screenshot: ${a.message}`),toastError(`Failed to capture screenshot: ${a.message}`),{error:`Failed to capture map screenshot: ${a.message}`}}}}});const GEOSPACE_SPECIFIC_PROMPT=`
**geo!space - WebGIS Application:**

geo!space is a WebGIS (Web Geographic Information System) application for creating, editing, and visualizing interactive maps.

**Core Capabilities:**
- Interactive map editor with zoom, pan, and layer management
- Support for multiple layer types: GeoJSON, WMS, WMTS, Vector Tiles, and more
- Drawing tools for creating and editing geographic features
- Style management for customizing layer appearance
- Map state persistence in .geospace files (JSON format containing map configuration, layers, view settings, and styles)

**Map Editor:**
When a .geospace file is open, the map editor provides:
- Interactive map view with coordinate system support (EPSG:3857, EPSG:4326, etc.)
- Layer panel for managing multiple data layers
- Drawing tools for creating points, lines, and polygons
- Style editor for customizing layer visualizations
- Catalog integration for browsing and adding spatial data
`,geospacePromptEnhancer={enhance:async(g,a)=>`${g}

${GEOSPACE_SPECIFIC_PROMPT}`,priority:5};function registerGeospacePromptEnhancer(){contributionRegistry.registerContribution(CID_PROMPT_ENHANCERS,{label:"Geo!space Prompt Enhancer",enhancer:geospacePromptEnhancer})}const README=`# 🌐 geo!space
[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/erdalkaraca/geospace)
[![Browser Support](https://img.shields.io/badge/Chrome%20%7C%20Opera-Supported-brightgreen)](#-browser-compatibility)
[![AI Providers](https://img.shields.io/badge/AI%20Providers-6-blue)](#-ai-configuration)
[![PWA Ready](https://img.shields.io/badge/PWA-Ready-purple)](#-key-features)
[![No Installation](https://img.shields.io/badge/Installation-None%20Required-orange)](#-quick-start)

**The Interactive Mapping IDE in Your Browser**

geo!space is a powerful web application that combines professional mapping capabilities with AI-powered automation tools. Create interactive maps, execute Python and JavaScript code, and automate repetitive tasks using natural language prompts - all without installing any software, directly in your browser.

## 📑 Table of Contents

- [✨ Key Features](#-key-features)
- [🌐 Browser Compatibility](#-browser-compatibility)
- [🌟 Use Cases](#-use-cases)
- [🚀 Getting Started](#-getting-started)
- [👨‍💻 Development](#-development)
- [💬 Commands & Natural Language](#-commands--natural-language)
- [💡 Examples](#-examples)
- [⚙️ AI Configuration](#️-ai-configuration)
- [🔧 Troubleshooting](#-troubleshooting)
- [❓ FAQ](#-faq)
- [🏗️ Technical Architecture](#️-technical-architecture)
- [🤝 Trusted by](#-trusted-by)
- [⚡ Quick Start](#-quick-start)

## ✨ Key Features

### 🗺️ **Professional Mapping**
- **Interactive Map Editor**: Create and edit maps using the custom \`.geospace\` format
- **Multiple Data Sources**: Support for OSM, XYZ tiles, GeoJSON, KML, GeoTIFF, GPX, Features, BM (basemap.de), WMS, WMTS, and Overpass API
- **Satellite Imagery**: Built-in access to Esri World Imagery and Sentinel-2 satellite imagery
- **Layer Management**: Vector layers, tile layers, and layer groups with full styling control
- **OpenLayers Integration**: Built on the industry-standard OpenLayers mapping library
- **Advanced Styling**: Dynamic style loading and management system
- **PWA Transformation**: Convert \`.geospace\` files into cross-platform Progressive Web Apps

### 🤖 **AI-Powered Automation**
- **Multiple AI Providers**: Ollama, OpenAI, Groq, Cerebras, and WebLLM support
- **Context-Aware Assistants**: Specialized AI roles for mapping, coding, and general assistance
- **Local AI Support**: Run AI models locally using WebLLM or Ollama
- **Natural Language Commands**: Control the application using conversational prompts

### 💻 **Development Environment**
- **Monaco Editor**: Full VS Code editor experience with syntax highlighting
- **Python Execution**: Complete Pyodide integration with package management and pip requirements
- **JavaScript Execution**: Direct browser JavaScript execution in workers
- **File System Access**: Direct browser integration with local files and workspace persistence
- **Dependency Management**: Automatic pip requirements handling and package installation

### 🔧 **Extensibility**
- **Extension System**: Browse, install, and uninstall extensions from the built-in extension manager
- **Built-in Extensions**: WebLLM, Python/JS terminals, Linux terminal
- **Extension Sources**: Add extensions from trusted URLs or the geo!space extension registry
- **Command Registry**: 20+ built-in commands + extensible command system
- **Build System**: Generate publishable maps from \`.geospace\` files

## 🌐 Browser Compatibility

**⚠️ Important**: geo!space uses the File System Access API which has limited browser support.

- ✅ **Fully Supported**: Chrome and Opera
- ⚠️ **Limited Support**: Firefox and Safari (partial File System Access API support)

For more details, see [File System API](https://developer.mozilla.org/en-US/docs/Web/API/Window/showDirectoryPicker)

## 🌟 Use Cases

- **Data Analysts**: Create interactive maps for data visualization
- **Urban Planners**: Design and prototype mapping applications  
- **Developers**: Build geospatial applications without complex setup
- **Researchers**: Prototype location-based applications quickly
- **Educators**: Teach mapping and geospatial concepts interactively
- **App Creators**: Transform maps into cross-platform PWAs for mobile, desktop, and web deployment

## 🚀 Getting Started

### 1. **Connect a Workspace**
- In the Workspace tab, click the folder icon "Load workspace folder"
- Choose a local folder to use as your workspace
- This folder will be saved and restored when you reload geo!space

### 2. **Configure AI Assistant (Optional)**
- Open the settings editor using the settings button in the upper right corner
- Configure AI providers and models in the \`aiConfig\` section
- Set up API keys for your preferred AI services

### 3. **Working with Files**
- **\`.geospace\` files**: Map files that open in the interactive map editor
- **Python/JavaScript files**: Open in the Monaco code editor with syntax highlighting
- **Other files**: Open in the appropriate editor based on file type

### 4. **Creating Interactive Maps**
- Double-click \`.geospace\` files to open them in the map editor
- Use the map editor's UI to interact with layers, features, and styling
- Use the input field to run commands or interact with the map via natural language
- Add data sources: OSM tiles, GeoJSON files, KML, GeoTIFF, GPX, or custom features
- **Build PWA**: Use the "Build map" button to transform your \`.geospace\` file into a cross-platform Progressive Web App

### 5. **Code Development**
- Edit Python and JavaScript code in the Monaco editor
- Execute Python code using Pyodide (Python in the browser)
- Run JavaScript code directly in the browser
- Use the "Run" button to execute code snippets

### 6. **Resource Catalog**
- Browse the catalog view for curated maps, datasets, icons, and controls
- Select items from catalog categories (datasets, maps, overlays, controls, icons)
- Use the "Checkout" button to download items directly to your workspace
- Access pre-built basemaps (OpenStreetMap, basemap.de) and sample datasets

## 👨‍💻 Development

geo!space provides a powerful development environment for creating custom map controls and overlays using JavaScript modules.

### **Custom Modules**

Create interactive UI components for your maps using JavaScript modules. geo!space uses **Lit** for templating and **Web Awesome** for UI components - both are provided by default and based on browser standards only, so no build tools are required.

**Key Features:**
- **No Build Tools**: Write plain JavaScript modules that run directly in the browser
- **Lit Templating**: Use Lit's HTML template literals for reactive UI
- **Web Awesome Components**: Access to a full library of web-standard UI components
- **OpenLayers API**: Full access to OpenLayers through the \`ol\` namespace object
- **Module System**: Import and share modules within your workspace using relative paths or bare specifiers

**Getting Started:**
1. Create a JavaScript file in your workspace (e.g., \`my-control.js\`)
2. Export a default function that receives APIs via destructuring
3. Return a Lit template from your function
4. Add your module to a map's \`controls\` or \`overlays\` array in the \`.geospace\` file

**Example:**
\`\`\`javascript
export default function ({html, style, events, map}) {
    style({
        position: "absolute",
        bottom: "0",
        left: "0",
        right: "0"
    });

    return () => html\`
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr;">
            <wa-button @click=\${() => events("drawer/openMenu")}>
                Menu
            </wa-button>
        </div>
    \`;
}
\`\`\`

**Learn More:**
- 📖 See the [User Modules Guide](packages/geospace/public/docs/user-modules.md) for complete documentation
- 🎨 Browse Web Awesome components: https://webawesome.com
- 🗺️ Explore OpenLayers API: https://openlayers.org/

## 💬 Commands & Natural Language

### **Slash Commands**
Use commands starting with \`/\` in the map editor's input field:

- \`/python\`: Execute Python code
- \`/js\`: Execute JavaScript code  
- \`/touch\`: Create a new, empty file
- \`/save\`: Save the current file
- \`/build_map\`: Build a publishable map from the current \`.geospace\` file

### **Rich Command Library**
geo!space includes 20+ built-in commands for mapping operations:
- **Map Navigation**: \`zoom_to_level\`, \`center_location\`
- **Layer Management**: \`add_layer\`, \`delete_layer\`, \`add_marker\`
- **Data Operations**: Import/export various geospatial formats
- **File Operations**: Create, save, and manage workspace files

### **Natural Language Interaction**
- **Map Editor**: Ask questions like "Add a marker at coordinates 52.5, 13.4" or "Change the style of all points to red"
- **Code Editor**: Request code assistance like "Create a function to calculate distance between two points"
- **General**: Ask about app features, get help with workflows, or request explanations

## 💡 Examples

### **Create a City Map**
\`\`\`
1. /touch city-map.geospace
2. "Add OpenStreetMap as base layer"
3. "Download buildings in the current view"
4. "Download trees in the current view"
5. /build_map
\`\`\`

### **Custom App Development**
\`\`\`
1. Create map with /touch app.geospace
2. Add custom controls using JavaScript with prepackaged libraries (Lit, WebAwesome)
3. Write Python scripts for data processing
4. /build_map for cross-platform deployment
\`\`\`

## ⚙️ AI Configuration

### **Context-Aware AI Assistants**
The AI assistant adapts its role based on your current context:

- **🗺️ Map Editor**: Specialized for mapping tasks, layer management, and geospatial operations
- **💻 Code Editor**: Focused on coding assistance, debugging, and code generation
- **🌐 General App**: Helps with app navigation, features, and general workflows

Each assistant can be identified by its icon and help hint in the AI view.

### **AI Provider Setup**
Configure AI providers in the app settings (accessible via the settings button in the upper right corner). The settings are stored in IndexedDB under the \`settings.json\` section:

\`\`\`json
{
  "aiConfig": {
    "defaultProvider": "openai",
    "providers": [
      {
        "name": "ollama",
        "model": "gemma3:12b",
        "chatApiEndpoint": "http://localhost:11434/v1/chat/completions",
        "apiKey": ""
      },
      {
        "name": "openai",
        "model": "gpt-4.1",
        "chatApiEndpoint": "https://api.openai.com/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "groq",
        "model": "llama-3.1-8b-instant",
        "chatApiEndpoint": "https://api.groq.com/openai/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "cerebras",
        "model": "llama3.1-8b",
        "chatApiEndpoint": "https://api.cerebras.ai/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "webllm",
        "model": "gemma-2-9b-it-q4f16_1-MLC",
        "chatApiEndpoint": "",
        "apiKey": "",
        "parameters": {
          "context_window_size": 4096
        }
      },
      {
        "name": "mistral",
        "model": "mistral-large-latest",
        "chatApiEndpoint": "https://api.mistral.ai/v1/chat/completions",
        "apiKey": "<your api key>",
        "ocrApiEndpoint": "https://api.mistral.ai/v1/ocr"
      }
    ]
  }
}
\`\`\`

**Setup Instructions:**
1. Open the settings editor using the settings button in the upper right corner
2. Replace \`<your api key>\` with your actual API keys for each provider
3. Set \`defaultProvider\` to your preferred provider name
4. For **Ollama**: Install locally and ensure it's running on \`localhost:11434\`
5. For **WebLLM**: No API key needed - runs models locally in the browser
   - **⚠️ GPU Requirement**: Requires a dedicated GPU with sufficient VRAM to run the selected model
   - Models like \`gemma-2-9b-it-q4f16_1-MLC\` typically need 8GB+ VRAM
6. Settings are automatically saved to IndexedDB - no manual file management required
7. You can change the default provider in the AI view after connecting to a workspace

## 🔧 Troubleshooting

### **Common Issues**

**File Not Found**
- If you don't see expected files, try reloading the workspace
- Ensure the workspace folder is properly connected

**AI Assistant Not Working**
- Verify settings are correctly configured in the app settings (stored in IndexedDB)
- Check that your API keys are valid and properly formatted
- For local providers (Ollama), ensure the service is running

**Browser Compatibility Issues**
- Use Chrome or Opera for full functionality
- Firefox and Safari have limited File System Access API support

**Map Not Loading**
- Check that \`.geospace\` files contain valid JSON
- Verify data source URLs are accessible
- Ensure required resources (icons, styles) are available

## ❓ FAQ

**Q: Do I need to install anything?**
A: No! geo!space runs entirely in your browser. Just open it in Chrome or Opera.

**Q: Is my data secure?**
A: Yes. All data stays in your browser and local workspace. No data is sent to external servers unless you explicitly use AI services.

**Q: Can I use geo!space offline?**
A: Yes, for basic mapping features. AI assistance requires internet connection (except for local providers like Ollama/WebLLM).

**Q: How do I share my maps?**
A: Use the "Build map" button to create a PWA that can be deployed anywhere or shared as a standalone app.

**Q: What file formats are supported?**
A: Maps: \`.geospace\` (JSON), Data: GeoJSON, KML, GPX, GeoTIFF, Features. Tile sources: OSM, XYZ, WMS, WMTS, BM (basemap.de), Satellite imagery (Esri, Sentinel-2). Code: Python, JavaScript, and more.

**Q: Can I customize the interface?**
A: Yes! Install extensions, create custom controls using WebAwesome components, or add your own extensions.

**Q: What extensions are available?**
A: Built-in extensions include WebLLM, Python/JS terminals, Linux terminal, and more. Browse and install from the extension manager.

## 🏗️ Technical Architecture

**Frontend Stack:**
- **Lit**: Web components framework
- **TypeScript**: Main development language  
- **Vite**: Build tool and development server
- **Monaco Editor**: VS Code's editor component
- **WebAwesome**: Web components library (also available for custom map controls)

**Mapping Stack:**
- **OpenLayers**: Professional mapping library
- **Custom Runtime**: Map-to-OpenLayers conversion system
- **Style Loader**: Dynamic style loading

**AI Stack:**
- **Multiple Providers**: Flexible AI provider system
- **WebLLM**: Local AI model execution
- **Context-Aware**: Specialized AI roles per context

## 🤝 Trusted by

- **[Kiosk Scout](https://finder.kioskscout.de)**: A cross-platform PWA for finding nearby vending machines
- **Want your geo!space app listed here?** Contact us!

---

## ⚡ Quick Start

**Get up and running in 3 minutes:**

1. **Open geo!space** in Chrome or Opera
2. **Connect workspace** - Click folder icon and select a local directory
3. **Create your first map** - Use \`/touch my-map.geospace\` or open existing files
4. **Try AI assistance** - Ask "Add a marker at [your location]" in the map editor
5. **Build your app** - Use \`/build_map\` to create a deployable PWA

### **First-Time Setup**
- **No AI needed**: Start mapping immediately without configuration
- **AI setup**: Open settings → configure API keys for enhanced assistance
- **Extensions**: Browse and install extensions from the extension manager

## 🎯 Ready to Start?

1. **Load the app** in Chrome or Opera
2. **Connect a workspace** folder
3. **Create your first map** or open an existing \`.geospace\` file
4. **Ask the AI** for help with mapping tasks
5. **Build and share** your interactive maps

**Happy mapping! 🗺️✨**`,appVersion=geospacePackageJson.version,logger=createLogger("GeoSpaceApp"),GEOSPACE_EXTENSIONS=["geospace.styleEditor","system.mdeditor","system.monaco","system.download","system.commandpalette","system.memoryusage","system.pythonpackagemanager","system.settings-tree","system.ai-system"],GEOSPACE_UI_CONTRIBUTIONS=[{target:TOOLBAR_MAIN,slot:"start",label:"Brand",html:'<span style="margin-right: 1rem;"><span><nobr>🌐<i><b>geo!</b></i><small>space</small></nobr></span></span>'},{target:"system.fastviews-bottomend",name:"catalog",label:"Catalog",icon:"book",component:g=>x$1`<gs-catalog id="${g}"></gs-catalog>`},{target:SIDEBAR_MAIN_BOTTOM,name:"map-props",label:"Map Properties",icon:"fg map-options",component:g=>x$1`<gs-map-props id="${g}"></gs-map-props>`},{target:"contextmenu:filebrowser",label:"Add as Map Layer",icon:"layer-group",command:"add_layer_from_selection",disabled:()=>{const g=activeSelectionSignal.get();return g instanceof File?!isSupportedSpatialFile(g):!0}},{target:"filebrowser.create",label:"geo!space map",icon:"earth",command:"create_map_file"}],GEOSPACE_EXTENSION_CONTRIBUTIONS=[{id:"geospace.mapBuilder",name:"geo!space Map Builder",description:"Compile a geo!space file to an interactive website",loader:()=>__vitePreload(()=>import("./mapbuilder-extension-BLxLOfBN.js"),__vite__mapDeps([24,1,2])),icon:"earth"},{id:"geospace.styleEditor",name:"Style Editor",description:"Visual editor for defining and managing map styles and rules",loader:()=>__vitePreload(()=>import("./style-editor-extension-DAzqQgjT.js"),__vite__mapDeps([25,1,2])),icon:"palette"},{id:"geospace.overpass",name:"OpenStreetMap Overpass",description:"OpenStreetMap Overpass API Integration for use with LLMs",loader:()=>__vitePreload(()=>import("./overpass-extension-BD4gemYX.js"),__vite__mapDeps([26,1,2])),icon:"table"},{id:"geospace.gtfs",name:"GTFS to GeoJSON Converter",description:"Convert GTFS zip archives to GeoJSON files",loader:()=>__vitePreload(()=>import("./gtfs-extension-DzsnGyEV.js"),__vite__mapDeps([27,1,2])),icon:"map-location-dot"}],geospaceApp={id:"geospace",name:"🌐geo!space",version:appVersion,description:"An IDE for working with geospatial data.",metadata:{github:{owner:"erdalkaraca",repo:"geospace"},favicon:"/geospace.svg"},extensions:GEOSPACE_EXTENSIONS,contributions:{ui:GEOSPACE_UI_CONTRIBUTIONS,extensions:GEOSPACE_EXTENSION_CONTRIBUTIONS},async initialize(){packageInfoService.addPackage({name:geospacePackageJson.name,version:geospacePackageJson.version,dependencies:geospacePackageJson.dependencies,devDependencies:geospacePackageJson.devDependencies}),registerGeospacePromptEnhancer(),contributionRegistry.registerContribution("system.icons",{label:"geo!space File Icons",mappings:{geospace:"earth"},priority:1}),registerAll({command:{id:"add_layer_from_selection",name:"Add Layer from Selected File",description:"Adds the selected file as a map layer",parameters:[]},handler:{execute:async g=>{const a=activeSelectionSignal.get();if(!(a instanceof File))return;const l=getSourceTypeFromFile(a);if(!l){logger.warn(`Unsupported file type: ${a.getName()}`);return}const A=a.getWorkspacePath(),O=commandRegistry.createExecutionContext({source:l,url:A});await commandRegistry.execute("add_layer",O)}}}),registerAll({command:{id:"create_map_file",name:"Create Geospace map file",description:"Creates a new .geospace map file with default map structure. This is specifically for creating geospace map files, not general files.",parameters:[{name:"path",description:"the path including name of the map file to be created (e.g., 'my-map.geospace' or 'my map'). The .geospace extension will be added automatically if missing. Must be relative to the workspace.",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async g=>{const a={...DEFAULT_GSMAP,chatHistory:[],view:{center:[1105600,6120800],zoom:5,projection:"EPSG:3857"}},l=g.params?.path||"map.geospace",A=l.endsWith(".geospace")?l:`${l}.geospace`;return await commandRegistry.execute("create_file",{params:{path:A,contents:JSON.stringify(a,null,2),extension:".geospace",ask:l==="map.geospace"}})}}}),registerAll({command:{id:"help",name:"Show welcome",description:"Shows the welcome page.",parameters:[]},handler:{execute:async g=>{const a=new StringFile(README,"README.md");await editorRegistry.loadEditor(a)}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"question-circle",label:"Welcome"}}),logger.info("geo!space is ready!")}};appLoaderService.registerApp(geospaceApp,{defaultAppId:"geospace",autoStart:!0,container:document.body});export{commandregistry as $,createLogger as A,TOPIC_SETTINGS_CHANGED as B,CID_PROMPT_ENHANCERS as C,Directory as D,appSettings as E,File as F,GsMapEditor as G,promptDialog as H,confirmDialog as I,inBrowserMLService as J,KElement as K,topic as L,TOPIC_AICONFIG_CHANGED as M,uiContext as N,TOPIC_AI_STREAM_COMPLETE as O,PyEnv as P,tokenUsageTracker as Q,ProviderFactory as R,KEY_AI_CONFIG as S,TOOLBAR_MAIN as T,CID_CHAT_PROVIDERS as U,CID_AGENTS as V,TOOLBAR_MAIN_RIGHT as W,pipeline as X,env$1 as Y,toastWarning as Z,TOPIC_WORKSPACE_CONNECTED as _,toastInfo as a,settingsservice as a0,constants as a1,toolExecutor as a2,toastError as b,activePartSignal as c,activeSelectionSignal as d,contributionRegistry as e,activeEditorSignal as f,defaultLogger as g,registerAll as h,PANEL_BOTTOM as i,aiService as j,KPart as k,loadEnvs as l,k as m,c as n,TOOLBAR_MAIN_CENTER as o,commandRegistry as p,FileContentType as q,rootContext as r,subscribe as s,taskService as t,commonjsRequire as u,editorRegistry as v,workspaceService as w,TOOLBAR_BOTTOM as x,publish as y,TOPIC_WORKSPACE_CHANGED as z};
