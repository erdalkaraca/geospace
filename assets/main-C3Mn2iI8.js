const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DUZ9xzhO.js","assets/index-CyGQFstn.css","assets/git-extension-DYs6fDdp.js","assets/pyterminal-extension-j52wL-XV.js","assets/xterm-CODBi7oP.js","assets/k-linuxterminal-DGp9lFI5.js","assets/p12-splitter-eRk-0BzG.js","assets/notebook-extension-BVgDMCki.js","assets/editor.main-V90s_O0y.js","assets/editor-D6kYW_CN.css","assets/command-palette-extension-HeJqRso8.js","assets/download-extension-DSqPbzxp.js","assets/unzip-extension-BBdvAyLw.js","assets/md-editor-extension-BI1Vg3CR.js","assets/monaco-editor-extension-DPR2O5-8.js","assets/memory-usage-extension-Cqu036sA.js","assets/mapbuilder-extension-D7BBqcMB.js","assets/overpass-extension-CcpW4aBa.js"])))=>i.map(i=>d[i]);
var aa=Object.defineProperty;var oa=(n,e,t)=>e in n?aa(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var He=(n,e,t)=>oa(n,typeof e!="symbol"?e+"":e,t);import{r as lr,p as sr,g as ss,u as sn,i as as,s as Zt,a as Mt,x as fe,t as wt,o as os,b as la,n as Wt,c as Ct,E as dr,e as Er,d as Cr,f as Ht,B as ls,h as oi,w as Tt,R as ca,D as ua,F as cs,T as Hr,j as li,k as Jr,W as pa,S as us,l as Fi,m as da,_ as ha,q as fa,v as At,y as ma,z as ga,A as va,C as ps,G as ya,H as ba,I as wa,J as Ia,K as xa}from"./index-DUZ9xzhO.js";class ka{constructor(){this.level=1}setLevel(e){this.level=e}debug(e){this.level===0&&console.log(`[DEBUG] ${e}`)}info(e){(this.level===1||this.level===0)&&console.log(`[INFO] ${e}`)}warn(e){(this.level===2||this.level===1||this.level===0)&&console.warn(`[WARN] ${e}`)}error(e){console.error(`[ERROR] ${e}`)}}const Ut=new ka;Ut.setLevel(0);lr.put("logger",Ut);var Sa=Object.defineProperty,Aa=(n,e,t)=>e in n?Sa(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Wn=(n,e,t)=>(Aa(n,typeof e!="symbol"?e+"":e,t),t),_a=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},Gn=(n,e)=>{if(Object(e)!==e)throw TypeError('Cannot use the "in" operator on this value');return n.has(e)},fn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},qi=(n,e,t)=>(_a(n,e,"access private method"),t);/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */function ds(n,e){return Object.is(n,e)}/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */let lt=null,Zr=!1,In=1;const kn=Symbol("SIGNAL");function Dr(n){const e=lt;return lt=n,e}function Ea(){return lt}function Ca(){return Zr}const ci={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Tn(n){if(Zr)throw new Error(typeof ngDevMode<"u"&&ngDevMode?"Assertion error: signal read during notification phase":"");if(lt===null)return;lt.consumerOnSignalRead(n);const e=lt.nextProducerIndex++;if(Mr(lt),e<lt.producerNode.length&&lt.producerNode[e]!==n&&Yn(lt)){const t=lt.producerNode[e];Rn(t,lt.producerIndexOfThis[e])}lt.producerNode[e]!==n&&(lt.producerNode[e]=n,lt.producerIndexOfThis[e]=Yn(lt)?ms(n,lt,e):0),lt.producerLastReadVersion[e]=n.version}function Oa(){In++}function hs(n){if(!(!n.dirty&&n.lastCleanEpoch===In)){if(!n.producerMustRecompute(n)&&!La(n)){n.dirty=!1,n.lastCleanEpoch=In;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=In}}function fs(n){if(n.liveConsumerNode===void 0)return;const e=Zr;Zr=!0;try{for(const t of n.liveConsumerNode)t.dirty||Ta(t)}finally{Zr=e}}function Pa(){return(lt==null?void 0:lt.consumerAllowSignalWrites)!==!1}function Ta(n){var e;n.dirty=!0,fs(n),(e=n.consumerMarkedDirty)==null||e.call(n.wrapper??n)}function Ra(n){return n&&(n.nextProducerIndex=0),Dr(n)}function Na(n,e){if(Dr(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(Yn(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)Rn(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function La(n){Mr(n);for(let e=0;e<n.producerNode.length;e++){const t=n.producerNode[e],i=n.producerLastReadVersion[e];if(i!==t.version||(hs(t),i!==t.version))return!0}return!1}function ms(n,e,t){var i;if(ui(n),Mr(n),n.liveConsumerNode.length===0){(i=n.watched)==null||i.call(n.wrapper);for(let a=0;a<n.producerNode.length;a++)n.producerIndexOfThis[a]=ms(n.producerNode[a],n,a)}return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(e)-1}function Rn(n,e){var t;if(ui(n),Mr(n),typeof ngDevMode<"u"&&ngDevMode&&e>=n.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${e} is out of bounds of ${n.liveConsumerNode.length} consumers)`);if(n.liveConsumerNode.length===1){(t=n.unwatched)==null||t.call(n.wrapper);for(let a=0;a<n.producerNode.length;a++)Rn(n.producerNode[a],n.producerIndexOfThis[a])}const i=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[i],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[i],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){const a=n.liveConsumerIndexOfThis[e],u=n.liveConsumerNode[e];Mr(u),u.producerIndexOfThis[a]=e}}function Yn(n){var e;return n.consumerIsAlwaysLive||(((e=n==null?void 0:n.liveConsumerNode)==null?void 0:e.length)??0)>0}function Mr(n){n.producerNode??(n.producerNode=[]),n.producerIndexOfThis??(n.producerIndexOfThis=[]),n.producerLastReadVersion??(n.producerLastReadVersion=[])}function ui(n){n.liveConsumerNode??(n.liveConsumerNode=[]),n.liveConsumerIndexOfThis??(n.liveConsumerIndexOfThis=[])}/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */function gs(n){if(hs(n),Tn(n),n.value===Zn)throw n.error;return n.value}function Da(n){const e=Object.create(Ma);e.computation=n;const t=()=>gs(e);return t[kn]=e,t}const Vn=Symbol("UNSET"),Kn=Symbol("COMPUTING"),Zn=Symbol("ERRORED"),Ma={...ci,value:Vn,dirty:!0,error:null,equal:ds,producerMustRecompute(n){return n.value===Vn||n.value===Kn},producerRecomputeValue(n){if(n.value===Kn)throw new Error("Detected cycle in computations.");const e=n.value;n.value=Kn;const t=Ra(n);let i,a=!1;try{i=n.computation.call(n.wrapper),a=e!==Vn&&e!==Zn&&n.equal.call(n.wrapper,e,i)}catch(u){i=Zn,n.error=u}finally{Na(n,t)}if(a){n.value=e;return}n.value=i,n.version++}};/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */function $a(){throw new Error}let Fa=$a;function qa(){Fa()}/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */function za(n){const e=Object.create(Ba);e.value=n;const t=()=>(Tn(e),e.value);return t[kn]=e,t}function ja(){return Tn(this),this.value}function Ua(n,e){Pa()||qa(),n.equal.call(n.wrapper,n.value,e)||(n.value=e,Wa(n))}const Ba={...ci,equal:ds,value:void 0};function Wa(n){n.version++,Oa(),fs(n)}/**
 * @license
 * Copyright 2024 Bloomberg Finance L.P.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt=Symbol("node");var Jt;(n=>{var e,t,i,a;class u{constructor(E,x={}){fn(this,t),Wn(this,e);const O=za(E)[kn];if(this[bt]=O,O.wrapper=this,x){const w=x.equals;w&&(O.equal=w),O.watched=x[n.subtle.watched],O.unwatched=x[n.subtle.unwatched]}}get(){if(!(0,n.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return ja.call(this[bt])}set(E){if(!(0,n.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(Ca())throw new Error("Writes to signals not permitted during Watcher callback");const x=this[bt];Ua(x,E)}}e=bt,t=new WeakSet,n.isState=m=>typeof m=="object"&&Gn(t,m),n.State=u;class o{constructor(E,x){fn(this,a),Wn(this,i);const O=Da(E)[kn];if(O.consumerAllowSignalWrites=!0,this[bt]=O,O.wrapper=this,x){const w=x.equals;w&&(O.equal=w),O.watched=x[n.subtle.watched],O.unwatched=x[n.subtle.unwatched]}}get(){if(!(0,n.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return gs(this[bt])}}i=bt,a=new WeakSet,n.isComputed=m=>typeof m=="object"&&Gn(a,m),n.Computed=o,(m=>{var E,x,C,O;function w(D){let B,N=null;try{N=Dr(null),B=D()}finally{Dr(N)}return B}m.untrack=w;function T(D){var B;if(!(0,n.isComputed)(D)&&!(0,n.isWatcher)(D))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return((B=D[bt].producerNode)==null?void 0:B.map(N=>N.wrapper))??[]}m.introspectSources=T;function j(D){var B;if(!(0,n.isComputed)(D)&&!(0,n.isState)(D))throw new TypeError("Called introspectSinks without a Signal argument");return((B=D[bt].liveConsumerNode)==null?void 0:B.map(N=>N.wrapper))??[]}m.introspectSinks=j;function te(D){if(!(0,n.isComputed)(D)&&!(0,n.isState)(D))throw new TypeError("Called hasSinks without a Signal argument");const B=D[bt].liveConsumerNode;return B?B.length>0:!1}m.hasSinks=te;function we(D){if(!(0,n.isComputed)(D)&&!(0,n.isWatcher)(D))throw new TypeError("Called hasSources without a Computed or Watcher argument");const B=D[bt].producerNode;return B?B.length>0:!1}m.hasSources=we;class Oe{constructor(B){fn(this,x),fn(this,C),Wn(this,E);let N=Object.create(ci);N.wrapper=this,N.consumerMarkedDirty=B,N.consumerIsAlwaysLive=!0,N.consumerAllowSignalWrites=!1,N.producerNode=[],this[bt]=N}watch(...B){if(!(0,n.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");qi(this,C,O).call(this,B);const N=this[bt];N.dirty=!1;const v=Dr(N);for(const F of B)Tn(F[bt]);Dr(v)}unwatch(...B){if(!(0,n.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");qi(this,C,O).call(this,B);const N=this[bt];Mr(N);for(let v=N.producerNode.length-1;v>=0;v--)if(B.includes(N.producerNode[v].wrapper)){Rn(N.producerNode[v],N.producerIndexOfThis[v]);const F=N.producerNode.length-1;if(N.producerNode[v]=N.producerNode[F],N.producerIndexOfThis[v]=N.producerIndexOfThis[F],N.producerNode.length--,N.producerIndexOfThis.length--,N.nextProducerIndex--,v<N.producerNode.length){const z=N.producerIndexOfThis[v],ie=N.producerNode[v];ui(ie),ie.liveConsumerIndexOfThis[z]=v}}}getPending(){if(!(0,n.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[bt].producerNode.filter(N=>N.dirty).map(N=>N.wrapper)}}E=bt,x=new WeakSet,C=new WeakSet,O=function(D){for(const B of D)if(!(0,n.isComputed)(B)&&!(0,n.isState)(B))throw new TypeError("Called watch/unwatch without a Computed or State argument")},n.isWatcher=D=>Gn(x,D),m.Watcher=Oe;function U(){var D;return(D=Ea())==null?void 0:D.wrapper}m.currentComputed=U,m.watched=Symbol("watched"),m.unwatched=Symbol("unwatched")})(n.subtle||(n.subtle={}))})(Jt||(Jt={}));/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ga=Symbol("SignalWatcherBrand"),Va=new FinalizationRegistry(({watcher:n,signal:e})=>{n.unwatch(e)}),zi=new WeakMap;function vs(n){return n[Ga]===!0?(console.warn("SignalWatcher should not be applied to the same class more than once."),n):class extends n{constructor(){super(...arguments),this._$St=new Jt.State(0),this._$Si=!1,this._$So=!0,this._$Sh=new Set}_$Sl(){if(this._$Su!==void 0)return;this._$Sv=new Jt.Computed(()=>{this._$St.get(),super.performUpdate()});const e=this._$Su=new Jt.subtle.Watcher(function(){const t=zi.get(this);t!==void 0&&(t._$Si===!1&&t.requestUpdate(),this.watch())});zi.set(e,this),Va.register(this,{watcher:e,signal:this._$Sv}),e.watch(this._$Sv)}_$Sp(){this._$Su!==void 0&&(this._$Su.unwatch(this._$Sv),this._$Sv=void 0,this._$Su=void 0)}performUpdate(){this.isUpdatePending&&(this._$Sl(),this._$Si=!0,this._$St.set(this._$St.get()+1),this._$Si=!1,this._$Sv.get())}update(e){try{this._$So?(this._$So=!1,super.update(e)):this._$Sh.forEach(t=>t.commit())}finally{this.isUpdatePending=!1,this._$Sh.clear()}}requestUpdate(e,t,i){this._$So=!0,super.requestUpdate(e,t,i)}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask(()=>{this.isConnected===!1&&this._$Sp()})}_(e){this._$Sh.add(e);const t=this._$So;this.requestUpdate(),this._$So=t}m(e){this._$Sh.delete(e)}}}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */Jt.State;Jt.Computed;const Or=(n,e)=>new Jt.State(n,e),Nn="app-toolbars-main",Pr="app-toolbars-main-right",Ka="app-toolbars-main-center",Qn="app-toolbars-bottom",ys="app-toolbars-bottom-center",bs="app-toolbars-bottom-end",ws="editor-area-main",Is="app-tabs-right",pi="app-tabs-left-start",xs="app-tabs-left-end",ks="app-tabs-editing-left",Ss="app-tabs-editing-right",Ln="perspectives-main",an="system.views",on="events/contributionregistry/contributionsChanged";class Ha{constructor(){this.contributions=new Map}registerContribution(e,t){const i=this.getContributions(e);if(t.disabled instanceof Function){const a=t.disabled;t.disabled=new Jt.Computed(a)}i.push(t),sr(on,this.contributions)}getContributions(e){return this.contributions.has(e)||this.contributions.set(e,[]),this.contributions.get(e)}getView(e){return this.getContributions(an).find(i=>i.name===e)}}const Me=new Ha;lr.put("contributionRegistry",Me);class Ja{constructor(e,t,i,a,u){this.id=e,this.name=t,this.description=i,this.parameters=a||[],this.output=u||[]}}class As{async execute(e,t){return Je.execute(e,t)}async undo(){}async redo(){}}class Ya{constructor(){this.commands={},this.handlers=new Map}registerHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}getHandler(e){return this.handlers.get(e)}execute(e,t={}){const i=this.getHandler(e);if(!i)throw new Error(`No handlers registered for command: ${e}`);for(const a of i)if(a.canExecute===void 0||a.canExecute(t))return a.execute(t);throw new Error(`Registered handlers could not match execution of command: ${e}`)}createAndRegisterCommand(e,t,i,a,u){const o=new Ja(e,t,i,a);this.registerCommand(o),u&&this.registerHandler(e,u)}registerCommand(e){this.commands[e.id]=e,Ut.info(`Command registered: ${e.id}`)}hasCommand(e){return e in this.commands}listCommands(e){return e?Object.values(this.commands).filter(t=>(Je.getHandler(t.id)||[]).some(a=>a.canExecute===void 0||a.canExecute(e))).reduce((t,i)=>(t[i.id]=i,t),{}):this.commands}getCommand(e){return this.commands[e]}registerAll(e){const t=e.command.id;this.registerCommand(e.command),e.handler&&this.registerHandler(t,e.handler),e.contribution&&e.contribution.target&&Me.registerContribution(e.contribution.target,{command:t,...e.contribution})}}const Je=new Ya;lr.put("commandRegistry",Je);const dt=n=>{Je.registerAll(n)};class Za{constructor(){this.bindings=new Map,this.enabled=!0,document.addEventListener("keydown",this.handleKeyDown.bind(this),!0),this.registerExistingCommandBindings(),this.watchCommandRegistry(),Ut.info("KeyBindingManager initialized")}registerExistingCommandBindings(){const e=Je.listCommands();Object.values(e).forEach(t=>{t.keyBinding&&this.registerKeyBinding(t.id,t.keyBinding)})}watchCommandRegistry(){const e=Je.registerCommand.bind(Je);Je.registerCommand=t=>{e(t),t.keyBinding&&this.registerKeyBinding(t.id,t.keyBinding)}}parseKeyBinding(e){if(!e||e.trim()==="")return null;const t=e.toUpperCase().split("+").map(o=>o.trim());if(t.length===0)return null;const i={ctrl:!1,alt:!1,shift:!1,meta:!1},a=t[t.length-1],u=t.slice(0,-1);for(const o of u)switch(o){case"CTRL":case"CONTROL":i.ctrl=!0;break;case"ALT":case"OPTION":i.alt=!0;break;case"SHIFT":i.shift=!0;break;case"META":case"CMD":case"COMMAND":case"WIN":case"WINDOWS":i.meta=!0;break;default:Ut.warn(`Unknown modifier: ${o}`)}return i.key=this.normalizeKey(a),i}normalizeKey(e){return{SPACE:" ",ESC:"ESCAPE",RETURN:"ENTER",LEFT:"ARROWLEFT",RIGHT:"ARROWRIGHT",UP:"ARROWUP",DOWN:"ARROWDOWN",DEL:"DELETE",INS:"INSERT",PAGEUP:"PAGEUP",PAGEDOWN:"PAGEDOWN"}[e]||e}getBindingKey(e){const t=[];return e.ctrl&&t.push("ctrl"),e.alt&&t.push("alt"),e.shift&&t.push("shift"),e.meta&&t.push("meta"),t.sort(),`${t.join("+")}+${e.key.toUpperCase()}`}registerKeyBinding(e,t){const i=this.parseKeyBinding(t);if(!i)return Ut.warn(`Invalid key binding: ${t}`),!1;i.commandId=e;const a=this.getBindingKey(i);this.bindings.has(a)||this.bindings.set(a,[]);const u=this.bindings.get(a);return u.find(m=>m.commandId===e)?(Ut.warn(`Key binding ${t} already registered for command ${e}`),!1):(u.push(i),Ut.info(`Key binding registered: ${t} -> ${e}`),!0)}unregisterKeyBinding(e,t){if(t){const i=this.parseKeyBinding(t);if(i){const a=this.getBindingKey(i),u=this.bindings.get(a);if(u){const o=u.filter(m=>m.commandId!==e);o.length===0?this.bindings.delete(a):this.bindings.set(a,o)}}}else for(const[i,a]of this.bindings.entries()){const u=a.filter(o=>o.commandId!==e);u.length===0?this.bindings.delete(i):this.bindings.set(i,u)}}getKeyBindingsForCommand(e){const t=[];for(const i of this.bindings.values())for(const a of i)a.commandId===e&&t.push(this.formatKeyBinding(a));return t}formatKeyBinding(e){const t=[];e.ctrl&&t.push("Ctrl"),e.alt&&t.push("Alt"),e.shift&&t.push("Shift"),e.meta&&t.push("Cmd");let i=e.key;return i.length===1?i=i.toUpperCase():i=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase(),t.push(i),t.join("+")}handleKeyDown(e){if(!this.enabled)return;const t=e.target;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)){const o=e.key.toUpperCase();if(!((e.ctrlKey||e.metaKey)&&e.shiftKey&&o==="P"))return}const i={commandId:"",key:this.normalizeKey(e.key.toUpperCase()),ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},a=this.getBindingKey(i),u=this.bindings.get(a);if(u&&u.length>0){const o=u[0];try{e.preventDefault(),e.stopPropagation();const m={source:"keybinding",params:{}};Je.execute(o.commandId,m),Ut.info(`Executed command via key binding: ${o.commandId}`)}catch(m){Ut.error(`Failed to execute command ${o.commandId}: ${m.message}`)}}}setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}getAllBindings(){return new Map(this.bindings)}clearAll(){this.bindings.clear()}}const Qa=new Za;lr.put("keyBindingManager",Qa);var xn={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */var Xa=xn.exports,ji;function eo(){return ji||(ji=1,function(n){(function(e,t){n.exports?n.exports=t():e.Toastify=t()})(Xa,function(e){var t=function(o){return new t.lib.init(o)},i="1.12.0";t.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},t.lib=t.prototype={toastify:i,constructor:t,init:function(o){return o||(o={}),this.options={},this.toastElement=null,this.options.text=o.text||t.defaults.text,this.options.node=o.node||t.defaults.node,this.options.duration=o.duration===0?0:o.duration||t.defaults.duration,this.options.selector=o.selector||t.defaults.selector,this.options.callback=o.callback||t.defaults.callback,this.options.destination=o.destination||t.defaults.destination,this.options.newWindow=o.newWindow||t.defaults.newWindow,this.options.close=o.close||t.defaults.close,this.options.gravity=o.gravity==="bottom"?"toastify-bottom":t.defaults.gravity,this.options.positionLeft=o.positionLeft||t.defaults.positionLeft,this.options.position=o.position||t.defaults.position,this.options.backgroundColor=o.backgroundColor||t.defaults.backgroundColor,this.options.avatar=o.avatar||t.defaults.avatar,this.options.className=o.className||t.defaults.className,this.options.stopOnFocus=o.stopOnFocus===void 0?t.defaults.stopOnFocus:o.stopOnFocus,this.options.onClick=o.onClick||t.defaults.onClick,this.options.offset=o.offset||t.defaults.offset,this.options.escapeMarkup=o.escapeMarkup!==void 0?o.escapeMarkup:t.defaults.escapeMarkup,this.options.ariaLive=o.ariaLive||t.defaults.ariaLive,this.options.style=o.style||t.defaults.style,o.backgroundColor&&(this.options.style.background=o.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var o=document.createElement("div");o.className="toastify on "+this.options.className,this.options.position?o.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(o.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):o.className+=" toastify-right",o.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var m in this.options.style)o.style[m]=this.options.style[m];if(this.options.ariaLive&&o.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)o.appendChild(this.options.node);else if(this.options.escapeMarkup?o.innerText=this.options.text:o.innerHTML=this.options.text,this.options.avatar!==""){var E=document.createElement("img");E.src=this.options.avatar,E.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?o.appendChild(E):o.insertAdjacentElement("afterbegin",E)}if(this.options.close===!0){var x=document.createElement("button");x.type="button",x.setAttribute("aria-label","Close"),x.className="toast-close",x.innerHTML="&#10006;",x.addEventListener("click",(function(we){we.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}).bind(this));var C=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&C>360?o.insertAdjacentElement("afterbegin",x):o.appendChild(x)}if(this.options.stopOnFocus&&this.options.duration>0){var O=this;o.addEventListener("mouseover",function(we){window.clearTimeout(o.timeOutValue)}),o.addEventListener("mouseleave",function(){o.timeOutValue=window.setTimeout(function(){O.removeElement(o)},O.options.duration)})}if(typeof this.options.destination<"u"&&o.addEventListener("click",(function(we){we.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}).bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&o.addEventListener("click",(function(we){we.stopPropagation(),this.options.onClick()}).bind(this)),typeof this.options.offset=="object"){var w=a("x",this.options),T=a("y",this.options),j=this.options.position=="left"?w:"-"+w,te=this.options.gravity=="toastify-top"?T:"-"+T;o.style.transform="translate("+j+","+te+")"}return o},showToast:function(){this.toastElement=this.buildToast();var o;if(typeof this.options.selector=="string"?o=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?o=this.options.selector:o=document.body,!o)throw"Root element is not defined";var m=t.defaults.oldestFirst?o.firstChild:o.lastChild;return o.insertBefore(this.toastElement,m),t.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((function(){this.removeElement(this.toastElement)}).bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(o){o.className=o.className.replace(" on",""),window.setTimeout((function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),o.parentNode&&o.parentNode.removeChild(o),this.options.callback.call(o),t.reposition()}).bind(this),400)}},t.reposition=function(){for(var o={top:15,bottom:15},m={top:15,bottom:15},E={top:15,bottom:15},x=document.getElementsByClassName("toastify"),C,O=0;O<x.length;O++){u(x[O],"toastify-top")===!0?C="toastify-top":C="toastify-bottom";var w=x[O].offsetHeight;C=C.substr(9,C.length-1);var T=15,j=window.innerWidth>0?window.innerWidth:screen.width;j<=360?(x[O].style[C]=E[C]+"px",E[C]+=w+T):u(x[O],"toastify-left")===!0?(x[O].style[C]=o[C]+"px",o[C]+=w+T):(x[O].style[C]=m[C]+"px",m[C]+=w+T)}return this};function a(o,m){return m.offset[o]?isNaN(m.offset[o])?m.offset[o]:m.offset[o]+"px":"0px"}function u(o,m){return!o||typeof m!="string"?!1:!!(o.className&&o.className.trim().split(/\s+/gi).indexOf(m)>-1)}return t.lib.init.prototype=t.lib,t})}(xn)),xn.exports}var to=eo();const di=ss(to),hr=n=>{console.info(n),di({text:n,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0}).showToast()},ct=n=>{console.error(n),di({text:n,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0,style:{background:"coral"}}).showToast()},ro=n=>{console.warn(n),di({text:n,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0,style:{background:"orange"}}).showToast()};sn.put("toastInfo",hr);sn.put("toastError",ct);sn.put("toastWarning",ro);const _s=(n,e)=>{const t=new Jt.subtle.Watcher(async()=>{try{await 0,e(n.get())}finally{t.watch()}});t.watch(n)},hi=n=>function(e,t,i){const a=i.value;return a.signal=n,i};Object.defineProperty(as.prototype,"model",{enumerable:!0,configurable:!0,writable:!0});class Dn extends as{connectedCallback(){const e=Object.getPrototypeOf(this);Object.getOwnPropertyNames(e).forEach(t=>{const i=e[t];if(i instanceof Function){const a=i;a.name.startsWith("on")&&"topic"in a&&this.subscribe(a.topic,a)}}),Object.getOwnPropertyNames(e).forEach(t=>{const i=e[t];if(i instanceof Function){const a=i;a.name.startsWith("on")&&"signal"in a&&this.watch(a.signal,a)}}),super.connectedCallback(),this.doBeforeUI()}subscribe(e,t){Zt(e,t.bind(this))}showInfo(e){hr(e)}showError(e){ct(e)}nobubble(e){return t=>{t.stopPropagation(),e.bind(this)(t)}}command(e,t={}){return()=>{this.executeCommand(e,t)}}executeCommand(e,t){const i={source:this,params:t};Je.execute(e,i)}watch(e,t){_s(e,t.bind(this))}firstUpdated(e){super.firstUpdated(e),this.doInitUI()}updateIdle(){requestIdleCallback(()=>this.requestUpdate())}updateLater(){requestAnimationFrame(()=>this.requestUpdate())}doBeforeUI(){}doInitUI(){}withRefresh(e){e(),this.updateLater()}}class jr extends Dn{}var no=Object.getOwnPropertyDescriptor,io=(n,e,t,i)=>{for(var a=i>1?void 0:i?no(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=o(a)||a);return a};let Xn=class extends jr{render(){return fe`
            <slot></slot>
        `}};Xn.styles=Mt`
        :host {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            width: 100%;
            box-sizing: border-box;
        }
    `;Xn=io([wt("k-app")],Xn);var so=Object.defineProperty,ao=Object.getOwnPropertyDescriptor,fi=(n,e,t,i)=>{for(var a=i>1?void 0:i?ao(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&so(e,t,a),a};let en=class extends vs(jr){constructor(){super(...arguments),this.position="start",this.contributions=[]}doInitUI(){if(this.getAttribute("id")){const n=this.getAttribute("id");this.contributions=Me.getContributions(n)}Zt(on,()=>{this.requestUpdate()})}contributionCreator(n){var e;if("command"in n){const t=n;return fe`
                <wa-button @click=${this.command(t.command)}
                           title=${t.label}
                           ?disabled="${(e=t.disabled)==null?void 0:e.get()}"
                           appearance="plain" size="small">
                    <wa-icon name=${t.icon}></wa-icon>
                </wa-button>
            `}else if("html"in n){const t=n.html;return t instanceof Function?t():os(t)}else return fe`<span>unknown contribution type: ${typeof n}</span>`}render(){return fe`
            <div class="toolbar-items" style=${la({"justify-content":this.position})}>
                <slot name="start">
                    ${this.contributions.filter(n=>n.slot==="start").map(this.contributionCreator.bind(this))}
                </slot>
                ${this.contributions.filter(n=>n.slot===void 0).map(this.contributionCreator.bind(this))}
                <slot>
                </slot>
                <slot name="end">
                    ${this.contributions.filter(n=>n.slot==="end").map(this.contributionCreator.bind(this))}
                </slot>
            </div>
        `}};en.styles=Mt`
        :host {
            display: flex;
            flex-direction: row;
        }

        .toolbar-items {
            display: flex;
            flex: 1;
        }
    `;fi([Wt()],en.prototype,"position",2);fi([Ct()],en.prototype,"contributions",2);en=fi([wt("k-toolbar")],en);class mi extends jr{}const gi=n=>{n&&(n.style.height="100%",new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting?n.style.maxHeight=`${t.intersectionRect.height}px`:n.style.maxHeight="none"})}).observe(n))},ar=n=>{if(!n)return"";const e=n.trim().split(/ +/),t=e.pop(),i=e.pop();return fe`
        <wa-icon library="${i||dr}" name="${t}"></wa-icon>`};class oo{constructor(){this.instances=new Map}getInstanceKey(e,t){return e.singleton??!0?e.name:`${t}-${e.name}`}getInstance(e){return this.instances.get(e)}createInstance(e,t){const i={element:document.createElement("div"),contribution:t,currentContainer:void 0};return this.instances.set(e,i),i}getOrCreateInstance(e,t){const i=this.getInstance(e);return i||this.createInstance(e,t)}moveToContainer(e,t){const i=this.getInstance(e);i&&(i.currentContainer=t)}releaseInstance(e){const t=this.instances.get(e);t&&(t.currentContainer=void 0)}removeInstance(e){const t=this.instances.get(e);t&&t.element.parentElement&&t.element.remove(),this.instances.delete(e)}}const nr=new oo;var lo=Object.defineProperty,co=Object.getOwnPropertyDescriptor,Es=(n,e,t,i)=>{for(var a=i>1?void 0:i?co(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&lo(e,t,a),a};let Sn=class extends mi{constructor(){super(...arguments),this.contributions=[],this.tabGroup=Er(),this.containerId=null}doInitUI(){if(this.containerId=this.getAttribute("id"),!this.containerId)throw new Error("k-tabs requires an 'id' attribute to function");this.loadAndResolveContributions(),this.updateComplete.then(()=>{this.activateNextAvailableTab(),this.tabGroup.value&&this.tabGroup.value.addEventListener("wa-tab-show",n=>{const e=this.getTabPanel(n.detail.name);this.dispatchEvent(new CustomEvent("tab-shown",{detail:e}))})}),Zt(on,()=>{this.containerId&&(this.loadAndResolveContributions(),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()}))})}updated(n){super.updated(n),n.has("contributions")&&(!this.containerId||!this.tabGroup.value||this.contributions.forEach(e=>{this.manageTabInstance(e)}))}has(n){return!!this.getTabPanel(n)}activate(n){this.tabGroup.value.setAttribute("active",n)}getActiveEditor(){return this.tabGroup.value.getAttribute("active")}open(n){if(this.contributions.find(t=>t.name===n.name)){this.activate(n.name);return}this.contributions.push(n),this.requestUpdate(),this.updateComplete.then(()=>{if(n.noOverflow!==!1){const t=this.getTabPanel(n.name);t&&gi(t)}this.activate(n.name)})}closeTab(n,e){if(n.stopPropagation(),this.isDirty(e)&&!confirm("Unsaved changes will be lost: Do you really want to close?"))return;const t=n.currentTarget.parentElement;if(!t)return;t.remove();const i=this.getTabPanel(e);if(!i)return;const a=this.contributions.find(u=>u.name===e);if(a&&this.containerId){this.cleanupTabInstance(a,i);const u=this.contributions.indexOf(a);u>-1&&this.contributions.splice(u,1)}this.dispatchEvent(new CustomEvent("tab-closed",{detail:i})),i.remove(),this.requestUpdate(),this.activateNextAvailableTab()}markDirty(n,e){this.getTab(n).classList.toggle("part-dirty",e)}isDirty(n){return this.getTab(n).classList.contains("part-dirty")}loadAndResolveContributions(){const n=Me.getContributions(this.containerId);this.contributions=n.map(e=>{if(e.view){const t=Me.getView(e.view);if(t)return{...t,...e,name:e.name||t.name}}return e}),this.requestUpdate()}manageTabInstance(n){const e=nr.getInstanceKey(n,this.containerId);let t=nr.getInstance(e);const i=this.getTabPanel(n.name);if(!i)return;const a=i.querySelector(".tab-content");if(a)if(t)t.element&&!a.contains(t.element)&&(a.appendChild(t.element),t.element.style.display="","requestUpdate"in t.element&&typeof t.element.requestUpdate=="function"&&t.element.requestUpdate()),nr.moveToContainer(e,this.containerId);else{const u=a.firstElementChild;u&&(t=nr.createInstance(e,n),t.element=u,nr.moveToContainer(e,this.containerId))}}cleanupTabInstance(n,e){const t=nr.getInstanceKey(n,this.containerId),i=e.querySelector(".tab-content");if(i&&i.firstElementChild){const a=i.firstElementChild;"close"in a&&typeof a.close=="function"&&a.close()}nr.removeInstance(t)}activateNextAvailableTab(){if(!this.tabGroup.value)return;const n=this.tabGroup.value.querySelectorAll("wa-tab");if(n.length>0){const e=n.item(0).getAttribute("panel");e&&this.tabGroup.value.setAttribute("active",e)}else this.tabGroup.value.removeAttribute("active")}getTabPanel(n){return this.tabGroup.value.querySelector(`wa-tab-panel[name='${n}']`)}getTab(n){return this.tabGroup.value.querySelector(`wa-tab[panel='${n}']`)}render(){const n=this.containerId||"";return fe`
            <wa-tab-group ${Cr(this.tabGroup)}>
                ${this.contributions.map(e=>{const t=nr.getInstanceKey(e,n),i=nr.getInstance(t);return fe`
                    <wa-tab panel="${e.name}">
                        ${ar(e.icon)}
                        ${e.label}
                        ${Ht(e.closable,()=>fe`
                            <wa-button for="${e.name}" tabindex="-1" title="Close Tab" appearance="plain" size="small"
                                       @click="${a=>this.closeTab(a,e.name)}">
                                <wa-icon name="xmark"></wa-icon>
                            </wa-button>
                        `)}
                    </wa-tab>
                    <wa-tab-panel name="${e.name}">
                        <k-toolbar id="toolbar.${e.name}" class="tab-toolbar"></k-toolbar>
                            <div class="tab-content" style="height: 100%; width: 100%;">
                                ${i?dr:e.component?e.component(e.name):dr}
                            </div>
                    </wa-tab-panel>
                    `})}
            </wa-tab-group>
        `}};Sn.styles=Mt`
        :host {
            height: 100%;
            width: 100%;
        }

        wa-tab-group {
            height: 100%;
            width: 100%;
        }

        wa-tab::part(base) {
            padding: 3px 0.5rem;
        }

        wa-tab-group::part(base) {
            display: grid;
            grid-template-rows: auto minmax(0, 1fr);
            height: 100%;
            width: 100%;
        }

        wa-tab-panel[active] {
            display: grid;
            grid-template-rows: minmax(0, 1fr);
            height: 100%;
            width: 100%;
        }

        wa-tab-panel {
            --padding: 0px;
        }

        .part-dirty::part(base) {
            font-style: italic;
            color: var(--wa-color-danger-fill-loud)
        }
    `;Es([Ct()],Sn.prototype,"contributions",2);Sn=Es([wt("k-tabs")],Sn);var uo=Object.defineProperty,po=Object.getOwnPropertyDescriptor,ln=(n,e,t,i)=>{for(var a=i>1?void 0:i?po(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&uo(e,t,a),a};let $r=class extends jr{constructor(){super(...arguments),this.orientation="horizontal",this.gridSizes=[],this.gridChildren=[],this.resizing=null,this.childrenLoaded=!1,this.handleResize=n=>{if(!this.resizing)return;const t=(this.orientation==="horizontal"?n.clientX:n.clientY)-this.resizing.startPos,i=[...this.resizing.startSizes];i[this.resizing.handleIndex]+=t,i[this.resizing.handleIndex+1]-=t;const a=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,u=a*.05;i[this.resizing.handleIndex]>=u&&i[this.resizing.handleIndex+1]>=u&&(this.gridSizes=i.map(o=>`${(o/a*100).toFixed(2)}%`),this.requestUpdate())},this.stopResize=()=>{this.resizing=null,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.body.style.cursor="",document.body.style.userSelect=""}}createRenderRoot(){return this}doInitUI(){this.childrenLoaded||(this.mutationObserver=new MutationObserver(()=>{this.childrenLoaded||this.loadChildren()}),this.mutationObserver.observe(this,{childList:!0,subtree:!1}),this.loadChildren())}loadChildren(){const n=Array.from(this.children).filter(e=>e.tagName!=="STYLE"&&e.tagName!=="SCRIPT"&&!e.classList.contains("resize-handle"));if(n.length!==0){if(this.childrenLoaded=!0,this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.gridChildren=n,this.sizes)this.gridSizes=this.sizes.split(",").map(e=>e.trim());else{const e=`${100/this.gridChildren.length}%`;this.gridSizes=this.gridChildren.map(()=>e)}this.requestUpdate()}}updated(n){super.updated(n),!(!n.has("gridChildren")&&!n.has("gridSizes"))&&this.gridChildren.forEach((e,t)=>{e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",e.style.gridColumn=this.orientation==="horizontal"?`${t*2+1}`:"1",e.style.gridRow=this.orientation==="vertical"?`${t*2+1}`:"1",e.style.display="flex",e.style.flexDirection="column"})}startResize(n,e){if(n.preventDefault(),e>=this.gridChildren.length-1)return;const t=this.orientation==="horizontal"?n.clientX:n.clientY,i=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,a=this.gridSizes.map(u=>u.endsWith("%")?parseFloat(u)/100*i:(u.endsWith("px"),parseFloat(u)));this.resizing={handleIndex:e,startPos:t,startSizes:a},document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"}render(){if(this.gridChildren.length===0||this.gridSizes.length===0)return dr;const n=this.gridSizes.flatMap((e,t)=>t===this.gridSizes.length-1?[e]:[e,"4px"]).join(" ");return this.style.display="grid",this.orientation==="horizontal"?(this.style.gridTemplateColumns=n,this.style.gridTemplateRows="100%"):(this.style.gridTemplateColumns="100%",this.style.gridTemplateRows=n),this.style.overflow="hidden",fe`
            ${this.gridChildren.map((e,t)=>{if(t<this.gridChildren.length-1){const i=this.orientation==="horizontal"?`${t*2+2}`:"1",a=this.orientation==="vertical"?`${t*2+2}`:"1";return fe`
                        <div 
                            class="resize-handle"
                            style="
                                background-color: var(--wa-color-neutral-border-subtle, rgba(128, 128, 128, 0.2));
                                cursor: ${this.orientation==="horizontal"?"col-resize":"row-resize"};
                                position: relative;
                                z-index: 10;
                                grid-column: ${i};
                                grid-row: ${a};
                            "
                            @mousedown=${u=>this.startResize(u,t)}
                            @mouseenter=${u=>{u.target.style.backgroundColor="var(--wa-color-primary-fill, rgba(0, 102, 204, 0.4))"}}
                            @mouseleave=${u=>{u.target.style.backgroundColor="var(--wa-color-neutral-border-subtle, rgba(128, 128, 128, 0.2))"}}
                        ></div>
                    `}return dr})}
        `}disconnectedCallback(){super.disconnectedCallback(),this.resizing&&this.stopResize(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}connectedCallback(){super.connectedCallback(),this.style.height="100%",this.style.width="100%"}};ln([Wt()],$r.prototype,"orientation",2);ln([Wt()],$r.prototype,"sizes",2);ln([Ct()],$r.prototype,"gridSizes",2);ln([Ct()],$r.prototype,"gridChildren",2);$r=ln([wt("k-resizable-grid")],$r);const ho={},mt=Or(null),ei=Or(null),ti=Or(null),Ar=Or(0),Fr=Or(void 0),fo=Or({name:"",timestamp:0});var mo=Object.defineProperty,go=Object.getOwnPropertyDescriptor,vi=(n,e,t,i)=>{for(var a=i>1?void 0:i?go(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&mo(e,t,a),a};let An=class extends mi{constructor(){super(...arguments),this.contributions=[],this.activePerspective="",this.containerId=null,this.containerRef=Er(),this.perspectiveElements=new Map}createRenderRoot(){return this}doBeforeUI(){if(!this.editorArea){this.editorArea=document.createElement("k-tabs");const n=this.getAttribute("editor-id")||"editor-area-main";this.editorArea.id=n}}doInitUI(){this.containerId=this.getAttribute("id"),this.containerId&&(this.contributions=Me.getContributions(this.containerId),this.contributions.length>0&&!this.activePerspective&&(this.activePerspective=this.contributions[0].name),Zt(on,()=>{this.containerId&&(this.contributions=Me.getContributions(this.containerId),this.contributions.length>0&&!this.activePerspective&&(this.activePerspective=this.contributions[0].name),this.requestUpdate())}))}updated(n){super.updated(n),(n.has("contributions")||n.has("activePerspective"))&&this.updatePerspectiveVisibility()}switchPerspective(n){const e=this.containerRef.value;if(e){const t=this.contributions.find(i=>i.name===n);t&&!this.perspectiveElements.has(n)&&this.renderPerspective(t,e)}this.activePerspective=n,fo.set({name:n,timestamp:Date.now()}),this.dispatchEvent(new CustomEvent("perspective-switched",{detail:{name:n}}))}getActivePerspective(){return this.activePerspective}getPerspectives(){return this.contributions}addPerspective(n){this.contributions.push(n),this.requestUpdate(),this.activePerspective||(this.activePerspective=n.name)}updatePerspectiveVisibility(){const n=this.containerRef.value;if(!n)return;const e=this.activePerspective&&!this.perspectiveElements.has(this.activePerspective);if(e){const t=this.contributions.find(i=>i.name===this.activePerspective);t&&this.renderPerspective(t,n)}if(!e&&this.activePerspective&&this.editorArea){const t=this.perspectiveElements.get(this.activePerspective);if(t&&!t.contains(this.editorArea)){const i=t.querySelector("k-resizable-grid");if(i){const a=Array.from(i.children).filter(u=>!u.hasAttribute("data-resize-handle"));a.length>=2&&a[0].insertAdjacentElement("afterend",this.editorArea)}}}this.perspectiveElements.forEach((t,i)=>{const a=i===this.activePerspective;t.style.display=a?"flex":"none",a&&!e&&requestAnimationFrame(()=>{t.querySelectorAll("k-tabs").forEach(o=>{"contributions"in o&&Array.isArray(o.contributions)&&(o.contributions=[...o.contributions])})})})}renderPerspective(n,e){const t=document.createElement("div");t.className="perspective-content",t.setAttribute("data-perspective",n.name),t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",t.style.width="100%",e.appendChild(t),this.perspectiveElements.set(n.name,t);const i=n.component(this.editorArea);ls(i,t),this.updateComplete.then(()=>{t.querySelectorAll("k-tabs").forEach(u=>{"requestUpdate"in u&&typeof u.requestUpdate=="function"&&u.requestUpdate()})})}render(){return fe`
            <div class="perspectives-container" ${Cr(this.containerRef)} style="display: flex; flex-direction: column; height: 100%; width: 100%;">
            </div>
        `}connectedCallback(){super.connectedCallback(),this.style.display="flex",this.style.flexDirection="column",this.style.height="100%",this.style.width="100%"}};vi([Ct()],An.prototype,"contributions",2);vi([Ct()],An.prototype,"activePerspective",2);An=vi([wt("k-perspectives")],An);var vo=Object.defineProperty,yo=(n,e,t,i)=>{for(var a=void 0,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=o(e,t,a)||a);return a&&vo(e,t,a),a};class Yt extends mi{constructor(){super(...arguments),this.dirty=!1}getCommandStack(){return this.commandStack}updated(e){super.updated(e),e.has("dirty")&&e.get("dirty")!==void 0&&this.dispatchEvent(new CustomEvent("dirty",{detail:this.dirty,bubbles:!0}))}doClose(){}disconnectedCallback(){super.disconnectedCallback()}close(){this.doClose()}connectedCallback(){super.connectedCallback(),this.parentElement.addEventListener("click",e=>{mt.set(this)})}save(){}isDirty(){return this.dirty}markDirty(e){this.dirty=e,ti.set(null),ti.set(this),mt.set(null),mt.set(this)}registerToolbarContribution(e){const t=this.getAttribute("id");if(!t)return;const i=`toolbar.${t}`;Me.registerContribution(i,{...e,target:i})}}yo([Wt()],Yt.prototype,"dirty");const bo=(n,e)=>!n.leaf&&e.leaf?-1:n.leaf&&!e.leaf?1:n.label.localeCompare(e.label);var wo=Object.defineProperty,Io=Object.getOwnPropertyDescriptor,Mn=(n,e,t,i)=>{for(var a=i>1?void 0:i?Io(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&wo(e,t,a),a};let qr=class extends Yt{constructor(){super(...arguments),this.treeRef=Er()}async doInitUI(){const n=await Tt.getWorkspace();n?await this.loadWorkspace(n):Je.execute("help"),this.registerToolbarActions()}registerToolbarActions(){this.registerToolbarContribution({label:"Load workspace folder",icon:"folder-open",command:"load_workspace",slot:"start"}),this.registerToolbarContribution({label:"Reload workspace folder",icon:"repeat",command:"reload_workspace",slot:"start"}),this.registerToolbarContribution({label:"Create new file...",icon:"plus",command:"create_file",slot:"start"}),this.registerToolbarContribution({label:"Delete selected resource",icon:"trash",command:"delete_resource",slot:"start",disabled:()=>!(Fr.get()instanceof ca)})}async onWorkspaceChanged(n){await this.loadWorkspace(n)}async onWorkspaceConnected(n){await this.loadWorkspace(n)}async loadWorkspace(n){this.workspaceDir=n,n?this.root=await this.resourceToTreeNode(n):this.root=void 0}async resourceToTreeNode(n){const e=n instanceof cs,t={data:n,label:n.getName(),icon:e?"file":"folder-open",leaf:e,children:[]};if(n instanceof ua){for(const i of await n.listChildren(!0)){const a=await this.resourceToTreeNode(i);t.children.push(a)}t.children.sort(bo)}return t}createTreeItems(n,e=!1){return n?fe`
            <wa-tree-item @dblclick=${this.nobubble(this.onFileDoubleClicked)} .model=${n} ?expanded=${e}>
                <span><wa-icon name=${n.icon}></wa-icon> ${n.label}</span>
                ${n.children.map(t=>this.createTreeItems(t))}
            </wa-tree-item>`:fe``}async onFileDoubleClicked(n){const t=n.currentTarget.model.data.getWorkspacePath();this.executeCommand("open_editor",{path:t})}onSelectionChanged(n){const e=n.detail.selection[0].model;Fr.set(e.data)}render(){return fe`
            <div class="tree" ${Cr(this.treeRef)}>
                ${Ht(!this.workspaceDir,()=>fe`
                    <k-no-content message="Select a workspace."></k-no-content>`,()=>fe`
                `)}
                <wa-tree @wa-selection-change=${this.nobubble(this.onSelectionChanged)}
                         style="--indent-guide-width: 1px;">
                    ${this.createTreeItems(this.root,!0)}
                </wa-tree>
            </div>
        `}};qr.styles=Mt`
        :host {
        }
    `;Mn([Ct()],qr.prototype,"root",2);Mn([oi(Hr)],qr.prototype,"onWorkspaceChanged",1);Mn([oi(li)],qr.prototype,"onWorkspaceConnected",1);qr=Mn([wt("k-filebrowser")],qr);class xo{constructor(){this.tasks=[]}run(e,t){const i={name:e};try{this.tasks.push(i),Ar.set(this.tasks.length),t(i)}finally{this.tasks.splice(this.tasks.indexOf(i),1),Ar.set(this.tasks.length)}}async runAsync(e,t){const i={name:e};return this.tasks.push(i),Ar.set(this.tasks.length),t(i).finally(()=>{this.tasks.splice(this.tasks.indexOf(i),1),Ar.set(this.tasks.length)})}getActiveTasks(){return this.tasks}}const cn=new xo;lr.put("taskService",cn);var ko=Object.getOwnPropertyDescriptor,So=(n,e,t,i)=>{for(var a=i>1?void 0:i?ko(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=o(a)||a);return a};Me.registerContribution(ys,{html:"<k-tasks></k-tasks>"});let Ui=class extends vs(Yt){render(){if(Ar.get()!=0)return fe`
            <wa-dropdown>
                <div slot="trigger" title="Active tasks: ${Ar.get()}">
                    <wa-animation name="zoomIn" duration="1000" play>
                        <wa-icon name="hourglass" style="color: var(--wa-color-warning-fill-loud)"></wa-icon>
                    </wa-animation>
                    Active tasks: ${Ar.get()}
                </div>
                ${cn.getActiveTasks().map(n=>fe`
                    <wa-dropdown-item>${n.name}: ${n.message}</wa-dropdown-item>
                `)}
            </wa-dropdown>
        `}};Ui=So([wt("k-tasks")],Ui);var Ao=Object.getOwnPropertyDescriptor,_o=(n,e,t,i)=>{for(var a=i>1?void 0:i?Ao(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=o(a)||a);return a};const Bi="<no workspace>";let Wi=class extends jr{constructor(){super(...arguments),this.workspaceName=Bi}doInitUI(){this.updateWorkspaceName(),Zt(li,()=>{this.updateWorkspaceName()})}updateWorkspaceName(){Tt.getWorkspace().then(n=>{this.workspaceName=(n==null?void 0:n.getName())||Bi,this.requestUpdate()})}render(){return fe`
            <span style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.85em; color: var(--wa-color-neutral-text);">
                <wa-icon name="folder-open"></wa-icon>
                <span>${this.workspaceName}</span>
            </span>
        `}};Wi=_o([wt("k-workspace-name")],Wi);function yi(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Tr=yi();function Cs(n){Tr=n}const Qr={exec:()=>null};function je(n,e=""){let t=typeof n=="string"?n:n.source;const i={replace:(a,u)=>{let o=typeof u=="string"?u:u.source;return o=o.replace(Et.caret,"$1"),t=t.replace(a,o),i},getRegex:()=>new RegExp(t,e)};return i}const Et={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},Eo=/^(?:[ \t]*(?:\n|$))+/,Co=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Oo=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,un=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Po=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,bi=/(?:[*+-]|\d{1,9}[.)])/,Os=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ps=je(Os).replace(/bull/g,bi).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),To=je(Os).replace(/bull/g,bi).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),wi=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ro=/^[^\n]+/,Ii=/(?!\s*\])(?:\\.|[^\[\]\\])+/,No=je(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Ii).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Lo=je(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,bi).getRegex(),$n="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",xi=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Do=je("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",xi).replace("tag",$n).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ts=je(wi).replace("hr",un).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",$n).getRegex(),Mo=je(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ts).getRegex(),ki={blockquote:Mo,code:Co,def:No,fences:Oo,heading:Po,hr:un,html:Do,lheading:Ps,list:Lo,newline:Eo,paragraph:Ts,table:Qr,text:Ro},Gi=je("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",un).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",$n).getRegex(),$o={...ki,lheading:To,table:Gi,paragraph:je(wi).replace("hr",un).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Gi).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",$n).getRegex()},Fo={...ki,html:je(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",xi).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Qr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:je(wi).replace("hr",un).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ps).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},qo=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,zo=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Rs=/^( {2,}|\\)\n(?!\s*$)/,jo=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Fn=/[\p{P}\p{S}]/u,Si=/[\s\p{P}\p{S}]/u,Ns=/[^\s\p{P}\p{S}]/u,Uo=je(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Si).getRegex(),Ls=/(?!~)[\p{P}\p{S}]/u,Bo=/(?!~)[\s\p{P}\p{S}]/u,Wo=/(?:[^\s\p{P}\p{S}]|~)/u,Go=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Ds=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Vo=je(Ds,"u").replace(/punct/g,Fn).getRegex(),Ko=je(Ds,"u").replace(/punct/g,Ls).getRegex(),Ms="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ho=je(Ms,"gu").replace(/notPunctSpace/g,Ns).replace(/punctSpace/g,Si).replace(/punct/g,Fn).getRegex(),Jo=je(Ms,"gu").replace(/notPunctSpace/g,Wo).replace(/punctSpace/g,Bo).replace(/punct/g,Ls).getRegex(),Yo=je("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ns).replace(/punctSpace/g,Si).replace(/punct/g,Fn).getRegex(),Zo=je(/\\(punct)/,"gu").replace(/punct/g,Fn).getRegex(),Qo=je(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Xo=je(xi).replace("(?:-->|$)","-->").getRegex(),el=je("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Xo).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_n=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,tl=je(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",_n).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),$s=je(/^!?\[(label)\]\[(ref)\]/).replace("label",_n).replace("ref",Ii).getRegex(),Fs=je(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ii).getRegex(),rl=je("reflink|nolink(?!\\()","g").replace("reflink",$s).replace("nolink",Fs).getRegex(),Ai={_backpedal:Qr,anyPunctuation:Zo,autolink:Qo,blockSkip:Go,br:Rs,code:zo,del:Qr,emStrongLDelim:Vo,emStrongRDelimAst:Ho,emStrongRDelimUnd:Yo,escape:qo,link:tl,nolink:Fs,punctuation:Uo,reflink:$s,reflinkSearch:rl,tag:el,text:jo,url:Qr},nl={...Ai,link:je(/^!?\[(label)\]\((.*?)\)/).replace("label",_n).getRegex(),reflink:je(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_n).getRegex()},ri={...Ai,emStrongRDelimAst:Jo,emStrongLDelim:Ko,url:je(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},il={...ri,br:je(Rs).replace("{2,}","*").getRegex(),text:je(ri.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},mn={normal:ki,gfm:$o,pedantic:Fo},Gr={normal:Ai,gfm:ri,breaks:il,pedantic:nl},sl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Vi=n=>sl[n];function Kt(n,e){if(e){if(Et.escapeTest.test(n))return n.replace(Et.escapeReplace,Vi)}else if(Et.escapeTestNoEncode.test(n))return n.replace(Et.escapeReplaceNoEncode,Vi);return n}function Ki(n){try{n=encodeURI(n).replace(Et.percentDecode,"%")}catch{return null}return n}function Hi(n,e){var u;const t=n.replace(Et.findPipe,(o,m,E)=>{let x=!1,C=m;for(;--C>=0&&E[C]==="\\";)x=!x;return x?"|":" |"}),i=t.split(Et.splitPipe);let a=0;if(i[0].trim()||i.shift(),i.length>0&&!((u=i.at(-1))!=null&&u.trim())&&i.pop(),e)if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;a<i.length;a++)i[a]=i[a].trim().replace(Et.slashPipe,"|");return i}function Vr(n,e,t){const i=n.length;if(i===0)return"";let a=0;for(;a<i&&n.charAt(i-a-1)===e;)a++;return n.slice(0,i-a)}function al(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let i=0;i<n.length;i++)if(n[i]==="\\")i++;else if(n[i]===e[0])t++;else if(n[i]===e[1]&&(t--,t<0))return i;return t>0?-2:-1}function Ji(n,e,t,i,a){const u=e.href,o=e.title||null,m=n[1].replace(a.other.outputLinkReplace,"$1");i.state.inLink=!0;const E={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:u,title:o,text:m,tokens:i.inlineTokens(m)};return i.state.inLink=!1,E}function ol(n,e,t){const i=n.match(t.other.indentCodeCompensation);if(i===null)return e;const a=i[1];return e.split(`
`).map(u=>{const o=u.match(t.other.beginningSpace);if(o===null)return u;const[m]=o;return m.length>=a.length?u.slice(a.length):u}).join(`
`)}class En{constructor(e){He(this,"options");He(this,"rules");He(this,"lexer");this.options=e||Tr}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const i=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?i:Vr(i,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const i=t[0],a=ol(i,t[3]||"",this.rules);return{type:"code",raw:i,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:a}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let i=t[2].trim();if(this.rules.other.endingHash.test(i)){const a=Vr(i,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(i=a.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Vr(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let i=Vr(t[0],`
`).split(`
`),a="",u="";const o=[];for(;i.length>0;){let m=!1;const E=[];let x;for(x=0;x<i.length;x++)if(this.rules.other.blockquoteStart.test(i[x]))E.push(i[x]),m=!0;else if(!m)E.push(i[x]);else break;i=i.slice(x);const C=E.join(`
`),O=C.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${C}`:C,u=u?`${u}
${O}`:O;const w=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(O,o,!0),this.lexer.state.top=w,i.length===0)break;const T=o.at(-1);if((T==null?void 0:T.type)==="code")break;if((T==null?void 0:T.type)==="blockquote"){const j=T,te=j.raw+`
`+i.join(`
`),we=this.blockquote(te);o[o.length-1]=we,a=a.substring(0,a.length-j.raw.length)+we.raw,u=u.substring(0,u.length-j.text.length)+we.text;break}else if((T==null?void 0:T.type)==="list"){const j=T,te=j.raw+`
`+i.join(`
`),we=this.list(te);o[o.length-1]=we,a=a.substring(0,a.length-T.raw.length)+we.raw,u=u.substring(0,u.length-j.raw.length)+we.raw,i=te.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:u}}}list(e){let t=this.rules.block.list.exec(e);if(t){let i=t[1].trim();const a=i.length>1,u={type:"list",raw:"",ordered:a,start:a?+i.slice(0,-1):"",loose:!1,items:[]};i=a?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=a?i:"[*+-]");const o=this.rules.other.listItemRegex(i);let m=!1;for(;e;){let x=!1,C="",O="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;C=t[0],e=e.substring(C.length);let w=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,U=>" ".repeat(3*U.length)),T=e.split(`
`,1)[0],j=!w.trim(),te=0;if(this.options.pedantic?(te=2,O=w.trimStart()):j?te=t[1].length+1:(te=t[2].search(this.rules.other.nonSpaceChar),te=te>4?1:te,O=w.slice(te),te+=t[1].length),j&&this.rules.other.blankLine.test(T)&&(C+=T+`
`,e=e.substring(T.length+1),x=!0),!x){const U=this.rules.other.nextBulletRegex(te),D=this.rules.other.hrRegex(te),B=this.rules.other.fencesBeginRegex(te),N=this.rules.other.headingBeginRegex(te),v=this.rules.other.htmlBeginRegex(te);for(;e;){const F=e.split(`
`,1)[0];let z;if(T=F,this.options.pedantic?(T=T.replace(this.rules.other.listReplaceNesting,"  "),z=T):z=T.replace(this.rules.other.tabCharGlobal,"    "),B.test(T)||N.test(T)||v.test(T)||U.test(T)||D.test(T))break;if(z.search(this.rules.other.nonSpaceChar)>=te||!T.trim())O+=`
`+z.slice(te);else{if(j||w.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||B.test(w)||N.test(w)||D.test(w))break;O+=`
`+T}!j&&!T.trim()&&(j=!0),C+=F+`
`,e=e.substring(F.length+1),w=z.slice(te)}}u.loose||(m?u.loose=!0:this.rules.other.doubleBlankLine.test(C)&&(m=!0));let we=null,Oe;this.options.gfm&&(we=this.rules.other.listIsTask.exec(O),we&&(Oe=we[0]!=="[ ] ",O=O.replace(this.rules.other.listReplaceTask,""))),u.items.push({type:"list_item",raw:C,task:!!we,checked:Oe,loose:!1,text:O,tokens:[]}),u.raw+=C}const E=u.items.at(-1);if(E)E.raw=E.raw.trimEnd(),E.text=E.text.trimEnd();else return;u.raw=u.raw.trimEnd();for(let x=0;x<u.items.length;x++)if(this.lexer.state.top=!1,u.items[x].tokens=this.lexer.blockTokens(u.items[x].text,[]),!u.loose){const C=u.items[x].tokens.filter(w=>w.type==="space"),O=C.length>0&&C.some(w=>this.rules.other.anyLine.test(w.raw));u.loose=O}if(u.loose)for(let x=0;x<u.items.length;x++)u.items[x].loose=!0;return u}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const i=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",u=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:i,raw:t[0],href:a,title:u}}}table(e){var m;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const i=Hi(t[1]),a=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),u=(m=t[3])!=null&&m.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(i.length===a.length){for(const E of a)this.rules.other.tableAlignRight.test(E)?o.align.push("right"):this.rules.other.tableAlignCenter.test(E)?o.align.push("center"):this.rules.other.tableAlignLeft.test(E)?o.align.push("left"):o.align.push(null);for(let E=0;E<i.length;E++)o.header.push({text:i[E],tokens:this.lexer.inline(i[E]),header:!0,align:o.align[E]});for(const E of u)o.rows.push(Hi(E,o.header.length).map((x,C)=>({text:x,tokens:this.lexer.inline(x),header:!1,align:o.align[C]})));return o}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const i=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:i,tokens:this.lexer.inline(i)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const i=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(i)){if(!this.rules.other.endAngleBracket.test(i))return;const o=Vr(i.slice(0,-1),"\\");if((i.length-o.length)%2===0)return}else{const o=al(t[2],"()");if(o===-2)return;if(o>-1){const E=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,E).trim(),t[3]=""}}let a=t[2],u="";if(this.options.pedantic){const o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],u=o[3])}else u=t[3]?t[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(i)?a=a.slice(1):a=a.slice(1,-1)),Ji(t,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:u&&u.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){const a=(i[2]||i[1]).replace(this.rules.other.multipleSpaceGlobal," "),u=t[a.toLowerCase()];if(!u){const o=i[0].charAt(0);return{type:"text",raw:o,text:o}}return Ji(i,u,i[0],this.lexer,this.rules)}}emStrong(e,t,i=""){let a=this.rules.inline.emStrongLDelim.exec(e);if(!a||a[3]&&i.match(this.rules.other.unicodeAlphaNumeric))return;if(!(a[1]||a[2]||"")||!i||this.rules.inline.punctuation.exec(i)){const o=[...a[0]].length-1;let m,E,x=o,C=0;const O=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(O.lastIndex=0,t=t.slice(-1*e.length+o);(a=O.exec(t))!=null;){if(m=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!m)continue;if(E=[...m].length,a[3]||a[4]){x+=E;continue}else if((a[5]||a[6])&&o%3&&!((o+E)%3)){C+=E;continue}if(x-=E,x>0)continue;E=Math.min(E,E+x+C);const w=[...a[0]][0].length,T=e.slice(0,o+a.index+w+E);if(Math.min(o,E)%2){const te=T.slice(1,-1);return{type:"em",raw:T,text:te,tokens:this.lexer.inlineTokens(te)}}const j=T.slice(2,-2);return{type:"strong",raw:T,text:j,tokens:this.lexer.inlineTokens(j)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let i=t[2].replace(this.rules.other.newLineCharGlobal," ");const a=this.rules.other.nonSpaceChar.test(i),u=this.rules.other.startingSpaceChar.test(i)&&this.rules.other.endingSpaceChar.test(i);return a&&u&&(i=i.substring(1,i.length-1)),{type:"codespan",raw:t[0],text:i}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let i,a;return t[2]==="@"?(i=t[1],a="mailto:"+i):(i=t[1],a=i),{type:"link",raw:t[0],text:i,href:a,tokens:[{type:"text",raw:i,text:i}]}}}url(e){var i;let t;if(t=this.rules.inline.url.exec(e)){let a,u;if(t[2]==="@")a=t[0],u="mailto:"+a;else{let o;do o=t[0],t[0]=((i=this.rules.inline._backpedal.exec(t[0]))==null?void 0:i[0])??"";while(o!==t[0]);a=t[0],t[1]==="www."?u="http://"+t[0]:u=t[0]}return{type:"link",raw:t[0],text:a,href:u,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const i=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:i}}}}class Lt{constructor(e){He(this,"tokens");He(this,"options");He(this,"state");He(this,"tokenizer");He(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Tr,this.options.tokenizer=this.options.tokenizer||new En,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:Et,block:mn.normal,inline:Gr.normal};this.options.pedantic?(t.block=mn.pedantic,t.inline=Gr.pedantic):this.options.gfm&&(t.block=mn.gfm,this.options.breaks?t.inline=Gr.breaks:t.inline=Gr.gfm),this.tokenizer.rules=t}static get rules(){return{block:mn,inline:Gr}}static lex(e,t){return new Lt(t).lex(e)}static lexInline(e,t){return new Lt(t).inlineTokens(e)}lex(e){e=e.replace(Et.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const i=this.inlineQueue[t];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],i=!1){var a,u,o;for(this.options.pedantic&&(e=e.replace(Et.tabCharGlobal,"    ").replace(Et.spaceLine,""));e;){let m;if((u=(a=this.options.extensions)==null?void 0:a.block)!=null&&u.some(x=>(m=x.call({lexer:this},e,t))?(e=e.substring(m.raw.length),t.push(m),!0):!1))continue;if(m=this.tokenizer.space(e)){e=e.substring(m.raw.length);const x=t.at(-1);m.raw.length===1&&x!==void 0?x.raw+=`
`:t.push(m);continue}if(m=this.tokenizer.code(e)){e=e.substring(m.raw.length);const x=t.at(-1);(x==null?void 0:x.type)==="paragraph"||(x==null?void 0:x.type)==="text"?(x.raw+=`
`+m.raw,x.text+=`
`+m.text,this.inlineQueue.at(-1).src=x.text):t.push(m);continue}if(m=this.tokenizer.fences(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.heading(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.hr(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.blockquote(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.list(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.html(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.def(e)){e=e.substring(m.raw.length);const x=t.at(-1);(x==null?void 0:x.type)==="paragraph"||(x==null?void 0:x.type)==="text"?(x.raw+=`
`+m.raw,x.text+=`
`+m.raw,this.inlineQueue.at(-1).src=x.text):this.tokens.links[m.tag]||(this.tokens.links[m.tag]={href:m.href,title:m.title});continue}if(m=this.tokenizer.table(e)){e=e.substring(m.raw.length),t.push(m);continue}if(m=this.tokenizer.lheading(e)){e=e.substring(m.raw.length),t.push(m);continue}let E=e;if((o=this.options.extensions)!=null&&o.startBlock){let x=1/0;const C=e.slice(1);let O;this.options.extensions.startBlock.forEach(w=>{O=w.call({lexer:this},C),typeof O=="number"&&O>=0&&(x=Math.min(x,O))}),x<1/0&&x>=0&&(E=e.substring(0,x+1))}if(this.state.top&&(m=this.tokenizer.paragraph(E))){const x=t.at(-1);i&&(x==null?void 0:x.type)==="paragraph"?(x.raw+=`
`+m.raw,x.text+=`
`+m.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=x.text):t.push(m),i=E.length!==e.length,e=e.substring(m.raw.length);continue}if(m=this.tokenizer.text(e)){e=e.substring(m.raw.length);const x=t.at(-1);(x==null?void 0:x.type)==="text"?(x.raw+=`
`+m.raw,x.text+=`
`+m.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=x.text):t.push(m);continue}if(e){const x="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(x);break}else throw new Error(x)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var m,E,x;let i=e,a=null;if(this.tokens.links){const C=Object.keys(this.tokens.links);if(C.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)C.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,a.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)i=i.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let u=!1,o="";for(;e;){u||(o=""),u=!1;let C;if((E=(m=this.options.extensions)==null?void 0:m.inline)!=null&&E.some(w=>(C=w.call({lexer:this},e,t))?(e=e.substring(C.raw.length),t.push(C),!0):!1))continue;if(C=this.tokenizer.escape(e)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.tag(e)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.link(e)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(C.raw.length);const w=t.at(-1);C.type==="text"&&(w==null?void 0:w.type)==="text"?(w.raw+=C.raw,w.text+=C.text):t.push(C);continue}if(C=this.tokenizer.emStrong(e,i,o)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.codespan(e)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.br(e)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.del(e)){e=e.substring(C.raw.length),t.push(C);continue}if(C=this.tokenizer.autolink(e)){e=e.substring(C.raw.length),t.push(C);continue}if(!this.state.inLink&&(C=this.tokenizer.url(e))){e=e.substring(C.raw.length),t.push(C);continue}let O=e;if((x=this.options.extensions)!=null&&x.startInline){let w=1/0;const T=e.slice(1);let j;this.options.extensions.startInline.forEach(te=>{j=te.call({lexer:this},T),typeof j=="number"&&j>=0&&(w=Math.min(w,j))}),w<1/0&&w>=0&&(O=e.substring(0,w+1))}if(C=this.tokenizer.inlineText(O)){e=e.substring(C.raw.length),C.raw.slice(-1)!=="_"&&(o=C.raw.slice(-1)),u=!0;const w=t.at(-1);(w==null?void 0:w.type)==="text"?(w.raw+=C.raw,w.text+=C.text):t.push(C);continue}if(e){const w="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(w);break}else throw new Error(w)}}return t}}class Cn{constructor(e){He(this,"options");He(this,"parser");this.options=e||Tr}space(e){return""}code({text:e,lang:t,escaped:i}){var o;const a=(o=(t||"").match(Et.notSpaceStart))==null?void 0:o[0],u=e.replace(Et.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Kt(a)+'">'+(i?u:Kt(u,!0))+`</code></pre>
`:"<pre><code>"+(i?u:Kt(u,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,i=e.start;let a="";for(let m=0;m<e.items.length;m++){const E=e.items[m];a+=this.listitem(E)}const u=t?"ol":"ul",o=t&&i!==1?' start="'+i+'"':"";return"<"+u+o+`>
`+a+"</"+u+`>
`}listitem(e){var i;let t="";if(e.task){const a=this.checkbox({checked:!!e.checked});e.loose?((i=e.tokens[0])==null?void 0:i.type)==="paragraph"?(e.tokens[0].text=a+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=a+" "+Kt(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:a+" ",text:a+" ",escaped:!0}):t+=a+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",i="";for(let u=0;u<e.header.length;u++)i+=this.tablecell(e.header[u]);t+=this.tablerow({text:i});let a="";for(let u=0;u<e.rows.length;u++){const o=e.rows[u];i="";for(let m=0;m<o.length;m++)i+=this.tablecell(o[m]);a+=this.tablerow({text:i})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+a+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),i=e.header?"th":"td";return(e.align?`<${i} align="${e.align}">`:`<${i}>`)+t+`</${i}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Kt(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:i}){const a=this.parser.parseInline(i),u=Ki(e);if(u===null)return a;e=u;let o='<a href="'+e+'"';return t&&(o+=' title="'+Kt(t)+'"'),o+=">"+a+"</a>",o}image({href:e,title:t,text:i,tokens:a}){a&&(i=this.parser.parseInline(a,this.parser.textRenderer));const u=Ki(e);if(u===null)return Kt(i);e=u;let o=`<img src="${e}" alt="${i}"`;return t&&(o+=` title="${Kt(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Kt(e.text)}}class _i{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class Dt{constructor(e){He(this,"options");He(this,"renderer");He(this,"textRenderer");this.options=e||Tr,this.options.renderer=this.options.renderer||new Cn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new _i}static parse(e,t){return new Dt(t).parse(e)}static parseInline(e,t){return new Dt(t).parseInline(e)}parse(e,t=!0){var a,u;let i="";for(let o=0;o<e.length;o++){const m=e[o];if((u=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&u[m.type]){const x=m,C=this.options.extensions.renderers[x.type].call({parser:this},x);if(C!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(x.type)){i+=C||"";continue}}const E=m;switch(E.type){case"space":{i+=this.renderer.space(E);continue}case"hr":{i+=this.renderer.hr(E);continue}case"heading":{i+=this.renderer.heading(E);continue}case"code":{i+=this.renderer.code(E);continue}case"table":{i+=this.renderer.table(E);continue}case"blockquote":{i+=this.renderer.blockquote(E);continue}case"list":{i+=this.renderer.list(E);continue}case"html":{i+=this.renderer.html(E);continue}case"paragraph":{i+=this.renderer.paragraph(E);continue}case"text":{let x=E,C=this.renderer.text(x);for(;o+1<e.length&&e[o+1].type==="text";)x=e[++o],C+=`
`+this.renderer.text(x);t?i+=this.renderer.paragraph({type:"paragraph",raw:C,text:C,tokens:[{type:"text",raw:C,text:C,escaped:!0}]}):i+=C;continue}default:{const x='Token with "'+E.type+'" type was not found.';if(this.options.silent)return console.error(x),"";throw new Error(x)}}}return i}parseInline(e,t=this.renderer){var a,u;let i="";for(let o=0;o<e.length;o++){const m=e[o];if((u=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&u[m.type]){const x=this.options.extensions.renderers[m.type].call({parser:this},m);if(x!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(m.type)){i+=x||"";continue}}const E=m;switch(E.type){case"escape":{i+=t.text(E);break}case"html":{i+=t.html(E);break}case"link":{i+=t.link(E);break}case"image":{i+=t.image(E);break}case"strong":{i+=t.strong(E);break}case"em":{i+=t.em(E);break}case"codespan":{i+=t.codespan(E);break}case"br":{i+=t.br(E);break}case"del":{i+=t.del(E);break}case"text":{i+=t.text(E);break}default:{const x='Token with "'+E.type+'" type was not found.';if(this.options.silent)return console.error(x),"";throw new Error(x)}}}return i}}class Xr{constructor(e){He(this,"options");He(this,"block");this.options=e||Tr}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Lt.lex:Lt.lexInline}provideParser(){return this.block?Dt.parse:Dt.parseInline}}He(Xr,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class ll{constructor(...e){He(this,"defaults",yi());He(this,"options",this.setOptions);He(this,"parse",this.parseMarkdown(!0));He(this,"parseInline",this.parseMarkdown(!1));He(this,"Parser",Dt);He(this,"Renderer",Cn);He(this,"TextRenderer",_i);He(this,"Lexer",Lt);He(this,"Tokenizer",En);He(this,"Hooks",Xr);this.use(...e)}walkTokens(e,t){var a,u;let i=[];for(const o of e)switch(i=i.concat(t.call(this,o)),o.type){case"table":{const m=o;for(const E of m.header)i=i.concat(this.walkTokens(E.tokens,t));for(const E of m.rows)for(const x of E)i=i.concat(this.walkTokens(x.tokens,t));break}case"list":{const m=o;i=i.concat(this.walkTokens(m.items,t));break}default:{const m=o;(u=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&u[m.type]?this.defaults.extensions.childTokens[m.type].forEach(E=>{const x=m[E].flat(1/0);i=i.concat(this.walkTokens(x,t))}):m.tokens&&(i=i.concat(this.walkTokens(m.tokens,t)))}}return i}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(i=>{const a={...i};if(a.async=this.defaults.async||a.async||!1,i.extensions&&(i.extensions.forEach(u=>{if(!u.name)throw new Error("extension name required");if("renderer"in u){const o=t.renderers[u.name];o?t.renderers[u.name]=function(...m){let E=u.renderer.apply(this,m);return E===!1&&(E=o.apply(this,m)),E}:t.renderers[u.name]=u.renderer}if("tokenizer"in u){if(!u.level||u.level!=="block"&&u.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=t[u.level];o?o.unshift(u.tokenizer):t[u.level]=[u.tokenizer],u.start&&(u.level==="block"?t.startBlock?t.startBlock.push(u.start):t.startBlock=[u.start]:u.level==="inline"&&(t.startInline?t.startInline.push(u.start):t.startInline=[u.start]))}"childTokens"in u&&u.childTokens&&(t.childTokens[u.name]=u.childTokens)}),a.extensions=t),i.renderer){const u=this.defaults.renderer||new Cn(this.defaults);for(const o in i.renderer){if(!(o in u))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;const m=o,E=i.renderer[m],x=u[m];u[m]=(...C)=>{let O=E.apply(u,C);return O===!1&&(O=x.apply(u,C)),O||""}}a.renderer=u}if(i.tokenizer){const u=this.defaults.tokenizer||new En(this.defaults);for(const o in i.tokenizer){if(!(o in u))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const m=o,E=i.tokenizer[m],x=u[m];u[m]=(...C)=>{let O=E.apply(u,C);return O===!1&&(O=x.apply(u,C)),O}}a.tokenizer=u}if(i.hooks){const u=this.defaults.hooks||new Xr;for(const o in i.hooks){if(!(o in u))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;const m=o,E=i.hooks[m],x=u[m];Xr.passThroughHooks.has(o)?u[m]=C=>{if(this.defaults.async)return Promise.resolve(E.call(u,C)).then(w=>x.call(u,w));const O=E.call(u,C);return x.call(u,O)}:u[m]=(...C)=>{let O=E.apply(u,C);return O===!1&&(O=x.apply(u,C)),O}}a.hooks=u}if(i.walkTokens){const u=this.defaults.walkTokens,o=i.walkTokens;a.walkTokens=function(m){let E=[];return E.push(o.call(this,m)),u&&(E=E.concat(u.call(this,m))),E}}this.defaults={...this.defaults,...a}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Lt.lex(e,t??this.defaults)}parser(e,t){return Dt.parse(e,t??this.defaults)}parseMarkdown(e){return(i,a)=>{const u={...a},o={...this.defaults,...u},m=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&u.async===!1)return m(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof i>"u"||i===null)return m(new Error("marked(): input parameter is undefined or null"));if(typeof i!="string")return m(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(i)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=e);const E=o.hooks?o.hooks.provideLexer():e?Lt.lex:Lt.lexInline,x=o.hooks?o.hooks.provideParser():e?Dt.parse:Dt.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(i):i).then(C=>E(C,o)).then(C=>o.hooks?o.hooks.processAllTokens(C):C).then(C=>o.walkTokens?Promise.all(this.walkTokens(C,o.walkTokens)).then(()=>C):C).then(C=>x(C,o)).then(C=>o.hooks?o.hooks.postprocess(C):C).catch(m);try{o.hooks&&(i=o.hooks.preprocess(i));let C=E(i,o);o.hooks&&(C=o.hooks.processAllTokens(C)),o.walkTokens&&this.walkTokens(C,o.walkTokens);let O=x(C,o);return o.hooks&&(O=o.hooks.postprocess(O)),O}catch(C){return m(C)}}}onError(e,t){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const a="<p>An error occurred:</p><pre>"+Kt(i.message+"",!0)+"</pre>";return t?Promise.resolve(a):a}if(t)return Promise.reject(i);throw i}}}const _r=new ll;function Ge(n,e){return _r.parse(n,e)}Ge.options=Ge.setOptions=function(n){return _r.setOptions(n),Ge.defaults=_r.defaults,Cs(Ge.defaults),Ge};Ge.getDefaults=yi;Ge.defaults=Tr;Ge.use=function(...n){return _r.use(...n),Ge.defaults=_r.defaults,Cs(Ge.defaults),Ge};Ge.walkTokens=function(n,e){return _r.walkTokens(n,e)};Ge.parseInline=_r.parseInline;Ge.Parser=Dt;Ge.parser=Dt.parse;Ge.Renderer=Cn;Ge.TextRenderer=_i;Ge.Lexer=Lt;Ge.lexer=Lt.lex;Ge.Tokenizer=En;Ge.Hooks=Xr;Ge.parse=Ge;Ge.options;Ge.setOptions;Ge.use;Ge.walkTokens;Ge.parseInline;Dt.parse;Lt.lex;var ir={},jt={},Yi;function cl(){if(Yi)return jt;Yi=1,Object.defineProperty(jt,"__esModule",{value:!0});function n(c){const r=c||"";return function(){throw new Error("this method "+r+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function e(c,r){if(!c)throw new Error(r||"Assertion failed")}function t(c,r,s){let p;Object.defineProperty(c,r,{get(){return p||(p=s.call(this)),p}})}function i(c){return c&&Object.assign({},c)}function a(c,r){const s=[];for(;r-- >0;)s.push(c());return s}function u(c,r){return new Array(r+1).join(c)}function o(c,r){return a(()=>c,r)}function m(c){const r=[];for(let s=0;s<c.length;s++){const p=c[s];c.lastIndexOf(p)!==s&&r.indexOf(p)<0&&r.push(p)}return r}function E(c){const r=[];return c.forEach(s=>{r.indexOf(s)<0&&r.push(s)}),r}function x(c){const r=c[0];return r===r.toUpperCase()}function C(c){return!x(c)}function O(c,r,s){const p=s||" ";return c.length<r?u(p,r-c.length)+c:c}function w(){this.strings=[]}w.prototype.append=function(c){this.strings.push(c)},w.prototype.contents=function(){return this.strings.join("")};const T=c=>String.fromCodePoint(parseInt(c,16));function j(c){if(c.charAt(0)==="\\")switch(c.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return T(c.slice(2,4));case"u":return c.charAt(2)==="{"?T(c.slice(3,-1)):T(c.slice(2,6));default:return c.charAt(1)}else return c}function te(c){if(c==null)return String(c);const r=Object.prototype.toString.call(c);try{let s;return c.constructor&&c.constructor.name?s=c.constructor.name:r.indexOf("[object ")===0?s=r.slice(8,-1):s=typeof c,s+": "+JSON.stringify(String(c))}catch{return r}}var we=Object.freeze({__proto__:null,abstract:n,assert:e,defineLazyProperty:t,clone:i,repeatFn:a,repeatStr:u,repeat:o,getDuplicates:m,copyWithoutDuplicates:E,isSyntactic:x,isLexical:C,padLeft:O,StringBuffer:w,unescapeCodePoint:j,unexpectedObjToString:te});const Oe={Lu:new RegExp("\\p{Lu}","u"),Ll:new RegExp("\\p{Ll}","u"),Lt:new RegExp("\\p{Lt}","u"),Lm:new RegExp("\\p{Lm}","u"),Lo:new RegExp("\\p{Lo}","u"),Nl:new RegExp("\\p{Nl}","u"),Nd:new RegExp("\\p{Nd}","u"),Mn:new RegExp("\\p{Mn}","u"),Mc:new RegExp("\\p{Mc}","u"),Pc:new RegExp("\\p{Pc}","u"),Zs:new RegExp("\\p{Zs}","u"),L:new RegExp("\\p{Letter}","u"),Ltmo:new RegExp("\\p{Lt}|\\p{Lm}|\\p{Lo}","u")};class U{constructor(){if(this.constructor===U)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(r){return r&&(this.source=r.trimmed()),this}}const D=Object.create(U.prototype),B=Object.create(U.prototype);class N extends U{constructor(r){super(),this.obj=r}}class v extends U{constructor(r,s){super(),this.from=r,this.to=s,this.matchCodePoint=r.length>1||s.length>1}}class F extends U{constructor(r){super(),this.index=r}}class z extends U{constructor(r){super(),this.terms=r}}class ie extends z{constructor(r,s,p){const g=r.rules[s].body;super([p,g]),this.superGrammar=r,this.name=s,this.body=p}}class me extends z{constructor(r,s,p,g){const _=r.rules[s].body;super([...p,_,...g]),this.superGrammar=r,this.ruleName=s,this.expansionPos=p.length}}class J extends U{constructor(r){super(),this.factors=r}}class re extends U{constructor(r){super(),this.expr=r}}class le extends re{}class ke extends re{}class qe extends re{}le.prototype.operator="*",ke.prototype.operator="+",qe.prototype.operator="?",le.prototype.minNumMatches=0,ke.prototype.minNumMatches=1,qe.prototype.minNumMatches=0,le.prototype.maxNumMatches=Number.POSITIVE_INFINITY,ke.prototype.maxNumMatches=Number.POSITIVE_INFINITY,qe.prototype.maxNumMatches=1;class ve extends U{constructor(r){super(),this.expr=r}}class ge extends U{constructor(r){super(),this.expr=r}}class Ue extends U{constructor(r){super(),this.expr=r}}class ee extends U{constructor(r,s=[]){super(),this.ruleName=r,this.args=s}isSyntactic(){return x(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class Ee extends U{constructor(r){super(),this.category=r,this.pattern=Oe[r]}}function Pe(c,r){let s;return r?(s=new Error(r.getLineAndColumnMessage()+c),s.shortMessage=c,s.interval=r):s=new Error(c),s}function y(){return Pe("Interval sources don't match")}function k(c){const r=new Error;return Object.defineProperty(r,"message",{enumerable:!0,get(){return c.message}}),Object.defineProperty(r,"shortMessage",{enumerable:!0,get(){return"Expected "+c.getExpectedText()}}),r.interval=c.getInterval(),r}function ae(c,r,s){const p=r?`Grammar ${c} is not declared in namespace '${r}'`:"Undeclared grammar "+c;return Pe(p,s)}function Ae(c,r){return Pe("Grammar "+c.name+" is already declared in this namespace")}function Be(c){return Pe(`Grammar '${c.name}' does not support incremental parsing`)}function Te(c,r,s){return Pe("Rule "+c+" is not declared in grammar "+r,s)}function P(c,r,s){return Pe("Cannot override rule "+c+" because it is not declared in "+r,s)}function $(c,r,s){return Pe("Cannot extend rule "+c+" because it is not declared in "+r,s)}function R(c,r,s,p){let g="Duplicate declaration for rule '"+c+"' in grammar '"+r+"'";return r!==s&&(g+=" (originally declared in '"+s+"')"),Pe(g,p)}function K(c,r,s,p){return Pe("Wrong number of parameters for rule "+c+" (expected "+r+", got "+s+")",p)}function Q(c,r,s,p){return Pe("Wrong number of arguments for rule "+c+" (expected "+r+", got "+s+")",p)}function H(c,r,s){return Pe("Duplicate parameter names in rule "+c+": "+r.join(", "),s)}function q(c,r){return Pe("Invalid parameter to rule "+c+": "+r+" has arity "+r.getArity()+", but parameter expressions must have arity 1",r.source)}const X="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function de(c,r){return Pe("Cannot apply syntactic rule "+c+" from here (inside a lexical context)",r.source)}function Ce(c){const{ruleName:r}=c;return Pe(`applySyntactic is for syntactic rules, but '${r}' is a lexical rule. `+X,c.source)}function Re(c){return Pe("applySyntactic is not required here (in a syntactic context)",c.source)}function pe(c,r){return Pe("Incorrect argument type: expected "+c,r.source)}function be(c){return Pe("'...' can appear at most once in a rule body",c.source)}function Le(c){const r=c._node;e(r&&r.isNonterminal()&&r.ctorName==="escapeChar_unicodeCodePoint");const s=c.children.slice(1,-1).map(g=>g.source),p=s[0].coverageWith(...s.slice(1));return Pe(`U+${p.contents} is not a valid Unicode code point`,p)}function ce(c,r){const s=r.length>0?r[r.length-1].args:[];let g="Nullable expression "+c.expr.substituteParams(s)+" is not allowed inside '"+c.operator+"' (possible infinite loop)";if(r.length>0){const _=r.map(M=>new ee(M.ruleName,M.args)).join(`
`);g+=`
Application stack (most recent application last):
`+_}return Pe(g,c.expr.source)}function st(c,r,s,p){return Pe("Rule "+c+" involves an alternation which has inconsistent arity (expected "+r+", got "+s+")",p.source)}function Ot(c){const r=c.map(s=>s.message);return Pe(["Errors:"].concat(r).join(`
- `),c[0].interval)}function ht(c,r,s,p){let g=p.slice(0,-1).map(Y=>{const ue="  "+Y[0].name+" > "+Y[1];return Y.length===3?ue+" for '"+Y[2]+"'":ue}).join(`
`);g+=`
  `+r+" > "+c;let _="";c==="_iter"&&(_=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes  see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));const M=[`Missing semantic action for '${c}' in ${s} '${r}'.${_}`,"Action stack (most recent call last):",g].join(`
`),Z=Pe(M);return Z.name="missingSemanticAction",Z}function at(c){if(c.length===1)throw c[0];if(c.length>1)throw Ot(c)}function ft(c){let r=0;return c.map(p=>{const g=p.toString();return r=Math.max(r,g.length),g}).map(p=>O(p,r))}function Rt(c,r,s){const p=c.length,g=c.slice(0,s),_=c.slice(s+r.length);return(g+r+_).substr(0,p)}function Gt(...c){const r=this,{offset:s}=r,{repeatStr:p}=we,g=new w;g.append("Line "+r.lineNum+", col "+r.colNum+`:
`);const _=ft([r.prevLine==null?0:r.lineNum-1,r.lineNum,r.nextLine==null?0:r.lineNum+1]),M=(G,W,se)=>{g.append(se+_[G]+" | "+W+`
`)};r.prevLine!=null&&M(0,r.prevLine,"  "),M(1,r.line,"> ");const Z=r.line.length;let Y=p(" ",Z+1);for(let G=0;G<c.length;++G){let W=c[G][0],se=c[G][1];e(W>=0&&W<=se,"range start must be >= 0 and <= end");const Ie=s-r.colNum+1;W=Math.max(0,W-Ie),se=Math.min(se-Ie,Z),Y=Rt(Y,p("~",se-W),W)}const ue=2+_[1].length+3;return g.append(p(" ",ue)),Y=Rt(Y,"^",r.colNum-1),g.append(Y.replace(/ +$/,"")+`
`),r.nextLine!=null&&M(2,r.nextLine,"  "),g.contents()}let cr=[];function $t(c){cr.push(c)}function ne(c){cr.forEach(r=>{r(c)}),cr=null}function ur(c,r){let s=1,p=1,g=0,_=0,M=null,Z=null,Y=-1;for(;g<r;){const W=c.charAt(g++);W===`
`?(s++,p=1,Y=_,_=g):W!=="\r"&&p++}let ue=c.indexOf(`
`,_);if(ue===-1)ue=c.length;else{const W=c.indexOf(`
`,ue+1);M=W===-1?c.slice(ue):c.slice(ue,W),M=M.replace(/^\r?\n/,"").replace(/\r$/,"")}Y>=0&&(Z=c.slice(Y,_).replace(/\r?\n$/,""));const G=c.slice(_,ue).replace(/\r$/,"");return{offset:r,lineNum:s,colNum:p,line:G,prevLine:Z,nextLine:M,toString:Gt}}function Xt(c,r,...s){return ur(c,r).toString(...s)}const Pt=(()=>{let c=0;return r=>""+r+c++})();class Xe{constructor(r,s,p){this.sourceString=r,this.startIdx=s,this.endIdx=p}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...r){return Xe.coverage(...r,this)}collapsedLeft(){return new Xe(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new Xe(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return ur(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const r=[this.startIdx,this.endIdx];return Xt(this.sourceString,this.startIdx,r)}minus(r){if(this.sourceString!==r.sourceString)throw y();return this.startIdx===r.startIdx&&this.endIdx===r.endIdx?[]:this.startIdx<r.startIdx&&r.endIdx<this.endIdx?[new Xe(this.sourceString,this.startIdx,r.startIdx),new Xe(this.sourceString,r.endIdx,this.endIdx)]:this.startIdx<r.endIdx&&r.endIdx<this.endIdx?[new Xe(this.sourceString,r.endIdx,this.endIdx)]:this.startIdx<r.startIdx&&r.startIdx<this.endIdx?[new Xe(this.sourceString,this.startIdx,r.startIdx)]:[this]}relativeTo(r){if(this.sourceString!==r.sourceString)throw y();return e(this.startIdx>=r.startIdx&&this.endIdx<=r.endIdx,"other interval does not cover this one"),new Xe(this.sourceString,this.startIdx-r.startIdx,this.endIdx-r.startIdx)}trimmed(){const{contents:r}=this,s=this.startIdx+r.match(/^\s*/)[0].length,p=this.endIdx-r.match(/\s*$/)[0].length;return new Xe(this.sourceString,s,p)}subInterval(r,s){const p=this.startIdx+r;return new Xe(this.sourceString,p,p+s)}}Xe.coverage=function(c,...r){let{startIdx:s,endIdx:p}=c;for(const g of r){if(g.sourceString!==c.sourceString)throw y();s=Math.min(s,g.startIdx),p=Math.max(p,g.endIdx)}return new Xe(c.sourceString,s,p)};const Nt=65535;class De{constructor(r){this.source=r,this.pos=0,this.examinedLength=0}atEnd(){const r=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),r}next(){const r=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),r}nextCharCode(){const r=this.next();return r&&r.charCodeAt(0)}nextCodePoint(){const r=this.source.slice(this.pos++).codePointAt(0);return r>Nt&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),r}matchString(r,s){let p;if(s){for(p=0;p<r.length;p++){const g=this.next(),_=r[p];if(g==null||g.toUpperCase()!==_.toUpperCase())return!1}return!0}for(p=0;p<r.length;p++)if(this.next()!==r[p])return!1;return!0}sourceSlice(r,s){return this.source.slice(r,s)}interval(r,s){return new Xe(this.source,r,s||this.pos)}}class h{constructor(r,s,p,g,_,M,Z){this.matcher=r,this.input=s,this.startExpr=p,this._cst=g,this._cstOffset=_,this._rightmostFailurePosition=M,this._rightmostFailures=Z,this.failed()&&(t(this,"message",function(){const Y="Expected "+this.getExpectedText();return Xt(this.input,this.getRightmostFailurePosition())+Y}),t(this,"shortMessage",function(){const Y="expected "+this.getExpectedText(),ue=ur(this.input,this.getRightmostFailurePosition());return"Line "+ue.lineNum+", col "+ue.colNum+": "+Y}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const r=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=r.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const r=new w;let s=this.getRightmostFailures();s=s.filter(p=>!p.isFluffy());for(let p=0;p<s.length;p++)p>0&&(p===s.length-1?r.append(s.length>2?", or ":" or "):r.append(", ")),r.append(s[p].toString());return r.contents()}getInterval(){const r=this.getRightmostFailurePosition();return new Xe(this.input,r,r)}}class b{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(r){return this.applicationMemoKeyStack.indexOf(r.toMemoKey())>=0}enter(r){this.applicationMemoKeyStack.push(r.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(r,s){s.isLeftRecursion=!0,s.headApplication=r,s.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=s;const{applicationMemoKeyStack:p}=this,g=p.indexOf(r.toMemoKey())+1,_=p.slice(g);s.isInvolved=function(M){return _.indexOf(M)>=0},s.updateInvolvedApplicationMemoKeys=function(){for(let M=g;M<p.length;M++){const Z=p[M];this.isInvolved(Z)||_.push(Z)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(r){if(!r.isLeftRecursion)return!0;const{applicationMemoKeyStack:s}=this;for(let p=0;p<s.length;p++){const g=s[p];if(r.isInvolved(g))return!1}return!0}memoize(r,s){return this.memo[r]=s,this.maxExaminedLength=Math.max(this.maxExaminedLength,s.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,s.rightmostFailureOffset),s}clearObsoleteEntries(r,s){if(r+this.maxExaminedLength<=s)return;const{memo:p}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(p).forEach(g=>{const _=p[g];r+_.examinedLength>s?delete p[g]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,_.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,_.rightmostFailureOffset))})}}const S="",l="",d="",f="",A="",I="",L="",V={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function oe(c){return o(" ",c).join("")}function he(c,r,s){const p=$e(c.slice(r,r+s));return p.length<s?p+o(" ",s-p.length).join(""):p}function $e(c){return typeof c=="string"?c.replace(/ /g,d).replace(/\t/g,A).replace(/\n/g,I).replace(/\r/g,L):String(c)}class xe{constructor(r,s,p,g,_,M,Z){this.input=r,this.pos=this.pos1=s,this.pos2=p,this.source=new Xe(r,s,p),this.expr=g,this.bindings=M,this.children=Z||[],this.terminatingLREntry=null,this._flags=_?V.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(r){const s=new xe(this.input,this.pos,this.pos2,r,this.succeeded,this.bindings,this.children);return s.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,s.isImplicitSpaces=this.isImplicitSpaces,s.isMemoized=this.isMemoized,s.isRootNode=this.isRootNode,s.terminatesLR=this.terminatesLR,s.terminatingLREntry=this.terminatingLREntry,s}recordLRTermination(r,s){this.terminatingLREntry=new xe(this.input,this.pos,this.pos2,this.expr,!1,[s],[r]),this.terminatingLREntry.terminatesLR=!0}walk(r,s){let p=r;typeof p=="function"&&(p={enter:p});function g(_,M,Z){let Y=!0;p.enter&&p.enter.call(s,_,M,Z)===xe.prototype.SKIP&&(Y=!1),Y&&(_.children.forEach(ue=>{g(ue,_,Z+1)}),p.exit&&p.exit.call(s,_,M,Z))}this.isRootNode?this.children.forEach(_=>{g(_,null,0)}):g(this,null,0)}toString(){const r=new w;return this.walk((s,p,g)=>{if(!s)return this.SKIP;if(s.expr.constructor.name!=="Alt"){if(r.append(he(s.input,s.pos,10)+oe(g*2+1)),r.append((s.succeeded?l:S)+" "+s.displayString),s.isHeadOfLeftRecursion&&r.append(" (LR)"),s.succeeded){const M=$e(s.source.contents);r.append(" "+f+"  "),r.append(typeof M=="string"?'"'+M+'"':M)}r.append(`
`)}}),r.contents()}}xe.prototype.SKIP={},Object.keys(V).forEach(c=>{const r=V[c];Object.defineProperty(xe.prototype,c,{get(){return(this._flags&r)!==0},set(s){s?this._flags|=r:this._flags&=~r}})}),U.prototype.allowsSkippingPrecedingSpace=n("allowsSkippingPrecedingSpace"),D.allowsSkippingPrecedingSpace=B.allowsSkippingPrecedingSpace=ee.prototype.allowsSkippingPrecedingSpace=N.prototype.allowsSkippingPrecedingSpace=v.prototype.allowsSkippingPrecedingSpace=Ee.prototype.allowsSkippingPrecedingSpace=function(){return!0},z.prototype.allowsSkippingPrecedingSpace=re.prototype.allowsSkippingPrecedingSpace=Ue.prototype.allowsSkippingPrecedingSpace=ge.prototype.allowsSkippingPrecedingSpace=ve.prototype.allowsSkippingPrecedingSpace=F.prototype.allowsSkippingPrecedingSpace=J.prototype.allowsSkippingPrecedingSpace=function(){return!1};let Fe;$t(c=>{Fe=c});let Ne;U.prototype.assertAllApplicationsAreValid=function(c,r){Ne=0,this._assertAllApplicationsAreValid(c,r)},U.prototype._assertAllApplicationsAreValid=n("_assertAllApplicationsAreValid"),D._assertAllApplicationsAreValid=B._assertAllApplicationsAreValid=N.prototype._assertAllApplicationsAreValid=v.prototype._assertAllApplicationsAreValid=F.prototype._assertAllApplicationsAreValid=Ee.prototype._assertAllApplicationsAreValid=function(c,r){},Ue.prototype._assertAllApplicationsAreValid=function(c,r){Ne++,this.expr._assertAllApplicationsAreValid(c,r),Ne--},z.prototype._assertAllApplicationsAreValid=function(c,r){for(let s=0;s<this.terms.length;s++)this.terms[s]._assertAllApplicationsAreValid(c,r)},J.prototype._assertAllApplicationsAreValid=function(c,r){for(let s=0;s<this.factors.length;s++)this.factors[s]._assertAllApplicationsAreValid(c,r)},re.prototype._assertAllApplicationsAreValid=ve.prototype._assertAllApplicationsAreValid=ge.prototype._assertAllApplicationsAreValid=function(c,r){this.expr._assertAllApplicationsAreValid(c,r)},ee.prototype._assertAllApplicationsAreValid=function(c,r,s=!1){const p=r.rules[this.ruleName],g=x(c)&&Ne===0;if(!p)throw Te(this.ruleName,r.name,this.source);if(!s&&x(this.ruleName)&&!g)throw de(this.ruleName,this);const _=this.args.length,M=p.formals.length;if(_!==M)throw Q(this.ruleName,M,_,this.source);const Z=Fe&&p===Fe.rules.applySyntactic;if(Fe&&p===Fe.rules.caseInsensitive&&!(this.args[0]instanceof N))throw pe('a Terminal (e.g. "abc")',this.args[0]);if(Z){const ue=this.args[0];if(!(ue instanceof ee))throw pe("a syntactic rule application",ue);if(!x(ue.ruleName))throw Ce(ue);if(g)throw Re(this)}this.args.forEach(ue=>{if(ue._assertAllApplicationsAreValid(c,r,Z),ue.getArity()!==1)throw q(this.ruleName,ue)})},U.prototype.assertChoicesHaveUniformArity=n("assertChoicesHaveUniformArity"),D.assertChoicesHaveUniformArity=B.assertChoicesHaveUniformArity=N.prototype.assertChoicesHaveUniformArity=v.prototype.assertChoicesHaveUniformArity=F.prototype.assertChoicesHaveUniformArity=Ue.prototype.assertChoicesHaveUniformArity=Ee.prototype.assertChoicesHaveUniformArity=function(c){},z.prototype.assertChoicesHaveUniformArity=function(c){if(this.terms.length===0)return;const r=this.terms[0].getArity();for(let s=0;s<this.terms.length;s++){const p=this.terms[s];p.assertChoicesHaveUniformArity();const g=p.getArity();if(r!==g)throw st(c,r,g,p)}},ie.prototype.assertChoicesHaveUniformArity=function(c){const r=this.terms[0].getArity(),s=this.terms[1].getArity();if(r!==s)throw st(c,s,r,this.terms[0])},J.prototype.assertChoicesHaveUniformArity=function(c){for(let r=0;r<this.factors.length;r++)this.factors[r].assertChoicesHaveUniformArity(c)},re.prototype.assertChoicesHaveUniformArity=function(c){this.expr.assertChoicesHaveUniformArity(c)},ve.prototype.assertChoicesHaveUniformArity=function(c){},ge.prototype.assertChoicesHaveUniformArity=function(c){this.expr.assertChoicesHaveUniformArity(c)},ee.prototype.assertChoicesHaveUniformArity=function(c){},U.prototype.assertIteratedExprsAreNotNullable=n("assertIteratedExprsAreNotNullable"),D.assertIteratedExprsAreNotNullable=B.assertIteratedExprsAreNotNullable=N.prototype.assertIteratedExprsAreNotNullable=v.prototype.assertIteratedExprsAreNotNullable=F.prototype.assertIteratedExprsAreNotNullable=Ee.prototype.assertIteratedExprsAreNotNullable=function(c){},z.prototype.assertIteratedExprsAreNotNullable=function(c){for(let r=0;r<this.terms.length;r++)this.terms[r].assertIteratedExprsAreNotNullable(c)},J.prototype.assertIteratedExprsAreNotNullable=function(c){for(let r=0;r<this.factors.length;r++)this.factors[r].assertIteratedExprsAreNotNullable(c)},re.prototype.assertIteratedExprsAreNotNullable=function(c){if(this.expr.assertIteratedExprsAreNotNullable(c),this.expr.isNullable(c))throw ce(this,[])},qe.prototype.assertIteratedExprsAreNotNullable=ve.prototype.assertIteratedExprsAreNotNullable=ge.prototype.assertIteratedExprsAreNotNullable=Ue.prototype.assertIteratedExprsAreNotNullable=function(c){this.expr.assertIteratedExprsAreNotNullable(c)},ee.prototype.assertIteratedExprsAreNotNullable=function(c){this.args.forEach(r=>{r.assertIteratedExprsAreNotNullable(c)})};class tt{constructor(r){this.matchLength=r}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(r){if(this.children)return this.children[r]}indexOfChild(r){return this.children.indexOf(r)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(r){const s=this.indexOfChild(r);if(s<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(s===0)throw new Error("cannot get child before first child");return this.childAt(s-1)}childAfter(r){const s=this.indexOfChild(r);if(s<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(s===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(s+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class _e extends tt{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class Ze extends tt{constructor(r,s,p,g){super(g),this.ruleName=r,this.children=s,this.childOffsets=p}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return C(this.ctorName)}isSyntactic(){return x(this.ctorName)}}class _t extends tt{constructor(r,s,p,g){super(p),this.children=r,this.childOffsets=s,this.optional=g}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}U.prototype.eval=n("eval"),D.eval=function(c){const{inputStream:r}=c,s=r.pos,p=r.nextCodePoint();return p!==void 0?(c.pushBinding(new _e(String.fromCodePoint(p).length),s),!0):(c.processFailure(s,this),!1)},B.eval=function(c){const{inputStream:r}=c,s=r.pos;return r.atEnd()?(c.pushBinding(new _e(0),s),!0):(c.processFailure(s,this),!1)},N.prototype.eval=function(c){const{inputStream:r}=c,s=r.pos;return r.matchString(this.obj)?(c.pushBinding(new _e(this.obj.length),s),!0):(c.processFailure(s,this),!1)},v.prototype.eval=function(c){const{inputStream:r}=c,s=r.pos,p=this.matchCodePoint?r.nextCodePoint():r.nextCharCode();return p!==void 0&&this.from.codePointAt(0)<=p&&p<=this.to.codePointAt(0)?(c.pushBinding(new _e(String.fromCodePoint(p).length),s),!0):(c.processFailure(s,this),!1)},F.prototype.eval=function(c){return c.eval(c.currentApplication().args[this.index])},Ue.prototype.eval=function(c){c.enterLexifiedContext();const r=c.eval(this.expr);return c.exitLexifiedContext(),r},z.prototype.eval=function(c){for(let r=0;r<this.terms.length;r++)if(c.eval(this.terms[r]))return!0;return!1},J.prototype.eval=function(c){for(let r=0;r<this.factors.length;r++){const s=this.factors[r];if(!c.eval(s))return!1}return!0},re.prototype.eval=function(c){const{inputStream:r}=c,s=r.pos,p=this.getArity(),g=[],_=[];for(;g.length<p;)g.push([]),_.push([]);let M=0,Z=s,Y;for(;M<this.maxNumMatches&&c.eval(this.expr);){if(r.pos===Z)throw ce(this,c._applicationStack);Z=r.pos,M++;const se=c._bindings.splice(c._bindings.length-p,p),Ie=c._bindingOffsets.splice(c._bindingOffsets.length-p,p);for(Y=0;Y<se.length;Y++)g[Y].push(se[Y]),_[Y].push(Ie[Y])}if(M<this.minNumMatches)return!1;let ue=c.posToOffset(s),G=0;if(M>0){const se=g[p-1],Ie=_[p-1],ze=Ie[Ie.length-1]+se[se.length-1].matchLength;ue=_[0][0],G=ze-ue}const W=this instanceof qe;for(Y=0;Y<g.length;Y++)c._bindings.push(new _t(g[Y],_[Y],G,W)),c._bindingOffsets.push(ue);return!0},ve.prototype.eval=function(c){const{inputStream:r}=c,s=r.pos;c.pushFailuresInfo();const p=c.eval(this.expr);return c.popFailuresInfo(),p?(c.processFailure(s,this),!1):(r.pos=s,!0)},ge.prototype.eval=function(c){const{inputStream:r}=c,s=r.pos;return c.eval(this.expr)?(r.pos=s,!0):!1},ee.prototype.eval=function(c){const r=c.currentApplication(),s=r?r.args:[],p=this.substituteParams(s),g=c.getCurrentPosInfo();if(g.isActive(p))return p.handleCycle(c);const _=p.toMemoKey(),M=g.memo[_];if(M&&g.shouldUseMemoizedResult(M)){if(c.hasNecessaryInfo(M))return c.useMemoizedResult(c.inputStream.pos,M);delete g.memo[_]}return p.reallyEval(c)},ee.prototype.handleCycle=function(c){const r=c.getCurrentPosInfo(),{currentLeftRecursion:s}=r,p=this.toMemoKey();let g=r.memo[p];return s&&s.headApplication.toMemoKey()===p?g.updateInvolvedApplicationMemoKeys():g||(g=r.memoize(p,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),r.startLeftRecursion(this,g)),c.useMemoizedResult(c.inputStream.pos,g)},ee.prototype.reallyEval=function(c){const{inputStream:r}=c,s=r.pos,p=c.getCurrentPosInfo(),g=c.grammar.rules[this.ruleName],{body:_}=g,{description:M}=g;c.enterApplication(p,this),M&&c.pushFailuresInfo();const Z=r.examinedLength;r.examinedLength=0;let Y=this.evalOnce(_,c);const ue=p.currentLeftRecursion,G=this.toMemoKey(),W=ue&&ue.headApplication.toMemoKey()===G;let se;c.doNotMemoize?c.doNotMemoize=!1:W?(Y=this.growSeedResult(_,c,s,ue,Y),p.endLeftRecursion(),se=ue,se.examinedLength=r.examinedLength-s,se.rightmostFailureOffset=c._getRightmostFailureOffset(),p.memoize(G,se)):(!ue||!ue.isInvolved(G))&&(se=p.memoize(G,{matchLength:r.pos-s,examinedLength:r.examinedLength-s,value:Y,failuresAtRightmostPosition:c.cloneRecordedFailures(),rightmostFailureOffset:c._getRightmostFailureOffset()}));const Ie=!!Y;if(M&&(c.popFailuresInfo(),Ie||c.processFailure(s,this),se&&(se.failuresAtRightmostPosition=c.cloneRecordedFailures())),c.isTracing()&&se){const ze=c.getTraceEntry(s,this,Ie,Ie?[Y]:[]);W&&(e(ze.terminatingLREntry!=null||!Ie),ze.isHeadOfLeftRecursion=!0),se.traceEntry=ze}return r.examinedLength=Math.max(r.examinedLength,Z),c.exitApplication(p,Y),Ie},ee.prototype.evalOnce=function(c,r){const{inputStream:s}=r,p=s.pos;if(r.eval(c)){const g=c.getArity(),_=r._bindings.splice(r._bindings.length-g,g),M=r._bindingOffsets.splice(r._bindingOffsets.length-g,g),Z=s.pos-p;return new Ze(this.ruleName,_,M,Z)}else return!1},ee.prototype.growSeedResult=function(c,r,s,p,g){if(!g)return!1;const{inputStream:_}=r;for(;;){if(p.matchLength=_.pos-s,p.value=g,p.failuresAtRightmostPosition=r.cloneRecordedFailures(),r.isTracing()){const M=r.trace[r.trace.length-1];p.traceEntry=new xe(r.input,s,_.pos,this,!0,[g],[M.clone()])}if(_.pos=s,g=this.evalOnce(c,r),_.pos-s<=p.matchLength)break;r.isTracing()&&r.trace.splice(-2,1)}return r.isTracing()&&p.traceEntry.recordLRTermination(r.trace.pop(),g),_.pos=s+p.matchLength,p.value},Ee.prototype.eval=function(c){const{inputStream:r}=c,s=r.pos,p=r.next();return p&&this.pattern.test(p)?(c.pushBinding(new _e(p.length),s),!0):(c.processFailure(s,this),!1)},U.prototype.getArity=n("getArity"),D.getArity=B.getArity=N.prototype.getArity=v.prototype.getArity=F.prototype.getArity=ee.prototype.getArity=Ee.prototype.getArity=function(){return 1},z.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()},J.prototype.getArity=function(){let c=0;for(let r=0;r<this.factors.length;r++)c+=this.factors[r].getArity();return c},re.prototype.getArity=function(){return this.expr.getArity()},ve.prototype.getArity=function(){return 0},ge.prototype.getArity=Ue.prototype.getArity=function(){return this.expr.getArity()};function We(c,r){const s={};if(c.source&&r){const p=c.source.relativeTo(r);s.sourceInterval=[p.startIdx,p.endIdx]}return s}U.prototype.outputRecipe=n("outputRecipe"),D.outputRecipe=function(c,r){return["any",We(this,r)]},B.outputRecipe=function(c,r){return["end",We(this,r)]},N.prototype.outputRecipe=function(c,r){return["terminal",We(this,r),this.obj]},v.prototype.outputRecipe=function(c,r){return["range",We(this,r),this.from,this.to]},F.prototype.outputRecipe=function(c,r){return["param",We(this,r),this.index]},z.prototype.outputRecipe=function(c,r){return["alt",We(this,r)].concat(this.terms.map(s=>s.outputRecipe(c,r)))},ie.prototype.outputRecipe=function(c,r){return this.terms[0].outputRecipe(c,r)},me.prototype.outputRecipe=function(c,r){const s=this.terms.slice(0,this.expansionPos),p=this.terms.slice(this.expansionPos+1);return["splice",We(this,r),s.map(g=>g.outputRecipe(c,r)),p.map(g=>g.outputRecipe(c,r))]},J.prototype.outputRecipe=function(c,r){return["seq",We(this,r)].concat(this.factors.map(s=>s.outputRecipe(c,r)))},le.prototype.outputRecipe=ke.prototype.outputRecipe=qe.prototype.outputRecipe=ve.prototype.outputRecipe=ge.prototype.outputRecipe=Ue.prototype.outputRecipe=function(c,r){return[this.constructor.name.toLowerCase(),We(this,r),this.expr.outputRecipe(c,r)]},ee.prototype.outputRecipe=function(c,r){return["app",We(this,r),this.ruleName,this.args.map(s=>s.outputRecipe(c,r))]},Ee.prototype.outputRecipe=function(c,r){return["unicodeChar",We(this,r),this.category]},U.prototype.introduceParams=n("introduceParams"),D.introduceParams=B.introduceParams=N.prototype.introduceParams=v.prototype.introduceParams=F.prototype.introduceParams=Ee.prototype.introduceParams=function(c){return this},z.prototype.introduceParams=function(c){return this.terms.forEach((r,s,p)=>{p[s]=r.introduceParams(c)}),this},J.prototype.introduceParams=function(c){return this.factors.forEach((r,s,p)=>{p[s]=r.introduceParams(c)}),this},re.prototype.introduceParams=ve.prototype.introduceParams=ge.prototype.introduceParams=Ue.prototype.introduceParams=function(c){return this.expr=this.expr.introduceParams(c),this},ee.prototype.introduceParams=function(c){const r=c.indexOf(this.ruleName);if(r>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new F(r).withSource(this.source)}else return this.args.forEach((s,p,g)=>{g[p]=s.introduceParams(c)}),this},U.prototype.isNullable=function(c){return this._isNullable(c,Object.create(null))},U.prototype._isNullable=n("_isNullable"),D._isNullable=v.prototype._isNullable=F.prototype._isNullable=ke.prototype._isNullable=Ee.prototype._isNullable=function(c,r){return!1},B._isNullable=function(c,r){return!0},N.prototype._isNullable=function(c,r){return typeof this.obj=="string"?this.obj==="":!1},z.prototype._isNullable=function(c,r){return this.terms.length===0||this.terms.some(s=>s._isNullable(c,r))},J.prototype._isNullable=function(c,r){return this.factors.every(s=>s._isNullable(c,r))},le.prototype._isNullable=qe.prototype._isNullable=ve.prototype._isNullable=ge.prototype._isNullable=function(c,r){return!0},Ue.prototype._isNullable=function(c,r){return this.expr._isNullable(c,r)},ee.prototype._isNullable=function(c,r){const s=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(r,s)){const{body:p}=c.rules[this.ruleName],g=p.substituteParams(this.args);r[s]=!1,r[s]=g._isNullable(c,r)}return r[s]},U.prototype.substituteParams=n("substituteParams"),D.substituteParams=B.substituteParams=N.prototype.substituteParams=v.prototype.substituteParams=Ee.prototype.substituteParams=function(c){return this},F.prototype.substituteParams=function(c){return c[this.index]},z.prototype.substituteParams=function(c){return new z(this.terms.map(r=>r.substituteParams(c)))},J.prototype.substituteParams=function(c){return new J(this.factors.map(r=>r.substituteParams(c)))},re.prototype.substituteParams=ve.prototype.substituteParams=ge.prototype.substituteParams=Ue.prototype.substituteParams=function(c){return new this.constructor(this.expr.substituteParams(c))},ee.prototype.substituteParams=function(c){if(this.args.length===0)return this;{const r=this.args.map(s=>s.substituteParams(c));return new ee(this.ruleName,r)}};function er(c){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(c)}function Ye(c){const r=Object.create(null);c.forEach(s=>{r[s]=(r[s]||0)+1}),Object.keys(r).forEach(s=>{if(r[s]<=1)return;let p=1;c.forEach((g,_)=>{g===s&&(c[_]=g+"_"+p++)})})}U.prototype.toArgumentNameList=n("toArgumentNameList"),D.toArgumentNameList=function(c,r){return["any"]},B.toArgumentNameList=function(c,r){return["end"]},N.prototype.toArgumentNameList=function(c,r){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+c]},v.prototype.toArgumentNameList=function(c,r){let s=this.from+"_to_"+this.to;return er(s)||(s="_"+s),er(s)||(s="$"+c),[s]},z.prototype.toArgumentNameList=function(c,r){const s=this.terms.map(_=>_.toArgumentNameList(c,!0)),p=[],g=s[0].length;for(let _=0;_<g;_++){const M=[];for(let Y=0;Y<this.terms.length;Y++)M.push(s[Y][_]);const Z=E(M);p.push(Z.join("_or_"))}return r||Ye(p),p},J.prototype.toArgumentNameList=function(c,r){let s=[];return this.factors.forEach(p=>{const g=p.toArgumentNameList(c,!0);s=s.concat(g),c+=g.length}),r||Ye(s),s},re.prototype.toArgumentNameList=function(c,r){const s=this.expr.toArgumentNameList(c,r).map(p=>p[p.length-1]==="s"?p+"es":p+"s");return r||Ye(s),s},qe.prototype.toArgumentNameList=function(c,r){return this.expr.toArgumentNameList(c,r).map(s=>"opt"+s[0].toUpperCase()+s.slice(1))},ve.prototype.toArgumentNameList=function(c,r){return[]},ge.prototype.toArgumentNameList=Ue.prototype.toArgumentNameList=function(c,r){return this.expr.toArgumentNameList(c,r)},ee.prototype.toArgumentNameList=function(c,r){return[this.ruleName]},Ee.prototype.toArgumentNameList=function(c,r){return["$"+c]},F.prototype.toArgumentNameList=function(c,r){return["param"+this.index]},U.prototype.toDisplayString=n("toDisplayString"),z.prototype.toDisplayString=J.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"},D.toDisplayString=B.toDisplayString=re.prototype.toDisplayString=ve.prototype.toDisplayString=ge.prototype.toDisplayString=Ue.prototype.toDisplayString=N.prototype.toDisplayString=v.prototype.toDisplayString=F.prototype.toDisplayString=function(){return this.toString()},ee.prototype.toDisplayString=function(){if(this.args.length>0){const c=this.args.map(r=>r.toDisplayString());return this.ruleName+"<"+c.join(",")+">"}else return this.ruleName},Ee.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function yr(c){return c==="description"||c==="string"||c==="code"}class rt{constructor(r,s,p){if(!yr(p))throw new Error("invalid Failure type: "+p);this.pexpr=r,this.text=s,this.type=p,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(r){return this.getText()===r.getText()&&this.type===r.type&&(!this.isFluffy()||this.isFluffy()&&r.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){const r=new rt(this.pexpr,this.text,this.type);return this.isFluffy()&&r.makeFluffy(),r}toKey(){return this.toString()+"#"+this.type}}U.prototype.toFailure=n("toFailure"),D.toFailure=function(c){return new rt(this,"any object","description")},B.toFailure=function(c){return new rt(this,"end of input","description")},N.prototype.toFailure=function(c){return new rt(this,this.obj,"string")},v.prototype.toFailure=function(c){return new rt(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")},ve.prototype.toFailure=function(c){const r=this.expr===D?"nothing":"not "+this.expr.toFailure(c);return new rt(this,r,"description")},ge.prototype.toFailure=function(c){return this.expr.toFailure(c)},ee.prototype.toFailure=function(c){let{description:r}=c.rules[this.ruleName];return r||(r=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new rt(this,r,"description")},Ee.prototype.toFailure=function(c){return new rt(this,"a Unicode ["+this.category+"] character","description")},z.prototype.toFailure=function(c){const s="("+this.terms.map(p=>p.toFailure(c)).join(" or ")+")";return new rt(this,s,"description")},J.prototype.toFailure=function(c){const s="("+this.factors.map(p=>p.toFailure(c)).join(" ")+")";return new rt(this,s,"description")},re.prototype.toFailure=function(c){const r="("+this.expr.toFailure(c)+this.operator+")";return new rt(this,r,"description")},U.prototype.toString=n("toString"),D.toString=function(){return"any"},B.toString=function(){return"end"},N.prototype.toString=function(){return JSON.stringify(this.obj)},v.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)},F.prototype.toString=function(){return"$"+this.index},Ue.prototype.toString=function(){return"#("+this.expr.toString()+")"},z.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(c=>c.toString()).join(" | ")+")"},J.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(c=>c.toString()).join(" ")+")"},re.prototype.toString=function(){return this.expr+this.operator},ve.prototype.toString=function(){return"~"+this.expr},ge.prototype.toString=function(){return"&"+this.expr},ee.prototype.toString=function(){if(this.args.length>0){const c=this.args.map(r=>r.toString());return this.ruleName+"<"+c.join(",")+">"}else return this.ruleName},Ee.prototype.toString=function(){return"\\p{"+this.category+"}"};class Ft extends U{constructor(r){super(),this.obj=r}_getString(r){const s=r.currentApplication().args[this.obj.index];return e(s instanceof N,"expected a Terminal expression"),s.obj}allowsSkippingPrecedingSpace(){return!0}eval(r){const{inputStream:s}=r,p=s.pos,g=this._getString(r);return s.matchString(g,!0)?(r.pushBinding(new _e(g.length),p),!0):(r.processFailure(p,this),!1)}getArity(){return 1}substituteParams(r){return new Ft(this.obj.substituteParams(r))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(r){return new rt(this,this.obj.toFailure(r)+" (case-insensitive)","description")}_isNullable(r,s){return this.obj._isNullable(r,s)}}var Bn=Object.freeze({__proto__:null,CaseInsensitiveTerminal:Ft,PExpr:U,any:D,end:B,Terminal:N,Range:v,Param:F,Alt:z,Extend:ie,Splice:me,Seq:J,Iter:re,Star:le,Plus:ke,Opt:qe,Not:ve,Lookahead:ge,Lex:Ue,Apply:ee,UnicodeChar:Ee});let dn;$t(c=>{dn=c.rules.applySyntactic.body});const Ur=new ee("spaces");class hn{constructor(r,s,p){this.matcher=r,this.startExpr=s,this.grammar=r.grammar,this.input=r.getInput(),this.inputStream=new De(this.input),this.memoTable=r._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],p!==void 0&&(this.positionToRecordFailures=p,this.recordedFailures=Object.create(null))}posToOffset(r){return r-this._posStack[this._posStack.length-1]}enterApplication(r,s){this._posStack.push(this.inputStream.pos),this._applicationStack.push(s),this.inLexifiedContextStack.push(!1),r.enter(s),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(r,s){const p=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),r.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),s&&this.pushBinding(s,p)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const r=this.currentApplication();return r?r.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(Ur),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(r){return r.allowsSkippingPrecedingSpace()&&r!==Ur?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(r,s){this._bindings.push(r),this._bindingOffsets.push(this.posToOffset(s))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(r){for(;this._bindings.length>r;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(r){let s=this.memoTable[r];return s||(s=this.memoTable[r]=new b),s}processFailure(r,s){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,r),this.recordedFailures&&r===this.positionToRecordFailures){const p=this.currentApplication();p&&(s=s.substituteParams(p.args)),this.recordFailure(s.toFailure(this.grammar),!1)}}recordFailure(r,s){const p=r.toKey();this.recordedFailures[p]?this.recordedFailures[p].isFluffy()&&!r.isFluffy()&&this.recordedFailures[p].clearFluffy():this.recordedFailures[p]=s?r.clone():r}recordFailures(r,s){Object.keys(r).forEach(p=>{this.recordFailure(r[p],s)})}cloneRecordedFailures(){if(!this.recordedFailures)return;const r=Object.create(null);return Object.keys(this.recordedFailures).forEach(s=>{r[s]=this.recordedFailures[s].clone()}),r}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(r,s){const p=this.memoTable[r];if(p&&s instanceof ee){const g=p.memo[s.toMemoKey()];if(g&&g.traceEntry){const _=g.traceEntry.cloneWithExpr(s);return _.isMemoized=!0,_}}return null}getTraceEntry(r,s,p,g){if(s instanceof ee){const _=this.currentApplication(),M=_?_.args:[];s=s.substituteParams(M)}return this.getMemoizedTraceEntry(r,s)||new xe(this.input,r,this.inputStream.pos,s,p,g,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(r){return this.trace&&!r.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+r.rightmostFailureOffset===this.positionToRecordFailures?!!r.failuresAtRightmostPosition:!0}useMemoizedResult(r,s){this.trace&&this.trace.push(s.traceEntry);const p=this.inputStream.pos+s.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,p),this.recordedFailures&&this.positionToRecordFailures===p&&s.failuresAtRightmostPosition&&this.recordFailures(s.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,s.examinedLength+r),s.value?(this.inputStream.pos+=s.matchLength,this.pushBinding(s.value,r),!0):!1}eval(r){const{inputStream:s}=this,p=this._bindings.length,g=this.userData;let _;this.recordedFailures&&(_=this.recordedFailures,this.recordedFailures=Object.create(null));const M=s.pos,Z=this.maybeSkipSpacesBefore(r);let Y;this.trace&&(Y=this.trace,this.trace=[]);const ue=r.eval(this);if(this.trace){const G=this._bindings.slice(p),W=this.getTraceEntry(Z,r,ue,G);W.isImplicitSpaces=r===Ur,W.isRootNode=r===this.startExpr,Y.push(W),this.trace=Y}return ue?this.recordedFailures&&s.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(G=>{this.recordedFailures[G].makeFluffy()}):(s.pos=M,this.truncateBindings(p),this.userData=g),this.recordedFailures&&this.recordFailures(_,!1),r===dn&&this.skipSpaces(),ue}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let r;this.recordedFailures&&(r=Object.keys(this.recordedFailures).map(p=>this.recordedFailures[p]));const s=this._bindings[0];return s&&(s.grammar=this.grammar),new h(this.matcher,this.input,this.startExpr,s,this._bindingOffsets[0],this.rightmostFailurePosition,r)}getTrace(){this.trace=[];const r=this.getMatchResult(),s=this.trace[this.trace.length-1];return s.result=r,s}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class Se{constructor(r){this.grammar=r,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(r){return this._input!==r&&this.replaceInputRange(0,this._input.length,r),this}replaceInputRange(r,s,p){const g=this._input,_=this._memoTable;if(r<0||r>g.length||s<0||s>g.length||r>s)throw new Error("Invalid indices: "+r+" and "+s);this._input=g.slice(0,r)+p+g.slice(s),this._input!==g&&_.length>0&&(this._isMemoTableStale=!0);const M=_.slice(s);_.length=r;for(let Z=0;Z<p.length;Z++)_.push(void 0);for(const Z of M)_.push(Z);for(let Z=0;Z<r;Z++){const Y=_[Z];Y&&Y.clearObsoleteEntries(Z,r)}return this}match(r,s={incremental:!0}){return this._match(this._getStartExpr(r),{incremental:s.incremental,tracing:!1})}trace(r,s={incremental:!0}){return this._match(this._getStartExpr(r),{incremental:s.incremental,tracing:!0})}_match(r,s={}){const p={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...s};if(!p.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw Be(this.grammar);const g=new hn(this,r,p.positionToRecordFailures);return p.tracing?g.getTrace():g.getMatchResult()}_getStartExpr(r){const s=r||this.grammar.defaultStartRule;if(!s)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const p=this.grammar.parseApplication(s);return new J([p,B])}}const nt=[],tr=(c,r)=>Object.prototype.hasOwnProperty.call(c,r);class Br{constructor(r,s,p){this._node=r,this.source=s,this._baseInterval=p,r.isNonterminal()&&e(s===p),this._childWrappers=[]}_forgetMemoizedResultFor(r){delete this._node[this._semantics.attributeKeys[r]],this.children.forEach(s=>{s._forgetMemoizedResultFor(r)})}child(r){if(!(0<=r&&r<this._node.numChildren()))return;let s=this._childWrappers[r];if(!s){const p=this._node.childAt(r),g=this._node.childOffsets[r],_=this._baseInterval.subInterval(g,p.matchLength),M=p.isNonterminal()?_:this._baseInterval;s=this._childWrappers[r]=this._semantics.wrap(p,_,M)}return s}_children(){for(let r=0;r<this._node.numChildren();r++)this.child(r);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(r){const s=r||[],p=s.map(M=>M._node),g=new _t(p,[],-1,!1),_=this._semantics.wrap(g,null,null);return _._childWrappers=s,_}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class It{constructor(r,s){const p=this;if(this.grammar=r,this.checkedActionDicts=!1,this.Wrapper=class extends(s?s.Wrapper:Br){constructor(g,_,M){super(g,_,M),p.checkActionDictsIfHaventAlready(),this._semantics=p}toString(){return"[semantics wrapper for "+p.grammar.name+"]"}},this.super=s,s){if(!(r.equals(this.super.grammar)||r._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+r.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const g in this.attributes)Object.defineProperty(this.attributeKeys,g,{value:Pt(g)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let r;for(r in this.operations)this.operations[r].checkActionDict(this.grammar);for(r in this.attributes)this.attributes[r].checkActionDict(this.grammar)}toRecipe(r){function s(g){return g.super!==It.BuiltInSemantics._getSemantics()}let p=`(function(g) {
`;if(s(this)){p+="  var semantics = "+this.super.toRecipe(!0)+"(g";const g=this.super.grammar;let _=this.grammar;for(;_!==g;)p+=".superGrammar",_=_.superGrammar;p+=`);
`,p+="  return g.extendSemantics(semantics)"}else p+="  return g.createSemantics()";return["Operation","Attribute"].forEach(g=>{const _=this[g.toLowerCase()+"s"];Object.keys(_).forEach(M=>{const{actionDict:Z,formals:Y,builtInDefault:ue}=_[M];let G=M;Y.length>0&&(G+="("+Y.join(", ")+")");let W;s(this)&&this.super[g.toLowerCase()+"s"][M]?W="extend"+g:W="add"+g,p+=`
    .`+W+"("+JSON.stringify(G)+", {";const se=[];Object.keys(Z).forEach(Ie=>{if(Z[Ie]!==ue){let ze=Z[Ie].toString().trim();ze=ze.replace(/^.*\(/,"function("),se.push(`
      `+JSON.stringify(Ie)+": "+ze)}}),p+=se.join(",")+`
    })`})}),p+=`;
  })`,r||(p=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+p+`(grammar);
  return semantics;
});
`),p}addOperationOrAttribute(r,s,p){const g=r+"s",_=br(s,r),{name:M}=_,{formals:Z}=_;this.assertNewName(M,r);const Y=Nr(r,M,W),ue={_default:Y};Object.keys(p).forEach(se=>{ue[se]=p[se]});const G=r==="operation"?new ye(M,Z,ue,Y):new Ve(M,ue,Y);G.checkActionDict(this.grammar),this[g][M]=G;function W(...se){const Ie=this._semantics[g][M];if(arguments.length!==Ie.formals.length)throw new Error("Invalid number of arguments passed to "+M+" "+r+" (expected "+Ie.formals.length+", got "+arguments.length+")");const ze=Object.create(null);for(const[xr,Wr]of Object.entries(se)){const sa=Ie.formals[xr];ze[sa]=Wr}const pt=this.args;this.args=ze;const yt=Ie.execute(this._semantics,this);return this.args=pt,yt}r==="operation"?(this.Wrapper.prototype[M]=W,this.Wrapper.prototype[M].toString=function(){return"["+M+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,M,{get:W,configurable:!0}),Object.defineProperty(this.attributeKeys,M,{value:Pt(M)}))}extendOperationOrAttribute(r,s,p){const g=r+"s";if(br(s,"attribute"),!(this.super&&s in this.super[g]))throw new Error("Cannot extend "+r+" '"+s+"': did not inherit an "+r+" with that name");if(tr(this[g],s))throw new Error("Cannot extend "+r+" '"+s+"' again");const _=this[g][s].formals,M=this[g][s].actionDict,Z=Object.create(M);Object.keys(p).forEach(Y=>{Z[Y]=p[Y]}),this[g][s]=r==="operation"?new ye(s,_,Z):new Ve(s,Z),this[g][s].checkActionDict(this.grammar)}assertNewName(r,s){if(tr(Br.prototype,r))throw new Error("Cannot add "+s+" '"+r+"': that's a reserved name");if(r in this.operations)throw new Error("Cannot add "+s+" '"+r+"': an operation with that name already exists");if(r in this.attributes)throw new Error("Cannot add "+s+" '"+r+"': an attribute with that name already exists")}wrap(r,s,p){const g=p||s;return r instanceof this.Wrapper?r:new this.Wrapper(r,s,g)}}function br(c,r){if(!It.prototypeGrammar)return e(c.indexOf("(")===-1),{name:c,formals:[]};const s=It.prototypeGrammar.match(c,r==="operation"?"OperationSignature":"AttributeSignature");if(s.failed())throw new Error(s.message);return It.prototypeGrammarSemantics(s).parse()}function Nr(c,r,s){return function(...p){const _=(this._semantics.operations[r]||this._semantics.attributes[r]).formals.map(M=>this.args[M]);if(!this.isIteration()&&p.length===1)return s.apply(p[0],_);throw ht(this.ctorName,r,c,nt)}}It.createSemantics=function(c,r){const s=new It(c,r!==void 0?r:It.BuiltInSemantics._getSemantics()),p=function(_){if(!(_ instanceof h))throw new TypeError("Semantics expected a MatchResult, but got "+te(_));if(_.failed())throw new TypeError("cannot apply Semantics to "+_.toString());const M=_._cst;if(M.grammar!==c)throw new Error("Cannot use a MatchResult from grammar '"+M.grammar.name+"' with a semantics for '"+c.name+"'");const Z=new De(_.input);return s.wrap(M,Z.interval(_._cstOffset,_.input.length))};return p.addOperation=function(g,_){return s.addOperationOrAttribute("operation",g,_),p},p.extendOperation=function(g,_){return s.extendOperationOrAttribute("operation",g,_),p},p.addAttribute=function(g,_){return s.addOperationOrAttribute("attribute",g,_),p},p.extendAttribute=function(g,_){return s.extendOperationOrAttribute("attribute",g,_),p},p._getActionDict=function(g){const _=s.operations[g]||s.attributes[g];if(!_)throw new Error('"'+g+'" is not a valid operation or attribute name in this semantics for "'+c.name+'"');return _.actionDict},p._remove=function(g){let _;return g in s.operations?(_=s.operations[g],delete s.operations[g]):g in s.attributes&&(_=s.attributes[g],delete s.attributes[g]),delete s.Wrapper.prototype[g],_},p.getOperationNames=function(){return Object.keys(s.operations)},p.getAttributeNames=function(){return Object.keys(s.attributes)},p.getGrammar=function(){return s.grammar},p.toRecipe=function(g){return s.toRecipe(g)},p.toString=s.toString.bind(s),p._getSemantics=function(){return s},p};class ye{constructor(r,s,p,g){this.name=r,this.formals=s,this.actionDict=p,this.builtInDefault=g}checkActionDict(r){r._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(r,s){try{const{ctorName:p}=s._node;let g=this.actionDict[p];return g?(nt.push([this,p]),g.apply(s,s._children())):s.isNonterminal()&&(g=this.actionDict._nonterminal,g)?(nt.push([this,"_nonterminal",p]),g.apply(s,s._children())):(nt.push([this,"default action",p]),this.actionDict._default.apply(s,s._children()))}finally{nt.pop()}}}ye.prototype.typeName="operation";class Ve extends ye{constructor(r,s,p){super(r,[],s,p)}execute(r,s){const p=s._node,g=r.attributeKeys[this.name];return tr(p,g)||(p[g]=ye.prototype.execute.call(this,r,s)),p[g]}}Ve.prototype.typeName="attribute";const ut=["_iter","_terminal","_nonterminal","_default"];function Ke(c){return Object.keys(c.rules).sort().map(r=>c.rules[r])}const xt=c=>c.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");let qt,gt;class et{constructor(r,s,p,g){if(this.name=r,this.superGrammar=s,this.rules=p,g){if(!(g in p))throw new Error("Invalid start rule: '"+g+"' is not a rule in grammar '"+r+"'");this.defaultStartRule=g}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new Se(this)}isBuiltIn(){return this===et.ProtoBuiltInRules||this===et.BuiltInRules}equals(r){if(this===r)return!0;if(r==null||this.name!==r.name||this.defaultStartRule!==r.defaultStartRule||!(this.superGrammar===r.superGrammar||this.superGrammar.equals(r.superGrammar)))return!1;const s=Ke(this),p=Ke(r);return s.length===p.length&&s.every((g,_)=>g.description===p[_].description&&g.formals.join(",")===p[_].formals.join(",")&&g.body.toString()===p[_].body.toString())}match(r,s){const p=this.matcher();return p.replaceInputRange(0,0,r),p.match(s)}trace(r,s){const p=this.matcher();return p.replaceInputRange(0,0,r),p.trace(s)}createSemantics(){return It.createSemantics(this)}extendSemantics(r){return It.createSemantics(this,r._getSemantics())}_checkTopDownActionDict(r,s,p){const g=[];for(const _ in p){const M=p[_];if(!ut.includes(_)&&!(_ in this.rules)){g.push(`'${_}' is not a valid semantic action for '${this.name}'`);continue}if(typeof M!="function"){g.push(`'${_}' must be a function in an action dictionary for '${this.name}'`);continue}const Y=M.length,ue=this._topDownActionArity(_);if(Y!==ue){let G;_==="_iter"||_==="_nonterminal"?G=`it should use a rest parameter, e.g. \`${_}(...children) {}\`. NOTE: this is new in Ohm v16  see https://ohmjs.org/d/ati for details.`:G=`expected ${ue}, got ${Y}`,g.push(`Semantic action '${_}' has the wrong arity: ${G}`)}}if(g.length>0){const _=g.map(Z=>"- "+Z),M=new Error([`Found errors in the action dictionary of the '${s}' ${r}:`,..._].join(`
`));throw M.problems=g,M}}_topDownActionArity(r){return ut.includes(r)?0:this.rules[r].body.getArity()}_inheritsFrom(r){let s=this.superGrammar;for(;s;){if(s.equals(r,!0))return!0;s=s.superGrammar}return!1}toRecipe(r=void 0){const s={};this.source&&(s.source=this.source.contents);let p=null;this.defaultStartRule&&(p=this.defaultStartRule);const g={};Object.keys(this.rules).forEach(Z=>{const Y=this.rules[Z],{body:ue}=Y,G=!this.superGrammar||!this.superGrammar.rules[Z];let W;G?W="define":W=ue instanceof ie?"extend":"override";const se={};if(Y.source&&this.source){const pt=Y.source.relativeTo(this.source);se.sourceInterval=[pt.startIdx,pt.endIdx]}const Ie=G?Y.description:null,ze=ue.outputRecipe(Y.formals,this.source);g[Z]=[W,se,Ie,Y.formals,ze]});let _="null";r?_=r:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(_=this.superGrammar.toRecipe());const M=[...["grammar",s,this.name].map(JSON.stringify),_,...[p,g].map(JSON.stringify)];return xt(`[${M.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const r=new w;r.append("{");let s=!0;for(const p in this.rules){const{body:g}=this.rules[p];s?s=!1:r.append(","),r.append(`
`),r.append("  "),this.addSemanticActionTemplate(p,g,r)}return r.append(`
}`),r.contents()}addSemanticActionTemplate(r,s,p){p.append(r),p.append(": function(");const g=this._topDownActionArity(r);p.append(o("_",g).join(", ")),p.append(`) {
`),p.append("  }")}parseApplication(r){let s;if(r.indexOf("<")===-1)s=new ee(r);else{const g=qt.match(r,"Base_application");s=gt(g,{})}if(!(s.ruleName in this.rules))throw Te(s.ruleName,this.name);const{formals:p}=this.rules[s.ruleName];if(p.length!==s.args.length){const{source:g}=this.rules[s.ruleName];throw K(s.ruleName,p.length,s.args.length,g)}return s}_setUpMatchState(r){this._matchStateInitializer&&this._matchStateInitializer(r)}}et.ProtoBuiltInRules=new et("ProtoBuiltInRules",void 0,{any:{body:D,formals:[],description:"any character",primitive:!0},end:{body:B,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new Ft(new F(0)),formals:["str"],primitive:!0},lower:{body:new Ee("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new Ee("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new Ee("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new le(new ee("space")),formals:[]},space:{body:new v("\0"," "),formals:[],description:"a space"}}),et.initApplicationParser=function(c,r){qt=c,gt=r};class kt{constructor(r){this.name=r}sourceInterval(r,s){return this.source.subInterval(r,s-r)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?et.ProtoBuiltInRules:et.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(r,s){const p=this.ensureSuperGrammar().rules[r];if(!p)throw P(r,this.superGrammar.name,s);return p}installOverriddenOrExtendedRule(r,s,p,g){const _=m(s);if(_.length>0)throw H(r,_,g);const M=this.ensureSuperGrammar().rules[r],Z=M.formals,Y=Z?Z.length:0;if(s.length!==Y)throw K(r,Y,s.length,g);return this.install(r,s,p,M.description,g)}install(r,s,p,g,_,M=!1){return this.rules[r]={body:p.introduceParams(s),formals:s,description:g,source:_,primitive:M},this}withSuperGrammar(r){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=r,this.rules=Object.create(r.rules),r.isBuiltIn()||(this.defaultStartRule=r.defaultStartRule),this}withDefaultStartRule(r){return this.defaultStartRule=r,this}withSource(r){return this.source=new De(r).interval(0,r.length),this}build(){const r=new et(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);r._matchStateInitializer=r.superGrammar._matchStateInitializer,r.supportsIncrementalParsing=r.superGrammar.supportsIncrementalParsing;const s=[];let p=!1;return Object.keys(r.rules).forEach(g=>{const{body:_}=r.rules[g];try{_.assertChoicesHaveUniformArity(g)}catch(M){s.push(M)}try{_.assertAllApplicationsAreValid(g,r)}catch(M){s.push(M),p=!0}}),p||Object.keys(r.rules).forEach(g=>{const{body:_}=r.rules[g];try{_.assertIteratedExprsAreNotNullable(r,[])}catch(M){s.push(M)}}),s.length>0&&at(s),this.source&&(r.source=this.source),r}define(r,s,p,g,_,M){if(this.ensureSuperGrammar(),this.superGrammar.rules[r])throw R(r,this.name,this.superGrammar.name,_);if(this.rules[r])throw R(r,this.name,this.name,_);const Z=m(s);if(Z.length>0)throw H(r,Z,_);return this.install(r,s,p,g,_,M)}override(r,s,p,g,_){return this.ensureSuperGrammarRuleForOverriding(r,_),this.installOverriddenOrExtendedRule(r,s,p,_),this}extend(r,s,p,g,_){if(!this.ensureSuperGrammar().rules[r])throw $(r,this.superGrammar.name,_);const Z=new ie(this.superGrammar,r,p);return Z.source=p.source,this.installOverriddenOrExtendedRule(r,s,Z,_),this}}class St{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(r){return new kt(r)}grammar(r,s,p,g,_){const M=new kt(s);return p&&M.withSuperGrammar(p instanceof et?p:this.fromRecipe(p)),g&&M.withDefaultStartRule(g),r&&r.source&&M.withSource(r.source),this.currentDecl=M,Object.keys(_).forEach(Z=>{this.currentRuleName=Z;const Y=_[Z],ue=Y[0],G=Y[1],W=Y[2],se=Y[3],Ie=this.fromRecipe(Y[4]);let ze;M.source&&G&&G.sourceInterval&&(ze=M.source.subInterval(G.sourceInterval[0],G.sourceInterval[1]-G.sourceInterval[0])),M[ue](Z,se,Ie,W,ze)}),this.currentRuleName=this.currentDecl=null,M.build()}terminal(r){return new N(r)}range(r,s){return new v(r,s)}param(r){return new F(r)}alt(...r){let s=[];for(let p of r)p instanceof U||(p=this.fromRecipe(p)),p instanceof z?s=s.concat(p.terms):s.push(p);return s.length===1?s[0]:new z(s)}seq(...r){let s=[];for(let p of r)p instanceof U||(p=this.fromRecipe(p)),p instanceof J?s=s.concat(p.factors):s.push(p);return s.length===1?s[0]:new J(s)}star(r){return r instanceof U||(r=this.fromRecipe(r)),new le(r)}plus(r){return r instanceof U||(r=this.fromRecipe(r)),new ke(r)}opt(r){return r instanceof U||(r=this.fromRecipe(r)),new qe(r)}not(r){return r instanceof U||(r=this.fromRecipe(r)),new ve(r)}lookahead(r){return r instanceof U||(r=this.fromRecipe(r)),new ge(r)}lex(r){return r instanceof U||(r=this.fromRecipe(r)),new Ue(r)}app(r,s){return s&&s.length>0&&(s=s.map(function(p){return p instanceof U?p:this.fromRecipe(p)},this)),new ee(r,s)}splice(r,s){return new me(this.currentDecl.superGrammar,this.currentRuleName,r.map(p=>this.fromRecipe(p)),s.map(p=>this.fromRecipe(p)))}fromRecipe(r){const s=r[0]==="grammar"?r.slice(1):r.slice(2),p=this[r[0]](...s),g=r[1];return g&&g.sourceInterval&&this.currentDecl&&p.withSource(this.currentDecl.sourceInterval(...g.sourceInterval)),p}}function Qe(c){return typeof c=="function"?c.call(new St):(typeof c=="string"&&(c=JSON.parse(c)),new St().fromRecipe(c))}var vt=Qe(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);et.BuiltInRules=vt,ne(et.BuiltInRules);var wr=Qe(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0",""]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]);const ot=Object.create(U.prototype);function Ir(c,r){for(const s in c)if(s===r)return!0;return!1}function rr(c,r,s){const p=new St;let g,_,M,Z=!1;return(s||wr).createSemantics().addOperation("visit",{Grammars(G){return G.children.map(W=>W.visit())},Grammar(G,W,se,Ie,ze){const pt=G.visit();g=p.newGrammar(pt),W.child(0)&&W.child(0).visit(),Ie.children.map(xr=>xr.visit());const yt=g.build();if(yt.source=this.source.trimmed(),Ir(r,pt))throw Ae(yt);return r[pt]=yt,yt},SuperGrammar(G,W){const se=W.visit();if(se==="null")g.withSuperGrammar(null);else{if(!r||!Ir(r,se))throw ae(se,r,W.source);g.withSuperGrammar(r[se])}},Rule_define(G,W,se,Ie,ze){_=G.visit(),M=W.children.map(Wr=>Wr.visit())[0]||[],!g.defaultStartRule&&g.ensureSuperGrammar()!==et.ProtoBuiltInRules&&g.withDefaultStartRule(_);const pt=ze.visit(),yt=se.children.map(Wr=>Wr.visit())[0],xr=this.source.trimmed();return g.define(_,M,pt,yt,xr)},Rule_override(G,W,se,Ie){_=G.visit(),M=W.children.map(yt=>yt.visit())[0]||[];const ze=this.source.trimmed();g.ensureSuperGrammarRuleForOverriding(_,ze),Z=!0;const pt=Ie.visit();return Z=!1,g.override(_,M,pt,null,ze)},Rule_extend(G,W,se,Ie){_=G.visit(),M=W.children.map(yt=>yt.visit())[0]||[];const ze=Ie.visit(),pt=this.source.trimmed();return g.extend(_,M,ze,null,pt)},RuleBody(G,W){return p.alt(...W.visit()).withSource(this.source)},OverrideRuleBody(G,W){const se=W.visit(),Ie=se.indexOf(ot);if(Ie>=0){const ze=se.slice(0,Ie),pt=se.slice(Ie+1);return pt.forEach(yt=>{if(yt===ot)throw be(yt)}),new me(g.superGrammar,_,ze,pt).withSource(this.source)}else return p.alt(...se).withSource(this.source)},Formals(G,W,se){return W.visit()},Params(G,W,se){return W.visit()},Alt(G){return p.alt(...G.visit()).withSource(this.source)},TopLevelTerm_inline(G,W){const se=_+"_"+W.visit(),Ie=G.visit(),ze=this.source.trimmed(),pt=!(g.superGrammar&&g.superGrammar.rules[se]);Z&&!pt?g.override(se,M,Ie,null,ze):g.define(se,M,Ie,null,ze);const yt=M.map(xr=>p.app(xr));return p.app(se,yt).withSource(Ie.source)},OverrideTopLevelTerm_superSplice(G){return ot},Seq(G){return p.seq(...G.children.map(W=>W.visit())).withSource(this.source)},Iter_star(G,W){return p.star(G.visit()).withSource(this.source)},Iter_plus(G,W){return p.plus(G.visit()).withSource(this.source)},Iter_opt(G,W){return p.opt(G.visit()).withSource(this.source)},Pred_not(G,W){return p.not(W.visit()).withSource(this.source)},Pred_lookahead(G,W){return p.lookahead(W.visit()).withSource(this.source)},Lex_lex(G,W){return p.lex(W.visit()).withSource(this.source)},Base_application(G,W){const se=W.children.map(Ie=>Ie.visit())[0]||[];return p.app(G.visit(),se).withSource(this.source)},Base_range(G,W,se){return p.range(G.visit(),se.visit()).withSource(this.source)},Base_terminal(G){return p.terminal(G.visit()).withSource(this.source)},Base_paren(G,W,se){return W.visit()},ruleDescr(G,W,se){return W.visit()},ruleDescrText(G){return this.sourceString.trim()},caseName(G,W,se,Ie,ze){return se.visit()},name(G,W){return this.sourceString},nameFirst(G){},nameRest(G){},terminal(G,W,se){return W.children.map(Ie=>Ie.visit()).join("")},oneCharTerminal(G,W,se){return W.visit()},escapeChar(G){try{return j(this.sourceString)}catch(W){throw W instanceof RangeError&&W.message.startsWith("Invalid code point ")?Le(G):W}},NonemptyListOf(G,W,se){return[G.visit()].concat(se.children.map(Ie=>Ie.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(c).visit()}var zt=Qe(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);Lr(et.BuiltInRules),pr(zt);function Lr(c){const r={empty(){return this.iteration()},nonEmpty(s,p,g){return this.iteration([s].concat(g.children))}};It.BuiltInSemantics=It.createSemantics(c,null).addOperation("asIteration",{emptyListOf:r.empty,nonemptyListOf:r.nonEmpty,EmptyListOf:r.empty,NonemptyListOf:r.nonEmpty})}function pr(c){It.prototypeGrammarSemantics=c.createSemantics().addOperation("parse",{AttributeSignature(r){return{name:r.parse(),formals:[]}},OperationSignature(r,s){return{name:r.parse(),formals:s.children.map(p=>p.parse())[0]||[]}},Formals(r,s,p){return s.asIteration().children.map(g=>g.parse())},name(r,s){return this.sourceString}}),It.prototypeGrammar=c}function Ys(c){let r=0;const s=[0],p=()=>s[s.length-1],g={},_=/( *).*(?:$|\r?\n|\r)/g;let M;for(;(M=_.exec(c))!=null;){const[Z,Y]=M;if(Z.length===0)break;const ue=Y.length,G=p(),W=r+ue;if(ue>G)s.push(ue),g[W]=1;else if(ue<G){const se=s.length;for(;p()!==ue;)s.pop();g[W]=-1*(se-s.length)}r+=Z.length}return s.length>1&&(g[r]=1-s.length),g}const Ri="an indented block",Ni="a dedent",Li=1114112;class Zs extends De{constructor(r){super(r.input),this.state=r}_indentationAt(r){return this.state.userData[r]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Li):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Li):super.nextCodePoint()}}class Di extends U{constructor(r=!0){super(),this.isIndent=r}allowsSkippingPrecedingSpace(){return!0}eval(r){const{inputStream:s}=r,p=r.userData;r.doNotMemoize=!0;const g=s.pos,_=this.isIndent?1:-1;return(p[g]||0)*_>0?(r.userData=Object.create(p),r.userData[g]-=_,r.pushBinding(new _e(0),g),!0):(r.processFailure(g,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(r,s){}_isNullable(r,s){return!1}assertChoicesHaveUniformArity(r){}assertIteratedExprsAreNotNullable(r){}introduceParams(r){return this}substituteParams(r){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(r){const s=this.isIndent?Ri:Ni;return new rt(this,s,"description")}}const Qs=new ee("indent"),Xs=new ee("dedent"),ea=new me(vt,"any",[Qs,Xs],[]),Mi=new St().newGrammar("IndentationSensitive").withSuperGrammar(vt).define("indent",[],new Di(!0),Ri,void 0,!0).define("dedent",[],new Di(!1),Ni,void 0,!0).extend("any",[],ea,"any character",void 0).build();Object.assign(Mi,{_matchStateInitializer(c){c.userData=Ys(c.input),c.inputStream=new Zs(c)},supportsIncrementalParsing:!1});const ta="17.1.0";et.initApplicationParser(wr,rr);const ra=c=>!!c.constructor&&typeof c.constructor.isBuffer=="function"&&c.constructor.isBuffer(c);function na(c,r){const s=wr.match(c,"Grammars");if(s.failed())throw k(s);return rr(s,r)}function ia(c,r){const s=$i(c,r),p=Object.keys(s);if(p.length===0)throw new Error("Missing grammar definition");if(p.length>1){const _=s[p[1]].source;throw new Error(Xt(_.sourceString,_.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return s[p[0]]}function $i(c,r){const s=Object.create(r||{});if(typeof c!="string")if(ra(c))c=c.toString();else throw new TypeError("Expected string as first argument, got "+te(c));return na(c,s),s}return jt.ExperimentalIndentationSensitive=Mi,jt._buildGrammar=rr,jt.grammar=ia,jt.grammars=$i,jt.makeRecipe=Qe,jt.ohmGrammar=wr,jt.pexprs=Bn,jt.version=ta,jt}var Hn,Zi;function qs(){if(Zi)return Hn;Zi=1;const{makeRecipe:n}=cl();return Hn=n(["grammar",{source:`PEP508 {
    // Grammar adapted from https://peps.python.org/pep-0508/#complete-grammar
    // (naming retained, just reordered and camelCased)
    File = ListOf<Line, "\\n">
    Line = Req? comment?
    Req = UrlReq | NameReq | RequirementsReq | ConstraintsReq

    NameReq = Name Extras? VersionSpec QuotedMarker?
    UrlReq  = Name Extras? UrlSpec (space QuotedMarker)?
    Extras  = "[" ListOf<identifier, ","> "]"
    Name    = identifier
    identifier    = alnum identifierEnd*
    identifierEnd = alnum -- single
                  | (("-" | "_" | "." )* alnum) -- multi

    // Requirements based on other requirements files (not in PEP 508, but supported by pip)
    RequirementsReq = "-r" filePath
    ConstraintsReq  = "-c" filePath
    filePath        = (~("\\n" | "#") any)+

    UrlSpec      = "@" uriReference
    uriReference = uri | relativeRef
    uri          = scheme ":" hierPart? ("?" query )? ("#" fragment)?
    hierPart     = ("//" authority pathAbempty) -- abempty
                 | pathAbsolute -- absolute
                 | pathRootless -- rootless
    absoluteUri  = scheme ":" hierPart? ("?" query )?
    relativeRef  = relativePart? ("?" query )? ("#" fragment )?
    relativePart = "//" authority pathAbempty -- abempty
                 | pathAbsolute -- absolute
                 | pathNoscheme -- noscheme
    scheme       = letter (alnum | "+" | "-" | ".")*
    authority    = (userinfo "@" )? host (":" port )?
    userinfo     = (unreserved | pctEncoded | subDelims | ":")*
    host         = ipLiteral | ipv4Address | regName
    port         = digit*
    ipLiteral    = "[" (ipv6Address | ipvFuture) "]"
    ipvFuture    = "v" hexdig+ "." (unreserved | subDelims | ":")+
    ipv6Address  = (hexdig | ":" | ".")+ // dumbed down a lot, mostly due to lack of quantifier support in Ohm
    ipv4Address  = decOctet "." decOctet "." decOctet "." decOctet
    nz           = ~"0" digit
    decOctet     = digit -- zeroToNine
                 | nz digit -- tenToNinetyNine
                 | "1" digit digit -- oneHundredToOneNinetyNine
                 | "2" ("0" | "1" | "2" | "3" | "4") digit -- twoHundredToTwoFortyNine
                 | "25" ("0" | "1" | "2" | "3" | "4" | "5") -- twoFiftyToTwoFiftyFive
    regName      = (unreserved | pctEncoded | subDelims)*
    path         = pathAbempty // begins with "/" or is empty
                 | pathAbsolute // begins with "/" but not "//"
                 | pathNoscheme // begins with a non-colon segment
                 | pathRootless // begins with a segment
    pathAbempty  = ("/" segment)*
    pathAbsolute = "/" (segmentNz ("/" segment)* )?
    pathNoscheme = segmentNzNc ("/" segment)*
    pathRootless = segmentNz ("/" segment)*
    segment      = pchar*
    segmentNz    = pchar+
    segmentNzNc  = (unreserved | pctEncoded | subDelims | "@")+ // non-zero-length segment without any colon ":"
    pchar        = unreserved | pctEncoded | subDelims | ":" | "@"
    query        = (pchar | "/" | "?")*
    fragment     = (pchar | "/" | "?")*
    pctEncoded   = "%" hexdig
    unreserved   = alnum | "-" | "." | "_" | "~"
    reserved     = genDelims | subDelims
    genDelims    = ":" | "/" | "?" | "#" | "(" | ")?" | "@"
    subDelims    = "!" | "$" | "&" | "'" | "(" | ")" | "*" | "+" | "," | ";" | "="
    hexdig       = digit | "a" | "A" | "b" | "B" | "c" | "C" | "d" | "D" | "e" | "E" | "f" | "F"

    // Environment markers
    QuotedMarker  = ";" Marker
    Marker        = MarkerOr
    MarkerOr      = MarkerAnd "or" MarkerAnd -- node
                  | MarkerAnd -- leaf
    MarkerAnd     = MarkerExpr "and" MarkerExpr -- node
                  | MarkerExpr -- leaf
    MarkerExpr    = MarkerVar markerOp MarkerVar -- leaf
                  | "(" Marker ")" -- node
    MarkerVar     = envVar | pythonStr
    markerOp      = versionCmp -- versionCmp
                  | "in" -- in
                  | ("not" space+ "in") -- notIn
    pythonStr     = "'" (pythonStrChar | "\\"")* "'"
                  | "\\"" (pythonStrChar | "'")* "\\""
    pythonStrChar = space | alnum | "(" | ")" | "." | "{" | "}" | "-" | "_" | "*" | "#" | ":" | ";" | "," | "/" | "?"
                  | "[" | "]" | "!" | "~" | "\`" | "@" | "$" | "%" | "^" | "&" | "=" | "+" | "|" | "<" | ">"
    envVar        = "python_version" | "python_full_version" | "os_name" | "sys_platform" | "platform_release"
                  | "platform_system" | "platform_version" | "platform_machine" | "platform_python_implementation"
                  | "implementation_name" | "implementation_version" | "extra" // ONLY when defined by a containing layer

    // Version specifiers, defined in PEP 440 (https://peps.python.org/pep-0440/)
    VersionSpec   = "(" VersionMany ")" -- parenthesized
                  | VersionMany -- direct
    VersionMany   = ListOf<VersionOne, ",">
    VersionOne    = versionCmp version
    versionCmp    = "<=" | "<" | "!=" | "==" | ">=" | ">" | "~=" | "==="
    version       = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+

    comment = "#" (~"\\n" any)*

    space := " " | "\\t" // Overriding Ohm's definition of whitespace to kick out newlines and other Unicode whitespace

    // Loose grammar for parsing unfinished requirements - focused on extracting the name, extras, and version spec
    LooseFile         = ListOf<LooseLine, "\\n">
    LooseLine         = LooseReq comment?
    LooseReq          = LooseNonNameReq | LooseNameReq
    LooseNameReq      = Name LooseExtras? LooseVersionSpec LooseQuotedMarker?
    LooseNonNameReq   = (~(~(Name "@") Name) looseAnything) // Non-name req can start with Name only if followed by "@"
    LooseExtras       = "[" (ListOf<identifier, ","> "]"?)?
    LooseQuotedMarker = ";" looseAnything
    LooseVersionSpec  = "(" (LooseVersionMany ")"?)? -- parenthesized
                      | LooseVersionMany -- direct
    LooseVersionMany  = ListOf<LooseVersionOne, ","> ","?
    LooseVersionOne   = (looseVersionCmp looseVersion?)?
    looseVersionCmp   = ("<" | "=" | "!" | ">" | "~")+
    looseVersion      = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+
    looseAnything     = (~("\\n" | "#") any)* // Any non-comment line content
}`},"PEP508",null,"File",{File:["define",{sourceInterval:[148,173]},null,[],["app",{sourceInterval:[155,173]},"ListOf",[["app",{sourceInterval:[162,166]},"Line",[]],["terminal",{sourceInterval:[168,172]},`
`]]]],Line:["define",{sourceInterval:[178,198]},null,[],["seq",{sourceInterval:[185,198]},["opt",{sourceInterval:[185,189]},["app",{sourceInterval:[185,188]},"Req",[]]],["opt",{sourceInterval:[190,198]},["app",{sourceInterval:[190,197]},"comment",[]]]]],Req:["define",{sourceInterval:[203,260]},null,[],["alt",{sourceInterval:[209,260]},["app",{sourceInterval:[209,215]},"UrlReq",[]],["app",{sourceInterval:[218,225]},"NameReq",[]],["app",{sourceInterval:[228,243]},"RequirementsReq",[]],["app",{sourceInterval:[246,260]},"ConstraintsReq",[]]]],NameReq:["define",{sourceInterval:[266,314]},null,[],["seq",{sourceInterval:[276,314]},["app",{sourceInterval:[276,280]},"Name",[]],["opt",{sourceInterval:[281,288]},["app",{sourceInterval:[281,287]},"Extras",[]]],["app",{sourceInterval:[289,300]},"VersionSpec",[]],["opt",{sourceInterval:[301,314]},["app",{sourceInterval:[301,313]},"QuotedMarker",[]]]]],UrlReq:["define",{sourceInterval:[319,371]},null,[],["seq",{sourceInterval:[329,371]},["app",{sourceInterval:[329,333]},"Name",[]],["opt",{sourceInterval:[334,341]},["app",{sourceInterval:[334,340]},"Extras",[]]],["app",{sourceInterval:[342,349]},"UrlSpec",[]],["opt",{sourceInterval:[350,371]},["seq",{sourceInterval:[351,369]},["app",{sourceInterval:[351,356]},"space",[]],["app",{sourceInterval:[357,369]},"QuotedMarker",[]]]]]],Extras:["define",{sourceInterval:[376,417]},null,[],["seq",{sourceInterval:[386,417]},["terminal",{sourceInterval:[386,389]},"["],["app",{sourceInterval:[390,413]},"ListOf",[["app",{sourceInterval:[397,407]},"identifier",[]],["terminal",{sourceInterval:[409,412]},","]]],["terminal",{sourceInterval:[414,417]},"]"]]],Name:["define",{sourceInterval:[422,442]},null,[],["app",{sourceInterval:[432,442]},"identifier",[]]],identifier:["define",{sourceInterval:[447,483]},null,[],["seq",{sourceInterval:[463,483]},["app",{sourceInterval:[463,468]},"alnum",[]],["star",{sourceInterval:[469,483]},["app",{sourceInterval:[469,482]},"identifierEnd",[]]]]],identifierEnd_single:["define",{sourceInterval:[504,519]},null,[],["app",{sourceInterval:[504,509]},"alnum",[]]],identifierEnd_multi:["define",{sourceInterval:[540,576]},null,[],["seq",{sourceInterval:[540,567]},["star",{sourceInterval:[541,560]},["alt",{sourceInterval:[542,557]},["terminal",{sourceInterval:[542,545]},"-"],["terminal",{sourceInterval:[548,551]},"_"],["terminal",{sourceInterval:[554,557]},"."]]],["app",{sourceInterval:[561,566]},"alnum",[]]]],identifierEnd:["define",{sourceInterval:[488,576]},null,[],["alt",{sourceInterval:[504,576]},["app",{sourceInterval:[504,509]},"identifierEnd_single",[]],["app",{sourceInterval:[540,567]},"identifierEnd_multi",[]]]],RequirementsReq:["define",{sourceInterval:[675,706]},null,[],["seq",{sourceInterval:[693,706]},["terminal",{sourceInterval:[693,697]},"-r"],["app",{sourceInterval:[698,706]},"filePath",[]]]],ConstraintsReq:["define",{sourceInterval:[711,742]},null,[],["seq",{sourceInterval:[729,742]},["terminal",{sourceInterval:[729,733]},"-c"],["app",{sourceInterval:[734,742]},"filePath",[]]]],filePath:["define",{sourceInterval:[747,785]},null,[],["plus",{sourceInterval:[765,785]},["seq",{sourceInterval:[766,783]},["not",{sourceInterval:[766,779]},["alt",{sourceInterval:[768,778]},["terminal",{sourceInterval:[768,772]},`
`],["terminal",{sourceInterval:[775,778]},"#"]]],["app",{sourceInterval:[780,783]},"any",[]]]]],UrlSpec:["define",{sourceInterval:[791,822]},null,[],["seq",{sourceInterval:[806,822]},["terminal",{sourceInterval:[806,809]},"@"],["app",{sourceInterval:[810,822]},"uriReference",[]]]],uriReference:["define",{sourceInterval:[827,859]},null,[],["alt",{sourceInterval:[842,859]},["app",{sourceInterval:[842,845]},"uri",[]],["app",{sourceInterval:[848,859]},"relativeRef",[]]]],uri:["define",{sourceInterval:[864,929]},null,[],["seq",{sourceInterval:[879,929]},["app",{sourceInterval:[879,885]},"scheme",[]],["terminal",{sourceInterval:[886,889]},":"],["opt",{sourceInterval:[890,899]},["app",{sourceInterval:[890,898]},"hierPart",[]]],["opt",{sourceInterval:[900,913]},["seq",{sourceInterval:[901,910]},["terminal",{sourceInterval:[901,904]},"?"],["app",{sourceInterval:[905,910]},"query",[]]]],["opt",{sourceInterval:[914,929]},["seq",{sourceInterval:[915,927]},["terminal",{sourceInterval:[915,918]},"#"],["app",{sourceInterval:[919,927]},"fragment",[]]]]]],hierPart_abempty:["define",{sourceInterval:[949,988]},null,[],["seq",{sourceInterval:[949,977]},["terminal",{sourceInterval:[950,954]},"//"],["app",{sourceInterval:[955,964]},"authority",[]],["app",{sourceInterval:[965,976]},"pathAbempty",[]]]],hierPart_absolute:["define",{sourceInterval:[1008,1032]},null,[],["app",{sourceInterval:[1008,1020]},"pathAbsolute",[]]],hierPart_rootless:["define",{sourceInterval:[1052,1076]},null,[],["app",{sourceInterval:[1052,1064]},"pathRootless",[]]],hierPart:["define",{sourceInterval:[934,1076]},null,[],["alt",{sourceInterval:[949,1076]},["app",{sourceInterval:[949,977]},"hierPart_abempty",[]],["app",{sourceInterval:[1008,1020]},"hierPart_absolute",[]],["app",{sourceInterval:[1052,1064]},"hierPart_rootless",[]]]],absoluteUri:["define",{sourceInterval:[1081,1130]},null,[],["seq",{sourceInterval:[1096,1130]},["app",{sourceInterval:[1096,1102]},"scheme",[]],["terminal",{sourceInterval:[1103,1106]},":"],["opt",{sourceInterval:[1107,1116]},["app",{sourceInterval:[1107,1115]},"hierPart",[]]],["opt",{sourceInterval:[1117,1130]},["seq",{sourceInterval:[1118,1127]},["terminal",{sourceInterval:[1118,1121]},"?"],["app",{sourceInterval:[1122,1127]},"query",[]]]]]],relativeRef:["define",{sourceInterval:[1135,1194]},null,[],["seq",{sourceInterval:[1150,1194]},["opt",{sourceInterval:[1150,1163]},["app",{sourceInterval:[1150,1162]},"relativePart",[]]],["opt",{sourceInterval:[1164,1177]},["seq",{sourceInterval:[1165,1174]},["terminal",{sourceInterval:[1165,1168]},"?"],["app",{sourceInterval:[1169,1174]},"query",[]]]],["opt",{sourceInterval:[1178,1194]},["seq",{sourceInterval:[1179,1191]},["terminal",{sourceInterval:[1179,1182]},"#"],["app",{sourceInterval:[1183,1191]},"fragment",[]]]]]],relativePart_abempty:["define",{sourceInterval:[1214,1251]},null,[],["seq",{sourceInterval:[1214,1240]},["terminal",{sourceInterval:[1214,1218]},"//"],["app",{sourceInterval:[1219,1228]},"authority",[]],["app",{sourceInterval:[1229,1240]},"pathAbempty",[]]]],relativePart_absolute:["define",{sourceInterval:[1271,1295]},null,[],["app",{sourceInterval:[1271,1283]},"pathAbsolute",[]]],relativePart_noscheme:["define",{sourceInterval:[1315,1339]},null,[],["app",{sourceInterval:[1315,1327]},"pathNoscheme",[]]],relativePart:["define",{sourceInterval:[1199,1339]},null,[],["alt",{sourceInterval:[1214,1339]},["app",{sourceInterval:[1214,1240]},"relativePart_abempty",[]],["app",{sourceInterval:[1271,1283]},"relativePart_absolute",[]],["app",{sourceInterval:[1315,1327]},"relativePart_noscheme",[]]]],scheme:["define",{sourceInterval:[1344,1392]},null,[],["seq",{sourceInterval:[1359,1392]},["app",{sourceInterval:[1359,1365]},"letter",[]],["star",{sourceInterval:[1366,1392]},["alt",{sourceInterval:[1367,1390]},["app",{sourceInterval:[1367,1372]},"alnum",[]],["terminal",{sourceInterval:[1375,1378]},"+"],["terminal",{sourceInterval:[1381,1384]},"-"],["terminal",{sourceInterval:[1387,1390]},"."]]]]],authority:["define",{sourceInterval:[1397,1446]},null,[],["seq",{sourceInterval:[1412,1446]},["opt",{sourceInterval:[1412,1428]},["seq",{sourceInterval:[1413,1425]},["app",{sourceInterval:[1413,1421]},"userinfo",[]],["terminal",{sourceInterval:[1422,1425]},"@"]]],["app",{sourceInterval:[1429,1433]},"host",[]],["opt",{sourceInterval:[1434,1446]},["seq",{sourceInterval:[1435,1443]},["terminal",{sourceInterval:[1435,1438]},":"],["app",{sourceInterval:[1439,1443]},"port",[]]]]]],userinfo:["define",{sourceInterval:[1451,1510]},null,[],["star",{sourceInterval:[1466,1510]},["alt",{sourceInterval:[1467,1508]},["app",{sourceInterval:[1467,1477]},"unreserved",[]],["app",{sourceInterval:[1480,1490]},"pctEncoded",[]],["app",{sourceInterval:[1493,1502]},"subDelims",[]],["terminal",{sourceInterval:[1505,1508]},":"]]]],host:["define",{sourceInterval:[1515,1563]},null,[],["alt",{sourceInterval:[1530,1563]},["app",{sourceInterval:[1530,1539]},"ipLiteral",[]],["app",{sourceInterval:[1542,1553]},"ipv4Address",[]],["app",{sourceInterval:[1556,1563]},"regName",[]]]],port:["define",{sourceInterval:[1568,1589]},null,[],["star",{sourceInterval:[1583,1589]},["app",{sourceInterval:[1583,1588]},"digit",[]]]],ipLiteral:["define",{sourceInterval:[1594,1642]},null,[],["seq",{sourceInterval:[1609,1642]},["terminal",{sourceInterval:[1609,1612]},"["],["alt",{sourceInterval:[1614,1637]},["app",{sourceInterval:[1614,1625]},"ipv6Address",[]],["app",{sourceInterval:[1628,1637]},"ipvFuture",[]]],["terminal",{sourceInterval:[1639,1642]},"]"]]],ipvFuture:["define",{sourceInterval:[1647,1709]},null,[],["seq",{sourceInterval:[1662,1709]},["terminal",{sourceInterval:[1662,1665]},"v"],["plus",{sourceInterval:[1666,1673]},["app",{sourceInterval:[1666,1672]},"hexdig",[]]],["terminal",{sourceInterval:[1674,1677]},"."],["plus",{sourceInterval:[1678,1709]},["alt",{sourceInterval:[1679,1707]},["app",{sourceInterval:[1679,1689]},"unreserved",[]],["app",{sourceInterval:[1692,1701]},"subDelims",[]],["terminal",{sourceInterval:[1704,1707]},":"]]]]],ipv6Address:["define",{sourceInterval:[1714,1750]},null,[],["plus",{sourceInterval:[1729,1750]},["alt",{sourceInterval:[1730,1748]},["app",{sourceInterval:[1730,1736]},"hexdig",[]],["terminal",{sourceInterval:[1739,1742]},":"],["terminal",{sourceInterval:[1745,1748]},"."]]]],ipv4Address:["define",{sourceInterval:[1825,1887]},null,[],["seq",{sourceInterval:[1840,1887]},["app",{sourceInterval:[1840,1848]},"decOctet",[]],["terminal",{sourceInterval:[1849,1852]},"."],["app",{sourceInterval:[1853,1861]},"decOctet",[]],["terminal",{sourceInterval:[1862,1865]},"."],["app",{sourceInterval:[1866,1874]},"decOctet",[]],["terminal",{sourceInterval:[1875,1878]},"."],["app",{sourceInterval:[1879,1887]},"decOctet",[]]]],nz:["define",{sourceInterval:[1892,1917]},null,[],["seq",{sourceInterval:[1907,1917]},["not",{sourceInterval:[1907,1911]},["terminal",{sourceInterval:[1908,1911]},"0"]],["app",{sourceInterval:[1912,1917]},"digit",[]]]],decOctet_zeroToNine:["define",{sourceInterval:[1937,1956]},null,[],["app",{sourceInterval:[1937,1942]},"digit",[]]],decOctet_tenToNinetyNine:["define",{sourceInterval:[1976,2003]},null,[],["seq",{sourceInterval:[1976,1984]},["app",{sourceInterval:[1976,1978]},"nz",[]],["app",{sourceInterval:[1979,1984]},"digit",[]]]],decOctet_oneHundredToOneNinetyNine:["define",{sourceInterval:[2023,2067]},null,[],["seq",{sourceInterval:[2023,2038]},["terminal",{sourceInterval:[2023,2026]},"1"],["app",{sourceInterval:[2027,2032]},"digit",[]],["app",{sourceInterval:[2033,2038]},"digit",[]]]],decOctet_twoHundredToTwoFortyNine:["define",{sourceInterval:[2087,2154]},null,[],["seq",{sourceInterval:[2087,2126]},["terminal",{sourceInterval:[2087,2090]},"2"],["alt",{sourceInterval:[2092,2119]},["terminal",{sourceInterval:[2092,2095]},"0"],["terminal",{sourceInterval:[2098,2101]},"1"],["terminal",{sourceInterval:[2104,2107]},"2"],["terminal",{sourceInterval:[2110,2113]},"3"],["terminal",{sourceInterval:[2116,2119]},"4"]],["app",{sourceInterval:[2121,2126]},"digit",[]]]],decOctet_twoFiftyToTwoFiftyFive:["define",{sourceInterval:[2174,2240]},null,[],["seq",{sourceInterval:[2174,2214]},["terminal",{sourceInterval:[2174,2178]},"25"],["alt",{sourceInterval:[2180,2213]},["terminal",{sourceInterval:[2180,2183]},"0"],["terminal",{sourceInterval:[2186,2189]},"1"],["terminal",{sourceInterval:[2192,2195]},"2"],["terminal",{sourceInterval:[2198,2201]},"3"],["terminal",{sourceInterval:[2204,2207]},"4"],["terminal",{sourceInterval:[2210,2213]},"5"]]]],decOctet:["define",{sourceInterval:[1922,2240]},null,[],["alt",{sourceInterval:[1937,2240]},["app",{sourceInterval:[1937,1942]},"decOctet_zeroToNine",[]],["app",{sourceInterval:[1976,1984]},"decOctet_tenToNinetyNine",[]],["app",{sourceInterval:[2023,2038]},"decOctet_oneHundredToOneNinetyNine",[]],["app",{sourceInterval:[2087,2126]},"decOctet_twoHundredToTwoFortyNine",[]],["app",{sourceInterval:[2174,2214]},"decOctet_twoFiftyToTwoFiftyFive",[]]]],regName:["define",{sourceInterval:[2245,2298]},null,[],["star",{sourceInterval:[2260,2298]},["alt",{sourceInterval:[2261,2296]},["app",{sourceInterval:[2261,2271]},"unreserved",[]],["app",{sourceInterval:[2274,2284]},"pctEncoded",[]],["app",{sourceInterval:[2287,2296]},"subDelims",[]]]]],path:["define",{sourceInterval:[2303,2523]},null,[],["alt",{sourceInterval:[2318,2523]},["app",{sourceInterval:[2318,2329]},"pathAbempty",[]],["app",{sourceInterval:[2380,2392]},"pathAbsolute",[]],["app",{sourceInterval:[2444,2456]},"pathNoscheme",[]],["app",{sourceInterval:[2511,2523]},"pathRootless",[]]]],pathAbempty:["define",{sourceInterval:[2553,2582]},null,[],["star",{sourceInterval:[2568,2582]},["seq",{sourceInterval:[2569,2580]},["terminal",{sourceInterval:[2569,2572]},"/"],["app",{sourceInterval:[2573,2580]},"segment",[]]]]],pathAbsolute:["define",{sourceInterval:[2587,2634]},null,[],["seq",{sourceInterval:[2602,2634]},["terminal",{sourceInterval:[2602,2605]},"/"],["opt",{sourceInterval:[2606,2634]},["seq",{sourceInterval:[2607,2631]},["app",{sourceInterval:[2607,2616]},"segmentNz",[]],["star",{sourceInterval:[2617,2631]},["seq",{sourceInterval:[2618,2629]},["terminal",{sourceInterval:[2618,2621]},"/"],["app",{sourceInterval:[2622,2629]},"segment",[]]]]]]]],pathNoscheme:["define",{sourceInterval:[2639,2680]},null,[],["seq",{sourceInterval:[2654,2680]},["app",{sourceInterval:[2654,2665]},"segmentNzNc",[]],["star",{sourceInterval:[2666,2680]},["seq",{sourceInterval:[2667,2678]},["terminal",{sourceInterval:[2667,2670]},"/"],["app",{sourceInterval:[2671,2678]},"segment",[]]]]]],pathRootless:["define",{sourceInterval:[2685,2724]},null,[],["seq",{sourceInterval:[2700,2724]},["app",{sourceInterval:[2700,2709]},"segmentNz",[]],["star",{sourceInterval:[2710,2724]},["seq",{sourceInterval:[2711,2722]},["terminal",{sourceInterval:[2711,2714]},"/"],["app",{sourceInterval:[2715,2722]},"segment",[]]]]]],segment:["define",{sourceInterval:[2729,2750]},null,[],["star",{sourceInterval:[2744,2750]},["app",{sourceInterval:[2744,2749]},"pchar",[]]]],segmentNz:["define",{sourceInterval:[2755,2776]},null,[],["plus",{sourceInterval:[2770,2776]},["app",{sourceInterval:[2770,2775]},"pchar",[]]]],segmentNzNc:["define",{sourceInterval:[2781,2840]},null,[],["plus",{sourceInterval:[2796,2840]},["alt",{sourceInterval:[2797,2838]},["app",{sourceInterval:[2797,2807]},"unreserved",[]],["app",{sourceInterval:[2810,2820]},"pctEncoded",[]],["app",{sourceInterval:[2823,2832]},"subDelims",[]],["terminal",{sourceInterval:[2835,2838]},"@"]]]],pchar:["define",{sourceInterval:[2894,2956]},null,[],["alt",{sourceInterval:[2909,2956]},["app",{sourceInterval:[2909,2919]},"unreserved",[]],["app",{sourceInterval:[2922,2932]},"pctEncoded",[]],["app",{sourceInterval:[2935,2944]},"subDelims",[]],["terminal",{sourceInterval:[2947,2950]},":"],["terminal",{sourceInterval:[2953,2956]},"@"]]],query:["define",{sourceInterval:[2961,2996]},null,[],["star",{sourceInterval:[2976,2996]},["alt",{sourceInterval:[2977,2994]},["app",{sourceInterval:[2977,2982]},"pchar",[]],["terminal",{sourceInterval:[2985,2988]},"/"],["terminal",{sourceInterval:[2991,2994]},"?"]]]],fragment:["define",{sourceInterval:[3001,3036]},null,[],["star",{sourceInterval:[3016,3036]},["alt",{sourceInterval:[3017,3034]},["app",{sourceInterval:[3017,3022]},"pchar",[]],["terminal",{sourceInterval:[3025,3028]},"/"],["terminal",{sourceInterval:[3031,3034]},"?"]]]],pctEncoded:["define",{sourceInterval:[3041,3066]},null,[],["seq",{sourceInterval:[3056,3066]},["terminal",{sourceInterval:[3056,3059]},"%"],["app",{sourceInterval:[3060,3066]},"hexdig",[]]]],unreserved:["define",{sourceInterval:[3071,3115]},null,[],["alt",{sourceInterval:[3086,3115]},["app",{sourceInterval:[3086,3091]},"alnum",[]],["terminal",{sourceInterval:[3094,3097]},"-"],["terminal",{sourceInterval:[3100,3103]},"."],["terminal",{sourceInterval:[3106,3109]},"_"],["terminal",{sourceInterval:[3112,3115]},"~"]]],reserved:["define",{sourceInterval:[3120,3156]},null,[],["alt",{sourceInterval:[3135,3156]},["app",{sourceInterval:[3135,3144]},"genDelims",[]],["app",{sourceInterval:[3147,3156]},"subDelims",[]]]],genDelims:["define",{sourceInterval:[3161,3216]},null,[],["alt",{sourceInterval:[3176,3216]},["terminal",{sourceInterval:[3176,3179]},":"],["terminal",{sourceInterval:[3182,3185]},"/"],["terminal",{sourceInterval:[3188,3191]},"?"],["terminal",{sourceInterval:[3194,3197]},"#"],["terminal",{sourceInterval:[3200,3203]},"("],["terminal",{sourceInterval:[3206,3210]},")?"],["terminal",{sourceInterval:[3213,3216]},"@"]]],subDelims:["define",{sourceInterval:[3221,3299]},null,[],["alt",{sourceInterval:[3236,3299]},["terminal",{sourceInterval:[3236,3239]},"!"],["terminal",{sourceInterval:[3242,3245]},"$"],["terminal",{sourceInterval:[3248,3251]},"&"],["terminal",{sourceInterval:[3254,3257]},"'"],["terminal",{sourceInterval:[3260,3263]},"("],["terminal",{sourceInterval:[3266,3269]},")"],["terminal",{sourceInterval:[3272,3275]},"*"],["terminal",{sourceInterval:[3278,3281]},"+"],["terminal",{sourceInterval:[3284,3287]},","],["terminal",{sourceInterval:[3290,3293]},";"],["terminal",{sourceInterval:[3296,3299]},"="]]],hexdig:["define",{sourceInterval:[3304,3396]},null,[],["alt",{sourceInterval:[3319,3396]},["app",{sourceInterval:[3319,3324]},"digit",[]],["terminal",{sourceInterval:[3327,3330]},"a"],["terminal",{sourceInterval:[3333,3336]},"A"],["terminal",{sourceInterval:[3339,3342]},"b"],["terminal",{sourceInterval:[3345,3348]},"B"],["terminal",{sourceInterval:[3351,3354]},"c"],["terminal",{sourceInterval:[3357,3360]},"C"],["terminal",{sourceInterval:[3363,3366]},"d"],["terminal",{sourceInterval:[3369,3372]},"D"],["terminal",{sourceInterval:[3375,3378]},"e"],["terminal",{sourceInterval:[3381,3384]},"E"],["terminal",{sourceInterval:[3387,3390]},"f"],["terminal",{sourceInterval:[3393,3396]},"F"]]],QuotedMarker:["define",{sourceInterval:[3429,3455]},null,[],["seq",{sourceInterval:[3445,3455]},["terminal",{sourceInterval:[3445,3448]},";"],["app",{sourceInterval:[3449,3455]},"Marker",[]]]],Marker:["define",{sourceInterval:[3460,3484]},null,[],["app",{sourceInterval:[3476,3484]},"MarkerOr",[]]],MarkerOr_node:["define",{sourceInterval:[3505,3537]},null,[],["seq",{sourceInterval:[3505,3529]},["app",{sourceInterval:[3505,3514]},"MarkerAnd",[]],["terminal",{sourceInterval:[3515,3519]},"or"],["app",{sourceInterval:[3520,3529]},"MarkerAnd",[]]]],MarkerOr_leaf:["define",{sourceInterval:[3558,3575]},null,[],["app",{sourceInterval:[3558,3567]},"MarkerAnd",[]]],MarkerOr:["define",{sourceInterval:[3489,3575]},null,[],["alt",{sourceInterval:[3505,3575]},["app",{sourceInterval:[3505,3529]},"MarkerOr_node",[]],["app",{sourceInterval:[3558,3567]},"MarkerOr_leaf",[]]]],MarkerAnd_node:["define",{sourceInterval:[3596,3631]},null,[],["seq",{sourceInterval:[3596,3623]},["app",{sourceInterval:[3596,3606]},"MarkerExpr",[]],["terminal",{sourceInterval:[3607,3612]},"and"],["app",{sourceInterval:[3613,3623]},"MarkerExpr",[]]]],MarkerAnd_leaf:["define",{sourceInterval:[3652,3670]},null,[],["app",{sourceInterval:[3652,3662]},"MarkerExpr",[]]],MarkerAnd:["define",{sourceInterval:[3580,3670]},null,[],["alt",{sourceInterval:[3596,3670]},["app",{sourceInterval:[3596,3623]},"MarkerAnd_node",[]],["app",{sourceInterval:[3652,3662]},"MarkerAnd_leaf",[]]]],MarkerExpr_leaf:["define",{sourceInterval:[3691,3727]},null,[],["seq",{sourceInterval:[3691,3719]},["app",{sourceInterval:[3691,3700]},"MarkerVar",[]],["app",{sourceInterval:[3701,3709]},"markerOp",[]],["app",{sourceInterval:[3710,3719]},"MarkerVar",[]]]],MarkerExpr_node:["define",{sourceInterval:[3748,3770]},null,[],["seq",{sourceInterval:[3748,3762]},["terminal",{sourceInterval:[3748,3751]},"("],["app",{sourceInterval:[3752,3758]},"Marker",[]],["terminal",{sourceInterval:[3759,3762]},")"]]],MarkerExpr:["define",{sourceInterval:[3675,3770]},null,[],["alt",{sourceInterval:[3691,3770]},["app",{sourceInterval:[3691,3719]},"MarkerExpr_leaf",[]],["app",{sourceInterval:[3748,3762]},"MarkerExpr_node",[]]]],MarkerVar:["define",{sourceInterval:[3775,3809]},null,[],["alt",{sourceInterval:[3791,3809]},["app",{sourceInterval:[3791,3797]},"envVar",[]],["app",{sourceInterval:[3800,3809]},"pythonStr",[]]]],markerOp_versionCmp:["define",{sourceInterval:[3830,3854]},null,[],["app",{sourceInterval:[3830,3840]},"versionCmp",[]]],markerOp_in:["define",{sourceInterval:[3875,3885]},null,[],["terminal",{sourceInterval:[3875,3879]},"in"]],markerOp_notIn:["define",{sourceInterval:[3906,3934]},null,[],["seq",{sourceInterval:[3906,3925]},["terminal",{sourceInterval:[3907,3912]},"not"],["plus",{sourceInterval:[3913,3919]},["app",{sourceInterval:[3913,3918]},"space",[]]],["terminal",{sourceInterval:[3920,3924]},"in"]]],markerOp:["define",{sourceInterval:[3814,3934]},null,[],["alt",{sourceInterval:[3830,3934]},["app",{sourceInterval:[3830,3840]},"markerOp_versionCmp",[]],["app",{sourceInterval:[3875,3879]},"markerOp_in",[]],["app",{sourceInterval:[3906,3925]},"markerOp_notIn",[]]]],pythonStr:["define",{sourceInterval:[3939,4039]},null,[],["alt",{sourceInterval:[3955,4039]},["seq",{sourceInterval:[3955,3986]},["terminal",{sourceInterval:[3955,3958]},"'"],["star",{sourceInterval:[3959,3982]},["alt",{sourceInterval:[3960,3980]},["app",{sourceInterval:[3960,3973]},"pythonStrChar",[]],["terminal",{sourceInterval:[3976,3980]},'"']]],["terminal",{sourceInterval:[3983,3986]},"'"]],["seq",{sourceInterval:[4007,4039]},["terminal",{sourceInterval:[4007,4011]},'"'],["star",{sourceInterval:[4012,4034]},["alt",{sourceInterval:[4013,4032]},["app",{sourceInterval:[4013,4026]},"pythonStrChar",[]],["terminal",{sourceInterval:[4029,4032]},"'"]]],["terminal",{sourceInterval:[4035,4039]},'"']]]],pythonStrChar:["define",{sourceInterval:[4044,4265]},null,[],["alt",{sourceInterval:[4060,4265]},["app",{sourceInterval:[4060,4065]},"space",[]],["app",{sourceInterval:[4068,4073]},"alnum",[]],["terminal",{sourceInterval:[4076,4079]},"("],["terminal",{sourceInterval:[4082,4085]},")"],["terminal",{sourceInterval:[4088,4091]},"."],["terminal",{sourceInterval:[4094,4097]},"{"],["terminal",{sourceInterval:[4100,4103]},"}"],["terminal",{sourceInterval:[4106,4109]},"-"],["terminal",{sourceInterval:[4112,4115]},"_"],["terminal",{sourceInterval:[4118,4121]},"*"],["terminal",{sourceInterval:[4124,4127]},"#"],["terminal",{sourceInterval:[4130,4133]},":"],["terminal",{sourceInterval:[4136,4139]},";"],["terminal",{sourceInterval:[4142,4145]},","],["terminal",{sourceInterval:[4148,4151]},"/"],["terminal",{sourceInterval:[4154,4157]},"?"],["terminal",{sourceInterval:[4178,4181]},"["],["terminal",{sourceInterval:[4184,4187]},"]"],["terminal",{sourceInterval:[4190,4193]},"!"],["terminal",{sourceInterval:[4196,4199]},"~"],["terminal",{sourceInterval:[4202,4205]},"`"],["terminal",{sourceInterval:[4208,4211]},"@"],["terminal",{sourceInterval:[4214,4217]},"$"],["terminal",{sourceInterval:[4220,4223]},"%"],["terminal",{sourceInterval:[4226,4229]},"^"],["terminal",{sourceInterval:[4232,4235]},"&"],["terminal",{sourceInterval:[4238,4241]},"="],["terminal",{sourceInterval:[4244,4247]},"+"],["terminal",{sourceInterval:[4250,4253]},"|"],["terminal",{sourceInterval:[4256,4259]},"<"],["terminal",{sourceInterval:[4262,4265]},">"]]],envVar:["define",{sourceInterval:[4270,4570]},null,[],["alt",{sourceInterval:[4286,4570]},["terminal",{sourceInterval:[4286,4302]},"python_version"],["terminal",{sourceInterval:[4305,4326]},"python_full_version"],["terminal",{sourceInterval:[4329,4338]},"os_name"],["terminal",{sourceInterval:[4341,4355]},"sys_platform"],["terminal",{sourceInterval:[4358,4376]},"platform_release"],["terminal",{sourceInterval:[4397,4414]},"platform_system"],["terminal",{sourceInterval:[4417,4435]},"platform_version"],["terminal",{sourceInterval:[4438,4456]},"platform_machine"],["terminal",{sourceInterval:[4459,4491]},"platform_python_implementation"],["terminal",{sourceInterval:[4512,4533]},"implementation_name"],["terminal",{sourceInterval:[4536,4560]},"implementation_version"],["terminal",{sourceInterval:[4563,4570]},"extra"]]],VersionSpec_parenthesized:["define",{sourceInterval:[4717,4753]},null,[],["seq",{sourceInterval:[4717,4736]},["terminal",{sourceInterval:[4717,4720]},"("],["app",{sourceInterval:[4721,4732]},"VersionMany",[]],["terminal",{sourceInterval:[4733,4736]},")"]]],VersionSpec_direct:["define",{sourceInterval:[4774,4795]},null,[],["app",{sourceInterval:[4774,4785]},"VersionMany",[]]],VersionSpec:["define",{sourceInterval:[4701,4795]},null,[],["alt",{sourceInterval:[4717,4795]},["app",{sourceInterval:[4717,4736]},"VersionSpec_parenthesized",[]],["app",{sourceInterval:[4774,4785]},"VersionSpec_direct",[]]]],VersionMany:["define",{sourceInterval:[4800,4839]},null,[],["app",{sourceInterval:[4816,4839]},"ListOf",[["app",{sourceInterval:[4823,4833]},"VersionOne",[]],["terminal",{sourceInterval:[4835,4838]},","]]]],VersionOne:["define",{sourceInterval:[4844,4878]},null,[],["seq",{sourceInterval:[4860,4878]},["app",{sourceInterval:[4860,4870]},"versionCmp",[]],["app",{sourceInterval:[4871,4878]},"version",[]]]],versionCmp:["define",{sourceInterval:[4883,4951]},null,[],["alt",{sourceInterval:[4899,4951]},["terminal",{sourceInterval:[4899,4903]},"<="],["terminal",{sourceInterval:[4906,4909]},"<"],["terminal",{sourceInterval:[4912,4916]},"!="],["terminal",{sourceInterval:[4919,4923]},"=="],["terminal",{sourceInterval:[4926,4930]},">="],["terminal",{sourceInterval:[4933,4936]},">"],["terminal",{sourceInterval:[4939,4943]},"~="],["terminal",{sourceInterval:[4946,4951]},"==="]]],version:["define",{sourceInterval:[4956,5017]},null,[],["plus",{sourceInterval:[4972,5017]},["alt",{sourceInterval:[4973,5014]},["app",{sourceInterval:[4973,4978]},"alnum",[]],["terminal",{sourceInterval:[4981,4984]},"-"],["terminal",{sourceInterval:[4987,4990]},"_"],["terminal",{sourceInterval:[4993,4996]},"."],["terminal",{sourceInterval:[4999,5002]},"*"],["terminal",{sourceInterval:[5005,5008]},"+"],["terminal",{sourceInterval:[5011,5014]},"!"]]]],comment:["define",{sourceInterval:[5023,5049]},null,[],["seq",{sourceInterval:[5033,5049]},["terminal",{sourceInterval:[5033,5036]},"#"],["star",{sourceInterval:[5037,5049]},["seq",{sourceInterval:[5038,5047]},["not",{sourceInterval:[5038,5043]},["terminal",{sourceInterval:[5039,5043]},`
`]],["app",{sourceInterval:[5044,5047]},"any",[]]]]]],space:["override",{sourceInterval:[5055,5074]},null,[],["alt",{sourceInterval:[5064,5074]},["terminal",{sourceInterval:[5064,5067]}," "],["terminal",{sourceInterval:[5070,5074]},"	"]]],LooseFile:["define",{sourceInterval:[5291,5334]},null,[],["app",{sourceInterval:[5311,5334]},"ListOf",[["app",{sourceInterval:[5318,5327]},"LooseLine",[]],["terminal",{sourceInterval:[5329,5333]},`
`]]]],LooseLine:["define",{sourceInterval:[5339,5376]},null,[],["seq",{sourceInterval:[5359,5376]},["app",{sourceInterval:[5359,5367]},"LooseReq",[]],["opt",{sourceInterval:[5368,5376]},["app",{sourceInterval:[5368,5375]},"comment",[]]]]],LooseReq:["define",{sourceInterval:[5381,5431]},null,[],["alt",{sourceInterval:[5401,5431]},["app",{sourceInterval:[5401,5416]},"LooseNonNameReq",[]],["app",{sourceInterval:[5419,5431]},"LooseNameReq",[]]]],LooseNameReq:["define",{sourceInterval:[5436,5509]},null,[],["seq",{sourceInterval:[5456,5509]},["app",{sourceInterval:[5456,5460]},"Name",[]],["opt",{sourceInterval:[5461,5473]},["app",{sourceInterval:[5461,5472]},"LooseExtras",[]]],["app",{sourceInterval:[5474,5490]},"LooseVersionSpec",[]],["opt",{sourceInterval:[5491,5509]},["app",{sourceInterval:[5491,5508]},"LooseQuotedMarker",[]]]]],LooseNonNameReq:["define",{sourceInterval:[5514,5569]},null,[],["seq",{sourceInterval:[5534,5569]},["not",{sourceInterval:[5535,5554]},["seq",{sourceInterval:[5537,5553]},["not",{sourceInterval:[5537,5548]},["seq",{sourceInterval:[5539,5547]},["app",{sourceInterval:[5539,5543]},"Name",[]],["terminal",{sourceInterval:[5544,5547]},"@"]]],["app",{sourceInterval:[5549,5553]},"Name",[]]]],["app",{sourceInterval:[5555,5568]},"looseAnything",[]]]],LooseExtras:["define",{sourceInterval:[5634,5689]},null,[],["seq",{sourceInterval:[5654,5689]},["terminal",{sourceInterval:[5654,5657]},"["],["opt",{sourceInterval:[5658,5689]},["seq",{sourceInterval:[5659,5687]},["app",{sourceInterval:[5659,5682]},"ListOf",[["app",{sourceInterval:[5666,5676]},"identifier",[]],["terminal",{sourceInterval:[5678,5681]},","]]],["opt",{sourceInterval:[5683,5687]},["terminal",{sourceInterval:[5683,5686]},"]"]]]]]],LooseQuotedMarker:["define",{sourceInterval:[5694,5731]},null,[],["seq",{sourceInterval:[5714,5731]},["terminal",{sourceInterval:[5714,5717]},";"],["app",{sourceInterval:[5718,5731]},"looseAnything",[]]]],LooseVersionSpec_parenthesized:["define",{sourceInterval:[5756,5801]},null,[],["seq",{sourceInterval:[5756,5784]},["terminal",{sourceInterval:[5756,5759]},"("],["opt",{sourceInterval:[5760,5784]},["seq",{sourceInterval:[5761,5782]},["app",{sourceInterval:[5761,5777]},"LooseVersionMany",[]],["opt",{sourceInterval:[5778,5782]},["terminal",{sourceInterval:[5778,5781]},")"]]]]]],LooseVersionSpec_direct:["define",{sourceInterval:[5826,5852]},null,[],["app",{sourceInterval:[5826,5842]},"LooseVersionMany",[]]],LooseVersionSpec:["define",{sourceInterval:[5736,5852]},null,[],["alt",{sourceInterval:[5756,5852]},["app",{sourceInterval:[5756,5784]},"LooseVersionSpec_parenthesized",[]],["app",{sourceInterval:[5826,5842]},"LooseVersionSpec_direct",[]]]],LooseVersionMany:["define",{sourceInterval:[5857,5910]},null,[],["seq",{sourceInterval:[5877,5910]},["app",{sourceInterval:[5877,5905]},"ListOf",[["app",{sourceInterval:[5884,5899]},"LooseVersionOne",[]],["terminal",{sourceInterval:[5901,5904]},","]]],["opt",{sourceInterval:[5906,5910]},["terminal",{sourceInterval:[5906,5909]},","]]]],LooseVersionOne:["define",{sourceInterval:[5915,5967]},null,[],["opt",{sourceInterval:[5935,5967]},["seq",{sourceInterval:[5936,5965]},["app",{sourceInterval:[5936,5951]},"looseVersionCmp",[]],["opt",{sourceInterval:[5952,5965]},["app",{sourceInterval:[5952,5964]},"looseVersion",[]]]]]],looseVersionCmp:["define",{sourceInterval:[5972,6022]},null,[],["plus",{sourceInterval:[5992,6022]},["alt",{sourceInterval:[5993,6020]},["terminal",{sourceInterval:[5993,5996]},"<"],["terminal",{sourceInterval:[5999,6002]},"="],["terminal",{sourceInterval:[6005,6008]},"!"],["terminal",{sourceInterval:[6011,6014]},">"],["terminal",{sourceInterval:[6017,6020]},"~"]]]],looseVersion:["define",{sourceInterval:[6027,6092]},null,[],["plus",{sourceInterval:[6047,6092]},["alt",{sourceInterval:[6048,6089]},["app",{sourceInterval:[6048,6053]},"alnum",[]],["terminal",{sourceInterval:[6056,6059]},"-"],["terminal",{sourceInterval:[6062,6065]},"_"],["terminal",{sourceInterval:[6068,6071]},"."],["terminal",{sourceInterval:[6074,6077]},"*"],["terminal",{sourceInterval:[6080,6083]},"+"],["terminal",{sourceInterval:[6086,6089]},"!"]]]],looseAnything:["define",{sourceInterval:[6097,6137]},null,[],["star",{sourceInterval:[6117,6137]},["seq",{sourceInterval:[6118,6135]},["not",{sourceInterval:[6118,6131]},["alt",{sourceInterval:[6120,6130]},["terminal",{sourceInterval:[6120,6124]},`
`],["terminal",{sourceInterval:[6127,6130]},"#"]]],["app",{sourceInterval:[6132,6135]},"any",[]]]]]}]),Hn}var Kr={},Qi;function Xi(){return Qi||(Qi=1,function(n){var e=Kr&&Kr.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(n,"__esModule",{value:!0}),n.RequirementsSyntaxError=n.semantics=void 0;const t=e(qs());n.semantics=t.default.createSemantics(),n.semantics.addOperation("extract",{File:a=>a.asIteration().children.map(u=>u.extract()).filter(Boolean),Line:(a,u)=>{var o;return((o=a.child(0))===null||o===void 0?void 0:o.extract())||null},NameReq:(a,u,o,m)=>{var E,x;return{type:"ProjectName",name:a.sourceString,versionSpec:o.extract(),extras:(E=u.child(0))===null||E===void 0?void 0:E.extract(),environmentMarkerTree:(x=m.child(0))===null||x===void 0?void 0:x.extract()}},UrlReq:(a,u,o,m,E)=>{var x,C;return{type:"ProjectURL",name:a.sourceString,url:o.extract(),extras:(x=u.child(0))===null||x===void 0?void 0:x.extract(),environmentMarkerTree:(C=E.child(0))===null||C===void 0?void 0:C.extract()}},Extras:(a,u,o)=>u.asIteration().children.map(m=>m.sourceString),RequirementsReq:(a,u)=>({type:"RequirementsFile",path:u.sourceString}),ConstraintsReq:(a,u)=>({type:"ConstraintsFile",path:u.sourceString}),UrlSpec:(a,u)=>u.sourceString,QuotedMarker:(a,u)=>u.extract(),MarkerOr_node:(a,u,o)=>({operator:"or",left:a.extract(),right:o.extract()}),MarkerAnd_node:(a,u,o)=>({operator:"and",left:a.extract(),right:o.extract()}),MarkerExpr_leaf:(a,u,o)=>({left:a.sourceString,operator:u.sourceString,right:o.sourceString}),MarkerExpr_node:(a,u,o)=>u.extract(),VersionSpec_parenthesized:(a,u,o)=>u.extract()||[],VersionMany:a=>{const u=a.asIteration().children;if(u.length!==0)return u.map(o=>o.extract())},VersionOne:(a,u)=>({operator:a.sourceString,version:u.sourceString})}),n.semantics.addOperation("extractLoosely",{LooseFile:a=>a.asIteration().children.map(u=>u.extractLoosely()).filter(Boolean),LooseLine:(a,u)=>{var o;return((o=a.child(0))===null||o===void 0?void 0:o.extractLoosely())||null},LooseNameReq:(a,u,o,m)=>({type:"ProjectName",name:a.sourceString}),LooseNonNameReq:a=>null});class i extends Error{}n.RequirementsSyntaxError=i}(Kr)),Kr}var kr={},es;function ul(){if(es)return kr;es=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.VersionOperator=kr.EnvironmentMarkerVariable=void 0;var n;(function(t){t.PythonVersion="python_version",t.PythonFullVersion="python_full_version",t.OsName="os_name",t.SysPlatform="sys_platform",t.PlatformRelease="platform_release",t.PlatformSystem="platform_system",t.PlatformVersion="platform_version",t.PlatformMachine="platform_machine",t.PlatformPythonImplementation="platform_python_implementation",t.ImplementationName="implementation_name",t.ImplementationVersion="implementation_version",t.Extra="extra"})(n||(kr.EnvironmentMarkerVariable=n={}));var e;return function(t){t.CompatibleRelease="~=",t.VersionMatching="==",t.VersionExclusion="!=",t.LessThanOrMatching="<=",t.GreaterThanOrMatching=">=",t.LessThan="<",t.GreaterThan=">",t.ArbitrarilyEqual="==="}(e||(kr.VersionOperator=e={})),kr}var ts;function pl(){return ts||(ts=1,function(n){var e=ir&&ir.__createBinding||(Object.create?function(O,w,T,j){j===void 0&&(j=T);var te=Object.getOwnPropertyDescriptor(w,T);(!te||("get"in te?!w.__esModule:te.writable||te.configurable))&&(te={enumerable:!0,get:function(){return w[T]}}),Object.defineProperty(O,j,te)}:function(O,w,T,j){j===void 0&&(j=T),O[j]=w[T]}),t=ir&&ir.__exportStar||function(O,w){for(var T in O)T!=="default"&&!Object.prototype.hasOwnProperty.call(w,T)&&e(w,O,T)},i=ir&&ir.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(n,"__esModule",{value:!0}),n.parsePipRequirementsLineLoosely=n.parsePipRequirementsFileLoosely=n.parsePipRequirementsLine=n.parsePipRequirementsFile=n.RequirementsSyntaxError=void 0;const a=i(qs()),u=Xi();var o=Xi();Object.defineProperty(n,"RequirementsSyntaxError",{enumerable:!0,get:function(){return o.RequirementsSyntaxError}}),t(ul(),n);function m(O){const w=a.default.match(O,"File");if(w.failed())throw new u.RequirementsSyntaxError(`Failed to parse requirements file. ${w.shortMessage}`);return(0,u.semantics)(w).extract()}n.parsePipRequirementsFile=m;function E(O){const w=a.default.match(O,"Line");if(w.failed())throw new u.RequirementsSyntaxError(`Failed to parse requirements line. ${w.shortMessage}`);return(0,u.semantics)(w).extract()}n.parsePipRequirementsLine=E;function x(O){const w=a.default.match(O,"LooseFile");if(w.failed())throw new u.RequirementsSyntaxError(`Failed to loosely parse requirements file. ${w.shortMessage}`);return(0,u.semantics)(w).extractLoosely()}n.parsePipRequirementsFileLoosely=x;function C(O){const w=a.default.match(O,"LooseLine");if(w.failed())throw new u.RequirementsSyntaxError(`Failed to loosely parse requirements line. ${w.shortMessage}`);return(0,u.semantics)(w).extractLoosely()}n.parsePipRequirementsLineLoosely=C}(ir)),ir}var dl=pl();function hl(n){return new Worker("/assets/pyworker-CA0UrV0i.js",{type:"module",name:n==null?void 0:n.name})}let fl=0;class ml{constructor(){this.pendingMessages=new Map}async init(e,t){this.workspace=e,this.vars=t??{},this.worker=new hl,this.worker.onmessage=i=>{this.handleWorkerMessage(i.data)},this.worker.onerror=i=>{console.error("Python Worker error:",i)},await this.sendMessage("init",{vars:this.vars}),await this.mountWorkspace(),await this.installDependencies()}handleWorkerMessage(e){if(e.id==="interrupt-buffer"){e.type==="success"?this.interruptBuffer=new Uint8Array(e.payload):this.interruptBuffer=void 0;return}if(e.type==="inputRequest"){const i=e.payload.prompt||"Input:",a=window.prompt(i);this.worker.postMessage({id:e.id,type:"inputResponse",payload:{value:a,cancelled:a===null}});return}if(e.type==="stdout"){this.stdoutCallback?this.stdoutCallback(e.payload):console.info(e.payload);return}if(e.type==="stderr"){this.stderrCallback?this.stderrCallback(e.payload):console.error(e.payload);return}const t=this.pendingMessages.get(e.id);t&&(this.pendingMessages.delete(e.id),e.type==="success"?t.resolve(e.payload):e.type==="error"&&t.reject(new Error(e.payload.message)))}async sendMessage(e,t){if(!this.worker)throw new Error("PyEnv not initialized yet: see init()");const i=`msg-${fl++}`,a={id:i,type:e,payload:t};return new Promise((u,o)=>{this.pendingMessages.set(i,{resolve:u,reject:o}),this.worker.postMessage(a)})}setStdoutCallback(e){this.stdoutCallback=e}setStderrCallback(e){this.stderrCallback=e}async runFunction(e,t){const i=await this.sendMessage("runFunction",{name:e,args:t});return sr(Hr,this.workspace),i}async setGlobal(e,t){await this.sendMessage("setGlobal",{key:e,value:t})}async mountWorkspace(e="/workspace"){const t=await Tt.getWorkspace();await this.sendMessage("mountWorkspace",{handle:t.getHandle(),mountPoint:e})}async installDependencies(){var t;const e=await((t=this.workspace)==null?void 0:t.getResource("requirements.txt"));if(e){const i=(await e.getContents()).replaceAll("\r",""),a=dl.parsePipRequirementsFile(i).filter(u=>"name"in u).map(u=>u.name);await this.loadPackages(a)}}async loadPackages(e){e.length>0&&await this.sendMessage("loadPackages",{packages:e})}async syncWorkspace(){await this.sendMessage("syncWorkspace"),sr(Hr,this.workspace)}async execCode(e){const t=await this.sendMessage("execCode",{code:e});return sr(Hr,this.workspace),t}async execScript(e){const t=e.split(".")[0],i=e.includes(":")?e.split(":").reverse()[0]:void 0;return await this.execModule(t,i)}async execModule(e,t){const i=await this.sendMessage("execModule",{moduleName:e,entryName:t,vars:this.vars});return sr(Hr,this.workspace),i}async getVersion(){return await this.sendMessage("getVersion")}canInterrupt(){return this.interruptBuffer!==void 0}interrupt(){this.interruptBuffer&&(this.interruptBuffer[0]=2)}close(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.pendingMessages.clear()}}class gl{constructor(){this.editorInputHandlers=[],this.listenersAttached=!1,Zt(li,()=>{})}setupEventListeners(e){if(this.listenersAttached)return;this.listenersAttached=!0;const t=u=>{const o=u.detail;o&&Array.from(o.querySelectorAll("*")).filter(E=>E instanceof Yt).forEach(E=>{mt.set(E),ei.set(E)})};e.addEventListener("tab-shown",t);const i=u=>{const o=u.detail;Array.from(o.querySelectorAll("*")).filter(E=>E instanceof Yt).forEach(E=>{mt.get()==E&&(mt.set(null),ei.set(null))})};e.addEventListener("tab-closed",i),_s(ti,u=>{const m=u.closest("wa-tab-panel").getAttribute("name");e.markDirty(m,u.isDirty())})}registerEditorInputHandler(e){this.editorInputHandlers.push(e),this.editorInputHandlers.sort((t,i)=>(i.ranking??0)-(t.ranking??0))}async handleInput(e){for(let t=0;t<this.editorInputHandlers.length;t++){const i=this.editorInputHandlers[t];if(i.canHandle(e))return await i.handle(e)}}getEditorArea(){return document.querySelector(`k-tabs#${ws}`)}async loadEditor(e){if(!e||("widgetFactory"in e||(e=await this.handleInput(e)),!e||!("widgetFactory"in e)))return;const t=this.getEditorArea();if(!t){console.error("Editor area not found. The split pane system may not be initialized yet.");return}if(this.setupEventListeners(t),t.has(e.key)){t.activate(e.key);return}t.open({name:e.key,label:e.title,icon:e.icon,closable:!0,noOverflow:e.noOverflow,component:e.widgetFactory})}}const gr=new gl;lr.put("editorRegistry",gr);const vl=`#  geo!space

**The Interactive Mapping IDE in Your Browser**
[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/erdalkaraca/geospace)
[![Browser Support](https://img.shields.io/badge/Chrome%20%7C%20Opera-Supported-brightgreen)](#-browser-compatibility)
[![AI Providers](https://img.shields.io/badge/AI%20Providers-5-blue)](#-ai-configuration)
[![PWA Ready](https://img.shields.io/badge/PWA-Ready-purple)](#-key-features)
[![No Installation](https://img.shields.io/badge/Installation-None%20Required-orange)](#-quick-start)

geo!space is a powerful web application that combines professional mapping capabilities with AI-powered automation tools. Create interactive maps, execute Python and JavaScript code, and automate repetitive tasks using natural language prompts - all without installing any software, directly in your browser.

##  Table of Contents

- [ Key Features](#-key-features)
- [ Browser Compatibility](#-browser-compatibility)
- [ Use Cases](#-use-cases)
- [ Getting Started](#-getting-started)
- [ Commands & Natural Language](#-commands--natural-language)
- [ Examples](#-examples)
- [ AI Configuration](#-ai-configuration)
- [ Troubleshooting](#-troubleshooting)
- [ FAQ](#-faq)
- [ Technical Architecture](#-technical-architecture)
- [ Trusted by](#-trusted-by)
- [ Quick Start](#-quick-start)

##  Key Features

###  **Professional Mapping**
- **Interactive Map Editor**: Create and edit maps using the custom \`.geospace\` format
- **Multiple Data Sources**: Support for OSM, GeoJSON, KML, GeoTIFF, GPX, Features, BM (basemap.de), and Overpass API
- **Layer Management**: Vector layers, tile layers, and layer groups with full styling control
- **OpenLayers Integration**: Built on the industry-standard OpenLayers mapping library
- **Advanced Styling**: Dynamic style loading and management system
- **PWA Transformation**: Convert \`.geospace\` files into cross-platform Progressive Web Apps

###  **AI-Powered Automation**
- **Multiple AI Providers**: Ollama, OpenAI, Groq, Cerebras, and WebLLM support
- **Context-Aware Assistants**: Specialized AI roles for mapping, coding, and general assistance
- **Local AI Support**: Run AI models locally using WebLLM or Ollama
- **Natural Language Commands**: Control the application using conversational prompts

###  **Development Environment**
- **Monaco Editor**: Full VS Code editor experience with syntax highlighting
- **Python Execution**: Complete Pyodide integration with package management and pip requirements
- **JavaScript Execution**: Direct browser JavaScript execution in workers
- **File System Access**: Direct browser integration with local files and workspace persistence
- **Dependency Management**: Automatic pip requirements handling and package installation

###  **Extensibility**
- **Extension System**: Browse, install, and uninstall extensions from the built-in extension manager
- **Built-in Extensions**: WebLLM, Python/JS terminals, Linux terminal
- **Extension Sources**: Add extensions from trusted URLs or the geo!space extension registry
- **Command Registry**: 20+ built-in commands + extensible command system
- **Build System**: Generate publishable maps from \`.geospace\` files

##  Browser Compatibility

** Important**: geo!space uses the File System Access API which has limited browser support.

-  **Fully Supported**: Chrome and Opera
-  **Limited Support**: Firefox and Safari (partial File System Access API support)

For more details, see [File System API](https://developer.mozilla.org/en-US/docs/Web/API/Window/showDirectoryPicker)

##  Use Cases

- **Data Analysts**: Create interactive maps for data visualization
- **Urban Planners**: Design and prototype mapping applications  
- **Developers**: Build geospatial applications without complex setup
- **Researchers**: Prototype location-based applications quickly
- **Educators**: Teach mapping and geospatial concepts interactively
- **App Creators**: Transform maps into cross-platform PWAs for mobile, desktop, and web deployment

##  Getting Started

### 1. **Connect a Workspace**
- In the Workspace tab, click the folder icon "Load workspace folder"
- Choose a local folder to use as your workspace
- This folder will be saved and restored when you reload geo!space

### 2. **Configure AI Assistant (Optional)**
- Open the settings editor using the settings button in the upper right corner
- Configure AI providers and models in the \`aiConfig\` section
- Set up API keys for your preferred AI services

### 3. **Working with Files**
- **\`.geospace\` files**: Map files that open in the interactive map editor
- **Python/JavaScript files**: Open in the Monaco code editor with syntax highlighting
- **Other files**: Open in the appropriate editor based on file type

### 4. **Creating Interactive Maps**
- Double-click \`.geospace\` files to open them in the map editor
- Use the map editor's UI to interact with layers, features, and styling
- Use the input field to run commands or interact with the map via natural language
- Add data sources: OSM tiles, GeoJSON files, KML, GeoTIFF, GPX, or custom features
- **Build PWA**: Use the "Build map" button to transform your \`.geospace\` file into a cross-platform Progressive Web App

### 5. **Code Development**
- Edit Python and JavaScript code in the Monaco editor
- Execute Python code using Pyodide (Python in the browser)
- Run JavaScript code directly in the browser
- Use the "Run" button to execute code snippets

### 6. **Resource Catalog**
- Browse the catalog view for curated maps, datasets, icons, and controls
- Select items from catalog categories (datasets, maps, overlays, controls, icons)
- Use the "Checkout" button to download items directly to your workspace
- Access pre-built basemaps (OpenStreetMap, basemap.de) and sample datasets

##  Commands & Natural Language

### **Slash Commands**
Use commands starting with \`/\` in the map editor's input field:

- \`/python\`: Execute Python code
- \`/js\`: Execute JavaScript code  
- \`/touch\`: Create a new, empty file
- \`/save\`: Save the current file
- \`/build_map\`: Build a publishable map from the current \`.geospace\` file

### **Rich Command Library**
geo!space includes 20+ built-in commands for mapping operations:
- **Map Navigation**: \`zoom_to_level\`, \`center_location\`
- **Layer Management**: \`add_layer\`, \`delete_layer\`, \`add_marker\`
- **Data Operations**: Import/export various geospatial formats
- **File Operations**: Create, save, and manage workspace files

### **Natural Language Interaction**
- **Map Editor**: Ask questions like "Add a marker at coordinates 52.5, 13.4" or "Change the style of all points to red"
- **Code Editor**: Request code assistance like "Create a function to calculate distance between two points"
- **General**: Ask about app features, get help with workflows, or request explanations

##  Examples

### **Create a City Map**
\`\`\`
1. /touch city-map.geospace
2. "Add OpenStreetMap as base layer"
3. "Download buildings in the current view"
4. "Download trees in the current view"
5. /build_map
\`\`\`

### **Custom App Development**
\`\`\`
1. Create map with /touch app.geospace
2. Add custom controls using JavaScript with prepackaged libraries (Lit, WebAwesome)
3. Write Python scripts for data processing
4. /build_map for cross-platform deployment
\`\`\`

##  AI Configuration

### **Context-Aware AI Assistants**
The AI assistant adapts its role based on your current context:

- ** Map Editor**: Specialized for mapping tasks, layer management, and geospatial operations
- ** Code Editor**: Focused on coding assistance, debugging, and code generation
- ** General App**: Helps with app navigation, features, and general workflows

Each assistant can be identified by its icon and help hint in the AI view.

### **AI Provider Setup**
Configure AI providers in the app settings (accessible via the settings button in the upper right corner). The settings are stored in IndexedDB under the \`settings.json\` section:

\`\`\`json
{
  "aiConfig": {
    "defaultProvider": "openai",
    "providers": [
      {
        "name": "ollama",
        "model": "gemma3:12b",
        "chatApiEndpoint": "http://localhost:11434/v1/chat/completions",
        "apiKey": ""
      },
      {
        "name": "openai",
        "model": "gpt-4.1",
        "chatApiEndpoint": "https://api.openai.com/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "groq",
        "model": "llama-3.1-8b-instant",
        "chatApiEndpoint": "https://api.groq.com/openai/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "cerebras",
        "model": "llama3.1-8b",
        "chatApiEndpoint": "https://api.cerebras.ai/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "webllm",
        "model": "gemma-2-9b-it-q4f16_1-MLC",
        "chatApiEndpoint": "",
        "apiKey": "",
        "parameters": {
          "context_window_size": 4096
        }
      }
    ]
  }
}
\`\`\`

**Setup Instructions:**
1. Open the settings editor using the settings button in the upper right corner
2. Replace \`<your api key>\` with your actual API keys for each provider
3. Set \`defaultProvider\` to your preferred provider name
4. For **Ollama**: Install locally and ensure it's running on \`localhost:11434\`
5. For **WebLLM**: No API key needed - runs models locally in the browser
   - ** GPU Requirement**: Requires a dedicated GPU with sufficient VRAM to run the selected model
   - Models like \`gemma-2-9b-it-q4f16_1-MLC\` typically need 8GB+ VRAM
6. Settings are automatically saved to IndexedDB - no manual file management required
7. You can change the default provider in the AI view after connecting to a workspace

##  Troubleshooting

### **Common Issues**

**File Not Found**
- If you don't see expected files, try reloading the workspace
- Ensure the workspace folder is properly connected

**AI Assistant Not Working**
- Verify settings are correctly configured in the app settings (stored in IndexedDB)
- Check that your API keys are valid and properly formatted
- For local providers (Ollama), ensure the service is running

**Browser Compatibility Issues**
- Use Chrome or Opera for full functionality
- Firefox and Safari have limited File System Access API support

**Map Not Loading**
- Check that \`.geospace\` files contain valid JSON
- Verify data source URLs are accessible
- Ensure required resources (icons, styles) are available

##  FAQ

**Q: Do I need to install anything?**
A: No! geo!space runs entirely in your browser. Just open it in Chrome or Opera.

**Q: Is my data secure?**
A: Yes. All data stays in your browser and local workspace. No data is sent to external servers unless you explicitly use AI services.

**Q: Can I use geo!space offline?**
A: Yes, for basic mapping features. AI assistance requires internet connection (except for local providers like Ollama/WebLLM).

**Q: How do I share my maps?**
A: Use the "Build map" button to create a PWA that can be deployed anywhere or shared as a standalone app.

**Q: What file formats are supported?**
A: Maps: \`.geospace\` (JSON), Data: GeoJSON, KML, GPX, GeoTIFF, Features, BM (basemap.de), Overpass API. Code: Python, JavaScript, and more.

**Q: Can I customize the interface?**
A: Yes! Install extensions, create custom controls using WebAwesome components, or add your own extensions.

**Q: What extensions are available?**
A: Built-in extensions include WebLLM, Python/JS terminals, Linux terminal, and more. Browse and install from the extension manager.

##  Technical Architecture

**Frontend Stack:**
- **Lit**: Web components framework
- **TypeScript**: Main development language  
- **Vite**: Build tool and development server
- **Monaco Editor**: VS Code's editor component
- **WebAwesome**: Web components library (also available for custom map controls)

**Mapping Stack:**
- **OpenLayers**: Professional mapping library
- **Custom Runtime**: Map-to-OpenLayers conversion system
- **Style Loader**: Dynamic style loading

**AI Stack:**
- **Multiple Providers**: Flexible AI provider system
- **WebLLM**: Local AI model execution
- **Context-Aware**: Specialized AI roles per context

##  Trusted by

- **[Kiosk Scout](https://finder.kioskscout.de)**: A cross-platform PWA for finding nearby vending machines
- **Want your geo!space app listed here?** Contact us!

---

##  Quick Start

**Get up and running in 3 minutes:**

1. **Open geo!space** in Chrome or Opera
2. **Connect workspace** - Click folder icon and select a local directory
3. **Create your first map** - Use \`/touch my-map.geospace\` or open existing files
4. **Try AI assistance** - Ask "Add a marker at [your location]" in the map editor
5. **Build your app** - Use \`/build_map\` to create a deployable PWA

### **First-Time Setup**
- **No AI needed**: Start mapping immediately without configuration
- **AI setup**: Open settings  configure API keys for enhanced assistance
- **Extensions**: Browse and install extensions from the extension manager

##  Ready to Start?

1. **Load the app** in Chrome or Opera
2. **Connect a workspace** folder
3. **Create your first map** or open an existing \`.geospace\` file
4. **Ask the AI** for help with mapping tasks
5. **Build and share** your interactive maps

**Happy mapping! **`,gn=`${pa}/settings.json`,Ei="events/settings/changed";class yl{async checkSettings(){this.appSettings||(this.appSettings=await Jr.getObject(gn),this.appSettings||(this.appSettings={},await Jr.persistObject(gn,this.appSettings)),sr(Ei,this.appSettings))}async get(e){return await this.checkSettings(),this.appSettings[e]}async set(e,t){await this.checkSettings(),this.appSettings[e]=t,await Jr.persistObject(gn,this.appSettings)}async getAll(){return await this.checkSettings(),this.appSettings}async setAll(e){this.appSettings=e,await Jr.persistObject(gn,this.appSettings)}}const Bt=new yl;lr.put("appSettings",Bt);dt({command:{id:"touch",name:"Create a file",description:"Creates a new file within the workspace",parameters:[{name:"path",description:"the path including name of the file to be created, must be relative to the workspace",required:!0},{name:"contents",description:"the textual contents of the file",required:!1}]},handler:{execute:async({params:{path:n,contents:e}})=>{if(!n)return;const i=await(await Tt.getWorkspace()).getResource(n,{create:!0});i?e&&await i.saveContents(e):console.log("could not create file: "+n)}}});dt({command:{id:"create_file",name:"Create new file",description:"Shows a popup to create a new file",parameters:[]},handler:{execute:async n=>{const e=await Tt.getWorkspace();if(!e){ct("Please select a workspace!");return}const t=prompt("Enter path to new file (directories will be created if not exist):");t&&await e.getResource(t,{create:!0})}}});dt({command:{id:"delete_resource",name:"Delete a resource (file or directory)",description:"Deletes a resource (file or directory)",parameters:[{name:"path",description:"the path of the resource within the workspace to delete or the currently active selection",required:!1},{name:"confirm",description:"whether to ask the user to confirm the deletion, true by default",required:!1}]},handler:{execute:async n=>{let e,t=n.params&&n.params.path;if(t){const u=await Tt.getWorkspace();u&&(e=await u.getResource(t))}if(e||(e=Fr.get()),!e){ct("No resource to delete provided!");return}t=e.getWorkspacePath();const i=n.params&&n.params.confirm;let a=!0;(i===void 0||i===!0)&&(a=window.confirm(`Are you sure you want to delete ${t}?`)),a&&e.delete().then(()=>{hr("Resource deleted: "+t)}).catch(u=>{ct(`Resource ${t} could not be deleted: `+u)})}}});dt({command:{id:"load_workspace",name:"Load workspace",description:"Loads a workspace",parameters:[]},handler:{execute:async n=>{await window.showDirectoryPicker({mode:"readwrite"}).then(e=>Tt.connectWorkspace(e)).catch(e=>{ct(e.message)})}}});dt({command:{id:"reload_workspace",name:"Reload workspace folder",description:"Reloads the active workspace folder",parameters:[]},handler:{execute:async n=>{const e=await Tt.getWorkspace();e||ct("No workspace selected."),e.touch()}}});dt({command:{id:"open_editor",name:"Open editor",description:"Opens a file in an editor",parameters:[{name:"path",description:"tha path of the file to open within the workspace",required:!0}]},handler:{execute:async n=>{const e=await Tt.getWorkspace();e||ct("No workspace selected.");const t=n.params.path,i=await(e==null?void 0:e.getResource(t));await gr.loadEditor(i)}}});dt({command:{id:"python",name:"Run Python Script",description:"Executes a Python script given its file path",parameters:[{name:"script",description:"the path to a Python script to run",required:!1}]},handler:{execute:async n=>{const e=n.params.script;if(!e)return;const t=new ml,i=await Tt.getWorkspace();await t.init(i,n),await t.installDependencies(),await t.execScript(e)}}});dt({command:{id:"js",name:"Run JavaScript file",description:"Executes a JavaScript file given its path",parameters:[{name:"script",description:"the path to a JavaScript file to run",required:!1}]}});dt({command:{id:"save",name:"Save editor",description:"Saves the active/focused editor",keyBinding:"CTRL+S",parameters:[]},handler:{execute:async n=>{const e=mt.get();e&&e.isDirty()&&e.save()}},contribution:{target:Nn,icon:"floppy-disk",label:"Save active editor",slot:"end",disabled:()=>{const n=mt.get();return!n||!n.isDirty()}}});dt({command:{id:"help",name:"Show welcome",description:"Shows the welcome page.",parameters:[]},handler:{execute:async n=>{const e=new us(vl,"README.md");await gr.loadEditor(e)}},contribution:{target:Pr,icon:"question-circle",label:"Welcome"}});dt({command:{id:"switch_theme",name:"Switch theme",description:"Switches between dark and light theme",parameters:[]},handler:{execute:async n=>{document.documentElement.classList.toggle("wa-dark")||document.documentElement.classList.toggle("wa-light")}},contribution:{target:Pr,icon:"circle-half-stroke",label:"Theme Switcher"}});dt({command:{id:"fullscreen",name:"Toggle fullscreen",description:"Toggles fullscreen mode",parameters:[]},handler:{execute:async n=>{document.fullscreenElement===document.body?await document.exitFullscreen():await document.body.requestFullscreen()}},contribution:{target:Pr,icon:"expand",label:"Fullscreen"}});dt({command:{id:"open_settings",name:"Open Settings",description:"Opens the settings file in an editor",parameters:[]},handler:{execute:n=>{const e={title:"settings.json",data:{async getContents(){const t=await Bt.getAll();return JSON.stringify(t,void 0,2)},getName(){return e.key},saveContents(t){const i=JSON.parse(t);return Bt.setAll(i)}},key:"setting.json",icon:"gear",state:{}};e.widgetFactory=()=>fe`
                <k-monaco-editor .input=${e}></k-monaco-editor>`,gr.loadEditor(e).then()}},contribution:{target:Pr,icon:"gear",label:"Open Settings"}});dt({command:{id:"open_extensions",name:"Open Extensions",description:"Opens the extensions registry",parameters:[]},handler:{execute:n=>{const e={title:"Extensions",data:{},key:"system.extensions",icon:"puzzle-piece",state:{},noOverflow:!0};e.widgetFactory=()=>fe`
                <k-extensions></k-extensions>`,gr.loadEditor(e).then()}},contribution:{target:Pr,icon:"puzzle-piece",label:"Open Extensions"}});Je.registerAll({command:{id:"toast_message",name:"Toast message to user",description:"Shows a toast message",parameters:[{name:"message",description:"the message to toast",required:!0},{name:"type",description:"the toast type: info (default), or error",required:!1}]},handler:{execute:({params:{message:n,type:e}})=>{n&&(e==="error"?ct(n):hr(n))}}});const zs="events/chatservice/aiConfigChanged",vn="aiConfig",bl={defaultProvider:"ollama",providers:[{name:"ollama",model:"gemma3:12b",chatApiEndpoint:"http://localhost:11434/v1/chat/completions",apiKey:""},{name:"openai",model:"gpt-4.1-mini",chatApiEndpoint:"https://api.openai.com/v1/chat/completions",apiKey:"<your api key>"},{name:"groq",model:"llama-3.1-8b-instant",chatApiEndpoint:"https://api.groq.com/openai/v1/chat/completions",apiKey:"<your api key>"},{name:"cerebras",model:"llama3.1-8b",chatApiEndpoint:"https://api.cerebras.ai/v1/chat/completions",apiKey:"<your api key>"},{name:"webllm",model:"gemma-2-9b-it-q4f16_1-MLC",chatApiEndpoint:"",apiKey:"",parameters:{context_window_size:4096}}]},pn="chatservice.prompts",wl="gs-maps-commands-history",Il={name:"openai-api",canHandle:n=>!0,completionApi:async n=>(await fetch(n.chatConfig.chatApiEndpoint,{method:"POST",headers:{Authorization:`Bearer ${n.chatConfig.apiKey}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({model:n.model,stream:n.stream,messages:n.messages,...n.chatConfig.parameters})})).json().then(t=>({role:"assistant",content:t.choices[0].message.content}))};class xl{constructor(){this.fetchers=[],this.promptContributions=[],Zt(Ei,()=>{this.aiConfig=void 0,this.checkAIConfig().then()}),this.promptContributions=Me.getContributions(pn)}registerFetcher(e){this.fetchers.push(e)}async checkAIConfig(){this.aiConfig||(this.aiConfig=await Bt.get(vn),this.aiConfig||(await Bt.set(vn,bl),this.aiConfig=await Bt.get(vn)),sr(zs,this.aiConfig))}async getDefaultProvider(){var t;await this.checkAIConfig();const e=await this.getProviders();if((t=this.aiConfig)!=null&&t.defaultProvider){const i=e.find(a=>{var u;return a.name===((u=this.aiConfig)==null?void 0:u.defaultProvider)});if(i)return i}return e[0]}async setDefaultProvider(e){return await this.checkAIConfig(),this.aiConfig.defaultProvider=e,await Bt.set(vn,this.aiConfig),this.getDefaultProvider()}async getProviders(){var e;return await this.checkAIConfig(),((e=this.aiConfig)==null?void 0:e.providers)||[]}createMessage(e){return{role:"user",content:e}}getPromptContribution(e){return this.promptContributions.find(t=>t.role===e)}async handleUserPrompt(e){const t=e.chatConfig||await this.getDefaultProvider(),i=e.chatContext,a=this.promptContributions.map(o=>{const m=e.callContext.createChild({userPrompt:i.history[i.history.length-1].content});if(o.canHandle instanceof Function&&!o.canHandle(m.getProxy()))return;const E=i.history.map(w=>{let T=w.role,j=w.content;return T!=="user"&&(T!==o.role?(T="user",j=`***Another Assistant '${w.role}' replied:***
${j}`):T="assistant"),{role:T,content:j}});let x=E[E.length-1],C=o.sysPrompt;typeof C=="function"&&(C=C()),E.unshift({role:"system",content:C});const O=async()=>{const w={model:t.model,stream:!1,messages:E,chatConfig:t};return(this.fetchers.find(j=>j.canHandle(t))||Il).completionApi(w).then(j=>j)};return o.promptDecorator instanceof Function?o.promptDecorator(m.getProxy()).then(w=>{w&&(x.content=w)}).then(O).then(async w=>(w.role=o.role,o.messageDecorator&&(m.put("message",w),o.messageDecorator(m.getProxy())),w)):O()}),u=await Promise.all(a.filter(o=>!!o));i.history.push(...u)}}const Sr=new xl;lr.put("chatService",Sr);var kl=Object.defineProperty,Sl=Object.getOwnPropertyDescriptor,Rr=(n,e,t,i)=>{for(var a=i>1?void 0:i?Sl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&kl(e,t,a),a};let or=class extends Yt{constructor(){super(...arguments),this.defaultChatContext={history:[]},this.chatContext=this.defaultChatContext,this.busy=!1,this.containerRef=Er()}onAIConfigChanged(){this.doBeforeUI()}onPartChanged(n){n&&"chatContext"in n?this.chatContext=n.chatContext:this.chatContext=this.defaultChatContext}doBeforeUI(){Sr.getProviders().then(n=>{this.providers=n||[]}),Sr.getDefaultProvider().then(n=>{this.defaultProvider=n})}doInitUI(){gi(this.containerRef.value)}async onHandlePrompt(n){n.stopPropagation();const e=n.target.value;n.target.select(),n.target.setRangeText(""),await this.handlePrompt(e)}async getCommandsHistory(){return Jr.getObject(wl).then(n=>n||[])}async runCommand(n,e){const t=e||Je,i=n.trim().split(/\s+/);if(i.length>0){const a=i.shift(),u=t.getCommand(a);u||ct("Command not found: "+a);const o={};i.forEach((E,x)=>{o[u.parameters[x].name]=E});const m={source:this,params:o};t.execute(a,m),this.requestUpdate()}}async handlePrompt(n){if(n&&n.trim().startsWith("/")){await this.runCommand(n.substring(1),Je);return}const e=Sr.createMessage(n);this.chatContext.history.push(e),this.requestUpdate(),this.busy=!0;const t=sn.createChild({activePart:mt.get(),activeEditor:ei.get()});cn.runAsync("Calling AI assistant",i=>Sr.handleUserPrompt({chatContext:this.chatContext,callContext:t}).then(a=>{this.requestUpdate()})).catch(i=>{ct(`${i}`)}).finally(()=>{this.busy=!1,t.destroy()})}async onChangeDefaultProvider(n){this.defaultProvider=await Sr.setDefaultProvider(n.currentTarget.value)}render(){var n;return fe`
            ${Ht(!this.defaultProvider,()=>fe`
                <k-no-content message="Select a provider."></k-no-content>`)}
            <div class="chat-messages" ${Cr(this.containerRef)}}>
                ${this.chatContext.history.map(e=>{var t;return fe`
                        <wa-card class="message ${e.role}">
                            <div slot="header">
                                <wa-icon name=${e.role=="user"?"user":"robot"}></wa-icon>
                                ${Ht(Sr.getPromptContribution(e.role),i=>i.label,()=>e.role)}
                            </div>
                            <wa-divider></wa-divider>
                            ${os(Ge.parse(e.content))}
                            <div slot="footer" style="display: flex; justify-content: flex-end">
                                ${(t=e.actions)==null?void 0:t.map(i=>fe`
                                    <wa-button @click="${()=>i.action()}" size="small" variant="success"
                                               appearance="outlined" title="${i.label}">
                                        <wa-icon name="${i.icon}"></wa-icon>
                                    </wa-button>
                                `)}
                            </div>
                        </wa-card>
                    `})}
                ${Ht(this.busy,()=>fe`
                    <wa-card class="message">
                        <wa-animation name="flip" duration="2000" play>
                            <wa-icon name="robot"></wa-icon>
                        </wa-animation>
                        <span>Waiting for reply...</span>
                    </wa-card>
                `)}
            </div>
            <wa-input
                    placeholder="How can I help you?"
                    @change=${this.onHandlePrompt} autocomplete="off">

                <wa-dropdown slot="end">
                    <wa-button slot="trigger" appearance="plain" size="small">
                        <wa-icon name="ellipsis-vertical"></wa-icon>
                    </wa-button>
                    ${(n=this.providers)==null?void 0:n.map(e=>{var t;return fe`
                        <wa-dropdown-item type="checkbox"
                                          value="${e.name}"
                                          ?checked="${e.name==((t=this.defaultProvider)==null?void 0:t.name)}"
                                          @click="${this.onChangeDefaultProvider}">
                            ${e.name}
                        </wa-dropdown-item>
                    `})}
                </wa-dropdown>
            </wa-input>
        `}};or.styles=Mt`
        :host {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        p, pre {
            margin: 0;
            white-space: break-spaces;
        }

        .message {
            padding: 10px 14px;
            border-radius: 4px;
            font-size: small;
            line-height: 1.4;
            word-break: break-word;
            display: inline-block;
        }

        wa-card::part(body) {
            --spacing: 0.5rem;
        }

        .message.user {
            background-color: var(--wa-color-neutral-fill-normal);
            align-self: flex-end;
        }

        .message.assistant {
            background-color: var(--wa-color-neutral-fill-quiet);
            align-self: flex-start;
        }
    `;Rr([Ct()],or.prototype,"chatContext",2);Rr([Ct()],or.prototype,"providers",2);Rr([Ct()],or.prototype,"defaultProvider",2);Rr([Ct()],or.prototype,"busy",2);Rr([oi(zs)],or.prototype,"onAIConfigChanged",1);Rr([hi(mt)],or.prototype,"onPartChanged",1);or=Rr([wt("k-aiassist")],or);const ni="events/extensionsregistry/extensionsConfigChanged",yn="extensions";class Al{constructor(){this.extensions={},this.loadedExtensions=new Set,Zt(Ei,()=>{this.extensionsSettings=void 0,this.checkExtensionsConfig().then()}),this.checkExtensionsConfig().then(()=>{var e;(e=this.extensionsSettings)==null||e.forEach(t=>{this.isEnabled(t.id)&&this.load(t.id).catch(i=>{ct("Extension could not be loaded: "+i.message)})})})}async checkExtensionsConfig(){this.extensionsSettings||(this.extensionsSettings=await Bt.get(yn),this.extensionsSettings||(await Bt.set(yn,[]),this.extensionsSettings=await Bt.get(yn)),sr(ni,this.extensionsSettings))}registerExtension(e){this.extensions[e.id]=e}getExtensions(){return Object.values(this.extensions)}isEnabled(e){var t;return this.checkExtensionsConfig(),!!((t=this.extensionsSettings)!=null&&t.find(i=>i.id===e&&i.enabled))}isLoaded(e){return this.loadedExtensions.has(e)}enable(e,t=!1){this.isEnabled(e)||this.load(e).then(()=>{this.updateEnablement(e,!0,t)}).catch(i=>{ct("Could not load extension: "+e)})}async load(e){if(this.loadedExtensions.has(e))return;const t=this.extensions[e];if(!t)throw new Error("Extension not found: "+e);this.loadedExtensions.add(e);const i=await cn.runAsync("Loading extension: "+t.name,()=>{if(t.loader)return t.loader();if(t.url)return import(t.url)});(i==null?void 0:i.default)instanceof Function&&(i==null||i.default(sn.getProxy()))}disable(e,t=!1){this.isEnabled(e)&&this.updateEnablement(e,!1,t)}updateEnablement(e,t,i){this.checkExtensionsConfig().then(()=>{var u,o;const a=(u=this.extensionsSettings)==null?void 0:u.find(m=>m.id==e);a?a.enabled=t:(o=this.extensionsSettings)==null||o.push({id:e,enabled:t}),Bt.set(yn,this.extensionsSettings).then(()=>{if(i){const m=this.extensions[e];hr(t?m.name+" enabled.":m.name+" disabled  - Please restart to take effect")}sr(ni,this.extensionsSettings)})})}}const it=new Al;lr.put("extensionRegistry",it);var _l=Object.defineProperty,El=Object.getOwnPropertyDescriptor,js=(n,e,t,i)=>{for(var a=i>1?void 0:i?El(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&_l(e,t,a),a};let On=class extends Yt{doInitUI(){Zt(ni,()=>{this.requestUpdate()})}onExtensionDblClick(){}enable(n){it.enable(n.id,!0),this.requestUpdate()}disable(n){it.disable(n.id,!0),this.requestUpdate()}selectionChanged(n){this.selectedExtension=n.detail.selection[0].model}render(){return fe`
            <wa-split-panel position="30" style="height: 100%">
                <wa-tree style="--indent-guide-width: 1px;" slot="start"
                         @wa-selection-change="${this.selectionChanged}">
                    ${it.getExtensions().map(n=>fe`
                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${n} expanded>
                            <span>${ar(n.icon)} ${n.name}</span>
                        </wa-tree-item>`)}
                </wa-tree>
                <div slot="end" style="padding: 1em;">
                    ${Ht(this.selectedExtension,n=>fe`
                        <h1>${ar(n.icon)} ${n.name}</h1>
                        <hr>
                        <div>
                            ${Ht(it.isEnabled(n.id),()=>fe`
                                <wa-button title="Disable this extension" @click="${()=>this.disable(n)}"
                                           variant="danger" appearance="plain">
                                    <wa-icon name="xmark"></wa-icon>&nbsp;Uninstall (requires restart)
                                </wa-button>`,()=>fe`
                                <wa-button title="Enable this extension" @click="${()=>this.enable(n)}"
                                           variant="brand" appearance="plain">
                                    <wa-icon name="download"></wa-icon>&nbsp;Install
                                </wa-button>`)}
                        </div>

                        ${Ht(n.experimental,()=>fe`
                            <div>
                                <wa-button size="small" variant="warning" appearance="plain">
                                    <wa-icon name="triangle-exclamation"></wa-icon>
                                </wa-button>
                                <small><i>This is an experimental extension!</i></small>
                            </div>
                        `)}
                        ${n.description}
                    `)}
                </div>
            </wa-split-panel>
        `}};On.styles=Mt`
        :host {
        }
    `;js([Ct()],On.prototype,"selectedExtension",2);On=js([wt("k-extensions")],On);var Cl=Object.defineProperty,Ol=Object.getOwnPropertyDescriptor,qn=(n,e,t,i)=>{for(var a=i>1?void 0:i?Ol(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&Cl(e,t,a),a};let zr=class extends jr{constructor(){super(...arguments),this.targetId=Ln,this.perspectives=[],this.activePerspective=""}doInitUI(){this.findPerspectivesContainer(),this.updatePerspectives(),Zt(on,()=>{this.updatePerspectives()})}findPerspectivesContainer(){const n=document.querySelector(`k-perspectives#${this.targetId}`);n&&(this.perspectivesContainer=n,this.perspectivesContainer.addEventListener("perspective-switched",e=>{this.activePerspective=e.detail.name,this.requestUpdate()}))}updatePerspectives(){this.perspectivesContainer||this.findPerspectivesContainer(),this.perspectivesContainer&&(this.perspectives=this.perspectivesContainer.getPerspectives(),this.activePerspective=this.perspectivesContainer.getActivePerspective(),this.requestUpdate())}handlePerspectiveClick(n){this.perspectivesContainer&&this.perspectivesContainer.switchPerspective(n)}render(){return this.perspectives.length===0?fe``:fe`
            <wa-button-group>
                ${this.perspectives.map(n=>fe`
                    <wa-button
                        class="perspective-button ${n.name===this.activePerspective?"active":""}"
                        appearance="plain"
                        size="small"
                        @click="${()=>this.handlePerspectiveClick(n.name)}">
                        ${Ht(n.icon,()=>ar(n.icon))}
                        ${n.label}
                    </wa-button>
                `)}
            </wa-button-group>
        `}};zr.styles=Mt`
        :host {
            display: inline-flex;
            margin: 0 1rem;
        }

        wa-button-group {
            border-left: 1px solid var(--wa-color-neutral-border, #ccc);
            border-right: 1px solid var(--wa-color-neutral-border, #ccc);
            border-top: 1px solid var(--wa-color-neutral-border, #ccc);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .perspective-button.active::part(base) {
            font-weight: 600;
            background-color: var(--wa-color-primary-fill-subtle, rgba(0, 102, 204, 0.15));
            color: var(--wa-color-primary-text, #0066cc);
        }
    `;qn([Wt({attribute:"target-id"})],zr.prototype,"targetId",2);qn([Ct()],zr.prototype,"perspectives",2);qn([Ct()],zr.prototype,"activePerspective",2);zr=qn([wt("k-perspective-switcher")],zr);var Pl=Object.defineProperty,Tl=Object.getOwnPropertyDescriptor,Ci=(n,e,t,i)=>{for(var a=i>1?void 0:i?Tl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&Pl(e,t,a),a};let tn=class extends Dn{constructor(){super(...arguments),this.message="No content.",this.icon="info-circle"}render(){return fe`
            <h3>
                <wa-icon name=${this.icon}></wa-icon>
                ${this.message}
            </h3>
        `}};tn.styles=Mt`
        :host {
            display: flex;
            margin: 10px;
        }

        * {
            flex: 1;
        }
    `;Ci([Wt()],tn.prototype,"message",2);Ci([Wt()],tn.prototype,"icon",2);tn=Ci([wt("k-no-content")],tn);var Rl=Object.getOwnPropertyDescriptor,Nl=(n,e,t,i)=>{for(var a=i>1?void 0:i?Rl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=o(a)||a);return a};let ii=class extends Dn{constructor(){super(...arguments),this.containerRef=Er()}doInitUI(){gi(this.containerRef.value)}render(){return fe`
            <div ${Cr(this.containerRef)}>
                <slot></slot>
            </div>
        `}};ii.styles=Mt`
        :host {
            overflow: hidden;
        }
        
        .container {
            overflow: auto;
        }
    `;ii=Nl([wt("k-scroller")],ii);var Ll=Object.defineProperty,Dl=Object.getOwnPropertyDescriptor,zn=(n,e,t,i)=>{for(var a=i>1?void 0:i?Dl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&Ll(e,t,a),a};let rn=class extends Dn{constructor(){super(...arguments),this.family="regular"}render(){var i;const n=(i=this.name)==null?void 0:i.trim().split(" "),e=n==null?void 0:n.pop(),t=n==null?void 0:n.pop();return fe`
            <wa-icon library="${t||dr}" variant="${this.variant||dr}"
                     family="${this.family||dr}" name=${e}></wa-icon>
        `}};zn([Wt()],rn.prototype,"name",2);zn([Wt()],rn.prototype,"family",2);zn([Wt()],rn.prototype,"variant",2);rn=zn([wt("k-icon")],rn);function bn(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Jn={exports:{}},rs;function Ml(){return rs||(rs=1,function(n,e){(function(t){n.exports=t()})(function(){return function(){function t(i,a,u){function o(x,C){if(!a[x]){if(!i[x]){var O=typeof bn=="function"&&bn;if(!C&&O)return O(x,!0);if(m)return m(x,!0);var w=new Error("Cannot find module '"+x+"'");throw w.code="MODULE_NOT_FOUND",w}var T=a[x]={exports:{}};i[x][0].call(T.exports,function(j){var te=i[x][1][j];return o(te||j)},T,T.exports,t,i,a,u)}return a[x].exports}for(var m=typeof bn=="function"&&bn,E=0;E<u.length;E++)o(u[E]);return o}return t}()({1:[function(t,i,a){const u=t("./utils"),o=function(){const m=u.stringToArray,E=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],x=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],C=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],O=["Thousand","Million","Billion","Trillion"];function w(P,$){var R=function(Q,H,q){var X="";if(Q<=19)X=(H?" and ":"")+(q?x[Q]:E[Q]);else if(Q<100){const Ce=Math.floor(Q/10),Re=Q%10;X=(H?" and ":"")+C[Ce-2],Re>0?X+="-"+R(Re,!1,q):q&&(X=X.substring(0,X.length-1)+"ieth")}else if(Q<1e3){const Ce=Math.floor(Q/100),Re=Q%100;X=(H?", ":"")+E[Ce]+" Hundred",Re>0?X+=R(Re,!0,q):q&&(X+="th")}else{var de=Math.floor(Math.log10(Q)/3);de>O.length&&(de=O.length);const Ce=Math.pow(10,de*3),Re=Math.floor(Q/Ce),pe=Q-Re*Ce;X=(H?", ":"")+R(Re,!1,!1)+" "+O[de-1],pe>0?X+=R(pe,!0,q):q&&(X+="th")}return X},K=R(P,!1,$);return K}const T={};E.forEach(function(P,$){T[P.toLowerCase()]=$}),x.forEach(function(P,$){T[P.toLowerCase()]=$}),C.forEach(function(P,$){const R=P.toLowerCase();T[R]=($+2)*10,T[R.substring(0,P.length-1)+"ieth"]=T[R]}),T.hundredth=100,O.forEach(function(P,$){const R=P.toLowerCase(),K=Math.pow(10,($+1)*3);T[R]=K,T[R+"th"]=K});function j(P){const R=P.split(/,\s|\sand\s|[\s\\-]/).map(H=>T[H]);let K=[0];return R.forEach(H=>{if(H<100){let q=K.pop();q>=1e3&&(K.push(q),q=0),K.push(q+H)}else K.push(K.pop()*H)}),K.reduce((H,q)=>H+q,0)}const te=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],we={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function Oe(P){for(var $=0;$<te.length;$++){const R=te[$];if(P>=R[0])return R[1]+Oe(P-R[0])}return""}function U(P){for(var $=0,R=1,K=P.length-1;K>=0;K--){const Q=P[K],H=we[Q];H<R?$-=H:(R=H,$+=H)}return $}function D(P,$){for(var R=[],K=$.charCodeAt(0);P>0;)R.unshift(String.fromCharCode((P-1)%26+K)),P=Math.floor((P-1)/26);return R.join("")}function B(P,$){for(var R=$.charCodeAt(0),K=0,Q=0;Q<P.length;Q++)K+=(P.charCodeAt(P.length-Q-1)-R+1)*Math.pow(26,Q);return K}function N(P,$){if(typeof P>"u")return;P=Math.floor(P);const R=me($);return z(P,R)}const v={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},F={UPPER:"upper",LOWER:"lower",TITLE:"title"};function z(P,$){let R;const K=P<0;switch(P=Math.abs(P),$.primary){case v.LETTERS:R=D(P,$.case===F.UPPER?"A":"a");break;case v.ROMAN:R=Oe(P),$.case===F.UPPER&&(R=R.toUpperCase());break;case v.WORDS:R=w(P,$.ordinal),$.case===F.UPPER?R=R.toUpperCase():$.case===F.LOWER&&(R=R.toLowerCase());break;case v.DECIMAL:R=""+P;var Q=$.mandatoryDigits-R.length;if(Q>0){var H=new Array(Q+1).join("0");R=H+R}if($.zeroCode!==48&&(R=m(R).map(Ce=>String.fromCodePoint(Ce.codePointAt(0)+$.zeroCode-48)).join("")),$.regular){const Ce=Math.floor((R.length-1)/$.groupingSeparators.position);for(let Re=Ce;Re>0;Re--){const pe=R.length-Re*$.groupingSeparators.position;R=R.substr(0,pe)+$.groupingSeparators.character+R.substr(pe)}}else $.groupingSeparators.reverse().forEach(Ce=>{const Re=R.length-Ce.position;R=R.substr(0,Re)+Ce.character+R.substr(Re)});if($.ordinal){var q={1:"st",2:"nd",3:"rd"},X=R[R.length-1],de=q[X];(!de||R.length>1&&R[R.length-2]==="1")&&(de="th"),R=R+de}break;case v.SEQUENCE:throw{code:"D3130",value:$.token}}return K&&(R="-"+R),R}const ie=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function me(P){const $={type:"integer",primary:v.DECIMAL,case:F.LOWER,ordinal:!1};let R,K;const Q=P.lastIndexOf(";");switch(Q===-1?R=P:(R=P.substring(0,Q),K=P.substring(Q+1),K[0]==="o"&&($.ordinal=!0)),R){case"A":$.case=F.UPPER;case"a":$.primary=v.LETTERS;break;case"I":$.case=F.UPPER;case"i":$.primary=v.ROMAN;break;case"W":$.case=F.UPPER,$.primary=v.WORDS;break;case"Ww":$.case=F.TITLE,$.primary=v.WORDS;break;case"w":$.primary=v.WORDS;break;default:{let H=null,q=0,X=0,de=[],Ce=0;if(m(R).map(pe=>pe.codePointAt(0)).reverse().forEach(pe=>{let be=!1;for(let Le=0;Le<ie.length;Le++){const ce=ie[Le];if(pe>=ce&&pe<=ce+9){if(be=!0,q++,Ce++,H===null)H=ce;else if(ce!==H)throw{code:"D3131"};break}}be||(pe===35?(Ce++,X++):de.push({position:Ce,character:String.fromCodePoint(pe)}))}),q>0){$.primary=v.DECIMAL,$.zeroCode=H,$.mandatoryDigits=q,$.optionalDigits=X;const be=function(Le){if(Le.length===0)return 0;const ce=Le[0].character;for(let at=1;at<Le.length;at++)if(Le[at].character!==ce)return 0;const st=Le.map(at=>at.position),Ot=function(at,ft){return ft===0?at:Ot(ft,at%ft)},ht=st.reduce(Ot);for(let at=1;at<=st.length;at++)if(st.indexOf(at*ht)===-1)return 0;return ht}(de);be>0?($.regular=!0,$.groupingSeparators={position:be,character:de[0].character}):($.regular=!1,$.groupingSeparators=de)}else $.primary=v.SEQUENCE,$.token=R}}return $}const J={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function re(P){var $=[];const R={type:"datetime",parts:$},K=function(be,Le){if(Le>be){let ce=P.substring(be,Le);ce=ce.split("]]").join("]"),$.push({type:"literal",value:ce})}};for(var Q=0,H=0;H<P.length;){if(P.charAt(H)==="["){if(P.charAt(H+1)==="["){K(Q,H),$.push({type:"literal",value:"["}),H+=2,Q=H;continue}if(K(Q,H),Q=H,H=P.indexOf("]",Q),H===-1)throw{code:"D3135"};let be=P.substring(Q+1,H);be=be.split(/\s+/).join("");var q={type:"marker",component:be.charAt(0)},X=be.lastIndexOf(","),de;if(X!==-1){const Le=be.substring(X+1),ce=Le.indexOf("-");let st,Ot;const ht=function(ft){if(!(typeof ft>"u"||ft==="*"))return parseInt(ft)};ce===-1?st=Le:(st=Le.substring(0,ce),Ot=Le.substring(ce+1));const at={min:ht(st),max:ht(Ot)};q.width=at,de=be.substring(1,X)}else de=be.substring(1);if(de.length===1)q.presentation1=de;else if(de.length>1){var Ce=de.charAt(de.length-1);"atco".indexOf(Ce)!==-1?(q.presentation2=Ce,Ce==="o"&&(q.ordinal=!0),q.presentation1=de.substring(0,de.length-1)):q.presentation1=de}else q.presentation1=J[q.component];if(typeof q.presentation1>"u")throw{code:"D3132",value:q.component};if(q.presentation1[0]==="n")q.names=F.LOWER;else if(q.presentation1[0]==="N")q.presentation1[1]==="n"?q.names=F.TITLE:q.names=F.UPPER;else if("YMDdFWwXxHhmsf".indexOf(q.component)!==-1){var Re=q.presentation1;if(q.presentation2&&(Re+=";"+q.presentation2),q.integerFormat=me(Re),q.width&&q.width.min!==void 0&&q.integerFormat.mandatoryDigits<q.width.min&&(q.integerFormat.mandatoryDigits=q.width.min),"YMD".indexOf(q.component)!==-1)if(q.n=-1,q.width&&q.width.max!==void 0)q.n=q.width.max,q.integerFormat.mandatoryDigits=q.n;else{var pe=q.integerFormat.mandatoryDigits+q.integerFormat.optionalDigits;pe>=2&&(q.n=pe)}}(q.component==="Z"||q.component==="z")&&(q.integerFormat=me(q.presentation1)),$.push(q),Q=H+1}H++}return K(Q,H),R}const le=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ke=["January","February","March","April","May","June","July","August","September","October","November","December"],qe=1e3*60*60*24,ve=function(P){const $=Date.UTC(P.year,P.month);var R=new Date($).getUTCDay();return R===0&&(R=7),R>4?$+(8-R)*qe:$-(R-1)*qe},ge=function(P,$){return{year:P,month:$,nextMonth:function(){return $===11?ge(P+1,0):ge(P,$+1)},previousMonth:function(){return $===0?ge(P-1,11):ge(P,$-1)},nextYear:function(){return ge(P+1,$)},previousYear:function(){return ge(P-1,$)}}},Ue=function(P,$){return($-P)/(qe*7)+1},ee=(P,$)=>{let R;switch($){case"Y":R=P.getUTCFullYear();break;case"M":R=P.getUTCMonth()+1;break;case"D":R=P.getUTCDate();break;case"d":{const K=Date.UTC(P.getUTCFullYear(),P.getUTCMonth(),P.getUTCDate()),Q=Date.UTC(P.getUTCFullYear(),0);R=(K-Q)/qe+1;break}case"F":R=P.getUTCDay(),R===0&&(R=7);break;case"W":{const K=ge(P.getUTCFullYear(),0),Q=ve(K),H=Date.UTC(K.year,P.getUTCMonth(),P.getUTCDate());let q=Ue(Q,H);if(q>52){const X=ve(K.nextYear());H>=X&&(q=1)}else if(q<1){const X=ve(K.previousYear());q=Ue(X,H)}R=Math.floor(q);break}case"w":{const K=ge(P.getUTCFullYear(),P.getUTCMonth()),Q=ve(K),H=Date.UTC(K.year,K.month,P.getUTCDate());let q=Ue(Q,H);if(q>4){const X=ve(K.nextMonth());H>=X&&(q=1)}else if(q<1){const X=ve(K.previousMonth());q=Ue(X,H)}R=Math.floor(q);break}case"X":{const K=ge(P.getUTCFullYear(),0),Q=ve(K),H=ve(K.nextYear()),q=P.getTime();q<Q?R=K.year-1:q>=H?R=K.year+1:R=K.year;break}case"x":{const K=ge(P.getUTCFullYear(),P.getUTCMonth()),Q=ve(K),H=K.nextMonth(),q=ve(H),X=P.getTime();X<Q?R=K.previousMonth().month+1:X>=q?R=H.month+1:R=K.month+1;break}case"H":R=P.getUTCHours();break;case"h":R=P.getUTCHours(),R=R%12,R===0&&(R=12);break;case"P":R=P.getUTCHours()>=12?"pm":"am";break;case"m":R=P.getUTCMinutes();break;case"s":R=P.getUTCSeconds();break;case"f":R=P.getUTCMilliseconds();break;case"Z":case"z":break;case"C":R="ISO";break;case"E":R="ISO";break}return R};let Ee=null;function Pe(P,$,R){var K=0,Q=0;if(typeof R<"u"){const Re=parseInt(R);K=Math.floor(Re/100),Q=Re%100}var H=function(Re,pe){var be=ee(Re,pe.component);if("YMDdFWwXxHhms".indexOf(pe.component)!==-1)if(pe.component==="Y"&&pe.n!==-1&&(be=be%Math.pow(10,pe.n)),pe.names){if(pe.component==="M"||pe.component==="x")be=ke[be-1];else if(pe.component==="F")be=le[be];else throw{code:"D3133",value:pe.component};pe.names===F.UPPER?be=be.toUpperCase():pe.names===F.LOWER&&(be=be.toLowerCase()),pe.width&&be.length>pe.width.max&&(be=be.substring(0,pe.width.max))}else be=z(be,pe.integerFormat);else if(pe.component==="f")be=z(be,pe.integerFormat);else if(pe.component==="Z"||pe.component==="z"){const Le=K*100+Q;if(pe.integerFormat.regular)be=z(Le,pe.integerFormat);else{const ce=pe.integerFormat.mandatoryDigits;if(ce===1||ce===2)be=z(K,pe.integerFormat),Q!==0&&(be+=":"+N(Q,"00"));else if(ce===3||ce===4)be=z(Le,pe.integerFormat);else throw{code:"D3134",value:ce}}Le>=0&&(be="+"+be),pe.component==="z"&&(be="GMT"+be),Le===0&&pe.presentation2==="t"&&(be="Z")}else pe.component==="P"&&pe.names===F.UPPER&&(be=be.toUpperCase());return be};let q;typeof $>"u"?(Ee===null&&(Ee=re("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),q=Ee):q=re($);const X=(60*K+Q)*60*1e3,de=new Date(P+X);let Ce="";return q.parts.forEach(function(Re){Re.type==="literal"?Ce+=Re.value:Ce+=H(de,Re)}),Ce}function y(P){var $={};if(P.type==="datetime")$.type="datetime",$.parts=P.parts.map(function(R){var K={};if(R.type==="literal")K.regex=R.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(R.component==="Z"||R.component==="z"){let H;Array.isArray(R.integerFormat.groupingSeparators)||(H=R.integerFormat.groupingSeparators),K.regex="",R.component==="z"&&(K.regex="GMT"),K.regex+="[-+][0-9]+",H&&(K.regex+=H.character+"[0-9]+"),K.parse=function(q){R.component==="z"&&(q=q.substring(3));let X=0,de=0;return H?(X=Number.parseInt(q.substring(0,q.indexOf(H.character))),de=Number.parseInt(q.substring(q.indexOf(H.character)+1))):q.length-1<=2?X=Number.parseInt(q):(X=Number.parseInt(q.substring(0,3)),de=Number.parseInt(q.substring(3))),X*60+de}}else if(R.integerFormat)R.integerFormat.n=R.n,K=y(R.integerFormat);else{K.regex="[a-zA-Z]+";var Q={};if(R.component==="M"||R.component==="x")ke.forEach(function(H,q){R.width&&R.width.max?Q[H.substring(0,R.width.max)]=q+1:Q[H]=q+1});else if(R.component==="F")le.forEach(function(H,q){q>0&&(R.width&&R.width.max?Q[H.substring(0,R.width.max)]=q:Q[H]=q)});else if(R.component==="P")Q={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:R.component};K.parse=function(H){return Q[H]}}return K.component=R.component,K});else{$.type="integer";const R=P.case===F.UPPER;let K;switch(P.n&&P.n>0?P.optionalDigits===0?K=`{${P.n}}`:K=`{${P.n-P.optionalDigits},${P.n}}`:K="+",P.primary){case v.LETTERS:$.regex=R?"[A-Z]+":"[a-z]+",$.parse=function(Q){return B(Q,R?"A":"a")};break;case v.ROMAN:$.regex=R?"[MDCLXVI]+":"[mdclxvi]+",$.parse=function(Q){return U(R?Q:Q.toUpperCase())};break;case v.WORDS:$.regex="(?:"+Object.keys(T).concat("and","[\\-, ]").join("|")+")+",$.parse=function(Q){return j(Q.toLowerCase())};break;case v.DECIMAL:$.regex=`[0-9]${K}`,P.ordinal&&($.regex+="(?:th|st|nd|rd)"),$.parse=function(Q){let H=Q;return P.ordinal&&(H=Q.substring(0,Q.length-2)),P.regular?H=H.split(",").join(""):P.groupingSeparators.forEach(q=>{H=H.split(q.character).join("")}),P.zeroCode!==48&&(H=H.split("").map(q=>String.fromCodePoint(q.codePointAt(0)-P.zeroCode+48)).join("")),parseInt(H)};break;case v.SEQUENCE:throw{code:"D3130",value:P.token}}}return $}function k(P,$){if(typeof P>"u")return;const R=me($);return y(R).parse(P)}function ae(P,$){const R=re($),K=y(R),Q="^"+K.parts.map(de=>"("+de.regex+")").join("")+"$";var q=new RegExp(Q,"i").exec(P);if(q!==null){const ce={};for(let De=1;De<q.length;De++){const h=K.parts[De-1];h.parse&&(ce[h.component]=h.parse(q[De]))}if(Object.getOwnPropertyNames(ce).length===0)return;let st=0;const Ot=De=>{st<<=1,st+=De?1:0},ht=De=>!(~De&st)&&!!(De&st);"YXMxWwdD".split("").forEach(De=>Ot(ce[De]));const ft=!ht(161)&&ht(130),Rt=ht(84),Gt=!Rt&&ht(72);st=0,"PHhmsf".split("").forEach(De=>Ot(ce[De]));const $t=!ht(23)&&ht(47),Xt=(ft?"YD":Rt?"XxwF":Gt?"XWF":"YMD")+($t?"Phmsf":"Hmsf"),Pt=this.environment.timestamp;let Xe=!1,Nt=!1;if(Xt.split("").forEach(De=>{if(typeof ce[De]>"u")Xe?(ce[De]="MDd".indexOf(De)!==-1?1:0,Nt=!0):ce[De]=ee(Pt,De);else if(Xe=!0,Nt)throw{code:"D3136"}}),ce.M>0?ce.M-=1:ce.M=0,ft){const De=Date.UTC(ce.Y,0),h=(ce.d-1)*1e3*60*60*24,b=new Date(De+h);ce.M=b.getUTCMonth(),ce.D=b.getUTCDate()}if(Rt)throw{code:"D3136"};if(Gt)throw{code:"D3136"};$t&&(ce.H=ce.h===12?0:ce.h,ce.P===1&&(ce.H+=12));var X=Date.UTC(ce.Y,ce.M,ce.D,ce.H,ce.m,ce.s,ce.f);return(ce.Z||ce.z)&&(X-=(ce.Z||ce.z)*60*1e3),X}}var Ae=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function Be(P,$){if(!(typeof P>"u"))if(typeof $>"u"){if(!Ae.test(P))throw{stack:new Error().stack,code:"D3110",value:P};return Date.parse(P)}else return ae.call(this,P,$)}function Te(P,$,R){if(!(typeof P>"u"))return Pe.call(this,P,$,R)}return{formatInteger:N,parseInteger:k,fromMillis:Te,toMillis:Be}}();i.exports=o},{"./utils":6}],2:[function(t,i,a){(function(u){(function(){var o=t("./utils");const m=(()=>{var E=o.isNumeric,x=o.isArrayOfStrings,C=o.isArrayOfNumbers,O=o.createSequence,w=o.isSequence,T=o.isFunction,j=o.isLambda,te=o.isPromise,we=o.getFunctionArity,Oe=o.isDeepEqual,U=o.stringToArray;function D(l){if(!(typeof l>"u")){var d=0;return l.forEach(function(f){d+=f}),d}}function B(l){return typeof l>"u"?0:l.length}function N(l){if(!(typeof l>"u"||l.length===0))return Math.max.apply(Math,l)}function v(l){if(!(typeof l>"u"||l.length===0))return Math.min.apply(Math,l)}function F(l){if(!(typeof l>"u"||l.length===0)){var d=0;return l.forEach(function(f){d+=f}),d/l.length}}function z(l,d=!1){if(!(typeof l>"u")){var f;if(typeof l=="string")f=l;else if(T(l))f="";else{if(typeof l=="number"&&!isFinite(l))throw{code:"D3001",value:l,stack:new Error().stack};var A=d?2:0;Array.isArray(l)&&l.outerWrapper&&(l=l[0]),f=JSON.stringify(l,function(I,L){return typeof L<"u"&&L!==null&&L.toPrecision&&E(L)?Number(L.toPrecision(15)):L&&T(L)?"":L},A)}return f}}function ie(l,d,f){if(!(typeof l>"u")){var A=U(l),I=A.length;if(I+d<0&&(d=0),typeof f<"u"){if(f<=0)return"";var L=d>=0?d+f:I+d+f;return A.slice(d,L).join("")}return A.slice(d).join("")}}function me(l,d){if(!(typeof l>"u")){var f=l.indexOf(d);return f>-1?l.substr(0,f):l}}function J(l,d){if(!(typeof l>"u")){var f=l.indexOf(d);return f>-1?l.substr(f+d.length):l}}function re(l){if(!(typeof l>"u"))return l.toLowerCase()}function le(l){if(!(typeof l>"u"))return l.toUpperCase()}function ke(l){if(!(typeof l>"u"))return U(l).length}function qe(l){if(!(typeof l>"u")){var d=l.replace(/[ \t\n\r]+/gm," ");return d.charAt(0)===" "&&(d=d.substring(1)),d.charAt(d.length-1)===" "&&(d=d.substring(0,d.length-1)),d}}function ve(l,d,f){if(!(typeof l>"u")){(typeof f>"u"||f.length===0)&&(f=" ");var A,I=Math.abs(d)-ke(l);if(I>0){var L=new Array(I+1).join(f);f.length>1&&(L=ie(L,0,I)),d>0?A=l+L:A=L+l}else A=l;return A}}async function ge(l,d){var f=l.apply(this,[d]);if(te(f)&&(f=await f),f&&!(typeof f.start=="number"||f.end==="number"||Array.isArray(f.groups)||T(f.next)))throw{code:"T1010",stack:new Error().stack};return f}async function Ue(l,d){if(!(typeof l>"u")){var f;if(typeof d=="string")f=l.indexOf(d)!==-1;else{var A=await ge(d,l);f=typeof A<"u"}return f}}async function ee(l,d,f){if(!(typeof l>"u")){if(f<0)throw{stack:new Error().stack,value:f,code:"D3040",index:3};var A=O();if(typeof f>"u"||f>0){var I=0,L=await ge(d,l);if(typeof L<"u")for(;typeof L<"u"&&(typeof f>"u"||I<f);)A.push({match:L.match,index:L.start,groups:L.groups}),L=await ge(L.next),I++}return A}}async function Ee(l,d,f,A){if(!(typeof l>"u")){var I=this;if(d==="")throw{code:"D3010",stack:new Error().stack,value:d,index:2};if(A<0)throw{code:"D3011",stack:new Error().stack,value:A,index:4};var L;typeof f=="string"?L=function(Ne){for(var tt="",_e=0,Ze=f.indexOf("$",_e);Ze!==-1&&_e<f.length;){tt+=f.substring(_e,Ze),_e=Ze+1;var _t=f.charAt(_e);if(_t==="$")tt+="$",_e++;else if(_t==="0")tt+=Ne.match,_e++;else{var We;if(Ne.groups.length===0?We=1:We=Math.floor(Math.log(Ne.groups.length)*Math.LOG10E)+1,Ze=parseInt(f.substring(_e,_e+We),10),We>1&&Ze>Ne.groups.length&&(Ze=parseInt(f.substring(_e,_e+We-1),10)),isNaN(Ze))tt+="$";else{if(Ne.groups.length>0){var er=Ne.groups[Ze-1];typeof er<"u"&&(tt+=er)}_e+=Ze.toString().length}}Ze=f.indexOf("$",_e)}return tt+=f.substring(_e),tt}:L=f;var V="",oe=0;if(typeof A>"u"||A>0){var he=0;if(typeof d=="string"){for(var $e=l.indexOf(d,oe);$e!==-1&&(typeof A>"u"||he<A);)V+=l.substring(oe,$e),V+=f,oe=$e+d.length,he++,$e=l.indexOf(d,oe);V+=l.substring(oe)}else{var xe=await ge(d,l);if(typeof xe<"u"){for(;typeof xe<"u"&&(typeof A>"u"||he<A);){V+=l.substring(oe,xe.start);var Fe=L.apply(I,[xe]);if(te(Fe)&&(Fe=await Fe),typeof Fe=="string")V+=Fe;else throw{code:"D3012",stack:new Error().stack,value:Fe};oe=xe.start+xe.match.length,he++,xe=await ge(xe.next)}V+=l.substring(oe)}else V=l}}else V=l;return V}}function Pe(l){if(!(typeof l>"u")){var d=typeof window<"u"?window.btoa:function(f){return new u.Buffer.from(f,"binary").toString("base64")};return d(l)}}function y(l){if(!(typeof l>"u")){var d=typeof window<"u"?window.atob:function(f){return new u.Buffer.from(f,"base64").toString("binary")};return d(l)}}function k(l){if(!(typeof l>"u")){var d;try{d=encodeURIComponent(l)}catch{throw{code:"D3140",stack:new Error().stack,value:l,functionName:"encodeUrlComponent"}}return d}}function ae(l){if(!(typeof l>"u")){var d;try{d=encodeURI(l)}catch{throw{code:"D3140",stack:new Error().stack,value:l,functionName:"encodeUrl"}}return d}}function Ae(l){if(!(typeof l>"u")){var d;try{d=decodeURIComponent(l)}catch{throw{code:"D3140",stack:new Error().stack,value:l,functionName:"decodeUrlComponent"}}return d}}function Be(l){if(!(typeof l>"u")){var d;try{d=decodeURI(l)}catch{throw{code:"D3140",stack:new Error().stack,value:l,functionName:"decodeUrl"}}return d}}async function Te(l,d,f){if(!(typeof l>"u")){if(f<0)throw{code:"D3020",stack:new Error().stack,value:f,index:3};var A=[];if(typeof f>"u"||f>0)if(typeof d=="string")A=l.split(d,f);else{var I=0,L=await ge(d,l);if(typeof L<"u"){for(var V=0;typeof L<"u"&&(typeof f>"u"||I<f);)A.push(l.substring(V,L.start)),V=L.end,L=await ge(L.next),I++;(typeof f>"u"||I<f)&&A.push(l.substring(V))}else A.push(l)}return A}}function P(l,d){if(!(typeof l>"u"))return typeof d>"u"&&(d=""),l.join(d)}function $(l,d,f){if(!(typeof l>"u")){var A={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"","zero-digit":"0",digit:"#","pattern-separator":";"},I=A;typeof f<"u"&&Object.keys(f).forEach(function(ye){I[ye]=f[ye]});for(var L=[],V=I["zero-digit"].charCodeAt(0),oe=V;oe<V+10;oe++)L.push(String.fromCharCode(oe));var he=L.concat([I["decimal-separator"],I["exponent-separator"],I["grouping-separator"],I.digit,I["pattern-separator"]]),$e=d.split(I["pattern-separator"]);if($e.length>2)throw{code:"D3080",stack:new Error().stack};var xe=function(ye){var Ve=function(){for(var Qe,vt=0;vt<ye.length;vt++)if(Qe=ye.charAt(vt),he.indexOf(Qe)!==-1&&Qe!==I["exponent-separator"])return ye.substring(0,vt)}(),ut=function(){for(var Qe,vt=ye.length-1;vt>=0;vt--)if(Qe=ye.charAt(vt),he.indexOf(Qe)!==-1&&Qe!==I["exponent-separator"])return ye.substring(vt+1)}(),Ke=ye.substring(Ve.length,ye.length-ut.length),xt,qt,gt,et,kt=ye.indexOf(I["exponent-separator"],Ve.length);kt===-1||kt>ye.length-ut.length?(xt=Ke,qt=void 0):(xt=Ke.substring(0,kt),qt=Ke.substring(kt+1));var St=xt.indexOf(I["decimal-separator"]);return St===-1?(gt=xt,et=ut):(gt=xt.substring(0,St),et=xt.substring(St+1)),{prefix:Ve,suffix:ut,activePart:Ke,mantissaPart:xt,exponentPart:qt,integerPart:gt,fractionalPart:et,subpicture:ye}},Fe=function(ye){var Ve,ut,Ke=ye.subpicture,xt=Ke.indexOf(I["decimal-separator"]);xt!==Ke.lastIndexOf(I["decimal-separator"])&&(Ve="D3081"),Ke.indexOf(I.percent)!==Ke.lastIndexOf(I.percent)&&(Ve="D3082"),Ke.indexOf(I["per-mille"])!==Ke.lastIndexOf(I["per-mille"])&&(Ve="D3083"),Ke.indexOf(I.percent)!==-1&&Ke.indexOf(I["per-mille"])!==-1&&(Ve="D3084");var qt=!1;for(ut=0;ut<ye.mantissaPart.length;ut++){var gt=ye.mantissaPart.charAt(ut);if(L.indexOf(gt)!==-1||gt===I.digit){qt=!0;break}}qt||(Ve="D3085");var et=ye.activePart.split("").map(function(Qe){return he.indexOf(Qe)===-1?"p":"a"}).join("");et.indexOf("p")!==-1&&(Ve="D3086"),xt!==-1?(Ke.charAt(xt-1)===I["grouping-separator"]||Ke.charAt(xt+1)===I["grouping-separator"])&&(Ve="D3087"):ye.integerPart.charAt(ye.integerPart.length-1)===I["grouping-separator"]&&(Ve="D3088"),Ke.indexOf(I["grouping-separator"]+I["grouping-separator"])!==-1&&(Ve="D3089");var kt=ye.integerPart.indexOf(I.digit);kt!==-1&&ye.integerPart.substring(0,kt).split("").filter(function(Qe){return L.indexOf(Qe)>-1}).length>0&&(Ve="D3090"),kt=ye.fractionalPart.lastIndexOf(I.digit),kt!==-1&&ye.fractionalPart.substring(kt).split("").filter(function(Qe){return L.indexOf(Qe)>-1}).length>0&&(Ve="D3091");var St=typeof ye.exponentPart=="string";if(St&&ye.exponentPart.length>0&&(Ke.indexOf(I.percent)!==-1||Ke.indexOf(I["per-mille"])!==-1)&&(Ve="D3092"),St&&(ye.exponentPart.length===0||ye.exponentPart.split("").filter(function(Qe){return L.indexOf(Qe)===-1}).length>0)&&(Ve="D3093"),Ve)throw{code:Ve,stack:new Error().stack}},Ne=function(ye){var Ve=function(ot,Ir){for(var rr=[],zt=ot.indexOf(I["grouping-separator"]);zt!==-1;){var Lr=(Ir?ot.substring(0,zt):ot.substring(zt)).split("").filter(function(pr){return L.indexOf(pr)!==-1||pr===I.digit}).length;rr.push(Lr),zt=ye.integerPart.indexOf(I["grouping-separator"],zt+1)}return rr},ut=Ve(ye.integerPart),Ke=function(ot){if(ot.length===0)return 0;for(var Ir=function(Lr,pr){return pr===0?Lr:Ir(pr,Lr%pr)},rr=ot.reduce(Ir),zt=1;zt<=ot.length;zt++)if(ot.indexOf(zt*rr)===-1)return 0;return rr},xt=Ke(ut),qt=Ve(ye.fractionalPart,!0),gt=ye.integerPart.split("").filter(function(ot){return L.indexOf(ot)!==-1}).length,et=gt,kt=ye.fractionalPart.split(""),St=kt.filter(function(ot){return L.indexOf(ot)!==-1}).length,Qe=kt.filter(function(ot){return L.indexOf(ot)!==-1||ot===I.digit}).length,vt=typeof ye.exponentPart=="string";gt===0&&Qe===0&&(vt?(St=1,Qe=1):gt=1),vt&&gt===0&&ye.integerPart.indexOf(I.digit)!==-1&&(gt=1),gt===0&&St===0&&(St=1);var wr=0;return vt&&(wr=ye.exponentPart.split("").filter(function(ot){return L.indexOf(ot)!==-1}).length),{integerPartGroupingPositions:ut,regularGrouping:xt,minimumIntegerPartSize:gt,scalingFactor:et,prefix:ye.prefix,fractionalPartGroupingPositions:qt,minimumFactionalPartSize:St,maximumFactionalPartSize:Qe,minimumExponentSize:wr,suffix:ye.suffix,picture:ye.subpicture}},tt=$e.map(xe);tt.forEach(Fe);var _e=tt.map(Ne),Ze=I["minus-sign"],_t=I["zero-digit"],We=I["decimal-separator"],er=I["grouping-separator"];_e.length===1&&(_e.push(JSON.parse(JSON.stringify(_e[0]))),_e[1].prefix=Ze+_e[1].prefix);var Ye;l>=0?Ye=_e[0]:Ye=_e[1];var yr;Ye.picture.indexOf(I.percent)!==-1?yr=l*100:Ye.picture.indexOf(I["per-mille"])!==-1?yr=l*1e3:yr=l;var rt,Ft;if(Ye.minimumExponentSize===0)rt=yr;else{var Bn=Math.pow(10,Ye.scalingFactor),dn=Math.pow(10,Ye.scalingFactor-1);for(rt=yr,Ft=0;rt<dn;)rt*=10,Ft-=1;for(;rt>Bn;)rt/=10,Ft+=1}var Ur=X(rt,Ye.maximumFactionalPartSize),hn=function(ye,Ve){var ut=Math.abs(ye).toFixed(Ve);return _t!=="0"&&(ut=ut.split("").map(function(Ke){return Ke>="0"&&Ke<="9"?L[Ke.charCodeAt(0)-48]:Ke}).join("")),ut},Se=hn(Ur,Ye.maximumFactionalPartSize),nt=Se.indexOf(".");for(nt===-1?Se=Se+We:Se=Se.replace(".",We);Se.charAt(0)===_t;)Se=Se.substring(1);for(;Se.charAt(Se.length-1)===_t;)Se=Se.substring(0,Se.length-1);nt=Se.indexOf(We);var tr=Ye.minimumIntegerPartSize-nt,Br=Ye.minimumFactionalPartSize-(Se.length-nt-1);if(Se=(tr>0?new Array(tr+1).join(_t):"")+Se,Se=Se+(Br>0?new Array(Br+1).join(_t):""),nt=Se.indexOf(We),Ye.regularGrouping>0)for(var It=Math.floor((nt-1)/Ye.regularGrouping),br=1;br<=It;br++)Se=[Se.slice(0,nt-br*Ye.regularGrouping),er,Se.slice(nt-br*Ye.regularGrouping)].join("");else Ye.integerPartGroupingPositions.forEach(function(ye){Se=[Se.slice(0,nt-ye),er,Se.slice(nt-ye)].join(""),nt++});if(nt=Se.indexOf(We),Ye.fractionalPartGroupingPositions.forEach(function(ye){Se=[Se.slice(0,ye+nt+1),er,Se.slice(ye+nt+1)].join("")}),nt=Se.indexOf(We),(Ye.picture.indexOf(We)===-1||nt===Se.length-1)&&(Se=Se.substring(0,Se.length-1)),typeof Ft<"u"){var Nr=hn(Ft,0);tr=Ye.minimumExponentSize-Nr.length,tr>0&&(Nr=new Array(tr+1).join(_t)+Nr),Se=Se+I["exponent-separator"]+(Ft<0?Ze:"")+Nr}return Se=Ye.prefix+Se+Ye.suffix,Se}}function R(l,d){if(!(typeof l>"u")){if(l=X(l),typeof d>"u"?d=10:d=X(d),d<2||d>36)throw{code:"D3100",stack:new Error().stack,value:d};var f=l.toString(d);return f}}function K(l){var d;if(!(typeof l>"u")){if(typeof l=="number")d=l;else if(typeof l=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(l)&&!isNaN(parseFloat(l))&&isFinite(l))d=parseFloat(l);else if(typeof l=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(l))d=Number(l);else if(l===!0)d=1;else if(l===!1)d=0;else throw{code:"D3030",value:l,stack:new Error().stack,index:1};return d}}function Q(l){var d;if(!(typeof l>"u"))return d=Math.abs(l),d}function H(l){var d;if(!(typeof l>"u"))return d=Math.floor(l),d}function q(l){var d;if(!(typeof l>"u"))return d=Math.ceil(l),d}function X(l,d){var f;if(!(typeof l>"u")){if(d){var A=l.toString().split("e");l=+(A[0]+"e"+(A[1]?+A[1]+d:d))}f=Math.round(l);var I=f-l;return Math.abs(I)===.5&&Math.abs(f%2)===1&&(f=f-1),d&&(A=f.toString().split("e"),f=+(A[0]+"e"+(A[1]?+A[1]-d:-d))),Object.is(f,-0)&&(f=0),f}}function de(l){var d;if(!(typeof l>"u")){if(l<0)throw{stack:new Error().stack,code:"D3060",index:1,value:l};return d=Math.sqrt(l),d}}function Ce(l,d){var f;if(!(typeof l>"u")){if(f=Math.pow(l,d),!isFinite(f))throw{stack:new Error().stack,code:"D3061",index:1,value:l,exp:d};return f}}function Re(){return Math.random()}function pe(l){if(!(typeof l>"u")){var d=!1;if(Array.isArray(l)){if(l.length===1)d=pe(l[0]);else if(l.length>1){var f=l.filter(function(A){return pe(A)});d=f.length>0}}else typeof l=="string"?l.length>0&&(d=!0):E(l)?l!==0&&(d=!0):l!==null&&typeof l=="object"?Object.keys(l).length>0&&(d=!0):typeof l=="boolean"&&l===!0&&(d=!0);return d}}function be(l){if(!(typeof l>"u"))return!pe(l)}function Le(l,d,f,A){var I=[d],L=we(l);return L>=2&&I.push(f),L>=3&&I.push(A),I}async function ce(l,d){if(!(typeof l>"u")){for(var f=O(),A=0;A<l.length;A++){var I=Le(d,l[A],A,l),L=await d.apply(this,I);typeof L<"u"&&f.push(L)}return f}}async function st(l,d){if(!(typeof l>"u")){for(var f=O(),A=0;A<l.length;A++){var I=l[A],L=Le(d,I,A,l),V=await d.apply(this,L);pe(V)&&f.push(I)}return f}}async function Ot(l,d){if(!(typeof l>"u")){for(var f=!1,A,I=0;I<l.length;I++){var L=l[I],V=!0;if(typeof d<"u"){var oe=Le(d,L,I,l),he=await d.apply(this,oe);V=pe(he)}if(V)if(!f)A=L,f=!0;else throw{stack:new Error().stack,code:"D3138",index:I}}if(!f)throw{stack:new Error().stack,code:"D3139"};return A}}function ht(){for(var l=[],d=Array.prototype.slice.call(arguments),f=Math.min.apply(Math,d.map(function(L){return Array.isArray(L)?L.length:0})),A=0;A<f;A++){var I=d.map(L=>L[A]);l.push(I)}return l}async function at(l,d,f){if(!(typeof l>"u")){var A,I=we(d);if(I<2)throw{stack:new Error().stack,code:"D3050",index:1};var L;for(typeof f>"u"&&l.length>0?(A=l[0],L=1):(A=f,L=0);L<l.length;){var V=[A,l[L]];I>=3&&V.push(L),I>=4&&V.push(l),A=await d.apply(this,V),L++}return A}}function ft(l){var d=O();if(Array.isArray(l)){var f={};l.forEach(function(A){var I=ft(A);I.forEach(function(L){f[L]=!0})}),d=ft(f)}else l!==null&&typeof l=="object"&&!T(l)&&Object.keys(l).forEach(A=>d.push(A));return d}function Rt(l,d){var f;if(Array.isArray(l)){f=O();for(var A=0;A<l.length;A++){var I=Rt(l[A],d);typeof I<"u"&&(Array.isArray(I)?I.forEach(L=>f.push(L)):f.push(I))}}else l!==null&&typeof l=="object"&&!T(l)&&(f=l[d]);return f}function Gt(l,d){return typeof l>"u"?d:typeof d>"u"?l:(Array.isArray(l)||(l=O(l)),Array.isArray(d)||(d=[d]),l.concat(d))}function cr(l){return!(typeof l>"u")}function $t(l){var d=O();if(Array.isArray(l))l.forEach(function(I){d=Gt(d,$t(I))});else if(l!==null&&typeof l=="object"&&!j(l))for(var f in l){var A={};A[f]=l[f],d.push(A)}else d=l;return d}function ne(l){if(!(typeof l>"u")){var d={};return l.forEach(function(f){for(var A in f)d[A]=f[A]}),d}}function ur(l){if(!(typeof l>"u")){if(l.length<=1)return l;for(var d=l.length,f=new Array(d),A=0;A<d;A++)f[d-A-1]=l[A];return f}}async function Xt(l,d){var f=O();for(var A in l){var I=Le(d,l[A],A,l),L=await d.apply(this,I);typeof L<"u"&&f.push(L)}return f}function Pt(l){throw{code:"D3137",stack:new Error().stack,message:l||"$error() function evaluated"}}function Xe(l,d){if(!l)throw{code:"D3141",stack:new Error().stack,message:d||"$assert() statement failed"}}function Nt(l){if(l!==void 0)return l===null?"null":E(l)?"number":typeof l=="string"?"string":typeof l=="boolean"?"boolean":Array.isArray(l)?"array":T(l)?"function":"object"}async function De(l,d){if(!(typeof l>"u")){if(l.length<=1)return l;var f;if(typeof d>"u"){if(!C(l)&&!x(l))throw{stack:new Error().stack,code:"D3070",index:1};f=async function(V,oe){return V>oe}}else f=d;var A=async function(V,oe){var he=async function(xe,Fe,Ne){Fe.length===0?Array.prototype.push.apply(xe,Ne):Ne.length===0?Array.prototype.push.apply(xe,Fe):await f(Fe[0],Ne[0])?(xe.push(Ne[0]),await he(xe,Fe,Ne.slice(1))):(xe.push(Fe[0]),await he(xe,Fe.slice(1),Ne))},$e=[];return await he($e,V,oe),$e},I=async function(V){if(!Array.isArray(V)||V.length<=1)return V;var oe=Math.floor(V.length/2),he=V.slice(0,oe),$e=V.slice(oe);return he=await I(he),$e=await I($e),await A(he,$e)},L=await I(l);return L}}function h(l){if(!(typeof l>"u")){if(l.length<=1)return l;for(var d=new Array(l.length),f=0;f<l.length;f++){var A=Math.floor(Math.random()*(f+1));f!==A&&(d[f]=d[A]),d[A]=l[f]}return d}}function b(l){if(!(typeof l>"u")){if(!Array.isArray(l)||l.length<=1)return l;for(var d=w(l)?O():[],f=0;f<l.length;f++){for(var A=l[f],I=!1,L=0;L<d.length;L++)if(Oe(A,d[L])){I=!0;break}I||d.push(A)}return d}}async function S(l,d){var f={};for(var A in l){var I=l[A],L=Le(d,I,A,l),V=await d.apply(this,L);pe(V)&&(f[A]=I)}return Object.keys(f).length===0&&(f=void 0),f}return{sum:D,count:B,max:N,min:v,average:F,string:z,substring:ie,substringBefore:me,substringAfter:J,lowercase:re,uppercase:le,length:ke,trim:qe,pad:ve,match:ee,contains:Ue,replace:Ee,split:Te,join:P,formatNumber:$,formatBase:R,number:K,floor:H,ceil:q,round:X,abs:Q,sqrt:de,power:Ce,random:Re,boolean:pe,not:be,map:ce,zip:ht,filter:st,single:Ot,foldLeft:at,sift:S,keys:ft,lookup:Rt,append:Gt,exists:cr,spread:$t,merge:ne,reverse:ur,each:Xt,error:Pt,assert:Xe,type:Nt,sort:De,shuffle:h,distinct:b,base64encode:Pe,base64decode:y,encodeUrlComponent:k,encodeUrl:ae,decodeUrlComponent:Ae,decodeUrl:Be}})();i.exports=m}).call(this)}).call(this,typeof Fi<"u"?Fi:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(t,i,a){var u=t("./datetime"),o=t("./functions"),m=t("./utils"),E=t("./parser"),x=t("./signature"),C=function(){var O=m.isNumeric,w=m.isArrayOfStrings,T=m.isArrayOfNumbers,j=m.createSequence,te=m.isSequence,we=m.isFunction,Oe=m.isLambda,U=m.isIterable,D=m.isPromise,B=m.getFunctionArity,N=m.isDeepEqual,v=Pt(null);async function F(h,b,S){var l,d=S.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(d&&await d(h,b,S),h.type){case"path":l=await z(h,b,S);break;case"binary":l=await ke(h,b,S);break;case"unary":l=await qe(h,b,S);break;case"name":l=ve(h,b);break;case"string":case"number":case"value":l=ge(h);break;case"wildcard":l=Ue(h,b);break;case"descendant":l=Ee(h,b);break;case"parent":l=S.lookup(h.slot.label);break;case"condition":l=await H(h,b,S);break;case"block":l=await q(h,b,S);break;case"bind":l=await Q(h,b,S);break;case"regex":l=X(h);break;case"function":l=await Le(h,b,S);break;case"variable":l=de(h,b,S);break;case"lambda":l=Ot(h,b,S);break;case"partial":l=await ht(h,b,S);break;case"apply":l=await be(h,b,S);break;case"transform":l=Re(h,b,S);break}if(Object.prototype.hasOwnProperty.call(h,"predicate"))for(var f=0;f<h.predicate.length;f++)l=await le(h.predicate[f].expr,l,S);h.type!=="path"&&Object.prototype.hasOwnProperty.call(h,"group")&&(l=await $(h.group,l,S));var A=S.lookup(Symbol.for("jsonata.__evaluate_exit"));return A&&await A(h,b,S,l),l&&te(l)&&!l.tupleStream&&(h.keepArray&&(l.keepSingleton=!0),l.length===0?l=void 0:l.length===1&&(l=l.keepSingleton?l:l[0])),l}async function z(h,b,S){var l;Array.isArray(b)&&h.steps[0].type!=="variable"?l=b:l=j(b);for(var d,f=!1,A=void 0,I=0;I<h.steps.length;I++){var L=h.steps[I];if(L.tuple&&(f=!0),I===0&&L.consarray?d=await F(L,l,S):f?A=await re(L,l,A,S):d=await me(L,l,S,I===h.steps.length-1),!f&&(typeof d>"u"||d.length===0))break;typeof L.focus>"u"&&(l=d)}if(f)if(h.tuple)d=A;else for(d=j(),I=0;I<A.length;I++)d.push(A[I]["@"]);return h.keepSingletonArray&&(Array.isArray(d)&&d.cons&&!d.sequence&&(d=j(d)),d.keepSingleton=!0),h.hasOwnProperty("group")&&(d=await $(h.group,f?A:d,S)),d}function ie(h,b){var S=Pt(h);for(const l in b)S.bind(l,b[l]);return S}async function me(h,b,S,l){var d;if(h.type==="sort")return d=await Ce(h,b,S),h.stages&&(d=await J(h.stages,d,S)),d;d=j();for(var f=0;f<b.length;f++){var A=await F(h,b[f],S);if(h.stages)for(var I=0;I<h.stages.length;I++)A=await le(h.stages[I].expr,A,S);typeof A<"u"&&d.push(A)}var L=j();return l&&d.length===1&&Array.isArray(d[0])&&!te(d[0])?L=d[0]:d.forEach(function(V){!Array.isArray(V)||V.cons?L.push(V):V.forEach(oe=>L.push(oe))}),L}async function J(h,b,S){for(var l=b,d=0;d<h.length;d++){var f=h[d];switch(f.type){case"filter":l=await le(f.expr,l,S);break;case"index":for(var A=0;A<l.length;A++){var I=l[A];I[f.value]=A}break}}return l}async function re(h,b,S,l){var d;if(h.type==="sort"){if(S)d=await Ce(h,S,l);else{var f=await Ce(h,b,l);d=j(),d.tupleStream=!0;for(var A=0;A<f.length;A++){var I={"@":f[A]};I[h.index]=A,d.push(I)}}return h.stages&&(d=await J(h.stages,d,l)),d}d=j(),d.tupleStream=!0;var L=l;S===void 0&&(S=b.map($e=>({"@":$e})));for(var V=0;V<S.length;V++){L=ie(l,S[V]);var oe=await F(h,S[V]["@"],L);if(typeof oe<"u"){Array.isArray(oe)||(oe=[oe]);for(var he=0;he<oe.length;he++)I={},Object.assign(I,S[V]),oe.tupleStream?Object.assign(I,oe[he]):(h.focus?(I[h.focus]=oe[he],I["@"]=S[V]["@"]):I["@"]=oe[he],h.index&&(I[h.index]=he),h.ancestor&&(I[h.ancestor.label]=S[V]["@"])),d.push(I)}}return h.stages&&(d=await J(h.stages,d,l)),d}async function le(h,b,S){var l=j();if(b&&b.tupleStream&&(l.tupleStream=!0),Array.isArray(b)||(b=j(b)),h.type==="number"){var d=Math.floor(h.value);d<0&&(d=b.length+d);var f=b[d];typeof f<"u"&&(Array.isArray(f)?l=f:l.push(f))}else for(d=0;d<b.length;d++){var f=b[d],A=f,I=S;b.tupleStream&&(A=f["@"],I=ie(S,f));var L=await F(h,A,I);O(L)&&(L=[L]),T(L)?L.forEach(function(oe){var he=Math.floor(oe);he<0&&(he=b.length+he),he===d&&l.push(f)}):o.boolean(L)&&l.push(f)}return l}async function ke(h,b,S){var l,d=await F(h.lhs,b,S),f=h.value,A=async()=>await F(h.rhs,b,S);if(f==="and"||f==="or")try{return await Be(d,A,f)}catch(L){throw L.position=h.position,L.token=f,L}var I=await A();try{switch(f){case"+":case"-":case"*":case"/":case"%":l=y(d,I,f);break;case"=":case"!=":l=k(d,I,f);break;case"<":case"<=":case">":case">=":l=ae(d,I,f);break;case"&":l=P(d,I);break;case"..":l=K(d,I);break;case"in":l=Ae(d,I);break}}catch(L){throw L.position=h.position,L.token=f,L}return l}async function qe(h,b,S){var l;switch(h.value){case"-":if(l=await F(h.expression,b,S),typeof l>"u")l=void 0;else if(O(l))l=-l;else throw{code:"D1002",stack:new Error().stack,position:h.position,token:h.value,value:l};break;case"[":l=[];let A=await Promise.all(h.expressions.map(async(I,L)=>(S.isParallelCall=L>0,[I,await F(I,b,S)])));for(let I of A){var[d,f]=I;typeof f<"u"&&(d.value==="["?l.push(f):l=o.append(l,f))}h.consarray&&Object.defineProperty(l,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":l=await $(h,b,S);break}return l}function ve(h,b,S){return o.lookup(b,h.value)}function ge(h){return h.value}function Ue(h,b){var S=j();return Array.isArray(b)&&b.outerWrapper&&b.length>0&&(b=b[0]),b!==null&&typeof b=="object"&&Object.keys(b).forEach(function(l){var d=b[l];Array.isArray(d)?(d=ee(d),S=o.append(S,d)):S.push(d)}),S}function ee(h,b){return typeof b>"u"&&(b=[]),Array.isArray(h)?h.forEach(function(S){ee(S,b)}):b.push(h),b}function Ee(h,b){var S,l=j();return typeof b<"u"&&(Pe(b,l),l.length===1?S=l[0]:S=l),S}function Pe(h,b){Array.isArray(h)||b.push(h),Array.isArray(h)?h.forEach(function(S){Pe(S,b)}):h!==null&&typeof h=="object"&&Object.keys(h).forEach(function(S){Pe(h[S],b)})}function y(h,b,S){var l;if(typeof h<"u"&&!O(h))throw{code:"T2001",stack:new Error().stack,value:h};if(typeof b<"u"&&!O(b))throw{code:"T2002",stack:new Error().stack,value:b};if(typeof h>"u"||typeof b>"u")return l;switch(S){case"+":l=h+b;break;case"-":l=h-b;break;case"*":l=h*b;break;case"/":l=h/b;break;case"%":l=h%b;break}return l}function k(h,b,S){var l,d=typeof h,f=typeof b;if(d==="undefined"||f==="undefined")return!1;switch(S){case"=":l=N(h,b);break;case"!=":l=!N(h,b);break}return l}function ae(h,b,S){var l,d=typeof h,f=typeof b,A=d==="undefined"||d==="string"||d==="number",I=f==="undefined"||f==="string"||f==="number";if(!A||!I)throw{code:"T2010",stack:new Error().stack,value:d==="string"||d==="number"?b:h};if(!(d==="undefined"||f==="undefined")){if(d!==f)throw{code:"T2009",stack:new Error().stack,value:h,value2:b};switch(S){case"<":l=h<b;break;case"<=":l=h<=b;break;case">":l=h>b;break;case">=":l=h>=b;break}return l}}function Ae(h,b){var S=!1;if(typeof h>"u"||typeof b>"u")return!1;Array.isArray(b)||(b=[b]);for(var l=0;l<b.length;l++)if(b[l]===h){S=!0;break}return S}async function Be(h,b,S){var l,d=Te(h);switch(S){case"and":l=d&&Te(await b());break;case"or":l=d||Te(await b());break}return l}function Te(h){var b=o.boolean(h);return typeof b>"u"?!1:b}function P(h,b){var S,l="",d="";return typeof h<"u"&&(l=o.string(h)),typeof b<"u"&&(d=o.string(b)),S=l.concat(d),S}async function $(h,b,S){var l={},d={},f=!!(b&&b.tupleStream);Array.isArray(b)||(b=j(b)),b.length===0&&b.push(void 0);for(var A=0;A<b.length;A++)for(var I=b[A],L=f?ie(S,I):S,V=0;V<h.lhs.length;V++){var oe=h.lhs[V],he=await F(oe[0],f?I["@"]:I,L);if(typeof he!="string"&&he!==void 0)throw{code:"T1003",stack:new Error().stack,position:h.position,value:he};if(he!==void 0){var $e={data:I,exprIndex:V};if(d.hasOwnProperty(he)){if(d[he].exprIndex!==V)throw{code:"D1009",stack:new Error().stack,position:h.position,value:he};d[he].data=o.append(d[he].data,I)}else d[he]=$e}}let xe=await Promise.all(Object.keys(d).map(async(Ne,tt)=>{let _e=d[Ne];var Ze=_e.data,_t=S;if(f){var We=R(_e.data);Ze=We["@"],delete We["@"],_t=ie(S,We)}return S.isParallelCall=tt>0,[Ne,await F(h.lhs[_e.exprIndex][1],Ze,_t)]}));for(let Ne of xe){var[he,Fe]=await Ne;typeof Fe<"u"&&(l[he]=Fe)}return l}function R(h){if(!Array.isArray(h))return h;var b={};Object.assign(b,h[0]);for(var S=1;S<h.length;S++)for(const l in h[S])b[l]=o.append(b[l],h[S][l]);return b}function K(h,b){var S;if(typeof h<"u"&&!Number.isInteger(h))throw{code:"T2003",stack:new Error().stack,value:h};if(typeof b<"u"&&!Number.isInteger(b))throw{code:"T2004",stack:new Error().stack,value:b};if(typeof h>"u"||typeof b>"u"||h>b)return S;var l=b-h+1;if(l>1e7)throw{code:"D2014",stack:new Error().stack,value:l};S=new Array(l);for(var d=h,f=0;d<=b;d++,f++)S[f]=d;return S.sequence=!0,S}async function Q(h,b,S){var l=await F(h.rhs,b,S);return S.bind(h.lhs.value,l),l}async function H(h,b,S){var l,d=await F(h.condition,b,S);return o.boolean(d)?l=await F(h.then,b,S):typeof h.else<"u"&&(l=await F(h.else,b,S)),l}async function q(h,b,S){for(var l,d=Pt(S),f=0;f<h.expressions.length;f++)l=await F(h.expressions[f],b,d);return l}function X(h){var b=new De.RegexEngine(h.value),S=function(l,d){var f;b.lastIndex=d||0;var A=b.exec(l);if(A!==null){if(f={match:A[0],start:A.index,end:A.index+A[0].length,groups:[]},A.length>1)for(var I=1;I<A.length;I++)f.groups.push(A[I]);f.next=function(){if(!(b.lastIndex>=l.length)){var L=S(l,b.lastIndex);if(L&&L.match==="")throw{code:"D1004",stack:new Error().stack,position:h.position,value:h.value.source};return L}}}return f};return S}function de(h,b,S){var l;return h.value===""?l=b&&b.outerWrapper?b[0]:b:l=S.lookup(h.value),l}async function Ce(h,b,S){var l,d=b,f=!!b.tupleStream,A=async function(L,V){for(var oe=0,he=0;oe===0&&he<h.terms.length;he++){var $e=h.terms[he],xe=L,Fe=S;f&&(xe=L["@"],Fe=ie(S,L));var Ne=await F($e.expression,xe,Fe);xe=V,Fe=S,f&&(xe=V["@"],Fe=ie(S,V));var tt=await F($e.expression,xe,Fe),_e=typeof Ne,Ze=typeof tt;if(_e==="undefined"){oe=Ze==="undefined"?0:1;continue}if(Ze==="undefined"){oe=-1;continue}if(!(_e==="string"||_e==="number")||!(Ze==="string"||Ze==="number"))throw{code:"T2008",stack:new Error().stack,position:h.position,value:_e==="string"||_e==="number"?tt:Ne};if(_e!==Ze)throw{code:"T2007",stack:new Error().stack,position:h.position,value:Ne,value2:tt};Ne!==tt&&(Ne<tt?oe=-1:oe=1,$e.descending===!0&&(oe=-oe))}return oe===1},I={environment:S,input:b};return l=await o.sort.apply(I,[d,A]),l}function Re(h,b,S){var l=async function(d){if(!(typeof d>"u")){var f=S.lookup("clone");if(!we(f))throw{code:"T2013",stack:new Error().stack,position:h.position};var A=await ce(f,[d],null,S),I=await F(h.pattern,A,S);if(typeof I<"u"){Array.isArray(I)||(I=[I]);for(var L=0;L<I.length;L++){var V=I[L];if(V&&(V.isPrototypeOf(A)||V instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:h.position};var oe=await F(h.update,V,S),he=typeof oe;if(he!=="undefined"){if(he!=="object"||oe===null||Array.isArray(oe))throw{code:"T2011",stack:new Error().stack,position:h.update.position,value:oe};for(var $e in oe)V[$e]=oe[$e]}if(typeof h.delete<"u"){var xe=await F(h.delete,V,S);if(typeof xe<"u"){var Fe=xe;if(Array.isArray(xe)||(xe=[xe]),!w(xe))throw{code:"T2012",stack:new Error().stack,position:h.delete.position,value:Fe};for(var Ne=0;Ne<xe.length;Ne++)typeof V=="object"&&V!==null&&delete V[xe[Ne]]}}}}return A}};return ne(l,"<(oa):o>")}var pe=E("function($f, $g) { function($x){ $g($f($x)) } }");async function be(h,b,S){var l,d=await F(h.lhs,b,S);if(h.rhs.type==="function")l=await Le(h.rhs,b,S,{context:d});else{var f=await F(h.rhs,b,S);if(!we(f))throw{code:"T2006",stack:new Error().stack,position:h.position,value:f};if(we(d)){var A=await F(pe,null,S);l=await ce(A,[d,f],null,S)}else l=await ce(f,[d],null,S)}return l}async function Le(h,b,S,l){var d,f=await F(h.procedure,b,S);if(typeof f>"u"&&h.procedure.type==="path"&&S.lookup(h.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:h.position,token:h.procedure.steps[0].value};var A=[];typeof l<"u"&&A.push(l.context);for(var I=0;I<h.arguments.length;I++){const V=await F(h.arguments[I],b,S);if(we(V)){const oe=async function(...he){return await ce(V,he,null,S)};oe.arity=B(V),A.push(oe)}else A.push(V)}var L=h.procedure.type==="path"?h.procedure.steps[0].value:h.procedure.value;try{typeof f=="object"&&(f.token=L,f.position=h.position),d=await ce(f,A,b,S)}catch(V){throw V.position||(V.position=h.position),V.token||(V.token=L),V}return d}async function ce(h,b,S,l){var d;for(d=await st(h,b,S,l);Oe(d)&&d.thunk===!0;){var f=await F(d.body.procedure,d.input,d.environment);d.body.procedure.type==="variable"&&(f.token=d.body.procedure.value),f.position=d.body.procedure.position;for(var A=[],I=0;I<d.body.arguments.length;I++)A.push(await F(d.body.arguments[I],d.input,d.environment));d=await st(f,A,S,l)}return d}async function st(h,b,S,l){var d;try{var f=b;if(h&&(f=at(h.signature,b,S)),Oe(h))d=await ft(h,f);else if(h&&h._jsonata_function===!0){var A={environment:l,input:S};d=h.implementation.apply(A,f),U(d)&&(d=d.next().value),D(d)&&(d=await d)}else if(typeof h=="function")d=h.apply(S,f),D(d)&&(d=await d);else throw{code:"T1006",stack:new Error().stack}}catch(I){throw h&&(typeof I.token>"u"&&typeof h.token<"u"&&(I.token=h.token),I.position=h.position||I.position),I}return d}function Ot(h,b,S){var l={_jsonata_lambda:!0,input:b,environment:S,arguments:h.arguments,signature:h.signature,body:h.body};return h.thunk===!0&&(l.thunk=!0),l.apply=async function(d,f){return await ce(l,f,b,d?d.environment:S)},l}async function ht(h,b,S){for(var l,d=[],f=0;f<h.arguments.length;f++){var A=h.arguments[f];A.type==="operator"&&A.value==="?"?d.push(A):d.push(await F(A,b,S))}var I=await F(h.procedure,b,S);if(typeof I>"u"&&h.procedure.type==="path"&&S.lookup(h.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:h.position,token:h.procedure.steps[0].value};if(Oe(I))l=Rt(I,d);else if(I&&I._jsonata_function===!0)l=Gt(I.implementation,d);else if(typeof I=="function")l=Gt(I,d);else throw{code:"T1008",stack:new Error().stack,position:h.position,token:h.procedure.type==="path"?h.procedure.steps[0].value:h.procedure.value};return l}function at(h,b,S){if(typeof h>"u")return b;var l=h.validate(b,S);return l}async function ft(h,b){var S,l=Pt(h.environment);return h.arguments.forEach(function(d,f){l.bind(d.value,b[f])}),typeof h.body=="function"?S=await cr(h.body,l):S=await F(h.body,h.input,l),S}function Rt(h,b){var S=Pt(h.environment),l=[];h.arguments.forEach(function(f,A){var I=b[A];I&&I.type==="operator"&&I.value==="?"?l.push(f):S.bind(f.value,I)});var d={_jsonata_lambda:!0,input:h.input,environment:S,arguments:l,body:h.body};return d}function Gt(h,b){var S=$t(h);S=S.map(function(A){return"$"+A.trim()});var l="function("+S.join(", ")+"){ _ }",d=E(l);d.body=h;var f=Rt(d,b);return f}async function cr(h,b){var S=$t(h),l=S.map(function(A){return b.lookup(A.trim())}),d={environment:b},f=h.apply(d,l);return D(f)&&(f=await f),f}function $t(h){var b=h.toString(),S=/\(([^)]*)\)/.exec(b)[1],l=S.split(",");return l}function ne(h,b){var S={_jsonata_function:!0,implementation:h};return typeof b<"u"&&(S.signature=x(b)),S}async function ur(h,b){if(!(typeof h>"u")){var S=this.input;typeof b<"u"&&(S=b,Array.isArray(S)&&!te(S)&&(S=j(S),S.outerWrapper=!0));try{var l=E(h,!1)}catch(f){throw Nt(f),{stack:new Error().stack,code:"D3120",value:f.message,error:f}}try{var d=await F(l,S,this.environment)}catch(f){throw Nt(f),{stack:new Error().stack,code:"D3121",value:f.message,error:f}}return d}}function Xt(h){if(!(typeof h>"u"))return JSON.parse(o.string(h))}function Pt(h){var b={};const S={bind:function(d,f){b[d]=f},lookup:function(d){var f;return b.hasOwnProperty(d)?f=b[d]:h&&(f=h.lookup(d)),f},timestamp:h?h.timestamp:null,async:h?h.async:!1,isParallelCall:h?h.isParallelCall:!1,global:h?h.global:{ancestry:[null]}};if(h){var l=h.lookup(Symbol.for("jsonata.__createFrame_push"));l&&l(h,S)}return S}v.bind("sum",ne(o.sum,"<a<n>:n>")),v.bind("count",ne(o.count,"<a:n>")),v.bind("max",ne(o.max,"<a<n>:n>")),v.bind("min",ne(o.min,"<a<n>:n>")),v.bind("average",ne(o.average,"<a<n>:n>")),v.bind("string",ne(o.string,"<x-b?:s>")),v.bind("substring",ne(o.substring,"<s-nn?:s>")),v.bind("substringBefore",ne(o.substringBefore,"<s-s:s>")),v.bind("substringAfter",ne(o.substringAfter,"<s-s:s>")),v.bind("lowercase",ne(o.lowercase,"<s-:s>")),v.bind("uppercase",ne(o.uppercase,"<s-:s>")),v.bind("length",ne(o.length,"<s-:n>")),v.bind("trim",ne(o.trim,"<s-:s>")),v.bind("pad",ne(o.pad,"<s-ns?:s>")),v.bind("match",ne(o.match,"<s-f<s:o>n?:a<o>>")),v.bind("contains",ne(o.contains,"<s-(sf):b>")),v.bind("replace",ne(o.replace,"<s-(sf)(sf)n?:s>")),v.bind("split",ne(o.split,"<s-(sf)n?:a<s>>")),v.bind("join",ne(o.join,"<a<s>s?:s>")),v.bind("formatNumber",ne(o.formatNumber,"<n-so?:s>")),v.bind("formatBase",ne(o.formatBase,"<n-n?:s>")),v.bind("formatInteger",ne(u.formatInteger,"<n-s:s>")),v.bind("parseInteger",ne(u.parseInteger,"<s-s:n>")),v.bind("number",ne(o.number,"<(nsb)-:n>")),v.bind("floor",ne(o.floor,"<n-:n>")),v.bind("ceil",ne(o.ceil,"<n-:n>")),v.bind("round",ne(o.round,"<n-n?:n>")),v.bind("abs",ne(o.abs,"<n-:n>")),v.bind("sqrt",ne(o.sqrt,"<n-:n>")),v.bind("power",ne(o.power,"<n-n:n>")),v.bind("random",ne(o.random,"<:n>")),v.bind("boolean",ne(o.boolean,"<x-:b>")),v.bind("not",ne(o.not,"<x-:b>")),v.bind("map",ne(o.map,"<af>")),v.bind("zip",ne(o.zip,"<a+>")),v.bind("filter",ne(o.filter,"<af>")),v.bind("single",ne(o.single,"<af?>")),v.bind("reduce",ne(o.foldLeft,"<afj?:j>")),v.bind("sift",ne(o.sift,"<o-f?:o>")),v.bind("keys",ne(o.keys,"<x-:a<s>>")),v.bind("lookup",ne(o.lookup,"<x-s:x>")),v.bind("append",ne(o.append,"<xx:a>")),v.bind("exists",ne(o.exists,"<x:b>")),v.bind("spread",ne(o.spread,"<x-:a<o>>")),v.bind("merge",ne(o.merge,"<a<o>:o>")),v.bind("reverse",ne(o.reverse,"<a:a>")),v.bind("each",ne(o.each,"<o-f:a>")),v.bind("error",ne(o.error,"<s?:x>")),v.bind("assert",ne(o.assert,"<bs?:x>")),v.bind("type",ne(o.type,"<x:s>")),v.bind("sort",ne(o.sort,"<af?:a>")),v.bind("shuffle",ne(o.shuffle,"<a:a>")),v.bind("distinct",ne(o.distinct,"<x:x>")),v.bind("base64encode",ne(o.base64encode,"<s-:s>")),v.bind("base64decode",ne(o.base64decode,"<s-:s>")),v.bind("encodeUrlComponent",ne(o.encodeUrlComponent,"<s-:s>")),v.bind("encodeUrl",ne(o.encodeUrl,"<s-:s>")),v.bind("decodeUrlComponent",ne(o.decodeUrlComponent,"<s-:s>")),v.bind("decodeUrl",ne(o.decodeUrl,"<s-:s>")),v.bind("eval",ne(ur,"<sx?:x>")),v.bind("toMillis",ne(u.toMillis,"<s-s?:n>")),v.bind("fromMillis",ne(u.fromMillis,"<n-s?s?:s>")),v.bind("clone",ne(Xt,"<(oa)-:o>"));var Xe={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Nt(h){var b=Xe[h.code];if(typeof b<"u"){var S=b.replace(/\{\{\{([^}]+)}}}/g,function(){return h[arguments[1]]});S=S.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(h[arguments[1]])}),h.message=S}}function De(h,b){var S,l;try{S=E(h,b&&b.recover),l=S.errors,delete S.errors}catch(A){throw Nt(A),A}var d=Pt(v),f=new Date;return d.bind("now",ne(function(A,I){return u.fromMillis(f.getTime(),A,I)},"<s?s?:s>")),d.bind("millis",ne(function(){return f.getTime()},"<:n>")),b&&b.RegexEngine?De.RegexEngine=b.RegexEngine:De.RegexEngine=RegExp,{evaluate:async function(A,I,L){if(typeof l<"u"){var V={code:"S0500",position:0};throw Nt(V),V}if(typeof I<"u"){var oe;oe=Pt(d);for(var he in I)oe.bind(he,I[he])}else oe=d;oe.bind("$",A),f=new Date,oe.timestamp=f,Array.isArray(A)&&!te(A)&&(A=j(A),A.outerWrapper=!0);var $e;try{return $e=await F(S,A,oe),typeof L=="function"&&L(null,$e),$e}catch(xe){throw Nt(xe),xe}},assign:function(A,I){d.bind(A,I)},registerFunction:function(A,I,L){var V=ne(I,L);d.bind(A,V)},ast:function(){return S},errors:function(){return l}}}return De.parser=E,De}();i.exports=C},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(t,i,a){var u=t("./signature");const o=(()=>{var m={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},E={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},x=function(O){var w=0,T=O.length,j=function(Oe,U){var D={type:Oe,value:U,position:w};return D},te=function(){for(var Oe=w,U=0,D,B,N=function(F){if(O.charAt(F)==="/"&&U===0){for(var z=0;O.charAt(F-(z+1))==="\\";)z++;if(z%2===0)return!0}return!1};w<T;){var v=O.charAt(w);if(N(w)){if(D=O.substring(Oe,w),D==="")throw{code:"S0301",stack:new Error().stack,position:w};for(w++,v=O.charAt(w),Oe=w;v==="i"||v==="m";)w++,v=O.charAt(w);return B=O.substring(Oe,w)+"g",new RegExp(D,B)}(v==="("||v==="["||v==="{")&&O.charAt(w-1)!=="\\"&&U++,(v===")"||v==="]"||v==="}")&&O.charAt(w-1)!=="\\"&&U--,w++}throw{code:"S0302",stack:new Error().stack,position:w}},we=function(Oe){if(w>=T)return null;for(var U=O.charAt(w);w<T&&` 	
\r\v`.indexOf(U)>-1;)w++,U=O.charAt(w);if(U==="/"&&O.charAt(w+1)==="*"){var D=w;for(w+=2,U=O.charAt(w);!(U==="*"&&O.charAt(w+1)==="/");)if(U=O.charAt(++w),w>=T)throw{code:"S0106",stack:new Error().stack,position:D};return w+=2,U=O.charAt(w),we(Oe)}if(Oe!==!0&&U==="/")return w++,j("regex",te());if(U==="."&&O.charAt(w+1)===".")return w+=2,j("operator","..");if(U===":"&&O.charAt(w+1)==="=")return w+=2,j("operator",":=");if(U==="!"&&O.charAt(w+1)==="=")return w+=2,j("operator","!=");if(U===">"&&O.charAt(w+1)==="=")return w+=2,j("operator",">=");if(U==="<"&&O.charAt(w+1)==="=")return w+=2,j("operator","<=");if(U==="*"&&O.charAt(w+1)==="*")return w+=2,j("operator","**");if(U==="~"&&O.charAt(w+1)===">")return w+=2,j("operator","~>");if(Object.prototype.hasOwnProperty.call(m,U))return w++,j("operator",U);if(U==='"'||U==="'"){var B=U;w++;for(var N="";w<T;){if(U=O.charAt(w),U==="\\")if(w++,U=O.charAt(w),Object.prototype.hasOwnProperty.call(E,U))N+=E[U];else if(U==="u"){var v=O.substr(w+1,4);if(/^[0-9a-fA-F]+$/.test(v)){var F=parseInt(v,16);N+=String.fromCharCode(F),w+=4}else throw{code:"S0104",stack:new Error().stack,position:w}}else throw{code:"S0103",stack:new Error().stack,position:w,token:U};else{if(U===B)return w++,j("string",N);N+=U}w++}throw{code:"S0101",stack:new Error().stack,position:w}}var z=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,ie=z.exec(O.substring(w));if(ie!==null){var me=parseFloat(ie[0]);if(!isNaN(me)&&isFinite(me))return w+=ie[0].length,j("number",me);throw{code:"S0102",stack:new Error().stack,position:w,token:ie[0]}}var J;if(U==="`"){w++;var re=O.indexOf("`",w);if(re!==-1)return J=O.substring(w,re),w=re+1,j("name",J);throw w=T,{code:"S0105",stack:new Error().stack,position:w}}for(var le=w,ke;;)if(ke=O.charAt(le),le===T||` 	
\r\v`.indexOf(ke)>-1||Object.prototype.hasOwnProperty.call(m,ke)){if(O.charAt(w)==="$")return J=O.substring(w+1,le),w=le,j("variable",J);switch(J=O.substring(w,le),w=le,J){case"or":case"in":case"and":return j("operator",J);case"true":return j("value",!0);case"false":return j("value",!1);case"null":return j("value",null);default:return w===T&&J===""?null:j("name",J)}}else le++};return we},C=function(O,w){var T,j,te={},we=[],Oe=function(){var y=[];T.id!=="(end)"&&y.push({type:T.type,value:T.value,position:T.position});for(var k=j();k!==null;)y.push(k),k=j();return y},U={nud:function(){var y={code:"S0211",token:this.value,position:this.position};if(w)return y.remaining=Oe(),y.type="error",we.push(y),y;throw y.stack=new Error().stack,y}},D=function(y,k){var ae=te[y];return k=k||0,ae?k>=ae.lbp&&(ae.lbp=k):(ae=Object.create(U),ae.id=ae.value=y,ae.lbp=k,te[y]=ae),ae},B=function(y){if(w){y.remaining=Oe(),we.push(y);var k=te["(error)"];return T=Object.create(k),T.error=y,T.type="(error)",T}else throw y.stack=new Error().stack,y},N=function(y,k){if(y&&T.id!==y){var ae;T.id==="(end)"?ae="S0203":ae="S0202";var Ae={code:ae,position:T.position,token:T.value,value:y};return B(Ae)}var Be=j(k);if(Be===null)return T=te["(end)"],T.position=O.length,T;var Te=Be.value,P=Be.type,$;switch(P){case"name":case"variable":$=te["(name)"];break;case"operator":if($=te[Te],!$)return B({code:"S0204",stack:new Error().stack,position:Be.position,token:Te});break;case"string":case"number":case"value":$=te["(literal)"];break;case"regex":P="regex",$=te["(regex)"];break;default:return B({code:"S0205",stack:new Error().stack,position:Be.position,token:Te})}return T=Object.create($),T.value=Te,T.type=P,T.position=Be.position,T},v=function(y){var k,ae=T;for(N(null,!0),k=ae.nud();y<T.lbp;)ae=T,N(),k=ae.led(k);return k},F=function(y){var k=D(y,0);k.nud=function(){return this}},z=function(y,k,ae){var Ae=k||m[y],Be=D(y,Ae);return Be.led=ae||function(Te){return this.lhs=Te,this.rhs=v(Ae),this.type="binary",this},Be},ie=function(y,k,ae){var Ae=D(y,k);return Ae.led=ae,Ae},me=function(y,k){var ae=D(y);return ae.nud=k||function(){return this.expression=v(70),this.type="unary",this},ae};F("(end)"),F("(name)"),F("(literal)"),F("(regex)"),D(":"),D(";"),D(","),D(")"),D("]"),D("}"),D(".."),z("."),z("+"),z("-"),z("*"),z("/"),z("%"),z("="),z("<"),z(">"),z("!="),z("<="),z(">="),z("&"),z("and"),z("or"),z("in"),F("and"),F("or"),F("in"),me("-"),z("~>"),ie("(error)",10,function(y){return this.lhs=y,this.error=T.error,this.remaining=Oe(),this.type="error",this}),me("*",function(){return this.type="wildcard",this}),me("**",function(){return this.type="descendant",this}),me("%",function(){return this.type="parent",this}),z("(",m["("],function(y){if(this.procedure=y,this.type="function",this.arguments=[],T.id!==")")for(;T.type==="operator"&&T.id==="?"?(this.type="partial",this.arguments.push(T),N("?")):this.arguments.push(v(0)),T.id===",";)N(",");if(N(")",!0),y.type==="name"&&(y.value==="function"||y.value==="")){if(this.arguments.forEach(function(Te,P){if(Te.type!=="variable")return B({code:"S0208",stack:new Error().stack,position:Te.position,token:Te.value,value:P+1})}),this.type="lambda",T.id==="<"){for(var k=T.position,ae=1,Ae="<";ae>0&&T.id!=="{"&&T.id!=="(end)";){var Be=N();Be.id===">"?ae--:Be.id==="<"&&ae++,Ae+=Be.value}N(">");try{this.signature=u(Ae)}catch(Te){return Te.position=k+Te.offset,B(Te)}}N("{"),this.body=v(0),N("}")}return this}),me("(",function(){for(var y=[];T.id!==")"&&(y.push(v(0)),T.id===";");)N(";");return N(")",!0),this.type="block",this.expressions=y,this}),me("[",function(){var y=[];if(T.id!=="]")for(;;){var k=v(0);if(T.id===".."){var ae={type:"binary",value:"..",position:T.position,lhs:k};N(".."),ae.rhs=v(0),k=ae}if(y.push(k),T.id!==",")break;N(",")}return N("]",!0),this.expressions=y,this.type="unary",this}),z("[",m["["],function(y){if(T.id==="]"){for(var k=y;k&&k.type==="binary"&&k.value==="[";)k=k.lhs;return k.keepArray=!0,N("]"),y}else return this.lhs=y,this.rhs=v(m["]"]),this.type="binary",N("]",!0),this}),z("^",m["^"],function(y){N("(");for(var k=[];;){var ae={descending:!1};if(T.id==="<"?N("<"):T.id===">"&&(ae.descending=!0,N(">")),ae.expression=v(0),k.push(ae),T.id!==",")break;N(",")}return N(")"),this.lhs=y,this.rhs=k,this.type="binary",this});var J=function(y){var k=[];if(T.id!=="}")for(;;){var ae=v(0);N(":");var Ae=v(0);if(k.push([ae,Ae]),T.id!==",")break;N(",")}return N("}",!0),typeof y>"u"?(this.lhs=k,this.type="unary"):(this.lhs=y,this.rhs=k,this.type="binary"),this};me("{",J),z("{",m["{"],J),ie(":=",m[":="],function(y){return y.type!=="variable"?B({code:"S0212",stack:new Error().stack,position:y.position,token:y.value}):(this.lhs=y,this.rhs=v(m[":="]-1),this.type="binary",this)}),z("@",m["@"],function(y){return this.lhs=y,this.rhs=v(m["@"]),this.rhs.type!=="variable"?B({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),z("#",m["#"],function(y){return this.lhs=y,this.rhs=v(m["#"]),this.rhs.type!=="variable"?B({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),z("?",m["?"],function(y){return this.type="condition",this.condition=y,this.then=v(0),T.id===":"&&(N(":"),this.else=v(0)),this}),me("|",function(){return this.type="transform",this.pattern=v(0),N("|"),this.update=v(0),T.id===","&&(N(","),this.delete=v(0)),N("|"),this});var re=function(y){var k;if(y.type==="function"&&!y.predicate){var ae={type:"lambda",thunk:!0,arguments:[],position:y.position};ae.body=y,k=ae}else if(y.type==="condition")y.then=re(y.then),typeof y.else<"u"&&(y.else=re(y.else)),k=y;else if(y.type==="block"){var Ae=y.expressions.length;Ae>0&&(y.expressions[Ae-1]=re(y.expressions[Ae-1])),k=y}else k=y;return k},le=0,ke=0,qe=[],ve=function(y,k){switch(y.type){case"name":case"wildcard":k.level--,k.level===0&&(typeof y.ancestor>"u"||(qe[k.index].slot.label=y.ancestor.label),y.ancestor=k,y.tuple=!0);break;case"parent":k.level++;break;case"block":y.expressions.length>0&&(y.tuple=!0,k=ve(y.expressions[y.expressions.length-1],k));break;case"path":y.tuple=!0;var ae=y.steps.length-1;for(k=ve(y.steps[ae--],k);k.level>0&&ae>=0;)k=ve(y.steps[ae--],k);break;default:throw{code:"S0217",token:y.type,position:y.position}}return k},ge=function(y,k){if(typeof k.seekingParent<"u"||k.type==="parent"){var ae=typeof k.seekingParent<"u"?k.seekingParent:[];k.type==="parent"&&ae.push(k.slot),typeof y.seekingParent>"u"?y.seekingParent=ae:Array.prototype.push.apply(y.seekingParent,ae)}},Ue=function(y){var k=y.steps.length-1,ae=y.steps[k],Ae=typeof ae.seekingParent<"u"?ae.seekingParent:[];ae.type==="parent"&&Ae.push(ae.slot);for(var Be=0;Be<Ae.length;Be++){var Te=Ae[Be];for(k=y.steps.length-2;Te.level>0;){if(k<0){typeof y.seekingParent>"u"?y.seekingParent=[Te]:y.seekingParent.push(Te);break}for(var P=y.steps[k--];k>=0&&P.focus&&y.steps[k].focus;)P=y.steps[k--];Te=ve(P,Te)}}},ee=function(y){var k;switch(y.type){case"binary":switch(y.value){case".":var ae=ee(y.lhs);ae.type==="path"?k=ae:k={type:"path",steps:[ae]},ae.type==="parent"&&(k.seekingParent=[ae.slot]);var Ae=ee(y.rhs);Ae.type==="function"&&Ae.procedure.type==="path"&&Ae.procedure.steps.length===1&&Ae.procedure.steps[0].type==="name"&&k.steps[k.steps.length-1].type==="function"&&(k.steps[k.steps.length-1].nextFunction=Ae.procedure.steps[0].value),Ae.type==="path"?Array.prototype.push.apply(k.steps,Ae.steps):(typeof Ae.predicate<"u"&&(Ae.stages=Ae.predicate,delete Ae.predicate),k.steps.push(Ae)),k.steps.filter(function(X){if(X.type==="number"||X.type==="value")throw{code:"S0213",stack:new Error().stack,position:X.position,value:X.value};return X.type==="string"}).forEach(function(X){X.type="name"}),k.steps.filter(function(X){return X.keepArray===!0}).length>0&&(k.keepSingletonArray=!0);var Be=k.steps[0];Be.type==="unary"&&Be.value==="["&&(Be.consarray=!0);var Te=k.steps[k.steps.length-1];Te.type==="unary"&&Te.value==="["&&(Te.consarray=!0),Ue(k);break;case"[":k=ee(y.lhs);var P=k,$="predicate";if(k.type==="path"&&(P=k.steps[k.steps.length-1],$="stages"),typeof P.group<"u")throw{code:"S0209",stack:new Error().stack,position:y.position};typeof P[$]>"u"&&(P[$]=[]);var R=ee(y.rhs);typeof R.seekingParent<"u"&&(R.seekingParent.forEach(X=>{X.level===1?ve(P,X):X.level--}),ge(P,R)),P[$].push({type:"filter",expr:R,position:y.position});break;case"{":if(k=ee(y.lhs),typeof k.group<"u")throw{code:"S0210",stack:new Error().stack,position:y.position};k.group={lhs:y.rhs.map(function(X){return[ee(X[0]),ee(X[1])]}),position:y.position};break;case"^":k=ee(y.lhs),k.type!=="path"&&(k={type:"path",steps:[k]});var K={type:"sort",position:y.position};K.terms=y.rhs.map(function(X){var de=ee(X.expression);return ge(K,de),{descending:X.descending,expression:de}}),k.steps.push(K),Ue(k);break;case":=":k={type:"bind",value:y.value,position:y.position},k.lhs=ee(y.lhs),k.rhs=ee(y.rhs),ge(k,k.rhs);break;case"@":if(k=ee(y.lhs),P=k,k.type==="path"&&(P=k.steps[k.steps.length-1]),typeof P.stages<"u"||typeof P.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:y.position};if(P.type==="sort")throw{code:"S0216",stack:new Error().stack,position:y.position};y.keepArray&&(P.keepArray=!0),P.focus=y.rhs.value,P.tuple=!0;break;case"#":k=ee(y.lhs),P=k,k.type==="path"?P=k.steps[k.steps.length-1]:(k={type:"path",steps:[k]},typeof P.predicate<"u"&&(P.stages=P.predicate,delete P.predicate)),typeof P.stages>"u"?P.index=y.rhs.value:P.stages.push({type:"index",value:y.rhs.value,position:y.position}),P.tuple=!0;break;case"~>":k={type:"apply",value:y.value,position:y.position},k.lhs=ee(y.lhs),k.rhs=ee(y.rhs),k.keepArray=k.lhs.keepArray||k.rhs.keepArray;break;default:k={type:y.type,value:y.value,position:y.position},k.lhs=ee(y.lhs),k.rhs=ee(y.rhs),ge(k,k.lhs),ge(k,k.rhs)}break;case"unary":k={type:y.type,value:y.value,position:y.position},y.value==="["?k.expressions=y.expressions.map(function(X){var de=ee(X);return ge(k,de),de}):y.value==="{"?k.lhs=y.lhs.map(function(X){var de=ee(X[0]);ge(k,de);var Ce=ee(X[1]);return ge(k,Ce),[de,Ce]}):(k.expression=ee(y.expression),y.value==="-"&&k.expression.type==="number"?(k=k.expression,k.value=-k.value):ge(k,k.expression));break;case"function":case"partial":k={type:y.type,name:y.name,value:y.value,position:y.position},k.arguments=y.arguments.map(function(X){var de=ee(X);return ge(k,de),de}),k.procedure=ee(y.procedure);break;case"lambda":k={type:y.type,arguments:y.arguments,signature:y.signature,position:y.position};var Q=ee(y.body);k.body=re(Q);break;case"condition":k={type:y.type,position:y.position},k.condition=ee(y.condition),ge(k,k.condition),k.then=ee(y.then),ge(k,k.then),typeof y.else<"u"&&(k.else=ee(y.else),ge(k,k.else));break;case"transform":k={type:y.type,position:y.position},k.pattern=ee(y.pattern),k.update=ee(y.update),typeof y.delete<"u"&&(k.delete=ee(y.delete));break;case"block":k={type:y.type,position:y.position},k.expressions=y.expressions.map(function(X){var de=ee(X);return ge(k,de),(de.consarray||de.type==="path"&&de.steps[0].consarray)&&(k.consarray=!0),de});break;case"name":k={type:"path",steps:[y]},y.keepArray&&(k.keepSingletonArray=!0);break;case"parent":k={type:"parent",slot:{label:"!"+le++,level:1,index:ke++}},qe.push(k);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":k=y;break;case"operator":if(y.value==="and"||y.value==="or"||y.value==="in")y.type="name",k=ee(y);else if(y.value==="?")k=y;else throw{code:"S0201",stack:new Error().stack,position:y.position,token:y.value};break;case"error":k=y,y.lhs&&(k=ee(y.lhs));break;default:var H="S0206";y.id==="(end)"&&(H="S0207");var q={code:H,position:y.position,token:y.value};if(w)return we.push(q),{type:"error",error:q};throw q.stack=new Error().stack,q}return y.keepArray&&(k.keepArray=!0),k};j=x(O),N();var Ee=v(0);if(T.id!=="(end)"){var Pe={code:"S0201",position:T.position,token:T.value};B(Pe)}if(Ee=ee(Ee),Ee.type==="parent"||typeof Ee.seekingParent<"u")throw{code:"S0217",token:Ee.type,position:Ee.position};return we.length>0&&(Ee.errors=we),Ee};return C})();i.exports=o},{"./signature":5}],5:[function(t,i,a){var u=t("./utils");const o=(()=>{var m={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function E(x){for(var C=1,O=[],w={},T=w;C<x.length;){var j=x.charAt(C);if(j===":")break;var te=function(){O.push(w),T=w,w={}},we=function(z,ie,me,J){for(var re=1,le=ie;le<z.length;)if(le++,j=z.charAt(le),j===J){if(re--,re===0)break}else j===me&&re++;return le};switch(j){case"s":case"n":case"b":case"l":case"o":w.regex="["+j+"m]",w.type=j,te();break;case"a":w.regex="[asnblfom]",w.type=j,w.array=!0,te();break;case"f":w.regex="f",w.type=j,te();break;case"j":w.regex="[asnblom]",w.type=j,te();break;case"x":w.regex="[asnblfom]",w.type=j,te();break;case"-":T.context=!0,T.contextRegex=new RegExp(T.regex),T.regex+="?";break;case"?":case"+":T.regex+=j;break;case"(":var Oe=we(x,C,"(",")"),U=x.substring(C+1,Oe);if(U.indexOf("<")===-1)w.regex="["+U+"m]";else throw{code:"S0402",stack:new Error().stack,value:U,offset:C};w.type="("+U+")",C=Oe,te();break;case"<":if(T.type==="a"||T.type==="f"){var D=we(x,C,"<",">");T.subtype=x.substring(C+1,D),C=D}else throw{code:"S0401",stack:new Error().stack,value:T.type,offset:C};break}C++}var B="^"+O.map(function(z){return"("+z.regex+")"}).join("")+"$",N=new RegExp(B),v=function(z){var ie;if(u.isFunction(z))ie="f";else{var me=typeof z;switch(me){case"string":ie="s";break;case"number":ie="n";break;case"boolean":ie="b";break;case"object":z===null?ie="l":Array.isArray(z)?ie="a":ie="o";break;case"undefined":default:ie="m"}}return ie},F=function(z,ie){for(var me="^",J=0,re=0;re<O.length;re++){me+=O[re].regex;var le=ie.match(me);if(le===null)throw{code:"T0410",stack:new Error().stack,value:z[J],index:J+1};J=le[0].length}throw{code:"T0410",stack:new Error().stack,value:z[J],index:J+1}};return{definition:x,validate:function(z,ie){var me="";z.forEach(function(ke){me+=v(ke)});var J=N.exec(me);if(J){var re=[],le=0;return O.forEach(function(ke,qe){var ve=z[le],ge=J[qe+1];if(ge==="")if(ke.context&&ke.contextRegex){var Ue=v(ie);if(ke.contextRegex.test(Ue))re.push(ie);else throw{code:"T0411",stack:new Error().stack,value:ie,index:le+1}}else re.push(ve),le++;else ge.split("").forEach(function(ee){if(ke.type==="a"){if(ee==="m")ve=void 0;else{ve=z[le];var Ee=!0;if(typeof ke.subtype<"u"){if(ee!=="a"&&ge!==ke.subtype)Ee=!1;else if(ee==="a"&&ve.length>0){var Pe=v(ve[0]);if(Pe!==ke.subtype.charAt(0))Ee=!1;else{var y=ve.filter(function(k){return v(k)!==Pe});Ee=y.length===0}}}if(!Ee)throw{code:"T0412",stack:new Error().stack,value:ve,index:le+1,type:m[ke.subtype]};ee!=="a"&&(ve=[ve])}re.push(ve),le++}else re.push(ve),le++})}),re}F(z,me)}}}return E})();i.exports=o},{"./utils":6}],6:[function(t,i,a){const u=(()=>{function o(D){var B=!1;if(typeof D=="number"&&(B=!isNaN(D),B&&!isFinite(D)))throw{code:"D1001",value:D,stack:new Error().stack};return B}function m(D){var B=!1;return Array.isArray(D)&&(B=D.filter(function(N){return typeof N!="string"}).length===0),B}function E(D){var B=!1;return Array.isArray(D)&&(B=D.filter(function(N){return!o(N)}).length===0),B}function x(){var D=[];return D.sequence=!0,arguments.length===1&&D.push(arguments[0]),D}function C(D){return D.sequence===!0&&Array.isArray(D)}function O(D){return D&&(D._jsonata_function===!0||D._jsonata_lambda===!0)||typeof D=="function"}function w(D){var B=typeof D.arity=="number"?D.arity:typeof D.implementation=="function"?D.implementation.length:typeof D.length=="number"?D.length:D.arguments.length;return B}function T(D){return D&&D._jsonata_lambda===!0}var j=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function te(D){return typeof D=="object"&&D!==null&&j in D&&"next"in D&&typeof D.next=="function"}function we(D,B){if(D===B)return!0;if(typeof D=="object"&&typeof B=="object"&&D!==null&&B!==null){if(Array.isArray(D)&&Array.isArray(B)){if(D.length!==B.length)return!1;for(var N=0;N<D.length;N++)if(!we(D[N],B[N]))return!1;return!0}var v=Object.getOwnPropertyNames(D),F=Object.getOwnPropertyNames(B);if(v.length!==F.length)return!1;for(v=v.sort(),F=F.sort(),N=0;N<v.length;N++)if(v[N]!==F[N])return!1;for(N=0;N<v.length;N++){var z=v[N];if(!we(D[z],B[z]))return!1}return!0}return!1}function Oe(D){return typeof D=="object"&&D!==null&&"then"in D&&typeof D.then=="function"}function U(D){var B=[];for(let N of D)B.push(N);return B}return{isNumeric:o,isArrayOfStrings:m,isArrayOfNumbers:E,createSequence:x,isSequence:C,isFunction:O,isLambda:T,isIterable:te,getFunctionArity:w,isDeepEqual:we,stringToArray:U,isPromise:Oe}})();i.exports=u},{}]},{},[3])(3)})}(Jn)),Jn.exports}var $l=Ml();const Us=ss($l);var Vt={exports:{}};const wn=da(ha),Fl="16.5.0",ql={version:Fl};var ns;function zl(){if(ns)return Vt.exports;ns=1;var n={};const e=wn,t=wn,i=wn,a=wn,o=ql.version,m=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function E(v){const F={};let z=v.toString();z=z.replace(/\r\n?/mg,`
`);let ie;for(;(ie=m.exec(z))!=null;){const me=ie[1];let J=ie[2]||"";J=J.trim();const re=J[0];J=J.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),re==='"'&&(J=J.replace(/\\n/g,`
`),J=J.replace(/\\r/g,"\r")),F[me]=J}return F}function x(v){const F=j(v),z=N.configDotenv({path:F});if(!z.parsed){const re=new Error(`MISSING_DATA: Cannot parse ${F} for an unknown reason`);throw re.code="MISSING_DATA",re}const ie=w(v).split(","),me=ie.length;let J;for(let re=0;re<me;re++)try{const le=ie[re].trim(),ke=T(z,le);J=N.decrypt(ke.ciphertext,ke.key);break}catch(le){if(re+1>=me)throw le}return N.parse(J)}function C(v){console.log(`[dotenv@${o}][WARN] ${v}`)}function O(v){console.log(`[dotenv@${o}][DEBUG] ${v}`)}function w(v){return v&&v.DOTENV_KEY&&v.DOTENV_KEY.length>0?v.DOTENV_KEY:n.DOTENV_KEY&&n.DOTENV_KEY.length>0?n.DOTENV_KEY:""}function T(v,F){let z;try{z=new URL(F)}catch(le){if(le.code==="ERR_INVALID_URL"){const ke=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw ke.code="INVALID_DOTENV_KEY",ke}throw le}const ie=z.password;if(!ie){const le=new Error("INVALID_DOTENV_KEY: Missing key part");throw le.code="INVALID_DOTENV_KEY",le}const me=z.searchParams.get("environment");if(!me){const le=new Error("INVALID_DOTENV_KEY: Missing environment part");throw le.code="INVALID_DOTENV_KEY",le}const J=`DOTENV_VAULT_${me.toUpperCase()}`,re=v.parsed[J];if(!re){const le=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${J} in your .env.vault file.`);throw le.code="NOT_FOUND_DOTENV_ENVIRONMENT",le}return{ciphertext:re,key:ie}}function j(v){let F=null;if(v&&v.path&&v.path.length>0)if(Array.isArray(v.path))for(const z of v.path)e.existsSync(z)&&(F=z.endsWith(".vault")?z:`${z}.vault`);else F=v.path.endsWith(".vault")?v.path:`${v.path}.vault`;else F=t.resolve(process.cwd(),".env.vault");return e.existsSync(F)?F:null}function te(v){return v[0]==="~"?t.join(i.homedir(),v.slice(1)):v}function we(v){!!(v&&v.debug)&&O("Loading env from encrypted .env.vault");const z=N._parseVault(v);let ie=n;return v&&v.processEnv!=null&&(ie=v.processEnv),N.populate(ie,z,v),{parsed:z}}function Oe(v){const F=t.resolve(process.cwd(),".env");let z="utf8";const ie=!!(v&&v.debug);v&&v.encoding?z=v.encoding:ie&&O("No encoding is specified. UTF-8 is used by default");let me=[F];if(v&&v.path)if(!Array.isArray(v.path))me=[te(v.path)];else{me=[];for(const ke of v.path)me.push(te(ke))}let J;const re={};for(const ke of me)try{const qe=N.parse(e.readFileSync(ke,{encoding:z}));N.populate(re,qe,v)}catch(qe){ie&&O(`Failed to load ${ke} ${qe.message}`),J=qe}let le=n;return v&&v.processEnv!=null&&(le=v.processEnv),N.populate(le,re,v),J?{parsed:re,error:J}:{parsed:re}}function U(v){if(w(v).length===0)return N.configDotenv(v);const F=j(v);return F?N._configVault(v):(C(`You set DOTENV_KEY but you are missing a .env.vault file at ${F}. Did you forget to build it?`),N.configDotenv(v))}function D(v,F){const z=Buffer.from(F.slice(-64),"hex");let ie=Buffer.from(v,"base64");const me=ie.subarray(0,12),J=ie.subarray(-16);ie=ie.subarray(12,-16);try{const re=a.createDecipheriv("aes-256-gcm",z,me);return re.setAuthTag(J),`${re.update(ie)}${re.final()}`}catch(re){const le=re instanceof RangeError,ke=re.message==="Invalid key length",qe=re.message==="Unsupported state or unable to authenticate data";if(le||ke){const ve=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw ve.code="INVALID_DOTENV_KEY",ve}else if(qe){const ve=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw ve.code="DECRYPTION_FAILED",ve}else throw re}}function B(v,F,z={}){const ie=!!(z&&z.debug),me=!!(z&&z.override);if(typeof F!="object"){const J=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw J.code="OBJECT_REQUIRED",J}for(const J of Object.keys(F))Object.prototype.hasOwnProperty.call(v,J)?(me===!0&&(v[J]=F[J]),ie&&O(me===!0?`"${J}" is already defined and WAS overwritten`:`"${J}" is already defined and was NOT overwritten`)):v[J]=F[J]}const N={configDotenv:Oe,_configVault:we,_parseVault:x,config:U,decrypt:D,parse:E,populate:B};return Vt.exports.configDotenv=N.configDotenv,Vt.exports._configVault=N._configVault,Vt.exports._parseVault=N._parseVault,Vt.exports.config=N.config,Vt.exports.decrypt=N.decrypt,Vt.exports.parse=N.parse,Vt.exports.populate=N.populate,Vt.exports=N,Vt.exports}var jl=zl();const Oi=async n=>{const t=await(await Tt.getWorkspace()).getResource(n);return t||ct("Invalid URL: "+n),await t.getContents({uri:!0})},Bs=n=>n.startsWith("blob:")||n.startsWith("http:")||n.startsWith("https:"),Pi={},Pn=async(n,e)=>{const t=await Us(`[**[${e}!='']]`).evaluate(n);for(const i of t){const a=i[e];if(Bs(a))continue;const u=await Oi(a);Pi[u]=i[e],i[e]=u}},Yr=n=>Pi[n],si=async(n,e)=>{const t=await Us(`[**[${e}!='']]`).evaluate(n);for(const i of t){const a=i[e];!a||!a.startsWith("blob:")||(i[e]=Pi[a])}},Ws=n=>{var t;Me.registerContribution("catalog.root",{label:n.label,icon:n.icon,contributionId:n.contributionId});const e=n.contributionId??n.label;(t=n.items)==null||t.forEach(i=>{Me.registerContribution(e,{label:i.label,icon:i.icon,contributionId:i.contributionId});const u=import.meta.resolve("/.");i.items.forEach(o=>{var E;const m={label:o.label,icon:o.icon,state:{...o.state}};(E=m.state)!=null&&E.url&&(m.state.url=m.state.url.replace("${baseURL}/",u)),Me.registerContribution(i.contributionId,m)})})},ai=n=>{Object.entries(n).forEach(([e,t])=>{const i=/\${([a-zA-Z0-9_]+)}/g;n[e]=t.replace(i,(a,u)=>{const o=n[u];return o!==void 0?o:a})})},Gs=async(...n)=>{const e=await Tt.getWorkspace(),t={};for(const i of n){const a=await(e==null?void 0:e.getResource(i));if(!a)continue;const u=await a.getContents(),o=jl.parse(u||"");ai(o),Object.assign(t,o)}return ai(t),t},Ul=Object.freeze(Object.defineProperty({__proto__:null,getOriginalUri:Yr,isAbsoluteResource:Bs,loadEnvs:Gs,registerCatalog:Ws,replaceUris:Pn,replaceVars:ai,revertBlobUris:si,toBlobUri:Oi},Symbol.toStringTag,{value:"Module"}));fa.resolveUrl=n=>Oi(n);gr.registerEditorInputHandler({canHandle:n=>n instanceof cs&&n.getName().endsWith(".geospace"),handle:async n=>{const e={title:n.getName(),data:n,key:n.getName(),icon:"location-dot",state:{}};return e.widgetFactory=()=>fe`
            <gs-map .input="${e}"></gs-map>`,e}});var jn=(n=>(n[n.LOADED=0]="LOADED",n[n.LAYER_ADDED=1]="LAYER_ADDED",n[n.LAYER_DELETED=2]="LAYER_DELETED",n))(jn||{});const Un=Or(ho),Bl=`:root,
:host {
  --ol-background-color: white;
  --ol-accent-background-color: #F5F5F5;
  --ol-subtle-background-color: rgba(128, 128, 128, 0.25);
  --ol-partial-background-color: rgba(255, 255, 255, 0.75);
  --ol-foreground-color: #333333;
  --ol-subtle-foreground-color: #666666;
  --ol-brand-color: #00AAFF;
}

.ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.ol-scale-bar-inner {
  display: flex;
}

.ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);
}

.ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);
}

.ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.ol-unsupported {
  display: none;
}

.ol-viewport,
.ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.ol-viewport canvas {
  all: unset;
  overflow: hidden;
}

.ol-viewport {
  touch-action: pan-x pan-y;
}

.ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.ol-zoom {
  top: .5em;
  left: .5em;
}

.ol-rotate {
  top: .5em;
  right: .5em;
  transition: opacity .25s linear, visibility 0s linear;
}

.ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition: opacity .25s linear, visibility 0s linear .25s;
}

.ol-zoom-extent {
  top: 4.643em;
  left: .5em;
}

.ol-full-screen {
  right: .5em;
  top: .5em;
}

.ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: .4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.ol-zoom-extent button {
  line-height: 1.4em;
}

.ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.ol-touch .ol-control button {
  font-size: 1.5em;
}

.ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.ol-control button:hover,
.ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.ol-attribution {
  text-align: right;
  bottom: .5em;
  right: .5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.ol-attribution ul {
  margin: 0;
  padding: 1px .5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.ol-attribution li {
  display: inline;
  list-style: none;
}

.ol-attribution li:not(:last-child):after {
  content: " ";
}

.ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.ol-attribution button {
  flex-shrink: 0;
}

.ol-attribution.ol-collapsed ul {
  display: none;
}

.ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.ol-attribution.ol-uncollapsible img {
  margin-top: -.2em;
  max-height: 1.6em;
}

.ol-attribution.ol-uncollapsible button {
  display: none;
}

.ol-zoomslider {
  top: 4.5em;
  left: .5em;
  height: 200px;
}

.ol-zoomslider button {
  position: relative;
  height: 10px;
}

.ol-touch .ol-zoomslider {
  top: 5.5em;
}

.ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.ol-overviewmap .ol-overviewmap-map,
.ol-overviewmap button {
  display: block;
}

.ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.ol-overviewmap-box {
  border: 1.5px dotted var(--ol-subtle-foreground-color);
}

.ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

.ol-overviewmap .ol-viewport:hover {
  cursor: pointer;
}
`,Wl=n=>new Proxy({},{get:(e,t)=>async(...i)=>{for(const a of n)await a[t](...i)}}),Gl="iframe-map-renderer.html";class Vl{constructor(e,t){this.messageId=0,this.pendingMessages=new Map,this.isMobileView=!1,this.gsMap=e,this.env=t,this.operations=this.createProxy(this)}createProxy(e){return new Proxy({},{get(t,i){return async(...a)=>await e.sendMessage(i,{...a})}})}async reattached(){if(!this.targetElement){console.warn("No target element stored, cannot reattach");return}this.iframe&&this.iframe.parentElement&&this.iframe.remove(),await this.render(this.targetElement)}async render(e){if(this.iframe=document.createElement("iframe"),this.iframe.style.overflow="hidden",this.updateIframeStyles(),this.iframe.src=Gl,this.targetElement=typeof e=="string"?document.querySelector(e):e,!this.targetElement)throw new Error("Container element not found");this.targetElement.innerHTML="",this.targetElement.appendChild(this.iframe),await this.waitRendererReady(),this.setupMessageListener(),await this.sendMessage("render",{gsMap:this.gsMap,env:this.env})}async modelToUI(e){await this.sendMessage("modelToUI",e??this.gsMap)}getOperations(){return this.operations}getViewExtent(){return[0,0,0,0]}setOnDirty(e){this.onDirtyCallback=e}triggerDirty(){this.onDirtyCallback&&this.onDirtyCallback()}setOnSync(e){this.onSyncCallback=e}triggerSync(){this.onSyncCallback&&this.onSyncCallback(this.gsMap)}toggleMobileView(){this.isMobileView=!this.isMobileView,this.updateIframeStyles()}isInMobileView(){return this.isMobileView}updateIframeStyles(){this.iframe&&(this.isMobileView?(this.iframe.style.width="375px",this.iframe.style.height="667px",this.iframe.style.border="2px solid rgb(168, 168, 168)",this.iframe.style.borderRadius="20px",this.iframe.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.51)",this.iframe.style.margin="20px auto",this.iframe.style.display="block"):(this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.border="none",this.iframe.style.borderRadius="0",this.iframe.style.boxShadow="none",this.iframe.style.margin="0"))}async handleAssetResolution(e,t){try{const{toBlobUri:i}=await At(async()=>{const{toBlobUri:u}=await Promise.resolve().then(()=>Ul);return{toBlobUri:u}},[]),a=await i(t);this.iframe.contentWindow.postMessage({id:e,success:!0,assetUrl:a},"*")}catch(i){this.iframe.contentWindow.postMessage({id:e,success:!1,error:i instanceof Error?i.message:"Unknown error"},"*")}}destroy(){this.messageListener&&(window.removeEventListener("message",this.messageListener),this.messageListener=void 0),this.iframe&&(this.iframe.remove(),this.iframe=void 0),this.pendingMessages.clear()}setupMessageListener(){this.messageListener=e=>{var m,E,x;if(e.source!==((m=this.iframe)==null?void 0:m.contentWindow))return;const{id:t,result:i,error:a,type:u,gsMap:o}=e.data;if(t!==void 0&&this.pendingMessages.has(t)){const{resolve:C,reject:O}=this.pendingMessages.get(t);this.pendingMessages.delete(t),a?O(new Error(a)):C(i)}u==="dirty"?(E=this.onDirtyCallback)==null||E.call(this):u==="sync"?(x=this.onSyncCallback)==null||x.call(this,o):u==="resolveAsset"&&this.handleAssetResolution(t,e.data.path)},window.addEventListener("message",this.messageListener)}async waitRendererReady(){return new Promise(e=>{const t=i=>{var a;i.source===((a=this.iframe)==null?void 0:a.contentWindow)&&i.data.type==="rendererReady"&&(window.removeEventListener("message",t),e())};window.addEventListener("message",t)})}async sendMessage(e,t){if(!this.iframe)throw new Error("Iframe not initialized");const i=++this.messageId;return new Promise((a,u)=>{this.pendingMessages.set(i,{resolve:a,reject:u}),this.iframe.contentWindow.postMessage({id:i,method:e,params:t},"*"),setTimeout(()=>{this.pendingMessages.has(i)&&(this.pendingMessages.delete(i),u(new Error("Message timeout")))},5e3)})}}class Kl{constructor(e,t){this.gsMap=e,this.renderer=t}triggerDirty(){this.renderer.triggerDirty()}async setZoom(e){this.gsMap.view.zoom=e,this.triggerDirty()}async setCenter(e){this.gsMap.view.center=e,this.triggerDirty()}async switchColorMode(e){this.gsMap.view.colorMode=e,this.triggerDirty()}async addLayer(e,t){t?this.gsMap.layers.unshift(e):this.gsMap.layers.push(e),this.triggerDirty()}async deleteLayer(e){e>=0&&e<this.gsMap.layers.length&&this.gsMap.layers.splice(e,1),this.triggerDirty()}async setLayerVisible(e,t){e>=0&&e<this.gsMap.layers.length&&(this.gsMap.layers[e].visible=t),this.triggerDirty()}async applyStyles(e,t){const i=typeof e=="number"?this.gsMap.layers[e]:this.gsMap.layers.find(a=>a.name===e);i&&(i.stylesPath=t),this.triggerDirty()}async addMarker(e,t){let i=this.gsMap.layers.find(a=>a.name===(t||"Markers"));i||(i={name:t||"Markers",type:"vector",source:{type:"features",features:[]},visible:!0},this.gsMap.layers.push(i)),i.source&&i.source.features&&i.source.features.push(e),this.triggerDirty()}async addControlFromModule(e){this.gsMap.controls.push({src:e,type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeControl(e){e>=0&&e<this.gsMap.controls.length&&this.gsMap.controls.splice(e,1),this.triggerDirty(),await this.renderer.modelToUI()}async addOverlayFromModule(e,t){this.gsMap.overlays.push({src:e,position:t||"bottom-left",type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeOverlay(e){e>=0&&e<this.gsMap.overlays.length&&this.gsMap.overlays.splice(e,1),this.triggerDirty(),await this.renderer.modelToUI()}}var Hl=Object.defineProperty,Jl=Object.getOwnPropertyDescriptor,Vs=(n,e,t,i)=>{for(var a=i>1?void 0:i?Jl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&Hl(e,t,a),a};let fr=class extends Yt{constructor(){super(),this.mapContainer=Er(),this.isFirstConnection=!0,this.chatContext={history:[]},this.commandStack=new As}async connectedCallback(){var n;if(super.connectedCallback(),this.isFirstConnection){this.isFirstConnection=!1;return}(n=this.renderer)!=null&&n.reattached&&await this.renderer.reattached()}async doInitUI(){var o;const n=(o=this.input)==null?void 0:o.data,e=await Gs(".env","envs/.env","env","envs/env","default.env","envs/default.env","dev.env","envs/dev.env");e.BUILD_TIME=new Date;const t=await n.getContents();let i=t&&t.trim()?JSON.parse(t):ga;i=this.migrateGsMap(i),await Pn(i,"url"),await Pn(i,"src"),this.gsMap=i,this.renderer=new Vl(i,e);const a=this.renderer.getOperations(),u=new Kl(i,this.renderer);this.operations=Wl([u,a]);try{if(!this.mapContainer.value)throw new Error("Map container not available");await this.renderer.render(this.mapContainer.value),this.renderer.setOnDirty(()=>this.markDirty(!0)),this.renderer.setOnSync(m=>{this.gsMap.view=m.view,this.markDirty(!0)}),Un.set({part:this,event:jn.LOADED})}catch(m){console.error("Failed to render map:",m),ct(`Failed to render map: ${m.message}`)}}migrateGsMap(n){if(n.view)return n;console.log("Creating view field and migrating old properties...");const e={...n,view:{}};return n.center!==void 0&&(e.view.center=n.center,delete e.center),n.zoom!==void 0&&(e.view.zoom=n.zoom,delete e.zoom),n.projection!==void 0&&(e.view.projection=n.projection,delete e.projection),e.view.center===void 0&&(e.view.center=[0,0]),e.view.zoom===void 0&&(e.view.zoom=0),e.view.projection===void 0&&(e.view.projection="EPSG:3857"),e}getGsMap(){return this.gsMap}async save(){var n;if(!this.renderer){ct("Map not initialized");return}try{if(!this.gsMap){ct("Map not initialized");return}const e=JSON.parse(JSON.stringify(this.gsMap));await si(e,"url"),await si(e,"src"),(n=this.input)==null||n.data.saveContents(JSON.stringify(e,null,2)),this.markDirty(!1)}catch(e){ct(`Save failed: ${e.message}`)}}get mapOperations(){return this.operations}edit(){hr("not yet implemented")}doClose(){var n;(n=this.renderer)==null||n.destroy(),this.renderer=void 0,this.input=void 0}render(){return fe`
            <div class="gc-map-container" ${Cr(this.mapContainer)}>
            </div>
        `}};fr.styles=[ma(Bl),Mt`
        :host {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        .gc-map-container {
            flex: 1;
        }

        input.prompt {
            flex: 1;
            font-size: large;
        }
    `];Vs([Wt({attribute:!1})],fr.prototype,"input",2);fr=Vs([wt("gs-map")],fr);var Yl=Object.defineProperty,Zl=Object.getOwnPropertyDescriptor,Ti=(n,e,t,i)=>{for(var a=i>1?void 0:i?Zl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&Yl(e,t,a),a};let nn=class extends Yt{onPartChanged(n){n==this||n==this.mapEditor||(this.mapEditor=n instanceof fr?n:void 0,this.updateLater())}onMapChanged({part:n}){n==this.mapEditor&&this.updateLater()}toggleVisible(n){var o,m;const e=n.currentTarget.index,u=!(this.mapEditor.getGsMap().layers[e].visible!==!1);(m=(o=this.mapEditor)==null?void 0:o.mapOperations)==null||m.setLayerVisible(e,u),this.updateLater()}confirmAction(n,e){confirm(n)&&e()}render(){return Ht(!this.mapEditor,()=>fe`
                    <k-no-content message="Select a map."></k-no-content>`,()=>{var n,e,t,i,a;return fe`
                <wa-tree>
                    <wa-tree-item expanded>
                        ${ar("fg layers")} Layers
                        ${(n=this.mapEditor.getGsMap())==null?void 0:n.layers.map((u,o)=>fe`
                            <wa-tree-item>
                                <wa-button .index="${o}" @click="${this.toggleVisible}" appearance="plain"
                                           size="small">
                                    <wa-icon name="${u.visible!==!1?"eye":"eye-slash"}"></wa-icon>
                                </wa-button>
                                <span>${u.name??`Layer ${o+1}`}${o==0?fe`
                                    <small>(basemap)</small>`:""}</span>
                                <wa-button appearance="plain" size="small"
                                           @click="${()=>this.confirmAction(`Delete layer "${u.name||`Layer ${o+1}`}"?`,()=>this.withRefresh(()=>{var m,E;return(E=(m=this.mapEditor)==null?void 0:m.mapOperations)==null?void 0:E.deleteLayer(o)}))}">
                                    <wa-icon name="trash"></wa-icon>
                                </wa-button>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        ${ar("fg map-control")} Controls
                        ${(t=(e=this.mapEditor)==null?void 0:e.getGsMap())==null?void 0:t.controls.map((u,o)=>fe`
                            <wa-tree-item>
                                <span>${Yr(u.src)}</span>
                                <wa-button appearance="plain" size="small"
                                           @click="${()=>this.confirmAction(`Delete control "${Yr(u.src)}"?`,()=>this.withRefresh(()=>{var m,E;return(E=(m=this.mapEditor)==null?void 0:m.mapOperations)==null?void 0:E.removeControl(o)}))}">
                                    <wa-icon name="trash"></wa-icon>
                                </wa-button>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        ${ar("fg map-poi")} Overlays
                        ${(a=(i=this.mapEditor)==null?void 0:i.getGsMap())==null?void 0:a.overlays.map((u,o)=>fe`
                            <wa-tree-item>
                                <span>${Yr(u.src)}</span>
                                <wa-button appearance="plain" size="small"
                                           @click="${()=>this.confirmAction(`Delete overlay "${Yr(u.src)}"?`,()=>this.withRefresh(()=>{var m,E;return(E=(m=this.mapEditor)==null?void 0:m.mapOperations)==null?void 0:E.removeOverlay(o)}))}">
                                    <wa-icon name="trash"></wa-icon>
                                </wa-button>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        ${ar("highlighter")} Styles
                    </wa-tree-item>
                </wa-tree>
            `})}};nn.styles=Mt`
        :host {
            display: flex;
            flex-direction: column;
        }
    `;Ti([hi(mt)],nn.prototype,"onPartChanged",1);Ti([hi(Un)],nn.prototype,"onMapChanged",1);nn=Ti([wt("gs-map-props")],nn);var Ql=Object.defineProperty,Xl=Object.getOwnPropertyDescriptor,Ks=(n,e,t,i)=>{for(var a=i>1?void 0:i?Xl(e,t):e,u=n.length-1,o;u>=0;u--)(o=n[u])&&(a=(i?o(e,t,a):o(a))||a);return i&&a&&Ql(e,t,a),a};const ec="catalog.root";let mr=class extends Yt{constructor(){super(...arguments),this.treeRef=Er()}doInitUI(){const n=Me.getContributions(ec);this.rootNodes=this.toTreeNodes(n),this.registerToolbarActions()}registerToolbarActions(){this.registerToolbarContribution({label:"Checkout",icon:"file-arrow-down",command:"checkout",slot:"start",disabled:()=>!(mt.get()instanceof mr)||Fr.get()===void 0}),this.registerToolbarContribution({label:"Refresh Catalog",icon:"arrows-rotate",command:"refresh_catalog",slot:"start"}),this.registerToolbarContribution({label:"Expand All",icon:"angles-down",command:"catalog_expand_all",slot:"end"}),this.registerToolbarContribution({label:"Collapse All",icon:"angles-up",command:"catalog_collapse_all",slot:"end"})}toTreeNodes(n){return n.map(e=>{const t={data:e.state,icon:e.icon,label:e.label,leaf:!1};if(e.contributionId){const i=Me.getContributions(e.contributionId);t.leaf=i.length===0,t.children=this.toTreeNodes(i)}return t})}onItemDblClicked(n){const e=n.currentTarget.model.data.url;this.executeCommand("checkout",{url:e})}onSelectionChanged(n){const e=n.detail.selection[0].model;Fr.set(e.data)}setAllExpanded(n){const e=this.treeRef.value;e&&e.querySelectorAll("wa-tree-item").forEach(t=>{t.expanded=n})}refresh(){this.requestUpdate()}createTreeItems(n,e=!1){var t;return n?fe`
            <wa-tree-item
                    @dblclick=${this.nobubble(this.onItemDblClicked)} .model=${n} ?expanded=${e}>
                <span>${ar(n.icon)} ${n.label}</span>
                ${(t=n.children)==null?void 0:t.map(i=>this.createTreeItems(i))}
            </wa-tree-item>`:fe``}render(){var n;return fe`
            <wa-tree ${Cr(this.treeRef)} @wa-selection-change=${this.nobubble(this.onSelectionChanged)} style="--indent-guide-width: 1px;">
                ${(n=this.rootNodes)==null?void 0:n.map(e=>this.createTreeItems(e,!0))}
            </wa-tree>
        `}};mr.styles=Mt`
        :host {
            display: flex;
            flex-direction: column;
        }
    `;Ks([Ct()],mr.prototype,"rootNodes",2);mr=Ks([wt("gs-catalog")],mr);const tc="geo!space catalog",rc="earth",nc="catalog.root.geospace",ic=[{contributionId:"catalog.root.notebooks",label:"Notebooks",icon:"book",items:[{label:"Welcome to Jupyter Notebooks",icon:"graduation-cap",state:{url:"${baseURL}/notebooks/welcome.ipynb",type:"file"}},{label:"Simple Notebook",icon:"circle-info",state:{url:"${baseURL}/notebooks/simple-notebook.ipynb",type:"file"}}]},{contributionId:"catalog.root.datasets",label:"Datasets",icon:"clone",items:[{label:"countries.geojson",icon:"fg geojson-file",state:{url:"${baseURL}/datasets/countries.geojson",type:"file"}}]},{contributionId:"catalog.root.maps",label:"Maps",icon:"map-location",items:[{label:"OpenStreetMap basemap",icon:"earth",state:{url:"${baseURL}/maps/osm.geospace",type:"file"}},{label:"basemap.de basemap",icon:"earth",state:{url:"${baseURL}/maps/bm.geospace",type:"file"}},{label:"basemap.de WMS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms.geospace",type:"file"}},{label:"basemap.de WMS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms-gray.geospace",type:"file"}},{label:"basemap.de WMTS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts.geospace",type:"file"}},{label:"basemap.de WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts.geospace",type:"file"}},{label:"TopPlusOpen WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light-gray.geospace",type:"file"}}]},{contributionId:"catalog.root.overlays",label:"Overlays",icon:"fg map-poi",items:[]},{contributionId:"catalog.root.controls",label:"Controls",icon:"fg map-control",items:[]},{contributionId:"catalog.root.icons",label:"Icons",icon:"icons",items:[{label:"marker.png",icon:"file",state:{url:"${baseURL}/icons/marker.png",type:"file"}},{label:"location-user-24.png",icon:"file",state:{url:"${baseURL}/icons/location-user-24.png",type:"file"}}]},{contributionId:"catalog.root.packages",label:"Asset Packages",icon:"box-archive",items:[]}],sc={label:tc,icon:rc,contributionId:nc,items:ic};dt({command:{id:"checkout",name:"Checkout",description:"Checkout a catalog item into the workspace",parameters:[{name:"url",description:"the url of the resource to checkout, if not provided, the current selection in the catalog will be used",required:!1}]},handler:{execute:async n=>{let e=n.params&&n.params.url;if(!e){const i=Fr.get();if(!i||!("url"in i))return;e=i.url}const t=await Tt.getWorkspace();if(!t){ct("No workspace selected.");return}fetch(e,{method:"GET"}).then(i=>i.blob()).then(i=>{const a=new URL(e).pathname.split("/"),u=a[a.length-1];return t.getResource(u,{create:!0}).then(o=>o.saveContents(i,{contentType:va.BINARY}).then(()=>{hr("File checked out: "+u)}))}).catch(i=>{ct(i)})}}});dt({command:{id:"refresh_catalog",name:"Refresh Catalog",description:"Refreshes the catalog view",parameters:[]},handler:{execute:async n=>{const e=mt.get();e instanceof mr&&e.refresh()}}});dt({command:{id:"catalog_expand_all",name:"Expand All Catalog Items",description:"Expands all items in the catalog tree",parameters:[]},handler:{execute:async n=>{const e=mt.get();e instanceof mr&&e.setAllExpanded(!0)}}});dt({command:{id:"catalog_collapse_all",name:"Collapse All Catalog Items",description:"Collapses all items in the catalog tree",parameters:[]},handler:{execute:async n=>{const e=mt.get();e instanceof mr&&e.setAllExpanded(!1)}}});Ws(sc);const Qt=n=>n.source instanceof fr,vr=n=>{if(!n.source||!n.source.renderer)throw new Error("GsMapEditor with renderer not available in context.source");return n.source.renderer.getOperations()};Je.registerAll({command:{id:"zoom_to_level",name:"Zoom to Level",description:"Zooms the map to the provided level",parameters:[{name:"zoom",description:"the zoom level, an interger between 0 and 12",required:!0}]},handler:{canExecute:Qt,execute:async n=>{await vr(n).setZoom(Number(n.params.zoom).valueOf())}}});Je.registerAll({command:{id:"center_location",name:"Center to a location",description:"Centers the map to the provided location coordinates",parameters:[{name:"lat",description:"the latitude of the map",required:!0},{name:"lon",description:"the longitude of the map",required:!0}]},handler:{canExecute:Qt,execute:async n=>{const e=vr(n),t=ps([Number(n.params.lon).valueOf(),Number(n.params.lat).valueOf()]);await e.setCenter([t[0],t[1]])}}});Je.registerAll({command:{id:"add_marker",name:"Add a marker",description:"Add a marker to the map",parameters:[{name:"lat",description:"the latitude of the marker",required:!0},{name:"lon",description:"the longitude of the marker",required:!0},{name:"name",description:"a short name of the marker",required:!0},{name:"description",description:"a description of the marker",required:!0},{name:"iconPath",description:"the path within the workspace to the icon file in any graphics format such as png, jpg or svg; if no icon path provided, a marker.png file will be assumed to be located in the root of the workspace",required:!1},{name:"layerName",description:"the name of the layer to add the marker to; if not provided, markers will be added to the default 'geocoded-markers' layer",required:!1}]},handler:{canExecute:Qt,execute:async n=>{const e=vr(n),t=ps([Number(n.params.lon).valueOf(),Number(n.params.lat).valueOf()]),i=n.params.iconPath||"marker.png",a={state:{name:n.params.name,description:n.params.description},style:i,geometry:{type:ya.Point,coordinates:[...t]}};await e.addMarker(a,n.params.layerName),Un.set({part:e,event:jn.LAYER_ADDED})}}});Je.registerAll({command:{id:"add_layer",name:"Add new layer",description:"Adds a new layer to the map or set the basemap",parameters:[{name:"source",description:`the source of the layer, one of: ${Object.values(xa).join(", ")}`,required:!0},{name:"basemap",description:"if set to true, the new layer will be used as the basemap or basemap layer",required:!1},{name:"url",description:"the URL or path within the workspace to load the features/geometries from",required:!1},{name:"stylePath",description:"the path within the workspace to the style json file if source is of type vector, for example, geojson",required:!1}]},handler:{canExecute:Qt,execute:async n=>{var m;const e=vr(n),t=(m=n.params.source)==null?void 0:m.trim().toLowerCase(),i=n.params.url,a=ba(t),u=(n==null?void 0:n.params)&&n.params.basemap==!0,o={type:Ia(t),source:{type:a,url:i??wa(a)}};await Pn(o,"url"),await e.addLayer(o,u),Un.set({part:e,event:jn.LAYER_ADDED})}}});Je.registerAll({command:{id:"delete_layer",name:"Delete a layer",description:"Delete a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to delete, starts with 1 for the first layer",required:!0}]},handler:{canExecute:Qt,execute:async n=>{const e=vr(n),t=parseInt(n.params.index)-1;t<0||await e.deleteLayer(t)}}});Je.registerAll({command:{id:"apply_styles",name:"Apply styles",description:"Applies a styles json file to a layer",parameters:[{name:"stylesPath",description:"the path to the json file containing style definitions",required:!0},{name:"layer",description:"the layer to apply the styles to: can be either a name or the index pointing to a layer in the layers stack",required:!0}]},handler:{canExecute:Qt,execute:async n=>{var a;const e=vr(n),t=n.params.layer,i=(a=n.params.stylesPath)==null?void 0:a.trim().toLowerCase();await e.applyStyles(t,i)}}});Je.registerAll({command:{id:"switch_color_mode",name:"Switch color mode",description:"Switches the current color mode to either dark or light (default)",parameters:[{name:"mode",description:"the mode to switch to, will be toggled if not provided",required:!1}]},handler:{canExecute:Qt,execute:async n=>{var i;const e=n.source,t=(i=n.params)==null?void 0:i.mode;await e.switchColorMode(t)}}});Je.registerAll({command:{id:"add_overlay",name:"Add overlay",description:"Adds an overlay JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute:Qt,execute:async n=>{const e=vr(n),t=n.params.src,i=n.params.position;await e.addOverlayFromModule(t,i)}}});Je.registerAll({command:{id:"add_control",name:"Add control",description:"Adds a control JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute:Qt,execute:async n=>{const e=vr(n),t=n.params.src;await e.addControlFromModule(t)}}});Je.registerAll({command:{id:"view_extents",name:"View extents",description:"Stores the extent of the current view as a variable",parameters:[{name:"latlon",description:"set to true to reverse coordinates to lat/lon instead of lon/lat; useful for various external services such as OpenStreetMap Overpass API",required:!1}],output:[{name:"viewExtent",description:"the current view's extent as lat/lon coordinates",type:"number[]"}]},handler:{canExecute:Qt,execute:async n=>{const e=n.params.latlon,i=n.source.renderer.getViewExtent();if(!i)throw new Error("Failed to get view extent");let a=i;if(e||e===void 0){const{transformExtent:u}=await At(async()=>{const{transformExtent:o}=await import("./index-DUZ9xzhO.js").then(m=>m.a8);return{transformExtent:o}},__vite__mapDeps([0,1]));a=u(i,"EPSG:3857","EPSG:4326"),[a[0],a[1]]=[a[1],a[0]],[a[2],a[3]]=[a[3],a[2]]}n.viewExtent=a}}});Je.registerAll({command:{id:"toggle_mobile_view",name:"Toggle Mobile View",description:"Toggles between desktop and mobile view for the map",parameters:[]},handler:{canExecute:n=>mt.get()instanceof fr,execute:async n=>{const e=mt.get().renderer;if(!e||!("toggleMobileView"in e))throw new Error("Mobile view toggle not available on this renderer");e.toggleMobileView()}},contribution:{target:Nn,icon:"mobile",label:"Toggle mobile view",disabled:()=>!(mt.get()instanceof fr)}});it.registerExtension({id:"system.git",name:"Git Support",description:"Git commands and UI elements",loader:()=>At(()=>import("./git-extension-DYs6fDdp.js"),__vite__mapDeps([2,0,1])),icon:"code-branch",experimental:!0});it.registerExtension({id:"system.pyterminal",name:"Python terminal",description:"Python terminal view",loader:()=>At(()=>import("./pyterminal-extension-j52wL-XV.js"),__vite__mapDeps([3,0,1,4])),icon:"terminal",experimental:!0});it.registerExtension({id:"system.linuxterminal",name:"Linux terminal",description:"Linux terminal view",loader:()=>At(()=>import("./k-linuxterminal-DGp9lFI5.js"),__vite__mapDeps([5,0,1,4])),icon:"terminal",experimental:!0});it.registerExtension({id:"system.webllm",name:"WebLLM",description:"In-Browser LLM inference",loader:()=>At(()=>import("./webllmservice-DEDenTv5.js"),[]),icon:"robot"});it.registerExtension({id:"system.p12splitter",name:".p12 file splitter",description:"Adds a command to split/separate a .p12 file into private/public and additional .pem files",loader:()=>At(()=>import("./p12-splitter-eRk-0BzG.js"),__vite__mapDeps([6,0,1])),icon:"certificate"});it.registerExtension({id:"system.notebook",name:"Jupyter Notebook Editor",description:"View and execute Jupyter notebooks (.ipynb) with Python code execution and markdown rendering",loader:()=>At(()=>import("./notebook-extension-BVgDMCki.js"),__vite__mapDeps([7,0,1,8,9])),icon:"book"});it.registerExtension({id:"system.commandpalette",name:"Command Palette",description:"VS Code-style command palette at the top center for quick command execution (Ctrl+Shift+P)",loader:()=>At(()=>import("./command-palette-extension-HeJqRso8.js"),__vite__mapDeps([10,0,1])),icon:"terminal"});it.registerExtension({id:"system.download",name:"Download Files",description:"Download files from URLs to the workspace",loader:()=>At(()=>import("./download-extension-DSqPbzxp.js"),__vite__mapDeps([11,0,1])),icon:"download"});it.registerExtension({id:"system.unzip",name:"Unzip Archives",description:"Extract zip archives to the workspace",loader:()=>At(()=>import("./unzip-extension-BBdvAyLw.js"),__vite__mapDeps([12,0,1])),icon:"box-archive"});it.registerExtension({id:"system.mdeditor",name:"Markdown Editor",description:"View and render Markdown (.md) files",loader:()=>At(()=>import("./md-editor-extension-BI1Vg3CR.js"),__vite__mapDeps([13,0,1])),icon:"book"});it.registerExtension({id:"system.monaco",name:"Monaco Code Editor",description:"Code editor with syntax highlighting, IntelliSense, and Python execution support",loader:()=>At(()=>import("./monaco-editor-extension-DPR2O5-8.js"),__vite__mapDeps([14,8,0,1,9])),icon:"file-pen"});it.registerExtension({id:"system.memoryusage",name:"Memory Usage Monitor",description:"Displays JavaScript heap memory usage in the bottom toolbar",loader:()=>At(()=>import("./memory-usage-extension-Cqu036sA.js"),__vite__mapDeps([15,0,1])),icon:"microchip"});const ac=`You are a specialized commands execution plan generator. Your sole purpose is to analyze user requests expressed in natural language and translate them into a precise sequence of command calls that can be executed by a software controller.

**Instructions:**

1.  **Analyze the User Prompt:** Carefully understand the user's request.  Identify the desired outcome.
2.  **Translate to Command Sequence:**  Break down the request into a sequence of command calls.  Each command call should be a JSON object in the following format:
    \`\`\`json
    {
      "id": "CommandId",
      "summary": "brief description effects of executing this command and the parameter values which will be provided"
      "parameters": {
        "parameter1": "value1",
        "parameter2": "{{variable1}}",
        ...
      }
    }
    \`\`\`
    Note that the parameters object of each command call can reference output variables of previous commands by using the notation {{var_name}} as their value.
3.  **JSON Output Only:**  Your response *must* be a single, valid JSON array containing the sequence of command calls.  Do not include any introductory text or explanations *outside* the JSON array.
4.  **Parameter Extraction:**  Carefully extract the necessary parameters from the user prompt and map them to the corresponding command parameters.
5.  **Prioritize Clarity:**  If multiple command sequences could satisfy the request, choose the most straightforward and understandable sequence.
6.  **Error Handling:** If the user prompt is unclear or cannot be translated into a valid command sequence, use the proper command (toast_message) to inform the user, else respond with an empty JSON array: \\\`[]\\\`
7.  **Check json output:** Check your JSON result and correct if required.

**Available commands:**

\`\`\`json
\${commandsJson}
\`\`\``,oc=`You are a helpful assistant designed to guide users in programming tasks within a WebGIS called "geo!space".
The user will provide code snippets, and you will help them understand, debug, and extend their code.
Supported programming languages that geo!space can directly run:
- Python code is directly executed in the browser using Pyodide
- JavaScript code is executed in a worker

Code for other programming languages cannot be executed directly, but geo!space uses the monaco editor to offer basic IDE like functionality.

**Your Responsibilities:**

*   **Understand the User's Goal:**  Always start by clarifying what the user is trying to achieve with their Python code. Ask clarifying questions if necessary.
*   **Explain Python Code:**  If the user provides code, explain what it does, line by line if needed.  Point out potential issues or areas for improvement.
*   **Help with \`js\` Module Interaction:**  The user will likely want to call JavaScript functions from Python or pass data between Python and JavaScript.  Provide clear examples of how to use the \`js\` module for these interactions.  Explain the syntax and potential pitfalls.
*   **Provide Code Examples:**  Give concise, runnable code examples to illustrate concepts.
*   **Debug Code:**  If the user reports errors, help them identify the cause and suggest solutions.  Consider both Python and JavaScript errors.
*   **Suggest Improvements:**  Offer suggestions for making the code more efficient, readable, or robust.
*   **Focus on Browser Context:**  Remember that the code is running in a browser environment.  Be mindful of browser limitations and security considerations.
*   **Be Concise and Clear:**  Avoid jargon and explain concepts in a way that is easy to understand.
*   **Assume Basic Python Knowledge:**  While you should explain code, assume the user has a basic understanding of Python syntax.

**About the Python environment:**
A mount point is provided at /workspace which is linked to a folder on the user's local file system previously selected using the file system access api of the browser.
The working directory is automatically set to the /workspace folder. The user can access the workspace content in the web app's file browser titled "Workspace" in the UI.
The user can install additional Python packages by adding them as dependencies in the workspace file requirements.txt.
The dependencies within the requirements.txt are installed before any code is executed.`,lc=`You are a JavaScript programming assistant for the geo!space IDE.
Your role is to help users write, understand, and debug geo!space modulesJavaScript files that export a function for dynamic interaction with OpenLayers-powered maps.

*Always follow these guidelines:*

- Explain concepts and code clearly, concisely, and at the experience level of the user.
- If a user shares module code, extract and summarize its structure (such as state, refs, UI, use of the map object, etc.) before offering feedback or improvements.
- When explaining, reference geo!space context, e.g., "This is how you add a map layer in geo!space..."
- For any questions or issues, focus help specifically on JavaScript, OpenLayers usage, and geo!space module patterns.
- Do not discuss topics outside JavaScript, OpenLayers, or geo!space modules.
- If a user's intent isn't clear, ask clarifying questions before answering.
- When a user requests a starter, skeleton, or minimal module, provide the following template and explain its structure:

\`\`\`javascript
// Export your module as a default function.
// The following parameters are available:
export default function ({ map, env, render, html, style, when, ref, createRef, events, settings }) {
    // Optional: local state for your module
    const state = {
        // Your state variables here
    };

    // Optional: references for interactive elements
    // const myRef = createRef();

    // Optional: run code when module loads
    // style({ /* ... custom styles or slotting ... */ })

    // Return a function that renders your UI
    return () => html\`
        <!-- Your module's UI goes here -->

        <div>
            <h3>Hello, geo!space!</h3>
            <button @click=\${() => {
                // Example: add a marker or interact with map
                alert("Button clicked! Add OpenLayers code here.");
            }}>
                Click me
            </button>
        </div>
    \`;
}
\`\`\``;let cc=0;Me.registerContribution(pn,{label:"Commander",description:"Commands execution plan generator",role:"commands",sysPrompt:ac,canHandle:({activeEditor:n})=>{const e=Je.listCommands({source:n});return Object.keys(e).length>0},promptDecorator:async({userPrompt:n,commandRegistry:e,activeEditor:t})=>{const i=e.listCommands({source:t}),a=JSON.stringify(i,null,2);return`${n}

***Available Commands:***
${a}`},messageDecorator:async({message:n,activeEditor:e})=>{if(!n)return;const t=n.content.replace("```json","").replace("```",""),i=JSON.parse(t);let a=!0;n.content=i.map(({id:u,summary:o},m)=>{const E=Je.getCommand(u);return E?`${m+1}. ${E.name}
	- ${o||E.description}`:(a=!1,`${m+1}. *INVALID COMMAND:* _${u}_`)}).join(`
`),n.actions=n.actions||[],n.actions.push({label:"Show Commands Execution Plan",icon:"list",action:async()=>{const u=cc++,o=`\`\`\`json
${JSON.stringify(i,null,2)}
\`\`\``,m=new us(o,`Commands Execution Plan (${u}).md`);await gr.loadEditor(m)}}),a&&n.actions.push({label:"Execute Commands",icon:"play",action:async()=>{const u=(e==null?void 0:e.getCommandStack())||new As;await cn.runAsync("Executing commands",async()=>{Ut.debug("Executing commands: "+JSON.stringify(i));const o={source:e};for(const m of i){const E=Object.entries(m.parameters||{}).map(([x,C])=>(typeof C=="string"&&(C=C.replace(/{{(.*?)}}/g,(O,w)=>o[w.trim()]??"")),[x,C]));o.params=Object.fromEntries(E),await u.execute(m.id,o)}})}})}});const Hs=n=>n&&typeof n.getEditor=="function"&&typeof n.getLanguage=="function",Js=async({userPrompt:n,activeEditor:e})=>{var u,o;const t=e.getEditor(),i=t.getModel(),a=i.getValueInRange(t.getSelection());return a?`${n}

 Code selection within file "${(u=e.input)==null?void 0:u.data.getWorkspacePath()}":

            ${a}`:`${n}

Code in file "${(o=e.input)==null?void 0:o.data.getWorkspacePath()}":

            ${i.getValue()}`};Me.registerContribution(pn,{label:"Python Assistant",description:"Python code assistant",role:"py-programmer",sysPrompt:oc,canHandle:({activeEditor:n})=>Hs(n)&&n.getLanguage()=="python",promptDecorator:Js});Me.registerContribution(pn,{label:"JavaScript Assistant",description:"JavaScript code assistant",role:"js-programmer",sysPrompt:lc,canHandle:({activeEditor:n})=>Hs(n)&&n.getLanguage()=="javascript",promptDecorator:Js});const uc=`You are an assistant embedded in a highly modular and extendable WebGIS called "geo!space".
geo!space provides the following components:
- a file browser on the left pane with "Workspace" in its tab title
- an editor area in the center which shows a welcome message and how to get started if no workspace is selected
- a chat UI on the right pane to interact with you

The file browser component allows to select a local folder as a workspace.
Once a workspace is connected, it will be restored when the user reloads geo!space.
If the user does not see a file they expect to be in the file browser,
they can choose to reload the workspace which will lead to syncing the workspace folder with the local file system.

Files with the extension .geospace are opened in the geo!space mapping editor: once opened,
the editor offers an input field which the user can use to either directly interact with the map via UI elements
or by prompting another editor-specific assistant to run one or more commands.
.geospace files are simple json files which contain fields to save and restore the map the user created.
For example, the zoom level, the center coordinates and the layers.

Any other will be opened using a code editor. The code editor has IDE like UI,
such as syntax highlighting and syntax checking for most well known programming languages and file formats.
The user can execute code in Python or JavaScript by pressing the run button in the open code editor.

If a file is dirty, i.e. the user made changes to its content, the tab title of the dirty editor will signal this
by showing an asterisk "*".

If the user prompt starts with "/<command>" where <command> is a command name,
geo!space will directly run the registered command.

Via a button with a puzzle icon in the top-right corner, the extensions editor can be opened.
The user can browse available extensions, install, or uninstall it (in this case a reload of the web app is required).

Answer technical requests not by code any technical terms, but by abstract and easy-to-understand concepts.
Keep your answer concise and as short as possible: specific requests are handled by other assistants.`,is="0.11.12";Me.registerContribution(Nn,{slot:"start",html:'<span style="margin-right: 1rem;"><span><nobr><i><b>geo!</b></i><small>space</small></nobr></span></span>'});Me.registerContribution(Pr,{slot:"end",html:"<k-perspective-switcher></k-perspective-switcher>"});Me.registerContribution(an,{name:"assistant",label:"AI",icon:"robot",component:n=>fe`<k-aiassist id="${n}"></k-aiassist>`});Me.registerContribution(an,{name:"filebrowser",label:"Workspace",icon:"folder-open",component:n=>fe`<k-filebrowser id="${n}"></k-filebrowser>`});Me.registerContribution(an,{name:"catalog",label:"Catalog",icon:"book",component:n=>fe`<gs-catalog id="${n}"></gs-catalog>`});Me.registerContribution(an,{name:"map-props",label:"Map Properties",icon:"fg map-options",component:n=>fe`<gs-map-props id="${n}"></gs-map-props>`});Me.registerContribution(pi,{name:"filebrowser",view:"filebrowser"});Me.registerContribution(pi,{name:"catalog",view:"catalog"});Me.registerContribution(xs,{name:"map-props",view:"map-props"});Me.registerContribution(Is,{name:"assistant",view:"assistant"});Me.registerContribution(ks,{name:"filebrowser",view:"filebrowser"});Me.registerContribution(Ss,{name:"assistant",view:"assistant"});it.registerExtension({id:"geospace.mapBuilder",name:"geo!space Map Builder",description:"Compile a geo!space file to an interactive website",loader:()=>At(()=>import("./mapbuilder-extension-D7BBqcMB.js"),__vite__mapDeps([16,0,1])),icon:"earth"});it.registerExtension({id:"geospace.overpass",name:"OpenStreetMap Overpass",description:"OpenStreetMap Overpass API Integration for use with LLMs",loader:()=>At(()=>import("./overpass-extension-CcpW4aBa.js"),__vite__mapDeps([17,0,1])),icon:"table"});Me.registerContribution(pn,{label:"App Support",description:"General app support",role:"appsupport",sysPrompt:()=>{const n=it.getExtensions().map(t=>({id:t.id,name:t.name,description:t.description,experimental:t.experimental,installedAndEnabled:it.isEnabled(t.id)})),e=`***Available Extensions:***
${JSON.stringify(n,null,2)}`;return`${uc}

${e}`},canHandle:({activeEditor:n})=>n===void 0,promptDecorator:async({userPrompt:n})=>Tt.getWorkspace().then(e=>{var a;const t={workspace:e==null?void 0:e.getName(),activeEditor:(a=gr.getEditorArea())==null?void 0:a.getActiveEditor()};return`${`***App's state:***
${JSON.stringify(t,null,2)}`}

${n}`})});Me.registerContribution(Qn,{target:Qn,slot:"start",label:"Workspace",html:"<k-workspace-name></k-workspace-name>"});dt({command:{id:"show_version_info",name:"Show Version Info",description:"Shows application version information",parameters:[]},handler:{execute:async n=>{alert(`geo!space
Version: ${is}
Alpha Release

A geospatial IDE for working with spatial data.`)}},contribution:{target:bs,label:`v${is}`,icon:"circle-info"}});const pc=["system.mdeditor","system.monaco","system.download","system.commandpalette","system.memoryusage"];pc.forEach(n=>{it.enable(n)});Me.registerContribution(Ln,{name:"geospace",label:"Geo",icon:"earth",component:n=>fe`
        <k-resizable-grid orientation="horizontal" sizes="20%, 60%, 20%">
            <!-- Left: 20% - nested vertical grid -->
            <k-resizable-grid orientation="vertical" sizes="50%, 50%">
                <k-tabs id="${pi}"></k-tabs>
                <k-tabs id="${xs}"></k-tabs>
            </k-resizable-grid>
            
            <!-- Center: 60% -->
            ${n}
            
            <!-- Right: 20% -->
            <k-tabs id="${Is}"></k-tabs>
        </k-resizable-grid>
    `});Me.registerContribution(Ln,{name:"files",label:"Files",icon:"folder-open",component:n=>fe`
        <k-resizable-grid orientation="horizontal" sizes="20%, 55%, 25%">
            <k-tabs id="${ks}"></k-tabs>
            ${n}
            <k-tabs id="${Ss}"></k-tabs>
        </k-resizable-grid>
    `});ls(fe`
    <div id="gs-app" style="display: flex; flex-direction: column; flex: 1; min-height: 0; width: 100%; box-sizing: border-box;">
        <div style="width: 100%; display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center; border-bottom: solid 1px grey; flex-shrink: 0;">
            <k-toolbar id=${Nn}></k-toolbar>
            <k-toolbar id=${Ka}>
            </k-toolbar>
            <k-toolbar style="justify-self: end;" id=${Pr} align="right">
            </k-toolbar>
        </div>
        <k-perspectives 
            id="${Ln}"
            editor-id="${ws}"
            style="flex: 1 1 auto; min-height: 0; overflow: hidden;">
        </k-perspectives>
        <div style="width: 100%; border-top: solid 1px grey; display: grid; grid-template-columns: 1fr 2fr auto; align-items: center; flex-shrink: 0; min-height: 32px; padding: 0 0.5rem;">
            <k-toolbar id=${Qn}></k-toolbar>
            <k-toolbar id=${ys}></k-toolbar>
            <k-toolbar id=${bs} style="justify-self: end;"></k-toolbar>
        </div>
    </div>`,document.body);export{fr as G,jr as K,ml as P,Nn as T,mt as a,cn as b,ct as c,Is as d,Yt as e,Ka as f,bn as g,Fr as h,gr as i,Me as j,Qn as k,Gs as l,Ge as m,dt as r,hr as t};
