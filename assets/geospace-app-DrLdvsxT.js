const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/transformers-BKBq_BO4.js","assets/index-CUNXveE1.js","assets/preload-helper-WQhrSmCl.js","assets/chunk.LTSJC6DR-BTS7fm5P.js","assets/index-aP6FMjSZ.css","assets/git-extension-CAy4nbR--DTMnEsDG.js","assets/chunk.RRCUZAZD-5O78oK5S.js","assets/pyterminal-extension-pHe-9S4g-94Tt9WM-.js","assets/xterm-CODBi7oP.js","assets/k-linuxterminal-Gn34lZt_-y8Mw87Kf.js","assets/webllmservice-CfQCj-vi-Dn53x9hW.js","assets/p12-splitter-CLd-jrC9-BBZSMt5A.js","assets/package-manager-extension-Dam_bdu7-CjHTAJUW.js","assets/notebook-extension-DvXaL_zr-CzAeqBDV.js","assets/command-palette-extension-BHP-LNWF-HuKo_E-f.js","assets/download-extension-C0HpW3Ju-D8PCFgJC.js","assets/unzip-extension-Bdq8VktW-DBdZadW7.js","assets/md-editor-extension-NNMGzJBp-C6Hxoz7U.js","assets/media-viewer-extension-BjSnv_2M-Bsp5KjMW.js","assets/monaco-editor-extension-BhlPveq1-BF4nK4cN.js","assets/memory-usage-extension-B_KVoe6C-RYW7UvMT.js","assets/webdav-extension-Cyfz0fV9-BMNo9uab.js","assets/settings-tree-extension-CFfvk7we-CoZZh9lE.js","assets/in-browser-ml-extension-BRq7giCu-CuFG3Z_t.js","assets/ai-system-extension-DOA2eWoM-D_SEfv4G.js","assets/rag-system-extension-ZWtPqjPf-BABSZEzq.js","assets/howto-extension-DTqPvdBZ-BCYrGF7U.js","assets/index-DAjG65pZ.js","assets/k-monaco-editor-CZiHNKA0-CLJMyj7w.js","assets/editor.main-ChA2hgQD.js","assets/editor-Dvl_Svmm.css","assets/mapbuilder-extension-Cw9K-6EZ.js","assets/style-editor-extension-Ccm_W4NP.js","assets/overpass-extension-BO2kVNgO.js","assets/gtfs-extension-BdaMPtsO.js","assets/github-service-zng27Z0w.js"])))=>i.map(i=>d[i]);
import{_ as Le,c as Ks,g as el,a as tl}from"./preload-helper-WQhrSmCl.js";import{x as S,B as Vt,s as Oe,u as Ke,y as nl,z as Da,A as Ze,E as le,H as Ve,I as qe,J as Ir,M as We,N as rl,O as Jt,P as Qt,Q as ct,R as il,T as sl,G as Gt,w as al,q as Ys,U as ol,W as Ra,X as Zs,Y as ll,Z as cl,_ as ul,$ as dl,o as Js,a0 as pl,a1 as hl,a2 as fl}from"./index-CUNXveE1.js";import"./chunk.RRCUZAZD-5O78oK5S.js";import{r as gl}from"./chunk.LTSJC6DR-BTS7fm5P.js";const ml="@kispace-io/geospace",yl="1.2.1",wl={"@kispace-io/appspace":"^1.1.25","@kispace-io/gs-lib":"file:../gs-lib","esbuild-wasm":"^0.25.11","font-gis":"^1.0.6",osmtogeojson:"^3.0.0-beta.5","pace-js":"^1.2.4"},bl={"@testing-library/jest-dom":"^6.9.1","@types/node":"^24.9.2","@vitest/coverage-v8":"^4.0.6","@vitest/ui":"^4.0.6","happy-dom":"^20.0.10",jsdom:"^27.1.0","rollup-plugin-visualizer":"^6.0.5",typescript:"~5.9.3",vite:"^7.1.12","vite-plugin-cross-origin-isolation":"^0.1.6","vite-plugin-mkcert":"^1.17.9","vite-plugin-static-copy":"^3.1.4","vite-plugin-zip":"^1.0.1",vitest:"^4.0.6"},br={name:ml,version:yl,dependencies:wl,devDependencies:bl},us="app-toolbars-main",Cn="app-toolbars-main-right",Ia="app-toolbars-main-center",ds="app-toolbars-bottom",Ai="app-toolbars-bottom-center",Pr="app-toolbars-bottom-end",wn="editor-area-main",oi="sidebar-main",ps="sidebar-main-bottom",hs="sidebar-auxiliary",Pa="panel-bottom",vl="command-save",La=!1;var fs=(n=>(n[n.LEFT=0]="LEFT",n[n.MIDDLE=1]="MIDDLE",n[n.RIGHT=2]="RIGHT",n[n.BACK=3]="BACK",n[n.FORWARD=4]="FORWARD",n))(fs||{});const El=Object.freeze(Object.defineProperty({__proto__:null,COMMAND_SAVE:vl,EDITOR_AREA_MAIN:wn,HIDE_DOT_RESOURCE:La,MouseButton:fs,PANEL_BOTTOM:Pa,SIDEBAR_AUXILIARY:hs,SIDEBAR_MAIN:oi,SIDEBAR_MAIN_BOTTOM:ps,TOOLBAR_BOTTOM:ds,TOOLBAR_BOTTOM_CENTER:Ai,TOOLBAR_BOTTOM_END:Pr,TOOLBAR_MAIN:us,TOOLBAR_MAIN_CENTER:Ia,TOOLBAR_MAIN_RIGHT:Cn},Symbol.toStringTag,{value:"Module"}));class gs{constructor(e){this.children=[],this.variables=e,this.proxy=new Proxy(e,this)}get(e,t){return e[t]||this.parent?.getProxy()[t]}set(e,t,r){e[t]=r}put(e,t){this.variables[e]=t}getProxy(){return this.proxy}createChild(e={}){const t=new gs(e);return t.parent=this,this.children.push(t),t}getChildren(){return this.children}getParent(){return this.parent}destroy(){const e=this.parent?.children.indexOf(this);e!==void 0&&e>=0&&this.parent?.children.splice(e,1),this.parent=void 0}}const ut=new gs({}),ir=ut.createChild({});ir.put("html",S);ir.put("render",Vt);ut.put("constants",El);const Qs={debug:0,info:1,warning:2,error:3};let kl="debug";const qn={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console)};let li=null;const Ki=[];function dr(n){if(n===null)return"null";if(n===void 0)return"undefined";if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean")return String(n);if(n instanceof Error)return`${n.name}: ${n.message}`;try{return JSON.stringify(n)}catch{return String(n)}}class Cl{constructor(e){this.source=e}info(e){this.log(e,"info")}warning(e){this.log(e,"warning")}warn(e){this.log(e,"warning")}error(e){this.log(e,"error")}debug(e){this.log(e,"debug")}log(e,t){jn(this.source,e,t)}}function xl(n){return Qs[n]>=Qs[kl]}function jn(n,e,t){xl(t)&&(li?li(n,e,t):(Ki.push({source:n,message:e,level:t}),qn[t==="error"?"error":t==="warning"?"warn":t==="debug"?"debug":"log"](`[${n}] ${e}`)))}function Al(){console.log=function(...n){qn.log.apply(console,n),jn("Console",n.map(e=>dr(e)).join(" "),"info")},console.info=function(...n){qn.info.apply(console,n),jn("Console",n.map(e=>dr(e)).join(" "),"info")},console.warn=function(...n){qn.warn.apply(console,n),jn("Console",n.map(e=>dr(e)).join(" "),"warning")},console.error=function(...n){qn.error.apply(console,n),jn("Console",n.map(e=>dr(e)).join(" "),"error")},console.debug=function(...n){qn.debug.apply(console,n),jn("Console",n.map(e=>dr(e)).join(" "),"debug")}}Al();function Sl(n){for(li=n;Ki.length>0;){const e=Ki.shift();e&&n(e.source,e.message,e.level)}}function Tl(){li=null}function It(n){return new Cl(n)}const ve=It("System");ut.put("logger",ve);function ms(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function _l(n,e){let t;const r=()=>{if(t)return t;const i=indexedDB.open(n);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=ms(i),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t};return(i,s)=>r().then(a=>s(a.transaction(e,i).objectStore(e)))}let Ui;function Ma(){return Ui||(Ui=_l("keyval-store","keyval")),Ui}function $l(n,e=Ma()){return e("readonly",t=>ms(t.get(n)))}function Ol(n,e,t=Ma()){return t("readwrite",r=>(r.put(e,n),ms(r.transaction)))}class Dl{async persistObject(e,t){return Ol(e,t)}async getObject(e){return $l(e)}}const Rt=new Dl;ut.put("persistenceService",Rt);const Bn=".geospace/settings.json",si="dialogSettings",ln="events/settings/changed";class Rl{async checkSettings(){this.appSettings||(this.appSettings=await Rt.getObject(Bn),this.appSettings||(this.appSettings={},await Rt.persistObject(Bn,this.appSettings)),Oe(ln,this.appSettings))}async get(e){return await this.checkSettings(),this.appSettings[e]}async set(e,t){await this.checkSettings(),this.appSettings[e]=t,await Rt.persistObject(Bn,this.appSettings),Oe(ln,this.appSettings)}async getAll(){return await this.checkSettings(),this.appSettings}async setAll(e){this.appSettings=e,await Rt.persistObject(Bn,this.appSettings),Oe(ln,this.appSettings)}async getDialogSetting(e){return await this.checkSettings(),(this.appSettings[si]||{})[e]}async setDialogSetting(e,t){await this.checkSettings();const r=this.appSettings[si]||{};r[e]=t,this.appSettings[si]=r,await Rt.persistObject(Bn,this.appSettings),Oe(ln,this.appSettings)}}const Ue=new Rl;ut.put("appSettings",Ue);const Il=Object.freeze(Object.defineProperty({__proto__:null,DIALOG_SETTINGS_KEY:si,SETTINGS_FILE_PATH:Bn,TOPIC_SETTINGS_CHANGED:ln,appSettings:Ue},Symbol.toStringTag,{value:"Module"})),sh=Object.freeze(Object.defineProperty({__proto__:null,T:ln,a:Ue,p:Rt,s:Il},Symbol.toStringTag,{value:"Module"})),yt=n=>{console.info("[TOAST] INFO:",n)},ge=n=>{console.error("[TOAST] ERROR:",n)},Pl=n=>{console.warn("[TOAST] WARNING:",n)};ir.put("toastInfo",yt);ir.put("toastError",ge);ir.put("toastWarning",Pl);var Ll=Object.defineProperty,Ml=(n,e,t)=>e in n?Ll(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,zi=(n,e,t)=>(Ml(n,typeof e!="symbol"?e+"":e,t),t),Nl=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},Fi=(n,e)=>{if(Object(e)!==e)throw TypeError('Cannot use the "in" operator on this value');return n.has(e)},ti=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},ea=(n,e,t)=>(Nl(n,e,"access private method"),t);function Na(n,e){return Object.is(n,e)}let Xe=null,Sr=!1,ai=1;const ci=Symbol("SIGNAL");function Vn(n){const e=Xe;return Xe=n,e}function Ul(){return Xe}function zl(){return Sr}const ys={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Si(n){if(Sr)throw new Error(typeof ngDevMode<"u"&&ngDevMode?"Assertion error: signal read during notification phase":"");if(Xe===null)return;Xe.consumerOnSignalRead(n);const e=Xe.nextProducerIndex++;if(Jn(Xe),e<Xe.producerNode.length&&Xe.producerNode[e]!==n&&Yi(Xe)){const t=Xe.producerNode[e];Ti(t,Xe.producerIndexOfThis[e])}Xe.producerNode[e]!==n&&(Xe.producerNode[e]=n,Xe.producerIndexOfThis[e]=Yi(Xe)?Fa(n,Xe,e):0),Xe.producerLastReadVersion[e]=n.version}function Fl(){ai++}function Ua(n){if(!(!n.dirty&&n.lastCleanEpoch===ai)){if(!n.producerMustRecompute(n)&&!Bl(n)){n.dirty=!1,n.lastCleanEpoch=ai;return}n.producerRecomputeValue(n),n.dirty=!1,n.lastCleanEpoch=ai}}function za(n){if(n.liveConsumerNode===void 0)return;const e=Sr;Sr=!0;try{for(const t of n.liveConsumerNode)t.dirty||Gl(t)}finally{Sr=e}}function Wl(){return Xe?.consumerAllowSignalWrites!==!1}function Gl(n){var e;n.dirty=!0,za(n),(e=n.consumerMarkedDirty)==null||e.call(n.wrapper??n)}function ql(n){return n&&(n.nextProducerIndex=0),Vn(n)}function jl(n,e){if(Vn(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(Yi(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)Ti(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function Bl(n){Jn(n);for(let e=0;e<n.producerNode.length;e++){const t=n.producerNode[e],r=n.producerLastReadVersion[e];if(r!==t.version||(Ua(t),r!==t.version))return!0}return!1}function Fa(n,e,t){var r;if(ws(n),Jn(n),n.liveConsumerNode.length===0){(r=n.watched)==null||r.call(n.wrapper);for(let i=0;i<n.producerNode.length;i++)n.producerIndexOfThis[i]=Fa(n.producerNode[i],n,i)}return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(e)-1}function Ti(n,e){var t;if(ws(n),Jn(n),typeof ngDevMode<"u"&&ngDevMode&&e>=n.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${e} is out of bounds of ${n.liveConsumerNode.length} consumers)`);if(n.liveConsumerNode.length===1){(t=n.unwatched)==null||t.call(n.wrapper);for(let i=0;i<n.producerNode.length;i++)Ti(n.producerNode[i],n.producerIndexOfThis[i])}const r=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[r],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[r],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){const i=n.liveConsumerIndexOfThis[e],s=n.liveConsumerNode[e];Jn(s),s.producerIndexOfThis[i]=e}}function Yi(n){var e;return n.consumerIsAlwaysLive||(((e=n?.liveConsumerNode)==null?void 0:e.length)??0)>0}function Jn(n){n.producerNode??(n.producerNode=[]),n.producerIndexOfThis??(n.producerIndexOfThis=[]),n.producerLastReadVersion??(n.producerLastReadVersion=[])}function ws(n){n.liveConsumerNode??(n.liveConsumerNode=[]),n.liveConsumerIndexOfThis??(n.liveConsumerIndexOfThis=[])}function Wa(n){if(Ua(n),Si(n),n.value===Zi)throw n.error;return n.value}function Vl(n){const e=Object.create(Hl);e.computation=n;const t=()=>Wa(e);return t[ci]=e,t}const Wi=Symbol("UNSET"),Gi=Symbol("COMPUTING"),Zi=Symbol("ERRORED"),Hl={...ys,value:Wi,dirty:!0,error:null,equal:Na,producerMustRecompute(n){return n.value===Wi||n.value===Gi},producerRecomputeValue(n){if(n.value===Gi)throw new Error("Detected cycle in computations.");const e=n.value;n.value=Gi;const t=ql(n);let r,i=!1;try{r=n.computation.call(n.wrapper),i=e!==Wi&&e!==Zi&&n.equal.call(n.wrapper,e,r)}catch(s){r=Zi,n.error=s}finally{jl(n,t)}if(i){n.value=e;return}n.value=r,n.version++}};function Xl(){throw new Error}let Kl=Xl;function Yl(){Kl()}function Zl(n){const e=Object.create(ec);e.value=n;const t=()=>(Si(e),e.value);return t[ci]=e,t}function Jl(){return Si(this),this.value}function Ql(n,e){Wl()||Yl(),n.equal.call(n.wrapper,n.value,e)||(n.value=e,tc(n))}const ec={...ys,equal:Na,value:void 0};function tc(n){n.version++,Fl(),za(n)}const at=Symbol("node");var en;(n=>{var e,t,r,i;class s{constructor(u,h={}){ti(this,t),zi(this,e);const E=Zl(u)[ci];if(this[at]=E,E.wrapper=this,h){const v=h.equals;v&&(E.equal=v),E.watched=h[n.subtle.watched],E.unwatched=h[n.subtle.unwatched]}}get(){if(!(0,n.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return Jl.call(this[at])}set(u){if(!(0,n.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(zl())throw new Error("Writes to signals not permitted during Watcher callback");const h=this[at];Ql(h,u)}}e=at,t=new WeakSet,n.isState=l=>typeof l=="object"&&Fi(t,l),n.State=s;class a{constructor(u,h){ti(this,i),zi(this,r);const E=Vl(u)[ci];if(E.consumerAllowSignalWrites=!0,this[at]=E,E.wrapper=this,h){const v=h.equals;v&&(E.equal=v),E.watched=h[n.subtle.watched],E.unwatched=h[n.subtle.unwatched]}}get(){if(!(0,n.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return Wa(this[at])}}r=at,i=new WeakSet,n.isComputed=l=>typeof l=="object"&&Fi(i,l),n.Computed=a,(l=>{var u,h,T,E;function v(O){let U,P=null;try{P=Vn(null),U=O()}finally{Vn(P)}return U}l.untrack=v;function k(O){var U;if(!(0,n.isComputed)(O)&&!(0,n.isWatcher)(O))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return((U=O[at].producerNode)==null?void 0:U.map(P=>P.wrapper))??[]}l.introspectSources=k;function _(O){var U;if(!(0,n.isComputed)(O)&&!(0,n.isState)(O))throw new TypeError("Called introspectSinks without a Signal argument");return((U=O[at].liveConsumerNode)==null?void 0:U.map(P=>P.wrapper))??[]}l.introspectSinks=_;function q(O){if(!(0,n.isComputed)(O)&&!(0,n.isState)(O))throw new TypeError("Called hasSinks without a Signal argument");const U=O[at].liveConsumerNode;return U?U.length>0:!1}l.hasSinks=q;function ee(O){if(!(0,n.isComputed)(O)&&!(0,n.isWatcher)(O))throw new TypeError("Called hasSources without a Computed or Watcher argument");const U=O[at].producerNode;return U?U.length>0:!1}l.hasSources=ee;class Y{constructor(U){ti(this,h),ti(this,T),zi(this,u);let P=Object.create(ys);P.wrapper=this,P.consumerMarkedDirty=U,P.consumerIsAlwaysLive=!0,P.consumerAllowSignalWrites=!1,P.producerNode=[],this[at]=P}watch(...U){if(!(0,n.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");ea(this,T,E).call(this,U);const P=this[at];P.dirty=!1;const x=Vn(P);for(const L of U)Si(L[at]);Vn(x)}unwatch(...U){if(!(0,n.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");ea(this,T,E).call(this,U);const P=this[at];Jn(P);for(let x=P.producerNode.length-1;x>=0;x--)if(U.includes(P.producerNode[x].wrapper)){Ti(P.producerNode[x],P.producerIndexOfThis[x]);const L=P.producerNode.length-1;if(P.producerNode[x]=P.producerNode[L],P.producerIndexOfThis[x]=P.producerIndexOfThis[L],P.producerNode.length--,P.producerIndexOfThis.length--,P.nextProducerIndex--,x<P.producerNode.length){const j=P.producerIndexOfThis[x],de=P.producerNode[x];ws(de),de.liveConsumerIndexOfThis[j]=x}}}getPending(){if(!(0,n.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[at].producerNode.filter(P=>P.dirty).map(P=>P.wrapper)}}u=at,h=new WeakSet,T=new WeakSet,E=function(O){for(const U of O)if(!(0,n.isComputed)(U)&&!(0,n.isState)(U))throw new TypeError("Called watch/unwatch without a Computed or State argument")},n.isWatcher=O=>Fi(h,O),l.Watcher=Y;function G(){var O;return(O=Ul())==null?void 0:O.wrapper}l.currentComputed=G,l.watched=Symbol("watched"),l.unwatched=Symbol("unwatched")})(n.subtle||(n.subtle={}))})(en||(en={}));const nc=Symbol("SignalWatcherBrand"),rc=new FinalizationRegistry((({watcher:n,signal:e})=>{n.unwatch(e)})),ta=new WeakMap;function ic(n){return n[nc]===!0?(console.warn("SignalWatcher should not be applied to the same class more than once."),n):class extends n{constructor(){super(...arguments),this._$St=new en.State(0),this._$Si=!1,this._$So=!0,this._$Sh=new Set}_$Sl(){if(this._$Su!==void 0)return;this._$Sv=new en.Computed((()=>{this._$St.get(),super.performUpdate()}));const e=this._$Su=new en.subtle.Watcher((function(){const t=ta.get(this);t!==void 0&&(t._$Si===!1&&t.requestUpdate(),this.watch())}));ta.set(e,this),rc.register(this,{watcher:e,signal:this._$Sv}),e.watch(this._$Sv)}_$Sp(){this._$Su!==void 0&&(this._$Su.unwatch(this._$Sv),this._$Sv=void 0,this._$Su=void 0)}performUpdate(){this.isUpdatePending&&(this._$Sl(),this._$Si=!0,this._$St.set(this._$St.get()+1),this._$Si=!1,this._$Sv.get())}update(e){try{this._$So?(this._$So=!1,super.update(e)):this._$Sh.forEach((t=>t.commit()))}finally{this.isUpdatePending=!1,this._$Sh.clear()}}requestUpdate(e,t,r){this._$So=!0,super.requestUpdate(e,t,r)}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask((()=>{this.isConnected===!1&&this._$Sp()}))}_(e){this._$Sh.add(e);const t=this._$So;this.requestUpdate(),this._$So=t}m(e){this._$Sh.delete(e)}}}en.State;en.Computed;const cn=(n,e)=>new en.State(n,e),Ht="events/contributionregistry/contributionsChanged";class sc{constructor(){this.contributions=new Map}registerContribution(e,t){const r=this.getContributions(e);if(t.disabled instanceof Function){const i=t.disabled;t.disabled=new en.Computed(i)}r.push(t),Oe(Ht,{target:e,contributions:r})}getContributions(e){return this.contributions.has(e)||this.contributions.set(e,[]),this.contributions.get(e)}}const Q=new sc;ut.put("contributionRegistry",Q);const ac={},Re=cn(null),Ut=cn(null),Dr=cn(null),Ji=cn(0),Mt=cn(void 0);cn({name:"",timestamp:0});class oc{constructor(){this.tasks=[],this.updateCounter=0}notifyUpdate(){this.updateCounter++,Ji.set(this.updateCounter)}run(e,t){const r=this.createProgressMonitor(e);try{this.tasks.push(r),this.notifyUpdate(),t(r)}finally{this.tasks.splice(this.tasks.indexOf(r),1),this.notifyUpdate()}}async runAsync(e,t){const r=this.createProgressMonitor(e);return this.tasks.push(r),this.notifyUpdate(),t(r).finally(()=>{this.tasks.splice(this.tasks.indexOf(r),1),this.notifyUpdate()})}createProgressMonitor(e){const t={name:e,message:"",currentStep:0,totalSteps:-1,progress:-1};return new Proxy(t,{set:(r,i,s)=>(r[i]=s,this.notifyUpdate(),!0)})}getActiveTasks(){return this.tasks}}const _n=new oc;ut.put("taskService",_n);const lc=It("EsmShService"),Lr=class Dt{isEsmShUrl(e){try{const t=new URL(e);return t.hostname==="esm.sh"||t.hostname==="raw.esm.sh"}catch{return!1}}isSourceIdentifier(e){return this.isEsmShUrl(e)||this.isHttpUrl(e)?!1:this.parseSource(e)!==null}isHttpUrl(e){try{const t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}parseSource(e){return!e||typeof e!="string"||(e=e.trim(),this.isHttpUrl(e))?null:e.startsWith(Dt.GITHUB_PREFIX)?this.parseGitHubSource(e):e.startsWith(Dt.JSR_PREFIX)?this.parseJsrSource(e):e.startsWith(Dt.PR_PREFIX)?this.parsePrSource(e):this.parseNpmSource(e)}parseGitHubSource(e){const r=e.substring(Dt.GITHUB_PREFIX.length).split("/");if(r.length<2)return null;const i=r[0],s=r[1];let a,l,u;const h=s.match(/^(.+?)(@(.+))?$/);return h?(a=h[1],l=h[3],r.length>2&&(u=r.slice(2).join("/")),{type:"github",owner:i,repo:a,version:l,path:u}):null}parseJsrSource(e){const t=e.substring(Dt.JSR_PREFIX.length);if(!t.startsWith("@"))return null;const r=t.split("/");if(r.length<2)return null;const i=r[0],s=r[1];let a,l,u;const h=s.match(/^(.+?)(@(.+))?$/);return h?(a=`${i}/${h[1]}`,l=h[3],r.length>2&&(u=r.slice(2).join("/")),{type:"jsr",package:a,version:l,path:u}):null}parsePrSource(e){const r=e.substring(Dt.PR_PREFIX.length).split("/");if(r.length<2)return null;const i=r[0],s=r[1];let a,l;const u=s.match(/^(.+?)@(.+)$/);return u?(a=u[1],l=u[2]):a=s,{type:"pr",owner:i,repo:a,commit:l}}parseNpmSource(e){const t=e.split("/"),r=t[0];let i,s,a;const l=r.match(/^(.+?)(@(.+))?$/);return l?(i=l[1],s=l[3],t.length>1&&(a=t.slice(1).join("/")),{type:"npm",package:i,version:s,path:a}):null}buildEsmShUrl(e,t){let r=Dt.ESM_SH_BASE;switch(e.type){case"npm":r+=`/${e.package}`,e.version&&(r+=`@${e.version}`),e.path&&(r+=`/${e.path}`);break;case"github":r+=`/${Dt.GITHUB_PREFIX}${e.owner}/${e.repo}`,e.version&&(r+=`@${e.version}`),e.path&&(r+=`/${e.path}`);break;case"jsr":r+=`/${Dt.JSR_PREFIX}${e.package}`,e.version&&(r+=`@${e.version}`),e.path&&(r+=`/${e.path}`);break;case"pr":r+=`/${Dt.PR_PREFIX}${e.owner}/${e.repo}`,e.commit&&(r+=`@${e.commit}`);break}const i=[];if(t?.deps){const s=Object.entries(t.deps).map(([a,l])=>`${a}@${l}`).join(",");i.push(`deps=${encodeURIComponent(s)}`)}return t?.target&&i.push(`target=${encodeURIComponent(t.target)}`),t?.dev&&i.push("dev"),t?.bundle===!1?i.push("bundle=false"):t?.bundle===!0&&i.push("bundle"),i.length>0&&(r+=`?${i.join("&")}`),r}normalizeToEsmSh(e,t){if(this.isEsmShUrl(e)||this.isHttpUrl(e))return e;const r=this.parseSource(e);return r?this.buildEsmShUrl(r,t):(lc.warn(`Could not parse source identifier: ${e}`),e)}extractPackageName(e){const t=this.parseSource(e);if(!t)return null;switch(t.type){case"npm":return t.package||null;case"github":return`${t.owner}/${t.repo}`;case"jsr":return t.package||null;case"pr":return`${t.owner}/${t.repo}`}}isGitHubUrl(e){try{const t=new URL(e);return t.hostname==="github.com"||t.hostname==="www.github.com"}catch{return e.startsWith("https://github.com/")||e.startsWith("http://github.com/")}}convertGitHubUrlToSource(e){try{const r=new URL(e).pathname.split("/").filter(h=>h);if(r.length<2)throw new Error("Invalid GitHub URL format");const i=r[0];let s=r[1].replace(/\.git$/,""),a,l;r.length>2&&(r[2]==="blob"||r[2]==="tree"?(a=r[3]||"main",r[2]==="blob"&&r.length>4&&(l=r.slice(4).join("/"))):r[2]==="commit"?a=r[3]:l=r.slice(2).join("/"));let u=`${Dt.GITHUB_PREFIX}${i}/${s}`;return a&&(u+=`@${a}`),l&&(u+=`/${l}`),u}catch{const t=e.match(/github\.com\/([^\/]+)\/([^\/]+)/);return t?`${Dt.GITHUB_PREFIX}${t[1]}/${t[2].replace(/\.git$/,"")}`:e}}async fetchGitHubPackageJson(e){if(e.type!=="github")throw new Error("Source must be a GitHub source");const t=e.owner,r=e.repo,i=e.version||"main",s=`https://raw.githubusercontent.com/${t}/${r}/${i}/package.json`,a=await fetch(s);if(!a.ok)throw new Error(`Failed to fetch package.json: ${a.statusText}`);return await a.json()}};Lr.ESM_SH_BASE="https://esm.sh";Lr.GITHUB_PREFIX="gh/";Lr.JSR_PREFIX="jsr/";Lr.PR_PREFIX="pr/";let cc=Lr;const an=new cc,vr="events/extensionsregistry/extensionsConfigChanged",pr="extensions",na="extensions.external";class uc{constructor(){this.extensions={},this.loadedExtensions=new Set,this.loadingPromises=new Map,Ke(ln,()=>{this.extensionsSettings=void 0,this.checkExtensionsConfig().then()}),this.loadPersistedExternalExtensions().then(()=>{this.checkExtensionsConfig().then(async()=>{const e=this.extensionsSettings?.filter(t=>this.isEnabled(t.id)).map(t=>this.load(t.id).catch(r=>{ge("Extension could not be loaded: "+r.message)}))||[];await Promise.all(e)})})}async loadPersistedExternalExtensions(){try{const e=await Ue.get(na);e&&Array.isArray(e)&&(e.forEach(t=>{this.extensions[t.id]=t}),ve.debug(`Loaded ${e.length} persisted external extensions`))}catch(e){ve.error(`Failed to load persisted external extensions: ${e}`)}}async savePersistedExternalExtensions(){try{const e=Object.values(this.extensions).filter(t=>t.external);await Ue.set(na,e)}catch(e){ve.error(`Failed to save persisted external extensions: ${e}`)}}async checkExtensionsConfig(){this.extensionsSettings||(this.extensionsSettings=await Ue.get(pr),this.extensionsSettings||(await Ue.set(pr,[]),this.extensionsSettings=await Ue.get(pr)),Oe(vr,this.extensionsSettings))}registerExtension(e){this.extensions[e.id]=e,e.external&&this.savePersistedExternalExtensions().catch(t=>{ve.error(`Failed to persist external extension: ${t}`)}),Oe(vr,this.extensionsSettings)}async loadExtensionFromUrl(e,t){ve.info(`Loading extension from URL: ${e}...`);try{let r=e,i=`Extension from ${e}`;if(an.isSourceIdentifier(e)){const a=an.extractPackageName(e);a&&(i=`Extension: ${a}`),r=an.normalizeToEsmSh(e),ve.debug(`Converted source identifier to esm.sh URL: ${e} -> ${r}`)}const s=t||`url:${r}`;if(this.isEnabled(s))return ve.info(`Extension from URL ${r} is already enabled`),s;if(!this.extensions[s]){const a={id:s,name:i,description:`Extension loaded from: ${e}`,url:r};this.registerExtension(a),ve.info(`Registered extension from URL: ${s}`)}return this.enable(s,!1),ve.info(`Successfully enabled extension from URL: ${r}`),s}catch(r){throw ve.error(`Failed to load extension from URL ${e}: ${r}`),r}}getExtensions(){return Object.values(this.extensions)}isEnabled(e){return this.checkExtensionsConfig(),!!this.extensionsSettings?.find(t=>t.id===e&&t.enabled)}isLoaded(e){return this.loadedExtensions.has(e)}enable(e,t=!1){this.isEnabled(e)||(ve.debug(`Loading extension: ${e}`),this.load(e).then(()=>{this.updateEnablement(e,!0,t)}).catch(r=>{ve.error(`Could not load extension: ${e}: ${r}`)}))}async load(e,t=[]){if(this.loadedExtensions.has(e))return;const r=this.loadingPromises.get(e);if(r)return r;if(t.includes(e)){const a=[...t,e].join(" â†’ ");throw new Error(`Circular dependency detected: ${a}`)}const i=this.extensions[e];if(!i)throw new Error("Extension not found: "+e);const s=(async()=>{try{if(i.dependencies&&i.dependencies.length>0){ve.debug(`Loading dependencies for ${e}: ${i.dependencies.join(", ")}`);const l=[...t,e];for(const u of i.dependencies)await this.load(u,l),this.isEnabled(u)||(await this.updateEnablementAsync(u,!0,!1),ve.debug(`Auto-enabled dependency: ${u}`))}const a=await _n.runAsync("Loading extension: "+i.name,async()=>{if(i.loader)return i.loader();if(i.url){let l=i.url;return an.isSourceIdentifier(i.url)&&(l=an.normalizeToEsmSh(i.url),ve.debug(`Normalized extension URL: ${i.url} -> ${l}`)),import(l)}});if(this.loadedExtensions.add(e),a?.default instanceof Function){ve.debug(`Executing extension function for: ${e}`);try{a?.default(ir.getProxy()),ve.debug(`Extension function executed successfully: ${e}`)}catch(l){throw ve.error(`Error executing extension function for ${e}: ${l}`),l}}else ve.warn(`Extension ${e} does not export a default function`);ve.debug(`Extension loaded: ${e}`)}catch(a){throw this.loadedExtensions.delete(e),a}finally{this.loadingPromises.delete(e)}})();return this.loadingPromises.set(e,s),s}disable(e,t=!1){this.isEnabled(e)&&this.updateEnablement(e,!1,t)}updateEnablement(e,t,r){this.checkExtensionsConfig().then(()=>{const i=this.extensionsSettings?.find(s=>s.id==e);i?i.enabled=t:this.extensionsSettings?.push({id:e,enabled:t}),Ue.set(pr,this.extensionsSettings).then(()=>{if(r){const s=this.extensions[e];yt(t?s.name+" enabled.":s.name+" disabled  - Please restart to take effect")}Oe(vr,this.extensionsSettings)})})}async updateEnablementAsync(e,t,r){await this.checkExtensionsConfig();const i=this.extensionsSettings?.find(s=>s.id==e);if(i?i.enabled=t:this.extensionsSettings?.push({id:e,enabled:t}),await Ue.set(pr,this.extensionsSettings),r){const s=this.extensions[e];yt(t?s.name+" enabled.":s.name+" disabled  - Please restart to take effect")}Oe(vr,this.extensionsSettings)}}ve.debug("ExtensionRegistry initializing...");const fe=new uc;ut.put("extensionRegistry",fe);ve.debug("ExtensionRegistry initialized");const Ce=It("AppLoader");function Gn(n){return n instanceof Error?n.message:String(n)}function dc(n){try{const t=new URL(n).pathname.split("/").filter(Boolean);return t.length>0?t[t.length-1]:void 0}catch{const e=n.split("/").filter(Boolean);return e.length>0?e[e.length-1]:void 0}}function pc(){const e=window.location.pathname.split("/").filter(Boolean);if(e.length===0)return;const t=e[0];if(!(!t||t==="index.html"||t.endsWith(".html")))return t}const Ga=class Qi{constructor(){this.apps=new Map,this.started=!1,this.container=document.body,this.systemRequiredExtensions=new Set}registerApp(e,t){this.apps.has(e.id)&&Ce.warn(`App '${e.id}' is already registered. Overwriting.`),this.apps.set(e.id,e),Ce.info(`Registered app: ${e.name} (${e.id}) v${e.version}`),t?.defaultAppId&&(this.defaultAppId=t.defaultAppId),t?.container&&(this.container=t.container),t?.autoStart&&!this.started&&this.start()}registerSystemRequiredExtension(e){this.systemRequiredExtensions.add(e)}async loadAppFromUrl(e){Ce.info(`Loading app from URL: ${e}...`);try{const t=await import(e);if(!t.default)throw new Error(`Module at ${e} does not have a default export`);const r=t.default;if(!r.id||!r.name||!r.version)throw new Error(`Module at ${e} does not export a valid AppDefinition`);return Ce.info(`Successfully loaded app definition from URL: ${r.name} (${r.id})`),r}catch(t){throw Ce.error(`Failed to load app from URL ${e}: ${Gn(t)}`),t}}async start(){if(this.started){Ce.debug("AppLoader already started");return}this.started=!0,Ce.info("Starting AppLoader...");const e=new URLSearchParams(window.location.search),t=e.get("app"),r=e.get("appId"),i=pc(),s=this.apps.size;let a;if(t&&(a=dc(t),a&&Ce.info(`Extracted app ID from URL path: ${a}`)),i&&Ce.info(`Extracted app ID from current page path: ${i}`),t)try{Ce.info(`URL parameter 'app' found: ${t}, attempting to load extension or app`);try{await fe.loadExtensionFromUrl(t),Ce.info(`Successfully loaded extension from URL: ${t}`)}catch(u){Ce.info(`Failed to load as extension, trying as app definition: ${Gn(u)}`);try{const h=await this.loadAppFromUrl(t);this.registerApp(h),await this.loadApp(h.id,this.container),Ce.info(`Successfully loaded app from URL: ${t}`);return}catch(h){throw Ce.error(`Failed to load from URL as both extension and app: ${Gn(h)}`),h}}}catch(u){Ce.error(`Failed to load from URL parameter, falling back to default app: ${Gn(u)}`)}const l=await this.selectAppToLoad({appIdFromUrl:r,appIdFromPath:i,appIdFromAppUrl:a,appsBeforeExtension:s});if(!l)throw new Error("No apps registered");await this.loadApp(l,this.container)}async loadApp(e,t){const r=this.apps.get(e);if(!r)throw new Error(`App '${e}' not found. Make sure it's registered.`);Ce.info(`Loading app: ${r.name}...`),this.currentApp&&(Ce.info(`Disposing current app: ${this.currentApp.name}`),this.currentApp.dispose&&await this.currentApp.dispose(),this.currentApp.extensions&&this.currentApp.extensions.length>0&&(Ce.info(`Disabling ${this.currentApp.extensions.length} extensions...`),this.currentApp.extensions.forEach(s=>{fe.disable(s)}))),r.contributions&&(Ce.info("Registering app contributions..."),r.contributions.ui&&(r.contributions.ui.forEach(s=>{const a=s.target;a&&Q.registerContribution(a,s)}),Ce.info(`Registered ${r.contributions.ui.length} UI contributions`)),r.contributions.extensions&&(r.contributions.extensions.forEach(s=>{fe.registerExtension(s)}),Ce.info(`Registered ${r.contributions.extensions.length} app extensions`)));const i=new Set(r.extensions||[]);this.systemRequiredExtensions.forEach(s=>i.add(s)),r.extensions=Array.from(i),r.extensions.length>0&&(Ce.info(`Enabling ${r.extensions.length} extensions...`),r.extensions.forEach(s=>{fe.enable(s)})),r.initialize&&(Ce.info(`Initializing ${r.name}...`),await r.initialize()),this.currentApp=r,Ce.info(`App ${r.name} loaded successfully`),this.updateDocumentMetadata(r),t&&this.renderApp(t),window.dispatchEvent(new CustomEvent("app-loaded",{detail:{appId:r.id}}))}updateDocumentMetadata(e){if(document.title=e.name,e.metadata?.favicon){const t=e.metadata.favicon;let r=document.querySelector("link[rel*='icon']");r||(r=document.createElement("link"),r.rel="icon",document.head.appendChild(r)),r.type="image/svg+xml",r.href=t}}renderApp(e){if(!this.currentApp)throw new Error("No app loaded. Call loadApp() first.");const t=this.currentApp.render?this.currentApp.render():S`<k-standard-app></k-standard-app>`;Vt(t,e),Ce.info(`Rendered ${this.currentApp.name}`)}getCurrentApp(){return this.currentApp}getRegisteredApps(){return Array.from(this.apps.values())}async getPreferredAppId(){try{return await Ue.get(Qi.PREFERRED_APP_KEY)}catch(e){Ce.debug(`Failed to get preferred app ID from settings: ${Gn(e)}`);return}}async setPreferredAppId(e){if(!this.apps.has(e))throw new Error(`App '${e}' not found. Make sure it's registered.`);try{await Ue.set(Qi.PREFERRED_APP_KEY,e),this.defaultAppId=e,Ce.info(`Set preferred app to: ${e}`)}catch(t){throw Ce.error(`Failed to persist preferred app ID: ${Gn(t)}`),t}}async selectAppToLoad(e){const{appIdFromUrl:t,appIdFromPath:r,appIdFromAppUrl:i,appsBeforeExtension:s}=e;if(t){if(this.apps.has(t))return Ce.info(`Loading app specified by URL parameter 'appId': ${t}`),t;Ce.warn(`App ID '${t}' from URL parameter not found`)}if(r){if(this.apps.has(r))return Ce.info(`Loading app from URL path: ${r}`),r;Ce.debug(`App ID '${r}' from URL path not found, continuing search`)}if(i&&this.apps.has(i))return Ce.info(`Loading app using ID extracted from app URL path: ${i}`),i;if(this.apps.size>s){const u=Array.from(this.apps.values()).slice(s);if(u.length>0){const h=u[0];return Ce.info(`Loading app registered by extension: ${h.name} (${h.id})`),h.id}}const a=await this.getPreferredAppId();if(a&&this.apps.has(a))return Ce.info(`Loading preferred app from settings: ${a}`),a;if(this.defaultAppId){if(this.apps.has(this.defaultAppId))return this.defaultAppId;Ce.warn(`Default app '${this.defaultAppId}' not found`)}const l=this.getRegisteredApps();if(l.length>0){const u=l[0];return Ce.info(`Loading first registered app: ${u.name} (${u.id})`),u.id}}};Ga.PREFERRED_APP_KEY="preferredAppId";let hc=Ga;const At=new hc;ut.put("appLoaderService",At);class qa{constructor(e,t,r,i,s){this.id=e,this.name=t,this.description=r,this.parameters=i||[],this.output=s||[]}}class ja{async execute(e,t){return we.execute(e,t)}async undo(){}async redo(){}}class Ba{constructor(){this.commands={},this.handlers=new Map}registerHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]);const r=this.handlers.get(e);r.push(t),r.sort((i,s)=>(s.ranking??0)-(i.ranking??0))}getHandler(e){return this.handlers.get(e)}createExecutionContext(e){return{params:e||{},activePart:Re.get(),activeEditor:Ut.get()}}execute(e,t={}){const r=this.getHandler(e);if(!r)throw ve.debug(`[CommandRegistry] No handlers registered for command: ${e}`),new Error(`No handlers registered for command: ${e}`);const i=this.getCommand(e),s=t.params?` params: ${JSON.stringify(t.params)}`:"";ve.debug(`[CommandRegistry] Executing command: ${e}${i?` (${i.name})`:""}${s}`);for(const a of r)if(a.canExecute===void 0||a.canExecute(t))try{const l=a.execute(t);return ve.debug(`[CommandRegistry] Command executed successfully: ${e} (result: ${l})`),l}catch(l){const u=l instanceof Error?l.message:String(l);throw ve.error(`[CommandRegistry] Command execution failed: ${e} - ${u}`),l}ve.error(`[CommandRegistry] No handler found to execute command: ${e}`)}createAndRegisterCommand(e,t,r,i,s){const a=new qa(e,t,r,i);this.registerCommand(a),s&&this.registerHandler(e,s)}registerCommand(e){this.commands[e.id]=e,ve.debug(`Command registered: ${e.id}`)}hasCommand(e){return e in this.commands}listCommands(e){return e?Object.values(this.commands).filter(t=>(we.getHandler(t.id)||[]).some(i=>i.canExecute===void 0||i.canExecute(e))).reduce((t,r)=>(t[r.id]=r,t),{}):this.commands}getCommand(e){return this.commands[e]}registerAll(e){const t=e.command.id;this.registerCommand(e.command),e.handler&&this.registerHandler(t,e.handler),e.contribution&&e.contribution.target&&Q.registerContribution(e.contribution.target,{command:t,...e.contribution})}}const we=new Ba;ut.put("commandRegistry",we);const Se=n=>{we.registerAll(n)},ah=Object.freeze(Object.defineProperty({__proto__:null,Command:qa,CommandRegistry:Ba,CommandStack:ja,commandRegistry:we,registerAll:Se},Symbol.toStringTag,{value:"Module"})),Bt="events/filesys/workspaceChanged",Qn="events/filesys/workspaceConnected";class ui{constructor(){this.state={}}getWorkspacePath(){const e=[];let t=this;for(;t;)e.push(t.getName()),t=t.getParent();return e.reverse(),e.shift(),e.join("/")}getWorkspace(){let e=this;for(;e;){const t=e.getParent();if(t)e=t;else break}return e}}var bs=(n=>(n[n.TEXT=0]="TEXT",n[n.BINARY=1]="BINARY",n))(bs||{});class St extends ui{}class Kn extends ui{}class fc extends St{constructor(e,t){super(),this.contents=e,this.name=t}async getContents(e){return this.contents}async saveContents(e,t){this.contents=e}async size(){return this.contents.length||null}async copyTo(e){throw Error("Not supported")}delete(e,t){throw Error("Not supported")}async rename(e){throw Error("Not supported")}getName(){return this.name}getParent(){}}class ra extends St{constructor(e,t){super(),this.fileHandle=e,this.parent=t}getName(){return this.fileHandle.name}getParent(){return this.parent}async delete(){return this.getParent().delete(this.getName())}async getContents(e){const t=await this.fileHandle.getFile();return!e||e?.contentType==0?await t.text():e?.encoding==0||e?.uri?URL.createObjectURL(t):e?.blob?t:t.stream()}async size(){try{return(await this.fileHandle.getFile()).size}catch{return null}}async saveContents(e,t){const r=await this.fileHandle.createWritable();if(e&&typeof e.pipeTo=="function")await e.pipeTo(r);else{const i=r.getWriter();try{await i.write(e)}finally{await i.close()}}}async copyTo(e){const t=await this.getContents({blob:!0});await(await this.getWorkspace().getResource(e,{create:!0})).saveContents(t)}async rename(e){const t=this.getParent();if(!t)throw new Error("Cannot rename root resource");if(this.getName()!==e){if(!("move"in this.fileHandle)||typeof this.fileHandle.move!="function")throw new Error("File rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.fileHandle.move(e)}catch(r){throw r.name==="NotAllowedError"||r.message?.includes("not allowed")||r.message?.includes("user agent")?new Error("File rename failed: The operation took too long and user activation expired. Please try again."):r}await t.listChildren(!0),Oe(Bt,this.getWorkspace())}}}class on extends Kn{constructor(e,t){super(),this.dirHandle=e,this.parent=t}getHandle(){return this.dirHandle}getParent(){return this.parent}getName(){return this.dirHandle.name}async listChildren(e=!1){return e||!this.files?this.loadingPromise?this.loadingPromise:(this.loadingPromise=(async()=>{try{const t={};try{for await(const r of this.dirHandle.values()){const s=r.kind==="file"?new ra(r,this):new on(r,this);t[s.getName()]=s}}catch(r){if(r.name==="NotFoundError")return this.files={},[];throw r}return this.files=t,Object.values(this.files)}finally{this.loadingPromise=void 0}})(),this.loadingPromise):Object.values(this.files)}async getResource(e,t){if(!e)throw new Error("No path provided");const r=e.split("/");let i=this,s=!1;try{for(let a=0;a<r.length;a++){let l=r[a];if(l&&(l=l.trim()),!l)break;if(i instanceof on){if(await i.listChildren(),!i.files)return null;const u=i.files[l];if(u)i=u;else if(t?.create)if(s=!0,a<r.length-1)try{const h=await i.dirHandle.getDirectoryHandle(l,{create:!0}),T=new on(h,i);i.files[l]=T,i=T,i instanceof on&&await i.listChildren();continue}catch(h){throw h.name==="NotFoundError"?new Error(`Directory not found or not accessible: ${r.slice(0,a+1).join("/")}`):h}else try{const h=await i.dirHandle.getFileHandle(l,{create:!0}),T=new ra(h,i);return i.files[l]=T,T}catch(h){throw h.name==="NotFoundError"?new Error(`File not found or not accessible: ${r.join("/")}`):h}else return null}}}finally{s&&Oe(Bt,this.getWorkspace())}return i}touch(){Oe(Bt,this.getWorkspace())}async delete(e,t=!0){if(!e){const r=this.getParent();return r instanceof on&&(await r.listChildren(),r.files&&delete r.files[this.getName()]),this.files=void 0,this.loadingPromise=void 0,r?.delete(this.getName())}return this.dirHandle.removeEntry(e,{recursive:t}).then(async()=>{this.files&&delete this.files[e],Oe(Bt,this.getWorkspace())})}async copyTo(e){for(const t of await this.listChildren()){const r=[e,t.getName()].join("/");await t.copyTo(r)}}async rename(e){const t=this.getParent();if(!t)throw new Error("Cannot rename workspace root");if(this.getName()!==e){if(!("move"in this.dirHandle)||typeof this.dirHandle.move!="function")throw new Error("Directory rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.dirHandle.move(e)}catch(r){throw r.name==="NotAllowedError"||r.message?.includes("not allowed")||r.message?.includes("user agent")?new Error("Directory rename failed: The operation took too long and user activation expired. Please try again."):r}await t.listChildren(!0),Oe(Bt,this.getWorkspace())}}}class gc{constructor(){this.contributions=new Map,this.workspace=this.loadPersistedWorkspace(),this.workspace.then(e=>{e&&Oe(Qn,e)})}registerContribution(e){this.contributions.set(e.type,e),console.log(`Workspace contribution registered: ${e.name} (${e.type})`)}getContributions(){return Array.from(this.contributions.values())}async loadPersistedWorkspace(){const e=await Rt.getObject("workspace_data");if(!e)return;const t=this.contributions.get(e.type);if(!t){console.warn(`No contribution found for workspace type: ${e.type}`);return}try{if(t.restore){const r=await t.restore(e.data);return r&&(this.currentType=e.type),r}}catch(r){console.error(`Failed to restore workspace of type ${e.type}:`,r)}}async connectWorkspace(e){const t=Array.from(this.contributions.values()).find(a=>a.canHandle(e));if(!t)throw new Error("No workspace contribution can handle this input");const r=await t.connect(e),i=t.persist?await t.persist(r):e,s={type:t.type,data:i};return await Rt.persistObject("workspace_data",s),this.currentType=t.type,this.workspace=Promise.resolve(r),Oe(Qn,r),r}async getWorkspace(){if(!this.workspace)throw new Error("No workspace connected.");return await this.workspace}isConnected(){return!!this.workspace}getWorkspaceType(){return this.currentType}async disconnectWorkspace(){this.workspace=void 0,this.currentType=void 0,await Rt.persistObject("workspace_data",null),await Rt.persistObject("workspace",null)}}const et=new gc;ut.put("workspaceService",et);et.registerContribution({type:"filesystem",name:"Local File System",canHandle(n){return n&&"kind"in n&&n.kind==="directory"},async connect(n){return new on(n)},async restore(n){if(n&&"kind"in n&&n.kind==="directory")return new on(n,void 0)},async persist(n){return n instanceof on?n.getHandle():null}});const er=(n,e)=>{const t=new en.subtle.Watcher(async()=>{try{await 0,e(n.get())}finally{t.watch(n)}});return t.watch(n),n.get(),()=>{t.unwatch(n)}};Object.defineProperty(Da.prototype,"model",{enumerable:!0,configurable:!0,writable:!0});class Mr extends ic(Da){constructor(){super(...arguments),this.signalCleanups=new Set,this.eventSubscriptions=new Set}connectedCallback(){super.connectedCallback(),this.doBeforeUI()}disconnectedCallback(){super.disconnectedCallback(),this.eventSubscriptions.forEach(e=>nl(e)),this.eventSubscriptions.clear(),this.signalCleanups.forEach(e=>e()),this.signalCleanups.clear()}subscribe(e,t){const r=Ke(e,t.bind(this));this.eventSubscriptions.add(r)}showInfo(e){yt(e)}showError(e){ge(e)}nobubble(e){return t=>{t.stopPropagation(),e.bind(this)(t)}}command(e,t={}){return()=>{this.executeCommand(e,t)}}executeCommand(e,t){const r=we.createExecutionContext(t);we.execute(e,r)}watch(e,t){const r=er(e,t.bind(this));this.signalCleanups.add(r)}firstUpdated(e){super.firstUpdated(e),this.doInitUI()}updateIdle(){requestIdleCallback(()=>this.requestUpdate())}updateLater(){requestAnimationFrame(()=>this.requestUpdate())}doBeforeUI(){}doInitUI(){}withRefresh(e){e(),this.updateLater()}}const mc="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='2'%20y='2'%20width='28'%20height='28'%20fill='%23FFCA28'/%3e%3cpath%20d='M19%2025.2879L21.0615%2023.9237C21.2231%2024.4313%2022.2462%2025.6368%2023.5385%2025.6368C24.8308%2025.6368%2025.4308%2024.931%2025.4308%2024.463C25.4308%2023.1878%2024.1112%2022.7382%2023.4774%2022.5223C23.374%2022.4871%2023.289%2022.4581%2023.2308%2022.4328C23.2009%2022.4198%2023.1558%2022.4025%2023.0979%2022.3804C22.393%2022.1111%2019.7923%2021.1175%2019.7923%2018.2373C19.7923%2015.065%2022.8538%2014.7002%2023.5462%2014.7002C23.9991%2014.7002%2026.1769%2014.7557%2027.2615%2016.7939L25.2615%2018.1898C24.8231%2017.3015%2024.0946%2017.0081%2023.6462%2017.0081C22.5385%2017.0081%2022.3077%2017.8201%2022.3077%2018.1898C22.3077%2019.227%2023.5112%2019.6919%2024.5273%2020.0844C24.7932%2020.1871%2025.0462%2020.2848%2025.2615%2020.3866C26.3692%2020.91%2028%2021.7666%2028%2024.463C28%2025.8136%2026.8672%2028.0002%2024.0154%2028.0002C20.1846%2028.0002%2019.1692%2025.7003%2019%2025.2879Z'%20fill='%233E3E3E'/%3e%3cpath%20d='M9%2025.5587L11.1487%2024.1953C11.317%2024.7026%2011.9713%2025.638%2012.9205%2025.638C13.8698%2025.638%2014.3557%2024.663%2014.3557%2024.1953V15.0002H16.9982V24.1953C17.041%2025.4636%2016.3376%2028.0002%2013.2332%2028.0002C10.379%2028.0002%209.19242%2026.3039%209%2025.5587Z'%20fill='%233E3E3E'/%3e%3c/svg%3e",yc="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='-22%200%20300%20300'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20preserveAspectRatio='xMidYMid'%3e%3cg%3e%3cpath%20d='M10.5838307,156.409656%20L10.5838307,156.196646%20L10.5838307,123.657627%20L17.7200527,123.657627%20L17.7200527,158.912657%20C18.0516208,161.753926%2017.8075656,164.63288%2017.0023629,167.377784%20C16.19722,170.122687%2014.8474392,172.677251%2013.0335946,174.88924%20C9.6624625,177.797086%205.34298451,179.369568%200.891381719,179.309391%20L0.145805038,173.983903%20C3.01718628,173.985518%205.78730255,172.922981%207.92105685,171.001585%20C9.83826599,168.76489%2010.5838307,165.729334%2010.5838307,156.409656%20Z%20M63.8037763,152.209035%20C63.8037763,156.203166%2063.8037763,159.771277%2064.1232613,162.860071%20L57.7859014,162.860071%20L57.3598815,156.522711%20C56.0343268,158.765028%2054.1386519,160.616318%2051.8656486,161.888456%20C49.5925854,163.160593%2047.0232464,163.808237%2044.4187946,163.765408%20C38.2412071,163.765408%2030.8919752,160.410366%2030.8919752,146.723715%20L30.8919752,123.983721%20L38.0281972,123.983721%20L38.0281972,145.285823%20C38.0281972,152.688352%2040.3181887,157.641058%2046.7620834,157.641058%20C48.0878176,157.655354%2049.4030239,157.404719%2050.6306575,156.903927%20C51.8582911,156.403136%2052.9735276,155.662296%2053.9110465,154.724777%20C54.8485056,153.787318%2055.5894046,152.672022%2056.0901963,151.444448%20C56.5909282,150.216815%2056.8415633,148.901549%2056.8273268,147.575814%20L56.8273268,123.717444%20L63.9634889,123.717444%20L63.9634889,151.996025%20L63.8037763,152.209035%20Z%20M77.330762,136.653806%20C77.330762,131.70104%2077.330762,127.653648%2077.0112304,123.979032%20L83.4018876,123.979032%20L83.7213726,130.635931%20C85.1452074,128.23088%2087.1949721,126.257257%2089.6521533,124.925482%20C92.1093944,123.593709%2094.8819333,122.953703%2097.6742718,123.073695%20C107.153723,123.073695%20114.289945,131.008713%20114.289945,142.831393%20C114.289945,156.784292%20105.715831,163.707504%2096.4493898,163.707504%20C94.0776877,163.813321%2091.7187865,163.305232%2089.6009496,162.232346%20C87.4831127,161.159401%2085.6780613,159.558028%2084.3604623,157.583154%20L84.3604623,178.885226%20L77.330762,178.885226%20L77.330762,136.813578%20L77.330762,136.653806%20Z%20M84.3604623,147.038594%20C84.3797833,148.004885%2084.4867369,148.967408%2084.6800071,149.914378%20C85.2842232,152.279021%2086.6597255,154.374666%2088.5887785,155.869683%20C90.5178913,157.364761%2092.8904309,158.173852%2095.3310427,158.168947%20C102.840047,158.168947%20107.260258,152.044597%20107.260258,143.150938%20C107.260258,135.375686%20103.106354,128.718758%2095.59735,128.718758%20C92.6257387,128.962101%2089.844945,130.280974%2087.7762781,132.428062%20C85.7076111,134.575149%2084.4931374,137.403079%2084.3604623,140.381689%20L84.3604623,147.038594%20Z%20M127.004503,123.94359%20L135.578617,146.896647%20C136.483954,149.452886%20137.442529,152.54168%20138.081618,154.831671%20C138.827183,152.488442%20139.625985,149.506124%20140.58462,146.736875%20L148.359872,123.94359%20L155.868876,123.94359%20L145.21784,151.636343%20C139.892293,164.950152%20136.643726,171.820127%20131.744199,175.97403%20C129.27643,178.228071%20126.267791,179.805756%20123.010354,180.553953%20L121.252929,174.589376%20C123.530581,173.840999%20125.645092,172.666304%20127.48382,171.127799%20C130.081872,169.010501%20132.14366,166.310102%20133.501635,163.246013%20C133.792288,162.715372%20133.990404,162.139031%20134.087428,161.541814%20C134.026892,160.899135%20133.865146,160.270094%20133.60817,159.677902%20L119.122716,123.837079%20L126.897968,123.837079%20L127.004503,123.94359%20Z%20M174.813541,112.770851%20L174.813541,123.954441%20L185.038557,123.954441%20L185.038557,129.279989%20L174.813541,129.279989%20L174.813541,150.262575%20C174.813541,155.055568%20176.198196,157.824817%20180.139089,157.824817%20C181.538758,157.847727%20182.935316,157.686579%20184.292992,157.345559%20L184.612537,162.671047%20C182.57671,163.376355%20180.428486,163.701283%20178.275118,163.629682%20C176.849069,163.718929%20175.420569,163.498622%20174.087657,162.983833%20C172.754744,162.469044%20171.549004,161.671976%20170.553103,160.647363%20C168.383883,157.745977%20167.394359,154.130491%20167.783854,150.528882%20L167.783854,129.226751%20L161.712742,129.226751%20L161.712742,123.901204%20L167.890329,123.901204%20L167.890329,114.421764%20L174.813541,112.770851%20Z%20M198.184399,144.647511%20C198.03988,146.453639%20198.289199,148.269577%20198.915189,149.969888%20C199.541179,151.670199%20200.528884,153.214267%20201.810114,154.495437%20C203.091285,155.776667%20204.635352,156.764373%20206.335664,157.390363%20C208.035975,158.016352%20209.851913,158.265672%20211.658041,158.121153%20C215.311153,158.202863%20218.940457,157.513288%20222.309077,156.097409%20L223.533958,161.422956%20C219.400274,163.12572%20214.955358,163.942168%20210.486396,163.819423%20C207.881107,163.997798%20205.268101,163.61054%20202.826592,162.684147%20C200.385023,161.757814%20198.172795,160.3143%20196.341489,158.452721%20C194.51022,156.591082%20193.103284,154.355345%20192.217196,151.898941%20C191.331104,149.442478%20190.986827,146.82349%20191.207978,144.221491%20C191.207978,132.505346%20198.184399,123.238905%20209.581059,123.238905%20C222.362314,123.238905%20225.557643,134.422495%20225.557643,141.558717%20C225.625954,142.658281%20225.625954,143.761016%20225.557643,144.860581%20L198.024687,144.860581%20L198.184399,144.647511%20Z%20M219.06051,139.322023%20C219.266043,137.898188%20219.163995,136.446897%20218.761184,135.065892%20C218.358433,133.684886%20217.664311,132.406228%20216.725656,131.316115%20C215.786941,130.226062%20214.625525,129.349856%20213.31959,128.746561%20C212.013656,128.143278%20210.59353,127.826939%20209.155039,127.818864%20C206.228949,128.030665%20203.487515,129.327603%20201.467959,131.455549%20C199.448402,133.583436%20198.296377,136.388874%20198.237697,139.322023%20L219.06051,139.322023%20Z%20M236.385366,136.053478%20C236.385366,131.473555%20236.385366,127.532637%20236.065834,123.911277%20L242.456492,123.911277%20L242.456492,131.526792%20L242.775977,131.526792%20C243.446769,129.176325%20244.83268,127.093027%20246.741335,125.566097%20C248.64999,124.039161%20250.986699,123.144369%20253.427072,123.005938%20C254.098762,122.917777%20254.779066,122.917777%20255.450756,123.005938%20L255.450756,129.66288%20C254.63688,129.568608%20253.814868,129.568608%20253.000992,129.66288%20C250.58353,129.756495%20248.282771,130.726973%20246.528505,132.393068%20C244.774238,134.059104%20243.686458,136.306745%20243.468304,138.716252%20C243.269171,139.805946%20243.162278,140.910475%20243.148819,142.018055%20L243.148819,162.734394%20L236.11909,162.734394%20L236.11909,136.106715%20L236.385366,136.053478%20Z'%20fill='%234E4E4E'%3e%3c/path%3e%3cpath%20d='M233.257943,16.9621357%20C233.476636,20.5398773%20232.625434,24.1017075%20230.812666,27.1939108%20C228.999898,30.286174%20226.307754,32.7687777%20223.079047,34.3255867%20C219.85034,35.8823358%20216.231324,36.4427655%20212.683013,35.9355136%20C209.134702,35.4282017%20205.817704,33.8761781%20203.154559,31.4770796%20C200.491421,29.0780409%20198.602703,25.9404959%20197.729013,22.4642047%20C196.855323,18.9879135%20197.036209,15.330196%20198.248625,11.9570899%20C199.461041,8.5839838%20201.650109,5.64808944%20204.536953,3.52346926%20C207.423803,1.39884909%20210.877782,0.181657262%20214.458814,0.0269503701%20C216.806708,-0.10224713%20219.156996,0.233972409%20221.374429,1.01627461%20C223.591922,1.79857323%20225.632893,3.01152758%20227.379981,4.58537259%20C229.12701,6.15922358%20230.54576,8.06291398%20231.554522,10.1869719%20C232.563283,12.3110298%20233.142196,14.6135829%20233.257943,16.9621357%20Z'%20fill='%23767677'%3e%3c/path%3e%3cpath%20d='M127.952969,225.540984%20C80.0236372,225.540984%2037.8984531,208.339518%2016.1170646,182.936721%20C24.5683135,205.78944%2039.8176362,225.504615%2059.8124569,239.428562%20C79.8070981,253.352629%20103.588124,260.816651%20127.952969,260.816651%20C152.318411,260.816651%20176.098839,253.352629%20196.094019,239.428562%20C216.0886,225.504615%20231.337863,205.78944%20239.789471,182.936721%20C218.061379,208.339518%20176.095848,225.540984%20127.952969,225.540984%20Z'%20fill='%23F37726'%3e%3c/path%3e%3cpath%20d='M127.952969,60.3543133%20C175.882898,60.3543133%20218.008142,77.5557785%20239.789471,102.958396%20C231.337863,80.1058563%20216.0886,60.3906823%20196.094019,46.4667348%20C176.098839,32.5427873%20152.318411,25.0784666%20127.952969,25.0784666%20C103.588124,25.0784666%2079.8070981,32.5427873%2059.8124569,46.4667348%20C39.8176362,60.3906823%2024.5683135,80.1058563%2016.1170646,102.958396%20C37.8984531,77.502541%2079.8106871,60.3543133%20127.952969,60.3543133%20Z'%20fill='%23F37726'%3e%3c/path%3e%3cpath%20d='M61.9716874,274.975202%20C62.2528294,279.48161%2061.186045,283.969713%2058.9072992,287.867658%20C56.6284936,291.765602%2053.2409116,294.896926%2049.1761363,296.862707%20C45.1113611,298.828488%2040.5533909,299.539717%2036.0829934,298.905772%20C31.6125362,298.271767%2027.4320141,296.321359%2024.0740419,293.30297%20C20.7160636,290.284582%2018.3326671,286.334835%2017.2274978,281.957035%20C16.1223339,277.579176%2016.3454363,272.971497%2017.868382,268.720869%20C19.3913284,264.470301%2022.1451683,260.769335%2025.7790187,258.089483%20C29.4129289,255.40962%2033.7623156,253.872201%2038.2730898,253.673106%20C41.2280121,253.515051%2044.1851476,253.940738%2046.9755719,254.925846%20C49.7659364,255.910962%2052.3349165,257.436187%2054.5356604,259.414404%20C56.7364042,261.392633%2058.5259031,263.785032%2059.8017495,266.455044%20C61.0776558,269.124996%2061.8150255,272.02022%2061.9716874,274.975202%20Z'%20fill='%239E9E9E'%3e%3c/path%3e%3cpath%20d='M21.5641016,54.5650606%20C18.9814831,54.6363631%2016.4354131,53.9424806%2014.2460944,52.570687%20C12.0567996,51.1988336%2010.3219858,49.2102622%209.25983722,46.8551295%20C8.19768984,44.499937%207.85562972,41.8832824%208.276674,39.3342215%20C8.69771827,36.7851606%209.86306631,34.4174662%2011.6261678,32.5289814%20C13.3892752,30.6404727%2015.6714246,29.3154324%2018.1856119,28.7204982%20C20.6997394,28.1255646%2023.3336813,28.2873008%2025.7562282,29.1853653%20C28.1787154,30.0834346%2030.2815979,31.6777312%2031.800363,33.767765%20C33.3191879,35.8578106%2034.1861222,38.3502842%2034.2921188,40.9317063%20C34.3930308,44.4222341%2033.113057,47.8117302%2030.7300493,50.3642007%20C28.3470417,52.916731%2025.0533134,54.4262842%2021.5641016,54.5650606%20Z'%20fill='%23616262'%3e%3c/path%3e%3c/g%3e%3c/svg%3e",wc="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.0164%202C10.8193%202%209.03825%203.72453%209.03825%205.85185V8.51852H15.9235V9.25926H5.97814C3.78107%209.25926%202%2010.9838%202%2013.1111L2%2018.8889C2%2021.0162%203.78107%2022.7407%205.97814%2022.7407H8.27322V19.4815C8.27322%2017.3542%2010.0543%2015.6296%2012.2514%2015.6296H19.5956C21.4547%2015.6296%2022.9617%2014.1704%2022.9617%2012.3704V5.85185C22.9617%203.72453%2021.1807%202%2018.9836%202H13.0164ZM12.0984%206.74074C12.8589%206.74074%2013.4754%206.14378%2013.4754%205.40741C13.4754%204.67103%2012.8589%204.07407%2012.0984%204.07407C11.3378%204.07407%2010.7213%204.67103%2010.7213%205.40741C10.7213%206.14378%2011.3378%206.74074%2012.0984%206.74074Z'%20fill='url(%23paint0_linear_87_8204)'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M18.9834%2030C21.1805%2030%2022.9616%2028.2755%2022.9616%2026.1482V23.4815L16.0763%2023.4815L16.0763%2022.7408L26.0217%2022.7408C28.2188%2022.7408%2029.9998%2021.0162%2029.9998%2018.8889V13.1111C29.9998%2010.9838%2028.2188%209.25928%2026.0217%209.25928L23.7266%209.25928V12.5185C23.7266%2014.6459%2021.9455%2016.3704%2019.7485%2016.3704L12.4042%2016.3704C10.5451%2016.3704%209.03809%2017.8296%209.03809%2019.6296L9.03809%2026.1482C9.03809%2028.2755%2010.8192%2030%2013.0162%2030H18.9834ZM19.9015%2025.2593C19.1409%2025.2593%2018.5244%2025.8562%2018.5244%2026.5926C18.5244%2027.329%2019.1409%2027.9259%2019.9015%2027.9259C20.662%2027.9259%2021.2785%2027.329%2021.2785%2026.5926C21.2785%2025.8562%2020.662%2025.2593%2019.9015%2025.2593Z'%20fill='url(%23paint1_linear_87_8204)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_87_8204'%20x1='12.4809'%20y1='2'%20x2='12.4809'%20y2='22.7407'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23327EBD'/%3e%3cstop%20offset='1'%20stop-color='%231565A7'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_87_8204'%20x1='19.519'%20y1='9.25928'%20x2='19.519'%20y2='30'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFDA4B'/%3e%3cstop%20offset='1'%20stop-color='%23F9C600'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e";gl("k",{resolver:n=>new URL(Object.assign({"../icons/js.svg":mc,"../icons/jupyter.svg":yc,"../icons/python.svg":wc})[`../icons/${n}.svg`],import.meta.url).href,mutator:n=>{n.setAttribute("fill","currentColor"),n.setAttribute("stroke","currentColor")}});var bc=Object.defineProperty,vc=Object.getOwnPropertyDescriptor,Nr=(n,e,t,r)=>{for(var i=r>1?void 0:r?vc(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&bc(e,t,i),i};let $n=class extends Mr{constructor(){super(...arguments),this.family="regular"}render(){if(!this.name)return"";const n=this.name.trim().split(/ +/),e=n.pop(),t=n.pop();return S`
            <wa-icon library="${t||Ve}" variant="${this.variant||Ve}"
                         family="${this.family||Ve}" name=${e} label="${this.label||this.name||Ve}"></wa-icon>`}};$n.styles=Ze`
        :host {
            display: contents;
        }
    `;Nr([le()],$n.prototype,"name",2);Nr([le()],$n.prototype,"family",2);Nr([le()],$n.prototype,"variant",2);Nr([le()],$n.prototype,"label",2);$n=Nr([qe("k-icon")],$n);function vs(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Pn=vs();function Va(n){Pn=n}var Tr={exec:()=>null};function De(n,e=""){let t=typeof n=="string"?n:n.source,r={replace:(i,s)=>{let a=typeof s=="string"?s:s.source;return a=a.replace(bt.caret,"$1"),t=t.replace(i,a),r},getRegex:()=>new RegExp(t,e)};return r}var Ec=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),bt={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},kc=/^(?:[ \t]*(?:\n|$))+/,Cc=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,xc=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ur=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ac=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Es=/(?:[*+-]|\d{1,9}[.)])/,Ha=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Xa=De(Ha).replace(/bull/g,Es).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Sc=De(Ha).replace(/bull/g,Es).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),ks=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Tc=/^[^\n]+/,Cs=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,_c=De(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Cs).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),$c=De(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Es).getRegex(),_i="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",xs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Oc=De("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",xs).replace("tag",_i).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ka=De(ks).replace("hr",Ur).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_i).getRegex(),Dc=De(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ka).getRegex(),As={blockquote:Dc,code:Cc,def:_c,fences:xc,heading:Ac,hr:Ur,html:Oc,lheading:Xa,list:$c,newline:kc,paragraph:Ka,table:Tr,text:Tc},ia=De("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ur).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_i).getRegex(),Rc={...As,lheading:Sc,table:ia,paragraph:De(ks).replace("hr",Ur).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ia).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",_i).getRegex()},Ic={...As,html:De(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",xs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Tr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:De(ks).replace("hr",Ur).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Xa).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Pc=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Lc=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Ya=/^( {2,}|\\)\n(?!\s*$)/,Mc=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,$i=/[\p{P}\p{S}]/u,Ss=/[\s\p{P}\p{S}]/u,Za=/[^\s\p{P}\p{S}]/u,Nc=De(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ss).getRegex(),Ja=/(?!~)[\p{P}\p{S}]/u,Uc=/(?!~)[\s\p{P}\p{S}]/u,zc=/(?:[^\s\p{P}\p{S}]|~)/u,Fc=De(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Ec?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Qa=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Wc=De(Qa,"u").replace(/punct/g,$i).getRegex(),Gc=De(Qa,"u").replace(/punct/g,Ja).getRegex(),eo="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",qc=De(eo,"gu").replace(/notPunctSpace/g,Za).replace(/punctSpace/g,Ss).replace(/punct/g,$i).getRegex(),jc=De(eo,"gu").replace(/notPunctSpace/g,zc).replace(/punctSpace/g,Uc).replace(/punct/g,Ja).getRegex(),Bc=De("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Za).replace(/punctSpace/g,Ss).replace(/punct/g,$i).getRegex(),Vc=De(/\\(punct)/,"gu").replace(/punct/g,$i).getRegex(),Hc=De(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Xc=De(xs).replace("(?:-->|$)","-->").getRegex(),Kc=De("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Xc).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),di=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Yc=De(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",di).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),to=De(/^!?\[(label)\]\[(ref)\]/).replace("label",di).replace("ref",Cs).getRegex(),no=De(/^!?\[(ref)\](?:\[\])?/).replace("ref",Cs).getRegex(),Zc=De("reflink|nolink(?!\\()","g").replace("reflink",to).replace("nolink",no).getRegex(),sa=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Ts={_backpedal:Tr,anyPunctuation:Vc,autolink:Hc,blockSkip:Fc,br:Ya,code:Lc,del:Tr,emStrongLDelim:Wc,emStrongRDelimAst:qc,emStrongRDelimUnd:Bc,escape:Pc,link:Yc,nolink:no,punctuation:Nc,reflink:to,reflinkSearch:Zc,tag:Kc,text:Mc,url:Tr},Jc={...Ts,link:De(/^!?\[(label)\]\((.*?)\)/).replace("label",di).getRegex(),reflink:De(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",di).getRegex()},es={...Ts,emStrongRDelimAst:jc,emStrongLDelim:Gc,url:De(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",sa).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:De(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",sa).getRegex()},Qc={...es,br:De(Ya).replace("{2,}","*").getRegex(),text:De(es.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ni={normal:As,gfm:Rc,pedantic:Ic},hr={normal:Ts,gfm:es,breaks:Qc,pedantic:Jc},eu={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},aa=n=>eu[n];function Yt(n,e){if(e){if(bt.escapeTest.test(n))return n.replace(bt.escapeReplace,aa)}else if(bt.escapeTestNoEncode.test(n))return n.replace(bt.escapeReplaceNoEncode,aa);return n}function oa(n){try{n=encodeURI(n).replace(bt.percentDecode,"%")}catch{return null}return n}function la(n,e){let t=n.replace(bt.findPipe,(s,a,l)=>{let u=!1,h=a;for(;--h>=0&&l[h]==="\\";)u=!u;return u?"|":" |"}),r=t.split(bt.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(bt.slashPipe,"|");return r}function fr(n,e,t){let r=n.length;if(r===0)return"";let i=0;for(;i<r&&n.charAt(r-i-1)===e;)i++;return n.slice(0,r-i)}function tu(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return t>0?-2:-1}function ca(n,e,t,r,i){let s=e.href,a=e.title||null,l=n[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let u={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:s,title:a,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,u}function nu(n,e,t){let r=n.match(t.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let a=s.match(t.other.beginningSpace);if(a===null)return s;let[l]=a;return l.length>=i.length?s.slice(i.length):s}).join(`
`)}var pi=class{options;rules;lexer;constructor(n){this.options=n||Pn}space(n){let e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){let e=this.rules.block.code.exec(n);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:fr(t,`
`)}}}fences(n){let e=this.rules.block.fences.exec(n);if(e){let t=e[0],r=nu(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(n){let e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let r=fr(t,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(t=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){let e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:fr(e[0],`
`)}}blockquote(n){let e=this.rules.block.blockquote.exec(n);if(e){let t=fr(e[0],`
`).split(`
`),r="",i="",s=[];for(;t.length>0;){let a=!1,l=[],u;for(u=0;u<t.length;u++)if(this.rules.other.blockquoteStart.test(t[u]))l.push(t[u]),a=!0;else if(!a)l.push(t[u]);else break;t=t.slice(u);let h=l.join(`
`),T=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${h}`:h,i=i?`${i}
${T}`:T;let E=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(T,s,!0),this.lexer.state.top=E,t.length===0)break;let v=s.at(-1);if(v?.type==="code")break;if(v?.type==="blockquote"){let k=v,_=k.raw+`
`+t.join(`
`),q=this.blockquote(_);s[s.length-1]=q,r=r.substring(0,r.length-k.raw.length)+q.raw,i=i.substring(0,i.length-k.text.length)+q.text;break}else if(v?.type==="list"){let k=v,_=k.raw+`
`+t.join(`
`),q=this.list(_);s[s.length-1]=q,r=r.substring(0,r.length-v.raw.length)+q.raw,i=i.substring(0,i.length-k.raw.length)+q.raw,t=_.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim(),r=t.length>1,i={type:"list",raw:"",ordered:r,start:r?+t.slice(0,-1):"",loose:!1,items:[]};t=r?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=r?t:"[*+-]");let s=this.rules.other.listItemRegex(t),a=!1;for(;n;){let u=!1,h="",T="";if(!(e=s.exec(n))||this.rules.block.hr.test(n))break;h=e[0],n=n.substring(h.length);let E=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,Y=>" ".repeat(3*Y.length)),v=n.split(`
`,1)[0],k=!E.trim(),_=0;if(this.options.pedantic?(_=2,T=E.trimStart()):k?_=e[1].length+1:(_=e[2].search(this.rules.other.nonSpaceChar),_=_>4?1:_,T=E.slice(_),_+=e[1].length),k&&this.rules.other.blankLine.test(v)&&(h+=v+`
`,n=n.substring(v.length+1),u=!0),!u){let Y=this.rules.other.nextBulletRegex(_),G=this.rules.other.hrRegex(_),O=this.rules.other.fencesBeginRegex(_),U=this.rules.other.headingBeginRegex(_),P=this.rules.other.htmlBeginRegex(_);for(;n;){let x=n.split(`
`,1)[0],L;if(v=x,this.options.pedantic?(v=v.replace(this.rules.other.listReplaceNesting,"  "),L=v):L=v.replace(this.rules.other.tabCharGlobal,"    "),O.test(v)||U.test(v)||P.test(v)||Y.test(v)||G.test(v))break;if(L.search(this.rules.other.nonSpaceChar)>=_||!v.trim())T+=`
`+L.slice(_);else{if(k||E.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||O.test(E)||U.test(E)||G.test(E))break;T+=`
`+v}!k&&!v.trim()&&(k=!0),h+=x+`
`,n=n.substring(x.length+1),E=L.slice(_)}}i.loose||(a?i.loose=!0:this.rules.other.doubleBlankLine.test(h)&&(a=!0));let q=null,ee;this.options.gfm&&(q=this.rules.other.listIsTask.exec(T),q&&(ee=q[0]!=="[ ] ",T=T.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:h,task:!!q,checked:ee,loose:!1,text:T,tokens:[]}),i.raw+=h}let l=i.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let u=0;u<i.items.length;u++)if(this.lexer.state.top=!1,i.items[u].tokens=this.lexer.blockTokens(i.items[u].text,[]),!i.loose){let h=i.items[u].tokens.filter(E=>E.type==="space"),T=h.length>0&&h.some(E=>this.rules.other.anyLine.test(E.raw));i.loose=T}if(i.loose)for(let u=0;u<i.items.length;u++)i.items[u].loose=!0;return i}}html(n){let e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){let e=this.rules.block.def.exec(n);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:i}}}table(n){let e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=la(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===r.length){for(let a of r)this.rules.other.tableAlignRight.test(a)?s.align.push("right"):this.rules.other.tableAlignCenter.test(a)?s.align.push("center"):this.rules.other.tableAlignLeft.test(a)?s.align.push("left"):s.align.push(null);for(let a=0;a<t.length;a++)s.header.push({text:t[a],tokens:this.lexer.inline(t[a]),header:!0,align:s.align[a]});for(let a of i)s.rows.push(la(a,s.header.length).map((l,u)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:s.align[u]})));return s}}lheading(n){let e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){let e=this.rules.block.paragraph.exec(n);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){let e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){let e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){let e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){let e=this.rules.inline.link.exec(n);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let s=fr(t.slice(0,-1),"\\");if((t.length-s.length)%2===0)return}else{let s=tu(e[2],"()");if(s===-2)return;if(s>-1){let a=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,a).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r=r.slice(1):r=r.slice(1,-1)),ca(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){let r=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=t[0].charAt(0);return{type:"text",raw:s,text:s}}return ca(t,i,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let r=this.rules.inline.emStrongLDelim.exec(n);if(!(!r||r[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!t||this.rules.inline.punctuation.exec(t))){let i=[...r[0]].length-1,s,a,l=i,u=0,h=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,e=e.slice(-1*n.length+i);(r=h.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(a=[...s].length,r[3]||r[4]){l+=a;continue}else if((r[5]||r[6])&&i%3&&!((i+a)%3)){u+=a;continue}if(l-=a,l>0)continue;a=Math.min(a,a+l+u);let T=[...r[0]][0].length,E=n.slice(0,i+r.index+T+a);if(Math.min(i,a)%2){let k=E.slice(1,-1);return{type:"em",raw:E,text:k,tokens:this.lexer.inlineTokens(k)}}let v=E.slice(2,-2);return{type:"strong",raw:E,text:v,tokens:this.lexer.inlineTokens(v)}}}}codespan(n){let e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){let e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){let e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){let e=this.rules.inline.autolink.exec(n);if(e){let t,r;return e[2]==="@"?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(n){let e;if(e=this.rules.inline.url.exec(n)){let t,r;if(e[2]==="@")t=e[0],r="mailto:"+t;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);t=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(n){let e=this.rules.inline.text.exec(n);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},qt=class ts{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Pn,this.options.tokenizer=this.options.tokenizer||new pi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:bt,block:ni.normal,inline:hr.normal};this.options.pedantic?(t.block=ni.pedantic,t.inline=hr.pedantic):this.options.gfm&&(t.block=ni.gfm,this.options.breaks?t.inline=hr.breaks:t.inline=hr.gfm),this.tokenizer.rules=t}static get rules(){return{block:ni,inline:hr}}static lex(e,t){return new ts(t).lex(e)}static lexInline(e,t){return new ts(t).inlineTokens(e)}lex(e){e=e.replace(bt.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(bt.tabCharGlobal,"    ").replace(bt.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(a=>(i=a.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let a=t.at(-1);i.raw.length===1&&a!==void 0?a.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.text,this.inlineQueue.at(-1).src=a.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},t.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let a=1/0,l=e.slice(1),u;this.options.extensions.startBlock.forEach(h=>{u=h.call({lexer:this},l),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(s=e.substring(0,a+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let a=t.at(-1);r&&a?.type==="paragraph"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let a=t.at(-1);a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(i);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,i=null;if(this.tokens.links){let u=Object.keys(this.tokens.links);if(u.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)u.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=i[2]?i[2].length:0,r=r.slice(0,i.index+s)+"["+"a".repeat(i[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let a=!1,l="";for(;e;){a||(l=""),a=!1;let u;if(this.options.extensions?.inline?.some(T=>(u=T.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);let T=t.at(-1);u.type==="text"&&T?.type==="text"?(T.raw+=u.raw,T.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,r,l)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let h=e;if(this.options.extensions?.startInline){let T=1/0,E=e.slice(1),v;this.options.extensions.startInline.forEach(k=>{v=k.call({lexer:this},E),typeof v=="number"&&v>=0&&(T=Math.min(T,v))}),T<1/0&&T>=0&&(h=e.substring(0,T+1))}if(u=this.tokenizer.inlineText(h)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(l=u.raw.slice(-1)),a=!0;let T=t.at(-1);T?.type==="text"?(T.raw+=u.raw,T.text+=u.text):t.push(u);continue}if(e){let T="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(T);break}else throw new Error(T)}}return t}},hi=class{options;parser;constructor(n){this.options=n||Pn}space(n){return""}code({text:n,lang:e,escaped:t}){let r=(e||"").match(bt.notSpaceStart)?.[0],i=n.replace(bt.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Yt(r)+'">'+(t?i:Yt(i,!0))+`</code></pre>
`:"<pre><code>"+(t?i:Yt(i,!0))+`</code></pre>
`}blockquote({tokens:n}){return`<blockquote>
${this.parser.parse(n)}</blockquote>
`}html({text:n}){return n}def(n){return""}heading({tokens:n,depth:e}){return`<h${e}>${this.parser.parseInline(n)}</h${e}>
`}hr(n){return`<hr>
`}list(n){let e=n.ordered,t=n.start,r="";for(let a=0;a<n.items.length;a++){let l=n.items[a];r+=this.listitem(l)}let i=e?"ol":"ul",s=e&&t!==1?' start="'+t+'"':"";return"<"+i+s+`>
`+r+"</"+i+`>
`}listitem(n){let e="";if(n.task){let t=this.checkbox({checked:!!n.checked});n.loose?n.tokens[0]?.type==="paragraph"?(n.tokens[0].text=t+" "+n.tokens[0].text,n.tokens[0].tokens&&n.tokens[0].tokens.length>0&&n.tokens[0].tokens[0].type==="text"&&(n.tokens[0].tokens[0].text=t+" "+Yt(n.tokens[0].tokens[0].text),n.tokens[0].tokens[0].escaped=!0)):n.tokens.unshift({type:"text",raw:t+" ",text:t+" ",escaped:!0}):e+=t+" "}return e+=this.parser.parse(n.tokens,!!n.loose),`<li>${e}</li>
`}checkbox({checked:n}){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:n}){return`<p>${this.parser.parseInline(n)}</p>
`}table(n){let e="",t="";for(let i=0;i<n.header.length;i++)t+=this.tablecell(n.header[i]);e+=this.tablerow({text:t});let r="";for(let i=0;i<n.rows.length;i++){let s=n.rows[i];t="";for(let a=0;a<s.length;a++)t+=this.tablecell(s[a]);r+=this.tablerow({text:t})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:n}){return`<tr>
${n}</tr>
`}tablecell(n){let e=this.parser.parseInline(n.tokens),t=n.header?"th":"td";return(n.align?`<${t} align="${n.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:n}){return`<strong>${this.parser.parseInline(n)}</strong>`}em({tokens:n}){return`<em>${this.parser.parseInline(n)}</em>`}codespan({text:n}){return`<code>${Yt(n,!0)}</code>`}br(n){return"<br>"}del({tokens:n}){return`<del>${this.parser.parseInline(n)}</del>`}link({href:n,title:e,tokens:t}){let r=this.parser.parseInline(t),i=oa(n);if(i===null)return r;n=i;let s='<a href="'+n+'"';return e&&(s+=' title="'+Yt(e)+'"'),s+=">"+r+"</a>",s}image({href:n,title:e,text:t,tokens:r}){r&&(t=this.parser.parseInline(r,this.parser.textRenderer));let i=oa(n);if(i===null)return Yt(t);n=i;let s=`<img src="${n}" alt="${t}"`;return e&&(s+=` title="${Yt(e)}"`),s+=">",s}text(n){return"tokens"in n&&n.tokens?this.parser.parseInline(n.tokens):"escaped"in n&&n.escaped?n.text:Yt(n.text)}},_s=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}},jt=class ns{options;renderer;textRenderer;constructor(e){this.options=e||Pn,this.options.renderer=this.options.renderer||new hi,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new _s}static parse(e,t){return new ns(t).parse(e)}static parseInline(e,t){return new ns(t).parseInline(e)}parse(e,t=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let l=s,u=this.options.extensions.renderers[l.type].call({parser:this},l);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(l.type)){r+=u||"";continue}}let a=s;switch(a.type){case"space":{r+=this.renderer.space(a);continue}case"hr":{r+=this.renderer.hr(a);continue}case"heading":{r+=this.renderer.heading(a);continue}case"code":{r+=this.renderer.code(a);continue}case"table":{r+=this.renderer.table(a);continue}case"blockquote":{r+=this.renderer.blockquote(a);continue}case"list":{r+=this.renderer.list(a);continue}case"html":{r+=this.renderer.html(a);continue}case"def":{r+=this.renderer.def(a);continue}case"paragraph":{r+=this.renderer.paragraph(a);continue}case"text":{let l=a,u=this.renderer.text(l);for(;i+1<e.length&&e[i+1].type==="text";)l=e[++i],u+=`
`+this.renderer.text(l);t?r+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):r+=u;continue}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return r}parseInline(e,t=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let l=this.options.extensions.renderers[s.type].call({parser:this},s);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=l||"";continue}}let a=s;switch(a.type){case"escape":{r+=t.text(a);break}case"html":{r+=t.html(a);break}case"link":{r+=t.link(a);break}case"image":{r+=t.image(a);break}case"strong":{r+=t.strong(a);break}case"em":{r+=t.em(a);break}case"codespan":{r+=t.codespan(a);break}case"br":{r+=t.br(a);break}case"del":{r+=t.del(a);break}case"text":{r+=t.text(a);break}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return r}},Er=class{options;block;constructor(n){this.options=n||Pn}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}emStrongMask(n){return n}provideLexer(){return this.block?qt.lex:qt.lexInline}provideParser(){return this.block?jt.parse:jt.parseInline}},ru=class{defaults=vs();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=jt;Renderer=hi;TextRenderer=_s;Lexer=qt;Tokenizer=pi;Hooks=Er;constructor(...n){this.use(...n)}walkTokens(n,e){let t=[];for(let r of n)switch(t=t.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)t=t.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let a of s)t=t.concat(this.walkTokens(a.tokens,e));break}case"list":{let i=r;t=t.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let a=i[s].flat(1/0);t=t.concat(this.walkTokens(a,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{let r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...a){let l=i.renderer.apply(this,a);return l===!1&&(l=s.apply(this,a)),l}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),t.renderer){let i=this.defaults.renderer||new hi(this.defaults);for(let s in t.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let a=s,l=t.renderer[a],u=i[a];i[a]=(...h)=>{let T=l.apply(i,h);return T===!1&&(T=u.apply(i,h)),T||""}}r.renderer=i}if(t.tokenizer){let i=this.defaults.tokenizer||new pi(this.defaults);for(let s in t.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let a=s,l=t.tokenizer[a],u=i[a];i[a]=(...h)=>{let T=l.apply(i,h);return T===!1&&(T=u.apply(i,h)),T}}r.tokenizer=i}if(t.hooks){let i=this.defaults.hooks||new Er;for(let s in t.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let a=s,l=t.hooks[a],u=i[a];Er.passThroughHooks.has(s)?i[a]=h=>{if(this.defaults.async&&Er.passThroughHooksRespectAsync.has(s))return(async()=>{let E=await l.call(i,h);return u.call(i,E)})();let T=l.call(i,h);return u.call(i,T)}:i[a]=(...h)=>{if(this.defaults.async)return(async()=>{let E=await l.apply(i,h);return E===!1&&(E=await u.apply(i,h)),E})();let T=l.apply(i,h);return T===!1&&(T=u.apply(i,h)),T}}r.hooks=i}if(t.walkTokens){let i=this.defaults.walkTokens,s=t.walkTokens;r.walkTokens=function(a){let l=[];return l.push(s.call(this,a)),i&&(l=l.concat(i.call(this,a))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return qt.lex(n,e??this.defaults)}parser(n,e){return jt.parse(n,e??this.defaults)}parseMarkdown(n){return(e,t)=>{let r={...t},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=n),i.async)return(async()=>{let a=i.hooks?await i.hooks.preprocess(e):e,l=await(i.hooks?await i.hooks.provideLexer():n?qt.lex:qt.lexInline)(a,i),u=i.hooks?await i.hooks.processAllTokens(l):l;i.walkTokens&&await Promise.all(this.walkTokens(u,i.walkTokens));let h=await(i.hooks?await i.hooks.provideParser():n?jt.parse:jt.parseInline)(u,i);return i.hooks?await i.hooks.postprocess(h):h})().catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let a=(i.hooks?i.hooks.provideLexer():n?qt.lex:qt.lexInline)(e,i);i.hooks&&(a=i.hooks.processAllTokens(a)),i.walkTokens&&this.walkTokens(a,i.walkTokens);let l=(i.hooks?i.hooks.provideParser():n?jt.parse:jt.parseInline)(a,i);return i.hooks&&(l=i.hooks.postprocess(l)),l}catch(a){return s(a)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let r="<p>An error occurred:</p><pre>"+Yt(t.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(t);throw t}}},On=new ru;function Pe(n,e){return On.parse(n,e)}Pe.options=Pe.setOptions=function(n){return On.setOptions(n),Pe.defaults=On.defaults,Va(Pe.defaults),Pe};Pe.getDefaults=vs;Pe.defaults=Pn;Pe.use=function(...n){return On.use(...n),Pe.defaults=On.defaults,Va(Pe.defaults),Pe};Pe.walkTokens=function(n,e){return On.walkTokens(n,e)};Pe.parseInline=On.parseInline;Pe.Parser=jt;Pe.parser=jt.parse;Pe.Renderer=hi;Pe.TextRenderer=_s;Pe.Lexer=qt;Pe.lexer=qt.lex;Pe.Tokenizer=pi;Pe.Hooks=Er;Pe.parse=Pe;Pe.options;Pe.setOptions;Pe.use;Pe.walkTokens;Pe.parseInline;jt.parse;qt.lex;class tn extends Mr{constructor(){super(...arguments),this.settingsKey=null}buildDOMTreePath(){const e=[];let t=this;for(;t&&t!==document.body&&t!==document.documentElement;){const r=t.getAttribute("id");if(r){e.unshift(`#${r}`);break}const i=t.tagName.toLowerCase(),s=t.parentElement;if(!s)break;const l=Array.from(s.children).filter(u=>u.tagName.toLowerCase()===i).indexOf(t);l>=0?e.unshift(`${i}:${l}`):e.unshift(i),t=s}return e.length>0?e.join(" > "):null}initializeSettingsKey(){if(!this.settingsKey){const e=this.tagName.toLowerCase(),t=this.getAttribute("id");if(t){this.settingsKey=`${e}:${t}`;return}const r=this.buildDOMTreePath();r&&(this.settingsKey=`${e}:${r}`)}}async getDialogSetting(){if(this.initializeSettingsKey(),!!this.settingsKey)return await Ue.getDialogSetting(this.settingsKey)}async setDialogSetting(e){this.initializeSettingsKey(),this.settingsKey&&await Ue.setDialogSetting(this.settingsKey,e)}}const ro=class extends tn{dispose(){}getResult(){}renderMessage(e,t=!1){if(t){const r=Pe.parse(e,{async:!1});return S`<div class="dialog-message" style="white-space: normal;">${Ir(r)}</div>`}return S`<div class="dialog-message" style="white-space: pre-line;">${e}</div>`}};ro.styles=[Ze`
            .dialog-message {
                margin-bottom: 0.5rem;
                color: var(--wa-color-text-normal);
            }
        `];let Ln=ro;const sn=It("DialogService"),Dn="dialogs",Oi={id:"ok",label:"OK",variant:"primary"},io={id:"cancel",label:"Cancel",variant:"default"},so={id:"close",label:"Close",variant:"default"};let gr=null;function iu(){return gr||(gr=document.createElement("div"),gr.id="global-dialog-container",document.body.appendChild(gr)),gr}class su{constructor(){this.contributions=new Map,this.loadContributions(),Ke(Ht,e=>{e.target===Dn&&this.loadContributions()})}loadContributions(){const e=Q.getContributions(Dn);this.contributions.clear();for(const t of e){if(!t.id){sn.warn("Dialog contribution missing id, skipping");continue}if(!t.component){sn.warn(`Dialog contribution "${t.id}" has no component function, skipping`);continue}if(!t.onButton){sn.warn(`Dialog contribution "${t.id}" has no onButton callback, skipping`);continue}this.contributions.set(t.id,t),sn.debug(`Loaded dialog contribution: ${t.id}`)}sn.info(`Loaded ${this.contributions.size} dialog contributions`)}async open(e,t){const r=this.contributions.get(e);if(!r)throw sn.error(`Dialog "${e}" not found`),new Error(`Dialog "${e}" not found`);return new Promise(i=>{const s=iu();let a=!0,l=null;const u=async()=>{if(a){if(a=!1,l)try{await l.dispose()}catch(k){const _=k instanceof Error?k.message:String(k);sn.error(`Error disposing dialog content for "${e}": ${_}`)}try{const k=l?l.getResult():void 0;await r.onButton("close",k,E)}catch(k){const _=k instanceof Error?k.message:String(k);sn.error(`Error executing close callback for dialog "${e}": ${_}`)}Vt(S``,s),i()}},h=async k=>{try{const _=l?l.getResult():void 0;await r.onButton(k,_,E)!==!1&&u()}catch(_){const q=_ instanceof Error?_.message:String(_);sn.error(`Error executing button callback for dialog "${e}": ${q}`),u()}},T=r.buttons&&r.buttons.length>0?r.buttons:[Oi];t&&typeof t=="object"&&(t.close=u);const E={...t,close:u},v=S`
                <wa-dialog label="${r.label||e}" open @wa-request-close=${u}>
                    <style>
                        .dialog-service-content {
                            display: flex;
                            flex-direction: column;
                            gap: 1rem;
                            padding: 1rem;
                            min-width: 400px;
                        }
                        
                        .dialog-service-footer {
                            display: flex;
                            gap: 0.5rem;
                            justify-content: flex-end;
                            margin-top: 1rem;
                            padding-top: 1rem;
                            border-top: 1px solid var(--wa-color-neutral-20);
                        }

                        :host-context(.wa-light) .dialog-service-footer {
                            border-top-color: var(--wa-color-neutral-80);
                        }
                    </style>
                    
                    <div class="dialog-service-content" 
                         @dialog-ok=${()=>{const k=T.find(_=>_.id==="ok");k&&h(k.id)}}
                         @dialog-cancel=${()=>{const k=T.find(_=>_.id==="cancel");k?h(k.id):u()}}>
                        ${r.component(t)}
                        
                        <div class="dialog-service-footer">
                            ${T.map(k=>S`
                                <wa-button 
                                    variant="${k.variant||"default"}"
                                    ?disabled=${k.disabled}
                                    @click=${()=>h(k.id)}
                                >
                                    ${k.label}
                                </wa-button>
                            `)}
                        </div>
                    </div>
                </wa-dialog>
            `;Vt(v,s),(async()=>{const k=Array.from(s.querySelectorAll("*"));for(const _ of k)if(_ instanceof Ln){await _.updateComplete,l=_;break}})()})}getDialogIds(){return Array.from(this.contributions.keys())}hasDialog(e){return this.contributions.has(e)}}const Di=new su;ut.put("dialogService",Di);var au=Object.defineProperty,ou=Object.getOwnPropertyDescriptor,zr=(n,e,t,r)=>{for(var i=r>1?void 0:r?ou(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&au(e,t,i),i};let Rn=class extends Ln{constructor(){super(...arguments),this.message="",this.defaultValue="",this.markdown=!1,this.inputValue=""}async firstUpdated(n){super.firstUpdated(n),this.inputValue=this.defaultValue,await this.updateComplete;const e=this.shadowRoot?.querySelector("wa-input");if(e){const t=e.shadowRoot?.querySelector("input");t&&(t.focus(),t.select())}}getResult(){return this.inputValue}handleInput(n){this.inputValue=n.target.value}handleKeyDown(n){n.key==="Enter"?(n.preventDefault(),this.dispatchEvent(new CustomEvent("dialog-ok",{bubbles:!0,composed:!0}))):n.key==="Escape"&&(n.preventDefault(),this.dispatchEvent(new CustomEvent("dialog-cancel",{bubbles:!0,composed:!0})))}render(){return S`
            ${this.renderMessage(this.message,this.markdown)}
            <wa-input
                value="${this.inputValue}"
                @input=${this.handleInput}
                @keydown=${this.handleKeyDown}
                autofocus
            ></wa-input>
        `}};Rn.styles=[...Ln.styles,Ze`
            wa-input {
                width: 100%;
            }
        `];zr([le({type:String})],Rn.prototype,"message",2);zr([le({type:String,attribute:"default-value"})],Rn.prototype,"defaultValue",2);zr([le({type:Boolean})],Rn.prototype,"markdown",2);zr([We()],Rn.prototype,"inputValue",2);Rn=zr([qe("k-prompt-dialog-content")],Rn);Q.registerContribution(Dn,{id:"prompt",label:"Input",buttons:[Oi,io],component:n=>n?S`
            <k-prompt-dialog-content 
                .message="${n.message}"
                .defaultValue="${n.defaultValue}"
                .markdown="${n.markdown}"
            ></k-prompt-dialog-content>
        `:S`<div>Error: No prompt dialog state</div>`,onButton:async(n,e,t)=>(t&&(n==="ok"?t.resolve(e||""):t.resolve(null)),!0)});async function Fr(n,e="",t=!1){return new Promise(r=>{Di.open("prompt",{message:n,defaultValue:e,markdown:t,resolve:r})})}var lu=Object.defineProperty,cu=Object.getOwnPropertyDescriptor,$s=(n,e,t,r)=>{for(var i=r>1?void 0:r?cu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&lu(e,t,i),i};let fi=class extends Ln{constructor(){super(...arguments),this.message="",this.markdown=!1}render(){return S`
            ${this.renderMessage(this.message,this.markdown)}
        `}};$s([le({type:String})],fi.prototype,"message",2);$s([le({type:Boolean})],fi.prototype,"markdown",2);fi=$s([qe("k-info-dialog-content")],fi);Q.registerContribution(Dn,{id:"info",label:"Information",buttons:[Oi],component:n=>n?S`
            <k-info-dialog-content 
                .message="${n.message}"
                .markdown="${n.markdown}"
            ></k-info-dialog-content>
        `:S`<div>Error: No info dialog state</div>`,onButton:async(n,e,t)=>(t&&t.resolve&&t.resolve(),!0)});var uu=Object.defineProperty,du=Object.getOwnPropertyDescriptor,Os=(n,e,t,r)=>{for(var i=r>1?void 0:r?du(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&uu(e,t,i),i};let gi=class extends Ln{constructor(){super(...arguments),this.message="",this.markdown=!1}getResult(){return!1}render(){return S`
            ${this.renderMessage(this.message,this.markdown)}
        `}};Os([le({type:String})],gi.prototype,"message",2);Os([le({type:Boolean})],gi.prototype,"markdown",2);gi=Os([qe("k-confirm-dialog-content")],gi);Q.registerContribution(Dn,{id:"confirm",label:"Confirm",buttons:[Oi,io],component:n=>n?S`
            <k-confirm-dialog-content 
                .message="${n.message}"
                .markdown="${n.markdown}"
            ></k-confirm-dialog-content>
        `:S`<div>Error: No confirm dialog state</div>`,onButton:async(n,e,t)=>(t&&(n==="ok"?t.resolve(!0):t.resolve(!1)),!0)});async function Wr(n,e=!1){return new Promise(t=>{Di.open("confirm",{message:n,markdown:e,resolve:t})})}var pu=Object.defineProperty,hu=Object.getOwnPropertyDescriptor,Mn=(n,e,t,r)=>{for(var i=r>1?void 0:r?hu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&pu(e,t,i),i};let un=class extends Ln{constructor(){super(...arguments),this.title="",this.message="",this.markdown=!1,this.actions=[],this.currentTitle="",this.currentMessage="",this.dialogElement=null}async firstUpdated(n){super.firstUpdated(n),this.currentTitle=this.title,this.currentMessage=this.message,await this.updateComplete;const e=this.closest("wa-dialog");e&&(this.dialogElement=e,this.updateDialogLabel());const t=this.closest(".dialog-service-content");if(t){const r=t.parentElement?.querySelector(".dialog-service-footer");r&&(r.style.display="none")}}updated(n){super.updated(n),n.has("title")&&(this.currentTitle=this.title,this.updateDialogLabel()),n.has("message")&&(this.currentMessage=this.message)}updateDialogLabel(){this.dialogElement&&this.dialogElement.setAttribute("label",this.currentTitle)}updateDialog(n,e,t){this.currentTitle=n,this.currentMessage=e,this.actions=[...t],this.updateDialogLabel(),this.requestUpdate()}handleActionClick(n){n.callback()}handleClose(){this.closest("wa-dialog")&&this.resolveCallback&&this.resolveCallback()}render(){const n=this.actions.filter(t=>t.label!=="Close"),e=this.actions.filter(t=>t.label==="Close");return S`
            <div class="dialog-content">
                <wa-scroller class="dialog-scroller">
                    ${this.renderMessage(this.currentMessage,this.markdown)}
                </wa-scroller>
                
                <div class="dialog-actions">
                    <div class="dialog-actions-left">
                        ${n.map(t=>S`
                            <wa-button 
                                variant="${t.variant||"default"}"
                                ?disabled=${t.disabled}
                                @click=${()=>this.handleActionClick(t)}
                            >
                                ${t.label}
                            </wa-button>
                        `)}
                    </div>
                    <div class="dialog-actions-right">
                        ${e.map(t=>S`
                            <wa-button 
                                variant="${t.variant||"primary"}"
                                @click=${()=>{this.handleActionClick(t),this.handleClose()}}
                            >
                                ${t.label}
                            </wa-button>
                        `)}
                    </div>
                </div>
            </div>
        `}};un.styles=[...Ln.styles,Ze`
            :host {
                display: block;
            }

            :host-context(.dialog-service-content) {
                padding: 0;
            }
            
            .dialog-content {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                min-width: 400px;
                max-width: 600px;
                height: 500px;
                padding: 1rem;
            }
            
            .dialog-scroller {
                flex: 1;
                overflow-y: auto;
            }
            
            .dialog-actions {
                display: flex;
                gap: 0.5rem;
                justify-content: space-between;
                margin-top: 0.5rem;
            }
            
            .dialog-actions-left,
            .dialog-actions-right {
                display: flex;
                gap: 0.5rem;
            }
        `];Mn([le({type:String})],un.prototype,"title",2);Mn([le({type:String})],un.prototype,"message",2);Mn([le({type:Boolean})],un.prototype,"markdown",2);Mn([We()],un.prototype,"actions",2);Mn([We()],un.prototype,"currentTitle",2);Mn([We()],un.prototype,"currentMessage",2);un=Mn([qe("k-navigable-info-dialog-content")],un);Q.registerContribution(Dn,{id:"navigable-info",label:"Information",buttons:[so],component:n=>{if(!n)return S`<div>Error: No navigable info dialog state</div>`;const e=S`
            <k-navigable-info-dialog-content 
                .title="${n.title}"
                .message="${n.message}"
                .markdown="${n.markdown}"
            ></k-navigable-info-dialog-content>
        `;return(async()=>{const t=document.querySelector("k-navigable-info-dialog-content");t&&(await t.updateComplete,t.actions=n.actions||[],t.resolveCallback=n.resolve,n.updateDialogRef&&(n.updateDialogRef.current=(r,i,s)=>{t.updateDialog(r,i,s)}))})(),e},onButton:async(n,e,t)=>t&&n==="close"&&t.resolve?(t.resolve(),!0):!1});var fu=Object.getOwnPropertyDescriptor,gu=(n,e,t,r)=>{for(var i=r>1?void 0:r?fu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=a(i)||i);return i};let rs=class extends tn{render(){return S`
            <slot></slot>
        `}};rs.styles=Ze`
        :host {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            width: 100%;
            box-sizing: border-box;
        }
    `;rs=gu([qe("k-app")],rs);var mu=Object.defineProperty,yu=Object.getOwnPropertyDescriptor,sr=(n,e,t,r)=>{for(var i=r>1?void 0:r?yu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&mu(e,t,i),i};let vn=class extends tn{constructor(){super(...arguments),this.position="start",this.isEditor=!1,this.partToolbarContent=void 0,this.partToolbarRenderer=void 0,this.contributions=[]}doBeforeUI(){const n=this.getAttribute("id");n&&this.loadContributions(n),Ke(Ht,e=>{if(!n)return;this.matchesTarget(n,e.target)&&(this.loadContributions(n),this.requestUpdate())})}matchesTarget(n,e){if(e===n)return!0;if(!n.includes(":"))return!1;const[t]=n.split(":");if(e===`${t}:*`)return!0;const r=e.split(":");if(r.length===2){const i=r[1];if(i==="system.editors"||i===".system.editors")return this.isEditor&&n.startsWith(`${t}:`)}return!1}loadContributions(n){const e=Q.getContributions(n);if(!n.includes(":")){this.contributions=e;return}const[t]=n.split(":"),r=`${t}:*`,i=Q.getContributions(r),s=[];if(this.isEditor){const a=["system.editors",".system.editors"];for(const l of a){const u=`${t}:${l}`,h=Q.getContributions(u);s.push(...h)}}this.contributions=[...i,...s,...e]}contributionCreator(n){if("command"in n){const e=n,t=!!e.showLabel;return S`
                <wa-button @click=${()=>this.executeCommand(e.command,e.params||{})}
                           title=${e.label}
                           ?disabled="${e.disabled?.get()}"
                           appearance="plain" size="small">
                    <wa-icon name=${e.icon} label="${e.label}"></wa-icon>
                    ${t?e.label:""}
                </wa-button>
            `}else if("html"in n){const e=n.html;return e instanceof Function?e():Ir(e)}else return S`<span>unknown contribution type: ${typeof n}</span>`}render(){const n=this.partToolbarRenderer?this.partToolbarRenderer():this.partToolbarContent?this.partToolbarContent:"";return S`
            <div class="toolbar-items" style=${rl({"justify-content":this.position})}>
                <slot name="start">
                    ${this.contributions.filter(e=>e.slot==="start").map(this.contributionCreator.bind(this))}
                </slot>
                ${n}
                ${this.contributions.filter(e=>e.slot===void 0).map(this.contributionCreator.bind(this))}
                <slot>
                </slot>
                <slot name="end">
                    ${this.contributions.filter(e=>e.slot==="end").map(this.contributionCreator.bind(this))}
                </slot>
            </div>
        `}};vn.styles=Ze`
        :host {
            display: flex;
            flex-direction: row;
        }

        .toolbar-items {
            display: flex;
            flex: 1;
        }
    `;sr([le()],vn.prototype,"position",2);sr([le({type:Boolean,attribute:"is-editor"})],vn.prototype,"isEditor",2);sr([le({attribute:!1})],vn.prototype,"partToolbarContent",2);sr([le({attribute:!1})],vn.prototype,"partToolbarRenderer",2);sr([We()],vn.prototype,"contributions",2);vn=sr([qe("k-toolbar")],vn);var wu=Object.defineProperty,bu=Object.getOwnPropertyDescriptor,ar=(n,e,t,r)=>{for(var i=r>1?void 0:r?bu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&wu(e,t,i),i};let En=class extends tn{constructor(){super(...arguments),this.isEditor=!1,this.partContextMenuRenderer=void 0,this.contributions=[],this.isOpen=!1,this.position={x:0,y:0},this.anchorRef=Jt(),this.dropdownRef=Jt()}doBeforeUI(){const n=this.getAttribute("id");n&&this.loadContributions(n),Ke(Ht,e=>{if(!n)return;this.matchesTarget(n,e.target)&&(this.loadContributions(n),this.requestUpdate())})}matchesTarget(n,e){if(e===n)return!0;if(!n.includes(":"))return!1;const[t]=n.split(":");if(e===`${t}:*`)return!0;const r=e.split(":");if(r.length===2){const i=r[1];if(i==="system.editors"||i===".system.editors")return this.isEditor&&n.startsWith(`${t}:`)}return!1}loadContributions(n){const e=Q.getContributions(n);if(!n.includes(":")){this.contributions=e;return}const[t]=n.split(":"),r=`${t}:*`,i=Q.getContributions(r),s=[];if(this.isEditor){const a=["system.editors",".system.editors"];for(const l of a){const u=`${t}:${l}`,h=Q.getContributions(u);s.push(...h)}}this.contributions=[...i,...s,...e]}getElementFromPoint(n,e){let t=document.elementFromPoint(n,e);if(!t)return null;for(;t;){const r=t.shadowRoot;if(r){const i=r.elementFromPoint(n,e);if(i&&i!==t){t=i;continue}}break}return t}triggerClickUnderCursor(n){const e=this.getElementFromPoint(n.clientX,n.clientY);if(e){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,clientX:n.clientX,clientY:n.clientY,screenX:n.screenX,screenY:n.screenY,button:0,buttons:0,detail:1,which:1});e.dispatchEvent(t)}}show(n,e){e&&this.triggerClickUnderCursor(e),this.position=n,this.isOpen=!0}onClose(){this.isOpen=!1}handleCommandClick(n,e){return async()=>{this.executeCommand(n,e||{})}}renderContribution(n){if("command"in n){const e=n;return S`
                <wa-dropdown-item 
                    @click=${this.handleCommandClick(e.command,e.params)}
                    ?disabled="${e.disabled?.get()}">
                    ${e.icon?S`<wa-icon slot="icon" name=${e.icon}></wa-icon>`:""}
                    ${e.label}
                </wa-dropdown-item>
            `}else if("html"in n){const e=n.html;return e instanceof Function?e():Ir(e)}return Ve}render(){if(!this.isOpen)return Ve;const n=this.partContextMenuRenderer?this.partContextMenuRenderer():Ve;return S`
            <wa-dropdown 
                ${Qt(this.dropdownRef)}
                ?open=${this.isOpen}
                @wa-after-hide=${this.onClose}
                placement="bottom-start"
                distance="0">
                
                <div 
                    slot="trigger"
                    ${Qt(this.anchorRef)}
                    style="position: fixed; 
                           left: ${this.position.x}px; 
                           top: ${this.position.y}px; 
                           width: 1px; 
                           height: 1px; 
                           pointer-events: none;">
                </div>
                
                ${n}
                ${this.contributions.map(e=>this.renderContribution(e))}
            </wa-dropdown>
        `}};En.styles=Ze`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 10000;
        }

        wa-dropdown {
            pointer-events: auto;
            min-width: 200px;
        }
        
        wa-dropdown::part(panel) {
            min-width: 200px;
        }
    `;ar([le({type:Boolean,attribute:"is-editor"})],En.prototype,"isEditor",2);ar([le({attribute:!1})],En.prototype,"partContextMenuRenderer",2);ar([We()],En.prototype,"contributions",2);ar([We()],En.prototype,"isOpen",2);ar([We()],En.prototype,"position",2);En=ar([qe("k-contextmenu")],En);class Ds extends tn{}var vu=Object.defineProperty,Eu=(n,e,t,r)=>{for(var i=void 0,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=a(e,t,i)||i);return i&&vu(e,t,i),i};class mt extends Ds{constructor(){super(...arguments),this.dirty=!1,this.isEditor=!1}getCommandStack(){return this.commandStack}renderToolbar(){return Ve}updateToolbar(){this.dispatchEvent(new CustomEvent("part-toolbar-changed",{bubbles:!0,composed:!0}))}renderContextMenu(){return Ve}updateContextMenu(){this.dispatchEvent(new CustomEvent("part-contextmenu-changed",{bubbles:!0,composed:!0}))}updated(e){super.updated(e),e.has("dirty")&&e.get("dirty")!==void 0&&this.dispatchEvent(new CustomEvent("dirty",{detail:this.dirty,bubbles:!0}))}doClose(){}disconnectedCallback(){super.disconnectedCallback()}close(){this.doClose()}connectedCallback(){super.connectedCallback()}save(){}isDirty(){return this.dirty}markDirty(e){this.dirty=e,Dr.set(null),Dr.set(this),Re.set(null),Re.set(this)}}Eu([le()],mt.prototype,"dirty");var ku=Object.defineProperty,Cu=Object.getOwnPropertyDescriptor,ao=(n,e,t,r)=>{for(var i=r>1?void 0:r?Cu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&ku(e,t,i),i};let mi=class extends Ds{constructor(){super(...arguments),this.contributions=[],this.tabGroup=Jt(),this.containerId=null,this.resizeObservers=new WeakMap}doBeforeUI(){if(this.containerId=this.getAttribute("id"),!this.containerId)throw new Error("k-tabs requires an 'id' attribute to function");this.loadAndResolveContributions()}doInitUI(){this.updateComplete.then(()=>{this.activateNextAvailableTab(),this.tabGroup.value&&(this.tabGroup.value.addEventListener("wa-tab-show",n=>{const e=this.getTabPanel(n.detail.name);e&&(this.updateToolbarFromComponent(e),requestAnimationFrame(()=>{this.updateToolbarHeightVariable(e),this.setupToolbarResizeObserver(e)}),this.dispatchEvent(new CustomEvent("tab-shown",{detail:e})))}),this.tabGroup.value.addEventListener("part-toolbar-changed",n=>{const t=n.target.closest("wa-tab-panel");t&&(this.updateToolbarFromComponent(t),requestAnimationFrame(()=>this.updateToolbarHeightVariable(t)))}),this.tabGroup.value.addEventListener("part-contextmenu-changed",n=>{const t=n.target.closest("wa-tab-panel");t&&this.updateContextMenuFromComponent(t)}),this.tabGroup.value.addEventListener("click",n=>{const e=n.target,t=e.closest("wa-tab");if(t){const a=t.getAttribute("panel");if(a){const l=this.getTabPanel(a);if(l){const u=l.querySelector(".tab-content");if(u&&u.firstElementChild){const h=u.firstElementChild;h instanceof mt&&Re.set(h)}}}return}const r=e.closest("wa-scroller.tab-content");if(!r)return;const i=r.closest("wa-tab-panel");if(!i)return;const s=i.querySelector(".tab-content");if(s&&s.firstElementChild){const a=s.firstElementChild;a instanceof mt&&Re.set(a)}}),this.tabGroup.value.addEventListener("contextmenu",n=>{const e=n,t=e.target.closest("wa-scroller.tab-content");if(!t)return;e.preventDefault();const r=t.closest("wa-tab-panel");r&&requestAnimationFrame(()=>{this.updateContextMenuFromComponent(r);const i=r.querySelector("k-contextmenu");i&&i.show({x:e.clientX,y:e.clientY},e)})}))}),Ke(Ht,n=>{!this.containerId||n.target!==this.containerId||(this.loadAndResolveContributions(),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()}))})}updated(n){if(super.updated(n),n.has("contributions")){const e=this.containerId===wn;this.contributions.forEach(t=>{const r=this.getTabPanel(t.name);if(!r)return;const i=r.querySelector(".tab-content");if(i&&i.firstElementChild){const s=i.firstElementChild;s instanceof mt&&(s.tabContribution=t,s.isEditor=e)}requestAnimationFrame(()=>this.updateToolbarHeightVariable(r))})}}has(n){return this.tabGroup.value?!!this.getTabPanel(n):!1}activate(n){this.tabGroup.value&&this.tabGroup.value.setAttribute("active",n)}getActiveEditor(){return this.tabGroup.value?this.tabGroup.value.getAttribute("active"):null}open(n){if(this.contributions.find(t=>t.name===n.name)){this.activate(n.name);return}this.contributions.push(n),this.requestUpdate(),this.updateComplete.then(()=>{this.activate(n.name);const t=this.getTabPanel(n.name);if(t){const r=t.querySelector(".tab-content");if(r&&r.firstElementChild){const i=r.firstElementChild;i instanceof mt&&(i.tabContribution=n,i.isEditor=this.containerId===wn)}requestAnimationFrame(()=>{this.updateToolbarFromComponent(t),this.updateToolbarHeightVariable(t),this.setupToolbarResizeObserver(t)})}})}handleTabAuxClick(n,e){n.button===fs.MIDDLE&&e.closable&&this.closeTab(n,e.name)}async closeTab(n,e){if(n.stopPropagation(),this.isDirty(e)&&!await Wr("Unsaved changes will be lost: Do you really want to close?"))return;const t=this.getTabPanel(e);if(!t)return;const r=this.contributions.find(s=>s.name===e);if(!r)return;this.cleanupTabInstance(t);const i=this.contributions.indexOf(r);i>-1&&this.contributions.splice(i,1),this.dispatchEvent(new CustomEvent("tab-closed",{detail:t})),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()})}markDirty(n,e){this.getTab(n).classList.toggle("part-dirty",e)}isDirty(n){return this.getTab(n).classList.contains("part-dirty")}loadAndResolveContributions(){this.contributions=Q.getContributions(this.containerId),this.requestUpdate()}cleanupTabInstance(n){const e=this.resizeObservers.get(n);e&&(e.disconnect(),this.resizeObservers.delete(n));const t=n.querySelector(".tab-content");if(t&&t.firstElementChild){const r=t.firstElementChild;"close"in r&&typeof r.close=="function"&&r.close()}}activateNextAvailableTab(){if(!this.tabGroup.value)return;const n=this.tabGroup.value.querySelectorAll("wa-tab");if(n.length>0){const e=n.item(0).getAttribute("panel");e&&this.tabGroup.value.setAttribute("active",e)}else this.tabGroup.value.removeAttribute("active")}getTabPanel(n){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab-panel[name='${n}']`):null}getTab(n){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab[panel='${n}']`):null}updateToolbarFromComponent(n){const e=n.querySelector(".tab-content");if(!e||!e.firstElementChild)return;const t=e.firstElementChild;if(!(t instanceof mt)||!t.renderToolbar)return;const r=n.querySelector("k-toolbar");r&&(r.partToolbarRenderer=()=>t.renderToolbar(),r.requestUpdate())}updateContextMenuFromComponent(n){const e=n.querySelector(".tab-content");if(!e||!e.firstElementChild)return;const t=e.firstElementChild;if(!(t instanceof mt)||!t.renderContextMenu)return;const r=n.querySelector("k-contextmenu");r&&(r.partContextMenuRenderer=()=>t.renderContextMenu(),r.requestUpdate())}updateToolbarHeightVariable(n){const e=n.querySelector(".tab-toolbar");if(!e)return;const t=e.offsetHeight;n.style.setProperty("--toolbar-height",`${t}px`)}setupToolbarResizeObserver(n){if(this.resizeObservers.has(n))return;const e=n.querySelector(".tab-toolbar");if(!e)return;const t=new ResizeObserver(()=>{this.updateToolbarHeightVariable(n)});t.observe(e),this.resizeObservers.set(n,t)}render(){const n=At.getCurrentApp();return S`
            <wa-tab-group ${Qt(this.tabGroup)}>
                ${ct(this.contributions.length===0,()=>S`
                        <div class="empty-state">
                            ${ct(n,()=>S`
                                    <div class="empty-content">
                                        <h2 class="empty-title">${n.name}</h2>
                                        ${ct(n.description,()=>S`<p class="empty-description">${n.description}</p>`)}
                                    </div>
                                `,()=>S`
                                    <wa-icon name="folder-open" class="empty-icon"></wa-icon>
                                `)}
                        </div>
                    `,()=>il(this.contributions,e=>e.name,e=>S`
                            <wa-tab panel="${e.name}"
                                    @auxclick="${t=>this.handleTabAuxClick(t,e)}">
                                <k-icon name="${e.icon}"></k-icon>
                                ${e.label}
                                ${ct(e.closable,()=>S`
                                    <wa-icon name="xmark" label="Close"  @click="${t=>this.closeTab(t,e.name)}"></wa-icon>
                                `)}
                            </wa-tab>
                            <wa-tab-panel name="${e.name}">
                                <k-toolbar id="toolbar:${e.editorId??e.name}" 
                                           class="tab-toolbar"
                                           ?is-editor="${this.containerId===wn}"></k-toolbar>
                                <wa-scroller class="tab-content" orientation="vertical">
                                    ${e.component?e.component(e.name):Ve}
                                </wa-scroller>
                                <k-contextmenu id="contextmenu:${e.name}"
                                               ?is-editor="${this.containerId===wn}"></k-contextmenu>
                            </wa-tab-panel>
                        `))}
            </wa-tab-group>
        `}};mi.styles=Ze`
        :host {
            height: 100%;
            width: 100%;
        }

        wa-tab-group {
            height: 100%;
            width: 100%;
        }

        wa-tab-group::part(base) {
            display: grid;
            grid-template-rows: auto minmax(0, 1fr);
            height: 100%;
            width: 100%;
        }

        wa-tab-panel[active] {
            display: grid;
            grid-template-rows: minmax(0, 1fr);
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .tab-content {
            position: absolute;
            top: calc(var(--toolbar-height, 0px));
            right: 0;
            left: 0;
            height: calc(100% - var(--toolbar-height, 0px));
        }

        wa-tab::part(base) {
            padding: 3px 0.5rem;
        }

        wa-tab-panel {
            --padding: 0px;
        }

        .part-dirty::part(base) {
            font-style: italic;
            color: var(--wa-color-danger-fill-loud)
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            grid-row: 2;
        }

        .empty-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            gap: 0.75rem;
            opacity: 0.3;
        }

        .empty-title {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--wa-color-text-quiet);
        }

        .empty-description {
            margin: 0;
            font-size: 1rem;
            color: var(--wa-color-text-quiet);
            max-width: 500px;
        }

        .empty-icon {
            font-size: 6rem;
            opacity: 0.2;
            color: var(--wa-color-text-quiet);
        }
    `;ao([We()],mi.prototype,"contributions",2);mi=ao([qe("k-tabs")],mi);var xu=Object.defineProperty,Au=Object.getOwnPropertyDescriptor,Gr=(n,e,t,r)=>{for(var i=r>1?void 0:r?Au(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&xu(e,t,i),i};let tr=class extends tn{constructor(){super(...arguments),this.orientation="horizontal",this.gridSizes=[],this.gridChildren=[],this.resizing=null,this.resizeOverlay=null,this.childrenLoaded=!1,this.childStylesApplied=!1,this.settingsLoaded=!1,this.handleResize=n=>{if(!this.resizing)return;const t=(this.orientation==="horizontal"?n.clientX:n.clientY)-this.resizing.startPos,r=[...this.resizing.startSizes];r[this.resizing.handleIndex]+=t,r[this.resizing.handleIndex+1]-=t;const i=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,s=i*.05;if(r[this.resizing.handleIndex]>=s&&r[this.resizing.handleIndex+1]>=s){this.resizing.currentSizes=r;const a=r.map((l,u)=>{const T=`${(l/i*100).toFixed(2)}%`;return u===r.length-1?T:`${T} 4px`}).join(" ");this.orientation==="horizontal"?this.style.gridTemplateColumns=a:this.style.gridTemplateRows=a}},this.stopResize=async()=>{if(this.resizing?.currentSizes){const n=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight;this.gridSizes=this.resizing.currentSizes.map(e=>`${(e/n*100).toFixed(2)}%`),await this.saveSizes(),this.requestUpdate()}this.resizeOverlay&&(document.body.removeChild(this.resizeOverlay),this.resizeOverlay=null),this.resizing=null,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.body.style.cursor="",document.body.style.userSelect=""}}createRenderRoot(){return this}doBeforeUI(){this.childrenLoaded||(this.mutationObserver=new MutationObserver(()=>{this.childrenLoaded||this.loadChildren()}),this.mutationObserver.observe(this,{childList:!0,subtree:!1}),this.loadChildren())}async loadChildren(){const n=Array.from(this.children).filter(e=>e.tagName!=="STYLE"&&e.tagName!=="SCRIPT"&&!e.classList.contains("resize-handle"));if(n.length!==0){if(this.childrenLoaded=!0,this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.gridChildren=n,!this.settingsLoaded){this.settingsLoaded=!0;const e=await this.getDialogSetting();if(e&&Array.isArray(e.sizes)&&e.sizes.length===this.gridChildren.length){this.gridSizes=e.sizes,this.requestUpdate();return}}if(this.sizes)this.gridSizes=this.sizes.split(",").map(e=>e.trim());else{const e=`${100/this.gridChildren.length}%`;this.gridSizes=this.gridChildren.map(()=>e)}this.requestUpdate()}}async saveSizes(){this.gridSizes.length!==0&&await this.setDialogSetting({sizes:this.gridSizes,orientation:this.orientation})}updated(n){super.updated(n),n.has("gridChildren")&&!this.childStylesApplied&&this.gridChildren.length>0&&(this.childStylesApplied=!0,this.gridChildren.forEach((e,t)=>{e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",e.style.gridColumn=this.orientation==="horizontal"?`${t*2+1}`:"1",e.style.gridRow=this.orientation==="vertical"?`${t*2+1}`:"1",e.style.display="flex",e.style.flexDirection="column"}))}startResize(n,e){if(n.preventDefault(),e>=this.gridChildren.length-1)return;const t=this.orientation==="horizontal"?n.clientX:n.clientY,r=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,i=this.gridSizes.map(s=>s.endsWith("%")?parseFloat(s)/100*r:(s.endsWith("px"),parseFloat(s)));this.resizing={handleIndex:e,startPos:t,startSizes:i},this.resizeOverlay=document.createElement("div"),this.resizeOverlay.style.position="fixed",this.resizeOverlay.style.top="0",this.resizeOverlay.style.left="0",this.resizeOverlay.style.width="100%",this.resizeOverlay.style.height="100%",this.resizeOverlay.style.zIndex="9999",this.resizeOverlay.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.appendChild(this.resizeOverlay),document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"}render(){if(this.gridChildren.length===0||this.gridSizes.length===0)return Ve;const n=this.gridSizes.flatMap((e,t)=>t===this.gridSizes.length-1?[e]:[e,"4px"]).join(" ");return this.style.display="grid",this.orientation==="horizontal"?(this.style.gridTemplateColumns=n,this.style.gridTemplateRows="100%"):(this.style.gridTemplateColumns="100%",this.style.gridTemplateRows=n),this.style.overflow="hidden",S`
            <style>
                .resize-handle {
                    position: relative;
                    z-index: 10;
                    background-color: var(--wa-color-neutral-border-quiet);
                    transition: background-color var(--wa-transition-fast);
                }
                
                .resize-handle:hover {
                    background-color: var(--wa-color-brand-fill-normal);
                }
            </style>
            
            ${this.gridChildren.map((e,t)=>{if(t<this.gridChildren.length-1){const r=this.orientation==="horizontal"?`${t*2+2}`:"1",i=this.orientation==="vertical"?`${t*2+2}`:"1";return S`
                        <div 
                            class="resize-handle"
                            style="
                                cursor: ${this.orientation==="horizontal"?"col-resize":"row-resize"};
                                grid-column: ${r};
                                grid-row: ${i};
                            "
                            @mousedown=${s=>this.startResize(s,t)}
                        ></div>
                    `}return Ve})}
        `}disconnectedCallback(){super.disconnectedCallback(),this.resizing&&this.stopResize(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}connectedCallback(){super.connectedCallback(),this.style.height="100%",this.style.width="100%"}};Gr([le()],tr.prototype,"orientation",2);Gr([le()],tr.prototype,"sizes",2);Gr([We()],tr.prototype,"gridSizes",2);Gr([We()],tr.prototype,"gridChildren",2);tr=Gr([qe("k-resizable-grid")],tr);var Su=Object.defineProperty,Tu=Object.getOwnPropertyDescriptor,Rs=(n,e,t,r)=>{for(var i=r>1?void 0:r?Tu(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Su(e,t,i),i};let Rr=class extends Mr{constructor(){super(...arguments),this.message="No content.",this.icon="info-circle"}render(){return S`
            <h3>
                <wa-icon name=${this.icon} label="${this.message}"></wa-icon>
                ${this.message}
            </h3>
        `}};Rr.styles=Ze`
        :host {
            display: flex;
            margin: 10px;
        }

        * {
            flex: 1;
        }
    `;Rs([le()],Rr.prototype,"message",2);Rs([le()],Rr.prototype,"icon",2);Rr=Rs([qe("k-no-content")],Rr);var oo=(n=>(n.ZERO_SHOT_CLASSIFICATION="Xenova/distilbert-base-uncased-mnli",n.FEATURE_EXTRACTION="Xenova/all-MiniLM-L6-v2",n.TEXT_CLASSIFICATION="Xenova/distilbert-base-uncased-finetuned-sst-2-english",n.QUESTION_ANSWERING="Xenova/distilbert-base-cased-distilled-squad",n.SUMMARIZATION="Xenova/distilbart-cnn-6-6",n.TRANSLATION_EN_FR="Xenova/opus-mt-en-fr",n.FILL_MASK="Xenova/distilbert-base-uncased",n.SENTENCE_SIMILARITY="Xenova/all-MiniLM-L6-v2",n.TOKEN_CLASSIFICATION="Xenova/distilbert-base-uncased-finetuned-conll03-english",n.IMAGE_CLASSIFICATION="Xenova/vit-base-patch16-224",n.OBJECT_DETECTION="Xenova/detr-resnet-50",n.AUTOMATIC_SPEECH_RECOGNITION="Xenova/whisper-tiny",n.AUDIO_CLASSIFICATION="Xenova/wav2vec2-base",n))(oo||{}),lo=(n=>(n.ZERO_SHOT_CLASSIFICATION="zero-shot-classification",n.FEATURE_EXTRACTION="feature-extraction",n.TEXT_CLASSIFICATION="text-classification",n.SENTIMENT_ANALYSIS="sentiment-analysis",n.QUESTION_ANSWERING="question-answering",n.SUMMARIZATION="summarization",n.TRANSLATION="translation",n.FILL_MASK="fill-mask",n.SENTENCE_SIMILARITY="sentence-similarity",n.TOKEN_CLASSIFICATION="token-classification",n.IMAGE_CLASSIFICATION="image-classification",n.OBJECT_DETECTION="object-detection",n.AUTOMATIC_SPEECH_RECOGNITION="automatic-speech-recognition",n.AUDIO_CLASSIFICATION="audio-classification",n.IMAGE_TO_TEXT="image-to-text",n.TEXT_TO_IMAGE="text-to-image",n.IMAGE_SEGMENTATION="image-segmentation",n.DEPTH_ESTIMATION="depth-estimation",n))(lo||{});function _u(n){switch(n){case"zero-shot-classification":return"Xenova/distilbert-base-uncased-mnli";case"feature-extraction":return"Xenova/all-MiniLM-L6-v2";case"text-classification":case"sentiment-analysis":return"Xenova/distilbert-base-uncased-finetuned-sst-2-english";case"question-answering":return"Xenova/distilbert-base-cased-distilled-squad";case"summarization":return"Xenova/distilbart-cnn-6-6";case"translation":return"Xenova/opus-mt-en-fr";case"fill-mask":return"Xenova/distilbert-base-uncased";case"sentence-similarity":return"Xenova/all-MiniLM-L6-v2";case"token-classification":return"Xenova/distilbert-base-uncased-finetuned-conll03-english";case"image-classification":return"Xenova/vit-base-patch16-224";case"object-detection":return"Xenova/detr-resnet-50";case"automatic-speech-recognition":return"Xenova/whisper-tiny";case"audio-classification":return"Xenova/wav2vec2-base";default:return null}}let qi=null,ua=!1;async function co(){qi||(qi=Le(()=>import("./transformers-BKBq_BO4.js"),__vite__mapDeps([0,1,2,3,4])));const n=await qi;return ua||(n.env.allowRemoteModels=!0,n.env.allowLocalModels=!1,n.env.remoteHost="https://huggingface.co",ua=!0),n}async function $u(n){const{env:e}=await co();n&&n.trim()?e.useAuthToken=n.trim():e.useAuthToken=null}const mr=It("InBrowserMLService");class Hn{constructor(){this.pipelines=new Map,this.loadingPipelines=new Set}static getInstance(){return Hn.instance||(Hn.instance=new Hn),Hn.instance}setAuthToken(e){$u(e).then(()=>{e&&e.trim()&&mr.info("Hugging Face token set for authenticated model access")}).catch(t=>{mr.warn(`Failed to configure auth token: ${t instanceof Error?t.message:String(t)}`)})}async getPipeline(e,t,r={}){if(!t&&typeof e!="string"){const l=_u(e);l&&(t=l)}const i=e,s=t,a=`${i}:${s}`;if(this.pipelines.has(a))return this.pipelines.get(a);if(this.loadingPipelines.has(a)){for(;this.loadingPipelines.has(a);)await new Promise(l=>setTimeout(l,100));return this.pipelines.get(a)}this.loadingPipelines.add(a);try{mr.info(`Loading transformers.js pipeline: ${i} with model ${s}...`);const{pipeline:l}=await co(),u=await l(i,s,{quantized:!0,...r});return this.pipelines.set(a,u),mr.info(`Pipeline ${a} loaded successfully`),u}catch(l){const u=l instanceof Error?l.message:String(l);throw mr.error(`Failed to load pipeline ${a}: ${u}`),l}finally{this.loadingPipelines.delete(a)}}clearPipeline(e,t){const s=`${e}:${t}`;this.pipelines.delete(s)}clearAllPipelines(){this.pipelines.clear()}}const Ou=Hn.getInstance(),Is="events/aiservice/streamStarted",Ps="events/aiservice/streamChunk",Ls="events/aiservice/streamComplete",_r="events/aiservice/streamError",Ri="events/aiservice/aiConfigChanged",Ms="events/aiservice/agentWorkflowStarted",Ns="events/aiservice/agentWorkflowComplete",Us="events/aiservice/agentWorkflowError",zs="aiservice.agents",tt="aiservice.chatProviders",qr="aiservice.promptEnhancers",yn="aiConfig",Fs={defaultProvider:"openai",providers:[]},yi=10,uo=5,Du=Object.freeze(Object.defineProperty({__proto__:null,AI_CONFIG_TEMPLATE:Fs,CID_AGENTS:zs,CID_CHAT_PROVIDERS:tt,CID_PROMPT_ENHANCERS:qr,KEY_AI_CONFIG:yn,MAX_RECENT_TOOL_CALLS:uo,MAX_TOOL_ITERATIONS:yi,TOPIC_AGENT_WORKFLOW_COMPLETE:Ns,TOPIC_AGENT_WORKFLOW_ERROR:Us,TOPIC_AGENT_WORKFLOW_STARTED:Ms,TOPIC_AICONFIG_CHANGED:Ri,TOPIC_AI_STREAM_CHUNK:Ps,TOPIC_AI_STREAM_COMPLETE:Ls,TOPIC_AI_STREAM_ERROR:_r,TOPIC_AI_STREAM_STARTED:Is},Symbol.toStringTag,{value:"Module"}));class po{constructor(){this.decoder=new TextDecoder}*processLines(e){for(const t of e)t.trim()!==""&&(yield t)}}class Ru extends po{constructor(){super(...arguments),this.usage=null}async*parse(e){let t="";this.usage=null;try{for(;;){const{done:i,value:s}=await e.read();if(i)break;t+=this.decoder.decode(s,{stream:!0});const a=t.split(`
`);t=a.pop()||"";for(const l of this.processLines(a))if(l.startsWith("data: ")){const u=l.slice(6).trim();if(u==="[DONE]"){const h={type:"done",content:""};this.usage&&(h.metadata={usage:this.usage}),yield h;continue}try{const h=JSON.parse(u);if(h.error){yield{type:"error",content:h.error.message||"Unknown error",metadata:h.error};continue}this.extractUsage(h);const T=this.parseChunk(h);T&&(yield T)}catch{continue}}}if(t.trim()&&t.startsWith("data: ")){const i=t.slice(6).trim();if(i!=="[DONE]")try{const s=JSON.parse(i);this.extractUsage(s);const a=this.parseChunk(s);a&&(yield a)}catch{}}const r={type:"done",content:""};this.usage&&(r.metadata={usage:this.usage}),yield r}finally{e.releaseLock()}}extractUsage(e){if(e.usage){const t=e.usage;this.usage={promptTokens:t.prompt_tokens||0,completionTokens:t.completion_tokens||0,totalTokens:t.total_tokens||0,estimated:!1}}}parseChunk(e){const t=e.choices?.[0]?.delta,r=e.choices?.[0];if(t?.content)return{type:"token",content:t.content,message:{role:t.role||"assistant",content:r?.message?.content||t.content}};if(r?.message?.tool_calls){const i=this.parseToolCalls(r.message.tool_calls,!0);if(i.length>0)return{type:"token",content:"",toolCalls:i}}else if(t?.tool_calls||r?.delta?.tool_calls){const i=this.parseToolCalls(t?.tool_calls||r?.delta?.tool_calls||[],!1);if(i.length>0)return{type:"token",content:"",toolCalls:i}}return null}parseToolCalls(e,t=!1){return e.filter(r=>r.function!==void 0).map((r,i)=>({id:r.id||`call_${r.index!==void 0?r.index:i}_${Date.now()}`,type:"function",function:{name:r.function?.name||"",arguments:r.function?.arguments||(t?"{}":"")},_index:r.index!==void 0?r.index:i}))}}class Iu extends po{constructor(){super(...arguments),this.usage=null}async*parse(e){let t="";this.usage=null;try{for(;;){const{done:i,value:s}=await e.read();if(i)break;t+=this.decoder.decode(s,{stream:!0});const a=t.split(`
`);t=a.pop()||"";for(const l of this.processLines(a))try{const u=JSON.parse(l);if(u.error){yield{type:"error",content:u.error,metadata:u};continue}if(u.done){this.extractUsage(u);const h={type:"done",content:""};this.usage&&(h.metadata={usage:this.usage}),yield h;continue}u.message?.content?yield{type:"token",content:u.message.content,message:{role:u.message.role||"assistant",content:u.message.content}}:u.response&&(yield{type:"token",content:u.response,message:{role:"assistant",content:u.response}})}catch{continue}}if(t.trim())try{const i=JSON.parse(t);i.done&&this.extractUsage(i),i.message?.content&&(yield{type:"token",content:i.message.content,message:{role:i.message.role||"assistant",content:i.message.content}})}catch{}const r={type:"done",content:""};this.usage&&(r.metadata={usage:this.usage}),yield r}finally{e.releaseLock()}}extractUsage(e){if(e.prompt_eval_count!==void 0||e.eval_count!==void 0){const t=e.prompt_eval_count||0,r=e.eval_count||0;this.usage={promptTokens:t,completionTokens:r,totalTokens:t+r,estimated:!1}}}}class Ws{createParser(e,t){return e.includes("text/event-stream")||t.includes("openai")?new Ru:new Iu}async getAvailableModels(e){if(!e.chatApiEndpoint)return[];try{const t=e.chatApiEndpoint;let r=t;if(t.includes("/v1/chat/completions"))r=t.replace("/v1/chat/completions","");else if(t.includes("/api/v1/chat/completions"))r=t.replace("/api/v1/chat/completions","");else if(t.includes("/api/chat/completion"))r=t.replace("/api/chat/completion","");else try{const h=new URL(t);r=`${h.protocol}//${h.host}`}catch{return[]}const i=`${r}/v1/models`,s={"Content-Type":"application/json"};e.apiKey&&(s.Authorization=`Bearer ${e.apiKey}`);const a=await fetch(i,{method:"GET",headers:s});return a.ok?((await a.json()).data||[]).map(h=>({id:h.id,name:h.name||h.id})):[]}catch{return[]}}async*stream(e){const t={model:e.model,stream:!0,messages:e.messages,...e.chatConfig.parameters};e.tools&&e.tools.length>0&&(t.tools=e.tools,t.tool_choice="auto");const r=await fetch(e.chatConfig.chatApiEndpoint,{method:"POST",headers:{Authorization:`Bearer ${e.chatConfig.apiKey}`,"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(t),signal:e.signal});if(!r.ok){const u=await r.text().catch(()=>"Unknown error");yield{type:"error",content:`HTTP ${r.status}: ${u}`,metadata:{status:r.status,statusText:r.statusText}};return}const i=r.headers.get("content-type")||"",s=r.headers.get("content-length");if(!r.body){yield{type:"error",content:`Response body is null or empty (Content-Length: ${s||"unknown"}). This may indicate: 1) The endpoint doesn't support streaming, 2) Authentication is required/invalid, 3) The endpoint URL is incorrect. For Open WebUI, ensure you're using the correct endpoint and API key.`,metadata:{status:r.status,contentType:i,contentLength:s,endpoint:e.chatConfig.chatApiEndpoint,hasApiKey:!!e.chatConfig.apiKey}};return}const a=r.body.getReader();if(!a){yield{type:"error",content:"Response body is not readable"};return}const l=this.createParser(i,e.chatConfig.chatApiEndpoint);try{for await(const u of l.parse(a))yield u}catch(u){yield{type:"error",content:u instanceof Error?u.message:"Failed to parse response stream",metadata:{error:u,contentType:i,endpoint:e.chatConfig.chatApiEndpoint}}}}}class ho extends Ws{constructor(){super(...arguments),this.name="openai"}canHandle(e){return e.chatApiEndpoint.includes("openai")||e.chatApiEndpoint.includes("v1/chat/completions")}}class fo extends Ws{constructor(){super(...arguments),this.name="ollama"}canHandle(e){return e.name.toLowerCase()==="ollama"||e.chatApiEndpoint.includes("ollama")||e.chatApiEndpoint.includes("localhost:11434")}}class go{constructor(){this.providers=[],this.registerDefaultProviders()}registerDefaultProviders(){this.providers.push(new ho),this.providers.push(new fo)}registerProvider(e){this.providers.push(e)}getProvider(e){const t=this.providers.find(r=>r.canHandle(e));return t||this.providers[0]}getAllProviders(){return[...this.providers]}}class mo{getAgentContributions(){return Q.getContributions(zs)}filterAndSortAgents(e,t){return e.filter(r=>r.canHandle?r.canHandle(t):!0).sort((r,i)=>(i.priority||0)-(r.priority||0))}getMatchingAgents(e,t){const r=this.getAgentContributions();if(r.length===0)throw new Error("No agents are registered. The App Support agent should be available from the AI system extension.");let i=r.filter(s=>t&&!t.includes(s.role)?!1:s.canHandle?s.canHandle(e):!0);if(t&&t.length>0){if(i=i.sort((s,a)=>(a.priority||0)-(s.priority||0)),i.length===0){const s=t.join(", ");throw new Error(`No agents found for requested roles: ${s}. Available agents: ${r.map(a=>a.role).join(", ")}`)}}else if(i=this.filterAndSortAgents(i,e),i.length===0)throw new Error(`No agents can handle the current context. Available agents: ${r.map(s=>s.role).join(", ")}`);return i}}class Gs{sanitizeFunctionName(e){return e.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}commandToTool(e,t){const r={},i=[];return e.parameters?.forEach(l=>{const u=this.sanitizeFunctionName(l.name);r[u]={type:l.type||"string",description:l.description,...l.allowedValues&&{enum:l.allowedValues}},l.required===!0&&i.push(u)}),{type:"function",function:{name:this.sanitizeFunctionName(e.id),description:e.description||e.name,parameters:{type:"object",properties:r,required:i}}}}getAvailableTools(e,t){const r=we.listCommands();let i=Object.values(r);return t&&(i=i.filter(s=>t(s,e))),i.map(s=>this.commandToTool(s,e))}}const mn=It("ToolDetector");class Pu{constructor(){this.classifier=null,this.loading=!1,this.loadPromise=null}async ensureLoaded(){if(!this.classifier)return this.loading&&this.loadPromise?this.loadPromise:(this.loading=!0,this.loadPromise=(async()=>{try{mn.info("Loading ML model for tool detection..."),this.classifier=await Ou.getPipeline(lo.ZERO_SHOT_CLASSIFICATION,oo.ZERO_SHOT_CLASSIFICATION,{quantized:!0}),mn.info("ML model loaded successfully - will use for tool detection")}catch(e){const t=e instanceof Error?e.message:String(e);mn.warn(`Failed to load ML model, will use keyword-based detection fallback: ${t}`),this.classifier=null}finally{this.loading=!1}})(),this.loadPromise)}async needsTools(e){if(!e||e.trim().length===0)return!1;const t=e.toLowerCase().trim();if(["hello","hi","hey","thanks","thank you","bye","goodbye"].some(s=>t===s||t.startsWith(s+" ")))return!1;try{if(await this.ensureLoaded(),this.classifier){mn.info(`Using ML model to classify prompt: "${t.substring(0,50)}${t.length>50?"...":""}"`);const s=await this.classifier(t,["requires executing commands or actions","is a simple greeting or question"]),a=s.labels[0]==="requires executing commands or actions"&&s.scores[0]>.6;return mn.info(`ML classification result: ${s.labels[0]} (confidence: ${(s.scores[0]*100).toFixed(1)}%) - needsTools: ${a}`),a}}catch(s){const a=s instanceof Error?s.message:String(s);mn.warn(`ML classification failed, using keyword fallback: ${a}`)}mn.info("Using keyword-based detection (ML model not available)");const i=this.keywordBasedDetection(t);return mn.info(`Keyword detection result: needsTools=${i}`),i}keywordBasedDetection(e){const t=["create","open","delete","read","write","edit","save","rename","move","copy","list","show","display","run","execute","build","add","remove","update","modify","change","set","get","find","search","filter","sort","install","uninstall","load","import","export","generate","make","do","perform","call","invoke"],r=["file","folder","directory","workspace","editor","map","layer","command","tool","extension","script","code","project"],i=t.some(a=>e.includes(a)),s=r.some(a=>e.includes(a));return i&&(s||e.length>20)}dispose(){this.classifier=null,this.loading=!1,this.loadPromise=null}}const Lu=new Pu;class yo{constructor(){this.toolRegistry=new Gs,this.enhancers=[]}addEnhancer(e){this.enhancers.push(e)}async getSysPrompt(e,t){let r=e.sysPrompt;if(typeof r=="function"&&(r=r()),!r||typeof r!="string")throw new Error(`Agent "${e.role}" (${e.label}) is missing a system prompt. All agents must provide a sysPrompt.`);const i=[...e.promptEnhancers||[],...this.enhancers,...this.getContributedEnhancers()].sort((a,l)=>(l.priority||0)-(a.priority||0));let s=r;for(const a of i)try{s=await a.enhance(s,t),(!s||typeof s!="string")&&(s=r)}catch(l){console.warn("[PromptBuilder] Enhancer failed:",l)}return s}rewriteChatHistoryForAgent(e,t){return e.map(r=>r.role==="user"?{role:r.role,content:r.content}:r.role===t?{role:"assistant",content:r.content}:{role:"user",content:`***Agent '${r.role}' replied:***
${r.content}`})}getContributedEnhancers(){return Q.getContributions(qr).map(t=>({...t.enhancer,priority:t.priority??t.enhancer.priority}))}async build(e,t,r,i){i?.beforeSend&&await i.beforeSend(t,r);const s=this.sanitizeMessagesForAPI(t),a=this.rewriteChatHistoryForAgent(s,e.role);let l=e.tools;typeof l=="function"&&(l=await l());let u;if(l?.enabled)if(l.smartToolDetection){const v=t[t.length-1]?.content||"";await Lu.needsTools(v)&&(u=this.toolRegistry.getAvailableTools(r,l.commandFilter))}else u=this.toolRegistry.getAvailableTools(r,l.commandFilter);const h=await this.getSysPrompt(e,r);a.unshift({role:"system",content:h});const T=a.length-1;return{messages:a,userPromptIndex:T,tools:u}}sanitizeMessageForAPI(e){const t={role:e.role,content:e.content};return"tool_call_id"in e&&e.tool_call_id&&(t.tool_call_id=e.tool_call_id),"tool_calls"in e&&e.tool_calls&&(t.tool_calls=e.tool_calls),t}sanitizeMessagesForAPI(e){return e.map(t=>this.sanitizeMessageForAPI(t))}}class wo{constructor(){this.processors=[]}addProcessor(e){this.processors.push(e)}getSortedProcessors(){return[...this.processors].sort((e,t)=>(t.priority||0)-(e.priority||0))}async process(e,t,r){let i={...e};const s=[...t.messageProcessors||[],...this.processors].sort((l,u)=>(u.priority||0)-(l.priority||0));for(const l of s)i=await l.process(i,r);const a=i.actions?.some(l=>l.requiresAttention)||i.attentionRequests?.some(l=>l.requiresAction)||!1;return{...i,requiresAttention:a}}checkRequiresAttention(e){return e.actions?.some(t=>t.requiresAttention)||e.attentionRequests?.some(t=>t.requiresAction)||!1}}class bo{constructor(){this.accumulatedToolCalls=new Map,this.toolCallIndexMap=new Map}processChunk(e){if(e.type==="token"&&e.toolCalls&&e.toolCalls.length>0)for(const t of e.toolCalls){const r=t._index,i=t.id;let s,a;if(r!==void 0&&this.toolCallIndexMap.has(r)?(a=this.toolCallIndexMap.get(r),s=this.accumulatedToolCalls.get(a)):i&&this.accumulatedToolCalls.has(i)?(a=i,s=this.accumulatedToolCalls.get(a)):(a=i||`call_${r!==void 0?r:Date.now()}_${Math.random()}`,s=void 0),s){const l=s.function.arguments||"",u=t.function.arguments||"",h=l+u;this.accumulatedToolCalls.set(a,{id:a,type:t.type||s.type,function:{name:t.function.name||s.function.name,arguments:h}}),r!==void 0&&!this.toolCallIndexMap.has(r)&&this.toolCallIndexMap.set(r,a)}else this.accumulatedToolCalls.set(a,{...t,id:a}),r!==void 0&&this.toolCallIndexMap.set(r,a)}}getFinalToolCalls(){return Array.from(this.accumulatedToolCalls.values()).filter(e=>e.function.name&&e.function.name.trim().length>0).map(e=>{let t=e.function.arguments||"";return(!t||t.trim()==="")&&(t="{}"),{...e,function:{...e.function,arguments:t}}})}reset(){this.accumulatedToolCalls.clear(),this.toolCallIndexMap.clear()}}class qs{sanitizeFunctionName(e){return e.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}findCommand(e,t){const r=e.function.name,i=we.getCommand(r);if(i)return i;const s=we.listCommands();for(const[a,l]of Object.entries(s))if(this.sanitizeFunctionName(a)===r)return l;return null}parseArguments(e){if(!e||e.trim()===""||e==="{}")return{};try{const t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(t){const r=t instanceof Error?t.message:String(t);return console.error(`[ToolExecutor] Failed to parse arguments: ${e} - ${r}`),{}}}sanitizeArguments(e,t){if(!t||!t.parameters||!e||typeof e!="object")return e||{};const r={};return t.parameters.forEach(i=>{const s=this.sanitizeFunctionName(i.name);s in e&&(r[i.name]=e[s])}),r}async executeToolCall(e,t){try{const r=this.findCommand(e,t),i=r?.id||e.function.name,s=e.function.arguments||"{}",a=this.parseArguments(s),l=this.sanitizeArguments(a,r),u=we.createExecutionContext(l),h={...t,...u,params:l};let T=await we.execute(i,h);const v={success:!0,message:`Command "${r?.name||i}" executed successfully`,command:i};if(l&&typeof l=="object"&&Object.keys(l).length>0&&(v.parameters=l),T){let k=T;if(k instanceof Promise&&(k=await k),v.result=k,r?.output&&r.output.length>0){const _=r.output.map(q=>`${q.name}: ${q.description||q.type||"value"}`).join(", ");v.output=_}}return{id:e.id,result:v}}catch(r){const i=r instanceof Error?r.message:String(r);let s=null;try{s=this.findCommand(e,t)}catch{s=null}const a=s?.name||e.function.name;let l=i;return i.includes("No handler found")||i.includes("No handlers registered")?l=`Command "${a}" cannot be executed. ${i}. This usually means the command is not available in the current context (e.g., a map editor may not be open or active).`:(i.includes("not available")||i.includes("GsMapEditor"))&&(l=`Command "${a}" cannot be executed: ${i}. Please ensure the required editor or component is open and active.`),{id:e.id,result:null,error:l}}}async executeToolCalls(e,t){const r=[];for(const i of e){const s=await this.executeToolCall(i,t);r.push(s)}return r}createToolCallAccumulator(){return new bo}createToolCallSignature(e){const t=e.function.arguments||"{}";let r={};try{const s=JSON.parse(t);r=s&&typeof s=="object"?s:{}}catch{r={}}const i=r&&typeof r=="object"?Object.keys(r).sort().reduce((s,a)=>(s[a]=r[a],s),{}):{};return`${e.function.name}:${JSON.stringify(i)}`}}const Mu=Object.freeze(Object.defineProperty({__proto__:null,ToolExecutor:qs},Symbol.toStringTag,{value:"Module"}));class vo{async execute(e,t,r,i){const s=t.chatConfig;if(!s)throw new Error("Chat config is required");const a=e.map(async l=>{try{await i(l,t.chatContext.history,r.sharedState,s,t,r)}catch(u){const h=u instanceof Error?u:new Error(String(u));r.errors.set(l.role,h),t.onAgentError?.(l.role,h)}});await Promise.all(a)}}class Eo{async execute(e,t,r,i){const s=t.chatConfig;if(!s)throw new Error("Chat config is required");let a=[...t.chatContext.history],l={...r.sharedState};for(const u of e)try{const h=this.createAgentContextWithPreviousAgents(l,t,r),T=await i(u,a,l,s,t,r);if(!T)break;const E=this.updateWorkflowState(T,a,l,h,r);a=E.currentMessages,l=E.accumulatedState}catch(h){const T=h instanceof Error?h:new Error(String(h));r.errors.set(u.role,T),t.onAgentError?.(u.role,T);break}}createAgentContextWithPreviousAgents(e,t,r){return{...e,...t.callContext.getProxy(),previousAgents:Array.from(r.messages.entries()).map(([i,s])=>({role:i,content:s.content}))}}updateWorkflowState(e,t,r,i,s){return t.push(e),r={...r,...i,message:e},s.sharedState=r,{currentMessages:t,accumulatedState:r}}}class ko{async execute(e,t,r,i){const s=t.chatConfig;if(!s)throw new Error("Chat config is required");let a=[...t.chatContext.history],l={...r.sharedState};for(const u of e)try{const h=this.createAgentContextWithPreviousAgents(l,t,r);if(u.canHandle&&!u.canHandle(h))continue;const T=await i(u,a,l,s,t,r);if(!T)break;const E=this.updateWorkflowState(T,a,l,h,r);a=E.currentMessages,l=E.accumulatedState}catch(h){const T=h instanceof Error?h:new Error(String(h));r.errors.set(u.role,T),t.onAgentError?.(u.role,T)}}createAgentContextWithPreviousAgents(e,t,r){return{...e,...t.callContext.getProxy(),previousAgents:Array.from(r.messages.entries()).map(([i,s])=>({role:i,content:s.content}))}}updateWorkflowState(e,t,r,i,s){return t.push(e),r={...r,...i,message:e},s.sharedState=r,{currentMessages:t,accumulatedState:r}}}class Co{constructor(){this.strategies=new Map([["parallel",new vo],["sequential",new Eo],["conditional",new ko]])}registerStrategy(e,t){this.strategies.set(e,t)}async execute(e,t,r){const i=`workflow-${Date.now()}-${Math.random()}`,s=t.execution||"parallel",a=t.sharedState||{},l={messages:new Map,sharedState:{...a},errors:new Map};Oe(Ms,{workflowId:i,options:t});try{const u=this.strategies.get(s);if(!u)throw new Error(`Unknown workflow execution strategy: ${s}`);return await u.execute(e,t,l,r),Oe(Ns,{workflowId:i,results:l}),l}catch(u){const h=u instanceof Error?u:new Error(String(u));throw Oe(Us,{workflowId:i,error:h}),h}}}const Ii=class{static estimateTokens(e){if(!e||e.trim().length===0)return 0;const t=e.trim(),r=t.length,i=t.split(/\s+/).filter(a=>a.length>0).length,s=Math.ceil(r/this.AVERAGE_CHARS_PER_TOKEN+i*.3);return Math.max(1,s)}static estimateMessageTokens(e){let t=this.MESSAGE_OVERHEAD;if(e.content&&(t+=this.estimateTokens(e.content)),e.role&&(t+=this.estimateTokens(e.role)),e.tool_calls)for(const r of e.tool_calls)t+=this.estimateTokens(r.function.name||""),t+=this.estimateTokens(r.function.arguments||"{}"),t+=10;return e.tool_call_id&&(t+=this.estimateTokens(e.tool_call_id)),t}static estimatePromptTokens(e,t){let r=0;for(const i of e)r+=this.estimateMessageTokens(i);if(t&&t.length>0){for(const i of t)if(r+=this.TOOL_DEFINITION_OVERHEAD,r+=this.estimateTokens(i.function.name||""),r+=this.estimateTokens(i.function.description||""),i.function.parameters){const s=JSON.stringify(i.function.parameters);r+=this.estimateTokens(s)}}return r}static estimateCompletionTokens(e,t){let r=this.estimateTokens(e);if(t&&t.length>0)for(const i of t)r+=10,r+=this.estimateTokens(i.function?.name||""),r+=this.estimateTokens(i.function?.arguments||"{}");return r}};Ii.AVERAGE_CHARS_PER_TOKEN=4;Ii.TOOL_DEFINITION_OVERHEAD=50;Ii.MESSAGE_OVERHEAD=4;let da=Ii;const pa="ai_token_usage";class Nu{constructor(){this.data=null,this.loadPromise=null}async loadData(){return this.data?this.data:this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{const e=await Rt.getObject(pa);return e?this.data=e:(this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()),this.loadPromise=null,this.data})(),this.loadPromise)}async saveData(){this.data&&(this.data.lastUpdated=Date.now(),await Rt.persistObject(pa,this.data))}async recordUsage(e,t){if(await this.loadData(),!this.data)return;this.data.providers[e]||(this.data.providers[e]={promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0});const r=this.data.providers[e];r.promptTokens+=t.promptTokens,r.completionTokens+=t.completionTokens,r.totalTokens+=t.totalTokens,r.requestCount+=1,this.data.total.promptTokens+=t.promptTokens,this.data.total.completionTokens+=t.completionTokens,this.data.total.totalTokens+=t.totalTokens,this.data.total.requestCount+=1,await this.saveData()}async getProviderUsage(e){return await this.loadData(),this.data?.providers[e]||null}async getAllProviderUsage(){return await this.loadData(),this.data?.providers||{}}async getTotalUsage(){return await this.loadData(),this.data?.total||{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0}}async reset(){this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()}async resetProvider(e){if(await this.loadData(),!this.data)return;const t=this.data.providers[e];t&&(this.data.total.promptTokens-=t.promptTokens,this.data.total.completionTokens-=t.completionTokens,this.data.total.totalTokens-=t.totalTokens,this.data.total.requestCount-=t.requestCount,delete this.data.providers[e],await this.saveData())}}const xo=new Nu;class Uu{constructor(){this.activeRequests=new Map,this.providerFactory=new go,this.agentRegistry=new mo,this.promptBuilder=new yo,this.messageProcessor=new wo,this.toolExecutor=new qs,this.workflowEngine=new Co,this.toolRegistry=new Gs,Ke(ln,()=>{this.aiConfig=void 0,this.configCheckPromise=void 0,this.checkAIConfig().then()}),this.checkAIConfig().then()}getAgentContributions(){return this.agentRegistry.getAgentContributions()}async getProviders(){return await this.checkAIConfig(),this.aiConfig?.providers||[]}async getDefaultProvider(){await this.checkAIConfig();const e=await this.getProviders();if(this.aiConfig?.defaultProvider){const t=e.find(r=>r.name===this.aiConfig?.defaultProvider);if(t)return t}return e[0]}async setDefaultProvider(e){return await this.checkAIConfig(),this.aiConfig&&(this.aiConfig.defaultProvider=e,await Ue.set(yn,this.aiConfig)),this.getDefaultProvider()}createMessage(e){return{role:"user",content:e}}registerStreamingFetcher(e){this.providerFactory.registerProvider(e)}getContributedProviders(){return Q.getContributions(tt).map(t=>t.provider)}mergeProviders(e,t){const r=new Set(e.map(s=>s.name)),i=t.filter(s=>!r.has(s.name));return i.length>0?[...e,...i]:e}async createInitialConfig(){const e=this.getContributedProviders(),t={...Fs,providers:e};return await Ue.set(yn,t),await Ue.get(yn)}async updateConfigWithMissingProviders(e){const t=this.getContributedProviders(),r=this.mergeProviders(e.providers,t);if(r.length!==e.providers.length){const i={...e,providers:r};return await Ue.set(yn,i),i}return e}async checkAIConfig(){if(!this.aiConfig)return this.configCheckPromise?this.configCheckPromise:(this.configCheckPromise=this.performConfigCheck(),this.configCheckPromise)}async performConfigCheck(){try{this.aiConfig=await Ue.get(yn),this.aiConfig?this.aiConfig=await this.updateConfigWithMissingProviders(this.aiConfig):this.aiConfig=await this.createInitialConfig(),Oe(Ri,this.aiConfig)}finally{this.configCheckPromise=void 0}}createAgentContext(e,t,r={}){return{...e,...t.getProxy(),...r}}createFinalMessage(e,t){return{role:e.role,content:t.content,actions:t.actions,requiresAttention:t.requiresAttention,attentionRequests:t.attentionRequests,canContinue:t.canContinue}}async handleUserAttention(e,t,r,i){if(!t.requiresAttention||!r.userAttentionHandler)return!0;const s=[];if(t.attentionRequests&&s.push(...t.attentionRequests),t.actions)for(const u of t.actions)u.requiresAttention&&u.attentionRequest&&s.push(u.attentionRequest);if(s.length===0)return!0;if(i.pendingAttention||(i.pendingAttention=new Map),i.pendingAttention.set(e,s),r.onAttentionRequest)for(const u of s)r.onAttentionRequest(e,u);if(r.pauseOnAttention)return i.paused=!0,i.continuationToken=`${e}-${Date.now()}-${Math.random()}`,!1;const a=r.userAttentionHandler,l=this.createAgentContext(r.sharedState||{},r.callContext,{message:t});for(const u of s)if(a.onAttentionRequest){const h=await a.onAttentionRequest(u,l);if(u.requiresAction&&(h===!1||h===null))return!1;h&&typeof h=="string"&&(l[`attention_${u.type}_result`]=h)}else switch(u.type){case"confirmation":if(a.onConfirmation&&!await a.onConfirmation(u.message,l)&&u.requiresAction)return!1;break;case"input":if(a.onInput){const h=await a.onInput(u.message,void 0,l);if(!h&&u.requiresAction)return!1;h&&(l.attention_input_result=h)}break}return!0}async*streamCompletion(e){const t=`${Date.now()}-${Math.random()}`,r=new AbortController;this.activeRequests.set(t,r),e.signal&&e.signal.addEventListener("abort",()=>{r.abort()});const i=e.signal||r.signal;try{e.onStatus?.("starting"),Oe(Is,{requestId:t,options:e});const s=e.chatConfig||await this.getDefaultProvider(),a=this.sanitizeMessagesForAPI(e.chatContext.history),l=this.providerFactory.getProvider(s),u=this.toolExecutor.createToolCallAccumulator();let h="",T={role:"assistant",content:""},E;for await(const _ of l.stream({model:s.model,messages:a,chatConfig:s,tools:e.tools,signal:i})){if(_.type==="error"){e.onStatus?.("error"),Oe(_r,{requestId:t,chunk:_}),yield _;break}if(_.type==="token")u.processChunk(_),(!_.toolCalls||_.toolCalls.length===0)&&(h+=_.content,T.content=h),_.message?.role&&(T.role=_.message.role),_.content&&e.onToken?.(_.content),e.onStatus?.("streaming"),e.onProgress?.({received:h.length}),Oe(Ps,{requestId:t,chunk:_}),yield _;else if(_.type==="done"){_.metadata?.usage&&(E=_.metadata.usage),e.onStatus?.("complete"),Oe(Ls,{requestId:t}),yield _;break}else yield _}const v=u.getFinalToolCalls(),k={role:T.role||"assistant",content:h||"",...v.length>0&&{toolCalls:v}};if(!E){const _=da.estimatePromptTokens(a,e.tools),q=da.estimateCompletionTokens(h,v);E={promptTokens:_,completionTokens:q,totalTokens:_+q,estimated:!0}}return xo.recordUsage(s.name,E).catch(_=>{ve.error(`Failed to record token usage: ${_ instanceof Error?_.message:String(_)}`)}),{message:k,tokenUsage:E}}catch(s){if(s instanceof Error&&s.name==="AbortError")throw e.onStatus?.("error"),Oe(_r,{requestId:t,error:"Request cancelled"}),s;e.onStatus?.("error");const a=s instanceof Error?s.message:String(s);throw Oe(_r,{requestId:t,error:a}),yield{type:"error",content:a,metadata:{error:s}},s}finally{this.activeRequests.delete(t)}}async handleStreamingPromptDirect(e){const t=this.streamCompletion(e);let r;for(;;){if(r=await t.next(),r.done)return r.value.message;const i=r.value;if(i.type==="error")throw new Error(i.content);if(i.type==="done"){const s=await t.next();if(s.done&&s.value)return s.value.message;if(!s.done)continue;throw new Error("Stream completed without return value")}}}sanitizeMessageForAPI(e){const t={role:e.role,content:e.content};return"tool_call_id"in e&&e.tool_call_id&&(t.tool_call_id=e.tool_call_id),"tool_calls"in e&&e.tool_calls&&(t.tool_calls=e.tool_calls),t}sanitizeMessagesForAPI(e){return e.map(t=>this.sanitizeMessageForAPI(t))}async handleStreamingPrompt(e){const t=e.callContext||ut.createChild({}),r=this.createAgentContext({},t,{userPrompt:e.chatContext.history[e.chatContext.history.length-1]?.content||""}),i=this.agentRegistry.getMatchingAgents(r),s=i.length>0?i.map(u=>u.role):["assistant"],a=await this.executeAgentWorkflow({chatContext:e.chatContext,chatConfig:e.chatConfig,callContext:t,execution:"parallel",stream:e.stream,signal:e.signal,onToken:(u,h)=>{e.onToken?.(h)},onStatus:(u,h)=>{e.onStatus?.(h)},roles:s}),l=Array.from(a.messages.values());return l.length===1?l[0]:l}async continueWorkflow(e,t,r){const i={sharedState:{...r.sharedState,...Object.fromEntries(t)}},s={...r,sharedState:i.sharedState,pauseOnAttention:!1};return this.executeAgentWorkflow(s)}cancelRequest(e){const t=this.activeRequests.get(e);return t?(t.abort(),this.activeRequests.delete(e),!0):!1}async executeAgentWorkflow(e){const t=this.createAgentContext(e.sharedState||{},e.callContext),r=this.agentRegistry.getMatchingAgents(t,e.roles);return this.workflowEngine.execute(r,e,async(i,s,a,l,u,h)=>this.executeAgent(i,s,a,l,u,h))}async executeAgent(e,t,r,i,s,a){s.onAgentStart?.(e.role);const l=this.createAgentContext(r,s.callContext,{userPrompt:t[t.length-1]?.content||""}),{messages:u,tools:h}=await this.promptBuilder.build(e,t,l,e.hooks),T=u.map(Y=>{const G={role:Y.role,content:Y.content};return Y.tool_call_id&&(G.tool_call_id=Y.tool_call_id),Y.tool_calls&&(G.tool_calls=Y.tool_calls),G});let E=await this.handleStreamingPromptDirect({chatContext:{history:T},chatConfig:i,callContext:s.callContext,stream:s.stream??!0,signal:s.signal,tools:h}),v=0;const k=[...u];for(;E.toolCalls&&E.toolCalls.length>0;){if(v++,v>yi){console.warn(`[AIService] Maximum tool call iterations (${yi}) reached`);break}let Y=[];if(s.requireToolApproval&&s.onToolApprovalRequest){const L=E.toolCalls.map(pe=>{const ne=pe.function.arguments||"{}";let R={};try{R=JSON.parse(ne)}catch{R={}}return`${pe.function.name}(${Object.entries(R).map(([X,oe])=>`${X}=${oe}`).join(", ")})`}).join(", "),j={toolCalls:E.toolCalls,message:`The AI wants to execute: ${L}`};await s.onToolApprovalRequest(e.role,j)?Y=await this.toolExecutor.executeToolCalls(E.toolCalls,l):Y=E.toolCalls.map(pe=>({id:pe.id,result:{success:!1,message:"Tool execution cancelled by user",cancelled:!0}}))}else Y=await this.toolExecutor.executeToolCalls(E.toolCalls,l);const G=Y.map(L=>({role:"tool",content:L.error?JSON.stringify({error:L.error}):JSON.stringify(L.result),tool_call_id:L.id})),O={role:"assistant",content:E.content||""};E.toolCalls&&E.toolCalls.length>0&&(O.tool_calls=E.toolCalls.filter(L=>L.function.name&&L.function.name.trim().length>0).map(L=>({id:L.id,type:L.type,function:{name:L.function.name,arguments:L.function.arguments||"{}"}}))),k.push(O,...G);const U=k;E=await this.handleStreamingPromptDirect({chatContext:{history:U.map(L=>({role:L.role,content:L.content,...L.tool_call_id&&{tool_call_id:L.tool_call_id},...L.tool_calls&&{tool_calls:L.tool_calls}}))},chatConfig:i,callContext:s.callContext,stream:s.stream??!0,signal:s.signal,tools:h});const P=E.content&&E.content.trim().length>0,x=E.toolCalls&&E.toolCalls.length>0;if(P&&!x)break;if(P&&x){console.warn("[AIService] Model provided content but also called tools - treating as completion");break}}const _=await this.messageProcessor.process(E,e,this.createAgentContext(r,s.callContext,{message:E}));e.hooks?.afterReceive&&await e.hooks.afterReceive(_,this.createAgentContext(r,s.callContext));const q=this.createFinalMessage(e,_);return!await this.handleUserAttention(e.role,q,s,a)&&s.pauseOnAttention?null:(a.messages.set(e.role,q),s.onAgentComplete?.(e.role,q),q)}}const zu=new Uu,ch=Object.freeze(Object.defineProperty({__proto__:null,A:mo,B:Ws,C:zs,K:yn,M:wo,O:ho,P:yo,S:Eo,T:Is,W:Co,a:zu,b:Ps,c:Ls,d:_r,e:Ri,f:Ms,g:Ns,h:Us,i:tt,j:qr,k:Fs,l:yi,m:uo,n:fo,o:go,p:qs,q:bo,r:Gs,s:vo,t:ko,u:xo,v:Du,w:Mu},Symbol.toStringTag,{value:"Module"})),Fu="@kispace-io/appspace",Wu="1.2.4",Gu={catalogUrls:["https://raw.githubusercontent.com/kispace-io/appspace-marketplace/main/catalogs/extensions.json","https://raw.githubusercontent.com/kispace-io/appspace-marketplace/main/catalogs/apps.json"]},qu={"@awesome.me/webawesome":"^3.0.0","@fortawesome/fontawesome-free":"^7.1.0","@fortawesome/fontawesome-svg-core":"^7.1.0","@fortawesome/free-solid-svg-icons":"^7.1.0","@langchain/textsplitters":"^1.0.0","@lit-labs/signals":"^0.1.3","@mlc-ai/web-llm":"^0.2.79","@xenova/transformers":"^2.17.2","@xterm/xterm":"^5.5.0",axios:"^1.13.1",dotenv:"^17.2.3","idb-keyval":"^6.2.2",jsonata:"^2.1.0",jszip:"^3.10.1",lit:"^3.2.1",marked:"^12.0.0 || ^16.4.1","monaco-editor":"0.55.1","pace-js":"^1.2.4","pdfjs-dist":"^4.0.0","pip-requirements-js":"^1.0.2",pyodide:"^0.27.7",rxdb:"^15.0.0",uuid:"^13.0.0","wasm-git":"^0.0.13"},ju={typescript:"^5.9.3",vite:"^7.1.12","vite-plugin-dts":"^4.5.4"},kr={name:Fu,version:Wu,marketplace:Gu,dependencies:qu,devDependencies:ju},dn="system.language_bundles",is="language";function Bu(n,e){return e?n.replace(/\{(\w+)\}/g,(t,r)=>e[r]!==void 0?e[r]:t):n}class Vu extends String{constructor(e,t,r,i){super(""),this.i18nService=e,this.namespace=t,this.key=r,this.params=i}toString(){const e=this.i18nService.currentLanguageSignal.get();return this.cachedValue!==void 0&&this.cachedLanguage===e?this.cachedValue:(this.cachedValue=this.i18nService.translate(this.namespace,this.key,this.params),this.cachedLanguage=e,this.cachedValue)}valueOf(){return this.toString()}[Symbol.toPrimitive](e){if(e==="number"){const t=Number(this.toString());return isNaN(t)?0:t}return this.toString()}toJSON(){return this.toString()}}const Ao=class Cr{constructor(){this.translationCache=new Map,this.currentLanguageSignal=cn(this.getBrowserLanguage()),this.languageContributionsSignal=cn([]),this.initialize()}getBrowserLanguage(){return(navigator.language||navigator.languages?.[0]||Cr.DEFAULT_LANGUAGE).split("-")[0].toLowerCase()}async initializeLanguage(){return await Ue.get(is)||this.getBrowserLanguage()}async updateLanguageFromSettings(){const e=await this.initializeLanguage();this.currentLanguageSignal.set(e)}getPrimaryLanguage(e){return e.split("-")[0].toLowerCase()}updateLanguageContributions(){const e=Q.getContributions(dn);this.languageContributionsSignal.set(e)}createCacheKey(e,t){return`${e}:${t}`}mergeTranslationsForLanguage(e,t,r){const i=this.createCacheKey(t,r),s=this.translationCache.get(i);if(s!==void 0)return s;const a={};for(const l of e){if(l.namespace!==t)continue;let u;l.translations&&l.language===r?u=l.translations:l[r]&&typeof l[r]=="object"&&(u=l[r]),u&&Object.assign(a,u)}return this.translationCache.set(i,a),a}invalidateTranslationCache(){this.translationCache.clear()}translate(e,t,r){const i=this.currentLanguageSignal.get(),s=this.getPrimaryLanguage(i),a=this.languageContributionsSignal.get();let l;const u=this.mergeTranslationsForLanguage(a,e,i);if(u[t])l=u[t];else{const h=i!==s?this.mergeTranslationsForLanguage(a,e,s):u;if(h[t])l=h[t];else if(s!==Cr.DEFAULT_LANGUAGE&&i!==Cr.DEFAULT_LANGUAGE){const T=this.mergeTranslationsForLanguage(a,e,Cr.DEFAULT_LANGUAGE);T[t]&&(l=T[t])}}return l?Bu(l,r):t}initialize(){Ke(ln,async e=>{const t=e?.[is]||this.getBrowserLanguage();this.currentLanguageSignal.set(t),this.invalidateTranslationCache()}),Ke(Ht,e=>{e.target===dn&&(this.invalidateTranslationCache(),this.updateLanguageContributions())}),this.updateLanguageFromSettings(),this.updateLanguageContributions()}i18n(e){return(t,r)=>this.translate(e,t,r)}i18nLazy(e){return(t,r)=>new Vu(this,e,t,r)}};Ao.DEFAULT_LANGUAGE="en";let Hu=Ao;const jr=new Hu;ut.put("i18nService",jr);const So=jr.currentLanguageSignal,Xu=jr.languageContributionsSignal,Nn=n=>jr.i18n(n),Ku=n=>jr.i18nLazy(n),Yu="filebrowser",Zu={CONNECT_WORKSPACE:"Connect Workspace...",RELOAD_WORKSPACE:"Reload workspace folder",CREATE_NEW:"Create new...",RENAME_RESOURCE:"Rename selected resource",DELETE_RESOURCE:"Delete selected resource",OPEN:"Open",RENAME:"Rename",DELETE:"Delete",FILE:"File",FOLDER:"Folder",FILE_EXISTS_OVERWRITE:'File "{fileName}" already exists. Do you want to overwrite it?',SELECT_WORKSPACE:"Select a workspace.",DROP_FILES_HERE:"ðŸ“ Drop files here"},Ju={CONNECT_WORKSPACE:"Arbeitsbereich verbinden...",RELOAD_WORKSPACE:"Arbeitsbereich-Ordner neu laden",CREATE_NEW:"Neu erstellen...",RENAME_RESOURCE:"AusgewÃ¤hlte Ressource umbenennen",DELETE_RESOURCE:"AusgewÃ¤hlte Ressource lÃ¶schen",OPEN:"Ã–ffnen",RENAME:"Umbenennen",DELETE:"LÃ¶schen",FILE:"Datei",FOLDER:"Ordner",FILE_EXISTS_OVERWRITE:'Die Datei "{fileName}" existiert bereits. MÃ¶chten Sie sie Ã¼berschreiben?',SELECT_WORKSPACE:"WÃ¤hlen Sie einen Arbeitsbereich aus.",DROP_FILES_HERE:"ðŸ“ Dateien hier ablegen"},Qu={namespace:Yu,en:Zu,de:Ju},ed="extensions",td={FILTER_PLACEHOLDER:"Filter extensions...",INSTALLED:"Installed",AVAILABLE:"Available",NO_MATCHES:'No extensions match "{filterText}"',EXTERNAL_EXTENSION:"External Extension",UNINSTALL:"Uninstall (requires restart)",REQUIRED_HINT:"This extension is required by the current app and cannot be uninstalled",INSTALL:"Install",EXPERIMENTAL:"This is an experimental extension!",VERSION:"Version:",AUTHOR:"Author:",DEPENDENCIES:"Dependencies",NOT_INSTALLED:"Not Installed",DEPENDENCIES_HINT:"Dependencies are automatically installed when this extension is enabled.",DISABLE_TITLE:"Disable this extension",ENABLE_TITLE:"Enable this extension",EXT_GIT_NAME:"Git Support",EXT_GIT_DESC:"Git commands and UI elements",EXT_GITHUB_SERVICE_NAME:"GitHub Service",EXT_GITHUB_SERVICE_DESC:"GitHub API service for fetching release information",EXT_PYTERMINAL_NAME:"Python terminal",EXT_PYTERMINAL_DESC:"Python terminal view",EXT_LINUXTERMINAL_NAME:"Linux terminal",EXT_LINUXTERMINAL_DESC:"Linux terminal view",EXT_WEBLLM_NAME:"WebLLM",EXT_WEBLLM_DESC:"In-Browser LLM inference",EXT_P12SPLITTER_NAME:".p12 file splitter",EXT_P12SPLITTER_DESC:"Adds a command to split/separate a .p12 file into private/public and additional .pem files",EXT_PYTHONPACKAGEMANAGER_NAME:"Python Package Manager",EXT_PYTHONPACKAGEMANAGER_DESC:"Manage Python packages for notebooks and other Python-based extensions",EXT_NOTEBOOK_NAME:"Jupyter-like Notebook Editor",EXT_NOTEBOOK_DESC:"View and execute Jupyter-like notebooks (.ipynb) with Python code execution and markdown rendering",EXT_COMMANDPALETTE_NAME:"Command Palette",EXT_COMMANDPALETTE_DESC:"VS Code-style command palette at the top center for quick command execution (Ctrl+Shift+P)",EXT_DOWNLOAD_NAME:"Download Files",EXT_DOWNLOAD_DESC:"Download files from URLs to the workspace",EXT_UNZIP_NAME:"Unzip Archives",EXT_UNZIP_DESC:"Extract zip archives to the workspace",EXT_MDEDITOR_NAME:"Markdown Editor",EXT_MDEDITOR_DESC:"View and render Markdown (.md) files",EXT_MEDIAVIEWER_NAME:"Media Viewer",EXT_MEDIAVIEWER_DESC:"View PDF, image, and HTML files in the browser",EXT_MONACO_NAME:"Monaco Code Editor",EXT_MONACO_DESC:"Code editor with syntax highlighting, code completion, and Python execution support",EXT_MEMORYUSAGE_NAME:"Memory Usage Monitor",EXT_MEMORYUSAGE_DESC:"Displays JavaScript heap memory usage in the bottom toolbar",EXT_WEBDAV_NAME:"WebDAV Workspace",EXT_WEBDAV_DESC:"Connect to WebDAV servers (Nextcloud, ownCloud) as workspace folders for cloud storage integration",EXT_SETTINGS_TREE_NAME:"Settings Tree Editor",EXT_SETTINGS_TREE_DESC:"Tree-based editor for settings with in-place editing",EXT_IN_BROWSER_ML_NAME:"In-Browser ML",EXT_IN_BROWSER_ML_DESC:"In-browser machine learning service using transformers.js for specialized tasks (zero-shot classification, embeddings, etc.)",EXT_AI_SYSTEM_NAME:"AI System",EXT_AI_SYSTEM_DESC:"Modern AI service with streaming support and agent workflows",EXT_RAG_SYSTEM_NAME:"RAG System",EXT_RAG_SYSTEM_DESC:"Retrieval-Augmented Generation system for document indexing, search and retrieval",EXT_HOWTO_NAME:"HowTo System",EXT_HOWTO_DESC:"Step-by-step workflow system with pre and post condition checks"},nd={FILTER_PLACEHOLDER:"Erweiterungen filtern...",INSTALLED:"Installiert",AVAILABLE:"VerfÃ¼gbar",NO_MATCHES:'Keine Erweiterungen entsprechen "{filterText}"',EXTERNAL_EXTENSION:"Externe Erweiterung",UNINSTALL:"Deinstallieren (Neustart erforderlich)",REQUIRED_HINT:"Diese Erweiterung ist fÃ¼r die aktuelle App erforderlich und kann nicht deinstalliert werden",INSTALL:"Installieren",EXPERIMENTAL:"Dies ist eine experimentelle Erweiterung!",VERSION:"Version:",AUTHOR:"Autor:",DEPENDENCIES:"AbhÃ¤ngigkeiten",NOT_INSTALLED:"Nicht installiert",DEPENDENCIES_HINT:"AbhÃ¤ngigkeiten werden automatisch installiert, wenn diese Erweiterung aktiviert wird.",DISABLE_TITLE:"Diese Erweiterung deaktivieren",ENABLE_TITLE:"Diese Erweiterung aktivieren",EXT_GIT_NAME:"Git-UnterstÃ¼tzung",EXT_GIT_DESC:"Git-Befehle und UI-Elemente",EXT_GITHUB_SERVICE_NAME:"GitHub-Service",EXT_GITHUB_SERVICE_DESC:"GitHub-API-Service zum Abrufen von Release-Informationen",EXT_PYTERMINAL_NAME:"Python-Terminal",EXT_PYTERMINAL_DESC:"Python-Terminalansicht",EXT_LINUXTERMINAL_NAME:"Linux-Terminal",EXT_LINUXTERMINAL_DESC:"Linux-Terminalansicht",EXT_WEBLLM_NAME:"WebLLM",EXT_WEBLLM_DESC:"LLM-Inferenz im Browser",EXT_P12SPLITTER_NAME:".p12-Datei-Splitter",EXT_P12SPLITTER_DESC:"FÃ¼gt einen Befehl hinzu, um eine .p12-Datei in private/Ã¶ffentliche und zusÃ¤tzliche .pem-Dateien zu trennen",EXT_PYTHONPACKAGEMANAGER_NAME:"Python-Paket-Manager",EXT_PYTHONPACKAGEMANAGER_DESC:"Verwaltet Python-Pakete fÃ¼r Notebooks und andere Python-basierte Erweiterungen",EXT_NOTEBOOK_NAME:"Jupyter-Ã¤hnlicher Notebook-Editor",EXT_NOTEBOOK_DESC:"Anzeigen und AusfÃ¼hren von Jupyter-Ã¤hnlichen Notebooks (.ipynb) mit Python-CodeausfÃ¼hrung und Markdown-Rendering",EXT_COMMANDPALETTE_NAME:"Befehls-Palette",EXT_COMMANDPALETTE_DESC:"VS Code-Ã¤hnliche Befehls-Palette oben in der Mitte fÃ¼r schnelle BefehlsausfÃ¼hrung (Strg+Umschalt+P)",EXT_DOWNLOAD_NAME:"Dateien herunterladen",EXT_DOWNLOAD_DESC:"Dateien von URLs in den Arbeitsbereich herunterladen",EXT_UNZIP_NAME:"Archive entpacken",EXT_UNZIP_DESC:"Zip-Archive in den Arbeitsbereich extrahieren",EXT_MDEDITOR_NAME:"Markdown-Editor",EXT_MDEDITOR_DESC:"Anzeigen und Rendern von Markdown (.md) Dateien",EXT_MEDIAVIEWER_NAME:"Medien-Viewer",EXT_MEDIAVIEWER_DESC:"PDF-, Bild- und HTML-Dateien im Browser anzeigen",EXT_MONACO_NAME:"Monaco-Code-Editor",EXT_MONACO_DESC:"Code-Editor mit Syntaxhervorhebung, Code-VervollstÃ¤ndigung und Python-AusfÃ¼hrungsunterstÃ¼tzung",EXT_MEMORYUSAGE_NAME:"Speicherverbrauch-Monitor",EXT_MEMORYUSAGE_DESC:"Zeigt die JavaScript-Heap-Speichernutzung in der unteren Symbolleiste an",EXT_WEBDAV_NAME:"WebDAV-Arbeitsbereich",EXT_WEBDAV_DESC:"Verbinden Sie sich mit WebDAV-Servern (Nextcloud, ownCloud) als Arbeitsbereichsordner fÃ¼r Cloud-Speicher-Integration",EXT_SETTINGS_TREE_NAME:"Einstellungs-Baum-Editor",EXT_SETTINGS_TREE_DESC:"Baumbasierter Editor fÃ¼r Einstellungen mit direkter Bearbeitung",EXT_IN_BROWSER_ML_NAME:"ML im Browser",EXT_IN_BROWSER_ML_DESC:"Maschinelles Lernen im Browser mit transformers.js fÃ¼r spezialisierte Aufgaben (Zero-Shot-Klassifizierung, Embeddings usw.)",EXT_AI_SYSTEM_NAME:"KI-System",EXT_AI_SYSTEM_DESC:"Modernes KI-Service mit Streaming-UnterstÃ¼tzung und Agent-Workflows",EXT_RAG_SYSTEM_NAME:"RAG-System",EXT_RAG_SYSTEM_DESC:"Retrieval-Augmented Generation System fÃ¼r Dokumentenindizierung, Suche und Abruf",EXT_HOWTO_NAME:"HowTo-System",EXT_HOWTO_DESC:"Schritt-fÃ¼r-Schritt-Workflow-System mit Vor- und NachbedingungsprÃ¼fungen"},rd={namespace:ed,en:td,de:nd},id="tasks",sd={ACTIVE_TASKS:"Active Tasks",ACTIVE_TASKS_TITLE:"Active tasks: {taskCount}. Click to view details."},ad={ACTIVE_TASKS:"Aktive Aufgaben",ACTIVE_TASKS_TITLE:"Aktive Aufgaben: {taskCount}. Klicken Sie, um Details anzuzeigen."},od={namespace:id,en:sd,de:ad},ld="workspace",cd={NO_WORKSPACE:"<no workspace>",LOAD_WORKSPACE:"Load workspace"},ud={NO_WORKSPACE:"<kein Arbeitsbereich>",LOAD_WORKSPACE:"Arbeitsbereich laden"},dd={namespace:ld,en:cd,de:ud},pd="fastviews",hd={FAST_VIEWS:"Fast Views"},fd={FAST_VIEWS:"Schnellansichten"},gd={namespace:pd,en:hd,de:fd},md="logterminal",yd={ALL_LOGS:"All logs",ALL:"All",INFO_LOGS:"Info logs",INFO:"Info",WARNING_LOGS:"Warning logs",WARNINGS:"Warnings",ERROR_LOGS:"Error logs",ERRORS:"Errors",DEBUG_LOGS:"Debug logs",DEBUG:"Debug",AUTO_SCROLL_ENABLED:"Auto-scroll enabled",AUTO_SCROLL_DISABLED:"Auto-scroll disabled",AUTO_SCROLL:"Auto-scroll",MANUAL:"Manual",CLEAR_LOGS:"Clear logs",CLEAR:"Clear",NO_LOG_MESSAGES:"No log messages"},wd={ALL_LOGS:"Alle Protokolle",ALL:"Alle",INFO_LOGS:"Info-Protokolle",INFO:"Info",WARNING_LOGS:"Warnungsprotokolle",WARNINGS:"Warnungen",ERROR_LOGS:"Fehlerprotokolle",ERRORS:"Fehler",DEBUG_LOGS:"Debug-Protokolle",DEBUG:"Debug",AUTO_SCROLL_ENABLED:"Automatisches Scrollen aktiviert",AUTO_SCROLL_DISABLED:"Automatisches Scrollen deaktiviert",AUTO_SCROLL:"Automatisches Scrollen",MANUAL:"Manuell",CLEAR_LOGS:"Protokolle lÃ¶schen",CLEAR:"LÃ¶schen",NO_LOG_MESSAGES:"Keine Protokollnachrichten"},bd={namespace:md,en:yd,de:wd},vd="partname",Ed={NO_PART:"<no part>",ACTIVE_PART:"Active part"},kd={NO_PART:"<kein Bereich>",ACTIVE_PART:"Aktiver Bereich"},Cd={namespace:vd,en:Ed,de:kd};Q.registerContribution(dn,Qu);Q.registerContribution(dn,rd);Q.registerContribution(dn,od);Q.registerContribution(dn,dd);Q.registerContribution(dn,gd);Q.registerContribution(dn,bd);Q.registerContribution(dn,Cd);class xd{constructor(){this.bindings=new Map,this.enabled=!0,document.addEventListener("keydown",this.handleKeyDown.bind(this),!0),this.registerExistingCommandBindings(),this.watchCommandRegistry()}registerExistingCommandBindings(){const e=we.listCommands();Object.values(e).forEach(t=>{t.keyBinding&&this.registerKeyBinding(t.id,t.keyBinding)})}watchCommandRegistry(){const e=we.registerCommand.bind(we);we.registerCommand=t=>{e(t),t.keyBinding&&this.registerKeyBinding(t.id,t.keyBinding)}}parseKeyBinding(e){if(!e||e.trim()==="")return null;const t=e.toUpperCase().split("+").map(a=>a.trim());if(t.length===0)return null;const r={ctrl:!1,alt:!1,shift:!1,meta:!1},i=t[t.length-1],s=t.slice(0,-1);for(const a of s)switch(a){case"CTRL":case"CONTROL":r.ctrl=!0;break;case"ALT":case"OPTION":r.alt=!0;break;case"SHIFT":r.shift=!0;break;case"META":case"CMD":case"COMMAND":case"WIN":case"WINDOWS":r.meta=!0;break;default:ve.warn(`Unknown modifier: ${a}`)}return r.key=this.normalizeKey(i),r}normalizeKey(e){return{SPACE:" ",ESC:"ESCAPE",RETURN:"ENTER",LEFT:"ARROWLEFT",RIGHT:"ARROWRIGHT",UP:"ARROWUP",DOWN:"ARROWDOWN",DEL:"DELETE",INS:"INSERT",PAGEUP:"PAGEUP",PAGEDOWN:"PAGEDOWN"}[e]||e}getBindingKey(e){const t=[];return e.ctrl&&t.push("ctrl"),e.alt&&t.push("alt"),e.shift&&t.push("shift"),e.meta&&t.push("meta"),t.sort(),`${t.join("+")}+${e.key.toUpperCase()}`}registerKeyBinding(e,t){const r=this.parseKeyBinding(t);if(!r)return ve.error(`Invalid key binding: ${t}`),!1;r.commandId=e;const i=this.getBindingKey(r);this.bindings.has(i)||this.bindings.set(i,[]);const s=this.bindings.get(i);return s.find(l=>l.commandId===e)?(ve.error(`Key binding ${t} already registered for command ${e}`),!1):(s.push(r),ve.debug(`Key binding registered: ${t} -> ${e}`),!0)}unregisterKeyBinding(e,t){if(t){const r=this.parseKeyBinding(t);if(r){const i=this.getBindingKey(r),s=this.bindings.get(i);if(s){const a=s.filter(l=>l.commandId!==e);a.length===0?this.bindings.delete(i):this.bindings.set(i,a)}}}else for(const[r,i]of this.bindings.entries()){const s=i.filter(a=>a.commandId!==e);s.length===0?this.bindings.delete(r):this.bindings.set(r,s)}}getKeyBindingsForCommand(e){const t=[];for(const r of this.bindings.values())for(const i of r)i.commandId===e&&t.push(this.formatKeyBinding(i));return t}formatKeyBinding(e){const t=[];e.ctrl&&t.push("Ctrl"),e.alt&&t.push("Alt"),e.shift&&t.push("Shift"),e.meta&&t.push("Cmd");let r=e.key;return r.length===1?r=r.toUpperCase():r=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase(),t.push(r),t.join("+")}handleKeyDown(e){if(!this.enabled)return;const t=e.target;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)){const a=e.key.toUpperCase();if(!((e.ctrlKey||e.metaKey)&&e.shiftKey&&a==="P"))return}const r={commandId:"",key:this.normalizeKey(e.key.toUpperCase()),ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},i=this.getBindingKey(r),s=this.bindings.get(i);if(s&&s.length>0){const a=s[0];try{e.preventDefault(),e.stopPropagation();const l=we.createExecutionContext({});we.execute(a.commandId,l),ve.info(`Executed command via key binding: ${a.commandId}`)}catch(l){ve.error(`Failed to execute command ${a.commandId}: ${l.message}`)}}}setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}getAllBindings(){return new Map(this.bindings)}clearAll(){this.bindings.clear()}}ve.debug("KeyBindingManager initializing...");const To=new xd;ve.debug("KeyBindingManager initialized");ut.put("keyBindingManager",To);const ha=(n,e)=>!n.leaf&&e.leaf?-1:n.leaf&&!e.leaf?1:n.label.localeCompare(e.label);class Ad{constructor(){this.editorInputHandlers=[],this.listenersAttached=!1,this.cachedIconContributions=null,Ke(Qn,()=>{}),Ke(Ht,e=>{e.target==="system.icons"&&(this.cachedIconContributions=null)})}getSortedIconContributions(){if(this.cachedIconContributions!==null)return this.cachedIconContributions;const e=Q.getContributions("system.icons");return this.cachedIconContributions=[...e].sort((t,r)=>{const i=t.priority??0,s=r.priority??0;return s!==i?s-i:t.label.localeCompare(r.label)}),this.cachedIconContributions}setupEventListeners(e){if(this.listenersAttached)return;this.listenersAttached=!0;const t=s=>{const a=s.detail;a&&Array.from(a.querySelectorAll("*")).filter(u=>u instanceof mt).forEach(u=>{Re.set(u),u.isEditor&&Ut.set(u)})};e.addEventListener("tab-shown",t);const r=s=>{const a=s.detail;Array.from(a.querySelectorAll("*")).filter(u=>u instanceof mt).forEach(u=>{Re.get()==u&&Re.set(null),Ut.get()==u&&Ut.set(null)})};e.addEventListener("tab-closed",r);const i=s=>{const l=s.closest("wa-tab-panel").getAttribute("name");e.markDirty(l,s.isDirty())};this.signalCleanup=er(Dr,i)}registerEditorInputHandler(e){this.editorInputHandlers.push({definition:e,initialized:!1}),this.editorInputHandlers.sort((t,r)=>{const i=t.definition.ranking??0;return(r.definition.ranking??0)-i})}async ensureHandlerInitialized(e){const t=e.definition;!t.lazyInit||e.initialized||(e.lazyInitPromise||(e.lazyInitPromise=Promise.resolve(t.lazyInit()).then(()=>{e.initialized=!0,e.lazyInitPromise=void 0}).catch(r=>{throw e.lazyInitPromise=void 0,r})),await e.lazyInitPromise)}async handleInput(e){for(let t=0;t<this.editorInputHandlers.length;t++){const r=this.editorInputHandlers[t],i=r.definition;if(i.canHandle(e))return await this.ensureHandlerInitialized(r),await i.handle(e)}}getEditorArea(){return document.querySelector(`k-tabs#${wn}`)}async loadEditor(e){if(!e||("widgetFactory"in e||(e=await this.handleInput(e)),!e||!("widgetFactory"in e)))return;const t=this.getEditorArea();if(!t){console.error("Editor area not found. The split pane system may not be initialized yet.");return}if(this.setupEventListeners(t),t.has(e.key)){t.activate(e.key);return}t.open({name:e.key,editorId:e.editorId,label:e.title,icon:e.icon,closable:!0,noOverflow:e.noOverflow,component:e.widgetFactory})}getFileIcon(e){const t=e.includes(".")?e.split(".").pop()?.toLowerCase()||"":e.toLowerCase(),r=this.getSortedIconContributions();if(r.length===0)return"file";for(const i of r)if(i.mappings&&i.mappings[t])return i.mappings[t];return"file"}}const xn=new Ad;ut.put("editorRegistry",xn);Q.registerContribution("system.icons",{label:"Default File Icons",mappings:{pdf:"file-pdf",md:"book",txt:"file-lines",ts:"code",tsx:"code",js:"code",jsx:"code",json:"file-code",geojson:"file-code",py:"python",html:"code",htm:"code",css:"code",scss:"code",sass:"code",xml:"file-code",yaml:"file-code",yml:"file-code",sql:"database",kml:"file-code",gpx:"file-code",jpg:"image",jpeg:"image",png:"image",gif:"image",svg:"image",webp:"image",bmp:"image",ico:"image"},priority:0});var Sd=Object.defineProperty,Td=Object.getOwnPropertyDescriptor,_o=(n,e,t,r)=>{for(var i=r>1?void 0:r?Td(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Sd(e,t,i),i};const kt=Nn("filebrowser");let wi=class extends mt{constructor(){super(...arguments),this.treeRef=Jt(),this.loadingNodes=new Set}doBeforeUI(){this.initializeWorkspace(),Ke(Ht,n=>{n.target==="system.icons"&&this.requestUpdate()}),this.subscribe(Bt,n=>this.onWorkspaceChanged(n)),this.subscribe(Qn,n=>this.onWorkspaceConnected(n))}firstUpdated(n){super.firstUpdated(n),this.setupDragAndDrop()}updated(n){super.updated(n),n.has("workspaceDir")&&this.workspaceDir&&this.setupDragAndDrop()}async initializeWorkspace(){const n=await et.getWorkspace();n?await this.loadWorkspace(n):we.execute("help")}renderToolbar(){const n=Mt.get()instanceof ui;return S`
            <k-command icon="folder-open" title="${kt("CONNECT_WORKSPACE")}" dropdown="filebrowser.connections"></k-command>
            <k-command cmd="reload_workspace" icon="repeat" title="${kt("RELOAD_WORKSPACE")}"></k-command>
            <k-command cmd="create_file" icon="plus" title="${kt("CREATE_NEW")}" dropdown="filebrowser.create"></k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!n} title="${kt("RENAME_RESOURCE")}"></k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!n} title="${kt("DELETE_RESOURCE")}"></k-command>
        `}renderContextMenu(){const n=Mt.get()instanceof ui;return S`
            <k-command cmd="open_editor" icon="folder-open">${kt("OPEN")}</k-command>
            <k-command cmd="create_file" icon="plus" dropdown="filebrowser.create">${kt("CREATE_NEW")}</k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!n}>${kt("RENAME")}</k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!n}>${kt("DELETE")}</k-command>
        `}async onWorkspaceChanged(n){Mt.set(void 0),await this.loadWorkspace(n),await this.syncTreeSelection()}async onWorkspaceConnected(n){await this.loadWorkspace(n)}async loadWorkspace(n){this.workspaceDir=n,n?this.root=await this.resourceToTreeNode(n,!0):this.root=void 0}async syncTreeSelection(){await this.updateComplete;const e=this.treeRef.value?.querySelector("wa-tree")?.selectedItems||[];e.length>0&&Mt.set(e[0].model?.data)}async resourceToTreeNode(n,e=!1){const t=n instanceof St,r={data:n,label:n.getName(),leaf:t,children:[]};if(n instanceof Kn&&e){for(const i of await n.listChildren(!1)){const s=await this.resourceToTreeNode(i,!1);r.children.push(s)}r.children.sort(ha)}return r}createTreeItems(n,e=!1){if(!n)return S``;const t=!n.leaf&&n.children.length===0,r=n.data,i=r instanceof St,s=i?xn.getFileIcon(r.getName()):n.icon||"folder-open";return S`
            <wa-tree-item 
                draggable=${i}
                @dragstart=${i?this.nobubble(a=>this.onDragStart(a,r)):void 0}
                @dblclick=${this.nobubble(this.onFileDoubleClicked)}
                @wa-lazy-load=${this.nobubble(a=>this.onLazyLoad(a,n))}
                .model=${n} 
                ?expanded=${e}
                ?lazy=${t}>
                <span><wa-icon name=${s} label="${n.leaf?kt("FILE"):kt("FOLDER")}"></wa-icon> ${n.label}</span>
                ${n.children.map(a=>this.createTreeItems(a,!1))}
            </wa-tree-item>`}onDragStart(n,e){if(!n.dataTransfer)return;const t=e.getWorkspacePath(),r=e.getName();if(n.dataTransfer.effectAllowed="copy",n.dataTransfer.setData("text/plain",t),n.dataTransfer.setData("application/x-workspace-file",t),n.dataTransfer.setData("text/uri-list",t),n.dataTransfer.setDragImage){const i=document.createElement("div");i.textContent=r,i.style.position="absolute",i.style.top="-1000px",i.style.padding="4px 8px",i.style.background="var(--wa-color-neutral-10)",i.style.border="1px solid var(--wa-color-neutral-30)",i.style.borderRadius="4px",document.body.appendChild(i),n.dataTransfer.setDragImage(i,0,0),setTimeout(()=>document.body.removeChild(i),0)}}async onLazyLoad(n,e){const t=e.data;t instanceof Kn&&e.children.length===0&&await this.loadNodeChildren(e,t)}async loadNodeChildren(n,e){if(!this.loadingNodes.has(n)){this.loadingNodes.add(n);try{for(const t of await e.listChildren(!1)){La&&t.getName().startsWith(".");const r=await this.resourceToTreeNode(t,!1);n.children.push(r)}n.children.sort(ha),this.requestUpdate()}catch(t){console.error("Failed to load directory children:",t)}finally{this.loadingNodes.delete(n)}}}async onFileDoubleClicked(n){const t=n.currentTarget.model.data.getWorkspacePath();this.executeCommand("open_editor",{path:t})}onSelectionChanged(n){const e=n.detail.selection;if(e&&e.length>0){const t=e[0].model;Mt.set(t.data)}else Mt.set(void 0)}setupDragAndDrop(){const n=this.treeRef.value;if(!n)return;const e=s=>{if(!s.dataTransfer?.types.includes("Files"))return;s.preventDefault(),s.dataTransfer.dropEffect="copy",n.classList.add("drag-over");const l=s.target.closest("wa-tree-item");l&&l!==this.currentDropTarget&&(this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=l,l.classList.add("drop-target"))},t=s=>{s.dataTransfer?.types.includes("Files")&&(s.preventDefault(),n.classList.add("drag-over"))},r=s=>{const a=n.getBoundingClientRect(),l=s.clientX,u=s.clientY;(l<=a.left||l>=a.right||u<=a.top||u>=a.bottom)&&(n.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0)},i=async s=>{if(s.preventDefault(),n.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0,!s.dataTransfer||!this.workspaceDir)return;const a=Array.from(s.dataTransfer.files);if(a.length===0)return;const l=await this.getDropTarget(s);await this.handleFilesDrop(a,l)};n.removeEventListener("dragover",e),n.removeEventListener("dragenter",t),n.removeEventListener("dragleave",r),n.removeEventListener("drop",i),n.addEventListener("dragover",e),n.addEventListener("dragenter",t),n.addEventListener("dragleave",r),n.addEventListener("drop",i)}async getDropTarget(n){const t=n.target.closest("wa-tree-item");if(t){const i=t.model.data;if(i instanceof Kn)return i;const s=i.getParent();if(s)return s}return this.workspaceDir}async handleFilesDrop(n,e){const t=n.length;let r=0,i=0,s=0;for(const a of n)try{const l=this.buildTargetPath(e,a.name);if(await this.workspaceDir.getResource(l)&&!await Wr(kt("FILE_EXISTS_OVERWRITE",{fileName:a.name}))){s++;continue}await(await this.workspaceDir.getResource(l,{create:!0})).saveContents(a),r++}catch(l){console.error(`Failed to upload ${a.name}:`,l),i++}console.log(`Uploaded ${r}/${t} files${s>0?`, ${s} skipped`:""}${i>0?`, ${i} failed`:""}`),await this.loadWorkspace(this.workspaceDir)}buildTargetPath(n,e){const t=n.getWorkspacePath();return t?`${t}/${e}`:e}render(){return S`
            <div class="tree" ${Qt(this.treeRef)} style="--drop-files-text: '${kt("DROP_FILES_HERE")}'">
                ${ct(!this.workspaceDir,()=>S`
                    <k-no-content message="${kt("SELECT_WORKSPACE")}"></k-no-content>`,()=>S`
                `)}
                <wa-tree @wa-selection-change=${this.nobubble(this.onSelectionChanged)}
                         style="--indent-guide-width: 1px;">
                    ${this.createTreeItems(this.root,!0)}
                </wa-tree>
            </div>
        `}};wi.styles=Ze`
        :host {
        }
        
        .tree {
            height: 100%;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .tree.drag-over {
            background-color: var(--wa-color-brand-fill-quiet);
            outline: 2px dashed var(--wa-color-brand-border-normal);
            outline-offset: -4px;
            border-radius: var(--wa-border-radius-medium);
        }
        
        .tree.drag-over::before {
            content: var(--drop-files-text);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            padding: var(--wa-spacing-large);
            border-radius: var(--wa-border-radius-large);
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }
        
        wa-tree-item.drop-target {
            background-color: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            border-radius: var(--wa-border-radius-small);
            outline: 2px solid var(--wa-color-brand-border-loud);
            outline-offset: -2px;
        }
    `;_o([We()],wi.prototype,"root",2);wi=_o([qe("k-filebrowser")],wi);var _d=Object.getOwnPropertyDescriptor,$d=(n,e,t,r)=>{for(var i=r>1?void 0:r?_d(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=a(i)||i);return i};const ss=Nn("tasks");Q.registerContribution(Ai,{html:"<k-tasks></k-tasks>"});let yr=null;function $o(){return yr||(yr=document.createElement("div"),yr.id="progress-dialog-container",document.body.appendChild(yr)),yr}function fa(){return $o().querySelector("wa-dialog")}function Od(){Oo(!0)}function Oo(n=!1){const e=$o(),t=_n.getActiveTasks();if(t.length===0){Vt(S``,e);return}const i=fa();if(!(n||i?.open===!0))return;const a=()=>{const h=fa();h&&(h.open=!1)},l=()=>{Vt(S``,e)},u=S`
        <wa-dialog 
            label="${ss("ACTIVE_TASKS")}" 
            open
            light-dismiss
            style="--width: 600px;"
            @wa-request-close=${a}
            @wa-after-hide=${l}
        >
            <style>
                .progress-dialog-content {
                    display: flex;
                    flex-direction: column;
                    gap: 1.5rem;
                }
                
                .task-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.75rem;
                    padding: 1rem;
                    background: var(--wa-color-neutral-10);
                    border-radius: 8px;
                    border: 1px solid var(--wa-color-neutral-20);
                }
                
                :host-context(.wa-light) .task-item {
                    background: var(--wa-color-neutral-95);
                    border: 1px solid var(--wa-color-neutral-85);
                }
                
                .task-header {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                }
                
                .task-name {
                    font-weight: 600;
                    font-size: 1rem;
                    color: var(--wa-color-neutral-90);
                }
                
                :host-context(.wa-light) .task-name {
                    color: var(--wa-color-neutral-10);
                }
                
                .task-message {
                    font-size: 0.875rem;
                    color: var(--wa-color-neutral-70);
                    margin-top: 0.25rem;
                }
                
                :host-context(.wa-light) .task-message {
                    color: var(--wa-color-neutral-30);
                }
                
                .task-progress {
                    margin-top: 0.5rem;
                }
                
                wa-progress-bar {
                    --track-height: 1.5rem;
                }
                
                wa-progress-bar::part(label) {
                    text-align: center;
                    width: 100%;
                    font-size: 0.875rem;
                }
                
                .no-tasks {
                    text-align: center;
                    padding: 2rem;
                    color: var(--wa-color-neutral-60);
                }
                
                :host-context(.wa-light) .no-tasks {
                    color: var(--wa-color-neutral-40);
                }
            </style>
            
            <div class="progress-dialog-content">
                ${t.map(h=>{const T=h.progress>=0||h.totalSteps>0,E=h.progress>=0?h.progress:h.totalSteps>0?Math.round(h.currentStep/h.totalSteps*100):0,v=h.progress<0&&h.totalSteps>0;return S`
                        <div class="task-item">
                            <div class="task-header">
                                <wa-icon name="hourglass" style="color: var(--wa-color-warning-fill-loud);"></wa-icon>
                                <div style="flex: 1;">
                                    <div class="task-name">${h.name}</div>
                                    ${h.message?S`
                                        <div class="task-message">${h.message}</div>
                                    `:""}
                                </div>
                            </div>
                            <div class="task-progress">
                                ${T?S`
                                    <wa-progress-bar value="${E}">
                                        ${v?`${h.currentStep}/${h.totalSteps} - `:""}${E}%
                                    </wa-progress-bar>
                                `:S`
                                    <wa-progress-bar indeterminate></wa-progress-bar>
                                `}
                            </div>
                        </div>
                    `})}
            </div>
        </wa-dialog>
    `;Vt(u,e)}let as=class extends mt{doBeforeUI(){this.watch(Ji,()=>{Oo(),this.requestUpdate()})}handleIndicatorClick(){Od()}render(){Ji.get();const e=_n.getActiveTasks().length;return e===0?S``:S`
            <div class="task-indicator" @click=${this.handleIndicatorClick} title="${ss("ACTIVE_TASKS_TITLE",{taskCount:e.toString()})}">
                <wa-spinner 
                    style="font-size: 1rem; --indicator-color: var(--wa-color-warning-fill-loud);" 
                    label="${ss("ACTIVE_TASKS")}"
                ></wa-spinner>
                <span class="task-count">${e}</span>
            </div>
        `}};as.styles=Ze`
        :host {
            display: flex;
            align-items: center;
        }
        
        .task-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .task-indicator:hover {
            background: var(--wa-color-neutral-15);
        }
        
        :host-context(.wa-light) .task-indicator:hover {
            background: var(--wa-color-neutral-85);
        }
        
        .task-count {
            font-size: 0.875rem;
            color: var(--wa-color-neutral-70);
        }
        
        :host-context(.wa-light) .task-count {
            color: var(--wa-color-neutral-30);
        }
    `;as=$d([qe("k-tasks")],as);var Dd=Object.getOwnPropertyDescriptor,Rd=(n,e,t,r)=>{for(var i=r>1?void 0:r?Dd(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=a(i)||i);return i};const ji=Nn("workspace");let ga=class extends tn{constructor(){super(...arguments),this.workspaceName=ji("NO_WORKSPACE")}doInitUI(){this.updateWorkspaceName(),Ke(Qn,()=>{this.updateWorkspaceName()})}updateWorkspaceName(){et.getWorkspace().then(n=>{this.workspaceName=n?.getName()||ji("NO_WORKSPACE"),this.requestUpdate()})}handleLoadWorkspace(){we.execute("load_workspace",{source:this})}render(){return S`
            <wa-button 
                appearance="plain"
                size="small"
                title="${ji("LOAD_WORKSPACE")}"
                @click=${this.handleLoadWorkspace}>
                <wa-icon name="folder-open" slot="start" label="Workspace"></wa-icon>
                ${this.workspaceName}
            </wa-button>
        `}};ga=Rd([qe("k-workspace-name")],ga);var Id=Object.getOwnPropertyDescriptor,Pd=(n,e,t,r)=>{for(var i=r>1?void 0:r?Id(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=a(i)||i);return i};const Bi=Nn("partname");Q.registerContribution(Ai,{html:"<k-part-name></k-part-name>"});let ma=class extends tn{doBeforeUI(){this.watch(Re,()=>{this.requestUpdate()})}getPartName(){const n=Re.get();return n&&(n.tabContribution?.label||n.getAttribute("id"))||Bi("NO_PART")}render(){const e=Re.get()?.tabContribution?.icon||"box";return S`
            <wa-button 
                appearance="plain"
                size="small"
                title="${Bi("ACTIVE_PART")}">
                <k-icon slot="start" name="${e}" label="Part"></k-icon>
                ${this.getPartName()}
            </wa-button>
        `}};ma=Pd([qe("k-part-name")],ma);var Ld=Object.defineProperty,Md=Object.getOwnPropertyDescriptor,Br=(n,e,t,r)=>{for(var i=r>1?void 0:r?Md(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Ld(e,t,i),i};const Nd=It("KExtensions"),ot=Nn("extensions");let In=class extends mt{constructor(){super(...arguments),this.filterText="",this.showRegisterDialog=!1,this.registerExtensionData={}}doInitUI(){Ke(vr,()=>{this.requestUpdate()})}onExtensionDblClick(){}enable(n){fe.enable(n.id,!0),this.requestUpdate()}disable(n){fe.disable(n.id,!0),this.requestUpdate()}isExtensionRequired(n){const e=At.getCurrentApp();return!e||!e.extensions?!1:e.extensions.includes(n)}selectionChanged(n){const e=n.detail.selection||[];e.length>0&&e[0].model?this.selectedExtension=e[0].model:this.selectedExtension=void 0}getFilteredExtensions(){if(!this.filterText.trim())return fe.getExtensions();const n=this.filterText.toLowerCase();return fe.getExtensions().filter(e=>String(e.name).toLowerCase().includes(n)||(e.description?String(e.description).toLowerCase().includes(n):!1)||e.id.toLowerCase().includes(n))}getGroupedExtensions(){const n=this.getFilteredExtensions(),e=[],t=[];return n.forEach(r=>{fe.isEnabled(r.id)?e.push(r):t.push(r)}),e.sort((r,i)=>String(r.name).localeCompare(String(i.name))),t.sort((r,i)=>String(r.name).localeCompare(String(i.name))),{enabled:e,available:t}}isExternalExtension(n){return n.external===!0}handleFilterInput(n){this.filterText=n.target.value,this.requestUpdate()}clearFilter(){this.filterText="",this.requestUpdate()}async handleRegisterExtension(){try{const n=await Fr("Enter extension URL or source identifier:","",!1);if(!n)return;await _n.runAsync("Registering extension",async()=>{let e=n;an.isGitHubUrl(n)&&(e=an.convertGitHubUrlToSource(n));const t=an.parseSource(e);t?.type==="github"?await this.fetchGitHubMetadata(t,e):(this.registerExtensionData={url:e,id:"",name:"",description:""},this.showRegisterDialog=!0,this.requestUpdate())})}catch(n){ge(`Failed to register extension: ${n}`)}}async fetchGitHubMetadata(n,e){try{const t=await an.fetchGitHubPackageJson(n),r=n.owner,i=n.repo,s=t.name||`ext.${r}-${i}`,a=t.name||`${r}/${i}`,l=t.description||"",u=t.version||"",h=t.author||(typeof t.author=="string"?t.author:t.author?.name)||"";this.registerExtensionData={id:s,name:a,description:l,url:e,version:u,author:h,icon:"puzzle-piece",external:!0},this.showRegisterDialog=!0,this.requestUpdate()}catch(t){Nd.warn(`Could not fetch package.json, using defaults: ${t}`),this.registerExtensionData={url:e,id:"",name:"",description:""},this.showRegisterDialog=!0,this.requestUpdate()}}async confirmRegisterExtension(){if(!this.registerExtensionData.url){ge("URL is required");return}if(!this.registerExtensionData.id){ge("Extension ID is required");return}if(!this.registerExtensionData.name){ge("Extension name is required");return}try{await _n.runAsync("Registering extension",async()=>{const n={id:this.registerExtensionData.id,name:this.registerExtensionData.name,description:this.registerExtensionData.description,url:this.registerExtensionData.url,version:this.registerExtensionData.version,author:this.registerExtensionData.author,icon:this.registerExtensionData.icon||"puzzle-piece",external:!0};fe.registerExtension(n),await fe.loadExtensionFromUrl(this.registerExtensionData.url,n.id),yt(`Extension ${n.name} registered successfully`),this.showRegisterDialog=!1,this.registerExtensionData={},this.requestUpdate()})}catch(n){ge(`Failed to register extension: ${n}`)}}cancelRegisterExtension(){this.showRegisterDialog=!1,this.registerExtensionData={},this.requestUpdate()}renderToolbar(){return S`
            <wa-input
                placeholder="${ot("FILTER_PLACEHOLDER")}"
                .value=${this.filterText}
                @input=${n=>this.handleFilterInput(n)}
                @wa-clear=${()=>this.clearFilter()}
                with-clear
                size="small"
                style="width: 300px;">
                <wa-icon slot="start" name="magnifying-glass" label="Filter"></wa-icon>
            </wa-input>
            <wa-button 
                variant="primary" 
                appearance="plain"
                @click=${()=>this.handleRegisterExtension()}
                title="Register a new extension">
                <wa-icon name="plus" label="Add"></wa-icon>
                Register Extension
            </wa-button>
        `}render(){const n=this.getGroupedExtensions(),e=n.enabled.length>0||n.available.length>0;return S`
            ${ct(this.showRegisterDialog,()=>S`
                <wa-dialog 
                    label="Register Extension"
                    open
                    @wa-request-close=${()=>this.cancelRegisterExtension()}
                    style="--wa-dialog-width: 500px;">
                    <div style="display: flex; flex-direction: column; gap: 1rem; padding: 1rem;">
                        <wa-input
                            label="Extension ID *"
                            .value=${this.registerExtensionData.id||""}
                            @input=${t=>{this.registerExtensionData.id=t.target.value,this.requestUpdate()}}
                            required
                            hint="Unique identifier for the extension (e.g., 'ext.my-extension')">
                        </wa-input>
                        
                        <wa-input
                            label="Name *"
                            .value=${this.registerExtensionData.name||""}
                            @input=${t=>{this.registerExtensionData.name=t.target.value,this.requestUpdate()}}
                            required
                            hint="Display name of the extension">
                        </wa-input>
                        
                        <wa-input
                            label="Description"
                            .value=${this.registerExtensionData.description||""}
                            @input=${t=>{this.registerExtensionData.description=t.target.value,this.requestUpdate()}}
                            hint="Description of what the extension does">
                        </wa-input>
                        
                        <wa-input
                            label="URL *"
                            .value=${this.registerExtensionData.url||""}
                            @input=${t=>{this.registerExtensionData.url=t.target.value,this.requestUpdate()}}
                            required
                            readonly
                            hint="Extension source URL or identifier">
                        </wa-input>
                        
                        <div style="display: flex; gap: 0.5rem;">
                            <wa-input
                                label="Version"
                                .value=${this.registerExtensionData.version||""}
                                @input=${t=>{this.registerExtensionData.version=t.target.value,this.requestUpdate()}}
                                style="flex: 1;"
                                hint="Extension version">
                            </wa-input>
                            
                            <wa-input
                                label="Author"
                                .value=${this.registerExtensionData.author||""}
                                @input=${t=>{this.registerExtensionData.author=t.target.value,this.requestUpdate()}}
                                style="flex: 1;"
                                hint="Extension author">
                            </wa-input>
                        </div>
                        
                        <wa-input
                            label="Icon"
                            .value=${this.registerExtensionData.icon||"puzzle-piece"}
                            @input=${t=>{this.registerExtensionData.icon=t.target.value,this.requestUpdate()}}
                            hint="Icon name (FontAwesome icon)">
                        </wa-input>
                        
                        <div style="display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1rem;">
                            <wa-button 
                                variant="default" 
                                @click=${()=>this.cancelRegisterExtension()}>
                                Cancel
                            </wa-button>
                            <wa-button 
                                variant="primary" 
                                @click=${()=>this.confirmRegisterExtension()}
                                ?disabled=${!this.registerExtensionData.id||!this.registerExtensionData.name||!this.registerExtensionData.url}>
                                Register
                            </wa-button>
                        </div>
                    </div>
                </wa-dialog>
            `)}
            <wa-split-panel position="30" style="height: 100%">
                <wa-tree 
                    selection="leaf"
                    style="--indent-guide-width: 1px;" 
                    slot="start"
                    @wa-selection-change="${this.selectionChanged}">
                    ${e?S`
                        ${n.enabled.length>0?S`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="check-circle" style="color: var(--wa-color-success-50);"></wa-icon>
                                    ${ot("INSTALLED")} (${n.enabled.length})
                                </span>
                                ${n.enabled.map(t=>{const r=this.isExternalExtension(t);return S`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${t}>
                                            <span><k-icon name="${t.icon}"></k-icon></span> ${t.name}${r?S` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                        ${n.available.length>0?S`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="circle" style="color: var(--wa-color-neutral-50);"></wa-icon>
                                    ${ot("AVAILABLE")} (${n.available.length})
                                </span>
                                ${n.available.map(t=>{const r=this.isExternalExtension(t);return S`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${t}>
                                            <span><k-icon name="${t.icon}"></k-icon></span> ${t.name}${r?S` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                    `:""}
                    ${e?"":S`
                        <div style="padding: 1em; text-align: center; opacity: 0.7;">
                            ${ot("NO_MATCHES",{filterText:this.filterText})}
                        </div>
                    `}
                </wa-tree>
                <div slot="end" style="padding: 1em;">
                    ${ct(this.selectedExtension,t=>{const r=this.isExternalExtension(t),i=fe.isEnabled(t.id);return S`
                                <h1><k-icon name="${t.icon}"></k-icon> ${t.name}${r?" (External)":""}</h1>
                                ${ct(r,()=>S`
                                    <div class="marketplace-badge">
                                        <wa-icon name="store"></wa-icon>
                                        <span>${ot("EXTERNAL_EXTENSION")}</span>
                                    </div>
                                `)}
                                <hr>
                                <div>
                                    ${ct(i,()=>S`
                                        <wa-button 
                                            title="${this.isExtensionRequired(t.id)?ot("REQUIRED_HINT"):ot("DISABLE_TITLE")}" 
                                            @click="${()=>this.disable(t)}"
                                            variant="danger" 
                                            appearance="plain"
                                            ?disabled=${this.isExtensionRequired(t.id)}>
                                            <wa-icon name="xmark" label="Uninstall"></wa-icon>&nbsp;${ot("UNINSTALL")}
                                        </wa-button>
                                        ${ct(this.isExtensionRequired(t.id),()=>S`
                                            <div class="required-hint">
                                                <wa-icon name="info-circle" style="color: var(--wa-color-primary-50);"></wa-icon>
                                                <span>${ot("REQUIRED_HINT")}</span>
                                            </div>
                                        `)}
                                    `,()=>S`
                                        <wa-button 
                                            title="${ot("ENABLE_TITLE")}" 
                                            @click="${()=>this.enable(t)}"
                                            variant="brand" 
                                            appearance="plain">
                                            <wa-icon name="download" label="Install"></wa-icon>&nbsp;${ot("INSTALL")}
                                        </wa-button>
                                    `)}
                                </div>

                                ${ct(t.experimental,()=>S`
                                    <div style="margin-top: 1em;">
                                        <wa-button size="small" variant="warning" appearance="plain">
                                            <wa-icon name="triangle-exclamation" label="Warning"></wa-icon>
                                        </wa-button>
                                        <small><i>${ot("EXPERIMENTAL")}</i></small>
                                    </div>
                                `)}

                                ${ct(t.version||t.author,()=>S`
                                    <div style="margin-top: 1em; display: flex; flex-direction: column; gap: 0.5rem;">
                                        ${ct(t.version,()=>S`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="tag" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">${ot("VERSION")} <strong>${t.version}</strong></span>
                                            </div>
                                        `)}
                                        ${ct(t.author,()=>S`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="user" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">${ot("AUTHOR")} <strong>${t.author}</strong></span>
                                            </div>
                                        `)}
                                    </div>
                                `)}

                                <p style="margin-top: 1em;">${t.description}</p>

                                ${ct(t.dependencies&&t.dependencies.length>0,()=>S`
                                    <div style="margin-top: 1.5em;">
                                        <h3 style="margin-bottom: 0.5em;">
                                            <wa-icon name="puzzle-piece" style="font-size: 0.9em;"></wa-icon>
                                            ${ot("DEPENDENCIES")}
                                        </h3>
                                        <div class="dependencies-list">
                                            ${t.dependencies.map(s=>{const a=fe.getExtensions().find(u=>u.id===s),l=fe.isEnabled(s);return S`
                                                    <div class="dependency-item">
                                                        <wa-icon 
                                                            name="${l?"check-circle":"circle"}" 
                                                            style="color: ${l?"var(--wa-color-success-50)":"var(--wa-color-neutral-50)"};">
                                                        </wa-icon>
                                                        <k-icon name="${a?.icon||"puzzle-piece"}"></k-icon>
                                                        <span>${a?.name||s}</span>
                                                        ${l?"":S`
                                                            <span class="dependency-badge">${ot("NOT_INSTALLED")}</span>
                                                        `}
                                                    </div>
                                                `})}
                                        </div>
                                        <small style="opacity: 0.7; display: block; margin-top: 0.5em;">
                                            <wa-icon name="info-circle" style="font-size: 0.9em;"></wa-icon>
                                            ${ot("DEPENDENCIES_HINT")}
                                        </small>
                                    </div>
                                `)}
                            `})}
                </div>
            </wa-split-panel>
        `}};In.styles=Ze`
        :host {
        }

        wa-tree-item > span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        wa-tree-item:has(> wa-tree-item) {
            font-weight: 500;
        }

        .dependencies-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .dependency-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-surface-variant);
        }

        .dependency-item wa-icon:first-child {
            flex-shrink: 0;
        }

        .dependency-item k-icon {
            flex-shrink: 0;
        }

        .dependency-item span:not(.dependency-badge) {
            flex: 1;
        }

        .dependency-badge {
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-warning-100);
            color: var(--wa-color-warning-900);
        }

        .required-hint {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
        }

        .required-hint wa-icon {
            flex-shrink: 0;
        }

        .required-hint span {
            line-height: 1.4;
        }

        .marketplace-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.875rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--wa-color-primary-30);
        }
    `;Br([We()],In.prototype,"selectedExtension",2);Br([We()],In.prototype,"filterText",2);Br([We()],In.prototype,"showRegisterDialog",2);Br([We()],In.prototype,"registerExtensionData",2);In=Br([qe("k-extensions")],In);var Ud=Object.defineProperty,zd=Object.getOwnPropertyDescriptor,Pi=(n,e,t,r)=>{for(var i=r>1?void 0:r?zd(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Ud(e,t,i),i};const lt=Nn("logterminal");let nr=class extends mt{constructor(){super(...arguments),this.messages=[],this.autoScroll=!0,this.filter="all",this.containerRef=Jt()}connectedCallback(){super.connectedCallback(),this.loadSettings(),Sl(this.log.bind(this))}disconnectedCallback(){super.disconnectedCallback(),Tl()}log(n,e,t="info"){const r={timestamp:new Date,level:t,source:n,message:e};this.messages=[...this.messages,r],this.updateToolbar(),this.autoScroll&&this.updateComplete.then(()=>{const i=this.containerRef.value;i&&(i.scrollTop=i.scrollHeight)})}clear(){this.messages=[],this.updateToolbar()}getFilteredMessages(){return this.filter==="all"?this.messages:this.messages.filter(n=>n.level===this.filter)}formatTimestamp(n){return n.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}getLevelIcon(n){switch(n){case"info":return"circle-info";case"warning":return"triangle-exclamation";case"error":return"circle-xmark";case"debug":return"bug"}}getLevelColor(n){switch(n){case"info":return"var(--wa-color-primary-text, #0066cc)";case"warning":return"var(--wa-color-warning-text, #ff9800)";case"error":return"var(--wa-color-danger-text, #dc3545)";case"debug":return"var(--wa-color-neutral-text-subtle, #6c757d)"}}renderToolbar(){const n=this.messages.filter(i=>i.level==="info").length,e=this.messages.filter(i=>i.level==="warning").length,t=this.messages.filter(i=>i.level==="error").length,r=this.messages.filter(i=>i.level==="debug").length;return S`
            <k-command 
                icon="list"
                title="${lt("ALL_LOGS")}"
                appearance="${this.filter==="all"?"filled":"plain"}"
                variant="${this.filter==="all"?"brand":"neutral"}"
                .action=${()=>{this.filter="all",this.saveSettings(),this.updateToolbar()}}>
                ${lt("ALL")} (${this.messages.length})
            </k-command>

            <k-command 
                icon="circle-info"
                title="${lt("INFO_LOGS")}"
                appearance="${this.filter==="info"?"filled":"plain"}"
                variant="${this.filter==="info"?"brand":"neutral"}"
                .action=${()=>{this.filter="info",this.saveSettings(),this.updateToolbar()}}>
                ${lt("INFO")}${n>0?` (${n})`:""}
            </k-command>

            <k-command 
                icon="triangle-exclamation"
                title="${lt("WARNING_LOGS")}"
                appearance="${this.filter==="warning"?"filled":"plain"}"
                variant="${this.filter==="warning"?"brand":"neutral"}"
                .action=${()=>{this.filter="warning",this.saveSettings(),this.updateToolbar()}}>
                ${lt("WARNINGS")}${e>0?` (${e})`:""}
            </k-command>

            <k-command 
                icon="circle-xmark"
                title="${lt("ERROR_LOGS")}"
                appearance="${this.filter==="error"?"filled":"plain"}"
                variant="${this.filter==="error"?"brand":"neutral"}"
                .action=${()=>{this.filter="error",this.saveSettings(),this.updateToolbar()}}>
                ${lt("ERRORS")}${t>0?` (${t})`:""}
            </k-command>

            <k-command 
                icon="bug"
                title="${lt("DEBUG_LOGS")}"
                appearance="${this.filter==="debug"?"filled":"plain"}"
                variant="${this.filter==="debug"?"brand":"neutral"}"
                .action=${()=>{this.filter="debug",this.saveSettings(),this.updateToolbar()}}>
                ${lt("DEBUG")}${r>0?` (${r})`:""}
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>

            <k-command 
                icon="arrow-down" 
                title="${this.autoScroll?lt("AUTO_SCROLL_ENABLED"):lt("AUTO_SCROLL_DISABLED")}"
                appearance="${this.autoScroll?"filled":"plain"}"
                variant="${this.autoScroll?"brand":"neutral"}"
                .action=${()=>{this.autoScroll=!this.autoScroll,this.saveSettings(),this.updateToolbar()}}>
                ${this.autoScroll?lt("AUTO_SCROLL"):lt("MANUAL")}
            </k-command>

            <k-command 
                icon="trash" 
                title="${lt("CLEAR_LOGS")}"
                .action=${()=>this.clear()}>
                ${lt("CLEAR")}
            </k-command>
        `}render(){const n=this.getFilteredMessages();return S`
            <div class="log-terminal">
                <div class="messages" ${Qt(this.containerRef)}>
                    ${n.length===0?S`<div class="empty-state">${lt("NO_LOG_MESSAGES")}</div>`:n.map(e=>S`
                            <div class="message" data-level="${e.level}">
                                <span class="timestamp">${this.formatTimestamp(e.timestamp)}</span>
                                <wa-icon 
                                    name="${this.getLevelIcon(e.level)}" 
                                    label="${e.level}"
                                    style="color: ${this.getLevelColor(e.level)}">
                                </wa-icon>
                                <span class="source">[${e.source}]</span>
                                <span class="text">${e.message}</span>
                            </div>
                        `)}
                </div>
            </div>
        `}async loadSettings(){const n=await this.getDialogSetting();n&&(typeof n.filter=="string"&&(n.filter==="all"||["info","warning","error","debug"].includes(n.filter))&&(this.filter=n.filter),typeof n.autoScroll=="boolean"&&(this.autoScroll=n.autoScroll),this.updateToolbar())}async saveSettings(){await this.setDialogSetting({filter:this.filter,autoScroll:this.autoScroll})}};nr.styles=Ze`
        :host {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .log-terminal {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            font-family: var(--wa-font-mono);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .message {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            align-items: baseline;
            border-radius: var(--wa-border-radius-small);
        }

        .message:hover {
            background: var(--wa-color-neutral-background-hover);
        }

        .timestamp {
            color: var(--wa-color-neutral-text-subtle);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .source {
            color: var(--wa-color-primary-text);
            font-weight: 500;
            white-space: nowrap;
        }

        .text {
            color: var(--wa-color-neutral-text);
            word-break: break-word;
        }

        .message[data-level="error"] .text {
            color: var(--wa-color-danger-text);
        }

        .message[data-level="warning"] .text {
            color: var(--wa-color-warning-text);
        }

        .message[data-level="debug"] .text {
            color: var(--wa-color-neutral-text-subtle);
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--wa-color-neutral-text-subtle);
            font-style: italic;
        }

        wa-icon {
            flex-shrink: 0;
        }
    `;Pi([We()],nr.prototype,"messages",2);Pi([We()],nr.prototype,"autoScroll",2);Pi([We()],nr.prototype,"filter",2);nr=Pi([qe("k-log-terminal")],nr);var Fd=Object.defineProperty,Wd=Object.getOwnPropertyDescriptor,_t=(n,e,t,r)=>{for(var i=r>1?void 0:r?Wd(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Fd(e,t,i),i};let wt=class extends Mr{constructor(){super(...arguments),this.cmd="",this.title="",this.label=!1,this.disabled=!1,this.appearance="plain",this.variant="neutral",this.size="small",this.params={},this.placement="bottom-start",this.dropdownContributions=[]}handleClick(n){if(!this.disabled){if(n&&n.stopPropagation(),this.action){this.action(n);return}if(this.cmd){const e=this.closest("wa-dropdown");e&&e.open!==void 0&&(e.open=!1),this.executeCommand(this.cmd,this.params)}}}handleSelect(n){const e=n.target;e&&e.open!==void 0&&(e.open=!1)}isInDropdown(){return!!this.closest("wa-dropdown, wa-dropdown-menu")}getKeybinding(){if(!this.cmd||this.action)return null;const n=To.getKeyBindingsForCommand(this.cmd);return n.length>0?n[0]:null}doBeforeUI(){this.dropdown&&(this.loadDropdownContributions(),Ke(Ht,n=>{this.dropdown&&n.target===this.dropdown&&(this.dropdownContributions=n.contributions,this.requestUpdate())}))}loadDropdownContributions(){this.dropdown&&(this.dropdownContributions=Q.getContributions(this.dropdown),this.requestUpdate())}renderContribution(n){if("command"in n){const e=n,t=e.disabled?.get();return S`
                <k-command 
                    cmd="${e.command}"
                    icon="${e.icon||""}"
                    .params=${e.params||{}}
                    ?disabled="${t}">
                    ${e.label}
                </k-command>
            `}if("html"in n){const t=n.html;return t instanceof Function?t():Ir(t)}return Ve}render(){const n=this.getKeybinding();return this.isInDropdown()?S`
                <wa-dropdown-item 
                    ?disabled=${this.disabled}
                    @click=${e=>this.handleClick(e)}>
                    <k-icon name="${this.icon}" label="${this.title}" slot="icon"></k-icon>
                    <slot></slot>
                    ${n?S`<span class="keybinding">${n}</span>`:""}
                </wa-dropdown-item>
            `:this.dropdown?S`
                <wa-dropdown 
                    placement=${this.placement}
                    @wa-select=${e=>this.handleSelect(e)}>
                    <wa-button 
                        slot="trigger"
                        appearance=${this.appearance}
                        variant=${this.variant}
                        size=${this.size}
                        ?disabled=${this.disabled}
                        with-caret
                        title=${n?`${this.title} (${n})`:this.title}>
                        <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                        <slot></slot>
                        ${this.label?this.title:Ve}
                    </wa-button>
                    
                    ${this.title?S`
                        <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                            ${this.title}
                        </h6>
                    `:Ve}
                    
                    ${this.dropdownContributions.map(e=>this.renderContribution(e))}
                    
                    ${this.cmd?S`
                        <wa-divider></wa-divider>
                        <k-command 
                            cmd="${this.cmd}"
                            icon="${this.icon||""}"
                            .params=${this.params}
                            ?disabled=${this.disabled}>
                            <slot></slot>
                            ${this.title}
                        </k-command>
                    `:Ve}
                </wa-dropdown>
            `:S`
            <wa-button
                appearance=${this.appearance}
                variant=${this.variant}
                size=${this.size}
                ?disabled=${this.disabled}
                title=${n?`${this.title} (${n})`:this.title}
                @click=${e=>this.handleClick(e)}>
                <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                <slot></slot>
            </wa-button>
        `}};wt.styles=Ze`
        :host {
            display: inline-block;
        }

        .keybinding {
            margin-left: auto;
            padding: 2px 6px;
            background: var(--wa-color-neutral-15);
            border: 1px solid var(--wa-color-neutral-25);
            border-radius: 3px;
            font-size: 10px;
            font-family: monospace;
            opacity: 0.7;
        }

        :host-context(.wa-light) .keybinding {
            background: var(--wa-color-neutral-85);
            border: 1px solid var(--wa-color-neutral-75);
        }
    `;_t([le()],wt.prototype,"cmd",2);_t([le({type:Object,attribute:!1})],wt.prototype,"action",2);_t([le()],wt.prototype,"title",2);_t([le()],wt.prototype,"label",2);_t([le()],wt.prototype,"icon",2);_t([le({type:Boolean})],wt.prototype,"disabled",2);_t([le()],wt.prototype,"appearance",2);_t([le()],wt.prototype,"variant",2);_t([le()],wt.prototype,"size",2);_t([le({type:Object,attribute:!1})],wt.prototype,"params",2);_t([le()],wt.prototype,"dropdown",2);_t([le()],wt.prototype,"placement",2);_t([We()],wt.prototype,"dropdownContributions",2);wt=_t([qe("k-command")],wt);var Gd=Object.defineProperty,qd=Object.getOwnPropertyDescriptor,zt=(n,e,t,r)=>{for(var i=r>1?void 0:r?qd(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Gd(e,t,i),i};const jd=Nn("fastviews");let Tt=class extends Mr{constructor(){super(...arguments),this.target="",this.title="",this.disabled=!1,this.appearance="plain",this.size="small",this.placement="bottom-start",this.tabContributions=[],this.drawerOpen=!1,this.drawerSize="50vw",this.drawerRef=Jt(),this.tabsRef=Jt(),this.resizeHandleRef=Jt(),this.resizing=null}getDrawerTabsId(){return`fastviews-drawer-tabs-${this.target}`}handleTabClick(n){if(!this.disabled)if(this.containerId){const e=document.querySelector(`k-tabs#${this.containerId}`);if(!e){console.error(`k-fastviews: Tab container with id "${this.containerId}" not found`);return}e.open(n)}else this.drawerOpen=!0,this.updateComplete.then(()=>{const e=this.tabsRef.value;e&&e.open(n)})}handleDrawerHide(){this.drawerOpen=!1}startResize(n){n.preventDefault(),n.stopPropagation();const e=this.drawerRef.value;if(!e)return;let r=(()=>{const a=e.shadowRoot?.querySelector('[part="panel"]');if(a&&a.offsetWidth>0)return a.offsetWidth;const h=(window.getComputedStyle(e).getPropertyValue("--size")||this.drawerSize).match(/^(\d+(?:\.\d+)?)(px|vw|vh|%)$/);if(h){const T=parseFloat(h[1]),E=h[2];if(E==="px")return T;if(E==="vw")return T/100*window.innerWidth;if(E==="vh")return T/100*window.innerHeight;if(E==="%")return T/100*window.innerWidth}return 0})();r===0&&(r=window.innerWidth*.5);const i=a=>{this.resizing&&(a.preventDefault(),a.stopPropagation(),this.resizing.rafId!==null&&cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=requestAnimationFrame(()=>{if(!this.resizing)return;const l=this.resizing.startX-a.clientX,u=Math.round(this.resizing.startSize+l),h=200,T=Math.round(window.innerWidth*.9);if(u>=h&&u<=T){this.drawerSize=`${u}px`;const E=this.drawerRef.value;E&&(E.style.setProperty("--size",this.drawerSize),E.style.setProperty("transition","none"))}this.resizing.rafId=null}))},s=()=>{if(this.resizing){this.resizing.rafId!==null&&(cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=null),document.removeEventListener("mousemove",this.resizing.handleMouseMove),document.removeEventListener("mouseup",this.resizing.handleMouseUp),document.body.style.cursor="",document.body.style.userSelect="";const a=this.drawerRef.value;a&&a.style.removeProperty("transition"),this.resizing=null}};this.resizing={startX:n.clientX,startSize:r,handleMouseMove:i,handleMouseUp:s,rafId:null},document.addEventListener("mousemove",i,{passive:!1}),document.addEventListener("mouseup",s,{passive:!1}),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}doBeforeUI(){this.target&&(this.loadTabContributions(),Ke(Ht,n=>{this.target&&n.target===this.target&&this.loadTabContributions()}))}loadTabContributions(){if(!this.target)return;const n=Q.getContributions(this.target);this.tabContributions=n.filter(e=>"name"in e),this.requestUpdate()}renderTabContribution(n){const e=n.disabled?.get();return S`
            <wa-dropdown-item 
                ?disabled=${e}
                @click=${()=>this.handleTabClick(n)}>
                <k-icon name="${n.icon||""}" label="${n.label}" slot="icon"></k-icon>
                ${n.label}
            </wa-dropdown-item>
        `}render(){return this.target?this.tabContributions.length===0?Ve:S`
            <wa-dropdown placement=${this.placement}>
                <wa-button 
                    slot="trigger"
                    appearance=${this.appearance}
                    size=${this.size}
                    ?disabled=${this.disabled}
                    with-caret
                    title=${this.title}>
                    <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                    <slot></slot>
                </wa-button>
                
                ${this.title?S`
                    <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                        ${this.title}
                    </h6>
                `:Ve}
                
                ${this.tabContributions.map(n=>this.renderTabContribution(n))}
            </wa-dropdown>

            ${this.containerId?Ve:S`
                <wa-drawer 
                    ${Qt(this.drawerRef)}
                    label="${this.title||jd("FAST_VIEWS")}"
                    placement="end"
                    ?open=${this.drawerOpen}
                    @wa-hide=${this.handleDrawerHide}
                    style="--size: ${this.drawerSize};">
                    <div 
                        ${Qt(this.resizeHandleRef)}
                        class="resize-handle"
                        @mousedown=${this.startResize}>
                    </div>
                    <k-tabs 
                        ${Qt(this.tabsRef)}
                        id="${this.getDrawerTabsId()}"
                        style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                    </k-tabs>
                </wa-drawer>
            `}
        `:Ve}};Tt.styles=Ze`
        :host {
            display: inline-block;
        }

        wa-drawer {
            position: relative;
        }

        wa-drawer::part(panel) {
            position: relative;
        }

        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            z-index: 1000;
            background: transparent;
            transition: background-color 0.2s;
            user-select: none;
            touch-action: none;
        }

        .resize-handle:hover {
            background: var(--wa-color-brand-fill-loud);
        }

        .resize-handle:active {
            background: var(--wa-color-brand-fill-loud);
        }
    `;zt([le()],Tt.prototype,"target",2);zt([le()],Tt.prototype,"title",2);zt([le()],Tt.prototype,"icon",2);zt([le({type:Boolean})],Tt.prototype,"disabled",2);zt([le()],Tt.prototype,"appearance",2);zt([le()],Tt.prototype,"size",2);zt([le()],Tt.prototype,"placement",2);zt([le()],Tt.prototype,"containerId",2);zt([We()],Tt.prototype,"tabContributions",2);zt([We()],Tt.prototype,"drawerOpen",2);zt([We()],Tt.prototype,"drawerSize",2);Tt=zt([qe("k-fastviews")],Tt);var Bd=Object.getOwnPropertyDescriptor,Vd=(n,e,t,r)=>{for(var i=r>1?void 0:r?Bd(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=a(i)||i);return i};function Hd(){let n=document.getElementById("global-dialog-container");return n||(n=document.createElement("div"),n.id="global-dialog-container",document.body.appendChild(n)),n}const Do=n=>{try{return new Intl.DisplayNames([n],{type:"language"}).of(n)||n.toUpperCase()}catch{return n.toUpperCase()}},Xd=()=>{const n=Xu.get(),e=new Set;for(const t of n)if(t.namespace){const r=t;for(const i in r)i!=="namespace"&&i!=="label"&&i!=="language"&&i!=="translations"&&typeof r[i]=="object"&&e.add(i)}return Array.from(e).sort()},Kd=async()=>{const n=Xd(),e=So.get();return new Promise(t=>{const r=Hd();let i=!1;const s=()=>{const h=r.querySelector("wa-dialog");h&&!i&&(h.open=!1)},a=()=>{i||(i=!0,Vt(S``,r),t())},l=async h=>{await Ue.set(is,h),s()},u=S`
            <wa-dialog 
                label="Select Language" 
                open 
                light-dismiss
                @wa-request-close=${s}
                @wa-after-hide=${a}>
                <style>
                    .language-list {
                        display: flex;
                        flex-direction: column;
                        gap: 0.5rem;
                        padding: 1rem;
                        min-width: 300px;
                        max-height: 400px;
                        overflow-y: auto;
                    }
                    
                    .language-item {
                        display: flex;
                        align-items: center;
                        padding: 0.75rem;
                        border-radius: var(--wa-border-radius-small);
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    
                    .language-item:hover {
                        background-color: var(--wa-color-neutral-fill-quiet);
                    }
                    
                    .language-item.active {
                        background-color: var(--wa-color-brand-fill-quiet);
                        font-weight: 600;
                    }
                    
                    .language-code {
                        font-family: monospace;
                        margin-right: 0.75rem;
                        min-width: 3rem;
                        color: var(--wa-color-neutral-600);
                    }
                    
                    .language-name {
                        flex: 1;
                    }
                </style>
                
                <div class="language-list">
                    ${n.map(h=>S`
                        <div 
                            class="language-item ${h===e?"active":""}"
                            @click=${()=>l(h)}>
                            <span class="language-code">${h.toUpperCase()}</span>
                            <span class="language-name">${Do(h)}</span>
                        </div>
                    `)}
                </div>
            </wa-dialog>
        `;Vt(u,r)})};let os=class extends tn{render(){const n=So.get(),e=Do(n),t=`${n.toUpperCase()} ${e}`;return S`
            <wa-button 
                appearance="plain" 
                size="small"
                title="Current language: ${e}"
                @click=${()=>Kd()}>
                ${t}
            </wa-button>
        `}};os.styles=Ze`
        :host {
            display: inline-block;
        }
    `;os=Vd([qe("k-language-selector")],os);var Yd=Object.defineProperty,Zd=Object.getOwnPropertyDescriptor,Ro=(n,e,t,r)=>{for(var i=r>1?void 0:r?Zd(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Yd(e,t,i),i};const Io="app-switcher";Q.registerContribution(Dn,{id:Io,label:"Switch Application",buttons:[so],component:n=>{const e=n?.apps||[],t=n?.currentAppId,r=n?.selectApp;return S`
            <wa-scroller orientation="vertical" style="min-width: 300px; max-height: 400px; padding: var(--wa-space-m);">
                <div style="display: flex; flex-direction: column; gap: var(--wa-space-s);">
                    ${e.map(i=>S`
                        <wa-card 
                            style="cursor: pointer;"
                            variant=${i.id===t?"brand":"neutral"}
                            @click=${()=>r(i)}>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--wa-space-xs);">
                                <span style="font-weight: 600;">${i.name}</span>
                                ${i.version?S`<wa-badge variant="neutral">v${i.version}</wa-badge>`:""}
                            </div>
                            ${i.description?S`<p style="margin: 0; font-size: 0.875rem; line-height: 1.4;">${i.description}</p>`:""}
                            <div style="font-size: 0.75rem; color: var(--wa-color-neutral-foreground-quiet); font-family: monospace; margin-top: var(--wa-space-xs);">ID: ${i.id}</div>
                        </wa-card>
                    `)}
                </div>
            </wa-scroller>
        `},onButton:async()=>!0});const Jd=async()=>{const n=At.getRegisteredApps(),e=At.getCurrentApp();if(n.length===0)return;const t={apps:n,currentAppId:e?.id,selectApp:async r=>{if(r.id===e?.id){t.close?.();return}try{await At.setPreferredAppId(r.id),await At.loadApp(r.id,document.body)}catch(i){console.error("Failed to switch app:",i)}finally{t.close?.()}},close:void 0};await Di.open(Io,t)};let bi=class extends tn{doBeforeUI(){this.currentApp=At.getCurrentApp();const n=()=>{this.currentApp=At.getCurrentApp(),this.requestUpdate()};return window.addEventListener("app-loaded",n),()=>{window.removeEventListener("app-loaded",n)}}render(){const n=At.getRegisteredApps(),e=this.currentApp?.name||"No App";return n.length<=1?S``:S`
            <wa-button 
                appearance="plain" 
                size="small"
                title="Current app: ${e}. Click to switch applications."
                @click=${()=>Jd()}>
                <wa-icon name="grip" style="margin-right: 0.5rem;"></wa-icon>
                ${e}
            </wa-button>
        `}};bi.styles=Ze`
        :host {
            display: inline-block;
        }
    `;Ro([We()],bi.prototype,"currentApp",2);bi=Ro([qe("k-app-switcher")],bi);const me=Ku("extensions");fe.registerExtension({id:"system.git",name:me("EXT_GIT_NAME"),description:me("EXT_GIT_DESC"),loader:()=>Le(()=>import("./git-extension-CAy4nbR--DTMnEsDG.js"),__vite__mapDeps([5,2,1,3,4,6])),icon:"code-branch",experimental:!0});fe.registerExtension({id:"system.github-service",name:me("EXT_GITHUB_SERVICE_NAME"),description:me("EXT_GITHUB_SERVICE_DESC"),loader:()=>Le(()=>import("./github-service-extension-Bwyvo7DZ-C-kuSNTI.js"),[]),icon:"code-branch"});fe.registerExtension({id:"system.pyterminal",name:me("EXT_PYTERMINAL_NAME"),description:me("EXT_PYTERMINAL_DESC"),loader:()=>Le(()=>import("./pyterminal-extension-pHe-9S4g-94Tt9WM-.js"),__vite__mapDeps([7,1,2,3,4,8,6])),icon:"k python",experimental:!0});fe.registerExtension({id:"system.linuxterminal",name:me("EXT_LINUXTERMINAL_NAME"),description:me("EXT_LINUXTERMINAL_DESC"),loader:()=>Le(()=>import("./k-linuxterminal-Gn34lZt_-y8Mw87Kf.js"),__vite__mapDeps([9,1,2,3,4,8,6])),icon:"terminal",experimental:!0});fe.registerExtension({id:"system.webllm",name:me("EXT_WEBLLM_NAME"),description:me("EXT_WEBLLM_DESC"),loader:()=>Le(()=>import("./webllmservice-CfQCj-vi-Dn53x9hW.js"),__vite__mapDeps([10,2,1,3,4,6])),icon:"robot"});fe.registerExtension({id:"system.p12splitter",name:me("EXT_P12SPLITTER_NAME"),description:me("EXT_P12SPLITTER_DESC"),loader:()=>Le(()=>import("./p12-splitter-CLd-jrC9-BBZSMt5A.js"),__vite__mapDeps([11,2,1,3,4,6])),icon:"certificate"});fe.registerExtension({id:"system.pythonpackagemanager",name:me("EXT_PYTHONPACKAGEMANAGER_NAME"),description:me("EXT_PYTHONPACKAGEMANAGER_DESC"),loader:()=>Le(()=>import("./package-manager-extension-Dam_bdu7-CjHTAJUW.js"),__vite__mapDeps([12,1,2,3,4,6])),icon:"box"});fe.registerExtension({id:"system.notebook",name:me("EXT_NOTEBOOK_NAME"),description:me("EXT_NOTEBOOK_DESC"),loader:()=>Le(()=>import("./notebook-extension-DvXaL_zr-CzAeqBDV.js"),__vite__mapDeps([13,2,1,3,4,6])),icon:"k jupyter",dependencies:["system.pythonpackagemanager"]});fe.registerExtension({id:"system.commandpalette",name:me("EXT_COMMANDPALETTE_NAME"),description:me("EXT_COMMANDPALETTE_DESC"),loader:()=>Le(()=>import("./command-palette-extension-BHP-LNWF-HuKo_E-f.js"),__vite__mapDeps([14,1,2,3,4,6])),icon:"terminal"});fe.registerExtension({id:"system.download",name:me("EXT_DOWNLOAD_NAME"),description:me("EXT_DOWNLOAD_DESC"),loader:()=>Le(()=>import("./download-extension-C0HpW3Ju-D8PCFgJC.js"),__vite__mapDeps([15,2,1,3,4,6])),icon:"download"});fe.registerExtension({id:"system.unzip",name:me("EXT_UNZIP_NAME"),description:me("EXT_UNZIP_DESC"),loader:()=>Le(()=>import("./unzip-extension-Bdq8VktW-DBdZadW7.js"),__vite__mapDeps([16,2,1,3,4,6])),icon:"box-archive"});fe.registerExtension({id:"system.mdeditor",name:me("EXT_MDEDITOR_NAME"),description:me("EXT_MDEDITOR_DESC"),loader:()=>Le(()=>import("./md-editor-extension-NNMGzJBp-C6Hxoz7U.js"),__vite__mapDeps([17,1,2,3,4,6])),icon:"book"});fe.registerExtension({id:"system.mediaviewer",name:me("EXT_MEDIAVIEWER_NAME"),description:me("EXT_MEDIAVIEWER_DESC"),loader:()=>Le(()=>import("./media-viewer-extension-BjSnv_2M-Bsp5KjMW.js"),__vite__mapDeps([18,1,2,3,4,6])),icon:"image"});fe.registerExtension({id:"system.monaco",name:me("EXT_MONACO_NAME"),description:me("EXT_MONACO_DESC"),loader:()=>Le(()=>import("./monaco-editor-extension-BhlPveq1-BF4nK4cN.js"),__vite__mapDeps([19,2,1,3,4,6])),icon:"file-pen",dependencies:["system.pythonpackagemanager"]});fe.registerExtension({id:"system.memoryusage",name:me("EXT_MEMORYUSAGE_NAME"),description:me("EXT_MEMORYUSAGE_DESC"),loader:()=>Le(()=>import("./memory-usage-extension-B_KVoe6C-RYW7UvMT.js"),__vite__mapDeps([20,1,2,3,4,6])),icon:"microchip"});fe.registerExtension({id:"system.webdav",name:me("EXT_WEBDAV_NAME"),description:me("EXT_WEBDAV_DESC"),loader:()=>Le(()=>import("./webdav-extension-Cyfz0fV9-BMNo9uab.js"),__vite__mapDeps([21,1,2,3,4,6])),icon:"cloud"});fe.registerExtension({id:"system.settings-tree",name:me("EXT_SETTINGS_TREE_NAME"),description:me("EXT_SETTINGS_TREE_DESC"),loader:()=>Le(()=>import("./settings-tree-extension-CFfvk7we-CoZZh9lE.js"),__vite__mapDeps([22,1,2,3,4,6])),icon:"sitemap"});fe.registerExtension({id:"system.in-browser-ml",name:me("EXT_IN_BROWSER_ML_NAME"),description:me("EXT_IN_BROWSER_ML_DESC"),loader:()=>Le(()=>import("./in-browser-ml-extension-BRq7giCu-CuFG3Z_t.js"),__vite__mapDeps([23,2,1,3,4,6])),icon:"brain"});fe.registerExtension({id:"system.ai-system",name:me("EXT_AI_SYSTEM_NAME"),description:me("EXT_AI_SYSTEM_DESC"),loader:()=>Le(()=>import("./ai-system-extension-DOA2eWoM-D_SEfv4G.js"),__vite__mapDeps([24,2,1,3,4,6])),icon:"robot",dependencies:["system.in-browser-ml"]});fe.registerExtension({id:"system.rag-system",name:me("EXT_RAG_SYSTEM_NAME"),description:me("EXT_RAG_SYSTEM_DESC"),loader:()=>Le(()=>import("./rag-system-extension-ZWtPqjPf-BABSZEzq.js").then(n=>n.b),__vite__mapDeps([25,2,1,3,4])),icon:"database",experimental:!0,dependencies:["system.ai-system"]});fe.registerExtension({id:"system.howto",name:me("EXT_HOWTO_NAME"),description:me("EXT_HOWTO_DESC"),loader:()=>Le(()=>import("./howto-extension-DTqPvdBZ-BCYrGF7U.js"),__vite__mapDeps([26,1,2,3,4,6])),icon:"list-check"});Q.registerContribution(tt,{target:tt,label:"Ollama (Local)",provider:{name:"ollama",model:"gemma3:12b",chatApiEndpoint:"https://<your-server>/v1/chat/completions",apiKey:""}});Q.registerContribution(tt,{target:tt,label:"OpenWebUI (Self Hosted)",provider:{name:"openwebui",model:"gemma3:12b",chatApiEndpoint:"https://<your-server>/api/v1/chat/completion",apiKey:""}});Q.registerContribution(tt,{target:tt,label:"OpenAI",provider:{name:"openai",model:"gpt-4.1",chatApiEndpoint:"https://api.openai.com/v1/chat/completions",apiKey:"<your api key>"}});Q.registerContribution(tt,{target:tt,label:"Groq",provider:{name:"groq",model:"llama-3.1-8b-instant",chatApiEndpoint:"https://api.groq.com/openai/v1/chat/completions",apiKey:"<your api key>"}});Q.registerContribution(tt,{target:tt,label:"Cerebras",provider:{name:"cerebras",model:"llama3.1-8b",chatApiEndpoint:"https://api.cerebras.ai/v1/chat/completions",apiKey:"<your api key>"}});Q.registerContribution(tt,{target:tt,label:"WebLLM",provider:{name:"webllm",model:"gemma-2-9b-it-q4f16_1-MLC",chatApiEndpoint:"",apiKey:"",parameters:{context_window_size:4096}}});Q.registerContribution(tt,{target:tt,label:"Mistral",provider:{name:"mistral",model:"mistral-large-latest",chatApiEndpoint:"https://api.mistral.ai/v1/chat/completions",apiKey:"<your api key>",ocrApiEndpoint:"https://api.mistral.ai/v1/ocr",ocrModel:"mistral-ocr-latest"}});Q.registerContribution(tt,{target:tt,label:"LiteLLM",provider:{name:"litellm",model:"gpt-3.5-turbo",chatApiEndpoint:"https://<your-server>/v1/chat/completions",apiKey:"<your api key>"}});Q.registerContribution(oi,{name:"filebrowser",label:"Workspace",icon:"folder-open",component:n=>S`<k-filebrowser id="${n}"></k-filebrowser>`});Q.registerContribution(hs,{name:"aiview",label:"AI",icon:"robot",component:n=>S`<k-aiview id="${n}"></k-aiview>`});Q.registerContribution("system.fastviews-bottomend",{name:"log-terminal",label:"Log Messages",icon:"list",component:n=>S`<k-log-terminal id="${n}"></k-log-terminal>`});Q.registerContribution(ds,{slot:"start",label:"Workspace",html:"<k-workspace-name></k-workspace-name>"});Q.registerContribution(Pr,{label:"Info",icon:"circle-info",command:"show_version_info",showLabel:!0});Q.registerContribution(Pr,{label:"Fast Views",html:'<k-fastviews target="system.fastviews-bottomend" icon="bolt" title="Fast Views"></k-fastviews>'});Q.registerContribution(Pr,{label:"Language",html:()=>S`<k-language-selector></k-language-selector>`});Q.registerContribution(Cn,{label:"App Switcher",html:()=>S`<k-app-switcher></k-app-switcher>`});const Ct=It("MarketplaceRegistry"),ya="events/marketplaceregistry/changed",wa="marketplace.catalogUrls";class Qd{constructor(){this.catalogUrls=[],this.loadingPromises=new Map,this.loadCatalogUrls().then(()=>{this.refreshCatalogs().catch(e=>{Ct.error(`Failed to refresh catalogs on init: ${e.message}`)})})}async loadCatalogUrls(){try{const e=await Ue.get(wa);this.catalogUrls=Array.isArray(e)?e:[],Ct.debug(`Loaded ${this.catalogUrls.length} catalog URLs`)}catch(e){Ct.error(`Failed to load catalog URLs: ${e}`),this.catalogUrls=[]}}async saveCatalogUrls(){await Ue.set(wa,this.catalogUrls),Oe(ya,{type:"catalogs",urls:this.catalogUrls})}async addCatalogUrl(e){if(!this.isValidUrl(e))throw new Error(`Invalid catalog URL: ${e}`);if(this.catalogUrls.includes(e)){Ct.debug(`Catalog URL already exists: ${e}`);return}this.catalogUrls.push(e),await this.saveCatalogUrls(),Ct.info(`Added catalog URL: ${e}`);try{await this.refreshCatalogs()}catch(t){Ct.warn(`Failed to refresh catalogs immediately after adding: ${t}`)}}async removeCatalogUrl(e){const t=this.catalogUrls.indexOf(e);t!==-1&&(this.catalogUrls.splice(t,1),await this.saveCatalogUrls(),Ct.info(`Removed catalog URL: ${e}`))}getCatalogUrls(){return[...this.catalogUrls]}isValidUrl(e){try{const t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}async fetchCatalog(e){const t=this.loadingPromises.get(e);if(t)return t;const r=(async()=>{try{Ct.debug(`Fetching catalog from: ${e}`);const i=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const s=await i.json();if(!s.extensions||!Array.isArray(s.extensions))throw new Error("Invalid catalog format: extensions array is required");const a={name:s.name,description:s.description,extensions:s.extensions||[]},l=a.extensions?.length||0;return Ct.debug(`Successfully fetched catalog from ${e}: ${l} extensions`),a}catch(i){throw Ct.error(`Failed to fetch catalog from ${e}: ${i}`),i}finally{this.loadingPromises.delete(e)}})();return this.loadingPromises.set(e,r),r}async refreshCatalogs(){Ct.info(`Refreshing ${this.catalogUrls.length} catalogs...`);const e=this.catalogUrls.map(r=>this.fetchCatalog(r).catch(i=>(Ct.warn(`Failed to refresh catalog ${r}: ${i.message}`),null)));(await Promise.allSettled(e)).forEach((r,i)=>{if(r.status==="fulfilled"&&r.value){const s=r.value;s.extensions&&s.extensions.forEach(a=>{if(!fe.getExtensions().find(l=>l.id===a.id)){const l={...a,external:!0};fe.registerExtension(l),Ct.debug(`Registered marketplace extension: ${a.id}`)}})}}),Oe(ya,{type:"refreshed"}),Ct.info("Catalog refresh completed")}getMarketplaceExtension(e){const t=fe.getExtensions().find(r=>r.id===e);if(t&&t.external)return t}isMarketplaceExtension(e){const t=fe.getExtensions().find(r=>r.id===e);return t!==void 0&&t.external===!0}}const Po=new Qd;ut.put("marketplaceRegistry",Po);const ba=It("MarketplaceCatalogContributions"),Vi=kr.marketplace?.catalogUrls;Vi&&Array.isArray(Vi)?Vi.forEach(n=>{Po.addCatalogUrl(n).catch(e=>{ba.warn(`Failed to add marketplace catalog ${n}: ${e}`)})}):ba.warn("No marketplace catalog URLs found in package.json");function ep(n){return new Worker("/assets/pyworker-_tLBWDbU.js",{type:"module",name:n?.name})}let Hi=null;async function tp(){return Hi||(Hi=Le(()=>import("./index-DAjG65pZ.js").then(n=>n.i),__vite__mapDeps([27,2]))),Hi}let np=0;class rp{constructor(){this.pendingMessages=new Map}async init(e,t){this.workspace=e,this.vars=t??{},this.worker=new ep,this.worker.onmessage=r=>{this.handleWorkerMessage(r.data)},this.worker.onerror=r=>{console.error("Python Worker error:",r)},await this.sendMessage("init",{vars:this.vars}),await this.mountWorkspace(),await this.installDependencies()}handleWorkerMessage(e){if(e.id==="interrupt-buffer"){e.type==="success"?this.interruptBuffer=new Uint8Array(e.payload):this.interruptBuffer=void 0;return}if(e.type==="inputRequest"){const r=e.payload.prompt||"Input:",i=window.prompt(r);this.worker.postMessage({id:e.id,type:"inputResponse",payload:{value:i,cancelled:i===null}});return}if(e.type==="stdout"){this.stdoutCallback?this.stdoutCallback(e.payload):console.info(e.payload);return}if(e.type==="stderr"){this.stderrCallback?this.stderrCallback(e.payload):console.error(e.payload);return}if(e.type==="console"){const{level:r,message:i}=e.payload;typeof window<"u"&&window.logToTerminal&&window.logToTerminal("Python Worker",i,r);return}const t=this.pendingMessages.get(e.id);t&&(this.pendingMessages.delete(e.id),e.type==="success"?t.resolve(e.payload):e.type==="error"&&t.reject(new Error(e.payload.message)))}async sendMessage(e,t){if(!this.worker)throw new Error("PyEnv not initialized yet: see init()");const r=`msg-${np++}`,i={id:r,type:e,payload:t};return new Promise((s,a)=>{this.pendingMessages.set(r,{resolve:s,reject:a}),this.worker.postMessage(i)})}setStdoutCallback(e){this.stdoutCallback=e}setStderrCallback(e){this.stderrCallback=e}async runFunction(e,t){const r=await this.sendMessage("runFunction",{name:e,args:t});return Oe(Bt,this.workspace),r}async setGlobal(e,t){await this.sendMessage("setGlobal",{key:e,value:t})}async mountWorkspace(e="/workspace"){const t=await et.getWorkspace();await this.sendMessage("mountWorkspace",{handle:t.getHandle(),mountPoint:e})}async installDependencies(){const e=await this.workspace?.getResource("requirements.txt");if(e){const t=(await e.getContents()).replaceAll("\r",""),{parsePipRequirementsFile:r}=await tp(),i=r(t).filter(s=>"name"in s).map(s=>s.name);await this.loadPackages(i)}}async loadPackages(e){e.length>0&&await this.sendMessage("loadPackages",{packages:e})}async syncWorkspace(){await this.sendMessage("syncWorkspace"),Oe(Bt,this.workspace)}async execCode(e){const t=await this.sendMessage("execCode",{code:e});return Oe(Bt,this.workspace),t}async execScript(e){const t=e.split(".")[0],r=e.includes(":")?e.split(":").reverse()[0]:void 0;return await this.execModule(t,r)}async execModule(e,t){const r=await this.sendMessage("execModule",{moduleName:e,entryName:t,vars:this.vars});return Oe(Bt,this.workspace),r}async getVersion(){return await this.sendMessage("getVersion")}canInterrupt(){return this.interruptBuffer!==void 0}interrupt(){this.interruptBuffer&&(this.interruptBuffer[0]=2)}close(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.pendingMessages.clear()}}class ip{constructor(){this.packages=[]}addPackage(e){this.packages.push(e)}hasPackages(){return this.packages.length>0&&this.packages.some(e=>e.dependencies&&Object.keys(e.dependencies).length>0)}renderTree(){return this.packages.length===0?S``:S`
            <wa-tree style="--indent-guide-width: 1px;">
                ${this.packages.map(e=>{const t=e.dependencies||{},r=Object.entries(t);return r.length===0?S``:S`
                        <wa-tree-item expanded>
                            <span>${e.name}</span>
                            ${r.map(([i,s])=>S`
                                <wa-tree-item>
                                    <span>${i} <small>${s}</small></span>
                                </wa-tree-item>
                            `)}
                        </wa-tree-item>
                    `})}
            </wa-tree>
        `}}const vi=new ip;var sp=Object.defineProperty,ap=Object.getOwnPropertyDescriptor,Vr=(n,e,t,r)=>{for(var i=r>1?void 0:r?ap(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&sp(e,t,i),i};let rr=class extends Ds{constructor(){super(...arguments),this.showBottomSidebar=!1,this.showBottomPanel=!1,this.showLeftSidebar=!0,this.showAuxSidebar=!0}createRenderRoot(){return this}getGridSizes(){return this.showLeftSidebar&&this.showAuxSidebar?"15%, 65%, 20%":this.showLeftSidebar?"15%, 85%":this.showAuxSidebar?"80%, 20%":"100%"}render(){return S`
            <style>
                *, *::before, *::after {
                    box-sizing: border-box;
                }
                
                html {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                }
                
                body {
                    height: 100%;
                    width: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                }
                
                k-standard-app {
                    display: flex;
                    flex-direction: column;
                    height: 100vh;
                    width: 100%;
                }
                
                k-standard-app .toolbar-top {
                    width: 100%;
                    display: grid;
                    grid-template-columns: 1fr 2fr 1fr;
                    align-items: center;
                    border-bottom: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    flex-shrink: 0;
                }
                
                k-standard-app .toolbar-bottom {
                    width: 100%;
                    border-top: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    display: grid;
                    grid-template-columns: 1fr 2fr auto;
                    align-items: center;
                    flex-shrink: 0;
                    min-height: 32px;
                    padding: 0 var(--wa-space-s);
                    box-sizing: border-box;
                }
                
                k-standard-app .main-layout {
                    flex: 1;
                    min-height: 0;
                }
                
                k-standard-app .toolbar-end {
                    justify-self: end;
                }
            </style>
            
            <div class="toolbar-top">
                <k-toolbar id=${us}></k-toolbar>
                <k-toolbar id=${Ia}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${Cn}></k-toolbar>
            </div>
            
            <k-resizable-grid 
                class="main-layout"
                id="main-layout" 
                orientation="horizontal" 
                sizes=${this.getGridSizes()}>
                
                ${this.showLeftSidebar?S`
                        ${this.showBottomSidebar?S`
                                <k-resizable-grid 
                                    id="left-sidebar-split" 
                                    orientation="vertical" 
                                    sizes="50%, 50%">
                                    <k-tabs id="${oi}"></k-tabs>
                                    <k-tabs id="${ps}"></k-tabs>
                                </k-resizable-grid>
                            `:S`<k-tabs id="${oi}"></k-tabs>`}
                    `:Ve}
                
                ${this.showBottomPanel?S`
                        <k-resizable-grid 
                            id="editor-area-split" 
                            orientation="vertical" 
                            sizes="70%, 30%">
                            <k-tabs id="${wn}"></k-tabs>
                            <k-tabs id="${Pa}"></k-tabs>
                        </k-resizable-grid>
                    `:S`<k-tabs id="${wn}"></k-tabs>`}
                
                ${this.showAuxSidebar?S`<k-tabs id="${hs}"></k-tabs>`:Ve}
            </k-resizable-grid>
            
            <div class="toolbar-bottom">
                <k-toolbar id=${ds}></k-toolbar>
                <k-toolbar id=${Ai}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${Pr}></k-toolbar>
            </div>
        `}};Vr([le({type:Boolean,attribute:"show-bottom-sidebar"})],rr.prototype,"showBottomSidebar",2);Vr([le({type:Boolean,attribute:"show-bottom-panel"})],rr.prototype,"showBottomPanel",2);Vr([le({type:Boolean,attribute:"show-left-sidebar"})],rr.prototype,"showLeftSidebar",2);Vr([le({type:Boolean,attribute:"show-aux-sidebar"})],rr.prototype,"showAuxSidebar",2);rr=Vr([qe("k-standard-app")],rr);const op={enhance:async(n,e)=>{try{const t=await et.getWorkspace(),r=xn.getEditorArea()?.getActiveEditor(),i={workspace:t?.getName()||null,activeEditor:r?{title:r.input?.title||null,editorId:r.input?.editorId||null}:null},s=`***App's state:***
${JSON.stringify(i,null,2)}`;return`${n}

${s}`}catch{return n}},priority:20};Q.registerContribution(qr,{label:"App State Enhancer",enhancer:op});const wr=It("HowToService"),Ei="system.howtos";class lp{constructor(){this.contributions=new Map,this.loadContributions(),Ke(Ht,e=>{e.target===Ei&&this.loadContributions()})}loadContributions(){const e=Q.getContributions(Ei);this.contributions.clear();for(const t of e){if(!t.id){wr.warn("HowTo contribution missing id, skipping");continue}if(!t.label){const s=typeof t.title=="function"?t.title():t.title;t.label=s}if(!t.steps||t.steps.length===0){wr.warn(`HowTo contribution "${t.id}" has no steps, skipping`);continue}const r=new Set;for(const s of t.steps){if(r.has(s.id)){wr.warn(`HowTo contribution "${t.id}" has duplicate step ID: "${s.id}"`);continue}r.add(s.id)}this.contributions.set(t.id,t);const i=typeof t.title=="function"?t.title():t.title;wr.debug(`Loaded HowTo contribution: ${i} (${t.id})`)}wr.info(`Loaded ${this.contributions.size} HowTo contributions`)}getContribution(e){return this.contributions.get(e)}getAllContributions(){return Array.from(this.contributions.values())}getContributionsByCategory(e){return Array.from(this.contributions.values()).filter(t=>t.category===e)}hasContribution(e){return this.contributions.has(e)}}const uh=new lp,ki="welcome.txt";function cp(n){return n&&typeof n.getFilePath=="function"}async function up(){return et.isConnected()}async function va(){const n=await et.getWorkspace();if(!n)return!1;try{return await n.getResource(ki)instanceof St}catch{return!1}}function $r(){const n=Ut.get();return!n||!cp(n)?!1:n.getFilePath()===ki}function dp(){if(!$r())return!1;const n=Ut.get();return n?n.isDirty()===!1:!1}function pp(){return!$r()}function Ea(){return At.getCurrentApp()?.name||"AppSpace"}const hp={id:"appspace.onboarding",title:()=>`Welcome to ${Ea()}`,description:()=>`Get started with ${Ea()} by learning the basics of workspace and file management`,icon:"graduation-cap",label:"",category:"Getting Started",initialize:n=>{const e=[];return Ke(Bt,()=>{n.requestUpdate()}),Ke(Qn,()=>{n.requestUpdate()}),e.push(er(Ut,()=>{n.requestUpdate()})),e.push(er(Dr,()=>{n.requestUpdate()})),()=>{e.forEach(t=>t())}},steps:[{id:"create-text-file",title:"Create welcome.txt",description:`Create a new text file called "welcome.txt" in your workspace. If you don't have a workspace selected, choose one first.`,preCondition:async()=>await up(),postCondition:async()=>await va(),command:"create_file",commandParams:{path:ki,contents:`Welcome to AppSpace!

This is your first file. You can edit it and save your changes.`}},{id:"open-text-file",title:"Open welcome.txt",description:'Open the "welcome.txt" file in the editor.',preCondition:async()=>await va(),postCondition:()=>$r(),command:"open_editor",commandParams:{path:ki}},{id:"edit-and-save",title:"Type something and save",description:"Type some text in the editor to modify the file, then save it using Ctrl+S or the save button.",preCondition:()=>$r(),postCondition:()=>dp()},{id:"close-text-file",title:"Close the file",description:"Close the editor tab by clicking the X button on the tab.",preCondition:()=>$r(),postCondition:()=>pp()}]};Q.registerContribution(Ei,hp);const Lo=".system.ai-config";function Mo(n){return n&&typeof n.getFilePath=="function"}function Or(){const n=Ut.get();return!n||!Mo(n)?!1:n.getFilePath()===Lo}async function ka(){try{const n=await Ue.get(yn);if(!n||!n.defaultProvider)return!1;const e=n.providers?.find(t=>t.name===n.defaultProvider);return e?!!e.apiKey&&e.apiKey.trim()!=="":!1}catch{return!1}}function fp(){const n=Ut.get();return!n||!Mo(n)||n.getFilePath()!==Lo?!1:n.isDirty()===!0}function gp(){return Or()?!fp():!1}function mp(){return!Or()}async function yp(){try{const n=await Ue.get("aiChatSessions");if(!n||typeof n!="object")return!1;for(const e in n){const t=n[e];if(t?.history&&Array.isArray(t.history)&&t.history.some(i=>i.role==="user"&&i.content&&i.content.trim()!==""))return!0}return!1}catch{return!1}}function Ca(){return At.getCurrentApp()?.name||"AppSpace"}const wp={id:"appspace.ai-setup",title:()=>`Set up AI in ${Ca()}`,description:()=>`Configure an LLM provider to enable AI chat features in ${Ca()}`,icon:"robot",label:"",category:"Getting Started",initialize:n=>{const e=[];return e.push(er(Ut,()=>{n.requestUpdate()})),e.push(er(Dr,()=>{n.requestUpdate()})),Ke(Ri,()=>{n.requestUpdate()}),()=>{e.forEach(t=>t())}},steps:[{id:"open-ai-settings",title:"Open AI Settings",description:"Open the AI settings editor by clicking the robot icon in the toolbar or using the command palette.",preCondition:()=>!0,postCondition:()=>Or(),command:"open_ai_config"},{id:"configure-llm-provider",title:"Configure LLM Provider",description:"Select a provider as default and enter an API key. Make sure to save your changes using Ctrl+S or the save button.",preCondition:()=>Or(),postCondition:async()=>{const n=await ka(),e=gp();return n&&e}},{id:"save-and-close",title:"Save and Close",description:"Save your changes (if not already saved) and close the AI settings editor tab.",preCondition:()=>Or(),postCondition:()=>mp()},{id:"type-in-chat",title:"Type in Chat",description:"Open the AI chat view (if not already open) and type a message to test your AI configuration.",preCondition:async()=>await ka(),postCondition:async()=>await yp()}]};Q.registerContribution(Ei,wp);async function Li(n,e=!0){const t=await et.getWorkspace();if(!t)return null;const r=n?.path;return e&&!r?null:{workspace:t,path:r||""}}function js(n){return n&&typeof n.getContent=="function"&&typeof n.getSelection=="function"&&typeof n.getSnippet=="function"&&typeof n.getLanguage=="function"&&typeof n.getFilePath=="function"}async function No(n,e){let t;const r=n.params?.path;if(r){const i=await et.getWorkspace();i&&(t=await i.getResource(r))}return t||(t=Mt.get()),t}async function Mi(n){try{const e=await n.getContents();return typeof e!="string"?(ge("File is not a text file"),null):e}catch(e){return ge(`Failed to read file: ${e.message}`),null}}function bn(n=!1){const e={filePath:null,language:null};return n?{...e,snippet:null,cursorLine:null}:e}async function Hr(n,e=!0){const t=await Li(n,e);if(!t)return null;const{workspace:r,path:i}=t;if(!i)return null;try{const s=await r.getResource(i);return!s||!(s instanceof St)?null:{workspace:r,path:i,file:s}}catch{return null}}Se({command:{id:"create_file",name:"Create new file",description:"Creates a new file within the workspace. For .geospace map files, use create_map_file instead.",keyBinding:"CTRL+N",parameters:[{name:"path",description:"the path including name of the file to be created, must be relative to the workspace",required:!1},{name:"contents",description:"the textual contents of the file",required:!1},{name:"ask",description:"whether to prompt the user for the file path",required:!1},{name:"extension",description:"required file extension (e.g., '.geospace'), will be appended if missing",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async({params:n})=>{let e=n?.path;const t=n?.contents,r=n?.ask,i=n?.extension;if((r||!e)&&(e=await Fr("Enter path to new file (directories will be created if not exist):",e||""),!e))return;i&&!e.endsWith(i)&&(e+=i);const s=await Li({path:e},!0);if(!s)return;const{workspace:a}=s;if(await a.getResource(e)&&!await Wr(`File "${e}" already exists. Do you want to overwrite it?`))return;const u=await a.getResource(e,{create:!0});return u?(t&&await u.saveContents(t),ve.info("File created: "+e)):ge("Could not create file: "+e),e}}});Se({command:{id:"rename_resource",name:"Rename a resource (file or directory)",description:"Renames a resource (file or directory)",keyBinding:"F2",parameters:[{name:"path",description:"the path of the resource within the workspace to rename or the currently active selection",required:!1},{name:"newName",description:"the new name for the resource",required:!1}]},handler:{execute:async n=>{const e=await No(n);if(!e){ge("No resource to rename provided!");return}const t=e.getName(),r=n.params?.newName||await Fr(`Enter new name for "${t}":`,t);if(!(!r||r===t))try{await e.rename(r),yt(`Resource renamed to: ${r}`)}catch(i){ge(`Failed to rename ${t}: ${i.message}`)}}}});Se({command:{id:"delete_resource",name:"Delete a resource (file or directory)",description:"Deletes a resource (file or directory)",parameters:[{name:"path",description:"the path of the resource within the workspace to delete or the currently active selection",required:!1},{name:"confirm",description:"whether to ask the user to confirm the deletion, true by default",required:!1}]},handler:{execute:async n=>{const e=await No(n);if(!e){ge("No resource to delete provided!");return}const t=e.getWorkspacePath(),r=n.params&&n.params.confirm;let i=!0;if((r===void 0||r===!0)&&(i=await Wr(`Are you sure you want to delete ${t}?`)),i)try{await e.delete(),yt("Resource deleted: "+t)}catch(s){ge(`Resource ${t} could not be deleted: ${s.message||s}`)}}}});Se({command:{id:"load_workspace",name:"Local Folder",description:"Connect to a local folder using File System Access API",parameters:[]},handler:{execute:async n=>{await window.showDirectoryPicker({mode:"readwrite"}).then(e=>et.connectWorkspace(e)).catch(e=>{ge(e.message)})}},contribution:{target:"filebrowser.connections",label:"Local Folder",icon:"folder-open"}});Se({command:{id:"reload_workspace",name:"Reload workspace folder",description:"Reloads the active workspace folder",parameters:[]},handler:{execute:async n=>{const e=await et.getWorkspace();e||ge("No workspace selected."),e.touch()}}});Se({command:{id:"open_editor",name:"Open editor",description:"Opens a file in an editor",parameters:[{name:"path",description:"tha path of the file to open within the workspace",required:!0}]},handler:{execute:async n=>{const e=await Hr({path:n.params?.path});if(!e)return;const{file:t}=e;await xn.loadEditor(t)}}});Se({command:{id:"head_file",name:"Head - Show first lines",description:"Shows the first N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the beginning (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the first N lines of the file"}]},handler:{execute:async({params:n})=>{const e=await Hr(n);if(!e)return;const{file:t}=e,r=n?.lines?parseInt(n.lines,10):10;if(isNaN(r)||r<1){ge("Number of lines must be a positive integer");return}const i=await Mi(t);return i?i.split(`
`).slice(0,r).join(`
`):void 0}}});Se({command:{id:"tail_file",name:"Tail - Show last lines",description:"Shows the last N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the end (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the last N lines of the file"}]},handler:{execute:async({params:n})=>{const e=await Hr(n);if(!e)return;const{file:t}=e,r=n?.lines?parseInt(n.lines,10):10;if(isNaN(r)||r<1){ge("Number of lines must be a positive integer");return}const i=await Mi(t);return i?i.split(`
`).slice(-r).join(`
`):void 0}}});Se({command:{id:"cat_file",name:"Cat - Show file contents",description:"Shows the complete contents of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0}],output:[{name:"content",description:"the complete contents of the file"}]},handler:{execute:async({params:n})=>{const e=await Hr(n);if(!e)return;const{file:t}=e;return await Mi(t)}}});Se({command:{id:"wc_file",name:"Word count",description:"Counts lines, words, and characters in a file",parameters:[{name:"path",description:"the path of the file to analyze",required:!0}],output:[{name:"lines",description:"number of lines in the file"},{name:"words",description:"number of words in the file"},{name:"characters",description:"number of characters in the file"}]},handler:{execute:async({params:n})=>{const e=await Hr(n);if(!e)return;const{file:t}=e,r=await Mi(t);if(!r)return;const s=r.split(`
`).length,a=r.trim()===""?0:r.trim().split(/\s+/).filter(u=>u.length>0).length,l=r.length;return{lines:s,words:a,characters:l}}}});Se({command:{id:"file_exists",name:"Check if file exists",description:"Checks if a file exists at the given path",parameters:[{name:"path",description:"the path of the file to check, relative to the workspace",required:!0}],output:[{name:"exists",description:"true if the file exists, false otherwise"}]},handler:{execute:async({params:n})=>{const e=await Li(n);if(!e)return!1;const{workspace:t,path:r}=e;try{return await t.getResource(r)instanceof St}catch{return!1}}}});async function Uo(n){const e=[],t=await n.listChildren(!0);for(const r of t)if(r instanceof St)e.push(r.getWorkspacePath());else if(r instanceof Kn){const i=await Uo(r);e.push(...i)}return e}Se({command:{id:"ls",name:"List files",description:"Lists files from a directory. If recursive is provided, it traverses from the provided directory down to all leaves. If no directory is provided, it will traverse from the workspace root.",parameters:[{name:"path",description:"the path of the directory to list, relative to the workspace. If not provided, uses workspace root",required:!1},{name:"recursive",description:"whether to recursively traverse all subdirectories",type:"boolean",required:!1}],output:[{name:"files",description:"array of file objects with path and size information"}]},handler:{execute:async({params:n})=>{const e=await Li(n,!1);if(!e)return ge("No workspace available"),[];const{workspace:t,path:r}=e,i=n?.recursive===!0||n?.recursive==="true";try{let s=t;if(r){const a=await t.getResource(r);if(!a)return ge(`Path not found: ${r}`),[];if(!(a instanceof Kn))return ge(`Path is not a directory: ${r}`),[];s=a}if(i){const a=await Uo(s),l=[];for(const u of a){const h=await t.getResource(u);if(h instanceof St){const T=await h.size();l.push({path:u,size:T})}}return l}else{const a=await s.listChildren(!0),l=[];for(const u of a)if(u instanceof St){const h=await u.size();l.push({path:u.getWorkspacePath(),size:h})}return l}}catch(s){return ge(`Failed to list files: ${s.message}`),[]}}}});Se({command:{id:"get_active_editor_content",name:"Get active editor content",description:"Gets the complete contents of the currently active editor. Returns null if no editor is active or if the editor is not a code editor.",parameters:[],output:[{name:"content",description:"the complete contents of the active editor, or null if no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"}]},handler:{execute:async n=>{const e=n.activeEditor;if(!js(e))return{...bn(),content:null};try{return{content:e.getContent(),filePath:e.getFilePath(),language:e.getLanguage()}}catch{return{...bn(),content:null}}}}});Se({command:{id:"get_active_editor_selection",name:"Get active editor selection",description:"Gets the currently selected text in the active editor. Returns null if no editor is active, no selection exists, or if the editor is not a code editor.",parameters:[],output:[{name:"selection",description:"the selected text in the active editor, or null if no selection exists or no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"}]},handler:{execute:async n=>{const e=n.activeEditor;if(!js(e))return{...bn(),selection:null};try{return{selection:e.getSelection(),filePath:e.getFilePath(),language:e.getLanguage()}}catch{return{...bn(),selection:null}}}}});Se({command:{id:"get_active_editor_snippet",name:"Get active editor snippet around cursor",description:"Gets a code snippet from the active editor with n lines before and n lines after the cursor position. Useful for getting context around the cursor without loading the entire file.",parameters:[{name:"lines",description:"number of lines to include before and after the cursor position (default: 5)",type:"number",required:!1}],output:[{name:"snippet",description:"the code snippet with n lines before and after the cursor, or null if no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"},{name:"cursorLine",description:"the line number where the cursor is positioned (1-based), or null if no editor is active"}]},handler:{execute:async n=>{const e=n.activeEditor;if(!js(e))return bn(!0);try{const t=n.params?.lines?parseInt(n.params.lines,10):5;if(isNaN(t)||t<0)return bn(!0);const r=e.getSnippet(t);return r?{snippet:r.snippet,filePath:e.getFilePath(),language:e.getLanguage(),cursorLine:r.cursorLine}:bn(!0)}catch{return bn(!0)}}}});Se({command:{id:"show_version_info",name:"Show Version Info",description:"Shows application version information",parameters:[]},handler:{execute:async n=>{const e=At.getCurrentApp();if(!e){ge("No app loaded");return}const t=vi.hasPackages(),r=vi.renderTree();let i=null;const s=()=>(i||(i=document.getElementById("global-dialog-container")||document.createElement("div"),i.id||(i.id="global-dialog-container",document.body.appendChild(i))),i),a=()=>{i&&Vt(S``,i)},l=ee=>{const Y=Pe.parse(ee,{async:!1});return S`${Ir(Y)}`};let u=[];if(e.releaseHistory)if(typeof e.releaseHistory=="function")try{u=await e.releaseHistory()}catch(ee){console.error("Failed to load release history from app:",ee),u=[]}else u=e.releaseHistory;e.version;const h=u.length>0?u.findIndex(ee=>ee.tag_name===e.version):-1,T=h>=0?h:0;let E=T;const v=ee=>{if(u.length===0)return"";const Y=u[ee],G=Y.tag_name===e.version;let O=`**Version:** ${Y.tag_name}`;G&&(O+=" (Current)"),O+=`

`;const U=new Date(Y.published_at).toLocaleDateString();if(O+=`**Released:** ${U}

`,!G){const P=e.version.replace(/^v/,""),x=Y.tag_name.replace(/^v/,""),L=P.split(".").map(Number),j=x.split(".").map(Number);let de=!1;for(let pe=0;pe<Math.max(L.length,j.length);pe++){const ne=L[pe]||0,R=j[pe]||0;if(R>ne){de=!0;break}if(R<ne)break}de&&(O+=`âš ï¸ **Update available - reload page to update**

`)}return Y.body&&(O+=`---

${Y.body}`),O},k=()=>{a()},_=()=>{a()},q=ee=>{const Y=v(ee),G=u.length>0,O=S`
                    <wa-dialog 
                        label="About ${e.name} - ${e.version}"
                        open 
                        light-dismiss
                        style="--width: 600px;"
                        @wa-request-close=${k}
                        @wa-after-hide=${_}
                    >
                        <style>
                            .dialog-content {
                                height: 600px;
                            }
                            
                            wa-tree-item > span small {
                                color: var(--wa-color-neutral-60);
                                font-size: 0.875em;
                                margin-left: 0.5rem;
                            }
                        </style>
                        <small>${e.description}</small>
                        <div class="dialog-content">
                            <wa-tab-group>
                                ${u.length>0?S`
                                    <wa-tab slot="nav" panel="release">Release History</wa-tab>
                                    <wa-tab-panel name="release">
                                        ${l(Y)}
                                    </wa-tab-panel>
                                `:""}
                                
                                ${t?S`
                                    <wa-tab slot="nav" panel="packages">NPM Packages</wa-tab>
                                    <wa-tab-panel name="packages">
                                        ${r}
                                    </wa-tab-panel>
                                `:""}
                            </wa-tab-group>
                        </div>
                        <div slot="footer">
                            ${G?S`
                                <wa-button 
                                    variant="default"
                                    ?disabled=${ee===u.length-1}
                                    @click=${()=>{ee<u.length-1&&(E=ee+1,q(E))}}
                                >
                                    â† Previous
                                </wa-button>
                                <wa-button 
                                    variant="default"
                                    ?disabled=${ee===0}
                                    @click=${()=>{ee>0&&(E=ee-1,q(E))}}
                                >
                                    Next â†’
                                </wa-button>
                            `:""}
                            <wa-button variant="primary" data-dialog="close">Close</wa-button>
                        </div>
                    </wa-dialog>
                `;Vt(O,s())};return q(T),new Promise(ee=>{const Y=()=>{i?.querySelector("wa-dialog[open]")?setTimeout(Y,100):ee()};Y()})}}});Se({command:{id:"python",name:"Run Python Script",description:"Executes a Python script given its file path",parameters:[{name:"script",description:"the path to a Python script to run",required:!1}]},handler:{execute:async n=>{const e=n.params.script;if(!e)return;const t=new rp,r=await et.getWorkspace();await t.init(r,n),await t.installDependencies(),await t.execScript(e)}}});Se({command:{id:"js",name:"Run JavaScript file",description:"Executes a JavaScript file given its path",parameters:[{name:"script",description:"the path to a JavaScript file to run",required:!1}]}});Se({command:{id:"save",name:"Save editor",description:"Saves the active/focused editor",keyBinding:"CTRL+S",parameters:[]},handler:{execute:async n=>{const e=Ut.get()||Re.get();e&&e.isDirty()&&e.save()}},contribution:{target:"toolbar:.system.editors",icon:"floppy-disk",label:"Save active editor",slot:"start",disabled:()=>{const n=Re.get();return!n||!n.isDirty()}}});Se({command:{id:"run_python",name:"Run Python Cell",description:"Runs active Python code in a supporting context (e.g. notebook, terminal, etc.)",keyBinding:"CTRL+R",parameters:[]}});const zo="theme";async function Fo(n){const e=document.documentElement;e.classList.remove("wa-dark","wa-light"),e.classList.add(n)}async function bp(){const n=await Ue.get(zo);await Fo(n||"wa-dark")}async function vp(n){await Ue.set(zo,n)}Se({command:{id:"switch_theme",name:"Switch theme",description:"Switches between dark and light theme",parameters:[]},handler:{execute:async n=>{const t=document.documentElement.classList.contains("wa-dark")?"wa-light":"wa-dark";await Fo(t),await vp(t)}},contribution:{target:Cn,icon:"circle-half-stroke",label:"Theme Switcher"}});bp().catch(n=>{console.error("Failed to load theme preference:",n)});Se({command:{id:"fullscreen",name:"Toggle fullscreen",description:"Toggles fullscreen mode",parameters:[]},handler:{execute:async n=>{document.fullscreenElement===document.body?await document.exitFullscreen():await document.body.requestFullscreen()}},contribution:{target:Cn,icon:"expand",label:"Fullscreen"}});Se({command:{id:"open_settings",name:"Open Settings",description:"Opens the settings file in an editor",parameters:[]},handler:{execute:async n=>{await Le(()=>import("./k-monaco-editor-CZiHNKA0-CLJMyj7w.js"),__vite__mapDeps([28,29,2,30,1,3,4,12,6]));const e={title:"settings.json",data:{async getContents(){const t=await Ue.getAll();return JSON.stringify(t,void 0,2)},getName(){return e.key},saveContents(t){const r=JSON.parse(t);return Ue.setAll(r)}},key:"setting.json",editorId:"monaco-editor",icon:"gear",state:{}};e.widgetFactory=()=>S`
                <k-monaco-editor .input=${e}></k-monaco-editor>`,xn.loadEditor(e).then()}},contribution:{target:Cn,icon:"gear",label:"Open Settings"}});Se({command:{id:"open_extensions",name:"Open Extensions",description:"Opens the extensions registry",parameters:[]},handler:{execute:n=>{const e={title:"Extensions",data:{},key:"system.extensions",editorId:"extensions-editor",icon:"puzzle-piece",state:{},noOverflow:!0};e.widgetFactory=()=>S`
                <k-extensions></k-extensions>`,xn.loadEditor(e).then()}},contribution:{target:Cn,icon:"puzzle-piece",label:"Open Extensions"}});Se({command:{id:"list_extensions",name:"List extensions",description:"Lists all available extensions with their status (enabled/disabled)",parameters:[],output:[{name:"extensions",description:"array of extension objects with id, name, description, experimental flag, and enabled status"}]},handler:{execute:async n=>fe.getExtensions().map(t=>({id:t.id,name:t.name,description:t.description,experimental:t.experimental,enabled:fe.isEnabled(t.id)}))}});Se({command:{id:"toast_message",name:"Toast message to user",description:"Shows a toast message",parameters:[{name:"message",description:"the message to toast",required:!0},{name:"type",description:"the toast type: info (default), or error",required:!1}]},handler:{execute:({params:{message:n,type:e}})=>{n&&(e==="error"?ge(n):yt(n))}}});vi.addPackage({name:kr.name,version:kr.version,dependencies:kr.dependencies,devDependencies:kr.devDependencies});function Yn(n,e){return n.layers.find(t=>t.uuid===e)}function Zn(n,e){return n.layers.findIndex(t=>t.uuid===e)}function Ep(n,e){return n.controls.findIndex(t=>t.uuid===e)}function kp(n,e){return n.overlays.findIndex(t=>t.uuid===e)}const xa=n=>new Proxy({},{get:(e,t)=>async(...r)=>{for(const i of n)await i[t](...r)}});function ri(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Xi={exports:{}},Aa;function Cp(){return Aa||(Aa=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function(){function t(r,i,s){function a(h,T){if(!i[h]){if(!r[h]){var E=typeof ri=="function"&&ri;if(!T&&E)return E(h,!0);if(l)return l(h,!0);var v=new Error("Cannot find module '"+h+"'");throw v.code="MODULE_NOT_FOUND",v}var k=i[h]={exports:{}};r[h][0].call(k.exports,function(_){var q=r[h][1][_];return a(q||_)},k,k.exports,t,r,i,s)}return i[h].exports}for(var l=typeof ri=="function"&&ri,u=0;u<s.length;u++)a(s[u]);return a}return t})()({1:[function(t,r,i){const s=t("./utils"),a=(function(){const l=s.stringToArray,u=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],h=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],T=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],E=["Thousand","Million","Billion","Trillion"];function v(C,D){var A=function(W,z,I){var F="";if(W<=19)F=(z?" and ":"")+(I?h[W]:u[W]);else if(W<100){const xe=Math.floor(W/10),Te=W%10;F=(z?" and ":"")+T[xe-2],Te>0?F+="-"+A(Te,!1,I):I&&(F=F.substring(0,F.length-1)+"ieth")}else if(W<1e3){const xe=Math.floor(W/100),Te=W%100;F=(z?", ":"")+u[xe]+" Hundred",Te>0?F+=A(Te,!0,I):I&&(F+="th")}else{var se=Math.floor(Math.log10(W)/3);se>E.length&&(se=E.length);const xe=Math.pow(10,se*3),Te=Math.floor(W/xe),te=W-Te*xe;F=(z?", ":"")+A(Te,!1,!1)+" "+E[se-1],te>0?F+=A(te,!0,I):I&&(F+="th")}return F},M=A(C,!1,D);return M}const k={};u.forEach(function(C,D){k[C.toLowerCase()]=D}),h.forEach(function(C,D){k[C.toLowerCase()]=D}),T.forEach(function(C,D){const A=C.toLowerCase();k[A]=(D+2)*10,k[A.substring(0,C.length-1)+"ieth"]=k[A]}),k.hundredth=100,E.forEach(function(C,D){const A=C.toLowerCase(),M=Math.pow(10,(D+1)*3);k[A]=M,k[A+"th"]=M});function _(C){const A=C.split(/,\s|\sand\s|[\s\\-]/).map(z=>k[z]);let M=[0];return A.forEach(z=>{if(z<100){let I=M.pop();I>=1e3&&(M.push(I),I=0),M.push(I+z)}else M.push(M.pop()*z)}),M.reduce((z,I)=>z+I,0)}const q=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],ee={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function Y(C){for(var D=0;D<q.length;D++){const A=q[D];if(C>=A[0])return A[1]+Y(C-A[0])}return""}function G(C){for(var D=0,A=1,M=C.length-1;M>=0;M--){const W=C[M],z=ee[W];z<A?D-=z:(A=z,D+=z)}return D}function O(C,D){for(var A=[],M=D.charCodeAt(0);C>0;)A.unshift(String.fromCharCode((C-1)%26+M)),C=Math.floor((C-1)/26);return A.join("")}function U(C,D){for(var A=D.charCodeAt(0),M=0,W=0;W<C.length;W++)M+=(C.charCodeAt(C.length-W-1)-A+1)*Math.pow(26,W);return M}function P(C,D){if(typeof C>"u")return;C=Math.floor(C);const A=pe(D);return j(C,A)}const x={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},L={UPPER:"upper",LOWER:"lower",TITLE:"title"};function j(C,D){let A;const M=C<0;switch(C=Math.abs(C),D.primary){case x.LETTERS:A=O(C,D.case===L.UPPER?"A":"a");break;case x.ROMAN:A=Y(C),D.case===L.UPPER&&(A=A.toUpperCase());break;case x.WORDS:A=v(C,D.ordinal),D.case===L.UPPER?A=A.toUpperCase():D.case===L.LOWER&&(A=A.toLowerCase());break;case x.DECIMAL:A=""+C;var W=D.mandatoryDigits-A.length;if(W>0){var z=new Array(W+1).join("0");A=z+A}if(D.zeroCode!==48&&(A=l(A).map(xe=>String.fromCodePoint(xe.codePointAt(0)+D.zeroCode-48)).join("")),D.regular){const xe=Math.floor((A.length-1)/D.groupingSeparators.position);for(let Te=xe;Te>0;Te--){const te=A.length-Te*D.groupingSeparators.position;A=A.substr(0,te)+D.groupingSeparators.character+A.substr(te)}}else D.groupingSeparators.reverse().forEach(xe=>{const Te=A.length-xe.position;A=A.substr(0,Te)+xe.character+A.substr(Te)});if(D.ordinal){var I={1:"st",2:"nd",3:"rd"},F=A[A.length-1],se=I[F];(!se||A.length>1&&A[A.length-2]==="1")&&(se="th"),A=A+se}break;case x.SEQUENCE:throw{code:"D3130",value:D.token}}return M&&(A="-"+A),A}const de=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function pe(C){const D={type:"integer",primary:x.DECIMAL,case:L.LOWER,ordinal:!1};let A,M;const W=C.lastIndexOf(";");switch(W===-1?A=C:(A=C.substring(0,W),M=C.substring(W+1),M[0]==="o"&&(D.ordinal=!0)),A){case"A":D.case=L.UPPER;case"a":D.primary=x.LETTERS;break;case"I":D.case=L.UPPER;case"i":D.primary=x.ROMAN;break;case"W":D.case=L.UPPER,D.primary=x.WORDS;break;case"Ww":D.case=L.TITLE,D.primary=x.WORDS;break;case"w":D.primary=x.WORDS;break;default:{let z=null,I=0,F=0,se=[],xe=0;if(l(A).map(te=>te.codePointAt(0)).reverse().forEach(te=>{let ce=!1;for(let Ee=0;Ee<de.length;Ee++){const J=de[Ee];if(te>=J&&te<=J+9){if(ce=!0,I++,xe++,z===null)z=J;else if(J!==z)throw{code:"D3131"};break}}ce||(te===35?(xe++,F++):se.push({position:xe,character:String.fromCodePoint(te)}))}),I>0){D.primary=x.DECIMAL,D.zeroCode=z,D.mandatoryDigits=I,D.optionalDigits=F;const ce=function(Ee){if(Ee.length===0)return 0;const J=Ee[0].character;for(let Je=1;Je<Ee.length;Je++)if(Ee[Je].character!==J)return 0;const nt=Ee.map(Je=>Je.position),Pt=function(Je,ht){return ht===0?Je:Pt(ht,Je%ht)},pt=nt.reduce(Pt);for(let Je=1;Je<=nt.length;Je++)if(nt.indexOf(Je*pt)===-1)return 0;return pt}(se);ce>0?(D.regular=!0,D.groupingSeparators={position:ce,character:se[0].character}):(D.regular=!1,D.groupingSeparators=se)}else D.primary=x.SEQUENCE,D.token=A}}return D}const ne={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function R(C){var D=[];const A={type:"datetime",parts:D},M=function(ce,Ee){if(Ee>ce){let J=C.substring(ce,Ee);J=J.split("]]").join("]"),D.push({type:"literal",value:J})}};for(var W=0,z=0;z<C.length;){if(C.charAt(z)==="["){if(C.charAt(z+1)==="["){M(W,z),D.push({type:"literal",value:"["}),z+=2,W=z;continue}if(M(W,z),W=z,z=C.indexOf("]",W),z===-1)throw{code:"D3135"};let ce=C.substring(W+1,z);ce=ce.split(/\s+/).join("");var I={type:"marker",component:ce.charAt(0)},F=ce.lastIndexOf(","),se;if(F!==-1){const Ee=ce.substring(F+1),J=Ee.indexOf("-");let nt,Pt;const pt=function(ht){if(!(typeof ht>"u"||ht==="*"))return parseInt(ht)};J===-1?nt=Ee:(nt=Ee.substring(0,J),Pt=Ee.substring(J+1));const Je={min:pt(nt),max:pt(Pt)};I.width=Je,se=ce.substring(1,F)}else se=ce.substring(1);if(se.length===1)I.presentation1=se;else if(se.length>1){var xe=se.charAt(se.length-1);"atco".indexOf(xe)!==-1?(I.presentation2=xe,xe==="o"&&(I.ordinal=!0),I.presentation1=se.substring(0,se.length-1)):I.presentation1=se}else I.presentation1=ne[I.component];if(typeof I.presentation1>"u")throw{code:"D3132",value:I.component};if(I.presentation1[0]==="n")I.names=L.LOWER;else if(I.presentation1[0]==="N")I.presentation1[1]==="n"?I.names=L.TITLE:I.names=L.UPPER;else if("YMDdFWwXxHhmsf".indexOf(I.component)!==-1){var Te=I.presentation1;if(I.presentation2&&(Te+=";"+I.presentation2),I.integerFormat=pe(Te),I.width&&I.width.min!==void 0&&I.integerFormat.mandatoryDigits<I.width.min&&(I.integerFormat.mandatoryDigits=I.width.min),I.component==="Y")if(I.n=-1,I.width&&I.width.max!==void 0)I.n=I.width.max,I.integerFormat.mandatoryDigits=I.n;else{var te=I.integerFormat.mandatoryDigits+I.integerFormat.optionalDigits;te>=2&&(I.n=te)}const Ee=D[D.length-1];Ee&&Ee.integerFormat&&(Ee.integerFormat.parseWidth=Ee.integerFormat.mandatoryDigits)}(I.component==="Z"||I.component==="z")&&(I.integerFormat=pe(I.presentation1)),D.push(I),W=z+1}z++}return M(W,z),A}const X=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],oe=["January","February","March","April","May","June","July","August","September","October","November","December"],ye=1e3*60*60*24,ie=function(C){const D=Date.UTC(C.year,C.month);var A=new Date(D).getUTCDay();return A===0&&(A=7),A>4?D+(8-A)*ye:D-(A-1)*ye},K=function(C,D){return{year:C,month:D,nextMonth:function(){return D===11?K(C+1,0):K(C,D+1)},previousMonth:function(){return D===0?K(C-1,11):K(C,D-1)},nextYear:function(){return K(C+1,D)},previousYear:function(){return K(C-1,D)}}},re=function(C,D){return(D-C)/(ye*7)+1},B=(C,D)=>{let A;switch(D){case"Y":A=C.getUTCFullYear();break;case"M":A=C.getUTCMonth()+1;break;case"D":A=C.getUTCDate();break;case"d":{const M=Date.UTC(C.getUTCFullYear(),C.getUTCMonth(),C.getUTCDate()),W=Date.UTC(C.getUTCFullYear(),0);A=(M-W)/ye+1;break}case"F":A=C.getUTCDay(),A===0&&(A=7);break;case"W":{const M=K(C.getUTCFullYear(),0),W=ie(M),z=Date.UTC(M.year,C.getUTCMonth(),C.getUTCDate());let I=re(W,z);if(I>52){const F=ie(M.nextYear());z>=F&&(I=1)}else if(I<1){const F=ie(M.previousYear());I=re(F,z)}A=Math.floor(I);break}case"w":{const M=K(C.getUTCFullYear(),C.getUTCMonth()),W=ie(M),z=Date.UTC(M.year,M.month,C.getUTCDate());let I=re(W,z);if(I>4){const F=ie(M.nextMonth());z>=F&&(I=1)}else if(I<1){const F=ie(M.previousMonth());I=re(F,z)}A=Math.floor(I);break}case"X":{const M=K(C.getUTCFullYear(),0),W=ie(M),z=ie(M.nextYear()),I=C.getTime();I<W?A=M.year-1:I>=z?A=M.year+1:A=M.year;break}case"x":{const M=K(C.getUTCFullYear(),C.getUTCMonth()),W=ie(M),z=M.nextMonth(),I=ie(z),F=C.getTime();F<W?A=M.previousMonth().month+1:F>=I?A=z.month+1:A=M.month+1;break}case"H":A=C.getUTCHours();break;case"h":A=C.getUTCHours(),A=A%12,A===0&&(A=12);break;case"P":A=C.getUTCHours()>=12?"pm":"am";break;case"m":A=C.getUTCMinutes();break;case"s":A=C.getUTCSeconds();break;case"f":A=C.getUTCMilliseconds();break;case"Z":case"z":break;case"C":A="ISO";break;case"E":A="ISO";break}return A};let Ae=null;function dt(C,D,A){var M=0,W=0;if(typeof A<"u"){const Te=parseInt(A);M=Math.floor(Te/100),W=Te%100}var z=function(Te,te){var ce=B(Te,te.component);if("YMDdFWwXxHhms".indexOf(te.component)!==-1)if(te.component==="Y"&&te.n!==-1&&(ce=ce%Math.pow(10,te.n)),te.names){if(te.component==="M"||te.component==="x")ce=oe[ce-1];else if(te.component==="F")ce=X[ce];else throw{code:"D3133",value:te.component};te.names===L.UPPER?ce=ce.toUpperCase():te.names===L.LOWER&&(ce=ce.toLowerCase()),te.width&&ce.length>te.width.max&&(ce=ce.substring(0,te.width.max))}else ce=j(ce,te.integerFormat);else if(te.component==="f")ce=j(ce,te.integerFormat);else if(te.component==="Z"||te.component==="z"){const Ee=M*100+W;if(te.integerFormat.regular)ce=j(Ee,te.integerFormat);else{const J=te.integerFormat.mandatoryDigits;if(J===1||J===2)ce=j(M,te.integerFormat),W!==0&&(ce+=":"+P(W,"00"));else if(J===3||J===4)ce=j(Ee,te.integerFormat);else throw{code:"D3134",value:J}}Ee>=0&&(ce="+"+ce),te.component==="z"&&(ce="GMT"+ce),Ee===0&&te.presentation2==="t"&&(ce="Z")}else te.component==="P"&&te.names===L.UPPER&&(ce=ce.toUpperCase());return ce};let I;typeof D>"u"?(Ae===null&&(Ae=R("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),I=Ae):I=R(D);const F=(60*M+W)*60*1e3,se=new Date(C+F);let xe="";return I.parts.forEach(function(Te){Te.type==="literal"?xe+=Te.value:xe+=z(se,Te)}),xe}function f(C){var D={};if(C.type==="datetime")D.type="datetime",D.parts=C.parts.map(function(A){var M={};if(A.type==="literal")M.regex=A.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(A.component==="Z"||A.component==="z"){let z;Array.isArray(A.integerFormat.groupingSeparators)||(z=A.integerFormat.groupingSeparators),M.regex="",A.component==="z"&&(M.regex="GMT"),M.regex+="[-+][0-9]+",z&&(M.regex+=z.character+"[0-9]+"),M.parse=function(I){A.component==="z"&&(I=I.substring(3));let F=0,se=0;return z?(F=Number.parseInt(I.substring(0,I.indexOf(z.character))),se=Number.parseInt(I.substring(I.indexOf(z.character)+1))):I.length-1<=2?F=Number.parseInt(I):(F=Number.parseInt(I.substring(0,3)),se=Number.parseInt(I.substring(3))),F*60+se}}else if(A.integerFormat)M=f(A.integerFormat);else{M.regex="[a-zA-Z]+";var W={};if(A.component==="M"||A.component==="x")oe.forEach(function(z,I){A.width&&A.width.max?W[z.substring(0,A.width.max)]=I+1:W[z]=I+1});else if(A.component==="F")X.forEach(function(z,I){I>0&&(A.width&&A.width.max?W[z.substring(0,A.width.max)]=I:W[z]=I)});else if(A.component==="P")W={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:A.component};M.parse=function(z){return W[z]}}return M.component=A.component,M});else{D.type="integer";const A=C.case===L.UPPER;switch(C.primary){case x.LETTERS:D.regex=A?"[A-Z]+":"[a-z]+",D.parse=function(M){return U(M,A?"A":"a")};break;case x.ROMAN:D.regex=A?"[MDCLXVI]+":"[mdclxvi]+",D.parse=function(M){return G(A?M:M.toUpperCase())};break;case x.WORDS:D.regex="(?:"+Object.keys(k).concat("and","[\\-, ]").join("|")+")+",D.parse=function(M){return _(M.toLowerCase())};break;case x.DECIMAL:D.regex="[0-9]",C.parseWidth?D.regex+=`{${C.parseWidth}}`:D.regex+="+",C.ordinal&&(D.regex+="(?:th|st|nd|rd)"),D.parse=function(M){let W=M;return C.ordinal&&(W=M.substring(0,M.length-2)),C.regular?W=W.split(",").join(""):C.groupingSeparators.forEach(z=>{W=W.split(z.character).join("")}),C.zeroCode!==48&&(W=W.split("").map(z=>String.fromCodePoint(z.codePointAt(0)-C.zeroCode+48)).join("")),parseInt(W)};break;case x.SEQUENCE:throw{code:"D3130",value:C.token}}}return D}function m(C,D){if(typeof C>"u")return;const A=pe(D);return f(A).parse(C)}function H(C,D){const A=R(D),M=f(A),W="^"+M.parts.map(se=>"("+se.regex+")").join("")+"$";var I=new RegExp(W,"i").exec(C);if(I!==null){const J={};for(let Me=1;Me<I.length;Me++){const d=M.parts[Me-1];d.parse&&(J[d.component]=d.parse(I[Me]))}if(Object.getOwnPropertyNames(J).length===0)return;let nt=0;const Pt=Me=>{nt<<=1,nt+=Me?1:0},pt=Me=>!(~Me&nt)&&!!(Me&nt);"YXMxWwdD".split("").forEach(Me=>Pt(J[Me]));const ht=!pt(161)&&pt(130),nn=pt(84),hn=!nn&&pt(72);nt=0,"PHhmsf".split("").forEach(Me=>Pt(J[Me]));const fn=!pt(23)&&pt(47),or=(ht?"YD":nn?"XxwF":hn?"XWF":"YMD")+(fn?"Phmsf":"Hmsf"),Ft=this.environment.timestamp;let Un=!1,Xt=!1;if(or.split("").forEach(Me=>{if(typeof J[Me]>"u")Un?(J[Me]="MDd".indexOf(Me)!==-1?1:0,Xt=!0):J[Me]=B(Ft,Me);else if(Un=!0,Xt)throw{code:"D3136"}}),J.M>0?J.M-=1:J.M=0,ht){const Me=Date.UTC(J.Y,0),d=(J.d-1)*1e3*60*60*24,g=new Date(Me+d);J.M=g.getUTCMonth(),J.D=g.getUTCDate()}if(nn)throw{code:"D3136"};if(hn)throw{code:"D3136"};fn&&(J.H=J.h===12?0:J.h,J.P===1&&(J.H+=12));var F=Date.UTC(J.Y,J.M,J.D,J.H,J.m,J.s,J.f);return(J.Z||J.z)&&(F-=(J.Z||J.z)*60*1e3),F}}var he=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function ze(C,D){if(!(typeof C>"u"))if(typeof D>"u"){if(!he.test(C))throw{stack:new Error().stack,code:"D3110",value:C};return Date.parse(C)}else return H.call(this,C,D)}function $e(C,D,A){if(!(typeof C>"u"))return dt.call(this,C,D,A)}return{formatInteger:P,parseInteger:m,fromMillis:$e,toMillis:ze}})();r.exports=a},{"./utils":6}],2:[function(t,r,i){(function(s){(function(){var a=t("./utils");const l=(()=>{var u=a.isNumeric,h=a.isArrayOfStrings,T=a.isArrayOfNumbers,E=a.createSequence,v=a.isSequence,k=a.isFunction,_=a.isLambda,q=a.isPromise,ee=a.getFunctionArity,Y=a.isDeepEqual,G=a.stringToArray;function O(o){if(!(typeof o>"u")){var c=0;return o.forEach(function(p){c+=p}),c}}function U(o){return typeof o>"u"?0:o.length}function P(o){if(!(typeof o>"u"||o.length===0))return Math.max.apply(Math,o)}function x(o){if(!(typeof o>"u"||o.length===0))return Math.min.apply(Math,o)}function L(o){if(!(typeof o>"u"||o.length===0)){var c=0;return o.forEach(function(p){c+=p}),c/o.length}}function j(o,c=!1){if(!(typeof o>"u")){var p;if(typeof o=="string")p=o;else if(k(o))p="";else{if(typeof o=="number"&&!isFinite(o))throw{code:"D3001",value:o,stack:new Error().stack};var b=c?2:0;Array.isArray(o)&&o.outerWrapper&&(o=o[0]),p=JSON.stringify(o,function(y,$){return typeof $<"u"&&$!==null&&$.toPrecision&&u($)?Number($.toPrecision(15)):$&&k($)?"":$},b)}return p}}function de(o,c,p){if(!(typeof o>"u")){var b=G(o),y=b.length;if(y+c<0&&(c=0),typeof p<"u"){if(p<=0)return"";var $=c>=0?c+p:y+c+p;return b.slice(c,$).join("")}return b.slice(c).join("")}}function pe(o,c){if(!(typeof o>"u")){var p=o.indexOf(c);return p>-1?o.substr(0,p):o}}function ne(o,c){if(!(typeof o>"u")){var p=o.indexOf(c);return p>-1?o.substr(p+c.length):o}}function R(o){if(!(typeof o>"u"))return o.toLowerCase()}function X(o){if(!(typeof o>"u"))return o.toUpperCase()}function oe(o){if(!(typeof o>"u"))return G(o).length}function ye(o){if(!(typeof o>"u")){var c=o.replace(/[ \t\n\r]+/gm," ");return c.charAt(0)===" "&&(c=c.substring(1)),c.charAt(c.length-1)===" "&&(c=c.substring(0,c.length-1)),c}}function ie(o,c,p){if(!(typeof o>"u")){(typeof p>"u"||p.length===0)&&(p=" ");var b;c=Math.trunc(c);var y=Math.abs(c)-oe(o);if(y>0){var $=new Array(y+1).join(p);p.length>1&&($=de($,0,y)),c>0?b=o+$:b=$+o}else b=o;return b}}async function K(o,c){var p=o.apply(this,[c]);if(q(p)&&(p=await p),p&&!(typeof p.start=="number"||p.end==="number"||Array.isArray(p.groups)||k(p.next)))throw{code:"T1010",stack:new Error().stack};return p}async function re(o,c){if(!(typeof o>"u")){var p;if(typeof c=="string")p=o.indexOf(c)!==-1;else{var b=await K(c,o);p=typeof b<"u"}return p}}async function B(o,c,p){if(!(typeof o>"u")){if(p<0)throw{stack:new Error().stack,value:p,code:"D3040",index:3};var b=E();if(typeof p>"u"||p>0){var y=0,$=await K(c,o);if(typeof $<"u")for(;typeof $<"u"&&(typeof p>"u"||y<p);)b.push({match:$.match,index:$.start,groups:$.groups}),$=await K($.next),y++}return b}}async function Ae(o,c,p,b){if(!(typeof o>"u")){var y=this;if(c==="")throw{code:"D3010",stack:new Error().stack,value:c,index:2};if(b<0)throw{code:"D3011",stack:new Error().stack,value:b,index:4};var $;typeof p=="string"?$=function(Ie){for(var rt="",_e=0,Be=p.indexOf("$",_e);Be!==-1&&_e<p.length;){rt+=p.substring(_e,Be),_e=Be+1;var Lt=p.charAt(_e);if(Lt==="$")rt+="$",_e++;else if(Lt==="0")rt+=Ie.match,_e++;else{var it;if(Ie.groups.length===0?it=1:it=Math.floor(Math.log(Ie.groups.length)*Math.LOG10E)+1,Be=parseInt(p.substring(_e,_e+it),10),it>1&&Be>Ie.groups.length&&(Be=parseInt(p.substring(_e,_e+it-1),10)),isNaN(Be))rt+="$";else{if(Ie.groups.length>0){var zn=Ie.groups[Be-1];typeof zn<"u"&&(rt+=zn)}_e+=Be.toString().length}}Be=p.indexOf("$",_e)}return rt+=p.substring(_e),rt}:$=p;var N="",Z=0;if(typeof b>"u"||b>0){var ae=0;if(typeof c=="string"){for(var Ne=o.indexOf(c,Z);Ne!==-1&&(typeof b>"u"||ae<b);)N+=o.substring(Z,Ne),N+=p,Z=Ne+c.length,ae++,Ne=o.indexOf(c,Z);N+=o.substring(Z)}else{var ke=await K(c,o);if(typeof ke<"u"){for(;typeof ke<"u"&&(typeof b>"u"||ae<b);){N+=o.substring(Z,ke.start);var Fe=$.apply(y,[ke]);if(q(Fe)&&(Fe=await Fe),typeof Fe=="string")N+=Fe;else throw{code:"D3012",stack:new Error().stack,value:Fe};Z=ke.start+ke.match.length,ae++,ke=await K(ke.next)}N+=o.substring(Z)}else N=o}}else N=o;return N}}function dt(o){if(!(typeof o>"u")){var c=typeof window<"u"?window.btoa:function(p){return new s.Buffer.from(p,"binary").toString("base64")};return c(o)}}function f(o){if(!(typeof o>"u")){var c=typeof window<"u"?window.atob:function(p){return new s.Buffer.from(p,"base64").toString("binary")};return c(o)}}function m(o){if(!(typeof o>"u")){var c;try{c=encodeURIComponent(o)}catch{throw{code:"D3140",stack:new Error().stack,value:o,functionName:"encodeUrlComponent"}}return c}}function H(o){if(!(typeof o>"u")){var c;try{c=encodeURI(o)}catch{throw{code:"D3140",stack:new Error().stack,value:o,functionName:"encodeUrl"}}return c}}function he(o){if(!(typeof o>"u")){var c;try{c=decodeURIComponent(o)}catch{throw{code:"D3140",stack:new Error().stack,value:o,functionName:"decodeUrlComponent"}}return c}}function ze(o){if(!(typeof o>"u")){var c;try{c=decodeURI(o)}catch{throw{code:"D3140",stack:new Error().stack,value:o,functionName:"decodeUrl"}}return c}}async function $e(o,c,p){if(!(typeof o>"u")){if(p<0)throw{code:"D3020",stack:new Error().stack,value:p,index:3};var b=[];if(typeof p>"u"||p>0)if(typeof c=="string")b=o.split(c,p);else{var y=0,$=await K(c,o);if(typeof $<"u"){for(var N=0;typeof $<"u"&&(typeof p>"u"||y<p);)b.push(o.substring(N,$.start)),N=$.end,$=await K($.next),y++;(typeof p>"u"||y<p)&&b.push(o.substring(N))}else b.push(o)}return b}}function C(o,c){if(!(typeof o>"u"))return typeof c>"u"&&(c=""),o.join(c)}function D(o,c,p){if(!(typeof o>"u")){var b={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"â€°","zero-digit":"0",digit:"#","pattern-separator":";"},y=b;typeof p<"u"&&Object.keys(p).forEach(function(ue){y[ue]=p[ue]});for(var $=[],N=y["zero-digit"].charCodeAt(0),Z=N;Z<N+10;Z++)$.push(String.fromCharCode(Z));var ae=$.concat([y["decimal-separator"],y["exponent-separator"],y["grouping-separator"],y.digit,y["pattern-separator"]]),Ne=c.split(y["pattern-separator"]);if(Ne.length>2)throw{code:"D3080",stack:new Error().stack};var ke=function(ue){var je=(function(){for(var Qe,Ot=0;Ot<ue.length;Ot++)if(Qe=ue.charAt(Ot),ae.indexOf(Qe)!==-1&&Qe!==y["exponent-separator"])return ue.substring(0,Ot)})(),gt=(function(){for(var Qe,Ot=ue.length-1;Ot>=0;Ot--)if(Qe=ue.charAt(Ot),ae.indexOf(Qe)!==-1&&Qe!==y["exponent-separator"])return ue.substring(Ot+1)})(),Ge=ue.substring(je.length,ue.length-gt.length),vt,gn,Et,Tn,$t=ue.indexOf(y["exponent-separator"],je.length);$t===-1||$t>ue.length-gt.length?(vt=Ge,gn=void 0):(vt=Ge.substring(0,$t),gn=Ge.substring($t+1));var Wt=vt.indexOf(y["decimal-separator"]);return Wt===-1?(Et=vt,Tn=gt):(Et=vt.substring(0,Wt),Tn=vt.substring(Wt+1)),{prefix:je,suffix:gt,activePart:Ge,mantissaPart:vt,exponentPart:gn,integerPart:Et,fractionalPart:Tn,subpicture:ue}},Fe=function(ue){var je,gt,Ge=ue.subpicture,vt=Ge.indexOf(y["decimal-separator"]);vt!==Ge.lastIndexOf(y["decimal-separator"])&&(je="D3081"),Ge.indexOf(y.percent)!==Ge.lastIndexOf(y.percent)&&(je="D3082"),Ge.indexOf(y["per-mille"])!==Ge.lastIndexOf(y["per-mille"])&&(je="D3083"),Ge.indexOf(y.percent)!==-1&&Ge.indexOf(y["per-mille"])!==-1&&(je="D3084");var gn=!1;for(gt=0;gt<ue.mantissaPart.length;gt++){var Et=ue.mantissaPart.charAt(gt);if($.indexOf(Et)!==-1||Et===y.digit){gn=!0;break}}gn||(je="D3085");var Tn=ue.activePart.split("").map(function(Qe){return ae.indexOf(Qe)===-1?"p":"a"}).join("");Tn.indexOf("p")!==-1&&(je="D3086"),vt!==-1?(Ge.charAt(vt-1)===y["grouping-separator"]||Ge.charAt(vt+1)===y["grouping-separator"])&&(je="D3087"):ue.integerPart.charAt(ue.integerPart.length-1)===y["grouping-separator"]&&(je="D3088"),Ge.indexOf(y["grouping-separator"]+y["grouping-separator"])!==-1&&(je="D3089");var $t=ue.integerPart.indexOf(y.digit);$t!==-1&&ue.integerPart.substring(0,$t).split("").filter(function(Qe){return $.indexOf(Qe)>-1}).length>0&&(je="D3090"),$t=ue.fractionalPart.lastIndexOf(y.digit),$t!==-1&&ue.fractionalPart.substring($t).split("").filter(function(Qe){return $.indexOf(Qe)>-1}).length>0&&(je="D3091");var Wt=typeof ue.exponentPart=="string";if(Wt&&ue.exponentPart.length>0&&(Ge.indexOf(y.percent)!==-1||Ge.indexOf(y["per-mille"])!==-1)&&(je="D3092"),Wt&&(ue.exponentPart.length===0||ue.exponentPart.split("").filter(function(Qe){return $.indexOf(Qe)===-1}).length>0)&&(je="D3093"),je)throw{code:je,stack:new Error().stack}},Ie=function(ue){var je=function(st,Qr){for(var ur=[],rn=st.indexOf(y["grouping-separator"]);rn!==-1;){var ei=(Qr?st.substring(0,rn):st.substring(rn)).split("").filter(function(Wn){return $.indexOf(Wn)!==-1||Wn===y.digit}).length;ur.push(ei),rn=ue.integerPart.indexOf(y["grouping-separator"],rn+1)}return ur},gt=je(ue.integerPart),Ge=function(st){if(st.length===0)return 0;for(var Qr=function(ei,Wn){return Wn===0?ei:Qr(Wn,ei%Wn)},ur=st.reduce(Qr),rn=1;rn<=st.length;rn++)if(st.indexOf(rn*ur)===-1)return 0;return ur},vt=Ge(gt),gn=je(ue.fractionalPart,!0),Et=ue.integerPart.split("").filter(function(st){return $.indexOf(st)!==-1}).length,Tn=Et,$t=ue.fractionalPart.split(""),Wt=$t.filter(function(st){return $.indexOf(st)!==-1}).length,Qe=$t.filter(function(st){return $.indexOf(st)!==-1||st===y.digit}).length,Ot=typeof ue.exponentPart=="string";Et===0&&Qe===0&&(Ot?(Wt=1,Qe=1):Et=1),Ot&&Et===0&&ue.integerPart.indexOf(y.digit)!==-1&&(Et=1),Et===0&&Wt===0&&(Wt=1);var Xs=0;return Ot&&(Xs=ue.exponentPart.split("").filter(function(st){return $.indexOf(st)!==-1}).length),{integerPartGroupingPositions:gt,regularGrouping:vt,minimumIntegerPartSize:Et,scalingFactor:Tn,prefix:ue.prefix,fractionalPartGroupingPositions:gn,minimumFactionalPartSize:Wt,maximumFactionalPartSize:Qe,minimumExponentSize:Xs,suffix:ue.suffix,picture:ue.subpicture}},rt=Ne.map(ke);rt.forEach(Fe);var _e=rt.map(Ie),Be=y["minus-sign"],Lt=y["zero-digit"],it=y["decimal-separator"],zn=y["grouping-separator"];_e.length===1&&(_e.push(JSON.parse(JSON.stringify(_e[0]))),_e[1].prefix=Be+_e[1].prefix);var He;o>=0?He=_e[0]:He=_e[1];var lr;He.picture.indexOf(y.percent)!==-1?lr=o*100:He.picture.indexOf(y["per-mille"])!==-1?lr=o*1e3:lr=o;var Sn,Fn;if(He.minimumExponentSize===0)Sn=lr;else{var Yo=Math.pow(10,He.scalingFactor),Zo=Math.pow(10,He.scalingFactor-1);for(Sn=lr,Fn=0;Sn<Zo;)Sn*=10,Fn-=1;for(;Sn>Yo;)Sn/=10,Fn+=1}var Jo=F(Sn,He.maximumFactionalPartSize),Vs=function(ue,je){var gt=Math.abs(ue).toFixed(je);return Lt!=="0"&&(gt=gt.split("").map(function(Ge){return Ge>="0"&&Ge<="9"?$[Ge.charCodeAt(0)-48]:Ge}).join("")),gt},be=Vs(Jo,He.maximumFactionalPartSize),ft=be.indexOf(".");for(ft===-1?be=be+it:be=be.replace(".",it);be.charAt(0)===Lt;)be=be.substring(1);for(;be.charAt(be.length-1)===Lt;)be=be.substring(0,be.length-1);ft=be.indexOf(it);var cr=He.minimumIntegerPartSize-ft,Hs=He.minimumFactionalPartSize-(be.length-ft-1);if(be=(cr>0?new Array(cr+1).join(Lt):"")+be,be=be+(Hs>0?new Array(Hs+1).join(Lt):""),ft=be.indexOf(it),He.regularGrouping>0)for(var Qo=Math.floor((ft-1)/He.regularGrouping),Zr=1;Zr<=Qo;Zr++)be=[be.slice(0,ft-Zr*He.regularGrouping),zn,be.slice(ft-Zr*He.regularGrouping)].join("");else He.integerPartGroupingPositions.forEach(function(ue){be=[be.slice(0,ft-ue),zn,be.slice(ft-ue)].join(""),ft++});if(ft=be.indexOf(it),He.fractionalPartGroupingPositions.forEach(function(ue){be=[be.slice(0,ue+ft+1),zn,be.slice(ue+ft+1)].join("")}),ft=be.indexOf(it),(He.picture.indexOf(it)===-1||ft===be.length-1)&&(be=be.substring(0,be.length-1)),typeof Fn<"u"){var Jr=Vs(Fn,0);cr=He.minimumExponentSize-Jr.length,cr>0&&(Jr=new Array(cr+1).join(Lt)+Jr),be=be+y["exponent-separator"]+(Fn<0?Be:"")+Jr}return be=He.prefix+be+He.suffix,be}}function A(o,c){if(!(typeof o>"u")){if(o=F(o),typeof c>"u"?c=10:c=F(c),c<2||c>36)throw{code:"D3100",stack:new Error().stack,value:c};var p=o.toString(c);return p}}function M(o){var c;if(!(typeof o>"u")){if(typeof o=="number")c=o;else if(typeof o=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(o)&&!isNaN(parseFloat(o))&&isFinite(o))c=parseFloat(o);else if(typeof o=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(o))c=Number(o);else if(o===!0)c=1;else if(o===!1)c=0;else throw{code:"D3030",value:o,stack:new Error().stack,index:1};return c}}function W(o){var c;if(!(typeof o>"u"))return c=Math.abs(o),c}function z(o){var c;if(!(typeof o>"u"))return c=Math.floor(o),c}function I(o){var c;if(!(typeof o>"u"))return c=Math.ceil(o),c}function F(o,c){var p;if(!(typeof o>"u")){if(c){var b=o.toString().split("e");o=+(b[0]+"e"+(b[1]?+b[1]+c:c))}p=Math.round(o);var y=p-o;return Math.abs(y)===.5&&Math.abs(p%2)===1&&(p=p-1),c&&(b=p.toString().split("e"),p=+(b[0]+"e"+(b[1]?+b[1]-c:-c))),Object.is(p,-0)&&(p=0),p}}function se(o){var c;if(!(typeof o>"u")){if(o<0)throw{stack:new Error().stack,code:"D3060",index:1,value:o};return c=Math.sqrt(o),c}}function xe(o,c){var p;if(!(typeof o>"u")){if(p=Math.pow(o,c),!isFinite(p))throw{stack:new Error().stack,code:"D3061",index:1,value:o,exp:c};return p}}function Te(){return Math.random()}function te(o){if(!(typeof o>"u")){var c=!1;if(Array.isArray(o)){if(o.length===1)c=te(o[0]);else if(o.length>1){var p=o.filter(function(b){return te(b)});c=p.length>0}}else typeof o=="string"?o.length>0&&(c=!0):u(o)?o!==0&&(c=!0):o!==null&&typeof o=="object"&&!k(o)?Object.keys(o).length>0&&(c=!0):typeof o=="boolean"&&o===!0&&(c=!0);return c}}function ce(o){if(!(typeof o>"u"))return!te(o)}function Ee(o,c,p,b){var y=[c],$=ee(o);return $>=2&&y.push(p),$>=3&&y.push(b),y}async function J(o,c){if(!(typeof o>"u")){for(var p=E(),b=0;b<o.length;b++){var y=Ee(c,o[b],b,o),$=await c.apply(this,y);typeof $<"u"&&p.push($)}return p}}async function nt(o,c){if(!(typeof o>"u")){for(var p=E(),b=0;b<o.length;b++){var y=o[b],$=Ee(c,y,b,o),N=await c.apply(this,$);te(N)&&p.push(y)}return p}}async function Pt(o,c){if(!(typeof o>"u")){for(var p=!1,b,y=0;y<o.length;y++){var $=o[y],N=!0;if(typeof c<"u"){var Z=Ee(c,$,y,o),ae=await c.apply(this,Z);N=te(ae)}if(N)if(!p)b=$,p=!0;else throw{stack:new Error().stack,code:"D3138",index:y}}if(!p)throw{stack:new Error().stack,code:"D3139"};return b}}function pt(){for(var o=[],c=Array.prototype.slice.call(arguments),p=Math.min.apply(Math,c.map(function($){return Array.isArray($)?$.length:0})),b=0;b<p;b++){var y=c.map($=>$[b]);o.push(y)}return o}async function Je(o,c,p){if(!(typeof o>"u")){var b,y=ee(c);if(y<2)throw{stack:new Error().stack,code:"D3050",index:1};var $;for(typeof p>"u"&&o.length>0?(b=o[0],$=1):(b=p,$=0);$<o.length;){var N=[b,o[$]];y>=3&&N.push($),y>=4&&N.push(o),b=await c.apply(this,N),$++}return b}}function ht(o){var c=E();if(Array.isArray(o)){var p={};o.forEach(function(b){var y=ht(b);y.forEach(function($){p[$]=!0})}),c=ht(p)}else o!==null&&typeof o=="object"&&!k(o)&&Object.keys(o).forEach(b=>c.push(b));return c}function nn(o,c){var p;if(Array.isArray(o)){p=E();for(var b=0;b<o.length;b++){var y=nn(o[b],c);typeof y<"u"&&(Array.isArray(y)?y.forEach($=>p.push($)):p.push(y))}}else o!==null&&typeof o=="object"&&!k(o)&&(p=o[c]);return p}function hn(o,c){return typeof o>"u"?c:typeof c>"u"?o:(Array.isArray(o)||(o=E(o)),Array.isArray(c)||(c=[c]),o.concat(c))}function Kr(o){return!(typeof o>"u")}function fn(o){var c=E();if(Array.isArray(o))o.forEach(function(y){c=hn(c,fn(y))});else if(o!==null&&typeof o=="object"&&!_(o))for(var p in o){var b={};b[p]=o[p],c.push(b)}else c=o;return c}function V(o){if(!(typeof o>"u")){var c={};return o.forEach(function(p){for(var b in p)c[b]=p[b]}),c}}function Yr(o){if(!(typeof o>"u")){if(o.length<=1)return o;for(var c=o.length,p=new Array(c),b=0;b<c;b++)p[c-b-1]=o[b];return p}}async function or(o,c){var p=E();for(var b in o){var y=Ee(c,o[b],b,o),$=await c.apply(this,y);typeof $<"u"&&p.push($)}return p}function Ft(o){throw{code:"D3137",stack:new Error().stack,message:o||"$error() function evaluated"}}function Un(o,c){if(!o)throw{code:"D3141",stack:new Error().stack,message:c||"$assert() statement failed"}}function Xt(o){if(o!==void 0)return o===null?"null":u(o)?"number":typeof o=="string"?"string":typeof o=="boolean"?"boolean":Array.isArray(o)?"array":k(o)?"function":"object"}async function Me(o,c){if(!(typeof o>"u")){if(o.length<=1)return o;var p;if(typeof c>"u"){if(!T(o)&&!h(o))throw{stack:new Error().stack,code:"D3070",index:1};p=async function(N,Z){return N>Z}}else p=c;var b=async function(N,Z){var ae=async function(ke,Fe,Ie){Fe.length===0?Array.prototype.push.apply(ke,Ie):Ie.length===0?Array.prototype.push.apply(ke,Fe):await p(Fe[0],Ie[0])?(ke.push(Ie[0]),await ae(ke,Fe,Ie.slice(1))):(ke.push(Fe[0]),await ae(ke,Fe.slice(1),Ie))},Ne=[];return await ae(Ne,N,Z),Ne},y=async function(N){if(!Array.isArray(N)||N.length<=1)return N;var Z=Math.floor(N.length/2),ae=N.slice(0,Z),Ne=N.slice(Z);return ae=await y(ae),Ne=await y(Ne),await b(ae,Ne)},$=await y(o);return $}}function d(o){if(!(typeof o>"u")){if(o.length<=1)return o;for(var c=new Array(o.length),p=0;p<o.length;p++){var b=Math.floor(Math.random()*(p+1));p!==b&&(c[p]=c[b]),c[b]=o[p]}return c}}function g(o){if(!(typeof o>"u")){if(!Array.isArray(o)||o.length<=1)return o;for(var c=v(o)?E():[],p=0;p<o.length;p++){for(var b=o[p],y=!1,$=0;$<c.length;$++)if(Y(b,c[$])){y=!0;break}y||c.push(b)}return c}}async function w(o,c){var p={};for(var b in o){var y=o[b],$=Ee(c,y,b,o),N=await c.apply(this,$);te(N)&&(p[b]=y)}return Object.keys(p).length===0&&(p=void 0),p}return{sum:O,count:U,max:P,min:x,average:L,string:j,substring:de,substringBefore:pe,substringAfter:ne,lowercase:R,uppercase:X,length:oe,trim:ye,pad:ie,match:B,contains:re,replace:Ae,split:$e,join:C,formatNumber:D,formatBase:A,number:M,floor:z,ceil:I,round:F,abs:W,sqrt:se,power:xe,random:Te,boolean:te,not:ce,map:J,zip:pt,filter:nt,single:Pt,foldLeft:Je,sift:w,keys:ht,lookup:nn,append:hn,exists:Kr,spread:fn,merge:V,reverse:Yr,each:or,error:Ft,assert:Un,type:Xt,sort:Me,shuffle:d,distinct:g,base64encode:dt,base64decode:f,encodeUrlComponent:m,encodeUrl:H,decodeUrlComponent:he,decodeUrl:ze}})();r.exports=l}).call(this)}).call(this,typeof Ks<"u"?Ks:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(t,r,i){var s=t("./datetime"),a=t("./functions"),l=t("./utils"),u=t("./parser"),h=t("./signature"),T=(function(){var E=l.isNumeric,v=l.isArrayOfStrings,k=l.isArrayOfNumbers,_=l.createSequence,q=l.isSequence,ee=l.isFunction,Y=l.isLambda,G=l.isIterable,O=l.isPromise,U=l.getFunctionArity,P=l.isDeepEqual,x=Ft(null);async function L(d,g,w){var o,c=w.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(c&&await c(d,g,w),d.type){case"path":o=await j(d,g,w);break;case"binary":o=await oe(d,g,w);break;case"unary":o=await ye(d,g,w);break;case"name":o=ie(d,g);break;case"string":case"number":case"value":o=K(d);break;case"wildcard":o=re(d,g);break;case"descendant":o=Ae(d,g);break;case"parent":o=w.lookup(d.slot.label);break;case"condition":o=await z(d,g,w);break;case"block":o=await I(d,g,w);break;case"bind":o=await W(d,g,w);break;case"regex":o=F(d);break;case"function":o=await Ee(d,g,w);break;case"variable":o=se(d,g,w);break;case"lambda":o=Pt(d,g,w);break;case"partial":o=await pt(d,g,w);break;case"apply":o=await ce(d,g,w);break;case"transform":o=Te(d,g,w);break}if(Object.prototype.hasOwnProperty.call(d,"predicate"))for(var p=0;p<d.predicate.length;p++)o=await X(d.predicate[p].expr,o,w);d.type!=="path"&&Object.prototype.hasOwnProperty.call(d,"group")&&(o=await D(d.group,o,w));var b=w.lookup(Symbol.for("jsonata.__evaluate_exit"));return b&&await b(d,g,w,o),o&&q(o)&&!o.tupleStream&&(d.keepArray&&(o.keepSingleton=!0),o.length===0?o=void 0:o.length===1&&(o=o.keepSingleton?o:o[0])),o}async function j(d,g,w){var o;Array.isArray(g)&&d.steps[0].type!=="variable"?o=g:o=_(g);for(var c,p=!1,b=void 0,y=0;y<d.steps.length;y++){var $=d.steps[y];if($.tuple&&(p=!0),y===0&&$.consarray?c=await L($,o,w):p?b=await R($,o,b,w):c=await pe($,o,w,y===d.steps.length-1),!p&&(typeof c>"u"||c.length===0))break;typeof $.focus>"u"&&(o=c)}if(p)if(d.tuple)c=b;else for(c=_(),y=0;y<b.length;y++)c.push(b[y]["@"]);return d.keepSingletonArray&&(Array.isArray(c)&&c.cons&&!c.sequence&&(c=_(c)),c.keepSingleton=!0),d.hasOwnProperty("group")&&(c=await D(d.group,p?b:c,w)),c}function de(d,g){var w=Ft(d);for(const o in g)w.bind(o,g[o]);return w}async function pe(d,g,w,o){var c;if(d.type==="sort")return c=await xe(d,g,w),d.stages&&(c=await ne(d.stages,c,w)),c;c=_();for(var p=0;p<g.length;p++){var b=await L(d,g[p],w);if(d.stages)for(var y=0;y<d.stages.length;y++)b=await X(d.stages[y].expr,b,w);typeof b<"u"&&c.push(b)}var $=_();return o&&c.length===1&&Array.isArray(c[0])&&!q(c[0])?$=c[0]:c.forEach(function(N){!Array.isArray(N)||N.cons?$.push(N):N.forEach(Z=>$.push(Z))}),$}async function ne(d,g,w){for(var o=g,c=0;c<d.length;c++){var p=d[c];switch(p.type){case"filter":o=await X(p.expr,o,w);break;case"index":for(var b=0;b<o.length;b++){var y=o[b];y[p.value]=b}break}}return o}async function R(d,g,w,o){var c;if(d.type==="sort"){if(w)c=await xe(d,w,o);else{var p=await xe(d,g,o);c=_(),c.tupleStream=!0;for(var b=0;b<p.length;b++){var y={"@":p[b]};y[d.index]=b,c.push(y)}}return d.stages&&(c=await ne(d.stages,c,o)),c}c=_(),c.tupleStream=!0;var $=o;w===void 0&&(w=g.map(Ne=>({"@":Ne})));for(var N=0;N<w.length;N++){$=de(o,w[N]);var Z=await L(d,w[N]["@"],$);if(typeof Z<"u"){Array.isArray(Z)||(Z=[Z]);for(var ae=0;ae<Z.length;ae++)y={},Object.assign(y,w[N]),Z.tupleStream?Object.assign(y,Z[ae]):(d.focus?(y[d.focus]=Z[ae],y["@"]=w[N]["@"]):y["@"]=Z[ae],d.index&&(y[d.index]=ae),d.ancestor&&(y[d.ancestor.label]=w[N]["@"])),c.push(y)}}return d.stages&&(c=await ne(d.stages,c,o)),c}async function X(d,g,w){var o=_();if(g&&g.tupleStream&&(o.tupleStream=!0),Array.isArray(g)||(g=_(g)),d.type==="number"){var c=Math.floor(d.value);c<0&&(c=g.length+c);var p=await g[c];typeof p<"u"&&(Array.isArray(p)?o=p:o.push(p))}else for(c=0;c<g.length;c++){var p=g[c],b=p,y=w;g.tupleStream&&(b=p["@"],y=de(w,p));var $=await L(d,b,y);E($)&&($=[$]),k($)?$.forEach(function(Z){var ae=Math.floor(Z);ae<0&&(ae=g.length+ae),ae===c&&o.push(p)}):a.boolean($)&&o.push(p)}return o}async function oe(d,g,w){var o,c=await L(d.lhs,g,w),p=d.value,b=async()=>await L(d.rhs,g,w);if(p==="and"||p==="or")try{return await ze(c,b,p)}catch($){throw $.position=d.position,$.token=p,$}var y=await b();try{switch(p){case"+":case"-":case"*":case"/":case"%":o=f(c,y,p);break;case"=":case"!=":o=m(c,y,p);break;case"<":case"<=":case">":case">=":o=H(c,y,p);break;case"&":o=C(c,y);break;case"..":o=M(c,y);break;case"in":o=he(c,y);break}}catch($){throw $.position=d.position,$.token=p,$}return o}async function ye(d,g,w){var o;switch(d.value){case"-":if(o=await L(d.expression,g,w),typeof o>"u")o=void 0;else if(E(o))o=-o;else throw{code:"D1002",stack:new Error().stack,position:d.position,token:d.value,value:o};break;case"[":o=[];let b=await Promise.all(d.expressions.map(async(y,$)=>(w.isParallelCall=$>0,[y,await L(y,g,w)])));for(let y of b){var[c,p]=y;typeof p<"u"&&(c.value==="["?o.push(p):o=a.append(o,p))}d.consarray&&Object.defineProperty(o,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":o=await D(d,g,w);break}return o}function ie(d,g,w){return a.lookup(g,d.value)}function K(d){return d.value}function re(d,g){var w=_();return Array.isArray(g)&&g.outerWrapper&&g.length>0&&(g=g[0]),g!==null&&typeof g=="object"&&Object.keys(g).forEach(function(o){var c=g[o];Array.isArray(c)?(c=B(c),w=a.append(w,c)):w.push(c)}),w}function B(d,g){return typeof g>"u"&&(g=[]),Array.isArray(d)?d.forEach(function(w){B(w,g)}):g.push(d),g}function Ae(d,g){var w,o=_();return typeof g<"u"&&(dt(g,o),o.length===1?w=o[0]:w=o),w}function dt(d,g){Array.isArray(d)||g.push(d),Array.isArray(d)?d.forEach(function(w){dt(w,g)}):d!==null&&typeof d=="object"&&Object.keys(d).forEach(function(w){dt(d[w],g)})}function f(d,g,w){var o;if(typeof d<"u"&&!E(d))throw{code:"T2001",stack:new Error().stack,value:d};if(typeof g<"u"&&!E(g))throw{code:"T2002",stack:new Error().stack,value:g};if(typeof d>"u"||typeof g>"u")return o;switch(w){case"+":o=d+g;break;case"-":o=d-g;break;case"*":o=d*g;break;case"/":o=d/g;break;case"%":o=d%g;break}return o}function m(d,g,w){var o,c=typeof d,p=typeof g;if(c==="undefined"||p==="undefined")return!1;switch(w){case"=":o=P(d,g);break;case"!=":o=!P(d,g);break}return o}function H(d,g,w){var o,c=typeof d,p=typeof g,b=c==="undefined"||c==="string"||c==="number",y=p==="undefined"||p==="string"||p==="number";if(!b||!y)throw{code:"T2010",stack:new Error().stack,value:c==="string"||c==="number"?g:d};if(!(c==="undefined"||p==="undefined")){if(c!==p)throw{code:"T2009",stack:new Error().stack,value:d,value2:g};switch(w){case"<":o=d<g;break;case"<=":o=d<=g;break;case">":o=d>g;break;case">=":o=d>=g;break}return o}}function he(d,g){var w=!1;if(typeof d>"u"||typeof g>"u")return!1;Array.isArray(g)||(g=[g]);for(var o=0;o<g.length;o++)if(g[o]===d){w=!0;break}return w}async function ze(d,g,w){var o,c=$e(d);switch(w){case"and":o=c&&$e(await g());break;case"or":o=c||$e(await g());break}return o}function $e(d){var g=a.boolean(d);return typeof g>"u"?!1:g}function C(d,g){var w,o="",c="";return typeof d<"u"&&(o=a.string(d)),typeof g<"u"&&(c=a.string(g)),w=o.concat(c),w}async function D(d,g,w){var o={},c={},p=!!(g&&g.tupleStream);Array.isArray(g)||(g=_(g)),g.length===0&&g.push(void 0);for(var b=0;b<g.length;b++)for(var y=g[b],$=p?de(w,y):w,N=0;N<d.lhs.length;N++){var Z=d.lhs[N],ae=await L(Z[0],p?y["@"]:y,$);if(typeof ae!="string"&&ae!==void 0)throw{code:"T1003",stack:new Error().stack,position:d.position,value:ae};if(ae!==void 0){var Ne={data:y,exprIndex:N};if(c.hasOwnProperty(ae)){if(c[ae].exprIndex!==N)throw{code:"D1009",stack:new Error().stack,position:d.position,value:ae};c[ae].data=a.append(c[ae].data,y)}else c[ae]=Ne}}let ke=await Promise.all(Object.keys(c).map(async(Ie,rt)=>{let _e=c[Ie];var Be=_e.data,Lt=w;if(p){var it=A(_e.data);Be=it["@"],delete it["@"],Lt=de(w,it)}return w.isParallelCall=rt>0,[Ie,await L(d.lhs[_e.exprIndex][1],Be,Lt)]}));for(let Ie of ke){var[ae,Fe]=await Ie;typeof Fe<"u"&&(o[ae]=Fe)}return o}function A(d){if(!Array.isArray(d))return d;var g={};Object.assign(g,d[0]);for(var w=1;w<d.length;w++)for(const o in d[w])g[o]=a.append(g[o],d[w][o]);return g}function M(d,g){var w;if(typeof d<"u"&&!Number.isInteger(d))throw{code:"T2003",stack:new Error().stack,value:d};if(typeof g<"u"&&!Number.isInteger(g))throw{code:"T2004",stack:new Error().stack,value:g};if(typeof d>"u"||typeof g>"u"||d>g)return w;var o=g-d+1;if(o>1e7)throw{code:"D2014",stack:new Error().stack,value:o};w=new Array(o);for(var c=d,p=0;c<=g;c++,p++)w[p]=c;return w.sequence=!0,w}async function W(d,g,w){var o=await L(d.rhs,g,w);return w.bind(d.lhs.value,o),o}async function z(d,g,w){var o,c=await L(d.condition,g,w);return a.boolean(c)?o=await L(d.then,g,w):typeof d.else<"u"&&(o=await L(d.else,g,w)),o}async function I(d,g,w){for(var o,c=Ft(w),p=0;p<d.expressions.length;p++)o=await L(d.expressions[p],g,c);return o}function F(d){var g=new Me.RegexEngine(d.value),w=function(o,c){var p;g.lastIndex=c||0;var b=g.exec(o);if(b!==null){if(p={match:b[0],start:b.index,end:b.index+b[0].length,groups:[]},b.length>1)for(var y=1;y<b.length;y++)p.groups.push(b[y]);p.next=function(){if(!(g.lastIndex>=o.length)){var $=w(o,g.lastIndex);if($&&$.match==="")throw{code:"D1004",stack:new Error().stack,position:d.position,value:d.value.source};return $}}}return p};return w}function se(d,g,w){var o;return d.value===""?o=g&&g.outerWrapper?g[0]:g:o=w.lookup(d.value),o}async function xe(d,g,w){var o,c=g,p=!!g.tupleStream,b=async function($,N){for(var Z=0,ae=0;Z===0&&ae<d.terms.length;ae++){var Ne=d.terms[ae],ke=$,Fe=w;p&&(ke=$["@"],Fe=de(w,$));var Ie=await L(Ne.expression,ke,Fe);ke=N,Fe=w,p&&(ke=N["@"],Fe=de(w,N));var rt=await L(Ne.expression,ke,Fe),_e=typeof Ie,Be=typeof rt;if(_e==="undefined"){Z=Be==="undefined"?0:1;continue}if(Be==="undefined"){Z=-1;continue}if(!(_e==="string"||_e==="number")||!(Be==="string"||Be==="number"))throw{code:"T2008",stack:new Error().stack,position:d.position,value:_e==="string"||_e==="number"?rt:Ie};if(_e!==Be)throw{code:"T2007",stack:new Error().stack,position:d.position,value:Ie,value2:rt};Ie!==rt&&(Ie<rt?Z=-1:Z=1,Ne.descending===!0&&(Z=-Z))}return Z===1},y={environment:w,input:g};return o=await a.sort.apply(y,[c,b]),o}function Te(d,g,w){var o=async function(c){if(!(typeof c>"u")){var p=w.lookup("clone");if(!ee(p))throw{code:"T2013",stack:new Error().stack,position:d.position};var b=await J(p,[c],null,w),y=await L(d.pattern,b,w);if(typeof y<"u"){Array.isArray(y)||(y=[y]);for(var $=0;$<y.length;$++){var N=y[$];if(N&&(N.isPrototypeOf(b)||N instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:d.position};var Z=await L(d.update,N,w),ae=typeof Z;if(ae!=="undefined"){if(ae!=="object"||Z===null||Array.isArray(Z))throw{code:"T2011",stack:new Error().stack,position:d.update.position,value:Z};for(var Ne in Z)N[Ne]=Z[Ne]}if(typeof d.delete<"u"){var ke=await L(d.delete,N,w);if(typeof ke<"u"){var Fe=ke;if(Array.isArray(ke)||(ke=[ke]),!v(ke))throw{code:"T2012",stack:new Error().stack,position:d.delete.position,value:Fe};for(var Ie=0;Ie<ke.length;Ie++)typeof N=="object"&&N!==null&&delete N[ke[Ie]]}}}}return b}};return V(o,"<(oa):o>")}var te=u("function($f, $g) { function($x){ $g($f($x)) } }");async function ce(d,g,w){var o,c=await L(d.lhs,g,w);if(d.rhs.type==="function")o=await Ee(d.rhs,g,w,{context:c});else{var p=await L(d.rhs,g,w);if(!ee(p))throw{code:"T2006",stack:new Error().stack,position:d.position,value:p};if(ee(c)){var b=await L(te,null,w);o=await J(b,[c,p],null,w)}else o=await J(p,[c],null,w)}return o}async function Ee(d,g,w,o){var c,p=await L(d.procedure,g,w);if(typeof p>"u"&&d.procedure.type==="path"&&w.lookup(d.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:d.position,token:d.procedure.steps[0].value};var b=[];typeof o<"u"&&b.push(o.context);for(var y=0;y<d.arguments.length;y++){const N=await L(d.arguments[y],g,w);if(ee(N)){const Z=async function(...ae){return await J(N,ae,null,w)};Z.arity=U(N),b.push(Z)}else b.push(N)}var $=d.procedure.type==="path"?d.procedure.steps[0].value:d.procedure.value;try{typeof p=="object"&&(p.token=$,p.position=d.position),c=await J(p,b,g,w)}catch(N){throw N.position||(N.position=d.position),N.token||(N.token=$),N}return c}async function J(d,g,w,o){var c;for(c=await nt(d,g,w,o);Y(c)&&c.thunk===!0;){var p=await L(c.body.procedure,c.input,c.environment);c.body.procedure.type==="variable"&&(p.token=c.body.procedure.value),p.position=c.body.procedure.position;for(var b=[],y=0;y<c.body.arguments.length;y++)b.push(await L(c.body.arguments[y],c.input,c.environment));c=await nt(p,b,w,o)}return c}async function nt(d,g,w,o){var c;try{var p=g;if(d&&(p=Je(d.signature,g,w)),Y(d))c=await ht(d,p);else if(d&&d._jsonata_function===!0){var b={environment:o,input:w};c=d.implementation.apply(b,p),G(c)&&(c=c.next().value),O(c)&&(c=await c)}else if(typeof d=="function")c=d.apply(w,p),O(c)&&(c=await c);else throw{code:"T1006",stack:new Error().stack}}catch(y){throw d&&(typeof y.token>"u"&&typeof d.token<"u"&&(y.token=d.token),y.position=d.position||y.position),y}return c}function Pt(d,g,w){var o={_jsonata_lambda:!0,input:g,environment:w,arguments:d.arguments,signature:d.signature,body:d.body};return d.thunk===!0&&(o.thunk=!0),o.apply=async function(c,p){return await J(o,p,g,c?c.environment:w)},o}async function pt(d,g,w){for(var o,c=[],p=0;p<d.arguments.length;p++){var b=d.arguments[p];b.type==="operator"&&b.value==="?"?c.push(b):c.push(await L(b,g,w))}var y=await L(d.procedure,g,w);if(typeof y>"u"&&d.procedure.type==="path"&&w.lookup(d.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:d.position,token:d.procedure.steps[0].value};if(Y(y))o=nn(y,c);else if(y&&y._jsonata_function===!0)o=hn(y.implementation,c);else if(typeof y=="function")o=hn(y,c);else throw{code:"T1008",stack:new Error().stack,position:d.position,token:d.procedure.type==="path"?d.procedure.steps[0].value:d.procedure.value};return o}function Je(d,g,w){if(typeof d>"u")return g;var o=d.validate(g,w);return o}async function ht(d,g){var w,o=Ft(d.environment);return d.arguments.forEach(function(c,p){o.bind(c.value,g[p])}),typeof d.body=="function"?w=await Kr(d.body,o):w=await L(d.body,d.input,o),w}function nn(d,g){var w=Ft(d.environment),o=[];d.arguments.forEach(function(p,b){var y=g[b];y&&y.type==="operator"&&y.value==="?"?o.push(p):w.bind(p.value,y)});var c={_jsonata_lambda:!0,input:d.input,environment:w,arguments:o,body:d.body};return c}function hn(d,g){var w=fn(d);w=w.map(function(b){return"$"+b.trim()});var o="function("+w.join(", ")+"){ _ }",c=u(o);c.body=d;var p=nn(c,g);return p}async function Kr(d,g){var w=fn(d),o=w.map(function(b){return g.lookup(b.trim())}),c={environment:g},p=d.apply(c,o);return O(p)&&(p=await p),p}function fn(d){var g=d.toString(),w=/\(([^)]*)\)/.exec(g)[1],o=w.split(",");return o}function V(d,g){var w={_jsonata_function:!0,implementation:d};return typeof g<"u"&&(w.signature=h(g)),w}async function Yr(d,g){if(!(typeof d>"u")){var w=this.input;typeof g<"u"&&(w=g,Array.isArray(w)&&!q(w)&&(w=_(w),w.outerWrapper=!0));try{var o=u(d,!1)}catch(p){throw Xt(p),{stack:new Error().stack,code:"D3120",value:p.message,error:p}}try{var c=await L(o,w,this.environment)}catch(p){throw Xt(p),{stack:new Error().stack,code:"D3121",value:p.message,error:p}}return c}}function or(d){if(!(typeof d>"u"))return JSON.parse(a.string(d))}function Ft(d){var g={};const w={bind:function(c,p){g[c]=p},lookup:function(c){var p;return g.hasOwnProperty(c)?p=g[c]:d&&(p=d.lookup(c)),p},timestamp:d?d.timestamp:null,async:d?d.async:!1,isParallelCall:d?d.isParallelCall:!1,global:d?d.global:{ancestry:[null]}};if(d){var o=d.lookup(Symbol.for("jsonata.__createFrame_push"));o&&o(d,w)}return w}x.bind("sum",V(a.sum,"<a<n>:n>")),x.bind("count",V(a.count,"<a:n>")),x.bind("max",V(a.max,"<a<n>:n>")),x.bind("min",V(a.min,"<a<n>:n>")),x.bind("average",V(a.average,"<a<n>:n>")),x.bind("string",V(a.string,"<x-b?:s>")),x.bind("substring",V(a.substring,"<s-nn?:s>")),x.bind("substringBefore",V(a.substringBefore,"<s-s:s>")),x.bind("substringAfter",V(a.substringAfter,"<s-s:s>")),x.bind("lowercase",V(a.lowercase,"<s-:s>")),x.bind("uppercase",V(a.uppercase,"<s-:s>")),x.bind("length",V(a.length,"<s-:n>")),x.bind("trim",V(a.trim,"<s-:s>")),x.bind("pad",V(a.pad,"<s-ns?:s>")),x.bind("match",V(a.match,"<s-f<s:o>n?:a<o>>")),x.bind("contains",V(a.contains,"<s-(sf):b>")),x.bind("replace",V(a.replace,"<s-(sf)(sf)n?:s>")),x.bind("split",V(a.split,"<s-(sf)n?:a<s>>")),x.bind("join",V(a.join,"<a<s>s?:s>")),x.bind("formatNumber",V(a.formatNumber,"<n-so?:s>")),x.bind("formatBase",V(a.formatBase,"<n-n?:s>")),x.bind("formatInteger",V(s.formatInteger,"<n-s:s>")),x.bind("parseInteger",V(s.parseInteger,"<s-s:n>")),x.bind("number",V(a.number,"<(nsb)-:n>")),x.bind("floor",V(a.floor,"<n-:n>")),x.bind("ceil",V(a.ceil,"<n-:n>")),x.bind("round",V(a.round,"<n-n?:n>")),x.bind("abs",V(a.abs,"<n-:n>")),x.bind("sqrt",V(a.sqrt,"<n-:n>")),x.bind("power",V(a.power,"<n-n:n>")),x.bind("random",V(a.random,"<:n>")),x.bind("boolean",V(a.boolean,"<x-:b>")),x.bind("not",V(a.not,"<x-:b>")),x.bind("map",V(a.map,"<af>")),x.bind("zip",V(a.zip,"<a+>")),x.bind("filter",V(a.filter,"<af>")),x.bind("single",V(a.single,"<af?>")),x.bind("reduce",V(a.foldLeft,"<afj?:j>")),x.bind("sift",V(a.sift,"<o-f?:o>")),x.bind("keys",V(a.keys,"<x-:a<s>>")),x.bind("lookup",V(a.lookup,"<x-s:x>")),x.bind("append",V(a.append,"<xx:a>")),x.bind("exists",V(a.exists,"<x:b>")),x.bind("spread",V(a.spread,"<x-:a<o>>")),x.bind("merge",V(a.merge,"<a<o>:o>")),x.bind("reverse",V(a.reverse,"<a:a>")),x.bind("each",V(a.each,"<o-f:a>")),x.bind("error",V(a.error,"<s?:x>")),x.bind("assert",V(a.assert,"<bs?:x>")),x.bind("type",V(a.type,"<x:s>")),x.bind("sort",V(a.sort,"<af?:a>")),x.bind("shuffle",V(a.shuffle,"<a:a>")),x.bind("distinct",V(a.distinct,"<x:x>")),x.bind("base64encode",V(a.base64encode,"<s-:s>")),x.bind("base64decode",V(a.base64decode,"<s-:s>")),x.bind("encodeUrlComponent",V(a.encodeUrlComponent,"<s-:s>")),x.bind("encodeUrl",V(a.encodeUrl,"<s-:s>")),x.bind("decodeUrlComponent",V(a.decodeUrlComponent,"<s-:s>")),x.bind("decodeUrl",V(a.decodeUrl,"<s-:s>")),x.bind("eval",V(Yr,"<sx?:x>")),x.bind("toMillis",V(s.toMillis,"<s-s?:n>")),x.bind("fromMillis",V(s.fromMillis,"<n-s?s?:s>")),x.bind("clone",V(or,"<(oa)-:o>"));var Un={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Xt(d){var g=Un[d.code];if(typeof g<"u"){var w=g.replace(/\{\{\{([^}]+)}}}/g,function(){return d[arguments[1]]});w=w.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(d[arguments[1]])}),d.message=w}}function Me(d,g){var w,o;try{w=u(d,g&&g.recover),o=w.errors,delete w.errors}catch(b){throw Xt(b),b}var c=Ft(x),p=new Date;return c.bind("now",V(function(b,y){return s.fromMillis(p.getTime(),b,y)},"<s?s?:s>")),c.bind("millis",V(function(){return p.getTime()},"<:n>")),g&&g.RegexEngine?Me.RegexEngine=g.RegexEngine:Me.RegexEngine=RegExp,{evaluate:async function(b,y,$){if(typeof o<"u"){var N={code:"S0500",position:0};throw Xt(N),N}if(typeof y<"u"){var Z;Z=Ft(c);for(var ae in y)Z.bind(ae,y[ae])}else Z=c;Z.bind("$",b),p=new Date,Z.timestamp=p,Array.isArray(b)&&!q(b)&&(b=_(b),b.outerWrapper=!0);var Ne;try{return Ne=await L(w,b,Z),typeof $=="function"&&$(null,Ne),Ne}catch(ke){throw Xt(ke),ke}},assign:function(b,y){c.bind(b,y)},registerFunction:function(b,y,$){var N=V(y,$);c.bind(b,N)},ast:function(){return w},errors:function(){return o}}}return Me.parser=u,Me})();r.exports=T},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(t,r,i){var s=t("./signature");const a=(()=>{var l={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},h=function(E){var v=0,k=E.length,_=function(Y,G){var O={type:Y,value:G,position:v};return O},q=function(){for(var Y=v,G=0,O,U,P=function(L){if(E.charAt(L)==="/"&&G===0){for(var j=0;E.charAt(L-(j+1))==="\\";)j++;if(j%2===0)return!0}return!1};v<k;){var x=E.charAt(v);if(P(v)){if(O=E.substring(Y,v),O==="")throw{code:"S0301",stack:new Error().stack,position:v};for(v++,x=E.charAt(v),Y=v;x==="i"||x==="m";)v++,x=E.charAt(v);return U=E.substring(Y,v)+"g",new RegExp(O,U)}(x==="("||x==="["||x==="{")&&E.charAt(v-1)!=="\\"&&G++,(x===")"||x==="]"||x==="}")&&E.charAt(v-1)!=="\\"&&G--,v++}throw{code:"S0302",stack:new Error().stack,position:v}},ee=function(Y){if(v>=k)return null;for(var G=E.charAt(v);v<k&&` 	
\r\v`.indexOf(G)>-1;)v++,G=E.charAt(v);if(G==="/"&&E.charAt(v+1)==="*"){var O=v;for(v+=2,G=E.charAt(v);!(G==="*"&&E.charAt(v+1)==="/");)if(G=E.charAt(++v),v>=k)throw{code:"S0106",stack:new Error().stack,position:O};return v+=2,G=E.charAt(v),ee(Y)}if(Y!==!0&&G==="/")return v++,_("regex",q());if(G==="."&&E.charAt(v+1)===".")return v+=2,_("operator","..");if(G===":"&&E.charAt(v+1)==="=")return v+=2,_("operator",":=");if(G==="!"&&E.charAt(v+1)==="=")return v+=2,_("operator","!=");if(G===">"&&E.charAt(v+1)==="=")return v+=2,_("operator",">=");if(G==="<"&&E.charAt(v+1)==="=")return v+=2,_("operator","<=");if(G==="*"&&E.charAt(v+1)==="*")return v+=2,_("operator","**");if(G==="~"&&E.charAt(v+1)===">")return v+=2,_("operator","~>");if(G==="?"&&E.charAt(v+1)===":")return v+=2,_("operator","?:");if(G==="?"&&E.charAt(v+1)==="?")return v+=2,_("operator","??");if(Object.prototype.hasOwnProperty.call(l,G))return v++,_("operator",G);if(G==='"'||G==="'"){var U=G;v++;for(var P="";v<k;){if(G=E.charAt(v),G==="\\")if(v++,G=E.charAt(v),Object.prototype.hasOwnProperty.call(u,G))P+=u[G];else if(G==="u"){var x=E.substr(v+1,4);if(/^[0-9a-fA-F]+$/.test(x)){var L=parseInt(x,16);P+=String.fromCharCode(L),v+=4}else throw{code:"S0104",stack:new Error().stack,position:v}}else throw{code:"S0103",stack:new Error().stack,position:v,token:G};else{if(G===U)return v++,_("string",P);P+=G}v++}throw{code:"S0101",stack:new Error().stack,position:v}}var j=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,de=j.exec(E.substring(v));if(de!==null){var pe=parseFloat(de[0]);if(!isNaN(pe)&&isFinite(pe))return v+=de[0].length,_("number",pe);throw{code:"S0102",stack:new Error().stack,position:v,token:de[0]}}var ne;if(G==="`"){v++;var R=E.indexOf("`",v);if(R!==-1)return ne=E.substring(v,R),v=R+1,_("name",ne);throw v=k,{code:"S0105",stack:new Error().stack,position:v}}for(var X=v,oe;;)if(oe=E.charAt(X),X===k||` 	
\r\v`.indexOf(oe)>-1||Object.prototype.hasOwnProperty.call(l,oe)){if(E.charAt(v)==="$")return ne=E.substring(v+1,X),v=X,_("variable",ne);switch(ne=E.substring(v,X),v=X,ne){case"or":case"in":case"and":return _("operator",ne);case"true":return _("value",!0);case"false":return _("value",!1);case"null":return _("value",null);default:return v===k&&ne===""?null:_("name",ne)}}else X++};return ee},T=function(E,v){var k,_,q={},ee=[],Y=function(){var f=[];k.id!=="(end)"&&f.push({type:k.type,value:k.value,position:k.position});for(var m=_();m!==null;)f.push(m),m=_();return f},G={nud:function(){var f={code:"S0211",token:this.value,position:this.position};if(v)return f.remaining=Y(),f.type="error",ee.push(f),f;throw f.stack=new Error().stack,f}},O=function(f,m){var H=q[f];return m=m||0,H?m>=H.lbp&&(H.lbp=m):(H=Object.create(G),H.id=H.value=f,H.lbp=m,q[f]=H),H},U=function(f){if(v){f.remaining=Y(),ee.push(f);var m=q["(error)"];return k=Object.create(m),k.error=f,k.type="(error)",k}else throw f.stack=new Error().stack,f},P=function(f,m){if(f&&k.id!==f){var H;k.id==="(end)"?H="S0203":H="S0202";var he={code:H,position:k.position,token:k.value,value:f};return U(he)}var ze=_(m);if(ze===null)return k=q["(end)"],k.position=E.length,k;var $e=ze.value,C=ze.type,D;switch(C){case"name":case"variable":D=q["(name)"];break;case"operator":if(D=q[$e],!D)return U({code:"S0204",stack:new Error().stack,position:ze.position,token:$e});break;case"string":case"number":case"value":D=q["(literal)"];break;case"regex":C="regex",D=q["(regex)"];break;default:return U({code:"S0205",stack:new Error().stack,position:ze.position,token:$e})}return k=Object.create(D),k.value=$e,k.type=C,k.position=ze.position,k},x=function(f){var m,H=k;for(P(null,!0),m=H.nud();f<k.lbp;)H=k,P(),m=H.led(m);return m},L=function(f){var m=O(f,0);m.nud=function(){return this}},j=function(f,m,H){var he=m||l[f],ze=O(f,he);return ze.led=H||function($e){return this.lhs=$e,this.rhs=x(he),this.type="binary",this},ze},de=function(f,m,H){var he=O(f,m);return he.led=H,he},pe=function(f,m){var H=O(f);return H.nud=m||function(){return this.expression=x(70),this.type="unary",this},H};L("(end)"),L("(name)"),L("(literal)"),L("(regex)"),O(":"),O(";"),O(","),O(")"),O("]"),O("}"),O(".."),j("."),j("+"),j("-"),j("*"),j("/"),j("%"),j("="),j("<"),j(">"),j("!="),j("<="),j(">="),j("&"),j("and"),j("or"),j("in"),L("and"),L("or"),L("in"),pe("-"),j("~>"),j("??",l["??"],function(f){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[f]},this.then=f,this.else=x(0),this}),de("(error)",10,function(f){return this.lhs=f,this.error=k.error,this.remaining=Y(),this.type="error",this}),pe("*",function(){return this.type="wildcard",this}),pe("**",function(){return this.type="descendant",this}),pe("%",function(){return this.type="parent",this}),j("(",l["("],function(f){if(this.procedure=f,this.type="function",this.arguments=[],k.id!==")")for(;k.type==="operator"&&k.id==="?"?(this.type="partial",this.arguments.push(k),P("?")):this.arguments.push(x(0)),k.id===",";)P(",");if(P(")",!0),f.type==="name"&&(f.value==="function"||f.value==="Î»")){if(this.arguments.forEach(function($e,C){if($e.type!=="variable")return U({code:"S0208",stack:new Error().stack,position:$e.position,token:$e.value,value:C+1})}),this.type="lambda",k.id==="<"){for(var m=k.position,H=1,he="<";H>0&&k.id!=="{"&&k.id!=="(end)";){var ze=P();ze.id===">"?H--:ze.id==="<"&&H++,he+=ze.value}P(">");try{this.signature=s(he)}catch($e){return $e.position=m+$e.offset,U($e)}}P("{"),this.body=x(0),P("}")}return this}),pe("(",function(){for(var f=[];k.id!==")"&&(f.push(x(0)),k.id===";");)P(";");return P(")",!0),this.type="block",this.expressions=f,this}),pe("[",function(){var f=[];if(k.id!=="]")for(;;){var m=x(0);if(k.id===".."){var H={type:"binary",value:"..",position:k.position,lhs:m};P(".."),H.rhs=x(0),m=H}if(f.push(m),k.id!==",")break;P(",")}return P("]",!0),this.expressions=f,this.type="unary",this}),j("[",l["["],function(f){if(k.id==="]"){for(var m=f;m&&m.type==="binary"&&m.value==="[";)m=m.lhs;return m.keepArray=!0,P("]"),f}else return this.lhs=f,this.rhs=x(l["]"]),this.type="binary",P("]",!0),this}),j("^",l["^"],function(f){P("(");for(var m=[];;){var H={descending:!1};if(k.id==="<"?P("<"):k.id===">"&&(H.descending=!0,P(">")),H.expression=x(0),m.push(H),k.id!==",")break;P(",")}return P(")"),this.lhs=f,this.rhs=m,this.type="binary",this});var ne=function(f){var m=[];if(k.id!=="}")for(;;){var H=x(0);P(":");var he=x(0);if(m.push([H,he]),k.id!==",")break;P(",")}return P("}",!0),typeof f>"u"?(this.lhs=m,this.type="unary"):(this.lhs=f,this.rhs=m,this.type="binary"),this};pe("{",ne),j("{",l["{"],ne),de(":=",l[":="],function(f){return f.type!=="variable"?U({code:"S0212",stack:new Error().stack,position:f.position,token:f.value}):(this.lhs=f,this.rhs=x(l[":="]-1),this.type="binary",this)}),j("@",l["@"],function(f){return this.lhs=f,this.rhs=x(l["@"]),this.rhs.type!=="variable"?U({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),j("#",l["#"],function(f){return this.lhs=f,this.rhs=x(l["#"]),this.rhs.type!=="variable"?U({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),j("?",l["?"],function(f){return this.type="condition",this.condition=f,this.then=x(0),k.id===":"&&(P(":"),this.else=x(0)),this}),j("?:",l["?:"],function(f){return this.type="condition",this.condition=f,this.then=f,this.else=x(0),this}),pe("|",function(){return this.type="transform",this.pattern=x(0),P("|"),this.update=x(0),k.id===","&&(P(","),this.delete=x(0)),P("|"),this});var R=function(f){var m;if(f.type==="function"&&!f.predicate){var H={type:"lambda",thunk:!0,arguments:[],position:f.position};H.body=f,m=H}else if(f.type==="condition")f.then=R(f.then),typeof f.else<"u"&&(f.else=R(f.else)),m=f;else if(f.type==="block"){var he=f.expressions.length;he>0&&(f.expressions[he-1]=R(f.expressions[he-1])),m=f}else m=f;return m},X=0,oe=0,ye=[],ie=function(f,m){switch(f.type){case"name":case"wildcard":m.level--,m.level===0&&(typeof f.ancestor>"u"||(ye[m.index].slot.label=f.ancestor.label),f.ancestor=m,f.tuple=!0);break;case"parent":m.level++;break;case"block":f.expressions.length>0&&(f.tuple=!0,m=ie(f.expressions[f.expressions.length-1],m));break;case"path":f.tuple=!0;var H=f.steps.length-1;for(m=ie(f.steps[H--],m);m.level>0&&H>=0;)m=ie(f.steps[H--],m);break;default:throw{code:"S0217",token:f.type,position:f.position}}return m},K=function(f,m){if(typeof m.seekingParent<"u"||m.type==="parent"){var H=typeof m.seekingParent<"u"?m.seekingParent:[];m.type==="parent"&&H.push(m.slot),typeof f.seekingParent>"u"?f.seekingParent=H:Array.prototype.push.apply(f.seekingParent,H)}},re=function(f){var m=f.steps.length-1,H=f.steps[m],he=typeof H.seekingParent<"u"?H.seekingParent:[];H.type==="parent"&&he.push(H.slot);for(var ze=0;ze<he.length;ze++){var $e=he[ze];for(m=f.steps.length-2;$e.level>0;){if(m<0){typeof f.seekingParent>"u"?f.seekingParent=[$e]:f.seekingParent.push($e);break}for(var C=f.steps[m--];m>=0&&C.focus&&f.steps[m].focus;)C=f.steps[m--];$e=ie(C,$e)}}},B=function(f){var m;switch(f.type){case"binary":switch(f.value){case".":var H=B(f.lhs);H.type==="path"?m=H:m={type:"path",steps:[H]},H.type==="parent"&&(m.seekingParent=[H.slot]);var he=B(f.rhs);he.type==="function"&&he.procedure.type==="path"&&he.procedure.steps.length===1&&he.procedure.steps[0].type==="name"&&m.steps[m.steps.length-1].type==="function"&&(m.steps[m.steps.length-1].nextFunction=he.procedure.steps[0].value),he.type==="path"?Array.prototype.push.apply(m.steps,he.steps):(typeof he.predicate<"u"&&(he.stages=he.predicate,delete he.predicate),m.steps.push(he)),m.steps.filter(function(F){if(F.type==="number"||F.type==="value")throw{code:"S0213",stack:new Error().stack,position:F.position,value:F.value};return F.type==="string"}).forEach(function(F){F.type="name"}),m.steps.filter(function(F){return F.keepArray===!0}).length>0&&(m.keepSingletonArray=!0);var ze=m.steps[0];ze.type==="unary"&&ze.value==="["&&(ze.consarray=!0);var $e=m.steps[m.steps.length-1];$e.type==="unary"&&$e.value==="["&&($e.consarray=!0),re(m);break;case"[":m=B(f.lhs);var C=m,D="predicate";if(m.type==="path"&&(C=m.steps[m.steps.length-1],D="stages"),typeof C.group<"u")throw{code:"S0209",stack:new Error().stack,position:f.position};typeof C[D]>"u"&&(C[D]=[]);var A=B(f.rhs);typeof A.seekingParent<"u"&&(A.seekingParent.forEach(F=>{F.level===1?ie(C,F):F.level--}),K(C,A)),C[D].push({type:"filter",expr:A,position:f.position});break;case"{":if(m=B(f.lhs),typeof m.group<"u")throw{code:"S0210",stack:new Error().stack,position:f.position};m.group={lhs:f.rhs.map(function(F){return[B(F[0]),B(F[1])]}),position:f.position};break;case"^":m=B(f.lhs),m.type!=="path"&&(m={type:"path",steps:[m]});var M={type:"sort",position:f.position};M.terms=f.rhs.map(function(F){var se=B(F.expression);return K(M,se),{descending:F.descending,expression:se}}),m.steps.push(M),re(m);break;case":=":m={type:"bind",value:f.value,position:f.position},m.lhs=B(f.lhs),m.rhs=B(f.rhs),K(m,m.rhs);break;case"@":if(m=B(f.lhs),C=m,m.type==="path"&&(C=m.steps[m.steps.length-1]),typeof C.stages<"u"||typeof C.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:f.position};if(C.type==="sort")throw{code:"S0216",stack:new Error().stack,position:f.position};f.keepArray&&(C.keepArray=!0),C.focus=f.rhs.value,C.tuple=!0;break;case"#":m=B(f.lhs),C=m,m.type==="path"?C=m.steps[m.steps.length-1]:(m={type:"path",steps:[m]},typeof C.predicate<"u"&&(C.stages=C.predicate,delete C.predicate)),typeof C.stages>"u"?C.index=f.rhs.value:C.stages.push({type:"index",value:f.rhs.value,position:f.position}),C.tuple=!0;break;case"~>":m={type:"apply",value:f.value,position:f.position},m.lhs=B(f.lhs),m.rhs=B(f.rhs),m.keepArray=m.lhs.keepArray||m.rhs.keepArray;break;default:m={type:f.type,value:f.value,position:f.position},m.lhs=B(f.lhs),m.rhs=B(f.rhs),K(m,m.lhs),K(m,m.rhs)}break;case"unary":m={type:f.type,value:f.value,position:f.position},f.value==="["?m.expressions=f.expressions.map(function(F){var se=B(F);return K(m,se),se}):f.value==="{"?m.lhs=f.lhs.map(function(F){var se=B(F[0]);K(m,se);var xe=B(F[1]);return K(m,xe),[se,xe]}):(m.expression=B(f.expression),f.value==="-"&&m.expression.type==="number"?(m=m.expression,m.value=-m.value):K(m,m.expression));break;case"function":case"partial":m={type:f.type,name:f.name,value:f.value,position:f.position},m.arguments=f.arguments.map(function(F){var se=B(F);return K(m,se),se}),m.procedure=B(f.procedure);break;case"lambda":m={type:f.type,arguments:f.arguments,signature:f.signature,position:f.position};var W=B(f.body);m.body=R(W);break;case"condition":m={type:f.type,position:f.position},m.condition=B(f.condition),K(m,m.condition),m.then=B(f.then),K(m,m.then),typeof f.else<"u"&&(m.else=B(f.else),K(m,m.else));break;case"transform":m={type:f.type,position:f.position},m.pattern=B(f.pattern),m.update=B(f.update),typeof f.delete<"u"&&(m.delete=B(f.delete));break;case"block":m={type:f.type,position:f.position},m.expressions=f.expressions.map(function(F){var se=B(F);return K(m,se),(se.consarray||se.type==="path"&&se.steps[0].consarray)&&(m.consarray=!0),se});break;case"name":m={type:"path",steps:[f]},f.keepArray&&(m.keepSingletonArray=!0);break;case"parent":m={type:"parent",slot:{label:"!"+X++,level:1,index:oe++}},ye.push(m);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":m=f;break;case"operator":if(f.value==="and"||f.value==="or"||f.value==="in")f.type="name",m=B(f);else if(f.value==="?")m=f;else throw{code:"S0201",stack:new Error().stack,position:f.position,token:f.value};break;case"error":m=f,f.lhs&&(m=B(f.lhs));break;default:var z="S0206";f.id==="(end)"&&(z="S0207");var I={code:z,position:f.position,token:f.value};if(v)return ee.push(I),{type:"error",error:I};throw I.stack=new Error().stack,I}return f.keepArray&&(m.keepArray=!0),m};_=h(E),P();var Ae=x(0);if(k.id!=="(end)"){var dt={code:"S0201",position:k.position,token:k.value};U(dt)}if(Ae=B(Ae),Ae.type==="parent"||typeof Ae.seekingParent<"u")throw{code:"S0217",token:Ae.type,position:Ae.position};return ee.length>0&&(Ae.errors=ee),Ae};return T})();r.exports=a},{"./signature":5}],5:[function(t,r,i){var s=t("./utils");const a=(()=>{var l={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function u(h){for(var T=1,E=[],v={},k=v;T<h.length;){var _=h.charAt(T);if(_===":")break;var q=function(){E.push(v),k=v,v={}},ee=function(j,de,pe,ne){for(var R=1,X=de;X<j.length;)if(X++,_=j.charAt(X),_===ne){if(R--,R===0)break}else _===pe&&R++;return X};switch(_){case"s":case"n":case"b":case"l":case"o":v.regex="["+_+"m]",v.type=_,q();break;case"a":v.regex="[asnblfom]",v.type=_,v.array=!0,q();break;case"f":v.regex="f",v.type=_,q();break;case"j":v.regex="[asnblom]",v.type=_,q();break;case"x":v.regex="[asnblfom]",v.type=_,q();break;case"-":k.context=!0,k.contextRegex=new RegExp(k.regex),k.regex+="?";break;case"?":case"+":k.regex+=_;break;case"(":var Y=ee(h,T,"(",")"),G=h.substring(T+1,Y);if(G.indexOf("<")===-1)v.regex="["+G+"m]";else throw{code:"S0402",stack:new Error().stack,value:G,offset:T};v.type="("+G+")",T=Y,q();break;case"<":if(k.type==="a"||k.type==="f"){var O=ee(h,T,"<",">");k.subtype=h.substring(T+1,O),T=O}else throw{code:"S0401",stack:new Error().stack,value:k.type,offset:T};break}T++}var U="^"+E.map(function(j){return"("+j.regex+")"}).join("")+"$",P=new RegExp(U),x=function(j){var de;if(s.isFunction(j))de="f";else{var pe=typeof j;switch(pe){case"string":de="s";break;case"number":de="n";break;case"boolean":de="b";break;case"object":j===null?de="l":Array.isArray(j)?de="a":de="o";break;case"undefined":default:de="m"}}return de},L=function(j,de){for(var pe="^",ne=0,R=0;R<E.length;R++){pe+=E[R].regex;var X=de.match(pe);if(X===null)throw{code:"T0410",stack:new Error().stack,value:j[ne],index:ne+1};ne=X[0].length}throw{code:"T0410",stack:new Error().stack,value:j[ne],index:ne+1}};return{definition:h,validate:function(j,de){var pe="";j.forEach(function(oe){pe+=x(oe)});var ne=P.exec(pe);if(ne){var R=[],X=0;return E.forEach(function(oe,ye){var ie=j[X],K=ne[ye+1];if(K==="")if(oe.context&&oe.contextRegex){var re=x(de);if(oe.contextRegex.test(re))R.push(de);else throw{code:"T0411",stack:new Error().stack,value:de,index:X+1}}else R.push(ie),X++;else K.split("").forEach(function(B){if(oe.type==="a"){if(B==="m")ie=void 0;else{ie=j[X];var Ae=!0;if(typeof oe.subtype<"u"){if(B!=="a"&&K!==oe.subtype)Ae=!1;else if(B==="a"&&ie.length>0){var dt=x(ie[0]);if(dt!==oe.subtype.charAt(0))Ae=!1;else{var f=ie.filter(function(m){return x(m)!==dt});Ae=f.length===0}}}if(!Ae)throw{code:"T0412",stack:new Error().stack,value:ie,index:X+1,type:l[oe.subtype]};B!=="a"&&(ie=[ie])}R.push(ie),X++}else R.push(ie),X++})}),R}L(j,pe)}}}return u})();r.exports=a},{"./utils":6}],6:[function(t,r,i){const s=(()=>{function a(O){var U=!1;if(typeof O=="number"&&(U=!isNaN(O),U&&!isFinite(O)))throw{code:"D1001",value:O,stack:new Error().stack};return U}function l(O){var U=!1;return Array.isArray(O)&&(U=O.filter(function(P){return typeof P!="string"}).length===0),U}function u(O){var U=!1;return Array.isArray(O)&&(U=O.filter(function(P){return!a(P)}).length===0),U}function h(){var O=[];return O.sequence=!0,arguments.length===1&&O.push(arguments[0]),O}function T(O){return O.sequence===!0&&Array.isArray(O)}function E(O){return O&&(O._jsonata_function===!0||O._jsonata_lambda===!0)||typeof O=="function"}function v(O){var U=typeof O.arity=="number"?O.arity:typeof O.implementation=="function"?O.implementation.length:typeof O.length=="number"?O.length:O.arguments.length;return U}function k(O){return O&&O._jsonata_lambda===!0}var _=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function q(O){return typeof O=="object"&&O!==null&&_ in O&&"next"in O&&typeof O.next=="function"}function ee(O,U){if(O===U)return!0;if(typeof O=="object"&&typeof U=="object"&&O!==null&&U!==null){if(Array.isArray(O)&&Array.isArray(U)){if(O.length!==U.length)return!1;for(var P=0;P<O.length;P++)if(!ee(O[P],U[P]))return!1;return!0}var x=Object.getOwnPropertyNames(O),L=Object.getOwnPropertyNames(U);if(x.length!==L.length)return!1;for(x=x.sort(),L=L.sort(),P=0;P<x.length;P++)if(x[P]!==L[P])return!1;for(P=0;P<x.length;P++){var j=x[P];if(!ee(O[j],U[j]))return!1}return!0}return!1}function Y(O){return typeof O=="object"&&O!==null&&"then"in O&&typeof O.then=="function"}function G(O){var U=[];for(let P of O)U.push(P);return U}return{isNumeric:a,isArrayOfStrings:l,isArrayOfNumbers:u,createSequence:h,isSequence:T,isFunction:E,isLambda:k,isIterable:q,getFunctionArity:v,isDeepEqual:ee,stringToArray:G,isPromise:Y}})();r.exports=s},{}]},{},[3])(3)})})(Xi)),Xi.exports}var xp=Cp();const Wo=el(xp);var Kt={exports:{}};const ii=tl(sl),Ap="17.2.3",Sp={version:Ap};var Sa;function Tp(){if(Sa)return Kt.exports;Sa=1;var n={};const e=ii,t=ii,r=ii,i=ii,a=Sp.version,l=["ðŸ” encrypt with Dotenvx: https://dotenvx.com","ðŸ” prevent committing .env to code: https://dotenvx.com/precommit","ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild","ðŸ“¡ add observability to secrets: https://dotenvx.com/ops","ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops","ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops","âœ… audit secrets and track compliance: https://dotenvx.com/ops","ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops","ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops","ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`","âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }","âš™ï¸  enable debug logging with { debug: true }","âš™ï¸  override existing env vars with { override: true }","âš™ï¸  suppress all logs with { quiet: true }","âš™ï¸  write to custom object with { processEnv: myObject }","âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }"];function u(){return l[Math.floor(Math.random()*l.length)]}function h(R){return typeof R=="string"?!["false","0","no","off",""].includes(R.toLowerCase()):!!R}function T(){return process.stdout.isTTY}function E(R){return T()?`\x1B[2m${R}\x1B[0m`:R}const v=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function k(R){const X={};let oe=R.toString();oe=oe.replace(/\r\n?/mg,`
`);let ye;for(;(ye=v.exec(oe))!=null;){const ie=ye[1];let K=ye[2]||"";K=K.trim();const re=K[0];K=K.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),re==='"'&&(K=K.replace(/\\n/g,`
`),K=K.replace(/\\r/g,"\r")),X[ie]=K}return X}function _(R){R=R||{};const X=U(R);R.path=X;const oe=ne.configDotenv(R);if(!oe.parsed){const re=new Error(`MISSING_DATA: Cannot parse ${X} for an unknown reason`);throw re.code="MISSING_DATA",re}const ye=G(R).split(","),ie=ye.length;let K;for(let re=0;re<ie;re++)try{const B=ye[re].trim(),Ae=O(oe,B);K=ne.decrypt(Ae.ciphertext,Ae.key);break}catch(B){if(re+1>=ie)throw B}return ne.parse(K)}function q(R){console.error(`[dotenv@${a}][WARN] ${R}`)}function ee(R){console.log(`[dotenv@${a}][DEBUG] ${R}`)}function Y(R){console.log(`[dotenv@${a}] ${R}`)}function G(R){return R&&R.DOTENV_KEY&&R.DOTENV_KEY.length>0?R.DOTENV_KEY:n.DOTENV_KEY&&n.DOTENV_KEY.length>0?n.DOTENV_KEY:""}function O(R,X){let oe;try{oe=new URL(X)}catch(B){if(B.code==="ERR_INVALID_URL"){const Ae=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw Ae.code="INVALID_DOTENV_KEY",Ae}throw B}const ye=oe.password;if(!ye){const B=new Error("INVALID_DOTENV_KEY: Missing key part");throw B.code="INVALID_DOTENV_KEY",B}const ie=oe.searchParams.get("environment");if(!ie){const B=new Error("INVALID_DOTENV_KEY: Missing environment part");throw B.code="INVALID_DOTENV_KEY",B}const K=`DOTENV_VAULT_${ie.toUpperCase()}`,re=R.parsed[K];if(!re){const B=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${K} in your .env.vault file.`);throw B.code="NOT_FOUND_DOTENV_ENVIRONMENT",B}return{ciphertext:re,key:ye}}function U(R){let X=null;if(R&&R.path&&R.path.length>0)if(Array.isArray(R.path))for(const oe of R.path)e.existsSync(oe)&&(X=oe.endsWith(".vault")?oe:`${oe}.vault`);else X=R.path.endsWith(".vault")?R.path:`${R.path}.vault`;else X=t.resolve(process.cwd(),".env.vault");return e.existsSync(X)?X:null}function P(R){return R[0]==="~"?t.join(r.homedir(),R.slice(1)):R}function x(R){const X=h(n.DOTENV_CONFIG_DEBUG||R&&R.debug),oe=h(n.DOTENV_CONFIG_QUIET||R&&R.quiet);(X||!oe)&&Y("Loading env from encrypted .env.vault");const ye=ne._parseVault(R);let ie=n;return R&&R.processEnv!=null&&(ie=R.processEnv),ne.populate(ie,ye,R),{parsed:ye}}function L(R){const X=t.resolve(process.cwd(),".env");let oe="utf8",ye=n;R&&R.processEnv!=null&&(ye=R.processEnv);let ie=h(ye.DOTENV_CONFIG_DEBUG||R&&R.debug),K=h(ye.DOTENV_CONFIG_QUIET||R&&R.quiet);R&&R.encoding?oe=R.encoding:ie&&ee("No encoding is specified. UTF-8 is used by default");let re=[X];if(R&&R.path)if(!Array.isArray(R.path))re=[P(R.path)];else{re=[];for(const f of R.path)re.push(P(f))}let B;const Ae={};for(const f of re)try{const m=ne.parse(e.readFileSync(f,{encoding:oe}));ne.populate(Ae,m,R)}catch(m){ie&&ee(`Failed to load ${f} ${m.message}`),B=m}const dt=ne.populate(ye,Ae,R);if(ie=h(ye.DOTENV_CONFIG_DEBUG||ie),K=h(ye.DOTENV_CONFIG_QUIET||K),ie||!K){const f=Object.keys(dt).length,m=[];for(const H of re)try{const he=t.relative(process.cwd(),H);m.push(he)}catch(he){ie&&ee(`Failed to load ${H} ${he.message}`),B=he}Y(`injecting env (${f}) from ${m.join(",")} ${E(`-- tip: ${u()}`)}`)}return B?{parsed:Ae,error:B}:{parsed:Ae}}function j(R){if(G(R).length===0)return ne.configDotenv(R);const X=U(R);return X?ne._configVault(R):(q(`You set DOTENV_KEY but you are missing a .env.vault file at ${X}. Did you forget to build it?`),ne.configDotenv(R))}function de(R,X){const oe=Buffer.from(X.slice(-64),"hex");let ye=Buffer.from(R,"base64");const ie=ye.subarray(0,12),K=ye.subarray(-16);ye=ye.subarray(12,-16);try{const re=i.createDecipheriv("aes-256-gcm",oe,ie);return re.setAuthTag(K),`${re.update(ye)}${re.final()}`}catch(re){const B=re instanceof RangeError,Ae=re.message==="Invalid key length",dt=re.message==="Unsupported state or unable to authenticate data";if(B||Ae){const f=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw f.code="INVALID_DOTENV_KEY",f}else if(dt){const f=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw f.code="DECRYPTION_FAILED",f}else throw re}}function pe(R,X,oe={}){const ye=!!(oe&&oe.debug),ie=!!(oe&&oe.override),K={};if(typeof X!="object"){const re=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw re.code="OBJECT_REQUIRED",re}for(const re of Object.keys(X))Object.prototype.hasOwnProperty.call(R,re)?(ie===!0&&(R[re]=X[re],K[re]=X[re]),ye&&ee(ie===!0?`"${re}" is already defined and WAS overwritten`:`"${re}" is already defined and was NOT overwritten`)):(R[re]=X[re],K[re]=X[re]);return K}const ne={configDotenv:L,_configVault:x,_parseVault:_,config:j,decrypt:de,parse:k,populate:pe};return Kt.exports.configDotenv=ne.configDotenv,Kt.exports._configVault=ne._configVault,Kt.exports._parseVault=ne._parseVault,Kt.exports.config=ne.config,Kt.exports.decrypt=ne.decrypt,Kt.exports.parse=ne.parse,Kt.exports.populate=ne.populate,Kt.exports=ne,Kt.exports}var _p=Tp();const Go={".geojson":Gt.GeoJSON,".json":Gt.GeoJSON,".kml":Gt.KML,".gpx":Gt.GPX,".tif":Gt.GeoTIFF,".tiff":Gt.GeoTIFF,".geotiff":Gt.GeoTIFF},Bs=n=>{const e=n.getName().toLowerCase();for(const[t,r]of Object.entries(Go))if(e.endsWith(t))return r;return null},qo=n=>Bs(n)!==null,Ci=async n=>{const e=await et.getWorkspace();if(!e)throw new Error("No workspace available");const t=await e.getResource(n);if(!t)throw new Error("Invalid URL: "+n);return await t.getContents({uri:!0})},jo=n=>n.startsWith("blob:")||n.startsWith("http:")||n.startsWith("https:")||n.startsWith("data:"),Ni={},Xn=async(n,e,t)=>{const r=await Wo(`[**[${e}!='']]`).evaluate(n);for(const i of r){const s=i[e];if(jo(s))continue;let a;if(e==="src"&&t)try{a=(await t.resolveWorkspaceModule(s)).blobUrl}catch{a=await Ci(s)}else a=await Ci(s);Ni[a]=i[e],i[e]=a}},xr=n=>Ni[n],Ar=async(n,e)=>{const t=await Wo(`[**[${e}!='']]`).evaluate(n);for(const r of t){const i=r[e];!i||!i.startsWith("blob:")||(r[e]=Ni[i])}},Bo=n=>{Q.registerContribution("catalog.root",{label:n.label,icon:n.icon,contributionId:n.contributionId});const e=n.contributionId??n.label;n.items?.forEach(t=>{Q.registerContribution(e,{label:t.label,icon:t.icon,contributionId:t.contributionId});const i=import.meta.resolve("/.");t.items.forEach(s=>{const a={label:s.label,icon:s.icon,state:{...s.state}};a.state?.url&&(a.state.url=a.state.url.replace("${baseURL}/",i)),Q.registerContribution(t.contributionId,a)})})},ls=n=>{Object.entries(n).forEach(([e,t])=>{const r=/\${([a-zA-Z0-9_]+)}/g;n[e]=t.replace(r,(i,s)=>{const a=n[s];return a!==void 0?a:i})})},Vo=async(...n)=>{const e=await et.getWorkspace(),t={};for(const r of n){const i=await e?.getResource(r);if(!i)continue;const s=await i.getContents(),a=_p.parse(s||"");ls(a),Object.assign(t,a)}return ls(t),t},$p=Object.freeze(Object.defineProperty({__proto__:null,FILE_EXTENSION_TO_SOURCE_TYPE:Go,_blobsLookup:Ni,getOriginalUri:xr,getSourceTypeFromFile:Bs,isAbsoluteResource:jo,isSupportedSpatialFile:qo,loadEnvs:Vo,registerCatalog:Bo,replaceUris:Xn,replaceVars:ls,revertBlobUris:Ar,toBlobUri:Ci},Symbol.toStringTag,{value:"Module"}));al.resolveUrl=n=>Ci(n);xn.registerEditorInputHandler({canHandle:n=>n instanceof St&&n.getName().endsWith(".geospace"),handle:async n=>{const e={title:n.getName(),data:n,key:n.getName(),editorId:"map-editor",icon:"location-dot",state:{}};return e.widgetFactory=t=>S`
            <gs-map id="${t}" .input="${e}"></gs-map>`,e}});var Nt=(n=>(n[n.LOADED=0]="LOADED",n[n.LAYER_ADDED=1]="LAYER_ADDED",n[n.LAYER_DELETED=2]="LAYER_DELETED",n[n.LAYER_UPDATED=3]="LAYER_UPDATED",n[n.FEATURE_SELECTED=4]="FEATURE_SELECTED",n))(Nt||{});const Zt=cn(ac);function Op(n){return n.startsWith("blob:")||n.startsWith("http:")||n.startsWith("https:")}function Ta(n,e){if(n.startsWith("/"))return n.slice(1);const t=e.split("/").filter(s=>s),r=n.split("/").filter(s=>s);if(n.startsWith("./")||n.startsWith("../")||!n.startsWith("/")){const s=t.slice(0,-1);t.length=0,t.push(...s)}for(const s of r)s!=="."&&(s===".."?t.length>0&&t.pop():t.push(s));return t.join("/")}function Dp(n){const e=[],t=/import\s+(?:type\s+)?(?:[\w*{}\s,]+?\s+from\s+)?["']([^"']+)["']/g,r=/export\s+(?:type\s+)?(?:[\w*{}\s,]+?\s+from\s+)?["']([^"']+)["']/g,i=/import\s*\(\s*["']([^"']+)["']\s*\)/g;let s;for(;(s=t.exec(n))!==null;)e.push({fullMatch:s[0],importPath:s[1],isDynamic:!1,startIndex:s.index,endIndex:s.index+s[0].length});for(;(s=r.exec(n))!==null;)e.push({fullMatch:s[0],importPath:s[1],isDynamic:!1,startIndex:s.index,endIndex:s.index+s[0].length});for(;(s=i.exec(n))!==null;)e.push({fullMatch:s[0],importPath:s[1],isDynamic:!0,startIndex:s.index,endIndex:s.index+s[0].length});return e.sort((a,l)=>l.startIndex-a.startIndex)}class Rp{constructor(){this.blobUrlCache=new Map,this.moduleCache=new Map,this.resolvingModules=new Set,this.resolvingPromises=new Map}async resolveModuleRecursive(e){if(!await et.getWorkspace())throw new Error("Workspace not available");if(this.blobUrlCache.has(e))return this.blobUrlCache.get(e);if(this.resolvingPromises.has(e))return await this.resolvingPromises.get(e);if(this.resolvingModules.has(e))throw new Error(`Circular dependency detected: ${e}`);this.resolvingModules.add(e);const r=this.doResolveModule(e);this.resolvingPromises.set(e,r);try{return await r}finally{this.resolvingPromises.delete(e)}}async doResolveModule(e){const t=await et.getWorkspace();if(!t)throw new Error("Workspace not available");try{let r=await t.getResource(e);if(r||(await t.listChildren(!0),r=await t.getResource(e)),!r)throw new Error(`Module not found: ${e}`);let i=await r.getContents();const s=Dp(i);for(const u of s){const h=u.importPath;if(!Op(h))try{const T=Ta(h,e),E=await this.resolveModuleRecursive(T);let v;if(u.isDynamic)v=`import("${E}")`;else{const k=u.fullMatch.search(/["']/);if(k===-1)v=u.fullMatch;else{const _=u.fullMatch[k],q=u.fullMatch.lastIndexOf(_);q!==-1&&q>k?v=u.fullMatch.slice(0,k+1)+E+u.fullMatch.slice(q):v=u.fullMatch}}i=i.slice(0,u.startIndex)+v+i.slice(u.endIndex)}catch{}}const a=new Blob([i],{type:"application/javascript"}),l=URL.createObjectURL(a);return this.blobUrlCache.set(e,l),this.moduleCache.set(e,{code:i,workspacePath:e,blobUrl:l}),l}catch(r){throw r}finally{this.resolvingModules.delete(e)}}async resolveWorkspaceModule(e,t){const r=t?Ta(e,t):e;if(this.moduleCache.has(r))return this.moduleCache.get(r);await this.resolveModuleRecursive(r);const i=this.moduleCache.get(r);if(!i)throw new Error(`Failed to resolve module: ${r}`);return i}clear(){for(const e of this.blobUrlCache.values())e.startsWith("blob:")&&URL.revokeObjectURL(e);this.blobUrlCache.clear(),this.moduleCache.clear(),this.resolvingModules.clear()}}const Ip="iframe-map-renderer.html";class cs{constructor(e,t,r="openlayers"){this.messageId=0,this.pendingMessages=new Map,this.isMobileView=!1,this.gsMap=e,this.env=t,this.rendererType=r,this.operations=this.createProxy(this)}getRendererType(){return this.rendererType}getEnv(){return this.env}createProxy(e){return new Proxy({},{get(t,r){return async(...i)=>await e.sendMessage(r,{...i})}})}async reattached(){if(!this.targetElement){console.warn("No target element stored, cannot reattach");return}this.iframe&&this.iframe.parentElement&&this.iframe.remove(),await this.render(this.targetElement)}async render(e){if(this.iframe=document.createElement("iframe"),this.iframe.style.overflow="hidden",this.updateIframeStyles(),this.iframe.src=Ip,this.targetElement=typeof e=="string"?document.querySelector(e):e,!this.targetElement)throw new Error("Container element not found");this.targetElement.innerHTML="",this.targetElement.appendChild(this.iframe),await this.waitRendererReady(),this.setupMessageListener(),await this.sendMessage("render",{gsMap:this.gsMap,env:this.env,renderer:this.rendererType})}async modelToUI(e){await this.sendMessage("modelToUI",e??this.gsMap)}getOperations(){return this.operations}async getViewExtent(){return(await this.sendMessage("getViewExtent",{}))?.extent||[0,0,0,0]}async captureScreenshot(){return await this.sendMessage("captureScreenshot",{})}setOnDirty(e){this.onDirtyCallback=e}triggerDirty(){this.onDirtyCallback&&this.onDirtyCallback()}setOnSync(e){this.onSyncCallback=e}setOnClick(e){this.onClickCallback=e}triggerSync(e){this.onSyncCallback&&this.onSyncCallback(e)}toggleMobileView(){this.isMobileView=!this.isMobileView,this.updateIframeStyles()}isInMobileView(){return this.isMobileView}updateIframeStyles(){this.iframe&&(this.isMobileView?(this.iframe.style.width="375px",this.iframe.style.height="667px",this.iframe.style.border="2px solid rgb(168, 168, 168)",this.iframe.style.borderRadius="20px",this.iframe.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.51)",this.iframe.style.margin="20px auto",this.iframe.style.display="block"):(this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.border="none",this.iframe.style.borderRadius="0",this.iframe.style.boxShadow="none",this.iframe.style.margin="0"))}async handleAssetResolution(e,t){try{const{toBlobUri:r}=await Le(async()=>{const{toBlobUri:s}=await Promise.resolve().then(()=>$p);return{toBlobUri:s}},void 0),i=await r(t);this.iframe.contentWindow.postMessage({id:e,success:!0,assetUrl:i},"*")}catch(r){this.iframe.contentWindow.postMessage({id:e,success:!1,error:r instanceof Error?r.message:"Unknown error"},"*")}}destroy(){this.messageListener&&(window.removeEventListener("message",this.messageListener),this.messageListener=void 0),this.iframe&&(this.iframe.remove(),this.iframe=void 0),this.pendingMessages.clear()}setupMessageListener(){this.messageListener=e=>{if(e.source!==this.iframe?.contentWindow)return;const{id:t,result:r,error:i,type:s,event:a}=e.data;if(t!==void 0&&this.pendingMessages.has(t)){const{resolve:l,reject:u}=this.pendingMessages.get(t);if(this.pendingMessages.delete(t),i)u(new Error(i));else{const h=r??Object.fromEntries(Object.entries(e.data).filter(([T])=>!["id","type","event","error"].includes(T)));l(h)}}s==="dirty"?this.onDirtyCallback?.():s==="sync"?this.onSyncCallback?.(a):s==="iframeClicked"?this.onClickCallback?.():s==="resolveAsset"&&this.handleAssetResolution(t,e.data.path)},window.addEventListener("message",this.messageListener)}async waitRendererReady(){return new Promise(e=>{const t=r=>{r.source===this.iframe?.contentWindow&&r.data.type==="rendererReady"&&(window.removeEventListener("message",t),e())};window.addEventListener("message",t)})}async sendMessage(e,t){if(!this.iframe)throw new Error("Iframe not initialized");const r=++this.messageId;return new Promise((i,s)=>{this.pendingMessages.set(r,{resolve:i,reject:s}),this.iframe.contentWindow.postMessage({id:r,method:e,params:t},"*"),setTimeout(()=>{this.pendingMessages.has(r)&&(this.pendingMessages.delete(r),s(new Error("Message timeout")))},5e3)})}}class _a{constructor(e,t){this.gsMap=e,this.renderer=t}triggerDirty(){this.renderer.triggerDirty()}async setZoom(e){this.gsMap.view.zoom=e,this.triggerDirty()}async setCenter(e){this.gsMap.view.center=e,this.triggerDirty()}async switchColorMode(e){this.gsMap.view.colorMode=e,this.triggerDirty()}async addLayer(e,t){t?this.gsMap.layers.unshift(e):this.gsMap.layers.push(e),this.triggerDirty()}async deleteLayer(e){const t=Zn(this.gsMap,e);t>=0&&(this.gsMap.layers.splice(t,1),this.triggerDirty())}async renameLayer(e,t){const r=Yn(this.gsMap,e);r&&(r.name=t,this.triggerDirty())}async moveLayer(e,t){const r=Zn(this.gsMap,e);if(r<0)return;let i;if(t){if(i=Zn(this.gsMap,t),i<0||r===i)return}else i=r>0?r-1:r+1;if(i>=0&&i<this.gsMap.layers.length&&r!==i){const[s]=this.gsMap.layers.splice(r,1);this.gsMap.layers.splice(i,0,s),this.triggerDirty()}}async setLayerVisible(e,t){const r=Yn(this.gsMap,e);r&&(r.visible=t,this.triggerDirty())}async addControlFromModule(e){this.gsMap.controls.push({src:e,type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeControl(e){const t=Ep(this.gsMap,e);t>=0&&(this.gsMap.controls.splice(t,1),this.triggerDirty(),await this.renderer.modelToUI())}async addOverlayFromModule(e,t){this.gsMap.overlays.push({src:e,position:t||"bottom-left",type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeOverlay(e){const t=kp(this.gsMap,e);t>=0&&(this.gsMap.overlays.splice(t,1),this.triggerDirty(),await this.renderer.modelToUI())}async enableDrawing(e,t){}async disableDrawing(){}async enableFeatureSelection(){}async disableSelection(){}async deleteSelectedFeatures(){this.triggerDirty()}}class $a{constructor(e){this.source=e}async setZoom(e){}async setCenter(e){}async switchColorMode(e){}async addLayer(e,t){Zt.set({part:this.source,event:Nt.LAYER_ADDED})}async deleteLayer(e){Zt.set({part:this.source,event:Nt.LAYER_DELETED})}async renameLayer(e,t){Zt.set({part:this.source,event:Nt.LAYER_UPDATED})}async moveLayer(e,t){Zt.set({part:this.source,event:Nt.LAYER_UPDATED})}async setLayerVisible(e,t){}async addControlFromModule(e){}async removeControl(e){}async addOverlayFromModule(e,t){}async removeOverlay(e){}async enableDrawing(e,t){}async disableDrawing(){}async enableFeatureSelection(){}async disableSelection(){}async deleteSelectedFeatures(){Zt.set({part:this.source,event:Nt.LAYER_UPDATED})}}var Pp=Object.defineProperty,Lp=Object.getOwnPropertyDescriptor,Xr=(n,e,t,r)=>{for(var i=r>1?void 0:r?Lp(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Pp(e,t,i),i};const Mp=It("GsMapEditor");let Ye=class extends mt{constructor(){super(),this.mapContainer=Jt(),this.isFirstConnection=!0,this.moduleResolver=new Rp,this.interactionMode="none",this.selectedRenderer="openlayers",this.commandStack=new ja}getRenderer(){return this.renderer}getOperations(){return this.operations}doBeforeUI(){this.watch(Zt,({part:n,event:e})=>{this.onMapChanged({part:n,event:e})})}onMapChanged({part:n,event:e}){n===this&&(e===Nt.LAYER_ADDED||e===Nt.LAYER_DELETED||e===Nt.LAYER_UPDATED)&&this.updateToolbar()}renderToolbar(){const e=this.getGsMap()?.layers.filter(r=>{const i=r.type===Ys.VECTOR,s=r.source?.type===Gt.Features;return i&&s})||[],t=this.activeDrawingLayerUuid!==void 0;return S`
            <k-command cmd="zoom_in" icon="magnifying-glass-plus" title="Zoom in"></k-command>
            <k-command cmd="zoom_out" icon="magnifying-glass-minus" title="Zoom out"></k-command>
            <k-command cmd="reset_view" icon="house" title="Reset view"></k-command>
            <k-command cmd="refresh_map" icon="rotate" title="Refresh map"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command cmd="capture_map_screenshot" icon="camera" title="Capture screenshot"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command cmd="toggle_color_mode" icon="circle-half-stroke" title="Toggle dark/light mode"></k-command>
            <k-command cmd="toggle_mobile_view" icon="mobile" title="Toggle mobile view"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command icon="plus" 
                      title="Create Drawing Layer"
                      .action=${()=>this.handleCreateDrawingLayer()}>
            </k-command>
            
            ${ct(e.length>0,()=>{const r=e.map(i=>`${i.uuid}:${i.name}`).join("|");return S`
                ${ol(r,S`
                    <wa-select 
                        placeholder="Drawing layer"
                        size="small"
                        value="${this.activeDrawingLayerUuid??""}"
                        @change=${i=>{const s=i.target.value||void 0;this.activeDrawingLayerUuid=s,(s===void 0||i.target.value==="")&&(this.operations?.disableDrawing(),this.interactionMode="none"),this.updateToolbar()}}>
                        <wa-option value="">Select layer</wa-option>
                        ${e.map(i=>S`
                            <wa-option value="${i.uuid}">${i.name||"Layer"}</wa-option>
                        `)}
                    </wa-select>
                `)}
                
                <k-command icon="location-dot" 
                          title="Draw Point"
                          ?disabled=${!t}
                          .action=${()=>this.handleDrawPoint()}>
                </k-command>
                <k-command icon="minus" 
                          title="Draw LineString"
                          ?disabled=${!t}
                          .action=${()=>this.handleDrawLine()}>
                </k-command>
                <k-command icon="draw-polygon" 
                          title="Draw Polygon"
                          ?disabled=${!t}
                          .action=${()=>this.handleDrawPolygon()}>
                </k-command>
                
                <k-command icon="trash" 
                          title="Delete Selected Features"
                          ?disabled=${this.interactionMode!=="select"}
                          .action=${()=>this.handleDeleteSelected()}>
                </k-command>

                <wa-divider orientation="vertical"></wa-divider>
            `})}
            
            <k-command icon="hand-pointer" 
                      title="Select Features"
                      .action=${()=>this.handleSelectFeatures()}>
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>

            <wa-select 
                size="small"
                value="${this.selectedRenderer}"
                title="Map Renderer"
                @change=${r=>this.handleRendererChange(r.target.value)}>
                <wa-option value="openlayers">OpenLayers</wa-option>
                <wa-option value="maplibre">MapLibre</wa-option>
            </wa-select>
        `}async connectedCallback(){if(super.connectedCallback(),this.isFirstConnection){this.isFirstConnection=!1;return}this.renderer?.reattached&&(await this.renderer.reattached(),this.renderer.setOnClick&&this.renderer.setOnClick(()=>{Re.set(this)}))}async doInitUI(){const n=this.input?.data,e=await Vo(".env");e.BUILD_TIME=new Date;const t=await n.getContents();let r=t&&t.trim()?JSON.parse(t):Ra;r=this.migrateGsMap(r),Zs(r),await Xn(r,"url"),await Xn(r,"src",this.moduleResolver),this.gsMap=r,r.view&&(this.initialView={center:[...r.view.center],zoom:r.view.zoom}),this.selectedRenderer=r.state?.renderer||"openlayers",this.renderer=new cs(r,e,this.selectedRenderer);const i=this.renderer.getOperations(),s=new _a(r,this.renderer),a=new $a(this);this.operations=xa([s,i,a]);try{if(!this.mapContainer.value)throw new Error("Map container not available");await this.renderer.render(this.mapContainer.value),this.setupRendererCallbacks(),this.updateToolbar(),Zt.set({part:this,event:Nt.LOADED})}catch(l){console.error("Failed to render map:",l),ge(`Failed to render map: ${l.message}`)}}migrateGsMap(n){const e={...n};let t=!1;return n.view||(console.log("Creating view field and migrating old properties..."),t=!0,e.view={},n.center!==void 0&&(e.view.center=n.center,delete e.center),n.zoom!==void 0&&(e.view.zoom=n.zoom,delete e.zoom),n.projection!==void 0&&(e.view.projection=n.projection,delete e.projection),e.view.center===void 0&&(e.view.center=[0,0]),e.view.zoom===void 0&&(e.view.zoom=0),e.view.projection===void 0&&(e.view.projection="EPSG:3857")),(!n.styles||Object.keys(n.styles).length===0)&&(console.log("Adding default styles to map..."),t=!0,e.styles={...ll}),(!n.styleRules||n.styleRules.length===0)&&(console.log("Adding default style rules to map..."),t=!0,e.styleRules=[...cl]),t&&console.log("Map migration completed"),e}getGsMap(){return this.gsMap}setupRendererCallbacks(){this.renderer&&(this.renderer.setOnDirty(()=>this.markDirty(!0)),this.renderer.setOnSync(n=>{if(this.gsMap){switch(n.type){case"viewChanged":this.gsMap.view.center=n.view.center,this.gsMap.view.zoom=n.view.zoom,n.view.rotation!==void 0&&(this.gsMap.view.rotation=n.view.rotation),n.view.pitch!==void 0&&(this.gsMap.view.pitch=n.view.pitch),n.view.bearing!==void 0&&(this.gsMap.view.bearing=n.view.bearing);break;case"featuresChanged":const e=Yn(this.gsMap,n.layerUuid);e&&e.source?.type===Gt.Features&&(e.source.features=n.features);break;case"featureSelected":const t={feature:n.feature,layerUuid:n.layerUuid,metrics:n.metrics};console.info("Feature metrics:",t.metrics),Zt.set({part:this,event:Nt.FEATURE_SELECTED,payload:t});break;case"featureDeselected":console.info("Feature deselected"),Zt.set({part:this,event:Nt.FEATURE_SELECTED,payload:null}),this.interactionMode==="select"&&(this.interactionMode="none",this.updateToolbar());break;case"drawingDisabled":this.interactionMode==="draw"&&(this.interactionMode="none",this.updateToolbar());break}this.markDirty(!0)}}),this.renderer.setOnClick?.(()=>{Re.set(this)}))}async save(){if(!this.renderer){ge("Map not initialized");return}try{if(!this.gsMap){ge("Map not initialized");return}const n=JSON.parse(JSON.stringify(this.gsMap));await Ar(n,"url"),await Ar(n,"src"),this.input?.data.saveContents(JSON.stringify(n,null,2)),this.markDirty(!1)}catch(n){ge(`Save failed: ${n.message}`)}}get mapOperations(){return this.operations}edit(){yt("not yet implemented")}async refresh(){if(!this.renderer||!this.gsMap){Mp.error("Map not initialized");return}await Ar(this.gsMap,"url"),await Ar(this.gsMap,"src"),this.moduleResolver.clear(),await Xn(this.gsMap,"url"),await Xn(this.gsMap,"src",this.moduleResolver),await this.renderer.modelToUI(this.gsMap)}async resetView(){!this.operations||!this.initialView||(await this.operations.setCenter(this.initialView.center),await this.operations.setZoom(this.initialView.zoom))}async handleDrawPoint(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("Point",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleDrawLine(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("LineString",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleDrawPolygon(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("Polygon",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleSelectFeatures(){await this.operations?.enableFeatureSelection(),this.interactionMode="select",this.updateToolbar()}async handleDeleteSelected(){if(this.interactionMode==="select")try{await this.operations?.deleteSelectedFeatures(),yt("Selected features deleted")}catch(n){ge(n.message)}}async handleRendererChange(n){if(n!==this.selectedRenderer){if(this.selectedRenderer=n,this.gsMap&&(this.gsMap.state||(this.gsMap.state={}),this.gsMap.state.renderer=n),this.renderer&&this.gsMap&&this.mapContainer.value){const e=this.renderer.getEnv();this.renderer.destroy(),this.renderer=new cs(this.gsMap,e,n);const t=this.renderer.getOperations(),r=new _a(this.gsMap,this.renderer),i=new $a(this);this.operations=xa([r,t,i]);try{await this.renderer.render(this.mapContainer.value),this.setupRendererCallbacks(),yt(`Switched to ${n==="maplibre"?"MapLibre":"OpenLayers"} renderer`)}catch(s){ge(`Failed to switch renderer: ${s.message}`)}}this.markDirty(!0),this.updateToolbar()}}async handleCreateDrawingLayer(){if(!this.gsMap){ge("Map not initialized");return}const n=await Fr("Enter name for new drawing layer:","Drawing Layer");if(!n)return;const e=Zs({name:n,type:Ys.VECTOR,source:{type:Gt.Features,features:[]},visible:!0});await this.operations?.addLayer(e,!1);const t=this.gsMap?.layers.find(r=>r.uuid===e.uuid);t?.uuid&&(this.activeDrawingLayerUuid=t.uuid),await this.updateComplete,this.updateToolbar(),yt(`Created drawing layer: ${n}`)}doClose(){this.renderer?.destroy(),this.renderer=void 0,this.input=void 0,this.moduleResolver.clear()}render(){return S`
            <div class="gc-map-container" ${Qt(this.mapContainer)}>
            </div>
        `}};Ye.styles=[Ze`
        :host {
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .gc-map-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
    `];Xr([le({attribute:!1})],Ye.prototype,"input",2);Xr([le({type:String})],Ye.prototype,"activeDrawingLayerUuid",2);Xr([le({type:String})],Ye.prototype,"interactionMode",2);Xr([le({type:String})],Ye.prototype,"selectedRenderer",2);Ye=Xr([qe("gs-map")],Ye);var Np=Object.defineProperty,Up=Object.getOwnPropertyDescriptor,Ho=(n,e,t,r)=>{for(var i=r>1?void 0:r?Up(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Np(e,t,i),i};let xi=class extends mt{doBeforeUI(){this.watch(Ut,n=>{this.onPartChanged(n)}),this.watch(Zt,({part:n})=>{this.onMapChanged({part:n})})}onPartChanged(n){if(!(n==this||n==this.mapEditor)){if(!(n instanceof Ye)){this.mapEditor=void 0,this.requestUpdate();return}this.mapEditor=n,this.requestUpdate()}}onMapChanged({part:n}){n==this.mapEditor&&this.requestUpdate()}toggleVisible(n){const e=this.mapEditor.getGsMap(),t=Yn(e,n);if(!t)return;const i=!(t.visible!==!1);this.mapEditor?.mapOperations?.setLayerVisible(n,i),this.updateLater()}async confirmAction(n,e){await Wr(n)&&e()}selectLayer(n){this.selectedLayerUuid=n,this.updateToolbar(),this.updateContextMenu()}renameLayer(n){if(!this.mapEditor)return;const e=n||this.selectedLayerUuid;if(!e)return;const t=this.mapEditor.getGsMap();if(!Yn(t,e))return;const i=Zn(t,e),s=we.createExecutionContext({index:i+1});we.execute("rename_layer",s)}deleteLayer(n){if(!this.mapEditor)return;const e=n||this.selectedLayerUuid;if(!e)return;const t=this.mapEditor.getGsMap(),r=Yn(t,e);r&&this.confirmAction(`Delete layer "${r.name||"Layer"}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.deleteLayer(e)))}moveLayerUp(n){if(!this.mapEditor)return;const e=this.mapEditor.getGsMap();if(!e)return;const t=Zn(e,n);if(t<=0)return;const r=e.layers[t-1]?.uuid;r&&(this.withRefresh(()=>this.mapEditor?.mapOperations?.moveLayer(n,r)),this.selectedLayerUuid=r)}moveLayerDown(n){if(!this.mapEditor)return;const e=this.mapEditor.getGsMap();if(!e)return;const t=Zn(e,n);if(t<0||t>=e.layers.length-1)return;const r=e.layers[t+1]?.uuid;r&&(this.withRefresh(()=>this.mapEditor?.mapOperations?.moveLayer(n,r)),this.selectedLayerUuid=r)}renderToolbar(){const n=this.selectedLayerUuid!==void 0;return S`
            <k-command ?disabled=${!n} 
                      title="Rename selected layer" 
                      icon="pen"
                      .action=${()=>this.renameLayer()}>
            </k-command>
            <k-command ?disabled=${!n} 
                      title="Delete selected layer" 
                      icon="trash"
                      .action=${()=>this.deleteLayer()}>
            </k-command>
        `}renderContextMenu(){const n=this.selectedLayerUuid!==void 0;return S`
            <k-command ?disabled=${!n} 
                      icon="pen"
                      .action=${()=>this.renameLayer()}>
                Rename
            </k-command>
            <k-command ?disabled=${!n} 
                      icon="trash"
                      .action=${()=>this.deleteLayer()}>
                Delete
            </k-command>
        `}render(){return ct(!this.mapEditor,()=>S`
                    <k-no-content message="Select a map."></k-no-content>`,()=>S`
                <wa-tree>
                    <wa-tree-item expanded>
                        <k-icon name="fg layers"></k-icon> Layers
                        ${this.mapEditor.getGsMap()?.layers.map((n,e)=>S`
                            <wa-tree-item @click="${()=>n.uuid&&this.selectLayer(n.uuid)}" 
                                          class="${this.selectedLayerUuid===n.uuid?"selected":""}">
                                <div class="layer-item">
                                    <div class="layer-name">
                                        <span>${n.name??`Layer ${e+1}`}${e==0?S`
                                            <small>(basemap)</small>`:""}</span>
                                    </div>
                                    <div class="layer-actions">
                                        <k-command size="small"
                                                  icon="${n.visible!==!1?"eye":"eye-slash"}"
                                                  title="${n.visible!==!1?"Hide layer":"Show layer"}"
                                                  .action=${()=>n.uuid&&this.toggleVisible(n.uuid)}>
                                        </k-command>
                                        <k-command size="small"
                                                  icon="arrow-up"
                                                  title="Move layer up"
                                                  ?disabled="${e===0}"
                                                  .action=${()=>n.uuid&&this.moveLayerUp(n.uuid)}>
                                        </k-command>
                                        <k-command size="small"
                                                  icon="arrow-down"
                                                  title="Move layer down"
                                                  ?disabled="${e===this.mapEditor.getGsMap().layers.length-1}"
                                                  .action=${()=>n.uuid&&this.moveLayerDown(n.uuid)}>
                                        </k-command>
                                    </div>
                                </div>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="fg map-control"></k-icon> Controls
                        ${this.mapEditor?.getGsMap()?.controls.map(n=>S`
                            <wa-tree-item>
                                <span>${xr(n.src)}</span>
                                <k-command size="small"
                                          icon="trash"
                                          title="Delete control"
                                          .action=${()=>{n.uuid&&this.confirmAction(`Delete control "${xr(n.src)}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.removeControl(n.uuid)))}}>
                                </k-command>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="fg map-poi"></k-icon> Overlays
                        ${this.mapEditor?.getGsMap()?.overlays.map(n=>S`
                            <wa-tree-item>
                                <span>${xr(n.src)}</span>
                                <k-command size="small"
                                          icon="trash"
                                          title="Delete overlay"
                                          .action=${()=>{n.uuid&&this.confirmAction(`Delete overlay "${xr(n.src)}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.removeOverlay(n.uuid)))}}>
                                </k-command>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="highlighter"></k-icon> Styles
                        <wa-tree-item>
                            <span>Defined Styles: ${Object.keys(this.mapEditor.getGsMap()?.styles||{}).length}</span>
                        </wa-tree-item>
                        <wa-tree-item>
                            <span>Style Rules: ${this.mapEditor.getGsMap()?.styleRules?.length||0}</span>
                        </wa-tree-item>
                    </wa-tree-item>
                </wa-tree>
            `)}};xi.styles=Ze`
        :host {
            display: flex;
            flex-direction: column;
        }
        
        wa-tree-item.selected {
            background-color: var(--wa-color-primary-50);
        }
        
        .layer-item {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 4px;
        }
        
        .layer-name {
            flex: 1;
        }
        
        .layer-actions {
            display: flex;
            gap: 2px;
        }
    `;Ho([We()],xi.prototype,"selectedLayerUuid",2);xi=Ho([qe("gs-map-props")],xi);var zp=Object.defineProperty,Fp=Object.getOwnPropertyDescriptor,Xo=(n,e,t,r)=>{for(var i=r>1?void 0:r?Fp(e,t):e,s=n.length-1,a;s>=0;s--)(a=n[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&zp(e,t,i),i};const Wp="catalog.root";let kn=class extends mt{constructor(){super(...arguments),this.treeRef=Jt()}doBeforeUI(){const n=Q.getContributions(Wp);this.rootNodes=this.toTreeNodes(n)}renderToolbar(){const n=Re.get()instanceof kn&&Mt.get()!==void 0;return S`
            <k-command cmd="checkout" icon="file-arrow-down" ?disabled=${!n} title="Checkout"></k-command>
            <k-command cmd="refresh_catalog" icon="arrows-rotate" title="Refresh Catalog"></k-command>
            <k-command cmd="catalog_expand_all" icon="angles-down" slot="end" title="Expand All"></k-command>
            <k-command cmd="catalog_collapse_all" icon="angles-up" slot="end" title="Collapse All"></k-command>
        `}toTreeNodes(n){return n.map(e=>{const t={data:e.state,icon:e.icon,label:e.label,leaf:!1};if(e.contributionId){const r=Q.getContributions(e.contributionId);t.leaf=r.length===0,t.children=this.toTreeNodes(r)}return t})}onItemDblClicked(n){const e=n.currentTarget.model.data.url;this.executeCommand("checkout",{url:e})}onSelectionChanged(n){const e=n.detail.selection[0].model;Mt.set(e.data)}setAllExpanded(n){const e=this.treeRef.value;e&&e.querySelectorAll("wa-tree-item").forEach(t=>{t.expanded=n})}refresh(){this.requestUpdate()}createTreeItems(n,e=!1){return n?S`
            <wa-tree-item
                    @dblclick=${this.nobubble(this.onItemDblClicked)} .model=${n} ?expanded=${e}>
                <span><k-icon name="${n.icon}"></k-icon> ${n.label}</span>
                ${n.children?.map(t=>this.createTreeItems(t))}
            </wa-tree-item>`:S``}render(){return S`
            <wa-tree ${Qt(this.treeRef)} @wa-selection-change=${this.nobubble(this.onSelectionChanged)} style="--indent-guide-width: 1px;">
                ${this.rootNodes?.map(n=>this.createTreeItems(n,!0))}
            </wa-tree>
        `}};kn.styles=Ze`
        :host {
            display: flex;
            flex-direction: column;
        }
    `;Xo([We()],kn.prototype,"rootNodes",2);kn=Xo([qe("gs-catalog")],kn);const Gp="geo!space catalog",qp="earth",jp="catalog.root.geospace",Bp=[{contributionId:"catalog.root.notebooks",label:"Notebooks",icon:"book",items:[{label:"Welcome to Jupyter Notebooks",icon:"graduation-cap",state:{url:"${baseURL}/notebooks/welcome.ipynb",type:"file"}},{label:"Simple Notebook",icon:"circle-info",state:{url:"${baseURL}/notebooks/simple-notebook.ipynb",type:"file"}}]},{contributionId:"catalog.root.datasets",label:"Datasets",icon:"clone",items:[{label:"countries.geojson",icon:"fg geojson-file",state:{url:"${baseURL}/datasets/countries.geojson",type:"file"}}]},{contributionId:"catalog.root.maps",label:"Maps",icon:"map-location",items:[{label:"OpenStreetMap basemap",icon:"earth",state:{url:"${baseURL}/maps/osm.geospace",type:"file"}},{label:"basemap.de basemap",icon:"earth",state:{url:"${baseURL}/maps/bm.geospace",type:"file"}},{label:"basemap.de WMS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms.geospace",type:"file"}},{label:"basemap.de WMS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms-gray.geospace",type:"file"}},{label:"basemap.de WMTS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts.geospace",type:"file"}},{label:"basemap.de WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts.geospace",type:"file"}},{label:"TopPlusOpen WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light-gray.geospace",type:"file"}},{label:"Esri World Imagery (Satellite)",icon:"satellite",state:{url:"${baseURL}/maps/esri-world-imagery.geospace",type:"file"}},{label:"Sentinel-2 Cloudless (Satellite)",icon:"satellite",state:{url:"${baseURL}/maps/sentinel2-cloudless.geospace",type:"file"}},{label:"MapLibre 3D Example",icon:"cubes",state:{url:"${baseURL}/maps/maplibre-3d-demo.geospace",type:"file"}}]},{contributionId:"catalog.root.overlays",label:"Overlays",icon:"fg map-poi",items:[]},{contributionId:"catalog.root.controls",label:"Controls",icon:"fg map-control",items:[]},{contributionId:"catalog.root.icons",label:"Icons",icon:"icons",items:[{label:"marker.png",icon:"file",state:{url:"${baseURL}/icons/marker.png",type:"file"}},{label:"location-user-24.png",icon:"file",state:{url:"${baseURL}/icons/location-user-24.png",type:"file"}}]},{contributionId:"catalog.root.packages",label:"Asset Packages",icon:"box-archive",items:[]}],Vp={label:Gp,icon:qp,contributionId:jp,items:Bp};Se({command:{id:"checkout",name:"Checkout",description:"Checkout a catalog item into the workspace",parameters:[{name:"url",description:"the url of the resource to checkout, if not provided, the current selection in the catalog will be used",required:!1}]},handler:{execute:async n=>{let e=n.params&&n.params.url;if(!e){const r=Mt.get();if(!r||!("url"in r))return;e=r.url}const t=await et.getWorkspace();if(!t){ge("No workspace selected.");return}fetch(e,{method:"GET"}).then(r=>r.blob()).then(r=>{const i=new URL(e).pathname.split("/"),s=i[i.length-1];return t.getResource(s,{create:!0}).then(a=>a.saveContents(r,{contentType:bs.BINARY}).then(()=>{yt("File checked out: "+s)}))}).catch(r=>{ge(r)})}}});Se({command:{id:"refresh_catalog",name:"Refresh Catalog",description:"Refreshes the catalog view",parameters:[]},handler:{execute:async n=>{const e=Re.get();e instanceof kn&&e.refresh()}}});Se({command:{id:"catalog_expand_all",name:"Expand All Catalog Items",description:"Expands all items in the catalog tree",parameters:[]},handler:{execute:async n=>{const e=Re.get();e instanceof kn&&e.setAllExpanded(!0)}}});Se({command:{id:"catalog_collapse_all",name:"Collapse All Catalog Items",description:"Collapses all items in the catalog tree",parameters:[]},handler:{execute:async n=>{const e=Re.get();e instanceof kn&&e.setAllExpanded(!1)}}});Bo(Vp);const xt=It("GsCommandHandlers"),pn=n=>n.activeEditor instanceof Ye,An=n=>{const e=n.activeEditor;if(!(e instanceof Ye)||!e.getOperations())throw xt.error("GsMapEditor with renderer not available in context.activeEditor"),new Error("GsMapEditor with renderer not available in context.activeEditor");return e.getOperations()};we.registerAll({command:{id:"zoom_to_level",name:"Zoom to Level",description:"Zooms the map to the provided level",parameters:[{name:"zoom",description:"the zoom level (typically 0-20, where 0=world view, 5-9=country/region, 10-12=city, 13-15=street, 16-20=building detail)",required:!0}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),t=Number(n.params.zoom).valueOf();return await e.setZoom(t),{zoom:t}}}});we.registerAll({command:{id:"zoom_in",name:"Zoom In",description:"Zooms the map in by one level",parameters:[],output:[{name:"zoom",description:"the new zoom level",type:"number"}]},handler:{canExecute:n=>Re.get()instanceof Ye,execute:async n=>{const e=Re.get(),t=e.getGsMap();if(t?.view?.zoom!==void 0){const r=e.mapOperations,i=t.view.zoom+1;return await r?.setZoom(i),i}return t?.view?.zoom}}});we.registerAll({command:{id:"zoom_out",name:"Zoom Out",description:"Zooms the map out by one level",parameters:[],output:[{name:"zoom",description:"the new zoom level",type:"number"}]},handler:{canExecute:n=>Re.get()instanceof Ye,execute:async n=>{const e=Re.get(),t=e.getGsMap();if(t?.view?.zoom!==void 0){const r=e.mapOperations,i=t.view.zoom-1;return await r?.setZoom(i),i}return t?.view?.zoom}}});we.registerAll({command:{id:"center_location",name:"Center to a location",description:"Centers the map to the provided location coordinates",parameters:[{name:"lat",description:"the latitude of the location (e.g., 52.52 for Berlin). Use your knowledge of city coordinates or approximate values.",type:"number",required:!0},{name:"lon",description:"the longitude of the location (e.g., 13.405 for Berlin). Use your knowledge of city coordinates or approximate values.",type:"number",required:!0}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),t=ul([Number(n.params.lon).valueOf(),Number(n.params.lat).valueOf()]);await e.setCenter([t[0],t[1]])}}});we.registerAll({command:{id:"add_layer",name:"Add new layer",description:"Adds a new layer to the map or set the basemap",parameters:[{name:"source",description:`the source of the layer, one of: ${Object.values(Gt).join(", ")}`,required:!0},{name:"basemap",description:"if set to true, the new layer will be used as the basemap or basemap layer",required:!1},{name:"url",description:"the URL or path within the workspace to load the features/geometries from",required:!1},{name:"stylePath",description:"the path within the workspace to the style json file if source is of type vector, for example, geojson",required:!1}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),t=n.params.source?.trim().toLowerCase(),r=n.params.url,i=dl(t),s=n?.params&&n.params.basemap==!0;let a;r&&(a=r.split("/").pop()),!a&&i&&(a=i);const l=Js({name:a,type:pl(t),source:Js({type:i,url:r??hl(i)})});await Xn(l,"url"),await e.addLayer(l,s)}}});we.registerAll({command:{id:"delete_layer",name:"Delete a layer",description:"Delete a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to delete, starts with 1 for the first layer",required:!0}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),r=n.activeEditor.getGsMap(),i=parseInt(n.params.index)-1;if(i<0||!r||i>=r.layers.length)return;const s=r.layers[i];s?.uuid&&await e.deleteLayer(s.uuid)}}});we.registerAll({command:{id:"rename_layer",name:"Rename a layer",description:"Rename a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to rename, starts with 1 for the first layer",required:!0},{name:"newName",description:"the new name for the layer",required:!1}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),r=n.activeEditor.getGsMap(),i=parseInt(n.params.index)-1;if(i<0||!r||i>=r.layers.length)return;const s=r.layers[i];if(!s?.uuid)return;const a=s.name||`Layer ${i+1}`,l=n.params?.newName||await Fr(`Enter new name for "${a}":`,a);!l||l===a||await e.renameLayer(s.uuid,l)}}});we.registerAll({command:{id:"switch_color_mode",name:"Switch color mode",description:"Switches the current color mode to either dark or light (default)",parameters:[{name:"mode",description:"the mode to switch to, will be toggled if not provided",required:!1}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),t=n.params?.mode;await e.switchColorMode(t)}}});we.registerAll({command:{id:"add_overlay",name:"Add overlay",description:"Adds an overlay JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),t=n.params.src,r=n.params.position;await e.addOverlayFromModule(t,r)}}});we.registerAll({command:{id:"add_control",name:"Add control",description:"Adds a control JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute:pn,execute:async n=>{const e=An(n),t=n.params.src;await e.addControlFromModule(t)}}});we.registerAll({command:{id:"view_extents",name:"View extents",description:"Stores the extent of the current view as a variable",parameters:[{name:"latlon",description:"set to true to reverse coordinates to lat/lon instead of lon/lat; useful for various external services such as OpenStreetMap Overpass API",required:!1}],output:[{name:"viewExtent",description:"the current view's extent as lat/lon coordinates in WGS84 (EPSG:4326) format",type:"number[]"}]},handler:{canExecute:pn,execute:async n=>{const e=n.activeEditor,t=n.params.latlon,i=await e.getRenderer().getViewExtent();if(!i)throw new Error("Failed to get view extent");let s=i;return(t||t===void 0)&&(s=fl(i,"EPSG:3857","EPSG:4326"),[s[0],s[1]]=[s[1],s[0]],[s[2],s[3]]=[s[3],s[2]]),n.viewExtent=s,s}}});we.registerAll({command:{id:"toggle_mobile_view",name:"Toggle Mobile View",description:"Toggles between desktop and mobile view for the map",parameters:[]},handler:{canExecute:n=>Re.get()instanceof Ye,execute:async n=>{const e=Re.get().renderer;if(!e||!("toggleMobileView"in e))throw new Error("Mobile view toggle not available on this renderer");e.toggleMobileView()}}});we.registerAll({command:{id:"refresh_map",name:"Refresh Map",description:"Refreshes the currently active map editor",parameters:[]},handler:{canExecute:n=>Re.get()instanceof Ye,execute:async n=>{const e=Re.get();e instanceof Ye&&await e.refresh()}}});we.registerAll({command:{id:"reset_view",name:"Reset View",description:"Resets the map view to the initial center and zoom level",parameters:[]},handler:{canExecute:n=>Re.get()instanceof Ye,execute:async n=>{const e=Re.get();e instanceof Ye&&await e.resetView()}}});we.registerAll({command:{id:"toggle_color_mode",name:"Toggle Color Mode",description:"Toggles between dark and light mode for the map",parameters:[]},handler:{canExecute:n=>Re.get()instanceof Ye,execute:async n=>{const t=Re.get().mapOperations;t&&await t.switchColorMode()}}});we.registerAll({command:{id:"capture_map_screenshot",name:"Capture map screenshot",description:"Takes a screenshot of the currently visible map and returns it as a base64-encoded data URL. Useful for analyzing map imagery with ML tools.",parameters:[{name:"filePath",description:"Optional path for the screenshot file. If provided, the screenshot will be saved to this path. If not provided, a unique filename based on date and time will be generated and the screenshot will be saved (e.g., 'screenshot-2024-01-15-14-30-45.png').",type:"string",required:!1}],output:[{name:"dataUrl",description:"Base64-encoded data URL of the map screenshot (format: data:image/png;base64,...)",type:"string"},{name:"width",description:"Width of the captured image in pixels",type:"number"},{name:"height",description:"Height of the captured image in pixels",type:"number"},{name:"filePath",description:"Path of the saved file (always present as screenshot is always saved)",type:"string"}]},handler:{canExecute:n=>n.activeEditor instanceof Ye,execute:async n=>{try{const e=n.activeEditor;if(!(e instanceof Ye))return{error:"Active editor is not a map editor"};const t=e.getRenderer();return!t||!(t instanceof cs)?{error:"Map renderer not available"}:await _n.runAsync("Capturing map screenshot",async r=>{try{r.message="Capturing screenshot from map...",r.progress=10,xt.info("Capturing map screenshot...");const i=await t.sendMessage("captureScreenshot",{});if(!i)throw xt.error("No result from captureScreenshot"),ge("Failed to capture screenshot: No result from iframe"),new Error("No result from screenshot capture");if(!i.success)throw xt.error(`Screenshot capture failed: ${i.error||"Unknown error"}`),ge(`Failed to capture screenshot: ${i.error||"Unknown error"}`),new Error(i.error||"Failed to capture screenshot");r.message="Preparing to save screenshot...",r.progress=50,xt.info("Screenshot captured, saving to workspace...");const s=await et.getWorkspace();if(!s)throw xt.error("No workspace available"),ge("Failed to save screenshot: No workspace available"),new Error("No workspace available");let a=n.params?.filePath;if(!a){let v="map";e.input?.data instanceof St&&(v=e.input.data.getName().replace(/\.geospace$/i,""),v=v.replace(/[^a-zA-Z0-9_-]/g,"_"));const k=new Date,_=k.getFullYear(),q=String(k.getMonth()+1).padStart(2,"0"),ee=String(k.getDate()).padStart(2,"0"),Y=String(k.getHours()).padStart(2,"0"),G=String(k.getMinutes()).padStart(2,"0"),O=String(k.getSeconds()).padStart(2,"0");a=`${v}-screenshot-${_}-${q}-${ee}-${Y}-${G}-${O}.png`}const l=a.endsWith(".png")?a:`${a}.png`;if(r.message=`Saving screenshot to ${l}...`,r.progress=70,xt.info(`Saving screenshot to: ${l}`),!i.dataUrl)throw xt.error("No dataUrl in screenshot result"),ge("Failed to save screenshot: No image data received"),new Error("No image data in screenshot result");const u=i.dataUrl.split(",")[1];if(!u)throw xt.error("Invalid dataUrl format"),ge("Failed to save screenshot: Invalid image data format"),new Error("Invalid image data format");r.message="Converting image data...",r.progress=80;const h=Uint8Array.from(atob(u),v=>v.charCodeAt(0)),T=new Blob([h],{type:"image/png"}),E=await s.getResource(l,{create:!0});if(!E)throw xt.error(`Failed to create file resource: ${l}`),ge(`Failed to save screenshot: Could not create file ${l}`),new Error(`Failed to create file: ${l}`);return r.message="Writing file to workspace...",r.progress=90,xt.info(`Saving blob (size: ${T.size} bytes) to file...`),await E.saveContents(T,{contentType:bs.BINARY}),r.message="Screenshot saved successfully",r.progress=100,xt.info(`Screenshot saved successfully to: ${l}`),yt(`Screenshot saved: ${l}`),{dataUrl:i.dataUrl,width:i.width,height:i.height,filePath:l}}catch(i){throw xt.error(`Screenshot capture failed: ${i.message}`),ge(`Failed to capture screenshot: ${i.message}`),i}})}catch(e){return xt.error(`Failed to capture map screenshot: ${e.message}`),ge(`Failed to capture screenshot: ${e.message}`),{error:`Failed to capture map screenshot: ${e.message}`}}}}});const Hp=`
**geo!space - WebGIS Application:**

geo!space is a WebGIS (Web Geographic Information System) application for creating, editing, and visualizing interactive maps.

**Core Capabilities:**
- Interactive map editor with zoom, pan, and layer management
- Support for multiple layer types: GeoJSON, WMS, WMTS, Vector Tiles, and more
- Drawing tools for creating and editing geographic features
- Style management for customizing layer appearance
- Map state persistence in .geospace files (JSON format containing map configuration, layers, view settings, and styles)

**Map Editor:**
When a .geospace file is open, the map editor provides:
- Interactive map view with coordinate system support (EPSG:3857, EPSG:4326, etc.)
- Layer panel for managing multiple data layers
- Drawing tools for creating points, lines, and polygons
- Style editor for customizing layer visualizations
- Catalog integration for browsing and adding spatial data
`,Xp={enhance:async(n,e)=>`${n}

${Hp}`,priority:5};function Kp(){Q.registerContribution(qr,{label:"Geo!space Prompt Enhancer",enhancer:Xp})}const Yp=`# ðŸŒ geo!space
[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/erdalkaraca/geospace)
[![Browser Support](https://img.shields.io/badge/Chrome%20%7C%20Opera-Supported-brightgreen)](#-browser-compatibility)
[![PWA Ready](https://img.shields.io/badge/PWA-Ready-purple)](#-key-features)
[![No Installation](https://img.shields.io/badge/Installation-None%20Required-orange)](#-quick-start)
[![Built on app!space](https://img.shields.io/badge/Built%20on-app%21space-blue)](https://github.com/kispace-io/appspace)

**The Interactive Mapping IDE in Your Browser**

geo!space is a powerful web application built on the [app!space](https://github.com/kispace-io/appspace) platform that provides professional mapping capabilities in your browser. Create interactive maps, work with geospatial data, and transform maps into cross-platform Progressive Web Apps - all without installing any software, directly in your browser.

## ðŸ“‘ Table of Contents

- [âœ¨ Key Features](#-key-features)
- [ðŸŒ Browser Compatibility](#-browser-compatibility)
- [ðŸŒŸ Use Cases](#-use-cases)
- [ðŸš€ Getting Started](#-getting-started)
- [ðŸ‘¨â€ðŸ’» Development](#-development)
- [ðŸ’¡ Examples](#-examples)
- [ðŸ”§ Troubleshooting](#-troubleshooting)
- [â“ FAQ](#-faq)
- [ðŸ—ï¸ Technical Architecture](#ï¸-technical-architecture)
- [ðŸ¤ Trusted by](#-trusted-by)
- [âš¡ Quick Start](#-quick-start)

## âœ¨ Key Features

### ðŸ—ºï¸ **Professional Mapping**
- **Interactive Map Editor**: Create and edit maps using the custom \`.geospace\` format
- **Multiple Data Sources**: Support for OSM, XYZ tiles, GeoJSON, KML, GeoTIFF, GPX, Features, BM (basemap.de), WMS, WMTS, and Overpass API
- **Satellite Imagery**: Built-in access to Esri World Imagery and Sentinel-2 satellite imagery
- **Layer Management**: Vector layers, tile layers, and layer groups with full styling control
- **OpenLayers Integration**: Built on the industry-standard OpenLayers mapping library
- **Advanced Styling**: Dynamic style loading and management system
- **PWA Transformation**: Convert \`.geospace\` files into cross-platform Progressive Web Apps

### ðŸ› ï¸ **Map Building & Deployment**
- **PWA Builder**: Transform \`.geospace\` files into cross-platform Progressive Web Apps
- **Custom Controls**: Create interactive UI components using JavaScript modules
- **Module System**: Import and share custom map controls within your workspace

## ðŸŒ Browser Compatibility

**âš ï¸ Important**: geo!space uses the File System Access API which has limited browser support.

- âœ… **Fully Supported**: Chrome and Opera
- âš ï¸ **Limited Support**: Firefox and Safari (partial File System Access API support)

For more details, see [File System API](https://developer.mozilla.org/en-US/docs/Web/API/Window/showDirectoryPicker)

## ðŸŒŸ Use Cases

- **Data Analysts**: Create interactive maps for data visualization
- **Urban Planners**: Design and prototype mapping applications  
- **Developers**: Build geospatial applications without complex setup
- **Researchers**: Prototype location-based applications quickly
- **Educators**: Teach mapping and geospatial concepts interactively
- **App Creators**: Transform maps into cross-platform PWAs for mobile, desktop, and web deployment

## ðŸš€ Getting Started

### 1. **Connect a Workspace**
- In the Workspace tab, click the folder icon "Load workspace folder"
- Choose a local folder to use as your workspace
- This folder will be saved and restored when you reload geo!space

### 2. **Working with Files**
- **\`.geospace\` files**: Map files that open in the interactive map editor
- **Other files**: Open in the appropriate editor based on file type

### 3. **Creating Interactive Maps**
- Double-click \`.geospace\` files to open them in the map editor
- Use the map editor's UI to interact with layers, features, and styling
- Add data sources: OSM tiles, GeoJSON files, KML, GeoTIFF, GPX, or custom features
- **Build PWA**: Use the "Build map" button to transform your \`.geospace\` file into a cross-platform Progressive Web App

### 4. **Resource Catalog**
- Browse the catalog view for curated maps, datasets, icons, and controls
- Select items from catalog categories (datasets, maps, overlays, controls, icons)
- Use the "Checkout" button to download items directly to your workspace
- Access pre-built basemaps (OpenStreetMap, basemap.de) and sample datasets

## ðŸ‘¨â€ðŸ’» Development

geo!space provides a powerful development environment for creating custom map controls and overlays using JavaScript modules.

### **Custom Modules**

Create interactive UI components for your maps using JavaScript modules. geo!space uses **Lit** for templating and **Web Awesome** for UI components - both are provided by default and based on browser standards only, so no build tools are required.

**Key Features:**
- **No Build Tools**: Write plain JavaScript modules that run directly in the browser
- **Lit Templating**: Use Lit's HTML template literals for reactive UI
- **Web Awesome Components**: Access to a full library of web-standard UI components
- **OpenLayers API**: Full access to OpenLayers through the \`ol\` namespace object
- **Module System**: Import and share modules within your workspace using relative paths or bare specifiers

**Getting Started:**
1. Create a JavaScript file in your workspace (e.g., \`my-control.js\`)
2. Export a default function that receives APIs via destructuring
3. Return a Lit template from your function
4. Add your module to a map's \`controls\` or \`overlays\` array in the \`.geospace\` file

**Example:**
\`\`\`javascript
export default function ({html, style, events, map}) {
    style({
        position: "absolute",
        bottom: "0",
        left: "0",
        right: "0"
    });

    return () => html\`
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr;">
            <wa-button @click=\${() => events("drawer/openMenu")}>
                Menu
            </wa-button>
        </div>
    \`;
}
\`\`\`

**Learn More:**
- ðŸ“– See the [User Modules Guide](packages/geospace/public/docs/user-modules.md) for complete documentation
- ðŸŽ¨ Browse Web Awesome components: https://webawesome.com
- ðŸ—ºï¸ Explore OpenLayers API: https://openlayers.org/

## ðŸ’¡ Examples

### **Create a City Map**
\`\`\`
1. Create a new .geospace file
2. Add OpenStreetMap as base layer
3. Add GeoJSON layers for buildings and trees
4. Use the "Build map" button to create a deployable PWA
\`\`\`

### **Custom Map Controls**
\`\`\`
1. Create a JavaScript module for custom map controls
2. Use Lit and WebAwesome components for UI
3. Add your module to a map's controls array
4. Build the map as a PWA for deployment
\`\`\`

## ðŸ”§ Troubleshooting

### **Common Issues**

**File Not Found**
- If you don't see expected files, try reloading the workspace
- Ensure the workspace folder is properly connected

**Browser Compatibility Issues**
- Use Chrome or Opera for full functionality
- Firefox and Safari have limited File System Access API support

**Map Not Loading**
- Check that \`.geospace\` files contain valid JSON
- Verify data source URLs are accessible
- Ensure required resources (icons, styles) are available

## â“ FAQ

**Q: Do I need to install anything?**
A: No! geo!space runs entirely in your browser. Just open it in Chrome or Opera.

**Q: Is my data secure?**
A: Yes. All data stays in your browser and local workspace. No data is sent to external servers.

**Q: Can I use geo!space offline?**
A: Yes, for basic mapping features. Some features may require internet connection for data sources.

**Q: How do I share my maps?**
A: Use the "Build map" button to create a PWA that can be deployed anywhere or shared as a standalone app.

**Q: What file formats are supported?**
A: Maps: \`.geospace\` (JSON), Data: GeoJSON, KML, GPX, GeoTIFF, Features. Tile sources: OSM, XYZ, WMS, WMTS, BM (basemap.de), Satellite imagery (Esri, Sentinel-2).

**Q: Can I customize maps?**
A: Yes! Create custom controls using JavaScript modules with Lit and WebAwesome components.

## ðŸ—ï¸ Technical Architecture

geo!space is built on the [app!space](https://github.com/kispace-io/appspace) platform, which provides the core IDE infrastructure.

**geo!space-Specific Stack:**
- **OpenLayers**: Professional mapping library
- **Custom Runtime**: Map-to-OpenLayers conversion system (\`gs-lib\`)
- **Style Loader**: Dynamic style loading for geospatial data
- **PWA Builder**: Transform \`.geospace\` files into cross-platform Progressive Web Apps
- **Lit & WebAwesome**: Available for creating custom map controls and overlays

## ðŸ¤ Trusted by

- **[Kiosk Scout](https://finder.kioskscout.de)**: A cross-platform PWA for finding nearby vending machines
- **Want your geo!space app listed here?** Contact us!

---

## âš¡ Quick Start

**Get up and running in 3 minutes:**

1. **Open geo!space** in Chrome or Opera
2. **Connect workspace** - Click folder icon and select a local directory
3. **Create your first map** - Create a new \`.geospace\` file or open existing files
4. **Add data layers** - Import GeoJSON, KML, or add tile sources
5. **Build your app** - Use the "Build map" button to create a deployable PWA

### **First-Time Setup**
- **Start mapping immediately** - No configuration required
- **Add data sources** - Import your geospatial data or use built-in tile sources
- **Customize maps** - Create custom controls using JavaScript modules

## ðŸŽ¯ Ready to Start?

1. **Load the app** in Chrome or Opera
2. **Connect a workspace** folder
3. **Create your first map** or open an existing \`.geospace\` file
4. **Add layers and customize** your map
5. **Build and share** your interactive maps as PWAs

**Happy mapping! ðŸ—ºï¸âœ¨**`,Zp=br.version,Oa=It("GeoSpaceApp"),Jp=["geospace.styleEditor","system.mdeditor","system.monaco","system.download","system.commandpalette","system.github-service","system.memoryusage","system.pythonpackagemanager","system.settings-tree","system.ai-system","system.howto"],Qp=[{target:us,slot:"start",label:"Brand",html:'<span style="margin-right: 1rem;"><span><nobr>ðŸŒ<i><b>geo!</b></i><small>space</small></nobr></span></span>'},{target:"system.fastviews-bottomend",name:"catalog",label:"Catalog",icon:"book",component:n=>S`<gs-catalog id="${n}"></gs-catalog>`},{target:ps,name:"map-props",label:"Map Properties",icon:"fg map-options",component:n=>S`<gs-map-props id="${n}"></gs-map-props>`},{target:"contextmenu:filebrowser",label:"Add as Map Layer",icon:"layer-group",command:"add_layer_from_selection",disabled:()=>{const n=Mt.get();return n instanceof St?!qo(n):!0}},{target:"filebrowser.create",label:"geo!space map",icon:"earth",command:"create_map_file"}],eh=[{id:"geospace.mapBuilder",name:"geo!space Map Builder",description:"Compile a geo!space file to an interactive website",loader:()=>Le(()=>import("./mapbuilder-extension-Cw9K-6EZ.js"),__vite__mapDeps([31,1,2,3,4,6])),icon:"earth"},{id:"geospace.styleEditor",name:"Style Editor",description:"Visual editor for defining and managing map styles and rules",loader:()=>Le(()=>import("./style-editor-extension-Ccm_W4NP.js"),__vite__mapDeps([32,1,2,3,4,6])),icon:"palette"},{id:"geospace.overpass",name:"OpenStreetMap Overpass",description:"OpenStreetMap Overpass API Integration for use with LLMs",loader:()=>Le(()=>import("./overpass-extension-BO2kVNgO.js"),__vite__mapDeps([33,2,1,3,4,6])),icon:"table"},{id:"geospace.gtfs",name:"GTFS to GeoJSON Converter",description:"Convert GTFS zip archives to GeoJSON files",loader:()=>Le(()=>import("./gtfs-extension-BdaMPtsO.js"),__vite__mapDeps([34,2,1,3,4,6])),icon:"map-location-dot"}],Ko={id:"geospace",name:"ðŸŒgeo!space",version:Zp,description:"An IDE for working with geospatial data.",metadata:{github:{owner:"erdalkaraca",repo:"geospace"},favicon:"/geospace.svg"},extensions:Jp,contributions:{ui:Qp,extensions:eh},releaseHistory:async()=>{try{const{fetchReleases:n}=await Le(async()=>{const{fetchReleases:e}=await import("./github-service-zng27Z0w.js");return{fetchReleases:e}},__vite__mapDeps([35,2,1,3,4,6]));return await n()}catch(n){return console.error("Failed to fetch release history from GitHub:",n),[]}},async initialize(){vi.addPackage({name:br.name,version:br.version,dependencies:br.dependencies,devDependencies:br.devDependencies}),Kp(),Q.registerContribution("system.icons",{label:"geo!space File Icons",mappings:{geospace:"earth"},priority:1}),Se({command:{id:"add_layer_from_selection",name:"Add Layer from Selected File",description:"Adds the selected file as a map layer",parameters:[]},handler:{execute:async n=>{const e=Mt.get();if(!(e instanceof St))return;const t=Bs(e);if(!t){Oa.warn(`Unsupported file type: ${e.getName()}`);return}const r=e.getWorkspacePath(),i=we.createExecutionContext({source:t,url:r});await we.execute("add_layer",i)}}}),Se({command:{id:"create_map_file",name:"Create Geospace map file",description:"Creates a new .geospace map file with default map structure. This is specifically for creating geospace map files, not general files.",parameters:[{name:"path",description:"the path including name of the map file to be created (e.g., 'my-map.geospace' or 'my map'). The .geospace extension will be added automatically if missing. Must be relative to the workspace.",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async n=>{const e={...Ra,chatHistory:[],view:{center:[1105600,6120800],zoom:5,projection:"EPSG:3857"}},t=n.params?.path||"map.geospace",r=t.endsWith(".geospace")?t:`${t}.geospace`;return await we.execute("create_file",{params:{path:r,contents:JSON.stringify(e,null,2),extension:".geospace",ask:t==="map.geospace"}})}}}),Se({command:{id:"help",name:"Show welcome",description:"Shows the welcome page.",parameters:[]},handler:{execute:async n=>{const e=new fc(Yp,"README.md");await xn.loadEditor(e)}},contribution:{target:Cn,icon:"question-circle",label:"Welcome"}}),Oa.info("geo!space is ready!")}};At.registerApp(Ko,{defaultAppId:"geospace",autoStart:!0,container:document.body});const dh=Object.freeze(Object.defineProperty({__proto__:null,geospaceApp:Ko},Symbol.toStringTag,{value:"Module"}));export{Pr as $,ln as A,Ue as B,qr as C,Kn as D,Fr as E,St as F,Ye as G,Wr as H,Ou as I,zs as J,tn as K,yn as L,Cn as M,Ri as N,ir as O,rp as P,Ls as Q,xo as R,dn as S,us as T,go as U,tt as V,Qn as W,Pl as X,oo as Y,lo as Z,uh as _,yt as a,Mr as a0,Ei as a1,Ht as a2,sh as a3,ah as a4,ch as a5,dh as a6,ge as b,Re as c,Mt as d,Q as e,Ut as f,ve as g,Se as h,At as i,Pa as j,zu as k,Vo as l,mt as m,we as n,Nn as o,Ia as p,bs as q,ut as r,ri as s,_n as t,Pe as u,xn as v,et as w,ds as x,Bt as y,It as z};
