const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/git-extension-D4BfQL6j.js","assets/index-DoDY4M9O.js","assets/index-C2t38aP0.css","assets/pyterminal-extension-X5W4_oOc.js","assets/xterm-CODBi7oP.js","assets/k-linuxterminal-sD4NLkRQ.js","assets/webllmservice-BBDHOrTE.js","assets/p12-splitter-D81DKiCN.js","assets/package-manager-extension-gNNVbowH.js","assets/notebook-extension-CHbMu6_a.js","assets/editor.main-CSvhx3Vv.js","assets/editor-BhPcksyq.css","assets/command-palette-extension-Bq_pX6cn.js","assets/download-extension-CdcmmXQT.js","assets/unzip-extension-B1BhdLsj.js","assets/md-editor-extension-Bo009aao.js","assets/media-viewer-extension-DItWLVtR.js","assets/monaco-editor-extension-CA5l6lFU.js","assets/memory-usage-extension-XHxSvKlZ.js","assets/webdav-extension-Dy-BXo6j.js","assets/settings-tree-extension-CFFcBv4w.js","assets/ai-system-extension-Cl56n8uD.js","assets/rag-system-extension-BulprZ5N.js","assets/mapbuilder-extension-CDPdFLOY.js","assets/style-editor-extension-B_lnnPtx.js","assets/overpass-extension-DpaFgJZs.js","assets/gtfs-extension-B32au80i.js"])))=>i.map(i=>d[i]);
import{g as xi,x as G,B as Tr,P as Do,a as No,o as Un,i as pa,b as Yt,t as Et,n as Be,r as At,c as Mo,e as yr,E as kt,d as br,f as da,h as ha,j as Fo,p as qo,v as Ur,k as xn,M as Li,T as zo,m as fa,l as Uo,q as Ut,_ as mt,s as Os,u as jo,O as Wo,G as pr,w as Bo,y as Go,z as Rs,D as ma,A as Ps,C as Vo,F as Ho,H as Ko,I as Yo,J as Ls,K as Jo,L as Zo}from"./index-DoDY4M9O.js";function ga(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var ni={exports:{}};var Xo=ni.exports,$s;function Qo(){return $s||($s=1,(function(r,e){(function(){var t,n,i,o,a,c,f,y,R,b,x,_,D,Y,ve,xe,W,N,K,U,O,B,ee,Te,Pe,he,z,le,ye,ke,X,se,me,Z,Ce,Ne,w,I,fe,Re,Ye,We,P,q,$,Q,ue,ae,V,ce,we=[].slice,qe={}.hasOwnProperty,Ge=function(L,k){for(var M in k)qe.call(k,M)&&(L[M]=k[M]);function H(){this.constructor=L}return H.prototype=k.prototype,L.prototype=new H,L.__super__=k.prototype,L},Ie=[].indexOf||function(L){for(var k=0,M=this.length;k<M;k++)if(k in this&&this[k]===L)return k;return-1},Ae=function(L,k){return function(){return L.apply(k,arguments)}};for(B={className:"",catchupTime:100,initialRate:.03,minTime:250,ghostTime:100,maxProgressPerFrame:20,easeFactor:1.25,startOnPageLoad:!0,restartOnPushState:!0,restartOnRequestAfter:500,target:"body",elements:{checkInterval:100,selectors:["body"]},eventLag:{minSamples:10,sampleCount:3,lagThreshold:3},ajax:{trackMethods:["GET"],trackWebSockets:!0,ignoreURLs:[]}},ke=function(){var L;return(L=typeof performance<"u"&&performance!==null&&typeof performance.now=="function"?performance.now():void 0)!=null?L:+new Date},se=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,O=window.cancelAnimationFrame||window.mozCancelAnimationFrame,xe=function(L,k,M){return typeof L.addEventListener=="function"?L.addEventListener(k,M,!1):(function(){if(typeof L["on"+k]!="function"||typeof L["on"+k].eventListeners!="object"){var H=new y;typeof L["on"+k]=="function"&&H.on(k,L["on"+k]),L["on"+k]=function(J){return H.trigger(k,J)},L["on"+k].eventListeners=H}else var H=L["on"+k].eventListeners;H.on(k,M)})()},se==null&&(se=function(L){return setTimeout(L,50)},O=function(L){return clearTimeout(L)}),Z=function(L){var k,M;return k=ke(),M=function(){var H;return H=ke()-k,H>=33?(k=ke(),L(H,function(){return se(M)})):setTimeout(M,33-H)},M()},me=function(){var L,k,M;return M=arguments[0],k=arguments[1],L=3<=arguments.length?we.call(arguments,2):[],typeof M[k]=="function"?M[k].apply(M,L):M[k]},ee=function(){var L,k,M,H,J,te,_e;for(k=arguments[0],H=2<=arguments.length?we.call(arguments,1):[],te=0,_e=H.length;te<_e;te++)if(M=H[te],M)for(L in M)qe.call(M,L)&&(J=M[L],k[L]!=null&&typeof k[L]=="object"&&J!=null&&typeof J=="object"?ee(k[L],J):k[L]=J);return k},N=function(L){var k,M,H,J,te;for(M=k=0,J=0,te=L.length;J<te;J++)H=L[J],M+=Math.abs(H),k++;return M/k},Pe=function(L,k){var M,H,J;if(L==null&&(L="options"),k==null&&(k=!0),J=document.querySelector("[data-pace-"+L+"]"),!!J){if(M=J.getAttribute("data-pace-"+L),!k)return M;try{return JSON.parse(M)}catch(te){return H=te,typeof console<"u"&&console!==null?console.error("Error parsing inline pace options",H):void 0}}},f=(function(){function L(){}return L.prototype.on=function(k,M,H,J){var te;return J==null&&(J=!1),this.bindings==null&&(this.bindings={}),(te=this.bindings)[k]==null&&(te[k]=[]),this.bindings[k].push({handler:M,ctx:H,once:J})},L.prototype.once=function(k,M,H){return this.on(k,M,H,!0)},L.prototype.off=function(k,M){var H,J,te;if(((J=this.bindings)!=null?J[k]:void 0)!=null){if(M==null)return delete this.bindings[k];for(H=0,te=[];H<this.bindings[k].length;)this.bindings[k][H].handler===M?te.push(this.bindings[k].splice(H,1)):te.push(H++);return te}},L.prototype.trigger=function(){var k,M,H,J,te,_e,Le,Ke,st;if(H=arguments[0],k=2<=arguments.length?we.call(arguments,1):[],(Le=this.bindings)!=null&&Le[H]){for(te=0,st=[];te<this.bindings[H].length;)Ke=this.bindings[H][te],J=Ke.handler,M=Ke.ctx,_e=Ke.once,J.apply(M??this,k),_e?st.push(this.bindings[H].splice(te,1)):st.push(te++);return st}},L})(),b=window.Pace||{},window.Pace=b,ee(b,f.prototype),X=b.options=ee({},B,window.paceOptions,Pe()),ae=["ajax","document","eventLag","elements"],q=0,Q=ae.length;q<Q;q++)I=ae[q],X[I]===!0&&(X[I]=B[I]);R=(function(L){Ge(k,L);function k(){return V=k.__super__.constructor.apply(this,arguments),V}return k})(Error),n=(function(){function L(){this.progress=0}return L.prototype.getElement=function(){var k;if(this.el==null){if(k=document.querySelector(X.target),!k)throw new R;this.el=document.createElement("div"),this.el.className="pace pace-active",document.body.className=document.body.className.replace(/(pace-done )|/,"pace-running ");var M=X.className!==""?" "+X.className:"";this.el.innerHTML='<div class="pace-progress'+M+`">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div>`,k.firstChild!=null?k.insertBefore(this.el,k.firstChild):k.appendChild(this.el)}return this.el},L.prototype.finish=function(){var k;return k=this.getElement(),k.className=k.className.replace("pace-active","pace-inactive"),document.body.className=document.body.className.replace("pace-running ","pace-done ")},L.prototype.update=function(k){return this.progress=k,b.trigger("progress",k),this.render()},L.prototype.destroy=function(){try{this.getElement().parentNode.removeChild(this.getElement())}catch(k){R=k}return this.el=void 0},L.prototype.render=function(){var k,M,H,J,te,_e,Le;if(document.querySelector(X.target)==null)return!1;for(k=this.getElement(),J="translate3d("+this.progress+"%, 0, 0)",Le=["webkitTransform","msTransform","transform"],te=0,_e=Le.length;te<_e;te++)M=Le[te],k.children[0].style[M]=J;return(!this.lastRenderedProgress||this.lastRenderedProgress|this.progress!==0|0)&&(k.children[0].setAttribute("data-progress-text",""+(this.progress|0)+"%"),this.progress>=100?H="99":(H=this.progress<10?"0":"",H+=this.progress|0),k.children[0].setAttribute("data-progress",""+H)),b.trigger("change",this.progress),this.lastRenderedProgress=this.progress},L.prototype.done=function(){return this.progress>=100},L})(),y=(function(){function L(){this.bindings={}}return L.prototype.trigger=function(k,M){var H,J,te,_e,Le;if(this.bindings[k]!=null){for(_e=this.bindings[k],Le=[],J=0,te=_e.length;J<te;J++)H=_e[J],Le.push(H.call(this,M));return Le}},L.prototype.on=function(k,M){var H;return(H=this.bindings)[k]==null&&(H[k]=[]),this.bindings[k].push(M)},L})(),P=window.XMLHttpRequest,We=window.XDomainRequest,Ye=window.WebSocket,Te=function(L,k){var M,H;H=[];for(M in k.prototype)try{L[M]==null&&typeof k[M]!="function"?typeof Object.defineProperty=="function"?H.push(Object.defineProperty(L,M,{get:(function(J){return function(){return k.prototype[J]}})(M),configurable:!0,enumerable:!0})):H.push(L[M]=k.prototype[M]):H.push(void 0)}catch{}return H},le=[],b.ignore=function(){var L,k,M;return k=arguments[0],L=2<=arguments.length?we.call(arguments,1):[],le.unshift("ignore"),M=k.apply(null,L),le.shift(),M},b.track=function(){var L,k,M;return k=arguments[0],L=2<=arguments.length?we.call(arguments,1):[],le.unshift("track"),M=k.apply(null,L),le.shift(),M},w=function(L){var k;if(L==null&&(L="GET"),le[0]==="track")return"force";if(!le.length&&X.ajax){if(L==="socket"&&X.ajax.trackWebSockets)return!0;if(k=L.toUpperCase(),Ie.call(X.ajax.trackMethods,k)>=0)return!0}return!1},x=(function(L){Ge(k,L);function k(){var M,H=this;k.__super__.constructor.apply(this,arguments),M=function(J){var te;return te=J.open,J.open=function(_e,Le,Ke){return w(_e)&&H.trigger("request",{type:_e,url:Le,request:J}),te.apply(J,arguments)}},window.XMLHttpRequest=function(J){var te;return te=new P(J),M(te),te};try{Te(window.XMLHttpRequest,P)}catch{}if(We!=null){window.XDomainRequest=function(){var J;return J=new We,M(J),J};try{Te(window.XDomainRequest,We)}catch{}}if(Ye!=null&&X.ajax.trackWebSockets){window.WebSocket=function(J,te){var _e;return te!=null?_e=new Ye(J,te):_e=new Ye(J),w("socket")&&H.trigger("request",{type:"socket",url:J,protocols:te,request:_e}),_e};try{Te(window.WebSocket,Ye)}catch{}}}return k})(y),$=null,he=function(){return $==null&&($=new x),$},Ne=function(L){var k,M,H,J;for(J=X.ajax.ignoreURLs,M=0,H=J.length;M<H;M++)if(k=J[M],typeof k=="string"){if(L.indexOf(k)!==-1)return!0}else if(k.test(L))return!0;return!1},he().on("request",function(L){var k,M,H,J,te;if(J=L.type,H=L.request,te=L.url,!Ne(te)&&!b.running&&(X.restartOnRequestAfter!==!1||w(J)==="force"))return M=arguments,k=X.restartOnRequestAfter||0,typeof k=="boolean"&&(k=0),setTimeout(function(){var _e,Le,Ke,st,It,de;if(J==="socket"?_e=H.readyState<1:_e=0<(st=H.readyState)&&st<4,_e){for(b.restart(),It=b.sources,de=[],Le=0,Ke=It.length;Le<Ke;Le++)if(I=It[Le],I instanceof t){I.watch.apply(I,M);break}else de.push(void 0);return de}},k)}),t=(function(){function L(){this.complete=Ae(this.complete,this);var k=this;this.elements=[],he().on("request",function(){return k.watch.apply(k,arguments)})}return L.prototype.watch=function(k){var M,H,J,te;if(J=k.type,M=k.request,te=k.url,!Ne(te))return J==="socket"?H=new Y(M,this.complete):H=new ve(M,this.complete),this.elements.push(H)},L.prototype.complete=function(k){return this.elements=this.elements.filter(function(M){return M!==k})},L})(),ve=(function(){function L(k,M){var H,J,te,_e,Le,Ke=this;if(this.progress=0,window.ProgressEvent!=null)for(xe(k,"progress",function(st){return st.lengthComputable?Ke.progress=100*st.loaded/st.total:Ke.progress=Ke.progress+(100-Ke.progress)/2},!1),Le=["load","abort","timeout","error"],J=0,te=Le.length;J<te;J++)H=Le[J],xe(k,H,function(){return M(Ke),Ke.progress=100},!1);else _e=k.onreadystatechange,k.onreadystatechange=function(){var st;return(st=k.readyState)===0||st===4?(M(Ke),Ke.progress=100):k.readyState===3&&(Ke.progress=50),typeof _e=="function"?_e.apply(null,arguments):void 0}}return L})(),Y=(function(){function L(k,M){var H,J,te,_e,Le=this;for(this.progress=0,_e=["error","open"],J=0,te=_e.length;J<te;J++)H=_e[J],xe(k,H,function(){return M(Le),Le.progress=100},!1)}return L})(),o=(function(){function L(k){var M,H,J,te;for(k==null&&(k={}),this.complete=Ae(this.complete,this),this.elements=[],k.selectors==null&&(k.selectors=[]),te=k.selectors,H=0,J=te.length;H<J;H++)M=te[H],this.elements.push(new a(M,this.complete))}return L.prototype.complete=function(k){return this.elements=this.elements.filter(function(M){return M!==k})},L})(),a=(function(){function L(k,M){this.selector=k,this.completeCallback=M,this.progress=0,this.check()}return L.prototype.check=function(){var k=this;return document.querySelector(this.selector)?this.done():setTimeout((function(){return k.check()}),X.elements.checkInterval)},L.prototype.done=function(){return this.completeCallback(this),this.completeCallback=null,this.progress=100},L})(),i=(function(){L.prototype.states={loading:0,interactive:50,complete:100};function L(){var k,M,H=this;this.progress=(M=this.states[document.readyState])!=null?M:100,k=document.onreadystatechange,document.onreadystatechange=function(){return H.states[document.readyState]!=null&&(H.progress=H.states[document.readyState]),typeof k=="function"?k.apply(null,arguments):void 0}}return L})(),c=(function(){function L(){var k,M,H,J,te,_e=this;this.progress=0,k=0,te=[],J=0,H=ke(),M=setInterval(function(){var Le;return Le=ke()-H-50,H=ke(),te.push(Le),te.length>X.eventLag.sampleCount&&te.shift(),k=N(te),++J>=X.eventLag.minSamples&&k<X.eventLag.lagThreshold?(_e.progress=100,clearInterval(M)):_e.progress=100*(3/(k+3))},50)}return L})(),D=(function(){function L(k){this.source=k,this.last=this.sinceLastUpdate=0,this.rate=X.initialRate,this.catchup=0,this.progress=this.lastProgress=0,this.source!=null&&(this.progress=me(this.source,"progress"))}return L.prototype.tick=function(k,M){var H;return M==null&&(M=me(this.source,"progress")),M>=100&&(this.done=!0),M===this.last?this.sinceLastUpdate+=k:(this.sinceLastUpdate&&(this.rate=(M-this.last)/this.sinceLastUpdate),this.catchup=(M-this.progress)/X.catchupTime,this.sinceLastUpdate=0,this.last=M),M>this.progress&&(this.progress+=this.catchup*k),H=1-Math.pow(this.progress/100,X.easeFactor),this.progress+=H*this.rate*k,this.progress=Math.min(this.lastProgress+X.maxProgressPerFrame,this.progress),this.progress=Math.max(0,this.progress),this.progress=Math.min(100,this.progress),this.lastProgress=this.progress,this.progress},L})(),fe=null,Ce=null,K=null,Re=null,W=null,U=null,b.running=!1,z=function(){if(X.restartOnPushState)return b.restart()},window.history.pushState!=null&&(ue=window.history.pushState,window.history.pushState=function(){return z(),ue.apply(window.history,arguments)}),window.history.replaceState!=null&&(ce=window.history.replaceState,window.history.replaceState=function(){return z(),ce.apply(window.history,arguments)}),_={ajax:t,elements:o,document:i,eventLag:c},(ye=function(){var L,k,M,H,J,te,_e,Le;for(b.sources=fe=[],te=["ajax","elements","document","eventLag"],k=0,H=te.length;k<H;k++)L=te[k],X[L]!==!1&&fe.push(new _[L](X[L]));for(Le=(_e=X.extraSources)!=null?_e:[],M=0,J=Le.length;M<J;M++)I=Le[M],fe.push(new I(X));return b.bar=K=new n,Ce=[],Re=new D})(),b.stop=function(){return b.trigger("stop"),b.running=!1,K.destroy(),U=!0,W!=null&&(typeof O=="function"&&O(W),W=null),ye()},b.restart=function(){return b.trigger("restart"),b.stop(),b.start()},b.go=function(){var L;return b.running=!0,K.render(),L=ke(),U=!1,W=Z(function(k,M){var H,J,te,_e,Le,Ke,st,It,de,rr,Qt,Tt,pt,Gt,He;for(100-K.progress,J=rr=0,te=!0,Ke=Qt=0,pt=fe.length;Qt<pt;Ke=++Qt)for(I=fe[Ke],de=Ce[Ke]!=null?Ce[Ke]:Ce[Ke]=[],Le=(He=I.elements)!=null?He:[I],st=Tt=0,Gt=Le.length;Tt<Gt;st=++Tt)_e=Le[st],It=de[st]!=null?de[st]:de[st]=new D(_e),te&=It.done,!It.done&&(J++,rr+=It.tick(k));return H=rr/J,K.update(Re.tick(k,H)),K.done()||te||U?(K.update(100),b.trigger("done"),setTimeout(function(){return K.finish(),b.running=!1,b.trigger("hide")},Math.max(X.ghostTime,Math.max(X.minTime-(ke()-L),0)))):M()})},b.start=function(L){ee(X,L),b.running=!0;try{K.render()}catch(k){R=k}return document.querySelector(".pace")?(b.trigger("start"),b.go()):setTimeout(b.start,50)},r.exports=b}).call(Xo)})(ni)),ni.exports}var el=Qo();const tl=xi(el);tl.start();const rl="@kispace-io/geospace",nl="1.0.19",il={"@kispace-io/appspace":"file:../appspace","esbuild-wasm":"^0.25.11",ol:"^10.6.1","ol-mapbox-style":"^13.1.0",osmtogeojson:"^3.0.0-beta.5","font-gis":"^1.0.6","pace-js":"^1.2.4","pubsub-js":"^1.9.5"},sl={"@testing-library/jest-dom":"^6.9.1","@types/node":"^24.9.2","@types/pubsub-js":"^1.8.6","@types/toastify-js":"^1.12.4","@vitest/coverage-v8":"^4.0.6","@vitest/ui":"^4.0.6","happy-dom":"^20.0.10",jsdom:"^27.1.0","rollup-plugin-visualizer":"^6.0.5",typescript:"~5.9.3",vite:"^7.1.12","vite-plugin-cross-origin-isolation":"^0.1.6","vite-plugin-mkcert":"^1.17.9","vite-plugin-static-copy":"^3.1.4","vite-plugin-zip":"^1.0.1",vitest:"^4.0.6",esbuild:"^0.25.11"},Tn={name:rl,version:nl,dependencies:il,devDependencies:sl};class ts{constructor(e){this.children=[],this.variables=e,this.proxy=new Proxy(e,this)}get(e,t){return e[t]||this.parent?.getProxy()[t]}set(e,t,n){e[t]=n}put(e,t){this.variables[e]=t}getProxy(){return this.proxy}createChild(e={}){const t=new ts(e);return t.parent=this,this.children.push(t),t}getChildren(){return this.children}getParent(){return this.parent}destroy(){const e=this.parent?.children.indexOf(this);e!==void 0&&e>=0&&this.parent?.children.splice(e,1),this.parent=void 0}}const Bt=new ts({}),xr=Bt.createChild({});xr.put("html",G);xr.put("render",Tr);const Ds={debug:0,info:1,warning:2,error:3};let al="debug";const en={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console)};let li=null;const ji=[];function kn(r){if(r===null)return"null";if(r===void 0)return"undefined";if(typeof r=="string")return r;if(typeof r=="number"||typeof r=="boolean")return String(r);if(r instanceof Error)return`${r.name}: ${r.message}`;try{return JSON.stringify(r)}catch{return String(r)}}class ol{constructor(e){this.source=e}info(e){this.log(e,"info")}warning(e){this.log(e,"warning")}warn(e){this.log(e,"warning")}error(e){this.log(e,"error")}debug(e){this.log(e,"debug")}log(e,t){tn(this.source,e,t)}}function ll(r){return Ds[r]>=Ds[al]}function tn(r,e,t){ll(t)&&(li?li(r,e,t):(ji.push({source:r,message:e,level:t}),en[t==="error"?"error":t==="warning"?"warn":t==="debug"?"debug":"log"](`[${r}] ${e}`)))}function cl(){console.log=function(...r){en.log.apply(console,r),tn("Console",r.map(e=>kn(e)).join(" "),"info")},console.info=function(...r){en.info.apply(console,r),tn("Console",r.map(e=>kn(e)).join(" "),"info")},console.warn=function(...r){en.warn.apply(console,r),tn("Console",r.map(e=>kn(e)).join(" "),"warning")},console.error=function(...r){en.error.apply(console,r),tn("Console",r.map(e=>kn(e)).join(" "),"error")},console.debug=function(...r){en.debug.apply(console,r),tn("Console",r.map(e=>kn(e)).join(" "),"debug")}}cl();function ul(r){for(li=r;ji.length>0;){const e=ji.shift();e&&r(e.source,e.message,e.level)}}function pl(){li=null}function Hr(r){return new ol(r)}const tt=Hr("System");Bt.put("logger",tt);var dl=Object.defineProperty,hl=(r,e,t)=>e in r?dl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$i=(r,e,t)=>(hl(r,typeof e!="symbol"?e+"":e,t),t),fl=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},Di=(r,e)=>{if(Object(e)!==e)throw TypeError('Cannot use the "in" operator on this value');return r.has(e)},Xn=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Ns=(r,e,t)=>(fl(r,e,"access private method"),t);function va(r,e){return Object.is(r,e)}let St=null,Dn=!1,ii=1;const ci=Symbol("SIGNAL");function nn(r){const e=St;return St=r,e}function ml(){return St}function gl(){return Dn}const rs={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ki(r){if(Dn)throw new Error(typeof ngDevMode<"u"&&ngDevMode?"Assertion error: signal read during notification phase":"");if(St===null)return;St.consumerOnSignalRead(r);const e=St.nextProducerIndex++;if(un(St),e<St.producerNode.length&&St.producerNode[e]!==r&&Wi(St)){const t=St.producerNode[e];Ii(t,St.producerIndexOfThis[e])}St.producerNode[e]!==r&&(St.producerNode[e]=r,St.producerIndexOfThis[e]=Wi(St)?wa(r,St,e):0),St.producerLastReadVersion[e]=r.version}function vl(){ii++}function ya(r){if(!(!r.dirty&&r.lastCleanEpoch===ii)){if(!r.producerMustRecompute(r)&&!kl(r)){r.dirty=!1,r.lastCleanEpoch=ii;return}r.producerRecomputeValue(r),r.dirty=!1,r.lastCleanEpoch=ii}}function ba(r){if(r.liveConsumerNode===void 0)return;const e=Dn;Dn=!0;try{for(const t of r.liveConsumerNode)t.dirty||bl(t)}finally{Dn=e}}function yl(){return St?.consumerAllowSignalWrites!==!1}function bl(r){var e;r.dirty=!0,ba(r),(e=r.consumerMarkedDirty)==null||e.call(r.wrapper??r)}function wl(r){return r&&(r.nextProducerIndex=0),nn(r)}function xl(r,e){if(nn(e),!(!r||r.producerNode===void 0||r.producerIndexOfThis===void 0||r.producerLastReadVersion===void 0)){if(Wi(r))for(let t=r.nextProducerIndex;t<r.producerNode.length;t++)Ii(r.producerNode[t],r.producerIndexOfThis[t]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function kl(r){un(r);for(let e=0;e<r.producerNode.length;e++){const t=r.producerNode[e],n=r.producerLastReadVersion[e];if(n!==t.version||(ya(t),n!==t.version))return!0}return!1}function wa(r,e,t){var n;if(ns(r),un(r),r.liveConsumerNode.length===0){(n=r.watched)==null||n.call(r.wrapper);for(let i=0;i<r.producerNode.length;i++)r.producerIndexOfThis[i]=wa(r.producerNode[i],r,i)}return r.liveConsumerIndexOfThis.push(t),r.liveConsumerNode.push(e)-1}function Ii(r,e){var t;if(ns(r),un(r),typeof ngDevMode<"u"&&ngDevMode&&e>=r.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${e} is out of bounds of ${r.liveConsumerNode.length} consumers)`);if(r.liveConsumerNode.length===1){(t=r.unwatched)==null||t.call(r.wrapper);for(let i=0;i<r.producerNode.length;i++)Ii(r.producerNode[i],r.producerIndexOfThis[i])}const n=r.liveConsumerNode.length-1;if(r.liveConsumerNode[e]=r.liveConsumerNode[n],r.liveConsumerIndexOfThis[e]=r.liveConsumerIndexOfThis[n],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,e<r.liveConsumerNode.length){const i=r.liveConsumerIndexOfThis[e],o=r.liveConsumerNode[e];un(o),o.producerIndexOfThis[i]=e}}function Wi(r){var e;return r.consumerIsAlwaysLive||(((e=r?.liveConsumerNode)==null?void 0:e.length)??0)>0}function un(r){r.producerNode??(r.producerNode=[]),r.producerIndexOfThis??(r.producerIndexOfThis=[]),r.producerLastReadVersion??(r.producerLastReadVersion=[])}function ns(r){r.liveConsumerNode??(r.liveConsumerNode=[]),r.liveConsumerIndexOfThis??(r.liveConsumerIndexOfThis=[])}function xa(r){if(ya(r),ki(r),r.value===Bi)throw r.error;return r.value}function Il(r){const e=Object.create(Sl);e.computation=r;const t=()=>xa(e);return t[ci]=e,t}const Ni=Symbol("UNSET"),Mi=Symbol("COMPUTING"),Bi=Symbol("ERRORED"),Sl={...rs,value:Ni,dirty:!0,error:null,equal:va,producerMustRecompute(r){return r.value===Ni||r.value===Mi},producerRecomputeValue(r){if(r.value===Mi)throw new Error("Detected cycle in computations.");const e=r.value;r.value=Mi;const t=wl(r);let n,i=!1;try{n=r.computation.call(r.wrapper),i=e!==Ni&&e!==Bi&&r.equal.call(r.wrapper,e,n)}catch(o){n=Bi,r.error=o}finally{xl(r,t)}if(i){r.value=e;return}r.value=n,r.version++}};function _l(){throw new Error}let Cl=_l;function El(){Cl()}function Al(r){const e=Object.create(Rl);e.value=r;const t=()=>(ki(e),e.value);return t[ci]=e,t}function Tl(){return ki(this),this.value}function Ol(r,e){yl()||El(),r.equal.call(r.wrapper,r.value,e)||(r.value=e,Pl(r))}const Rl={...rs,equal:va,value:void 0};function Pl(r){r.version++,vl(),ba(r)}const Lt=Symbol("node");var wr;(r=>{var e,t,n,i;class o{constructor(f,y={}){Xn(this,t),$i(this,e);const b=Al(f)[ci];if(this[Lt]=b,b.wrapper=this,y){const x=y.equals;x&&(b.equal=x),b.watched=y[r.subtle.watched],b.unwatched=y[r.subtle.unwatched]}}get(){if(!(0,r.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return Tl.call(this[Lt])}set(f){if(!(0,r.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(gl())throw new Error("Writes to signals not permitted during Watcher callback");const y=this[Lt];Ol(y,f)}}e=Lt,t=new WeakSet,r.isState=c=>typeof c=="object"&&Di(t,c),r.State=o;class a{constructor(f,y){Xn(this,i),$i(this,n);const b=Il(f)[ci];if(b.consumerAllowSignalWrites=!0,this[Lt]=b,b.wrapper=this,y){const x=y.equals;x&&(b.equal=x),b.watched=y[r.subtle.watched],b.unwatched=y[r.subtle.unwatched]}}get(){if(!(0,r.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return xa(this[Lt])}}n=Lt,i=new WeakSet,r.isComputed=c=>typeof c=="object"&&Di(i,c),r.Computed=a,(c=>{var f,y,R,b;function x(N){let K,U=null;try{U=nn(null),K=N()}finally{nn(U)}return K}c.untrack=x;function _(N){var K;if(!(0,r.isComputed)(N)&&!(0,r.isWatcher)(N))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return((K=N[Lt].producerNode)==null?void 0:K.map(U=>U.wrapper))??[]}c.introspectSources=_;function D(N){var K;if(!(0,r.isComputed)(N)&&!(0,r.isState)(N))throw new TypeError("Called introspectSinks without a Signal argument");return((K=N[Lt].liveConsumerNode)==null?void 0:K.map(U=>U.wrapper))??[]}c.introspectSinks=D;function Y(N){if(!(0,r.isComputed)(N)&&!(0,r.isState)(N))throw new TypeError("Called hasSinks without a Signal argument");const K=N[Lt].liveConsumerNode;return K?K.length>0:!1}c.hasSinks=Y;function ve(N){if(!(0,r.isComputed)(N)&&!(0,r.isWatcher)(N))throw new TypeError("Called hasSources without a Computed or Watcher argument");const K=N[Lt].producerNode;return K?K.length>0:!1}c.hasSources=ve;class xe{constructor(K){Xn(this,y),Xn(this,R),$i(this,f);let U=Object.create(rs);U.wrapper=this,U.consumerMarkedDirty=K,U.consumerIsAlwaysLive=!0,U.consumerAllowSignalWrites=!1,U.producerNode=[],this[Lt]=U}watch(...K){if(!(0,r.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");Ns(this,R,b).call(this,K);const U=this[Lt];U.dirty=!1;const O=nn(U);for(const B of K)ki(B[Lt]);nn(O)}unwatch(...K){if(!(0,r.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");Ns(this,R,b).call(this,K);const U=this[Lt];un(U);for(let O=U.producerNode.length-1;O>=0;O--)if(K.includes(U.producerNode[O].wrapper)){Ii(U.producerNode[O],U.producerIndexOfThis[O]);const B=U.producerNode.length-1;if(U.producerNode[O]=U.producerNode[B],U.producerIndexOfThis[O]=U.producerIndexOfThis[B],U.producerNode.length--,U.producerIndexOfThis.length--,U.nextProducerIndex--,O<U.producerNode.length){const ee=U.producerIndexOfThis[O],Te=U.producerNode[O];ns(Te),Te.liveConsumerIndexOfThis[ee]=O}}}getPending(){if(!(0,r.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[Lt].producerNode.filter(U=>U.dirty).map(U=>U.wrapper)}}f=Lt,y=new WeakSet,R=new WeakSet,b=function(N){for(const K of N)if(!(0,r.isComputed)(K)&&!(0,r.isState)(K))throw new TypeError("Called watch/unwatch without a Computed or State argument")},r.isWatcher=N=>Di(y,N),c.Watcher=xe;function W(){var N;return(N=ml())==null?void 0:N.wrapper}c.currentComputed=W,c.watched=Symbol("watched"),c.unwatched=Symbol("unwatched")})(r.subtle||(r.subtle={}))})(wr||(wr={}));const Ll=Symbol("SignalWatcherBrand"),$l=new FinalizationRegistry((({watcher:r,signal:e})=>{r.unwatch(e)})),Ms=new WeakMap;function Dl(r){return r[Ll]===!0?(console.warn("SignalWatcher should not be applied to the same class more than once."),r):class extends r{constructor(){super(...arguments),this._$St=new wr.State(0),this._$Si=!1,this._$So=!0,this._$Sh=new Set}_$Sl(){if(this._$Su!==void 0)return;this._$Sv=new wr.Computed((()=>{this._$St.get(),super.performUpdate()}));const e=this._$Su=new wr.subtle.Watcher((function(){const t=Ms.get(this);t!==void 0&&(t._$Si===!1&&t.requestUpdate(),this.watch())}));Ms.set(e,this),$l.register(this,{watcher:e,signal:this._$Sv}),e.watch(this._$Sv)}_$Sp(){this._$Su!==void 0&&(this._$Su.unwatch(this._$Sv),this._$Sv=void 0,this._$Su=void 0)}performUpdate(){this.isUpdatePending&&(this._$Sl(),this._$Si=!0,this._$St.set(this._$St.get()+1),this._$Si=!1,this._$Sv.get())}update(e){try{this._$So?(this._$So=!1,super.update(e)):this._$Sh.forEach((t=>t.commit()))}finally{this.isUpdatePending=!1,this._$Sh.clear()}}requestUpdate(e,t,n){this._$So=!0,super.requestUpdate(e,t,n)}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask((()=>{this.isConnected===!1&&this._$Sp()}))}_(e){this._$Sh.add(e);const t=this._$So;this.requestUpdate(),this._$So=t}m(e){this._$Sh.delete(e)}}}wr.State;wr.Computed;const Kr=(r,e)=>new wr.State(r,e),ka=Do||No,Kt=(r,e)=>{ka.subscribe(r,(t,n)=>e(n))},Xe=(r,e)=>{ka.publish(r,e)},Ia=r=>function(e,t,n){const i=n.value;return i.topic=r,n};Bt.put("subscribe",Kt);Bt.put("publish",Xe);const Lr="events/contributionregistry/contributionsChanged";class Nl{constructor(){this.contributions=new Map}registerContribution(e,t){const n=this.getContributions(e);if(t.disabled instanceof Function){const i=t.disabled;t.disabled=new wr.Computed(i)}n.push(t),Xe(Lr,{target:e,contributions:n})}getContributions(e){return this.contributions.has(e)||this.contributions.set(e,[]),this.contributions.get(e)}}const Me=new Nl;Bt.put("contributionRegistry",Me);const Ml={},it=Kr(null),an=Kr(null),Gi=Kr(null),Vi=Kr(0),er=Kr(void 0);Kr({name:"",timestamp:0});class Sa{constructor(e,t,n,i,o){this.id=e,this.name=t,this.description=n,this.parameters=i||[],this.output=o||[]}}class _a{async execute(e,t){return je.execute(e,t)}async undo(){}async redo(){}}class Ca{constructor(){this.commands={},this.handlers=new Map}registerHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]);const n=this.handlers.get(e);n.push(t),n.sort((i,o)=>(o.ranking??0)-(i.ranking??0))}getHandler(e){return this.handlers.get(e)}createExecutionContext(e){return{params:e||{},activePart:it.get(),activeEditor:an.get()}}execute(e,t={}){const n=this.getHandler(e);if(!n)throw tt.debug(`[CommandRegistry] No handlers registered for command: ${e}`),new Error(`No handlers registered for command: ${e}`);const i=this.getCommand(e),o=t.params?` params: ${JSON.stringify(t.params)}`:"";tt.debug(`[CommandRegistry] Executing command: ${e}${i?` (${i.name})`:""}${o}`);for(const a of n)if(a.canExecute===void 0||a.canExecute(t))try{const c=a.execute(t);return tt.debug(`[CommandRegistry] Command executed successfully: ${e} (result: ${c})`),c}catch(c){const f=c instanceof Error?c.message:String(c);throw tt.error(`[CommandRegistry] Command execution failed: ${e} - ${f}`),c}tt.error(`[CommandRegistry] No handler found to execute command: ${e}`)}createAndRegisterCommand(e,t,n,i,o){const a=new Sa(e,t,n,i);this.registerCommand(a),o&&this.registerHandler(e,o)}registerCommand(e){this.commands[e.id]=e,tt.debug(`Command registered: ${e.id}`)}hasCommand(e){return e in this.commands}listCommands(e){return e?Object.values(this.commands).filter(t=>(je.getHandler(t.id)||[]).some(i=>i.canExecute===void 0||i.canExecute(e))).reduce((t,n)=>(t[n.id]=n,t),{}):this.commands}getCommand(e){return this.commands[e]}registerAll(e){const t=e.command.id;this.registerCommand(e.command),e.handler&&this.registerHandler(t,e.handler),e.contribution&&e.contribution.target&&Me.registerContribution(e.contribution.target,{command:t,...e.contribution})}}const je=new Ca;Bt.put("commandRegistry",je);const lt=r=>{je.registerAll(r)},ad=Object.freeze(Object.defineProperty({__proto__:null,Command:Sa,CommandRegistry:Ca,CommandStack:_a,commandRegistry:je,registerAll:lt},Symbol.toStringTag,{value:"Module"}));class Fl{constructor(){this.bindings=new Map,this.enabled=!0,document.addEventListener("keydown",this.handleKeyDown.bind(this),!0),this.registerExistingCommandBindings(),this.watchCommandRegistry()}registerExistingCommandBindings(){const e=je.listCommands();Object.values(e).forEach(t=>{t.keyBinding&&this.registerKeyBinding(t.id,t.keyBinding)})}watchCommandRegistry(){const e=je.registerCommand.bind(je);je.registerCommand=t=>{e(t),t.keyBinding&&this.registerKeyBinding(t.id,t.keyBinding)}}parseKeyBinding(e){if(!e||e.trim()==="")return null;const t=e.toUpperCase().split("+").map(a=>a.trim());if(t.length===0)return null;const n={ctrl:!1,alt:!1,shift:!1,meta:!1},i=t[t.length-1],o=t.slice(0,-1);for(const a of o)switch(a){case"CTRL":case"CONTROL":n.ctrl=!0;break;case"ALT":case"OPTION":n.alt=!0;break;case"SHIFT":n.shift=!0;break;case"META":case"CMD":case"COMMAND":case"WIN":case"WINDOWS":n.meta=!0;break;default:tt.warn(`Unknown modifier: ${a}`)}return n.key=this.normalizeKey(i),n}normalizeKey(e){return{SPACE:" ",ESC:"ESCAPE",RETURN:"ENTER",LEFT:"ARROWLEFT",RIGHT:"ARROWRIGHT",UP:"ARROWUP",DOWN:"ARROWDOWN",DEL:"DELETE",INS:"INSERT",PAGEUP:"PAGEUP",PAGEDOWN:"PAGEDOWN"}[e]||e}getBindingKey(e){const t=[];return e.ctrl&&t.push("ctrl"),e.alt&&t.push("alt"),e.shift&&t.push("shift"),e.meta&&t.push("meta"),t.sort(),`${t.join("+")}+${e.key.toUpperCase()}`}registerKeyBinding(e,t){const n=this.parseKeyBinding(t);if(!n)return tt.error(`Invalid key binding: ${t}`),!1;n.commandId=e;const i=this.getBindingKey(n);this.bindings.has(i)||this.bindings.set(i,[]);const o=this.bindings.get(i);return o.find(c=>c.commandId===e)?(tt.error(`Key binding ${t} already registered for command ${e}`),!1):(o.push(n),tt.debug(`Key binding registered: ${t} -> ${e}`),!0)}unregisterKeyBinding(e,t){if(t){const n=this.parseKeyBinding(t);if(n){const i=this.getBindingKey(n),o=this.bindings.get(i);if(o){const a=o.filter(c=>c.commandId!==e);a.length===0?this.bindings.delete(i):this.bindings.set(i,a)}}}else for(const[n,i]of this.bindings.entries()){const o=i.filter(a=>a.commandId!==e);o.length===0?this.bindings.delete(n):this.bindings.set(n,o)}}getKeyBindingsForCommand(e){const t=[];for(const n of this.bindings.values())for(const i of n)i.commandId===e&&t.push(this.formatKeyBinding(i));return t}formatKeyBinding(e){const t=[];e.ctrl&&t.push("Ctrl"),e.alt&&t.push("Alt"),e.shift&&t.push("Shift"),e.meta&&t.push("Cmd");let n=e.key;return n.length===1?n=n.toUpperCase():n=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),t.push(n),t.join("+")}handleKeyDown(e){if(!this.enabled)return;const t=e.target;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)){const a=e.key.toUpperCase();if(!((e.ctrlKey||e.metaKey)&&e.shiftKey&&a==="P"))return}const n={commandId:"",key:this.normalizeKey(e.key.toUpperCase()),ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},i=this.getBindingKey(n),o=this.bindings.get(i);if(o&&o.length>0){const a=o[0];try{e.preventDefault(),e.stopPropagation();const c=je.createExecutionContext({});je.execute(a.commandId,c),tt.info(`Executed command via key binding: ${a.commandId}`)}catch(c){tt.error(`Failed to execute command ${a.commandId}: ${c.message}`)}}}setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}getAllBindings(){return new Map(this.bindings)}clearAll(){this.bindings.clear()}}tt.debug("KeyBindingManager initializing...");const Ea=new Fl;tt.debug("KeyBindingManager initialized");Bt.put("keyBindingManager",Ea);function is(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Yr=is();function Aa(r){Yr=r}var Nn={exec:()=>null};function rt(r,e=""){let t=typeof r=="string"?r:r.source,n={replace:(i,o)=>{let a=typeof o=="string"?o:o.source;return a=a.replace(Ht.caret,"$1"),t=t.replace(i,a),n},getRegex:()=>new RegExp(t,e)};return n}var Ht={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},ql=/^(?:[ \t]*(?:\n|$))+/,zl=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ul=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,jn=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,jl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ss=/(?:[*+-]|\d{1,9}[.)])/,Ta=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Oa=rt(Ta).replace(/bull/g,ss).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Wl=rt(Ta).replace(/bull/g,ss).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),as=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Bl=/^[^\n]+/,os=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Gl=rt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",os).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Vl=rt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ss).getRegex(),Si="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ls=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Hl=rt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",ls).replace("tag",Si).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ra=rt(as).replace("hr",jn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Si).getRegex(),Kl=rt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ra).getRegex(),cs={blockquote:Kl,code:zl,def:Gl,fences:Ul,heading:jl,hr:jn,html:Hl,lheading:Oa,list:Vl,newline:ql,paragraph:Ra,table:Nn,text:Bl},Fs=rt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",jn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Si).getRegex(),Yl={...cs,lheading:Wl,table:Fs,paragraph:rt(as).replace("hr",jn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Fs).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Si).getRegex()},Jl={...cs,html:rt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",ls).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Nn,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:rt(as).replace("hr",jn).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Oa).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Zl=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Xl=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Pa=/^( {2,}|\\)\n(?!\s*$)/,Ql=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,_i=/[\p{P}\p{S}]/u,us=/[\s\p{P}\p{S}]/u,La=/[^\s\p{P}\p{S}]/u,ec=rt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,us).getRegex(),$a=/(?!~)[\p{P}\p{S}]/u,tc=/(?!~)[\s\p{P}\p{S}]/u,rc=/(?:[^\s\p{P}\p{S}]|~)/u,nc=rt(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),Da=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ic=rt(Da,"u").replace(/punct/g,_i).getRegex(),sc=rt(Da,"u").replace(/punct/g,$a).getRegex(),Na="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ac=rt(Na,"gu").replace(/notPunctSpace/g,La).replace(/punctSpace/g,us).replace(/punct/g,_i).getRegex(),oc=rt(Na,"gu").replace(/notPunctSpace/g,rc).replace(/punctSpace/g,tc).replace(/punct/g,$a).getRegex(),lc=rt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,La).replace(/punctSpace/g,us).replace(/punct/g,_i).getRegex(),cc=rt(/\\(punct)/,"gu").replace(/punct/g,_i).getRegex(),uc=rt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),pc=rt(ls).replace("(?:-->|$)","-->").getRegex(),dc=rt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",pc).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ui=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,hc=rt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",ui).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ma=rt(/^!?\[(label)\]\[(ref)\]/).replace("label",ui).replace("ref",os).getRegex(),Fa=rt(/^!?\[(ref)\](?:\[\])?/).replace("ref",os).getRegex(),fc=rt("reflink|nolink(?!\\()","g").replace("reflink",Ma).replace("nolink",Fa).getRegex(),qs=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,ps={_backpedal:Nn,anyPunctuation:cc,autolink:uc,blockSkip:nc,br:Pa,code:Xl,del:Nn,emStrongLDelim:ic,emStrongRDelimAst:ac,emStrongRDelimUnd:lc,escape:Zl,link:hc,nolink:Fa,punctuation:ec,reflink:Ma,reflinkSearch:fc,tag:dc,text:Ql,url:Nn},mc={...ps,link:rt(/^!?\[(label)\]\((.*?)\)/).replace("label",ui).getRegex(),reflink:rt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ui).getRegex()},Hi={...ps,emStrongRDelimAst:oc,emStrongLDelim:sc,url:rt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",qs).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:rt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",qs).getRegex()},gc={...Hi,br:rt(Pa).replace("{2,}","*").getRegex(),text:rt(Hi.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Qn={normal:cs,gfm:Yl,pedantic:Jl},In={normal:ps,gfm:Hi,breaks:gc,pedantic:mc},vc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zs=r=>vc[r];function mr(r,e){if(e){if(Ht.escapeTest.test(r))return r.replace(Ht.escapeReplace,zs)}else if(Ht.escapeTestNoEncode.test(r))return r.replace(Ht.escapeReplaceNoEncode,zs);return r}function Us(r){try{r=encodeURI(r).replace(Ht.percentDecode,"%")}catch{return null}return r}function js(r,e){let t=r.replace(Ht.findPipe,(o,a,c)=>{let f=!1,y=a;for(;--y>=0&&c[y]==="\\";)f=!f;return f?"|":" |"}),n=t.split(Ht.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(Ht.slashPipe,"|");return n}function Sn(r,e,t){let n=r.length;if(n===0)return"";let i=0;for(;i<n&&r.charAt(n-i-1)===e;)i++;return r.slice(0,n-i)}function yc(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return t>0?-2:-1}function Ws(r,e,t,n,i){let o=e.href,a=e.title||null,c=r[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let f={type:r[0].charAt(0)==="!"?"image":"link",raw:t,href:o,title:a,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,f}function bc(r,e,t){let n=r.match(t.other.indentCodeCompensation);if(n===null)return e;let i=n[1];return e.split(`
`).map(o=>{let a=o.match(t.other.beginningSpace);if(a===null)return o;let[c]=a;return c.length>=i.length?o.slice(i.length):o}).join(`
`)}var pi=class{options;rules;lexer;constructor(r){this.options=r||Yr}space(r){let e=this.rules.block.newline.exec(r);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(r){let e=this.rules.block.code.exec(r);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:Sn(t,`
`)}}}fences(r){let e=this.rules.block.fences.exec(r);if(e){let t=e[0],n=bc(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(r){let e=this.rules.block.heading.exec(r);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let n=Sn(t,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(t=n.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(r){let e=this.rules.block.hr.exec(r);if(e)return{type:"hr",raw:Sn(e[0],`
`)}}blockquote(r){let e=this.rules.block.blockquote.exec(r);if(e){let t=Sn(e[0],`
`).split(`
`),n="",i="",o=[];for(;t.length>0;){let a=!1,c=[],f;for(f=0;f<t.length;f++)if(this.rules.other.blockquoteStart.test(t[f]))c.push(t[f]),a=!0;else if(!a)c.push(t[f]);else break;t=t.slice(f);let y=c.join(`
`),R=y.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${y}`:y,i=i?`${i}
${R}`:R;let b=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(R,o,!0),this.lexer.state.top=b,t.length===0)break;let x=o.at(-1);if(x?.type==="code")break;if(x?.type==="blockquote"){let _=x,D=_.raw+`
`+t.join(`
`),Y=this.blockquote(D);o[o.length-1]=Y,n=n.substring(0,n.length-_.raw.length)+Y.raw,i=i.substring(0,i.length-_.text.length)+Y.text;break}else if(x?.type==="list"){let _=x,D=_.raw+`
`+t.join(`
`),Y=this.list(D);o[o.length-1]=Y,n=n.substring(0,n.length-x.raw.length)+Y.raw,i=i.substring(0,i.length-_.raw.length)+Y.raw,t=D.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:i}}}list(r){let e=this.rules.block.list.exec(r);if(e){let t=e[1].trim(),n=t.length>1,i={type:"list",raw:"",ordered:n,start:n?+t.slice(0,-1):"",loose:!1,items:[]};t=n?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=n?t:"[*+-]");let o=this.rules.other.listItemRegex(t),a=!1;for(;r;){let f=!1,y="",R="";if(!(e=o.exec(r))||this.rules.block.hr.test(r))break;y=e[0],r=r.substring(y.length);let b=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,xe=>" ".repeat(3*xe.length)),x=r.split(`
`,1)[0],_=!b.trim(),D=0;if(this.options.pedantic?(D=2,R=b.trimStart()):_?D=e[1].length+1:(D=e[2].search(this.rules.other.nonSpaceChar),D=D>4?1:D,R=b.slice(D),D+=e[1].length),_&&this.rules.other.blankLine.test(x)&&(y+=x+`
`,r=r.substring(x.length+1),f=!0),!f){let xe=this.rules.other.nextBulletRegex(D),W=this.rules.other.hrRegex(D),N=this.rules.other.fencesBeginRegex(D),K=this.rules.other.headingBeginRegex(D),U=this.rules.other.htmlBeginRegex(D);for(;r;){let O=r.split(`
`,1)[0],B;if(x=O,this.options.pedantic?(x=x.replace(this.rules.other.listReplaceNesting,"  "),B=x):B=x.replace(this.rules.other.tabCharGlobal,"    "),N.test(x)||K.test(x)||U.test(x)||xe.test(x)||W.test(x))break;if(B.search(this.rules.other.nonSpaceChar)>=D||!x.trim())R+=`
`+B.slice(D);else{if(_||b.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||N.test(b)||K.test(b)||W.test(b))break;R+=`
`+x}!_&&!x.trim()&&(_=!0),y+=O+`
`,r=r.substring(O.length+1),b=B.slice(D)}}i.loose||(a?i.loose=!0:this.rules.other.doubleBlankLine.test(y)&&(a=!0));let Y=null,ve;this.options.gfm&&(Y=this.rules.other.listIsTask.exec(R),Y&&(ve=Y[0]!=="[ ] ",R=R.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:y,task:!!Y,checked:ve,loose:!1,text:R,tokens:[]}),i.raw+=y}let c=i.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let f=0;f<i.items.length;f++)if(this.lexer.state.top=!1,i.items[f].tokens=this.lexer.blockTokens(i.items[f].text,[]),!i.loose){let y=i.items[f].tokens.filter(b=>b.type==="space"),R=y.length>0&&y.some(b=>this.rules.other.anyLine.test(b.raw));i.loose=R}if(i.loose)for(let f=0;f<i.items.length;f++)i.items[f].loose=!0;return i}}html(r){let e=this.rules.block.html.exec(r);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(r){let e=this.rules.block.def.exec(r);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:n,title:i}}}table(r){let e=this.rules.block.table.exec(r);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=js(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===n.length){for(let a of n)this.rules.other.tableAlignRight.test(a)?o.align.push("right"):this.rules.other.tableAlignCenter.test(a)?o.align.push("center"):this.rules.other.tableAlignLeft.test(a)?o.align.push("left"):o.align.push(null);for(let a=0;a<t.length;a++)o.header.push({text:t[a],tokens:this.lexer.inline(t[a]),header:!0,align:o.align[a]});for(let a of i)o.rows.push(js(a,o.header.length).map((c,f)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:o.align[f]})));return o}}lheading(r){let e=this.rules.block.lheading.exec(r);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(r){let e=this.rules.block.paragraph.exec(r);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(r){let e=this.rules.block.text.exec(r);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(r){let e=this.rules.inline.escape.exec(r);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(r){let e=this.rules.inline.tag.exec(r);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(r){let e=this.rules.inline.link.exec(r);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let o=Sn(t.slice(0,-1),"\\");if((t.length-o.length)%2===0)return}else{let o=yc(e[2],"()");if(o===-2)return;if(o>-1){let a=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,a).trim(),e[3]=""}}let n=e[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],i=o[3])}else i=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?n=n.slice(1):n=n.slice(1,-1)),Ws(e,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(r,e){let t;if((t=this.rules.inline.reflink.exec(r))||(t=this.rules.inline.nolink.exec(r))){let n=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[n.toLowerCase()];if(!i){let o=t[0].charAt(0);return{type:"text",raw:o,text:o}}return Ws(t,i,t[0],this.lexer,this.rules)}}emStrong(r,e,t=""){let n=this.rules.inline.emStrongLDelim.exec(r);if(!(!n||n[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!t||this.rules.inline.punctuation.exec(t))){let i=[...n[0]].length-1,o,a,c=i,f=0,y=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(y.lastIndex=0,e=e.slice(-1*r.length+i);(n=y.exec(e))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(a=[...o].length,n[3]||n[4]){c+=a;continue}else if((n[5]||n[6])&&i%3&&!((i+a)%3)){f+=a;continue}if(c-=a,c>0)continue;a=Math.min(a,a+c+f);let R=[...n[0]][0].length,b=r.slice(0,i+n.index+R+a);if(Math.min(i,a)%2){let _=b.slice(1,-1);return{type:"em",raw:b,text:_,tokens:this.lexer.inlineTokens(_)}}let x=b.slice(2,-2);return{type:"strong",raw:b,text:x,tokens:this.lexer.inlineTokens(x)}}}}codespan(r){let e=this.rules.inline.code.exec(r);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return n&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(r){let e=this.rules.inline.br.exec(r);if(e)return{type:"br",raw:e[0]}}del(r){let e=this.rules.inline.del.exec(r);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(r){let e=this.rules.inline.autolink.exec(r);if(e){let t,n;return e[2]==="@"?(t=e[1],n="mailto:"+t):(t=e[1],n=t),{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}url(r){let e;if(e=this.rules.inline.url.exec(r)){let t,n;if(e[2]==="@")t=e[0],n="mailto:"+t;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);t=e[0],e[1]==="www."?n="http://"+e[0]:n=e[0]}return{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(r){let e=this.rules.inline.text.exec(r);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},dr=class Ki{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Yr,this.options.tokenizer=this.options.tokenizer||new pi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:Ht,block:Qn.normal,inline:In.normal};this.options.pedantic?(t.block=Qn.pedantic,t.inline=In.pedantic):this.options.gfm&&(t.block=Qn.gfm,this.options.breaks?t.inline=In.breaks:t.inline=In.gfm),this.tokenizer.rules=t}static get rules(){return{block:Qn,inline:In}}static lex(e,t){return new Ki(t).lex(e)}static lexInline(e,t){return new Ki(t).inlineTokens(e)}lex(e){e=e.replace(Ht.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(Ht.tabCharGlobal,"    ").replace(Ht.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(a=>(i=a.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let a=t.at(-1);i.raw.length===1&&a!==void 0?a.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.text,this.inlineQueue.at(-1).src=a.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},t.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}let o=e;if(this.options.extensions?.startBlock){let a=1/0,c=e.slice(1),f;this.options.extensions.startBlock.forEach(y=>{f=y.call({lexer:this},c),typeof f=="number"&&f>=0&&(a=Math.min(a,f))}),a<1/0&&a>=0&&(o=e.substring(0,a+1))}if(this.state.top&&(i=this.tokenizer.paragraph(o))){let a=t.at(-1);n&&a?.type==="paragraph"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(i),n=o.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let a=t.at(-1);a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+i.raw,a.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(i);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n=e,i=null;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)c.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let o=!1,a="";for(;e;){o||(a=""),o=!1;let c;if(this.options.extensions?.inline?.some(y=>(c=y.call({lexer:this},e,t))?(e=e.substring(c.raw.length),t.push(c),!0):!1))continue;if(c=this.tokenizer.escape(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.tag(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.link(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(c.raw.length);let y=t.at(-1);c.type==="text"&&y?.type==="text"?(y.raw+=c.raw,y.text+=c.text):t.push(c);continue}if(c=this.tokenizer.emStrong(e,n,a)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.codespan(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.br(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.del(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.autolink(e)){e=e.substring(c.raw.length),t.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(e))){e=e.substring(c.raw.length),t.push(c);continue}let f=e;if(this.options.extensions?.startInline){let y=1/0,R=e.slice(1),b;this.options.extensions.startInline.forEach(x=>{b=x.call({lexer:this},R),typeof b=="number"&&b>=0&&(y=Math.min(y,b))}),y<1/0&&y>=0&&(f=e.substring(0,y+1))}if(c=this.tokenizer.inlineText(f)){e=e.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(a=c.raw.slice(-1)),o=!0;let y=t.at(-1);y?.type==="text"?(y.raw+=c.raw,y.text+=c.text):t.push(c);continue}if(e){let y="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(y);break}else throw new Error(y)}}return t}},di=class{options;parser;constructor(r){this.options=r||Yr}space(r){return""}code({text:r,lang:e,escaped:t}){let n=(e||"").match(Ht.notSpaceStart)?.[0],i=r.replace(Ht.endingNewline,"")+`
`;return n?'<pre><code class="language-'+mr(n)+'">'+(t?i:mr(i,!0))+`</code></pre>
`:"<pre><code>"+(t?i:mr(i,!0))+`</code></pre>
`}blockquote({tokens:r}){return`<blockquote>
${this.parser.parse(r)}</blockquote>
`}html({text:r}){return r}def(r){return""}heading({tokens:r,depth:e}){return`<h${e}>${this.parser.parseInline(r)}</h${e}>
`}hr(r){return`<hr>
`}list(r){let e=r.ordered,t=r.start,n="";for(let a=0;a<r.items.length;a++){let c=r.items[a];n+=this.listitem(c)}let i=e?"ol":"ul",o=e&&t!==1?' start="'+t+'"':"";return"<"+i+o+`>
`+n+"</"+i+`>
`}listitem(r){let e="";if(r.task){let t=this.checkbox({checked:!!r.checked});r.loose?r.tokens[0]?.type==="paragraph"?(r.tokens[0].text=t+" "+r.tokens[0].text,r.tokens[0].tokens&&r.tokens[0].tokens.length>0&&r.tokens[0].tokens[0].type==="text"&&(r.tokens[0].tokens[0].text=t+" "+mr(r.tokens[0].tokens[0].text),r.tokens[0].tokens[0].escaped=!0)):r.tokens.unshift({type:"text",raw:t+" ",text:t+" ",escaped:!0}):e+=t+" "}return e+=this.parser.parse(r.tokens,!!r.loose),`<li>${e}</li>
`}checkbox({checked:r}){return"<input "+(r?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:r}){return`<p>${this.parser.parseInline(r)}</p>
`}table(r){let e="",t="";for(let i=0;i<r.header.length;i++)t+=this.tablecell(r.header[i]);e+=this.tablerow({text:t});let n="";for(let i=0;i<r.rows.length;i++){let o=r.rows[i];t="";for(let a=0;a<o.length;a++)t+=this.tablecell(o[a]);n+=this.tablerow({text:t})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow({text:r}){return`<tr>
${r}</tr>
`}tablecell(r){let e=this.parser.parseInline(r.tokens),t=r.header?"th":"td";return(r.align?`<${t} align="${r.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:r}){return`<strong>${this.parser.parseInline(r)}</strong>`}em({tokens:r}){return`<em>${this.parser.parseInline(r)}</em>`}codespan({text:r}){return`<code>${mr(r,!0)}</code>`}br(r){return"<br>"}del({tokens:r}){return`<del>${this.parser.parseInline(r)}</del>`}link({href:r,title:e,tokens:t}){let n=this.parser.parseInline(t),i=Us(r);if(i===null)return n;r=i;let o='<a href="'+r+'"';return e&&(o+=' title="'+mr(e)+'"'),o+=">"+n+"</a>",o}image({href:r,title:e,text:t,tokens:n}){n&&(t=this.parser.parseInline(n,this.parser.textRenderer));let i=Us(r);if(i===null)return mr(t);r=i;let o=`<img src="${r}" alt="${t}"`;return e&&(o+=` title="${mr(e)}"`),o+=">",o}text(r){return"tokens"in r&&r.tokens?this.parser.parseInline(r.tokens):"escaped"in r&&r.escaped?r.text:mr(r.text)}},ds=class{strong({text:r}){return r}em({text:r}){return r}codespan({text:r}){return r}del({text:r}){return r}html({text:r}){return r}text({text:r}){return r}link({text:r}){return""+r}image({text:r}){return""+r}br(){return""}},hr=class Yi{options;renderer;textRenderer;constructor(e){this.options=e||Yr,this.options.renderer=this.options.renderer||new di,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ds}static parse(e,t){return new Yi(t).parse(e)}static parseInline(e,t){return new Yi(t).parseInline(e)}parse(e,t=!0){let n="";for(let i=0;i<e.length;i++){let o=e[i];if(this.options.extensions?.renderers?.[o.type]){let c=o,f=this.options.extensions.renderers[c.type].call({parser:this},c);if(f!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(c.type)){n+=f||"";continue}}let a=o;switch(a.type){case"space":{n+=this.renderer.space(a);continue}case"hr":{n+=this.renderer.hr(a);continue}case"heading":{n+=this.renderer.heading(a);continue}case"code":{n+=this.renderer.code(a);continue}case"table":{n+=this.renderer.table(a);continue}case"blockquote":{n+=this.renderer.blockquote(a);continue}case"list":{n+=this.renderer.list(a);continue}case"html":{n+=this.renderer.html(a);continue}case"def":{n+=this.renderer.def(a);continue}case"paragraph":{n+=this.renderer.paragraph(a);continue}case"text":{let c=a,f=this.renderer.text(c);for(;i+1<e.length&&e[i+1].type==="text";)c=e[++i],f+=`
`+this.renderer.text(c);t?n+=this.renderer.paragraph({type:"paragraph",raw:f,text:f,tokens:[{type:"text",raw:f,text:f,escaped:!0}]}):n+=f;continue}default:{let c='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,t=this.renderer){let n="";for(let i=0;i<e.length;i++){let o=e[i];if(this.options.extensions?.renderers?.[o.type]){let c=this.options.extensions.renderers[o.type].call({parser:this},o);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=c||"";continue}}let a=o;switch(a.type){case"escape":{n+=t.text(a);break}case"html":{n+=t.html(a);break}case"link":{n+=t.link(a);break}case"image":{n+=t.image(a);break}case"strong":{n+=t.strong(a);break}case"em":{n+=t.em(a);break}case"codespan":{n+=t.codespan(a);break}case"br":{n+=t.br(a);break}case"del":{n+=t.del(a);break}case"text":{n+=t.text(a);break}default:{let c='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}},On=class{options;block;constructor(r){this.options=r||Yr}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(r){return r}postprocess(r){return r}processAllTokens(r){return r}emStrongMask(r){return r}provideLexer(){return this.block?dr.lex:dr.lexInline}provideParser(){return this.block?hr.parse:hr.parseInline}},wc=class{defaults=is();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=hr;Renderer=di;TextRenderer=ds;Lexer=dr;Tokenizer=pi;Hooks=On;constructor(...r){this.use(...r)}walkTokens(r,e){let t=[];for(let n of r)switch(t=t.concat(e.call(this,n)),n.type){case"table":{let i=n;for(let o of i.header)t=t.concat(this.walkTokens(o.tokens,e));for(let o of i.rows)for(let a of o)t=t.concat(this.walkTokens(a.tokens,e));break}case"list":{let i=n;t=t.concat(this.walkTokens(i.items,e));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(o=>{let a=i[o].flat(1/0);t=t.concat(this.walkTokens(a,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}use(...r){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(t=>{let n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=e.renderers[i.name];o?e.renderers[i.name]=function(...a){let c=i.renderer.apply(this,a);return c===!1&&(c=o.apply(this,a)),c}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[i.level];o?o.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),n.extensions=e),t.renderer){let i=this.defaults.renderer||new di(this.defaults);for(let o in t.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let a=o,c=t.renderer[a],f=i[a];i[a]=(...y)=>{let R=c.apply(i,y);return R===!1&&(R=f.apply(i,y)),R||""}}n.renderer=i}if(t.tokenizer){let i=this.defaults.tokenizer||new pi(this.defaults);for(let o in t.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let a=o,c=t.tokenizer[a],f=i[a];i[a]=(...y)=>{let R=c.apply(i,y);return R===!1&&(R=f.apply(i,y)),R}}n.tokenizer=i}if(t.hooks){let i=this.defaults.hooks||new On;for(let o in t.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let a=o,c=t.hooks[a],f=i[a];On.passThroughHooks.has(o)?i[a]=y=>{if(this.defaults.async&&On.passThroughHooksRespectAsync.has(o))return(async()=>{let b=await c.call(i,y);return f.call(i,b)})();let R=c.call(i,y);return f.call(i,R)}:i[a]=(...y)=>{if(this.defaults.async)return(async()=>{let b=await c.apply(i,y);return b===!1&&(b=await f.apply(i,y)),b})();let R=c.apply(i,y);return R===!1&&(R=f.apply(i,y)),R}}n.hooks=i}if(t.walkTokens){let i=this.defaults.walkTokens,o=t.walkTokens;n.walkTokens=function(a){let c=[];return c.push(o.call(this,a)),i&&(c=c.concat(i.call(this,a))),c}}this.defaults={...this.defaults,...n}}),this}setOptions(r){return this.defaults={...this.defaults,...r},this}lexer(r,e){return dr.lex(r,e??this.defaults)}parser(r,e){return hr.parse(r,e??this.defaults)}parseMarkdown(r){return(e,t)=>{let n={...t},i={...this.defaults,...n},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=r),i.async)return(async()=>{let a=i.hooks?await i.hooks.preprocess(e):e,c=await(i.hooks?await i.hooks.provideLexer():r?dr.lex:dr.lexInline)(a,i),f=i.hooks?await i.hooks.processAllTokens(c):c;i.walkTokens&&await Promise.all(this.walkTokens(f,i.walkTokens));let y=await(i.hooks?await i.hooks.provideParser():r?hr.parse:hr.parseInline)(f,i);return i.hooks?await i.hooks.postprocess(y):y})().catch(o);try{i.hooks&&(e=i.hooks.preprocess(e));let a=(i.hooks?i.hooks.provideLexer():r?dr.lex:dr.lexInline)(e,i);i.hooks&&(a=i.hooks.processAllTokens(a)),i.walkTokens&&this.walkTokens(a,i.walkTokens);let c=(i.hooks?i.hooks.provideParser():r?hr.parse:hr.parseInline)(a,i);return i.hooks&&(c=i.hooks.postprocess(c)),c}catch(a){return o(a)}}}onError(r,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,r){let n="<p>An error occurred:</p><pre>"+mr(t.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(t);throw t}}},Gr=new wc;function at(r,e){return Gr.parse(r,e)}at.options=at.setOptions=function(r){return Gr.setOptions(r),at.defaults=Gr.defaults,Aa(at.defaults),at};at.getDefaults=is;at.defaults=Yr;at.use=function(...r){return Gr.use(...r),at.defaults=Gr.defaults,Aa(at.defaults),at};at.walkTokens=function(r,e){return Gr.walkTokens(r,e)};at.parseInline=Gr.parseInline;at.Parser=hr;at.parser=hr.parse;at.Renderer=di;at.TextRenderer=ds;at.Lexer=dr;at.lexer=dr.lex;at.Tokenizer=pi;at.Hooks=On;at.parse=at;at.options;at.setOptions;at.use;at.walkTokens;at.parseInline;hr.parse;dr.lex;let _n=null;function hs(){return _n||(_n=document.createElement("div"),_n.id="global-dialog-container",document.body.appendChild(_n)),_n}function fs(r){return new Promise(e=>{const t=hs(),n=()=>{Tr(G``,t)},i=()=>{n(),e(r.confirmValue)},o=()=>{n(),e(r.cancelValue)},a=G`
            <wa-dialog label="${r.title}" open @wa-request-close=${o}>
                <style>
                    .dialog-content {
                        display: flex;
                        flex-direction: column;
                        gap: 1rem;
                        padding: 1rem;
                        min-width: 400px;
                    }
                    
                    .dialog-message {
                        margin-bottom: 0.5rem;
                        color: var(--wa-color-neutral-700);
                    }
                    
                    .markdown-content {
                        line-height: 1.6;
                    }
                    
                    .markdown-content h1,
                    .markdown-content h2,
                    .markdown-content h3 {
                        margin-top: 1rem;
                        margin-bottom: 0.5rem;
                        font-weight: 600;
                    }
                    
                    .markdown-content h1 { font-size: 1.5rem; }
                    .markdown-content h2 { font-size: 1.3rem; }
                    .markdown-content h3 { font-size: 1.1rem; }
                    
                    .markdown-content p {
                        margin: 0.5rem 0;
                    }
                    
                    .markdown-content ul,
                    .markdown-content ol {
                        margin: 0.5rem 0;
                        padding-left: 1.5rem;
                    }
                    
                    .markdown-content code {
                        background: var(--wa-color-neutral-100);
                        padding: 0.125rem 0.25rem;
                        border-radius: 3px;
                        font-family: monospace;
                        font-size: 0.9em;
                    }
                    
                    .markdown-content pre {
                        background: var(--wa-color-neutral-100);
                        padding: 0.75rem;
                        border-radius: 4px;
                        overflow-x: auto;
                    }
                    
                    .markdown-content pre code {
                        background: none;
                        padding: 0;
                    }
                    
                    .markdown-content hr {
                        border: none;
                        border-top: 1px solid var(--wa-color-neutral-300);
                        margin: 1rem 0;
                    }
                    
                    .markdown-content blockquote {
                        border-left: 3px solid var(--wa-color-neutral-300);
                        padding-left: 1rem;
                        margin: 0.5rem 0;
                        color: var(--wa-color-neutral-600);
                    }
                    
                    .dialog-actions {
                        display: flex;
                        gap: 0.5rem;
                        justify-content: flex-end;
                        margin-top: 0.5rem;
                    }
                </style>
                
                <div class="dialog-content">
                    ${r.renderContent({onConfirm:i,onCancel:o})}
                </div>
            </wa-dialog>
        `;Tr(a,t),r.onAfterRender&&requestAnimationFrame(r.onAfterRender)})}function Ci(r,e=!1){if(e){const t=at.parse(r,{async:!1});return G`<div class="dialog-message markdown-content" style="white-space: normal;">${Un(t)}</div>`}return G`<div class="dialog-message" style="white-space: pre-line;">${r}</div>`}const Wn=async(r,e="",t=!1)=>{let n=e;return fs({title:"Input",message:r,markdown:t,confirmValue:n,cancelValue:null,renderContent:({onConfirm:i,onCancel:o})=>{const a=f=>{n=f.target.value},c=f=>{f.key==="Enter"?(f.preventDefault(),i()):f.key==="Escape"&&(f.preventDefault(),o())};return G`
                ${Ci(r,t)}
                <wa-input
                    value="${e}"
                    @input=${a}
                    @keydown=${c}
                    autofocus
                ></wa-input>
                
                <div class="dialog-actions">
                    <wa-button variant="default" @click=${o}>
                        Cancel
                    </wa-button>
                    <wa-button variant="primary" @click=${()=>{i()}}>
                        OK
                    </wa-button>
                </div>
            `},onAfterRender:()=>{const o=hs().querySelector("wa-input");if(o){const a=o.shadowRoot?.querySelector("input");a&&(a.focus(),a.select())}}}).then(()=>n)},fn=async(r,e=!1)=>fs({title:"Confirm",message:r,markdown:e,confirmValue:!0,cancelValue:!1,renderContent:({onConfirm:t,onCancel:n})=>G`
            ${Ci(r,e)}
            
            <div class="dialog-actions">
                <wa-button variant="default" @click=${n}>
                    Cancel
                </wa-button>
                <wa-button variant="primary" @click=${t}>
                    OK
                </wa-button>
            </div>
        `}),xc=async(r,e,t=!1)=>{await fs({title:r,message:e,markdown:t,confirmValue:void 0,cancelValue:void 0,renderContent:({onConfirm:n})=>G`
            ${Ci(e,t)}
            
            <div class="dialog-actions">
                <wa-button variant="primary" @click=${n}>
                    OK
                </wa-button>
            </div>
        `})},kc=async(r,e,t,n=!1)=>new Promise(i=>{const o=hs();let a=!0;const c=()=>{a&&(a=!1,Tr(G``,o),i())},f=(y,R,b)=>{if(!a)return;const x=G`
                <wa-dialog label="${y}" open @wa-request-close=${c}>
                    <style>
                        .dialog-content {
                            display: flex;
                            flex-direction: column;
                            gap: 1rem;
                            padding: 1rem;
                            min-width: 400px;
                            max-width: 600px;
                            height: 500px;
                        }
                        
                        .dialog-scroller {
                            flex: 1;
                            overflow-y: auto;
                        }
                        
                        .dialog-message {
                            margin-bottom: 0.5rem;
                            color: var(--wa-color-neutral-700);
                        }
                        
                        .dialog-actions {
                            display: flex;
                            gap: 0.5rem;
                            justify-content: space-between;
                            margin-top: 0.5rem;
                        }
                        
                        .dialog-actions-left,
                        .dialog-actions-right {
                            display: flex;
                            gap: 0.5rem;
                        }
                    </style>
                    
                    <div class="dialog-content">
                        <wa-scroller class="dialog-scroller">
                            ${Ci(R,n)}
                        </wa-scroller>
                        
                        <div class="dialog-actions">
                            <div class="dialog-actions-left">
                                ${b.filter(_=>_.label!=="Close").map(_=>G`
                                    <wa-button 
                                        variant="${_.variant||"default"}"
                                        ?disabled=${_.disabled}
                                        @click=${()=>{_.callback()}}
                                    >
                                        ${_.label}
                                    </wa-button>
                                `)}
                            </div>
                            <div class="dialog-actions-right">
                                ${b.filter(_=>_.label==="Close").map(_=>G`
                                    <wa-button 
                                        variant="${_.variant||"primary"}"
                                        @click=${()=>{_.callback(),c()}}
                                    >
                                        ${_.label}
                                    </wa-button>
                                `)}
                            </div>
                        </div>
                    </div>
                </wa-dialog>
            `;Tr(x,o)};t.updateDialog=f,f(r,e,t)});xr.put("promptDialog",Wn);xr.put("confirmDialog",fn);xr.put("infoDialog",xc);xr.put("navigableInfoDialog",kc);var si={exports:{}};var Ic=si.exports,Bs;function Sc(){return Bs||(Bs=1,(function(r){(function(e,t){r.exports?r.exports=t():e.Toastify=t()})(Ic,function(e){var t=function(a){return new t.lib.init(a)},n="1.12.0";t.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},t.lib=t.prototype={toastify:n,constructor:t,init:function(a){return a||(a={}),this.options={},this.toastElement=null,this.options.text=a.text||t.defaults.text,this.options.node=a.node||t.defaults.node,this.options.duration=a.duration===0?0:a.duration||t.defaults.duration,this.options.selector=a.selector||t.defaults.selector,this.options.callback=a.callback||t.defaults.callback,this.options.destination=a.destination||t.defaults.destination,this.options.newWindow=a.newWindow||t.defaults.newWindow,this.options.close=a.close||t.defaults.close,this.options.gravity=a.gravity==="bottom"?"toastify-bottom":t.defaults.gravity,this.options.positionLeft=a.positionLeft||t.defaults.positionLeft,this.options.position=a.position||t.defaults.position,this.options.backgroundColor=a.backgroundColor||t.defaults.backgroundColor,this.options.avatar=a.avatar||t.defaults.avatar,this.options.className=a.className||t.defaults.className,this.options.stopOnFocus=a.stopOnFocus===void 0?t.defaults.stopOnFocus:a.stopOnFocus,this.options.onClick=a.onClick||t.defaults.onClick,this.options.offset=a.offset||t.defaults.offset,this.options.escapeMarkup=a.escapeMarkup!==void 0?a.escapeMarkup:t.defaults.escapeMarkup,this.options.ariaLive=a.ariaLive||t.defaults.ariaLive,this.options.style=a.style||t.defaults.style,a.backgroundColor&&(this.options.style.background=a.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var a=document.createElement("div");a.className="toastify on "+this.options.className,this.options.position?a.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(a.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):a.className+=" toastify-right",a.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var c in this.options.style)a.style[c]=this.options.style[c];if(this.options.ariaLive&&a.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)a.appendChild(this.options.node);else if(this.options.escapeMarkup?a.innerText=this.options.text:a.innerHTML=this.options.text,this.options.avatar!==""){var f=document.createElement("img");f.src=this.options.avatar,f.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?a.appendChild(f):a.insertAdjacentElement("afterbegin",f)}if(this.options.close===!0){var y=document.createElement("button");y.type="button",y.setAttribute("aria-label","Close"),y.className="toast-close",y.innerHTML="&#10006;",y.addEventListener("click",(function(ve){ve.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}).bind(this));var R=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&R>360?a.insertAdjacentElement("afterbegin",y):a.appendChild(y)}if(this.options.stopOnFocus&&this.options.duration>0){var b=this;a.addEventListener("mouseover",function(ve){window.clearTimeout(a.timeOutValue)}),a.addEventListener("mouseleave",function(){a.timeOutValue=window.setTimeout(function(){b.removeElement(a)},b.options.duration)})}if(typeof this.options.destination<"u"&&a.addEventListener("click",(function(ve){ve.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}).bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&a.addEventListener("click",(function(ve){ve.stopPropagation(),this.options.onClick()}).bind(this)),typeof this.options.offset=="object"){var x=i("x",this.options),_=i("y",this.options),D=this.options.position=="left"?x:"-"+x,Y=this.options.gravity=="toastify-top"?_:"-"+_;a.style.transform="translate("+D+","+Y+")"}return a},showToast:function(){this.toastElement=this.buildToast();var a;if(typeof this.options.selector=="string"?a=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?a=this.options.selector:a=document.body,!a)throw"Root element is not defined";var c=t.defaults.oldestFirst?a.firstChild:a.lastChild;return a.insertBefore(this.toastElement,c),t.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout((function(){this.removeElement(this.toastElement)}).bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(a){a.className=a.className.replace(" on",""),window.setTimeout((function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),a.parentNode&&a.parentNode.removeChild(a),this.options.callback.call(a),t.reposition()}).bind(this),400)}},t.reposition=function(){for(var a={top:15,bottom:15},c={top:15,bottom:15},f={top:15,bottom:15},y=document.getElementsByClassName("toastify"),R,b=0;b<y.length;b++){o(y[b],"toastify-top")===!0?R="toastify-top":R="toastify-bottom";var x=y[b].offsetHeight;R=R.substr(9,R.length-1);var _=15,D=window.innerWidth>0?window.innerWidth:screen.width;D<=360?(y[b].style[R]=f[R]+"px",f[R]+=x+_):o(y[b],"toastify-left")===!0?(y[b].style[R]=a[R]+"px",a[R]+=x+_):(y[b].style[R]=c[R]+"px",c[R]+=x+_)}return this};function i(a,c){return c.offset[a]?isNaN(c.offset[a])?c.offset[a]:c.offset[a]+"px":"0px"}function o(a,c){return!a||typeof c!="string"?!1:!!(a.className&&a.className.trim().split(/\s+/gi).indexOf(c)>-1)}return t.lib.init.prototype=t.lib,t})})(si)),si.exports}var qa=Sc();const za=xi(qa),_c=ga({__proto__:null,default:za},[qa]),ms=za||_c,tr=r=>{console.info("[TOAST] INFO: ",r),ms({text:r,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0}).showToast()},Ze=r=>{console.error("[TOAST] ERROR: ",r),ms({text:r,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0,style:{background:"coral"}}).showToast()},Cc=r=>{console.warn("[TOAST] WARNING: ",r),ms({text:r,duration:3e3,close:!0,gravity:"bottom",stopOnFocus:!0,style:{background:"orange"}}).showToast()};xr.put("toastInfo",tr);xr.put("toastError",Ze);xr.put("toastWarning",Cc);const Ua=(r,e)=>{const t=new wr.subtle.Watcher(async()=>{try{await 0,e(r.get())}finally{t.watch(r)}});return t.watch(r),r.get(),()=>{t.unwatch(r)}};Object.defineProperty(pa.prototype,"model",{enumerable:!0,configurable:!0,writable:!0});class Bn extends Dl(pa){constructor(){super(...arguments),this.signalCleanups=new Set}connectedCallback(){const e=Object.getPrototypeOf(this);Object.getOwnPropertyNames(e).forEach(t=>{const n=e[t];if(n instanceof Function){const i=n;i.name.startsWith("on")&&"topic"in i&&this.subscribe(i.topic,i)}}),super.connectedCallback(),this.doBeforeUI()}disconnectedCallback(){super.disconnectedCallback(),this.signalCleanups.forEach(e=>e()),this.signalCleanups.clear()}subscribe(e,t){Kt(e,t.bind(this))}showInfo(e){tr(e)}showError(e){Ze(e)}nobubble(e){return t=>{t.stopPropagation(),e.bind(this)(t)}}command(e,t={}){return()=>{this.executeCommand(e,t)}}executeCommand(e,t){const n=je.createExecutionContext(t);je.execute(e,n)}watch(e,t){const n=Ua(e,t.bind(this));this.signalCleanups.add(n)}firstUpdated(e){super.firstUpdated(e),this.doInitUI()}updateIdle(){requestIdleCallback(()=>this.requestUpdate())}updateLater(){requestAnimationFrame(()=>this.requestUpdate())}doBeforeUI(){}doInitUI(){}withRefresh(e){e(),this.updateLater()}}function gs(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function Ec(r,e){let t;const n=()=>{if(t)return t;const i=indexedDB.open(r);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=gs(i),t.then(o=>{o.onclose=()=>t=void 0},()=>{}),t};return(i,o)=>n().then(a=>o(a.transaction(e,i).objectStore(e)))}let Fi;function ja(){return Fi||(Fi=Ec("keyval-store","keyval")),Fi}function Ac(r,e=ja()){return e("readonly",t=>gs(t.get(r)))}function Tc(r,e,t=ja()){return t("readwrite",n=>(n.put(e,r),gs(n.transaction)))}class Oc{async persistObject(e,t){return Tc(e,t)}async getObject(e){return Ac(e)}}const ir=new Oc;Bt.put("persistenceService",ir);const rn=".geospace/settings.json",ai="dialogSettings",Wr="events/settings/changed";class Rc{async checkSettings(){this.appSettings||(this.appSettings=await ir.getObject(rn),this.appSettings||(this.appSettings={},await ir.persistObject(rn,this.appSettings)),Xe(Wr,this.appSettings))}async get(e){return await this.checkSettings(),this.appSettings[e]}async set(e,t){await this.checkSettings(),this.appSettings[e]=t,await ir.persistObject(rn,this.appSettings),Xe(Wr,this.appSettings)}async getAll(){return await this.checkSettings(),this.appSettings}async setAll(e){this.appSettings=e,await ir.persistObject(rn,this.appSettings),Xe(Wr,this.appSettings)}async getDialogSetting(e){return await this.checkSettings(),(this.appSettings[ai]||{})[e]}async setDialogSetting(e,t){await this.checkSettings();const n=this.appSettings[ai]||{};n[e]=t,this.appSettings[ai]=n,await ir.persistObject(rn,this.appSettings),Xe(Wr,this.appSettings)}}const xt=new Rc;Bt.put("appSettings",xt);const od=Object.freeze(Object.defineProperty({__proto__:null,DIALOG_SETTINGS_KEY:ai,SETTINGS_FILE_PATH:rn,TOPIC_SETTINGS_CHANGED:Wr,appSettings:xt},Symbol.toStringTag,{value:"Module"}));class Jr extends Bn{constructor(){super(...arguments),this.settingsKey=null}buildDOMTreePath(){const e=[];let t=this;for(;t&&t!==document.body&&t!==document.documentElement;){const n=t.getAttribute("id");if(n){e.unshift(`#${n}`);break}const i=t.tagName.toLowerCase(),o=t.parentElement;if(!o)break;const c=Array.from(o.children).filter(f=>f.tagName.toLowerCase()===i).indexOf(t);c>=0?e.unshift(`${i}:${c}`):e.unshift(i),t=o}return e.length>0?e.join(" > "):null}initializeSettingsKey(){if(!this.settingsKey){const e=this.tagName.toLowerCase(),t=this.getAttribute("id");if(t){this.settingsKey=`${e}:${t}`;return}const n=this.buildDOMTreePath();n&&(this.settingsKey=`${e}:${n}`)}}async getDialogSetting(){if(this.initializeSettingsKey(),!!this.settingsKey)return await xt.getDialogSetting(this.settingsKey)}async setDialogSetting(e){this.initializeSettingsKey(),this.settingsKey&&await xt.setDialogSetting(this.settingsKey,e)}}var Pc=Object.getOwnPropertyDescriptor,Lc=(r,e,t,n)=>{for(var i=n>1?void 0:n?Pc(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=a(i)||i);return i};let Ji=class extends Jr{render(){return G`
            <slot></slot>
        `}};Ji.styles=Yt`
        :host {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            width: 100%;
            box-sizing: border-box;
        }
    `;Ji=Lc([Et("k-app")],Ji);var $c=Object.defineProperty,Dc=Object.getOwnPropertyDescriptor,mn=(r,e,t,n)=>{for(var i=n>1?void 0:n?Dc(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&$c(e,t,i),i};let Or=class extends Jr{constructor(){super(...arguments),this.position="start",this.isEditor=!1,this.partToolbarContent=void 0,this.partToolbarRenderer=void 0,this.contributions=[]}doBeforeUI(){const r=this.getAttribute("id");r&&this.loadContributions(r),Kt(Lr,e=>{if(!r)return;this.matchesTarget(r,e.target)&&(this.loadContributions(r),this.requestUpdate())})}matchesTarget(r,e){if(e===r)return!0;if(!r.includes(":"))return!1;const[t]=r.split(":");if(e===`${t}:*`)return!0;const n=e.split(":");if(n.length===2){const i=n[1];if(i==="system.editors"||i===".system.editors")return this.isEditor&&r.startsWith(`${t}:`)}return!1}loadContributions(r){const e=Me.getContributions(r);if(!r.includes(":")){this.contributions=e;return}const[t]=r.split(":"),n=`${t}:*`,i=Me.getContributions(n),o=[];if(this.isEditor){const a=["system.editors",".system.editors"];for(const c of a){const f=`${t}:${c}`,y=Me.getContributions(f);o.push(...y)}}this.contributions=[...i,...o,...e]}contributionCreator(r){if("command"in r){const e=r,t=!!e.showLabel;return G`
                <wa-button @click=${()=>this.executeCommand(e.command,e.params||{})}
                           title=${e.label}
                           ?disabled="${e.disabled?.get()}"
                           appearance="plain" size="small">
                    <wa-icon name=${e.icon} label="${e.label}"></wa-icon>
                    ${t?e.label:""}
                </wa-button>
            `}else if("html"in r){const e=r.html;return e instanceof Function?e():Un(e)}else return G`<span>unknown contribution type: ${typeof r}</span>`}render(){const r=this.partToolbarRenderer?this.partToolbarRenderer():this.partToolbarContent?this.partToolbarContent:"";return G`
            <div class="toolbar-items" style=${Mo({"justify-content":this.position})}>
                <slot name="start">
                    ${this.contributions.filter(e=>e.slot==="start").map(this.contributionCreator.bind(this))}
                </slot>
                ${r}
                ${this.contributions.filter(e=>e.slot===void 0).map(this.contributionCreator.bind(this))}
                <slot>
                </slot>
                <slot name="end">
                    ${this.contributions.filter(e=>e.slot==="end").map(this.contributionCreator.bind(this))}
                </slot>
            </div>
        `}};Or.styles=Yt`
        :host {
            display: flex;
            flex-direction: row;
        }

        .toolbar-items {
            display: flex;
            flex: 1;
        }
    `;mn([Be()],Or.prototype,"position",2);mn([Be({type:Boolean,attribute:"is-editor"})],Or.prototype,"isEditor",2);mn([Be({attribute:!1})],Or.prototype,"partToolbarContent",2);mn([Be({attribute:!1})],Or.prototype,"partToolbarRenderer",2);mn([At()],Or.prototype,"contributions",2);Or=mn([Et("k-toolbar")],Or);var Nc=Object.defineProperty,Mc=Object.getOwnPropertyDescriptor,gn=(r,e,t,n)=>{for(var i=n>1?void 0:n?Mc(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Nc(e,t,i),i};let Rr=class extends Jr{constructor(){super(...arguments),this.isEditor=!1,this.partContextMenuRenderer=void 0,this.contributions=[],this.isOpen=!1,this.position={x:0,y:0},this.anchorRef=yr(),this.dropdownRef=yr()}doBeforeUI(){const r=this.getAttribute("id");r&&this.loadContributions(r),Kt(Lr,e=>{if(!r)return;this.matchesTarget(r,e.target)&&(this.loadContributions(r),this.requestUpdate())})}matchesTarget(r,e){if(e===r)return!0;if(!r.includes(":"))return!1;const[t]=r.split(":");if(e===`${t}:*`)return!0;const n=e.split(":");if(n.length===2){const i=n[1];if(i==="system.editors"||i===".system.editors")return this.isEditor&&r.startsWith(`${t}:`)}return!1}loadContributions(r){const e=Me.getContributions(r);if(!r.includes(":")){this.contributions=e;return}const[t]=r.split(":"),n=`${t}:*`,i=Me.getContributions(n),o=[];if(this.isEditor){const a=["system.editors",".system.editors"];for(const c of a){const f=`${t}:${c}`,y=Me.getContributions(f);o.push(...y)}}this.contributions=[...i,...o,...e]}getElementFromPoint(r,e){let t=document.elementFromPoint(r,e);if(!t)return null;for(;t;){const n=t.shadowRoot;if(n){const i=n.elementFromPoint(r,e);if(i&&i!==t){t=i;continue}}break}return t}triggerClickUnderCursor(r){const e=this.getElementFromPoint(r.clientX,r.clientY);if(e){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,clientX:r.clientX,clientY:r.clientY,screenX:r.screenX,screenY:r.screenY,button:0,buttons:0,detail:1,which:1});e.dispatchEvent(t)}}show(r,e){e&&this.triggerClickUnderCursor(e),this.position=r,this.isOpen=!0}onClose(){this.isOpen=!1}handleCommandClick(r,e){return async()=>{this.executeCommand(r,e||{})}}renderContribution(r){if("command"in r){const e=r;return G`
                <wa-dropdown-item 
                    @click=${this.handleCommandClick(e.command,e.params)}
                    ?disabled="${e.disabled?.get()}">
                    ${e.icon?G`<wa-icon slot="icon" name=${e.icon}></wa-icon>`:""}
                    ${e.label}
                </wa-dropdown-item>
            `}else if("html"in r){const e=r.html;return e instanceof Function?e():Un(e)}return kt}render(){if(!this.isOpen)return kt;const r=this.partContextMenuRenderer?this.partContextMenuRenderer():kt;return G`
            <wa-dropdown 
                ${br(this.dropdownRef)}
                ?open=${this.isOpen}
                @wa-after-hide=${this.onClose}
                placement="bottom-start"
                distance="0">
                
                <div 
                    slot="trigger"
                    ${br(this.anchorRef)}
                    style="position: fixed; 
                           left: ${this.position.x}px; 
                           top: ${this.position.y}px; 
                           width: 1px; 
                           height: 1px; 
                           pointer-events: none;">
                </div>
                
                ${r}
                ${this.contributions.map(e=>this.renderContribution(e))}
            </wa-dropdown>
        `}};Rr.styles=Yt`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 10000;
        }

        wa-dropdown {
            pointer-events: auto;
            min-width: 200px;
        }
        
        wa-dropdown::part(panel) {
            min-width: 200px;
        }
    `;gn([Be({type:Boolean,attribute:"is-editor"})],Rr.prototype,"isEditor",2);gn([Be({attribute:!1})],Rr.prototype,"partContextMenuRenderer",2);gn([At()],Rr.prototype,"contributions",2);gn([At()],Rr.prototype,"isOpen",2);gn([At()],Rr.prototype,"position",2);Rr=gn([Et("k-contextmenu")],Rr);class vs extends Jr{}const Gs=(r,e,t)=>{const n=new Map;for(let i=e;i<=t;i++)n.set(r[i],i);return n},Fc=da(class extends ha{constructor(r){if(super(r),r.type!==Fo.CHILD)throw Error("repeat() can only be used in text expressions")}dt(r,e,t){let n;t===void 0?t=e:e!==void 0&&(n=e);const i=[],o=[];let a=0;for(const c of r)i[a]=n?n(c,a):a,o[a]=t(c,a),a++;return{values:o,keys:i}}render(r,e,t){return this.dt(r,e,t).values}update(r,[e,t,n]){const i=qo(r),{values:o,keys:a}=this.dt(e,t,n);if(!Array.isArray(i))return this.ut=a,o;const c=this.ut??=[],f=[];let y,R,b=0,x=i.length-1,_=0,D=o.length-1;for(;b<=x&&_<=D;)if(i[b]===null)b++;else if(i[x]===null)x--;else if(c[b]===a[_])f[_]=Ur(i[b],o[_]),b++,_++;else if(c[x]===a[D])f[D]=Ur(i[x],o[D]),x--,D--;else if(c[b]===a[D])f[D]=Ur(i[b],o[D]),xn(r,f[D+1],i[b]),b++,D--;else if(c[x]===a[_])f[_]=Ur(i[x],o[_]),xn(r,i[b],i[x]),x--,_++;else if(y===void 0&&(y=Gs(a,_,D),R=Gs(c,b,x)),y.has(c[b]))if(y.has(c[x])){const Y=R.get(a[_]),ve=Y!==void 0?i[Y]:null;if(ve===null){const xe=xn(r,i[b]);Ur(xe,o[_]),f[_]=xe}else f[_]=Ur(ve,o[_]),xn(r,i[b],ve),i[Y]=null;_++}else Li(i[x]),x--;else Li(i[b]),b++;for(;_<=D;){const Y=xn(r,f[D+1]);Ur(Y,o[_]),f[_++]=Y}for(;b<=x;){const Y=i[b++];Y!==null&&Li(Y)}return this.ut=a,fa(r,f),zo}}),qc="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='2'%20y='2'%20width='28'%20height='28'%20fill='%23FFCA28'/%3e%3cpath%20d='M19%2025.2879L21.0615%2023.9237C21.2231%2024.4313%2022.2462%2025.6368%2023.5385%2025.6368C24.8308%2025.6368%2025.4308%2024.931%2025.4308%2024.463C25.4308%2023.1878%2024.1112%2022.7382%2023.4774%2022.5223C23.374%2022.4871%2023.289%2022.4581%2023.2308%2022.4328C23.2009%2022.4198%2023.1558%2022.4025%2023.0979%2022.3804C22.393%2022.1111%2019.7923%2021.1175%2019.7923%2018.2373C19.7923%2015.065%2022.8538%2014.7002%2023.5462%2014.7002C23.9991%2014.7002%2026.1769%2014.7557%2027.2615%2016.7939L25.2615%2018.1898C24.8231%2017.3015%2024.0946%2017.0081%2023.6462%2017.0081C22.5385%2017.0081%2022.3077%2017.8201%2022.3077%2018.1898C22.3077%2019.227%2023.5112%2019.6919%2024.5273%2020.0844C24.7932%2020.1871%2025.0462%2020.2848%2025.2615%2020.3866C26.3692%2020.91%2028%2021.7666%2028%2024.463C28%2025.8136%2026.8672%2028.0002%2024.0154%2028.0002C20.1846%2028.0002%2019.1692%2025.7003%2019%2025.2879Z'%20fill='%233E3E3E'/%3e%3cpath%20d='M9%2025.5587L11.1487%2024.1953C11.317%2024.7026%2011.9713%2025.638%2012.9205%2025.638C13.8698%2025.638%2014.3557%2024.663%2014.3557%2024.1953V15.0002H16.9982V24.1953C17.041%2025.4636%2016.3376%2028.0002%2013.2332%2028.0002C10.379%2028.0002%209.19242%2026.3039%209%2025.5587Z'%20fill='%233E3E3E'/%3e%3c/svg%3e",zc="/assets/jupyter-C78Cpfql.svg",Uc="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.0164%202C10.8193%202%209.03825%203.72453%209.03825%205.85185V8.51852H15.9235V9.25926H5.97814C3.78107%209.25926%202%2010.9838%202%2013.1111L2%2018.8889C2%2021.0162%203.78107%2022.7407%205.97814%2022.7407H8.27322V19.4815C8.27322%2017.3542%2010.0543%2015.6296%2012.2514%2015.6296H19.5956C21.4547%2015.6296%2022.9617%2014.1704%2022.9617%2012.3704V5.85185C22.9617%203.72453%2021.1807%202%2018.9836%202H13.0164ZM12.0984%206.74074C12.8589%206.74074%2013.4754%206.14378%2013.4754%205.40741C13.4754%204.67103%2012.8589%204.07407%2012.0984%204.07407C11.3378%204.07407%2010.7213%204.67103%2010.7213%205.40741C10.7213%206.14378%2011.3378%206.74074%2012.0984%206.74074Z'%20fill='url(%23paint0_linear_87_8204)'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M18.9834%2030C21.1805%2030%2022.9616%2028.2755%2022.9616%2026.1482V23.4815L16.0763%2023.4815L16.0763%2022.7408L26.0217%2022.7408C28.2188%2022.7408%2029.9998%2021.0162%2029.9998%2018.8889V13.1111C29.9998%2010.9838%2028.2188%209.25928%2026.0217%209.25928L23.7266%209.25928V12.5185C23.7266%2014.6459%2021.9455%2016.3704%2019.7485%2016.3704L12.4042%2016.3704C10.5451%2016.3704%209.03809%2017.8296%209.03809%2019.6296L9.03809%2026.1482C9.03809%2028.2755%2010.8192%2030%2013.0162%2030H18.9834ZM19.9015%2025.2593C19.1409%2025.2593%2018.5244%2025.8562%2018.5244%2026.5926C18.5244%2027.329%2019.1409%2027.9259%2019.9015%2027.9259C20.662%2027.9259%2021.2785%2027.329%2021.2785%2026.5926C21.2785%2025.8562%2020.662%2025.2593%2019.9015%2025.2593Z'%20fill='url(%23paint1_linear_87_8204)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_87_8204'%20x1='12.4809'%20y1='2'%20x2='12.4809'%20y2='22.7407'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23327EBD'/%3e%3cstop%20offset='1'%20stop-color='%231565A7'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_87_8204'%20x1='19.519'%20y1='9.25928'%20x2='19.519'%20y2='30'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFDA4B'/%3e%3cstop%20offset='1'%20stop-color='%23F9C600'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e";Uo("k",{resolver:r=>new URL(Object.assign({"../icons/js.svg":qc,"../icons/jupyter.svg":zc,"../icons/python.svg":Uc})[`../icons/${r}.svg`],import.meta.url).href,mutator:r=>{r.setAttribute("fill","currentColor"),r.setAttribute("stroke","currentColor")}});var jc=Object.defineProperty,Wc=Object.getOwnPropertyDescriptor,Gn=(r,e,t,n)=>{for(var i=n>1?void 0:n?Wc(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&jc(e,t,i),i};let Vr=class extends Bn{constructor(){super(...arguments),this.family="regular"}render(){if(!this.name)return"";const r=this.name.trim().split(/ +/),e=r.pop(),t=r.pop();return G`
            <wa-icon library="${t||kt}" variant="${this.variant||kt}"
                         family="${this.family||kt}" name=${e} label="${this.label||this.name||kt}"></wa-icon>`}};Vr.styles=Yt`
        :host {
            display: contents;
        }
    `;Gn([Be()],Vr.prototype,"name",2);Gn([Be()],Vr.prototype,"family",2);Gn([Be()],Vr.prototype,"variant",2);Gn([Be()],Vr.prototype,"label",2);Vr=Gn([Et("k-icon")],Vr);var Bc=Object.defineProperty,Gc=(r,e,t,n)=>{for(var i=void 0,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=a(e,t,i)||i);return i&&Bc(e,t,i),i};class jt extends vs{constructor(){super(...arguments),this.dirty=!1,this.isEditor=!1}getCommandStack(){return this.commandStack}renderToolbar(){return kt}updateToolbar(){this.dispatchEvent(new CustomEvent("part-toolbar-changed",{bubbles:!0,composed:!0}))}renderContextMenu(){return kt}updateContextMenu(){this.dispatchEvent(new CustomEvent("part-contextmenu-changed",{bubbles:!0,composed:!0}))}updated(e){super.updated(e),e.has("dirty")&&e.get("dirty")!==void 0&&this.dispatchEvent(new CustomEvent("dirty",{detail:this.dirty,bubbles:!0}))}doClose(){}disconnectedCallback(){super.disconnectedCallback()}close(){this.doClose()}connectedCallback(){super.connectedCallback()}save(){}isDirty(){return this.dirty}markDirty(e){this.dirty=e,Gi.set(null),Gi.set(this),it.set(null),it.set(this)}}Gc([Be()],jt.prototype,"dirty");const Wa="app-toolbars-main",vn="app-toolbars-main-right",Vc="app-toolbars-main-center",Ba="app-toolbars-bottom",ys="app-toolbars-bottom-center",bs="app-toolbars-bottom-end",Br="editor-area-main",Zi="sidebar-main",Ga="sidebar-main-bottom",Va="sidebar-auxiliary",Hc="panel-bottom",Kc=!1;var Ha=(r=>(r[r.LEFT=0]="LEFT",r[r.MIDDLE=1]="MIDDLE",r[r.RIGHT=2]="RIGHT",r[r.BACK=3]="BACK",r[r.FORWARD=4]="FORWARD",r))(Ha||{});class Yc{constructor(){this.tasks=[],this.updateCounter=0}notifyUpdate(){this.updateCounter++,Vi.set(this.updateCounter)}run(e,t){const n=this.createProgressMonitor(e);try{this.tasks.push(n),this.notifyUpdate(),t(n)}finally{this.tasks.splice(this.tasks.indexOf(n),1),this.notifyUpdate()}}async runAsync(e,t){const n=this.createProgressMonitor(e);return this.tasks.push(n),this.notifyUpdate(),t(n).finally(()=>{this.tasks.splice(this.tasks.indexOf(n),1),this.notifyUpdate()})}createProgressMonitor(e){const t={name:e,message:"",currentStep:0,totalSteps:-1,progress:-1};return new Proxy(t,{set:(n,i,o)=>(n[i]=o,this.notifyUpdate(),!0)})}getActiveTasks(){return this.tasks}}const hi=new Yc;Bt.put("taskService",hi);const Rn="events/extensionsregistry/extensionsConfigChanged",Cn="extensions",Vs="extensions.external";class Jc{constructor(){this.extensions={},this.loadedExtensions=new Set,this.loadingPromises=new Map,Kt(Wr,()=>{this.extensionsSettings=void 0,this.checkExtensionsConfig().then()}),this.loadPersistedExternalExtensions().then(()=>{this.checkExtensionsConfig().then(async()=>{const e=this.extensionsSettings?.filter(t=>this.isEnabled(t.id)).map(t=>this.load(t.id).catch(n=>{Ze("Extension could not be loaded: "+n.message)}))||[];await Promise.all(e)})})}async loadPersistedExternalExtensions(){try{const e=await xt.get(Vs);e&&Array.isArray(e)&&(e.forEach(t=>{this.extensions[t.id]=t}),tt.debug(`Loaded ${e.length} persisted external extensions`))}catch(e){tt.error(`Failed to load persisted external extensions: ${e}`)}}async savePersistedExternalExtensions(){try{const e=Object.values(this.extensions).filter(t=>t.external);await xt.set(Vs,e)}catch(e){tt.error(`Failed to save persisted external extensions: ${e}`)}}async checkExtensionsConfig(){this.extensionsSettings||(this.extensionsSettings=await xt.get(Cn),this.extensionsSettings||(await xt.set(Cn,[]),this.extensionsSettings=await xt.get(Cn)),Xe(Rn,this.extensionsSettings))}registerExtension(e){this.extensions[e.id]=e,e.external&&this.savePersistedExternalExtensions().catch(t=>{tt.error(`Failed to persist external extension: ${t}`)}),Xe(Rn,this.extensionsSettings)}getExtensions(){return Object.values(this.extensions)}isEnabled(e){return this.checkExtensionsConfig(),!!this.extensionsSettings?.find(t=>t.id===e&&t.enabled)}isLoaded(e){return this.loadedExtensions.has(e)}enable(e,t=!1){this.isEnabled(e)||(tt.debug(`Loading extension: ${e}`),this.load(e).then(()=>{this.updateEnablement(e,!0,t)}).catch(n=>{tt.error(`Could not load extension: ${e}`)}))}async load(e,t=[]){if(this.loadedExtensions.has(e))return;const n=this.loadingPromises.get(e);if(n)return n;if(t.includes(e)){const a=[...t,e].join(" → ");throw new Error(`Circular dependency detected: ${a}`)}const i=this.extensions[e];if(!i)throw new Error("Extension not found: "+e);const o=(async()=>{try{if(i.dependencies&&i.dependencies.length>0){tt.debug(`Loading dependencies for ${e}: ${i.dependencies.join(", ")}`);const c=[...t,e];for(const f of i.dependencies)await this.load(f,c),this.isEnabled(f)||(await this.updateEnablementAsync(f,!0,!1),tt.debug(`Auto-enabled dependency: ${f}`))}const a=await hi.runAsync("Loading extension: "+i.name,()=>{if(i.loader)return i.loader();if(i.url)return import(i.url)});if(this.loadedExtensions.add(e),a?.default instanceof Function){tt.debug(`Executing extension function for: ${e}`);try{a?.default(xr.getProxy()),tt.debug(`Extension function executed successfully: ${e}`)}catch(c){throw tt.error(`Error executing extension function for ${e}: ${c}`),c}}else tt.warn(`Extension ${e} does not export a default function`);tt.debug(`Extension loaded: ${e}`)}catch(a){throw this.loadedExtensions.delete(e),a}finally{this.loadingPromises.delete(e)}})();return this.loadingPromises.set(e,o),o}disable(e,t=!1){this.isEnabled(e)&&this.updateEnablement(e,!1,t)}updateEnablement(e,t,n){this.checkExtensionsConfig().then(()=>{const i=this.extensionsSettings?.find(o=>o.id==e);i?i.enabled=t:this.extensionsSettings?.push({id:e,enabled:t}),xt.set(Cn,this.extensionsSettings).then(()=>{if(n){const o=this.extensions[e];tr(t?o.name+" enabled.":o.name+" disabled  - Please restart to take effect")}Xe(Rn,this.extensionsSettings)})})}async updateEnablementAsync(e,t,n){await this.checkExtensionsConfig();const i=this.extensionsSettings?.find(o=>o.id==e);if(i?i.enabled=t:this.extensionsSettings?.push({id:e,enabled:t}),await xt.set(Cn,this.extensionsSettings),n){const o=this.extensions[e];tr(t?o.name+" enabled.":o.name+" disabled  - Please restart to take effect")}Xe(Rn,this.extensionsSettings)}}tt.debug("ExtensionRegistry initializing...");const Ue=new Jc;Bt.put("extensionRegistry",Ue);tt.debug("ExtensionRegistry initialized");const Ve=Hr("AppLoader");function En(r){return r instanceof Error?r.message:String(r)}function Zc(r){try{const t=new URL(r).pathname.split("/").filter(Boolean);return t.length>0?t[t.length-1]:void 0}catch{const e=r.split("/").filter(Boolean);return e.length>0?e[e.length-1]:void 0}}function Xc(){const e=window.location.pathname.split("/").filter(Boolean);if(e.length===0)return;const t=e[0];if(!(!t||t==="index.html"||t.endsWith(".html")))return t}class Qc{constructor(){this.apps=new Map,this.started=!1,this.container=document.body}registerApp(e,t){this.apps.has(e.id)&&Ve.warn(`App '${e.id}' is already registered. Overwriting.`),this.apps.set(e.id,e),Ve.info(`Registered app: ${e.name} (${e.id}) v${e.version}`),t?.defaultAppId&&(this.defaultAppId=t.defaultAppId),t?.container&&(this.container=t.container),t?.autoStart&&!this.started&&this.start()}async loadExtensionFromUrl(e){Ve.info(`Loading extension from URL: ${e}...`);try{const t=`url:${e}`;if(Ue.isEnabled(t)){Ve.info(`Extension from URL ${e} is already enabled`);return}const n={id:t,name:`Extension from ${e}`,description:`Extension loaded from URL: ${e}`,url:e};Ue.registerExtension(n),Ve.info(`Registered extension from URL: ${t}`),Ue.enable(t,!1),Ve.info(`Successfully enabled extension from URL: ${e}`)}catch(t){throw Ve.error(`Failed to load extension from URL ${e}: ${En(t)}`),t}}async loadAppFromUrl(e){Ve.info(`Loading app from URL: ${e}...`);try{const t=await import(e);if(!t.default)throw new Error(`Module at ${e} does not have a default export`);const n=t.default;if(!n.id||!n.name||!n.version)throw new Error(`Module at ${e} does not export a valid AppDefinition`);return Ve.info(`Successfully loaded app definition from URL: ${n.name} (${n.id})`),n}catch(t){throw Ve.error(`Failed to load app from URL ${e}: ${En(t)}`),t}}async start(){if(this.started){Ve.debug("AppLoader already started");return}document.readyState==="loading"&&await new Promise(f=>{document.addEventListener("DOMContentLoaded",()=>f(),{once:!0})}),this.started=!0,Ve.info("Starting AppLoader...");const e=new URLSearchParams(window.location.search),t=e.get("app"),n=e.get("appId"),i=Xc(),o=this.apps.size;let a;if(t&&(a=Zc(t),a&&Ve.info(`Extracted app ID from URL path: ${a}`)),i&&Ve.info(`Extracted app ID from current page path: ${i}`),t)try{Ve.info(`URL parameter 'app' found: ${t}, attempting to load extension or app`);try{await this.loadExtensionFromUrl(t),Ve.info(`Successfully loaded extension from URL: ${t}`)}catch(f){Ve.info(`Failed to load as extension, trying as app definition: ${En(f)}`);try{const y=await this.loadAppFromUrl(t);this.registerApp(y),await this.loadApp(y.id,this.container),Ve.info(`Successfully loaded app from URL: ${t}`);return}catch(y){throw Ve.error(`Failed to load from URL as both extension and app: ${En(y)}`),y}}}catch(f){Ve.error(`Failed to load from URL parameter, falling back to default app: ${En(f)}`)}const c=this.selectAppToLoad({appIdFromUrl:n,appIdFromPath:i,appIdFromAppUrl:a,appsBeforeExtension:o});if(!c)throw new Error("No apps registered");await this.loadApp(c,this.container)}async loadApp(e,t){const n=this.apps.get(e);if(!n)throw new Error(`App '${e}' not found. Make sure it's registered.`);Ve.info(`Loading app: ${n.name}...`),this.currentApp&&(Ve.info(`Disposing current app: ${this.currentApp.name}`),this.currentApp.dispose&&await this.currentApp.dispose(),this.currentApp.extensions&&(Ve.info(`Disabling ${this.currentApp.extensions.length} extensions...`),this.currentApp.extensions.forEach(i=>{Ue.disable(i)}))),n.contributions&&(Ve.info("Registering app contributions..."),n.contributions.ui&&(n.contributions.ui.forEach(i=>{const o=i.target;o&&Me.registerContribution(o,i)}),Ve.info(`Registered ${n.contributions.ui.length} UI contributions`)),n.contributions.extensions&&(n.contributions.extensions.forEach(i=>{Ue.registerExtension(i)}),Ve.info(`Registered ${n.contributions.extensions.length} app extensions`))),n.extensions&&(Ve.info(`Enabling ${n.extensions.length} extensions...`),n.extensions.forEach(i=>{Ue.enable(i)})),n.initialize&&(Ve.info(`Initializing ${n.name}...`),await n.initialize()),this.currentApp=n,Ve.info(`App ${n.name} loaded successfully`),this.updateDocumentMetadata(n),t&&this.renderApp(t)}updateDocumentMetadata(e){if(document.title=e.name,e.metadata?.favicon){const t=e.metadata.favicon;let n=document.querySelector("link[rel*='icon']");n||(n=document.createElement("link"),n.rel="icon",document.head.appendChild(n)),n.type="image/svg+xml",n.href=t}}renderApp(e){if(!this.currentApp)throw new Error("No app loaded. Call loadApp() first.");const t=this.currentApp.render?this.currentApp.render():G`<k-standard-app></k-standard-app>`;Tr(t,e),Ve.info(`Rendered ${this.currentApp.name}`)}getCurrentApp(){return this.currentApp}getRegisteredApps(){return Array.from(this.apps.values())}selectAppToLoad(e){const{appIdFromUrl:t,appIdFromPath:n,appIdFromAppUrl:i,appsBeforeExtension:o}=e;if(t){if(this.apps.has(t))return Ve.info(`Loading app specified by URL parameter 'appId': ${t}`),t;Ve.warn(`App ID '${t}' from URL parameter not found`)}if(n){if(this.apps.has(n))return Ve.info(`Loading app from URL path: ${n}`),n;Ve.debug(`App ID '${n}' from URL path not found, continuing search`)}if(i&&this.apps.has(i))return Ve.info(`Loading app using ID extracted from app URL path: ${i}`),i;if(this.apps.size>o){const c=Array.from(this.apps.values()).slice(o);if(c.length>0){const f=c[0];return Ve.info(`Loading app registered by extension: ${f.name} (${f.id})`),f.id}}if(this.defaultAppId){if(this.apps.has(this.defaultAppId))return this.defaultAppId;Ve.warn(`Default app '${this.defaultAppId}' not found`)}const a=this.getRegisteredApps();if(a.length>0){const c=a[0];return Ve.info(`Loading first registered app: ${c.name} (${c.id})`),c.id}}}const Zr=new Qc;Bt.put("appLoaderService",Zr);var eu=Object.defineProperty,tu=Object.getOwnPropertyDescriptor,Ka=(r,e,t,n)=>{for(var i=n>1?void 0:n?tu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&eu(e,t,i),i};let fi=class extends vs{constructor(){super(...arguments),this.contributions=[],this.tabGroup=yr(),this.containerId=null,this.resizeObservers=new WeakMap}doBeforeUI(){if(this.containerId=this.getAttribute("id"),!this.containerId)throw new Error("k-tabs requires an 'id' attribute to function");this.loadAndResolveContributions()}doInitUI(){this.updateComplete.then(()=>{this.activateNextAvailableTab(),this.tabGroup.value&&(this.tabGroup.value.addEventListener("wa-tab-show",r=>{const e=this.getTabPanel(r.detail.name);e&&(this.updateToolbarFromComponent(e),requestAnimationFrame(()=>{this.updateToolbarHeightVariable(e),this.setupToolbarResizeObserver(e)}),this.dispatchEvent(new CustomEvent("tab-shown",{detail:e})))}),this.tabGroup.value.addEventListener("part-toolbar-changed",r=>{const t=r.target.closest("wa-tab-panel");t&&(this.updateToolbarFromComponent(t),requestAnimationFrame(()=>this.updateToolbarHeightVariable(t)))}),this.tabGroup.value.addEventListener("part-contextmenu-changed",r=>{const t=r.target.closest("wa-tab-panel");t&&this.updateContextMenuFromComponent(t)}),this.tabGroup.value.addEventListener("click",r=>{const e=r.target,t=e.closest("wa-tab");if(t){const a=t.getAttribute("panel");if(a){const c=this.getTabPanel(a);if(c){const f=c.querySelector(".tab-content");if(f&&f.firstElementChild){const y=f.firstElementChild;y instanceof jt&&it.set(y)}}}return}const n=e.closest("wa-scroller.tab-content");if(!n)return;const i=n.closest("wa-tab-panel");if(!i)return;const o=i.querySelector(".tab-content");if(o&&o.firstElementChild){const a=o.firstElementChild;a instanceof jt&&it.set(a)}}),this.tabGroup.value.addEventListener("contextmenu",r=>{const e=r,t=e.target.closest("wa-scroller.tab-content");if(!t)return;e.preventDefault();const n=t.closest("wa-tab-panel");n&&requestAnimationFrame(()=>{this.updateContextMenuFromComponent(n);const i=n.querySelector("k-contextmenu");i&&i.show({x:e.clientX,y:e.clientY},e)})}))}),Kt(Lr,r=>{!this.containerId||r.target!==this.containerId||(this.loadAndResolveContributions(),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()}))})}updated(r){if(super.updated(r),r.has("contributions")){const e=this.containerId===Br;this.contributions.forEach(t=>{const n=this.getTabPanel(t.name);if(!n)return;const i=n.querySelector(".tab-content");if(i&&i.firstElementChild){const o=i.firstElementChild;o instanceof jt&&(o.tabContribution=t,o.isEditor=e)}requestAnimationFrame(()=>this.updateToolbarHeightVariable(n))})}}has(r){return this.tabGroup.value?!!this.getTabPanel(r):!1}activate(r){this.tabGroup.value&&this.tabGroup.value.setAttribute("active",r)}getActiveEditor(){return this.tabGroup.value?this.tabGroup.value.getAttribute("active"):null}open(r){if(this.contributions.find(t=>t.name===r.name)){this.activate(r.name);return}this.contributions.push(r),this.requestUpdate(),this.updateComplete.then(()=>{this.activate(r.name);const t=this.getTabPanel(r.name);if(t){const n=t.querySelector(".tab-content");if(n&&n.firstElementChild){const i=n.firstElementChild;i instanceof jt&&(i.tabContribution=r,i.isEditor=this.containerId===Br)}requestAnimationFrame(()=>{this.updateToolbarFromComponent(t),this.updateToolbarHeightVariable(t),this.setupToolbarResizeObserver(t)})}})}handleTabAuxClick(r,e){r.button===Ha.MIDDLE&&e.closable&&this.closeTab(r,e.name)}async closeTab(r,e){if(r.stopPropagation(),this.isDirty(e)&&!await fn("Unsaved changes will be lost: Do you really want to close?"))return;const t=this.getTabPanel(e);if(!t)return;const n=this.contributions.find(o=>o.name===e);if(!n)return;this.cleanupTabInstance(t);const i=this.contributions.indexOf(n);i>-1&&this.contributions.splice(i,1),this.dispatchEvent(new CustomEvent("tab-closed",{detail:t})),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()})}markDirty(r,e){this.getTab(r).classList.toggle("part-dirty",e)}isDirty(r){return this.getTab(r).classList.contains("part-dirty")}loadAndResolveContributions(){this.contributions=Me.getContributions(this.containerId),this.requestUpdate()}cleanupTabInstance(r){const e=this.resizeObservers.get(r);e&&(e.disconnect(),this.resizeObservers.delete(r));const t=r.querySelector(".tab-content");if(t&&t.firstElementChild){const n=t.firstElementChild;"close"in n&&typeof n.close=="function"&&n.close()}}activateNextAvailableTab(){if(!this.tabGroup.value)return;const r=this.tabGroup.value.querySelectorAll("wa-tab");if(r.length>0){const e=r.item(0).getAttribute("panel");e&&this.tabGroup.value.setAttribute("active",e)}else this.tabGroup.value.removeAttribute("active")}getTabPanel(r){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab-panel[name='${r}']`):null}getTab(r){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab[panel='${r}']`):null}updateToolbarFromComponent(r){const e=r.querySelector(".tab-content");if(!e||!e.firstElementChild)return;const t=e.firstElementChild;if(!(t instanceof jt)||!t.renderToolbar)return;const n=r.querySelector("k-toolbar");n&&(n.partToolbarRenderer=()=>t.renderToolbar(),n.requestUpdate())}updateContextMenuFromComponent(r){const e=r.querySelector(".tab-content");if(!e||!e.firstElementChild)return;const t=e.firstElementChild;if(!(t instanceof jt)||!t.renderContextMenu)return;const n=r.querySelector("k-contextmenu");n&&(n.partContextMenuRenderer=()=>t.renderContextMenu(),n.requestUpdate())}updateToolbarHeightVariable(r){const e=r.querySelector(".tab-toolbar");if(!e)return;const t=e.offsetHeight;r.style.setProperty("--toolbar-height",`${t}px`)}setupToolbarResizeObserver(r){if(this.resizeObservers.has(r))return;const e=r.querySelector(".tab-toolbar");if(!e)return;const t=new ResizeObserver(()=>{this.updateToolbarHeightVariable(r)});t.observe(e),this.resizeObservers.set(r,t)}render(){const r=Zr.getCurrentApp();return G`
            <wa-tab-group ${br(this.tabGroup)}>
                ${Ut(this.contributions.length===0,()=>G`
                        <div class="empty-state">
                            ${Ut(r,()=>G`
                                    <div class="empty-content">
                                        <h2 class="empty-title">${r.name}</h2>
                                        ${Ut(r.description,()=>G`<p class="empty-description">${r.description}</p>`)}
                                    </div>
                                `,()=>G`
                                    <wa-icon name="folder-open" class="empty-icon"></wa-icon>
                                `)}
                        </div>
                    `,()=>Fc(this.contributions,e=>e.name,e=>G`
                            <wa-tab panel="${e.name}"
                                    @auxclick="${t=>this.handleTabAuxClick(t,e)}">
                                <k-icon name="${e.icon}"></k-icon>
                                ${e.label}
                                ${Ut(e.closable,()=>G`
                                    <wa-icon name="xmark" label="Close"  @click="${t=>this.closeTab(t,e.name)}"></wa-icon>
                                `)}
                            </wa-tab>
                            <wa-tab-panel name="${e.name}">
                                <k-toolbar id="toolbar:${e.editorId??e.name}" 
                                           class="tab-toolbar"
                                           ?is-editor="${this.containerId===Br}"></k-toolbar>
                                <wa-scroller class="tab-content" orientation="vertical">
                                    ${e.component?e.component(e.name):kt}
                                </wa-scroller>
                                <k-contextmenu id="contextmenu:${e.name}"
                                               ?is-editor="${this.containerId===Br}"></k-contextmenu>
                            </wa-tab-panel>
                        `))}
            </wa-tab-group>
        `}};fi.styles=Yt`
        :host {
            height: 100%;
            width: 100%;
        }

        wa-tab-group {
            height: 100%;
            width: 100%;
        }

        wa-tab-group::part(base) {
            display: grid;
            grid-template-rows: auto minmax(0, 1fr);
            height: 100%;
            width: 100%;
        }

        wa-tab-panel[active] {
            display: grid;
            grid-template-rows: minmax(0, 1fr);
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .tab-content {
            position: absolute;
            top: calc(var(--toolbar-height, 0px));
            right: 0;
            left: 0;
            height: calc(100% - var(--toolbar-height, 0px));
        }

        wa-tab::part(base) {
            padding: 3px 0.5rem;
        }

        wa-tab-panel {
            --padding: 0px;
        }

        .part-dirty::part(base) {
            font-style: italic;
            color: var(--wa-color-danger-fill-loud)
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            grid-row: 2;
        }

        .empty-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            gap: 0.75rem;
            opacity: 0.3;
        }

        .empty-title {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--wa-color-text-quiet);
        }

        .empty-description {
            margin: 0;
            font-size: 1rem;
            color: var(--wa-color-text-quiet);
            max-width: 500px;
        }

        .empty-icon {
            font-size: 6rem;
            opacity: 0.2;
            color: var(--wa-color-text-quiet);
        }
    `;Ka([At()],fi.prototype,"contributions",2);fi=Ka([Et("k-tabs")],fi);var ru=Object.defineProperty,nu=Object.getOwnPropertyDescriptor,Vn=(r,e,t,n)=>{for(var i=n>1?void 0:n?nu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&ru(e,t,i),i};let pn=class extends Jr{constructor(){super(...arguments),this.orientation="horizontal",this.gridSizes=[],this.gridChildren=[],this.resizing=null,this.resizeOverlay=null,this.childrenLoaded=!1,this.childStylesApplied=!1,this.settingsLoaded=!1,this.handleResize=r=>{if(!this.resizing)return;const t=(this.orientation==="horizontal"?r.clientX:r.clientY)-this.resizing.startPos,n=[...this.resizing.startSizes];n[this.resizing.handleIndex]+=t,n[this.resizing.handleIndex+1]-=t;const i=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,o=i*.05;if(n[this.resizing.handleIndex]>=o&&n[this.resizing.handleIndex+1]>=o){this.resizing.currentSizes=n;const a=n.map((c,f)=>{const R=`${(c/i*100).toFixed(2)}%`;return f===n.length-1?R:`${R} 4px`}).join(" ");this.orientation==="horizontal"?this.style.gridTemplateColumns=a:this.style.gridTemplateRows=a}},this.stopResize=async()=>{if(this.resizing?.currentSizes){const r=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight;this.gridSizes=this.resizing.currentSizes.map(e=>`${(e/r*100).toFixed(2)}%`),await this.saveSizes(),this.requestUpdate()}this.resizeOverlay&&(document.body.removeChild(this.resizeOverlay),this.resizeOverlay=null),this.resizing=null,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.body.style.cursor="",document.body.style.userSelect=""}}createRenderRoot(){return this}doBeforeUI(){this.childrenLoaded||(this.mutationObserver=new MutationObserver(()=>{this.childrenLoaded||this.loadChildren()}),this.mutationObserver.observe(this,{childList:!0,subtree:!1}),this.loadChildren())}async loadChildren(){const r=Array.from(this.children).filter(e=>e.tagName!=="STYLE"&&e.tagName!=="SCRIPT"&&!e.classList.contains("resize-handle"));if(r.length!==0){if(this.childrenLoaded=!0,this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.gridChildren=r,!this.settingsLoaded){this.settingsLoaded=!0;const e=await this.getDialogSetting();if(e&&Array.isArray(e.sizes)&&e.sizes.length===this.gridChildren.length){this.gridSizes=e.sizes,this.requestUpdate();return}}if(this.sizes)this.gridSizes=this.sizes.split(",").map(e=>e.trim());else{const e=`${100/this.gridChildren.length}%`;this.gridSizes=this.gridChildren.map(()=>e)}this.requestUpdate()}}async saveSizes(){this.gridSizes.length!==0&&await this.setDialogSetting({sizes:this.gridSizes,orientation:this.orientation})}updated(r){super.updated(r),r.has("gridChildren")&&!this.childStylesApplied&&this.gridChildren.length>0&&(this.childStylesApplied=!0,this.gridChildren.forEach((e,t)=>{e.style.overflow="hidden",e.style.height="100%",e.style.width="100%",e.style.gridColumn=this.orientation==="horizontal"?`${t*2+1}`:"1",e.style.gridRow=this.orientation==="vertical"?`${t*2+1}`:"1",e.style.display="flex",e.style.flexDirection="column"}))}startResize(r,e){if(r.preventDefault(),e>=this.gridChildren.length-1)return;const t=this.orientation==="horizontal"?r.clientX:r.clientY,n=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,i=this.gridSizes.map(o=>o.endsWith("%")?parseFloat(o)/100*n:(o.endsWith("px"),parseFloat(o)));this.resizing={handleIndex:e,startPos:t,startSizes:i},this.resizeOverlay=document.createElement("div"),this.resizeOverlay.style.position="fixed",this.resizeOverlay.style.top="0",this.resizeOverlay.style.left="0",this.resizeOverlay.style.width="100%",this.resizeOverlay.style.height="100%",this.resizeOverlay.style.zIndex="9999",this.resizeOverlay.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.appendChild(this.resizeOverlay),document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"}render(){if(this.gridChildren.length===0||this.gridSizes.length===0)return kt;const r=this.gridSizes.flatMap((e,t)=>t===this.gridSizes.length-1?[e]:[e,"4px"]).join(" ");return this.style.display="grid",this.orientation==="horizontal"?(this.style.gridTemplateColumns=r,this.style.gridTemplateRows="100%"):(this.style.gridTemplateColumns="100%",this.style.gridTemplateRows=r),this.style.overflow="hidden",G`
            <style>
                .resize-handle {
                    position: relative;
                    z-index: 10;
                    background-color: var(--wa-color-neutral-border-quiet);
                    transition: background-color var(--wa-transition-fast);
                }
                
                .resize-handle:hover {
                    background-color: var(--wa-color-brand-fill-normal);
                }
            </style>
            
            ${this.gridChildren.map((e,t)=>{if(t<this.gridChildren.length-1){const n=this.orientation==="horizontal"?`${t*2+2}`:"1",i=this.orientation==="vertical"?`${t*2+2}`:"1";return G`
                        <div 
                            class="resize-handle"
                            style="
                                cursor: ${this.orientation==="horizontal"?"col-resize":"row-resize"};
                                grid-column: ${n};
                                grid-row: ${i};
                            "
                            @mousedown=${o=>this.startResize(o,t)}
                        ></div>
                    `}return kt})}
        `}disconnectedCallback(){super.disconnectedCallback(),this.resizing&&this.stopResize(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}connectedCallback(){super.connectedCallback(),this.style.height="100%",this.style.width="100%"}};Vn([Be()],pn.prototype,"orientation",2);Vn([Be()],pn.prototype,"sizes",2);Vn([At()],pn.prototype,"gridSizes",2);Vn([At()],pn.prototype,"gridChildren",2);pn=Vn([Et("k-resizable-grid")],pn);const vr="events/filesys/workspaceChanged",Fn="events/filesys/workspaceConnected";class mi{constructor(){this.state={}}getWorkspacePath(){const e=[];let t=this;for(;t;)e.push(t.getName()),t=t.getParent();return e.reverse(),e.shift(),e.join("/")}getWorkspace(){let e=this;for(;e;){const t=e.getParent();if(t)e=t;else break}return e}}var Ya=(r=>(r[r.TEXT=0]="TEXT",r[r.BINARY=1]="BINARY",r))(Ya||{});class sr extends mi{}class on extends mi{}class iu extends sr{constructor(e,t){super(),this.contents=e,this.name=t}async getContents(e){return this.contents}async saveContents(e,t){this.contents=e}async size(){return this.contents.length||null}async copyTo(e){throw Error("Not supported")}delete(e,t){throw Error("Not supported")}async rename(e){throw Error("Not supported")}getName(){return this.name}getParent(){}}class Hs extends sr{constructor(e,t){super(),this.fileHandle=e,this.parent=t}getName(){return this.fileHandle.name}getParent(){return this.parent}async delete(){return this.getParent().delete(this.getName())}async getContents(e){const t=await this.fileHandle.getFile();return!e||e?.contentType==0?await t.text():e?.encoding==0||e?.uri?URL.createObjectURL(t):e?.blob?t:t.stream()}async size(){try{return(await this.fileHandle.getFile()).size}catch{return null}}async saveContents(e,t){const n=await this.fileHandle.createWritable();if(e&&typeof e.pipeTo=="function")await e.pipeTo(n);else{const i=n.getWriter();try{await i.write(e)}finally{await i.close()}}}async copyTo(e){const t=await this.getContents({blob:!0});await(await this.getWorkspace().getResource(e,{create:!0})).saveContents(t)}async rename(e){const t=this.getParent();if(!t)throw new Error("Cannot rename root resource");if(this.getName()!==e){if(!("move"in this.fileHandle)||typeof this.fileHandle.move!="function")throw new Error("File rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.fileHandle.move(e)}catch(n){throw n.name==="NotAllowedError"||n.message?.includes("not allowed")||n.message?.includes("user agent")?new Error("File rename failed: The operation took too long and user activation expired. Please try again."):n}await t.listChildren(!0),Xe(vr,this.getWorkspace())}}}class Cr extends on{constructor(e,t){super(),this.dirHandle=e,this.parent=t}getHandle(){return this.dirHandle}getParent(){return this.parent}getName(){return this.dirHandle.name}async listChildren(e=!1){return e||!this.files?this.loadingPromise?this.loadingPromise:(this.loadingPromise=(async()=>{try{const t={};try{for await(const n of this.dirHandle.values()){const o=n.kind==="file"?new Hs(n,this):new Cr(n,this);t[o.getName()]=o}}catch(n){if(n.name==="NotFoundError")return this.files={},[];throw n}return this.files=t,Object.values(this.files)}finally{this.loadingPromise=void 0}})(),this.loadingPromise):Object.values(this.files)}async getResource(e,t){if(!e)throw new Error("No path provided");const n=e.split("/");let i=this,o=!1;try{for(let a=0;a<n.length;a++){let c=n[a];if(c&&(c=c.trim()),!c)break;if(i instanceof Cr){if(await i.listChildren(),!i.files)return null;const f=i.files[c];if(f)i=f;else if(t?.create)if(o=!0,a<n.length-1)try{const y=await i.dirHandle.getDirectoryHandle(c,{create:!0}),R=new Cr(y,i);i.files[c]=R,i=R,i instanceof Cr&&await i.listChildren();continue}catch(y){throw y.name==="NotFoundError"?new Error(`Directory not found or not accessible: ${n.slice(0,a+1).join("/")}`):y}else try{const y=await i.dirHandle.getFileHandle(c,{create:!0}),R=new Hs(y,i);return i.files[c]=R,R}catch(y){throw y.name==="NotFoundError"?new Error(`File not found or not accessible: ${n.join("/")}`):y}else return null}}}finally{o&&Xe(vr,this.getWorkspace())}return i}touch(){Xe(vr,this.getWorkspace())}async delete(e,t=!0){if(!e){const n=this.getParent();return n instanceof Cr&&(await n.listChildren(),n.files&&delete n.files[this.getName()]),this.files=void 0,this.loadingPromise=void 0,n?.delete(this.getName())}return this.dirHandle.removeEntry(e,{recursive:t}).then(async()=>{this.files&&delete this.files[e],Xe(vr,this.getWorkspace())})}async copyTo(e){for(const t of await this.listChildren()){const n=[e,t.getName()].join("/");await t.copyTo(n)}}async rename(e){const t=this.getParent();if(!t)throw new Error("Cannot rename workspace root");if(this.getName()!==e){if(!("move"in this.dirHandle)||typeof this.dirHandle.move!="function")throw new Error("Directory rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.dirHandle.move(e)}catch(n){throw n.name==="NotAllowedError"||n.message?.includes("not allowed")||n.message?.includes("user agent")?new Error("Directory rename failed: The operation took too long and user activation expired. Please try again."):n}await t.listChildren(!0),Xe(vr,this.getWorkspace())}}}class su{constructor(){this.contributions=new Map,this.workspace=this.loadPersistedWorkspace(),this.workspace.then(e=>{e&&Xe(Fn,e)})}registerContribution(e){this.contributions.set(e.type,e),console.log(`Workspace contribution registered: ${e.name} (${e.type})`)}getContributions(){return Array.from(this.contributions.values())}async loadPersistedWorkspace(){const e=await ir.getObject("workspace_data");if(!e)return;const t=this.contributions.get(e.type);if(!t){console.warn(`No contribution found for workspace type: ${e.type}`);return}try{if(t.restore){const n=await t.restore(e.data);return n&&(this.currentType=e.type),n}}catch(n){console.error(`Failed to restore workspace of type ${e.type}:`,n)}}async connectWorkspace(e){const t=Array.from(this.contributions.values()).find(a=>a.canHandle(e));if(!t)throw new Error("No workspace contribution can handle this input");const n=await t.connect(e),i=t.persist?await t.persist(n):e,o={type:t.type,data:i};return await ir.persistObject("workspace_data",o),this.currentType=t.type,this.workspace=Promise.resolve(n),Xe(Fn,n),n}async getWorkspace(){if(!this.workspace)throw new Error("No workspace connected.");return await this.workspace}isConnected(){return!!this.workspace}getWorkspaceType(){return this.currentType}async disconnectWorkspace(){this.workspace=void 0,this.currentType=void 0,await ir.persistObject("workspace_data",null),await ir.persistObject("workspace",null)}}const Dt=new su;Bt.put("workspaceService",Dt);Dt.registerContribution({type:"filesystem",name:"Local File System",canHandle(r){return r&&"kind"in r&&r.kind==="directory"},async connect(r){return new Cr(r)},async restore(r){if(r&&"kind"in r&&r.kind==="directory")return new Cr(r,void 0)},async persist(r){return r instanceof Cr?r.getHandle():null}});const Ks=(r,e)=>!r.leaf&&e.leaf?-1:r.leaf&&!e.leaf?1:r.label.localeCompare(e.label);class au{constructor(){this.editorInputHandlers=[],this.listenersAttached=!1,this.cachedIconContributions=null,Kt(Fn,()=>{}),Kt(Lr,e=>{e.target==="system.icons"&&(this.cachedIconContributions=null)})}getSortedIconContributions(){if(this.cachedIconContributions!==null)return this.cachedIconContributions;const e=Me.getContributions("system.icons");return this.cachedIconContributions=[...e].sort((t,n)=>{const i=t.priority??0,o=n.priority??0;return o!==i?o-i:t.label.localeCompare(n.label)}),this.cachedIconContributions}setupEventListeners(e){if(this.listenersAttached)return;this.listenersAttached=!0;const t=o=>{const a=o.detail;a&&Array.from(a.querySelectorAll("*")).filter(f=>f instanceof jt).forEach(f=>{it.set(f),f.isEditor&&an.set(f)})};e.addEventListener("tab-shown",t);const n=o=>{const a=o.detail;Array.from(a.querySelectorAll("*")).filter(f=>f instanceof jt).forEach(f=>{it.get()==f&&it.set(null),an.get()==f&&an.set(null)})};e.addEventListener("tab-closed",n);const i=o=>{const c=o.closest("wa-tab-panel").getAttribute("name");e.markDirty(c,o.isDirty())};this.signalCleanup=Ua(Gi,i)}registerEditorInputHandler(e){this.editorInputHandlers.push(e),this.editorInputHandlers.sort((t,n)=>(n.ranking??0)-(t.ranking??0))}async handleInput(e){for(let t=0;t<this.editorInputHandlers.length;t++){const n=this.editorInputHandlers[t];if(n.canHandle(e))return await n.handle(e)}}getEditorArea(){return document.querySelector(`k-tabs#${Br}`)}async loadEditor(e){if(!e||("widgetFactory"in e||(e=await this.handleInput(e)),!e||!("widgetFactory"in e)))return;const t=this.getEditorArea();if(!t){console.error("Editor area not found. The split pane system may not be initialized yet.");return}if(this.setupEventListeners(t),t.has(e.key)){t.activate(e.key);return}t.open({name:e.key,editorId:e.editorId,label:e.title,icon:e.icon,closable:!0,noOverflow:e.noOverflow,component:e.widgetFactory})}getFileIcon(e){const t=e.includes(".")?e.split(".").pop()?.toLowerCase()||"":e.toLowerCase(),n=this.getSortedIconContributions();if(n.length===0)return"file";for(const i of n)if(i.mappings&&i.mappings[t])return i.mappings[t];return"file"}}const $r=new au;Bt.put("editorRegistry",$r);Me.registerContribution("system.icons",{label:"Default File Icons",mappings:{pdf:"file-pdf",md:"book",txt:"file-lines",ts:"code",tsx:"code",js:"code",jsx:"code",json:"file-code",geojson:"file-code",py:"python",html:"code",htm:"code",css:"code",scss:"code",sass:"code",xml:"file-code",yaml:"file-code",yml:"file-code",sql:"database",kml:"file-code",gpx:"file-code",jpg:"image",jpeg:"image",png:"image",gif:"image",svg:"image",webp:"image",bmp:"image",ico:"image"},priority:0});var ou=Object.defineProperty,lu=Object.getOwnPropertyDescriptor,Ei=(r,e,t,n)=>{for(var i=n>1?void 0:n?lu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&ou(e,t,i),i};let dn=class extends jt{constructor(){super(...arguments),this.treeRef=yr(),this.loadingNodes=new Set}doBeforeUI(){this.initializeWorkspace(),Kt(Lr,r=>{r.target==="system.icons"&&this.requestUpdate()})}firstUpdated(r){super.firstUpdated(r),this.setupDragAndDrop()}updated(r){super.updated(r),r.has("workspaceDir")&&this.workspaceDir&&this.setupDragAndDrop()}async initializeWorkspace(){const r=await Dt.getWorkspace();r?await this.loadWorkspace(r):je.execute("help")}renderToolbar(){const r=er.get()instanceof mi;return G`
            <k-command icon="folder-open" title="Connect workspace..." dropdown="filebrowser.connections"></k-command>
            <k-command cmd="reload_workspace" icon="repeat" title="Reload workspace folder"></k-command>
            <k-command cmd="create_file" icon="plus" title="Create new..." dropdown="filebrowser.create"></k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!r} title="Rename selected resource (F2)"></k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!r} title="Delete selected resource"></k-command>
        `}renderContextMenu(){const r=er.get()instanceof mi;return G`
            <k-command cmd="open_editor" icon="folder-open">Open</k-command>
            <k-command cmd="create_file" icon="plus" dropdown="filebrowser.create">Create new...</k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!r}>Rename</k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!r}>Delete</k-command>
        `}async onWorkspaceChanged(r){er.set(void 0),await this.loadWorkspace(r),await this.syncTreeSelection()}async onWorkspaceConnected(r){await this.loadWorkspace(r)}async loadWorkspace(r){this.workspaceDir=r,r?this.root=await this.resourceToTreeNode(r,!0):this.root=void 0}async syncTreeSelection(){await this.updateComplete;const e=this.treeRef.value?.querySelector("wa-tree")?.selectedItems||[];e.length>0&&er.set(e[0].model?.data)}async resourceToTreeNode(r,e=!1){const t=r instanceof sr,n={data:r,label:r.getName(),leaf:t,children:[]};if(r instanceof on&&e){for(const i of await r.listChildren(!1)){const o=await this.resourceToTreeNode(i,!1);n.children.push(o)}n.children.sort(Ks)}return n}createTreeItems(r,e=!1){if(!r)return G``;const t=!r.leaf&&r.children.length===0,n=r.data,i=n instanceof sr,o=i?$r.getFileIcon(n.getName()):r.icon||"folder-open";return G`
            <wa-tree-item 
                draggable=${i}
                @dragstart=${i?this.nobubble(a=>this.onDragStart(a,n)):void 0}
                @dblclick=${this.nobubble(this.onFileDoubleClicked)}
                @wa-lazy-load=${this.nobubble(a=>this.onLazyLoad(a,r))}
                .model=${r} 
                ?expanded=${e}
                ?lazy=${t}>
                <span><wa-icon name=${o} label="${r.leaf?"File":"Folder"}"></wa-icon> ${r.label}</span>
                ${r.children.map(a=>this.createTreeItems(a,!1))}
            </wa-tree-item>`}onDragStart(r,e){if(!r.dataTransfer)return;const t=e.getWorkspacePath(),n=e.getName();if(r.dataTransfer.effectAllowed="copy",r.dataTransfer.setData("text/plain",t),r.dataTransfer.setData("application/x-workspace-file",t),r.dataTransfer.setData("text/uri-list",t),r.dataTransfer.setDragImage){const i=document.createElement("div");i.textContent=n,i.style.position="absolute",i.style.top="-1000px",i.style.padding="4px 8px",i.style.background="var(--wa-color-neutral-10)",i.style.border="1px solid var(--wa-color-neutral-30)",i.style.borderRadius="4px",document.body.appendChild(i),r.dataTransfer.setDragImage(i,0,0),setTimeout(()=>document.body.removeChild(i),0)}}async onLazyLoad(r,e){const t=e.data;t instanceof on&&e.children.length===0&&await this.loadNodeChildren(e,t)}async loadNodeChildren(r,e){if(!this.loadingNodes.has(r)){this.loadingNodes.add(r);try{for(const t of await e.listChildren(!1)){Kc&&t.getName().startsWith(".");const n=await this.resourceToTreeNode(t,!1);r.children.push(n)}r.children.sort(Ks),this.requestUpdate()}catch(t){console.error("Failed to load directory children:",t)}finally{this.loadingNodes.delete(r)}}}async onFileDoubleClicked(r){const t=r.currentTarget.model.data.getWorkspacePath();this.executeCommand("open_editor",{path:t})}onSelectionChanged(r){const e=r.detail.selection;if(e&&e.length>0){const t=e[0].model;er.set(t.data)}else er.set(void 0)}setupDragAndDrop(){const r=this.treeRef.value;if(!r)return;const e=o=>{if(!o.dataTransfer?.types.includes("Files"))return;o.preventDefault(),o.dataTransfer.dropEffect="copy",r.classList.add("drag-over");const c=o.target.closest("wa-tree-item");c&&c!==this.currentDropTarget&&(this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=c,c.classList.add("drop-target"))},t=o=>{o.dataTransfer?.types.includes("Files")&&(o.preventDefault(),r.classList.add("drag-over"))},n=o=>{const a=r.getBoundingClientRect(),c=o.clientX,f=o.clientY;(c<=a.left||c>=a.right||f<=a.top||f>=a.bottom)&&(r.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0)},i=async o=>{if(o.preventDefault(),r.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0,!o.dataTransfer||!this.workspaceDir)return;const a=Array.from(o.dataTransfer.files);if(a.length===0)return;const c=await this.getDropTarget(o);await this.handleFilesDrop(a,c)};r.removeEventListener("dragover",e),r.removeEventListener("dragenter",t),r.removeEventListener("dragleave",n),r.removeEventListener("drop",i),r.addEventListener("dragover",e),r.addEventListener("dragenter",t),r.addEventListener("dragleave",n),r.addEventListener("drop",i)}async getDropTarget(r){const t=r.target.closest("wa-tree-item");if(t){const i=t.model.data;if(i instanceof on)return i;const o=i.getParent();if(o)return o}return this.workspaceDir}async handleFilesDrop(r,e){const t=r.length;let n=0,i=0,o=0;for(const a of r)try{const c=this.buildTargetPath(e,a.name);if(await this.workspaceDir.getResource(c)&&!await fn(`File "${a.name}" already exists. Do you want to overwrite it?`)){o++;continue}await(await this.workspaceDir.getResource(c,{create:!0})).saveContents(a),n++}catch(c){console.error(`Failed to upload ${a.name}:`,c),i++}console.log(`Uploaded ${n}/${t} files${o>0?`, ${o} skipped`:""}${i>0?`, ${i} failed`:""}`),await this.loadWorkspace(this.workspaceDir)}buildTargetPath(r,e){const t=r.getWorkspacePath();return t?`${t}/${e}`:e}render(){return G`
            <div class="tree" ${br(this.treeRef)}>
                ${Ut(!this.workspaceDir,()=>G`
                    <k-no-content message="Select a workspace."></k-no-content>`,()=>G`
                `)}
                <wa-tree @wa-selection-change=${this.nobubble(this.onSelectionChanged)}
                         style="--indent-guide-width: 1px;">
                    ${this.createTreeItems(this.root,!0)}
                </wa-tree>
            </div>
        `}};dn.styles=Yt`
        :host {
        }
        
        .tree {
            height: 100%;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .tree.drag-over {
            background-color: var(--wa-color-brand-fill-quiet);
            outline: 2px dashed var(--wa-color-brand-border-normal);
            outline-offset: -4px;
            border-radius: var(--wa-border-radius-medium);
        }
        
        .tree.drag-over::before {
            content: '📁 Drop files here';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            padding: var(--wa-spacing-large);
            border-radius: var(--wa-border-radius-large);
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }
        
        wa-tree-item.drop-target {
            background-color: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            border-radius: var(--wa-border-radius-small);
            outline: 2px solid var(--wa-color-brand-border-loud);
            outline-offset: -2px;
        }
    `;Ei([At()],dn.prototype,"root",2);Ei([Ia(vr)],dn.prototype,"onWorkspaceChanged",1);Ei([Ia(Fn)],dn.prototype,"onWorkspaceConnected",1);dn=Ei([Et("k-filebrowser")],dn);var cu=Object.getOwnPropertyDescriptor,uu=(r,e,t,n)=>{for(var i=n>1?void 0:n?cu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=a(i)||i);return i};Me.registerContribution(ys,{html:"<k-tasks></k-tasks>"});let Xi=class extends jt{doBeforeUI(){this.watch(Vi,()=>{this.requestUpdate()})}render(){Vi.get();const r=hi.getActiveTasks().length;if(r!=0)return G`
            <wa-dropdown>
                <wa-button slot="trigger" appearance="plain" size="small" title="Active tasks: ${r}">
                    <wa-animation name="zoomIn" duration="1000" play>
                        <wa-icon name="hourglass" label="Active tasks" style="color: var(--wa-color-warning-fill-loud)"></wa-icon>
                    </wa-animation>
                    Active tasks: ${r}
                </wa-button>
                ${hi.getActiveTasks().map(e=>{const t=e.progress>=0||e.totalSteps>0,n=e.progress>=0?e.progress:e.totalSteps>0?Math.round(e.currentStep/e.totalSteps*100):0,i=e.progress<0&&e.totalSteps>0;return G`
                        <wa-dropdown-item style="display: block; padding: 0.5rem 1rem;">
                            <div style="margin-bottom: 0.25rem;">
                                <strong>${e.name}</strong>: ${e.message}
                            </div>
                            ${t?G`
                                <wa-progress-bar value="${n}" style="--track-height: 1.25rem;">
                                    ${i?`${e.currentStep}/${e.totalSteps} - `:""}${n}%
                                </wa-progress-bar>
                            `:G`
                                <wa-progress-bar indeterminate style="--track-height: 1.25rem;"></wa-progress-bar>
                            `}
                        </wa-dropdown-item>
                    `})}
            </wa-dropdown>
        `}};Xi.styles=Yt`
        wa-progress-bar::part(label) {
            text-align: center;
            width: 100%;
        }
    `;Xi=uu([Et("k-tasks")],Xi);var pu=Object.getOwnPropertyDescriptor,du=(r,e,t,n)=>{for(var i=n>1?void 0:n?pu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=a(i)||i);return i};const Ys="<no workspace>";let Js=class extends Jr{constructor(){super(...arguments),this.workspaceName=Ys}doInitUI(){this.updateWorkspaceName(),Kt(Fn,()=>{this.updateWorkspaceName()})}updateWorkspaceName(){Dt.getWorkspace().then(r=>{this.workspaceName=r?.getName()||Ys,this.requestUpdate()})}handleLoadWorkspace(){je.execute("load_workspace",{source:this})}render(){return G`
            <wa-button 
                appearance="plain"
                size="small"
                title="Load workspace"
                @click=${this.handleLoadWorkspace}>
                <wa-icon name="folder-open" slot="start" label="Workspace"></wa-icon>
                ${this.workspaceName}
            </wa-button>
        `}};Js=du([Et("k-workspace-name")],Js);var hu=Object.getOwnPropertyDescriptor,fu=(r,e,t,n)=>{for(var i=n>1?void 0:n?hu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=a(i)||i);return i};const Zs="<no part>";Me.registerContribution(ys,{html:"<k-part-name></k-part-name>"});let Xs=class extends Jr{doBeforeUI(){this.watch(it,()=>{this.requestUpdate()})}getPartName(){const r=it.get();return r&&(r.tabContribution?.label||r.getAttribute("id"))||Zs}render(){const e=it.get()?.tabContribution?.icon||"box";return G`
            <wa-button 
                appearance="plain"
                size="small"
                title="Active part">
                <k-icon slot="start" name="${e}" label="Part"></k-icon>
                ${this.getPartName()}
            </wa-button>
        `}};Xs=fu([Et("k-part-name")],Xs);var mu=Object.defineProperty,gu=Object.getOwnPropertyDescriptor,ws=(r,e,t,n)=>{for(var i=n>1?void 0:n?gu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&mu(e,t,i),i};let qn=class extends jt{constructor(){super(...arguments),this.filterText=""}doInitUI(){Kt(Rn,()=>{this.requestUpdate()})}onExtensionDblClick(){}enable(r){Ue.enable(r.id,!0),this.requestUpdate()}disable(r){Ue.disable(r.id,!0),this.requestUpdate()}isExtensionRequired(r){const e=Zr.getCurrentApp();return!e||!e.extensions?!1:e.extensions.includes(r)}selectionChanged(r){const e=r.detail.selection||[];e.length>0&&e[0].model?this.selectedExtension=e[0].model:this.selectedExtension=void 0}getFilteredExtensions(){if(!this.filterText.trim())return Ue.getExtensions();const r=this.filterText.toLowerCase();return Ue.getExtensions().filter(e=>e.name.toLowerCase().includes(r)||(e.description?.toLowerCase().includes(r)??!1)||e.id.toLowerCase().includes(r))}getGroupedExtensions(){const r=this.getFilteredExtensions(),e=[],t=[];return r.forEach(n=>{Ue.isEnabled(n.id)?e.push(n):t.push(n)}),e.sort((n,i)=>n.name.localeCompare(i.name)),t.sort((n,i)=>n.name.localeCompare(i.name)),{enabled:e,available:t}}isExternalExtension(r){return r.external===!0}handleFilterInput(r){this.filterText=r.target.value,this.requestUpdate()}clearFilter(){this.filterText="",this.requestUpdate()}renderToolbar(){return G`
            <wa-input
                placeholder="Filter extensions..."
                .value=${this.filterText}
                @input=${r=>this.handleFilterInput(r)}
                @wa-clear=${()=>this.clearFilter()}
                with-clear
                size="small"
                style="width: 300px;">
                <wa-icon slot="start" name="magnifying-glass" label="Filter"></wa-icon>
            </wa-input>
        `}render(){const r=this.getGroupedExtensions(),e=r.enabled.length>0||r.available.length>0;return G`
            <wa-split-panel position="30" style="height: 100%">
                <wa-tree 
                    selection="leaf"
                    style="--indent-guide-width: 1px;" 
                    slot="start"
                    @wa-selection-change="${this.selectionChanged}">
                    ${e?G`
                        ${r.enabled.length>0?G`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="check-circle" style="color: var(--wa-color-success-50);"></wa-icon>
                                    Installed (${r.enabled.length})
                                </span>
                                ${r.enabled.map(t=>{const n=this.isExternalExtension(t);return G`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${t}>
                                            <span><k-icon name="${t.icon}"></k-icon></span> ${t.name}${n?G` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                        ${r.available.length>0?G`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="circle" style="color: var(--wa-color-neutral-50);"></wa-icon>
                                    Available (${r.available.length})
                                </span>
                                ${r.available.map(t=>{const n=this.isExternalExtension(t);return G`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${t}>
                                            <span><k-icon name="${t.icon}"></k-icon></span> ${t.name}${n?G` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                    `:""}
                    ${e?"":G`
                        <div style="padding: 1em; text-align: center; opacity: 0.7;">
                            No extensions match "${this.filterText}"
                        </div>
                    `}
                </wa-tree>
                <div slot="end" style="padding: 1em;">
                    ${Ut(this.selectedExtension,t=>{const n=this.isExternalExtension(t),i=Ue.isEnabled(t.id);return G`
                                <h1><k-icon name="${t.icon}"></k-icon> ${t.name}${n?" (External)":""}</h1>
                                ${Ut(n,()=>G`
                                    <div class="marketplace-badge">
                                        <wa-icon name="store"></wa-icon>
                                        <span>External Extension</span>
                                    </div>
                                `)}
                                <hr>
                                <div>
                                    ${Ut(i,()=>G`
                                        <wa-button 
                                            title="${this.isExtensionRequired(t.id)?"This extension is required by the current app and cannot be uninstalled":"Disable this extension"}" 
                                            @click="${()=>this.disable(t)}"
                                            variant="danger" 
                                            appearance="plain"
                                            ?disabled=${this.isExtensionRequired(t.id)}>
                                            <wa-icon name="xmark" label="Uninstall"></wa-icon>&nbsp;Uninstall (requires restart)
                                        </wa-button>
                                        ${Ut(this.isExtensionRequired(t.id),()=>G`
                                            <div class="required-hint">
                                                <wa-icon name="info-circle" style="color: var(--wa-color-primary-50);"></wa-icon>
                                                <span>This extension is required by the current app and cannot be uninstalled</span>
                                            </div>
                                        `)}
                                    `,()=>G`
                                        <wa-button 
                                            title="Enable this extension" 
                                            @click="${()=>this.enable(t)}"
                                            variant="brand" 
                                            appearance="plain">
                                            <wa-icon name="download" label="Install"></wa-icon>&nbsp;Install
                                        </wa-button>
                                    `)}
                                </div>

                                ${Ut(t.experimental,()=>G`
                                    <div style="margin-top: 1em;">
                                        <wa-button size="small" variant="warning" appearance="plain">
                                            <wa-icon name="triangle-exclamation" label="Warning"></wa-icon>
                                        </wa-button>
                                        <small><i>This is an experimental extension!</i></small>
                                    </div>
                                `)}

                                ${Ut(t.version||t.author,()=>G`
                                    <div style="margin-top: 1em; display: flex; flex-direction: column; gap: 0.5rem;">
                                        ${Ut(t.version,()=>G`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="tag" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">Version: <strong>${t.version}</strong></span>
                                            </div>
                                        `)}
                                        ${Ut(t.author,()=>G`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="user" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">Author: <strong>${t.author}</strong></span>
                                            </div>
                                        `)}
                                    </div>
                                `)}

                                <p style="margin-top: 1em;">${t.description}</p>

                                ${Ut(t.dependencies&&t.dependencies.length>0,()=>G`
                                    <div style="margin-top: 1.5em;">
                                        <h3 style="margin-bottom: 0.5em;">
                                            <wa-icon name="puzzle-piece" style="font-size: 0.9em;"></wa-icon>
                                            Dependencies
                                        </h3>
                                        <div class="dependencies-list">
                                            ${t.dependencies.map(o=>{const a=Ue.getExtensions().find(f=>f.id===o),c=Ue.isEnabled(o);return G`
                                                    <div class="dependency-item">
                                                        <wa-icon 
                                                            name="${c?"check-circle":"circle"}" 
                                                            style="color: ${c?"var(--wa-color-success-50)":"var(--wa-color-neutral-50)"};">
                                                        </wa-icon>
                                                        <k-icon name="${a?.icon||"puzzle-piece"}"></k-icon>
                                                        <span>${a?.name||o}</span>
                                                        ${c?"":G`
                                                            <span class="dependency-badge">Not Installed</span>
                                                        `}
                                                    </div>
                                                `})}
                                        </div>
                                        <small style="opacity: 0.7; display: block; margin-top: 0.5em;">
                                            <wa-icon name="info-circle" style="font-size: 0.9em;"></wa-icon>
                                            Dependencies are automatically installed when this extension is enabled.
                                        </small>
                                    </div>
                                `)}
                            `})}
                </div>
            </wa-split-panel>
        `}};qn.styles=Yt`
        :host {
        }

        wa-tree-item > span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        wa-tree-item:has(> wa-tree-item) {
            font-weight: 500;
        }

        .dependencies-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .dependency-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-surface-variant);
        }

        .dependency-item wa-icon:first-child {
            flex-shrink: 0;
        }

        .dependency-item k-icon {
            flex-shrink: 0;
        }

        .dependency-item span:not(.dependency-badge) {
            flex: 1;
        }

        .dependency-badge {
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-warning-100);
            color: var(--wa-color-warning-900);
        }

        .required-hint {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
        }

        .required-hint wa-icon {
            flex-shrink: 0;
        }

        .required-hint span {
            line-height: 1.4;
        }

        .marketplace-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.875rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--wa-color-primary-30);
        }
    `;ws([At()],qn.prototype,"selectedExtension",2);ws([At()],qn.prototype,"filterText",2);qn=ws([Et("k-extensions")],qn);var vu=Object.defineProperty,yu=Object.getOwnPropertyDescriptor,Ai=(r,e,t,n)=>{for(var i=n>1?void 0:n?yu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&vu(e,t,i),i};let hn=class extends jt{constructor(){super(...arguments),this.messages=[],this.autoScroll=!0,this.filter="all",this.containerRef=yr()}connectedCallback(){super.connectedCallback(),this.loadSettings(),ul(this.log.bind(this))}disconnectedCallback(){super.disconnectedCallback(),pl()}log(r,e,t="info"){const n={timestamp:new Date,level:t,source:r,message:e};this.messages=[...this.messages,n],this.updateToolbar(),this.autoScroll&&this.updateComplete.then(()=>{const i=this.containerRef.value;i&&(i.scrollTop=i.scrollHeight)})}clear(){this.messages=[],this.updateToolbar()}getFilteredMessages(){return this.filter==="all"?this.messages:this.messages.filter(r=>r.level===this.filter)}formatTimestamp(r){return r.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}getLevelIcon(r){switch(r){case"info":return"circle-info";case"warning":return"triangle-exclamation";case"error":return"circle-xmark";case"debug":return"bug"}}getLevelColor(r){switch(r){case"info":return"var(--wa-color-primary-text, #0066cc)";case"warning":return"var(--wa-color-warning-text, #ff9800)";case"error":return"var(--wa-color-danger-text, #dc3545)";case"debug":return"var(--wa-color-neutral-text-subtle, #6c757d)"}}renderToolbar(){const r=this.messages.filter(i=>i.level==="info").length,e=this.messages.filter(i=>i.level==="warning").length,t=this.messages.filter(i=>i.level==="error").length,n=this.messages.filter(i=>i.level==="debug").length;return G`
            <k-command 
                icon="list"
                title="All logs"
                appearance="${this.filter==="all"?"filled":"plain"}"
                variant="${this.filter==="all"?"brand":"neutral"}"
                .action=${()=>{this.filter="all",this.saveSettings(),this.updateToolbar()}}>
                All (${this.messages.length})
            </k-command>

            <k-command 
                icon="circle-info"
                title="Info logs"
                appearance="${this.filter==="info"?"filled":"plain"}"
                variant="${this.filter==="info"?"brand":"neutral"}"
                .action=${()=>{this.filter="info",this.saveSettings(),this.updateToolbar()}}>
                Info${r>0?` (${r})`:""}
            </k-command>

            <k-command 
                icon="triangle-exclamation"
                title="Warning logs"
                appearance="${this.filter==="warning"?"filled":"plain"}"
                variant="${this.filter==="warning"?"brand":"neutral"}"
                .action=${()=>{this.filter="warning",this.saveSettings(),this.updateToolbar()}}>
                Warnings${e>0?` (${e})`:""}
            </k-command>

            <k-command 
                icon="circle-xmark"
                title="Error logs"
                appearance="${this.filter==="error"?"filled":"plain"}"
                variant="${this.filter==="error"?"brand":"neutral"}"
                .action=${()=>{this.filter="error",this.saveSettings(),this.updateToolbar()}}>
                Errors${t>0?` (${t})`:""}
            </k-command>

            <k-command 
                icon="bug"
                title="Debug logs"
                appearance="${this.filter==="debug"?"filled":"plain"}"
                variant="${this.filter==="debug"?"brand":"neutral"}"
                .action=${()=>{this.filter="debug",this.saveSettings(),this.updateToolbar()}}>
                Debug${n>0?` (${n})`:""}
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>

            <k-command 
                icon="arrow-down" 
                title="${this.autoScroll?"Auto-scroll enabled":"Auto-scroll disabled"}"
                appearance="${this.autoScroll?"filled":"plain"}"
                variant="${this.autoScroll?"brand":"neutral"}"
                .action=${()=>{this.autoScroll=!this.autoScroll,this.saveSettings(),this.updateToolbar()}}>
                ${this.autoScroll?"Auto-scroll":"Manual"}
            </k-command>

            <k-command 
                icon="trash" 
                title="Clear logs"
                .action=${()=>this.clear()}>
                Clear
            </k-command>
        `}render(){const r=this.getFilteredMessages();return G`
            <div class="log-terminal">
                <div class="messages" ${br(this.containerRef)}>
                    ${r.length===0?G`<div class="empty-state">No log messages</div>`:r.map(e=>G`
                            <div class="message" data-level="${e.level}">
                                <span class="timestamp">${this.formatTimestamp(e.timestamp)}</span>
                                <wa-icon 
                                    name="${this.getLevelIcon(e.level)}" 
                                    label="${e.level}"
                                    style="color: ${this.getLevelColor(e.level)}">
                                </wa-icon>
                                <span class="source">[${e.source}]</span>
                                <span class="text">${e.message}</span>
                            </div>
                        `)}
                </div>
            </div>
        `}async loadSettings(){const r=await this.getDialogSetting();r&&(typeof r.filter=="string"&&(r.filter==="all"||["info","warning","error","debug"].includes(r.filter))&&(this.filter=r.filter),typeof r.autoScroll=="boolean"&&(this.autoScroll=r.autoScroll),this.updateToolbar())}async saveSettings(){await this.setDialogSetting({filter:this.filter,autoScroll:this.autoScroll})}};hn.styles=Yt`
        :host {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .log-terminal {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            font-family: var(--wa-font-mono);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .message {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            align-items: baseline;
            border-radius: var(--wa-border-radius-small);
        }

        .message:hover {
            background: var(--wa-color-neutral-background-hover);
        }

        .timestamp {
            color: var(--wa-color-neutral-text-subtle);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .source {
            color: var(--wa-color-primary-text);
            font-weight: 500;
            white-space: nowrap;
        }

        .text {
            color: var(--wa-color-neutral-text);
            word-break: break-word;
        }

        .message[data-level="error"] .text {
            color: var(--wa-color-danger-text);
        }

        .message[data-level="warning"] .text {
            color: var(--wa-color-warning-text);
        }

        .message[data-level="debug"] .text {
            color: var(--wa-color-neutral-text-subtle);
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--wa-color-neutral-text-subtle);
            font-style: italic;
        }

        wa-icon {
            flex-shrink: 0;
        }
    `;Ai([At()],hn.prototype,"messages",2);Ai([At()],hn.prototype,"autoScroll",2);Ai([At()],hn.prototype,"filter",2);hn=Ai([Et("k-log-terminal")],hn);var bu=Object.defineProperty,wu=Object.getOwnPropertyDescriptor,Xt=(r,e,t,n)=>{for(var i=n>1?void 0:n?wu(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&bu(e,t,i),i};let Wt=class extends Bn{constructor(){super(...arguments),this.cmd="",this.title="",this.label=!1,this.disabled=!1,this.appearance="plain",this.variant="neutral",this.size="small",this.params={},this.placement="bottom-start",this.dropdownContributions=[]}handleClick(r){if(!this.disabled){if(r&&r.stopPropagation(),this.action){this.action(r);return}if(this.cmd){const e=this.closest("wa-dropdown");e&&e.open!==void 0&&(e.open=!1),this.executeCommand(this.cmd,this.params)}}}handleSelect(r){const e=r.target;e&&e.open!==void 0&&(e.open=!1)}isInDropdown(){return!!this.closest("wa-dropdown, wa-dropdown-menu")}getKeybinding(){if(!this.cmd||this.action)return null;const r=Ea.getKeyBindingsForCommand(this.cmd);return r.length>0?r[0]:null}doBeforeUI(){this.dropdown&&(this.loadDropdownContributions(),Kt(Lr,r=>{this.dropdown&&r.target===this.dropdown&&(this.dropdownContributions=r.contributions,this.requestUpdate())}))}loadDropdownContributions(){this.dropdown&&(this.dropdownContributions=Me.getContributions(this.dropdown),this.requestUpdate())}renderContribution(r){if("command"in r){const e=r,t=e.disabled?.get();return G`
                <k-command 
                    cmd="${e.command}"
                    icon="${e.icon||""}"
                    .params=${e.params||{}}
                    ?disabled="${t}">
                    ${e.label}
                </k-command>
            `}if("html"in r){const t=r.html;return t instanceof Function?t():Un(t)}return kt}render(){const r=this.getKeybinding();return this.isInDropdown()?G`
                <wa-dropdown-item 
                    ?disabled=${this.disabled}
                    @click=${e=>this.handleClick(e)}>
                    <k-icon name="${this.icon}" label="${this.title}" slot="icon"></k-icon>
                    <slot></slot>
                    ${r?G`<span class="keybinding">${r}</span>`:""}
                </wa-dropdown-item>
            `:this.dropdown?G`
                <wa-dropdown 
                    placement=${this.placement}
                    @wa-select=${e=>this.handleSelect(e)}>
                    <wa-button 
                        slot="trigger"
                        appearance=${this.appearance}
                        variant=${this.variant}
                        size=${this.size}
                        ?disabled=${this.disabled}
                        with-caret
                        title=${r?`${this.title} (${r})`:this.title}>
                        <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                        <slot></slot>
                        ${this.label?this.title:kt}
                    </wa-button>
                    
                    ${this.title?G`
                        <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                            ${this.title}
                        </h6>
                    `:kt}
                    
                    ${this.dropdownContributions.map(e=>this.renderContribution(e))}
                    
                    ${this.cmd?G`
                        <wa-divider></wa-divider>
                        <k-command 
                            cmd="${this.cmd}"
                            icon="${this.icon||""}"
                            .params=${this.params}
                            ?disabled=${this.disabled}>
                            <slot></slot>
                            ${this.title}
                        </k-command>
                    `:kt}
                </wa-dropdown>
            `:G`
            <wa-button
                appearance=${this.appearance}
                variant=${this.variant}
                size=${this.size}
                ?disabled=${this.disabled}
                title=${r?`${this.title} (${r})`:this.title}
                @click=${e=>this.handleClick(e)}>
                <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                <slot></slot>
            </wa-button>
        `}};Wt.styles=Yt`
        :host {
            display: inline-block;
        }

        .keybinding {
            margin-left: auto;
            padding: 2px 6px;
            background: var(--wa-color-neutral-15);
            border: 1px solid var(--wa-color-neutral-25);
            border-radius: 3px;
            font-size: 10px;
            font-family: monospace;
            opacity: 0.7;
        }

        :host-context(.wa-light) .keybinding {
            background: var(--wa-color-neutral-85);
            border: 1px solid var(--wa-color-neutral-75);
        }
    `;Xt([Be()],Wt.prototype,"cmd",2);Xt([Be({type:Object,attribute:!1})],Wt.prototype,"action",2);Xt([Be()],Wt.prototype,"title",2);Xt([Be()],Wt.prototype,"label",2);Xt([Be()],Wt.prototype,"icon",2);Xt([Be({type:Boolean})],Wt.prototype,"disabled",2);Xt([Be()],Wt.prototype,"appearance",2);Xt([Be()],Wt.prototype,"variant",2);Xt([Be()],Wt.prototype,"size",2);Xt([Be({type:Object,attribute:!1})],Wt.prototype,"params",2);Xt([Be()],Wt.prototype,"dropdown",2);Xt([Be()],Wt.prototype,"placement",2);Xt([At()],Wt.prototype,"dropdownContributions",2);Wt=Xt([Et("k-command")],Wt);var xu=Object.defineProperty,ku=Object.getOwnPropertyDescriptor,ar=(r,e,t,n)=>{for(var i=n>1?void 0:n?ku(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&xu(e,t,i),i};let Jt=class extends Bn{constructor(){super(...arguments),this.target="",this.title="",this.disabled=!1,this.appearance="plain",this.size="small",this.placement="bottom-start",this.tabContributions=[],this.drawerOpen=!1,this.drawerSize="50vw",this.drawerRef=yr(),this.tabsRef=yr(),this.resizeHandleRef=yr(),this.resizing=null}getDrawerTabsId(){return`fastviews-drawer-tabs-${this.target}`}handleTabClick(r){if(!this.disabled)if(this.containerId){const e=document.querySelector(`k-tabs#${this.containerId}`);if(!e){console.error(`k-fastviews: Tab container with id "${this.containerId}" not found`);return}e.open(r)}else this.drawerOpen=!0,this.updateComplete.then(()=>{const e=this.tabsRef.value;e&&e.open(r)})}handleDrawerHide(){this.drawerOpen=!1}startResize(r){r.preventDefault(),r.stopPropagation();const e=this.drawerRef.value;if(!e)return;let n=(()=>{const a=e.shadowRoot?.querySelector('[part="panel"]');if(a&&a.offsetWidth>0)return a.offsetWidth;const y=(window.getComputedStyle(e).getPropertyValue("--size")||this.drawerSize).match(/^(\d+(?:\.\d+)?)(px|vw|vh|%)$/);if(y){const R=parseFloat(y[1]),b=y[2];if(b==="px")return R;if(b==="vw")return R/100*window.innerWidth;if(b==="vh")return R/100*window.innerHeight;if(b==="%")return R/100*window.innerWidth}return 0})();n===0&&(n=window.innerWidth*.5);const i=a=>{this.resizing&&(a.preventDefault(),a.stopPropagation(),this.resizing.rafId!==null&&cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=requestAnimationFrame(()=>{if(!this.resizing)return;const c=this.resizing.startX-a.clientX,f=Math.round(this.resizing.startSize+c),y=200,R=Math.round(window.innerWidth*.9);if(f>=y&&f<=R){this.drawerSize=`${f}px`;const b=this.drawerRef.value;b&&(b.style.setProperty("--size",this.drawerSize),b.style.setProperty("transition","none"))}this.resizing.rafId=null}))},o=()=>{if(this.resizing){this.resizing.rafId!==null&&(cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=null),document.removeEventListener("mousemove",this.resizing.handleMouseMove),document.removeEventListener("mouseup",this.resizing.handleMouseUp),document.body.style.cursor="",document.body.style.userSelect="";const a=this.drawerRef.value;a&&a.style.removeProperty("transition"),this.resizing=null}};this.resizing={startX:r.clientX,startSize:n,handleMouseMove:i,handleMouseUp:o,rafId:null},document.addEventListener("mousemove",i,{passive:!1}),document.addEventListener("mouseup",o,{passive:!1}),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}doBeforeUI(){this.target&&(this.loadTabContributions(),Kt(Lr,r=>{this.target&&r.target===this.target&&this.loadTabContributions()}))}loadTabContributions(){if(!this.target)return;const r=Me.getContributions(this.target);this.tabContributions=r.filter(e=>"name"in e),this.requestUpdate()}renderTabContribution(r){const e=r.disabled?.get();return G`
            <wa-dropdown-item 
                ?disabled=${e}
                @click=${()=>this.handleTabClick(r)}>
                <k-icon name="${r.icon||""}" label="${r.label}" slot="icon"></k-icon>
                ${r.label}
            </wa-dropdown-item>
        `}render(){return this.target?this.tabContributions.length===0?kt:G`
            <wa-dropdown placement=${this.placement}>
                <wa-button 
                    slot="trigger"
                    appearance=${this.appearance}
                    size=${this.size}
                    ?disabled=${this.disabled}
                    with-caret
                    title=${this.title}>
                    <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                    <slot></slot>
                </wa-button>
                
                ${this.title?G`
                    <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                        ${this.title}
                    </h6>
                `:kt}
                
                ${this.tabContributions.map(r=>this.renderTabContribution(r))}
            </wa-dropdown>

            ${this.containerId?kt:G`
                <wa-drawer 
                    ${br(this.drawerRef)}
                    label="${this.title||"Fast Views"}"
                    placement="end"
                    ?open=${this.drawerOpen}
                    @wa-hide=${this.handleDrawerHide}
                    style="--size: ${this.drawerSize};">
                    <div 
                        ${br(this.resizeHandleRef)}
                        class="resize-handle"
                        @mousedown=${this.startResize}>
                    </div>
                    <k-tabs 
                        ${br(this.tabsRef)}
                        id="${this.getDrawerTabsId()}"
                        style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                    </k-tabs>
                </wa-drawer>
            `}
        `:kt}};Jt.styles=Yt`
        :host {
            display: inline-block;
        }

        wa-drawer {
            position: relative;
        }

        wa-drawer::part(panel) {
            position: relative;
        }

        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            z-index: 1000;
            background: transparent;
            transition: background-color 0.2s;
            user-select: none;
            touch-action: none;
        }

        .resize-handle:hover {
            background: var(--wa-color-brand-fill-loud);
        }

        .resize-handle:active {
            background: var(--wa-color-brand-fill-loud);
        }
    `;ar([Be()],Jt.prototype,"target",2);ar([Be()],Jt.prototype,"title",2);ar([Be()],Jt.prototype,"icon",2);ar([Be({type:Boolean})],Jt.prototype,"disabled",2);ar([Be()],Jt.prototype,"appearance",2);ar([Be()],Jt.prototype,"size",2);ar([Be()],Jt.prototype,"placement",2);ar([Be()],Jt.prototype,"containerId",2);ar([At()],Jt.prototype,"tabContributions",2);ar([At()],Jt.prototype,"drawerOpen",2);ar([At()],Jt.prototype,"drawerSize",2);Jt=ar([Et("k-fastviews")],Jt);var Iu=Object.defineProperty,Su=Object.getOwnPropertyDescriptor,xs=(r,e,t,n)=>{for(var i=n>1?void 0:n?Su(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Iu(e,t,i),i};let zn=class extends Bn{constructor(){super(...arguments),this.message="No content.",this.icon="info-circle"}render(){return G`
            <h3>
                <wa-icon name=${this.icon} label="${this.message}"></wa-icon>
                ${this.message}
            </h3>
        `}};zn.styles=Yt`
        :host {
            display: flex;
            margin: 10px;
        }

        * {
            flex: 1;
        }
    `;xs([Be()],zn.prototype,"message",2);xs([Be()],zn.prototype,"icon",2);zn=xs([Et("k-no-content")],zn);Ue.registerExtension({id:"system.git",name:"Git Support",description:"Git commands and UI elements",loader:()=>mt(()=>import("./git-extension-D4BfQL6j.js"),__vite__mapDeps([0,1,2])),icon:"code-branch",experimental:!0});Ue.registerExtension({id:"system.pyterminal",name:"Python terminal",description:"Python terminal view",loader:()=>mt(()=>import("./pyterminal-extension-X5W4_oOc.js"),__vite__mapDeps([3,1,2,4])),icon:"k python",experimental:!0});Ue.registerExtension({id:"system.linuxterminal",name:"Linux terminal",description:"Linux terminal view",loader:()=>mt(()=>import("./k-linuxterminal-sD4NLkRQ.js"),__vite__mapDeps([5,1,2,4])),icon:"terminal",experimental:!0});Ue.registerExtension({id:"system.webllm",name:"WebLLM",description:"In-Browser LLM inference",loader:()=>mt(()=>import("./webllmservice-BBDHOrTE.js"),__vite__mapDeps([6,1,2])),icon:"robot"});Ue.registerExtension({id:"system.p12splitter",name:".p12 file splitter",description:"Adds a command to split/separate a .p12 file into private/public and additional .pem files",loader:()=>mt(()=>import("./p12-splitter-D81DKiCN.js"),__vite__mapDeps([7,1,2])),icon:"certificate"});Ue.registerExtension({id:"system.pythonpackagemanager",name:"Python Package Manager",description:"Manage Python packages for notebooks and other Python-based extensions",loader:()=>mt(()=>import("./package-manager-extension-gNNVbowH.js"),__vite__mapDeps([8,1,2])),icon:"box"});Ue.registerExtension({id:"system.notebook",name:"Jupyter-like Notebook Editor",description:"View and execute Jupyter-like notebooks (.ipynb) with Python code execution and markdown rendering",loader:()=>mt(()=>import("./notebook-extension-CHbMu6_a.js"),__vite__mapDeps([9,1,2,10,11,8])),icon:"k jupyter",dependencies:["system.pythonpackagemanager"]});Ue.registerExtension({id:"system.commandpalette",name:"Command Palette",description:"VS Code-style command palette at the top center for quick command execution (Ctrl+Shift+P)",loader:()=>mt(()=>import("./command-palette-extension-Bq_pX6cn.js"),__vite__mapDeps([12,1,2])),icon:"terminal"});Ue.registerExtension({id:"system.download",name:"Download Files",description:"Download files from URLs to the workspace",loader:()=>mt(()=>import("./download-extension-CdcmmXQT.js"),__vite__mapDeps([13,1,2])),icon:"download"});Ue.registerExtension({id:"system.unzip",name:"Unzip Archives",description:"Extract zip archives to the workspace",loader:()=>mt(()=>import("./unzip-extension-B1BhdLsj.js"),__vite__mapDeps([14,1,2])),icon:"box-archive"});Ue.registerExtension({id:"system.mdeditor",name:"Markdown Editor",description:"View and render Markdown (.md) files",loader:()=>mt(()=>import("./md-editor-extension-Bo009aao.js"),__vite__mapDeps([15,1,2])),icon:"book"});Ue.registerExtension({id:"system.mediaviewer",name:"Media Viewer",description:"View PDF, image, and HTML files in the browser",loader:()=>mt(()=>import("./media-viewer-extension-DItWLVtR.js"),__vite__mapDeps([16,1,2])),icon:"image"});Ue.registerExtension({id:"system.monaco",name:"Monaco Code Editor",description:"Code editor with syntax highlighting, code completion, and Python execution support",loader:()=>mt(()=>import("./monaco-editor-extension-CA5l6lFU.js"),__vite__mapDeps([17,10,1,2,11,8])),icon:"file-pen",dependencies:["system.pythonpackagemanager"]});Ue.registerExtension({id:"system.memoryusage",name:"Memory Usage Monitor",description:"Displays JavaScript heap memory usage in the bottom toolbar",loader:()=>mt(()=>import("./memory-usage-extension-XHxSvKlZ.js"),__vite__mapDeps([18,1,2])),icon:"microchip"});Ue.registerExtension({id:"system.webdav",name:"WebDAV Workspace",description:"Connect to WebDAV servers (Nextcloud, ownCloud) as workspace folders for cloud storage integration",loader:()=>mt(()=>import("./webdav-extension-Dy-BXo6j.js"),__vite__mapDeps([19,1,2])),icon:"cloud"});Ue.registerExtension({id:"system.settings-tree",name:"Settings Tree Editor",description:"Tree-based editor for settings with in-place editing",loader:()=>mt(()=>import("./settings-tree-extension-CFFcBv4w.js"),__vite__mapDeps([20,1,2])),icon:"sitemap"});Ue.registerExtension({id:"system.ai-system",name:"AI System",description:"Modern AI service with streaming support and agent workflows",loader:()=>mt(()=>import("./ai-system-extension-Cl56n8uD.js"),__vite__mapDeps([21,1,2])),icon:"robot"});Ue.registerExtension({id:"system.rag-system",name:"RAG System",description:"Retrieval-Augmented Generation system for document indexing, search and retrieval",loader:()=>mt(()=>import("./rag-system-extension-BulprZ5N.js").then(r=>r.b),__vite__mapDeps([22,1,2])),icon:"database",experimental:!0,dependencies:["system.ai-system"]});const Ja="events/aiservice/streamStarted",Za="events/aiservice/streamChunk",Xa="events/aiservice/streamComplete",oi="events/aiservice/streamError",Qa="events/aiservice/aiConfigChanged",eo="events/aiservice/agentWorkflowStarted",to="events/aiservice/agentWorkflowComplete",ro="events/aiservice/agentWorkflowError",Hn="aiservice.agents",Zt="aiservice.chatProviders",Kn="aiservice.promptEnhancers",Pn="aiConfig",no={defaultProvider:"openai",providers:[]},Qi=10,ld=Object.freeze(Object.defineProperty({__proto__:null,AI_CONFIG_TEMPLATE:no,CID_AGENTS:Hn,CID_CHAT_PROVIDERS:Zt,CID_PROMPT_ENHANCERS:Kn,KEY_AI_CONFIG:Pn,MAX_TOOL_ITERATIONS:Qi,TOPIC_AGENT_WORKFLOW_COMPLETE:to,TOPIC_AGENT_WORKFLOW_ERROR:ro,TOPIC_AGENT_WORKFLOW_STARTED:eo,TOPIC_AICONFIG_CHANGED:Qa,TOPIC_AI_STREAM_CHUNK:Za,TOPIC_AI_STREAM_COMPLETE:Xa,TOPIC_AI_STREAM_ERROR:oi,TOPIC_AI_STREAM_STARTED:Ja},Symbol.toStringTag,{value:"Module"}));class io{constructor(){this.decoder=new TextDecoder}*processLines(e){for(const t of e)t.trim()!==""&&(yield t)}}class _u extends io{constructor(){super(...arguments),this.usage=null}async*parse(e){let t="";this.usage=null;try{for(;;){const{done:i,value:o}=await e.read();if(i)break;t+=this.decoder.decode(o,{stream:!0});const a=t.split(`
`);t=a.pop()||"";for(const c of this.processLines(a))if(c.startsWith("data: ")){const f=c.slice(6).trim();if(f==="[DONE]"){const y={type:"done",content:""};this.usage&&(y.metadata={usage:this.usage}),yield y;continue}try{const y=JSON.parse(f);if(y.error){yield{type:"error",content:y.error.message||"Unknown error",metadata:y.error};continue}this.extractUsage(y);const R=this.parseChunk(y);R&&(yield R)}catch{continue}}}if(t.trim()&&t.startsWith("data: ")){const i=t.slice(6).trim();if(i!=="[DONE]")try{const o=JSON.parse(i);this.extractUsage(o);const a=this.parseChunk(o);a&&(yield a)}catch{}}const n={type:"done",content:""};this.usage&&(n.metadata={usage:this.usage}),yield n}finally{e.releaseLock()}}extractUsage(e){if(e.usage){const t=e.usage;this.usage={promptTokens:t.prompt_tokens||0,completionTokens:t.completion_tokens||0,totalTokens:t.total_tokens||0,estimated:!1}}}parseChunk(e){const t=e.choices?.[0]?.delta,n=e.choices?.[0];if(t?.content)return{type:"token",content:t.content,message:{role:t.role||"assistant",content:n?.message?.content||t.content}};if(n?.message?.tool_calls){const i=this.parseToolCalls(n.message.tool_calls,!0);if(i.length>0)return{type:"token",content:"",toolCalls:i}}else if(t?.tool_calls||n?.delta?.tool_calls){const i=this.parseToolCalls(t?.tool_calls||n?.delta?.tool_calls||[],!1);if(i.length>0)return{type:"token",content:"",toolCalls:i}}return null}parseToolCalls(e,t=!1){return e.filter(n=>n.function!==void 0).map((n,i)=>({id:n.id||`call_${n.index!==void 0?n.index:i}_${Date.now()}`,type:"function",function:{name:n.function?.name||"",arguments:n.function?.arguments||(t?"{}":"")},_index:n.index!==void 0?n.index:i}))}}class Cu extends io{constructor(){super(...arguments),this.usage=null}async*parse(e){let t="";this.usage=null;try{for(;;){const{done:i,value:o}=await e.read();if(i)break;t+=this.decoder.decode(o,{stream:!0});const a=t.split(`
`);t=a.pop()||"";for(const c of this.processLines(a))try{const f=JSON.parse(c);if(f.error){yield{type:"error",content:f.error,metadata:f};continue}if(f.done){this.extractUsage(f);const y={type:"done",content:""};this.usage&&(y.metadata={usage:this.usage}),yield y;continue}f.message?.content?yield{type:"token",content:f.message.content,message:{role:f.message.role||"assistant",content:f.message.content}}:f.response&&(yield{type:"token",content:f.response,message:{role:"assistant",content:f.response}})}catch{continue}}if(t.trim())try{const i=JSON.parse(t);i.done&&this.extractUsage(i),i.message?.content&&(yield{type:"token",content:i.message.content,message:{role:i.message.role||"assistant",content:i.message.content}})}catch{}const n={type:"done",content:""};this.usage&&(n.metadata={usage:this.usage}),yield n}finally{e.releaseLock()}}extractUsage(e){if(e.prompt_eval_count!==void 0||e.eval_count!==void 0){const t=e.prompt_eval_count||0,n=e.eval_count||0;this.usage={promptTokens:t,completionTokens:n,totalTokens:t+n,estimated:!1}}}}class so{createParser(e,t){return e.includes("text/event-stream")||t.includes("openai")?new _u:new Cu}async*stream(e){const t={model:e.model,stream:!0,messages:e.messages,...e.chatConfig.parameters};e.tools&&e.tools.length>0&&(t.tools=e.tools,t.tool_choice="auto");const n=await fetch(e.chatConfig.chatApiEndpoint,{method:"POST",headers:{Authorization:`Bearer ${e.chatConfig.apiKey}`,"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(t),signal:e.signal});if(!n.ok){const c=await n.text().catch(()=>"Unknown error");yield{type:"error",content:`HTTP ${n.status}: ${c}`,metadata:{status:n.status,statusText:n.statusText}};return}const i=n.headers.get("content-type")||"",o=n.body?.getReader();if(!o){yield{type:"error",content:"Response body is not readable"};return}const a=this.createParser(i,e.chatConfig.chatApiEndpoint);for await(const c of a.parse(o))yield c}}class Eu extends so{constructor(){super(...arguments),this.name="openai"}canHandle(e){return e.chatApiEndpoint.includes("openai")||e.chatApiEndpoint.includes("v1/chat/completions")}}class Au extends so{constructor(){super(...arguments),this.name="ollama"}canHandle(e){return e.name.toLowerCase()==="ollama"||e.chatApiEndpoint.includes("ollama")||e.chatApiEndpoint.includes("localhost:11434")}}class Tu{constructor(){this.providers=[],this.registerDefaultProviders()}registerDefaultProviders(){this.providers.push(new Eu),this.providers.push(new Au)}registerProvider(e){this.providers.push(e)}getProvider(e){const t=this.providers.find(n=>n.canHandle(e));return t||this.providers[0]}getAllProviders(){return[...this.providers]}}class Ou{getAgentContributions(){return Me.getContributions(Hn)}filterAndSortAgents(e,t){return e.filter(n=>n.canHandle?n.canHandle(t):!0).sort((n,i)=>(i.priority||0)-(n.priority||0))}getDefaultAgent(){return{role:"assistant",label:"Assistant",description:"General assistant",sysPrompt:"You are a helpful AI assistant.",priority:0,tools:{enabled:!0}}}getMatchingAgents(e,t){const n=this.getAgentContributions();let i=n.filter(o=>t&&!t.includes(o.role)?!1:o.canHandle?o.canHandle(e):!0);if(t&&t.length>0){if(i=i.sort((o,a)=>(a.priority||0)-(o.priority||0)),i.length===0){const o=t.includes("assistant")?"assistant":t[0];if(o==="assistant")i.push(this.getDefaultAgent());else{const a=n.find(c=>c.role===o);a?i.push(a):i.push(this.getDefaultAgent())}}}else i=this.filterAndSortAgents(i,e),i.length===0&&i.push(this.getDefaultAgent());return i}}class ao{sanitizeFunctionName(e){return e.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}commandToTool(e,t){const n={},i=[];return e.parameters?.forEach(c=>{const f=this.sanitizeFunctionName(c.name);n[f]={type:c.type||"string",description:c.description,...c.allowedValues&&{enum:c.allowedValues}},c.required===!0&&i.push(f)}),{type:"function",function:{name:this.sanitizeFunctionName(e.id),description:e.description||e.name,parameters:{type:"object",properties:n,required:i}}}}getAvailableTools(e,t){const n=je.listCommands();let i=Object.values(n);return t&&(i=i.filter(o=>t(o,e))),i.map(o=>this.commandToTool(o,e))}}class Ru{constructor(){this.toolRegistry=new ao,this.enhancers=[]}addEnhancer(e){this.enhancers.push(e)}getSysPrompt(e){const t=e.sysPrompt;return typeof t=="function"?t():t}rewriteChatHistoryForAgent(e,t){return e.map(n=>n.role==="user"?{role:n.role,content:n.content}:n.role===t?{role:"assistant",content:n.content}:{role:"user",content:`***Agent '${n.role}' replied:***
${n.content}`})}getContributedEnhancers(){return Me.getContributions(Kn).map(t=>({...t.enhancer,priority:t.priority??t.enhancer.priority}))}async enhancePrompt(e,t,n){let i=e;const o=[...t.promptEnhancers||[],...this.enhancers,...this.getContributedEnhancers()].sort((a,c)=>(c.priority||0)-(a.priority||0));for(const a of o)i=await a.enhance(i,n);return i}async build(e,t,n,i){i?.beforeSend&&await i.beforeSend(t,n);const o=this.sanitizeMessagesForAPI(t),a=this.rewriteChatHistoryForAgent(o,e.role),c=a.length-1;let f=a[c],y;e.tools?.enabled&&(y=this.toolRegistry.getAvailableTools(n,e.tools.commandFilter));const R=await this.enhancePrompt(f.content,e,n);f.content=R;const b=this.getSysPrompt(e);return a.unshift({role:"system",content:b}),{messages:a,userPromptIndex:c,tools:y}}sanitizeMessageForAPI(e){const t={role:e.role,content:e.content};return"tool_call_id"in e&&e.tool_call_id&&(t.tool_call_id=e.tool_call_id),"tool_calls"in e&&e.tool_calls&&(t.tool_calls=e.tool_calls),t}sanitizeMessagesForAPI(e){return e.map(t=>this.sanitizeMessageForAPI(t))}}class Pu{constructor(){this.processors=[]}addProcessor(e){this.processors.push(e)}getSortedProcessors(){return[...this.processors].sort((e,t)=>(t.priority||0)-(e.priority||0))}async process(e,t,n){let i={...e};const o=[...t.messageProcessors||[],...this.processors].sort((c,f)=>(f.priority||0)-(c.priority||0));for(const c of o)i=await c.process(i,n);const a=i.actions?.some(c=>c.requiresAttention)||i.attentionRequests?.some(c=>c.requiresAction)||!1;return{...i,requiresAttention:a}}checkRequiresAttention(e){return e.actions?.some(t=>t.requiresAttention)||e.attentionRequests?.some(t=>t.requiresAction)||!1}}class Lu{constructor(){this.accumulatedToolCalls=new Map,this.toolCallIndexMap=new Map}processChunk(e){if(e.type==="token"&&e.toolCalls&&e.toolCalls.length>0)for(const t of e.toolCalls){const n=t._index,i=t.id;let o,a;if(n!==void 0&&this.toolCallIndexMap.has(n)?(a=this.toolCallIndexMap.get(n),o=this.accumulatedToolCalls.get(a)):i&&this.accumulatedToolCalls.has(i)?(a=i,o=this.accumulatedToolCalls.get(a)):(a=i||`call_${n!==void 0?n:Date.now()}_${Math.random()}`,o=void 0),o){const c=o.function.arguments||"",f=t.function.arguments||"",y=c+f;this.accumulatedToolCalls.set(a,{id:a,type:t.type||o.type,function:{name:t.function.name||o.function.name,arguments:y}}),n!==void 0&&!this.toolCallIndexMap.has(n)&&this.toolCallIndexMap.set(n,a)}else this.accumulatedToolCalls.set(a,{...t,id:a}),n!==void 0&&this.toolCallIndexMap.set(n,a)}}getFinalToolCalls(){return Array.from(this.accumulatedToolCalls.values()).filter(e=>e.function.name&&e.function.name.trim().length>0).map(e=>{let t=e.function.arguments||"";return(!t||t.trim()==="")&&(t="{}"),{...e,function:{...e.function,arguments:t}}})}reset(){this.accumulatedToolCalls.clear(),this.toolCallIndexMap.clear()}}class oo{sanitizeFunctionName(e){return e.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}findCommand(e,t){const n=e.function.name,i=je.getCommand(n);if(i)return i;const o=je.listCommands();for(const[a,c]of Object.entries(o))if(this.sanitizeFunctionName(a)===n)return c;return null}parseArguments(e){if(!e||e.trim()===""||e==="{}")return{};try{const t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch(t){const n=t instanceof Error?t.message:String(t);return console.error(`[ToolExecutor] Failed to parse arguments: ${e} - ${n}`),{}}}sanitizeArguments(e,t){if(!t||!t.parameters||!e||typeof e!="object")return e||{};const n={};return t.parameters.forEach(i=>{const o=this.sanitizeFunctionName(i.name);o in e&&(n[i.name]=e[o])}),n}async executeToolCall(e,t){try{const n=this.findCommand(e,t),i=n?.id||e.function.name,o=e.function.arguments||"{}",a=this.parseArguments(o),c=this.sanitizeArguments(a,n),f=je.createExecutionContext(c),y={...t,...f,params:c};let R=await je.execute(i,y);const x={success:!0,message:`Command "${n?.name||i}" executed successfully`,command:i};if(c&&typeof c=="object"&&Object.keys(c).length>0&&(x.parameters=c),R){let _=R;if(_ instanceof Promise&&(_=await _),x.result=_,n?.output&&n.output.length>0){const D=n.output.map(Y=>`${Y.name}: ${Y.description||Y.type||"value"}`).join(", ");x.output=D}}return{id:e.id,result:x}}catch(n){const i=n instanceof Error?n.message:String(n);let o=null;try{o=this.findCommand(e,t)}catch{o=null}const a=o?.name||e.function.name;let c=i;return i.includes("No handler found")||i.includes("No handlers registered")?c=`Command "${a}" cannot be executed. ${i}. This usually means the command is not available in the current context (e.g., a map editor may not be open or active).`:(i.includes("not available")||i.includes("GsMapEditor"))&&(c=`Command "${a}" cannot be executed: ${i}. Please ensure the required editor or component is open and active.`),{id:e.id,result:null,error:c}}}async executeToolCalls(e,t){const n=[];for(const i of e){const o=await this.executeToolCall(i,t);n.push(o)}return n}createToolCallAccumulator(){return new Lu}createToolCallSignature(e){const t=e.function.arguments||"{}";let n={};try{const o=JSON.parse(t);n=o&&typeof o=="object"?o:{}}catch{n={}}const i=n&&typeof n=="object"?Object.keys(n).sort().reduce((o,a)=>(o[a]=n[a],o),{}):{};return`${e.function.name}:${JSON.stringify(i)}`}}const cd=Object.freeze(Object.defineProperty({__proto__:null,ToolExecutor:oo},Symbol.toStringTag,{value:"Module"}));class $u{async execute(e,t,n,i){const o=t.chatConfig;if(!o)throw new Error("Chat config is required");const a=e.map(async c=>{try{await i(c,t.chatContext.history,n.sharedState,o,t,n)}catch(f){const y=f instanceof Error?f:new Error(String(f));n.errors.set(c.role,y),t.onAgentError?.(c.role,y)}});await Promise.all(a)}}class Du{async execute(e,t,n,i){const o=t.chatConfig;if(!o)throw new Error("Chat config is required");let a=[...t.chatContext.history],c={...n.sharedState};for(const f of e)try{const y=this.createAgentContextWithPreviousAgents(c,t,n),R=await i(f,a,c,o,t,n);if(!R)break;const b=this.updateWorkflowState(R,a,c,y,n);a=b.currentMessages,c=b.accumulatedState}catch(y){const R=y instanceof Error?y:new Error(String(y));n.errors.set(f.role,R),t.onAgentError?.(f.role,R);break}}createAgentContextWithPreviousAgents(e,t,n){return{...e,...t.callContext.getProxy(),previousAgents:Array.from(n.messages.entries()).map(([i,o])=>({role:i,content:o.content}))}}updateWorkflowState(e,t,n,i,o){return t.push(e),n={...n,...i,message:e},o.sharedState=n,{currentMessages:t,accumulatedState:n}}}class Nu{async execute(e,t,n,i){const o=t.chatConfig;if(!o)throw new Error("Chat config is required");let a=[...t.chatContext.history],c={...n.sharedState};for(const f of e)try{const y=this.createAgentContextWithPreviousAgents(c,t,n);if(f.canHandle&&!f.canHandle(y))continue;const R=await i(f,a,c,o,t,n);if(!R)break;const b=this.updateWorkflowState(R,a,c,y,n);a=b.currentMessages,c=b.accumulatedState}catch(y){const R=y instanceof Error?y:new Error(String(y));n.errors.set(f.role,R),t.onAgentError?.(f.role,R)}}createAgentContextWithPreviousAgents(e,t,n){return{...e,...t.callContext.getProxy(),previousAgents:Array.from(n.messages.entries()).map(([i,o])=>({role:i,content:o.content}))}}updateWorkflowState(e,t,n,i,o){return t.push(e),n={...n,...i,message:e},o.sharedState=n,{currentMessages:t,accumulatedState:n}}}class Mu{constructor(){this.strategies=new Map([["parallel",new $u],["sequential",new Du],["conditional",new Nu]])}registerStrategy(e,t){this.strategies.set(e,t)}async execute(e,t,n){const i=`workflow-${Date.now()}-${Math.random()}`,o=t.execution||"parallel",a=t.sharedState||{},c={messages:new Map,sharedState:{...a},errors:new Map};Xe(eo,{workflowId:i,options:t});try{const f=this.strategies.get(o);if(!f)throw new Error(`Unknown workflow execution strategy: ${o}`);return await f.execute(e,t,c,n),Xe(to,{workflowId:i,results:c}),c}catch(f){const y=f instanceof Error?f:new Error(String(f));throw Xe(ro,{workflowId:i,error:y}),y}}}const Mn=class Mn{static estimateTokens(e){if(!e||e.trim().length===0)return 0;const t=e.trim(),n=t.length,i=t.split(/\s+/).filter(a=>a.length>0).length,o=Math.ceil(n/this.AVERAGE_CHARS_PER_TOKEN+i*.3);return Math.max(1,o)}static estimateMessageTokens(e){let t=this.MESSAGE_OVERHEAD;if(e.content&&(t+=this.estimateTokens(e.content)),e.role&&(t+=this.estimateTokens(e.role)),e.tool_calls)for(const n of e.tool_calls)t+=this.estimateTokens(n.function.name||""),t+=this.estimateTokens(n.function.arguments||"{}"),t+=10;return e.tool_call_id&&(t+=this.estimateTokens(e.tool_call_id)),t}static estimatePromptTokens(e,t){let n=0;for(const i of e)n+=this.estimateMessageTokens(i);if(t&&t.length>0){for(const i of t)if(n+=this.TOOL_DEFINITION_OVERHEAD,n+=this.estimateTokens(i.function.name||""),n+=this.estimateTokens(i.function.description||""),i.function.parameters){const o=JSON.stringify(i.function.parameters);n+=this.estimateTokens(o)}}return n}static estimateCompletionTokens(e,t){let n=this.estimateTokens(e);if(t&&t.length>0)for(const i of t)n+=10,n+=this.estimateTokens(i.function?.name||""),n+=this.estimateTokens(i.function?.arguments||"{}");return n}};Mn.AVERAGE_CHARS_PER_TOKEN=4,Mn.TOOL_DEFINITION_OVERHEAD=50,Mn.MESSAGE_OVERHEAD=4;let gi=Mn;const Qs="ai_token_usage";class Fu{constructor(){this.data=null,this.loadPromise=null}async loadData(){return this.data?this.data:this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{const e=await ir.getObject(Qs);return e?this.data=e:(this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()),this.loadPromise=null,this.data})(),this.loadPromise)}async saveData(){this.data&&(this.data.lastUpdated=Date.now(),await ir.persistObject(Qs,this.data))}async recordUsage(e,t){if(await this.loadData(),!this.data)return;this.data.providers[e]||(this.data.providers[e]={promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0});const n=this.data.providers[e];n.promptTokens+=t.promptTokens,n.completionTokens+=t.completionTokens,n.totalTokens+=t.totalTokens,n.requestCount+=1,this.data.total.promptTokens+=t.promptTokens,this.data.total.completionTokens+=t.completionTokens,this.data.total.totalTokens+=t.totalTokens,this.data.total.requestCount+=1,await this.saveData()}async getProviderUsage(e){return await this.loadData(),this.data?.providers[e]||null}async getAllProviderUsage(){return await this.loadData(),this.data?.providers||{}}async getTotalUsage(){return await this.loadData(),this.data?.total||{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0}}async reset(){this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()}async resetProvider(e){if(await this.loadData(),!this.data)return;const t=this.data.providers[e];t&&(this.data.total.promptTokens-=t.promptTokens,this.data.total.completionTokens-=t.completionTokens,this.data.total.totalTokens-=t.totalTokens,this.data.total.requestCount-=t.requestCount,delete this.data.providers[e],await this.saveData())}}const qu=new Fu;class zu{constructor(){this.activeRequests=new Map,this.providerFactory=new Tu,this.agentRegistry=new Ou,this.promptBuilder=new Ru,this.messageProcessor=new Pu,this.toolExecutor=new oo,this.workflowEngine=new Mu,this.toolRegistry=new ao,Kt(Wr,()=>{this.aiConfig=void 0,this.checkAIConfig().then()}),this.checkAIConfig().then()}getAgentContributions(){return this.agentRegistry.getAgentContributions()}async getProviders(){return await this.checkAIConfig(),this.aiConfig?.providers||[]}async getDefaultProvider(){await this.checkAIConfig();const e=await this.getProviders();if(this.aiConfig?.defaultProvider){const t=e.find(n=>n.name===this.aiConfig?.defaultProvider);if(t)return t}return e[0]}async setDefaultProvider(e){return await this.checkAIConfig(),this.aiConfig&&(this.aiConfig.defaultProvider=e,await xt.set(Pn,this.aiConfig)),this.getDefaultProvider()}createMessage(e){return{role:"user",content:e}}registerStreamingFetcher(e){this.providerFactory.registerProvider(e)}async checkAIConfig(){if(!this.aiConfig){if(this.aiConfig=await xt.get(Pn),!this.aiConfig){const t=Me.getContributions(Zt).map(i=>i.provider),n={...no,providers:t};await xt.set(Pn,n),this.aiConfig=await xt.get(Pn)}Xe(Qa,this.aiConfig)}}createAgentContext(e,t,n={}){return{...e,...t.getProxy(),...n}}createFinalMessage(e,t){return{role:e.role,content:t.content,actions:t.actions,requiresAttention:t.requiresAttention,attentionRequests:t.attentionRequests,canContinue:t.canContinue}}async handleUserAttention(e,t,n,i){if(!t.requiresAttention||!n.userAttentionHandler)return!0;const o=[];if(t.attentionRequests&&o.push(...t.attentionRequests),t.actions)for(const f of t.actions)f.requiresAttention&&f.attentionRequest&&o.push(f.attentionRequest);if(o.length===0)return!0;if(i.pendingAttention||(i.pendingAttention=new Map),i.pendingAttention.set(e,o),n.onAttentionRequest)for(const f of o)n.onAttentionRequest(e,f);if(n.pauseOnAttention)return i.paused=!0,i.continuationToken=`${e}-${Date.now()}-${Math.random()}`,!1;const a=n.userAttentionHandler,c=this.createAgentContext(n.sharedState||{},n.callContext,{message:t});for(const f of o)if(a.onAttentionRequest){const y=await a.onAttentionRequest(f,c);if(f.requiresAction&&(y===!1||y===null))return!1;y&&typeof y=="string"&&(c[`attention_${f.type}_result`]=y)}else switch(f.type){case"confirmation":if(a.onConfirmation&&!await a.onConfirmation(f.message,c)&&f.requiresAction)return!1;break;case"input":if(a.onInput){const y=await a.onInput(f.message,void 0,c);if(!y&&f.requiresAction)return!1;y&&(c.attention_input_result=y)}break}return!0}async*streamCompletion(e){const t=`${Date.now()}-${Math.random()}`,n=new AbortController;this.activeRequests.set(t,n),e.signal&&e.signal.addEventListener("abort",()=>{n.abort()});const i=e.signal||n.signal;try{e.onStatus?.("starting"),Xe(Ja,{requestId:t,options:e});const o=e.chatConfig||await this.getDefaultProvider(),a=this.sanitizeMessagesForAPI(e.chatContext.history),c=this.providerFactory.getProvider(o),f=this.toolExecutor.createToolCallAccumulator();let y="",R={role:"assistant",content:""},b;for await(const D of c.stream({model:o.model,messages:a,chatConfig:o,tools:e.tools,signal:i})){if(D.type==="error"){e.onStatus?.("error"),Xe(oi,{requestId:t,chunk:D}),yield D;break}if(D.type==="token")f.processChunk(D),(!D.toolCalls||D.toolCalls.length===0)&&(y+=D.content,R.content=y),D.message?.role&&(R.role=D.message.role),D.content&&e.onToken?.(D.content),e.onStatus?.("streaming"),e.onProgress?.({received:y.length}),Xe(Za,{requestId:t,chunk:D}),yield D;else if(D.type==="done"){D.metadata?.usage&&(b=D.metadata.usage),e.onStatus?.("complete"),Xe(Xa,{requestId:t}),yield D;break}else yield D}const x=f.getFinalToolCalls(),_={role:R.role||"assistant",content:y||"",...x.length>0&&{toolCalls:x}};if(!b){const D=gi.estimatePromptTokens(a,e.tools),Y=gi.estimateCompletionTokens(y,x);b={promptTokens:D,completionTokens:Y,totalTokens:D+Y,estimated:!0}}return qu.recordUsage(o.name,b).catch(D=>{tt.error(`Failed to record token usage: ${D instanceof Error?D.message:String(D)}`)}),{message:_,tokenUsage:b}}catch(o){if(o instanceof Error&&o.name==="AbortError")throw e.onStatus?.("error"),Xe(oi,{requestId:t,error:"Request cancelled"}),o;e.onStatus?.("error");const a=o instanceof Error?o.message:String(o);throw Xe(oi,{requestId:t,error:a}),yield{type:"error",content:a,metadata:{error:o}},o}finally{this.activeRequests.delete(t)}}async handleStreamingPromptDirect(e){const t=this.streamCompletion(e);let n;for(;;){if(n=await t.next(),n.done)return n.value.message;const i=n.value;if(i.type==="error")throw new Error(i.content);if(i.type==="done"){const o=await t.next();if(o.done&&o.value)return o.value.message;if(!o.done)continue;throw new Error("Stream completed without return value")}}}sanitizeMessageForAPI(e){const t={role:e.role,content:e.content};return"tool_call_id"in e&&e.tool_call_id&&(t.tool_call_id=e.tool_call_id),"tool_calls"in e&&e.tool_calls&&(t.tool_calls=e.tool_calls),t}sanitizeMessagesForAPI(e){return e.map(t=>this.sanitizeMessageForAPI(t))}async handleStreamingPrompt(e){const t=e.callContext||Bt.createChild({}),n=this.createAgentContext({},t,{userPrompt:e.chatContext.history[e.chatContext.history.length-1]?.content||""}),i=this.agentRegistry.getMatchingAgents(n),o=i.length>0?i.map(f=>f.role):["assistant"],a=await this.executeAgentWorkflow({chatContext:e.chatContext,chatConfig:e.chatConfig,callContext:t,execution:"parallel",stream:e.stream,signal:e.signal,onToken:(f,y)=>{e.onToken?.(y)},onStatus:(f,y)=>{e.onStatus?.(y)},roles:o}),c=Array.from(a.messages.values());return c.length===1?c[0]:c}async continueWorkflow(e,t,n){const i={sharedState:{...n.sharedState,...Object.fromEntries(t)}},o={...n,sharedState:i.sharedState,pauseOnAttention:!1};return this.executeAgentWorkflow(o)}cancelRequest(e){const t=this.activeRequests.get(e);return t?(t.abort(),this.activeRequests.delete(e),!0):!1}async executeAgentWorkflow(e){const t=this.createAgentContext(e.sharedState||{},e.callContext),n=this.agentRegistry.getMatchingAgents(t,e.roles);return this.workflowEngine.execute(n,e,async(i,o,a,c,f,y)=>this.executeAgent(i,o,a,c,f,y))}async executeAgent(e,t,n,i,o,a){o.onAgentStart?.(e.role);const c=this.createAgentContext(n,o.callContext,{userPrompt:t[t.length-1]?.content||""}),{messages:f,tools:y}=await this.promptBuilder.build(e,t,c,e.hooks),R=f.map(xe=>{const W={role:xe.role,content:xe.content};return xe.tool_call_id&&(W.tool_call_id=xe.tool_call_id),xe.tool_calls&&(W.tool_calls=xe.tool_calls),W});let b=await this.handleStreamingPromptDirect({chatContext:{history:R},chatConfig:i,callContext:o.callContext,stream:o.stream??!0,signal:o.signal,tools:y}),x=0;const _=[...f];for(;b.toolCalls&&b.toolCalls.length>0;){if(x++,x>Qi){console.warn(`[AIService] Maximum tool call iterations (${Qi}) reached`);break}let xe=[];if(o.requireToolApproval&&o.onToolApprovalRequest){const B=b.toolCalls.map(Pe=>{const he=Pe.function.arguments||"{}";let z={};try{z=JSON.parse(he)}catch{z={}}return`${Pe.function.name}(${Object.entries(z).map(([le,ye])=>`${le}=${ye}`).join(", ")})`}).join(", "),ee={toolCalls:b.toolCalls,message:`The AI wants to execute: ${B}`};await o.onToolApprovalRequest(e.role,ee)?xe=await this.toolExecutor.executeToolCalls(b.toolCalls,c):xe=b.toolCalls.map(Pe=>({id:Pe.id,result:{success:!1,message:"Tool execution cancelled by user",cancelled:!0}}))}else xe=await this.toolExecutor.executeToolCalls(b.toolCalls,c);const W=xe.map(B=>({role:"tool",content:B.error?JSON.stringify({error:B.error}):JSON.stringify(B.result),tool_call_id:B.id})),N={role:"assistant",content:b.content||""};b.toolCalls&&b.toolCalls.length>0&&(N.tool_calls=b.toolCalls.filter(B=>B.function.name&&B.function.name.trim().length>0).map(B=>({id:B.id,type:B.type,function:{name:B.function.name,arguments:B.function.arguments||"{}"}}))),_.push(N,...W);const K=_;b=await this.handleStreamingPromptDirect({chatContext:{history:K.map(B=>({role:B.role,content:B.content,...B.tool_call_id&&{tool_call_id:B.tool_call_id},...B.tool_calls&&{tool_calls:B.tool_calls}}))},chatConfig:i,callContext:o.callContext,stream:o.stream??!0,signal:o.signal,tools:y});const U=b.content&&b.content.trim().length>0,O=b.toolCalls&&b.toolCalls.length>0;if(U&&!O)break;if(U&&O){console.warn("[AIService] Model provided content but also called tools - treating as completion");break}}const D=await this.messageProcessor.process(b,e,this.createAgentContext(n,o.callContext,{message:b}));e.hooks?.afterReceive&&await e.hooks.afterReceive(D,this.createAgentContext(n,o.callContext));const Y=this.createFinalMessage(e,D);return!await this.handleUserAttention(e.role,Y,o,a)&&o.pauseOnAttention?null:(a.messages.set(e.role,Y),o.onAgentComplete?.(e.role,Y),Y)}}const ud=new zu,Uu=`You are a helpful assistant designed to guide users in programming tasks within a WebGIS called "geo!space".
The user will provide code snippets, and you will help them understand, debug, and extend their code.
Supported programming languages that geo!space can directly run:
- Python code is directly executed in the browser using Pyodide
- JavaScript code is executed in a worker

Code for other programming languages cannot be executed directly, but geo!space uses the monaco editor to offer basic IDE like functionality.

**Your Responsibilities:**

*   **Understand the User's Goal:**  Always start by clarifying what the user is trying to achieve with their Python code. Ask clarifying questions if necessary.
*   **Explain Python Code:**  If the user provides code, explain what it does, line by line if needed.  Point out potential issues or areas for improvement.
*   **Help with \`js\` Module Interaction:**  The user will likely want to call JavaScript functions from Python or pass data between Python and JavaScript.  Provide clear examples of how to use the \`js\` module for these interactions.  Explain the syntax and potential pitfalls.
*   **Provide Code Examples:**  Give concise, runnable code examples to illustrate concepts.
*   **Debug Code:**  If the user reports errors, help them identify the cause and suggest solutions.  Consider both Python and JavaScript errors.
*   **Suggest Improvements:**  Offer suggestions for making the code more efficient, readable, or robust.
*   **Focus on Browser Context:**  Remember that the code is running in a browser environment.  Be mindful of browser limitations and security considerations.
*   **Be Concise and Clear:**  Avoid jargon and explain concepts in a way that is easy to understand.
*   **Assume Basic Python Knowledge:**  While you should explain code, assume the user has a basic understanding of Python syntax.

**About the Python environment:**
A mount point is provided at /workspace which is linked to a folder on the user's local file system previously selected using the file system access api of the browser.
The working directory is automatically set to the /workspace folder. The user can access the workspace content in the web app's file browser titled "Workspace" in the UI.
The user can install additional Python packages by adding them as dependencies in the workspace file requirements.txt.
The dependencies within the requirements.txt are installed before any code is executed.`,ju=`You are a JavaScript programming assistant for the geo!space IDE.
Your role is to help users write, understand, and debug geo!space modules—JavaScript files that export a function for dynamic interaction with OpenLayers-powered maps.

*Always follow these guidelines:*

- Explain concepts and code clearly, concisely, and at the experience level of the user.
- If a user shares module code, extract and summarize its structure (such as state, refs, UI, use of the map object, etc.) before offering feedback or improvements.
- When explaining, reference geo!space context, e.g., "This is how you add a map layer in geo!space..."
- For any questions or issues, focus help specifically on JavaScript, OpenLayers usage, and geo!space module patterns.
- Do not discuss topics outside JavaScript, OpenLayers, or geo!space modules.
- If a user's intent isn't clear, ask clarifying questions before answering.
- When a user requests a starter, skeleton, or minimal module, provide the following template and explain its structure:

\`\`\`javascript
// Export your module as a default function.
// The following parameters are available:
export default function ({ map, env, render, html, style, when, ref, createRef, events, settings }) {
    // Optional: local state for your module
    const state = {
        // Your state variables here
    };

    // Optional: references for interactive elements
    // const myRef = createRef();

    // Optional: run code when module loads
    // style({ /* ... custom styles or slotting ... */ })

    // Return a function that renders your UI
    return () => html\`
        <!-- Your module's UI goes here -->

        <div>
            <h3>Hello, geo!space!</h3>
            <button @click=\${() => {
                // Example: add a marker or interact with map
                alert("Button clicked! Add OpenLayers code here.");
            }}>
                Click me
            </button>
        </div>
    \`;
}
\`\`\``,lo=r=>r&&typeof r.getEditor=="function"&&typeof r.getLanguage=="function",Wu={enhance:async(r,e)=>{const t=e.activeEditor;if(!lo(t))return r;const n=t.getEditor(),i=n.getModel(),o=i.getValueInRange(n.getSelection()),a=t.input?.data.getWorkspacePath();return o?`${r}

 Code selection within file "${a}":
${o}`:`${r}

Code in file "${a}":
${i.getValue()}`}},co=(r,e,t)=>({label:t,description:`${t}`,role:`${r==="python"?"py":"js"}-programmer`,icon:"code",sysPrompt:e,canHandle:n=>{const i=n.activeEditor;return lo(i)&&i.getLanguage()===r},promptEnhancers:[Wu]});Me.registerContribution(Hn,co("python",Uu,"Python Assistant"));Me.registerContribution(Hn,co("javascript",ju,"JavaScript Assistant"));Me.registerContribution(Zt,{target:Zt,label:"Ollama",provider:{name:"ollama",model:"gemma3:12b",chatApiEndpoint:"http://localhost:11434/v1/chat/completions",apiKey:""}});Me.registerContribution(Zt,{target:Zt,label:"OpenAI",provider:{name:"openai",model:"gpt-4.1",chatApiEndpoint:"https://api.openai.com/v1/chat/completions",apiKey:"<your api key>"}});Me.registerContribution(Zt,{target:Zt,label:"Groq",provider:{name:"groq",model:"llama-3.1-8b-instant",chatApiEndpoint:"https://api.groq.com/openai/v1/chat/completions",apiKey:"<your api key>"}});Me.registerContribution(Zt,{target:Zt,label:"Cerebras",provider:{name:"cerebras",model:"llama3.1-8b",chatApiEndpoint:"https://api.cerebras.ai/v1/chat/completions",apiKey:"<your api key>"}});Me.registerContribution(Zt,{target:Zt,label:"WebLLM",provider:{name:"webllm",model:"gemma-2-9b-it-q4f16_1-MLC",chatApiEndpoint:"",apiKey:"",parameters:{context_window_size:4096}}});Me.registerContribution(Zt,{target:Zt,label:"Mistral",provider:{name:"mistral",model:"mistral-large-latest",chatApiEndpoint:"https://api.mistral.ai/v1/chat/completions",apiKey:"<your api key>",ocrApiEndpoint:"https://api.mistral.ai/v1/ocr"}});Me.registerContribution(Zi,{name:"filebrowser",label:"Workspace",icon:"folder-open",component:r=>G`<k-filebrowser id="${r}"></k-filebrowser>`});Me.registerContribution(Va,{name:"aiview",label:"AI",icon:"robot",component:r=>G`<k-aiview id="${r}"></k-aiview>`});Me.registerContribution("system.fastviews-bottomend",{name:"log-terminal",label:"Log Messages",icon:"list",component:r=>G`<k-log-terminal id="${r}"></k-log-terminal>`});Me.registerContribution(Ba,{slot:"start",label:"Workspace",html:"<k-workspace-name></k-workspace-name>"});Me.registerContribution(bs,{label:"Info",icon:"circle-info",command:"show_version_info",showLabel:!0});Me.registerContribution(bs,{label:"Fast Views",html:'<k-fastviews target="system.fastviews-bottomend" icon="bolt" title="Fast Views"></k-fastviews>'});const $t=Hr("MarketplaceRegistry"),qi="events/marketplaceregistry/changed",ea="marketplace.catalogUrls";class Bu{constructor(){this.catalogUrls=[],this.loadingPromises=new Map,this.loadCatalogUrls().then(()=>{this.refreshCatalogs().catch(e=>{$t.error(`Failed to refresh catalogs on init: ${e.message}`)})}),Kt(qi,()=>{this.registerMarketplaceExtensions()})}async loadCatalogUrls(){try{const e=await xt.get(ea);this.catalogUrls=Array.isArray(e)?e:[],$t.debug(`Loaded ${this.catalogUrls.length} catalog URLs`)}catch(e){$t.error(`Failed to load catalog URLs: ${e}`),this.catalogUrls=[]}}async saveCatalogUrls(){await xt.set(ea,this.catalogUrls),Xe(qi,{type:"catalogs",urls:this.catalogUrls})}async addCatalogUrl(e){if(!this.isValidUrl(e))throw new Error(`Invalid catalog URL: ${e}`);if(this.catalogUrls.includes(e)){$t.debug(`Catalog URL already exists: ${e}`);return}this.catalogUrls.push(e),await this.saveCatalogUrls(),$t.info(`Added catalog URL: ${e}`);try{await this.fetchCatalog(e),this.registerMarketplaceExtensions()}catch(t){$t.warn(`Failed to fetch catalog immediately after adding: ${t}`)}}async removeCatalogUrl(e){const t=this.catalogUrls.indexOf(e);t!==-1&&(this.catalogUrls.splice(t,1),await this.saveCatalogUrls(),$t.info(`Removed catalog URL: ${e}`))}getCatalogUrls(){return[...this.catalogUrls]}isValidUrl(e){try{const t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}async fetchCatalog(e){const t=this.loadingPromises.get(e);if(t)return t;const n=(async()=>{try{$t.debug(`Fetching catalog from: ${e}`);const i=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const o=await i.json();if(!o.extensions||!Array.isArray(o.extensions))throw new Error("Invalid catalog format: extensions array is required");const a={name:o.name,description:o.description,extensions:o.extensions};return $t.debug(`Successfully fetched catalog from ${e}: ${a.extensions.length} extensions`),a}catch(i){throw $t.error(`Failed to fetch catalog from ${e}: ${i}`),i}finally{this.loadingPromises.delete(e)}})();return this.loadingPromises.set(e,n),n}async refreshCatalogs(){$t.info(`Refreshing ${this.catalogUrls.length} catalogs...`);const e=this.catalogUrls.map(n=>this.fetchCatalog(n).catch(i=>($t.warn(`Failed to refresh catalog ${n}: ${i.message}`),null)));(await Promise.allSettled(e)).forEach((n,i)=>{n.status==="fulfilled"&&n.value&&n.value.extensions.forEach(a=>{if(!Ue.getExtensions().find(c=>c.id===a.id)){const c={...a,external:!0};Ue.registerExtension(c),$t.debug(`Registered marketplace extension: ${a.id}`)}})}),Xe(qi,{type:"refreshed"}),$t.info("Catalog refresh completed")}registerMarketplaceExtensions(){}getMarketplaceExtensions(){return[]}getMarketplaceExtension(e){const t=Ue.getExtensions().find(n=>n.id===e);if(t&&t.external)return t}getCatalogsWithExtensions(){return[]}async installExtension(e){if(Ue.isEnabled(e.id)){$t.info(`Extension ${e.id} is already installed`);return}$t.info(`Installing marketplace extension: ${e.name} from ${e.url}`);const t={...e,external:!0};Ue.registerExtension(t),await Zr.loadExtensionFromUrl(e.url),$t.info(`Successfully installed marketplace extension: ${e.id}`)}isMarketplaceExtension(e){const t=Ue.getExtensions().find(n=>n.id===e);return t!==void 0&&t.external===!0}}const uo=new Bu;Bt.put("marketplaceRegistry",uo);const Gu=Hr("MarketplaceCatalogContributions");uo.addCatalogUrl("https://marketplace.kispace.de/externals.json").catch(r=>{Gu.warn(`Failed to add commercial catalog: ${r}`)});const Vu={enhance:async(r,e)=>{const t=Ue.getExtensions().map(i=>({id:i.id,name:i.name,description:i.description,experimental:i.experimental,installedAndEnabled:Ue.isEnabled(i.id)}));return`${`***Available Extensions:***
${JSON.stringify(t,null,2)}`}

${r}`},priority:10},Hu={enhance:async(r,e)=>Dt.getWorkspace().then(t=>{const n={workspace:t?.getName(),activeEditor:$r.getEditorArea()?.getActiveEditor()};return`${`***App's state:***
${JSON.stringify(n,null,2)}`}

${r}`}),priority:20};Me.registerContribution(Kn,{label:"Extensions Enhancer",enhancer:Vu});Me.registerContribution(Kn,{label:"App State Enhancer",enhancer:Hu});async function Ti(r,e=!0){const t=await Dt.getWorkspace();if(!t)return null;const n=r?.path;return e&&!n?null:{workspace:t,path:n||""}}async function Yn(r,e=!0){const t=await Ti(r,e);if(!t)return null;const{workspace:n,path:i}=t;if(!i)return null;try{const o=await n.getResource(i);return!o||!(o instanceof sr)?null:{workspace:n,path:i,file:o}}catch{return null}}lt({command:{id:"create_file",name:"Create new file",description:"Creates a new file within the workspace. For .geospace map files, use create_map_file instead.",keyBinding:"CTRL+N",parameters:[{name:"path",description:"the path including name of the file to be created, must be relative to the workspace",required:!1},{name:"contents",description:"the textual contents of the file",required:!1},{name:"ask",description:"whether to prompt the user for the file path",required:!1},{name:"extension",description:"required file extension (e.g., '.geospace'), will be appended if missing",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async({params:r})=>{let e=r?.path;const t=r?.contents,n=r?.ask,i=r?.extension;if((n||!e)&&(e=await Wn("Enter path to new file (directories will be created if not exist):",e||""),!e))return;i&&!e.endsWith(i)&&(e+=i);const o=await Ti({path:e},!0);if(!o)return;const{workspace:a}=o;if(await a.getResource(e)&&!await fn(`File "${e}" already exists. Do you want to overwrite it?`))return;const f=await a.getResource(e,{create:!0});return f?(t&&await f.saveContents(t),tt.info("File created: "+e)):Ze("Could not create file: "+e),e}}});lt({command:{id:"rename_resource",name:"Rename a resource (file or directory)",description:"Renames a resource (file or directory)",keyBinding:"F2",parameters:[{name:"path",description:"the path of the resource within the workspace to rename or the currently active selection",required:!1},{name:"newName",description:"the new name for the resource",required:!1}]},handler:{execute:async r=>{let e,t=r.params&&r.params.path;if(t){const o=await Dt.getWorkspace();o&&(e=await o.getResource(t))}if(e||(e=er.get()),!e){Ze("No resource to rename provided!");return}const n=e.getName(),i=r.params?.newName||await Wn(`Enter new name for "${n}":`,n);if(!(!i||i===n))try{await e.rename(i),tr(`Resource renamed to: ${i}`)}catch(o){Ze(`Failed to rename ${n}: ${o.message}`)}}}});lt({command:{id:"delete_resource",name:"Delete a resource (file or directory)",description:"Deletes a resource (file or directory)",parameters:[{name:"path",description:"the path of the resource within the workspace to delete or the currently active selection",required:!1},{name:"confirm",description:"whether to ask the user to confirm the deletion, true by default",required:!1}]},handler:{execute:async r=>{let e,t=r.params&&r.params.path;if(t){const o=await Dt.getWorkspace();o&&(e=await o.getResource(t))}if(e||(e=er.get()),!e){Ze("No resource to delete provided!");return}t=e.getWorkspacePath();const n=r.params&&r.params.confirm;let i=!0;if((n===void 0||n===!0)&&(i=await fn(`Are you sure you want to delete ${t}?`)),i)try{await e.delete(),tr("Resource deleted: "+t)}catch(o){Ze(`Resource ${t} could not be deleted: ${o.message||o}`)}}}});lt({command:{id:"load_workspace",name:"Local Folder",description:"Connect to a local folder using File System Access API",parameters:[]},handler:{execute:async r=>{await window.showDirectoryPicker({mode:"readwrite"}).then(e=>Dt.connectWorkspace(e)).catch(e=>{Ze(e.message)})}},contribution:{target:"filebrowser.connections",label:"Local Folder",icon:"folder-open"}});lt({command:{id:"reload_workspace",name:"Reload workspace folder",description:"Reloads the active workspace folder",parameters:[]},handler:{execute:async r=>{const e=await Dt.getWorkspace();e||Ze("No workspace selected."),e.touch()}}});lt({command:{id:"open_editor",name:"Open editor",description:"Opens a file in an editor",parameters:[{name:"path",description:"tha path of the file to open within the workspace",required:!0}]},handler:{execute:async r=>{const e=await Yn({path:r.params?.path});if(!e)return;const{file:t}=e;await $r.loadEditor(t)}}});lt({command:{id:"head_file",name:"Head - Show first lines",description:"Shows the first N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the beginning (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the first N lines of the file"}]},handler:{execute:async({params:r})=>{const e=await Yn(r);if(!e)return;const{file:t}=e,n=r?.lines?parseInt(r.lines,10):10;if(isNaN(n)||n<1){Ze("Number of lines must be a positive integer");return}try{const i=await t.getContents();if(typeof i!="string"){Ze("File is not a text file");return}return i.split(`
`).slice(0,n).join(`
`)}catch(i){Ze(`Failed to read file: ${i.message}`);return}}}});lt({command:{id:"tail_file",name:"Tail - Show last lines",description:"Shows the last N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the end (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the last N lines of the file"}]},handler:{execute:async({params:r})=>{const e=await Yn(r);if(!e)return;const{file:t}=e,n=r?.lines?parseInt(r.lines,10):10;if(isNaN(n)||n<1){Ze("Number of lines must be a positive integer");return}try{const i=await t.getContents();if(typeof i!="string"){Ze("File is not a text file");return}return i.split(`
`).slice(-n).join(`
`)}catch(i){Ze(`Failed to read file: ${i.message}`);return}}}});lt({command:{id:"cat_file",name:"Cat - Show file contents",description:"Shows the complete contents of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0}],output:[{name:"content",description:"the complete contents of the file"}]},handler:{execute:async({params:r})=>{const e=await Yn(r);if(!e)return;const{file:t}=e;try{const n=await t.getContents();if(typeof n!="string"){Ze("File is not a text file");return}return n}catch(n){Ze(`Failed to read file: ${n.message}`);return}}}});lt({command:{id:"wc_file",name:"Word count",description:"Counts lines, words, and characters in a file",parameters:[{name:"path",description:"the path of the file to analyze",required:!0}],output:[{name:"lines",description:"number of lines in the file"},{name:"words",description:"number of words in the file"},{name:"characters",description:"number of characters in the file"}]},handler:{execute:async({params:r})=>{const e=await Yn(r);if(!e)return;const{file:t}=e;try{const n=await t.getContents();if(typeof n!="string"){Ze("File is not a text file");return}const o=n.split(`
`).length,a=n.trim()===""?0:n.trim().split(/\s+/).filter(f=>f.length>0).length,c=n.length;return{lines:o,words:a,characters:c}}catch(n){Ze(`Failed to read file: ${n.message}`);return}}}});lt({command:{id:"file_exists",name:"Check if file exists",description:"Checks if a file exists at the given path",parameters:[{name:"path",description:"the path of the file to check, relative to the workspace",required:!0}],output:[{name:"exists",description:"true if the file exists, false otherwise"}]},handler:{execute:async({params:r})=>{const e=await Ti(r);if(!e)return!1;const{workspace:t,path:n}=e;try{return await t.getResource(n)instanceof sr}catch{return!1}}}});async function po(r){const e=[],t=await r.listChildren(!0);for(const n of t)if(n instanceof sr)e.push(n.getWorkspacePath());else if(n instanceof on){const i=await po(n);e.push(...i)}return e}lt({command:{id:"ls",name:"List files",description:"Lists files from a directory. If recursive is provided, it traverses from the provided directory down to all leaves. If no directory is provided, it will traverse from the workspace root.",parameters:[{name:"path",description:"the path of the directory to list, relative to the workspace. If not provided, uses workspace root",required:!1},{name:"recursive",description:"whether to recursively traverse all subdirectories",type:"boolean",required:!1}],output:[{name:"files",description:"array of file objects with path and size information"}]},handler:{execute:async({params:r})=>{const e=await Ti(r,!1);if(!e)return Ze("No workspace available"),[];const{workspace:t,path:n}=e,i=r?.recursive===!0||r?.recursive==="true";try{let o=t;if(n){const a=await t.getResource(n);if(!a)return Ze(`Path not found: ${n}`),[];if(!(a instanceof on))return Ze(`Path is not a directory: ${n}`),[];o=a}if(i){const a=await po(o),c=[];for(const f of a){const y=await t.getResource(f);if(y instanceof sr){const R=await y.size();c.push({path:f,size:R})}}return c}else{const a=await o.listChildren(!0),c=[];for(const f of a)if(f instanceof sr){const y=await f.size();c.push({path:f.getWorkspacePath(),size:y})}return c}}catch(o){return Ze(`Failed to list files: ${o.message}`),[]}}}});var _r={},ur={},ta;function Ku(){if(ta)return ur;ta=1,Object.defineProperty(ur,"__esModule",{value:!0});function r(p){const s=p||"";return function(){throw new Error("this method "+s+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function e(p,s){if(!p)throw new Error(s||"Assertion failed")}function t(p,s,l){let d;Object.defineProperty(p,s,{get(){return d||(d=l.call(this)),d}})}function n(p){return p&&Object.assign({},p)}function i(p,s){const l=[];for(;s-- >0;)l.push(p());return l}function o(p,s){return new Array(s+1).join(p)}function a(p,s){return i(()=>p,s)}function c(p){const s=[];for(let l=0;l<p.length;l++){const d=p[l];p.lastIndexOf(d)!==l&&s.indexOf(d)<0&&s.push(d)}return s}function f(p){const s=[];return p.forEach(l=>{s.indexOf(l)<0&&s.push(l)}),s}function y(p){const s=p[0];return s===s.toUpperCase()}function R(p){return!y(p)}function b(p,s,l){const d=l||" ";return p.length<s?o(d,s-p.length)+p:p}function x(){this.strings=[]}x.prototype.append=function(p){this.strings.push(p)},x.prototype.contents=function(){return this.strings.join("")};const _=p=>String.fromCodePoint(parseInt(p,16));function D(p){if(p.charAt(0)==="\\")switch(p.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return _(p.slice(2,4));case"u":return p.charAt(2)==="{"?_(p.slice(3,-1)):_(p.slice(2,6));default:return p.charAt(1)}else return p}function Y(p){if(p==null)return String(p);const s=Object.prototype.toString.call(p);try{let l;return p.constructor&&p.constructor.name?l=p.constructor.name:s.indexOf("[object ")===0?l=s.slice(8,-1):l=typeof p,l+": "+JSON.stringify(String(p))}catch{return s}}var ve=Object.freeze({__proto__:null,abstract:r,assert:e,defineLazyProperty:t,clone:n,repeatFn:i,repeatStr:o,repeat:a,getDuplicates:c,copyWithoutDuplicates:f,isSyntactic:y,isLexical:R,padLeft:b,StringBuffer:x,unescapeCodePoint:D,unexpectedObjToString:Y});const xe={Lu:new RegExp("\\p{Lu}","u"),Ll:new RegExp("\\p{Ll}","u"),Lt:new RegExp("\\p{Lt}","u"),Lm:new RegExp("\\p{Lm}","u"),Lo:new RegExp("\\p{Lo}","u"),Nl:new RegExp("\\p{Nl}","u"),Nd:new RegExp("\\p{Nd}","u"),Mn:new RegExp("\\p{Mn}","u"),Mc:new RegExp("\\p{Mc}","u"),Pc:new RegExp("\\p{Pc}","u"),Zs:new RegExp("\\p{Zs}","u"),L:new RegExp("\\p{Letter}","u"),Ltmo:new RegExp("\\p{Lt}|\\p{Lm}|\\p{Lo}","u")};class W{constructor(){if(this.constructor===W)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(s){return s&&(this.source=s.trimmed()),this}}const N=Object.create(W.prototype),K=Object.create(W.prototype);class U extends W{constructor(s){super(),this.obj=s}}class O extends W{constructor(s,l){super(),this.from=s,this.to=l,this.matchCodePoint=s.length>1||l.length>1}}class B extends W{constructor(s){super(),this.index=s}}class ee extends W{constructor(s){super(),this.terms=s}}class Te extends ee{constructor(s,l,d){const v=s.rules[l].body;super([d,v]),this.superGrammar=s,this.name=l,this.body=d}}class Pe extends ee{constructor(s,l,d,v){const T=s.rules[l].body;super([...d,T,...v]),this.superGrammar=s,this.ruleName=l,this.expansionPos=d.length}}class he extends W{constructor(s){super(),this.factors=s}}class z extends W{constructor(s){super(),this.expr=s}}class le extends z{}class ye extends z{}class ke extends z{}le.prototype.operator="*",ye.prototype.operator="+",ke.prototype.operator="?",le.prototype.minNumMatches=0,ye.prototype.minNumMatches=1,ke.prototype.minNumMatches=0,le.prototype.maxNumMatches=Number.POSITIVE_INFINITY,ye.prototype.maxNumMatches=Number.POSITIVE_INFINITY,ke.prototype.maxNumMatches=1;class X extends W{constructor(s){super(),this.expr=s}}class se extends W{constructor(s){super(),this.expr=s}}class me extends W{constructor(s){super(),this.expr=s}}class Z extends W{constructor(s,l=[]){super(),this.ruleName=s,this.args=l}isSyntactic(){return y(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class Ce extends W{constructor(s){super(),this.category=s,this.pattern=xe[s]}}function Ne(p,s){let l;return s?(l=new Error(s.getLineAndColumnMessage()+p),l.shortMessage=p,l.interval=s):l=new Error(p),l}function w(){return Ne("Interval sources don't match")}function I(p){const s=new Error;return Object.defineProperty(s,"message",{enumerable:!0,get(){return p.message}}),Object.defineProperty(s,"shortMessage",{enumerable:!0,get(){return"Expected "+p.getExpectedText()}}),s.interval=p.getInterval(),s}function fe(p,s,l){const d=s?`Grammar ${p} is not declared in namespace '${s}'`:"Undeclared grammar "+p;return Ne(d,l)}function Re(p,s){return Ne("Grammar "+p.name+" is already declared in this namespace")}function Ye(p){return Ne(`Grammar '${p.name}' does not support incremental parsing`)}function We(p,s,l){return Ne("Rule "+p+" is not declared in grammar "+s,l)}function P(p,s,l){return Ne("Cannot override rule "+p+" because it is not declared in "+s,l)}function q(p,s,l){return Ne("Cannot extend rule "+p+" because it is not declared in "+s,l)}function $(p,s,l,d){let v="Duplicate declaration for rule '"+p+"' in grammar '"+s+"'";return s!==l&&(v+=" (originally declared in '"+l+"')"),Ne(v,d)}function Q(p,s,l,d){return Ne("Wrong number of parameters for rule "+p+" (expected "+s+", got "+l+")",d)}function ue(p,s,l,d){return Ne("Wrong number of arguments for rule "+p+" (expected "+s+", got "+l+")",d)}function ae(p,s,l){return Ne("Duplicate parameter names in rule "+p+": "+s.join(", "),l)}function V(p,s){return Ne("Invalid parameter to rule "+p+": "+s+" has arity "+s.getArity()+", but parameter expressions must have arity 1",s.source)}const ce="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function we(p,s){return Ne("Cannot apply syntactic rule "+p+" from here (inside a lexical context)",s.source)}function qe(p){const{ruleName:s}=p;return Ne(`applySyntactic is for syntactic rules, but '${s}' is a lexical rule. `+ce,p.source)}function Ge(p){return Ne("applySyntactic is not required here (in a syntactic context)",p.source)}function Ie(p,s){return Ne("Incorrect argument type: expected "+p,s.source)}function Ae(p){return Ne("'...' can appear at most once in a rule body",p.source)}function L(p){const s=p._node;e(s&&s.isNonterminal()&&s.ctorName==="escapeChar_unicodeCodePoint");const l=p.children.slice(1,-1).map(v=>v.source),d=l[0].coverageWith(...l.slice(1));return Ne(`U+${d.contents} is not a valid Unicode code point`,d)}function k(p,s){const l=s.length>0?s[s.length-1].args:[];let v="Nullable expression "+p.expr.substituteParams(l)+" is not allowed inside '"+p.operator+"' (possible infinite loop)";if(s.length>0){const T=s.map(j=>new Z(j.ruleName,j.args)).join(`
`);v+=`
Application stack (most recent application last):
`+T}return Ne(v,p.expr.source)}function M(p,s,l,d){return Ne("Rule "+p+" involves an alternation which has inconsistent arity (expected "+s+", got "+l+")",d.source)}function H(p){const s=p.map(l=>l.message);return Ne(["Errors:"].concat(s).join(`
- `),p[0].interval)}function J(p,s,l,d){let v=d.slice(0,-1).map(oe=>{const Se="  "+oe[0].name+" > "+oe[1];return oe.length===3?Se+" for '"+oe[2]+"'":Se}).join(`
`);v+=`
  `+s+" > "+p;let T="";p==="_iter"&&(T=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes — see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));const j=[`Missing semantic action for '${p}' in ${l} '${s}'.${T}`,"Action stack (most recent call last):",v].join(`
`),pe=Ne(j);return pe.name="missingSemanticAction",pe}function te(p){if(p.length===1)throw p[0];if(p.length>1)throw H(p)}function _e(p){let s=0;return p.map(d=>{const v=d.toString();return s=Math.max(s,v.length),v}).map(d=>b(d,s))}function Le(p,s,l){const d=p.length,v=p.slice(0,l),T=p.slice(l+s.length);return(v+s+T).substr(0,d)}function Ke(...p){const s=this,{offset:l}=s,{repeatStr:d}=ve,v=new x;v.append("Line "+s.lineNum+", col "+s.colNum+`:
`);const T=_e([s.prevLine==null?0:s.lineNum-1,s.lineNum,s.nextLine==null?0:s.lineNum+1]),j=(ne,re,ge)=>{v.append(ge+T[ne]+" | "+re+`
`)};s.prevLine!=null&&j(0,s.prevLine,"  "),j(1,s.line,"> ");const pe=s.line.length;let oe=d(" ",pe+1);for(let ne=0;ne<p.length;++ne){let re=p[ne][0],ge=p[ne][1];e(re>=0&&re<=ge,"range start must be >= 0 and <= end");const $e=l-s.colNum+1;re=Math.max(0,re-$e),ge=Math.min(ge-$e,pe),oe=Le(oe,d("~",ge-re),re)}const Se=2+T[1].length+3;return v.append(d(" ",Se)),oe=Le(oe,"^",s.colNum-1),v.append(oe.replace(/ +$/,"")+`
`),s.nextLine!=null&&j(2,s.nextLine,"  "),v.contents()}let st=[];function It(p){st.push(p)}function de(p){st.forEach(s=>{s(p)}),st=null}function rr(p,s){let l=1,d=1,v=0,T=0,j=null,pe=null,oe=-1;for(;v<s;){const re=p.charAt(v++);re===`
`?(l++,d=1,oe=T,T=v):re!=="\r"&&d++}let Se=p.indexOf(`
`,T);if(Se===-1)Se=p.length;else{const re=p.indexOf(`
`,Se+1);j=re===-1?p.slice(Se):p.slice(Se,re),j=j.replace(/^\r?\n/,"").replace(/\r$/,"")}oe>=0&&(pe=p.slice(oe,T).replace(/\r?\n$/,""));const ne=p.slice(T,Se).replace(/\r$/,"");return{offset:s,lineNum:l,colNum:d,line:ne,prevLine:pe,nextLine:j,toString:Ke}}function Qt(p,s,...l){return rr(p,s).toString(...l)}const Tt=(()=>{let p=0;return s=>""+s+p++})();class pt{constructor(s,l,d){this.sourceString=s,this.startIdx=l,this.endIdx=d}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...s){return pt.coverage(...s,this)}collapsedLeft(){return new pt(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new pt(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return rr(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const s=[this.startIdx,this.endIdx];return Qt(this.sourceString,this.startIdx,s)}minus(s){if(this.sourceString!==s.sourceString)throw w();return this.startIdx===s.startIdx&&this.endIdx===s.endIdx?[]:this.startIdx<s.startIdx&&s.endIdx<this.endIdx?[new pt(this.sourceString,this.startIdx,s.startIdx),new pt(this.sourceString,s.endIdx,this.endIdx)]:this.startIdx<s.endIdx&&s.endIdx<this.endIdx?[new pt(this.sourceString,s.endIdx,this.endIdx)]:this.startIdx<s.startIdx&&s.startIdx<this.endIdx?[new pt(this.sourceString,this.startIdx,s.startIdx)]:[this]}relativeTo(s){if(this.sourceString!==s.sourceString)throw w();return e(this.startIdx>=s.startIdx&&this.endIdx<=s.endIdx,"other interval does not cover this one"),new pt(this.sourceString,this.startIdx-s.startIdx,this.endIdx-s.startIdx)}trimmed(){const{contents:s}=this,l=this.startIdx+s.match(/^\s*/)[0].length,d=this.endIdx-s.match(/\s*$/)[0].length;return new pt(this.sourceString,l,d)}subInterval(s,l){const d=this.startIdx+s;return new pt(this.sourceString,d,d+l)}}pt.coverage=function(p,...s){let{startIdx:l,endIdx:d}=p;for(const v of s){if(v.sourceString!==p.sourceString)throw w();l=Math.min(l,v.startIdx),d=Math.max(d,v.endIdx)}return new pt(p.sourceString,l,d)};const Gt=65535;class He{constructor(s){this.source=s,this.pos=0,this.examinedLength=0}atEnd(){const s=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),s}next(){const s=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),s}nextCharCode(){const s=this.next();return s&&s.charCodeAt(0)}nextCodePoint(){const s=this.source.slice(this.pos++).codePointAt(0);return s>Gt&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),s}matchString(s,l){let d;if(l){for(d=0;d<s.length;d++){const v=this.next(),T=s[d];if(v==null||v.toUpperCase()!==T.toUpperCase())return!1}return!0}for(d=0;d<s.length;d++)if(this.next()!==s[d])return!1;return!0}sourceSlice(s,l){return this.source.slice(s,l)}interval(s,l){return new pt(this.source,s,l||this.pos)}}class m{constructor(s,l,d,v,T,j,pe){this.matcher=s,this.input=l,this.startExpr=d,this._cst=v,this._cstOffset=T,this._rightmostFailurePosition=j,this._rightmostFailures=pe,this.failed()&&(t(this,"message",function(){const oe="Expected "+this.getExpectedText();return Qt(this.input,this.getRightmostFailurePosition())+oe}),t(this,"shortMessage",function(){const oe="expected "+this.getExpectedText(),Se=rr(this.input,this.getRightmostFailurePosition());return"Line "+Se.lineNum+", col "+Se.colNum+": "+oe}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const s=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=s.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const s=new x;let l=this.getRightmostFailures();l=l.filter(d=>!d.isFluffy());for(let d=0;d<l.length;d++)d>0&&(d===l.length-1?s.append(l.length>2?", or ":" or "):s.append(", ")),s.append(l[d].toString());return s.contents()}getInterval(){const s=this.getRightmostFailurePosition();return new pt(this.input,s,s)}}class S{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(s){return this.applicationMemoKeyStack.indexOf(s.toMemoKey())>=0}enter(s){this.applicationMemoKeyStack.push(s.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(s,l){l.isLeftRecursion=!0,l.headApplication=s,l.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=l;const{applicationMemoKeyStack:d}=this,v=d.indexOf(s.toMemoKey())+1,T=d.slice(v);l.isInvolved=function(j){return T.indexOf(j)>=0},l.updateInvolvedApplicationMemoKeys=function(){for(let j=v;j<d.length;j++){const pe=d[j];this.isInvolved(pe)||T.push(pe)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(s){if(!s.isLeftRecursion)return!0;const{applicationMemoKeyStack:l}=this;for(let d=0;d<l.length;d++){const v=l[d];if(s.isInvolved(v))return!1}return!0}memoize(s,l){return this.memo[s]=l,this.maxExaminedLength=Math.max(this.maxExaminedLength,l.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,l.rightmostFailureOffset),l}clearObsoleteEntries(s,l){if(s+this.maxExaminedLength<=l)return;const{memo:d}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(d).forEach(v=>{const T=d[v];s+T.examinedLength>l?delete d[v]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,T.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,T.rightmostFailureOffset))})}}const E="✗",u="✓",h="⋅",g="⇒",A="␉",C="␊",F="␍",ie={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function be(p){return a(" ",p).join("")}function Ee(p,s,l){const d=Qe(p.slice(s,s+l));return d.length<l?d+a(" ",l-d.length).join(""):d}function Qe(p){return typeof p=="string"?p.replace(/ /g,h).replace(/\t/g,A).replace(/\n/g,C).replace(/\r/g,F):String(p)}class De{constructor(s,l,d,v,T,j,pe){this.input=s,this.pos=this.pos1=l,this.pos2=d,this.source=new pt(s,l,d),this.expr=v,this.bindings=j,this.children=pe||[],this.terminatingLREntry=null,this._flags=T?ie.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(s){const l=new De(this.input,this.pos,this.pos2,s,this.succeeded,this.bindings,this.children);return l.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,l.isImplicitSpaces=this.isImplicitSpaces,l.isMemoized=this.isMemoized,l.isRootNode=this.isRootNode,l.terminatesLR=this.terminatesLR,l.terminatingLREntry=this.terminatingLREntry,l}recordLRTermination(s,l){this.terminatingLREntry=new De(this.input,this.pos,this.pos2,this.expr,!1,[l],[s]),this.terminatingLREntry.terminatesLR=!0}walk(s,l){let d=s;typeof d=="function"&&(d={enter:d});function v(T,j,pe){let oe=!0;d.enter&&d.enter.call(l,T,j,pe)===De.prototype.SKIP&&(oe=!1),oe&&(T.children.forEach(Se=>{v(Se,T,pe+1)}),d.exit&&d.exit.call(l,T,j,pe))}this.isRootNode?this.children.forEach(T=>{v(T,null,0)}):v(this,null,0)}toString(){const s=new x;return this.walk((l,d,v)=>{if(!l)return this.SKIP;if(l.expr.constructor.name!=="Alt"){if(s.append(Ee(l.input,l.pos,10)+be(v*2+1)),s.append((l.succeeded?u:E)+" "+l.displayString),l.isHeadOfLeftRecursion&&s.append(" (LR)"),l.succeeded){const j=Qe(l.source.contents);s.append(" "+g+"  "),s.append(typeof j=="string"?'"'+j+'"':j)}s.append(`
`)}}),s.contents()}}De.prototype.SKIP={},Object.keys(ie).forEach(p=>{const s=ie[p];Object.defineProperty(De.prototype,p,{get(){return(this._flags&s)!==0},set(l){l?this._flags|=s:this._flags&=~s}})}),W.prototype.allowsSkippingPrecedingSpace=r("allowsSkippingPrecedingSpace"),N.allowsSkippingPrecedingSpace=K.allowsSkippingPrecedingSpace=Z.prototype.allowsSkippingPrecedingSpace=U.prototype.allowsSkippingPrecedingSpace=O.prototype.allowsSkippingPrecedingSpace=Ce.prototype.allowsSkippingPrecedingSpace=function(){return!0},ee.prototype.allowsSkippingPrecedingSpace=z.prototype.allowsSkippingPrecedingSpace=me.prototype.allowsSkippingPrecedingSpace=se.prototype.allowsSkippingPrecedingSpace=X.prototype.allowsSkippingPrecedingSpace=B.prototype.allowsSkippingPrecedingSpace=he.prototype.allowsSkippingPrecedingSpace=function(){return!1};let et;It(p=>{et=p});let Je;W.prototype.assertAllApplicationsAreValid=function(p,s){Je=0,this._assertAllApplicationsAreValid(p,s)},W.prototype._assertAllApplicationsAreValid=r("_assertAllApplicationsAreValid"),N._assertAllApplicationsAreValid=K._assertAllApplicationsAreValid=U.prototype._assertAllApplicationsAreValid=O.prototype._assertAllApplicationsAreValid=B.prototype._assertAllApplicationsAreValid=Ce.prototype._assertAllApplicationsAreValid=function(p,s){},me.prototype._assertAllApplicationsAreValid=function(p,s){Je++,this.expr._assertAllApplicationsAreValid(p,s),Je--},ee.prototype._assertAllApplicationsAreValid=function(p,s){for(let l=0;l<this.terms.length;l++)this.terms[l]._assertAllApplicationsAreValid(p,s)},he.prototype._assertAllApplicationsAreValid=function(p,s){for(let l=0;l<this.factors.length;l++)this.factors[l]._assertAllApplicationsAreValid(p,s)},z.prototype._assertAllApplicationsAreValid=X.prototype._assertAllApplicationsAreValid=se.prototype._assertAllApplicationsAreValid=function(p,s){this.expr._assertAllApplicationsAreValid(p,s)},Z.prototype._assertAllApplicationsAreValid=function(p,s,l=!1){const d=s.rules[this.ruleName],v=y(p)&&Je===0;if(!d)throw We(this.ruleName,s.name,this.source);if(!l&&y(this.ruleName)&&!v)throw we(this.ruleName,this);const T=this.args.length,j=d.formals.length;if(T!==j)throw ue(this.ruleName,j,T,this.source);const pe=et&&d===et.rules.applySyntactic;if(et&&d===et.rules.caseInsensitive&&!(this.args[0]instanceof U))throw Ie('a Terminal (e.g. "abc")',this.args[0]);if(pe){const Se=this.args[0];if(!(Se instanceof Z))throw Ie("a syntactic rule application",Se);if(!y(Se.ruleName))throw qe(Se);if(v)throw Ge(this)}this.args.forEach(Se=>{if(Se._assertAllApplicationsAreValid(p,s,pe),Se.getArity()!==1)throw V(this.ruleName,Se)})},W.prototype.assertChoicesHaveUniformArity=r("assertChoicesHaveUniformArity"),N.assertChoicesHaveUniformArity=K.assertChoicesHaveUniformArity=U.prototype.assertChoicesHaveUniformArity=O.prototype.assertChoicesHaveUniformArity=B.prototype.assertChoicesHaveUniformArity=me.prototype.assertChoicesHaveUniformArity=Ce.prototype.assertChoicesHaveUniformArity=function(p){},ee.prototype.assertChoicesHaveUniformArity=function(p){if(this.terms.length===0)return;const s=this.terms[0].getArity();for(let l=0;l<this.terms.length;l++){const d=this.terms[l];d.assertChoicesHaveUniformArity();const v=d.getArity();if(s!==v)throw M(p,s,v,d)}},Te.prototype.assertChoicesHaveUniformArity=function(p){const s=this.terms[0].getArity(),l=this.terms[1].getArity();if(s!==l)throw M(p,l,s,this.terms[0])},he.prototype.assertChoicesHaveUniformArity=function(p){for(let s=0;s<this.factors.length;s++)this.factors[s].assertChoicesHaveUniformArity(p)},z.prototype.assertChoicesHaveUniformArity=function(p){this.expr.assertChoicesHaveUniformArity(p)},X.prototype.assertChoicesHaveUniformArity=function(p){},se.prototype.assertChoicesHaveUniformArity=function(p){this.expr.assertChoicesHaveUniformArity(p)},Z.prototype.assertChoicesHaveUniformArity=function(p){},W.prototype.assertIteratedExprsAreNotNullable=r("assertIteratedExprsAreNotNullable"),N.assertIteratedExprsAreNotNullable=K.assertIteratedExprsAreNotNullable=U.prototype.assertIteratedExprsAreNotNullable=O.prototype.assertIteratedExprsAreNotNullable=B.prototype.assertIteratedExprsAreNotNullable=Ce.prototype.assertIteratedExprsAreNotNullable=function(p){},ee.prototype.assertIteratedExprsAreNotNullable=function(p){for(let s=0;s<this.terms.length;s++)this.terms[s].assertIteratedExprsAreNotNullable(p)},he.prototype.assertIteratedExprsAreNotNullable=function(p){for(let s=0;s<this.factors.length;s++)this.factors[s].assertIteratedExprsAreNotNullable(p)},z.prototype.assertIteratedExprsAreNotNullable=function(p){if(this.expr.assertIteratedExprsAreNotNullable(p),this.expr.isNullable(p))throw k(this,[])},ke.prototype.assertIteratedExprsAreNotNullable=X.prototype.assertIteratedExprsAreNotNullable=se.prototype.assertIteratedExprsAreNotNullable=me.prototype.assertIteratedExprsAreNotNullable=function(p){this.expr.assertIteratedExprsAreNotNullable(p)},Z.prototype.assertIteratedExprsAreNotNullable=function(p){this.args.forEach(s=>{s.assertIteratedExprsAreNotNullable(p)})};class vt{constructor(s){this.matchLength=s}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(s){if(this.children)return this.children[s]}indexOfChild(s){return this.children.indexOf(s)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(s){const l=this.indexOfChild(s);if(l<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(l===0)throw new Error("cannot get child before first child");return this.childAt(l-1)}childAfter(s){const l=this.indexOfChild(s);if(l<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(l===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(l+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class ze extends vt{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class ht extends vt{constructor(s,l,d,v){super(v),this.ruleName=s,this.children=l,this.childOffsets=d}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return R(this.ctorName)}isSyntactic(){return y(this.ctorName)}}class Vt extends vt{constructor(s,l,d,v){super(d),this.children=s,this.childOffsets=l,this.optional=v}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}W.prototype.eval=r("eval"),N.eval=function(p){const{inputStream:s}=p,l=s.pos,d=s.nextCodePoint();return d!==void 0?(p.pushBinding(new ze(String.fromCodePoint(d).length),l),!0):(p.processFailure(l,this),!1)},K.eval=function(p){const{inputStream:s}=p,l=s.pos;return s.atEnd()?(p.pushBinding(new ze(0),l),!0):(p.processFailure(l,this),!1)},U.prototype.eval=function(p){const{inputStream:s}=p,l=s.pos;return s.matchString(this.obj)?(p.pushBinding(new ze(this.obj.length),l),!0):(p.processFailure(l,this),!1)},O.prototype.eval=function(p){const{inputStream:s}=p,l=s.pos,d=this.matchCodePoint?s.nextCodePoint():s.nextCharCode();return d!==void 0&&this.from.codePointAt(0)<=d&&d<=this.to.codePointAt(0)?(p.pushBinding(new ze(String.fromCodePoint(d).length),l),!0):(p.processFailure(l,this),!1)},B.prototype.eval=function(p){return p.eval(p.currentApplication().args[this.index])},me.prototype.eval=function(p){p.enterLexifiedContext();const s=p.eval(this.expr);return p.exitLexifiedContext(),s},ee.prototype.eval=function(p){for(let s=0;s<this.terms.length;s++)if(p.eval(this.terms[s]))return!0;return!1},he.prototype.eval=function(p){for(let s=0;s<this.factors.length;s++){const l=this.factors[s];if(!p.eval(l))return!1}return!0},z.prototype.eval=function(p){const{inputStream:s}=p,l=s.pos,d=this.getArity(),v=[],T=[];for(;v.length<d;)v.push([]),T.push([]);let j=0,pe=l,oe;for(;j<this.maxNumMatches&&p.eval(this.expr);){if(s.pos===pe)throw k(this,p._applicationStack);pe=s.pos,j++;const ge=p._bindings.splice(p._bindings.length-d,d),$e=p._bindingOffsets.splice(p._bindingOffsets.length-d,d);for(oe=0;oe<ge.length;oe++)v[oe].push(ge[oe]),T[oe].push($e[oe])}if(j<this.minNumMatches)return!1;let Se=p.posToOffset(l),ne=0;if(j>0){const ge=v[d-1],$e=T[d-1],nt=$e[$e.length-1]+ge[ge.length-1].matchLength;Se=T[0][0],ne=nt-Se}const re=this instanceof ke;for(oe=0;oe<v.length;oe++)p._bindings.push(new Vt(v[oe],T[oe],ne,re)),p._bindingOffsets.push(Se);return!0},X.prototype.eval=function(p){const{inputStream:s}=p,l=s.pos;p.pushFailuresInfo();const d=p.eval(this.expr);return p.popFailuresInfo(),d?(p.processFailure(l,this),!1):(s.pos=l,!0)},se.prototype.eval=function(p){const{inputStream:s}=p,l=s.pos;return p.eval(this.expr)?(s.pos=l,!0):!1},Z.prototype.eval=function(p){const s=p.currentApplication(),l=s?s.args:[],d=this.substituteParams(l),v=p.getCurrentPosInfo();if(v.isActive(d))return d.handleCycle(p);const T=d.toMemoKey(),j=v.memo[T];if(j&&v.shouldUseMemoizedResult(j)){if(p.hasNecessaryInfo(j))return p.useMemoizedResult(p.inputStream.pos,j);delete v.memo[T]}return d.reallyEval(p)},Z.prototype.handleCycle=function(p){const s=p.getCurrentPosInfo(),{currentLeftRecursion:l}=s,d=this.toMemoKey();let v=s.memo[d];return l&&l.headApplication.toMemoKey()===d?v.updateInvolvedApplicationMemoKeys():v||(v=s.memoize(d,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),s.startLeftRecursion(this,v)),p.useMemoizedResult(p.inputStream.pos,v)},Z.prototype.reallyEval=function(p){const{inputStream:s}=p,l=s.pos,d=p.getCurrentPosInfo(),v=p.grammar.rules[this.ruleName],{body:T}=v,{description:j}=v;p.enterApplication(d,this),j&&p.pushFailuresInfo();const pe=s.examinedLength;s.examinedLength=0;let oe=this.evalOnce(T,p);const Se=d.currentLeftRecursion,ne=this.toMemoKey(),re=Se&&Se.headApplication.toMemoKey()===ne;let ge;p.doNotMemoize?p.doNotMemoize=!1:re?(oe=this.growSeedResult(T,p,l,Se,oe),d.endLeftRecursion(),ge=Se,ge.examinedLength=s.examinedLength-l,ge.rightmostFailureOffset=p._getRightmostFailureOffset(),d.memoize(ne,ge)):(!Se||!Se.isInvolved(ne))&&(ge=d.memoize(ne,{matchLength:s.pos-l,examinedLength:s.examinedLength-l,value:oe,failuresAtRightmostPosition:p.cloneRecordedFailures(),rightmostFailureOffset:p._getRightmostFailureOffset()}));const $e=!!oe;if(j&&(p.popFailuresInfo(),$e||p.processFailure(l,this),ge&&(ge.failuresAtRightmostPosition=p.cloneRecordedFailures())),p.isTracing()&&ge){const nt=p.getTraceEntry(l,this,$e,$e?[oe]:[]);re&&(e(nt.terminatingLREntry!=null||!$e),nt.isHeadOfLeftRecursion=!0),ge.traceEntry=nt}return s.examinedLength=Math.max(s.examinedLength,pe),p.exitApplication(d,oe),$e},Z.prototype.evalOnce=function(p,s){const{inputStream:l}=s,d=l.pos;if(s.eval(p)){const v=p.getArity(),T=s._bindings.splice(s._bindings.length-v,v),j=s._bindingOffsets.splice(s._bindingOffsets.length-v,v),pe=l.pos-d;return new ht(this.ruleName,T,j,pe)}else return!1},Z.prototype.growSeedResult=function(p,s,l,d,v){if(!v)return!1;const{inputStream:T}=s;for(;;){if(d.matchLength=T.pos-l,d.value=v,d.failuresAtRightmostPosition=s.cloneRecordedFailures(),s.isTracing()){const j=s.trace[s.trace.length-1];d.traceEntry=new De(s.input,l,T.pos,this,!0,[v],[j.clone()])}if(T.pos=l,v=this.evalOnce(p,s),T.pos-l<=d.matchLength)break;s.isTracing()&&s.trace.splice(-2,1)}return s.isTracing()&&d.traceEntry.recordLRTermination(s.trace.pop(),v),T.pos=l+d.matchLength,d.value},Ce.prototype.eval=function(p){const{inputStream:s}=p,l=s.pos,d=s.next();return d&&this.pattern.test(d)?(p.pushBinding(new ze(d.length),l),!0):(p.processFailure(l,this),!1)},W.prototype.getArity=r("getArity"),N.getArity=K.getArity=U.prototype.getArity=O.prototype.getArity=B.prototype.getArity=Z.prototype.getArity=Ce.prototype.getArity=function(){return 1},ee.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()},he.prototype.getArity=function(){let p=0;for(let s=0;s<this.factors.length;s++)p+=this.factors[s].getArity();return p},z.prototype.getArity=function(){return this.expr.getArity()},X.prototype.getArity=function(){return 0},se.prototype.getArity=me.prototype.getArity=function(){return this.expr.getArity()};function ot(p,s){const l={};if(p.source&&s){const d=p.source.relativeTo(s);l.sourceInterval=[d.startIdx,d.endIdx]}return l}W.prototype.outputRecipe=r("outputRecipe"),N.outputRecipe=function(p,s){return["any",ot(this,s)]},K.outputRecipe=function(p,s){return["end",ot(this,s)]},U.prototype.outputRecipe=function(p,s){return["terminal",ot(this,s),this.obj]},O.prototype.outputRecipe=function(p,s){return["range",ot(this,s),this.from,this.to]},B.prototype.outputRecipe=function(p,s){return["param",ot(this,s),this.index]},ee.prototype.outputRecipe=function(p,s){return["alt",ot(this,s)].concat(this.terms.map(l=>l.outputRecipe(p,s)))},Te.prototype.outputRecipe=function(p,s){return this.terms[0].outputRecipe(p,s)},Pe.prototype.outputRecipe=function(p,s){const l=this.terms.slice(0,this.expansionPos),d=this.terms.slice(this.expansionPos+1);return["splice",ot(this,s),l.map(v=>v.outputRecipe(p,s)),d.map(v=>v.outputRecipe(p,s))]},he.prototype.outputRecipe=function(p,s){return["seq",ot(this,s)].concat(this.factors.map(l=>l.outputRecipe(p,s)))},le.prototype.outputRecipe=ye.prototype.outputRecipe=ke.prototype.outputRecipe=X.prototype.outputRecipe=se.prototype.outputRecipe=me.prototype.outputRecipe=function(p,s){return[this.constructor.name.toLowerCase(),ot(this,s),this.expr.outputRecipe(p,s)]},Z.prototype.outputRecipe=function(p,s){return["app",ot(this,s),this.ruleName,this.args.map(l=>l.outputRecipe(p,s))]},Ce.prototype.outputRecipe=function(p,s){return["unicodeChar",ot(this,s),this.category]},W.prototype.introduceParams=r("introduceParams"),N.introduceParams=K.introduceParams=U.prototype.introduceParams=O.prototype.introduceParams=B.prototype.introduceParams=Ce.prototype.introduceParams=function(p){return this},ee.prototype.introduceParams=function(p){return this.terms.forEach((s,l,d)=>{d[l]=s.introduceParams(p)}),this},he.prototype.introduceParams=function(p){return this.factors.forEach((s,l,d)=>{d[l]=s.introduceParams(p)}),this},z.prototype.introduceParams=X.prototype.introduceParams=se.prototype.introduceParams=me.prototype.introduceParams=function(p){return this.expr=this.expr.introduceParams(p),this},Z.prototype.introduceParams=function(p){const s=p.indexOf(this.ruleName);if(s>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new B(s).withSource(this.source)}else return this.args.forEach((l,d,v)=>{v[d]=l.introduceParams(p)}),this},W.prototype.isNullable=function(p){return this._isNullable(p,Object.create(null))},W.prototype._isNullable=r("_isNullable"),N._isNullable=O.prototype._isNullable=B.prototype._isNullable=ye.prototype._isNullable=Ce.prototype._isNullable=function(p,s){return!1},K._isNullable=function(p,s){return!0},U.prototype._isNullable=function(p,s){return typeof this.obj=="string"?this.obj==="":!1},ee.prototype._isNullable=function(p,s){return this.terms.length===0||this.terms.some(l=>l._isNullable(p,s))},he.prototype._isNullable=function(p,s){return this.factors.every(l=>l._isNullable(p,s))},le.prototype._isNullable=ke.prototype._isNullable=X.prototype._isNullable=se.prototype._isNullable=function(p,s){return!0},me.prototype._isNullable=function(p,s){return this.expr._isNullable(p,s)},Z.prototype._isNullable=function(p,s){const l=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(s,l)){const{body:d}=p.rules[this.ruleName],v=d.substituteParams(this.args);s[l]=!1,s[l]=v._isNullable(p,s)}return s[l]},W.prototype.substituteParams=r("substituteParams"),N.substituteParams=K.substituteParams=U.prototype.substituteParams=O.prototype.substituteParams=Ce.prototype.substituteParams=function(p){return this},B.prototype.substituteParams=function(p){return p[this.index]},ee.prototype.substituteParams=function(p){return new ee(this.terms.map(s=>s.substituteParams(p)))},he.prototype.substituteParams=function(p){return new he(this.factors.map(s=>s.substituteParams(p)))},z.prototype.substituteParams=X.prototype.substituteParams=se.prototype.substituteParams=me.prototype.substituteParams=function(p){return new this.constructor(this.expr.substituteParams(p))},Z.prototype.substituteParams=function(p){if(this.args.length===0)return this;{const s=this.args.map(l=>l.substituteParams(p));return new Z(this.ruleName,s)}};function kr(p){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(p)}function dt(p){const s=Object.create(null);p.forEach(l=>{s[l]=(s[l]||0)+1}),Object.keys(s).forEach(l=>{if(s[l]<=1)return;let d=1;p.forEach((v,T)=>{v===l&&(p[T]=v+"_"+d++)})})}W.prototype.toArgumentNameList=r("toArgumentNameList"),N.toArgumentNameList=function(p,s){return["any"]},K.toArgumentNameList=function(p,s){return["end"]},U.prototype.toArgumentNameList=function(p,s){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+p]},O.prototype.toArgumentNameList=function(p,s){let l=this.from+"_to_"+this.to;return kr(l)||(l="_"+l),kr(l)||(l="$"+p),[l]},ee.prototype.toArgumentNameList=function(p,s){const l=this.terms.map(T=>T.toArgumentNameList(p,!0)),d=[],v=l[0].length;for(let T=0;T<v;T++){const j=[];for(let oe=0;oe<this.terms.length;oe++)j.push(l[oe][T]);const pe=f(j);d.push(pe.join("_or_"))}return s||dt(d),d},he.prototype.toArgumentNameList=function(p,s){let l=[];return this.factors.forEach(d=>{const v=d.toArgumentNameList(p,!0);l=l.concat(v),p+=v.length}),s||dt(l),l},z.prototype.toArgumentNameList=function(p,s){const l=this.expr.toArgumentNameList(p,s).map(d=>d[d.length-1]==="s"?d+"es":d+"s");return s||dt(l),l},ke.prototype.toArgumentNameList=function(p,s){return this.expr.toArgumentNameList(p,s).map(l=>"opt"+l[0].toUpperCase()+l.slice(1))},X.prototype.toArgumentNameList=function(p,s){return[]},se.prototype.toArgumentNameList=me.prototype.toArgumentNameList=function(p,s){return this.expr.toArgumentNameList(p,s)},Z.prototype.toArgumentNameList=function(p,s){return[this.ruleName]},Ce.prototype.toArgumentNameList=function(p,s){return["$"+p]},B.prototype.toArgumentNameList=function(p,s){return["param"+this.index]},W.prototype.toDisplayString=r("toDisplayString"),ee.prototype.toDisplayString=he.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"},N.toDisplayString=K.toDisplayString=z.prototype.toDisplayString=X.prototype.toDisplayString=se.prototype.toDisplayString=me.prototype.toDisplayString=U.prototype.toDisplayString=O.prototype.toDisplayString=B.prototype.toDisplayString=function(){return this.toString()},Z.prototype.toDisplayString=function(){if(this.args.length>0){const p=this.args.map(s=>s.toDisplayString());return this.ruleName+"<"+p.join(",")+">"}else return this.ruleName},Ce.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function Nr(p){return p==="description"||p==="string"||p==="code"}class yt{constructor(s,l,d){if(!Nr(d))throw new Error("invalid Failure type: "+d);this.pexpr=s,this.text=l,this.type=d,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(s){return this.getText()===s.getText()&&this.type===s.type&&(!this.isFluffy()||this.isFluffy()&&s.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){const s=new yt(this.pexpr,this.text,this.type);return this.isFluffy()&&s.makeFluffy(),s}toKey(){return this.toString()+"#"+this.type}}W.prototype.toFailure=r("toFailure"),N.toFailure=function(p){return new yt(this,"any object","description")},K.toFailure=function(p){return new yt(this,"end of input","description")},U.prototype.toFailure=function(p){return new yt(this,this.obj,"string")},O.prototype.toFailure=function(p){return new yt(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")},X.prototype.toFailure=function(p){const s=this.expr===N?"nothing":"not "+this.expr.toFailure(p);return new yt(this,s,"description")},se.prototype.toFailure=function(p){return this.expr.toFailure(p)},Z.prototype.toFailure=function(p){let{description:s}=p.rules[this.ruleName];return s||(s=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new yt(this,s,"description")},Ce.prototype.toFailure=function(p){return new yt(this,"a Unicode ["+this.category+"] character","description")},ee.prototype.toFailure=function(p){const l="("+this.terms.map(d=>d.toFailure(p)).join(" or ")+")";return new yt(this,l,"description")},he.prototype.toFailure=function(p){const l="("+this.factors.map(d=>d.toFailure(p)).join(" ")+")";return new yt(this,l,"description")},z.prototype.toFailure=function(p){const s="("+this.expr.toFailure(p)+this.operator+")";return new yt(this,s,"description")},W.prototype.toString=r("toString"),N.toString=function(){return"any"},K.toString=function(){return"end"},U.prototype.toString=function(){return JSON.stringify(this.obj)},O.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)},B.prototype.toString=function(){return"$"+this.index},me.prototype.toString=function(){return"#("+this.expr.toString()+")"},ee.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(p=>p.toString()).join(" | ")+")"},he.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(p=>p.toString()).join(" ")+")"},z.prototype.toString=function(){return this.expr+this.operator},X.prototype.toString=function(){return"~"+this.expr},se.prototype.toString=function(){return"&"+this.expr},Z.prototype.toString=function(){if(this.args.length>0){const p=this.args.map(s=>s.toString());return this.ruleName+"<"+p.join(",")+">"}else return this.ruleName},Ce.prototype.toString=function(){return"\\p{"+this.category+"}"};class or extends W{constructor(s){super(),this.obj=s}_getString(s){const l=s.currentApplication().args[this.obj.index];return e(l instanceof U,"expected a Terminal expression"),l.obj}allowsSkippingPrecedingSpace(){return!0}eval(s){const{inputStream:l}=s,d=l.pos,v=this._getString(s);return l.matchString(v,!0)?(s.pushBinding(new ze(v.length),d),!0):(s.processFailure(d,this),!1)}getArity(){return 1}substituteParams(s){return new or(this.obj.substituteParams(s))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(s){return new yt(this,this.obj.toFailure(s)+" (case-insensitive)","description")}_isNullable(s,l){return this.obj._isNullable(s,l)}}var Pi=Object.freeze({__proto__:null,CaseInsensitiveTerminal:or,PExpr:W,any:N,end:K,Terminal:U,Range:O,Param:B,Alt:ee,Extend:Te,Splice:Pe,Seq:he,Iter:z,Star:le,Plus:ye,Opt:ke,Not:X,Lookahead:se,Lex:me,Apply:Z,UnicodeChar:Ce});let Jn;It(p=>{Jn=p.rules.applySyntactic.body});const yn=new Z("spaces");class Zn{constructor(s,l,d){this.matcher=s,this.startExpr=l,this.grammar=s.grammar,this.input=s.getInput(),this.inputStream=new He(this.input),this.memoTable=s._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],d!==void 0&&(this.positionToRecordFailures=d,this.recordedFailures=Object.create(null))}posToOffset(s){return s-this._posStack[this._posStack.length-1]}enterApplication(s,l){this._posStack.push(this.inputStream.pos),this._applicationStack.push(l),this.inLexifiedContextStack.push(!1),s.enter(l),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(s,l){const d=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),s.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),l&&this.pushBinding(l,d)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const s=this.currentApplication();return s?s.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(yn),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(s){return s.allowsSkippingPrecedingSpace()&&s!==yn?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(s,l){this._bindings.push(s),this._bindingOffsets.push(this.posToOffset(l))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(s){for(;this._bindings.length>s;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(s){let l=this.memoTable[s];return l||(l=this.memoTable[s]=new S),l}processFailure(s,l){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,s),this.recordedFailures&&s===this.positionToRecordFailures){const d=this.currentApplication();d&&(l=l.substituteParams(d.args)),this.recordFailure(l.toFailure(this.grammar),!1)}}recordFailure(s,l){const d=s.toKey();this.recordedFailures[d]?this.recordedFailures[d].isFluffy()&&!s.isFluffy()&&this.recordedFailures[d].clearFluffy():this.recordedFailures[d]=l?s.clone():s}recordFailures(s,l){Object.keys(s).forEach(d=>{this.recordFailure(s[d],l)})}cloneRecordedFailures(){if(!this.recordedFailures)return;const s=Object.create(null);return Object.keys(this.recordedFailures).forEach(l=>{s[l]=this.recordedFailures[l].clone()}),s}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(s,l){const d=this.memoTable[s];if(d&&l instanceof Z){const v=d.memo[l.toMemoKey()];if(v&&v.traceEntry){const T=v.traceEntry.cloneWithExpr(l);return T.isMemoized=!0,T}}return null}getTraceEntry(s,l,d,v){if(l instanceof Z){const T=this.currentApplication(),j=T?T.args:[];l=l.substituteParams(j)}return this.getMemoizedTraceEntry(s,l)||new De(this.input,s,this.inputStream.pos,l,d,v,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(s){return this.trace&&!s.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+s.rightmostFailureOffset===this.positionToRecordFailures?!!s.failuresAtRightmostPosition:!0}useMemoizedResult(s,l){this.trace&&this.trace.push(l.traceEntry);const d=this.inputStream.pos+l.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,d),this.recordedFailures&&this.positionToRecordFailures===d&&l.failuresAtRightmostPosition&&this.recordFailures(l.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,l.examinedLength+s),l.value?(this.inputStream.pos+=l.matchLength,this.pushBinding(l.value,s),!0):!1}eval(s){const{inputStream:l}=this,d=this._bindings.length,v=this.userData;let T;this.recordedFailures&&(T=this.recordedFailures,this.recordedFailures=Object.create(null));const j=l.pos,pe=this.maybeSkipSpacesBefore(s);let oe;this.trace&&(oe=this.trace,this.trace=[]);const Se=s.eval(this);if(this.trace){const ne=this._bindings.slice(d),re=this.getTraceEntry(pe,s,Se,ne);re.isImplicitSpaces=s===yn,re.isRootNode=s===this.startExpr,oe.push(re),this.trace=oe}return Se?this.recordedFailures&&l.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(ne=>{this.recordedFailures[ne].makeFluffy()}):(l.pos=j,this.truncateBindings(d),this.userData=v),this.recordedFailures&&this.recordFailures(T,!1),s===Jn&&this.skipSpaces(),Se}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let s;this.recordedFailures&&(s=Object.keys(this.recordedFailures).map(d=>this.recordedFailures[d]));const l=this._bindings[0];return l&&(l.grammar=this.grammar),new m(this.matcher,this.input,this.startExpr,l,this._bindingOffsets[0],this.rightmostFailurePosition,s)}getTrace(){this.trace=[];const s=this.getMatchResult(),l=this.trace[this.trace.length-1];return l.result=s,l}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class Fe{constructor(s){this.grammar=s,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(s){return this._input!==s&&this.replaceInputRange(0,this._input.length,s),this}replaceInputRange(s,l,d){const v=this._input,T=this._memoTable;if(s<0||s>v.length||l<0||l>v.length||s>l)throw new Error("Invalid indices: "+s+" and "+l);this._input=v.slice(0,s)+d+v.slice(l),this._input!==v&&T.length>0&&(this._isMemoTableStale=!0);const j=T.slice(l);T.length=s;for(let pe=0;pe<d.length;pe++)T.push(void 0);for(const pe of j)T.push(pe);for(let pe=0;pe<s;pe++){const oe=T[pe];oe&&oe.clearObsoleteEntries(pe,s)}return this}match(s,l={incremental:!0}){return this._match(this._getStartExpr(s),{incremental:l.incremental,tracing:!1})}trace(s,l={incremental:!0}){return this._match(this._getStartExpr(s),{incremental:l.incremental,tracing:!0})}_match(s,l={}){const d={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...l};if(!d.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw Ye(this.grammar);const v=new Zn(this,s,d.positionToRecordFailures);return d.tracing?v.getTrace():v.getMatchResult()}_getStartExpr(s){const l=s||this.grammar.defaultStartRule;if(!l)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const d=this.grammar.parseApplication(l);return new he([d,K])}}const bt=[],Ir=(p,s)=>Object.prototype.hasOwnProperty.call(p,s);class bn{constructor(s,l,d){this._node=s,this.source=l,this._baseInterval=d,s.isNonterminal()&&e(l===d),this._childWrappers=[]}_forgetMemoizedResultFor(s){delete this._node[this._semantics.attributeKeys[s]],this.children.forEach(l=>{l._forgetMemoizedResultFor(s)})}child(s){if(!(0<=s&&s<this._node.numChildren()))return;let l=this._childWrappers[s];if(!l){const d=this._node.childAt(s),v=this._node.childOffsets[s],T=this._baseInterval.subInterval(v,d.matchLength),j=d.isNonterminal()?T:this._baseInterval;l=this._childWrappers[s]=this._semantics.wrap(d,T,j)}return l}_children(){for(let s=0;s<this._node.numChildren();s++)this.child(s);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(s){const l=s||[],d=l.map(j=>j._node),v=new Vt(d,[],-1,!1),T=this._semantics.wrap(v,null,null);return T._childWrappers=l,T}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class Mt{constructor(s,l){const d=this;if(this.grammar=s,this.checkedActionDicts=!1,this.Wrapper=class extends(l?l.Wrapper:bn){constructor(v,T,j){super(v,T,j),d.checkActionDictsIfHaventAlready(),this._semantics=d}toString(){return"[semantics wrapper for "+d.grammar.name+"]"}},this.super=l,l){if(!(s.equals(this.super.grammar)||s._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+s.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const v in this.attributes)Object.defineProperty(this.attributeKeys,v,{value:Tt(v)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let s;for(s in this.operations)this.operations[s].checkActionDict(this.grammar);for(s in this.attributes)this.attributes[s].checkActionDict(this.grammar)}toRecipe(s){function l(v){return v.super!==Mt.BuiltInSemantics._getSemantics()}let d=`(function(g) {
`;if(l(this)){d+="  var semantics = "+this.super.toRecipe(!0)+"(g";const v=this.super.grammar;let T=this.grammar;for(;T!==v;)d+=".superGrammar",T=T.superGrammar;d+=`);
`,d+="  return g.extendSemantics(semantics)"}else d+="  return g.createSemantics()";return["Operation","Attribute"].forEach(v=>{const T=this[v.toLowerCase()+"s"];Object.keys(T).forEach(j=>{const{actionDict:pe,formals:oe,builtInDefault:Se}=T[j];let ne=j;oe.length>0&&(ne+="("+oe.join(", ")+")");let re;l(this)&&this.super[v.toLowerCase()+"s"][j]?re="extend"+v:re="add"+v,d+=`
    .`+re+"("+JSON.stringify(ne)+", {";const ge=[];Object.keys(pe).forEach($e=>{if(pe[$e]!==Se){let nt=pe[$e].toString().trim();nt=nt.replace(/^.*\(/,"function("),ge.push(`
      `+JSON.stringify($e)+": "+nt)}}),d+=ge.join(",")+`
    })`})}),d+=`;
  })`,s||(d=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+d+`(grammar);
  return semantics;
});
`),d}addOperationOrAttribute(s,l,d){const v=s+"s",T=Mr(l,s),{name:j}=T,{formals:pe}=T;this.assertNewName(j,s);const oe=Xr(s,j,re),Se={_default:oe};Object.keys(d).forEach(ge=>{Se[ge]=d[ge]});const ne=s==="operation"?new Oe(j,pe,Se,oe):new ct(j,Se,oe);ne.checkActionDict(this.grammar),this[v][j]=ne;function re(...ge){const $e=this._semantics[v][j];if(arguments.length!==$e.formals.length)throw new Error("Invalid number of arguments passed to "+j+" "+s+" (expected "+$e.formals.length+", got "+arguments.length+")");const nt=Object.create(null);for(const[zr,wn]of Object.entries(ge)){const $o=$e.formals[zr];nt[$o]=wn}const Ct=this.args;this.args=nt;const Pt=$e.execute(this._semantics,this);return this.args=Ct,Pt}s==="operation"?(this.Wrapper.prototype[j]=re,this.Wrapper.prototype[j].toString=function(){return"["+j+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,j,{get:re,configurable:!0}),Object.defineProperty(this.attributeKeys,j,{value:Tt(j)}))}extendOperationOrAttribute(s,l,d){const v=s+"s";if(Mr(l,"attribute"),!(this.super&&l in this.super[v]))throw new Error("Cannot extend "+s+" '"+l+"': did not inherit an "+s+" with that name");if(Ir(this[v],l))throw new Error("Cannot extend "+s+" '"+l+"' again");const T=this[v][l].formals,j=this[v][l].actionDict,pe=Object.create(j);Object.keys(d).forEach(oe=>{pe[oe]=d[oe]}),this[v][l]=s==="operation"?new Oe(l,T,pe):new ct(l,pe),this[v][l].checkActionDict(this.grammar)}assertNewName(s,l){if(Ir(bn.prototype,s))throw new Error("Cannot add "+l+" '"+s+"': that's a reserved name");if(s in this.operations)throw new Error("Cannot add "+l+" '"+s+"': an operation with that name already exists");if(s in this.attributes)throw new Error("Cannot add "+l+" '"+s+"': an attribute with that name already exists")}wrap(s,l,d){const v=d||l;return s instanceof this.Wrapper?s:new this.Wrapper(s,l,v)}}function Mr(p,s){if(!Mt.prototypeGrammar)return e(p.indexOf("(")===-1),{name:p,formals:[]};const l=Mt.prototypeGrammar.match(p,s==="operation"?"OperationSignature":"AttributeSignature");if(l.failed())throw new Error(l.message);return Mt.prototypeGrammarSemantics(l).parse()}function Xr(p,s,l){return function(...d){const T=(this._semantics.operations[s]||this._semantics.attributes[s]).formals.map(j=>this.args[j]);if(!this.isIteration()&&d.length===1)return l.apply(d[0],T);throw J(this.ctorName,s,p,bt)}}Mt.createSemantics=function(p,s){const l=new Mt(p,s!==void 0?s:Mt.BuiltInSemantics._getSemantics()),d=function(T){if(!(T instanceof m))throw new TypeError("Semantics expected a MatchResult, but got "+Y(T));if(T.failed())throw new TypeError("cannot apply Semantics to "+T.toString());const j=T._cst;if(j.grammar!==p)throw new Error("Cannot use a MatchResult from grammar '"+j.grammar.name+"' with a semantics for '"+p.name+"'");const pe=new He(T.input);return l.wrap(j,pe.interval(T._cstOffset,T.input.length))};return d.addOperation=function(v,T){return l.addOperationOrAttribute("operation",v,T),d},d.extendOperation=function(v,T){return l.extendOperationOrAttribute("operation",v,T),d},d.addAttribute=function(v,T){return l.addOperationOrAttribute("attribute",v,T),d},d.extendAttribute=function(v,T){return l.extendOperationOrAttribute("attribute",v,T),d},d._getActionDict=function(v){const T=l.operations[v]||l.attributes[v];if(!T)throw new Error('"'+v+'" is not a valid operation or attribute name in this semantics for "'+p.name+'"');return T.actionDict},d._remove=function(v){let T;return v in l.operations?(T=l.operations[v],delete l.operations[v]):v in l.attributes&&(T=l.attributes[v],delete l.attributes[v]),delete l.Wrapper.prototype[v],T},d.getOperationNames=function(){return Object.keys(l.operations)},d.getAttributeNames=function(){return Object.keys(l.attributes)},d.getGrammar=function(){return l.grammar},d.toRecipe=function(v){return l.toRecipe(v)},d.toString=l.toString.bind(l),d._getSemantics=function(){return l},d};class Oe{constructor(s,l,d,v){this.name=s,this.formals=l,this.actionDict=d,this.builtInDefault=v}checkActionDict(s){s._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(s,l){try{const{ctorName:d}=l._node;let v=this.actionDict[d];return v?(bt.push([this,d]),v.apply(l,l._children())):l.isNonterminal()&&(v=this.actionDict._nonterminal,v)?(bt.push([this,"_nonterminal",d]),v.apply(l,l._children())):(bt.push([this,"default action",d]),this.actionDict._default.apply(l,l._children()))}finally{bt.pop()}}}Oe.prototype.typeName="operation";class ct extends Oe{constructor(s,l,d){super(s,[],l,d)}execute(s,l){const d=l._node,v=s.attributeKeys[this.name];return Ir(d,v)||(d[v]=Oe.prototype.execute.call(this,s,l)),d[v]}}ct.prototype.typeName="attribute";const _t=["_iter","_terminal","_nonterminal","_default"];function ut(p){return Object.keys(p.rules).sort().map(s=>p.rules[s])}const Ft=p=>p.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");let lr,Ot;class gt{constructor(s,l,d,v){if(this.name=s,this.superGrammar=l,this.rules=d,v){if(!(v in d))throw new Error("Invalid start rule: '"+v+"' is not a rule in grammar '"+s+"'");this.defaultStartRule=v}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new Fe(this)}isBuiltIn(){return this===gt.ProtoBuiltInRules||this===gt.BuiltInRules}equals(s){if(this===s)return!0;if(s==null||this.name!==s.name||this.defaultStartRule!==s.defaultStartRule||!(this.superGrammar===s.superGrammar||this.superGrammar.equals(s.superGrammar)))return!1;const l=ut(this),d=ut(s);return l.length===d.length&&l.every((v,T)=>v.description===d[T].description&&v.formals.join(",")===d[T].formals.join(",")&&v.body.toString()===d[T].body.toString())}match(s,l){const d=this.matcher();return d.replaceInputRange(0,0,s),d.match(l)}trace(s,l){const d=this.matcher();return d.replaceInputRange(0,0,s),d.trace(l)}createSemantics(){return Mt.createSemantics(this)}extendSemantics(s){return Mt.createSemantics(this,s._getSemantics())}_checkTopDownActionDict(s,l,d){const v=[];for(const T in d){const j=d[T];if(!_t.includes(T)&&!(T in this.rules)){v.push(`'${T}' is not a valid semantic action for '${this.name}'`);continue}if(typeof j!="function"){v.push(`'${T}' must be a function in an action dictionary for '${this.name}'`);continue}const oe=j.length,Se=this._topDownActionArity(T);if(oe!==Se){let ne;T==="_iter"||T==="_nonterminal"?ne=`it should use a rest parameter, e.g. \`${T}(...children) {}\`. NOTE: this is new in Ohm v16 — see https://ohmjs.org/d/ati for details.`:ne=`expected ${Se}, got ${oe}`,v.push(`Semantic action '${T}' has the wrong arity: ${ne}`)}}if(v.length>0){const T=v.map(pe=>"- "+pe),j=new Error([`Found errors in the action dictionary of the '${l}' ${s}:`,...T].join(`
`));throw j.problems=v,j}}_topDownActionArity(s){return _t.includes(s)?0:this.rules[s].body.getArity()}_inheritsFrom(s){let l=this.superGrammar;for(;l;){if(l.equals(s,!0))return!0;l=l.superGrammar}return!1}toRecipe(s=void 0){const l={};this.source&&(l.source=this.source.contents);let d=null;this.defaultStartRule&&(d=this.defaultStartRule);const v={};Object.keys(this.rules).forEach(pe=>{const oe=this.rules[pe],{body:Se}=oe,ne=!this.superGrammar||!this.superGrammar.rules[pe];let re;ne?re="define":re=Se instanceof Te?"extend":"override";const ge={};if(oe.source&&this.source){const Ct=oe.source.relativeTo(this.source);ge.sourceInterval=[Ct.startIdx,Ct.endIdx]}const $e=ne?oe.description:null,nt=Se.outputRecipe(oe.formals,this.source);v[pe]=[re,ge,$e,oe.formals,nt]});let T="null";s?T=s:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(T=this.superGrammar.toRecipe());const j=[...["grammar",l,this.name].map(JSON.stringify),T,...[d,v].map(JSON.stringify)];return Ft(`[${j.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const s=new x;s.append("{");let l=!0;for(const d in this.rules){const{body:v}=this.rules[d];l?l=!1:s.append(","),s.append(`
`),s.append("  "),this.addSemanticActionTemplate(d,v,s)}return s.append(`
}`),s.contents()}addSemanticActionTemplate(s,l,d){d.append(s),d.append(": function(");const v=this._topDownActionArity(s);d.append(a("_",v).join(", ")),d.append(`) {
`),d.append("  }")}parseApplication(s){let l;if(s.indexOf("<")===-1)l=new Z(s);else{const v=lr.match(s,"Base_application");l=Ot(v,{})}if(!(l.ruleName in this.rules))throw We(l.ruleName,this.name);const{formals:d}=this.rules[l.ruleName];if(d.length!==l.args.length){const{source:v}=this.rules[l.ruleName];throw Q(l.ruleName,d.length,l.args.length,v)}return l}_setUpMatchState(s){this._matchStateInitializer&&this._matchStateInitializer(s)}}gt.ProtoBuiltInRules=new gt("ProtoBuiltInRules",void 0,{any:{body:N,formals:[],description:"any character",primitive:!0},end:{body:K,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new or(new B(0)),formals:["str"],primitive:!0},lower:{body:new Ce("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new Ce("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new Ce("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new le(new Z("space")),formals:[]},space:{body:new O("\0"," "),formals:[],description:"a space"}}),gt.initApplicationParser=function(p,s){lr=p,Ot=s};class qt{constructor(s){this.name=s}sourceInterval(s,l){return this.source.subInterval(s,l-s)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?gt.ProtoBuiltInRules:gt.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(s,l){const d=this.ensureSuperGrammar().rules[s];if(!d)throw P(s,this.superGrammar.name,l);return d}installOverriddenOrExtendedRule(s,l,d,v){const T=c(l);if(T.length>0)throw ae(s,T,v);const j=this.ensureSuperGrammar().rules[s],pe=j.formals,oe=pe?pe.length:0;if(l.length!==oe)throw Q(s,oe,l.length,v);return this.install(s,l,d,j.description,v)}install(s,l,d,v,T,j=!1){return this.rules[s]={body:d.introduceParams(l),formals:l,description:v,source:T,primitive:j},this}withSuperGrammar(s){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=s,this.rules=Object.create(s.rules),s.isBuiltIn()||(this.defaultStartRule=s.defaultStartRule),this}withDefaultStartRule(s){return this.defaultStartRule=s,this}withSource(s){return this.source=new He(s).interval(0,s.length),this}build(){const s=new gt(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);s._matchStateInitializer=s.superGrammar._matchStateInitializer,s.supportsIncrementalParsing=s.superGrammar.supportsIncrementalParsing;const l=[];let d=!1;return Object.keys(s.rules).forEach(v=>{const{body:T}=s.rules[v];try{T.assertChoicesHaveUniformArity(v)}catch(j){l.push(j)}try{T.assertAllApplicationsAreValid(v,s)}catch(j){l.push(j),d=!0}}),d||Object.keys(s.rules).forEach(v=>{const{body:T}=s.rules[v];try{T.assertIteratedExprsAreNotNullable(s,[])}catch(j){l.push(j)}}),l.length>0&&te(l),this.source&&(s.source=this.source),s}define(s,l,d,v,T,j){if(this.ensureSuperGrammar(),this.superGrammar.rules[s])throw $(s,this.name,this.superGrammar.name,T);if(this.rules[s])throw $(s,this.name,this.name,T);const pe=c(l);if(pe.length>0)throw ae(s,pe,T);return this.install(s,l,d,v,T,j)}override(s,l,d,v,T){return this.ensureSuperGrammarRuleForOverriding(s,T),this.installOverriddenOrExtendedRule(s,l,d,T),this}extend(s,l,d,v,T){if(!this.ensureSuperGrammar().rules[s])throw q(s,this.superGrammar.name,T);const pe=new Te(this.superGrammar,s,d);return pe.source=d.source,this.installOverriddenOrExtendedRule(s,l,pe,T),this}}class zt{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(s){return new qt(s)}grammar(s,l,d,v,T){const j=new qt(l);return d&&j.withSuperGrammar(d instanceof gt?d:this.fromRecipe(d)),v&&j.withDefaultStartRule(v),s&&s.source&&j.withSource(s.source),this.currentDecl=j,Object.keys(T).forEach(pe=>{this.currentRuleName=pe;const oe=T[pe],Se=oe[0],ne=oe[1],re=oe[2],ge=oe[3],$e=this.fromRecipe(oe[4]);let nt;j.source&&ne&&ne.sourceInterval&&(nt=j.source.subInterval(ne.sourceInterval[0],ne.sourceInterval[1]-ne.sourceInterval[0])),j[Se](pe,ge,$e,re,nt)}),this.currentRuleName=this.currentDecl=null,j.build()}terminal(s){return new U(s)}range(s,l){return new O(s,l)}param(s){return new B(s)}alt(...s){let l=[];for(let d of s)d instanceof W||(d=this.fromRecipe(d)),d instanceof ee?l=l.concat(d.terms):l.push(d);return l.length===1?l[0]:new ee(l)}seq(...s){let l=[];for(let d of s)d instanceof W||(d=this.fromRecipe(d)),d instanceof he?l=l.concat(d.factors):l.push(d);return l.length===1?l[0]:new he(l)}star(s){return s instanceof W||(s=this.fromRecipe(s)),new le(s)}plus(s){return s instanceof W||(s=this.fromRecipe(s)),new ye(s)}opt(s){return s instanceof W||(s=this.fromRecipe(s)),new ke(s)}not(s){return s instanceof W||(s=this.fromRecipe(s)),new X(s)}lookahead(s){return s instanceof W||(s=this.fromRecipe(s)),new se(s)}lex(s){return s instanceof W||(s=this.fromRecipe(s)),new me(s)}app(s,l){return l&&l.length>0&&(l=l.map(function(d){return d instanceof W?d:this.fromRecipe(d)},this)),new Z(s,l)}splice(s,l){return new Pe(this.currentDecl.superGrammar,this.currentRuleName,s.map(d=>this.fromRecipe(d)),l.map(d=>this.fromRecipe(d)))}fromRecipe(s){const l=s[0]==="grammar"?s.slice(1):s.slice(2),d=this[s[0]](...l),v=s[1];return v&&v.sourceInterval&&this.currentDecl&&d.withSource(this.currentDecl.sourceInterval(...v.sourceInterval)),d}}function ft(p){return typeof p=="function"?p.call(new zt):(typeof p=="string"&&(p=JSON.parse(p)),new zt().fromRecipe(p))}var Rt=ft(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);gt.BuiltInRules=Rt,de(gt.BuiltInRules);var Fr=ft(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0","􏿿"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]);const wt=Object.create(W.prototype);function qr(p,s){for(const l in p)if(l===s)return!0;return!1}function Sr(p,s,l){const d=new zt;let v,T,j,pe=!1;return(l||Fr).createSemantics().addOperation("visit",{Grammars(ne){return ne.children.map(re=>re.visit())},Grammar(ne,re,ge,$e,nt){const Ct=ne.visit();v=d.newGrammar(Ct),re.child(0)&&re.child(0).visit(),$e.children.map(zr=>zr.visit());const Pt=v.build();if(Pt.source=this.source.trimmed(),qr(s,Ct))throw Re(Pt);return s[Ct]=Pt,Pt},SuperGrammar(ne,re){const ge=re.visit();if(ge==="null")v.withSuperGrammar(null);else{if(!s||!qr(s,ge))throw fe(ge,s,re.source);v.withSuperGrammar(s[ge])}},Rule_define(ne,re,ge,$e,nt){T=ne.visit(),j=re.children.map(wn=>wn.visit())[0]||[],!v.defaultStartRule&&v.ensureSuperGrammar()!==gt.ProtoBuiltInRules&&v.withDefaultStartRule(T);const Ct=nt.visit(),Pt=ge.children.map(wn=>wn.visit())[0],zr=this.source.trimmed();return v.define(T,j,Ct,Pt,zr)},Rule_override(ne,re,ge,$e){T=ne.visit(),j=re.children.map(Pt=>Pt.visit())[0]||[];const nt=this.source.trimmed();v.ensureSuperGrammarRuleForOverriding(T,nt),pe=!0;const Ct=$e.visit();return pe=!1,v.override(T,j,Ct,null,nt)},Rule_extend(ne,re,ge,$e){T=ne.visit(),j=re.children.map(Pt=>Pt.visit())[0]||[];const nt=$e.visit(),Ct=this.source.trimmed();return v.extend(T,j,nt,null,Ct)},RuleBody(ne,re){return d.alt(...re.visit()).withSource(this.source)},OverrideRuleBody(ne,re){const ge=re.visit(),$e=ge.indexOf(wt);if($e>=0){const nt=ge.slice(0,$e),Ct=ge.slice($e+1);return Ct.forEach(Pt=>{if(Pt===wt)throw Ae(Pt)}),new Pe(v.superGrammar,T,nt,Ct).withSource(this.source)}else return d.alt(...ge).withSource(this.source)},Formals(ne,re,ge){return re.visit()},Params(ne,re,ge){return re.visit()},Alt(ne){return d.alt(...ne.visit()).withSource(this.source)},TopLevelTerm_inline(ne,re){const ge=T+"_"+re.visit(),$e=ne.visit(),nt=this.source.trimmed(),Ct=!(v.superGrammar&&v.superGrammar.rules[ge]);pe&&!Ct?v.override(ge,j,$e,null,nt):v.define(ge,j,$e,null,nt);const Pt=j.map(zr=>d.app(zr));return d.app(ge,Pt).withSource($e.source)},OverrideTopLevelTerm_superSplice(ne){return wt},Seq(ne){return d.seq(...ne.children.map(re=>re.visit())).withSource(this.source)},Iter_star(ne,re){return d.star(ne.visit()).withSource(this.source)},Iter_plus(ne,re){return d.plus(ne.visit()).withSource(this.source)},Iter_opt(ne,re){return d.opt(ne.visit()).withSource(this.source)},Pred_not(ne,re){return d.not(re.visit()).withSource(this.source)},Pred_lookahead(ne,re){return d.lookahead(re.visit()).withSource(this.source)},Lex_lex(ne,re){return d.lex(re.visit()).withSource(this.source)},Base_application(ne,re){const ge=re.children.map($e=>$e.visit())[0]||[];return d.app(ne.visit(),ge).withSource(this.source)},Base_range(ne,re,ge){return d.range(ne.visit(),ge.visit()).withSource(this.source)},Base_terminal(ne){return d.terminal(ne.visit()).withSource(this.source)},Base_paren(ne,re,ge){return re.visit()},ruleDescr(ne,re,ge){return re.visit()},ruleDescrText(ne){return this.sourceString.trim()},caseName(ne,re,ge,$e,nt){return ge.visit()},name(ne,re){return this.sourceString},nameFirst(ne){},nameRest(ne){},terminal(ne,re,ge){return re.children.map($e=>$e.visit()).join("")},oneCharTerminal(ne,re,ge){return re.visit()},escapeChar(ne){try{return D(this.sourceString)}catch(re){throw re instanceof RangeError&&re.message.startsWith("Invalid code point ")?L(ne):re}},NonemptyListOf(ne,re,ge){return[ne.visit()].concat(ge.children.map($e=>$e.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(p).visit()}var cr=ft(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);Qr(gt.BuiltInRules),Ar(cr);function Qr(p){const s={empty(){return this.iteration()},nonEmpty(l,d,v){return this.iteration([l].concat(v.children))}};Mt.BuiltInSemantics=Mt.createSemantics(p,null).addOperation("asIteration",{emptyListOf:s.empty,nonemptyListOf:s.nonEmpty,EmptyListOf:s.empty,NonemptyListOf:s.nonEmpty})}function Ar(p){Mt.prototypeGrammarSemantics=p.createSemantics().addOperation("parse",{AttributeSignature(s){return{name:s.parse(),formals:[]}},OperationSignature(s,l){return{name:s.parse(),formals:l.children.map(d=>d.parse())[0]||[]}},Formals(s,l,d){return l.asIteration().children.map(v=>v.parse())},name(s,l){return this.sourceString}}),Mt.prototypeGrammar=p}function _o(p){let s=0;const l=[0],d=()=>l[l.length-1],v={},T=/( *).*(?:$|\r?\n|\r)/g;let j;for(;(j=T.exec(p))!=null;){const[pe,oe]=j;if(pe.length===0)break;const Se=oe.length,ne=d(),re=s+Se;if(Se>ne)l.push(Se),v[re]=1;else if(Se<ne){const ge=l.length;for(;d()!==Se;)l.pop();v[re]=-1*(ge-l.length)}s+=pe.length}return l.length>1&&(v[s]=1-l.length),v}const Ss="an indented block",_s="a dedent",Cs=1114112;class Co extends He{constructor(s){super(s.input),this.state=s}_indentationAt(s){return this.state.userData[s]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Cs):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Cs):super.nextCodePoint()}}class Es extends W{constructor(s=!0){super(),this.isIndent=s}allowsSkippingPrecedingSpace(){return!0}eval(s){const{inputStream:l}=s,d=s.userData;s.doNotMemoize=!0;const v=l.pos,T=this.isIndent?1:-1;return(d[v]||0)*T>0?(s.userData=Object.create(d),s.userData[v]-=T,s.pushBinding(new ze(0),v),!0):(s.processFailure(v,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(s,l){}_isNullable(s,l){return!1}assertChoicesHaveUniformArity(s){}assertIteratedExprsAreNotNullable(s){}introduceParams(s){return this}substituteParams(s){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(s){const l=this.isIndent?Ss:_s;return new yt(this,l,"description")}}const Eo=new Z("indent"),Ao=new Z("dedent"),To=new Pe(Rt,"any",[Eo,Ao],[]),As=new zt().newGrammar("IndentationSensitive").withSuperGrammar(Rt).define("indent",[],new Es(!0),Ss,void 0,!0).define("dedent",[],new Es(!1),_s,void 0,!0).extend("any",[],To,"any character",void 0).build();Object.assign(As,{_matchStateInitializer(p){p.userData=_o(p.input),p.inputStream=new Co(p)},supportsIncrementalParsing:!1});const Oo="17.1.0";gt.initApplicationParser(Fr,Sr);const Ro=p=>!!p.constructor&&typeof p.constructor.isBuffer=="function"&&p.constructor.isBuffer(p);function Po(p,s){const l=Fr.match(p,"Grammars");if(l.failed())throw I(l);return Sr(l,s)}function Lo(p,s){const l=Ts(p,s),d=Object.keys(l);if(d.length===0)throw new Error("Missing grammar definition");if(d.length>1){const T=l[d[1]].source;throw new Error(Qt(T.sourceString,T.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return l[d[0]]}function Ts(p,s){const l=Object.create(s||{});if(typeof p!="string")if(Ro(p))p=p.toString();else throw new TypeError("Expected string as first argument, got "+Y(p));return Po(p,l),l}return ur.ExperimentalIndentationSensitive=As,ur._buildGrammar=Sr,ur.grammar=Lo,ur.grammars=Ts,ur.makeRecipe=ft,ur.ohmGrammar=Fr,ur.pexprs=Pi,ur.version=Oo,ur}var zi,ra;function ho(){if(ra)return zi;ra=1;const{makeRecipe:r}=Ku();return zi=r(["grammar",{source:`PEP508 {
    // Grammar adapted from https://peps.python.org/pep-0508/#complete-grammar
    // (naming retained, just reordered and camelCased)
    File = ListOf<Line, "\\n">
    Line = Req? comment?
    Req = UrlReq | NameReq | RequirementsReq | ConstraintsReq

    NameReq = Name Extras? VersionSpec QuotedMarker?
    UrlReq  = Name Extras? UrlSpec (space QuotedMarker)?
    Extras  = "[" ListOf<identifier, ","> "]"
    Name    = identifier
    identifier    = alnum identifierEnd*
    identifierEnd = alnum -- single
                  | (("-" | "_" | "." )* alnum) -- multi

    // Requirements based on other requirements files (not in PEP 508, but supported by pip)
    RequirementsReq = "-r" filePath
    ConstraintsReq  = "-c" filePath
    filePath        = (~("\\n" | "#") any)+

    UrlSpec      = "@" uriReference
    uriReference = uri | relativeRef
    uri          = scheme ":" hierPart? ("?" query )? ("#" fragment)?
    hierPart     = ("//" authority pathAbempty) -- abempty
                 | pathAbsolute -- absolute
                 | pathRootless -- rootless
    absoluteUri  = scheme ":" hierPart? ("?" query )?
    relativeRef  = relativePart? ("?" query )? ("#" fragment )?
    relativePart = "//" authority pathAbempty -- abempty
                 | pathAbsolute -- absolute
                 | pathNoscheme -- noscheme
    scheme       = letter (alnum | "+" | "-" | ".")*
    authority    = (userinfo "@" )? host (":" port )?
    userinfo     = (unreserved | pctEncoded | subDelims | ":")*
    host         = ipLiteral | ipv4Address | regName
    port         = digit*
    ipLiteral    = "[" (ipv6Address | ipvFuture) "]"
    ipvFuture    = "v" hexdig+ "." (unreserved | subDelims | ":")+
    ipv6Address  = (hexdig | ":" | ".")+ // dumbed down a lot, mostly due to lack of quantifier support in Ohm
    ipv4Address  = decOctet "." decOctet "." decOctet "." decOctet
    nz           = ~"0" digit
    decOctet     = digit -- zeroToNine
                 | nz digit -- tenToNinetyNine
                 | "1" digit digit -- oneHundredToOneNinetyNine
                 | "2" ("0" | "1" | "2" | "3" | "4") digit -- twoHundredToTwoFortyNine
                 | "25" ("0" | "1" | "2" | "3" | "4" | "5") -- twoFiftyToTwoFiftyFive
    regName      = (unreserved | pctEncoded | subDelims)*
    path         = pathAbempty // begins with "/" or is empty
                 | pathAbsolute // begins with "/" but not "//"
                 | pathNoscheme // begins with a non-colon segment
                 | pathRootless // begins with a segment
    pathAbempty  = ("/" segment)*
    pathAbsolute = "/" (segmentNz ("/" segment)* )?
    pathNoscheme = segmentNzNc ("/" segment)*
    pathRootless = segmentNz ("/" segment)*
    segment      = pchar*
    segmentNz    = pchar+
    segmentNzNc  = (unreserved | pctEncoded | subDelims | "@")+ // non-zero-length segment without any colon ":"
    pchar        = unreserved | pctEncoded | subDelims | ":" | "@"
    query        = (pchar | "/" | "?")*
    fragment     = (pchar | "/" | "?")*
    pctEncoded   = "%" hexdig
    unreserved   = alnum | "-" | "." | "_" | "~"
    reserved     = genDelims | subDelims
    genDelims    = ":" | "/" | "?" | "#" | "(" | ")?" | "@"
    subDelims    = "!" | "$" | "&" | "'" | "(" | ")" | "*" | "+" | "," | ";" | "="
    hexdig       = digit | "a" | "A" | "b" | "B" | "c" | "C" | "d" | "D" | "e" | "E" | "f" | "F"

    // Environment markers
    QuotedMarker  = ";" Marker
    Marker        = MarkerOr
    MarkerOr      = MarkerAnd "or" MarkerAnd -- node
                  | MarkerAnd -- leaf
    MarkerAnd     = MarkerExpr "and" MarkerExpr -- node
                  | MarkerExpr -- leaf
    MarkerExpr    = MarkerVar markerOp MarkerVar -- leaf
                  | "(" Marker ")" -- node
    MarkerVar     = envVar | pythonStr
    markerOp      = versionCmp -- versionCmp
                  | "in" -- in
                  | ("not" space+ "in") -- notIn
    pythonStr     = "'" (pythonStrChar | "\\"")* "'"
                  | "\\"" (pythonStrChar | "'")* "\\""
    pythonStrChar = space | alnum | "(" | ")" | "." | "{" | "}" | "-" | "_" | "*" | "#" | ":" | ";" | "," | "/" | "?"
                  | "[" | "]" | "!" | "~" | "\`" | "@" | "$" | "%" | "^" | "&" | "=" | "+" | "|" | "<" | ">"
    envVar        = "python_version" | "python_full_version" | "os_name" | "sys_platform" | "platform_release"
                  | "platform_system" | "platform_version" | "platform_machine" | "platform_python_implementation"
                  | "implementation_name" | "implementation_version" | "extra" // ONLY when defined by a containing layer

    // Version specifiers, defined in PEP 440 (https://peps.python.org/pep-0440/)
    VersionSpec   = "(" VersionMany ")" -- parenthesized
                  | VersionMany -- direct
    VersionMany   = ListOf<VersionOne, ",">
    VersionOne    = versionCmp version
    versionCmp    = "<=" | "<" | "!=" | "==" | ">=" | ">" | "~=" | "==="
    version       = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+

    comment = "#" (~"\\n" any)*

    space := " " | "\\t" // Overriding Ohm's definition of whitespace to kick out newlines and other Unicode whitespace

    // Loose grammar for parsing unfinished requirements - focused on extracting the name, extras, and version spec
    LooseFile         = ListOf<LooseLine, "\\n">
    LooseLine         = LooseReq comment?
    LooseReq          = LooseNonNameReq | LooseNameReq
    LooseNameReq      = Name LooseExtras? LooseVersionSpec LooseQuotedMarker?
    LooseNonNameReq   = (~(~(Name "@") Name) looseAnything) // Non-name req can start with Name only if followed by "@"
    LooseExtras       = "[" ListOf<identifier, ","> ","* "]"?
    LooseQuotedMarker = ";" looseAnything
    LooseVersionSpec  = "(" LooseVersionMany ")"? -- parenthesized
                      | LooseVersionMany -- direct
    LooseVersionMany  = ListOf<LooseVersionOne, ","> ","*
    LooseVersionOne   = looseVersionCmp looseVersion?
    looseVersionCmp   = ("<" | "=" | "!" | ">" | "~")+
    looseVersion      = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+
    looseAnything     = (~("\\n" | "#") any)* // Any non-comment line content
}`},"PEP508",null,"File",{File:["define",{sourceInterval:[148,173]},null,[],["app",{sourceInterval:[155,173]},"ListOf",[["app",{sourceInterval:[162,166]},"Line",[]],["terminal",{sourceInterval:[168,172]},`
`]]]],Line:["define",{sourceInterval:[178,198]},null,[],["seq",{sourceInterval:[185,198]},["opt",{sourceInterval:[185,189]},["app",{sourceInterval:[185,188]},"Req",[]]],["opt",{sourceInterval:[190,198]},["app",{sourceInterval:[190,197]},"comment",[]]]]],Req:["define",{sourceInterval:[203,260]},null,[],["alt",{sourceInterval:[209,260]},["app",{sourceInterval:[209,215]},"UrlReq",[]],["app",{sourceInterval:[218,225]},"NameReq",[]],["app",{sourceInterval:[228,243]},"RequirementsReq",[]],["app",{sourceInterval:[246,260]},"ConstraintsReq",[]]]],NameReq:["define",{sourceInterval:[266,314]},null,[],["seq",{sourceInterval:[276,314]},["app",{sourceInterval:[276,280]},"Name",[]],["opt",{sourceInterval:[281,288]},["app",{sourceInterval:[281,287]},"Extras",[]]],["app",{sourceInterval:[289,300]},"VersionSpec",[]],["opt",{sourceInterval:[301,314]},["app",{sourceInterval:[301,313]},"QuotedMarker",[]]]]],UrlReq:["define",{sourceInterval:[319,371]},null,[],["seq",{sourceInterval:[329,371]},["app",{sourceInterval:[329,333]},"Name",[]],["opt",{sourceInterval:[334,341]},["app",{sourceInterval:[334,340]},"Extras",[]]],["app",{sourceInterval:[342,349]},"UrlSpec",[]],["opt",{sourceInterval:[350,371]},["seq",{sourceInterval:[351,369]},["app",{sourceInterval:[351,356]},"space",[]],["app",{sourceInterval:[357,369]},"QuotedMarker",[]]]]]],Extras:["define",{sourceInterval:[376,417]},null,[],["seq",{sourceInterval:[386,417]},["terminal",{sourceInterval:[386,389]},"["],["app",{sourceInterval:[390,413]},"ListOf",[["app",{sourceInterval:[397,407]},"identifier",[]],["terminal",{sourceInterval:[409,412]},","]]],["terminal",{sourceInterval:[414,417]},"]"]]],Name:["define",{sourceInterval:[422,442]},null,[],["app",{sourceInterval:[432,442]},"identifier",[]]],identifier:["define",{sourceInterval:[447,483]},null,[],["seq",{sourceInterval:[463,483]},["app",{sourceInterval:[463,468]},"alnum",[]],["star",{sourceInterval:[469,483]},["app",{sourceInterval:[469,482]},"identifierEnd",[]]]]],identifierEnd_single:["define",{sourceInterval:[504,519]},null,[],["app",{sourceInterval:[504,509]},"alnum",[]]],identifierEnd_multi:["define",{sourceInterval:[540,576]},null,[],["seq",{sourceInterval:[540,567]},["star",{sourceInterval:[541,560]},["alt",{sourceInterval:[542,557]},["terminal",{sourceInterval:[542,545]},"-"],["terminal",{sourceInterval:[548,551]},"_"],["terminal",{sourceInterval:[554,557]},"."]]],["app",{sourceInterval:[561,566]},"alnum",[]]]],identifierEnd:["define",{sourceInterval:[488,576]},null,[],["alt",{sourceInterval:[504,576]},["app",{sourceInterval:[504,509]},"identifierEnd_single",[]],["app",{sourceInterval:[540,567]},"identifierEnd_multi",[]]]],RequirementsReq:["define",{sourceInterval:[675,706]},null,[],["seq",{sourceInterval:[693,706]},["terminal",{sourceInterval:[693,697]},"-r"],["app",{sourceInterval:[698,706]},"filePath",[]]]],ConstraintsReq:["define",{sourceInterval:[711,742]},null,[],["seq",{sourceInterval:[729,742]},["terminal",{sourceInterval:[729,733]},"-c"],["app",{sourceInterval:[734,742]},"filePath",[]]]],filePath:["define",{sourceInterval:[747,785]},null,[],["plus",{sourceInterval:[765,785]},["seq",{sourceInterval:[766,783]},["not",{sourceInterval:[766,779]},["alt",{sourceInterval:[768,778]},["terminal",{sourceInterval:[768,772]},`
`],["terminal",{sourceInterval:[775,778]},"#"]]],["app",{sourceInterval:[780,783]},"any",[]]]]],UrlSpec:["define",{sourceInterval:[791,822]},null,[],["seq",{sourceInterval:[806,822]},["terminal",{sourceInterval:[806,809]},"@"],["app",{sourceInterval:[810,822]},"uriReference",[]]]],uriReference:["define",{sourceInterval:[827,859]},null,[],["alt",{sourceInterval:[842,859]},["app",{sourceInterval:[842,845]},"uri",[]],["app",{sourceInterval:[848,859]},"relativeRef",[]]]],uri:["define",{sourceInterval:[864,929]},null,[],["seq",{sourceInterval:[879,929]},["app",{sourceInterval:[879,885]},"scheme",[]],["terminal",{sourceInterval:[886,889]},":"],["opt",{sourceInterval:[890,899]},["app",{sourceInterval:[890,898]},"hierPart",[]]],["opt",{sourceInterval:[900,913]},["seq",{sourceInterval:[901,910]},["terminal",{sourceInterval:[901,904]},"?"],["app",{sourceInterval:[905,910]},"query",[]]]],["opt",{sourceInterval:[914,929]},["seq",{sourceInterval:[915,927]},["terminal",{sourceInterval:[915,918]},"#"],["app",{sourceInterval:[919,927]},"fragment",[]]]]]],hierPart_abempty:["define",{sourceInterval:[949,988]},null,[],["seq",{sourceInterval:[949,977]},["terminal",{sourceInterval:[950,954]},"//"],["app",{sourceInterval:[955,964]},"authority",[]],["app",{sourceInterval:[965,976]},"pathAbempty",[]]]],hierPart_absolute:["define",{sourceInterval:[1008,1032]},null,[],["app",{sourceInterval:[1008,1020]},"pathAbsolute",[]]],hierPart_rootless:["define",{sourceInterval:[1052,1076]},null,[],["app",{sourceInterval:[1052,1064]},"pathRootless",[]]],hierPart:["define",{sourceInterval:[934,1076]},null,[],["alt",{sourceInterval:[949,1076]},["app",{sourceInterval:[949,977]},"hierPart_abempty",[]],["app",{sourceInterval:[1008,1020]},"hierPart_absolute",[]],["app",{sourceInterval:[1052,1064]},"hierPart_rootless",[]]]],absoluteUri:["define",{sourceInterval:[1081,1130]},null,[],["seq",{sourceInterval:[1096,1130]},["app",{sourceInterval:[1096,1102]},"scheme",[]],["terminal",{sourceInterval:[1103,1106]},":"],["opt",{sourceInterval:[1107,1116]},["app",{sourceInterval:[1107,1115]},"hierPart",[]]],["opt",{sourceInterval:[1117,1130]},["seq",{sourceInterval:[1118,1127]},["terminal",{sourceInterval:[1118,1121]},"?"],["app",{sourceInterval:[1122,1127]},"query",[]]]]]],relativeRef:["define",{sourceInterval:[1135,1194]},null,[],["seq",{sourceInterval:[1150,1194]},["opt",{sourceInterval:[1150,1163]},["app",{sourceInterval:[1150,1162]},"relativePart",[]]],["opt",{sourceInterval:[1164,1177]},["seq",{sourceInterval:[1165,1174]},["terminal",{sourceInterval:[1165,1168]},"?"],["app",{sourceInterval:[1169,1174]},"query",[]]]],["opt",{sourceInterval:[1178,1194]},["seq",{sourceInterval:[1179,1191]},["terminal",{sourceInterval:[1179,1182]},"#"],["app",{sourceInterval:[1183,1191]},"fragment",[]]]]]],relativePart_abempty:["define",{sourceInterval:[1214,1251]},null,[],["seq",{sourceInterval:[1214,1240]},["terminal",{sourceInterval:[1214,1218]},"//"],["app",{sourceInterval:[1219,1228]},"authority",[]],["app",{sourceInterval:[1229,1240]},"pathAbempty",[]]]],relativePart_absolute:["define",{sourceInterval:[1271,1295]},null,[],["app",{sourceInterval:[1271,1283]},"pathAbsolute",[]]],relativePart_noscheme:["define",{sourceInterval:[1315,1339]},null,[],["app",{sourceInterval:[1315,1327]},"pathNoscheme",[]]],relativePart:["define",{sourceInterval:[1199,1339]},null,[],["alt",{sourceInterval:[1214,1339]},["app",{sourceInterval:[1214,1240]},"relativePart_abempty",[]],["app",{sourceInterval:[1271,1283]},"relativePart_absolute",[]],["app",{sourceInterval:[1315,1327]},"relativePart_noscheme",[]]]],scheme:["define",{sourceInterval:[1344,1392]},null,[],["seq",{sourceInterval:[1359,1392]},["app",{sourceInterval:[1359,1365]},"letter",[]],["star",{sourceInterval:[1366,1392]},["alt",{sourceInterval:[1367,1390]},["app",{sourceInterval:[1367,1372]},"alnum",[]],["terminal",{sourceInterval:[1375,1378]},"+"],["terminal",{sourceInterval:[1381,1384]},"-"],["terminal",{sourceInterval:[1387,1390]},"."]]]]],authority:["define",{sourceInterval:[1397,1446]},null,[],["seq",{sourceInterval:[1412,1446]},["opt",{sourceInterval:[1412,1428]},["seq",{sourceInterval:[1413,1425]},["app",{sourceInterval:[1413,1421]},"userinfo",[]],["terminal",{sourceInterval:[1422,1425]},"@"]]],["app",{sourceInterval:[1429,1433]},"host",[]],["opt",{sourceInterval:[1434,1446]},["seq",{sourceInterval:[1435,1443]},["terminal",{sourceInterval:[1435,1438]},":"],["app",{sourceInterval:[1439,1443]},"port",[]]]]]],userinfo:["define",{sourceInterval:[1451,1510]},null,[],["star",{sourceInterval:[1466,1510]},["alt",{sourceInterval:[1467,1508]},["app",{sourceInterval:[1467,1477]},"unreserved",[]],["app",{sourceInterval:[1480,1490]},"pctEncoded",[]],["app",{sourceInterval:[1493,1502]},"subDelims",[]],["terminal",{sourceInterval:[1505,1508]},":"]]]],host:["define",{sourceInterval:[1515,1563]},null,[],["alt",{sourceInterval:[1530,1563]},["app",{sourceInterval:[1530,1539]},"ipLiteral",[]],["app",{sourceInterval:[1542,1553]},"ipv4Address",[]],["app",{sourceInterval:[1556,1563]},"regName",[]]]],port:["define",{sourceInterval:[1568,1589]},null,[],["star",{sourceInterval:[1583,1589]},["app",{sourceInterval:[1583,1588]},"digit",[]]]],ipLiteral:["define",{sourceInterval:[1594,1642]},null,[],["seq",{sourceInterval:[1609,1642]},["terminal",{sourceInterval:[1609,1612]},"["],["alt",{sourceInterval:[1614,1637]},["app",{sourceInterval:[1614,1625]},"ipv6Address",[]],["app",{sourceInterval:[1628,1637]},"ipvFuture",[]]],["terminal",{sourceInterval:[1639,1642]},"]"]]],ipvFuture:["define",{sourceInterval:[1647,1709]},null,[],["seq",{sourceInterval:[1662,1709]},["terminal",{sourceInterval:[1662,1665]},"v"],["plus",{sourceInterval:[1666,1673]},["app",{sourceInterval:[1666,1672]},"hexdig",[]]],["terminal",{sourceInterval:[1674,1677]},"."],["plus",{sourceInterval:[1678,1709]},["alt",{sourceInterval:[1679,1707]},["app",{sourceInterval:[1679,1689]},"unreserved",[]],["app",{sourceInterval:[1692,1701]},"subDelims",[]],["terminal",{sourceInterval:[1704,1707]},":"]]]]],ipv6Address:["define",{sourceInterval:[1714,1750]},null,[],["plus",{sourceInterval:[1729,1750]},["alt",{sourceInterval:[1730,1748]},["app",{sourceInterval:[1730,1736]},"hexdig",[]],["terminal",{sourceInterval:[1739,1742]},":"],["terminal",{sourceInterval:[1745,1748]},"."]]]],ipv4Address:["define",{sourceInterval:[1825,1887]},null,[],["seq",{sourceInterval:[1840,1887]},["app",{sourceInterval:[1840,1848]},"decOctet",[]],["terminal",{sourceInterval:[1849,1852]},"."],["app",{sourceInterval:[1853,1861]},"decOctet",[]],["terminal",{sourceInterval:[1862,1865]},"."],["app",{sourceInterval:[1866,1874]},"decOctet",[]],["terminal",{sourceInterval:[1875,1878]},"."],["app",{sourceInterval:[1879,1887]},"decOctet",[]]]],nz:["define",{sourceInterval:[1892,1917]},null,[],["seq",{sourceInterval:[1907,1917]},["not",{sourceInterval:[1907,1911]},["terminal",{sourceInterval:[1908,1911]},"0"]],["app",{sourceInterval:[1912,1917]},"digit",[]]]],decOctet_zeroToNine:["define",{sourceInterval:[1937,1956]},null,[],["app",{sourceInterval:[1937,1942]},"digit",[]]],decOctet_tenToNinetyNine:["define",{sourceInterval:[1976,2003]},null,[],["seq",{sourceInterval:[1976,1984]},["app",{sourceInterval:[1976,1978]},"nz",[]],["app",{sourceInterval:[1979,1984]},"digit",[]]]],decOctet_oneHundredToOneNinetyNine:["define",{sourceInterval:[2023,2067]},null,[],["seq",{sourceInterval:[2023,2038]},["terminal",{sourceInterval:[2023,2026]},"1"],["app",{sourceInterval:[2027,2032]},"digit",[]],["app",{sourceInterval:[2033,2038]},"digit",[]]]],decOctet_twoHundredToTwoFortyNine:["define",{sourceInterval:[2087,2154]},null,[],["seq",{sourceInterval:[2087,2126]},["terminal",{sourceInterval:[2087,2090]},"2"],["alt",{sourceInterval:[2092,2119]},["terminal",{sourceInterval:[2092,2095]},"0"],["terminal",{sourceInterval:[2098,2101]},"1"],["terminal",{sourceInterval:[2104,2107]},"2"],["terminal",{sourceInterval:[2110,2113]},"3"],["terminal",{sourceInterval:[2116,2119]},"4"]],["app",{sourceInterval:[2121,2126]},"digit",[]]]],decOctet_twoFiftyToTwoFiftyFive:["define",{sourceInterval:[2174,2240]},null,[],["seq",{sourceInterval:[2174,2214]},["terminal",{sourceInterval:[2174,2178]},"25"],["alt",{sourceInterval:[2180,2213]},["terminal",{sourceInterval:[2180,2183]},"0"],["terminal",{sourceInterval:[2186,2189]},"1"],["terminal",{sourceInterval:[2192,2195]},"2"],["terminal",{sourceInterval:[2198,2201]},"3"],["terminal",{sourceInterval:[2204,2207]},"4"],["terminal",{sourceInterval:[2210,2213]},"5"]]]],decOctet:["define",{sourceInterval:[1922,2240]},null,[],["alt",{sourceInterval:[1937,2240]},["app",{sourceInterval:[1937,1942]},"decOctet_zeroToNine",[]],["app",{sourceInterval:[1976,1984]},"decOctet_tenToNinetyNine",[]],["app",{sourceInterval:[2023,2038]},"decOctet_oneHundredToOneNinetyNine",[]],["app",{sourceInterval:[2087,2126]},"decOctet_twoHundredToTwoFortyNine",[]],["app",{sourceInterval:[2174,2214]},"decOctet_twoFiftyToTwoFiftyFive",[]]]],regName:["define",{sourceInterval:[2245,2298]},null,[],["star",{sourceInterval:[2260,2298]},["alt",{sourceInterval:[2261,2296]},["app",{sourceInterval:[2261,2271]},"unreserved",[]],["app",{sourceInterval:[2274,2284]},"pctEncoded",[]],["app",{sourceInterval:[2287,2296]},"subDelims",[]]]]],path:["define",{sourceInterval:[2303,2523]},null,[],["alt",{sourceInterval:[2318,2523]},["app",{sourceInterval:[2318,2329]},"pathAbempty",[]],["app",{sourceInterval:[2380,2392]},"pathAbsolute",[]],["app",{sourceInterval:[2444,2456]},"pathNoscheme",[]],["app",{sourceInterval:[2511,2523]},"pathRootless",[]]]],pathAbempty:["define",{sourceInterval:[2553,2582]},null,[],["star",{sourceInterval:[2568,2582]},["seq",{sourceInterval:[2569,2580]},["terminal",{sourceInterval:[2569,2572]},"/"],["app",{sourceInterval:[2573,2580]},"segment",[]]]]],pathAbsolute:["define",{sourceInterval:[2587,2634]},null,[],["seq",{sourceInterval:[2602,2634]},["terminal",{sourceInterval:[2602,2605]},"/"],["opt",{sourceInterval:[2606,2634]},["seq",{sourceInterval:[2607,2631]},["app",{sourceInterval:[2607,2616]},"segmentNz",[]],["star",{sourceInterval:[2617,2631]},["seq",{sourceInterval:[2618,2629]},["terminal",{sourceInterval:[2618,2621]},"/"],["app",{sourceInterval:[2622,2629]},"segment",[]]]]]]]],pathNoscheme:["define",{sourceInterval:[2639,2680]},null,[],["seq",{sourceInterval:[2654,2680]},["app",{sourceInterval:[2654,2665]},"segmentNzNc",[]],["star",{sourceInterval:[2666,2680]},["seq",{sourceInterval:[2667,2678]},["terminal",{sourceInterval:[2667,2670]},"/"],["app",{sourceInterval:[2671,2678]},"segment",[]]]]]],pathRootless:["define",{sourceInterval:[2685,2724]},null,[],["seq",{sourceInterval:[2700,2724]},["app",{sourceInterval:[2700,2709]},"segmentNz",[]],["star",{sourceInterval:[2710,2724]},["seq",{sourceInterval:[2711,2722]},["terminal",{sourceInterval:[2711,2714]},"/"],["app",{sourceInterval:[2715,2722]},"segment",[]]]]]],segment:["define",{sourceInterval:[2729,2750]},null,[],["star",{sourceInterval:[2744,2750]},["app",{sourceInterval:[2744,2749]},"pchar",[]]]],segmentNz:["define",{sourceInterval:[2755,2776]},null,[],["plus",{sourceInterval:[2770,2776]},["app",{sourceInterval:[2770,2775]},"pchar",[]]]],segmentNzNc:["define",{sourceInterval:[2781,2840]},null,[],["plus",{sourceInterval:[2796,2840]},["alt",{sourceInterval:[2797,2838]},["app",{sourceInterval:[2797,2807]},"unreserved",[]],["app",{sourceInterval:[2810,2820]},"pctEncoded",[]],["app",{sourceInterval:[2823,2832]},"subDelims",[]],["terminal",{sourceInterval:[2835,2838]},"@"]]]],pchar:["define",{sourceInterval:[2894,2956]},null,[],["alt",{sourceInterval:[2909,2956]},["app",{sourceInterval:[2909,2919]},"unreserved",[]],["app",{sourceInterval:[2922,2932]},"pctEncoded",[]],["app",{sourceInterval:[2935,2944]},"subDelims",[]],["terminal",{sourceInterval:[2947,2950]},":"],["terminal",{sourceInterval:[2953,2956]},"@"]]],query:["define",{sourceInterval:[2961,2996]},null,[],["star",{sourceInterval:[2976,2996]},["alt",{sourceInterval:[2977,2994]},["app",{sourceInterval:[2977,2982]},"pchar",[]],["terminal",{sourceInterval:[2985,2988]},"/"],["terminal",{sourceInterval:[2991,2994]},"?"]]]],fragment:["define",{sourceInterval:[3001,3036]},null,[],["star",{sourceInterval:[3016,3036]},["alt",{sourceInterval:[3017,3034]},["app",{sourceInterval:[3017,3022]},"pchar",[]],["terminal",{sourceInterval:[3025,3028]},"/"],["terminal",{sourceInterval:[3031,3034]},"?"]]]],pctEncoded:["define",{sourceInterval:[3041,3066]},null,[],["seq",{sourceInterval:[3056,3066]},["terminal",{sourceInterval:[3056,3059]},"%"],["app",{sourceInterval:[3060,3066]},"hexdig",[]]]],unreserved:["define",{sourceInterval:[3071,3115]},null,[],["alt",{sourceInterval:[3086,3115]},["app",{sourceInterval:[3086,3091]},"alnum",[]],["terminal",{sourceInterval:[3094,3097]},"-"],["terminal",{sourceInterval:[3100,3103]},"."],["terminal",{sourceInterval:[3106,3109]},"_"],["terminal",{sourceInterval:[3112,3115]},"~"]]],reserved:["define",{sourceInterval:[3120,3156]},null,[],["alt",{sourceInterval:[3135,3156]},["app",{sourceInterval:[3135,3144]},"genDelims",[]],["app",{sourceInterval:[3147,3156]},"subDelims",[]]]],genDelims:["define",{sourceInterval:[3161,3216]},null,[],["alt",{sourceInterval:[3176,3216]},["terminal",{sourceInterval:[3176,3179]},":"],["terminal",{sourceInterval:[3182,3185]},"/"],["terminal",{sourceInterval:[3188,3191]},"?"],["terminal",{sourceInterval:[3194,3197]},"#"],["terminal",{sourceInterval:[3200,3203]},"("],["terminal",{sourceInterval:[3206,3210]},")?"],["terminal",{sourceInterval:[3213,3216]},"@"]]],subDelims:["define",{sourceInterval:[3221,3299]},null,[],["alt",{sourceInterval:[3236,3299]},["terminal",{sourceInterval:[3236,3239]},"!"],["terminal",{sourceInterval:[3242,3245]},"$"],["terminal",{sourceInterval:[3248,3251]},"&"],["terminal",{sourceInterval:[3254,3257]},"'"],["terminal",{sourceInterval:[3260,3263]},"("],["terminal",{sourceInterval:[3266,3269]},")"],["terminal",{sourceInterval:[3272,3275]},"*"],["terminal",{sourceInterval:[3278,3281]},"+"],["terminal",{sourceInterval:[3284,3287]},","],["terminal",{sourceInterval:[3290,3293]},";"],["terminal",{sourceInterval:[3296,3299]},"="]]],hexdig:["define",{sourceInterval:[3304,3396]},null,[],["alt",{sourceInterval:[3319,3396]},["app",{sourceInterval:[3319,3324]},"digit",[]],["terminal",{sourceInterval:[3327,3330]},"a"],["terminal",{sourceInterval:[3333,3336]},"A"],["terminal",{sourceInterval:[3339,3342]},"b"],["terminal",{sourceInterval:[3345,3348]},"B"],["terminal",{sourceInterval:[3351,3354]},"c"],["terminal",{sourceInterval:[3357,3360]},"C"],["terminal",{sourceInterval:[3363,3366]},"d"],["terminal",{sourceInterval:[3369,3372]},"D"],["terminal",{sourceInterval:[3375,3378]},"e"],["terminal",{sourceInterval:[3381,3384]},"E"],["terminal",{sourceInterval:[3387,3390]},"f"],["terminal",{sourceInterval:[3393,3396]},"F"]]],QuotedMarker:["define",{sourceInterval:[3429,3455]},null,[],["seq",{sourceInterval:[3445,3455]},["terminal",{sourceInterval:[3445,3448]},";"],["app",{sourceInterval:[3449,3455]},"Marker",[]]]],Marker:["define",{sourceInterval:[3460,3484]},null,[],["app",{sourceInterval:[3476,3484]},"MarkerOr",[]]],MarkerOr_node:["define",{sourceInterval:[3505,3537]},null,[],["seq",{sourceInterval:[3505,3529]},["app",{sourceInterval:[3505,3514]},"MarkerAnd",[]],["terminal",{sourceInterval:[3515,3519]},"or"],["app",{sourceInterval:[3520,3529]},"MarkerAnd",[]]]],MarkerOr_leaf:["define",{sourceInterval:[3558,3575]},null,[],["app",{sourceInterval:[3558,3567]},"MarkerAnd",[]]],MarkerOr:["define",{sourceInterval:[3489,3575]},null,[],["alt",{sourceInterval:[3505,3575]},["app",{sourceInterval:[3505,3529]},"MarkerOr_node",[]],["app",{sourceInterval:[3558,3567]},"MarkerOr_leaf",[]]]],MarkerAnd_node:["define",{sourceInterval:[3596,3631]},null,[],["seq",{sourceInterval:[3596,3623]},["app",{sourceInterval:[3596,3606]},"MarkerExpr",[]],["terminal",{sourceInterval:[3607,3612]},"and"],["app",{sourceInterval:[3613,3623]},"MarkerExpr",[]]]],MarkerAnd_leaf:["define",{sourceInterval:[3652,3670]},null,[],["app",{sourceInterval:[3652,3662]},"MarkerExpr",[]]],MarkerAnd:["define",{sourceInterval:[3580,3670]},null,[],["alt",{sourceInterval:[3596,3670]},["app",{sourceInterval:[3596,3623]},"MarkerAnd_node",[]],["app",{sourceInterval:[3652,3662]},"MarkerAnd_leaf",[]]]],MarkerExpr_leaf:["define",{sourceInterval:[3691,3727]},null,[],["seq",{sourceInterval:[3691,3719]},["app",{sourceInterval:[3691,3700]},"MarkerVar",[]],["app",{sourceInterval:[3701,3709]},"markerOp",[]],["app",{sourceInterval:[3710,3719]},"MarkerVar",[]]]],MarkerExpr_node:["define",{sourceInterval:[3748,3770]},null,[],["seq",{sourceInterval:[3748,3762]},["terminal",{sourceInterval:[3748,3751]},"("],["app",{sourceInterval:[3752,3758]},"Marker",[]],["terminal",{sourceInterval:[3759,3762]},")"]]],MarkerExpr:["define",{sourceInterval:[3675,3770]},null,[],["alt",{sourceInterval:[3691,3770]},["app",{sourceInterval:[3691,3719]},"MarkerExpr_leaf",[]],["app",{sourceInterval:[3748,3762]},"MarkerExpr_node",[]]]],MarkerVar:["define",{sourceInterval:[3775,3809]},null,[],["alt",{sourceInterval:[3791,3809]},["app",{sourceInterval:[3791,3797]},"envVar",[]],["app",{sourceInterval:[3800,3809]},"pythonStr",[]]]],markerOp_versionCmp:["define",{sourceInterval:[3830,3854]},null,[],["app",{sourceInterval:[3830,3840]},"versionCmp",[]]],markerOp_in:["define",{sourceInterval:[3875,3885]},null,[],["terminal",{sourceInterval:[3875,3879]},"in"]],markerOp_notIn:["define",{sourceInterval:[3906,3934]},null,[],["seq",{sourceInterval:[3906,3925]},["terminal",{sourceInterval:[3907,3912]},"not"],["plus",{sourceInterval:[3913,3919]},["app",{sourceInterval:[3913,3918]},"space",[]]],["terminal",{sourceInterval:[3920,3924]},"in"]]],markerOp:["define",{sourceInterval:[3814,3934]},null,[],["alt",{sourceInterval:[3830,3934]},["app",{sourceInterval:[3830,3840]},"markerOp_versionCmp",[]],["app",{sourceInterval:[3875,3879]},"markerOp_in",[]],["app",{sourceInterval:[3906,3925]},"markerOp_notIn",[]]]],pythonStr:["define",{sourceInterval:[3939,4039]},null,[],["alt",{sourceInterval:[3955,4039]},["seq",{sourceInterval:[3955,3986]},["terminal",{sourceInterval:[3955,3958]},"'"],["star",{sourceInterval:[3959,3982]},["alt",{sourceInterval:[3960,3980]},["app",{sourceInterval:[3960,3973]},"pythonStrChar",[]],["terminal",{sourceInterval:[3976,3980]},'"']]],["terminal",{sourceInterval:[3983,3986]},"'"]],["seq",{sourceInterval:[4007,4039]},["terminal",{sourceInterval:[4007,4011]},'"'],["star",{sourceInterval:[4012,4034]},["alt",{sourceInterval:[4013,4032]},["app",{sourceInterval:[4013,4026]},"pythonStrChar",[]],["terminal",{sourceInterval:[4029,4032]},"'"]]],["terminal",{sourceInterval:[4035,4039]},'"']]]],pythonStrChar:["define",{sourceInterval:[4044,4265]},null,[],["alt",{sourceInterval:[4060,4265]},["app",{sourceInterval:[4060,4065]},"space",[]],["app",{sourceInterval:[4068,4073]},"alnum",[]],["terminal",{sourceInterval:[4076,4079]},"("],["terminal",{sourceInterval:[4082,4085]},")"],["terminal",{sourceInterval:[4088,4091]},"."],["terminal",{sourceInterval:[4094,4097]},"{"],["terminal",{sourceInterval:[4100,4103]},"}"],["terminal",{sourceInterval:[4106,4109]},"-"],["terminal",{sourceInterval:[4112,4115]},"_"],["terminal",{sourceInterval:[4118,4121]},"*"],["terminal",{sourceInterval:[4124,4127]},"#"],["terminal",{sourceInterval:[4130,4133]},":"],["terminal",{sourceInterval:[4136,4139]},";"],["terminal",{sourceInterval:[4142,4145]},","],["terminal",{sourceInterval:[4148,4151]},"/"],["terminal",{sourceInterval:[4154,4157]},"?"],["terminal",{sourceInterval:[4178,4181]},"["],["terminal",{sourceInterval:[4184,4187]},"]"],["terminal",{sourceInterval:[4190,4193]},"!"],["terminal",{sourceInterval:[4196,4199]},"~"],["terminal",{sourceInterval:[4202,4205]},"`"],["terminal",{sourceInterval:[4208,4211]},"@"],["terminal",{sourceInterval:[4214,4217]},"$"],["terminal",{sourceInterval:[4220,4223]},"%"],["terminal",{sourceInterval:[4226,4229]},"^"],["terminal",{sourceInterval:[4232,4235]},"&"],["terminal",{sourceInterval:[4238,4241]},"="],["terminal",{sourceInterval:[4244,4247]},"+"],["terminal",{sourceInterval:[4250,4253]},"|"],["terminal",{sourceInterval:[4256,4259]},"<"],["terminal",{sourceInterval:[4262,4265]},">"]]],envVar:["define",{sourceInterval:[4270,4570]},null,[],["alt",{sourceInterval:[4286,4570]},["terminal",{sourceInterval:[4286,4302]},"python_version"],["terminal",{sourceInterval:[4305,4326]},"python_full_version"],["terminal",{sourceInterval:[4329,4338]},"os_name"],["terminal",{sourceInterval:[4341,4355]},"sys_platform"],["terminal",{sourceInterval:[4358,4376]},"platform_release"],["terminal",{sourceInterval:[4397,4414]},"platform_system"],["terminal",{sourceInterval:[4417,4435]},"platform_version"],["terminal",{sourceInterval:[4438,4456]},"platform_machine"],["terminal",{sourceInterval:[4459,4491]},"platform_python_implementation"],["terminal",{sourceInterval:[4512,4533]},"implementation_name"],["terminal",{sourceInterval:[4536,4560]},"implementation_version"],["terminal",{sourceInterval:[4563,4570]},"extra"]]],VersionSpec_parenthesized:["define",{sourceInterval:[4717,4753]},null,[],["seq",{sourceInterval:[4717,4736]},["terminal",{sourceInterval:[4717,4720]},"("],["app",{sourceInterval:[4721,4732]},"VersionMany",[]],["terminal",{sourceInterval:[4733,4736]},")"]]],VersionSpec_direct:["define",{sourceInterval:[4774,4795]},null,[],["app",{sourceInterval:[4774,4785]},"VersionMany",[]]],VersionSpec:["define",{sourceInterval:[4701,4795]},null,[],["alt",{sourceInterval:[4717,4795]},["app",{sourceInterval:[4717,4736]},"VersionSpec_parenthesized",[]],["app",{sourceInterval:[4774,4785]},"VersionSpec_direct",[]]]],VersionMany:["define",{sourceInterval:[4800,4839]},null,[],["app",{sourceInterval:[4816,4839]},"ListOf",[["app",{sourceInterval:[4823,4833]},"VersionOne",[]],["terminal",{sourceInterval:[4835,4838]},","]]]],VersionOne:["define",{sourceInterval:[4844,4878]},null,[],["seq",{sourceInterval:[4860,4878]},["app",{sourceInterval:[4860,4870]},"versionCmp",[]],["app",{sourceInterval:[4871,4878]},"version",[]]]],versionCmp:["define",{sourceInterval:[4883,4951]},null,[],["alt",{sourceInterval:[4899,4951]},["terminal",{sourceInterval:[4899,4903]},"<="],["terminal",{sourceInterval:[4906,4909]},"<"],["terminal",{sourceInterval:[4912,4916]},"!="],["terminal",{sourceInterval:[4919,4923]},"=="],["terminal",{sourceInterval:[4926,4930]},">="],["terminal",{sourceInterval:[4933,4936]},">"],["terminal",{sourceInterval:[4939,4943]},"~="],["terminal",{sourceInterval:[4946,4951]},"==="]]],version:["define",{sourceInterval:[4956,5017]},null,[],["plus",{sourceInterval:[4972,5017]},["alt",{sourceInterval:[4973,5014]},["app",{sourceInterval:[4973,4978]},"alnum",[]],["terminal",{sourceInterval:[4981,4984]},"-"],["terminal",{sourceInterval:[4987,4990]},"_"],["terminal",{sourceInterval:[4993,4996]},"."],["terminal",{sourceInterval:[4999,5002]},"*"],["terminal",{sourceInterval:[5005,5008]},"+"],["terminal",{sourceInterval:[5011,5014]},"!"]]]],comment:["define",{sourceInterval:[5023,5049]},null,[],["seq",{sourceInterval:[5033,5049]},["terminal",{sourceInterval:[5033,5036]},"#"],["star",{sourceInterval:[5037,5049]},["seq",{sourceInterval:[5038,5047]},["not",{sourceInterval:[5038,5043]},["terminal",{sourceInterval:[5039,5043]},`
`]],["app",{sourceInterval:[5044,5047]},"any",[]]]]]],space:["override",{sourceInterval:[5055,5074]},null,[],["alt",{sourceInterval:[5064,5074]},["terminal",{sourceInterval:[5064,5067]}," "],["terminal",{sourceInterval:[5070,5074]},"	"]]],LooseFile:["define",{sourceInterval:[5291,5334]},null,[],["app",{sourceInterval:[5311,5334]},"ListOf",[["app",{sourceInterval:[5318,5327]},"LooseLine",[]],["terminal",{sourceInterval:[5329,5333]},`
`]]]],LooseLine:["define",{sourceInterval:[5339,5376]},null,[],["seq",{sourceInterval:[5359,5376]},["app",{sourceInterval:[5359,5367]},"LooseReq",[]],["opt",{sourceInterval:[5368,5376]},["app",{sourceInterval:[5368,5375]},"comment",[]]]]],LooseReq:["define",{sourceInterval:[5381,5431]},null,[],["alt",{sourceInterval:[5401,5431]},["app",{sourceInterval:[5401,5416]},"LooseNonNameReq",[]],["app",{sourceInterval:[5419,5431]},"LooseNameReq",[]]]],LooseNameReq:["define",{sourceInterval:[5436,5509]},null,[],["seq",{sourceInterval:[5456,5509]},["app",{sourceInterval:[5456,5460]},"Name",[]],["opt",{sourceInterval:[5461,5473]},["app",{sourceInterval:[5461,5472]},"LooseExtras",[]]],["app",{sourceInterval:[5474,5490]},"LooseVersionSpec",[]],["opt",{sourceInterval:[5491,5509]},["app",{sourceInterval:[5491,5508]},"LooseQuotedMarker",[]]]]],LooseNonNameReq:["define",{sourceInterval:[5514,5569]},null,[],["seq",{sourceInterval:[5534,5569]},["not",{sourceInterval:[5535,5554]},["seq",{sourceInterval:[5537,5553]},["not",{sourceInterval:[5537,5548]},["seq",{sourceInterval:[5539,5547]},["app",{sourceInterval:[5539,5543]},"Name",[]],["terminal",{sourceInterval:[5544,5547]},"@"]]],["app",{sourceInterval:[5549,5553]},"Name",[]]]],["app",{sourceInterval:[5555,5568]},"looseAnything",[]]]],LooseExtras:["define",{sourceInterval:[5634,5691]},null,[],["seq",{sourceInterval:[5654,5691]},["terminal",{sourceInterval:[5654,5657]},"["],["app",{sourceInterval:[5658,5681]},"ListOf",[["app",{sourceInterval:[5665,5675]},"identifier",[]],["terminal",{sourceInterval:[5677,5680]},","]]],["star",{sourceInterval:[5682,5686]},["terminal",{sourceInterval:[5682,5685]},","]],["opt",{sourceInterval:[5687,5691]},["terminal",{sourceInterval:[5687,5690]},"]"]]]],LooseQuotedMarker:["define",{sourceInterval:[5696,5733]},null,[],["seq",{sourceInterval:[5716,5733]},["terminal",{sourceInterval:[5716,5719]},";"],["app",{sourceInterval:[5720,5733]},"looseAnything",[]]]],LooseVersionSpec_parenthesized:["define",{sourceInterval:[5758,5800]},null,[],["seq",{sourceInterval:[5758,5783]},["terminal",{sourceInterval:[5758,5761]},"("],["app",{sourceInterval:[5762,5778]},"LooseVersionMany",[]],["opt",{sourceInterval:[5779,5783]},["terminal",{sourceInterval:[5779,5782]},")"]]]],LooseVersionSpec_direct:["define",{sourceInterval:[5825,5851]},null,[],["app",{sourceInterval:[5825,5841]},"LooseVersionMany",[]]],LooseVersionSpec:["define",{sourceInterval:[5738,5851]},null,[],["alt",{sourceInterval:[5758,5851]},["app",{sourceInterval:[5758,5783]},"LooseVersionSpec_parenthesized",[]],["app",{sourceInterval:[5825,5841]},"LooseVersionSpec_direct",[]]]],LooseVersionMany:["define",{sourceInterval:[5856,5909]},null,[],["seq",{sourceInterval:[5876,5909]},["app",{sourceInterval:[5876,5904]},"ListOf",[["app",{sourceInterval:[5883,5898]},"LooseVersionOne",[]],["terminal",{sourceInterval:[5900,5903]},","]]],["star",{sourceInterval:[5905,5909]},["terminal",{sourceInterval:[5905,5908]},","]]]],LooseVersionOne:["define",{sourceInterval:[5914,5963]},null,[],["seq",{sourceInterval:[5934,5963]},["app",{sourceInterval:[5934,5949]},"looseVersionCmp",[]],["opt",{sourceInterval:[5950,5963]},["app",{sourceInterval:[5950,5962]},"looseVersion",[]]]]],looseVersionCmp:["define",{sourceInterval:[5968,6018]},null,[],["plus",{sourceInterval:[5988,6018]},["alt",{sourceInterval:[5989,6016]},["terminal",{sourceInterval:[5989,5992]},"<"],["terminal",{sourceInterval:[5995,5998]},"="],["terminal",{sourceInterval:[6001,6004]},"!"],["terminal",{sourceInterval:[6007,6010]},">"],["terminal",{sourceInterval:[6013,6016]},"~"]]]],looseVersion:["define",{sourceInterval:[6023,6088]},null,[],["plus",{sourceInterval:[6043,6088]},["alt",{sourceInterval:[6044,6085]},["app",{sourceInterval:[6044,6049]},"alnum",[]],["terminal",{sourceInterval:[6052,6055]},"-"],["terminal",{sourceInterval:[6058,6061]},"_"],["terminal",{sourceInterval:[6064,6067]},"."],["terminal",{sourceInterval:[6070,6073]},"*"],["terminal",{sourceInterval:[6076,6079]},"+"],["terminal",{sourceInterval:[6082,6085]},"!"]]]],looseAnything:["define",{sourceInterval:[6093,6133]},null,[],["star",{sourceInterval:[6113,6133]},["seq",{sourceInterval:[6114,6131]},["not",{sourceInterval:[6114,6127]},["alt",{sourceInterval:[6116,6126]},["terminal",{sourceInterval:[6116,6120]},`
`],["terminal",{sourceInterval:[6123,6126]},"#"]]],["app",{sourceInterval:[6128,6131]},"any",[]]]]]}]),zi}var An={},na;function ia(){return na||(na=1,(function(r){var e=An&&An.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(r,"__esModule",{value:!0}),r.RequirementsSyntaxError=r.semantics=void 0;const t=e(ho());r.semantics=t.default.createSemantics();function n(a){return{startIdx:a.source.startIdx,endIdx:a.source.endIdx}}function i(a,c){return{data:c,location:n(a)}}r.semantics.addOperation("extract",{File:a=>a.asIteration().children.map(c=>c.extract()).filter(Boolean),Line:(a,c)=>{var f;return((f=a.child(0))===null||f===void 0?void 0:f.extract())||null},NameReq:(a,c,f,y)=>{var R,b;return{type:"ProjectName",name:a.sourceString,versionSpec:f.extract(),extras:(R=c.child(0))===null||R===void 0?void 0:R.extract(),environmentMarkerTree:(b=y.child(0))===null||b===void 0?void 0:b.extract()}},UrlReq:(a,c,f,y,R)=>{var b,x;return{type:"ProjectURL",name:a.sourceString,url:f.extract(),extras:(b=c.child(0))===null||b===void 0?void 0:b.extract(),environmentMarkerTree:(x=R.child(0))===null||x===void 0?void 0:x.extract()}},Extras:(a,c,f)=>c.asIteration().children.map(y=>y.sourceString),RequirementsReq:(a,c)=>({type:"RequirementsFile",path:c.sourceString}),ConstraintsReq:(a,c)=>({type:"ConstraintsFile",path:c.sourceString}),UrlSpec:(a,c)=>c.sourceString,QuotedMarker:(a,c)=>c.extract(),MarkerOr_node:(a,c,f)=>({operator:"or",left:a.extract(),right:f.extract()}),MarkerAnd_node:(a,c,f)=>({operator:"and",left:a.extract(),right:f.extract()}),MarkerExpr_leaf:(a,c,f)=>({left:a.sourceString,operator:c.sourceString,right:f.sourceString}),MarkerExpr_node:(a,c,f)=>c.extract(),VersionSpec_parenthesized:(a,c,f)=>c.extract()||[],VersionMany:a=>{const c=a.asIteration().children;if(c.length!==0)return c.map(f=>f.extract())},VersionOne:(a,c)=>({operator:a.sourceString,version:c.sourceString})}),r.semantics.addOperation("extractLoosely",{LooseFile:a=>a.asIteration().children.map(c=>c.extractLoosely()).filter(Boolean),LooseLine:(a,c)=>{var f;return((f=a.child(0))===null||f===void 0?void 0:f.extractLoosely())||null},LooseNameReq:(a,c,f,y)=>{var R;return{type:"ProjectName",name:a.sourceString,extras:(R=c.child(0))===null||R===void 0?void 0:R.extractLoosely(),versionSpec:f.extractLoosely()}},LooseNonNameReq:a=>null,LooseExtras:(a,c,f,y)=>c.asIteration().children.map(R=>R.sourceString),LooseVersionSpec_parenthesized:(a,c,f)=>c.extractLoosely()||[],LooseVersionMany:(a,c)=>{const f=a.asIteration().children;if(f.length!==0)return f.map(y=>y.extractLoosely())},LooseVersionOne:(a,c)=>{const f={operator:a.sourceString};return c.sourceString&&(f.version=c.sourceString),f}}),r.semantics.addOperation("extractWithLocation",{File:a=>a.asIteration().children.map(c=>c.extractWithLocation()).filter(Boolean),Line:(a,c)=>{var f;return((f=a.child(0))===null||f===void 0?void 0:f.extractWithLocation())||null},NameReq:function(a,c,f,y){var R,b;return i(this,{type:"ProjectName",name:i(a,a.sourceString),versionSpec:f.extractWithLocation(),extras:(R=c.child(0))===null||R===void 0?void 0:R.extractWithLocation(),environmentMarkerTree:(b=y.child(0))===null||b===void 0?void 0:b.extractWithLocation()})},UrlReq:function(a,c,f,y,R){var b,x;return i(this,{type:"ProjectURL",name:i(a,a.sourceString),url:f.extractWithLocation(),extras:(b=c.child(0))===null||b===void 0?void 0:b.extractWithLocation(),environmentMarkerTree:(x=R.child(0))===null||x===void 0?void 0:x.extractWithLocation()})},Extras:function(a,c,f){return c.asIteration().children.map(y=>i(y,y.sourceString))},RequirementsReq:function(a,c){return i(this,{type:"RequirementsFile",path:c.sourceString})},ConstraintsReq:function(a,c){return i(this,{type:"ConstraintsFile",path:c.sourceString})},UrlSpec:function(a,c){return i(c,c.sourceString)},QuotedMarker:(a,c)=>i(c,c.extract()),VersionSpec_parenthesized:(a,c,f)=>c.extractWithLocation()||[],VersionMany:a=>{const c=a.asIteration().children;if(c.length!==0)return c.map(f=>f.extractWithLocation())},VersionOne:function(a,c){return i(this,{operator:i(a,a.sourceString),version:i(c,c.sourceString)})}}),r.semantics.addOperation("extractLooselyWithLocation",{LooseFile:a=>a.asIteration().children.map(c=>c.extractLooselyWithLocation()).filter(Boolean),LooseLine:(a,c)=>{var f;return((f=a.child(0))===null||f===void 0?void 0:f.extractLooselyWithLocation())||null},LooseNameReq:function(a,c,f,y){var R;return i(this,{type:"ProjectName",name:i(a,a.sourceString),extras:(R=c.child(0))===null||R===void 0?void 0:R.extractLooselyWithLocation(),versionSpec:f.extractLooselyWithLocation()})},LooseNonNameReq:a=>null,LooseExtras:function(a,c,f,y){return c.asIteration().children.map(R=>i(R,R.sourceString))},LooseVersionSpec_parenthesized:(a,c,f)=>c.extractLooselyWithLocation()||[],LooseVersionMany:(a,c)=>{const f=a.asIteration().children;if(f.length!==0)return f.map(y=>y.extractLooselyWithLocation())},LooseVersionOne:function(a,c){return i(this,{operator:i(a,a.sourceString),...c.sourceString?{version:i(c,c.sourceString)}:{}})}});class o extends Error{}r.RequirementsSyntaxError=o})(An)),An}var jr={},sa;function Yu(){if(sa)return jr;sa=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.VersionOperator=jr.EnvironmentMarkerVariable=void 0;var r;(function(t){t.PythonVersion="python_version",t.PythonFullVersion="python_full_version",t.OsName="os_name",t.SysPlatform="sys_platform",t.PlatformRelease="platform_release",t.PlatformSystem="platform_system",t.PlatformVersion="platform_version",t.PlatformMachine="platform_machine",t.PlatformPythonImplementation="platform_python_implementation",t.ImplementationName="implementation_name",t.ImplementationVersion="implementation_version",t.Extra="extra"})(r||(jr.EnvironmentMarkerVariable=r={}));var e;return(function(t){t.CompatibleRelease="~=",t.VersionMatching="==",t.VersionExclusion="!=",t.LessThanOrMatching="<=",t.GreaterThanOrMatching=">=",t.LessThan="<",t.GreaterThan=">",t.ArbitrarilyEqual="==="})(e||(jr.VersionOperator=e={})),jr}var aa;function Ju(){return aa||(aa=1,(function(r){var e=_r&&_r.__createBinding||(Object.create?(function(b,x,_,D){D===void 0&&(D=_);var Y=Object.getOwnPropertyDescriptor(x,_);(!Y||("get"in Y?!x.__esModule:Y.writable||Y.configurable))&&(Y={enumerable:!0,get:function(){return x[_]}}),Object.defineProperty(b,D,Y)}):(function(b,x,_,D){D===void 0&&(D=_),b[D]=x[_]})),t=_r&&_r.__exportStar||function(b,x){for(var _ in b)_!=="default"&&!Object.prototype.hasOwnProperty.call(x,_)&&e(x,b,_)},n=_r&&_r.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(r,"__esModule",{value:!0}),r.parsePipRequirementsLineLoosely=r.parsePipRequirementsFileLoosely=r.parsePipRequirementsLine=r.parsePipRequirementsFile=r.RequirementsSyntaxError=void 0;const i=n(ho()),o=ia();var a=ia();Object.defineProperty(r,"RequirementsSyntaxError",{enumerable:!0,get:function(){return a.RequirementsSyntaxError}}),t(Yu(),r);function c(b,x){const _=i.default.match(b,"File");if(_.failed())throw new o.RequirementsSyntaxError(`Failed to parse requirements file. ${_.shortMessage}`);return x?.includeLocations?(0,o.semantics)(_).extractWithLocation():(0,o.semantics)(_).extract()}r.parsePipRequirementsFile=c;function f(b,x){const _=i.default.match(b,"Line");if(_.failed())throw new o.RequirementsSyntaxError(`Failed to parse requirements line. ${_.shortMessage}`);return x?.includeLocations?(0,o.semantics)(_).extractWithLocation():(0,o.semantics)(_).extract()}r.parsePipRequirementsLine=f;function y(b,x){const _=i.default.match(b,"LooseFile");if(_.failed())throw new o.RequirementsSyntaxError(`Failed to loosely parse requirements file. ${_.shortMessage}`);return x?.includeLocations?(0,o.semantics)(_).extractLooselyWithLocation():(0,o.semantics)(_).extractLoosely()}r.parsePipRequirementsFileLoosely=y;function R(b,x){const _=i.default.match(b,"LooseLine");if(_.failed())throw new o.RequirementsSyntaxError(`Failed to loosely parse requirements line. ${_.shortMessage}`);return x?.includeLocations?(0,o.semantics)(_).extractLooselyWithLocation():(0,o.semantics)(_).extractLoosely()}r.parsePipRequirementsLineLoosely=R})(_r)),_r}var fo=Ju();const Zu=xi(fo),Xu=ga({__proto__:null,default:Zu},[fo]);function Qu(r){return new Worker("/assets/pyworker-Drd8fvVW.js",{type:"module",name:r?.name})}const{parsePipRequirementsFile:ep}=Xu;let tp=0;class rp{constructor(){this.pendingMessages=new Map}async init(e,t){this.workspace=e,this.vars=t??{},this.worker=new Qu,this.worker.onmessage=n=>{this.handleWorkerMessage(n.data)},this.worker.onerror=n=>{console.error("Python Worker error:",n)},await this.sendMessage("init",{vars:this.vars}),await this.mountWorkspace(),await this.installDependencies()}handleWorkerMessage(e){if(e.id==="interrupt-buffer"){e.type==="success"?this.interruptBuffer=new Uint8Array(e.payload):this.interruptBuffer=void 0;return}if(e.type==="inputRequest"){const n=e.payload.prompt||"Input:",i=window.prompt(n);this.worker.postMessage({id:e.id,type:"inputResponse",payload:{value:i,cancelled:i===null}});return}if(e.type==="stdout"){this.stdoutCallback?this.stdoutCallback(e.payload):console.info(e.payload);return}if(e.type==="stderr"){this.stderrCallback?this.stderrCallback(e.payload):console.error(e.payload);return}if(e.type==="console"){const{level:n,message:i}=e.payload;typeof window<"u"&&window.logToTerminal&&window.logToTerminal("Python Worker",i,n);return}const t=this.pendingMessages.get(e.id);t&&(this.pendingMessages.delete(e.id),e.type==="success"?t.resolve(e.payload):e.type==="error"&&t.reject(new Error(e.payload.message)))}async sendMessage(e,t){if(!this.worker)throw new Error("PyEnv not initialized yet: see init()");const n=`msg-${tp++}`,i={id:n,type:e,payload:t};return new Promise((o,a)=>{this.pendingMessages.set(n,{resolve:o,reject:a}),this.worker.postMessage(i)})}setStdoutCallback(e){this.stdoutCallback=e}setStderrCallback(e){this.stderrCallback=e}async runFunction(e,t){const n=await this.sendMessage("runFunction",{name:e,args:t});return Xe(vr,this.workspace),n}async setGlobal(e,t){await this.sendMessage("setGlobal",{key:e,value:t})}async mountWorkspace(e="/workspace"){const t=await Dt.getWorkspace();await this.sendMessage("mountWorkspace",{handle:t.getHandle(),mountPoint:e})}async installDependencies(){const e=await this.workspace?.getResource("requirements.txt");if(e){const t=(await e.getContents()).replaceAll("\r",""),n=ep(t).filter(i=>"name"in i).map(i=>i.name);await this.loadPackages(n)}}async loadPackages(e){e.length>0&&await this.sendMessage("loadPackages",{packages:e})}async syncWorkspace(){await this.sendMessage("syncWorkspace"),Xe(vr,this.workspace)}async execCode(e){const t=await this.sendMessage("execCode",{code:e});return Xe(vr,this.workspace),t}async execScript(e){const t=e.split(".")[0],n=e.includes(":")?e.split(":").reverse()[0]:void 0;return await this.execModule(t,n)}async execModule(e,t){const n=await this.sendMessage("execModule",{moduleName:e,entryName:t,vars:this.vars});return Xe(vr,this.workspace),n}async getVersion(){return await this.sendMessage("getVersion")}canInterrupt(){return this.interruptBuffer!==void 0}interrupt(){this.interruptBuffer&&(this.interruptBuffer[0]=2)}close(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.pendingMessages.clear()}}class np{constructor(){this.packages=[]}addPackage(e){this.packages.push(e)}hasPackages(){return this.packages.length>0&&this.packages.some(e=>e.dependencies&&Object.keys(e.dependencies).length>0)}renderTree(){return this.packages.length===0?G``:G`
            <wa-tree style="--indent-guide-width: 1px;">
                ${this.packages.map(e=>{const t=e.dependencies||{},n=Object.entries(t);return n.length===0?G``:G`
                        <wa-tree-item expanded>
                            <span>${e.name}</span>
                            ${n.map(([i,o])=>G`
                                <wa-tree-item>
                                    <span>${i} <small>${o}</small></span>
                                </wa-tree-item>
                            `)}
                        </wa-tree-item>
                    `})}
            </wa-tree>
        `}}const vi=new np,ip="https://api.github.com";function sp(){const r=Zr.getCurrentApp();if(r?.metadata?.github){const e=r.metadata.github;if(e.owner&&e.repo)return{owner:e.owner,repo:e.repo}}throw new Error("GitHub repository not configured. Specify metadata.github in AppDefinition.")}async function ap(r=100){try{const e=sp(),t=await fetch(`${ip}/repos/${e.owner}/${e.repo}/releases?per_page=${r}`);return t.ok?await t.json():[]}catch(e){return console.error("Failed to fetch releases:",e),[]}}function op(r,e){const t=r.replace(/^v/,""),n=e.replace(/^v/,""),i=t.split(".").map(Number),o=n.split(".").map(Number);for(let a=0;a<Math.max(i.length,o.length);a++){const c=i[a]||0,f=o[a]||0;if(f>c)return!0;if(f<c)return!1}return!1}lt({command:{id:"show_version_info",name:"Show Version Info",description:"Shows application version information",parameters:[]},handler:{execute:async r=>{const e=Zr.getCurrentApp();if(!e){Ze("No app loaded");return}const t=vi.hasPackages(),n=vi.renderTree();let i=null;const o=()=>(i||(i=document.getElementById("global-dialog-container")||document.createElement("div"),i.id||(i.id="global-dialog-container",document.body.appendChild(i))),i),a=()=>{i&&Tr(G``,i)},c=Y=>{const ve=at.parse(Y,{async:!1});return G`${Un(ve)}`};let f=[];try{f=await ap()}catch{f=[]}const y=e.version==="0.0.0",R=f.length>0?f.findIndex(Y=>Y.tag_name===e.version):-1,b=R>=0?R:0;let x=b;const _=Y=>{if(y)return`**Development Build**

${e.description||""}`;if(f.length===0)return`**Version:** ${e.version}

${e.description||""}`;const ve=f[Y],xe=ve.tag_name===e.version;let W=`**Version:** ${ve.tag_name}`;xe&&(W+=" (Current)"),W+=`

`;const N=new Date(ve.published_at).toLocaleDateString();return W+=`**Released:** ${N}

`,!xe&&op(e.version,ve.tag_name)&&(W+=`⚠️ **Update available**

`),ve.body&&(W+=`---

${ve.body}`),W},D=Y=>{const ve=_(Y),xe=f.length>0,W=G`
                    <wa-dialog label="${e.name}" open @wa-request-close=${a}>
                        <style>
                            .dialog-content {
                                width: 600px;
                                height: 600px;
                            }
                            
                            wa-tree-item > span small {
                                color: var(--wa-color-neutral-60);
                                font-size: 0.875em;
                                margin-left: 0.5rem;
                            }
                        </style>
                        <div class="dialog-content">
                            <wa-tab-group>
                                <wa-tab slot="nav" panel="release">Release Info</wa-tab>
                                ${t?G`<wa-tab slot="nav" panel="packages">NPM Packages</wa-tab>`:""}
                                
                                <wa-tab-panel name="release">
                                    ${c(ve)}
                                </wa-tab-panel>
                                
                                ${t?G`
                                    <wa-tab-panel name="packages">
                                        ${n}
                                    </wa-tab-panel>
                                `:""}
                            </wa-tab-group>
                        </div>
                        <div slot="footer">
                            ${xe?G`
                                <wa-button 
                                    variant="default"
                                    ?disabled=${Y===f.length-1}
                                    @click=${()=>{Y<f.length-1&&(x=Y+1,D(x))}}
                                >
                                    ← Previous
                                </wa-button>
                                <wa-button 
                                    variant="default"
                                    ?disabled=${Y===0}
                                    @click=${()=>{Y>0&&(x=Y-1,D(x))}}
                                >
                                    Next →
                                </wa-button>
                            `:""}
                            <wa-button variant="primary" @click=${a}>Close</wa-button>
                        </div>
                    </wa-dialog>
                `;Tr(W,o())};return D(b),new Promise(Y=>{const ve=()=>{i?.querySelector("wa-dialog[open]")?setTimeout(ve,100):Y()};ve()})}}});lt({command:{id:"python",name:"Run Python Script",description:"Executes a Python script given its file path",parameters:[{name:"script",description:"the path to a Python script to run",required:!1}]},handler:{execute:async r=>{const e=r.params.script;if(!e)return;const t=new rp,n=await Dt.getWorkspace();await t.init(n,r),await t.installDependencies(),await t.execScript(e)}}});lt({command:{id:"js",name:"Run JavaScript file",description:"Executes a JavaScript file given its path",parameters:[{name:"script",description:"the path to a JavaScript file to run",required:!1}]}});lt({command:{id:"save",name:"Save editor",description:"Saves the active/focused editor",keyBinding:"CTRL+S",parameters:[]},handler:{execute:async r=>{const e=an.get()||it.get();e&&e.isDirty()&&e.save()}},contribution:{target:"toolbar:.system.editors",icon:"floppy-disk",label:"Save active editor",slot:"start",disabled:()=>{const r=it.get();return!r||!r.isDirty()}}});lt({command:{id:"run_python",name:"Run Python Cell",description:"Runs active Python code in a supporting context (e.g. notebook, terminal, etc.)",keyBinding:"CTRL+R",parameters:[]}});const mo="theme";async function go(r){const e=document.documentElement;e.classList.remove("wa-dark","wa-light"),e.classList.add(r)}async function lp(){const r=await xt.get(mo);await go(r||"wa-dark")}async function cp(r){await xt.set(mo,r)}lt({command:{id:"switch_theme",name:"Switch theme",description:"Switches between dark and light theme",parameters:[]},handler:{execute:async r=>{const t=document.documentElement.classList.contains("wa-dark")?"wa-light":"wa-dark";await go(t),await cp(t)}},contribution:{target:vn,icon:"circle-half-stroke",label:"Theme Switcher"}});lp().catch(r=>{console.error("Failed to load theme preference:",r)});lt({command:{id:"fullscreen",name:"Toggle fullscreen",description:"Toggles fullscreen mode",parameters:[]},handler:{execute:async r=>{document.fullscreenElement===document.body?await document.exitFullscreen():await document.body.requestFullscreen()}},contribution:{target:vn,icon:"expand",label:"Fullscreen"}});lt({command:{id:"open_settings",name:"Open Settings",description:"Opens the settings file in an editor",parameters:[]},handler:{execute:r=>{const e={title:"settings.json",data:{async getContents(){const t=await xt.getAll();return JSON.stringify(t,void 0,2)},getName(){return e.key},saveContents(t){const n=JSON.parse(t);return xt.setAll(n)}},key:"setting.json",editorId:"monaco-editor",icon:"gear",state:{}};e.widgetFactory=()=>G`
                <k-monaco-editor .input=${e}></k-monaco-editor>`,$r.loadEditor(e).then()}},contribution:{target:vn,icon:"gear",label:"Open Settings"}});lt({command:{id:"open_extensions",name:"Open Extensions",description:"Opens the extensions registry",parameters:[]},handler:{execute:r=>{const e={title:"Extensions",data:{},key:"system.extensions",editorId:"extensions-editor",icon:"puzzle-piece",state:{},noOverflow:!0};e.widgetFactory=()=>G`
                <k-extensions></k-extensions>`,$r.loadEditor(e).then()}},contribution:{target:vn,icon:"puzzle-piece",label:"Open Extensions"}});je.registerAll({command:{id:"toast_message",name:"Toast message to user",description:"Shows a toast message",parameters:[{name:"message",description:"the message to toast",required:!0},{name:"type",description:"the toast type: info (default), or error",required:!1}]},handler:{execute:({params:{message:r,type:e}})=>{r&&(e==="error"?Ze(r):tr(r))}}});const up="@kispace-io/appspace",pp="1.0.19",dp={lit:"^3.2.1",marked:"^12.0.0 || ^16.4.1","@lit-labs/signals":"^0.1.3","@awesome.me/webawesome":"^3.0.0","@fortawesome/fontawesome-free":"^7.1.0","@fortawesome/fontawesome-svg-core":"^7.1.0","@fortawesome/free-solid-svg-icons":"^7.1.0","@langchain/textsplitters":"^1.0.0","@mlc-ai/web-llm":"^0.2.79","@xenova/transformers":"^2.17.2","@xterm/xterm":"^5.5.0",axios:"^1.13.1",dotenv:"^17.2.3","idb-keyval":"^6.2.2",jsonata:"^2.1.0",jszip:"^3.10.1","monaco-editor":"^0.54.0","pace-js":"^1.2.4","pdfjs-dist":"^4.0.0","pip-requirements-js":"^1.0.2","pubsub-js":"^1.9.5",pyodide:"^0.27.7",rxdb:"^15.0.0","toastify-js":"^1.12.0",uuid:"^13.0.0","wasm-git":"^0.0.13"},hp={typescript:"^5.9.3",vite:"^7.1.12","vite-plugin-dts":"^4.5.4"},ei={name:up,version:pp,dependencies:dp,devDependencies:hp};vi.addPackage({name:ei.name,version:ei.version,dependencies:ei.dependencies,devDependencies:ei.devDependencies});var fp=Object.defineProperty,mp=Object.getOwnPropertyDescriptor,ks=(r,e,t,n)=>{for(var i=n>1?void 0:n?mp(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&fp(e,t,i),i};let yi=class extends vs{constructor(){super(...arguments),this.showBottomSidebar=!0,this.showBottomPanel=!1}createRenderRoot(){return this}render(){return G`
            <style>
                *, *::before, *::after {
                    box-sizing: border-box;
                }
                
                html {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                }
                
                body {
                    height: 100%;
                    width: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                }
                
                k-standard-app {
                    display: flex;
                    flex-direction: column;
                    height: 100vh;
                    width: 100%;
                }
                
                k-standard-app .toolbar-top {
                    width: 100%;
                    display: grid;
                    grid-template-columns: 1fr 2fr 1fr;
                    align-items: center;
                    border-bottom: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    flex-shrink: 0;
                }
                
                k-standard-app .toolbar-bottom {
                    width: 100%;
                    border-top: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    display: grid;
                    grid-template-columns: 1fr 2fr auto;
                    align-items: center;
                    flex-shrink: 0;
                    min-height: 32px;
                    padding: 0 var(--wa-space-s);
                    box-sizing: border-box;
                }
                
                k-standard-app .main-layout {
                    flex: 1;
                    min-height: 0;
                }
                
                k-standard-app .toolbar-end {
                    justify-self: end;
                }
            </style>
            
            <div class="toolbar-top">
                <k-toolbar id=${Wa}></k-toolbar>
                <k-toolbar id=${Vc}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${vn}></k-toolbar>
            </div>
            
            <k-resizable-grid 
                class="main-layout"
                id="main-layout" 
                orientation="horizontal" 
                sizes="15%, 65%, 20%">
                
                ${this.showBottomSidebar?G`
                        <k-resizable-grid 
                            id="left-sidebar-split" 
                            orientation="vertical" 
                            sizes="50%, 50%">
                            <k-tabs id="${Zi}"></k-tabs>
                            <k-tabs id="${Ga}"></k-tabs>
                        </k-resizable-grid>
                    `:G`<k-tabs id="${Zi}"></k-tabs>`}
                
                ${this.showBottomPanel?G`
                        <k-resizable-grid 
                            id="editor-area-split" 
                            orientation="vertical" 
                            sizes="70%, 30%">
                            <k-tabs id="${Br}"></k-tabs>
                            <k-tabs id="${Hc}"></k-tabs>
                        </k-resizable-grid>
                    `:G`<k-tabs id="${Br}"></k-tabs>`}
                
                <k-tabs id="${Va}"></k-tabs>
            </k-resizable-grid>
            
            <div class="toolbar-bottom">
                <k-toolbar id=${Ba}></k-toolbar>
                <k-toolbar id=${ys}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${bs}></k-toolbar>
            </div>
        `}};ks([Be({type:Boolean,attribute:"show-bottom-sidebar"})],yi.prototype,"showBottomSidebar",2);ks([Be({type:Boolean,attribute:"show-bottom-panel"})],yi.prototype,"showBottomPanel",2);yi=ks([Et("k-standard-app")],yi);function ti(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ui={exports:{}},oa;function gp(){return oa||(oa=1,(function(r,e){(function(t){r.exports=t()})(function(){return(function(){function t(n,i,o){function a(y,R){if(!i[y]){if(!n[y]){var b=typeof ti=="function"&&ti;if(!R&&b)return b(y,!0);if(c)return c(y,!0);var x=new Error("Cannot find module '"+y+"'");throw x.code="MODULE_NOT_FOUND",x}var _=i[y]={exports:{}};n[y][0].call(_.exports,function(D){var Y=n[y][1][D];return a(Y||D)},_,_.exports,t,n,i,o)}return i[y].exports}for(var c=typeof ti=="function"&&ti,f=0;f<o.length;f++)a(o[f]);return a}return t})()({1:[function(t,n,i){const o=t("./utils"),a=(function(){const c=o.stringToArray,f=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],y=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],R=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],b=["Thousand","Million","Billion","Trillion"];function x(P,q){var $=function(ue,ae,V){var ce="";if(ue<=19)ce=(ae?" and ":"")+(V?y[ue]:f[ue]);else if(ue<100){const qe=Math.floor(ue/10),Ge=ue%10;ce=(ae?" and ":"")+R[qe-2],Ge>0?ce+="-"+$(Ge,!1,V):V&&(ce=ce.substring(0,ce.length-1)+"ieth")}else if(ue<1e3){const qe=Math.floor(ue/100),Ge=ue%100;ce=(ae?", ":"")+f[qe]+" Hundred",Ge>0?ce+=$(Ge,!0,V):V&&(ce+="th")}else{var we=Math.floor(Math.log10(ue)/3);we>b.length&&(we=b.length);const qe=Math.pow(10,we*3),Ge=Math.floor(ue/qe),Ie=ue-Ge*qe;ce=(ae?", ":"")+$(Ge,!1,!1)+" "+b[we-1],Ie>0?ce+=$(Ie,!0,V):V&&(ce+="th")}return ce},Q=$(P,!1,q);return Q}const _={};f.forEach(function(P,q){_[P.toLowerCase()]=q}),y.forEach(function(P,q){_[P.toLowerCase()]=q}),R.forEach(function(P,q){const $=P.toLowerCase();_[$]=(q+2)*10,_[$.substring(0,P.length-1)+"ieth"]=_[$]}),_.hundredth=100,b.forEach(function(P,q){const $=P.toLowerCase(),Q=Math.pow(10,(q+1)*3);_[$]=Q,_[$+"th"]=Q});function D(P){const $=P.split(/,\s|\sand\s|[\s\\-]/).map(ae=>_[ae]);let Q=[0];return $.forEach(ae=>{if(ae<100){let V=Q.pop();V>=1e3&&(Q.push(V),V=0),Q.push(V+ae)}else Q.push(Q.pop()*ae)}),Q.reduce((ae,V)=>ae+V,0)}const Y=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],ve={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function xe(P){for(var q=0;q<Y.length;q++){const $=Y[q];if(P>=$[0])return $[1]+xe(P-$[0])}return""}function W(P){for(var q=0,$=1,Q=P.length-1;Q>=0;Q--){const ue=P[Q],ae=ve[ue];ae<$?q-=ae:($=ae,q+=ae)}return q}function N(P,q){for(var $=[],Q=q.charCodeAt(0);P>0;)$.unshift(String.fromCharCode((P-1)%26+Q)),P=Math.floor((P-1)/26);return $.join("")}function K(P,q){for(var $=q.charCodeAt(0),Q=0,ue=0;ue<P.length;ue++)Q+=(P.charCodeAt(P.length-ue-1)-$+1)*Math.pow(26,ue);return Q}function U(P,q){if(typeof P>"u")return;P=Math.floor(P);const $=Pe(q);return ee(P,$)}const O={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},B={UPPER:"upper",LOWER:"lower",TITLE:"title"};function ee(P,q){let $;const Q=P<0;switch(P=Math.abs(P),q.primary){case O.LETTERS:$=N(P,q.case===B.UPPER?"A":"a");break;case O.ROMAN:$=xe(P),q.case===B.UPPER&&($=$.toUpperCase());break;case O.WORDS:$=x(P,q.ordinal),q.case===B.UPPER?$=$.toUpperCase():q.case===B.LOWER&&($=$.toLowerCase());break;case O.DECIMAL:$=""+P;var ue=q.mandatoryDigits-$.length;if(ue>0){var ae=new Array(ue+1).join("0");$=ae+$}if(q.zeroCode!==48&&($=c($).map(qe=>String.fromCodePoint(qe.codePointAt(0)+q.zeroCode-48)).join("")),q.regular){const qe=Math.floor(($.length-1)/q.groupingSeparators.position);for(let Ge=qe;Ge>0;Ge--){const Ie=$.length-Ge*q.groupingSeparators.position;$=$.substr(0,Ie)+q.groupingSeparators.character+$.substr(Ie)}}else q.groupingSeparators.reverse().forEach(qe=>{const Ge=$.length-qe.position;$=$.substr(0,Ge)+qe.character+$.substr(Ge)});if(q.ordinal){var V={1:"st",2:"nd",3:"rd"},ce=$[$.length-1],we=V[ce];(!we||$.length>1&&$[$.length-2]==="1")&&(we="th"),$=$+we}break;case O.SEQUENCE:throw{code:"D3130",value:q.token}}return Q&&($="-"+$),$}const Te=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function Pe(P){const q={type:"integer",primary:O.DECIMAL,case:B.LOWER,ordinal:!1};let $,Q;const ue=P.lastIndexOf(";");switch(ue===-1?$=P:($=P.substring(0,ue),Q=P.substring(ue+1),Q[0]==="o"&&(q.ordinal=!0)),$){case"A":q.case=B.UPPER;case"a":q.primary=O.LETTERS;break;case"I":q.case=B.UPPER;case"i":q.primary=O.ROMAN;break;case"W":q.case=B.UPPER,q.primary=O.WORDS;break;case"Ww":q.case=B.TITLE,q.primary=O.WORDS;break;case"w":q.primary=O.WORDS;break;default:{let ae=null,V=0,ce=0,we=[],qe=0;if(c($).map(Ie=>Ie.codePointAt(0)).reverse().forEach(Ie=>{let Ae=!1;for(let L=0;L<Te.length;L++){const k=Te[L];if(Ie>=k&&Ie<=k+9){if(Ae=!0,V++,qe++,ae===null)ae=k;else if(k!==ae)throw{code:"D3131"};break}}Ae||(Ie===35?(qe++,ce++):we.push({position:qe,character:String.fromCodePoint(Ie)}))}),V>0){q.primary=O.DECIMAL,q.zeroCode=ae,q.mandatoryDigits=V,q.optionalDigits=ce;const Ae=function(L){if(L.length===0)return 0;const k=L[0].character;for(let te=1;te<L.length;te++)if(L[te].character!==k)return 0;const M=L.map(te=>te.position),H=function(te,_e){return _e===0?te:H(_e,te%_e)},J=M.reduce(H);for(let te=1;te<=M.length;te++)if(M.indexOf(te*J)===-1)return 0;return J}(we);Ae>0?(q.regular=!0,q.groupingSeparators={position:Ae,character:we[0].character}):(q.regular=!1,q.groupingSeparators=we)}else q.primary=O.SEQUENCE,q.token=$}}return q}const he={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function z(P){var q=[];const $={type:"datetime",parts:q},Q=function(Ae,L){if(L>Ae){let k=P.substring(Ae,L);k=k.split("]]").join("]"),q.push({type:"literal",value:k})}};for(var ue=0,ae=0;ae<P.length;){if(P.charAt(ae)==="["){if(P.charAt(ae+1)==="["){Q(ue,ae),q.push({type:"literal",value:"["}),ae+=2,ue=ae;continue}if(Q(ue,ae),ue=ae,ae=P.indexOf("]",ue),ae===-1)throw{code:"D3135"};let Ae=P.substring(ue+1,ae);Ae=Ae.split(/\s+/).join("");var V={type:"marker",component:Ae.charAt(0)},ce=Ae.lastIndexOf(","),we;if(ce!==-1){const L=Ae.substring(ce+1),k=L.indexOf("-");let M,H;const J=function(_e){if(!(typeof _e>"u"||_e==="*"))return parseInt(_e)};k===-1?M=L:(M=L.substring(0,k),H=L.substring(k+1));const te={min:J(M),max:J(H)};V.width=te,we=Ae.substring(1,ce)}else we=Ae.substring(1);if(we.length===1)V.presentation1=we;else if(we.length>1){var qe=we.charAt(we.length-1);"atco".indexOf(qe)!==-1?(V.presentation2=qe,qe==="o"&&(V.ordinal=!0),V.presentation1=we.substring(0,we.length-1)):V.presentation1=we}else V.presentation1=he[V.component];if(typeof V.presentation1>"u")throw{code:"D3132",value:V.component};if(V.presentation1[0]==="n")V.names=B.LOWER;else if(V.presentation1[0]==="N")V.presentation1[1]==="n"?V.names=B.TITLE:V.names=B.UPPER;else if("YMDdFWwXxHhmsf".indexOf(V.component)!==-1){var Ge=V.presentation1;if(V.presentation2&&(Ge+=";"+V.presentation2),V.integerFormat=Pe(Ge),V.width&&V.width.min!==void 0&&V.integerFormat.mandatoryDigits<V.width.min&&(V.integerFormat.mandatoryDigits=V.width.min),V.component==="Y")if(V.n=-1,V.width&&V.width.max!==void 0)V.n=V.width.max,V.integerFormat.mandatoryDigits=V.n;else{var Ie=V.integerFormat.mandatoryDigits+V.integerFormat.optionalDigits;Ie>=2&&(V.n=Ie)}const L=q[q.length-1];L&&L.integerFormat&&(L.integerFormat.parseWidth=L.integerFormat.mandatoryDigits)}(V.component==="Z"||V.component==="z")&&(V.integerFormat=Pe(V.presentation1)),q.push(V),ue=ae+1}ae++}return Q(ue,ae),$}const le=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ye=["January","February","March","April","May","June","July","August","September","October","November","December"],ke=1e3*60*60*24,X=function(P){const q=Date.UTC(P.year,P.month);var $=new Date(q).getUTCDay();return $===0&&($=7),$>4?q+(8-$)*ke:q-($-1)*ke},se=function(P,q){return{year:P,month:q,nextMonth:function(){return q===11?se(P+1,0):se(P,q+1)},previousMonth:function(){return q===0?se(P-1,11):se(P,q-1)},nextYear:function(){return se(P+1,q)},previousYear:function(){return se(P-1,q)}}},me=function(P,q){return(q-P)/(ke*7)+1},Z=(P,q)=>{let $;switch(q){case"Y":$=P.getUTCFullYear();break;case"M":$=P.getUTCMonth()+1;break;case"D":$=P.getUTCDate();break;case"d":{const Q=Date.UTC(P.getUTCFullYear(),P.getUTCMonth(),P.getUTCDate()),ue=Date.UTC(P.getUTCFullYear(),0);$=(Q-ue)/ke+1;break}case"F":$=P.getUTCDay(),$===0&&($=7);break;case"W":{const Q=se(P.getUTCFullYear(),0),ue=X(Q),ae=Date.UTC(Q.year,P.getUTCMonth(),P.getUTCDate());let V=me(ue,ae);if(V>52){const ce=X(Q.nextYear());ae>=ce&&(V=1)}else if(V<1){const ce=X(Q.previousYear());V=me(ce,ae)}$=Math.floor(V);break}case"w":{const Q=se(P.getUTCFullYear(),P.getUTCMonth()),ue=X(Q),ae=Date.UTC(Q.year,Q.month,P.getUTCDate());let V=me(ue,ae);if(V>4){const ce=X(Q.nextMonth());ae>=ce&&(V=1)}else if(V<1){const ce=X(Q.previousMonth());V=me(ce,ae)}$=Math.floor(V);break}case"X":{const Q=se(P.getUTCFullYear(),0),ue=X(Q),ae=X(Q.nextYear()),V=P.getTime();V<ue?$=Q.year-1:V>=ae?$=Q.year+1:$=Q.year;break}case"x":{const Q=se(P.getUTCFullYear(),P.getUTCMonth()),ue=X(Q),ae=Q.nextMonth(),V=X(ae),ce=P.getTime();ce<ue?$=Q.previousMonth().month+1:ce>=V?$=ae.month+1:$=Q.month+1;break}case"H":$=P.getUTCHours();break;case"h":$=P.getUTCHours(),$=$%12,$===0&&($=12);break;case"P":$=P.getUTCHours()>=12?"pm":"am";break;case"m":$=P.getUTCMinutes();break;case"s":$=P.getUTCSeconds();break;case"f":$=P.getUTCMilliseconds();break;case"Z":case"z":break;case"C":$="ISO";break;case"E":$="ISO";break}return $};let Ce=null;function Ne(P,q,$){var Q=0,ue=0;if(typeof $<"u"){const Ge=parseInt($);Q=Math.floor(Ge/100),ue=Ge%100}var ae=function(Ge,Ie){var Ae=Z(Ge,Ie.component);if("YMDdFWwXxHhms".indexOf(Ie.component)!==-1)if(Ie.component==="Y"&&Ie.n!==-1&&(Ae=Ae%Math.pow(10,Ie.n)),Ie.names){if(Ie.component==="M"||Ie.component==="x")Ae=ye[Ae-1];else if(Ie.component==="F")Ae=le[Ae];else throw{code:"D3133",value:Ie.component};Ie.names===B.UPPER?Ae=Ae.toUpperCase():Ie.names===B.LOWER&&(Ae=Ae.toLowerCase()),Ie.width&&Ae.length>Ie.width.max&&(Ae=Ae.substring(0,Ie.width.max))}else Ae=ee(Ae,Ie.integerFormat);else if(Ie.component==="f")Ae=ee(Ae,Ie.integerFormat);else if(Ie.component==="Z"||Ie.component==="z"){const L=Q*100+ue;if(Ie.integerFormat.regular)Ae=ee(L,Ie.integerFormat);else{const k=Ie.integerFormat.mandatoryDigits;if(k===1||k===2)Ae=ee(Q,Ie.integerFormat),ue!==0&&(Ae+=":"+U(ue,"00"));else if(k===3||k===4)Ae=ee(L,Ie.integerFormat);else throw{code:"D3134",value:k}}L>=0&&(Ae="+"+Ae),Ie.component==="z"&&(Ae="GMT"+Ae),L===0&&Ie.presentation2==="t"&&(Ae="Z")}else Ie.component==="P"&&Ie.names===B.UPPER&&(Ae=Ae.toUpperCase());return Ae};let V;typeof q>"u"?(Ce===null&&(Ce=z("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),V=Ce):V=z(q);const ce=(60*Q+ue)*60*1e3,we=new Date(P+ce);let qe="";return V.parts.forEach(function(Ge){Ge.type==="literal"?qe+=Ge.value:qe+=ae(we,Ge)}),qe}function w(P){var q={};if(P.type==="datetime")q.type="datetime",q.parts=P.parts.map(function($){var Q={};if($.type==="literal")Q.regex=$.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if($.component==="Z"||$.component==="z"){let ae;Array.isArray($.integerFormat.groupingSeparators)||(ae=$.integerFormat.groupingSeparators),Q.regex="",$.component==="z"&&(Q.regex="GMT"),Q.regex+="[-+][0-9]+",ae&&(Q.regex+=ae.character+"[0-9]+"),Q.parse=function(V){$.component==="z"&&(V=V.substring(3));let ce=0,we=0;return ae?(ce=Number.parseInt(V.substring(0,V.indexOf(ae.character))),we=Number.parseInt(V.substring(V.indexOf(ae.character)+1))):V.length-1<=2?ce=Number.parseInt(V):(ce=Number.parseInt(V.substring(0,3)),we=Number.parseInt(V.substring(3))),ce*60+we}}else if($.integerFormat)Q=w($.integerFormat);else{Q.regex="[a-zA-Z]+";var ue={};if($.component==="M"||$.component==="x")ye.forEach(function(ae,V){$.width&&$.width.max?ue[ae.substring(0,$.width.max)]=V+1:ue[ae]=V+1});else if($.component==="F")le.forEach(function(ae,V){V>0&&($.width&&$.width.max?ue[ae.substring(0,$.width.max)]=V:ue[ae]=V)});else if($.component==="P")ue={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:$.component};Q.parse=function(ae){return ue[ae]}}return Q.component=$.component,Q});else{q.type="integer";const $=P.case===B.UPPER;switch(P.primary){case O.LETTERS:q.regex=$?"[A-Z]+":"[a-z]+",q.parse=function(Q){return K(Q,$?"A":"a")};break;case O.ROMAN:q.regex=$?"[MDCLXVI]+":"[mdclxvi]+",q.parse=function(Q){return W($?Q:Q.toUpperCase())};break;case O.WORDS:q.regex="(?:"+Object.keys(_).concat("and","[\\-, ]").join("|")+")+",q.parse=function(Q){return D(Q.toLowerCase())};break;case O.DECIMAL:q.regex="[0-9]",P.parseWidth?q.regex+=`{${P.parseWidth}}`:q.regex+="+",P.ordinal&&(q.regex+="(?:th|st|nd|rd)"),q.parse=function(Q){let ue=Q;return P.ordinal&&(ue=Q.substring(0,Q.length-2)),P.regular?ue=ue.split(",").join(""):P.groupingSeparators.forEach(ae=>{ue=ue.split(ae.character).join("")}),P.zeroCode!==48&&(ue=ue.split("").map(ae=>String.fromCodePoint(ae.codePointAt(0)-P.zeroCode+48)).join("")),parseInt(ue)};break;case O.SEQUENCE:throw{code:"D3130",value:P.token}}}return q}function I(P,q){if(typeof P>"u")return;const $=Pe(q);return w($).parse(P)}function fe(P,q){const $=z(q),Q=w($),ue="^"+Q.parts.map(we=>"("+we.regex+")").join("")+"$";var V=new RegExp(ue,"i").exec(P);if(V!==null){const k={};for(let He=1;He<V.length;He++){const m=Q.parts[He-1];m.parse&&(k[m.component]=m.parse(V[He]))}if(Object.getOwnPropertyNames(k).length===0)return;let M=0;const H=He=>{M<<=1,M+=He?1:0},J=He=>!(~He&M)&&!!(He&M);"YXMxWwdD".split("").forEach(He=>H(k[He]));const _e=!J(161)&&J(130),Le=J(84),Ke=!Le&&J(72);M=0,"PHhmsf".split("").forEach(He=>H(k[He]));const It=!J(23)&&J(47),Qt=(_e?"YD":Le?"XxwF":Ke?"XWF":"YMD")+(It?"Phmsf":"Hmsf"),Tt=this.environment.timestamp;let pt=!1,Gt=!1;if(Qt.split("").forEach(He=>{if(typeof k[He]>"u")pt?(k[He]="MDd".indexOf(He)!==-1?1:0,Gt=!0):k[He]=Z(Tt,He);else if(pt=!0,Gt)throw{code:"D3136"}}),k.M>0?k.M-=1:k.M=0,_e){const He=Date.UTC(k.Y,0),m=(k.d-1)*1e3*60*60*24,S=new Date(He+m);k.M=S.getUTCMonth(),k.D=S.getUTCDate()}if(Le)throw{code:"D3136"};if(Ke)throw{code:"D3136"};It&&(k.H=k.h===12?0:k.h,k.P===1&&(k.H+=12));var ce=Date.UTC(k.Y,k.M,k.D,k.H,k.m,k.s,k.f);return(k.Z||k.z)&&(ce-=(k.Z||k.z)*60*1e3),ce}}var Re=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function Ye(P,q){if(!(typeof P>"u"))if(typeof q>"u"){if(!Re.test(P))throw{stack:new Error().stack,code:"D3110",value:P};return Date.parse(P)}else return fe.call(this,P,q)}function We(P,q,$){if(!(typeof P>"u"))return Ne.call(this,P,q,$)}return{formatInteger:U,parseInteger:I,fromMillis:We,toMillis:Ye}})();n.exports=a},{"./utils":6}],2:[function(t,n,i){(function(o){(function(){var a=t("./utils");const c=(()=>{var f=a.isNumeric,y=a.isArrayOfStrings,R=a.isArrayOfNumbers,b=a.createSequence,x=a.isSequence,_=a.isFunction,D=a.isLambda,Y=a.isPromise,ve=a.getFunctionArity,xe=a.isDeepEqual,W=a.stringToArray;function N(u){if(!(typeof u>"u")){var h=0;return u.forEach(function(g){h+=g}),h}}function K(u){return typeof u>"u"?0:u.length}function U(u){if(!(typeof u>"u"||u.length===0))return Math.max.apply(Math,u)}function O(u){if(!(typeof u>"u"||u.length===0))return Math.min.apply(Math,u)}function B(u){if(!(typeof u>"u"||u.length===0)){var h=0;return u.forEach(function(g){h+=g}),h/u.length}}function ee(u,h=!1){if(!(typeof u>"u")){var g;if(typeof u=="string")g=u;else if(_(u))g="";else{if(typeof u=="number"&&!isFinite(u))throw{code:"D3001",value:u,stack:new Error().stack};var A=h?2:0;Array.isArray(u)&&u.outerWrapper&&(u=u[0]),g=JSON.stringify(u,function(C,F){return typeof F<"u"&&F!==null&&F.toPrecision&&f(F)?Number(F.toPrecision(15)):F&&_(F)?"":F},A)}return g}}function Te(u,h,g){if(!(typeof u>"u")){var A=W(u),C=A.length;if(C+h<0&&(h=0),typeof g<"u"){if(g<=0)return"";var F=h>=0?h+g:C+h+g;return A.slice(h,F).join("")}return A.slice(h).join("")}}function Pe(u,h){if(!(typeof u>"u")){var g=u.indexOf(h);return g>-1?u.substr(0,g):u}}function he(u,h){if(!(typeof u>"u")){var g=u.indexOf(h);return g>-1?u.substr(g+h.length):u}}function z(u){if(!(typeof u>"u"))return u.toLowerCase()}function le(u){if(!(typeof u>"u"))return u.toUpperCase()}function ye(u){if(!(typeof u>"u"))return W(u).length}function ke(u){if(!(typeof u>"u")){var h=u.replace(/[ \t\n\r]+/gm," ");return h.charAt(0)===" "&&(h=h.substring(1)),h.charAt(h.length-1)===" "&&(h=h.substring(0,h.length-1)),h}}function X(u,h,g){if(!(typeof u>"u")){(typeof g>"u"||g.length===0)&&(g=" ");var A;h=Math.trunc(h);var C=Math.abs(h)-ye(u);if(C>0){var F=new Array(C+1).join(g);g.length>1&&(F=Te(F,0,C)),h>0?A=u+F:A=F+u}else A=u;return A}}async function se(u,h){var g=u.apply(this,[h]);if(Y(g)&&(g=await g),g&&!(typeof g.start=="number"||g.end==="number"||Array.isArray(g.groups)||_(g.next)))throw{code:"T1010",stack:new Error().stack};return g}async function me(u,h){if(!(typeof u>"u")){var g;if(typeof h=="string")g=u.indexOf(h)!==-1;else{var A=await se(h,u);g=typeof A<"u"}return g}}async function Z(u,h,g){if(!(typeof u>"u")){if(g<0)throw{stack:new Error().stack,value:g,code:"D3040",index:3};var A=b();if(typeof g>"u"||g>0){var C=0,F=await se(h,u);if(typeof F<"u")for(;typeof F<"u"&&(typeof g>"u"||C<g);)A.push({match:F.match,index:F.start,groups:F.groups}),F=await se(F.next),C++}return A}}async function Ce(u,h,g,A){if(!(typeof u>"u")){var C=this;if(h==="")throw{code:"D3010",stack:new Error().stack,value:h,index:2};if(A<0)throw{code:"D3011",stack:new Error().stack,value:A,index:4};var F;typeof g=="string"?F=function(Je){for(var vt="",ze=0,ht=g.indexOf("$",ze);ht!==-1&&ze<g.length;){vt+=g.substring(ze,ht),ze=ht+1;var Vt=g.charAt(ze);if(Vt==="$")vt+="$",ze++;else if(Vt==="0")vt+=Je.match,ze++;else{var ot;if(Je.groups.length===0?ot=1:ot=Math.floor(Math.log(Je.groups.length)*Math.LOG10E)+1,ht=parseInt(g.substring(ze,ze+ot),10),ot>1&&ht>Je.groups.length&&(ht=parseInt(g.substring(ze,ze+ot-1),10)),isNaN(ht))vt+="$";else{if(Je.groups.length>0){var kr=Je.groups[ht-1];typeof kr<"u"&&(vt+=kr)}ze+=ht.toString().length}}ht=g.indexOf("$",ze)}return vt+=g.substring(ze),vt}:F=g;var ie="",be=0;if(typeof A>"u"||A>0){var Ee=0;if(typeof h=="string"){for(var Qe=u.indexOf(h,be);Qe!==-1&&(typeof A>"u"||Ee<A);)ie+=u.substring(be,Qe),ie+=g,be=Qe+h.length,Ee++,Qe=u.indexOf(h,be);ie+=u.substring(be)}else{var De=await se(h,u);if(typeof De<"u"){for(;typeof De<"u"&&(typeof A>"u"||Ee<A);){ie+=u.substring(be,De.start);var et=F.apply(C,[De]);if(Y(et)&&(et=await et),typeof et=="string")ie+=et;else throw{code:"D3012",stack:new Error().stack,value:et};be=De.start+De.match.length,Ee++,De=await se(De.next)}ie+=u.substring(be)}else ie=u}}else ie=u;return ie}}function Ne(u){if(!(typeof u>"u")){var h=typeof window<"u"?window.btoa:function(g){return new o.Buffer.from(g,"binary").toString("base64")};return h(u)}}function w(u){if(!(typeof u>"u")){var h=typeof window<"u"?window.atob:function(g){return new o.Buffer.from(g,"base64").toString("binary")};return h(u)}}function I(u){if(!(typeof u>"u")){var h;try{h=encodeURIComponent(u)}catch{throw{code:"D3140",stack:new Error().stack,value:u,functionName:"encodeUrlComponent"}}return h}}function fe(u){if(!(typeof u>"u")){var h;try{h=encodeURI(u)}catch{throw{code:"D3140",stack:new Error().stack,value:u,functionName:"encodeUrl"}}return h}}function Re(u){if(!(typeof u>"u")){var h;try{h=decodeURIComponent(u)}catch{throw{code:"D3140",stack:new Error().stack,value:u,functionName:"decodeUrlComponent"}}return h}}function Ye(u){if(!(typeof u>"u")){var h;try{h=decodeURI(u)}catch{throw{code:"D3140",stack:new Error().stack,value:u,functionName:"decodeUrl"}}return h}}async function We(u,h,g){if(!(typeof u>"u")){if(g<0)throw{code:"D3020",stack:new Error().stack,value:g,index:3};var A=[];if(typeof g>"u"||g>0)if(typeof h=="string")A=u.split(h,g);else{var C=0,F=await se(h,u);if(typeof F<"u"){for(var ie=0;typeof F<"u"&&(typeof g>"u"||C<g);)A.push(u.substring(ie,F.start)),ie=F.end,F=await se(F.next),C++;(typeof g>"u"||C<g)&&A.push(u.substring(ie))}else A.push(u)}return A}}function P(u,h){if(!(typeof u>"u"))return typeof h>"u"&&(h=""),u.join(h)}function q(u,h,g){if(!(typeof u>"u")){var A={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"‰","zero-digit":"0",digit:"#","pattern-separator":";"},C=A;typeof g<"u"&&Object.keys(g).forEach(function(Oe){C[Oe]=g[Oe]});for(var F=[],ie=C["zero-digit"].charCodeAt(0),be=ie;be<ie+10;be++)F.push(String.fromCharCode(be));var Ee=F.concat([C["decimal-separator"],C["exponent-separator"],C["grouping-separator"],C.digit,C["pattern-separator"]]),Qe=h.split(C["pattern-separator"]);if(Qe.length>2)throw{code:"D3080",stack:new Error().stack};var De=function(Oe){var ct=(function(){for(var ft,Rt=0;Rt<Oe.length;Rt++)if(ft=Oe.charAt(Rt),Ee.indexOf(ft)!==-1&&ft!==C["exponent-separator"])return Oe.substring(0,Rt)})(),_t=(function(){for(var ft,Rt=Oe.length-1;Rt>=0;Rt--)if(ft=Oe.charAt(Rt),Ee.indexOf(ft)!==-1&&ft!==C["exponent-separator"])return Oe.substring(Rt+1)})(),ut=Oe.substring(ct.length,Oe.length-_t.length),Ft,lr,Ot,gt,qt=Oe.indexOf(C["exponent-separator"],ct.length);qt===-1||qt>Oe.length-_t.length?(Ft=ut,lr=void 0):(Ft=ut.substring(0,qt),lr=ut.substring(qt+1));var zt=Ft.indexOf(C["decimal-separator"]);return zt===-1?(Ot=Ft,gt=_t):(Ot=Ft.substring(0,zt),gt=Ft.substring(zt+1)),{prefix:ct,suffix:_t,activePart:ut,mantissaPart:Ft,exponentPart:lr,integerPart:Ot,fractionalPart:gt,subpicture:Oe}},et=function(Oe){var ct,_t,ut=Oe.subpicture,Ft=ut.indexOf(C["decimal-separator"]);Ft!==ut.lastIndexOf(C["decimal-separator"])&&(ct="D3081"),ut.indexOf(C.percent)!==ut.lastIndexOf(C.percent)&&(ct="D3082"),ut.indexOf(C["per-mille"])!==ut.lastIndexOf(C["per-mille"])&&(ct="D3083"),ut.indexOf(C.percent)!==-1&&ut.indexOf(C["per-mille"])!==-1&&(ct="D3084");var lr=!1;for(_t=0;_t<Oe.mantissaPart.length;_t++){var Ot=Oe.mantissaPart.charAt(_t);if(F.indexOf(Ot)!==-1||Ot===C.digit){lr=!0;break}}lr||(ct="D3085");var gt=Oe.activePart.split("").map(function(ft){return Ee.indexOf(ft)===-1?"p":"a"}).join("");gt.indexOf("p")!==-1&&(ct="D3086"),Ft!==-1?(ut.charAt(Ft-1)===C["grouping-separator"]||ut.charAt(Ft+1)===C["grouping-separator"])&&(ct="D3087"):Oe.integerPart.charAt(Oe.integerPart.length-1)===C["grouping-separator"]&&(ct="D3088"),ut.indexOf(C["grouping-separator"]+C["grouping-separator"])!==-1&&(ct="D3089");var qt=Oe.integerPart.indexOf(C.digit);qt!==-1&&Oe.integerPart.substring(0,qt).split("").filter(function(ft){return F.indexOf(ft)>-1}).length>0&&(ct="D3090"),qt=Oe.fractionalPart.lastIndexOf(C.digit),qt!==-1&&Oe.fractionalPart.substring(qt).split("").filter(function(ft){return F.indexOf(ft)>-1}).length>0&&(ct="D3091");var zt=typeof Oe.exponentPart=="string";if(zt&&Oe.exponentPart.length>0&&(ut.indexOf(C.percent)!==-1||ut.indexOf(C["per-mille"])!==-1)&&(ct="D3092"),zt&&(Oe.exponentPart.length===0||Oe.exponentPart.split("").filter(function(ft){return F.indexOf(ft)===-1}).length>0)&&(ct="D3093"),ct)throw{code:ct,stack:new Error().stack}},Je=function(Oe){var ct=function(wt,qr){for(var Sr=[],cr=wt.indexOf(C["grouping-separator"]);cr!==-1;){var Qr=(qr?wt.substring(0,cr):wt.substring(cr)).split("").filter(function(Ar){return F.indexOf(Ar)!==-1||Ar===C.digit}).length;Sr.push(Qr),cr=Oe.integerPart.indexOf(C["grouping-separator"],cr+1)}return Sr},_t=ct(Oe.integerPart),ut=function(wt){if(wt.length===0)return 0;for(var qr=function(Qr,Ar){return Ar===0?Qr:qr(Ar,Qr%Ar)},Sr=wt.reduce(qr),cr=1;cr<=wt.length;cr++)if(wt.indexOf(cr*Sr)===-1)return 0;return Sr},Ft=ut(_t),lr=ct(Oe.fractionalPart,!0),Ot=Oe.integerPart.split("").filter(function(wt){return F.indexOf(wt)!==-1}).length,gt=Ot,qt=Oe.fractionalPart.split(""),zt=qt.filter(function(wt){return F.indexOf(wt)!==-1}).length,ft=qt.filter(function(wt){return F.indexOf(wt)!==-1||wt===C.digit}).length,Rt=typeof Oe.exponentPart=="string";Ot===0&&ft===0&&(Rt?(zt=1,ft=1):Ot=1),Rt&&Ot===0&&Oe.integerPart.indexOf(C.digit)!==-1&&(Ot=1),Ot===0&&zt===0&&(zt=1);var Fr=0;return Rt&&(Fr=Oe.exponentPart.split("").filter(function(wt){return F.indexOf(wt)!==-1}).length),{integerPartGroupingPositions:_t,regularGrouping:Ft,minimumIntegerPartSize:Ot,scalingFactor:gt,prefix:Oe.prefix,fractionalPartGroupingPositions:lr,minimumFactionalPartSize:zt,maximumFactionalPartSize:ft,minimumExponentSize:Fr,suffix:Oe.suffix,picture:Oe.subpicture}},vt=Qe.map(De);vt.forEach(et);var ze=vt.map(Je),ht=C["minus-sign"],Vt=C["zero-digit"],ot=C["decimal-separator"],kr=C["grouping-separator"];ze.length===1&&(ze.push(JSON.parse(JSON.stringify(ze[0]))),ze[1].prefix=ht+ze[1].prefix);var dt;u>=0?dt=ze[0]:dt=ze[1];var Nr;dt.picture.indexOf(C.percent)!==-1?Nr=u*100:dt.picture.indexOf(C["per-mille"])!==-1?Nr=u*1e3:Nr=u;var yt,or;if(dt.minimumExponentSize===0)yt=Nr;else{var Pi=Math.pow(10,dt.scalingFactor),Jn=Math.pow(10,dt.scalingFactor-1);for(yt=Nr,or=0;yt<Jn;)yt*=10,or-=1;for(;yt>Pi;)yt/=10,or+=1}var yn=ce(yt,dt.maximumFactionalPartSize),Zn=function(Oe,ct){var _t=Math.abs(Oe).toFixed(ct);return Vt!=="0"&&(_t=_t.split("").map(function(ut){return ut>="0"&&ut<="9"?F[ut.charCodeAt(0)-48]:ut}).join("")),_t},Fe=Zn(yn,dt.maximumFactionalPartSize),bt=Fe.indexOf(".");for(bt===-1?Fe=Fe+ot:Fe=Fe.replace(".",ot);Fe.charAt(0)===Vt;)Fe=Fe.substring(1);for(;Fe.charAt(Fe.length-1)===Vt;)Fe=Fe.substring(0,Fe.length-1);bt=Fe.indexOf(ot);var Ir=dt.minimumIntegerPartSize-bt,bn=dt.minimumFactionalPartSize-(Fe.length-bt-1);if(Fe=(Ir>0?new Array(Ir+1).join(Vt):"")+Fe,Fe=Fe+(bn>0?new Array(bn+1).join(Vt):""),bt=Fe.indexOf(ot),dt.regularGrouping>0)for(var Mt=Math.floor((bt-1)/dt.regularGrouping),Mr=1;Mr<=Mt;Mr++)Fe=[Fe.slice(0,bt-Mr*dt.regularGrouping),kr,Fe.slice(bt-Mr*dt.regularGrouping)].join("");else dt.integerPartGroupingPositions.forEach(function(Oe){Fe=[Fe.slice(0,bt-Oe),kr,Fe.slice(bt-Oe)].join(""),bt++});if(bt=Fe.indexOf(ot),dt.fractionalPartGroupingPositions.forEach(function(Oe){Fe=[Fe.slice(0,Oe+bt+1),kr,Fe.slice(Oe+bt+1)].join("")}),bt=Fe.indexOf(ot),(dt.picture.indexOf(ot)===-1||bt===Fe.length-1)&&(Fe=Fe.substring(0,Fe.length-1)),typeof or<"u"){var Xr=Zn(or,0);Ir=dt.minimumExponentSize-Xr.length,Ir>0&&(Xr=new Array(Ir+1).join(Vt)+Xr),Fe=Fe+C["exponent-separator"]+(or<0?ht:"")+Xr}return Fe=dt.prefix+Fe+dt.suffix,Fe}}function $(u,h){if(!(typeof u>"u")){if(u=ce(u),typeof h>"u"?h=10:h=ce(h),h<2||h>36)throw{code:"D3100",stack:new Error().stack,value:h};var g=u.toString(h);return g}}function Q(u){var h;if(!(typeof u>"u")){if(typeof u=="number")h=u;else if(typeof u=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(u)&&!isNaN(parseFloat(u))&&isFinite(u))h=parseFloat(u);else if(typeof u=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(u))h=Number(u);else if(u===!0)h=1;else if(u===!1)h=0;else throw{code:"D3030",value:u,stack:new Error().stack,index:1};return h}}function ue(u){var h;if(!(typeof u>"u"))return h=Math.abs(u),h}function ae(u){var h;if(!(typeof u>"u"))return h=Math.floor(u),h}function V(u){var h;if(!(typeof u>"u"))return h=Math.ceil(u),h}function ce(u,h){var g;if(!(typeof u>"u")){if(h){var A=u.toString().split("e");u=+(A[0]+"e"+(A[1]?+A[1]+h:h))}g=Math.round(u);var C=g-u;return Math.abs(C)===.5&&Math.abs(g%2)===1&&(g=g-1),h&&(A=g.toString().split("e"),g=+(A[0]+"e"+(A[1]?+A[1]-h:-h))),Object.is(g,-0)&&(g=0),g}}function we(u){var h;if(!(typeof u>"u")){if(u<0)throw{stack:new Error().stack,code:"D3060",index:1,value:u};return h=Math.sqrt(u),h}}function qe(u,h){var g;if(!(typeof u>"u")){if(g=Math.pow(u,h),!isFinite(g))throw{stack:new Error().stack,code:"D3061",index:1,value:u,exp:h};return g}}function Ge(){return Math.random()}function Ie(u){if(!(typeof u>"u")){var h=!1;if(Array.isArray(u)){if(u.length===1)h=Ie(u[0]);else if(u.length>1){var g=u.filter(function(A){return Ie(A)});h=g.length>0}}else typeof u=="string"?u.length>0&&(h=!0):f(u)?u!==0&&(h=!0):u!==null&&typeof u=="object"&&!_(u)?Object.keys(u).length>0&&(h=!0):typeof u=="boolean"&&u===!0&&(h=!0);return h}}function Ae(u){if(!(typeof u>"u"))return!Ie(u)}function L(u,h,g,A){var C=[h],F=ve(u);return F>=2&&C.push(g),F>=3&&C.push(A),C}async function k(u,h){if(!(typeof u>"u")){for(var g=b(),A=0;A<u.length;A++){var C=L(h,u[A],A,u),F=await h.apply(this,C);typeof F<"u"&&g.push(F)}return g}}async function M(u,h){if(!(typeof u>"u")){for(var g=b(),A=0;A<u.length;A++){var C=u[A],F=L(h,C,A,u),ie=await h.apply(this,F);Ie(ie)&&g.push(C)}return g}}async function H(u,h){if(!(typeof u>"u")){for(var g=!1,A,C=0;C<u.length;C++){var F=u[C],ie=!0;if(typeof h<"u"){var be=L(h,F,C,u),Ee=await h.apply(this,be);ie=Ie(Ee)}if(ie)if(!g)A=F,g=!0;else throw{stack:new Error().stack,code:"D3138",index:C}}if(!g)throw{stack:new Error().stack,code:"D3139"};return A}}function J(){for(var u=[],h=Array.prototype.slice.call(arguments),g=Math.min.apply(Math,h.map(function(F){return Array.isArray(F)?F.length:0})),A=0;A<g;A++){var C=h.map(F=>F[A]);u.push(C)}return u}async function te(u,h,g){if(!(typeof u>"u")){var A,C=ve(h);if(C<2)throw{stack:new Error().stack,code:"D3050",index:1};var F;for(typeof g>"u"&&u.length>0?(A=u[0],F=1):(A=g,F=0);F<u.length;){var ie=[A,u[F]];C>=3&&ie.push(F),C>=4&&ie.push(u),A=await h.apply(this,ie),F++}return A}}function _e(u){var h=b();if(Array.isArray(u)){var g={};u.forEach(function(A){var C=_e(A);C.forEach(function(F){g[F]=!0})}),h=_e(g)}else u!==null&&typeof u=="object"&&!_(u)&&Object.keys(u).forEach(A=>h.push(A));return h}function Le(u,h){var g;if(Array.isArray(u)){g=b();for(var A=0;A<u.length;A++){var C=Le(u[A],h);typeof C<"u"&&(Array.isArray(C)?C.forEach(F=>g.push(F)):g.push(C))}}else u!==null&&typeof u=="object"&&!_(u)&&(g=u[h]);return g}function Ke(u,h){return typeof u>"u"?h:typeof h>"u"?u:(Array.isArray(u)||(u=b(u)),Array.isArray(h)||(h=[h]),u.concat(h))}function st(u){return!(typeof u>"u")}function It(u){var h=b();if(Array.isArray(u))u.forEach(function(C){h=Ke(h,It(C))});else if(u!==null&&typeof u=="object"&&!D(u))for(var g in u){var A={};A[g]=u[g],h.push(A)}else h=u;return h}function de(u){if(!(typeof u>"u")){var h={};return u.forEach(function(g){for(var A in g)h[A]=g[A]}),h}}function rr(u){if(!(typeof u>"u")){if(u.length<=1)return u;for(var h=u.length,g=new Array(h),A=0;A<h;A++)g[h-A-1]=u[A];return g}}async function Qt(u,h){var g=b();for(var A in u){var C=L(h,u[A],A,u),F=await h.apply(this,C);typeof F<"u"&&g.push(F)}return g}function Tt(u){throw{code:"D3137",stack:new Error().stack,message:u||"$error() function evaluated"}}function pt(u,h){if(!u)throw{code:"D3141",stack:new Error().stack,message:h||"$assert() statement failed"}}function Gt(u){if(u!==void 0)return u===null?"null":f(u)?"number":typeof u=="string"?"string":typeof u=="boolean"?"boolean":Array.isArray(u)?"array":_(u)?"function":"object"}async function He(u,h){if(!(typeof u>"u")){if(u.length<=1)return u;var g;if(typeof h>"u"){if(!R(u)&&!y(u))throw{stack:new Error().stack,code:"D3070",index:1};g=async function(ie,be){return ie>be}}else g=h;var A=async function(ie,be){var Ee=async function(De,et,Je){et.length===0?Array.prototype.push.apply(De,Je):Je.length===0?Array.prototype.push.apply(De,et):await g(et[0],Je[0])?(De.push(Je[0]),await Ee(De,et,Je.slice(1))):(De.push(et[0]),await Ee(De,et.slice(1),Je))},Qe=[];return await Ee(Qe,ie,be),Qe},C=async function(ie){if(!Array.isArray(ie)||ie.length<=1)return ie;var be=Math.floor(ie.length/2),Ee=ie.slice(0,be),Qe=ie.slice(be);return Ee=await C(Ee),Qe=await C(Qe),await A(Ee,Qe)},F=await C(u);return F}}function m(u){if(!(typeof u>"u")){if(u.length<=1)return u;for(var h=new Array(u.length),g=0;g<u.length;g++){var A=Math.floor(Math.random()*(g+1));g!==A&&(h[g]=h[A]),h[A]=u[g]}return h}}function S(u){if(!(typeof u>"u")){if(!Array.isArray(u)||u.length<=1)return u;for(var h=x(u)?b():[],g=0;g<u.length;g++){for(var A=u[g],C=!1,F=0;F<h.length;F++)if(xe(A,h[F])){C=!0;break}C||h.push(A)}return h}}async function E(u,h){var g={};for(var A in u){var C=u[A],F=L(h,C,A,u),ie=await h.apply(this,F);Ie(ie)&&(g[A]=C)}return Object.keys(g).length===0&&(g=void 0),g}return{sum:N,count:K,max:U,min:O,average:B,string:ee,substring:Te,substringBefore:Pe,substringAfter:he,lowercase:z,uppercase:le,length:ye,trim:ke,pad:X,match:Z,contains:me,replace:Ce,split:We,join:P,formatNumber:q,formatBase:$,number:Q,floor:ae,ceil:V,round:ce,abs:ue,sqrt:we,power:qe,random:Ge,boolean:Ie,not:Ae,map:k,zip:J,filter:M,single:H,foldLeft:te,sift:E,keys:_e,lookup:Le,append:Ke,exists:st,spread:It,merge:de,reverse:rr,each:Qt,error:Tt,assert:pt,type:Gt,sort:He,shuffle:m,distinct:S,base64encode:Ne,base64decode:w,encodeUrlComponent:I,encodeUrl:fe,decodeUrlComponent:Re,decodeUrl:Ye}})();n.exports=c}).call(this)}).call(this,typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(t,n,i){var o=t("./datetime"),a=t("./functions"),c=t("./utils"),f=t("./parser"),y=t("./signature"),R=(function(){var b=c.isNumeric,x=c.isArrayOfStrings,_=c.isArrayOfNumbers,D=c.createSequence,Y=c.isSequence,ve=c.isFunction,xe=c.isLambda,W=c.isIterable,N=c.isPromise,K=c.getFunctionArity,U=c.isDeepEqual,O=Tt(null);async function B(m,S,E){var u,h=E.lookup(Symbol.for("jsonata.__evaluate_entry"));switch(h&&await h(m,S,E),m.type){case"path":u=await ee(m,S,E);break;case"binary":u=await ye(m,S,E);break;case"unary":u=await ke(m,S,E);break;case"name":u=X(m,S);break;case"string":case"number":case"value":u=se(m);break;case"wildcard":u=me(m,S);break;case"descendant":u=Ce(m,S);break;case"parent":u=E.lookup(m.slot.label);break;case"condition":u=await ae(m,S,E);break;case"block":u=await V(m,S,E);break;case"bind":u=await ue(m,S,E);break;case"regex":u=ce(m);break;case"function":u=await L(m,S,E);break;case"variable":u=we(m,S,E);break;case"lambda":u=H(m,S,E);break;case"partial":u=await J(m,S,E);break;case"apply":u=await Ae(m,S,E);break;case"transform":u=Ge(m,S,E);break}if(Object.prototype.hasOwnProperty.call(m,"predicate"))for(var g=0;g<m.predicate.length;g++)u=await le(m.predicate[g].expr,u,E);m.type!=="path"&&Object.prototype.hasOwnProperty.call(m,"group")&&(u=await q(m.group,u,E));var A=E.lookup(Symbol.for("jsonata.__evaluate_exit"));return A&&await A(m,S,E,u),u&&Y(u)&&!u.tupleStream&&(m.keepArray&&(u.keepSingleton=!0),u.length===0?u=void 0:u.length===1&&(u=u.keepSingleton?u:u[0])),u}async function ee(m,S,E){var u;Array.isArray(S)&&m.steps[0].type!=="variable"?u=S:u=D(S);for(var h,g=!1,A=void 0,C=0;C<m.steps.length;C++){var F=m.steps[C];if(F.tuple&&(g=!0),C===0&&F.consarray?h=await B(F,u,E):g?A=await z(F,u,A,E):h=await Pe(F,u,E,C===m.steps.length-1),!g&&(typeof h>"u"||h.length===0))break;typeof F.focus>"u"&&(u=h)}if(g)if(m.tuple)h=A;else for(h=D(),C=0;C<A.length;C++)h.push(A[C]["@"]);return m.keepSingletonArray&&(Array.isArray(h)&&h.cons&&!h.sequence&&(h=D(h)),h.keepSingleton=!0),m.hasOwnProperty("group")&&(h=await q(m.group,g?A:h,E)),h}function Te(m,S){var E=Tt(m);for(const u in S)E.bind(u,S[u]);return E}async function Pe(m,S,E,u){var h;if(m.type==="sort")return h=await qe(m,S,E),m.stages&&(h=await he(m.stages,h,E)),h;h=D();for(var g=0;g<S.length;g++){var A=await B(m,S[g],E);if(m.stages)for(var C=0;C<m.stages.length;C++)A=await le(m.stages[C].expr,A,E);typeof A<"u"&&h.push(A)}var F=D();return u&&h.length===1&&Array.isArray(h[0])&&!Y(h[0])?F=h[0]:h.forEach(function(ie){!Array.isArray(ie)||ie.cons?F.push(ie):ie.forEach(be=>F.push(be))}),F}async function he(m,S,E){for(var u=S,h=0;h<m.length;h++){var g=m[h];switch(g.type){case"filter":u=await le(g.expr,u,E);break;case"index":for(var A=0;A<u.length;A++){var C=u[A];C[g.value]=A}break}}return u}async function z(m,S,E,u){var h;if(m.type==="sort"){if(E)h=await qe(m,E,u);else{var g=await qe(m,S,u);h=D(),h.tupleStream=!0;for(var A=0;A<g.length;A++){var C={"@":g[A]};C[m.index]=A,h.push(C)}}return m.stages&&(h=await he(m.stages,h,u)),h}h=D(),h.tupleStream=!0;var F=u;E===void 0&&(E=S.map(Qe=>({"@":Qe})));for(var ie=0;ie<E.length;ie++){F=Te(u,E[ie]);var be=await B(m,E[ie]["@"],F);if(typeof be<"u"){Array.isArray(be)||(be=[be]);for(var Ee=0;Ee<be.length;Ee++)C={},Object.assign(C,E[ie]),be.tupleStream?Object.assign(C,be[Ee]):(m.focus?(C[m.focus]=be[Ee],C["@"]=E[ie]["@"]):C["@"]=be[Ee],m.index&&(C[m.index]=Ee),m.ancestor&&(C[m.ancestor.label]=E[ie]["@"])),h.push(C)}}return m.stages&&(h=await he(m.stages,h,u)),h}async function le(m,S,E){var u=D();if(S&&S.tupleStream&&(u.tupleStream=!0),Array.isArray(S)||(S=D(S)),m.type==="number"){var h=Math.floor(m.value);h<0&&(h=S.length+h);var g=await S[h];typeof g<"u"&&(Array.isArray(g)?u=g:u.push(g))}else for(h=0;h<S.length;h++){var g=S[h],A=g,C=E;S.tupleStream&&(A=g["@"],C=Te(E,g));var F=await B(m,A,C);b(F)&&(F=[F]),_(F)?F.forEach(function(be){var Ee=Math.floor(be);Ee<0&&(Ee=S.length+Ee),Ee===h&&u.push(g)}):a.boolean(F)&&u.push(g)}return u}async function ye(m,S,E){var u,h=await B(m.lhs,S,E),g=m.value,A=async()=>await B(m.rhs,S,E);if(g==="and"||g==="or")try{return await Ye(h,A,g)}catch(F){throw F.position=m.position,F.token=g,F}var C=await A();try{switch(g){case"+":case"-":case"*":case"/":case"%":u=w(h,C,g);break;case"=":case"!=":u=I(h,C,g);break;case"<":case"<=":case">":case">=":u=fe(h,C,g);break;case"&":u=P(h,C);break;case"..":u=Q(h,C);break;case"in":u=Re(h,C);break}}catch(F){throw F.position=m.position,F.token=g,F}return u}async function ke(m,S,E){var u;switch(m.value){case"-":if(u=await B(m.expression,S,E),typeof u>"u")u=void 0;else if(b(u))u=-u;else throw{code:"D1002",stack:new Error().stack,position:m.position,token:m.value,value:u};break;case"[":u=[];let A=await Promise.all(m.expressions.map(async(C,F)=>(E.isParallelCall=F>0,[C,await B(C,S,E)])));for(let C of A){var[h,g]=C;typeof g<"u"&&(h.value==="["?u.push(g):u=a.append(u,g))}m.consarray&&Object.defineProperty(u,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":u=await q(m,S,E);break}return u}function X(m,S,E){return a.lookup(S,m.value)}function se(m){return m.value}function me(m,S){var E=D();return Array.isArray(S)&&S.outerWrapper&&S.length>0&&(S=S[0]),S!==null&&typeof S=="object"&&Object.keys(S).forEach(function(u){var h=S[u];Array.isArray(h)?(h=Z(h),E=a.append(E,h)):E.push(h)}),E}function Z(m,S){return typeof S>"u"&&(S=[]),Array.isArray(m)?m.forEach(function(E){Z(E,S)}):S.push(m),S}function Ce(m,S){var E,u=D();return typeof S<"u"&&(Ne(S,u),u.length===1?E=u[0]:E=u),E}function Ne(m,S){Array.isArray(m)||S.push(m),Array.isArray(m)?m.forEach(function(E){Ne(E,S)}):m!==null&&typeof m=="object"&&Object.keys(m).forEach(function(E){Ne(m[E],S)})}function w(m,S,E){var u;if(typeof m<"u"&&!b(m))throw{code:"T2001",stack:new Error().stack,value:m};if(typeof S<"u"&&!b(S))throw{code:"T2002",stack:new Error().stack,value:S};if(typeof m>"u"||typeof S>"u")return u;switch(E){case"+":u=m+S;break;case"-":u=m-S;break;case"*":u=m*S;break;case"/":u=m/S;break;case"%":u=m%S;break}return u}function I(m,S,E){var u,h=typeof m,g=typeof S;if(h==="undefined"||g==="undefined")return!1;switch(E){case"=":u=U(m,S);break;case"!=":u=!U(m,S);break}return u}function fe(m,S,E){var u,h=typeof m,g=typeof S,A=h==="undefined"||h==="string"||h==="number",C=g==="undefined"||g==="string"||g==="number";if(!A||!C)throw{code:"T2010",stack:new Error().stack,value:h==="string"||h==="number"?S:m};if(!(h==="undefined"||g==="undefined")){if(h!==g)throw{code:"T2009",stack:new Error().stack,value:m,value2:S};switch(E){case"<":u=m<S;break;case"<=":u=m<=S;break;case">":u=m>S;break;case">=":u=m>=S;break}return u}}function Re(m,S){var E=!1;if(typeof m>"u"||typeof S>"u")return!1;Array.isArray(S)||(S=[S]);for(var u=0;u<S.length;u++)if(S[u]===m){E=!0;break}return E}async function Ye(m,S,E){var u,h=We(m);switch(E){case"and":u=h&&We(await S());break;case"or":u=h||We(await S());break}return u}function We(m){var S=a.boolean(m);return typeof S>"u"?!1:S}function P(m,S){var E,u="",h="";return typeof m<"u"&&(u=a.string(m)),typeof S<"u"&&(h=a.string(S)),E=u.concat(h),E}async function q(m,S,E){var u={},h={},g=!!(S&&S.tupleStream);Array.isArray(S)||(S=D(S)),S.length===0&&S.push(void 0);for(var A=0;A<S.length;A++)for(var C=S[A],F=g?Te(E,C):E,ie=0;ie<m.lhs.length;ie++){var be=m.lhs[ie],Ee=await B(be[0],g?C["@"]:C,F);if(typeof Ee!="string"&&Ee!==void 0)throw{code:"T1003",stack:new Error().stack,position:m.position,value:Ee};if(Ee!==void 0){var Qe={data:C,exprIndex:ie};if(h.hasOwnProperty(Ee)){if(h[Ee].exprIndex!==ie)throw{code:"D1009",stack:new Error().stack,position:m.position,value:Ee};h[Ee].data=a.append(h[Ee].data,C)}else h[Ee]=Qe}}let De=await Promise.all(Object.keys(h).map(async(Je,vt)=>{let ze=h[Je];var ht=ze.data,Vt=E;if(g){var ot=$(ze.data);ht=ot["@"],delete ot["@"],Vt=Te(E,ot)}return E.isParallelCall=vt>0,[Je,await B(m.lhs[ze.exprIndex][1],ht,Vt)]}));for(let Je of De){var[Ee,et]=await Je;typeof et<"u"&&(u[Ee]=et)}return u}function $(m){if(!Array.isArray(m))return m;var S={};Object.assign(S,m[0]);for(var E=1;E<m.length;E++)for(const u in m[E])S[u]=a.append(S[u],m[E][u]);return S}function Q(m,S){var E;if(typeof m<"u"&&!Number.isInteger(m))throw{code:"T2003",stack:new Error().stack,value:m};if(typeof S<"u"&&!Number.isInteger(S))throw{code:"T2004",stack:new Error().stack,value:S};if(typeof m>"u"||typeof S>"u"||m>S)return E;var u=S-m+1;if(u>1e7)throw{code:"D2014",stack:new Error().stack,value:u};E=new Array(u);for(var h=m,g=0;h<=S;h++,g++)E[g]=h;return E.sequence=!0,E}async function ue(m,S,E){var u=await B(m.rhs,S,E);return E.bind(m.lhs.value,u),u}async function ae(m,S,E){var u,h=await B(m.condition,S,E);return a.boolean(h)?u=await B(m.then,S,E):typeof m.else<"u"&&(u=await B(m.else,S,E)),u}async function V(m,S,E){for(var u,h=Tt(E),g=0;g<m.expressions.length;g++)u=await B(m.expressions[g],S,h);return u}function ce(m){var S=new He.RegexEngine(m.value),E=function(u,h){var g;S.lastIndex=h||0;var A=S.exec(u);if(A!==null){if(g={match:A[0],start:A.index,end:A.index+A[0].length,groups:[]},A.length>1)for(var C=1;C<A.length;C++)g.groups.push(A[C]);g.next=function(){if(!(S.lastIndex>=u.length)){var F=E(u,S.lastIndex);if(F&&F.match==="")throw{code:"D1004",stack:new Error().stack,position:m.position,value:m.value.source};return F}}}return g};return E}function we(m,S,E){var u;return m.value===""?u=S&&S.outerWrapper?S[0]:S:u=E.lookup(m.value),u}async function qe(m,S,E){var u,h=S,g=!!S.tupleStream,A=async function(F,ie){for(var be=0,Ee=0;be===0&&Ee<m.terms.length;Ee++){var Qe=m.terms[Ee],De=F,et=E;g&&(De=F["@"],et=Te(E,F));var Je=await B(Qe.expression,De,et);De=ie,et=E,g&&(De=ie["@"],et=Te(E,ie));var vt=await B(Qe.expression,De,et),ze=typeof Je,ht=typeof vt;if(ze==="undefined"){be=ht==="undefined"?0:1;continue}if(ht==="undefined"){be=-1;continue}if(!(ze==="string"||ze==="number")||!(ht==="string"||ht==="number"))throw{code:"T2008",stack:new Error().stack,position:m.position,value:ze==="string"||ze==="number"?vt:Je};if(ze!==ht)throw{code:"T2007",stack:new Error().stack,position:m.position,value:Je,value2:vt};Je!==vt&&(Je<vt?be=-1:be=1,Qe.descending===!0&&(be=-be))}return be===1},C={environment:E,input:S};return u=await a.sort.apply(C,[h,A]),u}function Ge(m,S,E){var u=async function(h){if(!(typeof h>"u")){var g=E.lookup("clone");if(!ve(g))throw{code:"T2013",stack:new Error().stack,position:m.position};var A=await k(g,[h],null,E),C=await B(m.pattern,A,E);if(typeof C<"u"){Array.isArray(C)||(C=[C]);for(var F=0;F<C.length;F++){var ie=C[F];if(ie&&(ie.isPrototypeOf(A)||ie instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:m.position};var be=await B(m.update,ie,E),Ee=typeof be;if(Ee!=="undefined"){if(Ee!=="object"||be===null||Array.isArray(be))throw{code:"T2011",stack:new Error().stack,position:m.update.position,value:be};for(var Qe in be)ie[Qe]=be[Qe]}if(typeof m.delete<"u"){var De=await B(m.delete,ie,E);if(typeof De<"u"){var et=De;if(Array.isArray(De)||(De=[De]),!x(De))throw{code:"T2012",stack:new Error().stack,position:m.delete.position,value:et};for(var Je=0;Je<De.length;Je++)typeof ie=="object"&&ie!==null&&delete ie[De[Je]]}}}}return A}};return de(u,"<(oa):o>")}var Ie=f("function($f, $g) { function($x){ $g($f($x)) } }");async function Ae(m,S,E){var u,h=await B(m.lhs,S,E);if(m.rhs.type==="function")u=await L(m.rhs,S,E,{context:h});else{var g=await B(m.rhs,S,E);if(!ve(g))throw{code:"T2006",stack:new Error().stack,position:m.position,value:g};if(ve(h)){var A=await B(Ie,null,E);u=await k(A,[h,g],null,E)}else u=await k(g,[h],null,E)}return u}async function L(m,S,E,u){var h,g=await B(m.procedure,S,E);if(typeof g>"u"&&m.procedure.type==="path"&&E.lookup(m.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:m.position,token:m.procedure.steps[0].value};var A=[];typeof u<"u"&&A.push(u.context);for(var C=0;C<m.arguments.length;C++){const ie=await B(m.arguments[C],S,E);if(ve(ie)){const be=async function(...Ee){return await k(ie,Ee,null,E)};be.arity=K(ie),A.push(be)}else A.push(ie)}var F=m.procedure.type==="path"?m.procedure.steps[0].value:m.procedure.value;try{typeof g=="object"&&(g.token=F,g.position=m.position),h=await k(g,A,S,E)}catch(ie){throw ie.position||(ie.position=m.position),ie.token||(ie.token=F),ie}return h}async function k(m,S,E,u){var h;for(h=await M(m,S,E,u);xe(h)&&h.thunk===!0;){var g=await B(h.body.procedure,h.input,h.environment);h.body.procedure.type==="variable"&&(g.token=h.body.procedure.value),g.position=h.body.procedure.position;for(var A=[],C=0;C<h.body.arguments.length;C++)A.push(await B(h.body.arguments[C],h.input,h.environment));h=await M(g,A,E,u)}return h}async function M(m,S,E,u){var h;try{var g=S;if(m&&(g=te(m.signature,S,E)),xe(m))h=await _e(m,g);else if(m&&m._jsonata_function===!0){var A={environment:u,input:E};h=m.implementation.apply(A,g),W(h)&&(h=h.next().value),N(h)&&(h=await h)}else if(typeof m=="function")h=m.apply(E,g),N(h)&&(h=await h);else throw{code:"T1006",stack:new Error().stack}}catch(C){throw m&&(typeof C.token>"u"&&typeof m.token<"u"&&(C.token=m.token),C.position=m.position||C.position),C}return h}function H(m,S,E){var u={_jsonata_lambda:!0,input:S,environment:E,arguments:m.arguments,signature:m.signature,body:m.body};return m.thunk===!0&&(u.thunk=!0),u.apply=async function(h,g){return await k(u,g,S,h?h.environment:E)},u}async function J(m,S,E){for(var u,h=[],g=0;g<m.arguments.length;g++){var A=m.arguments[g];A.type==="operator"&&A.value==="?"?h.push(A):h.push(await B(A,S,E))}var C=await B(m.procedure,S,E);if(typeof C>"u"&&m.procedure.type==="path"&&E.lookup(m.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:m.position,token:m.procedure.steps[0].value};if(xe(C))u=Le(C,h);else if(C&&C._jsonata_function===!0)u=Ke(C.implementation,h);else if(typeof C=="function")u=Ke(C,h);else throw{code:"T1008",stack:new Error().stack,position:m.position,token:m.procedure.type==="path"?m.procedure.steps[0].value:m.procedure.value};return u}function te(m,S,E){if(typeof m>"u")return S;var u=m.validate(S,E);return u}async function _e(m,S){var E,u=Tt(m.environment);return m.arguments.forEach(function(h,g){u.bind(h.value,S[g])}),typeof m.body=="function"?E=await st(m.body,u):E=await B(m.body,m.input,u),E}function Le(m,S){var E=Tt(m.environment),u=[];m.arguments.forEach(function(g,A){var C=S[A];C&&C.type==="operator"&&C.value==="?"?u.push(g):E.bind(g.value,C)});var h={_jsonata_lambda:!0,input:m.input,environment:E,arguments:u,body:m.body};return h}function Ke(m,S){var E=It(m);E=E.map(function(A){return"$"+A.trim()});var u="function("+E.join(", ")+"){ _ }",h=f(u);h.body=m;var g=Le(h,S);return g}async function st(m,S){var E=It(m),u=E.map(function(A){return S.lookup(A.trim())}),h={environment:S},g=m.apply(h,u);return N(g)&&(g=await g),g}function It(m){var S=m.toString(),E=/\(([^)]*)\)/.exec(S)[1],u=E.split(",");return u}function de(m,S){var E={_jsonata_function:!0,implementation:m};return typeof S<"u"&&(E.signature=y(S)),E}async function rr(m,S){if(!(typeof m>"u")){var E=this.input;typeof S<"u"&&(E=S,Array.isArray(E)&&!Y(E)&&(E=D(E),E.outerWrapper=!0));try{var u=f(m,!1)}catch(g){throw Gt(g),{stack:new Error().stack,code:"D3120",value:g.message,error:g}}try{var h=await B(u,E,this.environment)}catch(g){throw Gt(g),{stack:new Error().stack,code:"D3121",value:g.message,error:g}}return h}}function Qt(m){if(!(typeof m>"u"))return JSON.parse(a.string(m))}function Tt(m){var S={};const E={bind:function(h,g){S[h]=g},lookup:function(h){var g;return S.hasOwnProperty(h)?g=S[h]:m&&(g=m.lookup(h)),g},timestamp:m?m.timestamp:null,async:m?m.async:!1,isParallelCall:m?m.isParallelCall:!1,global:m?m.global:{ancestry:[null]}};if(m){var u=m.lookup(Symbol.for("jsonata.__createFrame_push"));u&&u(m,E)}return E}O.bind("sum",de(a.sum,"<a<n>:n>")),O.bind("count",de(a.count,"<a:n>")),O.bind("max",de(a.max,"<a<n>:n>")),O.bind("min",de(a.min,"<a<n>:n>")),O.bind("average",de(a.average,"<a<n>:n>")),O.bind("string",de(a.string,"<x-b?:s>")),O.bind("substring",de(a.substring,"<s-nn?:s>")),O.bind("substringBefore",de(a.substringBefore,"<s-s:s>")),O.bind("substringAfter",de(a.substringAfter,"<s-s:s>")),O.bind("lowercase",de(a.lowercase,"<s-:s>")),O.bind("uppercase",de(a.uppercase,"<s-:s>")),O.bind("length",de(a.length,"<s-:n>")),O.bind("trim",de(a.trim,"<s-:s>")),O.bind("pad",de(a.pad,"<s-ns?:s>")),O.bind("match",de(a.match,"<s-f<s:o>n?:a<o>>")),O.bind("contains",de(a.contains,"<s-(sf):b>")),O.bind("replace",de(a.replace,"<s-(sf)(sf)n?:s>")),O.bind("split",de(a.split,"<s-(sf)n?:a<s>>")),O.bind("join",de(a.join,"<a<s>s?:s>")),O.bind("formatNumber",de(a.formatNumber,"<n-so?:s>")),O.bind("formatBase",de(a.formatBase,"<n-n?:s>")),O.bind("formatInteger",de(o.formatInteger,"<n-s:s>")),O.bind("parseInteger",de(o.parseInteger,"<s-s:n>")),O.bind("number",de(a.number,"<(nsb)-:n>")),O.bind("floor",de(a.floor,"<n-:n>")),O.bind("ceil",de(a.ceil,"<n-:n>")),O.bind("round",de(a.round,"<n-n?:n>")),O.bind("abs",de(a.abs,"<n-:n>")),O.bind("sqrt",de(a.sqrt,"<n-:n>")),O.bind("power",de(a.power,"<n-n:n>")),O.bind("random",de(a.random,"<:n>")),O.bind("boolean",de(a.boolean,"<x-:b>")),O.bind("not",de(a.not,"<x-:b>")),O.bind("map",de(a.map,"<af>")),O.bind("zip",de(a.zip,"<a+>")),O.bind("filter",de(a.filter,"<af>")),O.bind("single",de(a.single,"<af?>")),O.bind("reduce",de(a.foldLeft,"<afj?:j>")),O.bind("sift",de(a.sift,"<o-f?:o>")),O.bind("keys",de(a.keys,"<x-:a<s>>")),O.bind("lookup",de(a.lookup,"<x-s:x>")),O.bind("append",de(a.append,"<xx:a>")),O.bind("exists",de(a.exists,"<x:b>")),O.bind("spread",de(a.spread,"<x-:a<o>>")),O.bind("merge",de(a.merge,"<a<o>:o>")),O.bind("reverse",de(a.reverse,"<a:a>")),O.bind("each",de(a.each,"<o-f:a>")),O.bind("error",de(a.error,"<s?:x>")),O.bind("assert",de(a.assert,"<bs?:x>")),O.bind("type",de(a.type,"<x:s>")),O.bind("sort",de(a.sort,"<af?:a>")),O.bind("shuffle",de(a.shuffle,"<a:a>")),O.bind("distinct",de(a.distinct,"<x:x>")),O.bind("base64encode",de(a.base64encode,"<s-:s>")),O.bind("base64decode",de(a.base64decode,"<s-:s>")),O.bind("encodeUrlComponent",de(a.encodeUrlComponent,"<s-:s>")),O.bind("encodeUrl",de(a.encodeUrl,"<s-:s>")),O.bind("decodeUrlComponent",de(a.decodeUrlComponent,"<s-:s>")),O.bind("decodeUrl",de(a.decodeUrl,"<s-:s>")),O.bind("eval",de(rr,"<sx?:x>")),O.bind("toMillis",de(o.toMillis,"<s-s?:n>")),O.bind("fromMillis",de(o.fromMillis,"<n-s?s?:s>")),O.bind("clone",de(Qt,"<(oa)-:o>"));var pt={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Gt(m){var S=pt[m.code];if(typeof S<"u"){var E=S.replace(/\{\{\{([^}]+)}}}/g,function(){return m[arguments[1]]});E=E.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(m[arguments[1]])}),m.message=E}}function He(m,S){var E,u;try{E=f(m,S&&S.recover),u=E.errors,delete E.errors}catch(A){throw Gt(A),A}var h=Tt(O),g=new Date;return h.bind("now",de(function(A,C){return o.fromMillis(g.getTime(),A,C)},"<s?s?:s>")),h.bind("millis",de(function(){return g.getTime()},"<:n>")),S&&S.RegexEngine?He.RegexEngine=S.RegexEngine:He.RegexEngine=RegExp,{evaluate:async function(A,C,F){if(typeof u<"u"){var ie={code:"S0500",position:0};throw Gt(ie),ie}if(typeof C<"u"){var be;be=Tt(h);for(var Ee in C)be.bind(Ee,C[Ee])}else be=h;be.bind("$",A),g=new Date,be.timestamp=g,Array.isArray(A)&&!Y(A)&&(A=D(A),A.outerWrapper=!0);var Qe;try{return Qe=await B(E,A,be),typeof F=="function"&&F(null,Qe),Qe}catch(De){throw Gt(De),De}},assign:function(A,C){h.bind(A,C)},registerFunction:function(A,C,F){var ie=de(C,F);h.bind(A,ie)},ast:function(){return E},errors:function(){return u}}}return He.parser=f,He})();n.exports=R},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(t,n,i){var o=t("./signature");const a=(()=>{var c={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,"?:":40,"??":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},f={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},y=function(b){var x=0,_=b.length,D=function(xe,W){var N={type:xe,value:W,position:x};return N},Y=function(){for(var xe=x,W=0,N,K,U=function(B){if(b.charAt(B)==="/"&&W===0){for(var ee=0;b.charAt(B-(ee+1))==="\\";)ee++;if(ee%2===0)return!0}return!1};x<_;){var O=b.charAt(x);if(U(x)){if(N=b.substring(xe,x),N==="")throw{code:"S0301",stack:new Error().stack,position:x};for(x++,O=b.charAt(x),xe=x;O==="i"||O==="m";)x++,O=b.charAt(x);return K=b.substring(xe,x)+"g",new RegExp(N,K)}(O==="("||O==="["||O==="{")&&b.charAt(x-1)!=="\\"&&W++,(O===")"||O==="]"||O==="}")&&b.charAt(x-1)!=="\\"&&W--,x++}throw{code:"S0302",stack:new Error().stack,position:x}},ve=function(xe){if(x>=_)return null;for(var W=b.charAt(x);x<_&&` 	
\r\v`.indexOf(W)>-1;)x++,W=b.charAt(x);if(W==="/"&&b.charAt(x+1)==="*"){var N=x;for(x+=2,W=b.charAt(x);!(W==="*"&&b.charAt(x+1)==="/");)if(W=b.charAt(++x),x>=_)throw{code:"S0106",stack:new Error().stack,position:N};return x+=2,W=b.charAt(x),ve(xe)}if(xe!==!0&&W==="/")return x++,D("regex",Y());if(W==="."&&b.charAt(x+1)===".")return x+=2,D("operator","..");if(W===":"&&b.charAt(x+1)==="=")return x+=2,D("operator",":=");if(W==="!"&&b.charAt(x+1)==="=")return x+=2,D("operator","!=");if(W===">"&&b.charAt(x+1)==="=")return x+=2,D("operator",">=");if(W==="<"&&b.charAt(x+1)==="=")return x+=2,D("operator","<=");if(W==="*"&&b.charAt(x+1)==="*")return x+=2,D("operator","**");if(W==="~"&&b.charAt(x+1)===">")return x+=2,D("operator","~>");if(W==="?"&&b.charAt(x+1)===":")return x+=2,D("operator","?:");if(W==="?"&&b.charAt(x+1)==="?")return x+=2,D("operator","??");if(Object.prototype.hasOwnProperty.call(c,W))return x++,D("operator",W);if(W==='"'||W==="'"){var K=W;x++;for(var U="";x<_;){if(W=b.charAt(x),W==="\\")if(x++,W=b.charAt(x),Object.prototype.hasOwnProperty.call(f,W))U+=f[W];else if(W==="u"){var O=b.substr(x+1,4);if(/^[0-9a-fA-F]+$/.test(O)){var B=parseInt(O,16);U+=String.fromCharCode(B),x+=4}else throw{code:"S0104",stack:new Error().stack,position:x}}else throw{code:"S0103",stack:new Error().stack,position:x,token:W};else{if(W===K)return x++,D("string",U);U+=W}x++}throw{code:"S0101",stack:new Error().stack,position:x}}var ee=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,Te=ee.exec(b.substring(x));if(Te!==null){var Pe=parseFloat(Te[0]);if(!isNaN(Pe)&&isFinite(Pe))return x+=Te[0].length,D("number",Pe);throw{code:"S0102",stack:new Error().stack,position:x,token:Te[0]}}var he;if(W==="`"){x++;var z=b.indexOf("`",x);if(z!==-1)return he=b.substring(x,z),x=z+1,D("name",he);throw x=_,{code:"S0105",stack:new Error().stack,position:x}}for(var le=x,ye;;)if(ye=b.charAt(le),le===_||` 	
\r\v`.indexOf(ye)>-1||Object.prototype.hasOwnProperty.call(c,ye)){if(b.charAt(x)==="$")return he=b.substring(x+1,le),x=le,D("variable",he);switch(he=b.substring(x,le),x=le,he){case"or":case"in":case"and":return D("operator",he);case"true":return D("value",!0);case"false":return D("value",!1);case"null":return D("value",null);default:return x===_&&he===""?null:D("name",he)}}else le++};return ve},R=function(b,x){var _,D,Y={},ve=[],xe=function(){var w=[];_.id!=="(end)"&&w.push({type:_.type,value:_.value,position:_.position});for(var I=D();I!==null;)w.push(I),I=D();return w},W={nud:function(){var w={code:"S0211",token:this.value,position:this.position};if(x)return w.remaining=xe(),w.type="error",ve.push(w),w;throw w.stack=new Error().stack,w}},N=function(w,I){var fe=Y[w];return I=I||0,fe?I>=fe.lbp&&(fe.lbp=I):(fe=Object.create(W),fe.id=fe.value=w,fe.lbp=I,Y[w]=fe),fe},K=function(w){if(x){w.remaining=xe(),ve.push(w);var I=Y["(error)"];return _=Object.create(I),_.error=w,_.type="(error)",_}else throw w.stack=new Error().stack,w},U=function(w,I){if(w&&_.id!==w){var fe;_.id==="(end)"?fe="S0203":fe="S0202";var Re={code:fe,position:_.position,token:_.value,value:w};return K(Re)}var Ye=D(I);if(Ye===null)return _=Y["(end)"],_.position=b.length,_;var We=Ye.value,P=Ye.type,q;switch(P){case"name":case"variable":q=Y["(name)"];break;case"operator":if(q=Y[We],!q)return K({code:"S0204",stack:new Error().stack,position:Ye.position,token:We});break;case"string":case"number":case"value":q=Y["(literal)"];break;case"regex":P="regex",q=Y["(regex)"];break;default:return K({code:"S0205",stack:new Error().stack,position:Ye.position,token:We})}return _=Object.create(q),_.value=We,_.type=P,_.position=Ye.position,_},O=function(w){var I,fe=_;for(U(null,!0),I=fe.nud();w<_.lbp;)fe=_,U(),I=fe.led(I);return I},B=function(w){var I=N(w,0);I.nud=function(){return this}},ee=function(w,I,fe){var Re=I||c[w],Ye=N(w,Re);return Ye.led=fe||function(We){return this.lhs=We,this.rhs=O(Re),this.type="binary",this},Ye},Te=function(w,I,fe){var Re=N(w,I);return Re.led=fe,Re},Pe=function(w,I){var fe=N(w);return fe.nud=I||function(){return this.expression=O(70),this.type="unary",this},fe};B("(end)"),B("(name)"),B("(literal)"),B("(regex)"),N(":"),N(";"),N(","),N(")"),N("]"),N("}"),N(".."),ee("."),ee("+"),ee("-"),ee("*"),ee("/"),ee("%"),ee("="),ee("<"),ee(">"),ee("!="),ee("<="),ee(">="),ee("&"),ee("and"),ee("or"),ee("in"),B("and"),B("or"),B("in"),Pe("-"),ee("~>"),ee("??",c["??"],function(w){return this.type="condition",this.condition={type:"function",value:"(",procedure:{type:"variable",value:"exists"},arguments:[w]},this.then=w,this.else=O(0),this}),Te("(error)",10,function(w){return this.lhs=w,this.error=_.error,this.remaining=xe(),this.type="error",this}),Pe("*",function(){return this.type="wildcard",this}),Pe("**",function(){return this.type="descendant",this}),Pe("%",function(){return this.type="parent",this}),ee("(",c["("],function(w){if(this.procedure=w,this.type="function",this.arguments=[],_.id!==")")for(;_.type==="operator"&&_.id==="?"?(this.type="partial",this.arguments.push(_),U("?")):this.arguments.push(O(0)),_.id===",";)U(",");if(U(")",!0),w.type==="name"&&(w.value==="function"||w.value==="λ")){if(this.arguments.forEach(function(We,P){if(We.type!=="variable")return K({code:"S0208",stack:new Error().stack,position:We.position,token:We.value,value:P+1})}),this.type="lambda",_.id==="<"){for(var I=_.position,fe=1,Re="<";fe>0&&_.id!=="{"&&_.id!=="(end)";){var Ye=U();Ye.id===">"?fe--:Ye.id==="<"&&fe++,Re+=Ye.value}U(">");try{this.signature=o(Re)}catch(We){return We.position=I+We.offset,K(We)}}U("{"),this.body=O(0),U("}")}return this}),Pe("(",function(){for(var w=[];_.id!==")"&&(w.push(O(0)),_.id===";");)U(";");return U(")",!0),this.type="block",this.expressions=w,this}),Pe("[",function(){var w=[];if(_.id!=="]")for(;;){var I=O(0);if(_.id===".."){var fe={type:"binary",value:"..",position:_.position,lhs:I};U(".."),fe.rhs=O(0),I=fe}if(w.push(I),_.id!==",")break;U(",")}return U("]",!0),this.expressions=w,this.type="unary",this}),ee("[",c["["],function(w){if(_.id==="]"){for(var I=w;I&&I.type==="binary"&&I.value==="[";)I=I.lhs;return I.keepArray=!0,U("]"),w}else return this.lhs=w,this.rhs=O(c["]"]),this.type="binary",U("]",!0),this}),ee("^",c["^"],function(w){U("(");for(var I=[];;){var fe={descending:!1};if(_.id==="<"?U("<"):_.id===">"&&(fe.descending=!0,U(">")),fe.expression=O(0),I.push(fe),_.id!==",")break;U(",")}return U(")"),this.lhs=w,this.rhs=I,this.type="binary",this});var he=function(w){var I=[];if(_.id!=="}")for(;;){var fe=O(0);U(":");var Re=O(0);if(I.push([fe,Re]),_.id!==",")break;U(",")}return U("}",!0),typeof w>"u"?(this.lhs=I,this.type="unary"):(this.lhs=w,this.rhs=I,this.type="binary"),this};Pe("{",he),ee("{",c["{"],he),Te(":=",c[":="],function(w){return w.type!=="variable"?K({code:"S0212",stack:new Error().stack,position:w.position,token:w.value}):(this.lhs=w,this.rhs=O(c[":="]-1),this.type="binary",this)}),ee("@",c["@"],function(w){return this.lhs=w,this.rhs=O(c["@"]),this.rhs.type!=="variable"?K({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),ee("#",c["#"],function(w){return this.lhs=w,this.rhs=O(c["#"]),this.rhs.type!=="variable"?K({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),ee("?",c["?"],function(w){return this.type="condition",this.condition=w,this.then=O(0),_.id===":"&&(U(":"),this.else=O(0)),this}),ee("?:",c["?:"],function(w){return this.type="condition",this.condition=w,this.then=w,this.else=O(0),this}),Pe("|",function(){return this.type="transform",this.pattern=O(0),U("|"),this.update=O(0),_.id===","&&(U(","),this.delete=O(0)),U("|"),this});var z=function(w){var I;if(w.type==="function"&&!w.predicate){var fe={type:"lambda",thunk:!0,arguments:[],position:w.position};fe.body=w,I=fe}else if(w.type==="condition")w.then=z(w.then),typeof w.else<"u"&&(w.else=z(w.else)),I=w;else if(w.type==="block"){var Re=w.expressions.length;Re>0&&(w.expressions[Re-1]=z(w.expressions[Re-1])),I=w}else I=w;return I},le=0,ye=0,ke=[],X=function(w,I){switch(w.type){case"name":case"wildcard":I.level--,I.level===0&&(typeof w.ancestor>"u"||(ke[I.index].slot.label=w.ancestor.label),w.ancestor=I,w.tuple=!0);break;case"parent":I.level++;break;case"block":w.expressions.length>0&&(w.tuple=!0,I=X(w.expressions[w.expressions.length-1],I));break;case"path":w.tuple=!0;var fe=w.steps.length-1;for(I=X(w.steps[fe--],I);I.level>0&&fe>=0;)I=X(w.steps[fe--],I);break;default:throw{code:"S0217",token:w.type,position:w.position}}return I},se=function(w,I){if(typeof I.seekingParent<"u"||I.type==="parent"){var fe=typeof I.seekingParent<"u"?I.seekingParent:[];I.type==="parent"&&fe.push(I.slot),typeof w.seekingParent>"u"?w.seekingParent=fe:Array.prototype.push.apply(w.seekingParent,fe)}},me=function(w){var I=w.steps.length-1,fe=w.steps[I],Re=typeof fe.seekingParent<"u"?fe.seekingParent:[];fe.type==="parent"&&Re.push(fe.slot);for(var Ye=0;Ye<Re.length;Ye++){var We=Re[Ye];for(I=w.steps.length-2;We.level>0;){if(I<0){typeof w.seekingParent>"u"?w.seekingParent=[We]:w.seekingParent.push(We);break}for(var P=w.steps[I--];I>=0&&P.focus&&w.steps[I].focus;)P=w.steps[I--];We=X(P,We)}}},Z=function(w){var I;switch(w.type){case"binary":switch(w.value){case".":var fe=Z(w.lhs);fe.type==="path"?I=fe:I={type:"path",steps:[fe]},fe.type==="parent"&&(I.seekingParent=[fe.slot]);var Re=Z(w.rhs);Re.type==="function"&&Re.procedure.type==="path"&&Re.procedure.steps.length===1&&Re.procedure.steps[0].type==="name"&&I.steps[I.steps.length-1].type==="function"&&(I.steps[I.steps.length-1].nextFunction=Re.procedure.steps[0].value),Re.type==="path"?Array.prototype.push.apply(I.steps,Re.steps):(typeof Re.predicate<"u"&&(Re.stages=Re.predicate,delete Re.predicate),I.steps.push(Re)),I.steps.filter(function(ce){if(ce.type==="number"||ce.type==="value")throw{code:"S0213",stack:new Error().stack,position:ce.position,value:ce.value};return ce.type==="string"}).forEach(function(ce){ce.type="name"}),I.steps.filter(function(ce){return ce.keepArray===!0}).length>0&&(I.keepSingletonArray=!0);var Ye=I.steps[0];Ye.type==="unary"&&Ye.value==="["&&(Ye.consarray=!0);var We=I.steps[I.steps.length-1];We.type==="unary"&&We.value==="["&&(We.consarray=!0),me(I);break;case"[":I=Z(w.lhs);var P=I,q="predicate";if(I.type==="path"&&(P=I.steps[I.steps.length-1],q="stages"),typeof P.group<"u")throw{code:"S0209",stack:new Error().stack,position:w.position};typeof P[q]>"u"&&(P[q]=[]);var $=Z(w.rhs);typeof $.seekingParent<"u"&&($.seekingParent.forEach(ce=>{ce.level===1?X(P,ce):ce.level--}),se(P,$)),P[q].push({type:"filter",expr:$,position:w.position});break;case"{":if(I=Z(w.lhs),typeof I.group<"u")throw{code:"S0210",stack:new Error().stack,position:w.position};I.group={lhs:w.rhs.map(function(ce){return[Z(ce[0]),Z(ce[1])]}),position:w.position};break;case"^":I=Z(w.lhs),I.type!=="path"&&(I={type:"path",steps:[I]});var Q={type:"sort",position:w.position};Q.terms=w.rhs.map(function(ce){var we=Z(ce.expression);return se(Q,we),{descending:ce.descending,expression:we}}),I.steps.push(Q),me(I);break;case":=":I={type:"bind",value:w.value,position:w.position},I.lhs=Z(w.lhs),I.rhs=Z(w.rhs),se(I,I.rhs);break;case"@":if(I=Z(w.lhs),P=I,I.type==="path"&&(P=I.steps[I.steps.length-1]),typeof P.stages<"u"||typeof P.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:w.position};if(P.type==="sort")throw{code:"S0216",stack:new Error().stack,position:w.position};w.keepArray&&(P.keepArray=!0),P.focus=w.rhs.value,P.tuple=!0;break;case"#":I=Z(w.lhs),P=I,I.type==="path"?P=I.steps[I.steps.length-1]:(I={type:"path",steps:[I]},typeof P.predicate<"u"&&(P.stages=P.predicate,delete P.predicate)),typeof P.stages>"u"?P.index=w.rhs.value:P.stages.push({type:"index",value:w.rhs.value,position:w.position}),P.tuple=!0;break;case"~>":I={type:"apply",value:w.value,position:w.position},I.lhs=Z(w.lhs),I.rhs=Z(w.rhs),I.keepArray=I.lhs.keepArray||I.rhs.keepArray;break;default:I={type:w.type,value:w.value,position:w.position},I.lhs=Z(w.lhs),I.rhs=Z(w.rhs),se(I,I.lhs),se(I,I.rhs)}break;case"unary":I={type:w.type,value:w.value,position:w.position},w.value==="["?I.expressions=w.expressions.map(function(ce){var we=Z(ce);return se(I,we),we}):w.value==="{"?I.lhs=w.lhs.map(function(ce){var we=Z(ce[0]);se(I,we);var qe=Z(ce[1]);return se(I,qe),[we,qe]}):(I.expression=Z(w.expression),w.value==="-"&&I.expression.type==="number"?(I=I.expression,I.value=-I.value):se(I,I.expression));break;case"function":case"partial":I={type:w.type,name:w.name,value:w.value,position:w.position},I.arguments=w.arguments.map(function(ce){var we=Z(ce);return se(I,we),we}),I.procedure=Z(w.procedure);break;case"lambda":I={type:w.type,arguments:w.arguments,signature:w.signature,position:w.position};var ue=Z(w.body);I.body=z(ue);break;case"condition":I={type:w.type,position:w.position},I.condition=Z(w.condition),se(I,I.condition),I.then=Z(w.then),se(I,I.then),typeof w.else<"u"&&(I.else=Z(w.else),se(I,I.else));break;case"transform":I={type:w.type,position:w.position},I.pattern=Z(w.pattern),I.update=Z(w.update),typeof w.delete<"u"&&(I.delete=Z(w.delete));break;case"block":I={type:w.type,position:w.position},I.expressions=w.expressions.map(function(ce){var we=Z(ce);return se(I,we),(we.consarray||we.type==="path"&&we.steps[0].consarray)&&(I.consarray=!0),we});break;case"name":I={type:"path",steps:[w]},w.keepArray&&(I.keepSingletonArray=!0);break;case"parent":I={type:"parent",slot:{label:"!"+le++,level:1,index:ye++}},ke.push(I);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":I=w;break;case"operator":if(w.value==="and"||w.value==="or"||w.value==="in")w.type="name",I=Z(w);else if(w.value==="?")I=w;else throw{code:"S0201",stack:new Error().stack,position:w.position,token:w.value};break;case"error":I=w,w.lhs&&(I=Z(w.lhs));break;default:var ae="S0206";w.id==="(end)"&&(ae="S0207");var V={code:ae,position:w.position,token:w.value};if(x)return ve.push(V),{type:"error",error:V};throw V.stack=new Error().stack,V}return w.keepArray&&(I.keepArray=!0),I};D=y(b),U();var Ce=O(0);if(_.id!=="(end)"){var Ne={code:"S0201",position:_.position,token:_.value};K(Ne)}if(Ce=Z(Ce),Ce.type==="parent"||typeof Ce.seekingParent<"u")throw{code:"S0217",token:Ce.type,position:Ce.position};return ve.length>0&&(Ce.errors=ve),Ce};return R})();n.exports=a},{"./signature":5}],5:[function(t,n,i){var o=t("./utils");const a=(()=>{var c={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function f(y){for(var R=1,b=[],x={},_=x;R<y.length;){var D=y.charAt(R);if(D===":")break;var Y=function(){b.push(x),_=x,x={}},ve=function(ee,Te,Pe,he){for(var z=1,le=Te;le<ee.length;)if(le++,D=ee.charAt(le),D===he){if(z--,z===0)break}else D===Pe&&z++;return le};switch(D){case"s":case"n":case"b":case"l":case"o":x.regex="["+D+"m]",x.type=D,Y();break;case"a":x.regex="[asnblfom]",x.type=D,x.array=!0,Y();break;case"f":x.regex="f",x.type=D,Y();break;case"j":x.regex="[asnblom]",x.type=D,Y();break;case"x":x.regex="[asnblfom]",x.type=D,Y();break;case"-":_.context=!0,_.contextRegex=new RegExp(_.regex),_.regex+="?";break;case"?":case"+":_.regex+=D;break;case"(":var xe=ve(y,R,"(",")"),W=y.substring(R+1,xe);if(W.indexOf("<")===-1)x.regex="["+W+"m]";else throw{code:"S0402",stack:new Error().stack,value:W,offset:R};x.type="("+W+")",R=xe,Y();break;case"<":if(_.type==="a"||_.type==="f"){var N=ve(y,R,"<",">");_.subtype=y.substring(R+1,N),R=N}else throw{code:"S0401",stack:new Error().stack,value:_.type,offset:R};break}R++}var K="^"+b.map(function(ee){return"("+ee.regex+")"}).join("")+"$",U=new RegExp(K),O=function(ee){var Te;if(o.isFunction(ee))Te="f";else{var Pe=typeof ee;switch(Pe){case"string":Te="s";break;case"number":Te="n";break;case"boolean":Te="b";break;case"object":ee===null?Te="l":Array.isArray(ee)?Te="a":Te="o";break;case"undefined":default:Te="m"}}return Te},B=function(ee,Te){for(var Pe="^",he=0,z=0;z<b.length;z++){Pe+=b[z].regex;var le=Te.match(Pe);if(le===null)throw{code:"T0410",stack:new Error().stack,value:ee[he],index:he+1};he=le[0].length}throw{code:"T0410",stack:new Error().stack,value:ee[he],index:he+1}};return{definition:y,validate:function(ee,Te){var Pe="";ee.forEach(function(ye){Pe+=O(ye)});var he=U.exec(Pe);if(he){var z=[],le=0;return b.forEach(function(ye,ke){var X=ee[le],se=he[ke+1];if(se==="")if(ye.context&&ye.contextRegex){var me=O(Te);if(ye.contextRegex.test(me))z.push(Te);else throw{code:"T0411",stack:new Error().stack,value:Te,index:le+1}}else z.push(X),le++;else se.split("").forEach(function(Z){if(ye.type==="a"){if(Z==="m")X=void 0;else{X=ee[le];var Ce=!0;if(typeof ye.subtype<"u"){if(Z!=="a"&&se!==ye.subtype)Ce=!1;else if(Z==="a"&&X.length>0){var Ne=O(X[0]);if(Ne!==ye.subtype.charAt(0))Ce=!1;else{var w=X.filter(function(I){return O(I)!==Ne});Ce=w.length===0}}}if(!Ce)throw{code:"T0412",stack:new Error().stack,value:X,index:le+1,type:c[ye.subtype]};Z!=="a"&&(X=[X])}z.push(X),le++}else z.push(X),le++})}),z}B(ee,Pe)}}}return f})();n.exports=a},{"./utils":6}],6:[function(t,n,i){const o=(()=>{function a(N){var K=!1;if(typeof N=="number"&&(K=!isNaN(N),K&&!isFinite(N)))throw{code:"D1001",value:N,stack:new Error().stack};return K}function c(N){var K=!1;return Array.isArray(N)&&(K=N.filter(function(U){return typeof U!="string"}).length===0),K}function f(N){var K=!1;return Array.isArray(N)&&(K=N.filter(function(U){return!a(U)}).length===0),K}function y(){var N=[];return N.sequence=!0,arguments.length===1&&N.push(arguments[0]),N}function R(N){return N.sequence===!0&&Array.isArray(N)}function b(N){return N&&(N._jsonata_function===!0||N._jsonata_lambda===!0)||typeof N=="function"}function x(N){var K=typeof N.arity=="number"?N.arity:typeof N.implementation=="function"?N.implementation.length:typeof N.length=="number"?N.length:N.arguments.length;return K}function _(N){return N&&N._jsonata_lambda===!0}var D=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function Y(N){return typeof N=="object"&&N!==null&&D in N&&"next"in N&&typeof N.next=="function"}function ve(N,K){if(N===K)return!0;if(typeof N=="object"&&typeof K=="object"&&N!==null&&K!==null){if(Array.isArray(N)&&Array.isArray(K)){if(N.length!==K.length)return!1;for(var U=0;U<N.length;U++)if(!ve(N[U],K[U]))return!1;return!0}var O=Object.getOwnPropertyNames(N),B=Object.getOwnPropertyNames(K);if(O.length!==B.length)return!1;for(O=O.sort(),B=B.sort(),U=0;U<O.length;U++)if(O[U]!==B[U])return!1;for(U=0;U<O.length;U++){var ee=O[U];if(!ve(N[ee],K[ee]))return!1}return!0}return!1}function xe(N){return typeof N=="object"&&N!==null&&"then"in N&&typeof N.then=="function"}function W(N){var K=[];for(let U of N)K.push(U);return K}return{isNumeric:a,isArrayOfStrings:c,isArrayOfNumbers:f,createSequence:y,isSequence:R,isFunction:b,isLambda:_,isIterable:Y,getFunctionArity:x,isDeepEqual:ve,stringToArray:W,isPromise:xe}})();n.exports=o},{}]},{},[3])(3)})})(Ui)),Ui.exports}var vp=gp();const vo=xi(vp);var fr={exports:{}};const ri=jo(Wo),yp="17.2.3",bp={version:yp};var la;function wp(){if(la)return fr.exports;la=1;var r={};const e=ri,t=ri,n=ri,i=ri,a=bp.version,c=["🔐 encrypt with Dotenvx: https://dotenvx.com","🔐 prevent committing .env to code: https://dotenvx.com/precommit","🔐 prevent building .env in docker: https://dotenvx.com/prebuild","📡 add observability to secrets: https://dotenvx.com/ops","👥 sync secrets across teammates & machines: https://dotenvx.com/ops","🗂️ backup and recover secrets: https://dotenvx.com/ops","✅ audit secrets and track compliance: https://dotenvx.com/ops","🔄 add secrets lifecycle management: https://dotenvx.com/ops","🔑 add access controls to secrets: https://dotenvx.com/ops","🛠️  run anywhere with `dotenvx run -- yourcommand`","⚙️  specify custom .env file path with { path: '/custom/path/.env' }","⚙️  enable debug logging with { debug: true }","⚙️  override existing env vars with { override: true }","⚙️  suppress all logs with { quiet: true }","⚙️  write to custom object with { processEnv: myObject }","⚙️  load multiple .env files with { path: ['.env.local', '.env'] }"];function f(){return c[Math.floor(Math.random()*c.length)]}function y(z){return typeof z=="string"?!["false","0","no","off",""].includes(z.toLowerCase()):!!z}function R(){return process.stdout.isTTY}function b(z){return R()?`\x1B[2m${z}\x1B[0m`:z}const x=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function _(z){const le={};let ye=z.toString();ye=ye.replace(/\r\n?/mg,`
`);let ke;for(;(ke=x.exec(ye))!=null;){const X=ke[1];let se=ke[2]||"";se=se.trim();const me=se[0];se=se.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),me==='"'&&(se=se.replace(/\\n/g,`
`),se=se.replace(/\\r/g,"\r")),le[X]=se}return le}function D(z){z=z||{};const le=K(z);z.path=le;const ye=he.configDotenv(z);if(!ye.parsed){const me=new Error(`MISSING_DATA: Cannot parse ${le} for an unknown reason`);throw me.code="MISSING_DATA",me}const ke=W(z).split(","),X=ke.length;let se;for(let me=0;me<X;me++)try{const Z=ke[me].trim(),Ce=N(ye,Z);se=he.decrypt(Ce.ciphertext,Ce.key);break}catch(Z){if(me+1>=X)throw Z}return he.parse(se)}function Y(z){console.error(`[dotenv@${a}][WARN] ${z}`)}function ve(z){console.log(`[dotenv@${a}][DEBUG] ${z}`)}function xe(z){console.log(`[dotenv@${a}] ${z}`)}function W(z){return z&&z.DOTENV_KEY&&z.DOTENV_KEY.length>0?z.DOTENV_KEY:r.DOTENV_KEY&&r.DOTENV_KEY.length>0?r.DOTENV_KEY:""}function N(z,le){let ye;try{ye=new URL(le)}catch(Z){if(Z.code==="ERR_INVALID_URL"){const Ce=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw Ce.code="INVALID_DOTENV_KEY",Ce}throw Z}const ke=ye.password;if(!ke){const Z=new Error("INVALID_DOTENV_KEY: Missing key part");throw Z.code="INVALID_DOTENV_KEY",Z}const X=ye.searchParams.get("environment");if(!X){const Z=new Error("INVALID_DOTENV_KEY: Missing environment part");throw Z.code="INVALID_DOTENV_KEY",Z}const se=`DOTENV_VAULT_${X.toUpperCase()}`,me=z.parsed[se];if(!me){const Z=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${se} in your .env.vault file.`);throw Z.code="NOT_FOUND_DOTENV_ENVIRONMENT",Z}return{ciphertext:me,key:ke}}function K(z){let le=null;if(z&&z.path&&z.path.length>0)if(Array.isArray(z.path))for(const ye of z.path)e.existsSync(ye)&&(le=ye.endsWith(".vault")?ye:`${ye}.vault`);else le=z.path.endsWith(".vault")?z.path:`${z.path}.vault`;else le=t.resolve(process.cwd(),".env.vault");return e.existsSync(le)?le:null}function U(z){return z[0]==="~"?t.join(n.homedir(),z.slice(1)):z}function O(z){const le=y(r.DOTENV_CONFIG_DEBUG||z&&z.debug),ye=y(r.DOTENV_CONFIG_QUIET||z&&z.quiet);(le||!ye)&&xe("Loading env from encrypted .env.vault");const ke=he._parseVault(z);let X=r;return z&&z.processEnv!=null&&(X=z.processEnv),he.populate(X,ke,z),{parsed:ke}}function B(z){const le=t.resolve(process.cwd(),".env");let ye="utf8",ke=r;z&&z.processEnv!=null&&(ke=z.processEnv);let X=y(ke.DOTENV_CONFIG_DEBUG||z&&z.debug),se=y(ke.DOTENV_CONFIG_QUIET||z&&z.quiet);z&&z.encoding?ye=z.encoding:X&&ve("No encoding is specified. UTF-8 is used by default");let me=[le];if(z&&z.path)if(!Array.isArray(z.path))me=[U(z.path)];else{me=[];for(const w of z.path)me.push(U(w))}let Z;const Ce={};for(const w of me)try{const I=he.parse(e.readFileSync(w,{encoding:ye}));he.populate(Ce,I,z)}catch(I){X&&ve(`Failed to load ${w} ${I.message}`),Z=I}const Ne=he.populate(ke,Ce,z);if(X=y(ke.DOTENV_CONFIG_DEBUG||X),se=y(ke.DOTENV_CONFIG_QUIET||se),X||!se){const w=Object.keys(Ne).length,I=[];for(const fe of me)try{const Re=t.relative(process.cwd(),fe);I.push(Re)}catch(Re){X&&ve(`Failed to load ${fe} ${Re.message}`),Z=Re}xe(`injecting env (${w}) from ${I.join(",")} ${b(`-- tip: ${f()}`)}`)}return Z?{parsed:Ce,error:Z}:{parsed:Ce}}function ee(z){if(W(z).length===0)return he.configDotenv(z);const le=K(z);return le?he._configVault(z):(Y(`You set DOTENV_KEY but you are missing a .env.vault file at ${le}. Did you forget to build it?`),he.configDotenv(z))}function Te(z,le){const ye=Buffer.from(le.slice(-64),"hex");let ke=Buffer.from(z,"base64");const X=ke.subarray(0,12),se=ke.subarray(-16);ke=ke.subarray(12,-16);try{const me=i.createDecipheriv("aes-256-gcm",ye,X);return me.setAuthTag(se),`${me.update(ke)}${me.final()}`}catch(me){const Z=me instanceof RangeError,Ce=me.message==="Invalid key length",Ne=me.message==="Unsupported state or unable to authenticate data";if(Z||Ce){const w=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw w.code="INVALID_DOTENV_KEY",w}else if(Ne){const w=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw w.code="DECRYPTION_FAILED",w}else throw me}}function Pe(z,le,ye={}){const ke=!!(ye&&ye.debug),X=!!(ye&&ye.override),se={};if(typeof le!="object"){const me=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw me.code="OBJECT_REQUIRED",me}for(const me of Object.keys(le))Object.prototype.hasOwnProperty.call(z,me)?(X===!0&&(z[me]=le[me],se[me]=le[me]),ke&&ve(X===!0?`"${me}" is already defined and WAS overwritten`:`"${me}" is already defined and was NOT overwritten`)):(z[me]=le[me],se[me]=le[me]);return se}const he={configDotenv:B,_configVault:O,_parseVault:D,config:ee,decrypt:Te,parse:_,populate:Pe};return fr.exports.configDotenv=he.configDotenv,fr.exports._configVault=he._configVault,fr.exports._parseVault=he._parseVault,fr.exports.config=he.config,fr.exports.decrypt=he.decrypt,fr.exports.parse=he.parse,fr.exports.populate=he.populate,fr.exports=he,fr.exports}var xp=wp();const yo={".geojson":pr.GeoJSON,".json":pr.GeoJSON,".kml":pr.KML,".gpx":pr.GPX,".tif":pr.GeoTIFF,".tiff":pr.GeoTIFF,".geotiff":pr.GeoTIFF},Is=r=>{const e=r.getName().toLowerCase();for(const[t,n]of Object.entries(yo))if(e.endsWith(t))return n;return null},bo=r=>Is(r)!==null,bi=async r=>{const e=await Dt.getWorkspace();if(!e)throw new Error("No workspace available");const t=await e.getResource(r);if(!t)throw new Error("Invalid URL: "+r);return await t.getContents({uri:!0})},wo=r=>r.startsWith("blob:")||r.startsWith("http:")||r.startsWith("https:"),Oi={},sn=async(r,e,t)=>{const n=await vo(`[**[${e}!='']]`).evaluate(r);for(const i of n){const o=i[e];if(wo(o))continue;let a;if(e==="src"&&t)try{a=(await t.resolveWorkspaceModule(o)).blobUrl}catch{a=await bi(o)}else a=await bi(o);Oi[a]=i[e],i[e]=a}},Ln=r=>Oi[r],$n=async(r,e)=>{const t=await vo(`[**[${e}!='']]`).evaluate(r);for(const n of t){const i=n[e];!i||!i.startsWith("blob:")||(n[e]=Oi[i])}},xo=r=>{Me.registerContribution("catalog.root",{label:r.label,icon:r.icon,contributionId:r.contributionId});const e=r.contributionId??r.label;r.items?.forEach(t=>{Me.registerContribution(e,{label:t.label,icon:t.icon,contributionId:t.contributionId});const i=import.meta.resolve("/.");t.items.forEach(o=>{const a={label:o.label,icon:o.icon,state:{...o.state}};a.state?.url&&(a.state.url=a.state.url.replace("${baseURL}/",i)),Me.registerContribution(t.contributionId,a)})})},es=r=>{Object.entries(r).forEach(([e,t])=>{const n=/\${([a-zA-Z0-9_]+)}/g;r[e]=t.replace(n,(i,o)=>{const a=r[o];return a!==void 0?a:i})})},ko=async(...r)=>{const e=await Dt.getWorkspace(),t={};for(const n of r){const i=await e?.getResource(n);if(!i)continue;const o=await i.getContents(),a=xp.parse(o||"");es(a),Object.assign(t,a)}return es(t),t},kp=Object.freeze(Object.defineProperty({__proto__:null,FILE_EXTENSION_TO_SOURCE_TYPE:yo,_blobsLookup:Oi,getOriginalUri:Ln,getSourceTypeFromFile:Is,isAbsoluteResource:wo,isSupportedSpatialFile:bo,loadEnvs:ko,registerCatalog:xo,replaceUris:sn,replaceVars:es,revertBlobUris:$n,toBlobUri:bi},Symbol.toStringTag,{value:"Module"}));Bo.resolveUrl=r=>bi(r);$r.registerEditorInputHandler({canHandle:r=>r instanceof sr&&r.getName().endsWith(".geospace"),handle:async r=>{const e={title:r.getName(),data:r,key:r.getName(),editorId:"map-editor",icon:"location-dot",state:{}};return e.widgetFactory=t=>G`
            <gs-map id="${t}" .input="${e}"></gs-map>`,e}});const Ip=da(class extends ha{constructor(){super(...arguments),this.key=kt}render(r,e){return this.key=r,e}update(r,[e,t]){return e!==this.key&&(fa(r),this.key=e),t}});function ln(r,e){return r.layers.find(t=>t.uuid===e)}function cn(r,e){return r.layers.findIndex(t=>t.uuid===e)}function Sp(r,e){return r.controls.findIndex(t=>t.uuid===e)}function _p(r,e){return r.overlays.findIndex(t=>t.uuid===e)}const Cp=r=>new Proxy({},{get:(e,t)=>async(...n)=>{for(const i of r)await i[t](...n)}});var nr=(r=>(r[r.LOADED=0]="LOADED",r[r.LAYER_ADDED=1]="LAYER_ADDED",r[r.LAYER_DELETED=2]="LAYER_DELETED",r[r.LAYER_UPDATED=3]="LAYER_UPDATED",r[r.FEATURE_SELECTED=4]="FEATURE_SELECTED",r))(nr||{});const gr=Kr(Ml),Ep=`:root,
:host {
  --ol-background-color: white;
  --ol-accent-background-color: #F5F5F5;
  --ol-subtle-background-color: rgba(128, 128, 128, 0.25);
  --ol-partial-background-color: rgba(255, 255, 255, 0.75);
  --ol-foreground-color: #333333;
  --ol-subtle-foreground-color: #666666;
  --ol-brand-color: #00AAFF;
}

.ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.ol-scale-bar-inner {
  display: flex;
}

.ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);
}

.ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow: -1.5px 0 var(--ol-partial-background-color), 0 1.5px var(--ol-partial-background-color), 1.5px 0 var(--ol-partial-background-color), 0 -1.5px var(--ol-partial-background-color);
}

.ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.ol-unsupported {
  display: none;
}

.ol-viewport,
.ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.ol-viewport canvas {
  all: unset;
  overflow: hidden;
}

.ol-viewport {
  touch-action: pan-x pan-y;
}

.ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.ol-zoom {
  top: .5em;
  left: .5em;
}

.ol-rotate {
  top: .5em;
  right: .5em;
  transition: opacity .25s linear, visibility 0s linear;
}

.ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition: opacity .25s linear, visibility 0s linear .25s;
}

.ol-zoom-extent {
  top: 4.643em;
  left: .5em;
}

.ol-full-screen {
  right: .5em;
  top: .5em;
}

.ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: .4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.ol-zoom-extent button {
  line-height: 1.4em;
}

.ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.ol-touch .ol-control button {
  font-size: 1.5em;
}

.ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.ol-control button:hover,
.ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.ol-attribution {
  text-align: right;
  bottom: .5em;
  right: .5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.ol-attribution ul {
  margin: 0;
  padding: 1px .5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.ol-attribution li {
  display: inline;
  list-style: none;
}

.ol-attribution li:not(:last-child):after {
  content: " ";
}

.ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.ol-attribution button {
  flex-shrink: 0;
}

.ol-attribution.ol-collapsed ul {
  display: none;
}

.ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.ol-attribution.ol-uncollapsible img {
  margin-top: -.2em;
  max-height: 1.6em;
}

.ol-attribution.ol-uncollapsible button {
  display: none;
}

.ol-zoomslider {
  top: 4.5em;
  left: .5em;
  height: 200px;
}

.ol-zoomslider button {
  position: relative;
  height: 10px;
}

.ol-touch .ol-zoomslider {
  top: 5.5em;
}

.ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.ol-overviewmap .ol-overviewmap-map,
.ol-overviewmap button {
  display: block;
}

.ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.ol-overviewmap-box {
  border: 1.5px dotted var(--ol-subtle-foreground-color);
}

.ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

.ol-overviewmap .ol-viewport:hover {
  cursor: pointer;
}
`;function Ap(r){return r.startsWith("blob:")||r.startsWith("http:")||r.startsWith("https:")}function ca(r,e){if(r.startsWith("/"))return r.slice(1);const t=e.split("/").filter(o=>o),n=r.split("/").filter(o=>o);if(r.startsWith("./")||r.startsWith("../")||!r.startsWith("/")){const o=t.slice(0,-1);t.length=0,t.push(...o)}for(const o of n)o!=="."&&(o===".."?t.length>0&&t.pop():t.push(o));return t.join("/")}function Tp(r){const e=[],t=/import\s+(?:type\s+)?(?:[\w*{}\s,]+?\s+from\s+)?["']([^"']+)["']/g,n=/export\s+(?:type\s+)?(?:[\w*{}\s,]+?\s+from\s+)?["']([^"']+)["']/g,i=/import\s*\(\s*["']([^"']+)["']\s*\)/g;let o;for(;(o=t.exec(r))!==null;)e.push({fullMatch:o[0],importPath:o[1],isDynamic:!1,startIndex:o.index,endIndex:o.index+o[0].length});for(;(o=n.exec(r))!==null;)e.push({fullMatch:o[0],importPath:o[1],isDynamic:!1,startIndex:o.index,endIndex:o.index+o[0].length});for(;(o=i.exec(r))!==null;)e.push({fullMatch:o[0],importPath:o[1],isDynamic:!0,startIndex:o.index,endIndex:o.index+o[0].length});return e.sort((a,c)=>c.startIndex-a.startIndex)}class Op{constructor(){this.blobUrlCache=new Map,this.moduleCache=new Map,this.resolvingModules=new Set,this.resolvingPromises=new Map}async resolveModuleRecursive(e){if(!await Dt.getWorkspace())throw new Error("Workspace not available");if(this.blobUrlCache.has(e))return this.blobUrlCache.get(e);if(this.resolvingPromises.has(e))return await this.resolvingPromises.get(e);if(this.resolvingModules.has(e))throw new Error(`Circular dependency detected: ${e}`);this.resolvingModules.add(e);const n=this.doResolveModule(e);this.resolvingPromises.set(e,n);try{return await n}finally{this.resolvingPromises.delete(e)}}async doResolveModule(e){const t=await Dt.getWorkspace();if(!t)throw new Error("Workspace not available");try{let n=await t.getResource(e);if(n||(await t.listChildren(!0),n=await t.getResource(e)),!n)throw new Error(`Module not found: ${e}`);let i=await n.getContents();const o=Tp(i);for(const f of o){const y=f.importPath;if(!Ap(y))try{const R=ca(y,e),b=await this.resolveModuleRecursive(R);let x;if(f.isDynamic)x=`import("${b}")`;else{const _=f.fullMatch.search(/["']/);if(_===-1)x=f.fullMatch;else{const D=f.fullMatch[_],Y=f.fullMatch.lastIndexOf(D);Y!==-1&&Y>_?x=f.fullMatch.slice(0,_+1)+b+f.fullMatch.slice(Y):x=f.fullMatch}}i=i.slice(0,f.startIndex)+x+i.slice(f.endIndex)}catch{}}const a=new Blob([i],{type:"application/javascript"}),c=URL.createObjectURL(a);return this.blobUrlCache.set(e,c),this.moduleCache.set(e,{code:i,workspacePath:e,blobUrl:c}),c}catch(n){throw n}finally{this.resolvingModules.delete(e)}}async resolveWorkspaceModule(e,t){const n=t?ca(e,t):e;if(this.moduleCache.has(n))return this.moduleCache.get(n);await this.resolveModuleRecursive(n);const i=this.moduleCache.get(n);if(!i)throw new Error(`Failed to resolve module: ${n}`);return i}clear(){for(const e of this.blobUrlCache.values())e.startsWith("blob:")&&URL.revokeObjectURL(e);this.blobUrlCache.clear(),this.moduleCache.clear(),this.resolvingModules.clear()}}const Rp="iframe-map-renderer.html";class Pp{constructor(e,t){this.messageId=0,this.pendingMessages=new Map,this.isMobileView=!1,this.gsMap=e,this.env=t,this.operations=this.createProxy(this)}createProxy(e){return new Proxy({},{get(t,n){return async(...i)=>await e.sendMessage(n,{...i})}})}async reattached(){if(!this.targetElement){console.warn("No target element stored, cannot reattach");return}this.iframe&&this.iframe.parentElement&&this.iframe.remove(),await this.render(this.targetElement)}async render(e){if(this.iframe=document.createElement("iframe"),this.iframe.style.overflow="hidden",this.updateIframeStyles(),this.iframe.src=Rp,this.targetElement=typeof e=="string"?document.querySelector(e):e,!this.targetElement)throw new Error("Container element not found");this.targetElement.innerHTML="",this.targetElement.appendChild(this.iframe),await this.waitRendererReady(),this.setupMessageListener(),await this.sendMessage("render",{gsMap:this.gsMap,env:this.env})}async modelToUI(e){await this.sendMessage("modelToUI",e??this.gsMap)}getOperations(){return this.operations}async getViewExtent(){return(await this.sendMessage("getViewExtent",{}))?.extent||[0,0,0,0]}setOnDirty(e){this.onDirtyCallback=e}triggerDirty(){this.onDirtyCallback&&this.onDirtyCallback()}setOnSync(e){this.onSyncCallback=e}setOnClick(e){this.onClickCallback=e}triggerSync(e){this.onSyncCallback&&this.onSyncCallback(e)}toggleMobileView(){this.isMobileView=!this.isMobileView,this.updateIframeStyles()}isInMobileView(){return this.isMobileView}updateIframeStyles(){this.iframe&&(this.isMobileView?(this.iframe.style.width="375px",this.iframe.style.height="667px",this.iframe.style.border="2px solid rgb(168, 168, 168)",this.iframe.style.borderRadius="20px",this.iframe.style.boxShadow="0 0 20px rgba(0, 0, 0, 0.51)",this.iframe.style.margin="20px auto",this.iframe.style.display="block"):(this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.border="none",this.iframe.style.borderRadius="0",this.iframe.style.boxShadow="none",this.iframe.style.margin="0"))}async handleAssetResolution(e,t){try{const{toBlobUri:n}=await mt(async()=>{const{toBlobUri:o}=await Promise.resolve().then(()=>kp);return{toBlobUri:o}},void 0),i=await n(t);this.iframe.contentWindow.postMessage({id:e,success:!0,assetUrl:i},"*")}catch(n){this.iframe.contentWindow.postMessage({id:e,success:!1,error:n instanceof Error?n.message:"Unknown error"},"*")}}destroy(){this.messageListener&&(window.removeEventListener("message",this.messageListener),this.messageListener=void 0),this.iframe&&(this.iframe.remove(),this.iframe=void 0),this.pendingMessages.clear()}setupMessageListener(){this.messageListener=e=>{if(e.source!==this.iframe?.contentWindow)return;const{id:t,result:n,error:i,type:o,event:a}=e.data;if(t!==void 0&&this.pendingMessages.has(t)){const{resolve:c,reject:f}=this.pendingMessages.get(t);if(this.pendingMessages.delete(t),i)f(new Error(i));else{const y=n??Object.fromEntries(Object.entries(e.data).filter(([R])=>!["id","type","event","error"].includes(R)));c(y)}}o==="dirty"?this.onDirtyCallback?.():o==="sync"?this.onSyncCallback?.(a):o==="iframeClicked"?this.onClickCallback?.():o==="resolveAsset"&&this.handleAssetResolution(t,e.data.path)},window.addEventListener("message",this.messageListener)}async waitRendererReady(){return new Promise(e=>{const t=n=>{n.source===this.iframe?.contentWindow&&n.data.type==="rendererReady"&&(window.removeEventListener("message",t),e())};window.addEventListener("message",t)})}async sendMessage(e,t){if(!this.iframe)throw new Error("Iframe not initialized");const n=++this.messageId;return new Promise((i,o)=>{this.pendingMessages.set(n,{resolve:i,reject:o}),this.iframe.contentWindow.postMessage({id:n,method:e,params:t},"*"),setTimeout(()=>{this.pendingMessages.has(n)&&(this.pendingMessages.delete(n),o(new Error("Message timeout")))},5e3)})}}class Lp{constructor(e,t){this.gsMap=e,this.renderer=t}triggerDirty(){this.renderer.triggerDirty()}async setZoom(e){this.gsMap.view.zoom=e,this.triggerDirty()}async setCenter(e){this.gsMap.view.center=e,this.triggerDirty()}async switchColorMode(e){this.gsMap.view.colorMode=e,this.triggerDirty()}async addLayer(e,t){t?this.gsMap.layers.unshift(e):this.gsMap.layers.push(e),this.triggerDirty()}async deleteLayer(e){const t=cn(this.gsMap,e);t>=0&&(this.gsMap.layers.splice(t,1),this.triggerDirty())}async renameLayer(e,t){const n=ln(this.gsMap,e);n&&(n.name=t,this.triggerDirty())}async moveLayer(e,t){const n=cn(this.gsMap,e);if(n<0)return;let i;if(t){if(i=cn(this.gsMap,t),i<0||n===i)return}else i=n>0?n-1:n+1;if(i>=0&&i<this.gsMap.layers.length&&n!==i){const[o]=this.gsMap.layers.splice(n,1);this.gsMap.layers.splice(i,0,o),this.triggerDirty()}}async setLayerVisible(e,t){const n=ln(this.gsMap,e);n&&(n.visible=t,this.triggerDirty())}async addControlFromModule(e){this.gsMap.controls.push({src:e,type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeControl(e){const t=Sp(this.gsMap,e);t>=0&&(this.gsMap.controls.splice(t,1),this.triggerDirty(),await this.renderer.modelToUI())}async addOverlayFromModule(e,t){this.gsMap.overlays.push({src:e,position:t||"bottom-left",type:"module"}),this.triggerDirty(),await this.renderer.modelToUI()}async removeOverlay(e){const t=_p(this.gsMap,e);t>=0&&(this.gsMap.overlays.splice(t,1),this.triggerDirty(),await this.renderer.modelToUI())}async enableDrawing(e,t){}async disableDrawing(){}async enableFeatureSelection(){}async disableSelection(){}async deleteSelectedFeatures(){this.triggerDirty()}}class $p{constructor(e){this.source=e}async setZoom(e){}async setCenter(e){}async switchColorMode(e){}async addLayer(e,t){gr.set({part:this.source,event:nr.LAYER_ADDED})}async deleteLayer(e){gr.set({part:this.source,event:nr.LAYER_DELETED})}async renameLayer(e,t){gr.set({part:this.source,event:nr.LAYER_UPDATED})}async moveLayer(e,t){gr.set({part:this.source,event:nr.LAYER_UPDATED})}async setLayerVisible(e,t){}async addControlFromModule(e){}async removeControl(e){}async addOverlayFromModule(e,t){}async removeOverlay(e){}async enableDrawing(e,t){}async disableDrawing(){}async enableFeatureSelection(){}async disableSelection(){}async deleteSelectedFeatures(){gr.set({part:this.source,event:nr.LAYER_UPDATED})}}var Dp=Object.defineProperty,Np=Object.getOwnPropertyDescriptor,Ri=(r,e,t,n)=>{for(var i=n>1?void 0:n?Np(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Dp(e,t,i),i};const Mp=Hr("GsMapEditor");let Nt=class extends jt{constructor(){super(),this.mapContainer=yr(),this.isFirstConnection=!0,this.moduleResolver=new Op,this.interactionMode="none",this.commandStack=new _a}getRenderer(){return this.renderer}getOperations(){return this.operations}doBeforeUI(){this.watch(gr,({part:r,event:e})=>{this.onMapChanged({part:r,event:e})})}onMapChanged({part:r,event:e}){r===this&&(e===nr.LAYER_ADDED||e===nr.LAYER_DELETED||e===nr.LAYER_UPDATED)&&this.updateToolbar()}renderToolbar(){const e=this.getGsMap()?.layers.filter(n=>{const i=n.type===Rs.VECTOR,o=n.source?.type===pr.Features;return i&&o})||[],t=this.activeDrawingLayerUuid!==void 0;return G`
            <k-command cmd="zoom_in" icon="magnifying-glass-plus" title="Zoom in"></k-command>
            <k-command cmd="zoom_out" icon="magnifying-glass-minus" title="Zoom out"></k-command>
            <k-command cmd="reset_view" icon="house" title="Reset view"></k-command>
            <k-command cmd="refresh_map" icon="rotate" title="Refresh map"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command cmd="toggle_color_mode" icon="circle-half-stroke" title="Toggle dark/light mode"></k-command>
            <k-command cmd="toggle_mobile_view" icon="mobile" title="Toggle mobile view"></k-command>
            
            <wa-divider orientation="vertical"></wa-divider>
            
            <k-command icon="plus" 
                      title="Create Drawing Layer"
                      .action=${()=>this.handleCreateDrawingLayer()}>
            </k-command>
            
            ${Ut(e.length>0,()=>{const n=e.map(i=>`${i.uuid}:${i.name}`).join("|");return G`
                ${Ip(n,G`
                    <wa-select 
                        placeholder="Drawing layer"
                        size="small"
                        value="${this.activeDrawingLayerUuid??""}"
                        @change=${i=>{const o=i.target.value||void 0;this.activeDrawingLayerUuid=o,(o===void 0||i.target.value==="")&&(this.operations?.disableDrawing(),this.interactionMode="none"),this.updateToolbar()}}>
                        <wa-option value="">Select layer</wa-option>
                        ${e.map(i=>G`
                            <wa-option value="${i.uuid}">${i.name||"Layer"}</wa-option>
                        `)}
                    </wa-select>
                `)}
                
                <k-command icon="location-dot" 
                          title="Draw Point"
                          ?disabled=${!t}
                          .action=${()=>this.handleDrawPoint()}>
                </k-command>
                <k-command icon="minus" 
                          title="Draw LineString"
                          ?disabled=${!t}
                          .action=${()=>this.handleDrawLine()}>
                </k-command>
                <k-command icon="draw-polygon" 
                          title="Draw Polygon"
                          ?disabled=${!t}
                          .action=${()=>this.handleDrawPolygon()}>
                </k-command>
                
                <k-command icon="trash" 
                          title="Delete Selected Features"
                          ?disabled=${this.interactionMode!=="select"}
                          .action=${()=>this.handleDeleteSelected()}>
                </k-command>

                <wa-divider orientation="vertical"></wa-divider>
            `})}
            
            <k-command icon="hand-pointer" 
                      title="Select Features"
                      .action=${()=>this.handleSelectFeatures()}>
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>
        `}async connectedCallback(){if(super.connectedCallback(),this.isFirstConnection){this.isFirstConnection=!1;return}this.renderer?.reattached&&(await this.renderer.reattached(),this.renderer.setOnClick&&this.renderer.setOnClick(()=>{it.set(this)}))}async doInitUI(){const r=this.input?.data,e=await ko(".env");e.BUILD_TIME=new Date;const t=await r.getContents();let n=t&&t.trim()?JSON.parse(t):ma;n=this.migrateGsMap(n),Ps(n),await sn(n,"url"),await sn(n,"src",this.moduleResolver),this.gsMap=n,n.view&&(this.initialView={center:[...n.view.center],zoom:n.view.zoom}),this.renderer=new Pp(n,e);const i=this.renderer.getOperations(),o=new Lp(n,this.renderer),a=new $p(this);this.operations=Cp([o,i,a]);try{if(!this.mapContainer.value)throw new Error("Map container not available");await this.renderer.render(this.mapContainer.value),this.renderer.setOnDirty(()=>this.markDirty(!0)),this.renderer.setOnSync(c=>{if(this.gsMap){switch(c.type){case"viewChanged":this.gsMap.view.center=c.view.center,this.gsMap.view.zoom=c.view.zoom,c.view.rotation!==void 0&&c.view.rotation!==0&&(this.gsMap.view.rotation=c.view.rotation);break;case"featuresChanged":const f=ln(this.gsMap,c.layerUuid);f&&f.source?.type===pr.Features&&(f.source.features=c.features);break;case"featureSelected":const y={feature:c.feature,layerUuid:c.layerUuid,metrics:c.metrics};console.info("Feature metrics:",y.metrics),gr.set({part:this,event:nr.FEATURE_SELECTED,payload:y});break;case"featureDeselected":console.info("Feature deselected"),gr.set({part:this,event:nr.FEATURE_SELECTED,payload:null}),this.interactionMode==="select"&&(this.interactionMode="none",this.updateToolbar());break;case"drawingDisabled":this.interactionMode==="draw"&&(this.interactionMode="none",this.updateToolbar());break}this.markDirty(!0)}}),this.renderer.setOnClick?.(()=>{it.set(this)}),this.updateToolbar(),gr.set({part:this,event:nr.LOADED})}catch(c){console.error("Failed to render map:",c),Ze(`Failed to render map: ${c.message}`)}}migrateGsMap(r){const e={...r};let t=!1;return r.view||(console.log("Creating view field and migrating old properties..."),t=!0,e.view={},r.center!==void 0&&(e.view.center=r.center,delete e.center),r.zoom!==void 0&&(e.view.zoom=r.zoom,delete e.zoom),r.projection!==void 0&&(e.view.projection=r.projection,delete e.projection),e.view.center===void 0&&(e.view.center=[0,0]),e.view.zoom===void 0&&(e.view.zoom=0),e.view.projection===void 0&&(e.view.projection="EPSG:3857")),(!r.styles||Object.keys(r.styles).length===0)&&(console.log("Adding default styles to map..."),t=!0,e.styles={...Vo}),(!r.styleRules||r.styleRules.length===0)&&(console.log("Adding default style rules to map..."),t=!0,e.styleRules=[...Ho]),t&&console.log("Map migration completed"),e}getGsMap(){return this.gsMap}async save(){if(!this.renderer){Ze("Map not initialized");return}try{if(!this.gsMap){Ze("Map not initialized");return}const r=JSON.parse(JSON.stringify(this.gsMap));await $n(r,"url"),await $n(r,"src"),this.input?.data.saveContents(JSON.stringify(r,null,2)),this.markDirty(!1)}catch(r){Ze(`Save failed: ${r.message}`)}}get mapOperations(){return this.operations}edit(){tr("not yet implemented")}async refresh(){if(!this.renderer||!this.gsMap){Mp.error("Map not initialized");return}await $n(this.gsMap,"url"),await $n(this.gsMap,"src"),this.moduleResolver.clear(),await sn(this.gsMap,"url"),await sn(this.gsMap,"src",this.moduleResolver),await this.renderer.modelToUI(this.gsMap)}async resetView(){!this.operations||!this.initialView||(await this.operations.setCenter(this.initialView.center),await this.operations.setZoom(this.initialView.zoom))}async handleDrawPoint(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("Point",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleDrawLine(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("LineString",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleDrawPolygon(){this.activeDrawingLayerUuid&&(await this.operations?.enableDrawing("Polygon",this.activeDrawingLayerUuid),this.interactionMode="draw",this.updateToolbar())}async handleSelectFeatures(){await this.operations?.enableFeatureSelection(),this.interactionMode="select",this.updateToolbar()}async handleDeleteSelected(){if(this.interactionMode==="select")try{await this.operations?.deleteSelectedFeatures(),tr("Selected features deleted")}catch(r){Ze(r.message)}}async handleCreateDrawingLayer(){if(!this.gsMap){Ze("Map not initialized");return}const r=await Wn("Enter name for new drawing layer:","Drawing Layer");if(!r)return;const e=Ps({name:r,type:Rs.VECTOR,source:{type:pr.Features,features:[]},visible:!0});await this.operations?.addLayer(e,!1);const t=this.gsMap?.layers.find(n=>n.uuid===e.uuid);t?.uuid&&(this.activeDrawingLayerUuid=t.uuid),await this.updateComplete,this.updateToolbar(),tr(`Created drawing layer: ${r}`)}doClose(){this.renderer?.destroy(),this.renderer=void 0,this.input=void 0,this.moduleResolver.clear()}render(){return G`
            <div class="gc-map-container" ${br(this.mapContainer)}>
            </div>
        `}};Nt.styles=[Go(Ep),Yt`
        :host {
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .gc-map-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
    `];Ri([Be({attribute:!1})],Nt.prototype,"input",2);Ri([Be({type:String})],Nt.prototype,"activeDrawingLayerUuid",2);Ri([Be({type:String})],Nt.prototype,"interactionMode",2);Nt=Ri([Et("gs-map")],Nt);var Fp=Object.defineProperty,qp=Object.getOwnPropertyDescriptor,Io=(r,e,t,n)=>{for(var i=n>1?void 0:n?qp(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&Fp(e,t,i),i};let wi=class extends jt{doBeforeUI(){this.watch(an,r=>{this.onPartChanged(r)}),this.watch(gr,({part:r})=>{this.onMapChanged({part:r})})}onPartChanged(r){if(!(r==this||r==this.mapEditor)){if(!(r instanceof Nt)){this.mapEditor=void 0,this.requestUpdate();return}this.mapEditor=r,this.requestUpdate()}}onMapChanged({part:r}){r==this.mapEditor&&this.requestUpdate()}toggleVisible(r){const e=this.mapEditor.getGsMap(),t=ln(e,r);if(!t)return;const i=!(t.visible!==!1);this.mapEditor?.mapOperations?.setLayerVisible(r,i),this.updateLater()}async confirmAction(r,e){await fn(r)&&e()}selectLayer(r){this.selectedLayerUuid=r,this.updateToolbar(),this.updateContextMenu()}renameLayer(r){if(!this.mapEditor)return;const e=r||this.selectedLayerUuid;if(!e)return;const t=this.mapEditor.getGsMap();if(!ln(t,e))return;const i=cn(t,e),o=je.createExecutionContext({index:i+1});je.execute("rename_layer",o)}deleteLayer(r){if(!this.mapEditor)return;const e=r||this.selectedLayerUuid;if(!e)return;const t=this.mapEditor.getGsMap(),n=ln(t,e);n&&this.confirmAction(`Delete layer "${n.name||"Layer"}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.deleteLayer(e)))}moveLayerUp(r){if(!this.mapEditor)return;const e=this.mapEditor.getGsMap();if(!e)return;const t=cn(e,r);if(t<=0)return;const n=e.layers[t-1]?.uuid;n&&(this.withRefresh(()=>this.mapEditor?.mapOperations?.moveLayer(r,n)),this.selectedLayerUuid=n)}moveLayerDown(r){if(!this.mapEditor)return;const e=this.mapEditor.getGsMap();if(!e)return;const t=cn(e,r);if(t<0||t>=e.layers.length-1)return;const n=e.layers[t+1]?.uuid;n&&(this.withRefresh(()=>this.mapEditor?.mapOperations?.moveLayer(r,n)),this.selectedLayerUuid=n)}renderToolbar(){const r=this.selectedLayerUuid!==void 0;return G`
            <k-command ?disabled=${!r} 
                      title="Rename selected layer" 
                      icon="pen"
                      .action=${()=>this.renameLayer()}>
            </k-command>
            <k-command ?disabled=${!r} 
                      title="Delete selected layer" 
                      icon="trash"
                      .action=${()=>this.deleteLayer()}>
            </k-command>
        `}renderContextMenu(){const r=this.selectedLayerUuid!==void 0;return G`
            <k-command ?disabled=${!r} 
                      icon="pen"
                      .action=${()=>this.renameLayer()}>
                Rename
            </k-command>
            <k-command ?disabled=${!r} 
                      icon="trash"
                      .action=${()=>this.deleteLayer()}>
                Delete
            </k-command>
        `}render(){return Ut(!this.mapEditor,()=>G`
                    <k-no-content message="Select a map."></k-no-content>`,()=>G`
                <wa-tree>
                    <wa-tree-item expanded>
                        <k-icon name="fg layers"></k-icon> Layers
                        ${this.mapEditor.getGsMap()?.layers.map((r,e)=>G`
                            <wa-tree-item @click="${()=>r.uuid&&this.selectLayer(r.uuid)}" 
                                          class="${this.selectedLayerUuid===r.uuid?"selected":""}">
                                <div class="layer-item">
                                    <div class="layer-name">
                                        <span>${r.name??`Layer ${e+1}`}${e==0?G`
                                            <small>(basemap)</small>`:""}</span>
                                    </div>
                                    <div class="layer-actions">
                                        <k-command size="small"
                                                  icon="${r.visible!==!1?"eye":"eye-slash"}"
                                                  title="${r.visible!==!1?"Hide layer":"Show layer"}"
                                                  .action=${()=>r.uuid&&this.toggleVisible(r.uuid)}>
                                        </k-command>
                                        <k-command size="small"
                                                  icon="arrow-up"
                                                  title="Move layer up"
                                                  ?disabled="${e===0}"
                                                  .action=${()=>r.uuid&&this.moveLayerUp(r.uuid)}>
                                        </k-command>
                                        <k-command size="small"
                                                  icon="arrow-down"
                                                  title="Move layer down"
                                                  ?disabled="${e===this.mapEditor.getGsMap().layers.length-1}"
                                                  .action=${()=>r.uuid&&this.moveLayerDown(r.uuid)}>
                                        </k-command>
                                    </div>
                                </div>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="fg map-control"></k-icon> Controls
                        ${this.mapEditor?.getGsMap()?.controls.map(r=>G`
                            <wa-tree-item>
                                <span>${Ln(r.src)}</span>
                                <k-command size="small"
                                          icon="trash"
                                          title="Delete control"
                                          .action=${()=>{r.uuid&&this.confirmAction(`Delete control "${Ln(r.src)}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.removeControl(r.uuid)))}}>
                                </k-command>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="fg map-poi"></k-icon> Overlays
                        ${this.mapEditor?.getGsMap()?.overlays.map(r=>G`
                            <wa-tree-item>
                                <span>${Ln(r.src)}</span>
                                <k-command size="small"
                                          icon="trash"
                                          title="Delete overlay"
                                          .action=${()=>{r.uuid&&this.confirmAction(`Delete overlay "${Ln(r.src)}"?`,()=>this.withRefresh(()=>this.mapEditor?.mapOperations?.removeOverlay(r.uuid)))}}>
                                </k-command>
                            </wa-tree-item>
                        `)}
                    </wa-tree-item>
                    <wa-tree-item expanded>
                        <k-icon name="highlighter"></k-icon> Styles
                        <wa-tree-item>
                            <span>Defined Styles: ${Object.keys(this.mapEditor.getGsMap()?.styles||{}).length}</span>
                        </wa-tree-item>
                        <wa-tree-item>
                            <span>Style Rules: ${this.mapEditor.getGsMap()?.styleRules?.length||0}</span>
                        </wa-tree-item>
                    </wa-tree-item>
                </wa-tree>
            `)}};wi.styles=Yt`
        :host {
            display: flex;
            flex-direction: column;
        }
        
        wa-tree-item.selected {
            background-color: var(--wa-color-primary-50);
        }
        
        .layer-item {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 4px;
        }
        
        .layer-name {
            flex: 1;
        }
        
        .layer-actions {
            display: flex;
            gap: 2px;
        }
    `;Io([At()],wi.prototype,"selectedLayerUuid",2);wi=Io([Et("gs-map-props")],wi);var zp=Object.defineProperty,Up=Object.getOwnPropertyDescriptor,So=(r,e,t,n)=>{for(var i=n>1?void 0:n?Up(e,t):e,o=r.length-1,a;o>=0;o--)(a=r[o])&&(i=(n?a(e,t,i):a(i))||i);return n&&i&&zp(e,t,i),i};const jp="catalog.root";let Pr=class extends jt{constructor(){super(...arguments),this.treeRef=yr()}doBeforeUI(){const r=Me.getContributions(jp);this.rootNodes=this.toTreeNodes(r)}renderToolbar(){const r=it.get()instanceof Pr&&er.get()!==void 0;return G`
            <k-command cmd="checkout" icon="file-arrow-down" ?disabled=${!r} title="Checkout"></k-command>
            <k-command cmd="refresh_catalog" icon="arrows-rotate" title="Refresh Catalog"></k-command>
            <k-command cmd="catalog_expand_all" icon="angles-down" slot="end" title="Expand All"></k-command>
            <k-command cmd="catalog_collapse_all" icon="angles-up" slot="end" title="Collapse All"></k-command>
        `}toTreeNodes(r){return r.map(e=>{const t={data:e.state,icon:e.icon,label:e.label,leaf:!1};if(e.contributionId){const n=Me.getContributions(e.contributionId);t.leaf=n.length===0,t.children=this.toTreeNodes(n)}return t})}onItemDblClicked(r){const e=r.currentTarget.model.data.url;this.executeCommand("checkout",{url:e})}onSelectionChanged(r){const e=r.detail.selection[0].model;er.set(e.data)}setAllExpanded(r){const e=this.treeRef.value;e&&e.querySelectorAll("wa-tree-item").forEach(t=>{t.expanded=r})}refresh(){this.requestUpdate()}createTreeItems(r,e=!1){return r?G`
            <wa-tree-item
                    @dblclick=${this.nobubble(this.onItemDblClicked)} .model=${r} ?expanded=${e}>
                <span><k-icon name="${r.icon}"></k-icon> ${r.label}</span>
                ${r.children?.map(t=>this.createTreeItems(t))}
            </wa-tree-item>`:G``}render(){return G`
            <wa-tree ${br(this.treeRef)} @wa-selection-change=${this.nobubble(this.onSelectionChanged)} style="--indent-guide-width: 1px;">
                ${this.rootNodes?.map(r=>this.createTreeItems(r,!0))}
            </wa-tree>
        `}};Pr.styles=Yt`
        :host {
            display: flex;
            flex-direction: column;
        }
    `;So([At()],Pr.prototype,"rootNodes",2);Pr=So([Et("gs-catalog")],Pr);const Wp="geo!space catalog",Bp="earth",Gp="catalog.root.geospace",Vp=[{contributionId:"catalog.root.notebooks",label:"Notebooks",icon:"book",items:[{label:"Welcome to Jupyter Notebooks",icon:"graduation-cap",state:{url:"${baseURL}/notebooks/welcome.ipynb",type:"file"}},{label:"Simple Notebook",icon:"circle-info",state:{url:"${baseURL}/notebooks/simple-notebook.ipynb",type:"file"}}]},{contributionId:"catalog.root.datasets",label:"Datasets",icon:"clone",items:[{label:"countries.geojson",icon:"fg geojson-file",state:{url:"${baseURL}/datasets/countries.geojson",type:"file"}}]},{contributionId:"catalog.root.maps",label:"Maps",icon:"map-location",items:[{label:"OpenStreetMap basemap",icon:"earth",state:{url:"${baseURL}/maps/osm.geospace",type:"file"}},{label:"basemap.de basemap",icon:"earth",state:{url:"${baseURL}/maps/bm.geospace",type:"file"}},{label:"basemap.de WMS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms.geospace",type:"file"}},{label:"basemap.de WMS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wms-gray.geospace",type:"file"}},{label:"basemap.de WMTS (Color)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts.geospace",type:"file"}},{label:"basemap.de WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/bm-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts.geospace",type:"file"}},{label:"TopPlusOpen WMTS (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-gray.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light.geospace",type:"file"}},{label:"TopPlusOpen WMTS Light (Gray)",icon:"earth",state:{url:"${baseURL}/maps/topplus-wmts-light-gray.geospace",type:"file"}},{label:"Esri World Imagery (Satellite)",icon:"satellite",state:{url:"${baseURL}/maps/esri-world-imagery.geospace",type:"file"}},{label:"Sentinel-2 Cloudless (Satellite)",icon:"satellite",state:{url:"${baseURL}/maps/sentinel2-cloudless.geospace",type:"file"}}]},{contributionId:"catalog.root.overlays",label:"Overlays",icon:"fg map-poi",items:[]},{contributionId:"catalog.root.controls",label:"Controls",icon:"fg map-control",items:[]},{contributionId:"catalog.root.icons",label:"Icons",icon:"icons",items:[{label:"marker.png",icon:"file",state:{url:"${baseURL}/icons/marker.png",type:"file"}},{label:"location-user-24.png",icon:"file",state:{url:"${baseURL}/icons/location-user-24.png",type:"file"}}]},{contributionId:"catalog.root.packages",label:"Asset Packages",icon:"box-archive",items:[]}],Hp={label:Wp,icon:Bp,contributionId:Gp,items:Vp};lt({command:{id:"checkout",name:"Checkout",description:"Checkout a catalog item into the workspace",parameters:[{name:"url",description:"the url of the resource to checkout, if not provided, the current selection in the catalog will be used",required:!1}]},handler:{execute:async r=>{let e=r.params&&r.params.url;if(!e){const n=er.get();if(!n||!("url"in n))return;e=n.url}const t=await Dt.getWorkspace();if(!t){Ze("No workspace selected.");return}fetch(e,{method:"GET"}).then(n=>n.blob()).then(n=>{const i=new URL(e).pathname.split("/"),o=i[i.length-1];return t.getResource(o,{create:!0}).then(a=>a.saveContents(n,{contentType:Ya.BINARY}).then(()=>{tr("File checked out: "+o)}))}).catch(n=>{Ze(n)})}}});lt({command:{id:"refresh_catalog",name:"Refresh Catalog",description:"Refreshes the catalog view",parameters:[]},handler:{execute:async r=>{const e=it.get();e instanceof Pr&&e.refresh()}}});lt({command:{id:"catalog_expand_all",name:"Expand All Catalog Items",description:"Expands all items in the catalog tree",parameters:[]},handler:{execute:async r=>{const e=it.get();e instanceof Pr&&e.setAllExpanded(!0)}}});lt({command:{id:"catalog_collapse_all",name:"Collapse All Catalog Items",description:"Collapses all items in the catalog tree",parameters:[]},handler:{execute:async r=>{const e=it.get();e instanceof Pr&&e.setAllExpanded(!1)}}});xo(Hp);const Kp=Hr("GsCommandHandlers"),Er=r=>r.activeEditor instanceof Nt,Dr=r=>{const e=r.activeEditor;if(!(e instanceof Nt)||!e.getOperations())throw Kp.error("GsMapEditor with renderer not available in context.activeEditor"),new Error("GsMapEditor with renderer not available in context.activeEditor");return e.getOperations()};je.registerAll({command:{id:"zoom_to_level",name:"Zoom to Level",description:"Zooms the map to the provided level",parameters:[{name:"zoom",description:"the zoom level (typically 0-20, where 0=world view, 5-9=country/region, 10-12=city, 13-15=street, 16-20=building detail)",required:!0}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),t=Number(r.params.zoom).valueOf();return await e.setZoom(t),{zoom:t}}}});je.registerAll({command:{id:"zoom_in",name:"Zoom In",description:"Zooms the map in by one level",parameters:[],output:[{name:"zoom",description:"the new zoom level",type:"number"}]},handler:{canExecute:r=>it.get()instanceof Nt,execute:async r=>{const e=it.get(),t=e.getGsMap();if(t?.view?.zoom!==void 0){const n=e.mapOperations,i=t.view.zoom+1;return await n?.setZoom(i),i}return t?.view?.zoom}}});je.registerAll({command:{id:"zoom_out",name:"Zoom Out",description:"Zooms the map out by one level",parameters:[],output:[{name:"zoom",description:"the new zoom level",type:"number"}]},handler:{canExecute:r=>it.get()instanceof Nt,execute:async r=>{const e=it.get(),t=e.getGsMap();if(t?.view?.zoom!==void 0){const n=e.mapOperations,i=t.view.zoom-1;return await n?.setZoom(i),i}return t?.view?.zoom}}});je.registerAll({command:{id:"center_location",name:"Center to a location",description:"Centers the map to the provided location coordinates",parameters:[{name:"lat",description:"the latitude of the location (e.g., 52.52 for Berlin). Use your knowledge of city coordinates or approximate values.",type:"number",required:!0},{name:"lon",description:"the longitude of the location (e.g., 13.405 for Berlin). Use your knowledge of city coordinates or approximate values.",type:"number",required:!0}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),t=Ko([Number(r.params.lon).valueOf(),Number(r.params.lat).valueOf()]);await e.setCenter([t[0],t[1]])}}});je.registerAll({command:{id:"add_layer",name:"Add new layer",description:"Adds a new layer to the map or set the basemap",parameters:[{name:"source",description:`the source of the layer, one of: ${Object.values(pr).join(", ")}`,required:!0},{name:"basemap",description:"if set to true, the new layer will be used as the basemap or basemap layer",required:!1},{name:"url",description:"the URL or path within the workspace to load the features/geometries from",required:!1},{name:"stylePath",description:"the path within the workspace to the style json file if source is of type vector, for example, geojson",required:!1}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),t=r.params.source?.trim().toLowerCase(),n=r.params.url,i=Yo(t),o=r?.params&&r.params.basemap==!0;let a;n&&(a=n.split("/").pop()),!a&&i&&(a=i);const c=Ls({name:a,type:Jo(t),source:Ls({type:i,url:n??Zo(i)})});await sn(c,"url"),await e.addLayer(c,o)}}});je.registerAll({command:{id:"delete_layer",name:"Delete a layer",description:"Delete a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to delete, starts with 1 for the first layer",required:!0}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),n=r.activeEditor.getGsMap(),i=parseInt(r.params.index)-1;if(i<0||!n||i>=n.layers.length)return;const o=n.layers[i];o?.uuid&&await e.deleteLayer(o.uuid)}}});je.registerAll({command:{id:"rename_layer",name:"Rename a layer",description:"Rename a layer given its index (starting with 1 for the first layer)",parameters:[{name:"index",description:"the index of the layer to rename, starts with 1 for the first layer",required:!0},{name:"newName",description:"the new name for the layer",required:!1}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),n=r.activeEditor.getGsMap(),i=parseInt(r.params.index)-1;if(i<0||!n||i>=n.layers.length)return;const o=n.layers[i];if(!o?.uuid)return;const a=o.name||`Layer ${i+1}`,c=r.params?.newName||await Wn(`Enter new name for "${a}":`,a);!c||c===a||await e.renameLayer(o.uuid,c)}}});je.registerAll({command:{id:"switch_color_mode",name:"Switch color mode",description:"Switches the current color mode to either dark or light (default)",parameters:[{name:"mode",description:"the mode to switch to, will be toggled if not provided",required:!1}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),t=r.params?.mode;await e.switchColorMode(t)}}});je.registerAll({command:{id:"add_overlay",name:"Add overlay",description:"Adds an overlay JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),t=r.params.src,n=r.params.position;await e.addOverlayFromModule(t,n)}}});je.registerAll({command:{id:"add_control",name:"Add control",description:"Adds a control JavaScript module to the map",parameters:[{name:"src",description:"the path within the workspace - can also be an external URL - to the JavaScript module which must return a default function that adds behavior to a wrapper control",required:!0}]},handler:{canExecute:Er,execute:async r=>{const e=Dr(r),t=r.params.src;await e.addControlFromModule(t)}}});je.registerAll({command:{id:"view_extents",name:"View extents",description:"Stores the extent of the current view as a variable",parameters:[{name:"latlon",description:"set to true to reverse coordinates to lat/lon instead of lon/lat; useful for various external services such as OpenStreetMap Overpass API",required:!1}],output:[{name:"viewExtent",description:"the current view's extent as lat/lon coordinates in WGS84 (EPSG:4326) format",type:"number[]"}]},handler:{canExecute:Er,execute:async r=>{const e=r.activeEditor,t=r.params.latlon,i=await e.getRenderer().getViewExtent();if(!i)throw new Error("Failed to get view extent");let o=i;if(t||t===void 0){const{transformExtent:a}=await mt(async()=>{const{transformExtent:c}=await import("./index-DoDY4M9O.js").then(f=>f.ah);return{transformExtent:c}},__vite__mapDeps([1,2]));o=a(i,"EPSG:3857","EPSG:4326"),[o[0],o[1]]=[o[1],o[0]],[o[2],o[3]]=[o[3],o[2]]}return r.viewExtent=o,o}}});je.registerAll({command:{id:"toggle_mobile_view",name:"Toggle Mobile View",description:"Toggles between desktop and mobile view for the map",parameters:[]},handler:{canExecute:r=>it.get()instanceof Nt,execute:async r=>{const e=it.get().renderer;if(!e||!("toggleMobileView"in e))throw new Error("Mobile view toggle not available on this renderer");e.toggleMobileView()}}});je.registerAll({command:{id:"refresh_map",name:"Refresh Map",description:"Refreshes the currently active map editor",parameters:[]},handler:{canExecute:r=>it.get()instanceof Nt,execute:async r=>{const e=it.get();e instanceof Nt&&await e.refresh()}}});je.registerAll({command:{id:"reset_view",name:"Reset View",description:"Resets the map view to the initial center and zoom level",parameters:[]},handler:{canExecute:r=>it.get()instanceof Nt,execute:async r=>{const e=it.get();e instanceof Nt&&await e.resetView()}}});je.registerAll({command:{id:"toggle_color_mode",name:"Toggle Color Mode",description:"Toggles between dark and light mode for the map",parameters:[]},handler:{canExecute:r=>it.get()instanceof Nt,execute:async r=>{const t=it.get().mapOperations;t&&await t.switchColorMode()}}});const Yp=`You are an assistant embedded in a highly modular and extendable web application.
The application provides the following components:
- a workspace/file browser in the left sidebar
- an editor area in the center which shows a welcome message and how to get started if no workspace is selected
- an AI chat interface in the auxiliary sidebar (right side) with tab label "AI" to interact with you
- a bottom panel for logs and terminal output

The workspace component (file browser) allows to select a local folder as a workspace.
Once a workspace is connected, it will be restored when the user reloads the application.
If the user does not see a file they expect to be in the workspace,
they can choose to reload the workspace which will lead to syncing the workspace folder with the local file system.

Files are opened using appropriate editors based on their type.
The code editor has IDE like UI,
such as syntax highlighting and syntax checking for most well known programming languages and file formats.
The user can execute code in Python or JavaScript by pressing the run button in the open code editor.

If a file is dirty, i.e. the user made changes to its content, the tab title of the dirty editor will signal this
by showing an asterisk "*".

If the user prompt starts with "/<command>" where <command> is a command name,
the application will directly run the registered command.

Via a button with a puzzle icon in the top-right corner, the extensions editor can be opened.
The user can browse available extensions, install, or uninstall it (in this case a reload of the web app is required).

**Command Execution via Tools:**

The application exposes commands as AI-callable tools/functions. These tools represent actual commands you can execute directly in the application.

**Tool Architecture:**
- Tools are dynamically generated from available commands in the system
- Commands are **context-aware/context-sensitive** - different commands are available depending on the current application context (active editor, selected files, workspace state, etc.)
- The available tools you see at any given time reflect what commands can be executed in the current context
- Each tool includes:
  - A descriptive name and function description
  - Parameter definitions with types, descriptions, and whether they're required
  - Enum values for parameters where applicable
- You can call multiple tools in sequence to accomplish complex tasks
- The system prevents infinite loops with a maximum iteration limit

**Context Information:**
- You receive current application state with each user prompt, including:
  - The active workspace name (if a workspace is selected)
  - The currently active editor (if any editor is open)
- Use this contextual information to understand what the user is working with and provide relevant assistance

**Rules for using tools:**
1. **Always check for available tools first** - If tools are available and the user requests an action that can be performed via a tool, you MUST call that tool
2. **Never describe manual steps when tools are available** - If a tool exists for an action, use it. Do not tell the user to click buttons or use menus
3. **Read tool descriptions and parameters** - Each tool's description and parameters explain exactly what it does and what parameters it needs. Use this information to determine the correct tool and parameters.
4. **Call tools in sequence when needed** - For complex requests requiring multiple steps, call tools one after another.
5. **Provide final response after tool execution** - After executing tools and receiving successful results, you MUST provide a final text response to the user confirming the completion of the task. Do NOT call more tools after receiving success results unless the user explicitly requested additional steps.
6. **Do NOT loop tool calls** - Once you receive a tool result indicating success, do NOT call the same or similar tool again. The task is complete - provide your response to the user instead of calling more tools.

**If tools are NOT available:** This means the current context doesn't support command execution. In this case:
- Explain what context is needed for the requested action
- Describe manual steps or explain how to perform the action using the UI
- Suggest changing the context if needed (e.g., opening the appropriate file or editor)

**Important:** When tools are provided, they represent actual commands you can execute. Use them immediately rather than discussing alternatives. The tool descriptions tell you exactly what each tool does and what parameters it requires.

Answer technical requests not by code any technical terms, but by abstract and easy-to-understand concepts.
Keep your answer concise and as short as possible: specific requests are handled by other assistants.

`,Jp=`
**geo!space - WebGIS Application:**

geo!space is a WebGIS (Web Geographic Information System) application for creating, editing, and visualizing interactive maps.

**Core Capabilities:**
- Interactive map editor with zoom, pan, and layer management
- Support for multiple layer types: GeoJSON, WMS, WMTS, Vector Tiles, and more
- Drawing tools for creating and editing geographic features
- Style management for customizing layer appearance
- Map state persistence in .geospace files (JSON format containing map configuration, layers, view settings, and styles)

**Map Editor:**
When a .geospace file is open, the map editor provides:
- Interactive map view with coordinate system support (EPSG:3857, EPSG:4326, etc.)
- Layer panel for managing multiple data layers
- Drawing tools for creating points, lines, and polygons
- Style editor for customizing layer visualizations
- Catalog integration for browsing and adding spatial data
`,Zp={enhance:async(r,e)=>`${Jp}

${r}`,priority:5};function Xp(){Me.registerContribution(Kn,{label:"Geo!space Prompt Enhancer",enhancer:Zp})}const Qp=`# 🌐 geo!space
[![Ask DeepWiki](https://deepwiki.com/badge.svg)](https://deepwiki.com/erdalkaraca/geospace)
[![Browser Support](https://img.shields.io/badge/Chrome%20%7C%20Opera-Supported-brightgreen)](#-browser-compatibility)
[![AI Providers](https://img.shields.io/badge/AI%20Providers-6-blue)](#-ai-configuration)
[![PWA Ready](https://img.shields.io/badge/PWA-Ready-purple)](#-key-features)
[![No Installation](https://img.shields.io/badge/Installation-None%20Required-orange)](#-quick-start)

**The Interactive Mapping IDE in Your Browser**

geo!space is a powerful web application that combines professional mapping capabilities with AI-powered automation tools. Create interactive maps, execute Python and JavaScript code, and automate repetitive tasks using natural language prompts - all without installing any software, directly in your browser.

## 📑 Table of Contents

- [✨ Key Features](#-key-features)
- [🌐 Browser Compatibility](#-browser-compatibility)
- [🌟 Use Cases](#-use-cases)
- [🚀 Getting Started](#-getting-started)
- [👨‍💻 Development](#-development)
- [💬 Commands & Natural Language](#-commands--natural-language)
- [💡 Examples](#-examples)
- [⚙️ AI Configuration](#️-ai-configuration)
- [🔧 Troubleshooting](#-troubleshooting)
- [❓ FAQ](#-faq)
- [🏗️ Technical Architecture](#️-technical-architecture)
- [🤝 Trusted by](#-trusted-by)
- [⚡ Quick Start](#-quick-start)

## ✨ Key Features

### 🗺️ **Professional Mapping**
- **Interactive Map Editor**: Create and edit maps using the custom \`.geospace\` format
- **Multiple Data Sources**: Support for OSM, XYZ tiles, GeoJSON, KML, GeoTIFF, GPX, Features, BM (basemap.de), WMS, WMTS, and Overpass API
- **Satellite Imagery**: Built-in access to Esri World Imagery and Sentinel-2 satellite imagery
- **Layer Management**: Vector layers, tile layers, and layer groups with full styling control
- **OpenLayers Integration**: Built on the industry-standard OpenLayers mapping library
- **Advanced Styling**: Dynamic style loading and management system
- **PWA Transformation**: Convert \`.geospace\` files into cross-platform Progressive Web Apps

### 🤖 **AI-Powered Automation**
- **Multiple AI Providers**: Ollama, OpenAI, Groq, Cerebras, and WebLLM support
- **Context-Aware Assistants**: Specialized AI roles for mapping, coding, and general assistance
- **Local AI Support**: Run AI models locally using WebLLM or Ollama
- **Natural Language Commands**: Control the application using conversational prompts

### 💻 **Development Environment**
- **Monaco Editor**: Full VS Code editor experience with syntax highlighting
- **Python Execution**: Complete Pyodide integration with package management and pip requirements
- **JavaScript Execution**: Direct browser JavaScript execution in workers
- **File System Access**: Direct browser integration with local files and workspace persistence
- **Dependency Management**: Automatic pip requirements handling and package installation

### 🔧 **Extensibility**
- **Extension System**: Browse, install, and uninstall extensions from the built-in extension manager
- **Built-in Extensions**: WebLLM, Python/JS terminals, Linux terminal
- **Extension Sources**: Add extensions from trusted URLs or the geo!space extension registry
- **Command Registry**: 20+ built-in commands + extensible command system
- **Build System**: Generate publishable maps from \`.geospace\` files

## 🌐 Browser Compatibility

**⚠️ Important**: geo!space uses the File System Access API which has limited browser support.

- ✅ **Fully Supported**: Chrome and Opera
- ⚠️ **Limited Support**: Firefox and Safari (partial File System Access API support)

For more details, see [File System API](https://developer.mozilla.org/en-US/docs/Web/API/Window/showDirectoryPicker)

## 🌟 Use Cases

- **Data Analysts**: Create interactive maps for data visualization
- **Urban Planners**: Design and prototype mapping applications  
- **Developers**: Build geospatial applications without complex setup
- **Researchers**: Prototype location-based applications quickly
- **Educators**: Teach mapping and geospatial concepts interactively
- **App Creators**: Transform maps into cross-platform PWAs for mobile, desktop, and web deployment

## 🚀 Getting Started

### 1. **Connect a Workspace**
- In the Workspace tab, click the folder icon "Load workspace folder"
- Choose a local folder to use as your workspace
- This folder will be saved and restored when you reload geo!space

### 2. **Configure AI Assistant (Optional)**
- Open the settings editor using the settings button in the upper right corner
- Configure AI providers and models in the \`aiConfig\` section
- Set up API keys for your preferred AI services

### 3. **Working with Files**
- **\`.geospace\` files**: Map files that open in the interactive map editor
- **Python/JavaScript files**: Open in the Monaco code editor with syntax highlighting
- **Other files**: Open in the appropriate editor based on file type

### 4. **Creating Interactive Maps**
- Double-click \`.geospace\` files to open them in the map editor
- Use the map editor's UI to interact with layers, features, and styling
- Use the input field to run commands or interact with the map via natural language
- Add data sources: OSM tiles, GeoJSON files, KML, GeoTIFF, GPX, or custom features
- **Build PWA**: Use the "Build map" button to transform your \`.geospace\` file into a cross-platform Progressive Web App

### 5. **Code Development**
- Edit Python and JavaScript code in the Monaco editor
- Execute Python code using Pyodide (Python in the browser)
- Run JavaScript code directly in the browser
- Use the "Run" button to execute code snippets

### 6. **Resource Catalog**
- Browse the catalog view for curated maps, datasets, icons, and controls
- Select items from catalog categories (datasets, maps, overlays, controls, icons)
- Use the "Checkout" button to download items directly to your workspace
- Access pre-built basemaps (OpenStreetMap, basemap.de) and sample datasets

## 👨‍💻 Development

geo!space provides a powerful development environment for creating custom map controls and overlays using JavaScript modules.

### **Custom Modules**

Create interactive UI components for your maps using JavaScript modules. geo!space uses **Lit** for templating and **Web Awesome** for UI components - both are provided by default and based on browser standards only, so no build tools are required.

**Key Features:**
- **No Build Tools**: Write plain JavaScript modules that run directly in the browser
- **Lit Templating**: Use Lit's HTML template literals for reactive UI
- **Web Awesome Components**: Access to a full library of web-standard UI components
- **OpenLayers API**: Full access to OpenLayers through the \`ol\` namespace object
- **Module System**: Import and share modules within your workspace using relative paths or bare specifiers

**Getting Started:**
1. Create a JavaScript file in your workspace (e.g., \`my-control.js\`)
2. Export a default function that receives APIs via destructuring
3. Return a Lit template from your function
4. Add your module to a map's \`controls\` or \`overlays\` array in the \`.geospace\` file

**Example:**
\`\`\`javascript
export default function ({html, style, events, map}) {
    style({
        position: "absolute",
        bottom: "0",
        left: "0",
        right: "0"
    });

    return () => html\`
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr;">
            <wa-button @click=\${() => events("drawer/openMenu")}>
                Menu
            </wa-button>
        </div>
    \`;
}
\`\`\`

**Learn More:**
- 📖 See the [User Modules Guide](packages/geospace/public/docs/user-modules.md) for complete documentation
- 🎨 Browse Web Awesome components: https://webawesome.com
- 🗺️ Explore OpenLayers API: https://openlayers.org/

## 💬 Commands & Natural Language

### **Slash Commands**
Use commands starting with \`/\` in the map editor's input field:

- \`/python\`: Execute Python code
- \`/js\`: Execute JavaScript code  
- \`/touch\`: Create a new, empty file
- \`/save\`: Save the current file
- \`/build_map\`: Build a publishable map from the current \`.geospace\` file

### **Rich Command Library**
geo!space includes 20+ built-in commands for mapping operations:
- **Map Navigation**: \`zoom_to_level\`, \`center_location\`
- **Layer Management**: \`add_layer\`, \`delete_layer\`, \`add_marker\`
- **Data Operations**: Import/export various geospatial formats
- **File Operations**: Create, save, and manage workspace files

### **Natural Language Interaction**
- **Map Editor**: Ask questions like "Add a marker at coordinates 52.5, 13.4" or "Change the style of all points to red"
- **Code Editor**: Request code assistance like "Create a function to calculate distance between two points"
- **General**: Ask about app features, get help with workflows, or request explanations

## 💡 Examples

### **Create a City Map**
\`\`\`
1. /touch city-map.geospace
2. "Add OpenStreetMap as base layer"
3. "Download buildings in the current view"
4. "Download trees in the current view"
5. /build_map
\`\`\`

### **Custom App Development**
\`\`\`
1. Create map with /touch app.geospace
2. Add custom controls using JavaScript with prepackaged libraries (Lit, WebAwesome)
3. Write Python scripts for data processing
4. /build_map for cross-platform deployment
\`\`\`

## ⚙️ AI Configuration

### **Context-Aware AI Assistants**
The AI assistant adapts its role based on your current context:

- **🗺️ Map Editor**: Specialized for mapping tasks, layer management, and geospatial operations
- **💻 Code Editor**: Focused on coding assistance, debugging, and code generation
- **🌐 General App**: Helps with app navigation, features, and general workflows

Each assistant can be identified by its icon and help hint in the AI view.

### **AI Provider Setup**
Configure AI providers in the app settings (accessible via the settings button in the upper right corner). The settings are stored in IndexedDB under the \`settings.json\` section:

\`\`\`json
{
  "aiConfig": {
    "defaultProvider": "openai",
    "providers": [
      {
        "name": "ollama",
        "model": "gemma3:12b",
        "chatApiEndpoint": "http://localhost:11434/v1/chat/completions",
        "apiKey": ""
      },
      {
        "name": "openai",
        "model": "gpt-4.1",
        "chatApiEndpoint": "https://api.openai.com/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "groq",
        "model": "llama-3.1-8b-instant",
        "chatApiEndpoint": "https://api.groq.com/openai/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "cerebras",
        "model": "llama3.1-8b",
        "chatApiEndpoint": "https://api.cerebras.ai/v1/chat/completions",
        "apiKey": "<your api key>"
      },
      {
        "name": "webllm",
        "model": "gemma-2-9b-it-q4f16_1-MLC",
        "chatApiEndpoint": "",
        "apiKey": "",
        "parameters": {
          "context_window_size": 4096
        }
      },
      {
        "name": "mistral",
        "model": "mistral-large-latest",
        "chatApiEndpoint": "https://api.mistral.ai/v1/chat/completions",
        "apiKey": "<your api key>",
        "ocrApiEndpoint": "https://api.mistral.ai/v1/ocr"
      }
    ]
  }
}
\`\`\`

**Setup Instructions:**
1. Open the settings editor using the settings button in the upper right corner
2. Replace \`<your api key>\` with your actual API keys for each provider
3. Set \`defaultProvider\` to your preferred provider name
4. For **Ollama**: Install locally and ensure it's running on \`localhost:11434\`
5. For **WebLLM**: No API key needed - runs models locally in the browser
   - **⚠️ GPU Requirement**: Requires a dedicated GPU with sufficient VRAM to run the selected model
   - Models like \`gemma-2-9b-it-q4f16_1-MLC\` typically need 8GB+ VRAM
6. Settings are automatically saved to IndexedDB - no manual file management required
7. You can change the default provider in the AI view after connecting to a workspace

## 🔧 Troubleshooting

### **Common Issues**

**File Not Found**
- If you don't see expected files, try reloading the workspace
- Ensure the workspace folder is properly connected

**AI Assistant Not Working**
- Verify settings are correctly configured in the app settings (stored in IndexedDB)
- Check that your API keys are valid and properly formatted
- For local providers (Ollama), ensure the service is running

**Browser Compatibility Issues**
- Use Chrome or Opera for full functionality
- Firefox and Safari have limited File System Access API support

**Map Not Loading**
- Check that \`.geospace\` files contain valid JSON
- Verify data source URLs are accessible
- Ensure required resources (icons, styles) are available

## ❓ FAQ

**Q: Do I need to install anything?**
A: No! geo!space runs entirely in your browser. Just open it in Chrome or Opera.

**Q: Is my data secure?**
A: Yes. All data stays in your browser and local workspace. No data is sent to external servers unless you explicitly use AI services.

**Q: Can I use geo!space offline?**
A: Yes, for basic mapping features. AI assistance requires internet connection (except for local providers like Ollama/WebLLM).

**Q: How do I share my maps?**
A: Use the "Build map" button to create a PWA that can be deployed anywhere or shared as a standalone app.

**Q: What file formats are supported?**
A: Maps: \`.geospace\` (JSON), Data: GeoJSON, KML, GPX, GeoTIFF, Features. Tile sources: OSM, XYZ, WMS, WMTS, BM (basemap.de), Satellite imagery (Esri, Sentinel-2). Code: Python, JavaScript, and more.

**Q: Can I customize the interface?**
A: Yes! Install extensions, create custom controls using WebAwesome components, or add your own extensions.

**Q: What extensions are available?**
A: Built-in extensions include WebLLM, Python/JS terminals, Linux terminal, and more. Browse and install from the extension manager.

## 🏗️ Technical Architecture

**Frontend Stack:**
- **Lit**: Web components framework
- **TypeScript**: Main development language  
- **Vite**: Build tool and development server
- **Monaco Editor**: VS Code's editor component
- **WebAwesome**: Web components library (also available for custom map controls)

**Mapping Stack:**
- **OpenLayers**: Professional mapping library
- **Custom Runtime**: Map-to-OpenLayers conversion system
- **Style Loader**: Dynamic style loading

**AI Stack:**
- **Multiple Providers**: Flexible AI provider system
- **WebLLM**: Local AI model execution
- **Context-Aware**: Specialized AI roles per context

## 🤝 Trusted by

- **[Kiosk Scout](https://finder.kioskscout.de)**: A cross-platform PWA for finding nearby vending machines
- **Want your geo!space app listed here?** Contact us!

---

## ⚡ Quick Start

**Get up and running in 3 minutes:**

1. **Open geo!space** in Chrome or Opera
2. **Connect workspace** - Click folder icon and select a local directory
3. **Create your first map** - Use \`/touch my-map.geospace\` or open existing files
4. **Try AI assistance** - Ask "Add a marker at [your location]" in the map editor
5. **Build your app** - Use \`/build_map\` to create a deployable PWA

### **First-Time Setup**
- **No AI needed**: Start mapping immediately without configuration
- **AI setup**: Open settings → configure API keys for enhanced assistance
- **Extensions**: Browse and install extensions from the extension manager

## 🎯 Ready to Start?

1. **Load the app** in Chrome or Opera
2. **Connect a workspace** folder
3. **Create your first map** or open an existing \`.geospace\` file
4. **Ask the AI** for help with mapping tasks
5. **Build and share** your interactive maps

**Happy mapping! 🗺️✨**`,ed=Tn.version,ua=Hr("GeoSpaceApp"),td=["geospace.styleEditor","system.mdeditor","system.monaco","system.download","system.commandpalette","system.memoryusage","system.pythonpackagemanager","system.settings-tree","system.ai-system"],rd=[{target:Wa,slot:"start",label:"Brand",html:'<span style="margin-right: 1rem;"><span><nobr>🌐<i><b>geo!</b></i><small>space</small></nobr></span></span>'},{target:"system.fastviews-bottomend",name:"catalog",label:"Catalog",icon:"book",component:r=>G`<gs-catalog id="${r}"></gs-catalog>`},{target:Ga,name:"map-props",label:"Map Properties",icon:"fg map-options",component:r=>G`<gs-map-props id="${r}"></gs-map-props>`},{target:"contextmenu:filebrowser",label:"Add as Map Layer",icon:"layer-group",command:"add_layer_from_selection",disabled:()=>{const r=er.get();return r instanceof sr?!bo(r):!0}},{target:"filebrowser.create",label:"geo!space map",icon:"earth",command:"create_map_file"}],nd=[{id:"geospace.mapBuilder",name:"geo!space Map Builder",description:"Compile a geo!space file to an interactive website",loader:()=>mt(()=>import("./mapbuilder-extension-CDPdFLOY.js"),__vite__mapDeps([23,1,2])),icon:"earth"},{id:"geospace.styleEditor",name:"Style Editor",description:"Visual editor for defining and managing map styles and rules",loader:()=>mt(()=>import("./style-editor-extension-B_lnnPtx.js"),__vite__mapDeps([24,1,2])),icon:"palette"},{id:"geospace.overpass",name:"OpenStreetMap Overpass",description:"OpenStreetMap Overpass API Integration for use with LLMs",loader:()=>mt(()=>import("./overpass-extension-DpaFgJZs.js"),__vite__mapDeps([25,1,2])),icon:"table"},{id:"geospace.gtfs",name:"GTFS to GeoJSON Converter",description:"Convert GTFS zip archives to GeoJSON files",loader:()=>mt(()=>import("./gtfs-extension-B32au80i.js"),__vite__mapDeps([26,1,2])),icon:"map-location-dot"}],id={id:"geospace",name:"🌐geo!space",version:ed,description:"An IDE for working with geospatial data.",metadata:{github:{owner:"erdalkaraca",repo:"geospace"},favicon:"/geospace.svg"},extensions:td,contributions:{ui:rd,extensions:nd},async initialize(){vi.addPackage({name:Tn.name,version:Tn.version,dependencies:Tn.dependencies,devDependencies:Tn.devDependencies}),Xp(),Me.registerContribution(Hn,{label:"App Support",description:"General app support",role:"appsupport",priority:100,icon:"question-circle",sysPrompt:Yp,tools:{enabled:!0}}),Me.registerContribution("system.icons",{label:"geo!space File Icons",mappings:{geospace:"earth"},priority:1}),lt({command:{id:"add_layer_from_selection",name:"Add Layer from Selected File",description:"Adds the selected file as a map layer",parameters:[]},handler:{execute:async r=>{const e=er.get();if(!(e instanceof sr))return;const t=Is(e);if(!t){ua.warn(`Unsupported file type: ${e.getName()}`);return}const n=e.getWorkspacePath(),i=je.createExecutionContext({source:t,url:n});await je.execute("add_layer",i)}}}),lt({command:{id:"create_map_file",name:"Create Geospace map file",description:"Creates a new .geospace map file with default map structure. This is specifically for creating geospace map files, not general files.",parameters:[{name:"path",description:"the path including name of the map file to be created (e.g., 'my-map.geospace' or 'my map'). The .geospace extension will be added automatically if missing. Must be relative to the workspace.",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async r=>{const e={...ma,chatHistory:[],view:{center:[1105600,6120800],zoom:5,projection:"EPSG:3857"}},t=r.params?.path||"map.geospace",n=t.endsWith(".geospace")?t:`${t}.geospace`;return await je.execute("create_file",{params:{path:n,contents:JSON.stringify(e,null,2),extension:".geospace",ask:t==="map.geospace"}})}}}),lt({command:{id:"help",name:"Show welcome",description:"Shows the welcome page.",parameters:[]},handler:{execute:async r=>{const e=new iu(Qp,"README.md");await $r.loadEditor(e)}},contribution:{target:vn,icon:"question-circle",label:"Welcome"}}),ua.info("geo!space is ready!")}};Zr.registerApp(id,{defaultAppId:"geospace",autoStart:!0,container:document.body});export{Hr as A,Wr as B,xt as C,on as D,Wn as E,sr as F,Nt as G,fn as H,Ia as I,Qa as J,Jr as K,xr as L,Xa as M,qu as N,Cc as O,rp as P,Fn as Q,vn as R,ad as S,Wa as T,od as U,ld as V,cd as W,tr as a,Ze as b,it as c,er as d,Me as e,an as f,tt as g,lt as h,Hc as i,ud as j,jt as k,ko as l,at as m,Fc as n,Vc as o,je as p,Ya as q,Bt as r,Kt as s,hi as t,ti as u,$r as v,Dt as w,Ba as x,Xe as y,vr as z};
