import{h as p,b as n,w as f,t as w,q as u,a as h}from"./geospace-app-BYDv20Zk.js";import"./preload-helper-WQhrSmCl.js";import"./index-8b_zEHWw.js";import"./chunk.LTSJC6DR-BTS7fm5P.js";import"./chunk.RRCUZAZD-5O78oK5S.js";p({command:{id:"download",name:"Download File",description:"Download a file from a URL to the workspace",parameters:[{name:"url",description:"the URL of the file to download",required:!0},{name:"filename",description:"optional filename to save as (will be auto-detected if not provided)",required:!1}]},handler:{canExecute:a=>{const o=a.params&&a.params.url;return o?o.startsWith("http://")||o.startsWith("https://"):!1},execute:async a=>{const o=a.params&&a.params.url;if(!o){n("No URL provided.");return}const d=await f.getWorkspace();if(!d){n("No workspace selected.");return}await w.runAsync("Downloading file",async r=>{r.message="Starting download...",r.progress=0;try{const i=await fetch(o,{mode:"cors",credentials:"omit"});if(!i.ok){n("Failed to download file: "+i.statusText);return}let t=a.params&&a.params.filename;if(!t){const s=i.headers.get("content-disposition");if(s){let e=s.match(/filename="([^"]+)"/);e&&e[1]?t=e[1]:(e=s.match(/filename=([^;]+)/),e&&e[1]&&(t=e[1].trim()))}if(!t){const e=new URL(o).pathname.split("/").filter(c=>c.length>0),l=e[e.length-1];l&&l.includes(".")?t=l:t=`downloaded-file-${new Date().toISOString().replace(/[:.]/g,"-").replace("T","_").slice(0,-5)}`}}const m=await d.getResource(t,{create:!0});r.message=`Downloading ${t}...`,r.progress=50,await m.saveContents(i.body,{contentType:u.BINARY}),r.progress=100,h(`File downloaded: ${t}`)}catch(i){throw n("Failed to download file: "+i),i}})}}});
