const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/git-extension-BI3B_Opd-kjl5sV8T.js","assets/preload-helper-WQhrSmCl.js","assets/chunk.LTSJC6DR-BCCP1Gxs.js","assets/pyterminal-extension-DuNmMRB0-CW36muxI.js","assets/xterm-CODBi7oP.js","assets/k-linuxterminal-C2332gGT-JB4af1LW.js","assets/webllmservice-B6R9uiIw-CQU2TnL8.js","assets/p12-splitter-YgDzLvd--B0Zr9rWX.js","assets/package-manager-extension-Bb1gA_o0-Dqa3LTk3.js","assets/notebook-extension-DCTEZLZK-CTZBl0os.js","assets/editor.main-BQC7qDWR.js","assets/editor-Dvl_Svmm.css","assets/command-palette-extension-CMSgFxB5-TYmhpMnZ.js","assets/download-extension-wVyZTJUS-DYLfOw4u.js","assets/unzip-extension-C0R1j7RZ-CcaaAHpS.js","assets/_commonjs-dynamic-modules-TDtrdbi3.js","assets/md-editor-extension-EKtXclAM-DdEXob9G.js","assets/media-viewer-extension-BiHd9Ilz-oP73UMpy.js","assets/monaco-editor-extension-DDiTiYIe-CvL4tWZ2.js","assets/memory-usage-extension-5WVlmkEK-DbcXgiRa.js","assets/webdav-extension-DMycsJok-8nOFu50H.js","assets/settings-tree-extension-D_VN3kNz-DxqK0WOo.js","assets/in-browser-ml-extension-BaJ20GOA-CrVEJQCS.js","assets/ai-system-extension-BvfJqFsN-Cnc_fQBN.js","assets/rag-system-extension-CvV0yerw-Dmht2lIM.js","assets/howto-extension-5oWlvyk1-CL0loxVQ.js","assets/raw-in9isEBO.js","assets/basedecoder-B2c5_Eok.js","assets/lzw-_aCqfs4w.js","assets/jpeg-vtRboCKw.js","assets/deflate-B9JhHpvg.js","assets/pako.esm-Cram60i4.js","assets/packbits-DDWKfGV_.js","assets/lerc-EvD1--I0.js","assets/webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
import{_ as __vitePreload,a as getAugmentedNamespace,g as getDefaultExportFromCjs$1}from"./preload-helper-WQhrSmCl.js";import{r as registerIconLibrary,w as watchIcon,u as unwatchIcon,g as getIconLibrary,a as getDefaultIconFamily,L as LocalizeController}from"./chunk.LTSJC6DR-BCCP1Gxs.js";function _mergeNamespaces(ee,O){for(var Y=0;Y<O.length;Y++){const te=O[Y];if(typeof te!="string"&&!Array.isArray(te)){for(const ne in te)if(ne!=="default"&&!(ne in ee)){const xe=Object.getOwnPropertyDescriptor(te,ne);xe&&Object.defineProperty(ee,ne,xe.get?xe:{enumerable:!0,get:()=>te[ne]})}}}return Object.freeze(Object.defineProperty(ee,Symbol.toStringTag,{value:"Module"}))}const bounce=[{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},{offset:.2,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},{offset:.4,easing:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -30px, 0) scaleY(1.1)"},{offset:.43,easing:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -30px, 0) scaleY(1.1)"},{offset:.53,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},{offset:.7,easing:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -15px, 0) scaleY(1.05)"},{offset:.8,"transition-timing-function":"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0) scaleY(0.95)"},{offset:.9,transform:"translate3d(0, -4px, 0) scaleY(1.02)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"}],flash=[{offset:0,opacity:"1"},{offset:.25,opacity:"0"},{offset:.5,opacity:"1"},{offset:.75,opacity:"0"},{offset:1,opacity:"1"}],headShake=[{offset:0,transform:"translateX(0)"},{offset:.065,transform:"translateX(-6px) rotateY(-9deg)"},{offset:.185,transform:"translateX(5px) rotateY(7deg)"},{offset:.315,transform:"translateX(-3px) rotateY(-5deg)"},{offset:.435,transform:"translateX(2px) rotateY(3deg)"},{offset:.5,transform:"translateX(0)"}],heartBeat=[{offset:0,transform:"scale(1)"},{offset:.14,transform:"scale(1.3)"},{offset:.28,transform:"scale(1)"},{offset:.42,transform:"scale(1.3)"},{offset:.7,transform:"scale(1)"}],jello=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.111,transform:"translate3d(0, 0, 0)"},{offset:.222,transform:"skewX(-12.5deg) skewY(-12.5deg)"},{offset:.33299999999999996,transform:"skewX(6.25deg) skewY(6.25deg)"},{offset:.444,transform:"skewX(-3.125deg) skewY(-3.125deg)"},{offset:.555,transform:"skewX(1.5625deg) skewY(1.5625deg)"},{offset:.6659999999999999,transform:"skewX(-0.78125deg) skewY(-0.78125deg)"},{offset:.777,transform:"skewX(0.390625deg) skewY(0.390625deg)"},{offset:.888,transform:"skewX(-0.1953125deg) skewY(-0.1953125deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],pulse=[{offset:0,transform:"scale3d(1, 1, 1)"},{offset:.5,transform:"scale3d(1.05, 1.05, 1.05)"},{offset:1,transform:"scale3d(1, 1, 1)"}],rubberBand=[{offset:0,transform:"scale3d(1, 1, 1)"},{offset:.3,transform:"scale3d(1.25, 0.75, 1)"},{offset:.4,transform:"scale3d(0.75, 1.25, 1)"},{offset:.5,transform:"scale3d(1.15, 0.85, 1)"},{offset:.65,transform:"scale3d(0.95, 1.05, 1)"},{offset:.75,transform:"scale3d(1.05, 0.95, 1)"},{offset:1,transform:"scale3d(1, 1, 1)"}],shake=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.1,transform:"translate3d(-10px, 0, 0)"},{offset:.2,transform:"translate3d(10px, 0, 0)"},{offset:.3,transform:"translate3d(-10px, 0, 0)"},{offset:.4,transform:"translate3d(10px, 0, 0)"},{offset:.5,transform:"translate3d(-10px, 0, 0)"},{offset:.6,transform:"translate3d(10px, 0, 0)"},{offset:.7,transform:"translate3d(-10px, 0, 0)"},{offset:.8,transform:"translate3d(10px, 0, 0)"},{offset:.9,transform:"translate3d(-10px, 0, 0)"},{offset:1,transform:"translate3d(0, 0, 0)"}],shakeX=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.1,transform:"translate3d(-10px, 0, 0)"},{offset:.2,transform:"translate3d(10px, 0, 0)"},{offset:.3,transform:"translate3d(-10px, 0, 0)"},{offset:.4,transform:"translate3d(10px, 0, 0)"},{offset:.5,transform:"translate3d(-10px, 0, 0)"},{offset:.6,transform:"translate3d(10px, 0, 0)"},{offset:.7,transform:"translate3d(-10px, 0, 0)"},{offset:.8,transform:"translate3d(10px, 0, 0)"},{offset:.9,transform:"translate3d(-10px, 0, 0)"},{offset:1,transform:"translate3d(0, 0, 0)"}],shakeY=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.1,transform:"translate3d(0, -10px, 0)"},{offset:.2,transform:"translate3d(0, 10px, 0)"},{offset:.3,transform:"translate3d(0, -10px, 0)"},{offset:.4,transform:"translate3d(0, 10px, 0)"},{offset:.5,transform:"translate3d(0, -10px, 0)"},{offset:.6,transform:"translate3d(0, 10px, 0)"},{offset:.7,transform:"translate3d(0, -10px, 0)"},{offset:.8,transform:"translate3d(0, 10px, 0)"},{offset:.9,transform:"translate3d(0, -10px, 0)"},{offset:1,transform:"translate3d(0, 0, 0)"}],swing=[{offset:.2,transform:"rotate3d(0, 0, 1, 15deg)"},{offset:.4,transform:"rotate3d(0, 0, 1, -10deg)"},{offset:.6,transform:"rotate3d(0, 0, 1, 5deg)"},{offset:.8,transform:"rotate3d(0, 0, 1, -5deg)"},{offset:1,transform:"rotate3d(0, 0, 1, 0deg)"}],tada=[{offset:0,transform:"scale3d(1, 1, 1)"},{offset:.1,transform:"scale3d(0.9, 0.9, 0.9) rotate3d(0, 0, 1, -3deg)"},{offset:.2,transform:"scale3d(0.9, 0.9, 0.9) rotate3d(0, 0, 1, -3deg)"},{offset:.3,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:.4,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},{offset:.5,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:.6,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},{offset:.7,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:.8,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},{offset:.9,transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},{offset:1,transform:"scale3d(1, 1, 1)"}],wobble=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:.15,transform:"translate3d(-25%, 0, 0) rotate3d(0, 0, 1, -5deg)"},{offset:.3,transform:"translate3d(20%, 0, 0) rotate3d(0, 0, 1, 3deg)"},{offset:.45,transform:"translate3d(-15%, 0, 0) rotate3d(0, 0, 1, -3deg)"},{offset:.6,transform:"translate3d(10%, 0, 0) rotate3d(0, 0, 1, 2deg)"},{offset:.75,transform:"translate3d(-5%, 0, 0) rotate3d(0, 0, 1, -1deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],backInDown=[{offset:0,transform:"translateY(-1200px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],backInLeft=[{offset:0,transform:"translateX(-2000px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],backInRight=[{offset:0,transform:"translateX(2000px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],backInUp=[{offset:0,transform:"translateY(1200px) scale(0.7)",opacity:"0.7"},{offset:.8,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"scale(1)",opacity:"1"}],backOutDown=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateY(700px) scale(0.7)",opacity:"0.7"}],backOutLeft=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateX(-2000px) scale(0.7)",opacity:"0.7"}],backOutRight=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateX(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateX(2000px) scale(0.7)",opacity:"0.7"}],backOutUp=[{offset:0,transform:"scale(1)",opacity:"1"},{offset:.2,transform:"translateY(0px) scale(0.7)",opacity:"0.7"},{offset:1,transform:"translateY(-700px) scale(0.7)",opacity:"0.7"}],bounceIn=[{offset:0,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.2,transform:"scale3d(1.1, 1.1, 1.1)"},{offset:.2,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.4,transform:"scale3d(0.9, 0.9, 0.9)"},{offset:.4,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"scale3d(1.03, 1.03, 1.03)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.8,transform:"scale3d(0.97, 0.97, 0.97)"},{offset:.8,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,opacity:"1",transform:"scale3d(1, 1, 1)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],bounceInDown=[{offset:0,opacity:"0",transform:"translate3d(0, -3000px, 0) scaleY(3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(0, 25px, 0) scaleY(0.9)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(0, -10px, 0) scaleY(0.95)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(0, 5px, 0) scaleY(0.985)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],bounceInLeft=[{offset:0,opacity:"0",transform:"translate3d(-3000px, 0, 0) scaleX(3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(25px, 0, 0) scaleX(1)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(-10px, 0, 0) scaleX(0.98)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(5px, 0, 0) scaleX(0.995)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],bounceInRight=[{offset:0,opacity:"0",transform:"translate3d(3000px, 0, 0) scaleX(3)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(-25px, 0, 0) scaleX(1)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(10px, 0, 0) scaleX(0.98)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(-5px, 0, 0) scaleX(0.995)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],bounceInUp=[{offset:0,opacity:"0",transform:"translate3d(0, 3000px, 0) scaleY(5)"},{offset:0,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.6,opacity:"1",transform:"translate3d(0, -20px, 0) scaleY(0.9)"},{offset:.6,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.75,transform:"translate3d(0, 10px, 0) scaleY(0.95)"},{offset:.75,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:.9,transform:"translate3d(0, -5px, 0) scaleY(0.985)"},{offset:.9,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"},{offset:1,transform:"translate3d(0, 0, 0)"},{offset:1,easing:"cubic-bezier(0.215, 0.61, 0.355, 1)"}],bounceOut=[{offset:.2,transform:"scale3d(0.9, 0.9, 0.9)"},{offset:.5,opacity:"1",transform:"scale3d(1.1, 1.1, 1.1)"},{offset:.55,opacity:"1",transform:"scale3d(1.1, 1.1, 1.1)"},{offset:1,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"}],bounceOutDown=[{offset:.2,transform:"translate3d(0, 10px, 0) scaleY(0.985)"},{offset:.4,opacity:"1",transform:"translate3d(0, -20px, 0) scaleY(0.9)"},{offset:.45,opacity:"1",transform:"translate3d(0, -20px, 0) scaleY(0.9)"},{offset:1,opacity:"0",transform:"translate3d(0, 2000px, 0) scaleY(3)"}],bounceOutLeft=[{offset:.2,opacity:"1",transform:"translate3d(20px, 0, 0) scaleX(0.9)"},{offset:1,opacity:"0",transform:"translate3d(-2000px, 0, 0) scaleX(2)"}],bounceOutRight=[{offset:.2,opacity:"1",transform:"translate3d(-20px, 0, 0) scaleX(0.9)"},{offset:1,opacity:"0",transform:"translate3d(2000px, 0, 0) scaleX(2)"}],bounceOutUp=[{offset:.2,transform:"translate3d(0, -10px, 0) scaleY(0.985)"},{offset:.4,opacity:"1",transform:"translate3d(0, 20px, 0) scaleY(0.9)"},{offset:.45,opacity:"1",transform:"translate3d(0, 20px, 0) scaleY(0.9)"},{offset:1,opacity:"0",transform:"translate3d(0, -2000px, 0) scaleY(3)"}],fadeIn=[{offset:0,opacity:"0"},{offset:1,opacity:"1"}],fadeInBottomLeft=[{offset:0,opacity:"0",transform:"translate3d(-100%, 100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInBottomRight=[{offset:0,opacity:"0",transform:"translate3d(100%, 100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInDown=[{offset:0,opacity:"0",transform:"translate3d(0, -100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInDownBig=[{offset:0,opacity:"0",transform:"translate3d(0, -2000px, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInLeft=[{offset:0,opacity:"0",transform:"translate3d(-100%, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInLeftBig=[{offset:0,opacity:"0",transform:"translate3d(-2000px, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInRight=[{offset:0,opacity:"0",transform:"translate3d(100%, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInRightBig=[{offset:0,opacity:"0",transform:"translate3d(2000px, 0, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInTopLeft=[{offset:0,opacity:"0",transform:"translate3d(-100%, -100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInTopRight=[{offset:0,opacity:"0",transform:"translate3d(100%, -100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInUp=[{offset:0,opacity:"0",transform:"translate3d(0, 100%, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeInUpBig=[{offset:0,opacity:"0",transform:"translate3d(0, 2000px, 0)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],fadeOut=[{offset:0,opacity:"1"},{offset:1,opacity:"0"}],fadeOutBottomLeft=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(-100%, 100%, 0)"}],fadeOutBottomRight=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(100%, 100%, 0)"}],fadeOutDown=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, 100%, 0)"}],fadeOutDownBig=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, 2000px, 0)"}],fadeOutLeft=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(-100%, 0, 0)"}],fadeOutLeftBig=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(-2000px, 0, 0)"}],fadeOutRight=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(100%, 0, 0)"}],fadeOutRightBig=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(2000px, 0, 0)"}],fadeOutTopLeft=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(-100%, -100%, 0)"}],fadeOutTopRight=[{offset:0,opacity:"1",transform:"translate3d(0, 0, 0)"},{offset:1,opacity:"0",transform:"translate3d(100%, -100%, 0)"}],fadeOutUp=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, -100%, 0)"}],fadeOutUpBig=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(0, -2000px, 0)"}],flip$2=[{offset:0,transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 0) rotate3d(0, 1, 0, -360deg)",easing:"ease-out"},{offset:.4,transform:`perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 150px)
      rotate3d(0, 1, 0, -190deg)`,easing:"ease-out"},{offset:.5,transform:`perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 150px)
      rotate3d(0, 1, 0, -170deg)`,easing:"ease-in"},{offset:.8,transform:`perspective(400px) scale3d(0.95, 0.95, 0.95) translate3d(0, 0, 0)
      rotate3d(0, 1, 0, 0deg)`,easing:"ease-in"},{offset:1,transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 0) rotate3d(0, 1, 0, 0deg)",easing:"ease-in"}],flipInX=[{offset:0,transform:"perspective(400px) rotate3d(1, 0, 0, 90deg)",easing:"ease-in",opacity:"0"},{offset:.4,transform:"perspective(400px) rotate3d(1, 0, 0, -20deg)",easing:"ease-in"},{offset:.6,transform:"perspective(400px) rotate3d(1, 0, 0, 10deg)",opacity:"1"},{offset:.8,transform:"perspective(400px) rotate3d(1, 0, 0, -5deg)"},{offset:1,transform:"perspective(400px)"}],flipInY=[{offset:0,transform:"perspective(400px) rotate3d(0, 1, 0, 90deg)",easing:"ease-in",opacity:"0"},{offset:.4,transform:"perspective(400px) rotate3d(0, 1, 0, -20deg)",easing:"ease-in"},{offset:.6,transform:"perspective(400px) rotate3d(0, 1, 0, 10deg)",opacity:"1"},{offset:.8,transform:"perspective(400px) rotate3d(0, 1, 0, -5deg)"},{offset:1,transform:"perspective(400px)"}],flipOutX=[{offset:0,transform:"perspective(400px)"},{offset:.3,transform:"perspective(400px) rotate3d(1, 0, 0, -20deg)",opacity:"1"},{offset:1,transform:"perspective(400px) rotate3d(1, 0, 0, 90deg)",opacity:"0"}],flipOutY=[{offset:0,transform:"perspective(400px)"},{offset:.3,transform:"perspective(400px) rotate3d(0, 1, 0, -15deg)",opacity:"1"},{offset:1,transform:"perspective(400px) rotate3d(0, 1, 0, 90deg)",opacity:"0"}],lightSpeedInLeft=[{offset:0,transform:"translate3d(-100%, 0, 0) skewX(30deg)",opacity:"0"},{offset:.6,transform:"skewX(-20deg)",opacity:"1"},{offset:.8,transform:"skewX(5deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],lightSpeedInRight=[{offset:0,transform:"translate3d(100%, 0, 0) skewX(-30deg)",opacity:"0"},{offset:.6,transform:"skewX(20deg)",opacity:"1"},{offset:.8,transform:"skewX(-5deg)"},{offset:1,transform:"translate3d(0, 0, 0)"}],lightSpeedOutLeft=[{offset:0,opacity:"1"},{offset:1,transform:"translate3d(-100%, 0, 0) skewX(-30deg)",opacity:"0"}],lightSpeedOutRight=[{offset:0,opacity:"1"},{offset:1,transform:"translate3d(100%, 0, 0) skewX(30deg)",opacity:"0"}],rotateIn=[{offset:0,transform:"rotate3d(0, 0, 1, -200deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],rotateInDownLeft=[{offset:0,transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],rotateInDownRight=[{offset:0,transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],rotateInUpLeft=[{offset:0,transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],rotateInUpRight=[{offset:0,transform:"rotate3d(0, 0, 1, -90deg)",opacity:"0"},{offset:1,transform:"translate3d(0, 0, 0)",opacity:"1"}],rotateOut=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, 200deg)",opacity:"0"}],rotateOutDownLeft=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"}],rotateOutDownRight=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"}],rotateOutUpLeft=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"}],rotateOutUpRight=[{offset:0,opacity:"1"},{offset:1,transform:"rotate3d(0, 0, 1, 90deg)",opacity:"0"}],slideInDown=[{offset:0,transform:"translate3d(0, -100%, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],slideInLeft=[{offset:0,transform:"translate3d(-100%, 0, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],slideInRight=[{offset:0,transform:"translate3d(100%, 0, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],slideInUp=[{offset:0,transform:"translate3d(0, 100%, 0)",visibility:"visible"},{offset:1,transform:"translate3d(0, 0, 0)"}],slideOutDown=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(0, 100%, 0)"}],slideOutLeft=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(-100%, 0, 0)"}],slideOutRight=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(100%, 0, 0)"}],slideOutUp=[{offset:0,transform:"translate3d(0, 0, 0)"},{offset:1,visibility:"hidden",transform:"translate3d(0, -100%, 0)"}],hinge=[{offset:0,easing:"ease-in-out"},{offset:.2,transform:"rotate3d(0, 0, 1, 80deg)",easing:"ease-in-out"},{offset:.4,transform:"rotate3d(0, 0, 1, 60deg)",easing:"ease-in-out",opacity:"1"},{offset:.6,transform:"rotate3d(0, 0, 1, 80deg)",easing:"ease-in-out"},{offset:.8,transform:"rotate3d(0, 0, 1, 60deg)",easing:"ease-in-out",opacity:"1"},{offset:1,transform:"translate3d(0, 700px, 0)",opacity:"0"}],jackInTheBox=[{offset:0,opacity:"0",transform:"scale(0.1) rotate(30deg)","transform-origin":"center bottom"},{offset:.5,transform:"rotate(-10deg)"},{offset:.7,transform:"rotate(3deg)"},{offset:1,opacity:"1",transform:"scale(1)"}],rollIn=[{offset:0,opacity:"0",transform:"translate3d(-100%, 0, 0) rotate3d(0, 0, 1, -120deg)"},{offset:1,opacity:"1",transform:"translate3d(0, 0, 0)"}],rollOut=[{offset:0,opacity:"1"},{offset:1,opacity:"0",transform:"translate3d(100%, 0, 0) rotate3d(0, 0, 1, 120deg)"}],zoomIn=[{offset:0,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},{offset:.5,opacity:"1"}],zoomInDown=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, -1000px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, 60px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],zoomInLeft=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(-1000px, 0, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(10px, 0, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],zoomInRight=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(1000px, 0, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(-10px, 0, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],zoomInUp=[{offset:0,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, 1000px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:.6,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, -60px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],zoomOut=[{offset:0,opacity:"1"},{offset:.5,opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},{offset:1,opacity:"0"}],zoomOutDown=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, -60px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:1,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, 2000px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],zoomOutLeft=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(42px, 0, 0)"},{offset:1,opacity:"0",transform:"scale(0.1) translate3d(-2000px, 0, 0)"}],zoomOutRight=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(-42px, 0, 0)"},{offset:1,opacity:"0",transform:"scale(0.1) translate3d(2000px, 0, 0)"}],zoomOutUp=[{offset:.4,opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, 60px, 0)",easing:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},{offset:1,opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, -2000px, 0)",easing:"cubic-bezier(0.175, 0.885, 0.32, 1)"}],easings={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",easeInSine:"cubic-bezier(0.47, 0, 0.745, 0.715)",easeOutSine:"cubic-bezier(0.39, 0.575, 0.565, 1)",easeInOutSine:"cubic-bezier(0.445, 0.05, 0.55, 0.95)",easeInQuad:"cubic-bezier(0.55, 0.085, 0.68, 0.53)",easeOutQuad:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",easeInOutQuad:"cubic-bezier(0.455, 0.03, 0.515, 0.955)",easeInCubic:"cubic-bezier(0.55, 0.055, 0.675, 0.19)",easeOutCubic:"cubic-bezier(0.215, 0.61, 0.355, 1)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1)",easeInQuart:"cubic-bezier(0.895, 0.03, 0.685, 0.22)",easeOutQuart:"cubic-bezier(0.165, 0.84, 0.44, 1)",easeInOutQuart:"cubic-bezier(0.77, 0, 0.175, 1)",easeInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",easeOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",easeInOutQuint:"cubic-bezier(0.86, 0, 0.07, 1)",easeInExpo:"cubic-bezier(0.95, 0.05, 0.795, 0.035)",easeOutExpo:"cubic-bezier(0.19, 1, 0.22, 1)",easeInOutExpo:"cubic-bezier(1, 0, 0, 1)",easeInCirc:"cubic-bezier(0.6, 0.04, 0.98, 0.335)",easeOutCirc:"cubic-bezier(0.075, 0.82, 0.165, 1)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.15, 0.86)",easeInBack:"cubic-bezier(0.6, -0.28, 0.735, 0.045)",easeOutBack:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",easeInOutBack:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},animations=Object.freeze(Object.defineProperty({__proto__:null,backInDown,backInLeft,backInRight,backInUp,backOutDown,backOutLeft,backOutRight,backOutUp,bounce,bounceIn,bounceInDown,bounceInLeft,bounceInRight,bounceInUp,bounceOut,bounceOutDown,bounceOutLeft,bounceOutRight,bounceOutUp,easings,fadeIn,fadeInBottomLeft,fadeInBottomRight,fadeInDown,fadeInDownBig,fadeInLeft,fadeInLeftBig,fadeInRight,fadeInRightBig,fadeInTopLeft,fadeInTopRight,fadeInUp,fadeInUpBig,fadeOut,fadeOutBottomLeft,fadeOutBottomRight,fadeOutDown,fadeOutDownBig,fadeOutLeft,fadeOutLeftBig,fadeOutRight,fadeOutRightBig,fadeOutTopLeft,fadeOutTopRight,fadeOutUp,fadeOutUpBig,flash,flip:flip$2,flipInX,flipInY,flipOutX,flipOutY,headShake,heartBeat,hinge,jackInTheBox,jello,lightSpeedInLeft,lightSpeedInRight,lightSpeedOutLeft,lightSpeedOutRight,pulse,rollIn,rollOut,rotateIn,rotateInDownLeft,rotateInDownRight,rotateInUpLeft,rotateInUpRight,rotateOut,rotateOutDownLeft,rotateOutDownRight,rotateOutUpLeft,rotateOutUpRight,rubberBand,shake,shakeX,shakeY,slideInDown,slideInLeft,slideInRight,slideInUp,slideOutDown,slideOutLeft,slideOutRight,slideOutUp,swing,tada,wobble,zoomIn,zoomInDown,zoomInLeft,zoomInRight,zoomInUp,zoomOut,zoomOutDown,zoomOutLeft,zoomOutRight,zoomOutUp},Symbol.toStringTag,{value:"Module"}));var __defProp$c=Object.defineProperty,__getOwnPropDesc$d=Object.getOwnPropertyDescriptor,__typeError=ee=>{throw TypeError(ee)},__decorateClass$d=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$d(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$c(O,Y,ne),ne},__accessCheck$1=(ee,O,Y)=>O.has(ee)||__typeError("Cannot "+Y),__privateGet=(ee,O,Y)=>(__accessCheck$1(ee,O,"read from private field"),O.get(ee)),__privateAdd$1=(ee,O,Y)=>O.has(ee)?__typeError("Cannot add the same private member more than once"):O instanceof WeakSet?O.add(ee):O.set(ee,Y),__privateSet=(ee,O,Y,te)=>(__accessCheck$1(ee,O,"write to private field"),O.set(ee,Y),Y);const t$d=globalThis,e$d=t$d.ShadowRoot&&(t$d.ShadyCSS===void 0||t$d.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s$6=Symbol(),o$e=new WeakMap;let n$b=class{constructor(O,Y,te){if(this._$cssResult$=!0,te!==s$6)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=O,this.t=Y}get styleSheet(){let O=this.o;const Y=this.t;if(e$d&&O===void 0){const te=Y!==void 0&&Y.length===1;te&&(O=o$e.get(Y)),O===void 0&&((this.o=O=new CSSStyleSheet).replaceSync(this.cssText),te&&o$e.set(Y,O))}return O}toString(){return this.cssText}};const r$a=ee=>new n$b(typeof ee=="string"?ee:ee+"",void 0,s$6),i$c=(ee,...O)=>{const Y=ee.length===1?ee[0]:O.reduce(((te,ne,xe)=>te+(et=>{if(et._$cssResult$===!0)return et.cssText;if(typeof et=="number")return et;throw Error("Value passed to 'css' function must be a 'css' function result: "+et+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(ne)+ee[xe+1]),ee[0]);return new n$b(Y,ee,s$6)},S$2=(ee,O)=>{if(e$d)ee.adoptedStyleSheets=O.map((Y=>Y instanceof CSSStyleSheet?Y:Y.styleSheet));else for(const Y of O){const te=document.createElement("style"),ne=t$d.litNonce;ne!==void 0&&te.setAttribute("nonce",ne),te.textContent=Y.cssText,ee.appendChild(te)}},c$5=e$d?ee=>ee:ee=>ee instanceof CSSStyleSheet?(O=>{let Y="";for(const te of O.cssRules)Y+=te.cssText;return r$a(Y)})(ee):ee;const{is:i$b,defineProperty:e$c,getOwnPropertyDescriptor:h$7,getOwnPropertyNames:r$9,getOwnPropertySymbols:o$d,getPrototypeOf:n$a}=Object,a$2=globalThis,c$4=a$2.trustedTypes,l$4=c$4?c$4.emptyScript:"",p$2=a$2.reactiveElementPolyfillSupport,d$3=(ee,O)=>ee,u$4={toAttribute(ee,O){switch(O){case Boolean:ee=ee?l$4:null;break;case Object:case Array:ee=ee==null?ee:JSON.stringify(ee)}return ee},fromAttribute(ee,O){let Y=ee;switch(O){case Boolean:Y=ee!==null;break;case Number:Y=ee===null?null:Number(ee);break;case Object:case Array:try{Y=JSON.parse(ee)}catch{Y=null}}return Y}},f$3=(ee,O)=>!i$b(ee,O),b$2={attribute:!0,type:String,converter:u$4,reflect:!1,useDefault:!1,hasChanged:f$3};Symbol.metadata??=Symbol("metadata"),a$2.litPropertyMetadata??=new WeakMap;let y$2=class extends HTMLElement{static addInitializer(O){this._$Ei(),(this.l??=[]).push(O)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(O,Y=b$2){if(Y.state&&(Y.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(O)&&((Y=Object.create(Y)).wrapped=!0),this.elementProperties.set(O,Y),!Y.noAccessor){const te=Symbol(),ne=this.getPropertyDescriptor(O,te,Y);ne!==void 0&&e$c(this.prototype,O,ne)}}static getPropertyDescriptor(O,Y,te){const{get:ne,set:xe}=h$7(this.prototype,O)??{get(){return this[Y]},set(et){this[Y]=et}};return{get:ne,set(et){const tt=ne?.call(this);xe?.call(this,et),this.requestUpdate(O,tt,te)},configurable:!0,enumerable:!0}}static getPropertyOptions(O){return this.elementProperties.get(O)??b$2}static _$Ei(){if(this.hasOwnProperty(d$3("elementProperties")))return;const O=n$a(this);O.finalize(),O.l!==void 0&&(this.l=[...O.l]),this.elementProperties=new Map(O.elementProperties)}static finalize(){if(this.hasOwnProperty(d$3("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d$3("properties"))){const Y=this.properties,te=[...r$9(Y),...o$d(Y)];for(const ne of te)this.createProperty(ne,Y[ne])}const O=this[Symbol.metadata];if(O!==null){const Y=litPropertyMetadata.get(O);if(Y!==void 0)for(const[te,ne]of Y)this.elementProperties.set(te,ne)}this._$Eh=new Map;for(const[Y,te]of this.elementProperties){const ne=this._$Eu(Y,te);ne!==void 0&&this._$Eh.set(ne,Y)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(O){const Y=[];if(Array.isArray(O)){const te=new Set(O.flat(1/0).reverse());for(const ne of te)Y.unshift(c$5(ne))}else O!==void 0&&Y.push(c$5(O));return Y}static _$Eu(O,Y){const te=Y.attribute;return te===!1?void 0:typeof te=="string"?te:typeof O=="string"?O.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((O=>this.enableUpdating=O)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((O=>O(this)))}addController(O){(this._$EO??=new Set).add(O),this.renderRoot!==void 0&&this.isConnected&&O.hostConnected?.()}removeController(O){this._$EO?.delete(O)}_$E_(){const O=new Map,Y=this.constructor.elementProperties;for(const te of Y.keys())this.hasOwnProperty(te)&&(O.set(te,this[te]),delete this[te]);O.size>0&&(this._$Ep=O)}createRenderRoot(){const O=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return S$2(O,this.constructor.elementStyles),O}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((O=>O.hostConnected?.()))}enableUpdating(O){}disconnectedCallback(){this._$EO?.forEach((O=>O.hostDisconnected?.()))}attributeChangedCallback(O,Y,te){this._$AK(O,te)}_$ET(O,Y){const te=this.constructor.elementProperties.get(O),ne=this.constructor._$Eu(O,te);if(ne!==void 0&&te.reflect===!0){const xe=(te.converter?.toAttribute!==void 0?te.converter:u$4).toAttribute(Y,te.type);this._$Em=O,xe==null?this.removeAttribute(ne):this.setAttribute(ne,xe),this._$Em=null}}_$AK(O,Y){const te=this.constructor,ne=te._$Eh.get(O);if(ne!==void 0&&this._$Em!==ne){const xe=te.getPropertyOptions(ne),et=typeof xe.converter=="function"?{fromAttribute:xe.converter}:xe.converter?.fromAttribute!==void 0?xe.converter:u$4;this._$Em=ne;const tt=et.fromAttribute(Y,xe.type);this[ne]=tt??this._$Ej?.get(ne)??tt,this._$Em=null}}requestUpdate(O,Y,te){if(O!==void 0){const ne=this.constructor,xe=this[O];if(te??=ne.getPropertyOptions(O),!((te.hasChanged??f$3)(xe,Y)||te.useDefault&&te.reflect&&xe===this._$Ej?.get(O)&&!this.hasAttribute(ne._$Eu(O,te))))return;this.C(O,Y,te)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(O,Y,{useDefault:te,reflect:ne,wrapped:xe},et){te&&!(this._$Ej??=new Map).has(O)&&(this._$Ej.set(O,et??Y??this[O]),xe!==!0||et!==void 0)||(this._$AL.has(O)||(this.hasUpdated||te||(Y=void 0),this._$AL.set(O,Y)),ne===!0&&this._$Em!==O&&(this._$Eq??=new Set).add(O))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(Y){Promise.reject(Y)}const O=this.scheduleUpdate();return O!=null&&await O,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[ne,xe]of this._$Ep)this[ne]=xe;this._$Ep=void 0}const te=this.constructor.elementProperties;if(te.size>0)for(const[ne,xe]of te){const{wrapped:et}=xe,tt=this[ne];et!==!0||this._$AL.has(ne)||tt===void 0||this.C(ne,void 0,xe,tt)}}let O=!1;const Y=this._$AL;try{O=this.shouldUpdate(Y),O?(this.willUpdate(Y),this._$EO?.forEach((te=>te.hostUpdate?.())),this.update(Y)):this._$EM()}catch(te){throw O=!1,this._$EM(),te}O&&this._$AE(Y)}willUpdate(O){}_$AE(O){this._$EO?.forEach((Y=>Y.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(O)),this.updated(O)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(O){return!0}update(O){this._$Eq&&=this._$Eq.forEach((Y=>this._$ET(Y,this[Y]))),this._$EM()}updated(O){}firstUpdated(O){}};y$2.elementStyles=[],y$2.shadowRootOptions={mode:"open"},y$2[d$3("elementProperties")]=new Map,y$2[d$3("finalized")]=new Map,p$2?.({ReactiveElement:y$2}),(a$2.reactiveElementVersions??=[]).push("2.1.1");const t$c=globalThis,i$a=t$c.trustedTypes,s$5=i$a?i$a.createPolicy("lit-html",{createHTML:ee=>ee}):void 0,e$b="$lit$",h$6=`lit$${Math.random().toFixed(9).slice(2)}$`,o$c="?"+h$6,n$9=`<${o$c}>`,r$8=document,l$3=()=>r$8.createComment(""),c$3=ee=>ee===null||typeof ee!="object"&&typeof ee!="function",a$1=Array.isArray,u$3=ee=>a$1(ee)||typeof ee?.[Symbol.iterator]=="function",d$2=`[ 	
\f\r]`,f$2=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v$2=/-->/g,_$1=/>/g,m$3=RegExp(`>|${d$2}(?:([^\\s"'>=/]+)(${d$2}*=${d$2}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),p$1=/'/g,g=/"/g,$$1=/^(?:script|style|textarea|title)$/i,y$1=ee=>(O,...Y)=>({_$litType$:ee,strings:O,values:Y}),x$1=y$1(1),b$1=y$1(2),w$1=y$1(3),T$1=Symbol.for("lit-noChange"),E$2=Symbol.for("lit-nothing"),A=new WeakMap,C$1=r$8.createTreeWalker(r$8,129);function P$1(ee,O){if(!a$1(ee)||!ee.hasOwnProperty("raw"))throw Error("invalid template strings array");return s$5!==void 0?s$5.createHTML(O):O}const V$1=(ee,O)=>{const Y=ee.length-1,te=[];let ne,xe=O===2?"<svg>":O===3?"<math>":"",et=f$2;for(let tt=0;tt<Y;tt++){const it=ee[tt];let st,ot,rt=-1,nt=0;for(;nt<it.length&&(et.lastIndex=nt,ot=et.exec(it),ot!==null);)nt=et.lastIndex,et===f$2?ot[1]==="!--"?et=v$2:ot[1]!==void 0?et=_$1:ot[2]!==void 0?($$1.test(ot[2])&&(ne=RegExp("</"+ot[2],"g")),et=m$3):ot[3]!==void 0&&(et=m$3):et===m$3?ot[0]===">"?(et=ne??f$2,rt=-1):ot[1]===void 0?rt=-2:(rt=et.lastIndex-ot[2].length,st=ot[1],et=ot[3]===void 0?m$3:ot[3]==='"'?g:p$1):et===g||et===p$1?et=m$3:et===v$2||et===_$1?et=f$2:(et=m$3,ne=void 0);const at=et===m$3&&ee[tt+1].startsWith("/>")?" ":"";xe+=et===f$2?it+n$9:rt>=0?(te.push(st),it.slice(0,rt)+e$b+it.slice(rt)+h$6+at):it+h$6+(rt===-2?tt:at)}return[P$1(ee,xe+(ee[Y]||"<?>")+(O===2?"</svg>":O===3?"</math>":"")),te]};let N$1=class mi{constructor({strings:O,_$litType$:Y},te){let ne;this.parts=[];let xe=0,et=0;const tt=O.length-1,it=this.parts,[st,ot]=V$1(O,Y);if(this.el=mi.createElement(st,te),C$1.currentNode=this.el.content,Y===2||Y===3){const rt=this.el.content.firstChild;rt.replaceWith(...rt.childNodes)}for(;(ne=C$1.nextNode())!==null&&it.length<tt;){if(ne.nodeType===1){if(ne.hasAttributes())for(const rt of ne.getAttributeNames())if(rt.endsWith(e$b)){const nt=ot[et++],at=ne.getAttribute(rt).split(h$6),ct=/([.?@])?(.*)/.exec(nt);it.push({type:1,index:xe,name:ct[2],strings:at,ctor:ct[1]==="."?H:ct[1]==="?"?I$1:ct[1]==="@"?L$1:k$1}),ne.removeAttribute(rt)}else rt.startsWith(h$6)&&(it.push({type:6,index:xe}),ne.removeAttribute(rt));if($$1.test(ne.tagName)){const rt=ne.textContent.split(h$6),nt=rt.length-1;if(nt>0){ne.textContent=i$a?i$a.emptyScript:"";for(let at=0;at<nt;at++)ne.append(rt[at],l$3()),C$1.nextNode(),it.push({type:2,index:++xe});ne.append(rt[nt],l$3())}}}else if(ne.nodeType===8)if(ne.data===o$c)it.push({type:2,index:xe});else{let rt=-1;for(;(rt=ne.data.indexOf(h$6,rt+1))!==-1;)it.push({type:7,index:xe}),rt+=h$6.length-1}xe++}}static createElement(O,Y){const te=r$8.createElement("template");return te.innerHTML=O,te}};function S$1(ee,O,Y=ee,te){if(O===T$1)return O;let ne=te!==void 0?Y._$Co?.[te]:Y._$Cl;const xe=c$3(O)?void 0:O._$litDirective$;return ne?.constructor!==xe&&(ne?._$AO?.(!1),xe===void 0?ne=void 0:(ne=new xe(ee),ne._$AT(ee,Y,te)),te!==void 0?(Y._$Co??=[])[te]=ne:Y._$Cl=ne),ne!==void 0&&(O=S$1(ee,ne._$AS(ee,O.values),ne,te)),O}let M$3=class{constructor(O,Y){this._$AV=[],this._$AN=void 0,this._$AD=O,this._$AM=Y}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(O){const{el:{content:Y},parts:te}=this._$AD,ne=(O?.creationScope??r$8).importNode(Y,!0);C$1.currentNode=ne;let xe=C$1.nextNode(),et=0,tt=0,it=te[0];for(;it!==void 0;){if(et===it.index){let st;it.type===2?st=new R$1(xe,xe.nextSibling,this,O):it.type===1?st=new it.ctor(xe,it.name,it.strings,this,O):it.type===6&&(st=new z$1(xe,this,O)),this._$AV.push(st),it=te[++tt]}et!==it?.index&&(xe=C$1.nextNode(),et++)}return C$1.currentNode=r$8,ne}p(O){let Y=0;for(const te of this._$AV)te!==void 0&&(te.strings!==void 0?(te._$AI(O,te,Y),Y+=te.strings.length-2):te._$AI(O[Y])),Y++}},R$1=class yi{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(O,Y,te,ne){this.type=2,this._$AH=E$2,this._$AN=void 0,this._$AA=O,this._$AB=Y,this._$AM=te,this.options=ne,this._$Cv=ne?.isConnected??!0}get parentNode(){let O=this._$AA.parentNode;const Y=this._$AM;return Y!==void 0&&O?.nodeType===11&&(O=Y.parentNode),O}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(O,Y=this){O=S$1(this,O,Y),c$3(O)?O===E$2||O==null||O===""?(this._$AH!==E$2&&this._$AR(),this._$AH=E$2):O!==this._$AH&&O!==T$1&&this._(O):O._$litType$!==void 0?this.$(O):O.nodeType!==void 0?this.T(O):u$3(O)?this.k(O):this._(O)}O(O){return this._$AA.parentNode.insertBefore(O,this._$AB)}T(O){this._$AH!==O&&(this._$AR(),this._$AH=this.O(O))}_(O){this._$AH!==E$2&&c$3(this._$AH)?this._$AA.nextSibling.data=O:this.T(r$8.createTextNode(O)),this._$AH=O}$(O){const{values:Y,_$litType$:te}=O,ne=typeof te=="number"?this._$AC(O):(te.el===void 0&&(te.el=N$1.createElement(P$1(te.h,te.h[0]),this.options)),te);if(this._$AH?._$AD===ne)this._$AH.p(Y);else{const xe=new M$3(ne,this),et=xe.u(this.options);xe.p(Y),this.T(et),this._$AH=xe}}_$AC(O){let Y=A.get(O.strings);return Y===void 0&&A.set(O.strings,Y=new N$1(O)),Y}k(O){a$1(this._$AH)||(this._$AH=[],this._$AR());const Y=this._$AH;let te,ne=0;for(const xe of O)ne===Y.length?Y.push(te=new yi(this.O(l$3()),this.O(l$3()),this,this.options)):te=Y[ne],te._$AI(xe),ne++;ne<Y.length&&(this._$AR(te&&te._$AB.nextSibling,ne),Y.length=ne)}_$AR(O=this._$AA.nextSibling,Y){for(this._$AP?.(!1,!0,Y);O!==this._$AB;){const te=O.nextSibling;O.remove(),O=te}}setConnected(O){this._$AM===void 0&&(this._$Cv=O,this._$AP?.(O))}},k$1=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(O,Y,te,ne,xe){this.type=1,this._$AH=E$2,this._$AN=void 0,this.element=O,this.name=Y,this._$AM=ne,this.options=xe,te.length>2||te[0]!==""||te[1]!==""?(this._$AH=Array(te.length-1).fill(new String),this.strings=te):this._$AH=E$2}_$AI(O,Y=this,te,ne){const xe=this.strings;let et=!1;if(xe===void 0)O=S$1(this,O,Y,0),et=!c$3(O)||O!==this._$AH&&O!==T$1,et&&(this._$AH=O);else{const tt=O;let it,st;for(O=xe[0],it=0;it<xe.length-1;it++)st=S$1(this,tt[te+it],Y,it),st===T$1&&(st=this._$AH[it]),et||=!c$3(st)||st!==this._$AH[it],st===E$2?O=E$2:O!==E$2&&(O+=(st??"")+xe[it+1]),this._$AH[it]=st}et&&!ne&&this.j(O)}j(O){O===E$2?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,O??"")}};class H extends k$1{constructor(){super(...arguments),this.type=3}j(O){this.element[this.name]=O===E$2?void 0:O}}let I$1=class extends k$1{constructor(){super(...arguments),this.type=4}j(O){this.element.toggleAttribute(this.name,!!O&&O!==E$2)}},L$1=class extends k$1{constructor(O,Y,te,ne,xe){super(O,Y,te,ne,xe),this.type=5}_$AI(O,Y=this){if((O=S$1(this,O,Y,0)??E$2)===T$1)return;const te=this._$AH,ne=O===E$2&&te!==E$2||O.capture!==te.capture||O.once!==te.once||O.passive!==te.passive,xe=O!==E$2&&(te===E$2||ne);ne&&this.element.removeEventListener(this.name,this,te),xe&&this.element.addEventListener(this.name,this,O),this._$AH=O}handleEvent(O){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,O):this._$AH.handleEvent(O)}},z$1=class{constructor(O,Y,te){this.element=O,this.type=6,this._$AN=void 0,this._$AM=Y,this.options=te}get _$AU(){return this._$AM._$AU}_$AI(O){S$1(this,O)}};const Z$1={M:e$b,P:h$6,A:o$c,C:1,L:V$1,R:M$3,D:u$3,V:S$1,I:R$1,H:k$1,N:I$1,U:L$1,B:H,F:z$1},j$1=t$c.litHtmlPolyfillSupport;j$1?.(N$1,R$1),(t$c.litHtmlVersions??=[]).push("3.3.1");const B$1=(ee,O,Y)=>{const te=Y?.renderBefore??O;let ne=te._$litPart$;if(ne===void 0){const xe=Y?.renderBefore??null;te._$litPart$=ne=new R$1(O.insertBefore(l$3(),xe),xe,void 0,Y??{})}return ne._$AI(ee),ne};const s$4=globalThis;let i$9=class extends y$2{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const O=super.createRenderRoot();return this.renderOptions.renderBefore??=O.firstChild,O}update(O){const Y=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(O),this._$Do=B$1(Y,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return T$1}};i$9._$litElement$=!0,i$9.finalized=!0,s$4.litElementHydrateSupport?.({LitElement:i$9});const o$b=s$4.litElementPolyfillSupport;o$b?.({LitElement:i$9});const n$8={_$AK:(ee,O,Y)=>{ee._$AK(O,Y)},_$AL:ee=>ee._$AL};(s$4.litElementVersions??=[]).push("4.2.1");const o$a=!1;const t$b=ee=>(O,Y)=>{Y!==void 0?Y.addInitializer((()=>{customElements.define(ee,O)})):customElements.define(ee,O)};const o$9={attribute:!0,type:String,converter:u$4,reflect:!1,hasChanged:f$3},r$7=(ee=o$9,O,Y)=>{const{kind:te,metadata:ne}=Y;let xe=globalThis.litPropertyMetadata.get(ne);if(xe===void 0&&globalThis.litPropertyMetadata.set(ne,xe=new Map),te==="setter"&&((ee=Object.create(ee)).wrapped=!0),xe.set(Y.name,ee),te==="accessor"){const{name:et}=Y;return{set(tt){const it=O.get.call(this);O.set.call(this,tt),this.requestUpdate(et,it,ee)},init(tt){return tt!==void 0&&this.C(et,void 0,ee,tt),tt}}}if(te==="setter"){const{name:et}=Y;return function(tt){const it=this[et];O.call(this,tt),this.requestUpdate(et,it,ee)}}throw Error("Unsupported decorator location: "+te)};function n$7(ee){return(O,Y)=>typeof Y=="object"?r$7(ee,O,Y):((te,ne,xe)=>{const et=ne.hasOwnProperty(xe);return ne.constructor.createProperty(xe,te),et?Object.getOwnPropertyDescriptor(ne,xe):void 0})(ee,O,Y)}function r$6(ee){return n$7({...ee,state:!0,attribute:!1})}function t$a(ee){return(O,Y)=>{const te=typeof O=="function"?O:O[Y];Object.assign(te,ee)}}const e$a=(ee,O,Y)=>(Y.configurable=!0,Y.enumerable=!0,Reflect.decorate&&typeof O!="object"&&Object.defineProperty(ee,O,Y),Y);function e$9(ee,O){return(Y,te,ne)=>{const xe=et=>et.renderRoot?.querySelector(ee)??null;if(O){const{get:et,set:tt}=typeof te=="object"?Y:ne??(()=>{const it=Symbol();return{get(){return this[it]},set(st){this[it]=st}}})();return e$a(Y,te,{get(){let it=et.call(this);return it===void 0&&(it=xe(this),(it!==null||this.hasUpdated)&&tt.call(this,it)),it}})}return e$a(Y,te,{get(){return xe(this)}})}}let e$8;function r$5(ee){return(O,Y)=>e$a(O,Y,{get(){return(this.renderRoot??(e$8??=document.createDocumentFragment())).querySelectorAll(ee)}})}function r$4(ee){return(O,Y)=>e$a(O,Y,{async get(){return await this.updateComplete,this.renderRoot?.querySelector(ee)??null}})}function o$8(ee){return(O,Y)=>{const{slot:te,selector:ne}=ee??{},xe="slot"+(te?`[name=${te}]`:":not([name])");return e$a(O,Y,{get(){const et=this.renderRoot?.querySelector(xe),tt=et?.assignedElements(ee)??[];return ne===void 0?tt:tt.filter((it=>it.matches(ne)))}})}}function n$6(ee){return(O,Y)=>{const{slot:te}=ee??{},ne="slot"+(te?`[name=${te}]`:":not([name])");return e$a(O,Y,{get(){return this.renderRoot?.querySelector(ne)?.assignedNodes(ee)??[]}})}}function n$5(ee,O,Y){return ee?O(ee):Y?.(ee)}const t$9={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},e$7=ee=>(...O)=>({_$litDirective$:ee,values:O});let i$8=class{constructor(O){}get _$AU(){return this._$AM._$AU}_$AT(O,Y,te){this._$Ct=O,this._$AM=Y,this._$Ci=te}_$AS(O,Y){return this.update(O,Y)}update(O,Y){return this.render(...Y)}};const{I:t$8}=Z$1,i$7=ee=>ee===null||typeof ee!="object"&&typeof ee!="function",e$6=(ee,O)=>ee?._$litType$!==void 0,l$2=ee=>ee?._$litType$?.h!=null,f$1=ee=>ee.strings===void 0,r$3=()=>document.createComment(""),s$3=(ee,O,Y)=>{const te=ee._$AA.parentNode,ne=O===void 0?ee._$AB:O._$AA;if(Y===void 0){const xe=te.insertBefore(r$3(),ne),et=te.insertBefore(r$3(),ne);Y=new t$8(xe,et,ee,ee.options)}else{const xe=Y._$AB.nextSibling,et=Y._$AM,tt=et!==ee;if(tt){let it;Y._$AQ?.(ee),Y._$AM=ee,Y._$AP!==void 0&&(it=ee._$AU)!==et._$AU&&Y._$AP(it)}if(xe!==ne||tt){let it=Y._$AA;for(;it!==xe;){const st=it.nextSibling;te.insertBefore(it,ne),it=st}}}return Y},v$1=(ee,O,Y=ee)=>(ee._$AI(O,Y),ee),u$2={},m$2=(ee,O=u$2)=>ee._$AH=O,p=ee=>ee._$AH,M$2=ee=>{ee._$AR(),ee._$AA.remove()},h$5=ee=>{ee._$AR()};const u$1=(ee,O,Y)=>{const te=new Map;for(let ne=O;ne<=Y;ne++)te.set(ee[ne],ne);return te},c$2=e$7(class extends i$8{constructor(ee){if(super(ee),ee.type!==t$9.CHILD)throw Error("repeat() can only be used in text expressions")}dt(ee,O,Y){let te;Y===void 0?Y=O:O!==void 0&&(te=O);const ne=[],xe=[];let et=0;for(const tt of ee)ne[et]=te?te(tt,et):et,xe[et]=Y(tt,et),et++;return{values:xe,keys:ne}}render(ee,O,Y){return this.dt(ee,O,Y).values}update(ee,[O,Y,te]){const ne=p(ee),{values:xe,keys:et}=this.dt(O,Y,te);if(!Array.isArray(ne))return this.ut=et,xe;const tt=this.ut??=[],it=[];let st,ot,rt=0,nt=ne.length-1,at=0,ct=xe.length-1;for(;rt<=nt&&at<=ct;)if(ne[rt]===null)rt++;else if(ne[nt]===null)nt--;else if(tt[rt]===et[at])it[at]=v$1(ne[rt],xe[at]),rt++,at++;else if(tt[nt]===et[ct])it[ct]=v$1(ne[nt],xe[ct]),nt--,ct--;else if(tt[rt]===et[ct])it[ct]=v$1(ne[rt],xe[ct]),s$3(ee,it[ct+1],ne[rt]),rt++,ct--;else if(tt[nt]===et[at])it[at]=v$1(ne[nt],xe[at]),s$3(ee,ne[rt],ne[nt]),nt--,at++;else if(st===void 0&&(st=u$1(et,at,ct),ot=u$1(tt,rt,nt)),st.has(tt[rt]))if(st.has(tt[nt])){const ut=ot.get(et[at]),dt=ut!==void 0?ne[ut]:null;if(dt===null){const ht=s$3(ee,ne[rt]);v$1(ht,xe[at]),it[at]=ht}else it[at]=v$1(dt,xe[at]),s$3(ee,ne[rt],dt),ne[ut]=null;at++}else M$2(ne[nt]),nt--;else M$2(ne[rt]),rt++;for(;at<=ct;){const ut=s$3(ee,it[ct+1]);v$1(ut,xe[at]),it[at++]=ut}for(;rt<=nt;){const ut=ne[rt++];ut!==null&&M$2(ut)}return this.ut=et,m$2(ee,it),T$1}});const i$6=e$7(class extends i$8{constructor(){super(...arguments),this.key=E$2}render(ee,O){return this.key=ee,O}update(ee,[O,Y]){return O!==this.key&&(m$2(ee),this.key=O),Y}});const e$5=e$7(class extends i$8{constructor(ee){if(super(ee),ee.type!==t$9.ATTRIBUTE||ee.name!=="class"||ee.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(ee){return" "+Object.keys(ee).filter((O=>ee[O])).join(" ")+" "}update(ee,[O]){if(this.st===void 0){this.st=new Set,ee.strings!==void 0&&(this.nt=new Set(ee.strings.join(" ").split(/\s/).filter((te=>te!==""))));for(const te in O)O[te]&&!this.nt?.has(te)&&this.st.add(te);return this.render(O)}const Y=ee.element.classList;for(const te of this.st)te in O||(Y.remove(te),this.st.delete(te));for(const te in O){const ne=!!O[te];ne===this.st.has(te)||this.nt?.has(te)||(ne?(Y.add(te),this.st.add(te)):(Y.remove(te),this.st.delete(te)))}return T$1}});const n$4="important",i$5=" !"+n$4,o$7=e$7(class extends i$8{constructor(ee){if(super(ee),ee.type!==t$9.ATTRIBUTE||ee.name!=="style"||ee.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(ee){return Object.keys(ee).reduce(((O,Y)=>{const te=ee[Y];return te==null?O:O+`${Y=Y.includes("-")?Y:Y.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${te};`}),"")}update(ee,[O]){const{style:Y}=ee.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(O)),this.render(O);for(const te of this.ft)O[te]==null&&(this.ft.delete(te),te.includes("-")?Y.removeProperty(te):Y[te]=null);for(const te in O){const ne=O[te];if(ne!=null){this.ft.add(te);const xe=typeof ne=="string"&&ne.endsWith(i$5);te.includes("-")||xe?Y.setProperty(te,xe?ne.slice(0,-11):ne,xe?n$4:""):Y[te]=ne}}return T$1}});const o$6=ee=>ee??E$2;const e$4={},i$4=e$7(class extends i$8{constructor(){super(...arguments),this.ot=e$4}render(ee,O){return O()}update(ee,[O,Y]){if(Array.isArray(O)){if(Array.isArray(this.ot)&&this.ot.length===O.length&&O.every(((te,ne)=>te===this.ot[ne])))return T$1}else if(this.ot===O)return T$1;return this.ot=Array.isArray(O)?Array.from(O):O,this.render(O,Y)}});const d$1=ee=>l$2(ee)?ee._$litType$.h:ee.strings,h$4=e$7(class extends i$8{constructor(ee){super(ee),this.et=new WeakMap}render(ee){return[ee]}update(ee,[O]){const Y=e$6(this.it)?d$1(this.it):null,te=e$6(O)?d$1(O):null;if(Y!==null&&(te===null||Y!==te)){const ne=p(ee).pop();let xe=this.et.get(Y);if(xe===void 0){const et=document.createDocumentFragment();xe=B$1(E$2,et),xe.setConnected(!1),this.et.set(Y,xe)}m$2(xe,[ne]),s$3(xe,void 0,ne)}if(te!==null){if(Y===null||Y!==te){const ne=this.et.get(te);if(ne!==void 0){const xe=p(ne).pop();h$5(ee),s$3(ee,void 0,xe),m$2(ee,[xe])}}this.it=O}else this.it=void 0;return this.render(O)}});let e$3=class extends i$8{constructor(O){if(super(O),this.it=E$2,O.type!==t$9.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(O){if(O===E$2||O==null)return this._t=void 0,this.it=O;if(O===T$1)return O;if(typeof O!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(O===this.it)return this._t;this.it=O;const Y=[O];return Y.raw=Y,this._t={_$litType$:this.constructor.resultType,strings:Y,values:[]}}};e$3.directiveName="unsafeHTML",e$3.resultType=1;const o$5=e$7(e$3);const s$2=(ee,O)=>{const Y=ee._$AN;if(Y===void 0)return!1;for(const te of Y)te._$AO?.(O,!1),s$2(te,O);return!0},o$4=ee=>{let O,Y;do{if((O=ee._$AM)===void 0)break;Y=O._$AN,Y.delete(ee),ee=O}while(Y?.size===0)},r$2=ee=>{for(let O;O=ee._$AM;ee=O){let Y=O._$AN;if(Y===void 0)O._$AN=Y=new Set;else if(Y.has(ee))break;Y.add(ee),c$1(O)}};function h$3(ee){this._$AN!==void 0?(o$4(this),this._$AM=ee,r$2(this)):this._$AM=ee}function n$3(ee,O=!1,Y=0){const te=this._$AH,ne=this._$AN;if(ne!==void 0&&ne.size!==0)if(O)if(Array.isArray(te))for(let xe=Y;xe<te.length;xe++)s$2(te[xe],!1),o$4(te[xe]);else te!=null&&(s$2(te,!1),o$4(te));else s$2(this,ee)}const c$1=ee=>{ee.type==t$9.CHILD&&(ee._$AP??=n$3,ee._$AQ??=h$3)};class f extends i$8{constructor(){super(...arguments),this._$AN=void 0}_$AT(O,Y,te){super._$AT(O,Y,te),r$2(this),this.isConnected=O._$AU}_$AO(O,Y=!0){O!==this.isConnected&&(this.isConnected=O,O?this.reconnected?.():this.disconnected?.()),Y&&(s$2(this,O),o$4(this))}setValue(O){if(f$1(this._$Ct))this._$Ct._$AI(O,this);else{const Y=[...this._$Ct._$AH];Y[this._$Ci]=O,this._$Ct._$AI(Y,this,0)}}disconnected(){}reconnected(){}}let s$1=class{constructor(O){this.G=O}disconnect(){this.G=void 0}reconnect(O){this.G=O}deref(){return this.G}},i$3=class{constructor(){this.Y=void 0,this.Z=void 0}get(){return this.Y}pause(){this.Y??=new Promise((O=>this.Z=O))}resume(){this.Z?.(),this.Y=this.Z=void 0}};const n$2=ee=>!i$7(ee)&&typeof ee.then=="function",h$2=1073741823;class c extends f{constructor(){super(...arguments),this._$Cwt=h$2,this._$Cbt=[],this._$CK=new s$1(this),this._$CX=new i$3}render(...O){return O.find((Y=>!n$2(Y)))??T$1}update(O,Y){const te=this._$Cbt;let ne=te.length;this._$Cbt=Y;const xe=this._$CK,et=this._$CX;this.isConnected||this.disconnected();for(let tt=0;tt<Y.length&&!(tt>this._$Cwt);tt++){const it=Y[tt];if(!n$2(it))return this._$Cwt=tt,it;tt<ne&&it===te[tt]||(this._$Cwt=h$2,ne=0,Promise.resolve(it).then((async st=>{for(;et.get();)await et.get();const ot=xe.deref();if(ot!==void 0){const rt=ot._$Cbt.indexOf(it);rt>-1&&rt<ot._$Cwt&&(ot._$Cwt=rt,ot.setValue(st))}})))}return T$1}disconnected(){this._$CK.disconnect(),this._$CX.pause()}reconnected(){this._$CK.reconnect(this),this._$CX.resume()}}const m$1=e$7(c);const l$1=e$7(class extends i$8{constructor(ee){if(super(ee),ee.type!==t$9.PROPERTY&&ee.type!==t$9.ATTRIBUTE&&ee.type!==t$9.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!f$1(ee))throw Error("`live` bindings can only contain a single expression")}render(ee){return ee}update(ee,[O]){if(O===T$1||O===E$2)return O;const Y=ee.element,te=ee.name;if(ee.type===t$9.PROPERTY){if(O===Y[te])return T$1}else if(ee.type===t$9.BOOLEAN_ATTRIBUTE){if(!!O===Y.hasAttribute(te))return T$1}else if(ee.type===t$9.ATTRIBUTE&&Y.getAttribute(te)===O+"")return T$1;return m$2(ee),O}});const e$2=()=>new h$1;let h$1=class{};const o$3=new WeakMap,n$1=e$7(class extends f{render(ee){return E$2}update(ee,[O]){const Y=O!==this.G;return Y&&this.G!==void 0&&this.rt(void 0),(Y||this.lt!==this.ct)&&(this.G=O,this.ht=ee.options?.host,this.rt(this.ct=ee.element)),E$2}rt(ee){if(this.isConnected||(ee=void 0),typeof this.G=="function"){const O=this.ht??globalThis;let Y=o$3.get(O);Y===void 0&&(Y=new WeakMap,o$3.set(O,Y)),Y.get(this.G)!==void 0&&this.G.call(this.ht,void 0),Y.set(this.G,ee),ee!==void 0&&this.G.call(this.ht,ee)}else this.G.value=ee}get lt(){return typeof this.G=="function"?o$3.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}}),lit=Object.freeze(Object.defineProperty({__proto__:null,CSSResult:n$b,LitElement:i$9,ReactiveElement:y$2,UnsafeHTMLDirective:e$3,UntilDirective:c,_$LE:n$8,_$LH:Z$1,adoptStyles:S$2,cache:h$4,classMap:e$5,createRef:e$2,css:i$c,customElement:t$b,defaultConverter:u$4,eventOptions:t$a,getCompatibleStyle:c$5,guard:i$4,html:x$1,ifDefined:o$6,isServer:o$a,keyed:i$6,live:l$1,mathml:w$1,noChange:T$1,notEqual:f$3,nothing:E$2,property:n$7,query:e$9,queryAll:r$5,queryAssignedElements:o$8,queryAssignedNodes:n$6,queryAsync:r$4,ref:n$1,render:B$1,repeat:c$2,standardProperty:r$7,state:r$6,styleMap:o$7,supportsAdoptingStyleSheets:e$d,svg:b$1,unsafeCSS:r$a,unsafeHTML:o$5,until:m$1,when:n$5},Symbol.toStringTag,{value:"Module"}));class DependencyContext{constructor(O){this.children=[],this.variables=O,this.proxy=new Proxy(O,this)}get(O,Y){return O[Y]||this.parent?.getProxy()[Y]}set(O,Y,te){O[Y]=te}put(O,Y){this.variables[O]=Y}getProxy(){return this.proxy}createChild(O={}){const Y=new DependencyContext(O);return Y.parent=this,this.children.push(Y),Y}getChildren(){return this.children}getParent(){return this.parent}destroy(){const O=this.parent?.children.indexOf(this);O!==void 0&&O>=0&&this.parent?.children.splice(O,1),this.parent=void 0}}const rootContext=new DependencyContext({}),uiContext=rootContext.createChild({});uiContext.put("html",x$1);uiContext.put("render",B$1);const LogLevelPriority={debug:0,info:1,warning:2,error:3};let globalLogLevel="debug";const originalConsole={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console)};let logHandler=null;const messageBuffer=[];function formatArg(ee){if(ee===null)return"null";if(ee===void 0)return"undefined";if(typeof ee=="string")return ee;if(typeof ee=="number"||typeof ee=="boolean")return String(ee);if(ee instanceof Error)return`${ee.name}: ${ee.message}`;try{return JSON.stringify(ee)}catch{return String(ee)}}class Logger{constructor(O){this.source=O}info(O){this.log(O,"info")}warning(O){this.log(O,"warning")}warn(O){this.log(O,"warning")}error(O){this.log(O,"error")}debug(O){this.log(O,"debug")}log(O,Y){dispatch(this.source,O,Y)}}function shouldLog(ee){return LogLevelPriority[ee]>=LogLevelPriority[globalLogLevel]}function dispatch(ee,O,Y){shouldLog(Y)&&(logHandler?logHandler(ee,O,Y):(messageBuffer.push({source:ee,message:O,level:Y}),originalConsole[Y==="error"?"error":Y==="warning"?"warn":Y==="debug"?"debug":"log"](`[${ee}] ${O}`)))}function initializeConsoleInterception(){console.log=function(...ee){originalConsole.log.apply(console,ee),dispatch("Console",ee.map(O=>formatArg(O)).join(" "),"info")},console.info=function(...ee){originalConsole.info.apply(console,ee),dispatch("Console",ee.map(O=>formatArg(O)).join(" "),"info")},console.warn=function(...ee){originalConsole.warn.apply(console,ee),dispatch("Console",ee.map(O=>formatArg(O)).join(" "),"warning")},console.error=function(...ee){originalConsole.error.apply(console,ee),dispatch("Console",ee.map(O=>formatArg(O)).join(" "),"error")},console.debug=function(...ee){originalConsole.debug.apply(console,ee),dispatch("Console",ee.map(O=>formatArg(O)).join(" "),"debug")}}initializeConsoleInterception();function registerLogHandler(ee){for(logHandler=ee;messageBuffer.length>0;){const O=messageBuffer.shift();O&&ee(O.source,O.message,O.level)}}function unregisterLogHandler(){logHandler=null}function createLogger(ee){return new Logger(ee)}const defaultLogger=createLogger("System");rootContext.put("logger",defaultLogger);var __defProp$b=Object.defineProperty,__defNormalProp=(ee,O,Y)=>O in ee?__defProp$b(ee,O,{enumerable:!0,configurable:!0,writable:!0,value:Y}):ee[O]=Y,__publicField=(ee,O,Y)=>(__defNormalProp(ee,typeof O!="symbol"?O+"":O,Y),Y),__accessCheck=(ee,O,Y)=>{if(!O.has(ee))throw TypeError("Cannot "+Y)},__privateIn=(ee,O)=>{if(Object(O)!==O)throw TypeError('Cannot use the "in" operator on this value');return ee.has(O)},__privateAdd=(ee,O,Y)=>{if(O.has(ee))throw TypeError("Cannot add the same private member more than once");O instanceof WeakSet?O.add(ee):O.set(ee,Y)},__privateMethod=(ee,O,Y)=>(__accessCheck(ee,O,"access private method"),Y);function defaultEquals(ee,O){return Object.is(ee,O)}let activeConsumer=null,inNotificationPhase=!1,epoch=1;const SIGNAL=Symbol("SIGNAL");function setActiveConsumer(ee){const O=activeConsumer;return activeConsumer=ee,O}function getActiveConsumer(){return activeConsumer}function isInNotificationPhase(){return inNotificationPhase}const REACTIVE_NODE={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function producerAccessed(ee){if(inNotificationPhase)throw new Error(typeof ngDevMode<"u"&&ngDevMode?"Assertion error: signal read during notification phase":"");if(activeConsumer===null)return;activeConsumer.consumerOnSignalRead(ee);const O=activeConsumer.nextProducerIndex++;if(assertConsumerNode(activeConsumer),O<activeConsumer.producerNode.length&&activeConsumer.producerNode[O]!==ee&&consumerIsLive(activeConsumer)){const Y=activeConsumer.producerNode[O];producerRemoveLiveConsumerAtIndex(Y,activeConsumer.producerIndexOfThis[O])}activeConsumer.producerNode[O]!==ee&&(activeConsumer.producerNode[O]=ee,activeConsumer.producerIndexOfThis[O]=consumerIsLive(activeConsumer)?producerAddLiveConsumer(ee,activeConsumer,O):0),activeConsumer.producerLastReadVersion[O]=ee.version}function producerIncrementEpoch(){epoch++}function producerUpdateValueVersion(ee){if(!(!ee.dirty&&ee.lastCleanEpoch===epoch)){if(!ee.producerMustRecompute(ee)&&!consumerPollProducersForChange(ee)){ee.dirty=!1,ee.lastCleanEpoch=epoch;return}ee.producerRecomputeValue(ee),ee.dirty=!1,ee.lastCleanEpoch=epoch}}function producerNotifyConsumers(ee){if(ee.liveConsumerNode===void 0)return;const O=inNotificationPhase;inNotificationPhase=!0;try{for(const Y of ee.liveConsumerNode)Y.dirty||consumerMarkDirty(Y)}finally{inNotificationPhase=O}}function producerUpdatesAllowed(){return activeConsumer?.consumerAllowSignalWrites!==!1}function consumerMarkDirty(ee){var O;ee.dirty=!0,producerNotifyConsumers(ee),(O=ee.consumerMarkedDirty)==null||O.call(ee.wrapper??ee)}function consumerBeforeComputation(ee){return ee&&(ee.nextProducerIndex=0),setActiveConsumer(ee)}function consumerAfterComputation(ee,O){if(setActiveConsumer(O),!(!ee||ee.producerNode===void 0||ee.producerIndexOfThis===void 0||ee.producerLastReadVersion===void 0)){if(consumerIsLive(ee))for(let Y=ee.nextProducerIndex;Y<ee.producerNode.length;Y++)producerRemoveLiveConsumerAtIndex(ee.producerNode[Y],ee.producerIndexOfThis[Y]);for(;ee.producerNode.length>ee.nextProducerIndex;)ee.producerNode.pop(),ee.producerLastReadVersion.pop(),ee.producerIndexOfThis.pop()}}function consumerPollProducersForChange(ee){assertConsumerNode(ee);for(let O=0;O<ee.producerNode.length;O++){const Y=ee.producerNode[O],te=ee.producerLastReadVersion[O];if(te!==Y.version||(producerUpdateValueVersion(Y),te!==Y.version))return!0}return!1}function producerAddLiveConsumer(ee,O,Y){var te;if(assertProducerNode(ee),assertConsumerNode(ee),ee.liveConsumerNode.length===0){(te=ee.watched)==null||te.call(ee.wrapper);for(let ne=0;ne<ee.producerNode.length;ne++)ee.producerIndexOfThis[ne]=producerAddLiveConsumer(ee.producerNode[ne],ee,ne)}return ee.liveConsumerIndexOfThis.push(Y),ee.liveConsumerNode.push(O)-1}function producerRemoveLiveConsumerAtIndex(ee,O){var Y;if(assertProducerNode(ee),assertConsumerNode(ee),typeof ngDevMode<"u"&&ngDevMode&&O>=ee.liveConsumerNode.length)throw new Error(`Assertion error: active consumer index ${O} is out of bounds of ${ee.liveConsumerNode.length} consumers)`);if(ee.liveConsumerNode.length===1){(Y=ee.unwatched)==null||Y.call(ee.wrapper);for(let ne=0;ne<ee.producerNode.length;ne++)producerRemoveLiveConsumerAtIndex(ee.producerNode[ne],ee.producerIndexOfThis[ne])}const te=ee.liveConsumerNode.length-1;if(ee.liveConsumerNode[O]=ee.liveConsumerNode[te],ee.liveConsumerIndexOfThis[O]=ee.liveConsumerIndexOfThis[te],ee.liveConsumerNode.length--,ee.liveConsumerIndexOfThis.length--,O<ee.liveConsumerNode.length){const ne=ee.liveConsumerIndexOfThis[O],xe=ee.liveConsumerNode[O];assertConsumerNode(xe),xe.producerIndexOfThis[ne]=O}}function consumerIsLive(ee){var O;return ee.consumerIsAlwaysLive||(((O=ee?.liveConsumerNode)==null?void 0:O.length)??0)>0}function assertConsumerNode(ee){ee.producerNode??(ee.producerNode=[]),ee.producerIndexOfThis??(ee.producerIndexOfThis=[]),ee.producerLastReadVersion??(ee.producerLastReadVersion=[])}function assertProducerNode(ee){ee.liveConsumerNode??(ee.liveConsumerNode=[]),ee.liveConsumerIndexOfThis??(ee.liveConsumerIndexOfThis=[])}function computedGet(ee){if(producerUpdateValueVersion(ee),producerAccessed(ee),ee.value===ERRORED)throw ee.error;return ee.value}function createComputed(ee){const O=Object.create(COMPUTED_NODE);O.computation=ee;const Y=()=>computedGet(O);return Y[SIGNAL]=O,Y}const UNSET=Symbol("UNSET"),COMPUTING=Symbol("COMPUTING"),ERRORED=Symbol("ERRORED"),COMPUTED_NODE={...REACTIVE_NODE,value:UNSET,dirty:!0,error:null,equal:defaultEquals,producerMustRecompute(ee){return ee.value===UNSET||ee.value===COMPUTING},producerRecomputeValue(ee){if(ee.value===COMPUTING)throw new Error("Detected cycle in computations.");const O=ee.value;ee.value=COMPUTING;const Y=consumerBeforeComputation(ee);let te,ne=!1;try{te=ee.computation.call(ee.wrapper),ne=O!==UNSET&&O!==ERRORED&&ee.equal.call(ee.wrapper,O,te)}catch(xe){te=ERRORED,ee.error=xe}finally{consumerAfterComputation(ee,Y)}if(ne){ee.value=O;return}ee.value=te,ee.version++}};function defaultThrowError(){throw new Error}let throwInvalidWriteToSignalErrorFn=defaultThrowError;function throwInvalidWriteToSignalError(){throwInvalidWriteToSignalErrorFn()}function createSignal(ee){const O=Object.create(SIGNAL_NODE);O.value=ee;const Y=()=>(producerAccessed(O),O.value);return Y[SIGNAL]=O,Y}function signalGetFn(){return producerAccessed(this),this.value}function signalSetFn(ee,O){producerUpdatesAllowed()||throwInvalidWriteToSignalError(),ee.equal.call(ee.wrapper,ee.value,O)||(ee.value=O,signalValueChanged(ee))}const SIGNAL_NODE={...REACTIVE_NODE,equal:defaultEquals,value:void 0};function signalValueChanged(ee){ee.version++,producerIncrementEpoch(),producerNotifyConsumers(ee)}const NODE=Symbol("node");var Signal;(ee=>{var O,Y,te,ne;class xe{constructor(it,st={}){__privateAdd(this,Y),__publicField(this,O);const rt=createSignal(it)[SIGNAL];if(this[NODE]=rt,rt.wrapper=this,st){const nt=st.equals;nt&&(rt.equal=nt),rt.watched=st[ee.subtle.watched],rt.unwatched=st[ee.subtle.unwatched]}}get(){if(!(0,ee.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.get");return signalGetFn.call(this[NODE])}set(it){if(!(0,ee.isState)(this))throw new TypeError("Wrong receiver type for Signal.State.prototype.set");if(isInNotificationPhase())throw new Error("Writes to signals not permitted during Watcher callback");const st=this[NODE];signalSetFn(st,it)}}O=NODE,Y=new WeakSet,ee.isState=tt=>typeof tt=="object"&&__privateIn(Y,tt),ee.State=xe;class et{constructor(it,st){__privateAdd(this,ne),__publicField(this,te);const rt=createComputed(it)[SIGNAL];if(rt.consumerAllowSignalWrites=!0,this[NODE]=rt,rt.wrapper=this,st){const nt=st.equals;nt&&(rt.equal=nt),rt.watched=st[ee.subtle.watched],rt.unwatched=st[ee.subtle.unwatched]}}get(){if(!(0,ee.isComputed)(this))throw new TypeError("Wrong receiver type for Signal.Computed.prototype.get");return computedGet(this[NODE])}}te=NODE,ne=new WeakSet,ee.isComputed=tt=>typeof tt=="object"&&__privateIn(ne,tt),ee.Computed=et,(tt=>{var it,st,ot,rt;function nt(ft){let mt,yt=null;try{yt=setActiveConsumer(null),mt=ft()}finally{setActiveConsumer(yt)}return mt}tt.untrack=nt;function at(ft){var mt;if(!(0,ee.isComputed)(ft)&&!(0,ee.isWatcher)(ft))throw new TypeError("Called introspectSources without a Computed or Watcher argument");return((mt=ft[NODE].producerNode)==null?void 0:mt.map(yt=>yt.wrapper))??[]}tt.introspectSources=at;function ct(ft){var mt;if(!(0,ee.isComputed)(ft)&&!(0,ee.isState)(ft))throw new TypeError("Called introspectSinks without a Signal argument");return((mt=ft[NODE].liveConsumerNode)==null?void 0:mt.map(yt=>yt.wrapper))??[]}tt.introspectSinks=ct;function ut(ft){if(!(0,ee.isComputed)(ft)&&!(0,ee.isState)(ft))throw new TypeError("Called hasSinks without a Signal argument");const mt=ft[NODE].liveConsumerNode;return mt?mt.length>0:!1}tt.hasSinks=ut;function dt(ft){if(!(0,ee.isComputed)(ft)&&!(0,ee.isWatcher)(ft))throw new TypeError("Called hasSources without a Computed or Watcher argument");const mt=ft[NODE].producerNode;return mt?mt.length>0:!1}tt.hasSources=dt;class ht{constructor(mt){__privateAdd(this,st),__privateAdd(this,ot),__publicField(this,it);let yt=Object.create(REACTIVE_NODE);yt.wrapper=this,yt.consumerMarkedDirty=mt,yt.consumerIsAlwaysLive=!0,yt.consumerAllowSignalWrites=!1,yt.producerNode=[],this[NODE]=yt}watch(...mt){if(!(0,ee.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");__privateMethod(this,ot,rt).call(this,mt);const yt=this[NODE];yt.dirty=!1;const bt=setActiveConsumer(yt);for(const vt of mt)producerAccessed(vt[NODE]);setActiveConsumer(bt)}unwatch(...mt){if(!(0,ee.isWatcher)(this))throw new TypeError("Called unwatch without Watcher receiver");__privateMethod(this,ot,rt).call(this,mt);const yt=this[NODE];assertConsumerNode(yt);for(let bt=yt.producerNode.length-1;bt>=0;bt--)if(mt.includes(yt.producerNode[bt].wrapper)){producerRemoveLiveConsumerAtIndex(yt.producerNode[bt],yt.producerIndexOfThis[bt]);const vt=yt.producerNode.length-1;if(yt.producerNode[bt]=yt.producerNode[vt],yt.producerIndexOfThis[bt]=yt.producerIndexOfThis[vt],yt.producerNode.length--,yt.producerIndexOfThis.length--,yt.nextProducerIndex--,bt<yt.producerNode.length){const Et=yt.producerIndexOfThis[bt],wt=yt.producerNode[bt];assertProducerNode(wt),wt.liveConsumerIndexOfThis[Et]=bt}}}getPending(){if(!(0,ee.isWatcher)(this))throw new TypeError("Called getPending without Watcher receiver");return this[NODE].producerNode.filter(yt=>yt.dirty).map(yt=>yt.wrapper)}}it=NODE,st=new WeakSet,ot=new WeakSet,rt=function(ft){for(const mt of ft)if(!(0,ee.isComputed)(mt)&&!(0,ee.isState)(mt))throw new TypeError("Called watch/unwatch without a Computed or State argument")},ee.isWatcher=ft=>__privateIn(st,ft),tt.Watcher=ht;function pt(){var ft;return(ft=getActiveConsumer())==null?void 0:ft.wrapper}tt.currentComputed=pt,tt.watched=Symbol("watched"),tt.unwatched=Symbol("unwatched")})(ee.subtle||(ee.subtle={}))})(Signal||(Signal={}));const i$2=Symbol("SignalWatcherBrand"),s=new FinalizationRegistry((({watcher:ee,signal:O})=>{ee.unwatch(O)})),h=new WeakMap;function e$1(ee){return ee[i$2]===!0?(console.warn("SignalWatcher should not be applied to the same class more than once."),ee):class extends ee{constructor(){super(...arguments),this._$St=new Signal.State(0),this._$Si=!1,this._$So=!0,this._$Sh=new Set}_$Sl(){if(this._$Su!==void 0)return;this._$Sv=new Signal.Computed((()=>{this._$St.get(),super.performUpdate()}));const O=this._$Su=new Signal.subtle.Watcher((function(){const Y=h.get(this);Y!==void 0&&(Y._$Si===!1&&Y.requestUpdate(),this.watch())}));h.set(O,this),s.register(this,{watcher:O,signal:this._$Sv}),O.watch(this._$Sv)}_$Sp(){this._$Su!==void 0&&(this._$Su.unwatch(this._$Sv),this._$Sv=void 0,this._$Su=void 0)}performUpdate(){this.isUpdatePending&&(this._$Sl(),this._$Si=!0,this._$St.set(this._$St.get()+1),this._$Si=!1,this._$Sv.get())}update(O){try{this._$So?(this._$So=!1,super.update(O)):this._$Sh.forEach((Y=>Y.commit()))}finally{this.isUpdatePending=!1,this._$Sh.clear()}}requestUpdate(O,Y,te){this._$So=!0,super.requestUpdate(O,Y,te)}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask((()=>{this.isConnected===!1&&this._$Sp()}))}_(O){this._$Sh.add(O);const Y=this._$So;this.requestUpdate(),this._$So=Y}m(O){this._$Sh.delete(O)}}}Signal.State;Signal.Computed;const r$1=(ee,O)=>new Signal.State(ee,O);class EventBus{constructor(){this.subscriptions=new Map,this.tokenCounter=0}subscribe(O,Y){this.subscriptions.has(O)||this.subscriptions.set(O,new Map);const te=`token_${++this.tokenCounter}_${Date.now()}`;return this.subscriptions.get(O).set(te,Y),te}unsubscribe(O){for(const[Y,te]of this.subscriptions.entries())if(te.has(O)){te.delete(O),te.size===0&&this.subscriptions.delete(Y);return}}publish(O,Y){const te=this.subscriptions.get(O);return!te||te.size===0?!1:(queueMicrotask(()=>{te.forEach(ne=>{try{ne(Y)}catch(xe){console.error(`Error in event callback for topic "${O}":`,xe)}})}),!0)}clearAllSubscriptions(){this.subscriptions.clear()}clearSubscriptions(O){this.subscriptions.delete(O)}}const eventBus=new EventBus,subscribe=(ee,O)=>eventBus.subscribe(ee,O),unsubscribe=ee=>{eventBus.unsubscribe(ee)},publish=(ee,O)=>eventBus.publish(ee,O),TOPIC_CONTRIBUTEIONS_CHANGED="events/contributionregistry/contributionsChanged";class ContributionRegistry{constructor(){this.contributions=new Map}registerContribution(O,Y){const te=this.getContributions(O);if(Y.disabled instanceof Function){const ne=Y.disabled;Y.disabled=new Signal.Computed(ne)}te.push(Y),publish(TOPIC_CONTRIBUTEIONS_CHANGED,{target:O,contributions:te})}getContributions(O){return this.contributions.has(O)||this.contributions.set(O,[]),this.contributions.get(O)}}const contributionRegistry=new ContributionRegistry;rootContext.put("contributionRegistry",contributionRegistry);const EMPTY_SIGNALPORT={},activePartSignal=r$1(null),activeEditorSignal=r$1(null),partDirtySignal=r$1(null),activeTasksSignal=r$1(0),activeSelectionSignal=r$1(void 0);r$1({name:"",timestamp:0});function promisifyRequest(ee){return new Promise((O,Y)=>{ee.oncomplete=ee.onsuccess=()=>O(ee.result),ee.onabort=ee.onerror=()=>Y(ee.error)})}function createStore(ee,O){let Y;const te=()=>{if(Y)return Y;const ne=indexedDB.open(ee);return ne.onupgradeneeded=()=>ne.result.createObjectStore(O),Y=promisifyRequest(ne),Y.then(xe=>{xe.onclose=()=>Y=void 0},()=>{}),Y};return(ne,xe)=>te().then(et=>xe(et.transaction(O,ne).objectStore(O)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get$5(ee,O=defaultGetStore()){return O("readonly",Y=>promisifyRequest(Y.get(ee)))}function set$1(ee,O,Y=defaultGetStore()){return Y("readwrite",te=>(te.put(O,ee),promisifyRequest(te.transaction)))}class PersistenceService{async persistObject(O,Y){return set$1(O,Y)}async getObject(O){return get$5(O)}}const persistenceService=new PersistenceService;rootContext.put("persistenceService",persistenceService);const SETTINGS_FILE_PATH=".geospace/settings.json",DIALOG_SETTINGS_KEY="dialogSettings",TOPIC_SETTINGS_CHANGED="events/settings/changed";class SettingsService{async checkSettings(){this.appSettings||(this.appSettings=await persistenceService.getObject(SETTINGS_FILE_PATH),this.appSettings||(this.appSettings={},await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings)),publish(TOPIC_SETTINGS_CHANGED,this.appSettings))}async get(O){return await this.checkSettings(),this.appSettings[O]}async set(O,Y){await this.checkSettings(),this.appSettings[O]=Y,await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings),publish(TOPIC_SETTINGS_CHANGED,this.appSettings)}async getAll(){return await this.checkSettings(),this.appSettings}async setAll(O){this.appSettings=O,await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings),publish(TOPIC_SETTINGS_CHANGED,this.appSettings)}async getDialogSetting(O){return await this.checkSettings(),(this.appSettings[DIALOG_SETTINGS_KEY]||{})[O]}async setDialogSetting(O,Y){await this.checkSettings();const te=this.appSettings[DIALOG_SETTINGS_KEY]||{};te[O]=Y,this.appSettings[DIALOG_SETTINGS_KEY]=te,await persistenceService.persistObject(SETTINGS_FILE_PATH,this.appSettings),publish(TOPIC_SETTINGS_CHANGED,this.appSettings)}}const appSettings=new SettingsService;rootContext.put("appSettings",appSettings);const settingsservice=Object.freeze(Object.defineProperty({__proto__:null,DIALOG_SETTINGS_KEY,SETTINGS_FILE_PATH,TOPIC_SETTINGS_CHANGED,appSettings},Symbol.toStringTag,{value:"Module"})),settingsservice_RRkTsDV=Object.freeze(Object.defineProperty({__proto__:null,T:TOPIC_SETTINGS_CHANGED,a:appSettings,p:persistenceService,s:settingsservice},Symbol.toStringTag,{value:"Module"})),toastInfo=ee=>{console.info("[TOAST] INFO:",ee)},toastError=ee=>{console.error("[TOAST] ERROR:",ee)},toastWarning=ee=>{console.warn("[TOAST] WARNING:",ee)};uiContext.put("toastInfo",toastInfo);uiContext.put("toastError",toastError);uiContext.put("toastWarning",toastWarning);class TaskService{constructor(){this.tasks=[],this.updateCounter=0}notifyUpdate(){this.updateCounter++,activeTasksSignal.set(this.updateCounter)}run(O,Y){const te=this.createProgressMonitor(O);try{this.tasks.push(te),this.notifyUpdate(),Y(te)}finally{this.tasks.splice(this.tasks.indexOf(te),1),this.notifyUpdate()}}async runAsync(O,Y){const te=this.createProgressMonitor(O);return this.tasks.push(te),this.notifyUpdate(),Y(te).finally(()=>{this.tasks.splice(this.tasks.indexOf(te),1),this.notifyUpdate()})}createProgressMonitor(O){const Y={name:O,message:"",currentStep:0,totalSteps:-1,progress:-1};return new Proxy(Y,{set:(te,ne,xe)=>(te[ne]=xe,this.notifyUpdate(),!0)})}getActiveTasks(){return this.tasks}}const taskService=new TaskService;rootContext.put("taskService",taskService);const TOPIC_EXTENSIONS_CHANGED="events/extensionsregistry/extensionsConfigChanged",KEY_EXTENSIONS_CONFIG="extensions",KEY_EXTERNAL_EXTENSIONS="extensions.external";class ExtensionRegistry{constructor(){this.extensions={},this.loadedExtensions=new Set,this.loadingPromises=new Map,subscribe(TOPIC_SETTINGS_CHANGED,()=>{this.extensionsSettings=void 0,this.checkExtensionsConfig().then()}),this.loadPersistedExternalExtensions().then(()=>{this.checkExtensionsConfig().then(async()=>{const O=this.extensionsSettings?.filter(Y=>this.isEnabled(Y.id)).map(Y=>this.load(Y.id).catch(te=>{toastError("Extension could not be loaded: "+te.message)}))||[];await Promise.all(O)})})}async loadPersistedExternalExtensions(){try{const O=await appSettings.get(KEY_EXTERNAL_EXTENSIONS);O&&Array.isArray(O)&&(O.forEach(Y=>{this.extensions[Y.id]=Y}),defaultLogger.debug(`Loaded ${O.length} persisted external extensions`))}catch(O){defaultLogger.error(`Failed to load persisted external extensions: ${O}`)}}async savePersistedExternalExtensions(){try{const O=Object.values(this.extensions).filter(Y=>Y.external);await appSettings.set(KEY_EXTERNAL_EXTENSIONS,O)}catch(O){defaultLogger.error(`Failed to save persisted external extensions: ${O}`)}}async checkExtensionsConfig(){this.extensionsSettings||(this.extensionsSettings=await appSettings.get(KEY_EXTENSIONS_CONFIG),this.extensionsSettings||(await appSettings.set(KEY_EXTENSIONS_CONFIG,[]),this.extensionsSettings=await appSettings.get(KEY_EXTENSIONS_CONFIG)),publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings))}registerExtension(O){this.extensions[O.id]=O,O.external&&this.savePersistedExternalExtensions().catch(Y=>{defaultLogger.error(`Failed to persist external extension: ${Y}`)}),publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings)}getExtensions(){return Object.values(this.extensions)}isEnabled(O){return this.checkExtensionsConfig(),!!this.extensionsSettings?.find(Y=>Y.id===O&&Y.enabled)}isLoaded(O){return this.loadedExtensions.has(O)}enable(O,Y=!1){this.isEnabled(O)||(defaultLogger.debug(`Loading extension: ${O}`),this.load(O).then(()=>{this.updateEnablement(O,!0,Y)}).catch(te=>{defaultLogger.error(`Could not load extension: ${O}: ${te}`)}))}async load(O,Y=[]){if(this.loadedExtensions.has(O))return;const te=this.loadingPromises.get(O);if(te)return te;if(Y.includes(O)){const et=[...Y,O].join("  ");throw new Error(`Circular dependency detected: ${et}`)}const ne=this.extensions[O];if(!ne)throw new Error("Extension not found: "+O);const xe=(async()=>{try{if(ne.dependencies&&ne.dependencies.length>0){defaultLogger.debug(`Loading dependencies for ${O}: ${ne.dependencies.join(", ")}`);const tt=[...Y,O];for(const it of ne.dependencies)await this.load(it,tt),this.isEnabled(it)||(await this.updateEnablementAsync(it,!0,!1),defaultLogger.debug(`Auto-enabled dependency: ${it}`))}const et=await taskService.runAsync("Loading extension: "+ne.name,()=>{if(ne.loader)return ne.loader();if(ne.url)return import(ne.url)});if(this.loadedExtensions.add(O),et?.default instanceof Function){defaultLogger.debug(`Executing extension function for: ${O}`);try{et?.default(uiContext.getProxy()),defaultLogger.debug(`Extension function executed successfully: ${O}`)}catch(tt){throw defaultLogger.error(`Error executing extension function for ${O}: ${tt}`),tt}}else defaultLogger.warn(`Extension ${O} does not export a default function`);defaultLogger.debug(`Extension loaded: ${O}`)}catch(et){throw this.loadedExtensions.delete(O),et}finally{this.loadingPromises.delete(O)}})();return this.loadingPromises.set(O,xe),xe}disable(O,Y=!1){this.isEnabled(O)&&this.updateEnablement(O,!1,Y)}updateEnablement(O,Y,te){this.checkExtensionsConfig().then(()=>{const ne=this.extensionsSettings?.find(xe=>xe.id==O);ne?ne.enabled=Y:this.extensionsSettings?.push({id:O,enabled:Y}),appSettings.set(KEY_EXTENSIONS_CONFIG,this.extensionsSettings).then(()=>{if(te){const xe=this.extensions[O];toastInfo(Y?xe.name+" enabled.":xe.name+" disabled  - Please restart to take effect")}publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings)})})}async updateEnablementAsync(O,Y,te){await this.checkExtensionsConfig();const ne=this.extensionsSettings?.find(xe=>xe.id==O);if(ne?ne.enabled=Y:this.extensionsSettings?.push({id:O,enabled:Y}),await appSettings.set(KEY_EXTENSIONS_CONFIG,this.extensionsSettings),te){const xe=this.extensions[O];toastInfo(Y?xe.name+" enabled.":xe.name+" disabled  - Please restart to take effect")}publish(TOPIC_EXTENSIONS_CHANGED,this.extensionsSettings)}}defaultLogger.debug("ExtensionRegistry initializing...");const extensionRegistry=new ExtensionRegistry;rootContext.put("extensionRegistry",extensionRegistry);defaultLogger.debug("ExtensionRegistry initialized");const logger$6=createLogger("AppLoader");function getErrorMessage(ee){return ee instanceof Error?ee.message:String(ee)}function extractLastPathSegment(ee){try{const Y=new URL(ee).pathname.split("/").filter(Boolean);return Y.length>0?Y[Y.length-1]:void 0}catch{const O=ee.split("/").filter(Boolean);return O.length>0?O[O.length-1]:void 0}}function extractAppIdFromPath(){const O=window.location.pathname.split("/").filter(Boolean);if(O.length===0)return;const Y=O[0];if(!(!Y||Y==="index.html"||Y.endsWith(".html")))return Y}class AppLoaderService{constructor(){this.apps=new Map,this.started=!1,this.container=document.body,this.systemRequiredExtensions=new Set}registerApp(O,Y){this.apps.has(O.id)&&logger$6.warn(`App '${O.id}' is already registered. Overwriting.`),this.apps.set(O.id,O),logger$6.info(`Registered app: ${O.name} (${O.id}) v${O.version}`),Y?.defaultAppId&&(this.defaultAppId=Y.defaultAppId),Y?.container&&(this.container=Y.container),Y?.autoStart&&!this.started&&this.start()}registerSystemRequiredExtension(O){this.systemRequiredExtensions.add(O)}async loadExtensionFromUrl(O){logger$6.info(`Loading extension from URL: ${O}...`);try{const Y=`url:${O}`;if(extensionRegistry.isEnabled(Y)){logger$6.info(`Extension from URL ${O} is already enabled`);return}const te={id:Y,name:`Extension from ${O}`,description:`Extension loaded from URL: ${O}`,url:O};extensionRegistry.registerExtension(te),logger$6.info(`Registered extension from URL: ${Y}`),extensionRegistry.enable(Y,!1),logger$6.info(`Successfully enabled extension from URL: ${O}`)}catch(Y){throw logger$6.error(`Failed to load extension from URL ${O}: ${getErrorMessage(Y)}`),Y}}async loadAppFromUrl(O){logger$6.info(`Loading app from URL: ${O}...`);try{const Y=await import(O);if(!Y.default)throw new Error(`Module at ${O} does not have a default export`);const te=Y.default;if(!te.id||!te.name||!te.version)throw new Error(`Module at ${O} does not export a valid AppDefinition`);return logger$6.info(`Successfully loaded app definition from URL: ${te.name} (${te.id})`),te}catch(Y){throw logger$6.error(`Failed to load app from URL ${O}: ${getErrorMessage(Y)}`),Y}}async start(){if(this.started){logger$6.debug("AppLoader already started");return}this.started=!0,logger$6.info("Starting AppLoader...");const O=new URLSearchParams(window.location.search),Y=O.get("app"),te=O.get("appId"),ne=extractAppIdFromPath(),xe=this.apps.size;let et;if(Y&&(et=extractLastPathSegment(Y),et&&logger$6.info(`Extracted app ID from URL path: ${et}`)),ne&&logger$6.info(`Extracted app ID from current page path: ${ne}`),Y)try{logger$6.info(`URL parameter 'app' found: ${Y}, attempting to load extension or app`);try{await this.loadExtensionFromUrl(Y),logger$6.info(`Successfully loaded extension from URL: ${Y}`)}catch(it){logger$6.info(`Failed to load as extension, trying as app definition: ${getErrorMessage(it)}`);try{const st=await this.loadAppFromUrl(Y);this.registerApp(st),await this.loadApp(st.id,this.container),logger$6.info(`Successfully loaded app from URL: ${Y}`);return}catch(st){throw logger$6.error(`Failed to load from URL as both extension and app: ${getErrorMessage(st)}`),st}}}catch(it){logger$6.error(`Failed to load from URL parameter, falling back to default app: ${getErrorMessage(it)}`)}const tt=this.selectAppToLoad({appIdFromUrl:te,appIdFromPath:ne,appIdFromAppUrl:et,appsBeforeExtension:xe});if(!tt)throw new Error("No apps registered");await this.loadApp(tt,this.container)}async loadApp(O,Y){const te=this.apps.get(O);if(!te)throw new Error(`App '${O}' not found. Make sure it's registered.`);logger$6.info(`Loading app: ${te.name}...`),this.currentApp&&(logger$6.info(`Disposing current app: ${this.currentApp.name}`),this.currentApp.dispose&&await this.currentApp.dispose(),this.currentApp.extensions&&this.currentApp.extensions.length>0&&(logger$6.info(`Disabling ${this.currentApp.extensions.length} extensions...`),this.currentApp.extensions.forEach(xe=>{extensionRegistry.disable(xe)}))),te.contributions&&(logger$6.info("Registering app contributions..."),te.contributions.ui&&(te.contributions.ui.forEach(xe=>{const et=xe.target;et&&contributionRegistry.registerContribution(et,xe)}),logger$6.info(`Registered ${te.contributions.ui.length} UI contributions`)),te.contributions.extensions&&(te.contributions.extensions.forEach(xe=>{extensionRegistry.registerExtension(xe)}),logger$6.info(`Registered ${te.contributions.extensions.length} app extensions`)));const ne=new Set(te.extensions||[]);this.systemRequiredExtensions.forEach(xe=>ne.add(xe)),te.extensions=Array.from(ne),te.extensions.length>0&&(logger$6.info(`Enabling ${te.extensions.length} extensions...`),te.extensions.forEach(xe=>{extensionRegistry.enable(xe)})),te.initialize&&(logger$6.info(`Initializing ${te.name}...`),await te.initialize()),this.currentApp=te,logger$6.info(`App ${te.name} loaded successfully`),this.updateDocumentMetadata(te),Y&&this.renderApp(Y)}updateDocumentMetadata(O){if(document.title=O.name,O.metadata?.favicon){const Y=O.metadata.favicon;let te=document.querySelector("link[rel*='icon']");te||(te=document.createElement("link"),te.rel="icon",document.head.appendChild(te)),te.type="image/svg+xml",te.href=Y}}renderApp(O){if(!this.currentApp)throw new Error("No app loaded. Call loadApp() first.");const Y=this.currentApp.render?this.currentApp.render():x$1`<k-standard-app></k-standard-app>`;B$1(Y,O),logger$6.info(`Rendered ${this.currentApp.name}`)}getCurrentApp(){return this.currentApp}getRegisteredApps(){return Array.from(this.apps.values())}selectAppToLoad(O){const{appIdFromUrl:Y,appIdFromPath:te,appIdFromAppUrl:ne,appsBeforeExtension:xe}=O;if(Y){if(this.apps.has(Y))return logger$6.info(`Loading app specified by URL parameter 'appId': ${Y}`),Y;logger$6.warn(`App ID '${Y}' from URL parameter not found`)}if(te){if(this.apps.has(te))return logger$6.info(`Loading app from URL path: ${te}`),te;logger$6.debug(`App ID '${te}' from URL path not found, continuing search`)}if(ne&&this.apps.has(ne))return logger$6.info(`Loading app using ID extracted from app URL path: ${ne}`),ne;if(this.apps.size>xe){const tt=Array.from(this.apps.values()).slice(xe);if(tt.length>0){const it=tt[0];return logger$6.info(`Loading app registered by extension: ${it.name} (${it.id})`),it.id}}if(this.defaultAppId){if(this.apps.has(this.defaultAppId))return this.defaultAppId;logger$6.warn(`Default app '${this.defaultAppId}' not found`)}const et=this.getRegisteredApps();if(et.length>0){const tt=et[0];return logger$6.info(`Loading first registered app: ${tt.name} (${tt.id})`),tt.id}}}const appLoaderService=new AppLoaderService;rootContext.put("appLoaderService",appLoaderService);class Command{constructor(O,Y,te,ne,xe){this.id=O,this.name=Y,this.description=te,this.parameters=ne||[],this.output=xe||[]}}class CommandStack{async execute(O,Y){return commandRegistry.execute(O,Y)}async undo(){}async redo(){}}class CommandRegistry{constructor(){this.commands={},this.handlers=new Map}registerHandler(O,Y){this.handlers.has(O)||this.handlers.set(O,[]);const te=this.handlers.get(O);te.push(Y),te.sort((ne,xe)=>(xe.ranking??0)-(ne.ranking??0))}getHandler(O){return this.handlers.get(O)}createExecutionContext(O){return{params:O||{},activePart:activePartSignal.get(),activeEditor:activeEditorSignal.get()}}execute(O,Y={}){const te=this.getHandler(O);if(!te)throw defaultLogger.debug(`[CommandRegistry] No handlers registered for command: ${O}`),new Error(`No handlers registered for command: ${O}`);const ne=this.getCommand(O),xe=Y.params?` params: ${JSON.stringify(Y.params)}`:"";defaultLogger.debug(`[CommandRegistry] Executing command: ${O}${ne?` (${ne.name})`:""}${xe}`);for(const et of te)if(et.canExecute===void 0||et.canExecute(Y))try{const tt=et.execute(Y);return defaultLogger.debug(`[CommandRegistry] Command executed successfully: ${O} (result: ${tt})`),tt}catch(tt){const it=tt instanceof Error?tt.message:String(tt);throw defaultLogger.error(`[CommandRegistry] Command execution failed: ${O} - ${it}`),tt}defaultLogger.error(`[CommandRegistry] No handler found to execute command: ${O}`)}createAndRegisterCommand(O,Y,te,ne,xe){const et=new Command(O,Y,te,ne);this.registerCommand(et),xe&&this.registerHandler(O,xe)}registerCommand(O){this.commands[O.id]=O,defaultLogger.debug(`Command registered: ${O.id}`)}hasCommand(O){return O in this.commands}listCommands(O){return O?Object.values(this.commands).filter(Y=>(commandRegistry.getHandler(Y.id)||[]).some(ne=>ne.canExecute===void 0||ne.canExecute(O))).reduce((Y,te)=>(Y[te.id]=te,Y),{}):this.commands}getCommand(O){return this.commands[O]}registerAll(O){const Y=O.command.id;this.registerCommand(O.command),O.handler&&this.registerHandler(Y,O.handler),O.contribution&&O.contribution.target&&contributionRegistry.registerContribution(O.contribution.target,{command:Y,...O.contribution})}}const commandRegistry=new CommandRegistry;rootContext.put("commandRegistry",commandRegistry);const registerAll=ee=>{commandRegistry.registerAll(ee)},commandregistryCeQZw2S=Object.freeze(Object.defineProperty({__proto__:null,Command,CommandRegistry,CommandStack,commandRegistry,registerAll},Symbol.toStringTag,{value:"Module"})),TOPIC_WORKSPACE_CHANGED="events/filesys/workspaceChanged",TOPIC_WORKSPACE_CONNECTED="events/filesys/workspaceConnected";class Resource{constructor(){this.state={}}getWorkspacePath(){const O=[];let Y=this;for(;Y;)O.push(Y.getName()),Y=Y.getParent();return O.reverse(),O.shift(),O.join("/")}getWorkspace(){let O=this;for(;O;){const Y=O.getParent();if(Y)O=Y;else break}return O}}var FileContentType=(ee=>(ee[ee.TEXT=0]="TEXT",ee[ee.BINARY=1]="BINARY",ee))(FileContentType||{});class File extends Resource{}class Directory extends Resource{}class StringFile extends File{constructor(O,Y){super(),this.contents=O,this.name=Y}async getContents(O){return this.contents}async saveContents(O,Y){this.contents=O}async size(){return this.contents.length||null}async copyTo(O){throw Error("Not supported")}delete(O,Y){throw Error("Not supported")}async rename(O){throw Error("Not supported")}getName(){return this.name}getParent(){}}class FileSysFileHandleResource extends File{constructor(O,Y){super(),this.fileHandle=O,this.parent=Y}getName(){return this.fileHandle.name}getParent(){return this.parent}async delete(){return this.getParent().delete(this.getName())}async getContents(O){const Y=await this.fileHandle.getFile();return!O||O?.contentType==0?await Y.text():O?.encoding==0||O?.uri?URL.createObjectURL(Y):O?.blob?Y:Y.stream()}async size(){try{return(await this.fileHandle.getFile()).size}catch{return null}}async saveContents(O,Y){const te=await this.fileHandle.createWritable();if(O&&typeof O.pipeTo=="function")await O.pipeTo(te);else{const ne=te.getWriter();try{await ne.write(O)}finally{await ne.close()}}}async copyTo(O){const Y=await this.getContents({blob:!0});await(await this.getWorkspace().getResource(O,{create:!0})).saveContents(Y)}async rename(O){const Y=this.getParent();if(!Y)throw new Error("Cannot rename root resource");if(this.getName()!==O){if(!("move"in this.fileHandle)||typeof this.fileHandle.move!="function")throw new Error("File rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.fileHandle.move(O)}catch(te){throw te.name==="NotAllowedError"||te.message?.includes("not allowed")||te.message?.includes("user agent")?new Error("File rename failed: The operation took too long and user activation expired. Please try again."):te}await Y.listChildren(!0),publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}}}class FileSysDirHandleResource extends Directory{constructor(O,Y){super(),this.dirHandle=O,this.parent=Y}getHandle(){return this.dirHandle}getParent(){return this.parent}getName(){return this.dirHandle.name}async listChildren(O=!1){return O||!this.files?this.loadingPromise?this.loadingPromise:(this.loadingPromise=(async()=>{try{const Y={};try{for await(const te of this.dirHandle.values()){const xe=te.kind==="file"?new FileSysFileHandleResource(te,this):new FileSysDirHandleResource(te,this);Y[xe.getName()]=xe}}catch(te){if(te.name==="NotFoundError")return this.files={},[];throw te}return this.files=Y,Object.values(this.files)}finally{this.loadingPromise=void 0}})(),this.loadingPromise):Object.values(this.files)}async getResource(O,Y){if(!O)throw new Error("No path provided");const te=O.split("/");let ne=this,xe=!1;try{for(let et=0;et<te.length;et++){let tt=te[et];if(tt&&(tt=tt.trim()),!tt)break;if(ne instanceof FileSysDirHandleResource){if(await ne.listChildren(),!ne.files)return null;const it=ne.files[tt];if(it)ne=it;else if(Y?.create)if(xe=!0,et<te.length-1)try{const st=await ne.dirHandle.getDirectoryHandle(tt,{create:!0}),ot=new FileSysDirHandleResource(st,ne);ne.files[tt]=ot,ne=ot,ne instanceof FileSysDirHandleResource&&await ne.listChildren();continue}catch(st){throw st.name==="NotFoundError"?new Error(`Directory not found or not accessible: ${te.slice(0,et+1).join("/")}`):st}else try{const st=await ne.dirHandle.getFileHandle(tt,{create:!0}),ot=new FileSysFileHandleResource(st,ne);return ne.files[tt]=ot,ot}catch(st){throw st.name==="NotFoundError"?new Error(`File not found or not accessible: ${te.join("/")}`):st}else return null}}}finally{xe&&publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}return ne}touch(){publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}async delete(O,Y=!0){if(!O){const te=this.getParent();return te instanceof FileSysDirHandleResource&&(await te.listChildren(),te.files&&delete te.files[this.getName()]),this.files=void 0,this.loadingPromise=void 0,te?.delete(this.getName())}return this.dirHandle.removeEntry(O,{recursive:Y}).then(async()=>{this.files&&delete this.files[O],publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())})}async copyTo(O){for(const Y of await this.listChildren()){const te=[O,Y.getName()].join("/");await Y.copyTo(te)}}async rename(O){const Y=this.getParent();if(!Y)throw new Error("Cannot rename workspace root");if(this.getName()!==O){if(!("move"in this.dirHandle)||typeof this.dirHandle.move!="function")throw new Error("Directory rename not supported in this browser. Please use a browser with File System Access API move() support.");try{await this.dirHandle.move(O)}catch(te){throw te.name==="NotAllowedError"||te.message?.includes("not allowed")||te.message?.includes("user agent")?new Error("Directory rename failed: The operation took too long and user activation expired. Please try again."):te}await Y.listChildren(!0),publish(TOPIC_WORKSPACE_CHANGED,this.getWorkspace())}}}class WorkspaceService{constructor(){this.contributions=new Map,this.workspace=this.loadPersistedWorkspace(),this.workspace.then(O=>{O&&publish(TOPIC_WORKSPACE_CONNECTED,O)})}registerContribution(O){this.contributions.set(O.type,O),console.log(`Workspace contribution registered: ${O.name} (${O.type})`)}getContributions(){return Array.from(this.contributions.values())}async loadPersistedWorkspace(){const O=await persistenceService.getObject("workspace_data");if(!O)return;const Y=this.contributions.get(O.type);if(!Y){console.warn(`No contribution found for workspace type: ${O.type}`);return}try{if(Y.restore){const te=await Y.restore(O.data);return te&&(this.currentType=O.type),te}}catch(te){console.error(`Failed to restore workspace of type ${O.type}:`,te)}}async connectWorkspace(O){const Y=Array.from(this.contributions.values()).find(et=>et.canHandle(O));if(!Y)throw new Error("No workspace contribution can handle this input");const te=await Y.connect(O),ne=Y.persist?await Y.persist(te):O,xe={type:Y.type,data:ne};return await persistenceService.persistObject("workspace_data",xe),this.currentType=Y.type,this.workspace=Promise.resolve(te),publish(TOPIC_WORKSPACE_CONNECTED,te),te}async getWorkspace(){if(!this.workspace)throw new Error("No workspace connected.");return await this.workspace}isConnected(){return!!this.workspace}getWorkspaceType(){return this.currentType}async disconnectWorkspace(){this.workspace=void 0,this.currentType=void 0,await persistenceService.persistObject("workspace_data",null),await persistenceService.persistObject("workspace",null)}}const workspaceService=new WorkspaceService;rootContext.put("workspaceService",workspaceService);workspaceService.registerContribution({type:"filesystem",name:"Local File System",canHandle(ee){return ee&&"kind"in ee&&ee.kind==="directory"},async connect(ee){return new FileSysDirHandleResource(ee)},async restore(ee){if(ee&&"kind"in ee&&ee.kind==="directory")return new FileSysDirHandleResource(ee,void 0)},async persist(ee){return ee instanceof FileSysDirHandleResource?ee.getHandle():null}});const watchSignal=(ee,O)=>{const Y=new Signal.subtle.Watcher(async()=>{try{await 0,O(ee.get())}finally{Y.watch(ee)}});return Y.watch(ee),ee.get(),()=>{Y.unwatch(ee)}};Object.defineProperty(i$9.prototype,"model",{enumerable:!0,configurable:!0,writable:!0});class KWidget extends e$1(i$9){constructor(){super(...arguments),this.signalCleanups=new Set,this.eventSubscriptions=new Set}connectedCallback(){super.connectedCallback(),this.doBeforeUI()}disconnectedCallback(){super.disconnectedCallback(),this.eventSubscriptions.forEach(O=>unsubscribe(O)),this.eventSubscriptions.clear(),this.signalCleanups.forEach(O=>O()),this.signalCleanups.clear()}subscribe(O,Y){const te=subscribe(O,Y.bind(this));this.eventSubscriptions.add(te)}showInfo(O){toastInfo(O)}showError(O){toastError(O)}nobubble(O){return Y=>{Y.stopPropagation(),O.bind(this)(Y)}}command(O,Y={}){return()=>{this.executeCommand(O,Y)}}executeCommand(O,Y){const te=commandRegistry.createExecutionContext(Y);commandRegistry.execute(O,te)}watch(O,Y){const te=watchSignal(O,Y.bind(this));this.signalCleanups.add(te)}firstUpdated(O){super.firstUpdated(O),this.doInitUI()}updateIdle(){requestIdleCallback(()=>this.requestUpdate())}updateLater(){requestAnimationFrame(()=>this.requestUpdate())}doBeforeUI(){}doInitUI(){}withRefresh(O){O(),this.updateLater()}}const __vite_glob_0_0="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='2'%20y='2'%20width='28'%20height='28'%20fill='%23FFCA28'/%3e%3cpath%20d='M19%2025.2879L21.0615%2023.9237C21.2231%2024.4313%2022.2462%2025.6368%2023.5385%2025.6368C24.8308%2025.6368%2025.4308%2024.931%2025.4308%2024.463C25.4308%2023.1878%2024.1112%2022.7382%2023.4774%2022.5223C23.374%2022.4871%2023.289%2022.4581%2023.2308%2022.4328C23.2009%2022.4198%2023.1558%2022.4025%2023.0979%2022.3804C22.393%2022.1111%2019.7923%2021.1175%2019.7923%2018.2373C19.7923%2015.065%2022.8538%2014.7002%2023.5462%2014.7002C23.9991%2014.7002%2026.1769%2014.7557%2027.2615%2016.7939L25.2615%2018.1898C24.8231%2017.3015%2024.0946%2017.0081%2023.6462%2017.0081C22.5385%2017.0081%2022.3077%2017.8201%2022.3077%2018.1898C22.3077%2019.227%2023.5112%2019.6919%2024.5273%2020.0844C24.7932%2020.1871%2025.0462%2020.2848%2025.2615%2020.3866C26.3692%2020.91%2028%2021.7666%2028%2024.463C28%2025.8136%2026.8672%2028.0002%2024.0154%2028.0002C20.1846%2028.0002%2019.1692%2025.7003%2019%2025.2879Z'%20fill='%233E3E3E'/%3e%3cpath%20d='M9%2025.5587L11.1487%2024.1953C11.317%2024.7026%2011.9713%2025.638%2012.9205%2025.638C13.8698%2025.638%2014.3557%2024.663%2014.3557%2024.1953V15.0002H16.9982V24.1953C17.041%2025.4636%2016.3376%2028.0002%2013.2332%2028.0002C10.379%2028.0002%209.19242%2026.3039%209%2025.5587Z'%20fill='%233E3E3E'/%3e%3c/svg%3e",__vite_glob_0_1="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='-22%200%20300%20300'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20preserveAspectRatio='xMidYMid'%3e%3cg%3e%3cpath%20d='M10.5838307,156.409656%20L10.5838307,156.196646%20L10.5838307,123.657627%20L17.7200527,123.657627%20L17.7200527,158.912657%20C18.0516208,161.753926%2017.8075656,164.63288%2017.0023629,167.377784%20C16.19722,170.122687%2014.8474392,172.677251%2013.0335946,174.88924%20C9.6624625,177.797086%205.34298451,179.369568%200.891381719,179.309391%20L0.145805038,173.983903%20C3.01718628,173.985518%205.78730255,172.922981%207.92105685,171.001585%20C9.83826599,168.76489%2010.5838307,165.729334%2010.5838307,156.409656%20Z%20M63.8037763,152.209035%20C63.8037763,156.203166%2063.8037763,159.771277%2064.1232613,162.860071%20L57.7859014,162.860071%20L57.3598815,156.522711%20C56.0343268,158.765028%2054.1386519,160.616318%2051.8656486,161.888456%20C49.5925854,163.160593%2047.0232464,163.808237%2044.4187946,163.765408%20C38.2412071,163.765408%2030.8919752,160.410366%2030.8919752,146.723715%20L30.8919752,123.983721%20L38.0281972,123.983721%20L38.0281972,145.285823%20C38.0281972,152.688352%2040.3181887,157.641058%2046.7620834,157.641058%20C48.0878176,157.655354%2049.4030239,157.404719%2050.6306575,156.903927%20C51.8582911,156.403136%2052.9735276,155.662296%2053.9110465,154.724777%20C54.8485056,153.787318%2055.5894046,152.672022%2056.0901963,151.444448%20C56.5909282,150.216815%2056.8415633,148.901549%2056.8273268,147.575814%20L56.8273268,123.717444%20L63.9634889,123.717444%20L63.9634889,151.996025%20L63.8037763,152.209035%20Z%20M77.330762,136.653806%20C77.330762,131.70104%2077.330762,127.653648%2077.0112304,123.979032%20L83.4018876,123.979032%20L83.7213726,130.635931%20C85.1452074,128.23088%2087.1949721,126.257257%2089.6521533,124.925482%20C92.1093944,123.593709%2094.8819333,122.953703%2097.6742718,123.073695%20C107.153723,123.073695%20114.289945,131.008713%20114.289945,142.831393%20C114.289945,156.784292%20105.715831,163.707504%2096.4493898,163.707504%20C94.0776877,163.813321%2091.7187865,163.305232%2089.6009496,162.232346%20C87.4831127,161.159401%2085.6780613,159.558028%2084.3604623,157.583154%20L84.3604623,178.885226%20L77.330762,178.885226%20L77.330762,136.813578%20L77.330762,136.653806%20Z%20M84.3604623,147.038594%20C84.3797833,148.004885%2084.4867369,148.967408%2084.6800071,149.914378%20C85.2842232,152.279021%2086.6597255,154.374666%2088.5887785,155.869683%20C90.5178913,157.364761%2092.8904309,158.173852%2095.3310427,158.168947%20C102.840047,158.168947%20107.260258,152.044597%20107.260258,143.150938%20C107.260258,135.375686%20103.106354,128.718758%2095.59735,128.718758%20C92.6257387,128.962101%2089.844945,130.280974%2087.7762781,132.428062%20C85.7076111,134.575149%2084.4931374,137.403079%2084.3604623,140.381689%20L84.3604623,147.038594%20Z%20M127.004503,123.94359%20L135.578617,146.896647%20C136.483954,149.452886%20137.442529,152.54168%20138.081618,154.831671%20C138.827183,152.488442%20139.625985,149.506124%20140.58462,146.736875%20L148.359872,123.94359%20L155.868876,123.94359%20L145.21784,151.636343%20C139.892293,164.950152%20136.643726,171.820127%20131.744199,175.97403%20C129.27643,178.228071%20126.267791,179.805756%20123.010354,180.553953%20L121.252929,174.589376%20C123.530581,173.840999%20125.645092,172.666304%20127.48382,171.127799%20C130.081872,169.010501%20132.14366,166.310102%20133.501635,163.246013%20C133.792288,162.715372%20133.990404,162.139031%20134.087428,161.541814%20C134.026892,160.899135%20133.865146,160.270094%20133.60817,159.677902%20L119.122716,123.837079%20L126.897968,123.837079%20L127.004503,123.94359%20Z%20M174.813541,112.770851%20L174.813541,123.954441%20L185.038557,123.954441%20L185.038557,129.279989%20L174.813541,129.279989%20L174.813541,150.262575%20C174.813541,155.055568%20176.198196,157.824817%20180.139089,157.824817%20C181.538758,157.847727%20182.935316,157.686579%20184.292992,157.345559%20L184.612537,162.671047%20C182.57671,163.376355%20180.428486,163.701283%20178.275118,163.629682%20C176.849069,163.718929%20175.420569,163.498622%20174.087657,162.983833%20C172.754744,162.469044%20171.549004,161.671976%20170.553103,160.647363%20C168.383883,157.745977%20167.394359,154.130491%20167.783854,150.528882%20L167.783854,129.226751%20L161.712742,129.226751%20L161.712742,123.901204%20L167.890329,123.901204%20L167.890329,114.421764%20L174.813541,112.770851%20Z%20M198.184399,144.647511%20C198.03988,146.453639%20198.289199,148.269577%20198.915189,149.969888%20C199.541179,151.670199%20200.528884,153.214267%20201.810114,154.495437%20C203.091285,155.776667%20204.635352,156.764373%20206.335664,157.390363%20C208.035975,158.016352%20209.851913,158.265672%20211.658041,158.121153%20C215.311153,158.202863%20218.940457,157.513288%20222.309077,156.097409%20L223.533958,161.422956%20C219.400274,163.12572%20214.955358,163.942168%20210.486396,163.819423%20C207.881107,163.997798%20205.268101,163.61054%20202.826592,162.684147%20C200.385023,161.757814%20198.172795,160.3143%20196.341489,158.452721%20C194.51022,156.591082%20193.103284,154.355345%20192.217196,151.898941%20C191.331104,149.442478%20190.986827,146.82349%20191.207978,144.221491%20C191.207978,132.505346%20198.184399,123.238905%20209.581059,123.238905%20C222.362314,123.238905%20225.557643,134.422495%20225.557643,141.558717%20C225.625954,142.658281%20225.625954,143.761016%20225.557643,144.860581%20L198.024687,144.860581%20L198.184399,144.647511%20Z%20M219.06051,139.322023%20C219.266043,137.898188%20219.163995,136.446897%20218.761184,135.065892%20C218.358433,133.684886%20217.664311,132.406228%20216.725656,131.316115%20C215.786941,130.226062%20214.625525,129.349856%20213.31959,128.746561%20C212.013656,128.143278%20210.59353,127.826939%20209.155039,127.818864%20C206.228949,128.030665%20203.487515,129.327603%20201.467959,131.455549%20C199.448402,133.583436%20198.296377,136.388874%20198.237697,139.322023%20L219.06051,139.322023%20Z%20M236.385366,136.053478%20C236.385366,131.473555%20236.385366,127.532637%20236.065834,123.911277%20L242.456492,123.911277%20L242.456492,131.526792%20L242.775977,131.526792%20C243.446769,129.176325%20244.83268,127.093027%20246.741335,125.566097%20C248.64999,124.039161%20250.986699,123.144369%20253.427072,123.005938%20C254.098762,122.917777%20254.779066,122.917777%20255.450756,123.005938%20L255.450756,129.66288%20C254.63688,129.568608%20253.814868,129.568608%20253.000992,129.66288%20C250.58353,129.756495%20248.282771,130.726973%20246.528505,132.393068%20C244.774238,134.059104%20243.686458,136.306745%20243.468304,138.716252%20C243.269171,139.805946%20243.162278,140.910475%20243.148819,142.018055%20L243.148819,162.734394%20L236.11909,162.734394%20L236.11909,136.106715%20L236.385366,136.053478%20Z'%20fill='%234E4E4E'%3e%3c/path%3e%3cpath%20d='M233.257943,16.9621357%20C233.476636,20.5398773%20232.625434,24.1017075%20230.812666,27.1939108%20C228.999898,30.286174%20226.307754,32.7687777%20223.079047,34.3255867%20C219.85034,35.8823358%20216.231324,36.4427655%20212.683013,35.9355136%20C209.134702,35.4282017%20205.817704,33.8761781%20203.154559,31.4770796%20C200.491421,29.0780409%20198.602703,25.9404959%20197.729013,22.4642047%20C196.855323,18.9879135%20197.036209,15.330196%20198.248625,11.9570899%20C199.461041,8.5839838%20201.650109,5.64808944%20204.536953,3.52346926%20C207.423803,1.39884909%20210.877782,0.181657262%20214.458814,0.0269503701%20C216.806708,-0.10224713%20219.156996,0.233972409%20221.374429,1.01627461%20C223.591922,1.79857323%20225.632893,3.01152758%20227.379981,4.58537259%20C229.12701,6.15922358%20230.54576,8.06291398%20231.554522,10.1869719%20C232.563283,12.3110298%20233.142196,14.6135829%20233.257943,16.9621357%20Z'%20fill='%23767677'%3e%3c/path%3e%3cpath%20d='M127.952969,225.540984%20C80.0236372,225.540984%2037.8984531,208.339518%2016.1170646,182.936721%20C24.5683135,205.78944%2039.8176362,225.504615%2059.8124569,239.428562%20C79.8070981,253.352629%20103.588124,260.816651%20127.952969,260.816651%20C152.318411,260.816651%20176.098839,253.352629%20196.094019,239.428562%20C216.0886,225.504615%20231.337863,205.78944%20239.789471,182.936721%20C218.061379,208.339518%20176.095848,225.540984%20127.952969,225.540984%20Z'%20fill='%23F37726'%3e%3c/path%3e%3cpath%20d='M127.952969,60.3543133%20C175.882898,60.3543133%20218.008142,77.5557785%20239.789471,102.958396%20C231.337863,80.1058563%20216.0886,60.3906823%20196.094019,46.4667348%20C176.098839,32.5427873%20152.318411,25.0784666%20127.952969,25.0784666%20C103.588124,25.0784666%2079.8070981,32.5427873%2059.8124569,46.4667348%20C39.8176362,60.3906823%2024.5683135,80.1058563%2016.1170646,102.958396%20C37.8984531,77.502541%2079.8106871,60.3543133%20127.952969,60.3543133%20Z'%20fill='%23F37726'%3e%3c/path%3e%3cpath%20d='M61.9716874,274.975202%20C62.2528294,279.48161%2061.186045,283.969713%2058.9072992,287.867658%20C56.6284936,291.765602%2053.2409116,294.896926%2049.1761363,296.862707%20C45.1113611,298.828488%2040.5533909,299.539717%2036.0829934,298.905772%20C31.6125362,298.271767%2027.4320141,296.321359%2024.0740419,293.30297%20C20.7160636,290.284582%2018.3326671,286.334835%2017.2274978,281.957035%20C16.1223339,277.579176%2016.3454363,272.971497%2017.868382,268.720869%20C19.3913284,264.470301%2022.1451683,260.769335%2025.7790187,258.089483%20C29.4129289,255.40962%2033.7623156,253.872201%2038.2730898,253.673106%20C41.2280121,253.515051%2044.1851476,253.940738%2046.9755719,254.925846%20C49.7659364,255.910962%2052.3349165,257.436187%2054.5356604,259.414404%20C56.7364042,261.392633%2058.5259031,263.785032%2059.8017495,266.455044%20C61.0776558,269.124996%2061.8150255,272.02022%2061.9716874,274.975202%20Z'%20fill='%239E9E9E'%3e%3c/path%3e%3cpath%20d='M21.5641016,54.5650606%20C18.9814831,54.6363631%2016.4354131,53.9424806%2014.2460944,52.570687%20C12.0567996,51.1988336%2010.3219858,49.2102622%209.25983722,46.8551295%20C8.19768984,44.499937%207.85562972,41.8832824%208.276674,39.3342215%20C8.69771827,36.7851606%209.86306631,34.4174662%2011.6261678,32.5289814%20C13.3892752,30.6404727%2015.6714246,29.3154324%2018.1856119,28.7204982%20C20.6997394,28.1255646%2023.3336813,28.2873008%2025.7562282,29.1853653%20C28.1787154,30.0834346%2030.2815979,31.6777312%2031.800363,33.767765%20C33.3191879,35.8578106%2034.1861222,38.3502842%2034.2921188,40.9317063%20C34.3930308,44.4222341%2033.113057,47.8117302%2030.7300493,50.3642007%20C28.3470417,52.916731%2025.0533134,54.4262842%2021.5641016,54.5650606%20Z'%20fill='%23616262'%3e%3c/path%3e%3c/g%3e%3c/svg%3e",__vite_glob_0_2="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.0164%202C10.8193%202%209.03825%203.72453%209.03825%205.85185V8.51852H15.9235V9.25926H5.97814C3.78107%209.25926%202%2010.9838%202%2013.1111L2%2018.8889C2%2021.0162%203.78107%2022.7407%205.97814%2022.7407H8.27322V19.4815C8.27322%2017.3542%2010.0543%2015.6296%2012.2514%2015.6296H19.5956C21.4547%2015.6296%2022.9617%2014.1704%2022.9617%2012.3704V5.85185C22.9617%203.72453%2021.1807%202%2018.9836%202H13.0164ZM12.0984%206.74074C12.8589%206.74074%2013.4754%206.14378%2013.4754%205.40741C13.4754%204.67103%2012.8589%204.07407%2012.0984%204.07407C11.3378%204.07407%2010.7213%204.67103%2010.7213%205.40741C10.7213%206.14378%2011.3378%206.74074%2012.0984%206.74074Z'%20fill='url(%23paint0_linear_87_8204)'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M18.9834%2030C21.1805%2030%2022.9616%2028.2755%2022.9616%2026.1482V23.4815L16.0763%2023.4815L16.0763%2022.7408L26.0217%2022.7408C28.2188%2022.7408%2029.9998%2021.0162%2029.9998%2018.8889V13.1111C29.9998%2010.9838%2028.2188%209.25928%2026.0217%209.25928L23.7266%209.25928V12.5185C23.7266%2014.6459%2021.9455%2016.3704%2019.7485%2016.3704L12.4042%2016.3704C10.5451%2016.3704%209.03809%2017.8296%209.03809%2019.6296L9.03809%2026.1482C9.03809%2028.2755%2010.8192%2030%2013.0162%2030H18.9834ZM19.9015%2025.2593C19.1409%2025.2593%2018.5244%2025.8562%2018.5244%2026.5926C18.5244%2027.329%2019.1409%2027.9259%2019.9015%2027.9259C20.662%2027.9259%2021.2785%2027.329%2021.2785%2026.5926C21.2785%2025.8562%2020.662%2025.2593%2019.9015%2025.2593Z'%20fill='url(%23paint1_linear_87_8204)'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_87_8204'%20x1='12.4809'%20y1='2'%20x2='12.4809'%20y2='22.7407'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23327EBD'/%3e%3cstop%20offset='1'%20stop-color='%231565A7'/%3e%3c/linearGradient%3e%3clinearGradient%20id='paint1_linear_87_8204'%20x1='19.519'%20y1='9.25928'%20x2='19.519'%20y2='30'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFDA4B'/%3e%3cstop%20offset='1'%20stop-color='%23F9C600'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e";registerIconLibrary("k",{resolver:ee=>new URL(Object.assign({"../icons/js.svg":__vite_glob_0_0,"../icons/jupyter.svg":__vite_glob_0_1,"../icons/python.svg":__vite_glob_0_2})[`../icons/${ee}.svg`],import.meta.url).href,mutator:ee=>{ee.setAttribute("fill","currentColor"),ee.setAttribute("stroke","currentColor")}});var __defProp$a=Object.defineProperty,__getOwnPropDesc$c=Object.getOwnPropertyDescriptor,__decorateClass$c=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$c(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$a(O,Y,ne),ne};let KIcon=class extends KWidget{constructor(){super(...arguments),this.family="regular"}render(){if(!this.name)return"";const ee=this.name.trim().split(/ +/),O=ee.pop(),Y=ee.pop();return x$1`
            <wa-icon library="${Y||E$2}" variant="${this.variant||E$2}"
                         family="${this.family||E$2}" name=${O} label="${this.label||this.name||E$2}"></wa-icon>`}};KIcon.styles=i$c`
        :host {
            display: contents;
        }
    `;__decorateClass$c([n$7()],KIcon.prototype,"name",2);__decorateClass$c([n$7()],KIcon.prototype,"family",2);__decorateClass$c([n$7()],KIcon.prototype,"variant",2);__decorateClass$c([n$7()],KIcon.prototype,"label",2);KIcon=__decorateClass$c([t$b("k-icon")],KIcon);function L(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var T=L();function G(ee){T=ee}var E$1={exec:()=>null};function d(ee,O=""){let Y=typeof ee=="string"?ee:ee.source,te={replace:(ne,xe)=>{let et=typeof xe=="string"?xe:xe.source;return et=et.replace(m.caret,"$1"),Y=Y.replace(ne,et),te},getRegex:()=>new RegExp(Y,O)};return te}var be=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),m={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:ee=>new RegExp(`^( {0,3}${ee})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:ee=>new RegExp(`^ {0,${Math.min(3,ee-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:ee=>new RegExp(`^ {0,${Math.min(3,ee-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:ee=>new RegExp(`^ {0,${Math.min(3,ee-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:ee=>new RegExp(`^ {0,${Math.min(3,ee-1)}}#`),htmlBeginRegex:ee=>new RegExp(`^ {0,${Math.min(3,ee-1)}}<(?:[a-z].*>|!--)`,"i")},Re=/^(?:[ \t]*(?:\n|$))+/,Te=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Oe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,I=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,we=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,F=/(?:[*+-]|\d{1,9}[.)])/,ie=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,oe=d(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ye=d(ie).replace(/bull/g,F).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),j=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Pe=/^[^\n]+/,Q=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Se=d(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Q).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),$e=d(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,F).getRegex(),v="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",U=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,_e=d("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",U).replace("tag",v).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ae=d(j).replace("hr",I).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),Le=d(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ae).getRegex(),K={blockquote:Le,code:Te,def:Se,fences:Oe,heading:we,hr:I,html:_e,lheading:oe,list:$e,newline:Re,paragraph:ae,table:E$1,text:Pe},re=d("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",I).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex(),Me={...K,lheading:ye,table:re,paragraph:d(j).replace("hr",I).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",re).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v).getRegex()},ze={...K,html:d(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",U).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:E$1,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:d(j).replace("hr",I).replace("heading",` *#{1,6} *[^
]`).replace("lheading",oe).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Ae=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ee=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,le=/^( {2,}|\\)\n(?!\s*$)/,Ie=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,D=/[\p{P}\p{S}]/u,W=/[\s\p{P}\p{S}]/u,ue=/[^\s\p{P}\p{S}]/u,Ce=d(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,W).getRegex(),pe=/(?!~)[\p{P}\p{S}]/u,Be=/(?!~)[\s\p{P}\p{S}]/u,qe=/(?:[^\s\p{P}\p{S}]|~)/u,ve=d(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",be?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),ce=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,De=d(ce,"u").replace(/punct/g,D).getRegex(),He=d(ce,"u").replace(/punct/g,pe).getRegex(),he="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ze=d(he,"gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Ge=d(he,"gu").replace(/notPunctSpace/g,qe).replace(/punctSpace/g,Be).replace(/punct/g,pe).getRegex(),Ne=d("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ue).replace(/punctSpace/g,W).replace(/punct/g,D).getRegex(),Fe=d(/\\(punct)/,"gu").replace(/punct/g,D).getRegex(),je=d(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Qe=d(U).replace("(?:-->|$)","-->").getRegex(),Ue=d("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Qe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),q=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ke=d(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",q).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),de$7=d(/^!?\[(label)\]\[(ref)\]/).replace("label",q).replace("ref",Q).getRegex(),ke=d(/^!?\[(ref)\](?:\[\])?/).replace("ref",Q).getRegex(),We=d("reflink|nolink(?!\\()","g").replace("reflink",de$7).replace("nolink",ke).getRegex(),se=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,X={_backpedal:E$1,anyPunctuation:Fe,autolink:je,blockSkip:ve,br:le,code:Ee,del:E$1,emStrongLDelim:De,emStrongRDelimAst:Ze,emStrongRDelimUnd:Ne,escape:Ae,link:Ke,nolink:ke,punctuation:Ce,reflink:de$7,reflinkSearch:We,tag:Ue,text:Ie,url:E$1},Xe={...X,link:d(/^!?\[(label)\]\((.*?)\)/).replace("label",q).getRegex(),reflink:d(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",q).getRegex()},N={...X,emStrongRDelimAst:Ge,emStrongLDelim:He,url:d(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",se).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:d(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",se).getRegex()},Je={...N,br:d(le).replace("{2,}","*").getRegex(),text:d(N.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},C={normal:K,gfm:Me,pedantic:ze},M$1={normal:X,gfm:N,breaks:Je,pedantic:Xe},Ve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ge=ee=>Ve[ee];function w(ee,O){if(O){if(m.escapeTest.test(ee))return ee.replace(m.escapeReplace,ge)}else if(m.escapeTestNoEncode.test(ee))return ee.replace(m.escapeReplaceNoEncode,ge);return ee}function J(ee){try{ee=encodeURI(ee).replace(m.percentDecode,"%")}catch{return null}return ee}function V(ee,O){let Y=ee.replace(m.findPipe,(xe,et,tt)=>{let it=!1,st=et;for(;--st>=0&&tt[st]==="\\";)it=!it;return it?"|":" |"}),te=Y.split(m.splitPipe),ne=0;if(te[0].trim()||te.shift(),te.length>0&&!te.at(-1)?.trim()&&te.pop(),O)if(te.length>O)te.splice(O);else for(;te.length<O;)te.push("");for(;ne<te.length;ne++)te[ne]=te[ne].trim().replace(m.slashPipe,"|");return te}function z(ee,O,Y){let te=ee.length;if(te===0)return"";let ne=0;for(;ne<te&&ee.charAt(te-ne-1)===O;)ne++;return ee.slice(0,te-ne)}function fe(ee,O){if(ee.indexOf(O[1])===-1)return-1;let Y=0;for(let te=0;te<ee.length;te++)if(ee[te]==="\\")te++;else if(ee[te]===O[0])Y++;else if(ee[te]===O[1]&&(Y--,Y<0))return te;return Y>0?-2:-1}function me(ee,O,Y,te,ne){let xe=O.href,et=O.title||null,tt=ee[1].replace(ne.other.outputLinkReplace,"$1");te.state.inLink=!0;let it={type:ee[0].charAt(0)==="!"?"image":"link",raw:Y,href:xe,title:et,text:tt,tokens:te.inlineTokens(tt)};return te.state.inLink=!1,it}function Ye(ee,O,Y){let te=ee.match(Y.other.indentCodeCompensation);if(te===null)return O;let ne=te[1];return O.split(`
`).map(xe=>{let et=xe.match(Y.other.beginningSpace);if(et===null)return xe;let[tt]=et;return tt.length>=ne.length?xe.slice(ne.length):xe}).join(`
`)}var y=class{options;rules;lexer;constructor(ee){this.options=ee||T}space(ee){let O=this.rules.block.newline.exec(ee);if(O&&O[0].length>0)return{type:"space",raw:O[0]}}code(ee){let O=this.rules.block.code.exec(ee);if(O){let Y=O[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:O[0],codeBlockStyle:"indented",text:this.options.pedantic?Y:z(Y,`
`)}}}fences(ee){let O=this.rules.block.fences.exec(ee);if(O){let Y=O[0],te=Ye(Y,O[3]||"",this.rules);return{type:"code",raw:Y,lang:O[2]?O[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):O[2],text:te}}}heading(ee){let O=this.rules.block.heading.exec(ee);if(O){let Y=O[2].trim();if(this.rules.other.endingHash.test(Y)){let te=z(Y,"#");(this.options.pedantic||!te||this.rules.other.endingSpaceChar.test(te))&&(Y=te.trim())}return{type:"heading",raw:O[0],depth:O[1].length,text:Y,tokens:this.lexer.inline(Y)}}}hr(ee){let O=this.rules.block.hr.exec(ee);if(O)return{type:"hr",raw:z(O[0],`
`)}}blockquote(ee){let O=this.rules.block.blockquote.exec(ee);if(O){let Y=z(O[0],`
`).split(`
`),te="",ne="",xe=[];for(;Y.length>0;){let et=!1,tt=[],it;for(it=0;it<Y.length;it++)if(this.rules.other.blockquoteStart.test(Y[it]))tt.push(Y[it]),et=!0;else if(!et)tt.push(Y[it]);else break;Y=Y.slice(it);let st=tt.join(`
`),ot=st.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");te=te?`${te}
${st}`:st,ne=ne?`${ne}
${ot}`:ot;let rt=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(ot,xe,!0),this.lexer.state.top=rt,Y.length===0)break;let nt=xe.at(-1);if(nt?.type==="code")break;if(nt?.type==="blockquote"){let at=nt,ct=at.raw+`
`+Y.join(`
`),ut=this.blockquote(ct);xe[xe.length-1]=ut,te=te.substring(0,te.length-at.raw.length)+ut.raw,ne=ne.substring(0,ne.length-at.text.length)+ut.text;break}else if(nt?.type==="list"){let at=nt,ct=at.raw+`
`+Y.join(`
`),ut=this.list(ct);xe[xe.length-1]=ut,te=te.substring(0,te.length-nt.raw.length)+ut.raw,ne=ne.substring(0,ne.length-at.raw.length)+ut.raw,Y=ct.substring(xe.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:te,tokens:xe,text:ne}}}list(ee){let O=this.rules.block.list.exec(ee);if(O){let Y=O[1].trim(),te=Y.length>1,ne={type:"list",raw:"",ordered:te,start:te?+Y.slice(0,-1):"",loose:!1,items:[]};Y=te?`\\d{1,9}\\${Y.slice(-1)}`:`\\${Y}`,this.options.pedantic&&(Y=te?Y:"[*+-]");let xe=this.rules.other.listItemRegex(Y),et=!1;for(;ee;){let it=!1,st="",ot="";if(!(O=xe.exec(ee))||this.rules.block.hr.test(ee))break;st=O[0],ee=ee.substring(st.length);let rt=O[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,ht=>" ".repeat(3*ht.length)),nt=ee.split(`
`,1)[0],at=!rt.trim(),ct=0;if(this.options.pedantic?(ct=2,ot=rt.trimStart()):at?ct=O[1].length+1:(ct=O[2].search(this.rules.other.nonSpaceChar),ct=ct>4?1:ct,ot=rt.slice(ct),ct+=O[1].length),at&&this.rules.other.blankLine.test(nt)&&(st+=nt+`
`,ee=ee.substring(nt.length+1),it=!0),!it){let ht=this.rules.other.nextBulletRegex(ct),pt=this.rules.other.hrRegex(ct),ft=this.rules.other.fencesBeginRegex(ct),mt=this.rules.other.headingBeginRegex(ct),yt=this.rules.other.htmlBeginRegex(ct);for(;ee;){let bt=ee.split(`
`,1)[0],vt;if(nt=bt,this.options.pedantic?(nt=nt.replace(this.rules.other.listReplaceNesting,"  "),vt=nt):vt=nt.replace(this.rules.other.tabCharGlobal,"    "),ft.test(nt)||mt.test(nt)||yt.test(nt)||ht.test(nt)||pt.test(nt))break;if(vt.search(this.rules.other.nonSpaceChar)>=ct||!nt.trim())ot+=`
`+vt.slice(ct);else{if(at||rt.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||ft.test(rt)||mt.test(rt)||pt.test(rt))break;ot+=`
`+nt}!at&&!nt.trim()&&(at=!0),st+=bt+`
`,ee=ee.substring(bt.length+1),rt=vt.slice(ct)}}ne.loose||(et?ne.loose=!0:this.rules.other.doubleBlankLine.test(st)&&(et=!0));let ut=null,dt;this.options.gfm&&(ut=this.rules.other.listIsTask.exec(ot),ut&&(dt=ut[0]!=="[ ] ",ot=ot.replace(this.rules.other.listReplaceTask,""))),ne.items.push({type:"list_item",raw:st,task:!!ut,checked:dt,loose:!1,text:ot,tokens:[]}),ne.raw+=st}let tt=ne.items.at(-1);if(tt)tt.raw=tt.raw.trimEnd(),tt.text=tt.text.trimEnd();else return;ne.raw=ne.raw.trimEnd();for(let it=0;it<ne.items.length;it++)if(this.lexer.state.top=!1,ne.items[it].tokens=this.lexer.blockTokens(ne.items[it].text,[]),!ne.loose){let st=ne.items[it].tokens.filter(rt=>rt.type==="space"),ot=st.length>0&&st.some(rt=>this.rules.other.anyLine.test(rt.raw));ne.loose=ot}if(ne.loose)for(let it=0;it<ne.items.length;it++)ne.items[it].loose=!0;return ne}}html(ee){let O=this.rules.block.html.exec(ee);if(O)return{type:"html",block:!0,raw:O[0],pre:O[1]==="pre"||O[1]==="script"||O[1]==="style",text:O[0]}}def(ee){let O=this.rules.block.def.exec(ee);if(O){let Y=O[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),te=O[2]?O[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",ne=O[3]?O[3].substring(1,O[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):O[3];return{type:"def",tag:Y,raw:O[0],href:te,title:ne}}}table(ee){let O=this.rules.block.table.exec(ee);if(!O||!this.rules.other.tableDelimiter.test(O[2]))return;let Y=V(O[1]),te=O[2].replace(this.rules.other.tableAlignChars,"").split("|"),ne=O[3]?.trim()?O[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],xe={type:"table",raw:O[0],header:[],align:[],rows:[]};if(Y.length===te.length){for(let et of te)this.rules.other.tableAlignRight.test(et)?xe.align.push("right"):this.rules.other.tableAlignCenter.test(et)?xe.align.push("center"):this.rules.other.tableAlignLeft.test(et)?xe.align.push("left"):xe.align.push(null);for(let et=0;et<Y.length;et++)xe.header.push({text:Y[et],tokens:this.lexer.inline(Y[et]),header:!0,align:xe.align[et]});for(let et of ne)xe.rows.push(V(et,xe.header.length).map((tt,it)=>({text:tt,tokens:this.lexer.inline(tt),header:!1,align:xe.align[it]})));return xe}}lheading(ee){let O=this.rules.block.lheading.exec(ee);if(O)return{type:"heading",raw:O[0],depth:O[2].charAt(0)==="="?1:2,text:O[1],tokens:this.lexer.inline(O[1])}}paragraph(ee){let O=this.rules.block.paragraph.exec(ee);if(O){let Y=O[1].charAt(O[1].length-1)===`
`?O[1].slice(0,-1):O[1];return{type:"paragraph",raw:O[0],text:Y,tokens:this.lexer.inline(Y)}}}text(ee){let O=this.rules.block.text.exec(ee);if(O)return{type:"text",raw:O[0],text:O[0],tokens:this.lexer.inline(O[0])}}escape(ee){let O=this.rules.inline.escape.exec(ee);if(O)return{type:"escape",raw:O[0],text:O[1]}}tag(ee){let O=this.rules.inline.tag.exec(ee);if(O)return!this.lexer.state.inLink&&this.rules.other.startATag.test(O[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(O[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(O[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(O[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:O[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:O[0]}}link(ee){let O=this.rules.inline.link.exec(ee);if(O){let Y=O[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(Y)){if(!this.rules.other.endAngleBracket.test(Y))return;let xe=z(Y.slice(0,-1),"\\");if((Y.length-xe.length)%2===0)return}else{let xe=fe(O[2],"()");if(xe===-2)return;if(xe>-1){let et=(O[0].indexOf("!")===0?5:4)+O[1].length+xe;O[2]=O[2].substring(0,xe),O[0]=O[0].substring(0,et).trim(),O[3]=""}}let te=O[2],ne="";if(this.options.pedantic){let xe=this.rules.other.pedanticHrefTitle.exec(te);xe&&(te=xe[1],ne=xe[3])}else ne=O[3]?O[3].slice(1,-1):"";return te=te.trim(),this.rules.other.startAngleBracket.test(te)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(Y)?te=te.slice(1):te=te.slice(1,-1)),me(O,{href:te&&te.replace(this.rules.inline.anyPunctuation,"$1"),title:ne&&ne.replace(this.rules.inline.anyPunctuation,"$1")},O[0],this.lexer,this.rules)}}reflink(ee,O){let Y;if((Y=this.rules.inline.reflink.exec(ee))||(Y=this.rules.inline.nolink.exec(ee))){let te=(Y[2]||Y[1]).replace(this.rules.other.multipleSpaceGlobal," "),ne=O[te.toLowerCase()];if(!ne){let xe=Y[0].charAt(0);return{type:"text",raw:xe,text:xe}}return me(Y,ne,Y[0],this.lexer,this.rules)}}emStrong(ee,O,Y=""){let te=this.rules.inline.emStrongLDelim.exec(ee);if(!(!te||te[3]&&Y.match(this.rules.other.unicodeAlphaNumeric))&&(!(te[1]||te[2])||!Y||this.rules.inline.punctuation.exec(Y))){let ne=[...te[0]].length-1,xe,et,tt=ne,it=0,st=te[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(st.lastIndex=0,O=O.slice(-1*ee.length+ne);(te=st.exec(O))!=null;){if(xe=te[1]||te[2]||te[3]||te[4]||te[5]||te[6],!xe)continue;if(et=[...xe].length,te[3]||te[4]){tt+=et;continue}else if((te[5]||te[6])&&ne%3&&!((ne+et)%3)){it+=et;continue}if(tt-=et,tt>0)continue;et=Math.min(et,et+tt+it);let ot=[...te[0]][0].length,rt=ee.slice(0,ne+te.index+ot+et);if(Math.min(ne,et)%2){let at=rt.slice(1,-1);return{type:"em",raw:rt,text:at,tokens:this.lexer.inlineTokens(at)}}let nt=rt.slice(2,-2);return{type:"strong",raw:rt,text:nt,tokens:this.lexer.inlineTokens(nt)}}}}codespan(ee){let O=this.rules.inline.code.exec(ee);if(O){let Y=O[2].replace(this.rules.other.newLineCharGlobal," "),te=this.rules.other.nonSpaceChar.test(Y),ne=this.rules.other.startingSpaceChar.test(Y)&&this.rules.other.endingSpaceChar.test(Y);return te&&ne&&(Y=Y.substring(1,Y.length-1)),{type:"codespan",raw:O[0],text:Y}}}br(ee){let O=this.rules.inline.br.exec(ee);if(O)return{type:"br",raw:O[0]}}del(ee){let O=this.rules.inline.del.exec(ee);if(O)return{type:"del",raw:O[0],text:O[2],tokens:this.lexer.inlineTokens(O[2])}}autolink(ee){let O=this.rules.inline.autolink.exec(ee);if(O){let Y,te;return O[2]==="@"?(Y=O[1],te="mailto:"+Y):(Y=O[1],te=Y),{type:"link",raw:O[0],text:Y,href:te,tokens:[{type:"text",raw:Y,text:Y}]}}}url(ee){let O;if(O=this.rules.inline.url.exec(ee)){let Y,te;if(O[2]==="@")Y=O[0],te="mailto:"+Y;else{let ne;do ne=O[0],O[0]=this.rules.inline._backpedal.exec(O[0])?.[0]??"";while(ne!==O[0]);Y=O[0],O[1]==="www."?te="http://"+O[0]:te=O[0]}return{type:"link",raw:O[0],text:Y,href:te,tokens:[{type:"text",raw:Y,text:Y}]}}}inlineText(ee){let O=this.rules.inline.text.exec(ee);if(O){let Y=this.lexer.state.inRawBlock;return{type:"text",raw:O[0],text:O[0],escaped:Y}}}},x=class fi{tokens;options;state;tokenizer;inlineQueue;constructor(O){this.tokens=[],this.tokens.links=Object.create(null),this.options=O||T,this.options.tokenizer=this.options.tokenizer||new y,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let Y={other:m,block:C.normal,inline:M$1.normal};this.options.pedantic?(Y.block=C.pedantic,Y.inline=M$1.pedantic):this.options.gfm&&(Y.block=C.gfm,this.options.breaks?Y.inline=M$1.breaks:Y.inline=M$1.gfm),this.tokenizer.rules=Y}static get rules(){return{block:C,inline:M$1}}static lex(O,Y){return new fi(Y).lex(O)}static lexInline(O,Y){return new fi(Y).inlineTokens(O)}lex(O){O=O.replace(m.carriageReturn,`
`),this.blockTokens(O,this.tokens);for(let Y=0;Y<this.inlineQueue.length;Y++){let te=this.inlineQueue[Y];this.inlineTokens(te.src,te.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(O,Y=[],te=!1){for(this.options.pedantic&&(O=O.replace(m.tabCharGlobal,"    ").replace(m.spaceLine,""));O;){let ne;if(this.options.extensions?.block?.some(et=>(ne=et.call({lexer:this},O,Y))?(O=O.substring(ne.raw.length),Y.push(ne),!0):!1))continue;if(ne=this.tokenizer.space(O)){O=O.substring(ne.raw.length);let et=Y.at(-1);ne.raw.length===1&&et!==void 0?et.raw+=`
`:Y.push(ne);continue}if(ne=this.tokenizer.code(O)){O=O.substring(ne.raw.length);let et=Y.at(-1);et?.type==="paragraph"||et?.type==="text"?(et.raw+=(et.raw.endsWith(`
`)?"":`
`)+ne.raw,et.text+=`
`+ne.text,this.inlineQueue.at(-1).src=et.text):Y.push(ne);continue}if(ne=this.tokenizer.fences(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.heading(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.hr(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.blockquote(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.list(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.html(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.def(O)){O=O.substring(ne.raw.length);let et=Y.at(-1);et?.type==="paragraph"||et?.type==="text"?(et.raw+=(et.raw.endsWith(`
`)?"":`
`)+ne.raw,et.text+=`
`+ne.raw,this.inlineQueue.at(-1).src=et.text):this.tokens.links[ne.tag]||(this.tokens.links[ne.tag]={href:ne.href,title:ne.title},Y.push(ne));continue}if(ne=this.tokenizer.table(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}if(ne=this.tokenizer.lheading(O)){O=O.substring(ne.raw.length),Y.push(ne);continue}let xe=O;if(this.options.extensions?.startBlock){let et=1/0,tt=O.slice(1),it;this.options.extensions.startBlock.forEach(st=>{it=st.call({lexer:this},tt),typeof it=="number"&&it>=0&&(et=Math.min(et,it))}),et<1/0&&et>=0&&(xe=O.substring(0,et+1))}if(this.state.top&&(ne=this.tokenizer.paragraph(xe))){let et=Y.at(-1);te&&et?.type==="paragraph"?(et.raw+=(et.raw.endsWith(`
`)?"":`
`)+ne.raw,et.text+=`
`+ne.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=et.text):Y.push(ne),te=xe.length!==O.length,O=O.substring(ne.raw.length);continue}if(ne=this.tokenizer.text(O)){O=O.substring(ne.raw.length);let et=Y.at(-1);et?.type==="text"?(et.raw+=(et.raw.endsWith(`
`)?"":`
`)+ne.raw,et.text+=`
`+ne.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=et.text):Y.push(ne);continue}if(O){let et="Infinite loop on byte: "+O.charCodeAt(0);if(this.options.silent){console.error(et);break}else throw new Error(et)}}return this.state.top=!0,Y}inline(O,Y=[]){return this.inlineQueue.push({src:O,tokens:Y}),Y}inlineTokens(O,Y=[]){let te=O,ne=null;if(this.tokens.links){let it=Object.keys(this.tokens.links);if(it.length>0)for(;(ne=this.tokenizer.rules.inline.reflinkSearch.exec(te))!=null;)it.includes(ne[0].slice(ne[0].lastIndexOf("[")+1,-1))&&(te=te.slice(0,ne.index)+"["+"a".repeat(ne[0].length-2)+"]"+te.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(ne=this.tokenizer.rules.inline.anyPunctuation.exec(te))!=null;)te=te.slice(0,ne.index)+"++"+te.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let xe;for(;(ne=this.tokenizer.rules.inline.blockSkip.exec(te))!=null;)xe=ne[2]?ne[2].length:0,te=te.slice(0,ne.index+xe)+"["+"a".repeat(ne[0].length-xe-2)+"]"+te.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);te=this.options.hooks?.emStrongMask?.call({lexer:this},te)??te;let et=!1,tt="";for(;O;){et||(tt=""),et=!1;let it;if(this.options.extensions?.inline?.some(ot=>(it=ot.call({lexer:this},O,Y))?(O=O.substring(it.raw.length),Y.push(it),!0):!1))continue;if(it=this.tokenizer.escape(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.tag(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.link(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.reflink(O,this.tokens.links)){O=O.substring(it.raw.length);let ot=Y.at(-1);it.type==="text"&&ot?.type==="text"?(ot.raw+=it.raw,ot.text+=it.text):Y.push(it);continue}if(it=this.tokenizer.emStrong(O,te,tt)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.codespan(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.br(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.del(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(it=this.tokenizer.autolink(O)){O=O.substring(it.raw.length),Y.push(it);continue}if(!this.state.inLink&&(it=this.tokenizer.url(O))){O=O.substring(it.raw.length),Y.push(it);continue}let st=O;if(this.options.extensions?.startInline){let ot=1/0,rt=O.slice(1),nt;this.options.extensions.startInline.forEach(at=>{nt=at.call({lexer:this},rt),typeof nt=="number"&&nt>=0&&(ot=Math.min(ot,nt))}),ot<1/0&&ot>=0&&(st=O.substring(0,ot+1))}if(it=this.tokenizer.inlineText(st)){O=O.substring(it.raw.length),it.raw.slice(-1)!=="_"&&(tt=it.raw.slice(-1)),et=!0;let ot=Y.at(-1);ot?.type==="text"?(ot.raw+=it.raw,ot.text+=it.text):Y.push(it);continue}if(O){let ot="Infinite loop on byte: "+O.charCodeAt(0);if(this.options.silent){console.error(ot);break}else throw new Error(ot)}}return Y}},P=class{options;parser;constructor(ee){this.options=ee||T}space(ee){return""}code({text:ee,lang:O,escaped:Y}){let te=(O||"").match(m.notSpaceStart)?.[0],ne=ee.replace(m.endingNewline,"")+`
`;return te?'<pre><code class="language-'+w(te)+'">'+(Y?ne:w(ne,!0))+`</code></pre>
`:"<pre><code>"+(Y?ne:w(ne,!0))+`</code></pre>
`}blockquote({tokens:ee}){return`<blockquote>
${this.parser.parse(ee)}</blockquote>
`}html({text:ee}){return ee}def(ee){return""}heading({tokens:ee,depth:O}){return`<h${O}>${this.parser.parseInline(ee)}</h${O}>
`}hr(ee){return`<hr>
`}list(ee){let O=ee.ordered,Y=ee.start,te="";for(let et=0;et<ee.items.length;et++){let tt=ee.items[et];te+=this.listitem(tt)}let ne=O?"ol":"ul",xe=O&&Y!==1?' start="'+Y+'"':"";return"<"+ne+xe+`>
`+te+"</"+ne+`>
`}listitem(ee){let O="";if(ee.task){let Y=this.checkbox({checked:!!ee.checked});ee.loose?ee.tokens[0]?.type==="paragraph"?(ee.tokens[0].text=Y+" "+ee.tokens[0].text,ee.tokens[0].tokens&&ee.tokens[0].tokens.length>0&&ee.tokens[0].tokens[0].type==="text"&&(ee.tokens[0].tokens[0].text=Y+" "+w(ee.tokens[0].tokens[0].text),ee.tokens[0].tokens[0].escaped=!0)):ee.tokens.unshift({type:"text",raw:Y+" ",text:Y+" ",escaped:!0}):O+=Y+" "}return O+=this.parser.parse(ee.tokens,!!ee.loose),`<li>${O}</li>
`}checkbox({checked:ee}){return"<input "+(ee?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:ee}){return`<p>${this.parser.parseInline(ee)}</p>
`}table(ee){let O="",Y="";for(let ne=0;ne<ee.header.length;ne++)Y+=this.tablecell(ee.header[ne]);O+=this.tablerow({text:Y});let te="";for(let ne=0;ne<ee.rows.length;ne++){let xe=ee.rows[ne];Y="";for(let et=0;et<xe.length;et++)Y+=this.tablecell(xe[et]);te+=this.tablerow({text:Y})}return te&&(te=`<tbody>${te}</tbody>`),`<table>
<thead>
`+O+`</thead>
`+te+`</table>
`}tablerow({text:ee}){return`<tr>
${ee}</tr>
`}tablecell(ee){let O=this.parser.parseInline(ee.tokens),Y=ee.header?"th":"td";return(ee.align?`<${Y} align="${ee.align}">`:`<${Y}>`)+O+`</${Y}>
`}strong({tokens:ee}){return`<strong>${this.parser.parseInline(ee)}</strong>`}em({tokens:ee}){return`<em>${this.parser.parseInline(ee)}</em>`}codespan({text:ee}){return`<code>${w(ee,!0)}</code>`}br(ee){return"<br>"}del({tokens:ee}){return`<del>${this.parser.parseInline(ee)}</del>`}link({href:ee,title:O,tokens:Y}){let te=this.parser.parseInline(Y),ne=J(ee);if(ne===null)return te;ee=ne;let xe='<a href="'+ee+'"';return O&&(xe+=' title="'+w(O)+'"'),xe+=">"+te+"</a>",xe}image({href:ee,title:O,text:Y,tokens:te}){te&&(Y=this.parser.parseInline(te,this.parser.textRenderer));let ne=J(ee);if(ne===null)return w(Y);ee=ne;let xe=`<img src="${ee}" alt="${Y}"`;return O&&(xe+=` title="${w(O)}"`),xe+=">",xe}text(ee){return"tokens"in ee&&ee.tokens?this.parser.parseInline(ee.tokens):"escaped"in ee&&ee.escaped?ee.text:w(ee.text)}},$=class{strong({text:ee}){return ee}em({text:ee}){return ee}codespan({text:ee}){return ee}del({text:ee}){return ee}html({text:ee}){return ee}text({text:ee}){return ee}link({text:ee}){return""+ee}image({text:ee}){return""+ee}br(){return""}},b=class gi{options;renderer;textRenderer;constructor(O){this.options=O||T,this.options.renderer=this.options.renderer||new P,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new $}static parse(O,Y){return new gi(Y).parse(O)}static parseInline(O,Y){return new gi(Y).parseInline(O)}parse(O,Y=!0){let te="";for(let ne=0;ne<O.length;ne++){let xe=O[ne];if(this.options.extensions?.renderers?.[xe.type]){let tt=xe,it=this.options.extensions.renderers[tt.type].call({parser:this},tt);if(it!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(tt.type)){te+=it||"";continue}}let et=xe;switch(et.type){case"space":{te+=this.renderer.space(et);continue}case"hr":{te+=this.renderer.hr(et);continue}case"heading":{te+=this.renderer.heading(et);continue}case"code":{te+=this.renderer.code(et);continue}case"table":{te+=this.renderer.table(et);continue}case"blockquote":{te+=this.renderer.blockquote(et);continue}case"list":{te+=this.renderer.list(et);continue}case"html":{te+=this.renderer.html(et);continue}case"def":{te+=this.renderer.def(et);continue}case"paragraph":{te+=this.renderer.paragraph(et);continue}case"text":{let tt=et,it=this.renderer.text(tt);for(;ne+1<O.length&&O[ne+1].type==="text";)tt=O[++ne],it+=`
`+this.renderer.text(tt);Y?te+=this.renderer.paragraph({type:"paragraph",raw:it,text:it,tokens:[{type:"text",raw:it,text:it,escaped:!0}]}):te+=it;continue}default:{let tt='Token with "'+et.type+'" type was not found.';if(this.options.silent)return console.error(tt),"";throw new Error(tt)}}}return te}parseInline(O,Y=this.renderer){let te="";for(let ne=0;ne<O.length;ne++){let xe=O[ne];if(this.options.extensions?.renderers?.[xe.type]){let tt=this.options.extensions.renderers[xe.type].call({parser:this},xe);if(tt!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(xe.type)){te+=tt||"";continue}}let et=xe;switch(et.type){case"escape":{te+=Y.text(et);break}case"html":{te+=Y.html(et);break}case"link":{te+=Y.link(et);break}case"image":{te+=Y.image(et);break}case"strong":{te+=Y.strong(et);break}case"em":{te+=Y.em(et);break}case"codespan":{te+=Y.codespan(et);break}case"br":{te+=Y.br(et);break}case"del":{te+=Y.del(et);break}case"text":{te+=Y.text(et);break}default:{let tt='Token with "'+et.type+'" type was not found.';if(this.options.silent)return console.error(tt),"";throw new Error(tt)}}}return te}},S=class{options;block;constructor(ee){this.options=ee||T}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(ee){return ee}postprocess(ee){return ee}processAllTokens(ee){return ee}emStrongMask(ee){return ee}provideLexer(){return this.block?x.lex:x.lexInline}provideParser(){return this.block?b.parse:b.parseInline}},B=class{defaults=L();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=b;Renderer=P;TextRenderer=$;Lexer=x;Tokenizer=y;Hooks=S;constructor(...ee){this.use(...ee)}walkTokens(ee,O){let Y=[];for(let te of ee)switch(Y=Y.concat(O.call(this,te)),te.type){case"table":{let ne=te;for(let xe of ne.header)Y=Y.concat(this.walkTokens(xe.tokens,O));for(let xe of ne.rows)for(let et of xe)Y=Y.concat(this.walkTokens(et.tokens,O));break}case"list":{let ne=te;Y=Y.concat(this.walkTokens(ne.items,O));break}default:{let ne=te;this.defaults.extensions?.childTokens?.[ne.type]?this.defaults.extensions.childTokens[ne.type].forEach(xe=>{let et=ne[xe].flat(1/0);Y=Y.concat(this.walkTokens(et,O))}):ne.tokens&&(Y=Y.concat(this.walkTokens(ne.tokens,O)))}}return Y}use(...ee){let O=this.defaults.extensions||{renderers:{},childTokens:{}};return ee.forEach(Y=>{let te={...Y};if(te.async=this.defaults.async||te.async||!1,Y.extensions&&(Y.extensions.forEach(ne=>{if(!ne.name)throw new Error("extension name required");if("renderer"in ne){let xe=O.renderers[ne.name];xe?O.renderers[ne.name]=function(...et){let tt=ne.renderer.apply(this,et);return tt===!1&&(tt=xe.apply(this,et)),tt}:O.renderers[ne.name]=ne.renderer}if("tokenizer"in ne){if(!ne.level||ne.level!=="block"&&ne.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let xe=O[ne.level];xe?xe.unshift(ne.tokenizer):O[ne.level]=[ne.tokenizer],ne.start&&(ne.level==="block"?O.startBlock?O.startBlock.push(ne.start):O.startBlock=[ne.start]:ne.level==="inline"&&(O.startInline?O.startInline.push(ne.start):O.startInline=[ne.start]))}"childTokens"in ne&&ne.childTokens&&(O.childTokens[ne.name]=ne.childTokens)}),te.extensions=O),Y.renderer){let ne=this.defaults.renderer||new P(this.defaults);for(let xe in Y.renderer){if(!(xe in ne))throw new Error(`renderer '${xe}' does not exist`);if(["options","parser"].includes(xe))continue;let et=xe,tt=Y.renderer[et],it=ne[et];ne[et]=(...st)=>{let ot=tt.apply(ne,st);return ot===!1&&(ot=it.apply(ne,st)),ot||""}}te.renderer=ne}if(Y.tokenizer){let ne=this.defaults.tokenizer||new y(this.defaults);for(let xe in Y.tokenizer){if(!(xe in ne))throw new Error(`tokenizer '${xe}' does not exist`);if(["options","rules","lexer"].includes(xe))continue;let et=xe,tt=Y.tokenizer[et],it=ne[et];ne[et]=(...st)=>{let ot=tt.apply(ne,st);return ot===!1&&(ot=it.apply(ne,st)),ot}}te.tokenizer=ne}if(Y.hooks){let ne=this.defaults.hooks||new S;for(let xe in Y.hooks){if(!(xe in ne))throw new Error(`hook '${xe}' does not exist`);if(["options","block"].includes(xe))continue;let et=xe,tt=Y.hooks[et],it=ne[et];S.passThroughHooks.has(xe)?ne[et]=st=>{if(this.defaults.async&&S.passThroughHooksRespectAsync.has(xe))return(async()=>{let rt=await tt.call(ne,st);return it.call(ne,rt)})();let ot=tt.call(ne,st);return it.call(ne,ot)}:ne[et]=(...st)=>{if(this.defaults.async)return(async()=>{let rt=await tt.apply(ne,st);return rt===!1&&(rt=await it.apply(ne,st)),rt})();let ot=tt.apply(ne,st);return ot===!1&&(ot=it.apply(ne,st)),ot}}te.hooks=ne}if(Y.walkTokens){let ne=this.defaults.walkTokens,xe=Y.walkTokens;te.walkTokens=function(et){let tt=[];return tt.push(xe.call(this,et)),ne&&(tt=tt.concat(ne.call(this,et))),tt}}this.defaults={...this.defaults,...te}}),this}setOptions(ee){return this.defaults={...this.defaults,...ee},this}lexer(ee,O){return x.lex(ee,O??this.defaults)}parser(ee,O){return b.parse(ee,O??this.defaults)}parseMarkdown(ee){return(O,Y)=>{let te={...Y},ne={...this.defaults,...te},xe=this.onError(!!ne.silent,!!ne.async);if(this.defaults.async===!0&&te.async===!1)return xe(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof O>"u"||O===null)return xe(new Error("marked(): input parameter is undefined or null"));if(typeof O!="string")return xe(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(O)+", string expected"));if(ne.hooks&&(ne.hooks.options=ne,ne.hooks.block=ee),ne.async)return(async()=>{let et=ne.hooks?await ne.hooks.preprocess(O):O,tt=await(ne.hooks?await ne.hooks.provideLexer():ee?x.lex:x.lexInline)(et,ne),it=ne.hooks?await ne.hooks.processAllTokens(tt):tt;ne.walkTokens&&await Promise.all(this.walkTokens(it,ne.walkTokens));let st=await(ne.hooks?await ne.hooks.provideParser():ee?b.parse:b.parseInline)(it,ne);return ne.hooks?await ne.hooks.postprocess(st):st})().catch(xe);try{ne.hooks&&(O=ne.hooks.preprocess(O));let et=(ne.hooks?ne.hooks.provideLexer():ee?x.lex:x.lexInline)(O,ne);ne.hooks&&(et=ne.hooks.processAllTokens(et)),ne.walkTokens&&this.walkTokens(et,ne.walkTokens);let tt=(ne.hooks?ne.hooks.provideParser():ee?b.parse:b.parseInline)(et,ne);return ne.hooks&&(tt=ne.hooks.postprocess(tt)),tt}catch(et){return xe(et)}}}onError(ee,O){return Y=>{if(Y.message+=`
Please report this to https://github.com/markedjs/marked.`,ee){let te="<p>An error occurred:</p><pre>"+w(Y.message+"",!0)+"</pre>";return O?Promise.resolve(te):te}if(O)return Promise.reject(Y);throw Y}}},_=new B;function k(ee,O){return _.parse(ee,O)}k.options=k.setOptions=function(ee){return _.setOptions(ee),k.defaults=_.defaults,G(k.defaults),k};k.getDefaults=L;k.defaults=T;k.use=function(...ee){return _.use(...ee),k.defaults=_.defaults,G(k.defaults),k};k.walkTokens=function(ee,O){return _.walkTokens(ee,O)};k.parseInline=_.parseInline;k.Parser=b;k.parser=b.parse;k.Renderer=P;k.TextRenderer=$;k.Lexer=x;k.lexer=x.lex;k.Tokenizer=y;k.Hooks=S;k.parse=k;k.options;k.setOptions;k.use;k.walkTokens;k.parseInline;b.parse;x.lex;class KElement extends KWidget{constructor(){super(...arguments),this.settingsKey=null}buildDOMTreePath(){const O=[];let Y=this;for(;Y&&Y!==document.body&&Y!==document.documentElement;){const te=Y.getAttribute("id");if(te){O.unshift(`#${te}`);break}const ne=Y.tagName.toLowerCase(),xe=Y.parentElement;if(!xe)break;const tt=Array.from(xe.children).filter(it=>it.tagName.toLowerCase()===ne).indexOf(Y);tt>=0?O.unshift(`${ne}:${tt}`):O.unshift(ne),Y=xe}return O.length>0?O.join(" > "):null}initializeSettingsKey(){if(!this.settingsKey){const O=this.tagName.toLowerCase(),Y=this.getAttribute("id");if(Y){this.settingsKey=`${O}:${Y}`;return}const te=this.buildDOMTreePath();te&&(this.settingsKey=`${O}:${te}`)}}async getDialogSetting(){if(this.initializeSettingsKey(),!!this.settingsKey)return await appSettings.getDialogSetting(this.settingsKey)}async setDialogSetting(O){this.initializeSettingsKey(),this.settingsKey&&await appSettings.setDialogSetting(this.settingsKey,O)}}const _KDialogContent=class extends KElement{dispose(){}getResult(){}renderMessage(O,Y=!1){if(Y){const te=k.parse(O,{async:!1});return x$1`<div class="dialog-message" style="white-space: normal;">${o$5(te)}</div>`}return x$1`<div class="dialog-message" style="white-space: pre-line;">${O}</div>`}};_KDialogContent.styles=[i$c`
            .dialog-message {
                margin-bottom: 0.5rem;
                color: var(--wa-color-text-normal);
            }
        `];let KDialogContent=_KDialogContent;const logger$5=createLogger("DialogService"),DIALOG_CONTRIBUTION_TARGET="dialogs",OK_BUTTON={id:"ok",label:"OK",variant:"primary"},CANCEL_BUTTON={id:"cancel",label:"Cancel",variant:"default"},CLOSE_BUTTON={id:"close",label:"Close",variant:"default"};let dialogContainer=null;function getDialogContainer$1(){return dialogContainer||(dialogContainer=document.createElement("div"),dialogContainer.id="global-dialog-container",document.body.appendChild(dialogContainer)),dialogContainer}class DialogService{constructor(){this.contributions=new Map,this.loadContributions(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,O=>{O.target===DIALOG_CONTRIBUTION_TARGET&&this.loadContributions()})}loadContributions(){const O=contributionRegistry.getContributions(DIALOG_CONTRIBUTION_TARGET);this.contributions.clear();for(const Y of O){if(!Y.id){logger$5.warn("Dialog contribution missing id, skipping");continue}if(!Y.component){logger$5.warn(`Dialog contribution "${Y.id}" has no component function, skipping`);continue}if(!Y.onButton){logger$5.warn(`Dialog contribution "${Y.id}" has no onButton callback, skipping`);continue}this.contributions.set(Y.id,Y),logger$5.debug(`Loaded dialog contribution: ${Y.id}`)}logger$5.info(`Loaded ${this.contributions.size} dialog contributions`)}async open(O,Y){const te=this.contributions.get(O);if(!te)throw logger$5.error(`Dialog "${O}" not found`),new Error(`Dialog "${O}" not found`);return new Promise(ne=>{const xe=getDialogContainer$1();let et=!0,tt=null;const it=async()=>{if(et){if(et=!1,tt)try{await tt.dispose()}catch(nt){const at=nt instanceof Error?nt.message:String(nt);logger$5.error(`Error disposing dialog content for "${O}": ${at}`)}try{const nt=tt?tt.getResult():void 0;await te.onButton("close",nt,Y)}catch(nt){const at=nt instanceof Error?nt.message:String(nt);logger$5.error(`Error executing close callback for dialog "${O}": ${at}`)}B$1(x$1``,xe),ne()}},st=async nt=>{try{const at=tt?tt.getResult():void 0;await te.onButton(nt,at,Y)!==!1&&it()}catch(at){const ct=at instanceof Error?at.message:String(at);logger$5.error(`Error executing button callback for dialog "${O}": ${ct}`),it()}},ot=te.buttons&&te.buttons.length>0?te.buttons:[OK_BUTTON],rt=x$1`
                <wa-dialog label="${te.label||O}" open @wa-request-close=${it}>
                    <style>
                        .dialog-service-content {
                            display: flex;
                            flex-direction: column;
                            gap: 1rem;
                            padding: 1rem;
                            min-width: 400px;
                        }
                        
                        .dialog-service-footer {
                            display: flex;
                            gap: 0.5rem;
                            justify-content: flex-end;
                            margin-top: 1rem;
                            padding-top: 1rem;
                            border-top: 1px solid var(--wa-color-neutral-20);
                        }

                        :host-context(.wa-light) .dialog-service-footer {
                            border-top-color: var(--wa-color-neutral-80);
                        }
                    </style>
                    
                    <div class="dialog-service-content" 
                         @dialog-ok=${()=>{const nt=ot.find(at=>at.id==="ok");nt&&st(nt.id)}}
                         @dialog-cancel=${()=>{const nt=ot.find(at=>at.id==="cancel");nt?st(nt.id):it()}}>
                        ${te.component(Y)}
                        
                        <div class="dialog-service-footer">
                            ${ot.map(nt=>x$1`
                                <wa-button 
                                    variant="${nt.variant||"default"}"
                                    ?disabled=${nt.disabled}
                                    @click=${()=>st(nt.id)}
                                >
                                    ${nt.label}
                                </wa-button>
                            `)}
                        </div>
                    </div>
                </wa-dialog>
            `;B$1(rt,xe),(async()=>{const nt=Array.from(xe.querySelectorAll("*"));for(const at of nt)if(at instanceof KDialogContent){await at.updateComplete,tt=at;break}})()})}getDialogIds(){return Array.from(this.contributions.keys())}hasDialog(O){return this.contributions.has(O)}}const dialogService=new DialogService;rootContext.put("dialogService",dialogService);var __defProp$8=Object.defineProperty,__getOwnPropDesc$8$1=Object.getOwnPropertyDescriptor,__decorateClass$9$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$8$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$8(O,Y,ne),ne};let KPromptDialogContent=class extends KDialogContent{constructor(){super(...arguments),this.message="",this.defaultValue="",this.markdown=!1,this.inputValue=""}async firstUpdated(ee){super.firstUpdated(ee),this.inputValue=this.defaultValue,await this.updateComplete;const O=this.shadowRoot?.querySelector("wa-input");if(O){const Y=O.shadowRoot?.querySelector("input");Y&&(Y.focus(),Y.select())}}getResult(){return this.inputValue}handleInput(ee){this.inputValue=ee.target.value}handleKeyDown(ee){ee.key==="Enter"?(ee.preventDefault(),this.dispatchEvent(new CustomEvent("dialog-ok",{bubbles:!0,composed:!0}))):ee.key==="Escape"&&(ee.preventDefault(),this.dispatchEvent(new CustomEvent("dialog-cancel",{bubbles:!0,composed:!0})))}render(){return x$1`
            ${this.renderMessage(this.message,this.markdown)}
            <wa-input
                value="${this.inputValue}"
                @input=${this.handleInput}
                @keydown=${this.handleKeyDown}
                autofocus
            ></wa-input>
        `}};KPromptDialogContent.styles=[...KDialogContent.styles,i$c`
            wa-input {
                width: 100%;
            }
        `];__decorateClass$9$1([n$7({type:String})],KPromptDialogContent.prototype,"message",2);__decorateClass$9$1([n$7({type:String,attribute:"default-value"})],KPromptDialogContent.prototype,"defaultValue",2);__decorateClass$9$1([n$7({type:Boolean})],KPromptDialogContent.prototype,"markdown",2);__decorateClass$9$1([r$6()],KPromptDialogContent.prototype,"inputValue",2);KPromptDialogContent=__decorateClass$9$1([t$b("k-prompt-dialog-content")],KPromptDialogContent);contributionRegistry.registerContribution(DIALOG_CONTRIBUTION_TARGET,{id:"prompt",label:"Input",buttons:[OK_BUTTON,CANCEL_BUTTON],component:ee=>ee?x$1`
            <k-prompt-dialog-content 
                .message="${ee.message}"
                .defaultValue="${ee.defaultValue}"
                .markdown="${ee.markdown}"
            ></k-prompt-dialog-content>
        `:x$1`<div>Error: No prompt dialog state</div>`,onButton:async(ee,O,Y)=>(Y&&(ee==="ok"?Y.resolve(O||""):Y.resolve(null)),!0)});async function promptDialog(ee,O="",Y=!1){return new Promise(te=>{dialogService.open("prompt",{message:ee,defaultValue:O,markdown:Y,resolve:te})})}var __defProp$7=Object.defineProperty,__getOwnPropDesc$7$1=Object.getOwnPropertyDescriptor,__decorateClass$8$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$7$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$7(O,Y,ne),ne};let KInfoDialogContent=class extends KDialogContent{constructor(){super(...arguments),this.message="",this.markdown=!1}render(){return x$1`
            ${this.renderMessage(this.message,this.markdown)}
        `}};__decorateClass$8$1([n$7({type:String})],KInfoDialogContent.prototype,"message",2);__decorateClass$8$1([n$7({type:Boolean})],KInfoDialogContent.prototype,"markdown",2);KInfoDialogContent=__decorateClass$8$1([t$b("k-info-dialog-content")],KInfoDialogContent);contributionRegistry.registerContribution(DIALOG_CONTRIBUTION_TARGET,{id:"info",label:"Information",buttons:[OK_BUTTON],component:ee=>ee?x$1`
            <k-info-dialog-content 
                .message="${ee.message}"
                .markdown="${ee.markdown}"
            ></k-info-dialog-content>
        `:x$1`<div>Error: No info dialog state</div>`,onButton:async(ee,O,Y)=>(Y&&Y.resolve&&Y.resolve(),!0)});var __defProp$6$1=Object.defineProperty,__getOwnPropDesc$6$1=Object.getOwnPropertyDescriptor,__decorateClass$7$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$6$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$6$1(O,Y,ne),ne};let KConfirmDialogContent=class extends KDialogContent{constructor(){super(...arguments),this.message="",this.markdown=!1}getResult(){return!1}render(){return x$1`
            ${this.renderMessage(this.message,this.markdown)}
        `}};__decorateClass$7$1([n$7({type:String})],KConfirmDialogContent.prototype,"message",2);__decorateClass$7$1([n$7({type:Boolean})],KConfirmDialogContent.prototype,"markdown",2);KConfirmDialogContent=__decorateClass$7$1([t$b("k-confirm-dialog-content")],KConfirmDialogContent);contributionRegistry.registerContribution(DIALOG_CONTRIBUTION_TARGET,{id:"confirm",label:"Confirm",buttons:[OK_BUTTON,CANCEL_BUTTON],component:ee=>ee?x$1`
            <k-confirm-dialog-content 
                .message="${ee.message}"
                .markdown="${ee.markdown}"
            ></k-confirm-dialog-content>
        `:x$1`<div>Error: No confirm dialog state</div>`,onButton:async(ee,O,Y)=>(Y&&(ee==="ok"?Y.resolve(!0):Y.resolve(!1)),!0)});async function confirmDialog(ee,O=!1){return new Promise(Y=>{dialogService.open("confirm",{message:ee,markdown:O,resolve:Y})})}var __defProp$5$1=Object.defineProperty,__getOwnPropDesc$5$1=Object.getOwnPropertyDescriptor,__decorateClass$6$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$5$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$5$1(O,Y,ne),ne};let KNavigableInfoDialogContent=class extends KDialogContent{constructor(){super(...arguments),this.title="",this.message="",this.markdown=!1,this.actions=[],this.currentTitle="",this.currentMessage="",this.dialogElement=null}async firstUpdated(ee){super.firstUpdated(ee),this.currentTitle=this.title,this.currentMessage=this.message,await this.updateComplete;const O=this.closest("wa-dialog");O&&(this.dialogElement=O,this.updateDialogLabel());const Y=this.closest(".dialog-service-content");if(Y){const te=Y.parentElement?.querySelector(".dialog-service-footer");te&&(te.style.display="none")}}updated(ee){super.updated(ee),ee.has("title")&&(this.currentTitle=this.title,this.updateDialogLabel()),ee.has("message")&&(this.currentMessage=this.message)}updateDialogLabel(){this.dialogElement&&this.dialogElement.setAttribute("label",this.currentTitle)}updateDialog(ee,O,Y){this.currentTitle=ee,this.currentMessage=O,this.actions=[...Y],this.updateDialogLabel(),this.requestUpdate()}handleActionClick(ee){ee.callback()}handleClose(){this.closest("wa-dialog")&&this.resolveCallback&&this.resolveCallback()}render(){const ee=this.actions.filter(Y=>Y.label!=="Close"),O=this.actions.filter(Y=>Y.label==="Close");return x$1`
            <div class="dialog-content">
                <wa-scroller class="dialog-scroller">
                    ${this.renderMessage(this.currentMessage,this.markdown)}
                </wa-scroller>
                
                <div class="dialog-actions">
                    <div class="dialog-actions-left">
                        ${ee.map(Y=>x$1`
                            <wa-button 
                                variant="${Y.variant||"default"}"
                                ?disabled=${Y.disabled}
                                @click=${()=>this.handleActionClick(Y)}
                            >
                                ${Y.label}
                            </wa-button>
                        `)}
                    </div>
                    <div class="dialog-actions-right">
                        ${O.map(Y=>x$1`
                            <wa-button 
                                variant="${Y.variant||"primary"}"
                                @click=${()=>{this.handleActionClick(Y),this.handleClose()}}
                            >
                                ${Y.label}
                            </wa-button>
                        `)}
                    </div>
                </div>
            </div>
        `}};KNavigableInfoDialogContent.styles=[...KDialogContent.styles,i$c`
            :host {
                display: block;
            }

            :host-context(.dialog-service-content) {
                padding: 0;
            }
            
            .dialog-content {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                min-width: 400px;
                max-width: 600px;
                height: 500px;
                padding: 1rem;
            }
            
            .dialog-scroller {
                flex: 1;
                overflow-y: auto;
            }
            
            .dialog-actions {
                display: flex;
                gap: 0.5rem;
                justify-content: space-between;
                margin-top: 0.5rem;
            }
            
            .dialog-actions-left,
            .dialog-actions-right {
                display: flex;
                gap: 0.5rem;
            }
        `];__decorateClass$6$1([n$7({type:String})],KNavigableInfoDialogContent.prototype,"title",2);__decorateClass$6$1([n$7({type:String})],KNavigableInfoDialogContent.prototype,"message",2);__decorateClass$6$1([n$7({type:Boolean})],KNavigableInfoDialogContent.prototype,"markdown",2);__decorateClass$6$1([r$6()],KNavigableInfoDialogContent.prototype,"actions",2);__decorateClass$6$1([r$6()],KNavigableInfoDialogContent.prototype,"currentTitle",2);__decorateClass$6$1([r$6()],KNavigableInfoDialogContent.prototype,"currentMessage",2);KNavigableInfoDialogContent=__decorateClass$6$1([t$b("k-navigable-info-dialog-content")],KNavigableInfoDialogContent);contributionRegistry.registerContribution(DIALOG_CONTRIBUTION_TARGET,{id:"navigable-info",label:"Information",buttons:[CLOSE_BUTTON],component:ee=>{if(!ee)return x$1`<div>Error: No navigable info dialog state</div>`;const O=x$1`
            <k-navigable-info-dialog-content 
                .title="${ee.title}"
                .message="${ee.message}"
                .markdown="${ee.markdown}"
            ></k-navigable-info-dialog-content>
        `;return(async()=>{const Y=document.querySelector("k-navigable-info-dialog-content");Y&&(await Y.updateComplete,Y.actions=ee.actions||[],Y.resolveCallback=ee.resolve,ee.updateDialogRef&&(ee.updateDialogRef.current=(te,ne,xe)=>{Y.updateDialog(te,ne,xe)}))})(),O},onButton:async(ee,O,Y)=>Y&&ee==="close"&&Y.resolve?(Y.resolve(),!0):!1});var __getOwnPropDesc$4$1=Object.getOwnPropertyDescriptor,__decorateClass$5$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$4$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=et(ne)||ne);return ne};let KApp=class extends KElement{render(){return x$1`
            <slot></slot>
        `}};KApp.styles=i$c`
        :host {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            width: 100%;
            box-sizing: border-box;
        }
    `;KApp=__decorateClass$5$1([t$b("k-app")],KApp);var __defProp$4$1=Object.defineProperty,__getOwnPropDesc$3$1=Object.getOwnPropertyDescriptor,__decorateClass$4$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$3$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$4$1(O,Y,ne),ne};let KToolbar=class extends KElement{constructor(){super(...arguments),this.position="start",this.isEditor=!1,this.partToolbarContent=void 0,this.partToolbarRenderer=void 0,this.contributions=[]}doBeforeUI(){const ee=this.getAttribute("id");ee&&this.loadContributions(ee),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,O=>{if(!ee)return;this.matchesTarget(ee,O.target)&&(this.loadContributions(ee),this.requestUpdate())})}matchesTarget(ee,O){if(O===ee)return!0;if(!ee.includes(":"))return!1;const[Y]=ee.split(":");if(O===`${Y}:*`)return!0;const te=O.split(":");if(te.length===2){const ne=te[1];if(ne==="system.editors"||ne===".system.editors")return this.isEditor&&ee.startsWith(`${Y}:`)}return!1}loadContributions(ee){const O=contributionRegistry.getContributions(ee);if(!ee.includes(":")){this.contributions=O;return}const[Y]=ee.split(":"),te=`${Y}:*`,ne=contributionRegistry.getContributions(te),xe=[];if(this.isEditor){const et=["system.editors",".system.editors"];for(const tt of et){const it=`${Y}:${tt}`,st=contributionRegistry.getContributions(it);xe.push(...st)}}this.contributions=[...ne,...xe,...O]}contributionCreator(ee){if("command"in ee){const O=ee,Y=!!O.showLabel;return x$1`
                <wa-button @click=${()=>this.executeCommand(O.command,O.params||{})}
                           title=${O.label}
                           ?disabled="${O.disabled?.get()}"
                           appearance="plain" size="small">
                    <wa-icon name=${O.icon} label="${O.label}"></wa-icon>
                    ${Y?O.label:""}
                </wa-button>
            `}else if("html"in ee){const O=ee.html;return O instanceof Function?O():o$5(O)}else return x$1`<span>unknown contribution type: ${typeof ee}</span>`}render(){const ee=this.partToolbarRenderer?this.partToolbarRenderer():this.partToolbarContent?this.partToolbarContent:"";return x$1`
            <div class="toolbar-items" style=${o$7({"justify-content":this.position})}>
                <slot name="start">
                    ${this.contributions.filter(O=>O.slot==="start").map(this.contributionCreator.bind(this))}
                </slot>
                ${ee}
                ${this.contributions.filter(O=>O.slot===void 0).map(this.contributionCreator.bind(this))}
                <slot>
                </slot>
                <slot name="end">
                    ${this.contributions.filter(O=>O.slot==="end").map(this.contributionCreator.bind(this))}
                </slot>
            </div>
        `}};KToolbar.styles=i$c`
        :host {
            display: flex;
            flex-direction: row;
        }

        .toolbar-items {
            display: flex;
            flex: 1;
        }
    `;__decorateClass$4$1([n$7()],KToolbar.prototype,"position",2);__decorateClass$4$1([n$7({type:Boolean,attribute:"is-editor"})],KToolbar.prototype,"isEditor",2);__decorateClass$4$1([n$7({attribute:!1})],KToolbar.prototype,"partToolbarContent",2);__decorateClass$4$1([n$7({attribute:!1})],KToolbar.prototype,"partToolbarRenderer",2);__decorateClass$4$1([r$6()],KToolbar.prototype,"contributions",2);KToolbar=__decorateClass$4$1([t$b("k-toolbar")],KToolbar);var __defProp$3$1=Object.defineProperty,__getOwnPropDesc$2$1=Object.getOwnPropertyDescriptor,__decorateClass$3$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$2$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$3$1(O,Y,ne),ne};let KContextMenu=class extends KElement{constructor(){super(...arguments),this.isEditor=!1,this.partContextMenuRenderer=void 0,this.contributions=[],this.isOpen=!1,this.position={x:0,y:0},this.anchorRef=e$2(),this.dropdownRef=e$2()}doBeforeUI(){const ee=this.getAttribute("id");ee&&this.loadContributions(ee),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,O=>{if(!ee)return;this.matchesTarget(ee,O.target)&&(this.loadContributions(ee),this.requestUpdate())})}matchesTarget(ee,O){if(O===ee)return!0;if(!ee.includes(":"))return!1;const[Y]=ee.split(":");if(O===`${Y}:*`)return!0;const te=O.split(":");if(te.length===2){const ne=te[1];if(ne==="system.editors"||ne===".system.editors")return this.isEditor&&ee.startsWith(`${Y}:`)}return!1}loadContributions(ee){const O=contributionRegistry.getContributions(ee);if(!ee.includes(":")){this.contributions=O;return}const[Y]=ee.split(":"),te=`${Y}:*`,ne=contributionRegistry.getContributions(te),xe=[];if(this.isEditor){const et=["system.editors",".system.editors"];for(const tt of et){const it=`${Y}:${tt}`,st=contributionRegistry.getContributions(it);xe.push(...st)}}this.contributions=[...ne,...xe,...O]}getElementFromPoint(ee,O){let Y=document.elementFromPoint(ee,O);if(!Y)return null;for(;Y;){const te=Y.shadowRoot;if(te){const ne=te.elementFromPoint(ee,O);if(ne&&ne!==Y){Y=ne;continue}}break}return Y}triggerClickUnderCursor(ee){const O=this.getElementFromPoint(ee.clientX,ee.clientY);if(O){const Y=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,clientX:ee.clientX,clientY:ee.clientY,screenX:ee.screenX,screenY:ee.screenY,button:0,buttons:0,detail:1,which:1});O.dispatchEvent(Y)}}show(ee,O){O&&this.triggerClickUnderCursor(O),this.position=ee,this.isOpen=!0}onClose(){this.isOpen=!1}handleCommandClick(ee,O){return async()=>{this.executeCommand(ee,O||{})}}renderContribution(ee){if("command"in ee){const O=ee;return x$1`
                <wa-dropdown-item 
                    @click=${this.handleCommandClick(O.command,O.params)}
                    ?disabled="${O.disabled?.get()}">
                    ${O.icon?x$1`<wa-icon slot="icon" name=${O.icon}></wa-icon>`:""}
                    ${O.label}
                </wa-dropdown-item>
            `}else if("html"in ee){const O=ee.html;return O instanceof Function?O():o$5(O)}return E$2}render(){if(!this.isOpen)return E$2;const ee=this.partContextMenuRenderer?this.partContextMenuRenderer():E$2;return x$1`
            <wa-dropdown 
                ${n$1(this.dropdownRef)}
                ?open=${this.isOpen}
                @wa-after-hide=${this.onClose}
                placement="bottom-start"
                distance="0">
                
                <div 
                    slot="trigger"
                    ${n$1(this.anchorRef)}
                    style="position: fixed; 
                           left: ${this.position.x}px; 
                           top: ${this.position.y}px; 
                           width: 1px; 
                           height: 1px; 
                           pointer-events: none;">
                </div>
                
                ${ee}
                ${this.contributions.map(O=>this.renderContribution(O))}
            </wa-dropdown>
        `}};KContextMenu.styles=i$c`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            pointer-events: none;
            z-index: 10000;
        }

        wa-dropdown {
            pointer-events: auto;
            min-width: 200px;
        }
        
        wa-dropdown::part(panel) {
            min-width: 200px;
        }
    `;__decorateClass$3$1([n$7({type:Boolean,attribute:"is-editor"})],KContextMenu.prototype,"isEditor",2);__decorateClass$3$1([n$7({attribute:!1})],KContextMenu.prototype,"partContextMenuRenderer",2);__decorateClass$3$1([r$6()],KContextMenu.prototype,"contributions",2);__decorateClass$3$1([r$6()],KContextMenu.prototype,"isOpen",2);__decorateClass$3$1([r$6()],KContextMenu.prototype,"position",2);KContextMenu=__decorateClass$3$1([t$b("k-contextmenu")],KContextMenu);class KContainer extends KElement{}var __defProp$2$1=Object.defineProperty,__decorateClass$2$1=(ee,O,Y,te)=>{for(var ne=void 0,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=et(O,Y,ne)||ne);return ne&&__defProp$2$1(O,Y,ne),ne};class KPart extends KContainer{constructor(){super(...arguments),this.dirty=!1,this.isEditor=!1}getCommandStack(){return this.commandStack}renderToolbar(){return E$2}updateToolbar(){this.dispatchEvent(new CustomEvent("part-toolbar-changed",{bubbles:!0,composed:!0}))}renderContextMenu(){return E$2}updateContextMenu(){this.dispatchEvent(new CustomEvent("part-contextmenu-changed",{bubbles:!0,composed:!0}))}updated(O){super.updated(O),O.has("dirty")&&O.get("dirty")!==void 0&&this.dispatchEvent(new CustomEvent("dirty",{detail:this.dirty,bubbles:!0}))}doClose(){}disconnectedCallback(){super.disconnectedCallback()}close(){this.doClose()}connectedCallback(){super.connectedCallback()}save(){}isDirty(){return this.dirty}markDirty(O){this.dirty=O,partDirtySignal.set(null),partDirtySignal.set(this),activePartSignal.set(null),activePartSignal.set(this)}}__decorateClass$2$1([n$7()],KPart.prototype,"dirty");const TOOLBAR_MAIN="app-toolbars-main",TOOLBAR_MAIN_RIGHT="app-toolbars-main-right",TOOLBAR_MAIN_CENTER="app-toolbars-main-center",TOOLBAR_BOTTOM="app-toolbars-bottom",TOOLBAR_BOTTOM_CENTER="app-toolbars-bottom-center",TOOLBAR_BOTTOM_END="app-toolbars-bottom-end",EDITOR_AREA_MAIN="editor-area-main",SIDEBAR_MAIN="sidebar-main",SIDEBAR_MAIN_BOTTOM="sidebar-main-bottom",SIDEBAR_AUXILIARY="sidebar-auxiliary",PANEL_BOTTOM="panel-bottom",HIDE_DOT_RESOURCE=!1;var MouseButton=(ee=>(ee[ee.LEFT=0]="LEFT",ee[ee.MIDDLE=1]="MIDDLE",ee[ee.RIGHT=2]="RIGHT",ee[ee.BACK=3]="BACK",ee[ee.FORWARD=4]="FORWARD",ee))(MouseButton||{}),__defProp$1$1=Object.defineProperty,__getOwnPropDesc$1$1=Object.getOwnPropertyDescriptor,__decorateClass$1$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$1$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$1$1(O,Y,ne),ne};let KTabs=class extends KContainer{constructor(){super(...arguments),this.contributions=[],this.tabGroup=e$2(),this.containerId=null,this.resizeObservers=new WeakMap}doBeforeUI(){if(this.containerId=this.getAttribute("id"),!this.containerId)throw new Error("k-tabs requires an 'id' attribute to function");this.loadAndResolveContributions()}doInitUI(){this.updateComplete.then(()=>{this.activateNextAvailableTab(),this.tabGroup.value&&(this.tabGroup.value.addEventListener("wa-tab-show",ee=>{const O=this.getTabPanel(ee.detail.name);O&&(this.updateToolbarFromComponent(O),requestAnimationFrame(()=>{this.updateToolbarHeightVariable(O),this.setupToolbarResizeObserver(O)}),this.dispatchEvent(new CustomEvent("tab-shown",{detail:O})))}),this.tabGroup.value.addEventListener("part-toolbar-changed",ee=>{const Y=ee.target.closest("wa-tab-panel");Y&&(this.updateToolbarFromComponent(Y),requestAnimationFrame(()=>this.updateToolbarHeightVariable(Y)))}),this.tabGroup.value.addEventListener("part-contextmenu-changed",ee=>{const Y=ee.target.closest("wa-tab-panel");Y&&this.updateContextMenuFromComponent(Y)}),this.tabGroup.value.addEventListener("click",ee=>{const O=ee.target,Y=O.closest("wa-tab");if(Y){const et=Y.getAttribute("panel");if(et){const tt=this.getTabPanel(et);if(tt){const it=tt.querySelector(".tab-content");if(it&&it.firstElementChild){const st=it.firstElementChild;st instanceof KPart&&activePartSignal.set(st)}}}return}const te=O.closest("wa-scroller.tab-content");if(!te)return;const ne=te.closest("wa-tab-panel");if(!ne)return;const xe=ne.querySelector(".tab-content");if(xe&&xe.firstElementChild){const et=xe.firstElementChild;et instanceof KPart&&activePartSignal.set(et)}}),this.tabGroup.value.addEventListener("contextmenu",ee=>{const O=ee,Y=O.target.closest("wa-scroller.tab-content");if(!Y)return;O.preventDefault();const te=Y.closest("wa-tab-panel");te&&requestAnimationFrame(()=>{this.updateContextMenuFromComponent(te);const ne=te.querySelector("k-contextmenu");ne&&ne.show({x:O.clientX,y:O.clientY},O)})}))}),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,ee=>{!this.containerId||ee.target!==this.containerId||(this.loadAndResolveContributions(),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()}))})}updated(ee){if(super.updated(ee),ee.has("contributions")){const O=this.containerId===EDITOR_AREA_MAIN;this.contributions.forEach(Y=>{const te=this.getTabPanel(Y.name);if(!te)return;const ne=te.querySelector(".tab-content");if(ne&&ne.firstElementChild){const xe=ne.firstElementChild;xe instanceof KPart&&(xe.tabContribution=Y,xe.isEditor=O)}requestAnimationFrame(()=>this.updateToolbarHeightVariable(te))})}}has(ee){return this.tabGroup.value?!!this.getTabPanel(ee):!1}activate(ee){this.tabGroup.value&&this.tabGroup.value.setAttribute("active",ee)}getActiveEditor(){return this.tabGroup.value?this.tabGroup.value.getAttribute("active"):null}open(ee){if(this.contributions.find(Y=>Y.name===ee.name)){this.activate(ee.name);return}this.contributions.push(ee),this.requestUpdate(),this.updateComplete.then(()=>{this.activate(ee.name);const Y=this.getTabPanel(ee.name);if(Y){const te=Y.querySelector(".tab-content");if(te&&te.firstElementChild){const ne=te.firstElementChild;ne instanceof KPart&&(ne.tabContribution=ee,ne.isEditor=this.containerId===EDITOR_AREA_MAIN)}requestAnimationFrame(()=>{this.updateToolbarFromComponent(Y),this.updateToolbarHeightVariable(Y),this.setupToolbarResizeObserver(Y)})}})}handleTabAuxClick(ee,O){ee.button===MouseButton.MIDDLE&&O.closable&&this.closeTab(ee,O.name)}async closeTab(ee,O){if(ee.stopPropagation(),this.isDirty(O)&&!await confirmDialog("Unsaved changes will be lost: Do you really want to close?"))return;const Y=this.getTabPanel(O);if(!Y)return;const te=this.contributions.find(xe=>xe.name===O);if(!te)return;this.cleanupTabInstance(Y);const ne=this.contributions.indexOf(te);ne>-1&&this.contributions.splice(ne,1),this.dispatchEvent(new CustomEvent("tab-closed",{detail:Y})),this.requestUpdate(),this.updateComplete.then(()=>{this.activateNextAvailableTab()})}markDirty(ee,O){this.getTab(ee).classList.toggle("part-dirty",O)}isDirty(ee){return this.getTab(ee).classList.contains("part-dirty")}loadAndResolveContributions(){this.contributions=contributionRegistry.getContributions(this.containerId),this.requestUpdate()}cleanupTabInstance(ee){const O=this.resizeObservers.get(ee);O&&(O.disconnect(),this.resizeObservers.delete(ee));const Y=ee.querySelector(".tab-content");if(Y&&Y.firstElementChild){const te=Y.firstElementChild;"close"in te&&typeof te.close=="function"&&te.close()}}activateNextAvailableTab(){if(!this.tabGroup.value)return;const ee=this.tabGroup.value.querySelectorAll("wa-tab");if(ee.length>0){const O=ee.item(0).getAttribute("panel");O&&this.tabGroup.value.setAttribute("active",O)}else this.tabGroup.value.removeAttribute("active")}getTabPanel(ee){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab-panel[name='${ee}']`):null}getTab(ee){return this.tabGroup.value?this.tabGroup.value.querySelector(`wa-tab[panel='${ee}']`):null}updateToolbarFromComponent(ee){const O=ee.querySelector(".tab-content");if(!O||!O.firstElementChild)return;const Y=O.firstElementChild;if(!(Y instanceof KPart)||!Y.renderToolbar)return;const te=ee.querySelector("k-toolbar");te&&(te.partToolbarRenderer=()=>Y.renderToolbar(),te.requestUpdate())}updateContextMenuFromComponent(ee){const O=ee.querySelector(".tab-content");if(!O||!O.firstElementChild)return;const Y=O.firstElementChild;if(!(Y instanceof KPart)||!Y.renderContextMenu)return;const te=ee.querySelector("k-contextmenu");te&&(te.partContextMenuRenderer=()=>Y.renderContextMenu(),te.requestUpdate())}updateToolbarHeightVariable(ee){const O=ee.querySelector(".tab-toolbar");if(!O)return;const Y=O.offsetHeight;ee.style.setProperty("--toolbar-height",`${Y}px`)}setupToolbarResizeObserver(ee){if(this.resizeObservers.has(ee))return;const O=ee.querySelector(".tab-toolbar");if(!O)return;const Y=new ResizeObserver(()=>{this.updateToolbarHeightVariable(ee)});Y.observe(O),this.resizeObservers.set(ee,Y)}render(){const ee=appLoaderService.getCurrentApp();return x$1`
            <wa-tab-group ${n$1(this.tabGroup)}>
                ${n$5(this.contributions.length===0,()=>x$1`
                        <div class="empty-state">
                            ${n$5(ee,()=>x$1`
                                    <div class="empty-content">
                                        <h2 class="empty-title">${ee.name}</h2>
                                        ${n$5(ee.description,()=>x$1`<p class="empty-description">${ee.description}</p>`)}
                                    </div>
                                `,()=>x$1`
                                    <wa-icon name="folder-open" class="empty-icon"></wa-icon>
                                `)}
                        </div>
                    `,()=>c$2(this.contributions,O=>O.name,O=>x$1`
                            <wa-tab panel="${O.name}"
                                    @auxclick="${Y=>this.handleTabAuxClick(Y,O)}">
                                <k-icon name="${O.icon}"></k-icon>
                                ${O.label}
                                ${n$5(O.closable,()=>x$1`
                                    <wa-icon name="xmark" label="Close"  @click="${Y=>this.closeTab(Y,O.name)}"></wa-icon>
                                `)}
                            </wa-tab>
                            <wa-tab-panel name="${O.name}">
                                <k-toolbar id="toolbar:${O.editorId??O.name}" 
                                           class="tab-toolbar"
                                           ?is-editor="${this.containerId===EDITOR_AREA_MAIN}"></k-toolbar>
                                <wa-scroller class="tab-content" orientation="vertical">
                                    ${O.component?O.component(O.name):E$2}
                                </wa-scroller>
                                <k-contextmenu id="contextmenu:${O.name}"
                                               ?is-editor="${this.containerId===EDITOR_AREA_MAIN}"></k-contextmenu>
                            </wa-tab-panel>
                        `))}
            </wa-tab-group>
        `}};KTabs.styles=i$c`
        :host {
            height: 100%;
            width: 100%;
        }

        wa-tab-group {
            height: 100%;
            width: 100%;
        }

        wa-tab-group::part(base) {
            display: grid;
            grid-template-rows: auto minmax(0, 1fr);
            height: 100%;
            width: 100%;
        }

        wa-tab-panel[active] {
            display: grid;
            grid-template-rows: minmax(0, 1fr);
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .tab-content {
            position: absolute;
            top: calc(var(--toolbar-height, 0px));
            right: 0;
            left: 0;
            height: calc(100% - var(--toolbar-height, 0px));
        }

        wa-tab::part(base) {
            padding: 3px 0.5rem;
        }

        wa-tab-panel {
            --padding: 0px;
        }

        .part-dirty::part(base) {
            font-style: italic;
            color: var(--wa-color-danger-fill-loud)
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            grid-row: 2;
        }

        .empty-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            gap: 0.75rem;
            opacity: 0.3;
        }

        .empty-title {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--wa-color-text-quiet);
        }

        .empty-description {
            margin: 0;
            font-size: 1rem;
            color: var(--wa-color-text-quiet);
            max-width: 500px;
        }

        .empty-icon {
            font-size: 6rem;
            opacity: 0.2;
            color: var(--wa-color-text-quiet);
        }
    `;__decorateClass$1$1([r$6()],KTabs.prototype,"contributions",2);KTabs=__decorateClass$1$1([t$b("k-tabs")],KTabs);var __defProp$9=Object.defineProperty,__getOwnPropDesc$b=Object.getOwnPropertyDescriptor,__decorateClass$b=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$b(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$9(O,Y,ne),ne};let KResizableGrid=class extends KElement{constructor(){super(...arguments),this.orientation="horizontal",this.gridSizes=[],this.gridChildren=[],this.resizing=null,this.resizeOverlay=null,this.childrenLoaded=!1,this.childStylesApplied=!1,this.settingsLoaded=!1,this.handleResize=ee=>{if(!this.resizing)return;const Y=(this.orientation==="horizontal"?ee.clientX:ee.clientY)-this.resizing.startPos,te=[...this.resizing.startSizes];te[this.resizing.handleIndex]+=Y,te[this.resizing.handleIndex+1]-=Y;const ne=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,xe=ne*.05;if(te[this.resizing.handleIndex]>=xe&&te[this.resizing.handleIndex+1]>=xe){this.resizing.currentSizes=te;const et=te.map((tt,it)=>{const ot=`${(tt/ne*100).toFixed(2)}%`;return it===te.length-1?ot:`${ot} 4px`}).join(" ");this.orientation==="horizontal"?this.style.gridTemplateColumns=et:this.style.gridTemplateRows=et}},this.stopResize=async()=>{if(this.resizing?.currentSizes){const ee=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight;this.gridSizes=this.resizing.currentSizes.map(O=>`${(O/ee*100).toFixed(2)}%`),await this.saveSizes(),this.requestUpdate()}this.resizeOverlay&&(document.body.removeChild(this.resizeOverlay),this.resizeOverlay=null),this.resizing=null,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.body.style.cursor="",document.body.style.userSelect=""}}createRenderRoot(){return this}doBeforeUI(){this.childrenLoaded||(this.mutationObserver=new MutationObserver(()=>{this.childrenLoaded||this.loadChildren()}),this.mutationObserver.observe(this,{childList:!0,subtree:!1}),this.loadChildren())}async loadChildren(){const ee=Array.from(this.children).filter(O=>O.tagName!=="STYLE"&&O.tagName!=="SCRIPT"&&!O.classList.contains("resize-handle"));if(ee.length!==0){if(this.childrenLoaded=!0,this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0),this.gridChildren=ee,!this.settingsLoaded){this.settingsLoaded=!0;const O=await this.getDialogSetting();if(O&&Array.isArray(O.sizes)&&O.sizes.length===this.gridChildren.length){this.gridSizes=O.sizes,this.requestUpdate();return}}if(this.sizes)this.gridSizes=this.sizes.split(",").map(O=>O.trim());else{const O=`${100/this.gridChildren.length}%`;this.gridSizes=this.gridChildren.map(()=>O)}this.requestUpdate()}}async saveSizes(){this.gridSizes.length!==0&&await this.setDialogSetting({sizes:this.gridSizes,orientation:this.orientation})}updated(ee){super.updated(ee),ee.has("gridChildren")&&!this.childStylesApplied&&this.gridChildren.length>0&&(this.childStylesApplied=!0,this.gridChildren.forEach((O,Y)=>{O.style.overflow="hidden",O.style.height="100%",O.style.width="100%",O.style.gridColumn=this.orientation==="horizontal"?`${Y*2+1}`:"1",O.style.gridRow=this.orientation==="vertical"?`${Y*2+1}`:"1",O.style.display="flex",O.style.flexDirection="column"}))}startResize(ee,O){if(ee.preventDefault(),O>=this.gridChildren.length-1)return;const Y=this.orientation==="horizontal"?ee.clientX:ee.clientY,te=this.orientation==="horizontal"?this.offsetWidth:this.offsetHeight,ne=this.gridSizes.map(xe=>xe.endsWith("%")?parseFloat(xe)/100*te:(xe.endsWith("px"),parseFloat(xe)));this.resizing={handleIndex:O,startPos:Y,startSizes:ne},this.resizeOverlay=document.createElement("div"),this.resizeOverlay.style.position="fixed",this.resizeOverlay.style.top="0",this.resizeOverlay.style.left="0",this.resizeOverlay.style.width="100%",this.resizeOverlay.style.height="100%",this.resizeOverlay.style.zIndex="9999",this.resizeOverlay.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.appendChild(this.resizeOverlay),document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize",document.body.style.userSelect="none"}render(){if(this.gridChildren.length===0||this.gridSizes.length===0)return E$2;const ee=this.gridSizes.flatMap((O,Y)=>Y===this.gridSizes.length-1?[O]:[O,"4px"]).join(" ");return this.style.display="grid",this.orientation==="horizontal"?(this.style.gridTemplateColumns=ee,this.style.gridTemplateRows="100%"):(this.style.gridTemplateColumns="100%",this.style.gridTemplateRows=ee),this.style.overflow="hidden",x$1`
            <style>
                .resize-handle {
                    position: relative;
                    z-index: 10;
                    background-color: var(--wa-color-neutral-border-quiet);
                    transition: background-color var(--wa-transition-fast);
                }
                
                .resize-handle:hover {
                    background-color: var(--wa-color-brand-fill-normal);
                }
            </style>
            
            ${this.gridChildren.map((O,Y)=>{if(Y<this.gridChildren.length-1){const te=this.orientation==="horizontal"?`${Y*2+2}`:"1",ne=this.orientation==="vertical"?`${Y*2+2}`:"1";return x$1`
                        <div 
                            class="resize-handle"
                            style="
                                cursor: ${this.orientation==="horizontal"?"col-resize":"row-resize"};
                                grid-column: ${te};
                                grid-row: ${ne};
                            "
                            @mousedown=${xe=>this.startResize(xe,Y)}
                        ></div>
                    `}return E$2})}
        `}disconnectedCallback(){super.disconnectedCallback(),this.resizing&&this.stopResize(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}connectedCallback(){super.connectedCallback(),this.style.height="100%",this.style.width="100%"}};__decorateClass$b([n$7()],KResizableGrid.prototype,"orientation",2);__decorateClass$b([n$7()],KResizableGrid.prototype,"sizes",2);__decorateClass$b([r$6()],KResizableGrid.prototype,"gridSizes",2);__decorateClass$b([r$6()],KResizableGrid.prototype,"gridChildren",2);KResizableGrid=__decorateClass$b([t$b("k-resizable-grid")],KResizableGrid);var WaLoadEvent=class extends Event{constructor(){super("wa-load",{bubbles:!0,cancelable:!1,composed:!0})}};function watch(ee,O){const Y={waitUntilFirstUpdate:!1,...O};return(te,ne)=>{const{update:xe}=te,et=Array.isArray(ee)?ee:[ee];te.update=function(tt){et.forEach(it=>{const st=it;if(tt.has(st)){const ot=tt.get(st),rt=this[st];ot!==rt&&(!Y.waitUntilFirstUpdate||this.hasUpdated)&&this[ne](ot,rt)}}),xe.call(this,tt)}}}var host_default=`:host {
  box-sizing: border-box !important;
}

:host *,
:host *::before,
:host *::after {
  box-sizing: inherit !important;
}

[hidden] {
  display: none !important;
}
`,_hasRecordedInitialProperties,WebAwesomeElement=class extends i$9{constructor(){super(),__privateAdd$1(this,_hasRecordedInitialProperties,!1),this.initialReflectedProperties=new Map,this.didSSR=!!this.shadowRoot,this.customStates={set:(O,Y)=>{if(this.internals?.states)try{Y?this.internals.states.add(O):this.internals.states.delete(O)}catch(te){if(String(te).includes("must start with '--'"))console.error("Your browser implements an outdated version of CustomStateSet. Consider using a polyfill");else throw te}},has:O=>{if(!this.internals?.states)return!1;try{return this.internals.states.has(O)}catch{return!1}}};try{this.internals=this.attachInternals()}catch{console.error("Element internals are not supported in your browser. Consider using a polyfill")}this.customStates.set("wa-defined",!0);let ee=this.constructor;for(let[O,Y]of ee.elementProperties)Y.default==="inherit"&&Y.initial!==void 0&&typeof O=="string"&&this.customStates.set(`initial-${O}-${Y.initial}`,!0)}static get styles(){const ee=Array.isArray(this.css)?this.css:this.css?[this.css]:[];return[host_default,...ee].map(O=>typeof O=="string"?r$a(O):O)}attributeChangedCallback(ee,O,Y){__privateGet(this,_hasRecordedInitialProperties)||(this.constructor.elementProperties.forEach((te,ne)=>{te.reflect&&this[ne]!=null&&this.initialReflectedProperties.set(ne,this[ne])}),__privateSet(this,_hasRecordedInitialProperties,!0)),super.attributeChangedCallback(ee,O,Y)}willUpdate(ee){super.willUpdate(ee),this.initialReflectedProperties.forEach((O,Y)=>{ee.has(Y)&&this[Y]==null&&(this[Y]=O)})}firstUpdated(ee){super.firstUpdated(ee),this.didSSR&&this.shadowRoot?.querySelectorAll("slot").forEach(O=>{O.dispatchEvent(new Event("slotchange",{bubbles:!0,composed:!1,cancelable:!1}))})}update(ee){try{super.update(ee)}catch(O){if(this.didSSR&&!this.hasUpdated){const Y=new Event("lit-hydration-error",{bubbles:!0,composed:!0,cancelable:!1});Y.error=O,this.dispatchEvent(Y)}throw O}}relayNativeEvent(ee,O){ee.stopImmediatePropagation(),this.dispatchEvent(new ee.constructor(ee.type,{...ee,...O}))}};_hasRecordedInitialProperties=new WeakMap;__decorateClass$d([n$7()],WebAwesomeElement.prototype,"dir",2);__decorateClass$d([n$7()],WebAwesomeElement.prototype,"lang",2);__decorateClass$d([n$7({type:Boolean,reflect:!0,attribute:"did-ssr"})],WebAwesomeElement.prototype,"didSSR",2);var WaErrorEvent=class extends Event{constructor(){super("wa-error",{bubbles:!0,cancelable:!1,composed:!0})}},icon_default=`:host {
  --primary-color: currentColor;
  --primary-opacity: 1;
  --secondary-color: currentColor;
  --secondary-opacity: 0.4;

  box-sizing: content-box;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  vertical-align: -0.125em;
}

/* Standard */
:host(:not([auto-width])) {
  width: 1.25em;
  height: 1em;
}

/* Auto-width */
:host([auto-width]) {
  width: auto;
  height: 1em;
}

svg {
  height: 1em;
  fill: currentColor;
  overflow: visible;

  /* Duotone colors with path-specific opacity fallback */
  path[data-duotone-primary] {
    color: var(--primary-color);
    opacity: var(--path-opacity, var(--primary-opacity));
  }

  path[data-duotone-secondary] {
    color: var(--secondary-color);
    opacity: var(--path-opacity, var(--secondary-opacity));
  }
}
`,CACHEABLE_ERROR=Symbol(),RETRYABLE_ERROR=Symbol(),parser,iconCache=new Map,WaIcon=class extends WebAwesomeElement{constructor(){super(...arguments),this.svg=null,this.autoWidth=!1,this.swapOpacity=!1,this.label="",this.library="default",this.resolveIcon=async(ee,O)=>{let Y;if(O?.spriteSheet){this.hasUpdated||await this.updateComplete,this.svg=x$1`<svg part="svg">
        <use part="use" href="${ee}"></use>
      </svg>`,await this.updateComplete;const te=this.shadowRoot.querySelector("[part='svg']");return typeof O.mutator=="function"&&O.mutator(te,this),this.svg}try{if(Y=await fetch(ee,{mode:"cors"}),!Y.ok)return Y.status===410?CACHEABLE_ERROR:RETRYABLE_ERROR}catch{return RETRYABLE_ERROR}try{const te=document.createElement("div");te.innerHTML=await Y.text();const ne=te.firstElementChild;if(ne?.tagName?.toLowerCase()!=="svg")return CACHEABLE_ERROR;parser||(parser=new DOMParser);const et=parser.parseFromString(ne.outerHTML,"text/html").body.querySelector("svg");return et?(et.part.add("svg"),document.adoptNode(et)):CACHEABLE_ERROR}catch{return CACHEABLE_ERROR}}}connectedCallback(){super.connectedCallback(),watchIcon(this)}firstUpdated(ee){super.firstUpdated(ee),this.setIcon()}disconnectedCallback(){super.disconnectedCallback(),unwatchIcon(this)}getIconSource(){const ee=getIconLibrary(this.library),O=this.family||getDefaultIconFamily();return this.name&&ee?{url:ee.resolver(this.name,O,this.variant,this.autoWidth),fromLibrary:!0}:{url:this.src,fromLibrary:!1}}handleLabelChange(){typeof this.label=="string"&&this.label.length>0?(this.setAttribute("role","img"),this.setAttribute("aria-label",this.label),this.removeAttribute("aria-hidden")):(this.removeAttribute("role"),this.removeAttribute("aria-label"),this.setAttribute("aria-hidden","true"))}async setIcon(){const{url:ee,fromLibrary:O}=this.getIconSource(),Y=O?getIconLibrary(this.library):void 0;if(!ee){this.svg=null;return}let te=iconCache.get(ee);te||(te=this.resolveIcon(ee,Y),iconCache.set(ee,te));const ne=await te;if(ne===RETRYABLE_ERROR&&iconCache.delete(ee),ee===this.getIconSource().url){if(e$6(ne)){this.svg=ne;return}switch(ne){case RETRYABLE_ERROR:case CACHEABLE_ERROR:this.svg=null,this.dispatchEvent(new WaErrorEvent);break;default:this.svg=ne.cloneNode(!0),Y?.mutator?.(this.svg,this),this.dispatchEvent(new WaLoadEvent)}}}updated(ee){super.updated(ee);const O=getIconLibrary(this.library),Y=this.shadowRoot?.querySelector("svg");Y&&O?.mutator?.(Y,this)}render(){return this.hasUpdated?this.svg:x$1`<svg part="svg" fill="currentColor" width="16" height="16"></svg>`}};WaIcon.css=icon_default;__decorateClass$d([r$6()],WaIcon.prototype,"svg",2);__decorateClass$d([n$7({reflect:!0})],WaIcon.prototype,"name",2);__decorateClass$d([n$7({reflect:!0})],WaIcon.prototype,"family",2);__decorateClass$d([n$7({reflect:!0})],WaIcon.prototype,"variant",2);__decorateClass$d([n$7({attribute:"auto-width",type:Boolean,reflect:!0})],WaIcon.prototype,"autoWidth",2);__decorateClass$d([n$7({attribute:"swap-opacity",type:Boolean,reflect:!0})],WaIcon.prototype,"swapOpacity",2);__decorateClass$d([n$7()],WaIcon.prototype,"src",2);__decorateClass$d([n$7()],WaIcon.prototype,"label",2);__decorateClass$d([n$7({reflect:!0})],WaIcon.prototype,"library",2);__decorateClass$d([watch("label")],WaIcon.prototype,"handleLabelChange",1);__decorateClass$d([watch(["family","name","library","variant","src","autoWidth","swapOpacity"])],WaIcon.prototype,"setIcon",1);WaIcon=__decorateClass$d([t$b("wa-icon")],WaIcon);var animated_image_default=`:host {
  --control-box-size: 3rem;
  --icon-size: calc(var(--control-box-size) * 0.625);

  display: inline-flex;
  position: relative;
  cursor: pointer;
}

img {
  display: block;
  width: 100%;
  height: 100%;
}

img[aria-hidden='true'] {
  display: none;
}

.control-box {
  display: flex;
  position: absolute;
  align-items: center;
  justify-content: center;
  top: calc(50% - var(--control-box-size) / 2);
  right: calc(50% - var(--control-box-size) / 2);
  width: var(--control-box-size);
  height: var(--control-box-size);
  font-size: calc(var(--icon-size) * 0.75);
  background: none;
  border: solid var(--wa-border-width-s) currentColor;
  background-color: rgb(0 0 0 / 50%);
  border-radius: var(--wa-border-radius-circle);
  color: white;
  pointer-events: none;
  transition: opacity var(--wa-transition-normal) var(--wa-transition-easing);
}

@media (hover: hover) {
  :host([play]:hover) .control-box {
    opacity: 1;
  }
}

:where(:host([play]:not(:hover))) .control-box {
  opacity: 0;
}

:host([play]) slot[name='play-icon'],
:host(:not([play])) slot[name='pause-icon'] {
  display: none;
}

/* Show control box on keyboard focus */
.animated-image {
  &:focus {
    outline: none;
  }

  &:focus-visible .control-box {
    opacity: 1;
    outline: var(--wa-focus-ring);
    outline-offset: var(--wa-focus-ring-offset);
  }
}
`,WaAnimatedImage=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.isLoaded=!1}handleClick(){this.play=!this.play}handleKeyDown(ee){(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),this.play=!this.play)}handleLoad(){const ee=document.createElement("canvas"),{width:O,height:Y}=this.animatedImage;ee.width=O,ee.height=Y,ee.getContext("2d").drawImage(this.animatedImage,0,0,O,Y),this.frozenFrame=ee.toDataURL("image/gif"),this.isLoaded||(this.dispatchEvent(new WaLoadEvent),this.isLoaded=!0)}handleError(){this.dispatchEvent(new WaErrorEvent)}handlePlayChange(){this.play&&(this.animatedImage.src="",this.animatedImage.src=this.src)}handleSrcChange(){this.isLoaded=!1}render(){const O=`${this.localize.term(this.play?"pauseAnimation":"playAnimation")} ${this.alt}`;return x$1`
      <div
        class="animated-image"
        tabindex="0"
        role="button"
        aria-pressed=${this.play?"true":"false"}
        aria-label=${O}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
      >
        <img
          class="animated"
          src=${this.src}
          alt=${this.alt}
          crossorigin="anonymous"
          aria-hidden=${this.play?"false":"true"}
          role="presentation"
          @load=${this.handleLoad}
          @error=${this.handleError}
        />

        ${this.isLoaded?x$1`
              <img
                class="frozen"
                src=${this.frozenFrame}
                alt=${this.alt}
                aria-hidden=${this.play?"true":"false"}
                role="presentation"
              />

              <div part="control-box" class="control-box" aria-hidden="true">
                <slot name="play-icon">
                  <wa-icon
                    name="play"
                    library="system"
                    variant="solid"
                    class="default"
                    style="margin-inline-start: 3px;"
                  ></wa-icon>
                </slot>
                <slot name="pause-icon">
                  <wa-icon name="pause" library="system" variant="solid" class="default"></wa-icon>
                </slot>
              </div>
            `:""}
      </div>
    `}};WaAnimatedImage.css=animated_image_default;__decorateClass$d([e$9(".animated")],WaAnimatedImage.prototype,"animatedImage",2);__decorateClass$d([r$6()],WaAnimatedImage.prototype,"frozenFrame",2);__decorateClass$d([r$6()],WaAnimatedImage.prototype,"isLoaded",2);__decorateClass$d([n$7()],WaAnimatedImage.prototype,"src",2);__decorateClass$d([n$7()],WaAnimatedImage.prototype,"alt",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaAnimatedImage.prototype,"play",2);__decorateClass$d([watch("play",{waitUntilFirstUpdate:!0})],WaAnimatedImage.prototype,"handlePlayChange",1);__decorateClass$d([watch("src")],WaAnimatedImage.prototype,"handleSrcChange",1);WaAnimatedImage=__decorateClass$d([t$b("wa-animated-image")],WaAnimatedImage);var WaCancelEvent=class extends Event{constructor(){super("wa-cancel",{bubbles:!0,cancelable:!1,composed:!0})}},WaFinishEvent=class extends Event{constructor(){super("wa-finish",{bubbles:!0,cancelable:!1,composed:!0})}},WaStartEvent=class extends Event{constructor(){super("wa-start",{bubbles:!0,cancelable:!1,composed:!0})}},animation_default=`:host {
  display: contents;
}
`,WaAnimation=class extends WebAwesomeElement{constructor(){super(...arguments),this.hasStarted=!1,this.name="none",this.play=!1,this.delay=0,this.direction="normal",this.duration=1e3,this.easing="linear",this.endDelay=0,this.fill="auto",this.iterations=1/0,this.iterationStart=0,this.playbackRate=1,this.handleAnimationFinish=()=>{this.play=!1,this.hasStarted=!1,this.dispatchEvent(new WaFinishEvent)},this.handleAnimationCancel=()=>{this.play=!1,this.hasStarted=!1,this.dispatchEvent(new WaCancelEvent)}}get currentTime(){return this.animation?.currentTime??0}set currentTime(ee){this.animation&&(this.animation.currentTime=ee)}connectedCallback(){super.connectedCallback(),this.createAnimation()}disconnectedCallback(){super.disconnectedCallback(),this.destroyAnimation()}handleSlotChange(){this.destroyAnimation(),this.createAnimation()}async createAnimation(){const ee=easings[this.easing]??this.easing,O=this.keyframes??animations[this.name],te=(await this.defaultSlot).assignedElements()[0];return!te||!O?!1:(this.destroyAnimation(),this.animation=te.animate(O,{delay:this.delay,direction:this.direction,duration:this.duration,easing:ee,endDelay:this.endDelay,fill:this.fill,iterationStart:this.iterationStart,iterations:this.iterations}),this.animation.playbackRate=this.playbackRate,this.animation.addEventListener("cancel",this.handleAnimationCancel),this.animation.addEventListener("finish",this.handleAnimationFinish),this.play?(this.hasStarted=!0,this.dispatchEvent(new WaStartEvent)):this.animation.pause(),!0)}destroyAnimation(){this.animation&&(this.animation.cancel(),this.animation.removeEventListener("cancel",this.handleAnimationCancel),this.animation.removeEventListener("finish",this.handleAnimationFinish),this.hasStarted=!1)}handleAnimationChange(){this.hasUpdated&&this.createAnimation()}handlePlayChange(){return this.animation?(this.play&&!this.hasStarted&&(this.hasStarted=!0,this.dispatchEvent(new WaStartEvent)),this.play?this.animation.play():this.animation.pause(),!0):!1}handlePlaybackRateChange(){this.animation&&(this.animation.playbackRate=this.playbackRate)}cancel(){this.animation?.cancel()}finish(){this.animation?.finish()}render(){return x$1` <slot @slotchange=${this.handleSlotChange}></slot> `}};WaAnimation.css=animation_default;__decorateClass$d([r$4("slot")],WaAnimation.prototype,"defaultSlot",2);__decorateClass$d([n$7()],WaAnimation.prototype,"name",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaAnimation.prototype,"play",2);__decorateClass$d([n$7({type:Number})],WaAnimation.prototype,"delay",2);__decorateClass$d([n$7()],WaAnimation.prototype,"direction",2);__decorateClass$d([n$7({type:Number})],WaAnimation.prototype,"duration",2);__decorateClass$d([n$7()],WaAnimation.prototype,"easing",2);__decorateClass$d([n$7({attribute:"end-delay",type:Number})],WaAnimation.prototype,"endDelay",2);__decorateClass$d([n$7()],WaAnimation.prototype,"fill",2);__decorateClass$d([n$7({type:Number})],WaAnimation.prototype,"iterations",2);__decorateClass$d([n$7({attribute:"iteration-start",type:Number})],WaAnimation.prototype,"iterationStart",2);__decorateClass$d([n$7({attribute:!1})],WaAnimation.prototype,"keyframes",2);__decorateClass$d([n$7({attribute:"playback-rate",type:Number})],WaAnimation.prototype,"playbackRate",2);__decorateClass$d([watch(["name","delay","direction","duration","easing","endDelay","fill","iterations","iterationsStart","keyframes"])],WaAnimation.prototype,"handleAnimationChange",1);__decorateClass$d([watch("play")],WaAnimation.prototype,"handlePlayChange",1);__decorateClass$d([watch("playbackRate")],WaAnimation.prototype,"handlePlaybackRateChange",1);WaAnimation=__decorateClass$d([t$b("wa-animation")],WaAnimation);var avatar_default=`:host {
  --size: 3rem;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: var(--size);
  height: var(--size);
  color: var(--wa-color-neutral-on-normal);
  font: inherit;
  font-size: calc(var(--size) * 0.4);
  vertical-align: middle;
  background-color: var(--wa-color-neutral-fill-normal);
  border-radius: var(--wa-border-radius-circle);
  user-select: none;
  -webkit-user-select: none;
}

:host([shape='square']) {
  border-radius: 0;
}

:host([shape='rounded']) {
  border-radius: var(--wa-border-radius-m);
}

.icon {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.initials {
  line-height: 1;
  text-transform: uppercase;
}

.image {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  overflow: hidden;
  border-radius: inherit;
}
`,WaAvatar=class extends WebAwesomeElement{constructor(){super(...arguments),this.hasError=!1,this.image="",this.label="",this.initials="",this.loading="eager",this.shape="circle"}handleImageChange(){this.hasError=!1}handleImageLoadError(){this.hasError=!0,this.dispatchEvent(new WaErrorEvent)}render(){const ee=x$1`
      <img
        part="image"
        class="image"
        src="${this.image}"
        loading="${this.loading}"
        role="img"
        aria-label=${this.label}
        @error="${this.handleImageLoadError}"
      />
    `;let O=x$1``;return this.initials?O=x$1`<div part="initials" class="initials" role="img" aria-label=${this.label}>
        ${this.initials}
      </div>`:O=x$1`
        <slot name="icon" part="icon" class="icon" role="img" aria-label=${this.label}>
          <wa-icon name="user" library="system" variant="solid"></wa-icon>
        </slot>
      `,x$1` ${this.image&&!this.hasError?ee:O} `}};WaAvatar.css=avatar_default;__decorateClass$d([r$6()],WaAvatar.prototype,"hasError",2);__decorateClass$d([n$7()],WaAvatar.prototype,"image",2);__decorateClass$d([n$7()],WaAvatar.prototype,"label",2);__decorateClass$d([n$7()],WaAvatar.prototype,"initials",2);__decorateClass$d([n$7()],WaAvatar.prototype,"loading",2);__decorateClass$d([n$7({reflect:!0})],WaAvatar.prototype,"shape",2);__decorateClass$d([watch("image")],WaAvatar.prototype,"handleImageChange",1);WaAvatar=__decorateClass$d([t$b("wa-avatar")],WaAvatar);var variants_default=`@layer wa-utilities {
  :where(:root),
  .wa-neutral,
  :host([variant='neutral']) {
    --wa-color-fill-loud: var(--wa-color-neutral-fill-loud);
    --wa-color-fill-normal: var(--wa-color-neutral-fill-normal);
    --wa-color-fill-quiet: var(--wa-color-neutral-fill-quiet);
    --wa-color-border-loud: var(--wa-color-neutral-border-loud);
    --wa-color-border-normal: var(--wa-color-neutral-border-normal);
    --wa-color-border-quiet: var(--wa-color-neutral-border-quiet);
    --wa-color-on-loud: var(--wa-color-neutral-on-loud);
    --wa-color-on-normal: var(--wa-color-neutral-on-normal);
    --wa-color-on-quiet: var(--wa-color-neutral-on-quiet);
  }

  .wa-brand,
  :host([variant='brand']) {
    --wa-color-fill-loud: var(--wa-color-brand-fill-loud);
    --wa-color-fill-normal: var(--wa-color-brand-fill-normal);
    --wa-color-fill-quiet: var(--wa-color-brand-fill-quiet);
    --wa-color-border-loud: var(--wa-color-brand-border-loud);
    --wa-color-border-normal: var(--wa-color-brand-border-normal);
    --wa-color-border-quiet: var(--wa-color-brand-border-quiet);
    --wa-color-on-loud: var(--wa-color-brand-on-loud);
    --wa-color-on-normal: var(--wa-color-brand-on-normal);
    --wa-color-on-quiet: var(--wa-color-brand-on-quiet);
  }

  .wa-success,
  :host([variant='success']) {
    --wa-color-fill-loud: var(--wa-color-success-fill-loud);
    --wa-color-fill-normal: var(--wa-color-success-fill-normal);
    --wa-color-fill-quiet: var(--wa-color-success-fill-quiet);
    --wa-color-border-loud: var(--wa-color-success-border-loud);
    --wa-color-border-normal: var(--wa-color-success-border-normal);
    --wa-color-border-quiet: var(--wa-color-success-border-quiet);
    --wa-color-on-loud: var(--wa-color-success-on-loud);
    --wa-color-on-normal: var(--wa-color-success-on-normal);
    --wa-color-on-quiet: var(--wa-color-success-on-quiet);
  }

  .wa-warning,
  :host([variant='warning']) {
    --wa-color-fill-loud: var(--wa-color-warning-fill-loud);
    --wa-color-fill-normal: var(--wa-color-warning-fill-normal);
    --wa-color-fill-quiet: var(--wa-color-warning-fill-quiet);
    --wa-color-border-loud: var(--wa-color-warning-border-loud);
    --wa-color-border-normal: var(--wa-color-warning-border-normal);
    --wa-color-border-quiet: var(--wa-color-warning-border-quiet);
    --wa-color-on-loud: var(--wa-color-warning-on-loud);
    --wa-color-on-normal: var(--wa-color-warning-on-normal);
    --wa-color-on-quiet: var(--wa-color-warning-on-quiet);
  }

  .wa-danger,
  :host([variant='danger']) {
    --wa-color-fill-loud: var(--wa-color-danger-fill-loud);
    --wa-color-fill-normal: var(--wa-color-danger-fill-normal);
    --wa-color-fill-quiet: var(--wa-color-danger-fill-quiet);
    --wa-color-border-loud: var(--wa-color-danger-border-loud);
    --wa-color-border-normal: var(--wa-color-danger-border-normal);
    --wa-color-border-quiet: var(--wa-color-danger-border-quiet);
    --wa-color-on-loud: var(--wa-color-danger-on-loud);
    --wa-color-on-normal: var(--wa-color-danger-on-normal);
    --wa-color-on-quiet: var(--wa-color-danger-on-quiet);
  }
}
`;var badge_default=`:host {
  --pulse-color: var(--wa-color-fill-loud, var(--wa-color-brand-fill-loud));

  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.375em 0.625em;
  color: var(--wa-color-on-loud, var(--wa-color-brand-on-loud));
  font-size: max(var(--wa-font-size-2xs), 0.75em);
  font-weight: var(--wa-font-weight-semibold);
  line-height: 1;
  white-space: nowrap;
  background-color: var(--wa-color-fill-loud, var(--wa-color-brand-fill-loud));
  border-color: transparent;
  border-radius: var(--wa-border-radius-s);
  border-style: var(--wa-border-style);
  border-width: var(--wa-border-width-s);
  user-select: none;
  -webkit-user-select: none;
  cursor: inherit;
}

/* Appearance modifiers */
:host([appearance='outlined']) {
  --pulse-color: var(--wa-color-border-loud, var(--wa-color-brand-border-loud));

  color: var(--wa-color-on-quiet, var(--wa-color-brand-on-quiet));
  background-color: transparent;
  border-color: var(--wa-color-border-loud, var(--wa-color-brand-border-loud));
}

:host([appearance='filled']) {
  --pulse-color: var(--wa-color-fill-normal, var(--wa-color-brand-fill-normal));

  color: var(--wa-color-on-normal, var(--wa-color-brand-on-normal));
  background-color: var(--wa-color-fill-normal, var(--wa-color-brand-fill-normal));
  border-color: transparent;
}

:host([appearance='filled-outlined']) {
  --pulse-color: var(--wa-color-border-normal, var(--wa-color-brand-border-normal));

  color: var(--wa-color-on-normal, var(--wa-color-brand-on-normal));
  background-color: var(--wa-color-fill-normal, var(--wa-color-brand-fill-normal));
  border-color: var(--wa-color-border-normal, var(--wa-color-brand-border-normal));
}

:host([appearance='accent']) {
  --pulse-color: var(--wa-color-fill-loud, var(--wa-color-brand-fill-loud));

  color: var(--wa-color-on-loud, var(--wa-color-brand-on-loud));
  background-color: var(--wa-color-fill-loud, var(--wa-color-brand-fill-loud));
  border-color: transparent;
}

/* Pill modifier */
:host([pill]) {
  border-radius: var(--wa-border-radius-pill);
}

/* Pulse attention */
:host([attention='pulse']) {
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 var(--pulse-color);
  }
  70% {
    box-shadow: 0 0 0 0.5rem transparent;
  }
  100% {
    box-shadow: 0 0 0 0 transparent;
  }
}

/* Bounce attention */
:host([attention='bounce']) {
  animation: bounce 1s cubic-bezier(0.28, 0.84, 0.42, 1) infinite;
}

@keyframes bounce {
  0%,
  20%,
  50%,
  80%,
  100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-5px);
  }
  60% {
    transform: translateY(-2px);
  }
}

::slotted(wa-icon) {
  margin-inline-end: var(--wa-space-2xs, 0.25em);
  opacity: 90%;
  line-height: 1;
  height: 0.85em;
}
`,WaBadge=class extends WebAwesomeElement{constructor(){super(...arguments),this.variant="brand",this.appearance="accent",this.pill=!1,this.attention="none"}render(){return x$1` <slot part="base" role="status"></slot>`}};WaBadge.css=[variants_default,badge_default];__decorateClass$d([n$7({reflect:!0})],WaBadge.prototype,"variant",2);__decorateClass$d([n$7({reflect:!0})],WaBadge.prototype,"appearance",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaBadge.prototype,"pill",2);__decorateClass$d([n$7({reflect:!0})],WaBadge.prototype,"attention",2);WaBadge=__decorateClass$d([t$b("wa-badge")],WaBadge);var breadcrumb_default=`.breadcrumb {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
}
`,WaBreadcrumb=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.separatorDir=this.localize.dir(),this.label=""}getSeparator(){const O=this.separatorSlot.assignedElements({flatten:!0})[0].cloneNode(!0);return[O,...O.querySelectorAll("[id]")].forEach(Y=>Y.removeAttribute("id")),O.setAttribute("data-default",""),O.slot="separator",O}handleSlotChange(){const ee=[...this.defaultSlot.assignedElements({flatten:!0})].filter(O=>O.tagName.toLowerCase()==="wa-breadcrumb-item");ee.forEach((O,Y)=>{const te=O.querySelector('[slot="separator"]');te===null?O.append(this.getSeparator()):te.hasAttribute("data-default")&&te.replaceWith(this.getSeparator()),Y===ee.length-1?O.setAttribute("aria-current","page"):O.removeAttribute("aria-current")})}render(){return this.separatorDir!==this.localize.dir()&&(this.separatorDir=this.localize.dir(),this.updateComplete.then(()=>this.handleSlotChange())),x$1`
      <nav part="base" class="breadcrumb" aria-label=${this.label}>
        <slot @slotchange=${this.handleSlotChange}></slot>
      </nav>

      <span hidden aria-hidden="true">
        <slot name="separator">
          <wa-icon
            name=${this.localize.dir()==="rtl"?"chevron-left":"chevron-right"}
            library="system"
            variant="solid"
          ></wa-icon>
        </slot>
      </span>
    `}};WaBreadcrumb.css=breadcrumb_default;__decorateClass$d([e$9("slot")],WaBreadcrumb.prototype,"defaultSlot",2);__decorateClass$d([e$9('slot[name="separator"]')],WaBreadcrumb.prototype,"separatorSlot",2);__decorateClass$d([n$7()],WaBreadcrumb.prototype,"label",2);WaBreadcrumb=__decorateClass$d([t$b("wa-breadcrumb")],WaBreadcrumb);var MirrorValidator=()=>({checkValidity(ee){const O=ee.input,Y={message:"",isValid:!0,invalidKeys:[]};if(!O)return Y;let te=!0;if("checkValidity"in O&&(te=O.checkValidity()),te)return Y;if(Y.isValid=!1,"validationMessage"in O&&(Y.message=O.validationMessage),!("validity"in O))return Y.invalidKeys.push("customError"),Y;for(const ne in O.validity){if(ne==="valid")continue;const xe=ne;O.validity[xe]&&Y.invalidKeys.push(xe)}return Y}});var WaInvalidEvent=class extends Event{constructor(){super("wa-invalid",{bubbles:!0,cancelable:!1,composed:!0})}},CustomErrorValidator=()=>({observedAttributes:["custom-error"],checkValidity(ee){const O={message:"",isValid:!0,invalidKeys:[]};return ee.customError&&(O.message=ee.customError,O.isValid=!1,O.invalidKeys=["customError"]),O}}),WebAwesomeFormAssociatedElement=class extends WebAwesomeElement{constructor(){super(),this.name=null,this.disabled=!1,this.required=!1,this.assumeInteractionOn=["input"],this.validators=[],this.valueHasChanged=!1,this.hasInteracted=!1,this.customError=null,this.emittedEvents=[],this.emitInvalid=ee=>{ee.target===this&&(this.hasInteracted=!0,this.dispatchEvent(new WaInvalidEvent))},this.handleInteraction=ee=>{const O=this.emittedEvents;O.includes(ee.type)||O.push(ee.type),O.length===this.assumeInteractionOn?.length&&(this.hasInteracted=!0)},this.addEventListener("invalid",this.emitInvalid)}static get validators(){return[CustomErrorValidator()]}static get observedAttributes(){const ee=new Set(super.observedAttributes||[]);for(const O of this.validators)if(O.observedAttributes)for(const Y of O.observedAttributes)ee.add(Y);return[...ee]}connectedCallback(){super.connectedCallback(),this.updateValidity(),this.assumeInteractionOn.forEach(ee=>{this.addEventListener(ee,this.handleInteraction)})}firstUpdated(...ee){super.firstUpdated(...ee),this.updateValidity()}willUpdate(ee){if(ee.has("customError")&&(this.customError||(this.customError=null),this.setCustomValidity(this.customError||"")),ee.has("value")||ee.has("disabled")){const O=this.value;if(Array.isArray(O)){if(this.name){const Y=new FormData;for(const te of O)Y.append(this.name,te);this.setValue(Y,Y)}}else this.setValue(O,O)}ee.has("disabled")&&(this.customStates.set("disabled",this.disabled),(this.hasAttribute("disabled")||!this.matches(":disabled"))&&this.toggleAttribute("disabled",this.disabled)),this.updateValidity(),super.willUpdate(ee)}get labels(){return this.internals.labels}getForm(){return this.internals.form}get validity(){return this.internals.validity}get willValidate(){return this.internals.willValidate}get validationMessage(){return this.internals.validationMessage}checkValidity(){return this.updateValidity(),this.internals.checkValidity()}reportValidity(){return this.updateValidity(),this.hasInteracted=!0,this.internals.reportValidity()}get validationTarget(){return this.input||void 0}setValidity(...ee){const O=ee[0],Y=ee[1];let te=ee[2];te||(te=this.validationTarget),this.internals.setValidity(O,Y,te||void 0),this.requestUpdate("validity"),this.setCustomStates()}setCustomStates(){const ee=!!this.required,O=this.internals.validity.valid,Y=this.hasInteracted;this.customStates.set("required",ee),this.customStates.set("optional",!ee),this.customStates.set("invalid",!O),this.customStates.set("valid",O),this.customStates.set("user-invalid",!O&&Y),this.customStates.set("user-valid",O&&Y)}setCustomValidity(ee){if(!ee){this.customError=null,this.setValidity({});return}this.customError=ee,this.setValidity({customError:!0},ee,this.validationTarget)}formResetCallback(){this.resetValidity(),this.hasInteracted=!1,this.valueHasChanged=!1,this.emittedEvents=[],this.updateValidity()}formDisabledCallback(ee){this.disabled=ee,this.updateValidity()}formStateRestoreCallback(ee,O){this.value=ee,O==="restore"&&this.resetValidity(),this.updateValidity()}setValue(...ee){const[O,Y]=ee;this.internals.setFormValue(O,Y)}get allValidators(){const ee=this.constructor.validators||[],O=this.validators||[];return[...ee,...O]}resetValidity(){this.setCustomValidity(""),this.setValidity({})}updateValidity(){if(this.disabled||this.hasAttribute("disabled")||!this.willValidate){this.resetValidity();return}const ee=this.allValidators;if(!ee?.length)return;const O={customError:!!this.customError},Y=this.validationTarget||this.input||void 0;let te="";for(const ne of ee){const{isValid:xe,message:et,invalidKeys:tt}=ne.checkValidity(this);xe||(te||(te=et),tt?.length>=0&&tt.forEach(it=>O[it]=!0))}te||(te=this.validationMessage),this.setValidity(O,te,Y)}};WebAwesomeFormAssociatedElement.formAssociated=!0;__decorateClass$d([n$7({reflect:!0})],WebAwesomeFormAssociatedElement.prototype,"name",2);__decorateClass$d([n$7({type:Boolean})],WebAwesomeFormAssociatedElement.prototype,"disabled",2);__decorateClass$d([n$7({state:!0,attribute:!1})],WebAwesomeFormAssociatedElement.prototype,"valueHasChanged",2);__decorateClass$d([n$7({state:!0,attribute:!1})],WebAwesomeFormAssociatedElement.prototype,"hasInteracted",2);__decorateClass$d([n$7({attribute:"custom-error",reflect:!0})],WebAwesomeFormAssociatedElement.prototype,"customError",2);__decorateClass$d([n$7({attribute:!1,state:!0,type:Object})],WebAwesomeFormAssociatedElement.prototype,"validity",1);var HasSlotController=class{constructor(ee,...O){this.slotNames=[],this.handleSlotChange=Y=>{const te=Y.target;(this.slotNames.includes("[default]")&&!te.name||te.name&&this.slotNames.includes(te.name))&&this.host.requestUpdate()},(this.host=ee).addController(this),this.slotNames=O}hasDefaultSlot(){return[...this.host.childNodes].some(ee=>{if(ee.nodeType===Node.TEXT_NODE&&ee.textContent.trim()!=="")return!0;if(ee.nodeType===Node.ELEMENT_NODE){const O=ee;if(O.tagName.toLowerCase()==="wa-visually-hidden")return!1;if(!O.hasAttribute("slot"))return!0}return!1})}hasNamedSlot(ee){return this.host.querySelector(`:scope > [slot="${ee}"]`)!==null}test(ee){return ee==="[default]"?this.hasDefaultSlot():this.hasNamedSlot(ee)}hostConnected(){this.host.shadowRoot.addEventListener("slotchange",this.handleSlotChange)}hostDisconnected(){this.host.shadowRoot.removeEventListener("slotchange",this.handleSlotChange)}};var size_default=`@layer wa-utilities {
  :host([size='small']),
  .wa-size-s {
    font-size: var(--wa-font-size-s);
  }

  :host([size='medium']),
  .wa-size-m {
    font-size: var(--wa-font-size-m);
  }

  :host([size='large']),
  .wa-size-l {
    font-size: var(--wa-font-size-l);
  }
}
`;const a=Symbol.for(""),o$2=ee=>{if(ee?.r===a)return ee?._$litStatic$},i$1=(ee,...O)=>({_$litStatic$:O.reduce(((Y,te,ne)=>Y+(xe=>{if(xe._$litStatic$!==void 0)return xe._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${xe}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(te)+ee[ne+1]),ee[0]),r:a}),l=new Map,n=ee=>(O,...Y)=>{const te=Y.length;let ne,xe;const et=[],tt=[];let it,st=0,ot=!1;for(;st<te;){for(it=O[st];st<te&&(xe=Y[st],(ne=o$2(xe))!==void 0);)it+=ne+O[++st],ot=!0;st!==te&&tt.push(xe),et.push(it),st++}if(st===te&&et.push(O[te]),ot){const rt=et.join("$$lit$$");(O=l.get(rt))===void 0&&(et.raw=et,l.set(rt,O=et)),Y=tt}return ee(O,...Y)},u=n(x$1);var button_default=`@layer wa-component {
  :host {
    display: inline-block;

    /* Workaround because Chrome doesn't like :host(:has()) below
     * https://issues.chromium.org/issues/40062355
     * Firefox doesn't like this nested rule, so both are needed */
    &:has(wa-badge) {
      position: relative;
    }
  }

  /* Apply relative positioning only when needed to position wa-badge
   * This avoids creating a new stacking context for every button */
  :host(:has(wa-badge)) {
    position: relative;
  }
}

.button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  user-select: none;
  -webkit-user-select: none;
  white-space: nowrap;
  vertical-align: middle;
  transition-property: background, border, box-shadow, color;
  transition-duration: var(--wa-transition-fast);
  transition-timing-function: var(--wa-transition-easing);
  cursor: pointer;
  padding: 0 var(--wa-form-control-padding-inline);
  font-family: inherit;
  font-size: inherit;
  font-weight: var(--wa-font-weight-action);
  line-height: calc(var(--wa-form-control-height) - var(--border-width) * 2);
  height: var(--wa-form-control-height);
  width: 100%;

  background-color: var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud));
  border-color: transparent;
  color: var(--wa-color-on-loud, var(--wa-color-neutral-on-loud));
  border-radius: var(--wa-form-control-border-radius);
  border-style: var(--wa-border-style);
  border-width: var(--wa-border-width-s);
}

/* Appearance modifiers */
:host([appearance='plain']) {
  .button {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: transparent;
    border-color: transparent;
  }
  @media (hover: hover) {
    .button:not(.disabled):not(.loading):hover {
      color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
      background-color: var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet));
    }
  }
  .button:not(.disabled):not(.loading):active {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: color-mix(
      in oklab,
      var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet)),
      var(--wa-color-mix-active)
    );
  }
}

:host([appearance='outlined']) {
  .button {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: transparent;
    border-color: var(--wa-color-border-loud, var(--wa-color-neutral-border-loud));
  }
  @media (hover: hover) {
    .button:not(.disabled):not(.loading):hover {
      color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
      background-color: var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet));
    }
  }
  .button:not(.disabled):not(.loading):active {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: color-mix(
      in oklab,
      var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet)),
      var(--wa-color-mix-active)
    );
  }
}

:host([appearance='filled']) {
  .button {
    color: var(--wa-color-on-normal, var(--wa-color-neutral-on-normal));
    background-color: var(--wa-color-fill-normal, var(--wa-color-neutral-fill-normal));
    border-color: transparent;
  }
  @media (hover: hover) {
    .button:not(.disabled):not(.loading):hover {
      color: var(--wa-color-on-normal, var(--wa-color-neutral-on-normal));
      background-color: color-mix(
        in oklab,
        var(--wa-color-fill-normal, var(--wa-color-neutral-fill-normal)),
        var(--wa-color-mix-hover)
      );
    }
  }
  .button:not(.disabled):not(.loading):active {
    color: var(--wa-color-on-normal, var(--wa-color-neutral-on-normal));
    background-color: color-mix(
      in oklab,
      var(--wa-color-fill-normal, var(--wa-color-neutral-fill-normal)),
      var(--wa-color-mix-active)
    );
  }
}

:host([appearance='filled-outlined']) {
  .button {
    color: var(--wa-color-on-normal, var(--wa-color-neutral-on-normal));
    background-color: var(--wa-color-fill-normal, var(--wa-color-neutral-fill-normal));
    border-color: var(--wa-color-border-normal, var(--wa-color-neutral-border-normal));
  }
  @media (hover: hover) {
    .button:not(.disabled):not(.loading):hover {
      color: var(--wa-color-on-normal, var(--wa-color-neutral-on-normal));
      background-color: color-mix(
        in oklab,
        var(--wa-color-fill-normal, var(--wa-color-neutral-fill-normal)),
        var(--wa-color-mix-hover)
      );
    }
  }
  .button:not(.disabled):not(.loading):active {
    color: var(--wa-color-on-normal, var(--wa-color-neutral-on-normal));
    background-color: color-mix(
      in oklab,
      var(--wa-color-fill-normal, var(--wa-color-neutral-fill-normal)),
      var(--wa-color-mix-active)
    );
  }
}

:host([appearance='accent']) {
  .button {
    color: var(--wa-color-on-loud, var(--wa-color-neutral-on-loud));
    background-color: var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud));
    border-color: transparent;
  }
  @media (hover: hover) {
    .button:not(.disabled):not(.loading):hover {
      background-color: color-mix(
        in oklab,
        var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud)),
        var(--wa-color-mix-hover)
      );
    }
  }
  .button:not(.disabled):not(.loading):active {
    background-color: color-mix(
      in oklab,
      var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud)),
      var(--wa-color-mix-active)
    );
  }
}

/* Focus states */
.button:focus {
  outline: none;
}

.button:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

/* Disabled state */
.button.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* When disabled, prevent mouse events from bubbling up from children */
.button.disabled * {
  pointer-events: none;
}

/* Keep it last so Safari doesn't stop parsing this block */
.button::-moz-focus-inner {
  border: 0;
}

/* Icon buttons */
.button.is-icon-button {
  outline-offset: 2px;
  width: var(--wa-form-control-height);
  aspect-ratio: 1;
}

.button.is-icon-button:has(wa-icon) {
  width: auto;
}

/* Pill modifier */
:host([pill]) .button {
  border-radius: var(--wa-border-radius-pill);
}

/*
 * Label
 */

.start,
.end {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  pointer-events: none;
}

.label {
  display: inline-block;
}

.is-icon-button .label {
  display: flex;
}

.label::slotted(wa-icon) {
  align-self: center;
}

/*
 * Caret modifier
 */

wa-icon[part='caret'] {
  display: flex;
  align-self: center;
  align-items: center;

  &::part(svg) {
    width: 0.875em;
    height: 0.875em;
  }

  .button:has(&) .end {
    display: none;
  }
}

/*
 * Loading modifier
 */

.loading {
  position: relative;
  cursor: wait;

  .start,
  .label,
  .end,
  .caret {
    visibility: hidden;
  }

  wa-spinner {
    --indicator-color: currentColor;
    --track-color: color-mix(in oklab, currentColor, transparent 90%);

    position: absolute;
    font-size: 1em;
    height: 1em;
    width: 1em;
    top: calc(50% - 0.5em);
    left: calc(50% - 0.5em);
  }
}

/*
 * Badges
 */

.button ::slotted(wa-badge) {
  border-color: var(--wa-color-surface-default);
  position: absolute;
  inset-block-start: 0;
  inset-inline-end: 0;
  translate: 50% -50%;
  pointer-events: none;
}

:host(:dir(rtl)) ::slotted(wa-badge) {
  translate: -50% -50%;
}

/*
* Button spacing
*/

slot[name='start']::slotted(*) {
  margin-inline-end: 0.75em;
}

slot[name='end']::slotted(*),
.button:not(.visually-hidden-label) [part='caret'] {
  margin-inline-start: 0.75em;
}

/*
 * Button group border radius modifications
 */

/* Remove border radius from all grouped buttons by default */
:host(.wa-button-group__button) .button {
  border-radius: 0;
}

/* Horizontal orientation */
:host(.wa-button-group__horizontal.wa-button-group__button-first) .button {
  border-start-start-radius: var(--wa-form-control-border-radius);
  border-end-start-radius: var(--wa-form-control-border-radius);
}

:host(.wa-button-group__horizontal.wa-button-group__button-last) .button {
  border-start-end-radius: var(--wa-form-control-border-radius);
  border-end-end-radius: var(--wa-form-control-border-radius);
}

/* Vertical orientation */
:host(.wa-button-group__vertical) {
  flex: 1 1 auto;
}

:host(.wa-button-group__vertical) .button {
  width: 100%;
  justify-content: start;
}

:host(.wa-button-group__vertical.wa-button-group__button-first) .button {
  border-start-start-radius: var(--wa-form-control-border-radius);
  border-start-end-radius: var(--wa-form-control-border-radius);
}

:host(.wa-button-group__vertical.wa-button-group__button-last) .button {
  border-end-start-radius: var(--wa-form-control-border-radius);
  border-end-end-radius: var(--wa-form-control-border-radius);
}

/* Handle pill modifier for button groups */
:host([pill].wa-button-group__horizontal.wa-button-group__button-first) .button {
  border-start-start-radius: var(--wa-border-radius-pill);
  border-end-start-radius: var(--wa-border-radius-pill);
}

:host([pill].wa-button-group__horizontal.wa-button-group__button-last) .button {
  border-start-end-radius: var(--wa-border-radius-pill);
  border-end-end-radius: var(--wa-border-radius-pill);
}

:host([pill].wa-button-group__vertical.wa-button-group__button-first) .button {
  border-start-start-radius: var(--wa-border-radius-pill);
  border-start-end-radius: var(--wa-border-radius-pill);
}

:host([pill].wa-button-group__vertical.wa-button-group__button-last) .button {
  border-end-start-radius: var(--wa-border-radius-pill);
  border-end-end-radius: var(--wa-border-radius-pill);
}
`,WaButton=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.assumeInteractionOn=["click"],this.hasSlotController=new HasSlotController(this,"[default]","start","end"),this.localize=new LocalizeController(this),this.invalid=!1,this.isIconButton=!1,this.title="",this.variant="neutral",this.appearance="accent",this.size="medium",this.withCaret=!1,this.disabled=!1,this.loading=!1,this.pill=!1,this.type="button",this.form=null}static get validators(){return[...super.validators,MirrorValidator()]}constructLightDOMButton(){const ee=document.createElement("button");return ee.type=this.type,ee.style.position="absolute",ee.style.width="0",ee.style.height="0",ee.style.clipPath="inset(50%)",ee.style.overflow="hidden",ee.style.whiteSpace="nowrap",this.name&&(ee.name=this.name),ee.value=this.value||"",["form","formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(O=>{this.hasAttribute(O)&&ee.setAttribute(O,this.getAttribute(O))}),ee}handleClick(){if(!this.getForm())return;const O=this.constructLightDOMButton();this.parentElement?.append(O),O.click(),O.remove()}handleInvalid(){this.dispatchEvent(new WaInvalidEvent)}handleLabelSlotChange(){const ee=this.labelSlot.assignedNodes({flatten:!0});let O=!1,Y=!1,te=!1,ne=!1;[...ee].forEach(xe=>{if(xe.nodeType===Node.ELEMENT_NODE){const et=xe;et.localName==="wa-icon"?(Y=!0,O||(O=et.label!==void 0)):ne=!0}else xe.nodeType===Node.TEXT_NODE&&(xe.textContent?.trim()||"").length>0&&(te=!0)}),this.isIconButton=Y&&!te&&!ne,this.isIconButton&&!O&&console.warn('Icon buttons must have a label for screen readers. Add <wa-icon label="..."> to remove this warning.',this)}isButton(){return!this.href}isLink(){return!!this.href}handleDisabledChange(){this.updateValidity()}setValue(...ee){}click(){this.button.click()}focus(ee){this.button.focus(ee)}blur(){this.button.blur()}render(){const ee=this.isLink(),O=ee?i$1`a`:i$1`button`;return u`
      <${O}
        part="base"
        class=${e$5({button:!0,caret:this.withCaret,disabled:this.disabled,loading:this.loading,rtl:this.localize.dir()==="rtl","has-label":this.hasSlotController.test("[default]"),"has-start":this.hasSlotController.test("start"),"has-end":this.hasSlotController.test("end"),"is-icon-button":this.isIconButton})}
        ?disabled=${o$6(ee?void 0:this.disabled)}
        type=${o$6(ee?void 0:this.type)}
        title=${this.title}
        name=${o$6(ee?void 0:this.name)}
        value=${o$6(ee?void 0:this.value)}
        href=${o$6(ee?this.href:void 0)}
        target=${o$6(ee?this.target:void 0)}
        download=${o$6(ee?this.download:void 0)}
        rel=${o$6(ee&&this.rel?this.rel:void 0)}
        role=${o$6(ee?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        tabindex=${this.disabled?"-1":"0"}
        @invalid=${this.isButton()?this.handleInvalid:null}
        @click=${this.handleClick}
      >
        <slot name="start" part="start" class="start"></slot>
        <slot part="label" class="label" @slotchange=${this.handleLabelSlotChange}></slot>
        <slot name="end" part="end" class="end"></slot>
        ${this.withCaret?u`
                <wa-icon part="caret" class="caret" library="system" name="chevron-down" variant="solid"></wa-icon>
              `:""}
        ${this.loading?u`<wa-spinner part="spinner"></wa-spinner>`:""}
      </${O}>
    `}};WaButton.shadowRootOptions={...WebAwesomeFormAssociatedElement.shadowRootOptions,delegatesFocus:!0};WaButton.css=[button_default,variants_default,size_default];__decorateClass$d([e$9(".button")],WaButton.prototype,"button",2);__decorateClass$d([e$9("slot:not([name])")],WaButton.prototype,"labelSlot",2);__decorateClass$d([r$6()],WaButton.prototype,"invalid",2);__decorateClass$d([r$6()],WaButton.prototype,"isIconButton",2);__decorateClass$d([n$7()],WaButton.prototype,"title",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"variant",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"appearance",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"size",2);__decorateClass$d([n$7({attribute:"with-caret",type:Boolean,reflect:!0})],WaButton.prototype,"withCaret",2);__decorateClass$d([n$7({type:Boolean})],WaButton.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaButton.prototype,"loading",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaButton.prototype,"pill",2);__decorateClass$d([n$7()],WaButton.prototype,"type",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"name",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"value",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"href",2);__decorateClass$d([n$7()],WaButton.prototype,"target",2);__decorateClass$d([n$7()],WaButton.prototype,"rel",2);__decorateClass$d([n$7()],WaButton.prototype,"download",2);__decorateClass$d([n$7({reflect:!0})],WaButton.prototype,"form",2);__decorateClass$d([n$7({attribute:"formaction"})],WaButton.prototype,"formAction",2);__decorateClass$d([n$7({attribute:"formenctype"})],WaButton.prototype,"formEnctype",2);__decorateClass$d([n$7({attribute:"formmethod"})],WaButton.prototype,"formMethod",2);__decorateClass$d([n$7({attribute:"formnovalidate",type:Boolean})],WaButton.prototype,"formNoValidate",2);__decorateClass$d([n$7({attribute:"formtarget"})],WaButton.prototype,"formTarget",2);__decorateClass$d([watch("disabled",{waitUntilFirstUpdate:!0})],WaButton.prototype,"handleDisabledChange",1);WaButton=__decorateClass$d([t$b("wa-button")],WaButton);var spinner_default=`:host {
  --track-width: 2px;
  --track-color: var(--wa-color-neutral-fill-normal);
  --indicator-color: var(--wa-color-brand-fill-loud);
  --speed: 2s;

  /* Resizing a spinner element using anything but font-size will break the animation because the animation uses em units.
   Therefore, if a spinner is used in a flex container without \`flex: none\` applied, the spinner can grow/shrink and
   break the animation. The use of \`flex: none\` on the host element prevents this by always having the spinner sized
   according to its actual dimensions.
  */
  flex: none;
  display: inline-flex;
  width: 1em;
  height: 1em;
}

svg {
  width: 100%;
  height: 100%;
  aspect-ratio: 1;
  animation: spin var(--speed) linear infinite;
}

.track {
  stroke: var(--track-color);
}

.indicator {
  stroke: var(--indicator-color);
  stroke-dasharray: 75, 100;
  stroke-dashoffset: -5;
  animation: dash 1.5s ease-in-out infinite;
  stroke-linecap: round;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

@keyframes dash {
  0% {
    stroke-dasharray: 1, 150;
    stroke-dashoffset: 0;
  }
  50% {
    stroke-dasharray: 90, 150;
    stroke-dashoffset: -35;
  }
  100% {
    stroke-dasharray: 90, 150;
    stroke-dashoffset: -124;
  }
}
`,WaSpinner=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this)}render(){return x$1`
      <svg
        part="base"
        role="progressbar"
        aria-label=${this.localize.term("loading")}
        fill="none"
        viewBox="0 0 50 50"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle class="track" cx="25" cy="25" r="20" fill="none" stroke-width="5" />
        <circle class="indicator" cx="25" cy="25" r="20" fill="none" stroke-width="5" />
      </svg>
    `}};WaSpinner.css=spinner_default;WaSpinner=__decorateClass$d([t$b("wa-spinner")],WaSpinner);var button_group_default=`:host {
  display: inline-flex;
}

.button-group {
  display: flex;
  position: relative;
  isolation: isolate;
  flex-wrap: wrap;
  gap: 1px;

  @media (hover: hover) {
    > :hover,
    &::slotted(:hover) {
      z-index: 1;
    }
  }

  /* Focus and checked are always on top */
  > :focus,
  &::slotted(:focus),
  > [aria-checked='true'],
  &::slotted([aria-checked='true']),
  > [checked],
  &::slotted([checked]) {
    z-index: 2 !important;
  }
}
:host([orientation='vertical']) .button-group {
  flex-direction: column;
}

/* Button groups with at least one outlined button will not have a gap and instead have borders overlap */
.button-group.has-outlined {
  gap: 0;

  &:not([aria-orientation='vertical']):not(.button-group-vertical)::slotted(:not(:first-child)) {
    margin-inline-start: calc(-1 * var(--border-width));
  }

  &:is([aria-orientation='vertical'], .button-group-vertical)::slotted(:not(:first-child)) {
    margin-block-start: calc(-1 * var(--border-width));
  }
}
`,WaButtonGroup=class extends WebAwesomeElement{constructor(){super(...arguments),this.disableRole=!1,this.hasOutlined=!1,this.label="",this.orientation="horizontal",this.variant="neutral"}updated(ee){super.updated(ee),ee.has("orientation")&&(this.setAttribute("aria-orientation",this.orientation),this.updateClassNames())}handleFocus(ee){findButton(ee.target)?.classList.add("button-focus")}handleBlur(ee){findButton(ee.target)?.classList.remove("button-focus")}handleMouseOver(ee){findButton(ee.target)?.classList.add("button-hover")}handleMouseOut(ee){findButton(ee.target)?.classList.remove("button-hover")}handleSlotChange(){this.updateClassNames()}updateClassNames(){const ee=[...this.defaultSlot.assignedElements({flatten:!0})];this.hasOutlined=!1,ee.forEach(O=>{const Y=ee.indexOf(O),te=findButton(O);te&&(te.appearance==="outlined"&&(this.hasOutlined=!0),te.classList.add("wa-button-group__button"),te.classList.toggle("wa-button-group__horizontal",this.orientation==="horizontal"),te.classList.toggle("wa-button-group__vertical",this.orientation==="vertical"),te.classList.toggle("wa-button-group__button-first",Y===0),te.classList.toggle("wa-button-group__button-inner",Y>0&&Y<ee.length-1),te.classList.toggle("wa-button-group__button-last",Y===ee.length-1),te.classList.toggle("wa-button-group__button-radio",te.tagName.toLowerCase()==="wa-radio-button"))})}render(){return x$1`
      <slot
        part="base"
        class=${e$5({"button-group":!0,"has-outlined":this.hasOutlined})}
        role="${this.disableRole?"presentation":"group"}"
        aria-label=${this.label}
        aria-orientation=${this.orientation}
        @focusout=${this.handleBlur}
        @focusin=${this.handleFocus}
        @mouseover=${this.handleMouseOver}
        @mouseout=${this.handleMouseOut}
        @slotchange=${this.handleSlotChange}
      ></slot>
    `}};WaButtonGroup.css=[variants_default,button_group_default];__decorateClass$d([e$9("slot")],WaButtonGroup.prototype,"defaultSlot",2);__decorateClass$d([r$6()],WaButtonGroup.prototype,"disableRole",2);__decorateClass$d([r$6()],WaButtonGroup.prototype,"hasOutlined",2);__decorateClass$d([n$7()],WaButtonGroup.prototype,"label",2);__decorateClass$d([n$7({reflect:!0})],WaButtonGroup.prototype,"orientation",2);__decorateClass$d([n$7({reflect:!0})],WaButtonGroup.prototype,"variant",2);WaButtonGroup=__decorateClass$d([t$b("wa-button-group")],WaButtonGroup);function findButton(ee){const O="wa-button, wa-radio-button";return ee.closest(O)??ee.querySelector(O)}var callout_default=`:host {
  display: flex;
  position: relative;
  align-items: stretch;
  border-radius: var(--wa-panel-border-radius);
  background-color: var(--wa-color-fill-quiet, var(--wa-color-brand-fill-quiet));
  border-color: var(--wa-color-border-quiet, var(--wa-color-brand-border-quiet));
  border-style: var(--wa-panel-border-style);
  border-width: var(--wa-panel-border-width);
  color: var(--wa-color-text-normal);
  padding: 1em;
}

/* Appearance modifiers */
:host([appearance~='plain']) {
  background-color: transparent;
  border-color: transparent;
}

:host([appearance~='outlined']) {
  background-color: transparent;
  border-color: var(--wa-color-border-loud, var(--wa-color-brand-border-loud));
}

:host([appearance~='filled']) {
  background-color: var(--wa-color-fill-quiet, var(--wa-color-brand-fill-quiet));
  border-color: transparent;
}

:host([appearance~='filled-outlined']) {
  border-color: var(--wa-color-border-quiet, var(--wa-color-brand-border-quiet));
}

:host([appearance~='accent']) {
  color: var(--wa-color-on-loud, var(--wa-color-brand-on-loud));
  background-color: var(--wa-color-fill-loud, var(--wa-color-brand-fill-loud));
  border-color: transparent;

  [part~='icon'] {
    color: currentColor;
  }
}

[part~='icon'] {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  color: var(--wa-color-on-quiet);
  font-size: 1.25em;
}

::slotted([slot='icon']) {
  margin-inline-end: var(--wa-form-control-padding-inline);
}

[part~='message'] {
  flex: 1 1 auto;
  display: block;
  overflow: hidden;
}
`,WaCallout=class extends WebAwesomeElement{constructor(){super(...arguments),this.variant="brand",this.size="medium"}render(){return x$1`
      <div part="icon">
        <slot name="icon"></slot>
      </div>

      <div part="message">
        <slot></slot>
      </div>
    `}};WaCallout.css=[callout_default,variants_default,size_default];__decorateClass$d([n$7({reflect:!0})],WaCallout.prototype,"variant",2);__decorateClass$d([n$7({reflect:!0})],WaCallout.prototype,"appearance",2);__decorateClass$d([n$7({reflect:!0})],WaCallout.prototype,"size",2);WaCallout=__decorateClass$d([t$b("wa-callout")],WaCallout);var card_default=`:host {
  --spacing: var(--wa-space-l);

  /* Internal calculated properties */
  --inner-border-radius: calc(var(--wa-panel-border-radius) - var(--wa-panel-border-width));

  display: flex;
  flex-direction: column;
  background-color: var(--wa-color-surface-default);
  border-color: var(--wa-color-surface-border);
  border-radius: var(--wa-panel-border-radius);
  border-style: var(--wa-panel-border-style);
  box-shadow: var(--wa-shadow-s);
  border-width: var(--wa-panel-border-width);
  color: var(--wa-color-text-normal);
}

/* Appearance modifiers */
:host([appearance~='plain']) {
  background-color: transparent;
  border-color: transparent;
  box-shadow: none;
}

:host([appearance~='outlined']) {
  background-color: var(--wa-color-surface-default);
  border-color: var(--wa-color-surface-border);
}

:host([appearance~='filled']) {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: transparent;
}

:host([appearance~='filled'][appearance~='outlined']) {
  border-color: var(--wa-color-neutral-border-quiet);
}

:host([appearance~='accent']) {
  color: var(--wa-color-neutral-on-loud);
  background-color: var(--wa-color-neutral-fill-loud);
  border-color: transparent;
}

/* Take care of top and bottom radii */
.media,
:host(:not([with-media])) .header,
:host(:not([with-media], [with-header])) .body {
  border-start-start-radius: var(--inner-border-radius);
  border-start-end-radius: var(--inner-border-radius);
}

:host(:not([with-footer])) .body,
.footer {
  border-end-start-radius: var(--inner-border-radius);
  border-end-end-radius: var(--inner-border-radius);
}

.media {
  display: flex;
  overflow: hidden;

  &::slotted(*) {
    display: block;
    width: 100%;
    border-radius: 0 !important;
  }
}

/* Round all corners for plain appearance */
:host([appearance='plain']) .media {
  border-radius: var(--inner-border-radius);

  &::slotted(*) {
    border-radius: inherit !important;
  }
}

.header {
  display: block;
  border-block-end-style: inherit;
  border-block-end-color: var(--wa-color-surface-border);
  border-block-end-width: var(--wa-panel-border-width);
  padding: calc(var(--spacing) / 2) var(--spacing);
}

.body {
  display: block;
  padding: var(--spacing);
}

.footer {
  display: block;
  border-block-start-style: inherit;
  border-block-start-color: var(--wa-color-surface-border);
  border-block-start-width: var(--wa-panel-border-width);
  padding: var(--spacing);
}

/* Push slots to sides when the action slots renders */
.has-actions {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

:host(:not([with-header])) .header,
:host(:not([with-footer])) .footer,
:host(:not([with-media])) .media {
  display: none;
}

/* Orientation Styles */
:host([orientation='horizontal']) {
  flex-direction: row;

  .media {
    border-start-start-radius: var(--inner-border-radius);
    border-end-start-radius: var(--inner-border-radius);
    border-start-end-radius: 0;

    &::slotted(*) {
      block-size: 100%;
      inline-size: 100%;
      object-fit: cover;
    }
  }
}

:host([orientation='horizontal']) ::slotted([slot='body']) {
  display: block;
  height: 100%;
  margin: 0;
}

:host([orientation='horizontal']) ::slotted([slot='actions']) {
  display: flex;
  align-items: center;
  padding: var(--spacing);
}
`,WaCard=class extends WebAwesomeElement{constructor(){super(...arguments),this.hasSlotController=new HasSlotController(this,"footer","header","media"),this.appearance="outlined",this.withHeader=!1,this.withMedia=!1,this.withFooter=!1,this.orientation="vertical"}updated(){!this.withHeader&&this.hasSlotController.test("header")&&(this.withHeader=!0),!this.withMedia&&this.hasSlotController.test("media")&&(this.withMedia=!0),!this.withFooter&&this.hasSlotController.test("footer")&&(this.withFooter=!0)}render(){return this.orientation==="horizontal"?x$1`
        <slot name="media" part="media" class="media"></slot>
        <slot part="body" class="body"></slot>
        <slot name="actions" part="actions" class="actions"></slot>
      `:x$1`
      <slot name="media" part="media" class="media"></slot>

      ${this.hasSlotController.test("header-actions")?x$1` <header part="header" class="header has-actions">
            <slot name="header"></slot>
            <slot name="header-actions"></slot>
          </header>`:x$1` <header part="header" class="header">
            <slot name="header"></slot>
          </header>`}

      <slot part="body" class="body"></slot>
      ${this.hasSlotController.test("footer-actions")?x$1` <footer part="footer" class="footer has-actions">
            <slot name="footer"></slot>
            <slot name="footer-actions"></slot>
          </footer>`:x$1` <footer part="footer" class="footer">
            <slot name="footer"></slot>
          </footer>`}
    `}};WaCard.css=[size_default,card_default];__decorateClass$d([n$7({reflect:!0})],WaCard.prototype,"appearance",2);__decorateClass$d([n$7({attribute:"with-header",type:Boolean,reflect:!0})],WaCard.prototype,"withHeader",2);__decorateClass$d([n$7({attribute:"with-media",type:Boolean,reflect:!0})],WaCard.prototype,"withMedia",2);__decorateClass$d([n$7({attribute:"with-footer",type:Boolean,reflect:!0})],WaCard.prototype,"withFooter",2);__decorateClass$d([n$7({reflect:!0})],WaCard.prototype,"orientation",2);WaCard=__decorateClass$d([t$b("wa-card")],WaCard);const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(ee=21)=>{let O="",Y=crypto.getRandomValues(new Uint8Array(ee|=0));for(;ee--;)O+=urlAlphabet[Y[ee]&63];return O};function clamp$3(ee,O,Y){const te=ne=>Object.is(ne,-0)?0:ne;return ee<O?te(O):ee>Y?te(Y):te(ee)}function uniqueId(ee=""){return`${ee}${nanoid()}`}function waitForEvent(ee,O){return new Promise(Y=>{function te(ne){ne.target===ee&&(ee.removeEventListener(O,te),Y())}ee.addEventListener(O,te)})}async function animate(ee,O,Y){return ee.animate(O,Y).finished.catch(()=>{})}function animateWithClass(ee,O){return new Promise(Y=>{const te=new AbortController,{signal:ne}=te;if(ee.classList.contains(O))return;ee.classList.remove(O),ee.classList.add(O);let xe=()=>{ee.classList.remove(O),Y(),te.abort()};ee.addEventListener("animationend",xe,{once:!0,signal:ne}),ee.addEventListener("animationcancel",xe,{once:!0,signal:ne})})}function parseDuration(ee){return ee=ee.toString().toLowerCase(),ee.indexOf("ms")>-1?parseFloat(ee)||0:ee.indexOf("s")>-1?(parseFloat(ee)||0)*1e3:parseFloat(ee)||0}function prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}var AutoplayController=class{constructor(ee,O){this.timerId=0,this.activeInteractions=0,this.paused=!1,this.stopped=!0,this.pause=()=>{this.activeInteractions++||(this.paused=!0,this.host.requestUpdate())},this.resume=()=>{--this.activeInteractions||(this.paused=!1,this.host.requestUpdate())},ee.addController(this),this.host=ee,this.tickCallback=O}hostConnected(){this.host.addEventListener("mouseenter",this.pause),this.host.addEventListener("mouseleave",this.resume),this.host.addEventListener("focusin",this.pause),this.host.addEventListener("focusout",this.resume),this.host.addEventListener("touchstart",this.pause,{passive:!0}),this.host.addEventListener("touchend",this.resume)}hostDisconnected(){this.stop(),this.host.removeEventListener("mouseenter",this.pause),this.host.removeEventListener("mouseleave",this.resume),this.host.removeEventListener("focusin",this.pause),this.host.removeEventListener("focusout",this.resume),this.host.removeEventListener("touchstart",this.pause),this.host.removeEventListener("touchend",this.resume)}start(ee){this.stop(),this.stopped=!1,this.timerId=window.setInterval(()=>{this.paused||this.tickCallback()},ee)}stop(){clearInterval(this.timerId),this.stopped=!0,this.host.requestUpdate()}};function*o$1(ee,O){if(ee!==void 0){let Y=0;for(const te of ee)yield O(te,Y++)}}function*o(ee,O,Y=1){const te=O===void 0?0:ee;O??=ee;for(let ne=te;Y>0?ne<O:O<ne;ne+=Y)yield ne}(()=>{const ee=(te,ne)=>{let xe=0;return function(...et){window.clearTimeout(xe),xe=window.setTimeout(()=>{te.call(this,...et)},ne)}},O=(te,ne,xe)=>{const et=te[ne];te[ne]=function(...tt){et.call(this,...tt),xe.call(this,et,...tt)}};if(!("onscrollend"in window)){const te=new Set,ne=new WeakMap,xe=tt=>{te.add(tt.pointerId)},et=tt=>{te.delete(tt.pointerId)};document.addEventListener("pointerdown",xe),document.addEventListener("pointerup",et),O(EventTarget.prototype,"addEventListener",function(tt,it){if(it!=="scroll")return;const st=ee(()=>{te.size?st():this.dispatchEvent(new Event("scrollend"))},100);tt.call(this,"scroll",st,{passive:!0}),ne.set(this,st)}),O(EventTarget.prototype,"removeEventListener",function(tt,it){if(it!=="scroll")return;const st=ne.get(this);st&&tt.call(this,"scroll",st,{passive:!0})})}})();var WaSlideChangeEvent=class extends Event{constructor(ee){super("wa-slide-change",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},carousel_default=`:host {
  --aspect-ratio: 16 / 9;
  --scroll-hint: 0px;
  --slide-gap: var(--wa-space-m, 1rem); /* fallback value is necessary */

  display: flex;
}

.carousel {
  display: grid;
  grid-template-columns: min-content 1fr min-content;
  grid-template-rows: 1fr min-content;
  grid-template-areas:
    '. slides .'
    '. pagination .';
  gap: var(--wa-space-m);
  align-items: center;
  min-height: 100%;
  min-width: 100%;
  position: relative;
}

.pagination {
  grid-area: pagination;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: var(--wa-space-s);
}

.slides {
  grid-area: slides;

  display: grid;
  height: 100%;
  width: 100%;
  align-items: center;
  justify-items: center;
  overflow: auto;
  overscroll-behavior-x: contain;
  scrollbar-width: none;
  aspect-ratio: calc(var(--aspect-ratio) * var(--slides-per-page));
  border-radius: var(--wa-border-radius-m);

  --slide-size: calc((100% - (var(--slides-per-page) - 1) * var(--slide-gap)) / var(--slides-per-page));
}

@media (prefers-reduced-motion) {
  :where(.slides) {
    scroll-behavior: auto;
  }
}

.slides-horizontal {
  grid-auto-flow: column;
  grid-auto-columns: var(--slide-size);
  grid-auto-rows: 100%;
  column-gap: var(--slide-gap);
  scroll-snap-type: x mandatory;
  scroll-padding-inline: var(--scroll-hint);
  padding-inline: var(--scroll-hint);
  overflow-y: hidden;
}

.slides-vertical {
  grid-auto-flow: row;
  grid-auto-columns: 100%;
  grid-auto-rows: var(--slide-size);
  row-gap: var(--slide-gap);
  scroll-snap-type: y mandatory;
  scroll-padding-block: var(--scroll-hint);
  padding-block: var(--scroll-hint);
  overflow-x: hidden;
}

.slides-dragging,
.slides-dropping {
  scroll-snap-type: unset;
}

:host([vertical]) ::slotted(wa-carousel-item) {
  height: 100%;
}

.slides::-webkit-scrollbar {
  display: none;
}

.navigation {
  grid-area: navigation;
  display: contents;
  font-size: var(--wa-font-size-l);
}

.navigation-button {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  background: none;
  border: none;
  border-radius: var(--wa-border-radius-m);
  font-size: inherit;
  color: var(--wa-color-text-quiet);
  padding: var(--wa-space-xs);
  cursor: pointer;
  transition: var(--wa-transition-normal) color;
  appearance: none;
}

.navigation-button-disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.navigation-button-disabled::part(base) {
  pointer-events: none;
}

.navigation-button-previous {
  grid-column: 1;
  grid-row: 1;
}

.navigation-button-next {
  grid-column: 3;
  grid-row: 1;
}

.pagination-item {
  display: block;
  cursor: pointer;
  background: none;
  border: 0;
  border-radius: var(--wa-border-radius-circle);
  width: var(--wa-space-s);
  height: var(--wa-space-s);
  background-color: var(--wa-color-neutral-fill-normal);
  padding: 0;
  margin: 0;
  transition: transform var(--wa-transition-slow);
}

.pagination-item-active {
  background-color: var(--wa-form-control-activated-color);
  transform: scale(1.25);
}

/* Focus styles */
.slides:focus-visible,
.navigation-button:focus-visible,
.pagination-item:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}
`,WaCarousel=class extends WebAwesomeElement{constructor(){super(...arguments),this.loop=!1,this.slides=0,this.currentSlide=0,this.navigation=!1,this.pagination=!1,this.autoplay=!1,this.autoplayInterval=3e3,this.slidesPerPage=1,this.slidesPerMove=1,this.orientation="horizontal",this.mouseDragging=!1,this.activeSlide=0,this.scrolling=!1,this.dragging=!1,this.autoplayController=new AutoplayController(this,()=>this.next()),this.dragStartPosition=[-1,-1],this.localize=new LocalizeController(this),this.pendingSlideChange=!1,this.handleMouseDrag=ee=>{this.dragging||(this.scrollContainer.style.setProperty("scroll-snap-type","none"),this.dragging=!0,this.dragStartPosition=[ee.clientX,ee.clientY]),this.scrollContainer.scrollBy({left:-ee.movementX,top:-ee.movementY,behavior:"instant"})},this.handleMouseDragEnd=()=>{const ee=this.scrollContainer;document.removeEventListener("pointermove",this.handleMouseDrag,{capture:!0});const O=ee.scrollLeft,Y=ee.scrollTop;ee.style.removeProperty("scroll-snap-type"),ee.style.setProperty("overflow","hidden");const te=ee.scrollLeft,ne=ee.scrollTop;ee.style.removeProperty("overflow"),ee.style.setProperty("scroll-snap-type","none"),ee.scrollTo({left:O,top:Y,behavior:"instant"}),requestAnimationFrame(async()=>{(O!==te||Y!==ne)&&(ee.scrollTo({left:te,top:ne,behavior:prefersReducedMotion()?"auto":"smooth"}),await waitForEvent(ee,"scrollend")),ee.style.removeProperty("scroll-snap-type"),this.dragging=!1,this.dragStartPosition=[-1,-1],this.handleScrollEnd()})},this.handleSlotChange=ee=>{ee.some(Y=>[...Y.addedNodes,...Y.removedNodes].some(te=>this.isCarouselItem(te)&&!te.hasAttribute("data-clone")))&&this.initializeSlides(),this.requestUpdate()}}connectedCallback(){super.connectedCallback(),this.setAttribute("role","region"),this.setAttribute("aria-label",this.localize.term("carousel"))}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect()}firstUpdated(){this.initializeSlides(),this.mutationObserver=new MutationObserver(this.handleSlotChange),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}willUpdate(ee){(ee.has("slidesPerMove")||ee.has("slidesPerPage"))&&(this.slidesPerMove=Math.min(this.slidesPerMove,this.slidesPerPage))}getPageCount(){const ee=this.getSlides().length,{slidesPerPage:O,slidesPerMove:Y,loop:te}=this,ne=te?ee/Y:(ee-O)/Y+1;return Math.ceil(ne)}getCurrentPage(){return Math.ceil(this.activeSlide/this.slidesPerMove)}canScrollNext(){return this.loop||this.getCurrentPage()<this.getPageCount()-1}canScrollPrev(){return this.loop||this.getCurrentPage()>0}getSlides({excludeClones:ee=!0}={}){return[...this.children].filter(O=>this.isCarouselItem(O)&&(!ee||!O.hasAttribute("data-clone")))}handleClick(ee){if(this.dragging&&this.dragStartPosition[0]>0&&this.dragStartPosition[1]>0){const O=Math.abs(this.dragStartPosition[0]-ee.clientX),Y=Math.abs(this.dragStartPosition[1]-ee.clientY);Math.sqrt(O*O+Y*Y)>=10&&ee.preventDefault()}}handleKeyDown(ee){if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(ee.key)){const O=ee.target,Y=this.localize.dir()==="rtl",te=O.closest('[part~="pagination-item"]')!==null,ne=ee.key==="ArrowDown"||!Y&&ee.key==="ArrowRight"||Y&&ee.key==="ArrowLeft",xe=ee.key==="ArrowUp"||!Y&&ee.key==="ArrowLeft"||Y&&ee.key==="ArrowRight";ee.preventDefault(),xe&&this.previous(),ne&&this.next(),ee.key==="Home"&&this.goToSlide(0),ee.key==="End"&&this.goToSlide(this.getSlides().length-1),te&&this.updateComplete.then(()=>{const et=this.shadowRoot?.querySelector('[part~="pagination-item-active"]');et&&et.focus()})}}handleMouseDragStart(ee){this.mouseDragging&&ee.button===0&&(ee.preventDefault(),document.addEventListener("pointermove",this.handleMouseDrag,{capture:!0,passive:!0}),document.addEventListener("pointerup",this.handleMouseDragEnd,{capture:!0,once:!0}))}handleScroll(){this.scrolling=!0,this.pendingSlideChange||this.synchronizeSlides()}synchronizeSlides(){const ee=new IntersectionObserver(O=>{ee.disconnect();for(const tt of O){const it=tt.target;it.toggleAttribute("inert",!tt.isIntersecting),it.classList.toggle("--in-view",tt.isIntersecting),it.setAttribute("aria-hidden",tt.isIntersecting?"false":"true")}const Y=O.find(tt=>tt.isIntersecting);if(!Y)return;const te=this.getSlides({excludeClones:!1}),ne=this.getSlides().length,xe=te.indexOf(Y.target),et=this.loop?xe-this.slidesPerPage:xe;if(Y&&(this.activeSlide=(Math.ceil(et/this.slidesPerMove)*this.slidesPerMove+ne)%ne,!this.scrolling&&this.loop&&Y.target.hasAttribute("data-clone"))){const tt=Number(Y.target.getAttribute("data-clone"));this.goToSlide(tt,"instant")}},{root:this.scrollContainer,threshold:.6});this.getSlides({excludeClones:!1}).forEach(O=>{ee.observe(O)})}handleScrollEnd(){!this.scrolling||this.dragging||(this.synchronizeSlides(),this.scrolling=!1,this.pendingSlideChange=!1,this.synchronizeSlides())}isCarouselItem(ee){return ee instanceof Element&&ee.tagName.toLowerCase()==="wa-carousel-item"}initializeSlides(){this.getSlides({excludeClones:!1}).forEach((ee,O)=>{ee.classList.remove("--in-view"),ee.classList.remove("--is-active"),ee.setAttribute("aria-label",this.localize.term("slideNum",O+1)),ee.hasAttribute("data-clone")&&ee.remove()}),this.updateSlidesSnap(),this.loop&&this.createClones(),this.goToSlide(this.activeSlide,"auto"),this.synchronizeSlides()}createClones(){const ee=this.getSlides(),O=this.slidesPerPage,Y=ee.slice(-O),te=ee.slice(0,O);Y.reverse().forEach((ne,xe)=>{const et=ne.cloneNode(!0);et.setAttribute("data-clone",String(ee.length-xe-1)),this.prepend(et)}),te.forEach((ne,xe)=>{const et=ne.cloneNode(!0);et.setAttribute("data-clone",String(xe)),this.append(et)})}handleSlideChange(){const ee=this.getSlides();ee.forEach((O,Y)=>{O.classList.toggle("--is-active",Y===this.activeSlide)}),this.hasUpdated&&this.dispatchEvent(new WaSlideChangeEvent({index:this.activeSlide,slide:ee[this.activeSlide]}))}updateSlidesSnap(){const ee=this.getSlides(),O=this.slidesPerMove;ee.forEach((Y,te)=>{(te+O)%O===0?Y.style.removeProperty("scroll-snap-align"):Y.style.setProperty("scroll-snap-align","none")})}handleAutoplayChange(){this.autoplayController.stop(),this.autoplay&&this.autoplayController.start(this.autoplayInterval)}previous(ee="smooth"){this.goToSlide(this.activeSlide-this.slidesPerMove,ee)}next(ee="smooth"){this.goToSlide(this.activeSlide+this.slidesPerMove,ee)}goToSlide(ee,O="smooth"){const{slidesPerPage:Y,loop:te}=this,ne=this.getSlides(),xe=this.getSlides({excludeClones:!1});if(!ne.length)return;const et=te?(ee+ne.length)%ne.length:clamp$3(ee,0,ne.length-Y);this.activeSlide=et;const tt=this.localize.dir()==="rtl",it=clamp$3(ee+(te?Y:0)+(tt?Y-1:0),0,xe.length-1),st=xe[it];this.scrollToSlide(st,prefersReducedMotion()?"auto":O)}scrollToSlide(ee,O="smooth"){this.pendingSlideChange=!0,window.requestAnimationFrame(()=>{if(!this.scrollContainer)return;const Y=this.scrollContainer,te=Y.getBoundingClientRect(),ne=ee.getBoundingClientRect(),xe=ne.left-te.left,et=ne.top-te.top;xe||et?(this.pendingSlideChange=!0,Y.scrollTo({left:xe+Y.scrollLeft,top:et+Y.scrollTop,behavior:O})):this.pendingSlideChange=!1})}render(){const{slidesPerMove:ee,scrolling:O}=this;let Y=0,te=0,ne=!1,xe=!1;this.hasUpdated&&(Y=this.getPageCount(),te=this.getCurrentPage(),ne=this.canScrollPrev(),xe=this.canScrollNext());const et=this.localize.dir()==="rtl";return x$1`
      <div part="base" class="carousel">
        <div
          id="scroll-container"
          part="scroll-container"
          class="${e$5({slides:!0,"slides-horizontal":this.orientation==="horizontal","slides-vertical":this.orientation==="vertical","slides-dragging":this.dragging})}"
          style="--slides-per-page: ${this.slidesPerPage};"
          aria-busy="${O?"true":"false"}"
          aria-atomic="true"
          tabindex="0"
          @keydown=${this.handleKeyDown}
          @mousedown="${this.handleMouseDragStart}"
          @scroll="${this.handleScroll}"
          @scrollend=${this.handleScrollEnd}
          @click=${this.handleClick}
        >
          <slot @slotchange=${()=>this.requestUpdate()}></slot>
        </div>

        ${this.navigation?x$1`
              <div part="navigation" class="navigation">
                <button
                  part="navigation-button navigation-button-previous"
                  class="${e$5({"navigation-button":!0,"navigation-button-previous":!0,"navigation-button-disabled":!ne})}"
                  aria-label="${this.localize.term("previousSlide")}"
                  aria-controls="scroll-container"
                  aria-disabled="${ne?"false":"true"}"
                  @click=${ne?()=>this.previous():null}
                >
                  <slot name="previous-icon">
                    <wa-icon library="system" name="${et?"chevron-right":"chevron-left"}"></wa-icon>
                  </slot>
                </button>

                <button
                  part="navigation-button navigation-button-next"
                  class=${e$5({"navigation-button":!0,"navigation-button-next":!0,"navigation-button-disabled":!xe})}
                  aria-label="${this.localize.term("nextSlide")}"
                  aria-controls="scroll-container"
                  aria-disabled="${xe?"false":"true"}"
                  @click=${xe?()=>this.next():null}
                >
                  <slot name="next-icon">
                    <wa-icon library="system" name="${et?"chevron-left":"chevron-right"}"></wa-icon>
                  </slot>
                </button>
              </div>
            `:""}
        ${this.pagination?x$1`
              <div part="pagination" role="tablist" class="pagination" aria-controls="scroll-container">
                ${o$1(o(Y),tt=>{const it=tt===te;return x$1`
                    <button
                      part="pagination-item ${it?"pagination-item-active":""}"
                      class="${e$5({"pagination-item":!0,"pagination-item-active":it})}"
                      role="tab"
                      aria-selected="${it?"true":"false"}"
                      aria-label="${this.localize.term("goToSlide",tt+1,Y)}"
                      tabindex=${it?"0":"-1"}
                      @click=${()=>this.goToSlide(tt*ee)}
                      @keydown=${this.handleKeyDown}
                    ></button>
                  `})}
              </div>
            `:x$1``}
      </div>
    `}};WaCarousel.css=carousel_default;__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCarousel.prototype,"loop",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaCarousel.prototype,"slides",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaCarousel.prototype,"currentSlide",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCarousel.prototype,"navigation",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCarousel.prototype,"pagination",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCarousel.prototype,"autoplay",2);__decorateClass$d([n$7({type:Number,attribute:"autoplay-interval"})],WaCarousel.prototype,"autoplayInterval",2);__decorateClass$d([n$7({type:Number,attribute:"slides-per-page"})],WaCarousel.prototype,"slidesPerPage",2);__decorateClass$d([n$7({type:Number,attribute:"slides-per-move"})],WaCarousel.prototype,"slidesPerMove",2);__decorateClass$d([n$7()],WaCarousel.prototype,"orientation",2);__decorateClass$d([n$7({type:Boolean,reflect:!0,attribute:"mouse-dragging"})],WaCarousel.prototype,"mouseDragging",2);__decorateClass$d([e$9(".slides")],WaCarousel.prototype,"scrollContainer",2);__decorateClass$d([e$9(".pagination")],WaCarousel.prototype,"paginationContainer",2);__decorateClass$d([r$6()],WaCarousel.prototype,"activeSlide",2);__decorateClass$d([r$6()],WaCarousel.prototype,"scrolling",2);__decorateClass$d([r$6()],WaCarousel.prototype,"dragging",2);__decorateClass$d([t$a({passive:!0})],WaCarousel.prototype,"handleScroll",1);__decorateClass$d([watch("loop",{waitUntilFirstUpdate:!0}),watch("slidesPerPage",{waitUntilFirstUpdate:!0})],WaCarousel.prototype,"initializeSlides",1);__decorateClass$d([watch("activeSlide")],WaCarousel.prototype,"handleSlideChange",1);__decorateClass$d([watch("slidesPerMove")],WaCarousel.prototype,"updateSlidesSnap",1);__decorateClass$d([watch("autoplay")],WaCarousel.prototype,"handleAutoplayChange",1);WaCarousel=__decorateClass$d([t$b("wa-carousel")],WaCarousel);var RequiredValidator=(ee={})=>{let{validationElement:O,validationProperty:Y}=ee;O||(O=Object.assign(document.createElement("input"),{required:!0})),Y||(Y="value");const te={observedAttributes:["required"],message:O.validationMessage,checkValidity(ne){const xe={message:"",isValid:!0,invalidKeys:[]};return(ne.required??ne.hasAttribute("required"))&&!ne[Y]&&(xe.message=typeof te.message=="function"?te.message(ne):te.message||"",xe.isValid=!1,xe.invalidKeys.push("valueMissing")),xe}};return te};var form_control_default=`:host {
  display: flex;
  flex-direction: column;
}

/* Label */
:is([part~='form-control-label'], [part~='label']):has(*:not(:empty)) {
  display: inline-flex;
  color: var(--wa-form-control-label-color);
  font-weight: var(--wa-form-control-label-font-weight);
  line-height: var(--wa-form-control-label-line-height);
  margin-block-end: 0.5em;
}

:host([required]) :is([part~='form-control-label'], [part~='label'])::after {
  content: var(--wa-form-control-required-content);
  margin-inline-start: var(--wa-form-control-required-content-offset);
  color: var(--wa-form-control-required-content-color);
}

/* Help text */
[part~='hint'] {
  display: block;
  color: var(--wa-form-control-hint-color);
  font-weight: var(--wa-form-control-hint-font-weight);
  line-height: var(--wa-form-control-hint-line-height);
  margin-block-start: 0.5em;
  font-size: var(--wa-font-size-smaller);
  line-height: var(--wa-form-control-label-line-height);

  &:not(.has-slotted) {
    display: none;
  }
}
`;var checkbox_default=`:host {
  --checked-icon-color: var(--wa-color-brand-on-loud);
  --checked-icon-scale: 0.8;

  display: inline-flex;
  color: var(--wa-form-control-value-color);
  font-family: inherit;
  font-weight: var(--wa-form-control-value-font-weight);
  line-height: var(--wa-form-control-value-line-height);
  user-select: none;
  -webkit-user-select: none;
}

[part~='control'] {
  display: inline-flex;
  flex: 0 0 auto;
  position: relative;
  align-items: center;
  justify-content: center;
  width: var(--wa-form-control-toggle-size);
  height: var(--wa-form-control-toggle-size);
  border-color: var(--wa-form-control-border-color);
  border-radius: min(
    calc(var(--wa-form-control-toggle-size) * 0.375),
    var(--wa-border-radius-s)
  ); /* min prevents entirely circular checkbox */
  border-style: var(--wa-border-style);
  border-width: var(--wa-form-control-border-width);
  background-color: var(--wa-form-control-background-color);
  transition:
    background var(--wa-transition-normal),
    border-color var(--wa-transition-fast),
    box-shadow var(--wa-transition-fast),
    color var(--wa-transition-fast);
  transition-timing-function: var(--wa-transition-easing);

  margin-inline-end: 0.5em;
}

[part~='base'] {
  display: flex;
  align-items: flex-start;
  position: relative;
  color: currentColor;
  vertical-align: middle;
  cursor: pointer;
}

[part~='label'] {
  display: inline;
}

/* Checked */
[part~='control']:has(:checked, :indeterminate) {
  color: var(--checked-icon-color);
  border-color: var(--wa-form-control-activated-color);
  background-color: var(--wa-form-control-activated-color);
}

/* Focus */
[part~='control']:has(> input:focus-visible:not(:disabled)) {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

/* Disabled */
:host [part~='base']:has(input:disabled) {
  opacity: 0.5;
  cursor: not-allowed;
}

input {
  position: absolute;
  padding: 0;
  margin: 0;
  height: 100%;
  width: 100%;
  opacity: 0;
  pointer-events: none;
}

[part~='icon'] {
  display: flex;
  scale: var(--checked-icon-scale);

  /* Without this, Safari renders the icon slightly to the left */
  &::part(svg) {
    translate: 0.0009765625em;
  }

  input:not(:checked, :indeterminate) + & {
    visibility: hidden;
  }
}

:host([required]) [part~='label']::after {
  content: var(--wa-form-control-required-content);
  color: var(--wa-form-control-required-content-color);
  margin-inline-start: var(--wa-form-control-required-content-offset);
}
`,WaCheckbox=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.hasSlotController=new HasSlotController(this,"hint"),this.title="",this.name="",this._value=this.getAttribute("value")??null,this.size="medium",this.disabled=!1,this.indeterminate=!1,this.checked=this.hasAttribute("checked"),this.defaultChecked=this.hasAttribute("checked"),this.form=null,this.required=!1,this.hint=""}static get validators(){const ee=[RequiredValidator({validationProperty:"checked",validationElement:Object.assign(document.createElement("input"),{type:"checkbox",required:!0})})];return[...super.validators,...ee]}get value(){const ee=this._value||"on";return this.checked?ee:null}set value(ee){this._value=ee}handleClick(){this.hasInteracted=!0,this.checked=!this.checked,this.indeterminate=!1,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}handleDefaultCheckedChange(){!this.hasInteracted&&this.checked!==this.defaultChecked&&(this.checked=this.defaultChecked,this.handleValueOrCheckedChange())}handleValueOrCheckedChange(){this.setValue(this.checked?this.value:null,this._value),this.updateValidity()}handleStateChange(){this.hasUpdated&&(this.input.checked=this.checked,this.input.indeterminate=this.indeterminate),this.customStates.set("checked",this.checked),this.customStates.set("indeterminate",this.indeterminate),this.updateValidity()}handleDisabledChange(){this.customStates.set("disabled",this.disabled)}willUpdate(ee){super.willUpdate(ee),ee.has("defaultChecked")&&(this.hasInteracted||(this.checked=this.defaultChecked)),(ee.has("value")||ee.has("checked"))&&this.handleValueOrCheckedChange()}formResetCallback(){this.checked=this.defaultChecked,super.formResetCallback(),this.handleValueOrCheckedChange()}click(){this.input.click()}focus(ee){this.input.focus(ee)}blur(){this.input.blur()}render(){const ee=this.hasSlotController.test("hint"),O=this.hint?!0:!!ee,Y=!this.checked&&this.indeterminate,te=Y?"indeterminate":"check",ne=Y?"indeterminate":"check";return x$1`
      <label part="base">
        <span part="control">
          <input
            class="input"
            type="checkbox"
            title=${this.title}
            name=${this.name}
            value=${o$6(this._value)}
            .indeterminate=${l$1(this.indeterminate)}
            .checked=${l$1(this.checked)}
            .disabled=${this.disabled}
            .required=${this.required}
            aria-checked=${this.checked?"true":"false"}
            aria-describedby="hint"
            @click=${this.handleClick}
          />

          <wa-icon part="${ne}-icon icon" library="system" name=${te}></wa-icon>
        </span>

        <slot part="label"></slot>
      </label>

      <slot
        id="hint"
        part="hint"
        name="hint"
        aria-hidden=${O?"false":"true"}
        class="${e$5({"has-slotted":O})}"
      >
        ${this.hint}
      </slot>
    `}};WaCheckbox.css=[form_control_default,size_default,checkbox_default];WaCheckbox.shadowRootOptions={...WebAwesomeFormAssociatedElement.shadowRootOptions,delegatesFocus:!0};__decorateClass$d([e$9('input[type="checkbox"]')],WaCheckbox.prototype,"input",2);__decorateClass$d([n$7()],WaCheckbox.prototype,"title",2);__decorateClass$d([n$7({reflect:!0})],WaCheckbox.prototype,"name",2);__decorateClass$d([n$7({reflect:!0})],WaCheckbox.prototype,"value",1);__decorateClass$d([n$7({reflect:!0})],WaCheckbox.prototype,"size",2);__decorateClass$d([n$7({type:Boolean})],WaCheckbox.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCheckbox.prototype,"indeterminate",2);__decorateClass$d([n$7({type:Boolean,attribute:!1})],WaCheckbox.prototype,"checked",2);__decorateClass$d([n$7({type:Boolean,reflect:!0,attribute:"checked"})],WaCheckbox.prototype,"defaultChecked",2);__decorateClass$d([n$7({reflect:!0})],WaCheckbox.prototype,"form",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCheckbox.prototype,"required",2);__decorateClass$d([n$7()],WaCheckbox.prototype,"hint",2);__decorateClass$d([watch("defaultChecked")],WaCheckbox.prototype,"handleDefaultCheckedChange",1);__decorateClass$d([watch(["checked","indeterminate"])],WaCheckbox.prototype,"handleStateChange",1);__decorateClass$d([watch("disabled")],WaCheckbox.prototype,"handleDisabledChange",1);WaCheckbox=__decorateClass$d([t$b("wa-checkbox")],WaCheckbox);function drag(ee,O){function Y(ne){const xe=ee.getBoundingClientRect(),et=ee.ownerDocument.defaultView,tt=xe.left+et.pageXOffset,it=xe.top+et.pageYOffset,st=ne.pageX-tt,ot=ne.pageY-it;O?.onMove&&O.onMove(st,ot)}function te(){document.removeEventListener("pointermove",Y),document.removeEventListener("pointerup",te),O?.onStop&&O.onStop()}document.addEventListener("pointermove",Y,{passive:!0}),document.addEventListener("pointerup",te),O?.initialEvent instanceof PointerEvent&&Y(O.initialEvent)}var supportsTouch=typeof window<"u"&&"ontouchstart"in window,DraggableElement=class{constructor(ee,O){this.isActive=!1,this.isDragging=!1,this.handleDragStart=Y=>{const te=supportsTouch&&"touches"in Y?Y.touches[0].clientX:Y.clientX,ne=supportsTouch&&"touches"in Y?Y.touches[0].clientY:Y.clientY;this.isDragging||!supportsTouch&&Y.buttons>1||(this.isDragging=!0,document.addEventListener("pointerup",this.handleDragStop),document.addEventListener("pointermove",this.handleDragMove),document.addEventListener("touchend",this.handleDragStop),document.addEventListener("touchmove",this.handleDragMove),this.options.start(te,ne))},this.handleDragStop=Y=>{const te=supportsTouch&&"touches"in Y?Y.touches[0].clientX:Y.clientX,ne=supportsTouch&&"touches"in Y?Y.touches[0].clientY:Y.clientY;this.isDragging=!1,document.removeEventListener("pointerup",this.handleDragStop),document.removeEventListener("pointermove",this.handleDragMove),document.removeEventListener("touchend",this.handleDragStop),document.removeEventListener("touchmove",this.handleDragMove),this.options.stop(te,ne)},this.handleDragMove=Y=>{const te=supportsTouch&&"touches"in Y?Y.touches[0].clientX:Y.clientX,ne=supportsTouch&&"touches"in Y?Y.touches[0].clientY:Y.clientY;window.getSelection()?.removeAllRanges(),this.options.move(te,ne)},this.element=ee,this.options={start:()=>{},stop:()=>{},move:()=>{},...O},this.start()}start(){this.isActive||(this.element.addEventListener("pointerdown",this.handleDragStart),supportsTouch&&this.element.addEventListener("touchstart",this.handleDragStart),this.isActive=!0)}stop(){document.removeEventListener("pointerup",this.handleDragStop),document.removeEventListener("pointermove",this.handleDragMove),document.removeEventListener("touchend",this.handleDragStop),document.removeEventListener("touchmove",this.handleDragMove),this.element.removeEventListener("pointerdown",this.handleDragStart),supportsTouch&&this.element.removeEventListener("touchstart",this.handleDragStart),this.isActive=!1,this.isDragging=!1}toggle(ee){(ee!==void 0?ee:!this.isActive)?this.start():this.stop()}};var visually_hidden_default=`@layer wa-utilities {
  .wa-visually-hidden:not(:focus-within),
  .wa-visually-hidden-force,
  .wa-visually-hidden-hint::part(hint),
  .wa-visually-hidden-label::part(label) {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    clip: rect(0 0 0 0) !important;
    clip-path: inset(50%) !important;
    border: none !important;
    overflow: hidden !important;
    white-space: nowrap !important;
    padding: 0 !important;
  }
}
`;function bound01(ee,O){isOnePointZero(ee)&&(ee="100%");const Y=isPercentage(ee);return ee=O===360?ee:Math.min(O,Math.max(0,parseFloat(ee))),Y&&(ee=parseInt(String(ee*O),10)/100),Math.abs(ee-O)<1e-6?1:(O===360?ee=(ee<0?ee%O+O:ee%O)/parseFloat(String(O)):ee=ee%O/parseFloat(String(O)),ee)}function clamp01(ee){return Math.min(1,Math.max(0,ee))}function isOnePointZero(ee){return typeof ee=="string"&&ee.indexOf(".")!==-1&&parseFloat(ee)===1}function isPercentage(ee){return typeof ee=="string"&&ee.indexOf("%")!==-1}function boundAlpha(ee){return ee=parseFloat(ee),(isNaN(ee)||ee<0||ee>1)&&(ee=1),ee}function convertToPercentage(ee){return Number(ee)<=1?`${Number(ee)*100}%`:ee}function pad2(ee){return ee.length===1?"0"+ee:String(ee)}function rgbToRgb(ee,O,Y){return{r:bound01(ee,255)*255,g:bound01(O,255)*255,b:bound01(Y,255)*255}}function rgbToHsl(ee,O,Y){ee=bound01(ee,255),O=bound01(O,255),Y=bound01(Y,255);const te=Math.max(ee,O,Y),ne=Math.min(ee,O,Y);let xe=0,et=0;const tt=(te+ne)/2;if(te===ne)et=0,xe=0;else{const it=te-ne;switch(et=tt>.5?it/(2-te-ne):it/(te+ne),te){case ee:xe=(O-Y)/it+(O<Y?6:0);break;case O:xe=(Y-ee)/it+2;break;case Y:xe=(ee-O)/it+4;break}xe/=6}return{h:xe,s:et,l:tt}}function hue2rgb(ee,O,Y){return Y<0&&(Y+=1),Y>1&&(Y-=1),Y<1/6?ee+(O-ee)*(6*Y):Y<1/2?O:Y<2/3?ee+(O-ee)*(2/3-Y)*6:ee}function hslToRgb$1(ee,O,Y){let te,ne,xe;if(ee=bound01(ee,360),O=bound01(O,100),Y=bound01(Y,100),O===0)ne=Y,xe=Y,te=Y;else{const et=Y<.5?Y*(1+O):Y+O-Y*O,tt=2*Y-et;te=hue2rgb(tt,et,ee+1/3),ne=hue2rgb(tt,et,ee),xe=hue2rgb(tt,et,ee-1/3)}return{r:te*255,g:ne*255,b:xe*255}}function rgbToHsv(ee,O,Y){ee=bound01(ee,255),O=bound01(O,255),Y=bound01(Y,255);const te=Math.max(ee,O,Y),ne=Math.min(ee,O,Y);let xe=0;const et=te,tt=te-ne,it=te===0?0:tt/te;if(te===ne)xe=0;else{switch(te){case ee:xe=(O-Y)/tt+(O<Y?6:0);break;case O:xe=(Y-ee)/tt+2;break;case Y:xe=(ee-O)/tt+4;break}xe/=6}return{h:xe,s:it,v:et}}function hsvToRgb(ee,O,Y){ee=bound01(ee,360)*6,O=bound01(O,100),Y=bound01(Y,100);const te=Math.floor(ee),ne=ee-te,xe=Y*(1-O),et=Y*(1-ne*O),tt=Y*(1-(1-ne)*O),it=te%6,st=[Y,et,xe,xe,tt,Y][it],ot=[tt,Y,Y,et,xe,xe][it],rt=[xe,xe,tt,Y,Y,et][it];return{r:st*255,g:ot*255,b:rt*255}}function rgbToHex(ee,O,Y,te){const ne=[pad2(Math.round(ee).toString(16)),pad2(Math.round(O).toString(16)),pad2(Math.round(Y).toString(16))];return te&&ne[0].startsWith(ne[0].charAt(1))&&ne[1].startsWith(ne[1].charAt(1))&&ne[2].startsWith(ne[2].charAt(1))?ne[0].charAt(0)+ne[1].charAt(0)+ne[2].charAt(0):ne.join("")}function rgbaToHex(ee,O,Y,te,ne){const xe=[pad2(Math.round(ee).toString(16)),pad2(Math.round(O).toString(16)),pad2(Math.round(Y).toString(16)),pad2(convertDecimalToHex(te))];return ne&&xe[0].startsWith(xe[0].charAt(1))&&xe[1].startsWith(xe[1].charAt(1))&&xe[2].startsWith(xe[2].charAt(1))&&xe[3].startsWith(xe[3].charAt(1))?xe[0].charAt(0)+xe[1].charAt(0)+xe[2].charAt(0)+xe[3].charAt(0):xe.join("")}function cmykToRgb(ee,O,Y,te){const ne=ee/100,xe=O/100,et=Y/100,tt=te/100,it=255*(1-ne)*(1-tt),st=255*(1-xe)*(1-tt),ot=255*(1-et)*(1-tt);return{r:it,g:st,b:ot}}function rgbToCmyk(ee,O,Y){let te=1-ee/255,ne=1-O/255,xe=1-Y/255,et=Math.min(te,ne,xe);return et===1?(te=0,ne=0,xe=0):(te=(te-et)/(1-et)*100,ne=(ne-et)/(1-et)*100,xe=(xe-et)/(1-et)*100),et*=100,{c:Math.round(te),m:Math.round(ne),y:Math.round(xe),k:Math.round(et)}}function convertDecimalToHex(ee){return Math.round(parseFloat(ee)*255).toString(16)}function convertHexToDecimal(ee){return parseIntFromHex(ee)/255}function parseIntFromHex(ee){return parseInt(ee,16)}function numberInputToObject(ee){return{r:ee>>16,g:(ee&65280)>>8,b:ee&255}}const names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function inputToRGB(ee){let O={r:0,g:0,b:0},Y=1,te=null,ne=null,xe=null,et=!1,tt=!1;return typeof ee=="string"&&(ee=stringInputToObject(ee)),typeof ee=="object"&&(isValidCSSUnit(ee.r)&&isValidCSSUnit(ee.g)&&isValidCSSUnit(ee.b)?(O=rgbToRgb(ee.r,ee.g,ee.b),et=!0,tt=String(ee.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(ee.h)&&isValidCSSUnit(ee.s)&&isValidCSSUnit(ee.v)?(te=convertToPercentage(ee.s),ne=convertToPercentage(ee.v),O=hsvToRgb(ee.h,te,ne),et=!0,tt="hsv"):isValidCSSUnit(ee.h)&&isValidCSSUnit(ee.s)&&isValidCSSUnit(ee.l)?(te=convertToPercentage(ee.s),xe=convertToPercentage(ee.l),O=hslToRgb$1(ee.h,te,xe),et=!0,tt="hsl"):isValidCSSUnit(ee.c)&&isValidCSSUnit(ee.m)&&isValidCSSUnit(ee.y)&&isValidCSSUnit(ee.k)&&(O=cmykToRgb(ee.c,ee.m,ee.y,ee.k),et=!0,tt="cmyk"),Object.prototype.hasOwnProperty.call(ee,"a")&&(Y=ee.a)),Y=boundAlpha(Y),{ok:et,format:ee.format||tt,r:Math.min(255,Math.max(O.r,0)),g:Math.min(255,Math.max(O.g,0)),b:Math.min(255,Math.max(O.b,0)),a:Y}}const CSS_INTEGER="[-\\+]?\\d+%?",CSS_NUMBER="[-\\+]?\\d*\\.\\d+%?",CSS_UNIT="(?:"+CSS_NUMBER+")|(?:"+CSS_INTEGER+")",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",matchers={CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),cmyk:new RegExp("cmyk"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function stringInputToObject(ee){if(ee=ee.trim().toLowerCase(),ee.length===0)return!1;let O=!1;if(names[ee])ee=names[ee],O=!0;else if(ee==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};let Y=matchers.rgb.exec(ee);return Y?{r:Y[1],g:Y[2],b:Y[3]}:(Y=matchers.rgba.exec(ee),Y?{r:Y[1],g:Y[2],b:Y[3],a:Y[4]}:(Y=matchers.hsl.exec(ee),Y?{h:Y[1],s:Y[2],l:Y[3]}:(Y=matchers.hsla.exec(ee),Y?{h:Y[1],s:Y[2],l:Y[3],a:Y[4]}:(Y=matchers.hsv.exec(ee),Y?{h:Y[1],s:Y[2],v:Y[3]}:(Y=matchers.hsva.exec(ee),Y?{h:Y[1],s:Y[2],v:Y[3],a:Y[4]}:(Y=matchers.cmyk.exec(ee),Y?{c:Y[1],m:Y[2],y:Y[3],k:Y[4]}:(Y=matchers.hex8.exec(ee),Y?{r:parseIntFromHex(Y[1]),g:parseIntFromHex(Y[2]),b:parseIntFromHex(Y[3]),a:convertHexToDecimal(Y[4]),format:O?"name":"hex8"}:(Y=matchers.hex6.exec(ee),Y?{r:parseIntFromHex(Y[1]),g:parseIntFromHex(Y[2]),b:parseIntFromHex(Y[3]),format:O?"name":"hex"}:(Y=matchers.hex4.exec(ee),Y?{r:parseIntFromHex(Y[1]+Y[1]),g:parseIntFromHex(Y[2]+Y[2]),b:parseIntFromHex(Y[3]+Y[3]),a:convertHexToDecimal(Y[4]+Y[4]),format:O?"name":"hex8"}:(Y=matchers.hex3.exec(ee),Y?{r:parseIntFromHex(Y[1]+Y[1]),g:parseIntFromHex(Y[2]+Y[2]),b:parseIntFromHex(Y[3]+Y[3]),format:O?"name":"hex"}:!1))))))))))}function isValidCSSUnit(ee){return typeof ee=="number"?!Number.isNaN(ee):matchers.CSS_UNIT.test(ee)}class TinyColor{constructor(O="",Y={}){if(O instanceof TinyColor)return O;typeof O=="number"&&(O=numberInputToObject(O)),this.originalInput=O;const te=inputToRGB(O);this.originalInput=O,this.r=te.r,this.g=te.g,this.b=te.b,this.a=te.a,this.roundA=Math.round(100*this.a)/100,this.format=Y.format??te.format,this.gradientType=Y.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=te.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const O=this.toRgb();return(O.r*299+O.g*587+O.b*114)/1e3}getLuminance(){const O=this.toRgb();let Y,te,ne;const xe=O.r/255,et=O.g/255,tt=O.b/255;return xe<=.03928?Y=xe/12.92:Y=Math.pow((xe+.055)/1.055,2.4),et<=.03928?te=et/12.92:te=Math.pow((et+.055)/1.055,2.4),tt<=.03928?ne=tt/12.92:ne=Math.pow((tt+.055)/1.055,2.4),.2126*Y+.7152*te+.0722*ne}getAlpha(){return this.a}setAlpha(O){return this.a=boundAlpha(O),this.roundA=Math.round(100*this.a)/100,this}isMonochrome(){const{s:O}=this.toHsl();return O===0}toHsv(){const O=rgbToHsv(this.r,this.g,this.b);return{h:O.h*360,s:O.s,v:O.v,a:this.a}}toHsvString(){const O=rgbToHsv(this.r,this.g,this.b),Y=Math.round(O.h*360),te=Math.round(O.s*100),ne=Math.round(O.v*100);return this.a===1?`hsv(${Y}, ${te}%, ${ne}%)`:`hsva(${Y}, ${te}%, ${ne}%, ${this.roundA})`}toHsl(){const O=rgbToHsl(this.r,this.g,this.b);return{h:O.h*360,s:O.s,l:O.l,a:this.a}}toHslString(){const O=rgbToHsl(this.r,this.g,this.b),Y=Math.round(O.h*360),te=Math.round(O.s*100),ne=Math.round(O.l*100);return this.a===1?`hsl(${Y}, ${te}%, ${ne}%)`:`hsla(${Y}, ${te}%, ${ne}%, ${this.roundA})`}toHex(O=!1){return rgbToHex(this.r,this.g,this.b,O)}toHexString(O=!1){return"#"+this.toHex(O)}toHex8(O=!1){return rgbaToHex(this.r,this.g,this.b,this.a,O)}toHex8String(O=!1){return"#"+this.toHex8(O)}toHexShortString(O=!1){return this.a===1?this.toHexString(O):this.toHex8String(O)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const O=Math.round(this.r),Y=Math.round(this.g),te=Math.round(this.b);return this.a===1?`rgb(${O}, ${Y}, ${te})`:`rgba(${O}, ${Y}, ${te}, ${this.roundA})`}toPercentageRgb(){const O=Y=>`${Math.round(bound01(Y,255)*100)}%`;return{r:O(this.r),g:O(this.g),b:O(this.b),a:this.a}}toPercentageRgbString(){const O=Y=>Math.round(bound01(Y,255)*100);return this.a===1?`rgb(${O(this.r)}%, ${O(this.g)}%, ${O(this.b)}%)`:`rgba(${O(this.r)}%, ${O(this.g)}%, ${O(this.b)}%, ${this.roundA})`}toCmyk(){return{...rgbToCmyk(this.r,this.g,this.b)}}toCmykString(){const{c:O,m:Y,y:te,k:ne}=rgbToCmyk(this.r,this.g,this.b);return`cmyk(${O}, ${Y}, ${te}, ${ne})`}toName(){if(this.a===0)return"transparent";if(this.a<1)return!1;const O="#"+rgbToHex(this.r,this.g,this.b,!1);for(const[Y,te]of Object.entries(names))if(O===te)return Y;return!1}toString(O){const Y=!!O;O=O??this.format;let te=!1;const ne=this.a<1&&this.a>=0;return!Y&&ne&&(O.startsWith("hex")||O==="name")?O==="name"&&this.a===0?this.toName():this.toRgbString():(O==="rgb"&&(te=this.toRgbString()),O==="prgb"&&(te=this.toPercentageRgbString()),(O==="hex"||O==="hex6")&&(te=this.toHexString()),O==="hex3"&&(te=this.toHexString(!0)),O==="hex4"&&(te=this.toHex8String(!0)),O==="hex8"&&(te=this.toHex8String()),O==="name"&&(te=this.toName()),O==="hsl"&&(te=this.toHslString()),O==="hsv"&&(te=this.toHsvString()),O==="cmyk"&&(te=this.toCmykString()),te||this.toHexString())}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new TinyColor(this.toString())}lighten(O=10){const Y=this.toHsl();return Y.l+=O/100,Y.l=clamp01(Y.l),new TinyColor(Y)}brighten(O=10){const Y=this.toRgb();return Y.r=Math.max(0,Math.min(255,Y.r-Math.round(255*-(O/100)))),Y.g=Math.max(0,Math.min(255,Y.g-Math.round(255*-(O/100)))),Y.b=Math.max(0,Math.min(255,Y.b-Math.round(255*-(O/100)))),new TinyColor(Y)}darken(O=10){const Y=this.toHsl();return Y.l-=O/100,Y.l=clamp01(Y.l),new TinyColor(Y)}tint(O=10){return this.mix("white",O)}shade(O=10){return this.mix("black",O)}desaturate(O=10){const Y=this.toHsl();return Y.s-=O/100,Y.s=clamp01(Y.s),new TinyColor(Y)}saturate(O=10){const Y=this.toHsl();return Y.s+=O/100,Y.s=clamp01(Y.s),new TinyColor(Y)}greyscale(){return this.desaturate(100)}spin(O){const Y=this.toHsl(),te=(Y.h+O)%360;return Y.h=te<0?360+te:te,new TinyColor(Y)}mix(O,Y=50){const te=this.toRgb(),ne=new TinyColor(O).toRgb(),xe=Y/100,et={r:(ne.r-te.r)*xe+te.r,g:(ne.g-te.g)*xe+te.g,b:(ne.b-te.b)*xe+te.b,a:(ne.a-te.a)*xe+te.a};return new TinyColor(et)}analogous(O=6,Y=30){const te=this.toHsl(),ne=360/Y,xe=[this];for(te.h=(te.h-(ne*O>>1)+720)%360;--O;)te.h=(te.h+ne)%360,xe.push(new TinyColor(te));return xe}complement(){const O=this.toHsl();return O.h=(O.h+180)%360,new TinyColor(O)}monochromatic(O=6){const Y=this.toHsv(),{h:te}=Y,{s:ne}=Y;let{v:xe}=Y;const et=[],tt=1/O;for(;O--;)et.push(new TinyColor({h:te,s:ne,v:xe})),xe=(xe+tt)%1;return et}splitcomplement(){const O=this.toHsl(),{h:Y}=O;return[this,new TinyColor({h:(Y+72)%360,s:O.s,l:O.l}),new TinyColor({h:(Y+216)%360,s:O.s,l:O.l})]}onBackground(O){const Y=this.toRgb(),te=new TinyColor(O).toRgb(),ne=Y.a+te.a*(1-Y.a);return new TinyColor({r:(Y.r*Y.a+te.r*te.a*(1-Y.a))/ne,g:(Y.g*Y.a+te.g*te.a*(1-Y.a))/ne,b:(Y.b*Y.a+te.b*te.a*(1-Y.a))/ne,a:ne})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(O){const Y=this.toHsl(),{h:te}=Y,ne=[this],xe=360/O;for(let et=1;et<O;et++)ne.push(new TinyColor({h:(te+et*xe)%360,s:Y.s,l:Y.l}));return ne}equals(O){const Y=new TinyColor(O);return this.format==="cmyk"||Y.format==="cmyk"?this.toCmykString()===Y.toCmykString():this.toRgbString()===Y.toRgbString()}}var color_picker_default=`:host {
  --grid-width: 17em;
  --grid-height: 12em;
  --grid-handle-size: 1.25em;
  --slider-height: 1em;
  --slider-handle-size: calc(var(--slider-height) + 0.25em);
}

.color-picker {
  background-color: var(--wa-color-surface-raised);
  border-radius: var(--wa-border-radius-m);
  border-style: var(--wa-border-style);
  border-width: var(--wa-border-width-s);
  border-color: var(--wa-color-surface-border);
  box-shadow: var(--wa-shadow-m);
  color: var(--color);
  font: inherit;
  font-size: inherit;
  user-select: none;
  width: var(--grid-width);
  -webkit-user-select: none;
}

.grid {
  position: relative;
  height: var(--grid-height);
  background-image:
    linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%),
    linear-gradient(to right, #fff 0%, rgba(255, 255, 255, 0) 100%);
  border-top-left-radius: calc(var(--wa-border-radius-m) - var(--wa-border-width-s));
  border-top-right-radius: calc(var(--wa-border-radius-m) - var(--wa-border-width-s));
  cursor: crosshair;
  forced-color-adjust: none;
}

.grid-handle {
  position: absolute;
  width: var(--grid-handle-size);
  height: var(--grid-handle-size);
  border-radius: var(--wa-border-radius-circle);
  box-shadow: 0 0 0 0.0625rem rgba(0, 0, 0, 0.2);
  border: solid 0.125rem white;
  margin-top: calc(var(--grid-handle-size) / -2);
  margin-left: calc(var(--grid-handle-size) / -2);
  transition: scale var(--wa-transition-normal) var(--wa-transition-easing);
}

.grid-handle-dragging {
  cursor: none;
  scale: 1.5;
}

.grid-handle:focus-visible {
  outline: var(--wa-focus-ring);
}

.controls {
  padding: 0.75em;
  display: flex;
  align-items: center;
}

.sliders {
  flex: 1 1 auto;
}

.slider {
  position: relative;
  height: var(--slider-height);
  border-radius: var(--wa-border-radius-s);
  box-shadow: inset 0 0 0 0.0625rem rgba(0, 0, 0, 0.2);
  forced-color-adjust: none;
}

.slider:not(:last-of-type) {
  margin-bottom: 0.75em;
}

.slider-handle {
  position: absolute;
  top: calc(50% - var(--slider-handle-size) / 2);
  width: var(--slider-handle-size);
  height: var(--slider-handle-size);
  border-radius: var(--wa-border-radius-circle);
  border: solid 0.125rem white;
  box-shadow: 0 0 0 0.0625rem rgba(0, 0, 0, 0.2);
  margin-left: calc(var(--slider-handle-size) / -2);
}

.slider-handle:focus-visible {
  outline: var(--wa-focus-ring);
}

.hue {
  background-image: linear-gradient(
    to right,
    rgb(255, 0, 0) 0%,
    rgb(255, 255, 0) 17%,
    rgb(0, 255, 0) 33%,
    rgb(0, 255, 255) 50%,
    rgb(0, 0, 255) 67%,
    rgb(255, 0, 255) 83%,
    rgb(255, 0, 0) 100%
  );
}

.alpha .alpha-gradient {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: inherit;
}

.preview {
  flex: 0 0 auto;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: 3em;
  height: 3em;
  border: none;
  border-radius: var(--wa-border-radius-circle);
  background: none;
  font-size: inherit;
  margin-inline-start: 0.75em;
  cursor: copy;
  forced-color-adjust: none;
}

.preview:before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: inherit;
  box-shadow: inset 0 0 0 0.0625rem rgba(0, 0, 0, 0.2);

  /* We use a custom property in lieu of currentColor because of https://bugs.webkit.org/show_bug.cgi?id=216780 */
  background-color: var(--preview-color);
}

.preview:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

.preview-color {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: solid 0.0625rem rgba(0, 0, 0, 0.125);
}

.preview-color-copied {
  animation: pulse 850ms;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 var(--wa-color-brand-fill-loud);
  }
  70% {
    box-shadow: 0 0 0 0.5rem transparent;
  }
  100% {
    box-shadow: 0 0 0 0 transparent;
  }
}

.user-input {
  display: flex;
  align-items: center;
  padding: 0 0.75em 0.75em 0.75em;
}

.user-input wa-input {
  min-width: 0; /* fix input width in Safari */
  flex: 1 1 auto;

  &::part(form-control-label) {
    /* Visually hidden */
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    clip: rect(0 0 0 0) !important;
    clip-path: inset(50%) !important;
    border: none !important;
    overflow: hidden !important;
    white-space: nowrap !important;
    padding: 0 !important;
  }
}

.user-input wa-button-group {
  margin-inline-start: 0.75em;

  &::part(base) {
    flex-wrap: nowrap;
  }
}

.user-input wa-button:first-of-type {
  min-width: 3em;
  max-width: 3em;
}

.swatches {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(min(1.5em, 100%), 1fr));
  grid-gap: 0.5em;
  justify-items: center;
  border-block-start: var(--wa-form-control-border-style) var(--wa-form-control-border-width)
    var(--wa-color-surface-border);
  padding: 0.5em;
  forced-color-adjust: none;
}

.swatch {
  position: relative;
  aspect-ratio: 1 / 1;
  width: 100%;
  border-radius: var(--wa-border-radius-s);
}

.swatch .swatch-color {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: solid 0.0625rem rgba(0, 0, 0, 0.125);
  border-radius: inherit;
  cursor: pointer;
}

.swatch:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

.transparent-bg {
  background-image:
    linear-gradient(45deg, var(--wa-color-neutral-fill-normal) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, var(--wa-color-neutral-fill-normal) 75%),
    linear-gradient(45deg, transparent 75%, var(--wa-color-neutral-fill-normal) 75%),
    linear-gradient(45deg, var(--wa-color-neutral-fill-normal) 25%, transparent 25%);
  background-size: 0.5rem 0.5rem;
  background-position:
    0 0,
    0 0,
    -0.25rem -0.25rem,
    0.25rem 0.25rem;
}

:host([disabled]) {
  opacity: 0.5;
  cursor: not-allowed;

  .grid,
  .grid-handle,
  .slider,
  .slider-handle,
  .preview,
  .swatch,
  .swatch-color {
    pointer-events: none;
  }
}

/*
 * Color dropdown
 */

.color-dropdown {
  display: contents;
}

.color-dropdown::part(panel) {
  max-height: none;
  background-color: var(--wa-color-surface-raised);
  border: var(--wa-border-style) var(--wa-border-width-s) var(--wa-color-surface-border);
  border-radius: var(--wa-border-radius-m);
  overflow: visible;
}

.trigger {
  display: block;
  position: relative;
  background-color: transparent;
  border: none;
  cursor: pointer;
  font-size: inherit;
  forced-color-adjust: none;
  width: var(--wa-form-control-height);
  height: var(--wa-form-control-height);
  border-radius: var(--wa-form-control-border-radius);
}

.trigger:before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: inherit;
  background-color: currentColor;
  box-shadow:
    inset 0 0 0 var(--wa-form-control-border-width) var(--wa-form-control-border-color),
    inset 0 0 0 calc(var(--wa-form-control-border-width) * 3) var(--wa-color-surface-default);
}

.trigger-empty:before {
  background-color: transparent;
}

.trigger:focus-visible {
  outline: none;
}

.trigger:focus-visible:not(.trigger:disabled) {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

:host([disabled]) :is(.label, .trigger) {
  opacity: 0.5;
  cursor: not-allowed;
}

.form-control.form-control-has-label .label {
  cursor: pointer;
  display: inline-block;
}
`,WaColorPicker=class extends WebAwesomeFormAssociatedElement{constructor(){super(),this.hasSlotController=new HasSlotController(this,"hint","label"),this.isSafeValue=!1,this.localize=new LocalizeController(this),this.hasFocus=!1,this.isDraggingGridHandle=!1,this.isEmpty=!0,this.inputValue="",this.hue=0,this.saturation=100,this.brightness=100,this.alpha=100,this._value=null,this.defaultValue=this.getAttribute("value")||null,this.withLabel=!1,this.withHint=!1,this.hasEyeDropper=!1,this.label="",this.hint="",this.format="hex",this.size="medium",this.withoutFormatToggle=!1,this.name=null,this.disabled=!1,this.open=!1,this.opacity=!1,this.uppercase=!1,this.swatches="",this.form=null,this.required=!1,this.handleFocusIn=()=>{this.hasFocus=!0},this.handleFocusOut=()=>{this.hasFocus=!1},this.reportValidityAfterShow=()=>{this.removeEventListener("invalid",this.emitInvalid),this.reportValidity(),this.addEventListener("invalid",this.emitInvalid)},this.handleKeyDown=ee=>{this.open&&ee.key==="Escape"&&(ee.stopPropagation(),this.hide(),this.focus())},this.handleDocumentKeyDown=ee=>{if(ee.key==="Escape"&&this.open){ee.stopPropagation(),this.focus(),this.hide();return}ee.key==="Tab"&&setTimeout(()=>{const O=this.getRootNode()instanceof ShadowRoot?document.activeElement?.shadowRoot?.activeElement:document.activeElement;(!this||O?.closest(this.tagName.toLowerCase())!==this)&&this.hide()})},this.handleDocumentMouseDown=ee=>{const Y=ee.composedPath().some(te=>te instanceof Element&&(te.closest(".color-picker")||te===this.trigger));this&&!Y&&this.hide()},this.addEventListener("focusin",this.handleFocusIn),this.addEventListener("focusout",this.handleFocusOut)}static get validators(){const ee=[RequiredValidator()];return[...super.validators,...ee]}get validationTarget(){return this.popup?.active?this.input:this.trigger}get value(){return this.valueHasChanged?this._value:this._value??this.defaultValue}set value(ee){this._value!==ee&&(this.valueHasChanged=!0,this._value=ee)}handleCopy(){this.input.select(),document.execCommand("copy"),this.previewButton.focus(),this.previewButton.classList.add("preview-color-copied"),this.previewButton.addEventListener("animationend",()=>{this.previewButton.classList.remove("preview-color-copied")})}handleFormatToggle(){const ee=["hex","rgb","hsl","hsv"],O=(ee.indexOf(this.format)+1)%ee.length;this.format=ee[O],this.setColor(this.value||""),this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))})}handleAlphaDrag(ee){const O=this.shadowRoot.querySelector(".slider.alpha"),Y=O.querySelector(".slider-handle"),{width:te}=O.getBoundingClientRect();let ne=this.value,xe=this.value;Y.focus(),ee.preventDefault(),drag(O,{onMove:et=>{this.alpha=clamp$3(et/te*100,0,100),this.syncValues(),this.value!==xe&&(xe=this.value,this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}))},onStop:()=>{this.value!==ne&&(ne=this.value,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))},initialEvent:ee})}handleHueDrag(ee){const O=this.shadowRoot.querySelector(".slider.hue"),Y=O.querySelector(".slider-handle"),{width:te}=O.getBoundingClientRect();let ne=this.value,xe=this.value;Y.focus(),ee.preventDefault(),drag(O,{onMove:et=>{this.hue=clamp$3(et/te*360,0,360),this.syncValues(),this.value!==xe&&(xe=this.value,this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input"))}))},onStop:()=>{this.value!==ne&&(ne=this.value,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))},initialEvent:ee})}handleGridDrag(ee){const O=this.shadowRoot.querySelector(".grid"),Y=O.querySelector(".grid-handle"),{width:te,height:ne}=O.getBoundingClientRect();let xe=this.value,et=this.value;Y.focus(),ee.preventDefault(),this.isDraggingGridHandle=!0,drag(O,{onMove:(tt,it)=>{this.saturation=clamp$3(tt/te*100,0,100),this.brightness=clamp$3(100-it/ne*100,0,100),this.syncValues(),this.value!==et&&(et=this.value,this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}))},onStop:()=>{this.isDraggingGridHandle=!1,this.value!==xe&&(xe=this.value,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))},initialEvent:ee})}handleAlphaKeyDown(ee){const O=ee.shiftKey?10:1,Y=this.value;ee.key==="ArrowLeft"&&(ee.preventDefault(),this.alpha=clamp$3(this.alpha-O,0,100),this.syncValues()),ee.key==="ArrowRight"&&(ee.preventDefault(),this.alpha=clamp$3(this.alpha+O,0,100),this.syncValues()),ee.key==="Home"&&(ee.preventDefault(),this.alpha=0,this.syncValues()),ee.key==="End"&&(ee.preventDefault(),this.alpha=100,this.syncValues()),this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}handleHueKeyDown(ee){const O=ee.shiftKey?10:1,Y=this.value;ee.key==="ArrowLeft"&&(ee.preventDefault(),this.hue=clamp$3(this.hue-O,0,360),this.syncValues()),ee.key==="ArrowRight"&&(ee.preventDefault(),this.hue=clamp$3(this.hue+O,0,360),this.syncValues()),ee.key==="Home"&&(ee.preventDefault(),this.hue=0,this.syncValues()),ee.key==="End"&&(ee.preventDefault(),this.hue=360,this.syncValues()),this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}handleGridKeyDown(ee){const O=ee.shiftKey?10:1,Y=this.value;ee.key==="ArrowLeft"&&(ee.preventDefault(),this.saturation=clamp$3(this.saturation-O,0,100),this.syncValues()),ee.key==="ArrowRight"&&(ee.preventDefault(),this.saturation=clamp$3(this.saturation+O,0,100),this.syncValues()),ee.key==="ArrowUp"&&(ee.preventDefault(),this.brightness=clamp$3(this.brightness+O,0,100),this.syncValues()),ee.key==="ArrowDown"&&(ee.preventDefault(),this.brightness=clamp$3(this.brightness-O,0,100),this.syncValues()),this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}handleInputChange(ee){const O=ee.target,Y=this.value;ee.stopPropagation(),this.input.value?(this.setColor(O.value),O.value=this.value||""):this.value="",this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}handleInputInput(ee){this.updateValidity(),ee.stopPropagation()}handleInputKeyDown(ee){if(ee.key==="Enter"){const O=this.value;this.input.value?(this.setColor(this.input.value),this.input.value=this.value,this.value!==O&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),setTimeout(()=>this.input.select())):this.hue=0}}handleTouchMove(ee){ee.preventDefault()}parseColor(ee){if(!ee||ee.trim()==="")return null;const O=new TinyColor(ee);if(!O.isValid)return null;const Y=O.toHsl(),te=O.toRgb(),ne=O.toHsv();if(!te||te.r==null||te.g==null||te.b==null)return null;const xe={h:Y.h||0,s:(Y.s||0)*100,l:(Y.l||0)*100,a:Y.a||0},et=O.toHexString(),tt=O.toHex8String(),it={h:ne.h||0,s:(ne.s||0)*100,v:(ne.v||0)*100,a:ne.a||0};return{hsl:{h:xe.h,s:xe.s,l:xe.l,string:this.setLetterCase(`hsl(${Math.round(xe.h)}, ${Math.round(xe.s)}%, ${Math.round(xe.l)}%)`)},hsla:{h:xe.h,s:xe.s,l:xe.l,a:xe.a,string:this.setLetterCase(`hsla(${Math.round(xe.h)}, ${Math.round(xe.s)}%, ${Math.round(xe.l)}%, ${xe.a.toFixed(2).toString()})`)},hsv:{h:it.h,s:it.s,v:it.v,string:this.setLetterCase(`hsv(${Math.round(it.h)}, ${Math.round(it.s)}%, ${Math.round(it.v)}%)`)},hsva:{h:it.h,s:it.s,v:it.v,a:it.a,string:this.setLetterCase(`hsva(${Math.round(it.h)}, ${Math.round(it.s)}%, ${Math.round(it.v)}%, ${it.a.toFixed(2).toString()})`)},rgb:{r:te.r,g:te.g,b:te.b,string:this.setLetterCase(`rgb(${Math.round(te.r)}, ${Math.round(te.g)}, ${Math.round(te.b)})`)},rgba:{r:te.r,g:te.g,b:te.b,a:te.a||0,string:this.setLetterCase(`rgba(${Math.round(te.r)}, ${Math.round(te.g)}, ${Math.round(te.b)}, ${(te.a||0).toFixed(2).toString()})`)},hex:this.setLetterCase(et),hexa:this.setLetterCase(tt)}}setColor(ee){const O=this.parseColor(ee);return O===null?!1:(this.hue=O.hsva.h,this.saturation=O.hsva.s,this.brightness=O.hsva.v,this.alpha=this.opacity?O.hsva.a*100:100,this.syncValues(),!0)}setLetterCase(ee){return typeof ee!="string"?"":this.uppercase?ee.toUpperCase():ee.toLowerCase()}async syncValues(){const ee=this.parseColor(`hsva(${this.hue}, ${this.saturation}%, ${this.brightness}%, ${this.alpha/100})`);ee!==null&&(this.format==="hsl"?this.inputValue=this.opacity?ee.hsla.string:ee.hsl.string:this.format==="rgb"?this.inputValue=this.opacity?ee.rgba.string:ee.rgb.string:this.format==="hsv"?this.inputValue=this.opacity?ee.hsva.string:ee.hsv.string:this.inputValue=this.opacity?ee.hexa:ee.hex,this.isSafeValue=!0,this.value=this.inputValue,await this.updateComplete,this.isSafeValue=!1)}handleAfterHide(){this.previewButton.classList.remove("preview-color-copied"),this.updateValidity()}handleAfterShow(){this.updateValidity()}handleEyeDropper(){if(!this.hasEyeDropper)return;new EyeDropper().open().then(O=>{const Y=this.value;this.setColor(O.sRGBHex),this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}).catch(()=>{})}selectSwatch(ee){const O=this.value;this.disabled||(this.setColor(ee),this.value!==O&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))}getHexString(ee,O,Y,te=100){const ne=new TinyColor(`hsva(${ee}, ${O}%, ${Y}%, ${te/100})`);return ne.isValid?ne.toHex8String():""}stopNestedEventPropagation(ee){ee.stopImmediatePropagation()}handleFormatChange(){this.syncValues()}handleOpacityChange(){this.alpha=100}willUpdate(ee){super.willUpdate(ee),ee.has("value")&&this.handleValueChange(ee.get("value")||"",this.value||"")}handleValueChange(ee,O){if(this.isEmpty=!O,O||(this.hue=0,this.saturation=0,this.brightness=100,this.alpha=100),!this.isSafeValue){const Y=this.parseColor(O);Y!==null?(this.inputValue=this.value||"",this.hue=Y.hsva.h,this.saturation=Y.hsva.s,this.brightness=Y.hsva.v,this.alpha=Y.hsva.a*100,this.syncValues()):this.inputValue=ee??""}this.requestUpdate()}focus(ee){this.trigger.focus(ee)}blur(){const ee=this.trigger;this.hasFocus&&(ee.focus({preventScroll:!0}),ee.blur()),this.popup?.active&&this.hide()}getFormattedValue(ee="hex"){const O=this.parseColor(`hsva(${this.hue}, ${this.saturation}%, ${this.brightness}%, ${this.alpha/100})`);if(O===null)return"";switch(ee){case"hex":return O.hex;case"hexa":return O.hexa;case"rgb":return O.rgb.string;case"rgba":return O.rgba.string;case"hsl":return O.hsl.string;case"hsla":return O.hsla.string;case"hsv":return O.hsv.string;case"hsva":return O.hsva.string;default:return""}}reportValidity(){return!this.validity.valid&&!this.open?(this.addEventListener("wa-after-show",this.reportValidityAfterShow,{once:!0}),this.show(),this.disabled||this.dispatchEvent(new WaInvalidEvent),!1):super.reportValidity()}formResetCallback(){this.value=this.defaultValue,super.formResetCallback()}firstUpdated(ee){super.firstUpdated(ee),this.hasEyeDropper="EyeDropper"in window}handleTriggerClick(){this.open?this.hide():(this.show(),this.focus())}async handleTriggerKeyDown(ee){if([" ","Enter"].includes(ee.key)){ee.preventDefault(),this.handleTriggerClick();return}}handleTriggerKeyUp(ee){ee.key===" "&&ee.preventDefault()}updateAccessibleTrigger(){const ee=this.trigger;ee&&(ee.setAttribute("aria-haspopup","true"),ee.setAttribute("aria-expanded",this.open?"true":"false"))}async show(){if(!this.open)return this.open=!0,waitForEvent(this,"wa-after-show")}async hide(){if(this.open)return this.open=!1,waitForEvent(this,"wa-after-hide")}addOpenListeners(){this.base.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("mousedown",this.handleDocumentMouseDown)}removeOpenListeners(){this.base&&this.base.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("mousedown",this.handleDocumentMouseDown)}async handleOpenChange(){if(this.disabled){this.open=!1;return}this.updateAccessibleTrigger(),this.open?(this.dispatchEvent(new CustomEvent("wa-show")),this.addOpenListeners(),await this.updateComplete,this.base.hidden=!1,this.popup.active=!0,await animateWithClass(this.popup.popup,"show-with-scale"),this.dispatchEvent(new CustomEvent("wa-after-show"))):(this.dispatchEvent(new CustomEvent("wa-hide")),this.removeOpenListeners(),await animateWithClass(this.popup.popup,"hide-with-scale"),this.base.hidden=!0,this.popup.active=!1,this.dispatchEvent(new CustomEvent("wa-after-hide")))}render(){const ee=this.hasUpdated?this.withLabel||this.hasSlotController.test("label"):this.withLabel,O=this.hasUpdated?this.withHint||this.hasSlotController.test("hint"):this.withHint,Y=this.label?!0:!!ee,te=this.hint?!0:!!O,ne=this.saturation,xe=100-this.brightness,et=Array.isArray(this.swatches)?this.swatches:this.swatches.split(";").filter(it=>it.trim()!==""),tt=x$1`
      <div
        part="base"
        class=${e$5({"color-picker":!0})}
        aria-disabled=${this.disabled?"true":"false"}
        tabindex="-1"
      >
        <div
          part="grid"
          class="grid"
          style=${o$7({backgroundColor:this.getHexString(this.hue,100,100)})}
          @pointerdown=${this.handleGridDrag}
          @touchmove=${this.handleTouchMove}
        >
          <span
            part="grid-handle"
            class=${e$5({"grid-handle":!0,"grid-handle-dragging":this.isDraggingGridHandle})}
            style=${o$7({top:`${xe}%`,left:`${ne}%`,backgroundColor:this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
            role="application"
            aria-label="HSV"
            tabindex=${o$6(this.disabled?void 0:"0")}
            @keydown=${this.handleGridKeyDown}
          ></span>
        </div>

        <div class="controls">
          <div class="sliders">
            <div
              part="slider hue-slider"
              class="hue slider"
              @pointerdown=${this.handleHueDrag}
              @touchmove=${this.handleTouchMove}
            >
              <span
                part="slider-handle hue-slider-handle"
                class="slider-handle"
                style=${o$7({left:`${this.hue===0?0:100/(360/this.hue)}%`,backgroundColor:this.getHexString(this.hue,100,100)})}
                role="slider"
                aria-label="hue"
                aria-orientation="horizontal"
                aria-valuemin="0"
                aria-valuemax="360"
                aria-valuenow=${`${Math.round(this.hue)}`}
                tabindex=${o$6(this.disabled?void 0:"0")}
                @keydown=${this.handleHueKeyDown}
              ></span>
            </div>

            ${this.opacity?x$1`
                  <div
                    part="slider opacity-slider"
                    class="alpha slider transparent-bg"
                    @pointerdown="${this.handleAlphaDrag}"
                    @touchmove=${this.handleTouchMove}
                  >
                    <div
                      class="alpha-gradient"
                      style=${o$7({backgroundImage:`linear-gradient(
                          to right,
                          ${this.getHexString(this.hue,this.saturation,this.brightness,0)} 0%,
                          ${this.getHexString(this.hue,this.saturation,this.brightness,100)} 100%
                        )`})}
                    ></div>
                    <span
                      part="slider-handle opacity-slider-handle"
                      class="slider-handle"
                      style=${o$7({left:`${this.alpha}%`,backgroundColor:this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
                      role="slider"
                      aria-label="alpha"
                      aria-orientation="horizontal"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      aria-valuenow=${Math.round(this.alpha)}
                      tabindex=${o$6(this.disabled?void 0:"0")}
                      @keydown=${this.handleAlphaKeyDown}
                    ></span>
                  </div>
                `:""}
          </div>

          <button
            type="button"
            part="preview"
            class="preview transparent-bg"
            aria-label=${this.localize.term("copy")}
            style=${o$7({"--preview-color":this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
            @click=${this.handleCopy}
          ></button>
        </div>

        <div class="user-input" aria-live="polite">
          <wa-input
            part="input"
            type="text"
            name=${this.name}
            size="small"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            .value=${this.isEmpty?"":this.inputValue}
            ?required=${this.required}
            ?disabled=${this.disabled}
            aria-label=${this.localize.term("currentValue")}
            @keydown=${this.handleInputKeyDown}
            @change=${this.handleInputChange}
            @input=${this.handleInputInput}
            @blur=${this.stopNestedEventPropagation}
            @focus=${this.stopNestedEventPropagation}
          ></wa-input>

          <wa-button-group>
            ${this.withoutFormatToggle?"":x$1`
                  <wa-button
                    part="format-button"
                    size="small"
                    appearance="outlined"
                    aria-label=${this.localize.term("toggleColorFormat")}
                    exportparts="
                      base:format-button__base,
                      start:format-button__start,
                      label:format-button__label,
                      end:format-button__end,
                      caret:format-button__caret
                    "
                    @click=${this.handleFormatToggle}
                    @blur=${this.stopNestedEventPropagation}
                    @focus=${this.stopNestedEventPropagation}
                  >
                    ${this.setLetterCase(this.format)}
                  </wa-button>
                `}
            ${this.hasEyeDropper?x$1`
                  <wa-button
                    part="eyedropper-button"
                    size="small"
                    appearance="outlined"
                    exportparts="
                      base:eyedropper-button__base,
                      start:eyedropper-button__start,
                      label:eyedropper-button__label,
                      end:eyedropper-button__end,
                      caret:eyedropper-button__caret
                    "
                    @click=${this.handleEyeDropper}
                    @blur=${this.stopNestedEventPropagation}
                    @focus=${this.stopNestedEventPropagation}
                  >
                    <wa-icon
                      library="system"
                      name="eyedropper"
                      variant="solid"
                      label=${this.localize.term("selectAColorFromTheScreen")}
                    ></wa-icon>
                  </wa-button>
                `:""}
          </wa-button-group>
        </div>

        ${et.length>0?x$1`
              <div part="swatches" class="swatches">
                ${et.map(it=>{const st=this.parseColor(it);return st?x$1`
                    <div
                      part="swatch"
                      class="swatch transparent-bg"
                      tabindex=${o$6(this.disabled?void 0:"0")}
                      role="button"
                      aria-label=${it}
                      @click=${()=>this.selectSwatch(it)}
                      @keydown=${ot=>!this.disabled&&ot.key==="Enter"&&this.setColor(st.hexa)}
                    >
                      <div class="swatch-color" style=${o$7({backgroundColor:st.hexa})}></div>
                    </div>
                  `:""})}
              </div>
            `:""}
      </div>
    `;return x$1`
      <div
        class=${e$5({container:!0,"form-control":!0,"form-control-has-label":Y})}
        part="trigger-container form-control"
      >
        <div part="form-control-label" class="label" id="form-control-label">
          <slot name="label">${this.label}</slot>
        </div>

        <button
          id="trigger"
          part="trigger form-control-input"
          class=${e$5({trigger:!0,"trigger-empty":this.isEmpty,"transparent-bg":!0,"form-control-input":!0})}
          style=${o$7({color:this.getHexString(this.hue,this.saturation,this.brightness,this.alpha)})}
          type="button"
          aria-labelledby="form-control-label"
          aria-describedby="hint"
          .disabled=${this.disabled}
          @click=${this.handleTriggerClick}
          @keydown=${this.handleTriggerKeyDown}
          @keyup=${this.handleTriggerKeyUp}
        ></button>

        <slot
          id="hint"
          name="hint"
          part="hint"
          class=${e$5({"has-slotted":te})}
          >${this.hint}</slot
        >
      </div>

      <wa-popup
        class="color-popup"
        anchor="trigger"
        placement="bottom-start"
        distance="0"
        skidding="0"
        sync="width"
        flip
        flip-fallback-strategy="best-fit"
        shift
        shift-padding="10"
        aria-disabled=${this.disabled?"true":"false"}
        @wa-after-show=${this.handleAfterShow}
        @wa-after-hide=${this.handleAfterHide}
      >
        ${tt}
      </wa-popup>
    `}};WaColorPicker.css=[visually_hidden_default,size_default,form_control_default,color_picker_default];WaColorPicker.shadowRootOptions={...WebAwesomeFormAssociatedElement.shadowRootOptions,delegatesFocus:!0};__decorateClass$d([e$9('[part~="base"]')],WaColorPicker.prototype,"base",2);__decorateClass$d([e$9('[part~="input"]')],WaColorPicker.prototype,"input",2);__decorateClass$d([e$9('[part~="form-control-label"]')],WaColorPicker.prototype,"triggerLabel",2);__decorateClass$d([e$9('[part~="form-control-input"]')],WaColorPicker.prototype,"triggerButton",2);__decorateClass$d([e$9(".color-popup")],WaColorPicker.prototype,"popup",2);__decorateClass$d([e$9('[part~="preview"]')],WaColorPicker.prototype,"previewButton",2);__decorateClass$d([e$9('[part~="trigger"]')],WaColorPicker.prototype,"trigger",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"hasFocus",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"isDraggingGridHandle",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"isEmpty",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"inputValue",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"hue",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"saturation",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"brightness",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"alpha",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"value",1);__decorateClass$d([n$7({attribute:"value",reflect:!0})],WaColorPicker.prototype,"defaultValue",2);__decorateClass$d([n$7({attribute:"with-label",reflect:!0,type:Boolean})],WaColorPicker.prototype,"withLabel",2);__decorateClass$d([n$7({attribute:"with-hint",reflect:!0,type:Boolean})],WaColorPicker.prototype,"withHint",2);__decorateClass$d([r$6()],WaColorPicker.prototype,"hasEyeDropper",2);__decorateClass$d([n$7()],WaColorPicker.prototype,"label",2);__decorateClass$d([n$7({attribute:"hint"})],WaColorPicker.prototype,"hint",2);__decorateClass$d([n$7()],WaColorPicker.prototype,"format",2);__decorateClass$d([n$7({reflect:!0})],WaColorPicker.prototype,"size",2);__decorateClass$d([n$7({attribute:"without-format-toggle",type:Boolean})],WaColorPicker.prototype,"withoutFormatToggle",2);__decorateClass$d([n$7({reflect:!0})],WaColorPicker.prototype,"name",2);__decorateClass$d([n$7({type:Boolean})],WaColorPicker.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaColorPicker.prototype,"open",2);__decorateClass$d([n$7({type:Boolean})],WaColorPicker.prototype,"opacity",2);__decorateClass$d([n$7({type:Boolean})],WaColorPicker.prototype,"uppercase",2);__decorateClass$d([n$7()],WaColorPicker.prototype,"swatches",2);__decorateClass$d([n$7({reflect:!0})],WaColorPicker.prototype,"form",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaColorPicker.prototype,"required",2);__decorateClass$d([t$a({passive:!1})],WaColorPicker.prototype,"handleTouchMove",1);__decorateClass$d([watch("format",{waitUntilFirstUpdate:!0})],WaColorPicker.prototype,"handleFormatChange",1);__decorateClass$d([watch("opacity")],WaColorPicker.prototype,"handleOpacityChange",1);__decorateClass$d([watch("value")],WaColorPicker.prototype,"handleValueChange",1);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaColorPicker.prototype,"handleOpenChange",1);WaColorPicker=__decorateClass$d([t$b("wa-color-picker")],WaColorPicker);var WaClearEvent=class extends Event{constructor(){super("wa-clear",{bubbles:!0,cancelable:!1,composed:!0})}};function submitOnEnter(ee,O){const Y=ee.metaKey||ee.ctrlKey||ee.shiftKey||ee.altKey;ee.key==="Enter"&&!Y&&setTimeout(()=>{!ee.defaultPrevented&&!ee.isComposing&&submitForm(O)})}function submitForm(ee){let O=null;if("form"in ee&&(O=ee.form),!O&&"getForm"in ee&&(O=ee.getForm()),!O)return;const Y=[...O.elements];if(Y.length===1){O.requestSubmit(null);return}const te=Y.find(ne=>ne.type==="submit"&&!ne.matches(":disabled"));te&&(["input","button"].includes(te.localName)?O.requestSubmit(te):te.click())}var input_default=`:host {
  border-width: 0;
}

.text-field {
  flex: auto;
  display: flex;
  align-items: stretch;
  justify-content: start;
  position: relative;
  transition: inherit;
  height: var(--wa-form-control-height);
  border-color: var(--wa-form-control-border-color);
  border-radius: var(--wa-form-control-border-radius);
  border-style: var(--wa-form-control-border-style);
  border-width: var(--wa-form-control-border-width);
  cursor: text;
  color: var(--wa-form-control-value-color);
  font-size: var(--wa-form-control-value-font-size);
  font-family: inherit;
  font-weight: var(--wa-form-control-value-font-weight);
  line-height: var(--wa-form-control-value-line-height);
  vertical-align: middle;
  width: 100%;
  transition:
    background-color var(--wa-transition-normal),
    border var(--wa-transition-normal),
    outline var(--wa-transition-fast);
  transition-timing-function: var(--wa-transition-easing);
  background-color: var(--wa-form-control-background-color);
  box-shadow: var(--box-shadow);
  padding: 0 var(--wa-form-control-padding-inline);

  &:focus-within {
    outline: var(--wa-focus-ring);
    outline-offset: var(--wa-focus-ring-offset);
  }

  /* Style disabled inputs */
  &:has(:disabled) {
    cursor: not-allowed;
    opacity: 0.5;
  }
}

/* Appearance modifiers */
:host([appearance='outlined']) .text-field {
  background-color: var(--wa-form-control-background-color);
  border-color: var(--wa-form-control-border-color);
}

:host([appearance='filled']) .text-field {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-color-neutral-fill-quiet);
}

:host([appearance='filled-outlined']) .text-field {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-form-control-border-color);
}

:host([pill]) .text-field {
  border-radius: var(--wa-border-radius-pill) !important;
}

.text-field {
  /* Show autofill styles over the entire text field, not just the native <input> */
  &:has(:autofill),
  &:has(:-webkit-autofill) {
    background-color: var(--wa-color-brand-fill-quiet) !important;
  }

  input,
  textarea {
    /*
    Fixes an alignment issue with placeholders.
    https://github.com/shoelace-style/webawesome/issues/342
  */
    height: 100%;

    padding: 0;
    border: none;
    outline: none;
    box-shadow: none;
    margin: 0;
    cursor: inherit;
    -webkit-appearance: none;
    font: inherit;

    /* Turn off Safari's autofill styles */
    &:-webkit-autofill,
    &:-webkit-autofill:hover,
    &:-webkit-autofill:focus,
    &:-webkit-autofill:active {
      -webkit-background-clip: text;
      background-color: transparent;
      -webkit-text-fill-color: inherit;
    }
  }
}

input {
  flex: 1 1 auto;
  min-width: 0;
  height: 100%;
  transition: inherit;

  /* prettier-ignore */
  background-color: rgb(118 118 118 / 0); /* ensures proper placeholder styles in webkit's date input */
  height: calc(var(--wa-form-control-height) - var(--border-width) * 2);
  padding-block: 0;
  color: inherit;

  &:autofill {
    &,
    &:hover,
    &:focus,
    &:active {
      box-shadow: none;
      caret-color: var(--wa-form-control-value-color);
    }
  }

  &::placeholder {
    color: var(--wa-form-control-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }

  &::-webkit-search-decoration,
  &::-webkit-search-cancel-button,
  &::-webkit-search-results-button,
  &::-webkit-search-results-decoration {
    -webkit-appearance: none;
  }

  &:focus {
    outline: none;
  }
}

textarea {
  &:autofill {
    &,
    &:hover,
    &:focus,
    &:active {
      box-shadow: none;
      caret-color: var(--wa-form-control-value-color);
    }
  }

  &::placeholder {
    color: var(--wa-form-control-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }
}

.start,
.end {
  display: inline-flex;
  flex: 0 0 auto;
  align-items: center;
  cursor: default;

  &::slotted(wa-icon) {
    color: var(--wa-color-neutral-on-quiet);
  }
}

.start::slotted(*) {
  margin-inline-end: var(--wa-form-control-padding-inline);
}

.end::slotted(*) {
  margin-inline-start: var(--wa-form-control-padding-inline);
}

/*
 * Clearable + Password Toggle
 */

.clear,
.password-toggle {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: inherit;
  color: var(--wa-color-neutral-on-quiet);
  border: none;
  background: none;
  padding: 0;
  transition: var(--wa-transition-normal) color;
  cursor: pointer;
  margin-inline-start: var(--wa-form-control-padding-inline);

  @media (hover: hover) {
    &:hover {
      color: color-mix(in oklab, currentColor, var(--wa-color-mix-hover));
    }
  }

  &:active {
    color: color-mix(in oklab, currentColor, var(--wa-color-mix-active));
  }

  &:focus {
    outline: none;
  }
}

/* Don't show the browser's password toggle in Edge */
::-ms-reveal {
  display: none;
}

/* Hide the built-in number spinner */
:host([without-spin-buttons]) input[type='number'] {
  -moz-appearance: textfield;

  &::-webkit-outer-spin-button,
  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    display: none;
  }
}
`,WaInput=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.assumeInteractionOn=["blur","input"],this.hasSlotController=new HasSlotController(this,"hint","label"),this.localize=new LocalizeController(this),this.title="",this.type="text",this._value=null,this.defaultValue=this.getAttribute("value")||null,this.size="medium",this.appearance="outlined",this.pill=!1,this.label="",this.hint="",this.withClear=!1,this.placeholder="",this.readonly=!1,this.passwordToggle=!1,this.passwordVisible=!1,this.withoutSpinButtons=!1,this.form=null,this.required=!1,this.spellcheck=!0,this.withLabel=!1,this.withHint=!1}static get validators(){return[...super.validators,MirrorValidator()]}get value(){return this.valueHasChanged?this._value:this._value??this.defaultValue}set value(ee){this._value!==ee&&(this.valueHasChanged=!0,this._value=ee)}handleChange(ee){this.value=this.input.value,this.relayNativeEvent(ee,{bubbles:!0,composed:!0})}handleClearClick(ee){ee.preventDefault(),this.value!==""&&(this.value="",this.updateComplete.then(()=>{this.dispatchEvent(new WaClearEvent),this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})),this.input.focus()}handleInput(){this.value=this.input.value}handleKeyDown(ee){submitOnEnter(ee,this)}handlePasswordToggle(){this.passwordVisible=!this.passwordVisible}updated(ee){super.updated(ee),ee.has("value")&&this.customStates.set("blank",!this.value)}handleStepChange(){this.input.step=String(this.step),this.updateValidity()}focus(ee){this.input.focus(ee)}blur(){this.input.blur()}select(){this.input.select()}setSelectionRange(ee,O,Y="none"){this.input.setSelectionRange(ee,O,Y)}setRangeText(ee,O,Y,te="preserve"){const ne=O??this.input.selectionStart,xe=Y??this.input.selectionEnd;this.input.setRangeText(ee,ne,xe,te),this.value!==this.input.value&&(this.value=this.input.value)}showPicker(){"showPicker"in HTMLInputElement.prototype&&this.input.showPicker()}stepUp(){this.input.stepUp(),this.value!==this.input.value&&(this.value=this.input.value)}stepDown(){this.input.stepDown(),this.value!==this.input.value&&(this.value=this.input.value)}formResetCallback(){this.value=this.defaultValue,super.formResetCallback()}render(){const ee=this.hasUpdated?this.hasSlotController.test("label"):this.withLabel,O=this.hasUpdated?this.hasSlotController.test("hint"):this.withHint,Y=this.label?!0:!!ee,te=this.hint?!0:!!O,ne=this.withClear&&!this.disabled&&!this.readonly,xe=this.hasUpdated&&ne&&(typeof this.value=="number"||this.value&&this.value.length>0);return x$1`
      <label part="form-control-label label" class="label" for="input" aria-hidden=${Y?"false":"true"}>
        <slot name="label">${this.label}</slot>
      </label>

      <div part="base" class="text-field">
        <slot name="start" part="start" class="start"></slot>

        <input
          part="input"
          id="input"
          class="control"
          type=${this.type==="password"&&this.passwordVisible?"text":this.type}
          title=${this.title}
          name=${o$6(this.name)}
          ?disabled=${this.disabled}
          ?readonly=${this.readonly}
          ?required=${this.required}
          placeholder=${o$6(this.placeholder)}
          minlength=${o$6(this.minlength)}
          maxlength=${o$6(this.maxlength)}
          min=${o$6(this.min)}
          max=${o$6(this.max)}
          step=${o$6(this.step)}
          .value=${l$1(this.value??"")}
          autocapitalize=${o$6(this.autocapitalize)}
          autocomplete=${o$6(this.autocomplete)}
          autocorrect=${o$6(this.autocorrect)}
          ?autofocus=${this.autofocus}
          spellcheck=${this.spellcheck}
          pattern=${o$6(this.pattern)}
          enterkeyhint=${o$6(this.enterkeyhint)}
          inputmode=${o$6(this.inputmode)}
          aria-describedby="hint"
          @change=${this.handleChange}
          @input=${this.handleInput}
          @keydown=${this.handleKeyDown}
        />

        ${xe?x$1`
              <button
                part="clear-button"
                class="clear"
                type="button"
                aria-label=${this.localize.term("clearEntry")}
                @click=${this.handleClearClick}
                tabindex="-1"
              >
                <slot name="clear-icon">
                  <wa-icon name="circle-xmark" library="system" variant="regular"></wa-icon>
                </slot>
              </button>
            `:""}
        ${this.passwordToggle&&!this.disabled?x$1`
              <button
                part="password-toggle-button"
                class="password-toggle"
                type="button"
                aria-label=${this.localize.term(this.passwordVisible?"hidePassword":"showPassword")}
                @click=${this.handlePasswordToggle}
                tabindex="-1"
              >
                ${this.passwordVisible?x$1`
                      <slot name="hide-password-icon">
                        <wa-icon name="eye-slash" library="system" variant="regular"></wa-icon>
                      </slot>
                    `:x$1`
                      <slot name="show-password-icon">
                        <wa-icon name="eye" library="system" variant="regular"></wa-icon>
                      </slot>
                    `}
              </button>
            `:""}

        <slot name="end" part="end" class="end"></slot>
      </div>

      <slot
        id="hint"
        part="hint"
        name="hint"
        class=${e$5({"has-slotted":te})}
        aria-hidden=${te?"false":"true"}
        >${this.hint}</slot
      >
    `}};WaInput.css=[size_default,form_control_default,input_default];WaInput.shadowRootOptions={...WebAwesomeFormAssociatedElement.shadowRootOptions,delegatesFocus:!0};__decorateClass$d([e$9("input")],WaInput.prototype,"input",2);__decorateClass$d([n$7()],WaInput.prototype,"title",2);__decorateClass$d([n$7({reflect:!0})],WaInput.prototype,"type",2);__decorateClass$d([r$6()],WaInput.prototype,"value",1);__decorateClass$d([n$7({attribute:"value",reflect:!0})],WaInput.prototype,"defaultValue",2);__decorateClass$d([n$7({reflect:!0})],WaInput.prototype,"size",2);__decorateClass$d([n$7({reflect:!0})],WaInput.prototype,"appearance",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaInput.prototype,"pill",2);__decorateClass$d([n$7()],WaInput.prototype,"label",2);__decorateClass$d([n$7({attribute:"hint"})],WaInput.prototype,"hint",2);__decorateClass$d([n$7({attribute:"with-clear",type:Boolean})],WaInput.prototype,"withClear",2);__decorateClass$d([n$7()],WaInput.prototype,"placeholder",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaInput.prototype,"readonly",2);__decorateClass$d([n$7({attribute:"password-toggle",type:Boolean})],WaInput.prototype,"passwordToggle",2);__decorateClass$d([n$7({attribute:"password-visible",type:Boolean})],WaInput.prototype,"passwordVisible",2);__decorateClass$d([n$7({attribute:"without-spin-buttons",type:Boolean})],WaInput.prototype,"withoutSpinButtons",2);__decorateClass$d([n$7({reflect:!0})],WaInput.prototype,"form",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaInput.prototype,"required",2);__decorateClass$d([n$7()],WaInput.prototype,"pattern",2);__decorateClass$d([n$7({type:Number})],WaInput.prototype,"minlength",2);__decorateClass$d([n$7({type:Number})],WaInput.prototype,"maxlength",2);__decorateClass$d([n$7()],WaInput.prototype,"min",2);__decorateClass$d([n$7()],WaInput.prototype,"max",2);__decorateClass$d([n$7()],WaInput.prototype,"step",2);__decorateClass$d([n$7()],WaInput.prototype,"autocapitalize",2);__decorateClass$d([n$7()],WaInput.prototype,"autocorrect",2);__decorateClass$d([n$7()],WaInput.prototype,"autocomplete",2);__decorateClass$d([n$7({type:Boolean})],WaInput.prototype,"autofocus",2);__decorateClass$d([n$7()],WaInput.prototype,"enterkeyhint",2);__decorateClass$d([n$7({type:Boolean,converter:{fromAttribute:ee=>!(!ee||ee==="false"),toAttribute:ee=>ee?"true":"false"}})],WaInput.prototype,"spellcheck",2);__decorateClass$d([n$7()],WaInput.prototype,"inputmode",2);__decorateClass$d([n$7({attribute:"with-label",type:Boolean})],WaInput.prototype,"withLabel",2);__decorateClass$d([n$7({attribute:"with-hint",type:Boolean})],WaInput.prototype,"withHint",2);__decorateClass$d([watch("step",{waitUntilFirstUpdate:!0})],WaInput.prototype,"handleStepChange",1);WaInput=__decorateClass$d([t$b("wa-input")],WaInput);var WaRepositionEvent=class extends Event{constructor(){super("wa-reposition",{bubbles:!0,cancelable:!1,composed:!0})}};const min$1=Math.min,max$1=Math.max,round$2=Math.round,floor$1=Math.floor,createCoords=ee=>({x:ee,y:ee}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp$2(ee,O,Y){return max$1(ee,min$1(O,Y))}function evaluate(ee,O){return typeof ee=="function"?ee(O):ee}function getSide(ee){return ee.split("-")[0]}function getAlignment(ee){return ee.split("-")[1]}function getOppositeAxis(ee){return ee==="x"?"y":"x"}function getAxisLength(ee){return ee==="y"?"height":"width"}const yAxisSides=new Set(["top","bottom"]);function getSideAxis(ee){return yAxisSides.has(getSide(ee))?"y":"x"}function getAlignmentAxis(ee){return getOppositeAxis(getSideAxis(ee))}function getAlignmentSides(ee,O,Y){Y===void 0&&(Y=!1);const te=getAlignment(ee),ne=getAlignmentAxis(ee),xe=getAxisLength(ne);let et=ne==="x"?te===(Y?"end":"start")?"right":"left":te==="start"?"bottom":"top";return O.reference[xe]>O.floating[xe]&&(et=getOppositePlacement(et)),[et,getOppositePlacement(et)]}function getExpandedPlacements(ee){const O=getOppositePlacement(ee);return[getOppositeAlignmentPlacement(ee),O,getOppositeAlignmentPlacement(O)]}function getOppositeAlignmentPlacement(ee){return ee.replace(/start|end/g,O=>oppositeAlignmentMap[O])}const lrPlacement=["left","right"],rlPlacement=["right","left"],tbPlacement=["top","bottom"],btPlacement=["bottom","top"];function getSideList(ee,O,Y){switch(ee){case"top":case"bottom":return Y?O?rlPlacement:lrPlacement:O?lrPlacement:rlPlacement;case"left":case"right":return O?tbPlacement:btPlacement;default:return[]}}function getOppositeAxisPlacements(ee,O,Y,te){const ne=getAlignment(ee);let xe=getSideList(getSide(ee),Y==="start",te);return ne&&(xe=xe.map(et=>et+"-"+ne),O&&(xe=xe.concat(xe.map(getOppositeAlignmentPlacement)))),xe}function getOppositePlacement(ee){return ee.replace(/left|right|bottom|top/g,O=>oppositeSideMap[O])}function expandPaddingObject(ee){return{top:0,right:0,bottom:0,left:0,...ee}}function getPaddingObject(ee){return typeof ee!="number"?expandPaddingObject(ee):{top:ee,right:ee,bottom:ee,left:ee}}function rectToClientRect(ee){const{x:O,y:Y,width:te,height:ne}=ee;return{width:te,height:ne,top:Y,left:O,right:O+te,bottom:Y+ne,x:O,y:Y}}function computeCoordsFromPlacement(ee,O,Y){let{reference:te,floating:ne}=ee;const xe=getSideAxis(O),et=getAlignmentAxis(O),tt=getAxisLength(et),it=getSide(O),st=xe==="y",ot=te.x+te.width/2-ne.width/2,rt=te.y+te.height/2-ne.height/2,nt=te[tt]/2-ne[tt]/2;let at;switch(it){case"top":at={x:ot,y:te.y-ne.height};break;case"bottom":at={x:ot,y:te.y+te.height};break;case"right":at={x:te.x+te.width,y:rt};break;case"left":at={x:te.x-ne.width,y:rt};break;default:at={x:te.x,y:te.y}}switch(getAlignment(O)){case"start":at[et]-=nt*(Y&&st?-1:1);break;case"end":at[et]+=nt*(Y&&st?-1:1);break}return at}const computePosition$1=async(ee,O,Y)=>{const{placement:te="bottom",strategy:ne="absolute",middleware:xe=[],platform:et}=Y,tt=xe.filter(Boolean),it=await(et.isRTL==null?void 0:et.isRTL(O));let st=await et.getElementRects({reference:ee,floating:O,strategy:ne}),{x:ot,y:rt}=computeCoordsFromPlacement(st,te,it),nt=te,at={},ct=0;for(let ut=0;ut<tt.length;ut++){const{name:dt,fn:ht}=tt[ut],{x:pt,y:ft,data:mt,reset:yt}=await ht({x:ot,y:rt,initialPlacement:te,placement:nt,strategy:ne,middlewareData:at,rects:st,platform:et,elements:{reference:ee,floating:O}});ot=pt??ot,rt=ft??rt,at={...at,[dt]:{...at[dt],...mt}},yt&&ct<=50&&(ct++,typeof yt=="object"&&(yt.placement&&(nt=yt.placement),yt.rects&&(st=yt.rects===!0?await et.getElementRects({reference:ee,floating:O,strategy:ne}):yt.rects),{x:ot,y:rt}=computeCoordsFromPlacement(st,nt,it)),ut=-1)}return{x:ot,y:rt,placement:nt,strategy:ne,middlewareData:at}};async function detectOverflow(ee,O){var Y;O===void 0&&(O={});const{x:te,y:ne,platform:xe,rects:et,elements:tt,strategy:it}=ee,{boundary:st="clippingAncestors",rootBoundary:ot="viewport",elementContext:rt="floating",altBoundary:nt=!1,padding:at=0}=evaluate(O,ee),ct=getPaddingObject(at),dt=tt[nt?rt==="floating"?"reference":"floating":rt],ht=rectToClientRect(await xe.getClippingRect({element:(Y=await(xe.isElement==null?void 0:xe.isElement(dt)))==null||Y?dt:dt.contextElement||await(xe.getDocumentElement==null?void 0:xe.getDocumentElement(tt.floating)),boundary:st,rootBoundary:ot,strategy:it})),pt=rt==="floating"?{x:te,y:ne,width:et.floating.width,height:et.floating.height}:et.reference,ft=await(xe.getOffsetParent==null?void 0:xe.getOffsetParent(tt.floating)),mt=await(xe.isElement==null?void 0:xe.isElement(ft))?await(xe.getScale==null?void 0:xe.getScale(ft))||{x:1,y:1}:{x:1,y:1},yt=rectToClientRect(xe.convertOffsetParentRelativeRectToViewportRelativeRect?await xe.convertOffsetParentRelativeRectToViewportRelativeRect({elements:tt,rect:pt,offsetParent:ft,strategy:it}):pt);return{top:(ht.top-yt.top+ct.top)/mt.y,bottom:(yt.bottom-ht.bottom+ct.bottom)/mt.y,left:(ht.left-yt.left+ct.left)/mt.x,right:(yt.right-ht.right+ct.right)/mt.x}}const arrow$1=ee=>({name:"arrow",options:ee,async fn(O){const{x:Y,y:te,placement:ne,rects:xe,platform:et,elements:tt,middlewareData:it}=O,{element:st,padding:ot=0}=evaluate(ee,O)||{};if(st==null)return{};const rt=getPaddingObject(ot),nt={x:Y,y:te},at=getAlignmentAxis(ne),ct=getAxisLength(at),ut=await et.getDimensions(st),dt=at==="y",ht=dt?"top":"left",pt=dt?"bottom":"right",ft=dt?"clientHeight":"clientWidth",mt=xe.reference[ct]+xe.reference[at]-nt[at]-xe.floating[ct],yt=nt[at]-xe.reference[at],bt=await(et.getOffsetParent==null?void 0:et.getOffsetParent(st));let vt=bt?bt[ft]:0;(!vt||!await(et.isElement==null?void 0:et.isElement(bt)))&&(vt=tt.floating[ft]||xe.floating[ct]);const Et=mt/2-yt/2,wt=vt/2-ut[ct]/2-1,St=min$1(rt[ht],wt),Ot=min$1(rt[pt],wt),$t=St,Mt=vt-ut[ct]-Ot,Nt=vt/2-ut[ct]/2+Et,Rt=clamp$2($t,Nt,Mt),Pt=!it.arrow&&getAlignment(ne)!=null&&Nt!==Rt&&xe.reference[ct]/2-(Nt<$t?St:Ot)-ut[ct]/2<0,kt=Pt?Nt<$t?Nt-$t:Nt-Mt:0;return{[at]:nt[at]+kt,data:{[at]:Rt,centerOffset:Nt-Rt-kt,...Pt&&{alignmentOffset:kt}},reset:Pt}}}),flip$1=function(ee){return ee===void 0&&(ee={}),{name:"flip",options:ee,async fn(O){var Y,te;const{placement:ne,middlewareData:xe,rects:et,initialPlacement:tt,platform:it,elements:st}=O,{mainAxis:ot=!0,crossAxis:rt=!0,fallbackPlacements:nt,fallbackStrategy:at="bestFit",fallbackAxisSideDirection:ct="none",flipAlignment:ut=!0,...dt}=evaluate(ee,O);if((Y=xe.arrow)!=null&&Y.alignmentOffset)return{};const ht=getSide(ne),pt=getSideAxis(tt),ft=getSide(tt)===tt,mt=await(it.isRTL==null?void 0:it.isRTL(st.floating)),yt=nt||(ft||!ut?[getOppositePlacement(tt)]:getExpandedPlacements(tt)),bt=ct!=="none";!nt&&bt&&yt.push(...getOppositeAxisPlacements(tt,ut,ct,mt));const vt=[tt,...yt],Et=await detectOverflow(O,dt),wt=[];let St=((te=xe.flip)==null?void 0:te.overflows)||[];if(ot&&wt.push(Et[ht]),rt){const Nt=getAlignmentSides(ne,et,mt);wt.push(Et[Nt[0]],Et[Nt[1]])}if(St=[...St,{placement:ne,overflows:wt}],!wt.every(Nt=>Nt<=0)){var Ot,$t;const Nt=(((Ot=xe.flip)==null?void 0:Ot.index)||0)+1,Rt=vt[Nt];if(Rt&&(!(rt==="alignment"?pt!==getSideAxis(Rt):!1)||St.every(Wt=>getSideAxis(Wt.placement)===pt?Wt.overflows[0]>0:!0)))return{data:{index:Nt,overflows:St},reset:{placement:Rt}};let Pt=($t=St.filter(kt=>kt.overflows[0]<=0).sort((kt,Wt)=>kt.overflows[1]-Wt.overflows[1])[0])==null?void 0:$t.placement;if(!Pt)switch(at){case"bestFit":{var Mt;const kt=(Mt=St.filter(Wt=>{if(bt){const zt=getSideAxis(Wt.placement);return zt===pt||zt==="y"}return!0}).map(Wt=>[Wt.placement,Wt.overflows.filter(zt=>zt>0).reduce((zt,Kt)=>zt+Kt,0)]).sort((Wt,zt)=>Wt[1]-zt[1])[0])==null?void 0:Mt[0];kt&&(Pt=kt);break}case"initialPlacement":Pt=tt;break}if(ne!==Pt)return{reset:{placement:Pt}}}return{}}}},originSides=new Set(["left","top"]);async function convertValueToCoords(ee,O){const{placement:Y,platform:te,elements:ne}=ee,xe=await(te.isRTL==null?void 0:te.isRTL(ne.floating)),et=getSide(Y),tt=getAlignment(Y),it=getSideAxis(Y)==="y",st=originSides.has(et)?-1:1,ot=xe&&it?-1:1,rt=evaluate(O,ee);let{mainAxis:nt,crossAxis:at,alignmentAxis:ct}=typeof rt=="number"?{mainAxis:rt,crossAxis:0,alignmentAxis:null}:{mainAxis:rt.mainAxis||0,crossAxis:rt.crossAxis||0,alignmentAxis:rt.alignmentAxis};return tt&&typeof ct=="number"&&(at=tt==="end"?ct*-1:ct),it?{x:at*ot,y:nt*st}:{x:nt*st,y:at*ot}}const offset$2=function(ee){return ee===void 0&&(ee=0),{name:"offset",options:ee,async fn(O){var Y,te;const{x:ne,y:xe,placement:et,middlewareData:tt}=O,it=await convertValueToCoords(O,ee);return et===((Y=tt.offset)==null?void 0:Y.placement)&&(te=tt.arrow)!=null&&te.alignmentOffset?{}:{x:ne+it.x,y:xe+it.y,data:{...it,placement:et}}}}},shift$1=function(ee){return ee===void 0&&(ee={}),{name:"shift",options:ee,async fn(O){const{x:Y,y:te,placement:ne}=O,{mainAxis:xe=!0,crossAxis:et=!1,limiter:tt={fn:dt=>{let{x:ht,y:pt}=dt;return{x:ht,y:pt}}},...it}=evaluate(ee,O),st={x:Y,y:te},ot=await detectOverflow(O,it),rt=getSideAxis(getSide(ne)),nt=getOppositeAxis(rt);let at=st[nt],ct=st[rt];if(xe){const dt=nt==="y"?"top":"left",ht=nt==="y"?"bottom":"right",pt=at+ot[dt],ft=at-ot[ht];at=clamp$2(pt,at,ft)}if(et){const dt=rt==="y"?"top":"left",ht=rt==="y"?"bottom":"right",pt=ct+ot[dt],ft=ct-ot[ht];ct=clamp$2(pt,ct,ft)}const ut=tt.fn({...O,[nt]:at,[rt]:ct});return{...ut,data:{x:ut.x-Y,y:ut.y-te,enabled:{[nt]:xe,[rt]:et}}}}}},size$1=function(ee){return ee===void 0&&(ee={}),{name:"size",options:ee,async fn(O){var Y,te;const{placement:ne,rects:xe,platform:et,elements:tt}=O,{apply:it=()=>{},...st}=evaluate(ee,O),ot=await detectOverflow(O,st),rt=getSide(ne),nt=getAlignment(ne),at=getSideAxis(ne)==="y",{width:ct,height:ut}=xe.floating;let dt,ht;rt==="top"||rt==="bottom"?(dt=rt,ht=nt===(await(et.isRTL==null?void 0:et.isRTL(tt.floating))?"start":"end")?"left":"right"):(ht=rt,dt=nt==="end"?"top":"bottom");const pt=ut-ot.top-ot.bottom,ft=ct-ot.left-ot.right,mt=min$1(ut-ot[dt],pt),yt=min$1(ct-ot[ht],ft),bt=!O.middlewareData.shift;let vt=mt,Et=yt;if((Y=O.middlewareData.shift)!=null&&Y.enabled.x&&(Et=ft),(te=O.middlewareData.shift)!=null&&te.enabled.y&&(vt=pt),bt&&!nt){const St=max$1(ot.left,0),Ot=max$1(ot.right,0),$t=max$1(ot.top,0),Mt=max$1(ot.bottom,0);at?Et=ct-2*(St!==0||Ot!==0?St+Ot:max$1(ot.left,ot.right)):vt=ut-2*($t!==0||Mt!==0?$t+Mt:max$1(ot.top,ot.bottom))}await it({...O,availableWidth:Et,availableHeight:vt});const wt=await et.getDimensions(tt.floating);return ct!==wt.width||ut!==wt.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(ee){return isNode(ee)?(ee.nodeName||"").toLowerCase():"#document"}function getWindow(ee){var O;return(ee==null||(O=ee.ownerDocument)==null?void 0:O.defaultView)||window}function getDocumentElement(ee){var O;return(O=(isNode(ee)?ee.ownerDocument:ee.document)||window.document)==null?void 0:O.documentElement}function isNode(ee){return hasWindow()?ee instanceof Node||ee instanceof getWindow(ee).Node:!1}function isElement(ee){return hasWindow()?ee instanceof Element||ee instanceof getWindow(ee).Element:!1}function isHTMLElement(ee){return hasWindow()?ee instanceof HTMLElement||ee instanceof getWindow(ee).HTMLElement:!1}function isShadowRoot(ee){return!hasWindow()||typeof ShadowRoot>"u"?!1:ee instanceof ShadowRoot||ee instanceof getWindow(ee).ShadowRoot}const invalidOverflowDisplayValues=new Set(["inline","contents"]);function isOverflowElement(ee){const{overflow:O,overflowX:Y,overflowY:te,display:ne}=getComputedStyle$1(ee);return/auto|scroll|overlay|hidden|clip/.test(O+te+Y)&&!invalidOverflowDisplayValues.has(ne)}const tableElements=new Set(["table","td","th"]);function isTableElement(ee){return tableElements.has(getNodeName(ee))}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(ee){return topLayerSelectors.some(O=>{try{return ee.matches(O)}catch{return!1}})}const transformProperties=["transform","translate","scale","rotate","perspective"],willChangeValues=["transform","translate","scale","rotate","perspective","filter"],containValues=["paint","layout","strict","content"];function isContainingBlock(ee){const O=isWebKit(),Y=isElement(ee)?getComputedStyle$1(ee):ee;return transformProperties.some(te=>Y[te]?Y[te]!=="none":!1)||(Y.containerType?Y.containerType!=="normal":!1)||!O&&(Y.backdropFilter?Y.backdropFilter!=="none":!1)||!O&&(Y.filter?Y.filter!=="none":!1)||willChangeValues.some(te=>(Y.willChange||"").includes(te))||containValues.some(te=>(Y.contain||"").includes(te))}function getContainingBlock(ee){let O=getParentNode(ee);for(;isHTMLElement(O)&&!isLastTraversableNode(O);){if(isContainingBlock(O))return O;if(isTopLayer(O))return null;O=getParentNode(O)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lastTraversableNodeNames=new Set(["html","body","#document"]);function isLastTraversableNode(ee){return lastTraversableNodeNames.has(getNodeName(ee))}function getComputedStyle$1(ee){return getWindow(ee).getComputedStyle(ee)}function getNodeScroll(ee){return isElement(ee)?{scrollLeft:ee.scrollLeft,scrollTop:ee.scrollTop}:{scrollLeft:ee.scrollX,scrollTop:ee.scrollY}}function getParentNode(ee){if(getNodeName(ee)==="html")return ee;const O=ee.assignedSlot||ee.parentNode||isShadowRoot(ee)&&ee.host||getDocumentElement(ee);return isShadowRoot(O)?O.host:O}function getNearestOverflowAncestor(ee){const O=getParentNode(ee);return isLastTraversableNode(O)?ee.ownerDocument?ee.ownerDocument.body:ee.body:isHTMLElement(O)&&isOverflowElement(O)?O:getNearestOverflowAncestor(O)}function getOverflowAncestors(ee,O,Y){var te;O===void 0&&(O=[]),Y===void 0&&(Y=!0);const ne=getNearestOverflowAncestor(ee),xe=ne===((te=ee.ownerDocument)==null?void 0:te.body),et=getWindow(ne);if(xe){const tt=getFrameElement(et);return O.concat(et,et.visualViewport||[],isOverflowElement(ne)?ne:[],tt&&Y?getOverflowAncestors(tt):[])}return O.concat(ne,getOverflowAncestors(ne,[],Y))}function getFrameElement(ee){return ee.parent&&Object.getPrototypeOf(ee.parent)?ee.frameElement:null}function getCssDimensions(ee){const O=getComputedStyle$1(ee);let Y=parseFloat(O.width)||0,te=parseFloat(O.height)||0;const ne=isHTMLElement(ee),xe=ne?ee.offsetWidth:Y,et=ne?ee.offsetHeight:te,tt=round$2(Y)!==xe||round$2(te)!==et;return tt&&(Y=xe,te=et),{width:Y,height:te,$:tt}}function unwrapElement(ee){return isElement(ee)?ee:ee.contextElement}function getScale$1(ee){const O=unwrapElement(ee);if(!isHTMLElement(O))return createCoords(1);const Y=O.getBoundingClientRect(),{width:te,height:ne,$:xe}=getCssDimensions(O);let et=(xe?round$2(Y.width):Y.width)/te,tt=(xe?round$2(Y.height):Y.height)/ne;return(!et||!Number.isFinite(et))&&(et=1),(!tt||!Number.isFinite(tt))&&(tt=1),{x:et,y:tt}}const noOffsets=createCoords(0);function getVisualOffsets(ee){const O=getWindow(ee);return!isWebKit()||!O.visualViewport?noOffsets:{x:O.visualViewport.offsetLeft,y:O.visualViewport.offsetTop}}function shouldAddVisualOffsets(ee,O,Y){return O===void 0&&(O=!1),!Y||O&&Y!==getWindow(ee)?!1:O}function getBoundingClientRect(ee,O,Y,te){O===void 0&&(O=!1),Y===void 0&&(Y=!1);const ne=ee.getBoundingClientRect(),xe=unwrapElement(ee);let et=createCoords(1);O&&(te?isElement(te)&&(et=getScale$1(te)):et=getScale$1(ee));const tt=shouldAddVisualOffsets(xe,Y,te)?getVisualOffsets(xe):createCoords(0);let it=(ne.left+tt.x)/et.x,st=(ne.top+tt.y)/et.y,ot=ne.width/et.x,rt=ne.height/et.y;if(xe){const nt=getWindow(xe),at=te&&isElement(te)?getWindow(te):te;let ct=nt,ut=getFrameElement(ct);for(;ut&&te&&at!==ct;){const dt=getScale$1(ut),ht=ut.getBoundingClientRect(),pt=getComputedStyle$1(ut),ft=ht.left+(ut.clientLeft+parseFloat(pt.paddingLeft))*dt.x,mt=ht.top+(ut.clientTop+parseFloat(pt.paddingTop))*dt.y;it*=dt.x,st*=dt.y,ot*=dt.x,rt*=dt.y,it+=ft,st+=mt,ct=getWindow(ut),ut=getFrameElement(ct)}}return rectToClientRect({width:ot,height:rt,x:it,y:st})}function getWindowScrollBarX(ee,O){const Y=getNodeScroll(ee).scrollLeft;return O?O.left+Y:getBoundingClientRect(getDocumentElement(ee)).left+Y}function getHTMLOffset(ee,O){const Y=ee.getBoundingClientRect(),te=Y.left+O.scrollLeft-getWindowScrollBarX(ee,Y),ne=Y.top+O.scrollTop;return{x:te,y:ne}}function convertOffsetParentRelativeRectToViewportRelativeRect(ee){let{elements:O,rect:Y,offsetParent:te,strategy:ne}=ee;const xe=ne==="fixed",et=getDocumentElement(te),tt=O?isTopLayer(O.floating):!1;if(te===et||tt&&xe)return Y;let it={scrollLeft:0,scrollTop:0},st=createCoords(1);const ot=createCoords(0),rt=isHTMLElement(te);if((rt||!rt&&!xe)&&((getNodeName(te)!=="body"||isOverflowElement(et))&&(it=getNodeScroll(te)),isHTMLElement(te))){const at=getBoundingClientRect(te);st=getScale$1(te),ot.x=at.x+te.clientLeft,ot.y=at.y+te.clientTop}const nt=et&&!rt&&!xe?getHTMLOffset(et,it):createCoords(0);return{width:Y.width*st.x,height:Y.height*st.y,x:Y.x*st.x-it.scrollLeft*st.x+ot.x+nt.x,y:Y.y*st.y-it.scrollTop*st.y+ot.y+nt.y}}function getClientRects(ee){return Array.from(ee.getClientRects())}function getDocumentRect(ee){const O=getDocumentElement(ee),Y=getNodeScroll(ee),te=ee.ownerDocument.body,ne=max$1(O.scrollWidth,O.clientWidth,te.scrollWidth,te.clientWidth),xe=max$1(O.scrollHeight,O.clientHeight,te.scrollHeight,te.clientHeight);let et=-Y.scrollLeft+getWindowScrollBarX(ee);const tt=-Y.scrollTop;return getComputedStyle$1(te).direction==="rtl"&&(et+=max$1(O.clientWidth,te.clientWidth)-ne),{width:ne,height:xe,x:et,y:tt}}const SCROLLBAR_MAX=25;function getViewportRect(ee,O){const Y=getWindow(ee),te=getDocumentElement(ee),ne=Y.visualViewport;let xe=te.clientWidth,et=te.clientHeight,tt=0,it=0;if(ne){xe=ne.width,et=ne.height;const ot=isWebKit();(!ot||ot&&O==="fixed")&&(tt=ne.offsetLeft,it=ne.offsetTop)}const st=getWindowScrollBarX(te);if(st<=0){const ot=te.ownerDocument,rt=ot.body,nt=getComputedStyle(rt),at=ot.compatMode==="CSS1Compat"&&parseFloat(nt.marginLeft)+parseFloat(nt.marginRight)||0,ct=Math.abs(te.clientWidth-rt.clientWidth-at);ct<=SCROLLBAR_MAX&&(xe-=ct)}else st<=SCROLLBAR_MAX&&(xe+=st);return{width:xe,height:et,x:tt,y:it}}const absoluteOrFixed=new Set(["absolute","fixed"]);function getInnerBoundingClientRect(ee,O){const Y=getBoundingClientRect(ee,!0,O==="fixed"),te=Y.top+ee.clientTop,ne=Y.left+ee.clientLeft,xe=isHTMLElement(ee)?getScale$1(ee):createCoords(1),et=ee.clientWidth*xe.x,tt=ee.clientHeight*xe.y,it=ne*xe.x,st=te*xe.y;return{width:et,height:tt,x:it,y:st}}function getClientRectFromClippingAncestor(ee,O,Y){let te;if(O==="viewport")te=getViewportRect(ee,Y);else if(O==="document")te=getDocumentRect(getDocumentElement(ee));else if(isElement(O))te=getInnerBoundingClientRect(O,Y);else{const ne=getVisualOffsets(ee);te={x:O.x-ne.x,y:O.y-ne.y,width:O.width,height:O.height}}return rectToClientRect(te)}function hasFixedPositionAncestor(ee,O){const Y=getParentNode(ee);return Y===O||!isElement(Y)||isLastTraversableNode(Y)?!1:getComputedStyle$1(Y).position==="fixed"||hasFixedPositionAncestor(Y,O)}function getClippingElementAncestors(ee,O){const Y=O.get(ee);if(Y)return Y;let te=getOverflowAncestors(ee,[],!1).filter(tt=>isElement(tt)&&getNodeName(tt)!=="body"),ne=null;const xe=getComputedStyle$1(ee).position==="fixed";let et=xe?getParentNode(ee):ee;for(;isElement(et)&&!isLastTraversableNode(et);){const tt=getComputedStyle$1(et),it=isContainingBlock(et);!it&&tt.position==="fixed"&&(ne=null),(xe?!it&&!ne:!it&&tt.position==="static"&&!!ne&&absoluteOrFixed.has(ne.position)||isOverflowElement(et)&&!it&&hasFixedPositionAncestor(ee,et))?te=te.filter(ot=>ot!==et):ne=tt,et=getParentNode(et)}return O.set(ee,te),te}function getClippingRect(ee){let{element:O,boundary:Y,rootBoundary:te,strategy:ne}=ee;const et=[...Y==="clippingAncestors"?isTopLayer(O)?[]:getClippingElementAncestors(O,this._c):[].concat(Y),te],tt=et[0],it=et.reduce((st,ot)=>{const rt=getClientRectFromClippingAncestor(O,ot,ne);return st.top=max$1(rt.top,st.top),st.right=min$1(rt.right,st.right),st.bottom=min$1(rt.bottom,st.bottom),st.left=max$1(rt.left,st.left),st},getClientRectFromClippingAncestor(O,tt,ne));return{width:it.right-it.left,height:it.bottom-it.top,x:it.left,y:it.top}}function getDimensions(ee){const{width:O,height:Y}=getCssDimensions(ee);return{width:O,height:Y}}function getRectRelativeToOffsetParent(ee,O,Y){const te=isHTMLElement(O),ne=getDocumentElement(O),xe=Y==="fixed",et=getBoundingClientRect(ee,!0,xe,O);let tt={scrollLeft:0,scrollTop:0};const it=createCoords(0);function st(){it.x=getWindowScrollBarX(ne)}if(te||!te&&!xe)if((getNodeName(O)!=="body"||isOverflowElement(ne))&&(tt=getNodeScroll(O)),te){const at=getBoundingClientRect(O,!0,xe,O);it.x=at.x+O.clientLeft,it.y=at.y+O.clientTop}else ne&&st();xe&&!te&&ne&&st();const ot=ne&&!te&&!xe?getHTMLOffset(ne,tt):createCoords(0),rt=et.left+tt.scrollLeft-it.x-ot.x,nt=et.top+tt.scrollTop-it.y-ot.y;return{x:rt,y:nt,width:et.width,height:et.height}}function isStaticPositioned(ee){return getComputedStyle$1(ee).position==="static"}function getTrueOffsetParent(ee,O){if(!isHTMLElement(ee)||getComputedStyle$1(ee).position==="fixed")return null;if(O)return O(ee);let Y=ee.offsetParent;return getDocumentElement(ee)===Y&&(Y=Y.ownerDocument.body),Y}function getOffsetParent(ee,O){const Y=getWindow(ee);if(isTopLayer(ee))return Y;if(!isHTMLElement(ee)){let ne=getParentNode(ee);for(;ne&&!isLastTraversableNode(ne);){if(isElement(ne)&&!isStaticPositioned(ne))return ne;ne=getParentNode(ne)}return Y}let te=getTrueOffsetParent(ee,O);for(;te&&isTableElement(te)&&isStaticPositioned(te);)te=getTrueOffsetParent(te,O);return te&&isLastTraversableNode(te)&&isStaticPositioned(te)&&!isContainingBlock(te)?Y:te||getContainingBlock(ee)||Y}const getElementRects=async function(ee){const O=this.getOffsetParent||getOffsetParent,Y=this.getDimensions,te=await Y(ee.floating);return{reference:getRectRelativeToOffsetParent(ee.reference,await O(ee.floating),ee.strategy),floating:{x:0,y:0,width:te.width,height:te.height}}};function isRTL(ee){return getComputedStyle$1(ee).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale:getScale$1,isElement,isRTL};function rectsAreEqual(ee,O){return ee.x===O.x&&ee.y===O.y&&ee.width===O.width&&ee.height===O.height}function observeMove(ee,O){let Y=null,te;const ne=getDocumentElement(ee);function xe(){var tt;clearTimeout(te),(tt=Y)==null||tt.disconnect(),Y=null}function et(tt,it){tt===void 0&&(tt=!1),it===void 0&&(it=1),xe();const st=ee.getBoundingClientRect(),{left:ot,top:rt,width:nt,height:at}=st;if(tt||O(),!nt||!at)return;const ct=floor$1(rt),ut=floor$1(ne.clientWidth-(ot+nt)),dt=floor$1(ne.clientHeight-(rt+at)),ht=floor$1(ot),ft={rootMargin:-ct+"px "+-ut+"px "+-dt+"px "+-ht+"px",threshold:max$1(0,min$1(1,it))||1};let mt=!0;function yt(bt){const vt=bt[0].intersectionRatio;if(vt!==it){if(!mt)return et();vt?et(!1,vt):te=setTimeout(()=>{et(!1,1e-7)},1e3)}vt===1&&!rectsAreEqual(st,ee.getBoundingClientRect())&&et(),mt=!1}try{Y=new IntersectionObserver(yt,{...ft,root:ne.ownerDocument})}catch{Y=new IntersectionObserver(yt,ft)}Y.observe(ee)}return et(!0),xe}function autoUpdate(ee,O,Y,te){te===void 0&&(te={});const{ancestorScroll:ne=!0,ancestorResize:xe=!0,elementResize:et=typeof ResizeObserver=="function",layoutShift:tt=typeof IntersectionObserver=="function",animationFrame:it=!1}=te,st=unwrapElement(ee),ot=ne||xe?[...st?getOverflowAncestors(st):[],...getOverflowAncestors(O)]:[];ot.forEach(ht=>{ne&&ht.addEventListener("scroll",Y,{passive:!0}),xe&&ht.addEventListener("resize",Y)});const rt=st&&tt?observeMove(st,Y):null;let nt=-1,at=null;et&&(at=new ResizeObserver(ht=>{let[pt]=ht;pt&&pt.target===st&&at&&(at.unobserve(O),cancelAnimationFrame(nt),nt=requestAnimationFrame(()=>{var ft;(ft=at)==null||ft.observe(O)})),Y()}),st&&!it&&at.observe(st),at.observe(O));let ct,ut=it?getBoundingClientRect(ee):null;it&&dt();function dt(){const ht=getBoundingClientRect(ee);ut&&!rectsAreEqual(ut,ht)&&Y(),ut=ht,ct=requestAnimationFrame(dt)}return Y(),()=>{var ht;ot.forEach(pt=>{ne&&pt.removeEventListener("scroll",Y),xe&&pt.removeEventListener("resize",Y)}),rt?.(),(ht=at)==null||ht.disconnect(),at=null,it&&cancelAnimationFrame(ct)}}const offset$1=offset$2,shift=shift$1,flip=flip$1,size=size$1,arrow=arrow$1,computePosition=(ee,O,Y)=>{const te=new Map,ne={platform,...Y},xe={...ne.platform,_c:te};return computePosition$1(ee,O,{...ne,platform:xe})};function e(ee){return i(ee)}function r(ee){return ee.assignedSlot?ee.assignedSlot:ee.parentNode instanceof ShadowRoot?ee.parentNode.host:ee.parentNode}function i(ee){for(let O=ee;O;O=r(O))if(O instanceof Element&&getComputedStyle(O).display==="none")return null;for(let O=r(ee);O;O=r(O)){if(!(O instanceof Element))continue;const Y=getComputedStyle(O);if(Y.display!=="contents"&&(Y.position!=="static"||isContainingBlock(Y)||O.tagName==="BODY"))return O}return null}var popup_default=`:host {
  --arrow-color: black;
  --arrow-size: var(--wa-tooltip-arrow-size);
  --show-duration: 100ms;
  --hide-duration: 100ms;

  /*
     * These properties are computed to account for the arrow's dimensions after being rotated 45. The constant
     * 0.7071 is derived from sin(45), which is the diagonal size of the arrow's container after rotating.
     */
  --arrow-size-diagonal: calc(var(--arrow-size) * 0.7071);
  --arrow-padding-offset: calc(var(--arrow-size-diagonal) - var(--arrow-size));

  display: contents;
}

.popup {
  position: absolute;
  isolation: isolate;
  max-width: var(--auto-size-available-width, none);
  max-height: var(--auto-size-available-height, none);

  /* Clear UA styles for [popover] */
  :where(&) {
    inset: unset;
    padding: unset;
    margin: unset;
    width: unset;
    height: unset;
    color: unset;
    background: unset;
    border: unset;
    overflow: unset;
  }
}

.popup-fixed {
  position: fixed;
}

.popup:not(.popup-active) {
  display: none;
}

.arrow {
  position: absolute;
  width: calc(var(--arrow-size-diagonal) * 2);
  height: calc(var(--arrow-size-diagonal) * 2);
  rotate: 45deg;
  background: var(--arrow-color);
  z-index: 3;
}

:host([data-current-placement~='left']) .arrow {
  rotate: -45deg;
}

:host([data-current-placement~='right']) .arrow {
  rotate: 135deg;
}

:host([data-current-placement~='bottom']) .arrow {
  rotate: 225deg;
}

/* Hover bridge */
.popup-hover-bridge:not(.popup-hover-bridge-visible) {
  display: none;
}

.popup-hover-bridge {
  position: fixed;
  z-index: 899;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  clip-path: polygon(
    var(--hover-bridge-top-left-x, 0) var(--hover-bridge-top-left-y, 0),
    var(--hover-bridge-top-right-x, 0) var(--hover-bridge-top-right-y, 0),
    var(--hover-bridge-bottom-right-x, 0) var(--hover-bridge-bottom-right-y, 0),
    var(--hover-bridge-bottom-left-x, 0) var(--hover-bridge-bottom-left-y, 0)
  );
}

/* Built-in animations */
.show {
  animation: show var(--show-duration) ease;
}

.hide {
  animation: show var(--hide-duration) ease reverse;
}

@keyframes show {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.show-with-scale {
  animation: show-with-scale var(--show-duration) ease;
}

.hide-with-scale {
  animation: show-with-scale var(--hide-duration) ease reverse;
}

@keyframes show-with-scale {
  from {
    opacity: 0;
    scale: 0.8;
  }
  to {
    opacity: 1;
    scale: 1;
  }
}
`;function isVirtualElement(ee){return ee!==null&&typeof ee=="object"&&"getBoundingClientRect"in ee&&("contextElement"in ee?ee instanceof Element:!0)}var SUPPORTS_POPOVER=globalThis?.HTMLElement?.prototype.hasOwnProperty("popover"),WaPopup=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.active=!1,this.placement="top",this.boundary="viewport",this.distance=0,this.skidding=0,this.arrow=!1,this.arrowPlacement="anchor",this.arrowPadding=10,this.flip=!1,this.flipFallbackPlacements="",this.flipFallbackStrategy="best-fit",this.flipPadding=0,this.shift=!1,this.shiftPadding=0,this.autoSizePadding=0,this.hoverBridge=!1,this.updateHoverBridge=()=>{if(this.hoverBridge&&this.anchorEl){const ee=this.anchorEl.getBoundingClientRect(),O=this.popup.getBoundingClientRect(),Y=this.placement.includes("top")||this.placement.includes("bottom");let te=0,ne=0,xe=0,et=0,tt=0,it=0,st=0,ot=0;Y?ee.top<O.top?(te=ee.left,ne=ee.bottom,xe=ee.right,et=ee.bottom,tt=O.left,it=O.top,st=O.right,ot=O.top):(te=O.left,ne=O.bottom,xe=O.right,et=O.bottom,tt=ee.left,it=ee.top,st=ee.right,ot=ee.top):ee.left<O.left?(te=ee.right,ne=ee.top,xe=O.left,et=O.top,tt=ee.right,it=ee.bottom,st=O.left,ot=O.bottom):(te=O.right,ne=O.top,xe=ee.left,et=ee.top,tt=O.right,it=O.bottom,st=ee.left,ot=ee.bottom),this.style.setProperty("--hover-bridge-top-left-x",`${te}px`),this.style.setProperty("--hover-bridge-top-left-y",`${ne}px`),this.style.setProperty("--hover-bridge-top-right-x",`${xe}px`),this.style.setProperty("--hover-bridge-top-right-y",`${et}px`),this.style.setProperty("--hover-bridge-bottom-left-x",`${tt}px`),this.style.setProperty("--hover-bridge-bottom-left-y",`${it}px`),this.style.setProperty("--hover-bridge-bottom-right-x",`${st}px`),this.style.setProperty("--hover-bridge-bottom-right-y",`${ot}px`)}}}async connectedCallback(){super.connectedCallback(),await this.updateComplete,this.start()}disconnectedCallback(){super.disconnectedCallback(),this.stop()}async updated(ee){super.updated(ee),ee.has("active")&&(this.active?this.start():this.stop()),ee.has("anchor")&&this.handleAnchorChange(),this.active&&(await this.updateComplete,this.reposition())}async handleAnchorChange(){if(await this.stop(),this.anchor&&typeof this.anchor=="string"){const ee=this.getRootNode();this.anchorEl=ee.getElementById(this.anchor)}else this.anchor instanceof Element||isVirtualElement(this.anchor)?this.anchorEl=this.anchor:this.anchorEl=this.querySelector('[slot="anchor"]');this.anchorEl instanceof HTMLSlotElement&&(this.anchorEl=this.anchorEl.assignedElements({flatten:!0})[0]),this.anchorEl&&this.start()}start(){!this.anchorEl||!this.active||(this.popup.showPopover?.(),this.cleanup=autoUpdate(this.anchorEl,this.popup,()=>{this.reposition()}))}async stop(){return new Promise(ee=>{this.popup.hidePopover?.(),this.cleanup?(this.cleanup(),this.cleanup=void 0,this.removeAttribute("data-current-placement"),this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height"),requestAnimationFrame(()=>ee())):ee()})}reposition(){if(!this.active||!this.anchorEl)return;const ee=[offset$1({mainAxis:this.distance,crossAxis:this.skidding})];this.sync?ee.push(size({apply:({rects:te})=>{const ne=this.sync==="width"||this.sync==="both",xe=this.sync==="height"||this.sync==="both";this.popup.style.width=ne?`${te.reference.width}px`:"",this.popup.style.height=xe?`${te.reference.height}px`:""}})):(this.popup.style.width="",this.popup.style.height="");let O;SUPPORTS_POPOVER&&!isVirtualElement(this.anchor)&&this.boundary==="scroll"&&(O=getOverflowAncestors(this.anchorEl).filter(te=>te instanceof Element)),this.flip&&ee.push(flip({boundary:this.flipBoundary||O,fallbackPlacements:this.flipFallbackPlacements,fallbackStrategy:this.flipFallbackStrategy==="best-fit"?"bestFit":"initialPlacement",padding:this.flipPadding})),this.shift&&ee.push(shift({boundary:this.shiftBoundary||O,padding:this.shiftPadding})),this.autoSize?ee.push(size({boundary:this.autoSizeBoundary||O,padding:this.autoSizePadding,apply:({availableWidth:te,availableHeight:ne})=>{this.autoSize==="vertical"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-height",`${ne}px`):this.style.removeProperty("--auto-size-available-height"),this.autoSize==="horizontal"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-width",`${te}px`):this.style.removeProperty("--auto-size-available-width")}})):(this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height")),this.arrow&&ee.push(arrow({element:this.arrowEl,padding:this.arrowPadding}));const Y=SUPPORTS_POPOVER?te=>platform.getOffsetParent(te,e):platform.getOffsetParent;computePosition(this.anchorEl,this.popup,{placement:this.placement,middleware:ee,strategy:SUPPORTS_POPOVER?"absolute":"fixed",platform:{...platform,getOffsetParent:Y}}).then(({x:te,y:ne,middlewareData:xe,placement:et})=>{const tt=this.localize.dir()==="rtl",it={top:"bottom",right:"left",bottom:"top",left:"right"}[et.split("-")[0]];if(this.setAttribute("data-current-placement",et),Object.assign(this.popup.style,{left:`${te}px`,top:`${ne}px`}),this.arrow){const st=xe.arrow.x,ot=xe.arrow.y;let rt="",nt="",at="",ct="";if(this.arrowPlacement==="start"){const ut=typeof st=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";rt=typeof ot=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"",nt=tt?ut:"",ct=tt?"":ut}else if(this.arrowPlacement==="end"){const ut=typeof st=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";nt=tt?"":ut,ct=tt?ut:"",at=typeof ot=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:""}else this.arrowPlacement==="center"?(ct=typeof st=="number"?"calc(50% - var(--arrow-size-diagonal))":"",rt=typeof ot=="number"?"calc(50% - var(--arrow-size-diagonal))":""):(ct=typeof st=="number"?`${st}px`:"",rt=typeof ot=="number"?`${ot}px`:"");Object.assign(this.arrowEl.style,{top:rt,right:nt,bottom:at,left:ct,[it]:"calc(var(--arrow-size-diagonal) * -1)"})}}),requestAnimationFrame(()=>this.updateHoverBridge()),this.dispatchEvent(new WaRepositionEvent)}render(){return x$1`
      <slot name="anchor" @slotchange=${this.handleAnchorChange}></slot>

      <span
        part="hover-bridge"
        class=${e$5({"popup-hover-bridge":!0,"popup-hover-bridge-visible":this.hoverBridge&&this.active})}
      ></span>

      <div
        popover="manual"
        part="popup"
        class=${e$5({popup:!0,"popup-active":this.active,"popup-fixed":!SUPPORTS_POPOVER,"popup-has-arrow":this.arrow})}
      >
        <slot></slot>
        ${this.arrow?x$1`<div part="arrow" class="arrow" role="presentation"></div>`:""}
      </div>
    `}};WaPopup.css=popup_default;__decorateClass$d([e$9(".popup")],WaPopup.prototype,"popup",2);__decorateClass$d([e$9(".arrow")],WaPopup.prototype,"arrowEl",2);__decorateClass$d([n$7()],WaPopup.prototype,"anchor",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaPopup.prototype,"active",2);__decorateClass$d([n$7({reflect:!0})],WaPopup.prototype,"placement",2);__decorateClass$d([n$7()],WaPopup.prototype,"boundary",2);__decorateClass$d([n$7({type:Number})],WaPopup.prototype,"distance",2);__decorateClass$d([n$7({type:Number})],WaPopup.prototype,"skidding",2);__decorateClass$d([n$7({type:Boolean})],WaPopup.prototype,"arrow",2);__decorateClass$d([n$7({attribute:"arrow-placement"})],WaPopup.prototype,"arrowPlacement",2);__decorateClass$d([n$7({attribute:"arrow-padding",type:Number})],WaPopup.prototype,"arrowPadding",2);__decorateClass$d([n$7({type:Boolean})],WaPopup.prototype,"flip",2);__decorateClass$d([n$7({attribute:"flip-fallback-placements",converter:{fromAttribute:ee=>ee.split(" ").map(O=>O.trim()).filter(O=>O!==""),toAttribute:ee=>ee.join(" ")}})],WaPopup.prototype,"flipFallbackPlacements",2);__decorateClass$d([n$7({attribute:"flip-fallback-strategy"})],WaPopup.prototype,"flipFallbackStrategy",2);__decorateClass$d([n$7({type:Object})],WaPopup.prototype,"flipBoundary",2);__decorateClass$d([n$7({attribute:"flip-padding",type:Number})],WaPopup.prototype,"flipPadding",2);__decorateClass$d([n$7({type:Boolean})],WaPopup.prototype,"shift",2);__decorateClass$d([n$7({type:Object})],WaPopup.prototype,"shiftBoundary",2);__decorateClass$d([n$7({attribute:"shift-padding",type:Number})],WaPopup.prototype,"shiftPadding",2);__decorateClass$d([n$7({attribute:"auto-size"})],WaPopup.prototype,"autoSize",2);__decorateClass$d([n$7()],WaPopup.prototype,"sync",2);__decorateClass$d([n$7({type:Object})],WaPopup.prototype,"autoSizeBoundary",2);__decorateClass$d([n$7({attribute:"auto-size-padding",type:Number})],WaPopup.prototype,"autoSizePadding",2);__decorateClass$d([n$7({attribute:"hover-bridge",type:Boolean})],WaPopup.prototype,"hoverBridge",2);WaPopup=__decorateClass$d([t$b("wa-popup")],WaPopup);var comparison_default=`:host {
  --divider-width: 0.125rem;
  --handle-size: 2.5rem;

  display: block;
  position: relative;
  max-width: 100%;
  max-height: 100%;
  overflow: hidden;
}

.before,
.after {
  display: block;

  &::slotted(img),
  &::slotted(svg) {
    display: block;
    max-width: 100% !important;
    height: auto;
  }

  &::slotted(:not(img, svg)) {
    isolation: isolate;
  }
}

.after {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
}

/* Disable pointer-events while dragging. This is especially important for iframes. */
:host(:state(dragging)) {
  .before,
  .after {
    pointer-events: none;
  }
}

.divider {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  width: var(--divider-width);
  height: 100%;
  background-color: var(--wa-color-surface-default);
  translate: calc(var(--divider-width) / -2);
  cursor: ew-resize;
}

.handle {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: calc(50% - (var(--handle-size) / 2));
  width: var(--handle-size);
  height: var(--handle-size);
  background-color: var(--wa-color-surface-default);
  border-radius: var(--wa-border-radius-circle);
  font-size: calc(var(--handle-size) * 0.4);
  color: var(--wa-color-neutral-on-quiet);
  cursor: inherit;
  z-index: 10;
}

.handle:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}
`,WaComparison=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.position=50}handleDrag(ee){const{width:O}=this.getBoundingClientRect(),Y=this.localize.dir()==="rtl";ee.preventDefault(),drag(this,{onMove:te=>{this.customStates.set("dragging",!0),this.position=parseFloat(clamp$3(te/O*100,0,100).toFixed(2)),Y&&(this.position=100-this.position)},onStop:()=>{this.customStates.set("dragging",!1)},initialEvent:ee})}handleKeyDown(ee){const O=this.matches(":dir(ltr)"),Y=this.localize.dir()==="rtl";if(["ArrowLeft","ArrowRight","Home","End"].includes(ee.key)){const te=ee.shiftKey?10:1;let ne=this.position;ee.preventDefault(),(O&&ee.key==="ArrowLeft"||Y&&ee.key==="ArrowRight")&&(ne-=te),(O&&ee.key==="ArrowRight"||Y&&ee.key==="ArrowLeft")&&(ne+=te),ee.key==="Home"&&(ne=0),ee.key==="End"&&(ne=100),ne=clamp$3(ne,0,100),this.position=ne}}handlePositionChange(){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}render(){const ee=this.hasUpdated?this.localize.dir()==="rtl":this.dir==="rtl";return x$1`
      <div id="comparison" class="image" part="base">
        <div part="before" class="before">
          <slot name="before"></slot>
        </div>

        <div
          part="after"
          class="after"
          style=${o$7({clipPath:ee?`inset(0 0 0 ${100-this.position}%)`:`inset(0 ${100-this.position}% 0 0)`})}
        >
          <slot name="after"></slot>
        </div>
      </div>

      <div
        part="divider"
        class="divider"
        style=${o$7({left:ee?`${100-this.position}%`:`${this.position}%`})}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleDrag}
        @touchstart=${this.handleDrag}
      >
        <div
          part="handle"
          class="handle"
          role="scrollbar"
          aria-valuenow=${this.position}
          aria-valuemin="0"
          aria-valuemax="100"
          aria-controls="comparison"
          tabindex="0"
        >
          <slot name="handle">
            <wa-icon library="system" name="grip-vertical" variant="solid"></wa-icon>
          </slot>
        </div>
      </div>
    `}};WaComparison.css=comparison_default;__decorateClass$d([e$9(".handle")],WaComparison.prototype,"handle",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaComparison.prototype,"position",2);__decorateClass$d([watch("position",{waitUntilFirstUpdate:!0})],WaComparison.prototype,"handlePositionChange",1);WaComparison=__decorateClass$d([t$b("wa-comparison")],WaComparison);var WaCopyEvent=class extends Event{constructor(ee){super("wa-copy",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},copy_button_default=`:host {
  display: inline-block;
  color: var(--wa-color-neutral-on-quiet);
}

.button {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  background-color: transparent;
  border: none;
  border-radius: var(--wa-form-control-border-radius);
  color: inherit;
  font-size: inherit;
  padding: 0.5em;
  cursor: pointer;
  transition: color var(--wa-transition-fast) var(--wa-transition-easing);
}

@media (hover: hover) {
  .button:hover:not([disabled]) {
    background-color: var(--wa-color-neutral-fill-quiet);
    color: color-mix(in oklab, currentColor, var(--wa-color-mix-hover));
  }
}

.button:focus-visible:not([disabled]) {
  background-color: var(--wa-color-neutral-fill-quiet);
  color: color-mix(in oklab, currentColor, var(--wa-color-mix-hover));
}

.button:active:not([disabled]) {
  color: color-mix(in oklab, currentColor, var(--wa-color-mix-active));
}

slot[name='success-icon'] {
  color: var(--wa-color-success-on-quiet);
}

slot[name='error-icon'] {
  color: var(--wa-color-danger-on-quiet);
}

.button:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

.button[disabled] {
  opacity: 0.5;
  cursor: not-allowed !important;
}

slot {
  display: inline-flex;
}

.show {
  animation: show 100ms ease;
}

.hide {
  animation: show 100ms ease reverse;
}

@keyframes show {
  from {
    scale: 0.25;
    opacity: 0.25;
  }
  to {
    scale: 1;
    opacity: 1;
  }
}
`,WaCopyButton=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.isCopying=!1,this.status="rest",this.value="",this.from="",this.disabled=!1,this.copyLabel="",this.successLabel="",this.errorLabel="",this.feedbackDuration=1e3,this.tooltipPlacement="top"}get currentLabel(){return this.status==="success"?this.successLabel||this.localize.term("copied"):this.status==="error"?this.errorLabel||this.localize.term("error"):this.copyLabel||this.localize.term("copy")}async handleCopy(){if(this.disabled||this.isCopying)return;this.isCopying=!0;let ee=this.value;if(this.from){const O=this.getRootNode(),Y=this.from.includes("."),te=this.from.includes("[")&&this.from.includes("]");let ne=this.from,xe="";Y?[ne,xe]=this.from.trim().split("."):te&&([ne,xe]=this.from.trim().replace(/\]$/,"").split("["));const et="getElementById"in O?O.getElementById(ne):null;et?te?ee=et.getAttribute(xe)||"":Y?ee=et[xe]||"":ee=et.textContent||"":(this.showStatus("error"),this.dispatchEvent(new WaErrorEvent))}if(!ee)this.showStatus("error"),this.dispatchEvent(new WaErrorEvent);else try{await navigator.clipboard.writeText(ee),this.showStatus("success"),this.dispatchEvent(new WaCopyEvent({value:ee}))}catch{this.showStatus("error"),this.dispatchEvent(new WaErrorEvent)}}async showStatus(ee){const O=ee==="success"?this.successIcon:this.errorIcon;await animateWithClass(this.copyIcon,"hide"),this.copyIcon.hidden=!0,this.status=ee,O.hidden=!1,await animateWithClass(O,"show"),setTimeout(async()=>{await animateWithClass(O,"hide"),O.hidden=!0,this.status="rest",this.copyIcon.hidden=!1,await animateWithClass(this.copyIcon,"show"),this.isCopying=!1},this.feedbackDuration)}render(){return x$1`
      <button
        class="button"
        part="button"
        type="button"
        id="copy-button"
        ?disabled=${this.disabled}
        @click=${this.handleCopy}
      >
        <!-- Render a visually hidden label to appease the accessibility checking gods -->
        <span class="wa-visually-hidden">${this.currentLabel}</span>
        <slot part="copy-icon" name="copy-icon">
          <wa-icon library="system" name="copy" variant="regular"></wa-icon>
        </slot>
        <slot part="success-icon" name="success-icon" variant="solid" hidden>
          <wa-icon library="system" name="check"></wa-icon>
        </slot>
        <slot part="error-icon" name="error-icon" variant="solid" hidden>
          <wa-icon library="system" name="xmark"></wa-icon>
        </slot>
        <wa-tooltip
          class=${e$5({"copy-button":!0,"copy-button-success":this.status==="success","copy-button-error":this.status==="error"})}
          for="copy-button"
          placement=${this.tooltipPlacement}
          ?disabled=${this.disabled}
          exportparts="
            base:tooltip__base,
            base__popup:tooltip__base__popup,
            base__arrow:tooltip__base__arrow,
            body:tooltip__body
          "
          >${this.currentLabel}</wa-tooltip
        >
      </button>
    `}};WaCopyButton.css=[visually_hidden_default,copy_button_default];__decorateClass$d([e$9('slot[name="copy-icon"]')],WaCopyButton.prototype,"copyIcon",2);__decorateClass$d([e$9('slot[name="success-icon"]')],WaCopyButton.prototype,"successIcon",2);__decorateClass$d([e$9('slot[name="error-icon"]')],WaCopyButton.prototype,"errorIcon",2);__decorateClass$d([e$9("wa-tooltip")],WaCopyButton.prototype,"tooltip",2);__decorateClass$d([r$6()],WaCopyButton.prototype,"isCopying",2);__decorateClass$d([r$6()],WaCopyButton.prototype,"status",2);__decorateClass$d([n$7()],WaCopyButton.prototype,"value",2);__decorateClass$d([n$7()],WaCopyButton.prototype,"from",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaCopyButton.prototype,"disabled",2);__decorateClass$d([n$7({attribute:"copy-label"})],WaCopyButton.prototype,"copyLabel",2);__decorateClass$d([n$7({attribute:"success-label"})],WaCopyButton.prototype,"successLabel",2);__decorateClass$d([n$7({attribute:"error-label"})],WaCopyButton.prototype,"errorLabel",2);__decorateClass$d([n$7({attribute:"feedback-duration",type:Number})],WaCopyButton.prototype,"feedbackDuration",2);__decorateClass$d([n$7({attribute:"tooltip-placement"})],WaCopyButton.prototype,"tooltipPlacement",2);WaCopyButton=__decorateClass$d([t$b("wa-copy-button")],WaCopyButton);var WaAfterHideEvent=class extends Event{constructor(){super("wa-after-hide",{bubbles:!0,cancelable:!1,composed:!0})}},WaAfterShowEvent=class extends Event{constructor(){super("wa-after-show",{bubbles:!0,cancelable:!1,composed:!0})}},WaHideEvent=class extends Event{constructor(ee){super("wa-hide",{bubbles:!0,cancelable:!0,composed:!0}),this.detail=ee}},WaShowEvent=class extends Event{constructor(){super("wa-show",{bubbles:!0,cancelable:!0,composed:!0})}};var tooltip_default=`:host {
  --max-width: 30ch;

  /** These styles are added so we don't interfere in the DOM. */
  display: inline-block;
  position: absolute;

  /** Defaults for inherited CSS properties */
  color: var(--wa-tooltip-content-color);
  font-size: var(--wa-tooltip-font-size);
  line-height: var(--wa-tooltip-line-height);
  text-align: start;
  white-space: normal;
}

.tooltip {
  --arrow-size: var(--wa-tooltip-arrow-size);
  --arrow-color: var(--wa-tooltip-background-color);
}

.tooltip::part(popup) {
  z-index: 1000;
}

.tooltip[placement^='top']::part(popup) {
  transform-origin: bottom;
}

.tooltip[placement^='bottom']::part(popup) {
  transform-origin: top;
}

.tooltip[placement^='left']::part(popup) {
  transform-origin: right;
}

.tooltip[placement^='right']::part(popup) {
  transform-origin: left;
}

.body {
  display: block;
  width: max-content;
  max-width: var(--max-width);
  border-radius: var(--wa-tooltip-border-radius);
  background-color: var(--wa-tooltip-background-color);
  border: var(--wa-tooltip-border-width) var(--wa-tooltip-border-style) var(--wa-tooltip-border-color);
  padding: 0.25em 0.5em;
  user-select: none;
  -webkit-user-select: none;
}

.tooltip::part(arrow) {
  border-bottom: var(--wa-tooltip-border-width) var(--wa-tooltip-border-style) var(--wa-tooltip-border-color);
  border-right: var(--wa-tooltip-border-width) var(--wa-tooltip-border-style) var(--wa-tooltip-border-color);
}
`,WaTooltip=class extends WebAwesomeElement{constructor(){super(...arguments),this.placement="top",this.disabled=!1,this.distance=8,this.open=!1,this.skidding=0,this.showDelay=150,this.hideDelay=0,this.trigger="hover focus",this.withoutArrow=!1,this.for=null,this.anchor=null,this.eventController=new AbortController,this.handleBlur=()=>{this.hasTrigger("focus")&&this.hide()},this.handleClick=()=>{this.hasTrigger("click")&&(this.open?this.hide():this.show())},this.handleFocus=()=>{this.hasTrigger("focus")&&this.show()},this.handleDocumentKeyDown=ee=>{ee.key==="Escape"&&(ee.stopPropagation(),this.hide())},this.handleMouseOver=()=>{this.hasTrigger("hover")&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>this.show(),this.showDelay))},this.handleMouseOut=()=>{this.hasTrigger("hover")&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>this.hide(),this.hideDelay))}}connectedCallback(){super.connectedCallback(),this.eventController.signal.aborted&&(this.eventController=new AbortController),this.open&&(this.open=!1,this.updateComplete.then(()=>{this.open=!0})),this.id||(this.id=uniqueId("wa-tooltip-")),this.for&&this.anchor?(this.anchor=null,this.handleForChange()):this.for&&this.handleForChange()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this.handleDocumentKeyDown),this.eventController.abort(),this.anchor&&this.removeFromAriaLabelledBy(this.anchor,this.id)}firstUpdated(){this.body.hidden=!this.open,this.open&&(this.popup.active=!0,this.popup.reposition())}hasTrigger(ee){return this.trigger.split(" ").includes(ee)}addToAriaLabelledBy(ee,O){const te=(ee.getAttribute("aria-labelledby")||"").split(/\s+/).filter(Boolean);te.includes(O)||(te.push(O),ee.setAttribute("aria-labelledby",te.join(" ")))}removeFromAriaLabelledBy(ee,O){const ne=(ee.getAttribute("aria-labelledby")||"").split(/\s+/).filter(Boolean).filter(xe=>xe!==O);ne.length>0?ee.setAttribute("aria-labelledby",ne.join(" ")):ee.removeAttribute("aria-labelledby")}async handleOpenChange(){if(this.open){if(this.disabled)return;const ee=new WaShowEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}document.addEventListener("keydown",this.handleDocumentKeyDown,{signal:this.eventController.signal}),this.body.hidden=!1,this.popup.active=!0,await animateWithClass(this.popup.popup,"show-with-scale"),this.popup.reposition(),this.dispatchEvent(new WaAfterShowEvent)}else{const ee=new WaHideEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}document.removeEventListener("keydown",this.handleDocumentKeyDown),await animateWithClass(this.popup.popup,"hide-with-scale"),this.popup.active=!1,this.body.hidden=!0,this.dispatchEvent(new WaAfterHideEvent)}}handleForChange(){const ee=this.getRootNode();if(!ee)return;const O=this.for?ee.getElementById(this.for):null,Y=this.anchor;if(O===Y)return;const{signal:te}=this.eventController;O&&(this.addToAriaLabelledBy(O,this.id),O.addEventListener("blur",this.handleBlur,{capture:!0,signal:te}),O.addEventListener("focus",this.handleFocus,{capture:!0,signal:te}),O.addEventListener("click",this.handleClick,{signal:te}),O.addEventListener("mouseover",this.handleMouseOver,{signal:te}),O.addEventListener("mouseout",this.handleMouseOut,{signal:te})),Y&&(this.removeFromAriaLabelledBy(Y,this.id),Y.removeEventListener("blur",this.handleBlur,{capture:!0}),Y.removeEventListener("focus",this.handleFocus,{capture:!0}),Y.removeEventListener("click",this.handleClick),Y.removeEventListener("mouseover",this.handleMouseOver),Y.removeEventListener("mouseout",this.handleMouseOut)),this.anchor=O}async handleOptionsChange(){this.hasUpdated&&(await this.updateComplete,this.popup.reposition())}handleDisabledChange(){this.disabled&&this.open&&this.hide()}async show(){if(!this.open)return this.open=!0,waitForEvent(this,"wa-after-show")}async hide(){if(this.open)return this.open=!1,waitForEvent(this,"wa-after-hide")}render(){return x$1`
      <wa-popup
        part="base"
        exportparts="
          popup:base__popup,
          arrow:base__arrow
        "
        class=${e$5({tooltip:!0,"tooltip-open":this.open})}
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        flip
        shift
        ?arrow=${!this.withoutArrow}
        hover-bridge
        .anchor=${this.anchor}
      >
        <div part="body" class="body">
          <slot></slot>
        </div>
      </wa-popup>
    `}};WaTooltip.css=tooltip_default;WaTooltip.dependencies={"wa-popup":WaPopup};__decorateClass$d([e$9("slot:not([name])")],WaTooltip.prototype,"defaultSlot",2);__decorateClass$d([e$9(".body")],WaTooltip.prototype,"body",2);__decorateClass$d([e$9("wa-popup")],WaTooltip.prototype,"popup",2);__decorateClass$d([n$7()],WaTooltip.prototype,"placement",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTooltip.prototype,"disabled",2);__decorateClass$d([n$7({type:Number})],WaTooltip.prototype,"distance",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTooltip.prototype,"open",2);__decorateClass$d([n$7({type:Number})],WaTooltip.prototype,"skidding",2);__decorateClass$d([n$7({attribute:"show-delay",type:Number})],WaTooltip.prototype,"showDelay",2);__decorateClass$d([n$7({attribute:"hide-delay",type:Number})],WaTooltip.prototype,"hideDelay",2);__decorateClass$d([n$7()],WaTooltip.prototype,"trigger",2);__decorateClass$d([n$7({attribute:"without-arrow",type:Boolean,reflect:!0})],WaTooltip.prototype,"withoutArrow",2);__decorateClass$d([n$7()],WaTooltip.prototype,"for",2);__decorateClass$d([r$6()],WaTooltip.prototype,"anchor",2);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaTooltip.prototype,"handleOpenChange",1);__decorateClass$d([watch("for")],WaTooltip.prototype,"handleForChange",1);__decorateClass$d([watch(["distance","placement","skidding"])],WaTooltip.prototype,"handleOptionsChange",1);__decorateClass$d([watch("disabled")],WaTooltip.prototype,"handleDisabledChange",1);WaTooltip=__decorateClass$d([t$b("wa-tooltip")],WaTooltip);var details_default=`:host {
  --spacing: var(--wa-space-m);
  --show-duration: 200ms;
  --hide-duration: 200ms;

  display: block;
}

details {
  display: block;
  overflow-anchor: none;
  border: var(--wa-panel-border-width) var(--wa-color-surface-border) var(--wa-panel-border-style);
  background-color: var(--wa-color-surface-default);
  border-radius: var(--wa-panel-border-radius);
  color: var(--wa-color-text-normal);

  /* Print styles */
  @media print {
    background: none;
    border: solid var(--wa-border-width-s) var(--wa-color-surface-border);

    summary {
      list-style: none;
    }
  }
}

/* Appearance modifiers */
:host([appearance='plain']) details {
  background-color: transparent;
  border-color: transparent;
  border-radius: 0;
}

:host([appearance='outlined']) details {
  background-color: var(--wa-color-surface-default);
  border-color: var(--wa-color-surface-border);
}

:host([appearance='filled']) details {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: transparent;
}

:host([appearance='filled-outlined']) details {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-color-neutral-border-quiet);
}

:host([disabled]) details {
  opacity: 0.5;
  cursor: not-allowed;
}

summary {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing);
  padding: var(--spacing); /* Add padding here */
  border-radius: calc(var(--wa-panel-border-radius) - var(--wa-panel-border-width));
  user-select: none;
  -webkit-user-select: none;
  cursor: pointer;

  &::marker,
  &::-webkit-details-marker {
    display: none;
  }

  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--wa-focus-ring);
    outline-offset: calc(var(--wa-panel-border-width) + var(--wa-focus-ring-offset));
  }
}

:host([open]) summary {
  border-end-start-radius: 0;
  border-end-end-radius: 0;
}

/* 'Start' icon placement */
:host([icon-placement='start']) summary {
  flex-direction: row-reverse;
  justify-content: start;
}

[part~='icon'] {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  color: var(--wa-color-text-quiet);
  transition: rotate var(--wa-transition-normal) var(--wa-transition-easing);
}

:host([open]) [part~='icon'] {
  rotate: 90deg;
}

:host([open]:dir(rtl)) [part~='icon'] {
  rotate: -90deg;
}

:host([open]) slot[name='expand-icon'],
:host(:not([open])) slot[name='collapse-icon'] {
  display: none;
}

.body.animating {
  overflow: hidden;
}

.content {
  display: block;
  padding-block-start: var(--spacing);
  padding-inline: var(--spacing); /* Add horizontal padding */
  padding-block-end: var(--spacing); /* Add bottom padding */
}
`,WaDetails=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.isAnimating=!1,this.open=!1,this.disabled=!1,this.appearance="outlined",this.iconPlacement="end"}disconnectedCallback(){super.disconnectedCallback(),this.detailsObserver?.disconnect()}firstUpdated(){this.body.style.height=this.open?"auto":"0",this.open&&(this.details.open=!0),this.detailsObserver=new MutationObserver(ee=>{for(const O of ee)O.type==="attributes"&&O.attributeName==="open"&&(this.details.open?this.show():this.hide())}),this.detailsObserver.observe(this.details,{attributes:!0})}updated(ee){ee.has("isAnimating")&&this.customStates.set("animating",this.isAnimating)}handleSummaryClick(ee){ee.composedPath().some(te=>{if(!(te instanceof HTMLElement))return!1;const ne=te.tagName?.toLowerCase();return["a","button","input","textarea","select"].includes(ne)?!0:te instanceof WebAwesomeFormAssociatedElement?!("disabled"in te)||!te.disabled:!1})||(ee.preventDefault(),this.disabled||(this.open?this.hide():this.show(),this.header.focus()))}handleSummaryKeyDown(ee){(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),this.open?this.hide():this.show()),(ee.key==="ArrowUp"||ee.key==="ArrowLeft")&&(ee.preventDefault(),this.hide()),(ee.key==="ArrowDown"||ee.key==="ArrowRight")&&(ee.preventDefault(),this.show())}closeOthersWithSameName(){if(!this.name)return;this.getRootNode().querySelectorAll(`wa-details[name="${this.name}"]`).forEach(Y=>{Y!==this&&Y.open&&(Y.open=!1)})}async handleOpenChange(){if(this.open){this.details.open=!0;const ee=new WaShowEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1,this.details.open=!1;return}this.closeOthersWithSameName(),this.isAnimating=!0;const O=parseDuration(getComputedStyle(this.body).getPropertyValue("--show-duration"));await animate(this.body,[{height:"0",opacity:"0"},{height:`${this.body.scrollHeight}px`,opacity:"1"}],{duration:O,easing:"linear"}),this.body.style.height="auto",this.isAnimating=!1,this.dispatchEvent(new WaAfterShowEvent)}else{const ee=new WaHideEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.details.open=!0,this.open=!0;return}this.isAnimating=!0;const O=parseDuration(getComputedStyle(this.body).getPropertyValue("--hide-duration"));await animate(this.body,[{height:`${this.body.scrollHeight}px`,opacity:"1"},{height:"0",opacity:"0"}],{duration:O,easing:"linear"}),this.body.style.height="auto",this.isAnimating=!1,this.details.open=!1,this.dispatchEvent(new WaAfterHideEvent)}}async show(){if(!(this.open||this.disabled))return this.open=!0,waitForEvent(this,"wa-after-show")}async hide(){if(!(!this.open||this.disabled))return this.open=!1,waitForEvent(this,"wa-after-hide")}render(){const ee=this.hasUpdated?this.localize.dir()==="rtl":this.dir==="rtl";return x$1`
      <details part="base">
        <summary
          part="header"
          role="button"
          aria-expanded=${this.open?"true":"false"}
          aria-controls="content"
          aria-disabled=${this.disabled?"true":"false"}
          tabindex=${this.disabled?"-1":"0"}
          @click=${this.handleSummaryClick}
          @keydown=${this.handleSummaryKeyDown}
        >
          <slot name="summary" part="summary">${this.summary}</slot>

          <span part="icon">
            <slot name="expand-icon">
              <wa-icon library="system" variant="solid" name=${ee?"chevron-left":"chevron-right"}></wa-icon>
            </slot>
            <slot name="collapse-icon">
              <wa-icon library="system" variant="solid" name=${ee?"chevron-left":"chevron-right"}></wa-icon>
            </slot>
          </span>
        </summary>

        <div
          class=${e$5({body:!0,animating:this.isAnimating})}
          role="region"
          aria-labelledby="header"
        >
          <slot part="content" id="content" class="content"></slot>
        </div>
      </details>
    `}};WaDetails.css=details_default;__decorateClass$d([e$9("details")],WaDetails.prototype,"details",2);__decorateClass$d([e$9("summary")],WaDetails.prototype,"header",2);__decorateClass$d([e$9(".body")],WaDetails.prototype,"body",2);__decorateClass$d([e$9(".expand-icon-slot")],WaDetails.prototype,"expandIconSlot",2);__decorateClass$d([r$6()],WaDetails.prototype,"isAnimating",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDetails.prototype,"open",2);__decorateClass$d([n$7()],WaDetails.prototype,"summary",2);__decorateClass$d([n$7({reflect:!0})],WaDetails.prototype,"name",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDetails.prototype,"disabled",2);__decorateClass$d([n$7({reflect:!0})],WaDetails.prototype,"appearance",2);__decorateClass$d([n$7({attribute:"icon-placement",reflect:!0})],WaDetails.prototype,"iconPlacement",2);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaDetails.prototype,"handleOpenChange",1);WaDetails=__decorateClass$d([t$b("wa-details")],WaDetails);function getOffset(ee,O){return{top:Math.round(ee.getBoundingClientRect().top-O.getBoundingClientRect().top),left:Math.round(ee.getBoundingClientRect().left-O.getBoundingClientRect().left)}}var locks=new Set;function getScrollbarWidth(){const ee=document.documentElement.clientWidth;return Math.abs(window.innerWidth-ee)}function getExistingBodyPadding(){const ee=Number(getComputedStyle(document.body).paddingRight.replace(/px/,""));return isNaN(ee)||!ee?0:ee}function lockBodyScrolling(ee){if(locks.add(ee),!document.documentElement.classList.contains("wa-scroll-lock")){const O=getScrollbarWidth()+getExistingBodyPadding();let Y=getComputedStyle(document.documentElement).scrollbarGutter;(!Y||Y==="auto")&&(Y="stable"),O<2&&(Y=""),document.documentElement.style.setProperty("--wa-scroll-lock-gutter",Y),document.documentElement.classList.add("wa-scroll-lock"),document.documentElement.style.setProperty("--wa-scroll-lock-size",`${O}px`)}}function unlockBodyScrolling(ee){locks.delete(ee),locks.size===0&&(document.documentElement.classList.remove("wa-scroll-lock"),document.documentElement.style.removeProperty("--wa-scroll-lock-size"))}function scrollIntoView(ee,O,Y="vertical",te="smooth"){const ne=getOffset(ee,O),xe=ne.top+O.scrollTop,et=ne.left+O.scrollLeft,tt=O.scrollLeft,it=O.scrollLeft+O.offsetWidth,st=O.scrollTop,ot=O.scrollTop+O.offsetHeight;(Y==="horizontal"||Y==="both")&&(et<tt?O.scrollTo({left:et,behavior:te}):et+ee.clientWidth>it&&O.scrollTo({left:et-O.offsetWidth+ee.clientWidth,behavior:te})),(Y==="vertical"||Y==="both")&&(xe<st?O.scrollTo({top:xe,behavior:te}):xe+ee.clientHeight>ot&&O.scrollTo({top:xe-O.offsetHeight+ee.clientHeight,behavior:te}))}function parseSpaceDelimitedTokens(ee){return ee.split(" ").map(O=>O.trim()).filter(O=>O!=="")}var dialog_default=`:host {
  --width: 31rem;
  --spacing: var(--wa-space-l);
  --show-duration: 200ms;
  --hide-duration: 200ms;

  display: none;
}

:host([open]) {
  display: block;
}

.dialog {
  display: flex;
  flex-direction: column;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: var(--width);
  max-width: calc(100% - var(--wa-space-2xl));
  max-height: calc(100% - var(--wa-space-2xl));
  background-color: var(--wa-color-surface-raised);
  border-radius: var(--wa-panel-border-radius);
  border: none;
  box-shadow: var(--wa-shadow-l);
  padding: 0;
  margin: auto;

  &.show {
    animation: show-dialog var(--show-duration) ease;

    &::backdrop {
      animation: show-backdrop var(--show-duration, 200ms) ease;
    }
  }

  &.hide {
    animation: show-dialog var(--hide-duration) ease reverse;

    &::backdrop {
      animation: show-backdrop var(--hide-duration, 200ms) ease reverse;
    }
  }

  &.pulse {
    animation: pulse 250ms ease;
  }
}

.dialog:focus {
  outline: none;
}

/* Ensure there's enough vertical padding for phones that don't update vh when chrome appears (e.g. iPhone) */
@media screen and (max-width: 420px) {
  .dialog {
    max-height: 80vh;
  }
}

.open {
  display: flex;
  opacity: 1;
}

.header {
  flex: 0 0 auto;
  display: flex;
  flex-wrap: nowrap;

  padding-inline-start: var(--spacing);
  padding-block-end: 0;

  /* Subtract the close button's padding so that the X is visually aligned with the edges of the dialog content */
  padding-inline-end: calc(var(--spacing) - var(--wa-form-control-padding-block));
  padding-block-start: calc(var(--spacing) - var(--wa-form-control-padding-block));
}

.title {
  align-self: center;
  flex: 1 1 auto;
  font-family: inherit;
  font-size: var(--wa-font-size-l);
  font-weight: var(--wa-font-weight-heading);
  line-height: var(--wa-line-height-condensed);
  margin: 0;
}

.header-actions {
  align-self: start;
  display: flex;
  flex-shrink: 0;
  flex-wrap: wrap;
  justify-content: end;
  gap: var(--wa-space-2xs);
  padding-inline-start: var(--spacing);
}

.header-actions wa-button,
.header-actions ::slotted(wa-button) {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
}

.body {
  flex: 1 1 auto;
  display: block;
  padding: var(--spacing);
  overflow: auto;
  -webkit-overflow-scrolling: touch;

  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--wa-focus-ring);
    outline-offset: var(--wa-focus-ring-offset);
  }
}

.footer {
  flex: 0 0 auto;
  display: flex;
  flex-wrap: wrap;
  gap: var(--wa-space-xs);
  justify-content: end;
  padding: var(--spacing);
  padding-block-start: 0;
}

.footer ::slotted(wa-button:not(:first-of-type)) {
  margin-inline-start: var(--wa-spacing-xs);
}

.dialog::backdrop {
  /*
    NOTE: the ::backdrop element doesn't inherit properly in Safari yet, but it will in 17.4! At that time, we can
    remove the fallback values here.
  */
  background-color: var(--wa-color-overlay-modal, rgb(0 0 0 / 0.25));
}

@keyframes pulse {
  0% {
    scale: 1;
  }
  50% {
    scale: 1.02;
  }
  100% {
    scale: 1;
  }
}

@keyframes show-dialog {
  from {
    opacity: 0;
    scale: 0.8;
  }
  to {
    opacity: 1;
    scale: 1;
  }
}

@keyframes show-backdrop {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@media (forced-colors: active) {
  .dialog {
    border: solid 1px white;
  }
}
`,WaDialog=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.hasSlotController=new HasSlotController(this,"footer","header-actions","label"),this.open=!1,this.label="",this.withoutHeader=!1,this.lightDismiss=!1,this.handleDocumentKeyDown=ee=>{ee.key==="Escape"&&this.open&&(ee.preventDefault(),ee.stopPropagation(),this.requestClose(this.dialog))}}firstUpdated(){this.open&&(this.addOpenListeners(),this.dialog.showModal(),lockBodyScrolling(this))}disconnectedCallback(){super.disconnectedCallback(),unlockBodyScrolling(this),this.removeOpenListeners()}async requestClose(ee){const O=new WaHideEvent({source:ee});if(this.dispatchEvent(O),O.defaultPrevented){this.open=!0,animateWithClass(this.dialog,"pulse");return}this.removeOpenListeners(),await animateWithClass(this.dialog,"hide"),this.open=!1,this.dialog.close(),unlockBodyScrolling(this);const Y=this.originalTrigger;typeof Y?.focus=="function"&&setTimeout(()=>Y.focus()),this.dispatchEvent(new WaAfterHideEvent)}addOpenListeners(){document.addEventListener("keydown",this.handleDocumentKeyDown)}removeOpenListeners(){document.removeEventListener("keydown",this.handleDocumentKeyDown)}handleDialogCancel(ee){ee.preventDefault(),!this.dialog.classList.contains("hide")&&ee.target===this.dialog&&this.requestClose(this.dialog)}handleDialogClick(ee){const Y=ee.target.closest('[data-dialog="close"]');Y&&(ee.stopPropagation(),this.requestClose(Y))}async handleDialogPointerDown(ee){ee.target===this.dialog&&(this.lightDismiss?this.requestClose(this.dialog):await animateWithClass(this.dialog,"pulse"))}handleOpenChange(){this.open&&!this.dialog.open?this.show():!this.open&&this.dialog.open&&(this.open=!0,this.requestClose(this.dialog))}async show(){const ee=new WaShowEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}this.addOpenListeners(),this.originalTrigger=document.activeElement,this.open=!0,this.dialog.showModal(),lockBodyScrolling(this),requestAnimationFrame(()=>{const O=this.querySelector("[autofocus]");O&&typeof O.focus=="function"?O.focus():this.dialog.focus()}),await animateWithClass(this.dialog,"show"),this.dispatchEvent(new WaAfterShowEvent)}render(){const ee=!this.withoutHeader,O=this.hasSlotController.test("footer");return x$1`
      <dialog
        part="dialog"
        class=${e$5({dialog:!0,open:this.open})}
        @cancel=${this.handleDialogCancel}
        @click=${this.handleDialogClick}
        @pointerdown=${this.handleDialogPointerDown}
      >
        ${ee?x$1`
              <header part="header" class="header">
                <h2 part="title" class="title" id="title">
                  <!-- If there's no label, use an invisible character to prevent the header from collapsing -->
                  <slot name="label"> ${this.label.length>0?this.label:""} </slot>
                </h2>
                <div part="header-actions" class="header-actions">
                  <slot name="header-actions"></slot>
                  <wa-button
                    part="close-button"
                    exportparts="base:close-button__base"
                    class="close"
                    appearance="plain"
                    @click="${Y=>this.requestClose(Y.target)}"
                  >
                    <wa-icon
                      name="xmark"
                      label=${this.localize.term("close")}
                      library="system"
                      variant="solid"
                    ></wa-icon>
                  </wa-button>
                </div>
              </header>
            `:""}

        <div part="body" class="body"><slot></slot></div>

        ${O?x$1`
              <footer part="footer" class="footer">
                <slot name="footer"></slot>
              </footer>
            `:""}
      </dialog>
    `}};WaDialog.css=dialog_default;__decorateClass$d([e$9(".dialog")],WaDialog.prototype,"dialog",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDialog.prototype,"open",2);__decorateClass$d([n$7({reflect:!0})],WaDialog.prototype,"label",2);__decorateClass$d([n$7({attribute:"without-header",type:Boolean,reflect:!0})],WaDialog.prototype,"withoutHeader",2);__decorateClass$d([n$7({attribute:"light-dismiss",type:Boolean})],WaDialog.prototype,"lightDismiss",2);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaDialog.prototype,"handleOpenChange",1);WaDialog=__decorateClass$d([t$b("wa-dialog")],WaDialog);document.addEventListener("click",ee=>{const O=ee.target.closest("[data-dialog]");if(O instanceof Element){const[Y,te]=parseSpaceDelimitedTokens(O.getAttribute("data-dialog")||"");if(Y==="open"&&te?.length){const xe=O.getRootNode().getElementById(te);xe?.localName==="wa-dialog"?xe.open=!0:console.warn(`A dialog with an ID of "${te}" could not be found in this document.`)}}});document.addEventListener("pointerdown",()=>{});var divider_default=`:host {
  --color: var(--wa-color-surface-border);
  --width: var(--wa-border-width-s);
  --spacing: var(--wa-space-m);
}

:host(:not([orientation='vertical'])) {
  display: block;
  border-top: solid var(--width) var(--color);
  margin: var(--spacing) 0;
}

:host([orientation='vertical']) {
  display: inline-block;
  height: 100%;
  border-inline-start: solid var(--width) var(--color);
  margin: 0 var(--spacing);
  min-block-size: 1lh;
}
`,WaDivider=class extends WebAwesomeElement{constructor(){super(...arguments),this.orientation="horizontal"}connectedCallback(){super.connectedCallback(),this.setAttribute("role","separator")}handleVerticalChange(){this.setAttribute("aria-orientation",this.orientation)}};WaDivider.css=divider_default;__decorateClass$d([n$7({reflect:!0})],WaDivider.prototype,"orientation",2);__decorateClass$d([watch("orientation")],WaDivider.prototype,"handleVerticalChange",1);WaDivider=__decorateClass$d([t$b("wa-divider")],WaDivider);var drawer_default=`:host {
  --size: 25rem;
  --spacing: var(--wa-space-l);
  --show-duration: 200ms;
  --hide-duration: 200ms;

  display: none;
}

:host([open]) {
  display: block;
}

.drawer {
  display: flex;
  flex-direction: column;
  top: 0;
  inset-inline-start: 0;
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
  overflow: hidden;
  background-color: var(--wa-color-surface-raised);
  border: none;
  box-shadow: var(--wa-shadow-l);
  overflow: auto;
  padding: 0;
  margin: 0;
  animation-duration: var(--show-duration);
  animation-timing-function: ease;

  &.show::backdrop {
    animation: show-backdrop var(--show-duration, 200ms) ease;
  }

  &.hide::backdrop {
    animation: show-backdrop var(--hide-duration, 200ms) ease reverse;
  }

  &.show.top {
    animation: show-drawer-from-top var(--show-duration) ease;
  }

  &.hide.top {
    animation: show-drawer-from-top var(--hide-duration) ease reverse;
  }

  &.show.end {
    animation: show-drawer-from-end var(--show-duration) ease;

    &:dir(rtl) {
      animation-name: show-drawer-from-start;
    }
  }

  &.hide.end {
    animation: show-drawer-from-end var(--hide-duration) ease reverse;

    &:dir(rtl) {
      animation-name: show-drawer-from-start;
    }
  }

  &.show.bottom {
    animation: show-drawer-from-bottom var(--show-duration) ease;
  }

  &.hide.bottom {
    animation: show-drawer-from-bottom var(--hide-duration) ease reverse;
  }

  &.show.start {
    animation: show-drawer-from-start var(--show-duration) ease;

    &:dir(rtl) {
      animation-name: show-drawer-from-end;
    }
  }

  &.hide.start {
    animation: show-drawer-from-start var(--hide-duration) ease reverse;

    &:dir(rtl) {
      animation-name: show-drawer-from-end;
    }
  }

  &.pulse {
    animation: pulse 250ms ease;
  }
}

.drawer:focus {
  outline: none;
}

.top {
  top: 0;
  inset-inline-end: auto;
  bottom: auto;
  inset-inline-start: 0;
  width: 100%;
  height: var(--size);
}

.end {
  top: 0;
  inset-inline-end: 0;
  bottom: auto;
  inset-inline-start: auto;
  width: var(--size);
  height: 100%;
}

.bottom {
  top: auto;
  inset-inline-end: auto;
  bottom: 0;
  inset-inline-start: 0;
  width: 100%;
  height: var(--size);
}

.start {
  top: 0;
  inset-inline-end: auto;
  bottom: auto;
  inset-inline-start: 0;
  width: var(--size);
  height: 100%;
}

.header {
  display: flex;
  flex-wrap: nowrap;
  padding-inline-start: var(--spacing);
  padding-block-end: 0;

  /* Subtract the close button's padding so that the X is visually aligned with the edges of the dialog content */
  padding-inline-end: calc(var(--spacing) - var(--wa-form-control-padding-block));
  padding-block-start: calc(var(--spacing) - var(--wa-form-control-padding-block));
}

.title {
  align-self: center;
  flex: 1 1 auto;
  font: inherit;
  font-size: var(--wa-font-size-l);
  font-weight: var(--wa-font-weight-heading);
  line-height: var(--wa-line-height-condensed);
  margin: 0;
}

.header-actions {
  align-self: start;
  display: flex;
  flex-shrink: 0;
  flex-wrap: wrap;
  justify-content: end;
  gap: var(--wa-space-2xs);
  padding-inline-start: var(--spacing);
}

.header-actions wa-button,
.header-actions ::slotted(wa-button) {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
}

.body {
  flex: 1 1 auto;
  display: block;
  padding: var(--spacing);
  overflow: auto;
  -webkit-overflow-scrolling: touch;

  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--wa-focus-ring);
    outline-offset: var(--wa-focus-ring-offset);
  }
}

.footer {
  display: flex;
  flex-wrap: wrap;
  gap: var(--wa-space-xs);
  justify-content: end;
  padding: var(--spacing);
  padding-block-start: 0;
}

.footer ::slotted(wa-button:not(:last-of-type)) {
  margin-inline-end: var(--wa-spacing-xs);
}

.drawer::backdrop {
  /*
      NOTE: the ::backdrop element doesn't inherit properly in Safari yet, but it will in 17.4! At that time, we can
      remove the fallback values here.
    */
  background-color: var(--wa-color-overlay-modal, rgb(0 0 0 / 0.25));
}

@keyframes pulse {
  0% {
    scale: 1;
  }
  50% {
    scale: 1.01;
  }
  100% {
    scale: 1;
  }
}

@keyframes show-drawer {
  from {
    opacity: 0;
    scale: 0.8;
  }
  to {
    opacity: 1;
    scale: 1;
  }
}

@keyframes show-drawer-from-top {
  from {
    opacity: 0;
    translate: 0 -100%;
  }
  to {
    opacity: 1;
    translate: 0 0;
  }
}

@keyframes show-drawer-from-end {
  from {
    opacity: 0;
    translate: 100%;
  }
  to {
    opacity: 1;
    translate: 0 0;
  }
}

@keyframes show-drawer-from-bottom {
  from {
    opacity: 0;
    translate: 0 100%;
  }
  to {
    opacity: 1;
    translate: 0 0;
  }
}

@keyframes show-drawer-from-start {
  from {
    opacity: 0;
    translate: -100% 0;
  }
  to {
    opacity: 1;
    translate: 0 0;
  }
}

@keyframes show-backdrop {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@media (forced-colors: active) {
  .drawer {
    border: solid 1px white;
  }
}
`,WaDrawer=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.hasSlotController=new HasSlotController(this,"footer","header-actions","label"),this.open=!1,this.label="",this.placement="end",this.withoutHeader=!1,this.lightDismiss=!0,this.handleDocumentKeyDown=ee=>{ee.key==="Escape"&&this.open&&(ee.preventDefault(),ee.stopPropagation(),this.requestClose(this.drawer))}}firstUpdated(){this.open&&(this.addOpenListeners(),this.drawer.showModal(),lockBodyScrolling(this))}disconnectedCallback(){super.disconnectedCallback(),unlockBodyScrolling(this),this.removeOpenListeners()}async requestClose(ee){const O=new WaHideEvent({source:ee});if(this.dispatchEvent(O),O.defaultPrevented){this.open=!0,animateWithClass(this.drawer,"pulse");return}this.removeOpenListeners(),await animateWithClass(this.drawer,"hide"),this.open=!1,this.drawer.close(),unlockBodyScrolling(this);const Y=this.originalTrigger;typeof Y?.focus=="function"&&setTimeout(()=>Y.focus()),this.dispatchEvent(new WaAfterHideEvent)}addOpenListeners(){document.addEventListener("keydown",this.handleDocumentKeyDown)}removeOpenListeners(){document.removeEventListener("keydown",this.handleDocumentKeyDown)}handleDialogCancel(ee){ee.preventDefault(),!this.drawer.classList.contains("hide")&&ee.target===this.drawer&&this.requestClose(this.drawer)}handleDialogClick(ee){const Y=ee.target.closest('[data-drawer="close"]');Y&&(ee.stopPropagation(),this.requestClose(Y))}async handleDialogPointerDown(ee){ee.target===this.drawer&&(this.lightDismiss?this.requestClose(this.drawer):await animateWithClass(this.drawer,"pulse"))}handleOpenChange(){this.open&&!this.drawer.open?this.show():this.drawer.open&&(this.open=!0,this.requestClose(this.drawer))}async show(){const ee=new WaShowEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}this.addOpenListeners(),this.originalTrigger=document.activeElement,this.open=!0,this.drawer.showModal(),lockBodyScrolling(this),requestAnimationFrame(()=>{const O=this.querySelector("[autofocus]");O&&typeof O.focus=="function"?O.focus():this.drawer.focus()}),await animateWithClass(this.drawer,"show"),this.dispatchEvent(new WaAfterShowEvent)}render(){const ee=!this.withoutHeader,O=this.hasSlotController.test("footer");return x$1`
      <dialog
        part="dialog"
        class=${e$5({drawer:!0,open:this.open,top:this.placement==="top",end:this.placement==="end",bottom:this.placement==="bottom",start:this.placement==="start"})}
        @cancel=${this.handleDialogCancel}
        @click=${this.handleDialogClick}
        @pointerdown=${this.handleDialogPointerDown}
      >
        ${ee?x$1`
              <header part="header" class="header">
                <h2 part="title" class="title" id="title">
                  <!-- If there's no label, use an invisible character to prevent the header from collapsing -->
                  <slot name="label"> ${this.label.length>0?this.label:""} </slot>
                </h2>
                <div part="header-actions" class="header-actions">
                  <slot name="header-actions"></slot>
                  <wa-button
                    part="close-button"
                    exportparts="base:close-button__base"
                    class="close"
                    appearance="plain"
                    @click="${Y=>this.requestClose(Y.target)}"
                  >
                    <wa-icon
                      name="xmark"
                      label=${this.localize.term("close")}
                      library="system"
                      variant="solid"
                    ></wa-icon>
                  </wa-button>
                </div>
              </header>
            `:""}

        <div part="body" class="body"><slot></slot></div>

        ${O?x$1`
              <footer part="footer" class="footer">
                <slot name="footer"></slot>
              </footer>
            `:""}
      </dialog>
    `}};WaDrawer.css=drawer_default;__decorateClass$d([e$9(".drawer")],WaDrawer.prototype,"drawer",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDrawer.prototype,"open",2);__decorateClass$d([n$7({reflect:!0})],WaDrawer.prototype,"label",2);__decorateClass$d([n$7({reflect:!0})],WaDrawer.prototype,"placement",2);__decorateClass$d([n$7({attribute:"without-header",type:Boolean,reflect:!0})],WaDrawer.prototype,"withoutHeader",2);__decorateClass$d([n$7({attribute:"light-dismiss",type:Boolean})],WaDrawer.prototype,"lightDismiss",2);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaDrawer.prototype,"handleOpenChange",1);WaDrawer=__decorateClass$d([t$b("wa-drawer")],WaDrawer);document.addEventListener("click",ee=>{const O=ee.target.closest("[data-drawer]");if(O instanceof Element){const[Y,te]=parseSpaceDelimitedTokens(O.getAttribute("data-drawer")||"");if(Y==="open"&&te?.length){const xe=O.getRootNode().getElementById(te);xe?.localName==="wa-drawer"?xe.open=!0:console.warn(`A drawer with an ID of "${te}" could not be found in this document.`)}}});document.body.addEventListener("pointerdown",()=>{});var WaSelectEvent=class extends Event{constructor(ee){super("wa-select",{bubbles:!0,cancelable:!0,composed:!0}),this.detail=ee}};function*activeElements(ee=document.activeElement){ee!=null&&(yield ee,"shadowRoot"in ee&&ee.shadowRoot&&ee.shadowRoot.mode!=="closed"&&(yield*activeElements(ee.shadowRoot.activeElement)))}var dropdown_default=`:host {
  --show-duration: 50ms;
  --hide-duration: 50ms;
  display: contents;
}

#menu {
  display: flex;
  flex-direction: column;
  width: max-content;
  margin: 0;
  padding: 0.25em;
  border: var(--wa-border-style) var(--wa-border-width-s) var(--wa-color-surface-border);
  border-radius: var(--wa-border-radius-m);
  background-color: var(--wa-color-surface-raised);
  box-shadow: var(--wa-shadow-m);
  color: var(--wa-color-text-normal);
  text-align: start;
  user-select: none;
  overflow: auto;
  max-width: var(--auto-size-available-width) !important;
  max-height: var(--auto-size-available-height) !important;

  &.show {
    animation: show var(--show-duration) ease;
  }

  &.hide {
    animation: show var(--hide-duration) ease reverse;
  }

  ::slotted(h1),
  ::slotted(h2),
  ::slotted(h3),
  ::slotted(h4),
  ::slotted(h5),
  ::slotted(h6) {
    display: block !important;
    margin: 0.25em 0 !important;
    padding: 0.25em 0.75em !important;
    color: var(--wa-color-text-quiet) !important;
    font-family: var(--wa-font-family-body) !important;
    font-weight: var(--wa-font-weight-semibold) !important;
    font-size: var(--wa-font-size-smaller) !important;
  }

  ::slotted(wa-divider) {
    --spacing: 0.25em; /* Component-specific, left as-is */
  }
}

wa-popup[data-current-placement^='top'] #menu {
  transform-origin: bottom;
}

wa-popup[data-current-placement^='bottom'] #menu {
  transform-origin: top;
}

wa-popup[data-current-placement^='left'] #menu {
  transform-origin: right;
}

wa-popup[data-current-placement^='right'] #menu {
  transform-origin: left;
}

wa-popup[data-current-placement='left-start'] #menu {
  transform-origin: right top;
}

wa-popup[data-current-placement='left-end'] #menu {
  transform-origin: right bottom;
}

wa-popup[data-current-placement='right-start'] #menu {
  transform-origin: left top;
}

wa-popup[data-current-placement='right-end'] #menu {
  transform-origin: left bottom;
}

@keyframes show {
  from {
    scale: 0.9;
    opacity: 0;
  }
  to {
    scale: 1;
    opacity: 1;
  }
}
`,openDropdowns=new Set,WaDropdown=class extends WebAwesomeElement{constructor(){super(...arguments),this.submenuCleanups=new Map,this.localize=new LocalizeController(this),this.userTypedQuery="",this.openSubmenuStack=[],this.open=!1,this.size="medium",this.placement="bottom-start",this.distance=0,this.skidding=0,this.handleDocumentKeyDown=async ee=>{const O=this.localize.dir()==="rtl";if(ee.key==="Escape"){const ot=this.getTrigger();ee.preventDefault(),ee.stopPropagation(),this.open=!1,ot?.focus();return}const Y=[...activeElements()].find(ot=>ot.localName==="wa-dropdown-item"),te=Y?.localName==="wa-dropdown-item",ne=this.getCurrentSubmenuItem(),xe=!!ne;let et,tt,it;xe?(et=this.getSubmenuItems(ne),tt=et.find(ot=>ot.active||ot===Y),it=tt?et.indexOf(tt):-1):(et=this.getItems(),tt=et.find(ot=>ot.active||ot===Y),it=tt?et.indexOf(tt):-1);let st;if(ee.key==="ArrowUp"&&(ee.preventDefault(),ee.stopPropagation(),it>0?st=et[it-1]:st=et[et.length-1]),ee.key==="ArrowDown"&&(ee.preventDefault(),ee.stopPropagation(),it!==-1&&it<et.length-1?st=et[it+1]:st=et[0]),ee.key===(O?"ArrowLeft":"ArrowRight")&&te&&tt&&tt.hasSubmenu){ee.preventDefault(),ee.stopPropagation(),tt.submenuOpen=!0,this.addToSubmenuStack(tt),setTimeout(()=>{const ot=this.getSubmenuItems(tt);ot.length>0&&(ot.forEach((rt,nt)=>rt.active=nt===0),ot[0].focus())},0);return}if(ee.key===(O?"ArrowRight":"ArrowLeft")&&xe){ee.preventDefault(),ee.stopPropagation();const ot=this.removeFromSubmenuStack();ot&&(ot.submenuOpen=!1,setTimeout(()=>{ot.focus(),ot.active=!0,(ot.slot==="submenu"?this.getSubmenuItems(ot.parentElement):this.getItems()).forEach(nt=>{nt!==ot&&(nt.active=!1)})},0));return}if((ee.key==="Home"||ee.key==="End")&&(ee.preventDefault(),ee.stopPropagation(),st=ee.key==="Home"?et[0]:et[et.length-1]),ee.key==="Tab"&&await this.hideMenu(),ee.key.length===1&&!(ee.metaKey||ee.ctrlKey||ee.altKey)&&!(ee.key===" "&&this.userTypedQuery==="")&&(clearTimeout(this.userTypedTimeout),this.userTypedTimeout=setTimeout(()=>{this.userTypedQuery=""},1e3),this.userTypedQuery+=ee.key,et.some(ot=>{const rt=(ot.textContent||"").trim().toLowerCase(),nt=this.userTypedQuery.trim().toLowerCase();return rt.startsWith(nt)?(st=ot,!0):!1})),st){ee.preventDefault(),ee.stopPropagation(),et.forEach(ot=>ot.active=ot===st),st.focus();return}(ee.key==="Enter"||ee.key===" "&&this.userTypedQuery==="")&&te&&tt&&(ee.preventDefault(),ee.stopPropagation(),tt.hasSubmenu?(tt.submenuOpen=!0,this.addToSubmenuStack(tt),setTimeout(()=>{const ot=this.getSubmenuItems(tt);ot.length>0&&(ot.forEach((rt,nt)=>rt.active=nt===0),ot[0].focus())},0)):this.makeSelection(tt))},this.handleDocumentPointerDown=ee=>{ee.composedPath().some(te=>te instanceof HTMLElement?te===this||te.closest('wa-dropdown, [part="submenu"]'):!1)||(this.open=!1)},this.handleGlobalMouseMove=ee=>{const O=this.getCurrentSubmenuItem();if(!O?.submenuOpen||!O.submenuElement)return;const Y=O.submenuElement.getBoundingClientRect(),te=this.localize.dir()==="rtl",ne=te?Y.right:Y.left,xe=te?Math.max(ee.clientX,ne):Math.min(ee.clientX,ne),et=Math.max(Y.top,Math.min(ee.clientY,Y.bottom));O.submenuElement.style.setProperty("--safe-triangle-cursor-x",`${xe}px`),O.submenuElement.style.setProperty("--safe-triangle-cursor-y",`${et}px`);const tt=O.matches(":hover"),it=O.submenuElement?.matches(":hover")||!!ee.composedPath().find(st=>st instanceof HTMLElement&&st.closest('[part="submenu"]')===O.submenuElement);!tt&&!it&&setTimeout(()=>{!O.matches(":hover")&&!O.submenuElement?.matches(":hover")&&(O.submenuOpen=!1)},100)}}disconnectedCallback(){super.disconnectedCallback(),clearInterval(this.userTypedTimeout),this.closeAllSubmenus(),this.submenuCleanups.forEach(ee=>ee()),this.submenuCleanups.clear(),document.removeEventListener("mousemove",this.handleGlobalMouseMove)}firstUpdated(){this.syncAriaAttributes()}async updated(ee){ee.has("open")&&(this.customStates.set("open",this.open),this.open?await this.showMenu():(this.closeAllSubmenus(),await this.hideMenu())),ee.has("size")&&this.syncItemSizes()}getItems(ee=!1){const O=this.defaultSlot.assignedElements({flatten:!0}).filter(Y=>Y.localName==="wa-dropdown-item");return ee?O:O.filter(Y=>!Y.disabled)}getSubmenuItems(ee,O=!1){const Y=ee.shadowRoot?.querySelector('slot[name="submenu"]')||ee.querySelector('slot[name="submenu"]');if(!Y)return[];const te=Y.assignedElements({flatten:!0}).filter(ne=>ne.localName==="wa-dropdown-item");return O?te:te.filter(ne=>!ne.disabled)}syncItemSizes(){this.defaultSlot.assignedElements({flatten:!0}).filter(O=>O.localName==="wa-dropdown-item").forEach(O=>O.size=this.size)}addToSubmenuStack(ee){const O=this.openSubmenuStack.indexOf(ee);O!==-1?this.openSubmenuStack=this.openSubmenuStack.slice(0,O+1):this.openSubmenuStack.push(ee)}removeFromSubmenuStack(){return this.openSubmenuStack.pop()}getCurrentSubmenuItem(){return this.openSubmenuStack.length>0?this.openSubmenuStack[this.openSubmenuStack.length-1]:void 0}closeAllSubmenus(){this.getItems(!0).forEach(O=>{O.submenuOpen=!1}),this.openSubmenuStack=[]}closeSiblingSubmenus(ee){const O=ee.closest('wa-dropdown-item:not([slot="submenu"])');let Y;O?Y=this.getSubmenuItems(O,!0):Y=this.getItems(!0),Y.forEach(te=>{te!==ee&&te.submenuOpen&&(te.submenuOpen=!1)}),this.openSubmenuStack.includes(ee)||this.openSubmenuStack.push(ee)}getTrigger(){return this.querySelector('[slot="trigger"]')}async showMenu(){if(!this.getTrigger())return;const O=new WaShowEvent;if(this.dispatchEvent(O),O.defaultPrevented){this.open=!1;return}openDropdowns.forEach(te=>te.open=!1),this.popup.active=!0,this.open=!0,openDropdowns.add(this),this.syncAriaAttributes(),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("pointerdown",this.handleDocumentPointerDown),document.addEventListener("mousemove",this.handleGlobalMouseMove),this.menu.classList.remove("hide"),await animateWithClass(this.menu,"show");const Y=this.getItems();Y.length>0&&(Y.forEach((te,ne)=>te.active=ne===0),Y[0].focus()),this.dispatchEvent(new WaAfterShowEvent)}async hideMenu(){const ee=new WaHideEvent({source:this});if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!0;return}this.open=!1,openDropdowns.delete(this),this.syncAriaAttributes(),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("pointerdown",this.handleDocumentPointerDown),document.removeEventListener("mousemove",this.handleGlobalMouseMove),this.menu.classList.remove("show"),await animateWithClass(this.menu,"hide"),this.popup.active=this.open,this.dispatchEvent(new WaAfterHideEvent)}handleMenuClick(ee){const O=ee.target.closest("wa-dropdown-item");if(!(!O||O.disabled)){if(O.hasSubmenu){O.submenuOpen||(this.closeSiblingSubmenus(O),this.addToSubmenuStack(O),O.submenuOpen=!0),ee.stopPropagation();return}this.makeSelection(O)}}async handleMenuSlotChange(){const ee=this.getItems(!0);await Promise.all(ee.map(te=>te.updateComplete)),this.syncItemSizes();const O=ee.some(te=>te.type==="checkbox"),Y=ee.some(te=>te.hasSubmenu);ee.forEach((te,ne)=>{te.active=ne===0,te.checkboxAdjacent=O,te.submenuAdjacent=Y})}handleTriggerClick(){this.open=!this.open}handleSubmenuOpening(ee){const O=ee.detail.item;this.closeSiblingSubmenus(O),this.addToSubmenuStack(O),this.setupSubmenuPosition(O),this.processSubmenuItems(O)}setupSubmenuPosition(ee){if(!ee.submenuElement)return;this.cleanupSubmenuPosition(ee);const O=autoUpdate(ee,ee.submenuElement,()=>{this.positionSubmenu(ee),this.updateSafeTriangleCoordinates(ee)});this.submenuCleanups.set(ee,O);const Y=ee.submenuElement.querySelector('slot[name="submenu"]');Y&&(Y.removeEventListener("slotchange",WaDropdown.handleSubmenuSlotChange),Y.addEventListener("slotchange",WaDropdown.handleSubmenuSlotChange),WaDropdown.handleSubmenuSlotChange({target:Y}))}static handleSubmenuSlotChange(ee){const O=ee.target;if(!O)return;const Y=O.assignedElements().filter(xe=>xe.localName==="wa-dropdown-item");if(Y.length===0)return;const te=Y.some(xe=>xe.hasSubmenu),ne=Y.some(xe=>xe.type==="checkbox");Y.forEach(xe=>{xe.submenuAdjacent=te,xe.checkboxAdjacent=ne})}processSubmenuItems(ee){if(!ee.submenuElement)return;const O=this.getSubmenuItems(ee,!0),Y=O.some(te=>te.hasSubmenu);O.forEach(te=>{te.submenuAdjacent=Y})}cleanupSubmenuPosition(ee){const O=this.submenuCleanups.get(ee);O&&(O(),this.submenuCleanups.delete(ee))}positionSubmenu(ee){if(!ee.submenuElement)return;const Y=this.localize.dir()==="rtl"?"left-start":"right-start";computePosition(ee,ee.submenuElement,{placement:Y,middleware:[offset$1({mainAxis:0,crossAxis:-5}),flip({fallbackStrategy:"bestFit"}),shift({padding:8})]}).then(({x:te,y:ne,placement:xe})=>{ee.submenuElement.setAttribute("data-placement",xe),Object.assign(ee.submenuElement.style,{left:`${te}px`,top:`${ne}px`})})}updateSafeTriangleCoordinates(ee){if(!ee.submenuElement||!ee.submenuOpen)return;if(document.activeElement?.matches(":focus-visible")){ee.submenuElement.style.setProperty("--safe-triangle-visible","none");return}ee.submenuElement.style.setProperty("--safe-triangle-visible","block");const Y=ee.submenuElement.getBoundingClientRect(),te=this.localize.dir()==="rtl";ee.submenuElement.style.setProperty("--safe-triangle-submenu-start-x",`${te?Y.right:Y.left}px`),ee.submenuElement.style.setProperty("--safe-triangle-submenu-start-y",`${Y.top}px`),ee.submenuElement.style.setProperty("--safe-triangle-submenu-end-x",`${te?Y.right:Y.left}px`),ee.submenuElement.style.setProperty("--safe-triangle-submenu-end-y",`${Y.bottom}px`)}makeSelection(ee){const O=this.getTrigger();if(ee.disabled)return;ee.type==="checkbox"&&(ee.checked=!ee.checked);const Y=new WaSelectEvent({item:ee});this.dispatchEvent(Y),Y.defaultPrevented||(this.open=!1,O?.focus())}async syncAriaAttributes(){const ee=this.getTrigger();let O;ee&&(ee.localName==="wa-button"?(await customElements.whenDefined("wa-button"),await ee.updateComplete,O=ee.shadowRoot.querySelector('[part="base"]')):O=ee,O.hasAttribute("id")||O.setAttribute("id",uniqueId("wa-dropdown-trigger-")),O.setAttribute("aria-haspopup","menu"),O.setAttribute("aria-expanded",this.open?"true":"false"),this.menu.setAttribute("aria-expanded","false"))}render(){let ee=this.hasUpdated?this.popup.active:this.open;return x$1`
      <wa-popup
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        ?active=${ee}
        flip
        flip-fallback-strategy="best-fit"
        shift
        shift-padding="10"
        auto-size="vertical"
        auto-size-padding="10"
      >
        <slot
          name="trigger"
          slot="anchor"
          @click=${this.handleTriggerClick}
          @slotchange=${this.syncAriaAttributes}
        ></slot>
        <div
          id="menu"
          part="menu"
          role="menu"
          tabindex="-1"
          aria-orientation="vertical"
          @click=${this.handleMenuClick}
          @submenu-opening=${this.handleSubmenuOpening}
        >
          <slot @slotchange=${this.handleMenuSlotChange}></slot>
        </div>
      </wa-popup>
    `}};WaDropdown.css=[size_default,dropdown_default];__decorateClass$d([e$9("slot:not([name])")],WaDropdown.prototype,"defaultSlot",2);__decorateClass$d([e$9("#menu")],WaDropdown.prototype,"menu",2);__decorateClass$d([e$9("wa-popup")],WaDropdown.prototype,"popup",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDropdown.prototype,"open",2);__decorateClass$d([n$7({reflect:!0})],WaDropdown.prototype,"size",2);__decorateClass$d([n$7({reflect:!0})],WaDropdown.prototype,"placement",2);__decorateClass$d([n$7({type:Number})],WaDropdown.prototype,"distance",2);__decorateClass$d([n$7({type:Number})],WaDropdown.prototype,"skidding",2);WaDropdown=__decorateClass$d([t$b("wa-dropdown")],WaDropdown);var dropdown_item_default=`:host {
  display: flex;
  position: relative;
  align-items: center;
  padding: 0.5em 1em;
  border-radius: var(--wa-border-radius-s);
  isolation: isolate;
  color: var(--wa-color-text-normal);
  line-height: var(--wa-line-height-condensed);
  cursor: pointer;
  transition:
    100ms background-color ease,
    100ms color ease;
}

@media (hover: hover) {
  :host(:hover:not(:state(disabled))) {
    background-color: var(--wa-color-neutral-fill-normal);
  }
}

:host(:focus-visible) {
  z-index: 1;
  outline: var(--wa-focus-ring);
  background-color: var(--wa-color-neutral-fill-normal);
}

:host(:state(disabled)) {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Danger variant */
:host([variant='danger']),
:host([variant='danger']) #details {
  color: var(--wa-color-danger-on-quiet);
}

@media (hover: hover) {
  :host([variant='danger']:hover) {
    background-color: var(--wa-color-danger-fill-normal);
    color: var(--wa-color-danger-on-normal);
  }
}

:host([variant='danger']:focus-visible) {
  background-color: var(--wa-color-danger-fill-normal);
  color: var(--wa-color-danger-on-normal);
}

:host([checkbox-adjacent]) {
  padding-inline-start: 2em;
}

/* Only add padding when item actually has a submenu */
:host([submenu-adjacent]:not(:state(has-submenu))) #details {
  padding-inline-end: 0;
}

:host(:state(has-submenu)[submenu-adjacent]) #details {
  padding-inline-end: 1.75em;
}

#check {
  visibility: hidden;
  margin-inline-start: -1.5em;
  margin-inline-end: 0.5em;
  font-size: var(--wa-font-size-smaller);
}

:host(:state(checked)) #check {
  visibility: visible;
}

#icon ::slotted(*) {
  display: flex;
  flex: 0 0 auto;
  align-items: center;
  margin-inline-end: 0.75em !important;
  font-size: var(--wa-font-size-smaller);
}

#label {
  flex: 1 1 auto;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

#details {
  display: flex;
  flex: 0 0 auto;
  align-items: center;
  justify-content: end;
  color: var(--wa-color-text-quiet);
  font-size: var(--wa-font-size-smaller) !important;
}

#details ::slotted(*) {
  margin-inline-start: 2em !important;
}

/* Submenu indicator icon */
#submenu-indicator {
  position: absolute;
  inset-inline-end: 1em;
  color: var(--wa-color-neutral-on-quiet);
  font-size: var(--wa-font-size-smaller);
}

/* Flip chevron icon when RTL */
:host(:dir(rtl)) #submenu-indicator {
  transform: scaleX(-1);
}

/* Submenu styles */
#submenu {
  display: flex;
  z-index: 10;
  position: absolute;
  top: 0;
  left: 0;
  flex-direction: column;
  width: max-content;
  margin: 0;
  padding: 0.25em;
  border: var(--wa-border-style) var(--wa-border-width-s) var(--wa-color-surface-border);
  border-radius: var(--wa-border-radius-m);
  background-color: var(--wa-color-surface-raised);
  box-shadow: var(--wa-shadow-m);
  color: var(--wa-color-text-normal);
  text-align: start;
  user-select: none;

  /* Override default popover styles */
  &[popover] {
    margin: 0;
    inset: auto;
    padding: 0.25em;
    overflow: visible;
    border-radius: var(--wa-border-radius-m);
  }

  &.show {
    animation: submenu-show var(--show-duration, 50ms) ease;
  }

  &.hide {
    animation: submenu-show var(--show-duration, 50ms) ease reverse;
  }

  /* Submenu placement transform origins */
  &[data-placement^='top'] {
    transform-origin: bottom;
  }

  &[data-placement^='bottom'] {
    transform-origin: top;
  }

  &[data-placement^='left'] {
    transform-origin: right;
  }

  &[data-placement^='right'] {
    transform-origin: left;
  }

  &[data-placement='left-start'] {
    transform-origin: right top;
  }

  &[data-placement='left-end'] {
    transform-origin: right bottom;
  }

  &[data-placement='right-start'] {
    transform-origin: left top;
  }

  &[data-placement='right-end'] {
    transform-origin: left bottom;
  }

  /* Safe triangle styling */
  &::before {
    display: none;
    z-index: 9;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: transparent;
    content: '';
    clip-path: polygon(
      var(--safe-triangle-cursor-x, 0) var(--safe-triangle-cursor-y, 0),
      var(--safe-triangle-submenu-start-x, 0) var(--safe-triangle-submenu-start-y, 0),
      var(--safe-triangle-submenu-end-x, 0) var(--safe-triangle-submenu-end-y, 0)
    );
    pointer-events: auto; /* Enable mouse events on the triangle */
  }

  &[data-visible]::before {
    display: block;
  }
}

::slotted(wa-dropdown-item) {
  font-size: inherit;
}

::slotted(wa-divider) {
  --spacing: 0.25em;
}

@keyframes submenu-show {
  from {
    scale: 0.9;
    opacity: 0;
  }
  to {
    scale: 1;
    opacity: 1;
  }
}
`,WaDropdownItem=class extends WebAwesomeElement{constructor(){super(...arguments),this.hasSlotController=new HasSlotController(this,"[default]","start","end"),this.active=!1,this.variant="default",this.size="medium",this.checkboxAdjacent=!1,this.submenuAdjacent=!1,this.type="normal",this.checked=!1,this.disabled=!1,this.submenuOpen=!1,this.hasSubmenu=!1,this.handleSlotChange=()=>{this.hasSubmenu=this.hasSlotController.test("submenu"),this.updateHasSubmenuState(),this.hasSubmenu?(this.setAttribute("aria-haspopup","menu"),this.setAttribute("aria-expanded",this.submenuOpen?"true":"false")):(this.removeAttribute("aria-haspopup"),this.removeAttribute("aria-expanded"))}}connectedCallback(){super.connectedCallback(),this.addEventListener("mouseenter",this.handleMouseEnter.bind(this)),this.shadowRoot.addEventListener("slotchange",this.handleSlotChange)}disconnectedCallback(){super.disconnectedCallback(),this.closeSubmenu(),this.removeEventListener("mouseenter",this.handleMouseEnter),this.shadowRoot.removeEventListener("slotchange",this.handleSlotChange)}firstUpdated(){this.setAttribute("tabindex","-1"),this.hasSubmenu=this.hasSlotController.test("submenu"),this.updateHasSubmenuState()}updated(ee){ee.has("active")&&(this.setAttribute("tabindex",this.active?"0":"-1"),this.customStates.set("active",this.active)),ee.has("checked")&&(this.setAttribute("aria-checked",this.checked?"true":"false"),this.customStates.set("checked",this.checked)),ee.has("disabled")&&(this.setAttribute("aria-disabled",this.disabled?"true":"false"),this.customStates.set("disabled",this.disabled)),ee.has("type")&&(this.type==="checkbox"?this.setAttribute("role","menuitemcheckbox"):this.setAttribute("role","menuitem")),ee.has("submenuOpen")&&(this.customStates.set("submenu-open",this.submenuOpen),this.submenuOpen?this.openSubmenu():this.closeSubmenu())}updateHasSubmenuState(){this.customStates.set("has-submenu",this.hasSubmenu)}async openSubmenu(){!this.hasSubmenu||!this.submenuElement||(this.notifyParentOfOpening(),this.submenuElement.showPopover(),this.submenuElement.hidden=!1,this.submenuElement.setAttribute("data-visible",""),this.submenuOpen=!0,this.setAttribute("aria-expanded","true"),await animateWithClass(this.submenuElement,"show"),setTimeout(()=>{const ee=this.getSubmenuItems();ee.length>0&&(ee.forEach((O,Y)=>O.active=Y===0),ee[0].focus())},0))}notifyParentOfOpening(){const ee=new CustomEvent("submenu-opening",{bubbles:!0,composed:!0,detail:{item:this}});this.dispatchEvent(ee);const O=this.parentElement;O&&[...O.children].filter(te=>te!==this&&te.localName==="wa-dropdown-item"&&te.getAttribute("slot")===this.getAttribute("slot")&&te.submenuOpen).forEach(te=>{te.submenuOpen=!1})}async closeSubmenu(){!this.hasSubmenu||!this.submenuElement||(this.submenuOpen=!1,this.setAttribute("aria-expanded","false"),this.submenuElement.hidden||(await animateWithClass(this.submenuElement,"hide"),this.submenuElement.hidden=!0,this.submenuElement.removeAttribute("data-visible"),this.submenuElement.hidePopover()))}getSubmenuItems(){return[...this.children].filter(ee=>ee.localName==="wa-dropdown-item"&&ee.getAttribute("slot")==="submenu"&&!ee.hasAttribute("disabled"))}handleMouseEnter(){this.hasSubmenu&&!this.disabled&&(this.notifyParentOfOpening(),this.submenuOpen=!0)}render(){return x$1`
      ${this.type==="checkbox"?x$1`
            <wa-icon
              id="check"
              part="checkmark"
              exportparts="svg:checkmark__svg"
              library="system"
              name="check"
            ></wa-icon>
          `:""}

      <span id="icon" part="icon">
        <slot name="icon"></slot>
      </span>

      <span id="label" part="label">
        <slot></slot>
      </span>

      <span id="details" part="details">
        <slot name="details"></slot>
      </span>

      ${this.hasSubmenu?x$1`
            <wa-icon
              id="submenu-indicator"
              part="submenu-icon"
              exportparts="svg:submenu-icon__svg"
              library="system"
              name="chevron-right"
            ></wa-icon>
          `:""}
      ${this.hasSubmenu?x$1`
            <div
              id="submenu"
              part="submenu"
              popover="manual"
              role="menu"
              tabindex="-1"
              aria-orientation="vertical"
              hidden
            >
              <slot name="submenu"></slot>
            </div>
          `:""}
    `}};WaDropdownItem.css=dropdown_item_default;__decorateClass$d([e$9("#submenu")],WaDropdownItem.prototype,"submenuElement",2);__decorateClass$d([n$7({type:Boolean})],WaDropdownItem.prototype,"active",2);__decorateClass$d([n$7({reflect:!0})],WaDropdownItem.prototype,"variant",2);__decorateClass$d([n$7({reflect:!0})],WaDropdownItem.prototype,"size",2);__decorateClass$d([n$7({attribute:"checkbox-adjacent",type:Boolean,reflect:!0})],WaDropdownItem.prototype,"checkboxAdjacent",2);__decorateClass$d([n$7({attribute:"submenu-adjacent",type:Boolean,reflect:!0})],WaDropdownItem.prototype,"submenuAdjacent",2);__decorateClass$d([n$7()],WaDropdownItem.prototype,"value",2);__decorateClass$d([n$7({reflect:!0})],WaDropdownItem.prototype,"type",2);__decorateClass$d([n$7({type:Boolean})],WaDropdownItem.prototype,"checked",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDropdownItem.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaDropdownItem.prototype,"submenuOpen",2);__decorateClass$d([r$6()],WaDropdownItem.prototype,"hasSubmenu",2);WaDropdownItem=__decorateClass$d([t$b("wa-dropdown-item")],WaDropdownItem);var WaFormatBytes=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.value=0,this.unit="byte",this.display="short"}static get styles(){return[]}render(){if(isNaN(this.value))return"";const ee=["","kilo","mega","giga","tera"],O=["","kilo","mega","giga","tera","peta"],Y=this.unit==="bit"?ee:O,te=Math.max(0,Math.min(Math.floor(Math.log10(this.value)/3),Y.length-1)),ne=Y[te]+this.unit,xe=parseFloat((this.value/Math.pow(1e3,te)).toPrecision(3));return this.localize.number(xe,{style:"unit",unit:ne,unitDisplay:this.display})}};__decorateClass$d([n$7({type:Number})],WaFormatBytes.prototype,"value",2);__decorateClass$d([n$7()],WaFormatBytes.prototype,"unit",2);__decorateClass$d([n$7()],WaFormatBytes.prototype,"display",2);WaFormatBytes=__decorateClass$d([t$b("wa-format-bytes")],WaFormatBytes);var WaFormatDate=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.date=new Date,this.hourFormat="auto"}static get styles(){return[]}render(){const ee=new Date(this.date),O=this.hourFormat==="auto"?void 0:this.hourFormat==="12";if(isNaN(ee.getMilliseconds()))return;const Y=this.localize.date(ee,{weekday:this.weekday,era:this.era,year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second,timeZoneName:this.timeZoneName,timeZone:this.timeZone,hour12:O});return x$1`<time datetime=${ee.toISOString()}>${Y}</time>`}};__decorateClass$d([n$7()],WaFormatDate.prototype,"date",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"weekday",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"era",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"year",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"month",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"day",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"hour",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"minute",2);__decorateClass$d([n$7()],WaFormatDate.prototype,"second",2);__decorateClass$d([n$7({attribute:"time-zone-name"})],WaFormatDate.prototype,"timeZoneName",2);__decorateClass$d([n$7({attribute:"time-zone"})],WaFormatDate.prototype,"timeZone",2);__decorateClass$d([n$7({attribute:"hour-format"})],WaFormatDate.prototype,"hourFormat",2);WaFormatDate=__decorateClass$d([t$b("wa-format-date")],WaFormatDate);var WaFormatNumber=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.value=0,this.type="decimal",this.withoutGrouping=!1,this.currency="USD",this.currencyDisplay="symbol"}static get styles(){return[]}render(){return isNaN(this.value)?"":this.localize.number(this.value,{style:this.type,currency:this.currency,currencyDisplay:this.currencyDisplay,useGrouping:!this.withoutGrouping,minimumIntegerDigits:this.minimumIntegerDigits,minimumFractionDigits:this.minimumFractionDigits,maximumFractionDigits:this.maximumFractionDigits,minimumSignificantDigits:this.minimumSignificantDigits,maximumSignificantDigits:this.maximumSignificantDigits})}};__decorateClass$d([n$7({type:Number})],WaFormatNumber.prototype,"value",2);__decorateClass$d([n$7()],WaFormatNumber.prototype,"type",2);__decorateClass$d([n$7({attribute:"without-grouping",type:Boolean})],WaFormatNumber.prototype,"withoutGrouping",2);__decorateClass$d([n$7()],WaFormatNumber.prototype,"currency",2);__decorateClass$d([n$7({attribute:"currency-display"})],WaFormatNumber.prototype,"currencyDisplay",2);__decorateClass$d([n$7({attribute:"minimum-integer-digits",type:Number})],WaFormatNumber.prototype,"minimumIntegerDigits",2);__decorateClass$d([n$7({attribute:"minimum-fraction-digits",type:Number})],WaFormatNumber.prototype,"minimumFractionDigits",2);__decorateClass$d([n$7({attribute:"maximum-fraction-digits",type:Number})],WaFormatNumber.prototype,"maximumFractionDigits",2);__decorateClass$d([n$7({attribute:"minimum-significant-digits",type:Number})],WaFormatNumber.prototype,"minimumSignificantDigits",2);__decorateClass$d([n$7({attribute:"maximum-significant-digits",type:Number})],WaFormatNumber.prototype,"maximumSignificantDigits",2);WaFormatNumber=__decorateClass$d([t$b("wa-format-number")],WaFormatNumber);var includeFiles=new Map;function requestInclude(ee,O="cors"){const Y=includeFiles.get(ee);if(Y!==void 0)return Promise.resolve(Y);const te=fetch(ee,{mode:O}).then(async ne=>{const xe={ok:ne.ok,status:ne.status,html:await ne.text()};return includeFiles.set(ee,xe),xe});return includeFiles.set(ee,te),te}var WaIncludeErrorEvent=class extends Event{constructor(ee){super("wa-include-error",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},include_default=`:host {
  display: block;
}
`,WaInclude=class extends WebAwesomeElement{constructor(){super(...arguments),this.mode="cors",this.allowScripts=!1}executeScript(ee){const O=document.createElement("script");[...ee.attributes].forEach(Y=>O.setAttribute(Y.name,Y.value)),O.textContent=ee.textContent,ee.parentNode.replaceChild(O,ee)}async handleSrcChange(){try{const ee=this.src,O=await requestInclude(ee,this.mode);if(ee!==this.src)return;if(!O.ok){this.dispatchEvent(new WaIncludeErrorEvent({status:O.status}));return}this.innerHTML=O.html,this.allowScripts&&[...this.querySelectorAll("script")].forEach(Y=>this.executeScript(Y)),this.dispatchEvent(new WaLoadEvent)}catch{this.dispatchEvent(new WaIncludeErrorEvent({status:-1}))}}render(){return x$1`<slot></slot>`}};WaInclude.css=include_default;__decorateClass$d([n$7()],WaInclude.prototype,"src",2);__decorateClass$d([n$7()],WaInclude.prototype,"mode",2);__decorateClass$d([n$7({attribute:"allow-scripts",type:Boolean})],WaInclude.prototype,"allowScripts",2);__decorateClass$d([watch("src")],WaInclude.prototype,"handleSrcChange",1);WaInclude=__decorateClass$d([t$b("wa-include")],WaInclude);var WaMutationEvent=class extends Event{constructor(ee){super("wa-mutation",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},mutation_observer_default=`:host {
  display: contents;
}
`,WaMutationObserver=class extends WebAwesomeElement{constructor(){super(...arguments),this.attrOldValue=!1,this.charData=!1,this.charDataOldValue=!1,this.childList=!1,this.disabled=!1,this.handleMutation=ee=>{this.dispatchEvent(new WaMutationEvent({mutationList:ee}))}}connectedCallback(){super.connectedCallback(),typeof MutationObserver<"u"&&(this.mutationObserver=new MutationObserver(this.handleMutation),this.disabled||this.startObserver())}disconnectedCallback(){super.disconnectedCallback(),this.stopObserver()}startObserver(){const ee=typeof this.attr=="string"&&this.attr.length>0,O=ee&&this.attr!=="*"?this.attr.split(" "):void 0;try{this.mutationObserver.observe(this,{subtree:!0,childList:this.childList,attributes:ee,attributeFilter:O,attributeOldValue:this.attrOldValue,characterData:this.charData,characterDataOldValue:this.charDataOldValue})}catch{}}stopObserver(){this.mutationObserver.disconnect()}handleDisabledChange(){this.disabled?this.stopObserver():this.startObserver()}handleChange(){this.stopObserver(),this.startObserver()}render(){return x$1` <slot></slot> `}};WaMutationObserver.css=mutation_observer_default;__decorateClass$d([n$7({reflect:!0})],WaMutationObserver.prototype,"attr",2);__decorateClass$d([n$7({attribute:"attr-old-value",type:Boolean,reflect:!0})],WaMutationObserver.prototype,"attrOldValue",2);__decorateClass$d([n$7({attribute:"char-data",type:Boolean,reflect:!0})],WaMutationObserver.prototype,"charData",2);__decorateClass$d([n$7({attribute:"char-data-old-value",type:Boolean,reflect:!0})],WaMutationObserver.prototype,"charDataOldValue",2);__decorateClass$d([n$7({attribute:"child-list",type:Boolean,reflect:!0})],WaMutationObserver.prototype,"childList",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaMutationObserver.prototype,"disabled",2);__decorateClass$d([watch("disabled")],WaMutationObserver.prototype,"handleDisabledChange",1);__decorateClass$d([watch("attr",{waitUntilFirstUpdate:!0}),watch("attr-old-value",{waitUntilFirstUpdate:!0}),watch("char-data",{waitUntilFirstUpdate:!0}),watch("char-data-old-value",{waitUntilFirstUpdate:!0}),watch("childList",{waitUntilFirstUpdate:!0})],WaMutationObserver.prototype,"handleChange",1);WaMutationObserver=__decorateClass$d([t$b("wa-mutation-observer")],WaMutationObserver);var popover_default=`:host {
  --arrow-size: 0.375rem;
  --max-width: 25rem;
  --show-duration: 100ms;
  --hide-duration: 100ms;

  /* Internal calculated properties */
  --arrow-diagonal-size: calc((var(--arrow-size) * sin(45deg)));

  display: contents;

  /** Defaults for inherited CSS properties */
  font-size: var(--wa-font-size-m);
  line-height: var(--wa-line-height-normal);
  text-align: start;
  white-space: normal;
}

/* The native dialog element */
.dialog {
  display: none;
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  border: none;
  background: transparent;
  overflow: visible;
  pointer-events: none;

  &:focus {
    outline: none;
  }

  &[open] {
    display: block;
  }
}

/* The <wa-popup> element */
.popover {
  --arrow-size: inherit;
  --show-duration: inherit;
  --hide-duration: inherit;

  pointer-events: auto;

  &::part(arrow) {
    background-color: var(--wa-color-surface-default);
    border-top: none;
    border-left: none;
    border-bottom: solid var(--wa-panel-border-width) var(--wa-color-surface-border);
    border-right: solid var(--wa-panel-border-width) var(--wa-color-surface-border);
    box-shadow: none;
  }
}

.popover[placement^='top']::part(popup) {
  transform-origin: bottom;
}

.popover[placement^='bottom']::part(popup) {
  transform-origin: top;
}

.popover[placement^='left']::part(popup) {
  transform-origin: right;
}

.popover[placement^='right']::part(popup) {
  transform-origin: left;
}

/* Body */
.body {
  display: flex;
  flex-direction: column;
  width: max-content;
  max-width: var(--max-width);
  padding: var(--wa-space-l);
  background-color: var(--wa-color-surface-default);
  border: var(--wa-panel-border-width) solid var(--wa-color-surface-border);
  border-radius: var(--wa-panel-border-radius);
  border-style: var(--wa-panel-border-style);
  box-shadow: var(--wa-shadow-l);
  color: var(--wa-color-text-normal);
  user-select: none;
  -webkit-user-select: none;
}
`,openPopovers=new Set,WaPopover=class extends WebAwesomeElement{constructor(){super(...arguments),this.anchor=null,this.placement="top",this.open=!1,this.distance=8,this.skidding=0,this.for=null,this.withoutArrow=!1,this.eventController=new AbortController,this.handleAnchorClick=()=>{this.open=!this.open},this.handleBodyClick=ee=>{ee.target.closest('[data-popover="close"]')&&(ee.stopPropagation(),this.open=!1)},this.handleDocumentKeyDown=ee=>{ee.key==="Escape"&&(ee.preventDefault(),this.open=!1,this.anchor&&typeof this.anchor.focus=="function"&&this.anchor.focus())},this.handleDocumentClick=ee=>{const O=ee.target;this.anchor&&ee.composedPath().includes(this.anchor)||O.closest("wa-popover")!==this&&(this.open=!1)}}connectedCallback(){super.connectedCallback(),this.id||(this.id=uniqueId("wa-popover-"))}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this.handleDocumentKeyDown),this.eventController.abort()}firstUpdated(){this.open&&(this.dialog.show(),this.popup.active=!0,this.popup.reposition())}updated(ee){ee.has("open")&&this.customStates.set("open",this.open)}async handleOpenChange(){if(this.open){const ee=new WaShowEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}openPopovers.forEach(O=>O.open=!1),document.addEventListener("keydown",this.handleDocumentKeyDown,{signal:this.eventController.signal}),document.addEventListener("click",this.handleDocumentClick,{signal:this.eventController.signal}),this.dialog.show(),this.popup.active=!0,openPopovers.add(this),requestAnimationFrame(()=>{const O=this.querySelector("[autofocus]");O&&typeof O.focus=="function"?O.focus():this.dialog.focus()}),await animateWithClass(this.popup.popup,"show-with-scale"),this.popup.reposition(),this.dispatchEvent(new WaAfterShowEvent)}else{const ee=new WaHideEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!0;return}document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("click",this.handleDocumentClick),openPopovers.delete(this),await animateWithClass(this.popup.popup,"hide-with-scale"),this.popup.active=!1,this.dialog.close(),this.dispatchEvent(new WaAfterHideEvent)}}handleForChange(){const ee=this.getRootNode();if(!ee)return;const O=this.for?ee.getElementById(this.for):null,Y=this.anchor;if(O===Y)return;const{signal:te}=this.eventController;O&&O.addEventListener("click",this.handleAnchorClick,{signal:te}),Y&&Y.removeEventListener("click",this.handleAnchorClick),this.anchor=O,this.for&&!O&&console.warn(`A popover was assigned to an element with an ID of "${this.for}" but the element could not be found.`,this)}async handleOptionsChange(){this.hasUpdated&&(await this.updateComplete,this.popup.reposition())}async show(){if(!this.open)return this.open=!0,waitForEvent(this,"wa-after-show")}async hide(){if(this.open)return this.open=!1,waitForEvent(this,"wa-after-hide")}render(){return x$1`
      <dialog part="dialog" class="dialog">
        <wa-popup
          part="popup"
          exportparts="
            popup:popup__popup,
            arrow:popup__arrow
          "
          class=${e$5({popover:!0,"popover-open":this.open})}
          placement=${this.placement}
          distance=${this.distance}
          skidding=${this.skidding}
          flip
          shift
          ?arrow=${!this.withoutArrow}
          .anchor=${this.anchor}
        >
          <div part="body" class="body" @click=${this.handleBodyClick}>
            <slot></slot>
          </div>
        </wa-popup>
      </dialog>
    `}};WaPopover.css=popover_default;WaPopover.dependencies={"wa-popup":WaPopup};__decorateClass$d([e$9("dialog")],WaPopover.prototype,"dialog",2);__decorateClass$d([e$9(".body")],WaPopover.prototype,"body",2);__decorateClass$d([e$9("wa-popup")],WaPopover.prototype,"popup",2);__decorateClass$d([r$6()],WaPopover.prototype,"anchor",2);__decorateClass$d([n$7()],WaPopover.prototype,"placement",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaPopover.prototype,"open",2);__decorateClass$d([n$7({type:Number})],WaPopover.prototype,"distance",2);__decorateClass$d([n$7({type:Number})],WaPopover.prototype,"skidding",2);__decorateClass$d([n$7()],WaPopover.prototype,"for",2);__decorateClass$d([n$7({attribute:"without-arrow",type:Boolean,reflect:!0})],WaPopover.prototype,"withoutArrow",2);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaPopover.prototype,"handleOpenChange",1);__decorateClass$d([watch("for")],WaPopover.prototype,"handleForChange",1);__decorateClass$d([watch(["distance","placement","skidding"])],WaPopover.prototype,"handleOptionsChange",1);WaPopover=__decorateClass$d([t$b("wa-popover")],WaPopover);var progress_bar_default=`:host {
  --track-height: 1rem;
  --track-color: var(--wa-color-neutral-fill-normal);
  --indicator-color: var(--wa-color-brand-fill-loud);

  display: flex;
}

.progress-bar {
  flex: 1 1 auto;
  display: flex;
  position: relative;
  overflow: hidden;
  height: var(--track-height);
  border-radius: var(--wa-border-radius-pill);
  background-color: var(--track-color);
  color: var(--wa-color-brand-on-loud);
  font-size: var(--wa-font-size-s);
}

.indicator {
  width: var(--percentage);
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--indicator-color);
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  line-height: 1;
  font-weight: var(--wa-font-weight-semibold);
  transition: all var(--wa-transition-slow, 200ms) var(--wa-transition-easing, ease);
  user-select: none;
  -webkit-user-select: none;
}

/* Indeterminate */
:host([indeterminate]) .indicator {
  position: absolute;
  inset-block: 0;
  inline-size: 50%;
  animation: wa-progress-indeterminate 2.5s infinite cubic-bezier(0.37, 0, 0.63, 1);
}

@media (forced-colors: active) {
  .progress-bar {
    outline: solid 1px SelectedItem;
    background-color: var(--wa-color-surface-default);
  }

  .indicator {
    outline: solid 1px SelectedItem;
    background-color: SelectedItem;
  }
}

@keyframes wa-progress-indeterminate {
  0% {
    inset-inline-start: -50%;
  }

  75%,
  100% {
    inset-inline-start: 100%;
  }
}
`,WaProgressBar=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.value=0,this.indeterminate=!1,this.label=""}updated(ee){ee.has("value")&&requestAnimationFrame(()=>{this.style.setProperty("--percentage",`${clamp$3(this.value,0,100)}%`)})}render(){return x$1`
      <div
        part="base"
        class="progress-bar"
        role="progressbar"
        title=${o$6(this.title)}
        aria-label=${this.label.length>0?this.label:this.localize.term("progress")}
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow=${this.indeterminate?"0":this.value}
      >
        <div part="indicator" class="indicator">
          ${this.indeterminate?"":x$1` <slot part="label" class="label"></slot> `}
        </div>
      </div>
    `}};WaProgressBar.css=progress_bar_default;__decorateClass$d([n$7({type:Number,reflect:!0})],WaProgressBar.prototype,"value",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaProgressBar.prototype,"indeterminate",2);__decorateClass$d([n$7()],WaProgressBar.prototype,"label",2);WaProgressBar=__decorateClass$d([t$b("wa-progress-bar")],WaProgressBar);var progress_ring_default=`:host {
  --size: 8rem;
  --track-width: 0.25em; /* avoid using rems here */
  --track-color: var(--wa-color-neutral-fill-normal);
  --indicator-width: var(--track-width);
  --indicator-color: var(--wa-color-brand-fill-loud);
  --indicator-transition-duration: 0.35s;

  display: inline-flex;
}

.progress-ring {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.image {
  width: var(--size);
  height: var(--size);
  rotate: -90deg;
  transform-origin: 50% 50%;
}

.track,
.indicator {
  --radius: calc(var(--size) / 2 - max(var(--track-width), var(--indicator-width)) * 0.5);
  --circumference: calc(var(--radius) * 2 * 3.141592654);

  fill: none;
  r: var(--radius);
  cx: calc(var(--size) / 2);
  cy: calc(var(--size) / 2);
}

.track {
  stroke: var(--track-color);
  stroke-width: var(--track-width);
}

.indicator {
  stroke: var(--indicator-color);
  stroke-width: var(--indicator-width);
  stroke-linecap: round;
  transition-property: stroke-dashoffset;
  transition-duration: var(--indicator-transition-duration);
  stroke-dasharray: var(--circumference) var(--circumference);
  stroke-dashoffset: calc(var(--circumference) - var(--percentage) * var(--circumference));
}

.label {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  text-align: center;
  user-select: none;
  -webkit-user-select: none;
}
`,WaProgressRing=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.value=0,this.label=""}updated(ee){if(super.updated(ee),ee.has("value")){const O=parseFloat(getComputedStyle(this.indicator).getPropertyValue("r")),Y=2*Math.PI*O,te=Y-this.value/100*Y;this.indicatorOffset=`${te}px`}}render(){return x$1`
      <div
        part="base"
        class="progress-ring"
        role="progressbar"
        aria-label=${this.label.length>0?this.label:this.localize.term("progress")}
        aria-describedby="label"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow="${this.value}"
        style="--percentage: ${this.value/100}"
      >
        <svg class="image">
          <circle class="track"></circle>
          <circle class="indicator" style="stroke-dashoffset: ${this.indicatorOffset}"></circle>
        </svg>

        <slot id="label" part="label" class="label"></slot>
      </div>
    `}};WaProgressRing.css=progress_ring_default;__decorateClass$d([e$9(".indicator")],WaProgressRing.prototype,"indicator",2);__decorateClass$d([r$6()],WaProgressRing.prototype,"indicatorOffset",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaProgressRing.prototype,"value",2);__decorateClass$d([n$7()],WaProgressRing.prototype,"label",2);WaProgressRing=__decorateClass$d([t$b("wa-progress-ring")],WaProgressRing);var qr_code_default=`:host {
  --size: 128px;
  display: inline-block;
}

:host,
canvas {
  max-width: var(--size);
  max-height: var(--size);
  width: var(--size);
  height: var(--size);
}
`,QrCreator,WaQrCode=class extends WebAwesomeElement{constructor(){super(...arguments),this.value="",this.label="",this.size=128,this.fill="black",this.background="white",this.radius=0,this.errorCorrection="H",this.generated=!1}firstUpdated(ee){super.firstUpdated(ee),this.hasUpdated&&this.generate()}generate(){if(this.style.setProperty("--size",`${this.size}px`),!!this.hasUpdated){if(!QrCreator){__vitePreload(()=>import("./qr-creator.es6.min-DtlEF1Ls.js"),[]).then(ee=>{QrCreator=ee.default,this.generate()});return}QrCreator.render({text:this.value,radius:this.radius,ecLevel:this.errorCorrection,fill:this.fill,background:this.background,size:this.size*2},this.canvas),this.generated=!0}}render(){return x$1`
      <canvas
        part="base"
        class="qr-code"
        role="img"
        aria-label=${this.label?.length>0?this.label:this.value}
      ></canvas>
    `}};WaQrCode.css=qr_code_default;__decorateClass$d([e$9("canvas")],WaQrCode.prototype,"canvas",2);__decorateClass$d([n$7()],WaQrCode.prototype,"value",2);__decorateClass$d([n$7()],WaQrCode.prototype,"label",2);__decorateClass$d([n$7({type:Number})],WaQrCode.prototype,"size",2);__decorateClass$d([n$7()],WaQrCode.prototype,"fill",2);__decorateClass$d([n$7()],WaQrCode.prototype,"background",2);__decorateClass$d([n$7({type:Number})],WaQrCode.prototype,"radius",2);__decorateClass$d([n$7({attribute:"error-correction"})],WaQrCode.prototype,"errorCorrection",2);__decorateClass$d([r$6()],WaQrCode.prototype,"generated",2);__decorateClass$d([watch(["background","errorCorrection","fill","radius","size","value"])],WaQrCode.prototype,"generate",1);WaQrCode=__decorateClass$d([t$b("wa-qr-code")],WaQrCode);var radio_group_default=`:host {
  display: block;
}

.form-control {
  position: relative;
  border: none;
  padding: 0;
  margin: 0;
}

.label {
  padding: 0;
}

.radio-group-required .label::after {
  content: var(--wa-form-control-required-content);
  margin-inline-start: var(--wa-form-control-required-content-offset);
}

[part~='form-control-input'] {
  display: flex;
  flex-direction: column;
  flex-wrap: wrap;
  gap: 0; /* Radios handle their own spacing */
}

/* Horizontal */
:host([orientation='horizontal']) [part~='form-control-input'] {
  flex-direction: row;
}

/* Help text */
[part~='hint'] {
  margin-block-start: 0.5em;
}
`,WaRadioGroup=class extends WebAwesomeFormAssociatedElement{constructor(){super(),this.hasSlotController=new HasSlotController(this,"hint","label"),this.label="",this.hint="",this.name=null,this.disabled=!1,this.orientation="vertical",this._value=null,this.defaultValue=this.getAttribute("value")||null,this.size="medium",this.required=!1,this.withLabel=!1,this.withHint=!1,this.handleRadioClick=ee=>{const O=ee.target.closest("wa-radio");if(!O||O.disabled||O.forceDisabled||this.disabled)return;const Y=this.value;this.value=O.value,O.checked=!0;const te=this.getAllRadios();for(const ne of te)O!==ne&&(ne.checked=!1,ne.setAttribute("tabindex","-1"));this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("click",this.handleRadioClick)}static get validators(){const ee=[RequiredValidator({validationElement:Object.assign(document.createElement("input"),{required:!0,type:"radio",name:uniqueId("__wa-radio")})})];return[...super.validators,...ee]}get value(){return this.valueHasChanged?this._value:this._value??this.defaultValue}set value(ee){typeof ee=="number"&&(ee=String(ee)),this.valueHasChanged=!0,this._value=ee}get validationTarget(){const ee=this.querySelector(":is(wa-radio):not([disabled])");if(ee)return ee}updated(ee){(ee.has("disabled")||ee.has("value"))&&this.syncRadioElements()}formResetCallback(...ee){this.value=this.defaultValue,super.formResetCallback(...ee),this.syncRadioElements()}getAllRadios(){return[...this.querySelectorAll("wa-radio")]}handleLabelClick(){this.focus()}async syncRadioElements(){const ee=this.getAllRadios();if(ee.forEach((O,Y)=>{O.setAttribute("size",this.size),O.toggleAttribute("data-wa-radio-horizontal",this.orientation!=="vertical"),O.toggleAttribute("data-wa-radio-vertical",this.orientation==="vertical"),O.toggleAttribute("data-wa-radio-first",Y===0),O.toggleAttribute("data-wa-radio-inner",Y!==0&&Y!==ee.length-1),O.toggleAttribute("data-wa-radio-last",Y===ee.length-1),O.forceDisabled=this.disabled}),await Promise.all(ee.map(async O=>{await O.updateComplete,!O.disabled&&O.value===this.value?O.checked=!0:O.checked=!1})),this.disabled)ee.forEach(O=>{O.tabIndex=-1});else{const O=ee.filter(te=>!te.disabled),Y=O.find(te=>te.checked);O.length>0&&(Y?O.forEach(te=>{te.tabIndex=te.checked?0:-1}):O.forEach((te,ne)=>{te.tabIndex=ne===0?0:-1})),ee.filter(te=>te.disabled).forEach(te=>{te.tabIndex=-1})}}handleKeyDown(ee){if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(ee.key)||this.disabled)return;const O=this.getAllRadios().filter(tt=>!tt.disabled);if(O.length<=0)return;ee.preventDefault();const Y=this.value,te=O.find(tt=>tt.checked)??O[0],ne=ee.key===" "?0:["ArrowUp","ArrowLeft"].includes(ee.key)?-1:1;let xe=O.indexOf(te)+ne;xe||(xe=0),xe<0&&(xe=O.length-1),xe>O.length-1&&(xe=0);const et=O.some(tt=>tt.tagName.toLowerCase()==="wa-radio-button");this.getAllRadios().forEach(tt=>{tt.checked=!1,et||tt.setAttribute("tabindex","-1")}),this.value=O[xe].value,O[xe].checked=!0,et?O[xe].shadowRoot.querySelector("button").focus():(O[xe].setAttribute("tabindex","0"),O[xe].focus()),this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),ee.preventDefault()}focus(ee){if(this.disabled)return;const O=this.getAllRadios(),Y=O.find(xe=>xe.checked),te=O.find(xe=>!xe.disabled),ne=Y||te;ne&&ne.focus(ee)}render(){const ee=this.hasUpdated?this.hasSlotController.test("label"):this.withLabel,O=this.hasUpdated?this.hasSlotController.test("hint"):this.withHint,Y=this.label?!0:!!ee,te=this.hint?!0:!!O;return x$1`
      <fieldset
        part="form-control"
        class=${e$5({"form-control":!0,"form-control-radio-group":!0,"form-control-has-label":Y})}
        role="radiogroup"
        aria-labelledby="label"
        aria-describedby="hint"
        aria-errormessage="error-message"
        aria-orientation=${this.orientation}
      >
        <label
          part="form-control-label"
          id="label"
          class="label"
          aria-hidden=${Y?"false":"true"}
          @click=${this.handleLabelClick}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <slot part="form-control-input" @slotchange=${this.syncRadioElements}></slot>

        <slot
          id="hint"
          name="hint"
          part="hint"
          class=${e$5({"has-slotted":te})}
          aria-hidden=${te?"false":"true"}
          >${this.hint}</slot
        >
      </fieldset>
    `}};WaRadioGroup.css=[size_default,form_control_default,radio_group_default];WaRadioGroup.shadowRootOptions={...WebAwesomeFormAssociatedElement.shadowRootOptions,delegatesFocus:!0};__decorateClass$d([e$9("slot:not([name])")],WaRadioGroup.prototype,"defaultSlot",2);__decorateClass$d([n$7()],WaRadioGroup.prototype,"label",2);__decorateClass$d([n$7({attribute:"hint"})],WaRadioGroup.prototype,"hint",2);__decorateClass$d([n$7({reflect:!0})],WaRadioGroup.prototype,"name",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaRadioGroup.prototype,"disabled",2);__decorateClass$d([n$7({reflect:!0})],WaRadioGroup.prototype,"orientation",2);__decorateClass$d([r$6()],WaRadioGroup.prototype,"value",1);__decorateClass$d([n$7({attribute:"value",reflect:!0})],WaRadioGroup.prototype,"defaultValue",2);__decorateClass$d([n$7({reflect:!0})],WaRadioGroup.prototype,"size",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaRadioGroup.prototype,"required",2);__decorateClass$d([n$7({type:Boolean,attribute:"with-label"})],WaRadioGroup.prototype,"withLabel",2);__decorateClass$d([n$7({type:Boolean,attribute:"with-hint"})],WaRadioGroup.prototype,"withHint",2);WaRadioGroup=__decorateClass$d([t$b("wa-radio-group")],WaRadioGroup);var radio_default=`:host {
  --checked-icon-color: var(--wa-form-control-activated-color);
  --checked-icon-scale: 0.7;

  color: var(--wa-form-control-value-color);
  display: inline-flex;
  flex-direction: row;
  align-items: top;
  font-family: inherit;
  font-weight: var(--wa-form-control-value-font-weight);
  line-height: var(--wa-form-control-value-line-height);
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}

:host(:focus) {
  outline: none;
}

/* When the control isn't checked, hide the circle for Windows High Contrast mode a11y */
:host(:not(:state(checked))) svg circle {
  opacity: 0;
}

[part~='label'] {
  display: inline;
}

[part~='hint'] {
  margin-block-start: 0.5em;
}

/* Default spacing for default appearance radios */
:host([appearance='default']) {
  margin-block: 0.375em; /* Half of the original 0.75em gap on each side */
}

:host([appearance='default'][data-wa-radio-horizontal]) {
  margin-block: 0;
  margin-inline: 0.5em; /* Half of the original 1em gap on each side */
}

/* Remove margin from first/last items to prevent extra space */
:host([appearance='default'][data-wa-radio-first]) {
  margin-block-start: 0;
  margin-inline-start: 0;
}

:host([appearance='default'][data-wa-radio-last]) {
  margin-block-end: 0;
  margin-inline-end: 0;
}

/* Button appearance have no spacing, they get handled by the overlap margins below */
:host([appearance='button']) {
  margin: 0;
  align-items: center;
  min-height: var(--wa-form-control-height);
  background-color: var(--wa-color-surface-default);
  border: var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);
  border-radius: var(--wa-border-radius-m);
  padding: 0 var(--wa-form-control-padding-inline);
  transition:
    background-color var(--wa-transition-fast),
    border-color var(--wa-transition-fast);
}

/* Default appearance */
:host([appearance='default']) {
  .control {
    flex: 0 0 auto;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--wa-form-control-toggle-size);
    height: var(--wa-form-control-toggle-size);
    border-color: var(--wa-form-control-border-color);
    border-radius: 50%;
    border-style: var(--wa-form-control-border-style);
    border-width: var(--wa-form-control-border-width);
    background-color: var(--wa-form-control-background-color);
    color: transparent;
    transition:
      background var(--wa-transition-normal),
      border-color var(--wa-transition-fast),
      box-shadow var(--wa-transition-fast),
      color var(--wa-transition-fast);
    transition-timing-function: var(--wa-transition-easing);

    margin-inline-end: 0.5em;
  }

  .checked-icon {
    display: flex;
    fill: currentColor;
    width: var(--wa-form-control-toggle-size);
    height: var(--wa-form-control-toggle-size);
    scale: var(--checked-icon-scale);
  }
}

/* Button appearance */
:host([appearance='button']) {
  .control {
    display: none;
  }
}

/* Checked */
:host(:state(checked)) .control {
  color: var(--checked-icon-color);
  border-color: var(--wa-form-control-activated-color);
  background-color: var(--wa-form-control-background-color);
}

/* Focus */
:host(:focus-visible) .control {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

/* Disabled */
:host(:state(disabled)) {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Horizontal grouping - remove inner border radius */
:host([appearance='button'][data-wa-radio-horizontal][data-wa-radio-inner]) {
  border-radius: 0;
}

:host([appearance='button'][data-wa-radio-horizontal][data-wa-radio-first]) {
  border-start-end-radius: 0;
  border-end-end-radius: 0;
}

:host([appearance='button'][data-wa-radio-horizontal][data-wa-radio-last]) {
  border-start-start-radius: 0;
  border-end-start-radius: 0;
}

/* Vertical grouping - remove inner border radius */
:host([appearance='button'][data-wa-radio-vertical][data-wa-radio-inner]) {
  border-radius: 0;
}

:host([appearance='button'][data-wa-radio-vertical][data-wa-radio-first]) {
  border-end-start-radius: 0;
  border-end-end-radius: 0;
}

:host([appearance='button'][data-wa-radio-vertical][data-wa-radio-last]) {
  border-start-start-radius: 0;
  border-start-end-radius: 0;
}

@media (hover: hover) {
  :host([appearance='button']:hover:not(:state(disabled), :state(checked))) {
    background-color: color-mix(in srgb, var(--wa-color-surface-default) 95%, var(--wa-color-mix-hover));
  }
}

:host([appearance='button']:focus-visible) {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

:host([appearance='button']:state(checked)) {
  border-color: var(--wa-form-control-activated-color);
  background-color: var(--wa-color-brand-fill-quiet);
}

:host([appearance='button']:state(checked):focus-visible) {
  outline: var(--wa-focus-ring-style) var(--wa-focus-ring-width) var(--wa-color-brand-border-loud);
  outline-offset: var(--wa-focus-ring-offset);
}

/* Button overlap margins */
:host([appearance='button'][data-wa-radio-horizontal]:not([data-wa-radio-first])) {
  margin-inline-start: calc(-1 * var(--wa-form-control-border-width));
}

:host([appearance='button'][data-wa-radio-vertical]:not([data-wa-radio-first])) {
  margin-block-start: calc(-1 * var(--wa-form-control-border-width));
}

/* Ensure interactive states are visible above adjacent buttons */
:host([appearance='button']:hover),
:host([appearance='button']:state(checked)) {
  position: relative;
  z-index: 1;
}

:host([appearance='button']:focus-visible) {
  z-index: 2;
}
`,WaRadio=class extends WebAwesomeFormAssociatedElement{constructor(){super(),this.checked=!1,this.forceDisabled=!1,this.form=null,this.appearance="default",this.size="medium",this.disabled=!1,this.handleClick=()=>{!this.disabled&&!this.forceDisabled&&(this.checked=!0)},this.addEventListener("click",this.handleClick)}connectedCallback(){super.connectedCallback(),this.setInitialAttributes()}setInitialAttributes(){this.setAttribute("role","radio"),this.tabIndex=0,this.setAttribute("aria-disabled",this.disabled||this.forceDisabled?"true":"false")}updated(ee){if(super.updated(ee),ee.has("checked")&&(this.customStates.set("checked",this.checked),this.setAttribute("aria-checked",this.checked?"true":"false"),!this.disabled&&!this.forceDisabled&&(this.tabIndex=this.checked?0:-1)),ee.has("disabled")||ee.has("forceDisabled")){const O=this.disabled||this.forceDisabled;this.customStates.set("disabled",O),this.setAttribute("aria-disabled",O?"true":"false"),O?this.tabIndex=-1:this.tabIndex=this.checked?0:-1}}setValue(){}render(){return x$1`
      <span part="control" class="control">
        ${this.checked?x$1`
              <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" part="checked-icon" class="checked-icon">
                <circle cx="8" cy="8" r="8" />
              </svg>
            `:""}
      </span>

      <slot part="label" class="label"></slot>
    `}};WaRadio.css=[form_control_default,size_default,radio_default];__decorateClass$d([r$6()],WaRadio.prototype,"checked",2);__decorateClass$d([r$6()],WaRadio.prototype,"forceDisabled",2);__decorateClass$d([n$7({reflect:!0})],WaRadio.prototype,"form",2);__decorateClass$d([n$7({reflect:!0})],WaRadio.prototype,"value",2);__decorateClass$d([n$7({reflect:!0})],WaRadio.prototype,"appearance",2);__decorateClass$d([n$7({reflect:!0})],WaRadio.prototype,"size",2);__decorateClass$d([n$7({type:Boolean})],WaRadio.prototype,"disabled",2);WaRadio=__decorateClass$d([t$b("wa-radio")],WaRadio);var WaHoverEvent=class extends Event{constructor(ee){super("wa-hover",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},rating_default=`:host {
  --symbol-color: var(--wa-color-neutral-on-quiet);
  --symbol-color-active: var(--wa-color-yellow-70);
  --symbol-spacing: 0.125em;

  display: inline-flex;
}

.rating {
  position: relative;
  display: inline-flex;
  border-radius: var(--wa-border-radius-m);
  vertical-align: middle;
}

.rating:focus {
  outline: none;
}

.rating:focus-visible {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

.symbols {
  display: inline-flex;
  gap: 0.125em;
  position: relative;
  line-height: 0;
  color: var(--symbol-color);
  white-space: nowrap;
  cursor: pointer;
}

.symbols > * {
  padding: var(--symbol-spacing);
}

.symbol-active,
.partial-filled {
  color: var(--symbol-color-active);
}

.partial-symbol-container {
  position: relative;
}

.partial-filled {
  position: absolute;
  top: var(--symbol-spacing);
  left: var(--symbol-spacing);
}

.symbol {
  transition: scale var(--wa-transition-normal) var(--wa-transition-easing);
  pointer-events: none;
}

.symbol-hover {
  scale: 1.2;
}

.rating-readonly .symbols {
  cursor: default;
}

:host([disabled]) .symbol-hover,
.rating-readonly .symbol-hover {
  scale: none;
}

:host([disabled]) {
  opacity: 0.5;
}

:host([disabled]) .symbols {
  cursor: not-allowed;
}

/* Forced colors mode */
@media (forced-colors: active) {
  .symbol-active {
    color: SelectedItem;
  }
}
`,WaRating=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.hoverValue=0,this.isHovering=!1,this.label="",this.value=0,this.max=5,this.precision=1,this.readonly=!1,this.disabled=!1,this.getSymbol=(ee,O)=>O?'<wa-icon name="star" library="system" variant="solid"></wa-icon>':'<wa-icon name="star" library="system" variant="regular"></wa-icon>',this.size="medium"}getValueFromMousePosition(ee){return this.getValueFromXCoordinate(ee.clientX)}getValueFromTouchPosition(ee){return this.getValueFromXCoordinate(ee.touches[0].clientX)}getValueFromXCoordinate(ee){const O=this.localize.dir()==="rtl",{left:Y,right:te,width:ne}=this.rating.getBoundingClientRect(),xe=O?this.roundToPrecision((te-ee)/ne*this.max,this.precision):this.roundToPrecision((ee-Y)/ne*this.max,this.precision);return clamp$3(xe,0,this.max)}handleClick(ee){this.disabled||(this.setValue(this.getValueFromMousePosition(ee)),this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))}setValue(ee){this.disabled||this.readonly||(this.value=ee===this.value?0:ee,this.isHovering=!1)}handleKeyDown(ee){const O=this.matches(":dir(ltr)"),Y=this.localize.dir()==="rtl",te=this.value;if(!(this.disabled||this.readonly)){if(ee.key==="ArrowDown"||O&&ee.key==="ArrowLeft"||Y&&ee.key==="ArrowRight"){const ne=ee.shiftKey?1:this.precision;this.value=Math.max(0,this.value-ne),ee.preventDefault()}if(ee.key==="ArrowUp"||O&&ee.key==="ArrowRight"||Y&&ee.key==="ArrowLeft"){const ne=ee.shiftKey?1:this.precision;this.value=Math.min(this.max,this.value+ne),ee.preventDefault()}ee.key==="Home"&&(this.value=0,ee.preventDefault()),ee.key==="End"&&(this.value=this.max,ee.preventDefault()),this.value!==te&&this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}}handleMouseEnter(ee){this.isHovering=!0,this.hoverValue=this.getValueFromMousePosition(ee)}handleMouseMove(ee){this.hoverValue=this.getValueFromMousePosition(ee)}handleMouseLeave(){this.isHovering=!1}handleTouchStart(ee){this.isHovering=!0,this.hoverValue=this.getValueFromTouchPosition(ee),ee.preventDefault()}handleTouchMove(ee){this.hoverValue=this.getValueFromTouchPosition(ee)}handleTouchEnd(ee){this.isHovering=!1,this.setValue(this.hoverValue),this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),ee.preventDefault()}roundToPrecision(ee,O=.5){const Y=1/O;return Math.ceil(ee*Y)/Y}handleHoverValueChange(){this.dispatchEvent(new WaHoverEvent({phase:"move",value:this.hoverValue}))}handleIsHoveringChange(){this.dispatchEvent(new WaHoverEvent({phase:this.isHovering?"start":"end",value:this.hoverValue}))}focus(ee){this.rating.focus(ee)}blur(){this.rating.blur()}render(){const ee=this.hasUpdated?this.localize.dir()==="rtl":this.dir,O=Array.from(Array(this.max).keys());let Y=0;return this.disabled||this.readonly?Y=this.value:Y=this.isHovering?this.hoverValue:this.value,x$1`
      <div
        part="base"
        class=${e$5({rating:!0,"rating-readonly":this.readonly,"rating-disabled":this.disabled})}
        role="slider"
        aria-label=${this.label}
        aria-disabled=${this.disabled?"true":"false"}
        aria-readonly=${this.readonly?"true":"false"}
        aria-valuenow=${this.value}
        aria-valuemin=${0}
        aria-valuemax=${this.max}
        tabindex=${this.disabled||this.readonly?"-1":"0"}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mouseenter=${this.handleMouseEnter}
        @touchstart=${this.handleTouchStart}
        @mouseleave=${this.handleMouseLeave}
        @touchend=${this.handleTouchEnd}
        @mousemove=${this.handleMouseMove}
        @touchmove=${this.handleTouchMove}
      >
        <span class="symbols">
          ${O.map(te=>{const ne=Y>=te+1;return Y>te&&Y<te+1?x$1`
                <span
                  class=${e$5({symbol:!0,"partial-symbol-container":!0,"symbol-hover":this.isHovering&&Math.ceil(Y)===te+1})}
                  role="presentation"
                >
                  <div
                    style=${o$7({clipPath:ee?`inset(0 ${(Y-te)*100}% 0 0)`:`inset(0 0 0 ${(Y-te)*100}%)`})}
                  >
                    ${o$5(this.getSymbol(te+1,!1))}
                  </div>
                  <div
                    class="partial-filled"
                    style=${o$7({clipPath:ee?`inset(0 0 0 ${100-(Y-te)*100}%)`:`inset(0 ${100-(Y-te)*100}% 0 0)`})}
                  >
                    ${o$5(this.getSymbol(te+1,!0))}
                  </div>
                </span>
              `:x$1`
              <span
                class=${e$5({symbol:!0,"symbol-hover":this.isHovering&&Math.ceil(Y)===te+1,"symbol-active":Y>=te+1})}
                role="presentation"
              >
                ${o$5(this.getSymbol(te+1,ne))}
              </span>
            `})}
        </span>
      </div>
    `}};WaRating.css=[size_default,rating_default];__decorateClass$d([e$9(".rating")],WaRating.prototype,"rating",2);__decorateClass$d([r$6()],WaRating.prototype,"hoverValue",2);__decorateClass$d([r$6()],WaRating.prototype,"isHovering",2);__decorateClass$d([n$7()],WaRating.prototype,"label",2);__decorateClass$d([n$7({type:Number})],WaRating.prototype,"value",2);__decorateClass$d([n$7({type:Number})],WaRating.prototype,"max",2);__decorateClass$d([n$7({type:Number})],WaRating.prototype,"precision",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaRating.prototype,"readonly",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaRating.prototype,"disabled",2);__decorateClass$d([n$7()],WaRating.prototype,"getSymbol",2);__decorateClass$d([n$7({reflect:!0})],WaRating.prototype,"size",2);__decorateClass$d([t$a({passive:!0})],WaRating.prototype,"handleTouchMove",1);__decorateClass$d([watch("hoverValue")],WaRating.prototype,"handleHoverValueChange",1);__decorateClass$d([watch("isHovering")],WaRating.prototype,"handleIsHoveringChange",1);WaRating=__decorateClass$d([t$b("wa-rating")],WaRating);var availableUnits=[{max:276e4,value:6e4,unit:"minute"},{max:72e6,value:36e5,unit:"hour"},{max:5184e5,value:864e5,unit:"day"},{max:24192e5,value:6048e5,unit:"week"},{max:28512e6,value:2592e6,unit:"month"},{max:1/0,value:31536e6,unit:"year"}],WaRelativeTime=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.isoTime="",this.relativeTime="",this.date=new Date,this.format="long",this.numeric="auto",this.sync=!1}disconnectedCallback(){super.disconnectedCallback(),clearTimeout(this.updateTimeout)}render(){const ee=new Date,O=new Date(this.date);if(isNaN(O.getMilliseconds()))return this.relativeTime="",this.isoTime="","";const Y=O.getTime()-ee.getTime(),{unit:te,value:ne}=availableUnits.find(xe=>Math.abs(Y)<xe.max);if(this.isoTime=O.toISOString(),this.relativeTime=this.localize.relativeTime(Math.round(Y/ne),te,{numeric:this.numeric,style:this.format}),clearTimeout(this.updateTimeout),this.sync){let xe;te==="minute"?xe=getTimeUntilNextUnit("second"):te==="hour"?xe=getTimeUntilNextUnit("minute"):te==="day"?xe=getTimeUntilNextUnit("hour"):xe=getTimeUntilNextUnit("day"),this.updateTimeout=setTimeout(()=>this.requestUpdate(),xe)}return x$1`<time datetime=${this.isoTime}>${this.relativeTime}</time>`}};__decorateClass$d([r$6()],WaRelativeTime.prototype,"isoTime",2);__decorateClass$d([r$6()],WaRelativeTime.prototype,"relativeTime",2);__decorateClass$d([n$7()],WaRelativeTime.prototype,"date",2);__decorateClass$d([n$7()],WaRelativeTime.prototype,"format",2);__decorateClass$d([n$7()],WaRelativeTime.prototype,"numeric",2);__decorateClass$d([n$7({type:Boolean})],WaRelativeTime.prototype,"sync",2);WaRelativeTime=__decorateClass$d([t$b("wa-relative-time")],WaRelativeTime);function getTimeUntilNextUnit(ee){const Y={second:1e3,minute:6e4,hour:36e5,day:864e5}[ee];return Y-Date.now()%Y}var WaResizeEvent=class extends Event{constructor(ee){super("wa-resize",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},resize_observer_default=`:host {
  display: contents;
}
`,WaResizeObserver=class extends WebAwesomeElement{constructor(){super(...arguments),this.observedElements=[],this.disabled=!1}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(ee=>{this.dispatchEvent(new WaResizeEvent({entries:ee}))}),this.disabled||this.updateComplete.then(()=>{this.startObserver()})}disconnectedCallback(){super.disconnectedCallback(),this.stopObserver()}handleSlotChange(){this.disabled||this.startObserver()}startObserver(){const ee=this.shadowRoot.querySelector("slot");if(ee!==null){const O=ee.assignedElements({flatten:!0});this.observedElements.forEach(Y=>this.resizeObserver.unobserve(Y)),this.observedElements=[],O.forEach(Y=>{this.resizeObserver.observe(Y),this.observedElements.push(Y)})}}stopObserver(){this.resizeObserver.disconnect()}handleDisabledChange(){this.disabled?this.stopObserver():this.startObserver()}render(){return x$1` <slot @slotchange=${this.handleSlotChange}></slot> `}};WaResizeObserver.css=resize_observer_default;__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaResizeObserver.prototype,"disabled",2);__decorateClass$d([watch("disabled",{waitUntilFirstUpdate:!0})],WaResizeObserver.prototype,"handleDisabledChange",1);WaResizeObserver=__decorateClass$d([t$b("wa-resize-observer")],WaResizeObserver);var scroller_default=`:host {
  --shadow-color: var(--wa-color-surface-default);
  --shadow-size: 2rem;

  /* private (defined dynamically) */
  --start-shadow-opacity: 0;
  --end-shadow-opacity: 0;

  display: block;
  position: relative;
  max-width: 100%;
  isolation: isolate;
}

:host([orientation='vertical']) {
  display: flex;
  flex-direction: column;
  height: 100%;
}

#content {
  z-index: 1; /* below shadows */
  border-radius: inherit;
  scroll-behavior: smooth;
  scrollbar-width: thin;

  /* Prevent text in mobile Safari from being larger when the container width larger than the viewport */
  -webkit-text-size-adjust: 100%;

  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: var(--wa-focus-ring);
    outline-offset: var(--wa-focus-ring-offset);
  }
}

:host([without-scrollbar]) #content {
  scrollbar-width: none;
}

:host([orientation='horizontal']) #content {
  overflow-x: auto;
  overflow-y: hidden;
}

:host([orientation='vertical']) #content {
  flex: 1 1 auto;
  min-height: 0; /* This is crucial for flex children to respect overflow */
  overflow-x: hidden;
  overflow-y: auto;
}

/* Horizontal shadows */
:host([orientation='horizontal']) {
  #start-shadow,
  #end-shadow {
    position: absolute;
    top: 0;
    bottom: 0;
    width: var(--shadow-size);
    pointer-events: none;
  }

  #start-shadow {
    opacity: var(--start-shadow-opacity);
  }

  #end-shadow {
    opacity: var(--end-shadow-opacity);
  }

  #start-shadow {
    &:dir(ltr) {
      left: 0;
      background: linear-gradient(to right, var(--shadow-color), transparent 100%);
    }

    &:dir(rtl) {
      right: 0;
      background: linear-gradient(to left, var(--shadow-color), transparent 100%);
    }
  }

  #end-shadow {
    &:dir(ltr) {
      right: 0;
      background: linear-gradient(to left, var(--shadow-color), transparent 100%);
    }

    &:dir(rtl) {
      left: 0;
      background: linear-gradient(to right, var(--shadow-color), transparent 100%);
    }
  }
}

/* Vertical shadows */
:host([orientation='vertical']) {
  #start-shadow,
  #end-shadow {
    position: absolute;
    z-index: 2;
    right: 0;
    left: 0;
    height: var(--shadow-size);
    pointer-events: none;
  }

  #start-shadow {
    opacity: var(--start-shadow-opacity);
  }

  #end-shadow {
    opacity: var(--end-shadow-opacity);
  }

  #start-shadow {
    top: 0;
    background: linear-gradient(to bottom, var(--shadow-color), transparent 100%);
  }

  #end-shadow {
    bottom: 0;
    background: linear-gradient(to top, var(--shadow-color), transparent 100%);
  }
}
`,WaScroller=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.resizeObserver=new ResizeObserver(()=>this.updateScroll()),this.canScroll=!1,this.orientation="horizontal",this.withoutScrollbar=!1,this.withoutShadow=!1}connectedCallback(){super.connectedCallback(),this.resizeObserver.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver.disconnect()}handleKeyDown(ee){ee.key==="Home"&&(ee.preventDefault(),this.content.scrollTo({left:this.orientation==="horizontal"?0:void 0,top:this.orientation==="vertical"?0:void 0})),ee.key==="End"&&(ee.preventDefault(),this.content.scrollTo({left:this.orientation==="horizontal"?this.content.scrollWidth:void 0,top:this.orientation==="vertical"?this.content.scrollHeight:void 0}))}handleSlotChange(){this.updateScroll()}updateScroll(){if(this.orientation==="horizontal"){const ee=Math.ceil(this.content.clientWidth),O=Math.abs(Math.ceil(this.content.scrollLeft)),te=Math.ceil(this.content.scrollWidth)-ee;this.canScroll=te>0;const ne=Math.min(1,O/(te*.05)),xe=Math.min(1,(te-O)/(te*.05));this.style.setProperty("--start-shadow-opacity",String(ne||0)),this.style.setProperty("--end-shadow-opacity",String(xe||0))}else{const ee=Math.ceil(this.content.clientHeight),O=Math.abs(Math.ceil(this.content.scrollTop)),te=Math.ceil(this.content.scrollHeight)-ee;this.canScroll=te>0;const ne=Math.min(1,O/(te*.05)),xe=Math.min(1,(te-O)/(te*.05));this.style.setProperty("--start-shadow-opacity",String(ne||0)),this.style.setProperty("--end-shadow-opacity",String(xe||0))}}render(){return x$1`
      ${this.withoutShadow?"":x$1`
            <div id="start-shadow" part="start-shadow" aria-hidden="true"></div>
            <div id="end-shadow" part="end-shadow" aria-hidden="true"></div>
          `}

      <div
        id="content"
        part="content"
        role="region"
        aria-label=${this.localize.term("scrollableRegion")}
        aria-orientation=${this.orientation}
        tabindex=${this.canScroll?"0":"-1"}
        @keydown=${this.handleKeyDown}
        @scroll=${this.updateScroll}
      >
        <slot @slotchange=${this.handleSlotChange}></slot>
      </div>
    `}};WaScroller.css=[scroller_default];__decorateClass$d([e$9("#content")],WaScroller.prototype,"content",2);__decorateClass$d([r$6()],WaScroller.prototype,"canScroll",2);__decorateClass$d([n$7({reflect:!0})],WaScroller.prototype,"orientation",2);__decorateClass$d([n$7({attribute:"without-scrollbar",type:Boolean,reflect:!0})],WaScroller.prototype,"withoutScrollbar",2);__decorateClass$d([n$7({attribute:"without-shadow",type:Boolean,reflect:!0})],WaScroller.prototype,"withoutShadow",2);__decorateClass$d([t$a({passive:!0})],WaScroller.prototype,"updateScroll",1);WaScroller=__decorateClass$d([t$b("wa-scroller")],WaScroller);var select_default=`:host {
  --tag-max-size: 10ch;
  --show-duration: 100ms;
  --hide-duration: 100ms;
}

/* Add ellipses to multi select options */
:host wa-tag::part(content) {
  display: initial;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  max-width: var(--tag-max-size);
}

:host .disabled [part~='combobox'] {
  opacity: 0.5;
  cursor: not-allowed;
  outline: none;
}

:host .enabled:is(.open, :focus-within) [part~='combobox'] {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

/** The popup */
.select {
  flex: 1 1 auto;
  display: inline-flex;
  width: 100%;
  position: relative;
  vertical-align: middle;

  /* Pass through from select to the popup */
  --show-duration: inherit;
  --hide-duration: inherit;

  &::part(popup) {
    z-index: 900;
  }

  &[data-current-placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  &[data-current-placement^='bottom']::part(popup) {
    transform-origin: top;
  }
}

/* Combobox */
.combobox {
  flex: 1;
  display: flex;
  width: 100%;
  min-width: 0;
  align-items: center;
  justify-content: start;

  min-height: var(--wa-form-control-height);

  background-color: var(--wa-form-control-background-color);
  border-color: var(--wa-form-control-border-color);
  border-radius: var(--wa-form-control-border-radius);
  border-style: var(--wa-form-control-border-style);
  border-width: var(--wa-form-control-border-width);
  color: var(--wa-form-control-value-color);
  cursor: pointer;
  font-family: inherit;
  font-weight: var(--wa-form-control-value-font-weight);
  line-height: var(--wa-form-control-value-line-height);
  overflow: hidden;
  padding: 0 var(--wa-form-control-padding-inline);
  position: relative;
  vertical-align: middle;
  width: 100%;
  transition:
    background-color var(--wa-transition-normal),
    border var(--wa-transition-normal),
    outline var(--wa-transition-fast);
  transition-timing-function: var(--wa-transition-easing);

  :host([multiple]) .select:not(.placeholder-visible) & {
    padding-inline-start: 0;
    padding-block: calc(var(--wa-form-control-height) * 0.1 - var(--wa-form-control-border-width));
  }

  /* Pills */
  :host([pill]) & {
    border-radius: var(--wa-border-radius-pill);
  }
}

/* Appearance modifiers */
:host([appearance='outlined']) .combobox {
  background-color: var(--wa-form-control-background-color);
  border-color: var(--wa-form-control-border-color);
}

:host([appearance='filled']) .combobox {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-color-neutral-fill-quiet);
}

:host([appearance='filled-outlined']) .combobox {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-form-control-border-color);
}

.display-input {
  position: relative;
  width: 100%;
  font: inherit;
  border: none;
  background: none;
  line-height: var(--wa-form-control-value-line-height);
  color: var(--wa-form-control-value-color);
  cursor: inherit;
  overflow: hidden;
  padding: 0;
  margin: 0;
  -webkit-appearance: none;

  &:focus {
    outline: none;
  }

  &::placeholder {
    color: var(--wa-form-control-placeholder-color);
  }
}

/* Visually hide the display input when multiple is enabled */
:host([multiple]) .select:not(.placeholder-visible) .display-input {
  position: absolute;
  z-index: -1;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
}

.value-input {
  position: absolute;
  z-index: -1;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  padding: 0;
  margin: 0;
}

.tags {
  display: flex;
  flex: 1;
  align-items: center;
  flex-wrap: wrap;
  margin-inline-start: 0.25em;
  gap: 0.25em;

  &::slotted(wa-tag) {
    cursor: pointer !important;
  }

  .disabled &,
  .disabled &::slotted(wa-tag) {
    cursor: not-allowed !important;
  }
}

/* Start and End */

.start,
.end {
  flex: 0;
  display: inline-flex;
  align-items: center;
  color: var(--wa-color-neutral-on-quiet);
}

.end::slotted(*) {
  margin-inline-start: var(--wa-form-control-padding-inline);
}

.start::slotted(*) {
  margin-inline-end: var(--wa-form-control-padding-inline);
}

:host([multiple]) .start::slotted(*) {
  margin-inline: var(--wa-form-control-padding-inline);
}

/* Clear button */
[part~='clear-button'] {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: inherit;
  color: var(--wa-color-neutral-on-quiet);
  border: none;
  background: none;
  padding: 0;
  transition: color var(--wa-transition-normal);
  cursor: pointer;
  margin-inline-start: var(--wa-form-control-padding-inline);

  &:focus {
    outline: none;
  }

  @media (hover: hover) {
    &:hover {
      color: color-mix(in oklab, currentColor, var(--wa-color-mix-hover));
    }
  }

  &:active {
    color: color-mix(in oklab, currentColor, var(--wa-color-mix-active));
  }
}

/* Expand icon */
.expand-icon {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  color: var(--wa-color-neutral-on-quiet);
  transition: rotate var(--wa-transition-slow) ease;
  rotate: 0deg;
  margin-inline-start: var(--wa-form-control-padding-inline);

  .open & {
    rotate: -180deg;
  }
}

/* Listbox */
.listbox {
  display: block;
  position: relative;
  font: inherit;
  box-shadow: var(--wa-shadow-m);
  background: var(--wa-color-surface-raised);
  border-color: var(--wa-color-surface-border);
  border-radius: var(--wa-border-radius-m);
  border-style: var(--wa-border-style);
  border-width: var(--wa-border-width-s);
  padding-block: 0.5em;
  padding-inline: 0;
  overflow: auto;
  overscroll-behavior: none;

  /* Make sure it adheres to the popup's auto size */
  max-width: var(--auto-size-available-width);
  max-height: var(--auto-size-available-height);

  &::slotted(wa-divider) {
    --spacing: 0.5em;
  }
}

slot:not([name])::slotted(small) {
  display: block;
  font-size: var(--wa-font-size-smaller);
  font-weight: var(--wa-font-weight-semibold);
  color: var(--wa-color-text-quiet);
  padding-block: 0.5em;
  padding-inline: 2.25em;
}
`,WaSelect=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.assumeInteractionOn=["blur","input"],this.hasSlotController=new HasSlotController(this,"hint","label"),this.localize=new LocalizeController(this),this.typeToSelectString="",this.displayLabel="",this.selectedOptions=[],this.name="",this._defaultValue=null,this.size="medium",this.placeholder="",this.multiple=!1,this.maxOptionsVisible=3,this.disabled=!1,this.withClear=!1,this.open=!1,this.appearance="outlined",this.pill=!1,this.label="",this.placement="bottom",this.hint="",this.withLabel=!1,this.withHint=!1,this.form=null,this.required=!1,this.getTag=ee=>x$1`
        <wa-tag
          part="tag"
          exportparts="
            base:tag__base,
            content:tag__content,
            remove-button:tag__remove-button,
            remove-button__base:tag__remove-button__base
          "
          ?pill=${this.pill}
          size=${this.size}
          with-remove
        >
          ${ee.label}
        </wa-tag>
      `,this.handleDocumentFocusIn=ee=>{const O=ee.composedPath();this&&!O.includes(this)&&this.hide()},this.handleDocumentKeyDown=ee=>{const O=ee.target,Y=O.closest('[part~="clear-button"]')!==null,te=O.closest("wa-button")!==null;if(!(Y||te)){if(ee.key==="Escape"&&this.open&&(ee.preventDefault(),ee.stopPropagation(),this.hide(),this.displayInput.focus({preventScroll:!0})),ee.key==="Enter"||ee.key===" "&&this.typeToSelectString===""){if(ee.preventDefault(),ee.stopImmediatePropagation(),!this.open){this.show();return}this.currentOption&&!this.currentOption.disabled&&(this.valueHasChanged=!0,this.hasInteracted=!0,this.multiple?this.toggleOptionSelection(this.currentOption):this.setSelectedOptions(this.currentOption),this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.multiple||(this.hide(),this.displayInput.focus({preventScroll:!0})));return}if(["ArrowUp","ArrowDown","Home","End"].includes(ee.key)){const ne=this.getAllOptions(),xe=ne.indexOf(this.currentOption);let et=Math.max(0,xe);if(ee.preventDefault(),!this.open&&(this.show(),this.currentOption))return;ee.key==="ArrowDown"?(et=xe+1,et>ne.length-1&&(et=0)):ee.key==="ArrowUp"?(et=xe-1,et<0&&(et=ne.length-1)):ee.key==="Home"?et=0:ee.key==="End"&&(et=ne.length-1),this.setCurrentOption(ne[et])}if(ee.key?.length===1||ee.key==="Backspace"){const ne=this.getAllOptions();if(ee.metaKey||ee.ctrlKey||ee.altKey)return;if(!this.open){if(ee.key==="Backspace")return;this.show()}ee.stopPropagation(),ee.preventDefault(),clearTimeout(this.typeToSelectTimeout),this.typeToSelectTimeout=window.setTimeout(()=>this.typeToSelectString="",1e3),ee.key==="Backspace"?this.typeToSelectString=this.typeToSelectString.slice(0,-1):this.typeToSelectString+=ee.key.toLowerCase();for(const xe of ne)if(xe.label.toLowerCase().startsWith(this.typeToSelectString)){this.setCurrentOption(xe);break}}}},this.handleDocumentMouseDown=ee=>{const O=ee.composedPath();this&&!O.includes(this)&&this.hide()}}static get validators(){const ee=[RequiredValidator({validationElement:Object.assign(document.createElement("select"),{required:!0})})];return[...super.validators,...ee]}get validationTarget(){return this.valueInput}set defaultValue(ee){this._defaultValue=this.convertDefaultValue(ee)}get defaultValue(){return this.convertDefaultValue(this._defaultValue)}convertDefaultValue(ee){return!(this.multiple||this.hasAttribute("multiple"))&&Array.isArray(ee)&&(ee=ee[0]),ee}set value(ee){let O=this.value;ee instanceof FormData&&(ee=ee.getAll(this.name)),ee!=null&&!Array.isArray(ee)&&(ee=[ee]),this._value=ee??null,this.value!==O&&(this.valueHasChanged=!0,this.requestUpdate("value",O))}get value(){let ee=this._value??this.defaultValue??null;ee!=null&&(ee=Array.isArray(ee)?ee:[ee]),ee==null?this.optionValues=new Set(null):this.optionValues=new Set(this.getAllOptions().filter(Y=>!Y.disabled).map(Y=>Y.value));let O=ee;return ee!=null&&(O=ee.filter(Y=>this.optionValues.has(Y)),O=this.multiple?O:O[0],O=O??null),O}connectedCallback(){super.connectedCallback(),this.handleDefaultSlotChange(),this.open=!1}updateDefaultValue(){const O=this.getAllOptions().filter(Y=>Y.hasAttribute("selected")||Y.defaultSelected);if(O.length>0){const Y=O.map(te=>te.value);this._defaultValue=this.multiple?Y:Y[0]}this.hasAttribute("value")&&(this._defaultValue=this.getAttribute("value")||null)}addOpenListeners(){document.addEventListener("focusin",this.handleDocumentFocusIn),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("mousedown",this.handleDocumentMouseDown),this.getRootNode()!==document&&this.getRootNode().addEventListener("focusin",this.handleDocumentFocusIn)}removeOpenListeners(){document.removeEventListener("focusin",this.handleDocumentFocusIn),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("mousedown",this.handleDocumentMouseDown),this.getRootNode()!==document&&this.getRootNode().removeEventListener("focusin",this.handleDocumentFocusIn)}handleFocus(){this.displayInput.setSelectionRange(0,0)}handleLabelClick(){this.displayInput.focus()}handleComboboxClick(ee){ee.preventDefault()}handleComboboxMouseDown(ee){const Y=ee.composedPath().some(te=>te instanceof Element&&te.tagName.toLowerCase()==="wa-button");this.disabled||Y||(ee.preventDefault(),this.displayInput.focus({preventScroll:!0}),this.open=!this.open)}handleComboboxKeyDown(ee){ee.stopPropagation(),this.handleDocumentKeyDown(ee)}handleClearClick(ee){ee.stopPropagation(),this.value!==null&&(this.setSelectedOptions([]),this.displayInput.focus({preventScroll:!0}),this.updateComplete.then(()=>{this.dispatchEvent(new WaClearEvent),this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))}handleClearMouseDown(ee){ee.stopPropagation(),ee.preventDefault()}handleOptionClick(ee){const Y=ee.target.closest("wa-option");Y&&!Y.disabled&&(this.hasInteracted=!0,this.valueHasChanged=!0,this.multiple?this.toggleOptionSelection(Y):this.setSelectedOptions(Y),this.updateComplete.then(()=>this.displayInput.focus({preventScroll:!0})),this.requestUpdate("value"),this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.multiple||(this.hide(),this.displayInput.focus({preventScroll:!0})))}handleDefaultSlotChange(){customElements.get("wa-option")||customElements.whenDefined("wa-option").then(()=>this.handleDefaultSlotChange());const ee=this.getAllOptions();this.optionValues=void 0,this.updateDefaultValue();let O=this.value;if(O==null||!this.valueHasChanged&&!this.hasInteracted){this.selectionChanged();return}Array.isArray(O)||(O=[O]);const Y=ee.filter(te=>O.includes(te.value));this.setSelectedOptions(Y)}handleTagRemove(ee,O){if(ee.stopPropagation(),this.disabled)return;let Y=O;if(!Y){const te=ee.target.closest("wa-tag[part~=tag]");if(te){const ne=this.shadowRoot?.querySelector('[part="tags"]');if(ne){const et=Array.from(ne.children).indexOf(te);et>=0&&et<this.selectedOptions.length&&(Y=this.selectedOptions[et])}}}Y&&(this.toggleOptionSelection(Y,!1),this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}))}getAllOptions(){return this?.querySelectorAll?[...this.querySelectorAll("wa-option")]:[]}getFirstOption(){return this.querySelector("wa-option")}setCurrentOption(ee){this.getAllOptions().forEach(Y=>{Y.current=!1,Y.tabIndex=-1}),ee&&(this.currentOption=ee,ee.current=!0,ee.tabIndex=0,ee.focus())}setSelectedOptions(ee){const O=this.getAllOptions(),Y=Array.isArray(ee)?ee:[ee];O.forEach(te=>{Y.includes(te)||(te.selected=!1)}),Y.length&&Y.forEach(te=>te.selected=!0),this.selectionChanged()}toggleOptionSelection(ee,O){O===!0||O===!1?ee.selected=O:ee.selected=!ee.selected,this.selectionChanged()}selectionChanged(){const ee=this.getAllOptions();this.selectedOptions=ee.filter(Y=>{if(!this.hasInteracted&&!this.valueHasChanged){const te=this.defaultValue,ne=Array.isArray(te)?te:[te];return Y.hasAttribute("selected")||Y.defaultSelected||Y.selected||ne?.includes(Y.value)}return Y.selected});let O=new Set(this.selectedOptions.map(Y=>Y.value));if(O.size>0||this._value){const Y=this._value;if(this._value==null){let te=this.defaultValue??[];this._value=Array.isArray(te)?te:[te]}this._value=this._value?.filter(te=>!this.optionValues?.has(te))??null,this._value?.unshift(...O),this.requestUpdate("value",Y)}if(this.multiple)this.placeholder&&!this.value?.length?this.displayLabel="":this.displayLabel=this.localize.term("numOptionsSelected",this.selectedOptions.length);else{const Y=this.selectedOptions[0];this.displayLabel=Y?.label??""}this.updateComplete.then(()=>{this.updateValidity()})}get tags(){return this.selectedOptions.map((ee,O)=>{if(O<this.maxOptionsVisible||this.maxOptionsVisible<=0){const Y=this.getTag(ee,O);return Y?typeof Y=="string"?o$5(Y):Y:null}else if(O===this.maxOptionsVisible)return x$1`
          <wa-tag
            part="tag"
            exportparts="
              base:tag__base,
              content:tag__content,
              remove-button:tag__remove-button,
              remove-button__base:tag__remove-button__base
            "
            >+${this.selectedOptions.length-O}</wa-tag
          >
        `;return null})}updated(ee){super.updated(ee),ee.has("value")&&this.customStates.set("blank",!this.value)}handleDisabledChange(){this.disabled&&this.open&&(this.open=!1)}handleValueChange(){const ee=this.getAllOptions(),O=Array.isArray(this.value)?this.value:[this.value],Y=ee.filter(te=>O.includes(te.value));this.setSelectedOptions(Y),this.updateValidity()}async handleOpenChange(){if(this.open&&!this.disabled){this.setCurrentOption(this.selectedOptions[0]||this.getFirstOption());const ee=new WaShowEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}this.addOpenListeners(),this.listbox.hidden=!1,this.popup.active=!0,requestAnimationFrame(()=>{this.setCurrentOption(this.currentOption)}),await animateWithClass(this.popup.popup,"show"),this.currentOption&&scrollIntoView(this.currentOption,this.listbox,"vertical","auto"),this.dispatchEvent(new WaAfterShowEvent)}else{const ee=new WaHideEvent;if(this.dispatchEvent(ee),ee.defaultPrevented){this.open=!1;return}this.removeOpenListeners(),await animateWithClass(this.popup.popup,"hide"),this.listbox.hidden=!0,this.popup.active=!1,this.dispatchEvent(new WaAfterHideEvent)}}async show(){if(this.open||this.disabled){this.open=!1;return}return this.open=!0,waitForEvent(this,"wa-after-show")}async hide(){if(!this.open||this.disabled){this.open=!1;return}return this.open=!1,waitForEvent(this,"wa-after-hide")}focus(ee){this.displayInput.focus(ee)}blur(){this.displayInput.blur()}formResetCallback(){this.value=this.defaultValue,super.formResetCallback(),this.handleValueChange(),this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}render(){const ee=this.hasUpdated?this.hasSlotController.test("label"):this.withLabel,O=this.hasUpdated?this.hasSlotController.test("hint"):this.withHint,Y=this.label?!0:!!ee,te=this.hint?!0:!!O,ne=(this.hasUpdated||o$a)&&this.withClear&&!this.disabled&&this.value&&this.value.length>0,xe=!!(this.placeholder&&(!this.value||this.value.length===0));return x$1`
      <div
        part="form-control"
        class=${e$5({"form-control":!0,"form-control-has-label":Y})}
      >
        <label
          id="label"
          part="form-control-label label"
          class="label"
          aria-hidden=${Y?"false":"true"}
          @click=${this.handleLabelClick}
        >
          <slot name="label">${this.label}</slot>
        </label>

        <div part="form-control-input" class="form-control-input">
          <wa-popup
            class=${e$5({select:!0,open:this.open,disabled:this.disabled,enabled:!this.disabled,multiple:this.multiple,"placeholder-visible":xe})}
            placement=${this.placement}
            flip
            shift
            sync="width"
            auto-size="vertical"
            auto-size-padding="10"
          >
            <div
              part="combobox"
              class="combobox"
              slot="anchor"
              @keydown=${this.handleComboboxKeyDown}
              @mousedown=${this.handleComboboxMouseDown}
              @click=${this.handleComboboxClick}
            >
              <slot part="start" name="start" class="start"></slot>

              <input
                part="display-input"
                class="display-input"
                type="text"
                placeholder=${this.placeholder}
                .disabled=${this.disabled}
                .value=${this.displayLabel}
                ?required=${this.required}
                autocomplete="off"
                spellcheck="false"
                autocapitalize="off"
                readonly
                aria-invalid=${!this.validity.valid}
                aria-controls="listbox"
                aria-expanded=${this.open?"true":"false"}
                aria-haspopup="listbox"
                aria-labelledby="label"
                aria-disabled=${this.disabled?"true":"false"}
                aria-describedby="hint"
                role="combobox"
                tabindex="0"
                @focus=${this.handleFocus}
              />

              <!-- Tags need to wait for first hydration before populating otherwise it will create a hydration mismatch. -->
              ${this.multiple&&this.hasUpdated?x$1`<div part="tags" class="tags" @wa-remove=${this.handleTagRemove}>${this.tags}</div>`:""}

              <input
                class="value-input"
                type="text"
                ?disabled=${this.disabled}
                ?required=${this.required}
                .value=${Array.isArray(this.value)?this.value.join(", "):this.value}
                tabindex="-1"
                aria-hidden="true"
                @focus=${()=>this.focus()}
              />

              ${ne?x$1`
                    <button
                      part="clear-button"
                      type="button"
                      aria-label=${this.localize.term("clearEntry")}
                      @mousedown=${this.handleClearMouseDown}
                      @click=${this.handleClearClick}
                      tabindex="-1"
                    >
                      <slot name="clear-icon">
                        <wa-icon name="circle-xmark" library="system" variant="regular"></wa-icon>
                      </slot>
                    </button>
                  `:""}

              <slot name="end" part="end" class="end"></slot>

              <slot name="expand-icon" part="expand-icon" class="expand-icon">
                <wa-icon library="system" name="chevron-down" variant="solid"></wa-icon>
              </slot>
            </div>

            <div
              id="listbox"
              role="listbox"
              aria-expanded=${this.open?"true":"false"}
              aria-multiselectable=${this.multiple?"true":"false"}
              aria-labelledby="label"
              part="listbox"
              class="listbox"
              tabindex="-1"
              @mouseup=${this.handleOptionClick}
            >
              <slot @slotchange=${this.handleDefaultSlotChange}></slot>
            </div>
          </wa-popup>
        </div>

        <slot
          id="hint"
          name="hint"
          part="hint"
          class=${e$5({"has-slotted":te})}
          aria-hidden=${te?"false":"true"}
          >${this.hint}</slot
        >
      </div>
    `}};WaSelect.css=[select_default,form_control_default,size_default];__decorateClass$d([e$9(".select")],WaSelect.prototype,"popup",2);__decorateClass$d([e$9(".combobox")],WaSelect.prototype,"combobox",2);__decorateClass$d([e$9(".display-input")],WaSelect.prototype,"displayInput",2);__decorateClass$d([e$9(".value-input")],WaSelect.prototype,"valueInput",2);__decorateClass$d([e$9(".listbox")],WaSelect.prototype,"listbox",2);__decorateClass$d([r$6()],WaSelect.prototype,"displayLabel",2);__decorateClass$d([r$6()],WaSelect.prototype,"currentOption",2);__decorateClass$d([r$6()],WaSelect.prototype,"selectedOptions",2);__decorateClass$d([r$6()],WaSelect.prototype,"optionValues",2);__decorateClass$d([n$7()],WaSelect.prototype,"name",2);__decorateClass$d([n$7({attribute:!1})],WaSelect.prototype,"defaultValue",1);__decorateClass$d([n$7({attribute:"value",reflect:!1})],WaSelect.prototype,"value",1);__decorateClass$d([n$7({reflect:!0})],WaSelect.prototype,"size",2);__decorateClass$d([n$7()],WaSelect.prototype,"placeholder",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSelect.prototype,"multiple",2);__decorateClass$d([n$7({attribute:"max-options-visible",type:Number})],WaSelect.prototype,"maxOptionsVisible",2);__decorateClass$d([n$7({type:Boolean})],WaSelect.prototype,"disabled",2);__decorateClass$d([n$7({attribute:"with-clear",type:Boolean})],WaSelect.prototype,"withClear",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSelect.prototype,"open",2);__decorateClass$d([n$7({reflect:!0})],WaSelect.prototype,"appearance",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSelect.prototype,"pill",2);__decorateClass$d([n$7()],WaSelect.prototype,"label",2);__decorateClass$d([n$7({reflect:!0})],WaSelect.prototype,"placement",2);__decorateClass$d([n$7({attribute:"hint"})],WaSelect.prototype,"hint",2);__decorateClass$d([n$7({attribute:"with-label",type:Boolean})],WaSelect.prototype,"withLabel",2);__decorateClass$d([n$7({attribute:"with-hint",type:Boolean})],WaSelect.prototype,"withHint",2);__decorateClass$d([n$7({reflect:!0})],WaSelect.prototype,"form",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSelect.prototype,"required",2);__decorateClass$d([n$7({attribute:!1})],WaSelect.prototype,"getTag",2);__decorateClass$d([watch("disabled",{waitUntilFirstUpdate:!0})],WaSelect.prototype,"handleDisabledChange",1);__decorateClass$d([watch("value",{waitUntilFirstUpdate:!0})],WaSelect.prototype,"handleValueChange",1);__decorateClass$d([watch("open",{waitUntilFirstUpdate:!0})],WaSelect.prototype,"handleOpenChange",1);WaSelect=__decorateClass$d([t$b("wa-select")],WaSelect);var WaRemoveEvent=class extends Event{constructor(){super("wa-remove",{bubbles:!0,cancelable:!1,composed:!0})}},tag_default=`@layer wa-component {
  :host {
    display: inline-flex;
    gap: 0.5em;
    border-radius: var(--wa-border-radius-m);
    align-items: center;
    background-color: var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet));
    border-color: var(--wa-color-border-normal, var(--wa-color-neutral-border-normal));
    border-style: var(--wa-border-style);
    border-width: var(--wa-border-width-s);
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    font-size: inherit;
    line-height: 1;
    white-space: nowrap;
    user-select: none;
    -webkit-user-select: none;
    height: calc(var(--wa-form-control-height) * 0.8);
    line-height: calc(var(--wa-form-control-height) - var(--wa-form-control-border-width) * 2);
    padding: 0 0.75em;
  }

  /* Appearance modifiers */
  :host([appearance='outlined']) {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: transparent;
    border-color: var(--wa-color-border-loud, var(--wa-color-neutral-border-loud));
  }

  :host([appearance='filled']) {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet));
    border-color: transparent;
  }

  :host([appearance='filled-outlined']) {
    color: var(--wa-color-on-quiet, var(--wa-color-neutral-on-quiet));
    background-color: var(--wa-color-fill-quiet, var(--wa-color-neutral-fill-quiet));
    border-color: var(--wa-color-border-normal, var(--wa-color-neutral-border-normal));
  }

  :host([appearance='accent']) {
    color: var(--wa-color-on-loud, var(--wa-color-neutral-on-loud));
    background-color: var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud));
    border-color: transparent;
  }
}

.content {
  font-size: var(--wa-font-size-smaller);
}

[part='remove-button'] {
  color: inherit;
  line-height: 1;
}

[part='remove-button']::part(base) {
  padding: 0;
  height: 1em;
  width: 1em;
}

@media (hover: hover) {
  :host(:hover) > [part='remove-button']::part(base) {
    color: color-mix(in oklab, currentColor, var(--wa-color-mix-hover));
  }
}

:host(:active) > [part='remove-button']::part(base) {
  color: color-mix(in oklab, currentColor, var(--wa-color-mix-active));
}

/*
 * Pill modifier
 */
:host([pill]) {
  border-radius: var(--wa-border-radius-pill);
}
`,WaTag=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.variant="neutral",this.appearance="filled-outlined",this.size="medium",this.pill=!1,this.withRemove=!1}handleRemoveClick(){this.dispatchEvent(new WaRemoveEvent)}render(){return x$1`
      <slot part="content" class="content"></slot>

      ${this.withRemove?x$1`
            <wa-button
              part="remove-button"
              exportparts="base:remove-button__base"
              class="remove"
              appearance="plain"
              @click=${this.handleRemoveClick}
              tabindex="-1"
            >
              <wa-icon name="xmark" library="system" variant="solid" label=${this.localize.term("remove")}></wa-icon>
            </wa-button>
          `:""}
    `}};WaTag.css=[tag_default,variants_default,size_default];__decorateClass$d([n$7({reflect:!0})],WaTag.prototype,"variant",2);__decorateClass$d([n$7({reflect:!0})],WaTag.prototype,"appearance",2);__decorateClass$d([n$7({reflect:!0})],WaTag.prototype,"size",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTag.prototype,"pill",2);__decorateClass$d([n$7({attribute:"with-remove",type:Boolean})],WaTag.prototype,"withRemove",2);WaTag=__decorateClass$d([t$b("wa-tag")],WaTag);function getText$1(ee,O=0){if(!ee||!globalThis.Node)return"";if(typeof ee[Symbol.iterator]=="function")return(Array.isArray(ee)?ee:[...ee]).map(ne=>getText$1(ne,--O)).join("");let Y=ee;if(Y.nodeType===Node.TEXT_NODE)return Y.textContent??"";if(Y.nodeType===Node.ELEMENT_NODE){let te=Y;if(te.hasAttribute("slot")||te.matches("style, script"))return"";if(te instanceof HTMLSlotElement){let ne=te.assignedNodes({flatten:!0});if(ne.length>0)return getText$1(ne,--O)}return O>-1?getText$1(te,--O):te.textContent??""}return Y.hasChildNodes()?getText$1(Y.childNodes,--O):""}var option_default=`:host {
  display: block;
  color: var(--wa-color-text-normal);
  -webkit-user-select: none;
  user-select: none;

  position: relative;
  display: flex;
  align-items: center;
  font: inherit;
  padding: 0.5em 1em 0.5em 0.25em;
  line-height: var(--wa-line-height-condensed);
  transition: fill var(--wa-transition-normal) var(--wa-transition-easing);
  cursor: pointer;
}

:host(:focus) {
  outline: none;
}

@media (hover: hover) {
  :host(:not([disabled], :state(current)):is(:state(hover), :hover)) {
    background-color: var(--wa-color-neutral-fill-normal);
    color: var(--wa-color-neutral-on-normal);
  }
}

:host(:state(current)),
:host([disabled]:state(current)) {
  background-color: var(--wa-color-brand-fill-loud);
  color: var(--wa-color-brand-on-loud);
  opacity: 1;
}

:host([disabled]) {
  outline: none;
  opacity: 0.5;
  cursor: not-allowed;
}

.label {
  flex: 1 1 auto;
  display: inline-block;
}

.check {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--wa-font-size-smaller);
  visibility: hidden;
  width: 2em;
}

:host(:state(selected)) .check {
  visibility: visible;
}

.start,
.end {
  flex: 0 0 auto;
  display: flex;
  align-items: center;
}

.start::slotted(*) {
  margin-inline-end: 0.5em;
}

.end::slotted(*) {
  margin-inline-start: 0.5em;
}

@media (forced-colors: active) {
  :host(:hover:not([aria-disabled='true'])) {
    outline: dashed 1px SelectedItem;
    outline-offset: -1px;
  }
}
`,WaOption=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.isInitialized=!1,this.current=!1,this.value="",this.disabled=!1,this.selected=!1,this.defaultSelected=!1,this._label="",this.defaultLabel="",this.handleHover=ee=>{ee.type==="mouseenter"?this.customStates.set("hover",!0):ee.type==="mouseleave"&&this.customStates.set("hover",!1)}}set label(ee){const O=this._label;this._label=ee||"",this._label!==O&&this.requestUpdate("label",O)}get label(){return this._label?this._label:(this.defaultLabel||this.updateDefaultLabel(),this.defaultLabel)}connectedCallback(){super.connectedCallback(),this.setAttribute("role","option"),this.setAttribute("aria-selected","false"),this.addEventListener("mouseenter",this.handleHover),this.addEventListener("mouseleave",this.handleHover),this.updateDefaultLabel()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("mouseenter",this.handleHover),this.removeEventListener("mouseleave",this.handleHover)}handleDefaultSlotChange(){this.updateDefaultLabel(),this.isInitialized?customElements.whenDefined("wa-select").then(()=>{const ee=this.closest("wa-select");ee&&(ee.handleDefaultSlotChange(),ee.selectionChanged?.())}):this.isInitialized=!0}willUpdate(ee){if(ee.has("defaultSelected")&&!this.closest("wa-select")?.hasInteracted){const O=this.selected;this.selected=this.defaultSelected,this.requestUpdate("selected",O)}super.willUpdate(ee)}updated(ee){super.updated(ee),ee.has("disabled")&&this.setAttribute("aria-disabled",this.disabled?"true":"false"),ee.has("selected")&&(this.setAttribute("aria-selected",this.selected?"true":"false"),this.customStates.set("selected",this.selected),this.handleDefaultSlotChange()),ee.has("value")&&(typeof this.value!="string"&&(this.value=String(this.value)),this.handleDefaultSlotChange()),ee.has("current")&&this.customStates.set("current",this.current)}updateDefaultLabel(){let ee=this.defaultLabel;this.defaultLabel=getText$1(this).trim();let O=this.defaultLabel!==ee;return!this._label&&O&&this.requestUpdate("label",ee),O}render(){return x$1`
      <wa-icon
        part="checked-icon"
        class="check"
        name="check"
        library="system"
        variant="solid"
        aria-hidden="true"
      ></wa-icon>
      <slot part="start" name="start" class="start"></slot>
      <slot part="label" class="label" @slotchange=${this.handleDefaultSlotChange}></slot>
      <slot part="end" name="end" class="end"></slot>
    `}};WaOption.css=option_default;__decorateClass$d([e$9(".label")],WaOption.prototype,"defaultSlot",2);__decorateClass$d([r$6()],WaOption.prototype,"current",2);__decorateClass$d([n$7({reflect:!0})],WaOption.prototype,"value",2);__decorateClass$d([n$7({type:Boolean})],WaOption.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,attribute:!1})],WaOption.prototype,"selected",2);__decorateClass$d([n$7({type:Boolean,attribute:"selected"})],WaOption.prototype,"defaultSelected",2);__decorateClass$d([n$7()],WaOption.prototype,"label",1);__decorateClass$d([r$6()],WaOption.prototype,"defaultLabel",2);WaOption=__decorateClass$d([t$b("wa-option")],WaOption);var skeleton_default=`:host {
  --color: var(--wa-color-neutral-fill-normal);
  --sheen-color: color-mix(in oklab, var(--color), var(--wa-color-surface-raised));

  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 1rem;
}

.indicator {
  flex: 1 1 auto;
  background: var(--color);
  border-radius: var(--wa-border-radius-pill);
}

:host([effect='sheen']) .indicator {
  background: linear-gradient(270deg, var(--sheen-color), var(--color), var(--color), var(--sheen-color));
  background-size: 400% 100%;
  animation: sheen 8s ease-in-out infinite;
}

:host([effect='pulse']) .indicator {
  animation: pulse 2s ease-in-out 0.5s infinite;
}

/* Forced colors mode */
@media (forced-colors: active) {
  :host {
    --color: GrayText;
  }
}

@keyframes sheen {
  0% {
    background-position: 200% 0;
  }
  to {
    background-position: -200% 0;
  }
}

@keyframes pulse {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
  100% {
    opacity: 1;
  }
}
`,WaSkeleton=class extends WebAwesomeElement{constructor(){super(...arguments),this.effect="none"}render(){return x$1` <div part="indicator" class="indicator"></div> `}};WaSkeleton.css=skeleton_default;__decorateClass$d([n$7({reflect:!0})],WaSkeleton.prototype,"effect",2);WaSkeleton=__decorateClass$d([t$b("wa-skeleton")],WaSkeleton);var SliderValidator=()=>{const ee=Object.assign(document.createElement("input"),{type:"range",required:!0});return{observedAttributes:["required","min","max","step"],checkValidity(O){const Y={message:"",isValid:!0,invalidKeys:[]},te=(ne,xe,et,tt)=>{const it=document.createElement("input");return it.type="range",it.min=String(xe),it.max=String(et),it.step=String(tt),it.value=String(ne),it.checkValidity(),it.validationMessage};if(O.required&&!O.hasInteracted)return Y.isValid=!1,Y.invalidKeys.push("valueMissing"),Y.message=ee.validationMessage||"Please fill out this field.",Y;if(O.isRange){const ne=O.minValue,xe=O.maxValue;if(ne<O.min)return Y.isValid=!1,Y.invalidKeys.push("rangeUnderflow"),Y.message=te(ne,O.min,O.max,O.step)||`Value must be greater than or equal to ${O.min}.`,Y;if(xe>O.max)return Y.isValid=!1,Y.invalidKeys.push("rangeOverflow"),Y.message=te(xe,O.min,O.max,O.step)||`Value must be less than or equal to ${O.max}.`,Y;if(O.step&&O.step!==1){const et=(ne-O.min)%O.step!==0,tt=(xe-O.min)%O.step!==0;if(et||tt){Y.isValid=!1,Y.invalidKeys.push("stepMismatch");const it=et?ne:xe;return Y.message=te(it,O.min,O.max,O.step)||`Value must be a multiple of ${O.step}.`,Y}}}else{const ne=O.value;if(ne<O.min)return Y.isValid=!1,Y.invalidKeys.push("rangeUnderflow"),Y.message=te(ne,O.min,O.max,O.step)||`Value must be greater than or equal to ${O.min}.`,Y;if(ne>O.max)return Y.isValid=!1,Y.invalidKeys.push("rangeOverflow"),Y.message=te(ne,O.min,O.max,O.step)||`Value must be less than or equal to ${O.max}.`,Y;if(O.step&&O.step!==1&&(ne-O.min)%O.step!==0)return Y.isValid=!1,Y.invalidKeys.push("stepMismatch"),Y.message=te(ne,O.min,O.max,O.step)||`Value must be a multiple of ${O.step}.`,Y}return Y}}},slider_default=`:host {
  --track-size: 0.5em;
  --thumb-width: 1.4em;
  --thumb-height: 1.4em;
  --marker-width: 0.1875em;
  --marker-height: 0.1875em;
}

:host([orientation='vertical']) {
  width: auto;
}

#label:has(~ .vertical) {
  display: block;
  order: 2;
  max-width: none;
  text-align: center;
}

#description:has(~ .vertical) {
  order: 3;
  text-align: center;
}

/* Add extra space between slider and label, when present */
#label:has(*:not(:empty)) ~ #slider {
  &.horizontal {
    margin-block-start: 0.5em;
  }
  &.vertical {
    margin-block-end: 0.5em;
  }
}

#slider {
  touch-action: none;

  &:focus {
    outline: none;
  }

  &:focus-visible:not(.disabled) #thumb,
  &:focus-visible:not(.disabled) #thumb-min,
  &:focus-visible:not(.disabled) #thumb-max {
    outline: var(--wa-focus-ring);
    /* intentionally no offset due to border */
  }
}

#track {
  position: relative;
  border-radius: 9999px;
  background: var(--wa-color-neutral-fill-normal);
  isolation: isolate;
}

/* Orientation */
.horizontal #track {
  height: var(--track-size);
}

.vertical #track {
  order: 1;
  width: var(--track-size);
  height: 200px;
}

/* Disabled */
.disabled #track {
  cursor: not-allowed;
  opacity: 0.5;
}

/* Indicator */
#indicator {
  position: absolute;
  border-radius: inherit;
  background-color: var(--wa-form-control-activated-color);

  &:dir(ltr) {
    right: calc(100% - max(var(--start), var(--end)));
    left: min(var(--start), var(--end));
  }

  &:dir(rtl) {
    right: min(var(--start), var(--end));
    left: calc(100% - max(var(--start), var(--end)));
  }
}

.horizontal #indicator {
  top: 0;
  height: 100%;
}

.vertical #indicator {
  top: calc(100% - var(--end));
  bottom: var(--start);
  left: 0;
  width: 100%;
}

/* Thumbs */
#thumb,
#thumb-min,
#thumb-max {
  z-index: 3;
  position: absolute;
  width: var(--thumb-width);
  height: var(--thumb-height);
  border: solid 0.125em var(--wa-color-surface-default);
  border-radius: 50%;
  background-color: var(--wa-form-control-activated-color);
  cursor: pointer;
}

.disabled #thumb,
.disabled #thumb-min,
.disabled #thumb-max {
  cursor: inherit;
}

.horizontal #thumb,
.horizontal #thumb-min,
.horizontal #thumb-max {
  top: calc(50% - var(--thumb-height) / 2);

  &:dir(ltr) {
    right: auto;
    left: calc(var(--position) - var(--thumb-width) / 2);
  }

  &:dir(rtl) {
    right: calc(var(--position) - var(--thumb-width) / 2);
    left: auto;
  }
}

.vertical #thumb,
.vertical #thumb-min,
.vertical #thumb-max {
  bottom: calc(var(--position) - var(--thumb-height) / 2);
  left: calc(50% - var(--thumb-width) / 2);
}

/* Range-specific thumb styles */
:host([range]) {
  #thumb-min:focus-visible,
  #thumb-max:focus-visible {
    z-index: 4; /* Ensure focused thumb appears on top */
    outline: var(--wa-focus-ring);
    /* intentionally no offset due to border */
  }
}

/* Markers */
#markers {
  pointer-events: none;
}

.marker {
  z-index: 2;
  position: absolute;
  width: var(--marker-width);
  height: var(--marker-height);
  border-radius: 50%;
  background-color: var(--wa-color-surface-default);
}

.marker:first-of-type,
.marker:last-of-type {
  display: none;
}

.horizontal .marker {
  top: calc(50% - var(--marker-height) / 2);
  left: calc(var(--position) - var(--marker-width) / 2);
}

.vertical .marker {
  top: calc(var(--position) - var(--marker-height) / 2);
  left: calc(50% - var(--marker-width) / 2);
}

/* Marker labels */
#references {
  position: relative;

  slot {
    display: flex;
    justify-content: space-between;
    height: 100%;
  }

  ::slotted(*) {
    color: var(--wa-color-text-quiet);
    font-size: 0.875em;
    line-height: 1;
  }
}

.horizontal {
  #references {
    margin-block-start: 0.5em;
  }
}

.vertical {
  display: flex;
  margin-inline: auto;

  #track {
    order: 1;
  }

  #references {
    order: 2;
    width: min-content;
    margin-inline-start: 0.75em;

    slot {
      flex-direction: column;
    }
  }
}

.vertical #references slot {
  flex-direction: column;
}
`,WaSlider=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.draggableThumbMin=null,this.draggableThumbMax=null,this.hasSlotController=new HasSlotController(this,"hint","label"),this.localize=new LocalizeController(this),this.activeThumb=null,this.lastTrackPosition=null,this.label="",this.hint="",this.minValue=0,this.maxValue=50,this.defaultValue=this.getAttribute("value")==null?this.minValue:Number(this.getAttribute("value")),this._value=this.defaultValue,this.range=!1,this.disabled=!1,this.readonly=!1,this.orientation="horizontal",this.size="medium",this.form=null,this.min=0,this.max=100,this.step=1,this.required=!1,this.tooltipDistance=8,this.tooltipPlacement="top",this.withMarkers=!1,this.withTooltip=!1}static get validators(){return[...super.validators,SliderValidator()]}get focusableAnchor(){return this.isRange?this.thumbMin||this.slider:this.slider}get validationTarget(){return this.focusableAnchor}get value(){return this.valueHasChanged?this._value:this._value??this.defaultValue}set value(ee){ee=Number(ee)??this.minValue,this._value!==ee&&(this.valueHasChanged=!0,this._value=ee)}get isRange(){return this.range}firstUpdated(){this.isRange?(this.draggableThumbMin=new DraggableElement(this.thumbMin,{start:()=>{this.activeThumb="min",this.trackBoundingClientRect=this.track.getBoundingClientRect(),this.valueWhenDraggingStarted=this.minValue,this.customStates.set("dragging",!0),this.showRangeTooltips()},move:(ee,O)=>{this.setThumbValueFromCoordinates(ee,O,"min")},stop:()=>{this.minValue!==this.valueWhenDraggingStarted&&(this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.hasInteracted=!0),this.hideRangeTooltips(),this.customStates.set("dragging",!1),this.valueWhenDraggingStarted=void 0,this.activeThumb=null}}),this.draggableThumbMax=new DraggableElement(this.thumbMax,{start:()=>{this.activeThumb="max",this.trackBoundingClientRect=this.track.getBoundingClientRect(),this.valueWhenDraggingStarted=this.maxValue,this.customStates.set("dragging",!0),this.showRangeTooltips()},move:(ee,O)=>{this.setThumbValueFromCoordinates(ee,O,"max")},stop:()=>{this.maxValue!==this.valueWhenDraggingStarted&&(this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.hasInteracted=!0),this.hideRangeTooltips(),this.customStates.set("dragging",!1),this.valueWhenDraggingStarted=void 0,this.activeThumb=null}}),this.draggableTrack=new DraggableElement(this.track,{start:(ee,O)=>{if(this.trackBoundingClientRect=this.track.getBoundingClientRect(),this.activeThumb)this.valueWhenDraggingStarted=this.activeThumb==="min"?this.minValue:this.maxValue;else{const Y=this.getValueFromCoordinates(ee,O),te=Math.abs(Y-this.minValue),ne=Math.abs(Y-this.maxValue);if(te===ne)if(Y>this.maxValue)this.activeThumb="max";else if(Y<this.minValue)this.activeThumb="min";else{const xe=this.localize.dir()==="rtl",et=this.orientation==="vertical",tt=et?O:ee,it=this.lastTrackPosition||tt;this.lastTrackPosition=tt;const st=tt>it!==xe&&!et||tt<it&&et;this.activeThumb=st?"max":"min"}else this.activeThumb=te<=ne?"min":"max";this.valueWhenDraggingStarted=this.activeThumb==="min"?this.minValue:this.maxValue}this.customStates.set("dragging",!0),this.setThumbValueFromCoordinates(ee,O,this.activeThumb),this.showRangeTooltips()},move:(ee,O)=>{this.activeThumb&&this.setThumbValueFromCoordinates(ee,O,this.activeThumb)},stop:()=>{this.activeThumb&&(this.activeThumb==="min"?this.minValue:this.maxValue)!==this.valueWhenDraggingStarted&&(this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.hasInteracted=!0),this.hideRangeTooltips(),this.customStates.set("dragging",!1),this.valueWhenDraggingStarted=void 0,this.activeThumb=null}})):this.draggableTrack=new DraggableElement(this.slider,{start:(ee,O)=>{this.trackBoundingClientRect=this.track.getBoundingClientRect(),this.valueWhenDraggingStarted=this.value,this.customStates.set("dragging",!0),this.setValueFromCoordinates(ee,O),this.showTooltip()},move:(ee,O)=>{this.setValueFromCoordinates(ee,O)},stop:()=>{this.value!==this.valueWhenDraggingStarted&&(this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.hasInteracted=!0),this.hideTooltip(),this.customStates.set("dragging",!1),this.valueWhenDraggingStarted=void 0}})}updated(ee){if(ee.has("range")&&this.requestUpdate(),this.isRange?(ee.has("minValue")||ee.has("maxValue"))&&(this.minValue=clamp$3(this.minValue,this.min,this.maxValue),this.maxValue=clamp$3(this.maxValue,this.minValue,this.max),this.updateFormValue()):ee.has("value")&&(this.value=clamp$3(this.value,this.min,this.max),this.setValue(String(this.value))),(ee.has("min")||ee.has("max"))&&(this.isRange?(this.minValue=clamp$3(this.minValue,this.min,this.max),this.maxValue=clamp$3(this.maxValue,this.min,this.max)):this.value=clamp$3(this.value,this.min,this.max)),ee.has("disabled")&&this.customStates.set("disabled",this.disabled),ee.has("disabled")||ee.has("readonly")){const O=!(this.disabled||this.readonly);this.isRange&&(this.draggableThumbMin&&this.draggableThumbMin.toggle(O),this.draggableThumbMax&&this.draggableThumbMax.toggle(O)),this.draggableTrack&&this.draggableTrack.toggle(O)}super.updated(ee)}formDisabledCallback(ee){this.disabled=ee}formResetCallback(){this.isRange?(this.minValue=parseFloat(this.getAttribute("min-value")??String(this.min)),this.maxValue=parseFloat(this.getAttribute("max-value")??String(this.max))):this.value=parseFloat(this.getAttribute("value")??String(this.min)),this.hasInteracted=!1,super.formResetCallback()}clampAndRoundToStep(ee){const O=(String(this.step).split(".")[1]||"").replace(/0+$/g,"").length;return ee=Math.round(ee/this.step)*this.step,ee=clamp$3(ee,this.min,this.max),parseFloat(ee.toFixed(O))}getPercentageFromValue(ee){return(ee-this.min)/(this.max-this.min)*100}getValueFromCoordinates(ee,O){const Y=this.localize.dir()==="rtl",te=this.orientation==="vertical",{top:ne,right:xe,bottom:et,left:tt,height:it,width:st}=this.trackBoundingClientRect,ot=te?O:ee,rt=te?{start:ne,end:et,size:it}:{start:tt,end:xe,size:st},at=(te||Y?rt.end-ot:ot-rt.start)/rt.size;return this.clampAndRoundToStep(this.min+(this.max-this.min)*at)}handleBlur(){this.isRange?requestAnimationFrame(()=>{const ee=this.shadowRoot?.activeElement;ee===this.thumbMin||ee===this.thumbMax||this.hideRangeTooltips()}):this.hideTooltip(),this.customStates.set("focused",!1),this.dispatchEvent(new FocusEvent("blur",{bubbles:!0,composed:!0}))}handleFocus(ee){const O=ee.target;this.isRange?(O===this.thumbMin?this.activeThumb="min":O===this.thumbMax&&(this.activeThumb="max"),this.showRangeTooltips()):this.showTooltip(),this.customStates.set("focused",!0),this.dispatchEvent(new FocusEvent("focus",{bubbles:!0,composed:!0}))}handleKeyDown(ee){const O=this.localize.dir()==="rtl",Y=ee.target;if(this.disabled||this.readonly||this.isRange&&(Y===this.thumbMin?this.activeThumb="min":Y===this.thumbMax&&(this.activeThumb="max"),!this.activeThumb))return;const te=this.isRange?this.activeThumb==="min"?this.minValue:this.maxValue:this.value;let ne=te;switch(ee.key){case"ArrowUp":case(O?"ArrowLeft":"ArrowRight"):ee.preventDefault(),ne=this.clampAndRoundToStep(te+this.step);break;case"ArrowDown":case(O?"ArrowRight":"ArrowLeft"):ee.preventDefault(),ne=this.clampAndRoundToStep(te-this.step);break;case"Home":ee.preventDefault(),ne=this.isRange&&this.activeThumb==="min"?this.min:this.isRange?this.minValue:this.min;break;case"End":ee.preventDefault(),ne=this.isRange&&this.activeThumb==="max"?this.max:this.isRange?this.maxValue:this.max;break;case"PageUp":ee.preventDefault();const xe=Math.max(te+(this.max-this.min)/10,te+this.step);ne=this.clampAndRoundToStep(xe);break;case"PageDown":ee.preventDefault();const et=Math.min(te-(this.max-this.min)/10,te-this.step);ne=this.clampAndRoundToStep(et);break;case"Enter":submitOnEnter(ee,this);return}ne!==te&&(this.isRange?(this.activeThumb==="min"?ne>this.maxValue?(this.maxValue=ne,this.minValue=ne):this.minValue=Math.max(this.min,ne):ne<this.minValue?(this.minValue=ne,this.maxValue=ne):this.maxValue=Math.min(this.max,ne),this.updateFormValue()):this.value=clamp$3(ne,this.min,this.max),this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))}),this.hasInteracted=!0)}handleLabelPointerDown(ee){ee.preventDefault(),this.disabled||(this.isRange?this.thumbMin?.focus():this.slider.focus())}setValueFromCoordinates(ee,O){const Y=this.value;this.value=this.getValueFromCoordinates(ee,O),this.value!==Y&&this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))})}setThumbValueFromCoordinates(ee,O,Y){const te=this.getValueFromCoordinates(ee,O),ne=Y==="min"?this.minValue:this.maxValue;Y==="min"?te>this.maxValue?(this.maxValue=te,this.minValue=te):this.minValue=Math.max(this.min,te):te<this.minValue?(this.minValue=te,this.maxValue=te):this.maxValue=Math.min(this.max,te),ne!==(Y==="min"?this.minValue:this.maxValue)&&(this.updateFormValue(),this.updateComplete.then(()=>{this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}))}showTooltip(){this.withTooltip&&this.tooltip&&(this.tooltip.open=!0)}hideTooltip(){this.withTooltip&&this.tooltip&&(this.tooltip.open=!1)}showRangeTooltips(){if(!this.withTooltip)return;const ee=this.shadowRoot?.getElementById("tooltip-thumb-min"),O=this.shadowRoot?.getElementById("tooltip-thumb-max");this.activeThumb==="min"?(ee&&(ee.open=!0),O&&(O.open=!1)):this.activeThumb==="max"&&(O&&(O.open=!0),ee&&(ee.open=!1))}hideRangeTooltips(){if(!this.withTooltip)return;const ee=this.shadowRoot?.getElementById("tooltip-thumb-min"),O=this.shadowRoot?.getElementById("tooltip-thumb-max");ee&&(ee.open=!1),O&&(O.open=!1)}updateFormValue(){if(this.isRange){const ee=new FormData;ee.append(this.name||"",String(this.minValue)),ee.append(this.name||"",String(this.maxValue)),this.setValue(ee)}}focus(){this.isRange?this.thumbMin?.focus():this.slider.focus()}blur(){this.isRange?document.activeElement===this.thumbMin?this.thumbMin.blur():document.activeElement===this.thumbMax&&this.thumbMax.blur():this.slider.blur()}stepDown(){if(this.isRange){const ee=this.clampAndRoundToStep(this.minValue-this.step);this.minValue=clamp$3(ee,this.min,this.maxValue),this.updateFormValue()}else{const ee=this.clampAndRoundToStep(this.value-this.step);this.value=ee}}stepUp(){if(this.isRange){const ee=this.clampAndRoundToStep(this.maxValue+this.step);this.maxValue=clamp$3(ee,this.minValue,this.max),this.updateFormValue()}else{const ee=this.clampAndRoundToStep(this.value+this.step);this.value=ee}}render(){const ee=this.hasSlotController.test("label"),O=this.hasSlotController.test("hint"),Y=this.label?!0:!!ee,te=this.hint?!0:!!O,ne=this.hasSlotController.test("reference"),xe=e$5({small:this.size==="small",medium:this.size==="medium",large:this.size==="large",horizontal:this.orientation==="horizontal",vertical:this.orientation==="vertical",disabled:this.disabled}),et=[];if(this.withMarkers)for(let nt=this.min;nt<=this.max;nt+=this.step)et.push(this.getPercentageFromValue(nt));const tt=x$1`
      <label
        id="label"
        part="label"
        for=${this.isRange?"thumb-min":"text-box"}
        class=${e$5({vh:!Y})}
        @pointerdown=${this.handleLabelPointerDown}
      >
        <slot name="label">${this.label}</slot>
      </label>
    `,it=x$1`
      <div
        id="hint"
        part="hint"
        class=${e$5({"has-slotted":te})}
      >
        <slot name="hint">${this.hint}</slot>
      </div>
    `,st=this.withMarkers?x$1`
          <div id="markers" part="markers">
            ${et.map(nt=>x$1`<span part="marker" class="marker" style="--position: ${nt}%"></span>`)}
          </div>
        `:"",ot=ne?x$1`
          <div id="references" part="references" aria-hidden="true">
            <slot name="reference"></slot>
          </div>
        `:"",rt=(nt,at)=>this.withTooltip?x$1`
            <wa-tooltip
              id=${`tooltip${nt!=="thumb"?"-"+nt:""}`}
              part="tooltip"
              exportparts="
                base:tooltip__base,
                body:tooltip__body,
                arrow:tooltip__arrow
              "
              trigger="manual"
              distance=${this.tooltipDistance}
              placement=${this.tooltipPlacement}
              for=${nt}
              activation="manual"
              dir=${this.localize.dir()}
            >
              <span aria-hidden="true">
                ${typeof this.valueFormatter=="function"?this.valueFormatter(at):this.localize.number(at)}
              </span>
            </wa-tooltip>
          `:"";if(this.isRange){const nt=clamp$3(this.getPercentageFromValue(this.minValue),0,100),at=clamp$3(this.getPercentageFromValue(this.maxValue),0,100);return x$1`
        ${tt}

        <div id="slider" part="slider" class=${xe}>
          <div id="track" part="track">
            <div
              id="indicator"
              part="indicator"
              style="--start: ${Math.min(nt,at)}%; --end: ${Math.max(nt,at)}%"
            ></div>

            ${st}

            <span
              id="thumb-min"
              part="thumb thumb-min"
              style="--position: ${nt}%"
              role="slider"
              aria-valuemin=${this.min}
              aria-valuenow=${this.minValue}
              aria-valuetext=${typeof this.valueFormatter=="function"?this.valueFormatter(this.minValue):this.localize.number(this.minValue)}
              aria-valuemax=${this.max}
              aria-label="${this.label?`${this.label} (minimum value)`:"Minimum value"}"
              aria-orientation=${this.orientation}
              aria-disabled=${this.disabled?"true":"false"}
              aria-readonly=${this.readonly?"true":"false"}
              tabindex=${this.disabled?-1:0}
              @blur=${this.handleBlur}
              @focus=${this.handleFocus}
              @keydown=${this.handleKeyDown}
            ></span>

            <span
              id="thumb-max"
              part="thumb thumb-max"
              style="--position: ${at}%"
              role="slider"
              aria-valuemin=${this.min}
              aria-valuenow=${this.maxValue}
              aria-valuetext=${typeof this.valueFormatter=="function"?this.valueFormatter(this.maxValue):this.localize.number(this.maxValue)}
              aria-valuemax=${this.max}
              aria-label="${this.label?`${this.label} (maximum value)`:"Maximum value"}"
              aria-orientation=${this.orientation}
              aria-disabled=${this.disabled?"true":"false"}
              aria-readonly=${this.readonly?"true":"false"}
              tabindex=${this.disabled?-1:0}
              @blur=${this.handleBlur}
              @focus=${this.handleFocus}
              @keydown=${this.handleKeyDown}
            ></span>
          </div>

          ${ot} ${it}
        </div>

        ${rt("thumb-min",this.minValue)} ${rt("thumb-max",this.maxValue)}
      `}else{const nt=clamp$3(this.getPercentageFromValue(this.value),0,100),at=clamp$3(this.getPercentageFromValue(typeof this.indicatorOffset=="number"?this.indicatorOffset:this.min),0,100);return x$1`
        ${tt}

        <div
          id="slider"
          part="slider"
          class=${xe}
          role="slider"
          aria-disabled=${this.disabled?"true":"false"}
          aria-readonly=${this.disabled?"true":"false"}
          aria-orientation=${this.orientation}
          aria-valuemin=${this.min}
          aria-valuenow=${this.value}
          aria-valuetext=${typeof this.valueFormatter=="function"?this.valueFormatter(this.value):this.localize.number(this.value)}
          aria-valuemax=${this.max}
          aria-labelledby="label"
          aria-describedby="hint"
          tabindex=${this.disabled?-1:0}
          @blur=${this.handleBlur}
          @focus=${this.handleFocus}
          @keydown=${this.handleKeyDown}
        >
          <div id="track" part="track">
            <div
              id="indicator"
              part="indicator"
              style="--start: ${at}%; --end: ${nt}%"
            ></div>

            ${st}
            <span id="thumb" part="thumb" style="--position: ${nt}%"></span>
          </div>

          ${ot} ${it}
        </div>

        ${rt("thumb",this.value)}
      `}}};WaSlider.formAssociated=!0;WaSlider.observeSlots=!0;WaSlider.css=[size_default,form_control_default,slider_default];__decorateClass$d([e$9("#slider")],WaSlider.prototype,"slider",2);__decorateClass$d([e$9("#thumb")],WaSlider.prototype,"thumb",2);__decorateClass$d([e$9("#thumb-min")],WaSlider.prototype,"thumbMin",2);__decorateClass$d([e$9("#thumb-max")],WaSlider.prototype,"thumbMax",2);__decorateClass$d([e$9("#track")],WaSlider.prototype,"track",2);__decorateClass$d([e$9("#tooltip")],WaSlider.prototype,"tooltip",2);__decorateClass$d([n$7()],WaSlider.prototype,"label",2);__decorateClass$d([n$7({attribute:"hint"})],WaSlider.prototype,"hint",2);__decorateClass$d([n$7({reflect:!0})],WaSlider.prototype,"name",2);__decorateClass$d([n$7({type:Number,attribute:"min-value"})],WaSlider.prototype,"minValue",2);__decorateClass$d([n$7({type:Number,attribute:"max-value"})],WaSlider.prototype,"maxValue",2);__decorateClass$d([n$7({attribute:"value",reflect:!0,type:Number})],WaSlider.prototype,"defaultValue",2);__decorateClass$d([r$6()],WaSlider.prototype,"value",1);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSlider.prototype,"range",2);__decorateClass$d([n$7({type:Boolean})],WaSlider.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSlider.prototype,"readonly",2);__decorateClass$d([n$7({reflect:!0})],WaSlider.prototype,"orientation",2);__decorateClass$d([n$7({reflect:!0})],WaSlider.prototype,"size",2);__decorateClass$d([n$7({attribute:"indicator-offset",type:Number})],WaSlider.prototype,"indicatorOffset",2);__decorateClass$d([n$7({reflect:!0})],WaSlider.prototype,"form",2);__decorateClass$d([n$7({type:Number})],WaSlider.prototype,"min",2);__decorateClass$d([n$7({type:Number})],WaSlider.prototype,"max",2);__decorateClass$d([n$7({type:Number})],WaSlider.prototype,"step",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSlider.prototype,"required",2);__decorateClass$d([n$7({type:Boolean})],WaSlider.prototype,"autofocus",2);__decorateClass$d([n$7({attribute:"tooltip-distance",type:Number})],WaSlider.prototype,"tooltipDistance",2);__decorateClass$d([n$7({attribute:"tooltip-placement",reflect:!0})],WaSlider.prototype,"tooltipPlacement",2);__decorateClass$d([n$7({attribute:"with-markers",type:Boolean})],WaSlider.prototype,"withMarkers",2);__decorateClass$d([n$7({attribute:"with-tooltip",type:Boolean})],WaSlider.prototype,"withTooltip",2);__decorateClass$d([n$7({attribute:!1})],WaSlider.prototype,"valueFormatter",2);WaSlider=__decorateClass$d([t$b("wa-slider")],WaSlider);var split_panel_default=`:host {
  --divider-width: 0.25rem;
  --divider-hit-area: 0.75rem;
  --min: 0%;
  --max: 100%;

  display: grid;
}

.start,
.end {
  overflow: hidden;
}

.divider {
  flex: 0 0 var(--divider-width);
  display: flex;
  position: relative;
  align-items: center;
  justify-content: center;
  background-color: var(--wa-color-neutral-border-normal);
  color: var(--wa-color-neutral-on-normal);
  z-index: 1;
}

.divider:focus {
  outline: none;
}

:host(:not([disabled])) .divider:focus-visible {
  outline: var(--wa-focus-ring);
}

:host([disabled]) .divider {
  cursor: not-allowed;
}

/* Horizontal */
:host(:not([orientation='vertical'], [disabled])) .divider {
  cursor: col-resize;
}

:host(:not([orientation='vertical'])) .divider::after {
  display: flex;
  content: '';
  position: absolute;
  height: 100%;
  left: calc(var(--divider-hit-area) / -2 + var(--divider-width) / 2);
  width: var(--divider-hit-area);
}

/* Vertical */
:host([orientation='vertical']) {
  flex-direction: column;
}

:host([orientation='vertical']:not([disabled])) .divider {
  cursor: row-resize;
}

:host([orientation='vertical']) .divider::after {
  content: '';
  position: absolute;
  width: 100%;
  top: calc(var(--divider-hit-area) / -2 + var(--divider-width) / 2);
  height: var(--divider-hit-area);
}

@media (forced-colors: active) {
  .divider {
    outline: solid 1px transparent;
  }
}
`,WaSplitPanel=class extends WebAwesomeElement{constructor(){super(...arguments),this.isCollapsed=!1,this.localize=new LocalizeController(this),this.positionBeforeCollapsing=0,this.position=50,this.orientation="horizontal",this.disabled=!1,this.snapThreshold=12}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(ee=>this.handleResize(ee)),this.updateComplete.then(()=>this.resizeObserver.observe(this)),this.detectSize(),this.cachedPositionInPixels=this.percentageToPixels(this.position)}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver?.unobserve(this)}detectSize(){const{width:ee,height:O}=this.getBoundingClientRect();this.size=this.orientation==="vertical"?O:ee}percentageToPixels(ee){return this.size*(ee/100)}pixelsToPercentage(ee){return ee/this.size*100}handleDrag(ee){const O=this.hasUpdated?this.localize.dir()==="rtl":this.dir==="rtl";this.disabled||(ee.cancelable&&ee.preventDefault(),drag(this,{onMove:(Y,te)=>{let ne=this.orientation==="vertical"?te:Y;this.primary==="end"&&(ne=this.size-ne),this.snap&&this.snap.split(" ").forEach(et=>{let tt;et.endsWith("%")?tt=this.size*(parseFloat(et)/100):tt=parseFloat(et),O&&this.orientation==="horizontal"&&(tt=this.size-tt),ne>=tt-this.snapThreshold&&ne<=tt+this.snapThreshold&&(ne=tt)}),this.position=clamp$3(this.pixelsToPercentage(ne),0,100)},initialEvent:ee}))}handleKeyDown(ee){if(!this.disabled&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","Enter"].includes(ee.key)){let O=this.position;const Y=(ee.shiftKey?10:1)*(this.primary==="end"?-1:1);if(ee.preventDefault(),(ee.key==="ArrowLeft"&&this.orientation==="horizontal"||ee.key==="ArrowUp"&&this.orientation==="vertical")&&(O-=Y),(ee.key==="ArrowRight"&&this.orientation==="horizontal"||ee.key==="ArrowDown"&&this.orientation==="vertical")&&(O+=Y),ee.key==="Home"&&(O=this.primary==="end"?100:0),ee.key==="End"&&(O=this.primary==="end"?0:100),ee.key==="Enter")if(this.isCollapsed)O=this.positionBeforeCollapsing,this.isCollapsed=!1;else{const te=this.position;O=0,requestAnimationFrame(()=>{this.isCollapsed=!0,this.positionBeforeCollapsing=te})}this.position=clamp$3(O,0,100)}}handleResize(ee){const{width:O,height:Y}=ee[0].contentRect;this.size=this.orientation==="vertical"?Y:O,(isNaN(this.cachedPositionInPixels)||this.position===1/0)&&(this.cachedPositionInPixels=Number(this.getAttribute("position-in-pixels")),this.positionInPixels=Number(this.getAttribute("position-in-pixels")),this.position=this.pixelsToPercentage(this.positionInPixels)),this.primary&&(this.position=this.pixelsToPercentage(this.cachedPositionInPixels))}handlePositionChange(){this.cachedPositionInPixels=this.percentageToPixels(this.position),this.positionInPixels=this.percentageToPixels(this.position),this.isCollapsed=!1,this.positionBeforeCollapsing=0,this.dispatchEvent(new WaRepositionEvent)}handlePositionInPixelsChange(){this.position=this.pixelsToPercentage(this.positionInPixels)}handleVerticalChange(){this.detectSize()}render(){const ee=this.orientation==="vertical"?"gridTemplateRows":"gridTemplateColumns",O=this.orientation==="vertical"?"gridTemplateColumns":"gridTemplateRows",Y=this.hasUpdated?this.localize.dir()==="rtl":this.dir==="rtl",te=`
      clamp(
        0%,
        clamp(
          var(--min),
          ${this.position}% - var(--divider-width) / 2,
          var(--max)
        ),
        calc(100% - var(--divider-width))
      )
    `,ne="auto";return this.style||(this.style={}),this.primary==="end"?Y&&this.orientation==="horizontal"?this.style[ee]=`${te} var(--divider-width) ${ne}`:this.style[ee]=`${ne} var(--divider-width) ${te}`:Y&&this.orientation==="horizontal"?this.style[ee]=`${ne} var(--divider-width) ${te}`:this.style[ee]=`${te} var(--divider-width) ${ne}`,this.style[O]="",x$1`
      <slot name="start" part="panel start" class="start"></slot>

      <div
        part="divider"
        class="divider"
        tabindex=${o$6(this.disabled?void 0:"0")}
        role="separator"
        aria-valuenow=${this.position}
        aria-valuemin="0"
        aria-valuemax="100"
        aria-label=${this.localize.term("resize")}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleDrag}
        @touchstart=${this.handleDrag}
      >
        <slot name="divider"></slot>
      </div>

      <slot name="end" part="panel end" class="end"></slot>
    `}};WaSplitPanel.css=split_panel_default;__decorateClass$d([e$9(".divider")],WaSplitPanel.prototype,"divider",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaSplitPanel.prototype,"position",2);__decorateClass$d([n$7({attribute:"position-in-pixels",type:Number})],WaSplitPanel.prototype,"positionInPixels",2);__decorateClass$d([n$7({reflect:!0})],WaSplitPanel.prototype,"orientation",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSplitPanel.prototype,"disabled",2);__decorateClass$d([n$7()],WaSplitPanel.prototype,"primary",2);__decorateClass$d([n$7()],WaSplitPanel.prototype,"snap",2);__decorateClass$d([n$7({type:Number,attribute:"snap-threshold"})],WaSplitPanel.prototype,"snapThreshold",2);__decorateClass$d([watch("position")],WaSplitPanel.prototype,"handlePositionChange",1);__decorateClass$d([watch("positionInPixels")],WaSplitPanel.prototype,"handlePositionInPixelsChange",1);__decorateClass$d([watch("vertical")],WaSplitPanel.prototype,"handleVerticalChange",1);WaSplitPanel=__decorateClass$d([t$b("wa-split-panel")],WaSplitPanel);var switch_default=`:host {
  --height: var(--wa-form-control-toggle-size);
  --width: calc(var(--height) * 1.75);
  --thumb-size: 0.75em;

  display: inline-flex;
  line-height: var(--wa-form-control-value-line-height);
}

label {
  position: relative;
  display: flex;
  align-items: center;
  font: inherit;
  color: var(--wa-form-control-value-color);
  vertical-align: middle;
  cursor: pointer;
}

.switch {
  flex: 0 0 auto;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--width);
  height: var(--height);
  background-color: var(--wa-form-control-background-color);
  border-color: var(--wa-form-control-border-color);
  border-radius: var(--height);
  border-style: var(--wa-form-control-border-style);
  border-width: var(--wa-form-control-border-width);
  transition-property: translate, background, border-color, box-shadow;
  transition-duration: var(--wa-transition-normal);
  transition-timing-function: var(--wa-transition-easing);
}

.switch .thumb {
  aspect-ratio: 1 / 1;
  width: var(--thumb-size);
  height: var(--thumb-size);
  background-color: var(--wa-form-control-border-color);
  border-radius: 50%;
  translate: calc((var(--width) - var(--height)) / -2);
  transition: inherit;
}

.input {
  position: absolute;
  opacity: 0;
  padding: 0;
  margin: 0;
  pointer-events: none;
}

/* Focus */
label:not(.disabled) .input:focus-visible ~ .switch .thumb {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
}

/* Checked */
.checked .switch {
  background-color: var(--wa-form-control-activated-color);
  border-color: var(--wa-form-control-activated-color);
}

.checked .switch .thumb {
  background-color: var(--wa-color-surface-default);
  translate: calc((var(--width) - var(--height)) / 2);
}

/* Disabled */
label:has(> :disabled) {
  opacity: 0.5;
  cursor: not-allowed;
}

[part~='label'] {
  display: inline-block;
  line-height: var(--height);
  margin-inline-start: 0.5em;
  user-select: none;
  -webkit-user-select: none;
}

:host([required]) [part~='label']::after {
  content: var(--wa-form-control-required-content);
  color: var(--wa-form-control-required-content-color);
  margin-inline-start: var(--wa-form-control-required-content-offset);
}

@media (forced-colors: active) {
  :checked:enabled + .switch:hover .thumb,
  :checked + .switch .thumb {
    background-color: ButtonText;
  }
}
`,WaSwitch=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.hasSlotController=new HasSlotController(this,"hint"),this.title="",this.name=null,this._value=this.getAttribute("value")??null,this.size="medium",this.disabled=!1,this.checked=this.hasAttribute("checked"),this.defaultChecked=this.hasAttribute("checked"),this.form=null,this.required=!1,this.hint="",this.withHint=!1}static get validators(){return[...super.validators,MirrorValidator()]}get value(){return this._value??"on"}set value(ee){this._value=ee}firstUpdated(ee){super.firstUpdated(ee),this.handleValueOrCheckedChange()}handleClick(){this.hasInteracted=!0,this.checked=!this.checked,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))})}handleKeyDown(ee){ee.key==="ArrowLeft"&&(ee.preventDefault(),this.checked=!1,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))})),ee.key==="ArrowRight"&&(ee.preventDefault(),this.checked=!0,this.updateComplete.then(()=>{this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}))}willUpdate(ee){super.willUpdate(ee),ee.has("defaultChecked")&&(this.hasInteracted||(this.checked=this.defaultChecked)),(ee.has("value")||ee.has("checked"))&&this.handleValueOrCheckedChange()}handleValueOrCheckedChange(){this.setValue(this.checked?this.value:null,this._value),this.updateValidity()}handleDefaultCheckedChange(){!this.hasInteracted&&this.checked!==this.defaultChecked&&(this.checked=this.defaultChecked,this.handleValueOrCheckedChange())}handleStateChange(){this.hasUpdated&&(this.input.checked=this.checked),this.customStates.set("checked",this.checked),this.updateValidity()}handleDisabledChange(){this.updateValidity()}click(){this.input.click()}focus(ee){this.input.focus(ee)}blur(){this.input.blur()}setValue(ee,O){if(!this.checked){this.internals.setFormValue(null,null);return}this.internals.setFormValue(ee??"on",O)}formResetCallback(){this.checked=this.defaultChecked,super.formResetCallback(),this.handleValueOrCheckedChange()}render(){const ee=this.hasUpdated?this.hasSlotController.test("hint"):this.withHint,O=this.hint?!0:!!ee;return x$1`
      <label
        part="base"
        class=${e$5({checked:this.checked,disabled:this.disabled})}
      >
        <input
          class="input"
          type="checkbox"
          title=${this.title}
          name=${this.name}
          value=${o$6(this.value)}
          .checked=${l$1(this.checked)}
          .disabled=${this.disabled}
          .required=${this.required}
          role="switch"
          aria-checked=${this.checked?"true":"false"}
          aria-describedby="hint"
          @click=${this.handleClick}
          @keydown=${this.handleKeyDown}
        />

        <span part="control" class="switch">
          <span part="thumb" class="thumb"></span>
        </span>

        <slot part="label" class="label"></slot>
      </label>

      <slot
        id="hint"
        name="hint"
        part="hint"
        class=${e$5({"has-slotted":O})}
        aria-hidden=${O?"false":"true"}
        >${this.hint}</slot
      >
    `}};WaSwitch.shadowRootOptions={...WebAwesomeFormAssociatedElement.shadowRootOptions,delegatesFocus:!0};WaSwitch.css=[form_control_default,size_default,switch_default];__decorateClass$d([e$9('input[type="checkbox"]')],WaSwitch.prototype,"input",2);__decorateClass$d([n$7()],WaSwitch.prototype,"title",2);__decorateClass$d([n$7({reflect:!0})],WaSwitch.prototype,"name",2);__decorateClass$d([n$7({reflect:!0})],WaSwitch.prototype,"value",1);__decorateClass$d([n$7({reflect:!0})],WaSwitch.prototype,"size",2);__decorateClass$d([n$7({type:Boolean})],WaSwitch.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,attribute:!1})],WaSwitch.prototype,"checked",2);__decorateClass$d([n$7({type:Boolean,attribute:"checked",reflect:!0})],WaSwitch.prototype,"defaultChecked",2);__decorateClass$d([n$7({reflect:!0})],WaSwitch.prototype,"form",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaSwitch.prototype,"required",2);__decorateClass$d([n$7({attribute:"hint"})],WaSwitch.prototype,"hint",2);__decorateClass$d([n$7({attribute:"with-hint",type:Boolean})],WaSwitch.prototype,"withHint",2);__decorateClass$d([watch("defaultChecked")],WaSwitch.prototype,"handleDefaultCheckedChange",1);__decorateClass$d([watch(["checked"])],WaSwitch.prototype,"handleStateChange",1);__decorateClass$d([watch("disabled",{waitUntilFirstUpdate:!0})],WaSwitch.prototype,"handleDisabledChange",1);WaSwitch=__decorateClass$d([t$b("wa-switch")],WaSwitch);var WaTabHideEvent=class extends Event{constructor(ee){super("wa-tab-hide",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},WaTabShowEvent=class extends Event{constructor(ee){super("wa-tab-show",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},tab_group_default=`:host {
  --indicator-color: var(--wa-color-brand-fill-loud);
  --track-color: var(--wa-color-neutral-fill-normal);
  --track-width: 0.125rem;

  display: block;
}

.tab-group {
  display: flex;
  border-radius: 0;
}

.tabs {
  display: flex;
  position: relative;
}

.indicator {
  position: absolute;
}

.tab-group-has-scroll-controls .nav-container {
  position: relative;
  padding: 0 1.5em;
}

.body {
  display: block;
}

.scroll-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  bottom: 0;
  width: 1.5em;
}

.scroll-button-start {
  inset-inline-start: 0;
}

.scroll-button-end {
  inset-inline-end: 0;
}

/*
   * Top
   */

.tab-group-top {
  flex-direction: column;
}

.tab-group-top .nav-container {
  order: 1;
}

.tab-group-top .nav {
  display: flex;
  overflow-x: auto;

  /* Hide scrollbar in Firefox */
  scrollbar-width: none;
}

/* Hide scrollbar in Chrome/Safari */
.tab-group-top .nav::-webkit-scrollbar {
  width: 0;
  height: 0;
}

.tab-group-top .tabs {
  flex: 1 1 auto;
  position: relative;
  flex-direction: row;
  border-bottom: solid var(--track-width) var(--track-color);
}

.tab-group-top .indicator {
  bottom: calc(-1 * var(--track-width));
  border-bottom: solid var(--track-width) var(--indicator-color);
}

.tab-group-top .body {
  order: 2;
}

.tab-group-top ::slotted(wa-tab[active]) {
  border-block-end: solid var(--track-width) var(--indicator-color);
  margin-block-end: calc(-1 * var(--track-width));
}

.tab-group-top ::slotted(wa-tab-panel) {
  --padding: var(--wa-space-xl) 0;
}

/*
   * Bottom
   */

.tab-group-bottom {
  flex-direction: column;
}

.tab-group-bottom .nav-container {
  order: 2;
}

.tab-group-bottom .nav {
  display: flex;
  overflow-x: auto;

  /* Hide scrollbar in Firefox */
  scrollbar-width: none;
}

/* Hide scrollbar in Chrome/Safari */
.tab-group-bottom .nav::-webkit-scrollbar {
  width: 0;
  height: 0;
}

.tab-group-bottom .tabs {
  flex: 1 1 auto;
  position: relative;
  flex-direction: row;
  border-top: solid var(--track-width) var(--track-color);
}

.tab-group-bottom .indicator {
  top: calc(-1 * var(--track-width));
  border-top: solid var(--track-width) var(--indicator-color);
}

.tab-group-bottom .body {
  order: 1;
}

.tab-group-bottom ::slotted(wa-tab[active]) {
  border-block-start: solid var(--track-width) var(--indicator-color);
  margin-block-start: calc(-1 * var(--track-width));
}

.tab-group-bottom ::slotted(wa-tab-panel) {
  --padding: var(--wa-space-xl) 0;
}

/*
   * Start
   */

.tab-group-start {
  flex-direction: row;
}

.tab-group-start .nav-container {
  order: 1;
}

.tab-group-start .tabs {
  flex: 0 0 auto;
  flex-direction: column;
  border-inline-end: solid var(--track-width) var(--track-color);
}

.tab-group-start .indicator {
  inset-inline-end: calc(-1 * var(--track-width));
  border-right: solid var(--track-width) var(--indicator-color);
}

.tab-group-start .body {
  flex: 1 1 auto;
  order: 2;
}

.tab-group-start ::slotted(wa-tab[active]) {
  border-inline-end: solid var(--track-width) var(--indicator-color);
  margin-inline-end: calc(-1 * var(--track-width));
}

.tab-group-start ::slotted(wa-tab-panel) {
  --padding: 0 var(--wa-space-xl);
}

/*
   * End
   */

.tab-group-end {
  flex-direction: row;
}

.tab-group-end .nav-container {
  order: 2;
}

.tab-group-end .tabs {
  flex: 0 0 auto;
  flex-direction: column;
  border-left: solid var(--track-width) var(--track-color);
}

.tab-group-end .indicator {
  inset-inline-start: calc(-1 * var(--track-width));
  border-inline-start: solid var(--track-width) var(--indicator-color);
}

.tab-group-end .body {
  flex: 1 1 auto;
  order: 1;
}

.tab-group-end ::slotted(wa-tab[active]) {
  border-inline-start: solid var(--track-width) var(--indicator-color);
  margin-inline-start: calc(-1 * var(--track-width));
}

.tab-group-end ::slotted(wa-tab-panel) {
  --padding: 0 var(--wa-space-xl);
}
`,WaTabGroup=class extends WebAwesomeElement{constructor(){super(...arguments),this.tabs=[],this.focusableTabs=[],this.panels=[],this.localize=new LocalizeController(this),this.hasScrollControls=!1,this.active="",this.placement="top",this.activation="auto",this.withoutScrollControls=!1}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>{this.updateScrollControls()}),this.mutationObserver=new MutationObserver(ee=>{ee.some(Y=>!["aria-labelledby","aria-controls"].includes(Y.attributeName))&&setTimeout(()=>this.setAriaLabels());const O=ee.filter(Y=>Y.target.closest("wa-tab-group")===this);if(O.some(Y=>Y.attributeName==="disabled"))this.syncTabsAndPanels();else if(O.some(Y=>Y.attributeName==="active")){const te=O.filter(ne=>ne.attributeName==="active"&&ne.target.tagName.toLowerCase()==="wa-tab").map(ne=>ne.target).find(ne=>ne.active);te&&te.closest("wa-tab-group")===this&&this.setActiveTab(te)}}),this.updateComplete.then(()=>{this.syncTabsAndPanels(),this.mutationObserver.observe(this,{attributes:!0,childList:!0,subtree:!0}),this.resizeObserver.observe(this.nav),new IntersectionObserver((O,Y)=>{if(O[0].intersectionRatio>0){if(this.setAriaLabels(),this.active){const te=this.tabs.find(ne=>ne.panel===this.active);te&&this.setActiveTab(te)}else this.setActiveTab(this.getActiveTab()??this.tabs[0],{emitEvents:!1});Y.unobserve(O[0].target)}}).observe(this.tabGroup)})}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.nav&&this.resizeObserver?.unobserve(this.nav)}getAllTabs(){return[...this.shadowRoot.querySelector('slot[name="nav"]').assignedElements()].filter(O=>O.tagName.toLowerCase()==="wa-tab")}getAllPanels(){return[...this.body.assignedElements()].filter(ee=>ee.tagName.toLowerCase()==="wa-tab-panel")}getActiveTab(){return this.tabs.find(ee=>ee.active)}handleClick(ee){const Y=ee.target.closest("wa-tab");Y?.closest("wa-tab-group")===this&&Y!==null&&this.setActiveTab(Y,{scrollBehavior:"smooth"})}handleKeyDown(ee){const Y=ee.target.closest("wa-tab");if(Y?.closest("wa-tab-group")===this){if(["Enter"," "].includes(ee.key)){Y!==null&&(this.setActiveTab(Y,{scrollBehavior:"smooth"}),ee.preventDefault());return}if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(ee.key)){const ne=this.tabs.find(tt=>tt.matches(":focus")),xe=this.localize.dir()==="rtl";let et=null;if(ne?.tagName.toLowerCase()==="wa-tab"){if(ee.key==="Home")et=this.focusableTabs[0];else if(ee.key==="End")et=this.focusableTabs[this.focusableTabs.length-1];else if(["top","bottom"].includes(this.placement)&&ee.key===(xe?"ArrowRight":"ArrowLeft")||["start","end"].includes(this.placement)&&ee.key==="ArrowUp"){const tt=this.tabs.findIndex(it=>it===ne);et=this.findNextFocusableTab(tt,"backward")}else if(["top","bottom"].includes(this.placement)&&ee.key===(xe?"ArrowLeft":"ArrowRight")||["start","end"].includes(this.placement)&&ee.key==="ArrowDown"){const tt=this.tabs.findIndex(it=>it===ne);et=this.findNextFocusableTab(tt,"forward")}if(!et)return;et.tabIndex=0,et.focus({preventScroll:!0}),this.activation==="auto"?this.setActiveTab(et,{scrollBehavior:"smooth"}):this.tabs.forEach(tt=>{tt.tabIndex=tt===et?0:-1}),["top","bottom"].includes(this.placement)&&scrollIntoView(et,this.nav,"horizontal"),ee.preventDefault()}}}}findNextFocusableTab(ee,O){let Y=null;const te=O==="forward"?1:-1;let ne=ee+te;for(;ee<this.tabs.length;){if(Y=this.tabs[ne]||null,Y===null){O==="forward"?Y=this.focusableTabs[0]:Y=this.focusableTabs[this.focusableTabs.length-1];break}if(!Y.disabled)break;ne+=te}return Y}handleScrollToStart(){this.nav.scroll({left:this.localize.dir()==="rtl"?this.nav.scrollLeft+this.nav.clientWidth:this.nav.scrollLeft-this.nav.clientWidth,behavior:"smooth"})}handleScrollToEnd(){this.nav.scroll({left:this.localize.dir()==="rtl"?this.nav.scrollLeft-this.nav.clientWidth:this.nav.scrollLeft+this.nav.clientWidth,behavior:"smooth"})}setActiveTab(ee,O){if(O={emitEvents:!0,scrollBehavior:"auto",...O},ee.closest("wa-tab-group")===this&&ee!==this.activeTab&&!ee.disabled){const Y=this.activeTab;this.active=ee.panel,this.activeTab=ee,this.tabs.forEach(te=>{te.active=te===this.activeTab,te.tabIndex=te===this.activeTab?0:-1}),this.panels.forEach(te=>te.active=te.name===this.activeTab?.panel),["top","bottom"].includes(this.placement)&&scrollIntoView(this.activeTab,this.nav,"horizontal",O.scrollBehavior),O.emitEvents&&(Y&&this.dispatchEvent(new WaTabHideEvent({name:Y.panel})),this.dispatchEvent(new WaTabShowEvent({name:this.activeTab.panel})))}}setAriaLabels(){this.tabs.forEach(ee=>{const O=this.panels.find(Y=>Y.name===ee.panel);O&&(ee.setAttribute("aria-controls",O.getAttribute("id")),O.setAttribute("aria-labelledby",ee.getAttribute("id")))})}syncTabsAndPanels(){this.tabs=this.getAllTabs(),this.focusableTabs=this.tabs.filter(ee=>!ee.disabled),this.panels=this.getAllPanels(),this.updateComplete.then(()=>this.updateScrollControls())}updateActiveTab(){const ee=this.tabs.find(O=>O.panel===this.active);ee&&this.setActiveTab(ee,{scrollBehavior:"smooth"})}updateScrollControls(){this.withoutScrollControls?this.hasScrollControls=!1:this.hasScrollControls=["top","bottom"].includes(this.placement)&&this.nav.scrollWidth>this.nav.clientWidth+1}render(){const ee=this.hasUpdated?this.localize.dir()==="rtl":this.dir==="rtl";return x$1`
      <div
        part="base"
        class=${e$5({"tab-group":!0,"tab-group-top":this.placement==="top","tab-group-bottom":this.placement==="bottom","tab-group-start":this.placement==="start","tab-group-end":this.placement==="end","tab-group-has-scroll-controls":this.hasScrollControls})}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
      >
        <div class="nav-container" part="nav">
          ${this.hasScrollControls?x$1`
                <wa-button
                  part="scroll-button scroll-button-start"
                  exportparts="base:scroll-button__base"
                  class="scroll-button scroll-button-start"
                  appearance="plain"
                  @click=${this.handleScrollToStart}
                >
                  <wa-icon
                    name=${ee?"chevron-right":"chevron-left"}
                    library="system"
                    variant="solid"
                    label=${this.localize.term("scrollToStart")}
                  ></wa-icon>
                </wa-button>
              `:""}

          <!-- We have a focus listener because in Firefox (and soon to be Chrome) overflow containers are focusable. -->
          <div class="nav" @focus=${()=>this.activeTab?.focus({preventScroll:!0})}>
            <div part="tabs" class="tabs" role="tablist">
              <slot name="nav" @slotchange=${this.syncTabsAndPanels}></slot>
            </div>
          </div>

          ${this.hasScrollControls?x$1`
                <wa-button
                  part="scroll-button scroll-button-end"
                  class="scroll-button scroll-button-end"
                  exportparts="base:scroll-button__base"
                  appearance="plain"
                  @click=${this.handleScrollToEnd}
                >
                  <wa-icon
                    name=${ee?"chevron-left":"chevron-right"}
                    library="system"
                    variant="solid"
                    label=${this.localize.term("scrollToEnd")}
                  ></wa-icon>
                </wa-button>
              `:""}
        </div>

        <slot part="body" class="body" @slotchange=${this.syncTabsAndPanels}></slot>
      </div>
    `}};WaTabGroup.css=tab_group_default;__decorateClass$d([e$9(".tab-group")],WaTabGroup.prototype,"tabGroup",2);__decorateClass$d([e$9(".body")],WaTabGroup.prototype,"body",2);__decorateClass$d([e$9(".nav")],WaTabGroup.prototype,"nav",2);__decorateClass$d([r$6()],WaTabGroup.prototype,"hasScrollControls",2);__decorateClass$d([n$7({reflect:!0})],WaTabGroup.prototype,"active",2);__decorateClass$d([n$7()],WaTabGroup.prototype,"placement",2);__decorateClass$d([n$7()],WaTabGroup.prototype,"activation",2);__decorateClass$d([n$7({attribute:"without-scroll-controls",type:Boolean})],WaTabGroup.prototype,"withoutScrollControls",2);__decorateClass$d([watch("active")],WaTabGroup.prototype,"updateActiveTab",1);__decorateClass$d([watch("withoutScrollControls",{waitUntilFirstUpdate:!0})],WaTabGroup.prototype,"updateScrollControls",1);WaTabGroup=__decorateClass$d([t$b("wa-tab-group")],WaTabGroup);var tab_default=`:host {
  display: inline-block;
  color: var(--wa-color-neutral-on-quiet);
  font-weight: var(--wa-font-weight-action);
}

.tab {
  display: inline-flex;
  align-items: center;
  font: inherit;
  padding: 1em 1.5em;
  white-space: nowrap;
  user-select: none;
  -webkit-user-select: none;
  cursor: pointer;
  transition: color var(--wa-transition-fast) var(--wa-transition-easing);

  ::slotted(wa-icon:first-child) {
    margin-inline-end: 0.5em;
  }

  ::slotted(wa-icon:last-child) {
    margin-inline-start: 0.5em;
  }
}

@media (hover: hover) {
  :host(:hover:not([disabled])) .tab {
    color: currentColor;
  }
}

:host(:focus) {
  outline: transparent;
}

:host(:focus-visible) .tab {
  outline: var(--wa-focus-ring);
  outline-offset: calc(-1 * var(--wa-border-width-l) - var(--wa-focus-ring-offset));
}

:host([active]:not([disabled])) {
  color: var(--wa-color-brand-on-quiet);
}

:host([disabled]) .tab {
  opacity: 0.5;
  cursor: not-allowed;
}

@media (forced-colors: active) {
  :host([active]:not([disabled])) {
    outline: solid 1px transparent;
    outline-offset: -3px;
  }
}
`,id$1=0,WaTab=class extends WebAwesomeElement{constructor(){super(...arguments),this.attrId=++id$1,this.componentId=`wa-tab-${this.attrId}`,this.panel="",this.active=!1,this.disabled=!1,this.tabIndex=0}connectedCallback(){this.slot||(this.slot="nav"),super.connectedCallback(),this.setAttribute("role","tab")}handleActiveChange(){this.setAttribute("aria-selected",this.active?"true":"false")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false"),this.disabled&&!this.active?this.tabIndex=-1:this.tabIndex=0}render(){return this.id=this.id?.length>0?this.id:this.componentId,x$1`
      <div
        part="base"
        class=${e$5({tab:!0,"tab-active":this.active})}
      >
        <slot></slot>
      </div>
    `}};WaTab.css=tab_default;__decorateClass$d([e$9(".tab")],WaTab.prototype,"tab",2);__decorateClass$d([n$7({reflect:!0})],WaTab.prototype,"panel",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTab.prototype,"active",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTab.prototype,"disabled",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaTab.prototype,"tabIndex",2);__decorateClass$d([watch("active")],WaTab.prototype,"handleActiveChange",1);__decorateClass$d([watch("disabled")],WaTab.prototype,"handleDisabledChange",1);WaTab=__decorateClass$d([t$b("wa-tab")],WaTab);var tab_panel_default=`:host {
  --padding: 0;

  display: none;
}

:host([active]) {
  display: block;
}

.tab-panel {
  display: block;
  padding: var(--padding);
}
`,id=0,WaTabPanel=class extends WebAwesomeElement{constructor(){super(...arguments),this.attrId=++id,this.componentId=`wa-tab-panel-${this.attrId}`,this.name="",this.active=!1}connectedCallback(){super.connectedCallback(),this.id=this.id.length>0?this.id:this.componentId,this.setAttribute("role","tabpanel")}handleActiveChange(){this.setAttribute("aria-hidden",this.active?"false":"true")}render(){return x$1`
      <slot
        part="base"
        class=${e$5({"tab-panel":!0,"tab-panel-active":this.active})}
      ></slot>
    `}};WaTabPanel.css=tab_panel_default;__decorateClass$d([n$7({reflect:!0})],WaTabPanel.prototype,"name",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTabPanel.prototype,"active",2);__decorateClass$d([watch("active")],WaTabPanel.prototype,"handleActiveChange",1);WaTabPanel=__decorateClass$d([t$b("wa-tab-panel")],WaTabPanel);var textarea_default=`:host {
  border-width: 0;
}

.textarea {
  display: grid;
  align-items: center;
  margin: 0;
  border: none;
  outline: none;
  cursor: inherit;
  font: inherit;
  background-color: var(--wa-form-control-background-color);
  border-color: var(--wa-form-control-border-color);
  border-radius: var(--wa-form-control-border-radius);
  border-style: var(--wa-form-control-border-style);
  border-width: var(--wa-form-control-border-width);
  -webkit-appearance: none;

  &:focus-within {
    outline: var(--wa-focus-ring);
    outline-offset: var(--wa-focus-ring-offset);
  }
}

/* Appearance modifiers */
:host([appearance='outlined']) .textarea {
  background-color: var(--wa-form-control-background-color);
  border-color: var(--wa-form-control-border-color);
}

:host([appearance='filled']) .textarea {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-color-neutral-fill-quiet);
}

:host([appearance='filled-outlined']) .textarea {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-color: var(--wa-form-control-border-color);
}

textarea {
  display: block;
  width: 100%;
  border: none;
  background: transparent;
  font: inherit;
  color: inherit;
  padding: calc(var(--wa-form-control-padding-block) - ((1lh - 1em) / 2)) var(--wa-form-control-padding-inline); /* accounts for the larger line height of textarea content */
  min-height: calc(var(--wa-form-control-height) - var(--border-width) * 2);
  box-shadow: none;
  margin: 0;

  &::placeholder {
    color: var(--wa-form-control-placeholder-color);
    user-select: none;
    -webkit-user-select: none;
  }

  &:autofill {
    &,
    &:hover,
    &:focus,
    &:active {
      box-shadow: none;
      caret-color: var(--wa-form-control-value-color);
    }
  }

  &:focus {
    outline: none;
  }
}

/* Shared textarea and size-adjuster positioning */
.control,
.size-adjuster {
  grid-area: 1 / 1 / 2 / 2;
}

.size-adjuster {
  visibility: hidden;
  pointer-events: none;
  opacity: 0;
  padding: 0;
}

textarea::-webkit-search-decoration,
textarea::-webkit-search-cancel-button,
textarea::-webkit-search-results-button,
textarea::-webkit-search-results-decoration {
  -webkit-appearance: none;
}

/*
 * Resize types
 */

:host([resize='none']) textarea {
  resize: none;
}

textarea,
:host([resize='vertical']) textarea {
  resize: vertical;
}

:host([resize='horizontal']) textarea {
  resize: horizontal;
}

:host([resize='both']) textarea {
  resize: both;
}

:host([resize='auto']) textarea {
  height: auto;
  resize: none;
  overflow-y: hidden;
}
`,WaTextarea=class extends WebAwesomeFormAssociatedElement{constructor(){super(...arguments),this.assumeInteractionOn=["blur","input"],this.hasSlotController=new HasSlotController(this,"hint","label"),this.title="",this.name=null,this._value=null,this.defaultValue=this.getAttribute("value")??"",this.size="medium",this.appearance="outlined",this.label="",this.hint="",this.placeholder="",this.rows=4,this.resize="vertical",this.disabled=!1,this.readonly=!1,this.form=null,this.required=!1,this.spellcheck=!0,this.withLabel=!1,this.withHint=!1}static get validators(){return[...super.validators,MirrorValidator()]}get value(){return this.valueHasChanged?this._value:this._value??this.defaultValue}set value(ee){this._value!==ee&&(this.valueHasChanged=!0,this._value=ee)}connectedCallback(){super.connectedCallback(),this.resizeObserver=new ResizeObserver(()=>this.setTextareaDimensions()),this.updateComplete.then(()=>{if(this.setTextareaDimensions(),this.resizeObserver.observe(this.input),this.didSSR&&this.input&&this.value!==this.input.value){const ee=this.input.value;this.value=ee}})}disconnectedCallback(){super.disconnectedCallback(),this.input&&this.resizeObserver?.unobserve(this.input)}handleBlur(){this.checkValidity()}handleChange(ee){this.valueHasChanged=!0,this.value=this.input.value,this.setTextareaDimensions(),this.checkValidity(),this.relayNativeEvent(ee,{bubbles:!0,composed:!0})}handleInput(ee){this.valueHasChanged=!0,this.value=this.input.value,this.relayNativeEvent(ee,{bubbles:!0,composed:!0})}setTextareaDimensions(){if(this.resize==="none"){this.base.style.width="",this.base.style.height="";return}if(this.resize==="auto"){this.sizeAdjuster.style.height=`${this.input.clientHeight}px`,this.input.style.height="auto",this.input.style.height=`${this.input.scrollHeight}px`,this.base.style.width="",this.base.style.height="";return}if(this.input.style.width){const ee=Number(this.input.style.width.split(/px/)[0])+2;this.base.style.width=`${ee}px`}if(this.input.style.height){const ee=Number(this.input.style.height.split(/px/)[0])+2;this.base.style.height=`${ee}px`}}handleRowsChange(){this.setTextareaDimensions()}async handleValueChange(){await this.updateComplete,this.checkValidity(),this.setTextareaDimensions()}updated(ee){ee.has("resize")&&this.setTextareaDimensions(),super.updated(ee),ee.has("value")&&this.customStates.set("blank",!this.value)}focus(ee){this.input.focus(ee)}blur(){this.input.blur()}select(){this.input.select()}scrollPosition(ee){if(ee){typeof ee.top=="number"&&(this.input.scrollTop=ee.top),typeof ee.left=="number"&&(this.input.scrollLeft=ee.left);return}return{top:this.input.scrollTop,left:this.input.scrollTop}}setSelectionRange(ee,O,Y="none"){this.input.setSelectionRange(ee,O,Y)}setRangeText(ee,O,Y,te="preserve"){const ne=O??this.input.selectionStart,xe=Y??this.input.selectionEnd;this.input.setRangeText(ee,ne,xe,te),this.value!==this.input.value&&(this.value=this.input.value,this.setTextareaDimensions())}formResetCallback(){this.value=this.defaultValue,super.formResetCallback()}render(){const ee=this.hasUpdated?this.hasSlotController.test("label"):this.withLabel,O=this.hasUpdated?this.hasSlotController.test("hint"):this.withHint,Y=this.label?!0:!!ee,te=this.hint?!0:!!O;return x$1`
      <label part="form-control-label label" class="label" for="input" aria-hidden=${Y?"false":"true"}>
        <slot name="label">${this.label}</slot>
      </label>

      <div part="base" class="textarea">
        <textarea
          part="textarea"
          id="input"
          class="control"
          title=${this.title}
          name=${o$6(this.name)}
          .value=${l$1(this.value)}
          ?disabled=${this.disabled}
          ?readonly=${this.readonly}
          ?required=${this.required}
          placeholder=${o$6(this.placeholder)}
          rows=${o$6(this.rows)}
          minlength=${o$6(this.minlength)}
          maxlength=${o$6(this.maxlength)}
          autocapitalize=${o$6(this.autocapitalize)}
          autocorrect=${o$6(this.autocorrect)}
          ?autofocus=${this.autofocus}
          spellcheck=${o$6(this.spellcheck)}
          enterkeyhint=${o$6(this.enterkeyhint)}
          inputmode=${o$6(this.inputmode)}
          aria-describedby="hint"
          @change=${this.handleChange}
          @input=${this.handleInput}
          @blur=${this.handleBlur}
        ></textarea>

        <!-- This "adjuster" exists to prevent layout shifting. https://github.com/shoelace-style/shoelace/issues/2180 -->
        <div part="textarea-adjuster" class="size-adjuster" ?hidden=${this.resize!=="auto"}></div>
      </div>

      <slot
        id="hint"
        name="hint"
        part="hint"
        aria-hidden=${te?"false":"true"}
        class=${e$5({"has-slotted":te})}
        >${this.hint}</slot
      >
    `}};WaTextarea.css=[textarea_default,form_control_default,size_default];__decorateClass$d([e$9(".control")],WaTextarea.prototype,"input",2);__decorateClass$d([e$9('[part~="base"]')],WaTextarea.prototype,"base",2);__decorateClass$d([e$9(".size-adjuster")],WaTextarea.prototype,"sizeAdjuster",2);__decorateClass$d([n$7()],WaTextarea.prototype,"title",2);__decorateClass$d([n$7({reflect:!0})],WaTextarea.prototype,"name",2);__decorateClass$d([r$6()],WaTextarea.prototype,"value",1);__decorateClass$d([n$7({attribute:"value",reflect:!0})],WaTextarea.prototype,"defaultValue",2);__decorateClass$d([n$7({reflect:!0})],WaTextarea.prototype,"size",2);__decorateClass$d([n$7({reflect:!0})],WaTextarea.prototype,"appearance",2);__decorateClass$d([n$7()],WaTextarea.prototype,"label",2);__decorateClass$d([n$7({attribute:"hint"})],WaTextarea.prototype,"hint",2);__decorateClass$d([n$7()],WaTextarea.prototype,"placeholder",2);__decorateClass$d([n$7({type:Number})],WaTextarea.prototype,"rows",2);__decorateClass$d([n$7({reflect:!0})],WaTextarea.prototype,"resize",2);__decorateClass$d([n$7({type:Boolean})],WaTextarea.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTextarea.prototype,"readonly",2);__decorateClass$d([n$7({reflect:!0})],WaTextarea.prototype,"form",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTextarea.prototype,"required",2);__decorateClass$d([n$7({type:Number})],WaTextarea.prototype,"minlength",2);__decorateClass$d([n$7({type:Number})],WaTextarea.prototype,"maxlength",2);__decorateClass$d([n$7()],WaTextarea.prototype,"autocapitalize",2);__decorateClass$d([n$7()],WaTextarea.prototype,"autocorrect",2);__decorateClass$d([n$7()],WaTextarea.prototype,"autocomplete",2);__decorateClass$d([n$7({type:Boolean})],WaTextarea.prototype,"autofocus",2);__decorateClass$d([n$7()],WaTextarea.prototype,"enterkeyhint",2);__decorateClass$d([n$7({type:Boolean,converter:{fromAttribute:ee=>!(!ee||ee==="false"),toAttribute:ee=>ee?"true":"false"}})],WaTextarea.prototype,"spellcheck",2);__decorateClass$d([n$7()],WaTextarea.prototype,"inputmode",2);__decorateClass$d([n$7({attribute:"with-label",type:Boolean})],WaTextarea.prototype,"withLabel",2);__decorateClass$d([n$7({attribute:"with-hint",type:Boolean})],WaTextarea.prototype,"withHint",2);__decorateClass$d([watch("rows",{waitUntilFirstUpdate:!0})],WaTextarea.prototype,"handleRowsChange",1);__decorateClass$d([watch("value",{waitUntilFirstUpdate:!0})],WaTextarea.prototype,"handleValueChange",1);WaTextarea=__decorateClass$d([t$b("wa-textarea")],WaTextarea);var WaAfterCollapseEvent=class extends Event{constructor(){super("wa-after-collapse",{bubbles:!0,cancelable:!1,composed:!0})}},WaAfterExpandEvent=class extends Event{constructor(){super("wa-after-expand",{bubbles:!0,cancelable:!1,composed:!0})}},WaCollapseEvent=class extends Event{constructor(){super("wa-collapse",{bubbles:!0,cancelable:!1,composed:!0})}},WaExpandEvent=class extends Event{constructor(){super("wa-expand",{bubbles:!0,cancelable:!1,composed:!0})}},WaLazyChangeEvent=class extends Event{constructor(){super("wa-lazy-change",{bubbles:!0,cancelable:!1,composed:!0})}},WaLazyLoadEvent=class extends Event{constructor(){super("wa-lazy-load",{bubbles:!0,cancelable:!1,composed:!0})}},tree_item_default=`:host {
  --show-duration: 200ms;
  --hide-duration: 200ms;

  display: block;
  color: var(--wa-color-text-normal);
  outline: 0;
  z-index: 0;
}

:host(:focus) {
  outline: none;
}

slot:not([name])::slotted(wa-icon) {
  margin-inline-end: var(--wa-space-xs);
}

.tree-item {
  position: relative;
  display: flex;
  align-items: stretch;
  flex-direction: column;
  cursor: default;
  user-select: none;
  -webkit-user-select: none;
}

.checkbox {
  line-height: var(--wa-form-control-value-line-height);
  pointer-events: none;
}

.expand-button,
.checkbox,
.label {
  font-family: inherit;
  font-size: var(--wa-font-size-m);
  font-weight: inherit;
}

.checkbox::part(base) {
  display: flex;
  align-items: center;
}

.indentation {
  display: block;
  width: 1em;
  flex-shrink: 0;
}

.expand-button {
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--wa-color-text-quiet);
  width: 2em;
  height: 2em;
  flex-shrink: 0;
  cursor: pointer;
}

.expand-button {
  transition: rotate var(--wa-transition-normal) var(--wa-transition-easing);
}

.tree-item-expanded .expand-button {
  rotate: 90deg;
}

.tree-item-expanded:dir(rtl) .expand-button {
  rotate: -90deg;
}

.tree-item-expanded slot[name='expand-icon'],
.tree-item:not(.tree-item-expanded) slot[name='collapse-icon'] {
  display: none;
}

.tree-item:not(.tree-item-has-expand-button) .expand-icon-slot {
  display: none;
}

.expand-button-visible {
  cursor: pointer;
}

.item {
  display: flex;
  align-items: center;
  border-inline-start: solid 3px transparent;
}

:host([disabled]) .item {
  opacity: 0.5;
  outline: none;
  cursor: not-allowed;
}

:host(:focus-visible) .item {
  outline: var(--wa-focus-ring);
  outline-offset: var(--wa-focus-ring-offset);
  z-index: 2;
}

:host(:not([aria-disabled='true'])) .tree-item-selected .item {
  background-color: var(--wa-color-neutral-fill-quiet);
  border-inline-start-color: var(--wa-color-brand-fill-loud);
}

:host(:not([aria-disabled='true'])) .expand-button {
  color: var(--wa-color-text-quiet);
}

.label {
  display: flex;
  align-items: center;
  transition: color var(--wa-transition-normal) var(--wa-transition-easing);
}

.children {
  display: block;
  font-size: calc(1em + var(--indent-size, var(--wa-space-m)));
}

/* Indentation lines */
.children {
  position: relative;
}

.children::before {
  content: '';
  position: absolute;
  top: var(--indent-guide-offset);
  bottom: var(--indent-guide-offset);
  inset-inline-start: calc(1em - (var(--indent-guide-width) / 2) - 1px);
  border-inline-end: var(--indent-guide-width) var(--indent-guide-style) var(--indent-guide-color);
  z-index: 1;
}

@media (forced-colors: active) {
  :host(:not([aria-disabled='true'])) .tree-item-selected .item {
    outline: dashed 1px SelectedItem;
  }
}
`,WaTreeItem=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.indeterminate=!1,this.isLeaf=!1,this.loading=!1,this.selectable=!1,this.expanded=!1,this.selected=!1,this.disabled=!1,this.lazy=!1}static isTreeItem(ee){return ee instanceof Element&&ee.getAttribute("role")==="treeitem"}connectedCallback(){super.connectedCallback(),this.setAttribute("role","treeitem"),this.setAttribute("tabindex","-1"),this.isNestedItem()&&(this.slot="children")}firstUpdated(){this.childrenContainer.hidden=!this.expanded,this.childrenContainer.style.height=this.expanded?"auto":"0",this.isLeaf=!this.lazy&&this.getChildrenItems().length===0,this.handleExpandedChange()}async animateCollapse(){this.dispatchEvent(new WaCollapseEvent);const ee=parseDuration(getComputedStyle(this.childrenContainer).getPropertyValue("--hide-duration"));await animate(this.childrenContainer,[{height:`${this.childrenContainer.scrollHeight}px`,opacity:"1",overflow:"hidden"},{height:"0",opacity:"0",overflow:"hidden"}],{duration:ee,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}),this.childrenContainer.hidden=!0,this.dispatchEvent(new WaAfterCollapseEvent)}isNestedItem(){const ee=this.parentElement;return!!ee&&WaTreeItem.isTreeItem(ee)}handleChildrenSlotChange(){this.loading=!1,this.isLeaf=!this.lazy&&this.getChildrenItems().length===0}willUpdate(ee){ee.has("selected")&&!ee.has("indeterminate")&&(this.indeterminate=!1)}async animateExpand(){this.dispatchEvent(new WaExpandEvent),this.childrenContainer.hidden=!1;const ee=parseDuration(getComputedStyle(this.childrenContainer).getPropertyValue("--show-duration"));await animate(this.childrenContainer,[{height:"0",opacity:"0",overflow:"hidden"},{height:`${this.childrenContainer.scrollHeight}px`,opacity:"1",overflow:"hidden"}],{duration:ee,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}),this.childrenContainer.style.height="auto",this.dispatchEvent(new WaAfterExpandEvent)}handleLoadingChange(){this.setAttribute("aria-busy",this.loading?"true":"false"),this.loading||this.animateExpand()}handleDisabledChange(){this.customStates.set("disabled",this.disabled),this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleExpandedState(){this.customStates.set("expanded",this.expanded)}handleIndeterminateStateChange(){this.customStates.set("indeterminate",this.indeterminate)}handleSelectedChange(){this.customStates.set("selected",this.selected),this.setAttribute("aria-selected",this.selected?"true":"false")}handleExpandedChange(){this.isLeaf?this.removeAttribute("aria-expanded"):this.setAttribute("aria-expanded",this.expanded?"true":"false")}handleExpandAnimation(){this.expanded?this.lazy?(this.loading=!0,this.dispatchEvent(new WaLazyLoadEvent)):this.animateExpand():this.animateCollapse()}handleLazyChange(){this.dispatchEvent(new WaLazyChangeEvent)}getChildrenItems({includeDisabled:ee=!0}={}){return this.childrenSlot?[...this.childrenSlot.assignedElements({flatten:!0})].filter(O=>WaTreeItem.isTreeItem(O)&&(ee||!O.disabled)):[]}render(){const ee=this.hasUpdated?this.localize.dir()==="rtl":this.dir==="rtl",O=!this.loading&&(!this.isLeaf||this.lazy);return x$1`
      <div
        part="base"
        class="${e$5({"tree-item":!0,"tree-item-expanded":this.expanded,"tree-item-selected":this.selected,"tree-item-leaf":this.isLeaf,"tree-item-has-expand-button":O})}"
      >
        <div class="item" part="item">
          <div class="indentation" part="indentation"></div>

          <div
            part="expand-button"
            class=${e$5({"expand-button":!0,"expand-button-visible":O})}
            aria-hidden="true"
          >
            <slot class="expand-icon-slot" name="expand-icon">
              ${n$5(this.loading,()=>x$1` <wa-spinner part="spinner" exportparts="base:spinner__base"></wa-spinner> `)}
              <wa-icon name=${ee?"chevron-left":"chevron-right"} library="system" variant="solid"></wa-icon>
            </slot>
            <slot class="expand-icon-slot" name="collapse-icon">
              <wa-icon name=${ee?"chevron-left":"chevron-right"} library="system" variant="solid"></wa-icon>
            </slot>
          </div>

          ${n$5(this.selectable,()=>x$1`
              <wa-checkbox
                part="checkbox"
                exportparts="
                    base:checkbox__base,
                    control:checkbox__control,
                    checked-icon:checkbox__checked-icon,
                    indeterminate-icon:checkbox__indeterminate-icon,
                    label:checkbox__label
                  "
                class="checkbox"
                ?disabled="${this.disabled}"
                ?checked="${l$1(this.selected)}"
                ?indeterminate="${this.indeterminate}"
                tabindex="-1"
              ></wa-checkbox>
            `)}

          <slot class="label" part="label"></slot>
        </div>

        <div class="children" part="children" role="group">
          <slot name="children" @slotchange="${this.handleChildrenSlotChange}"></slot>
        </div>
      </div>
    `}};WaTreeItem.css=tree_item_default;__decorateClass$d([r$6()],WaTreeItem.prototype,"indeterminate",2);__decorateClass$d([r$6()],WaTreeItem.prototype,"isLeaf",2);__decorateClass$d([r$6()],WaTreeItem.prototype,"loading",2);__decorateClass$d([r$6()],WaTreeItem.prototype,"selectable",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTreeItem.prototype,"expanded",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTreeItem.prototype,"selected",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTreeItem.prototype,"disabled",2);__decorateClass$d([n$7({type:Boolean,reflect:!0})],WaTreeItem.prototype,"lazy",2);__decorateClass$d([e$9("slot:not([name])")],WaTreeItem.prototype,"defaultSlot",2);__decorateClass$d([e$9("slot[name=children]")],WaTreeItem.prototype,"childrenSlot",2);__decorateClass$d([e$9(".item")],WaTreeItem.prototype,"itemElement",2);__decorateClass$d([e$9(".children")],WaTreeItem.prototype,"childrenContainer",2);__decorateClass$d([e$9(".expand-button slot")],WaTreeItem.prototype,"expandButtonSlot",2);__decorateClass$d([watch("loading",{waitUntilFirstUpdate:!0})],WaTreeItem.prototype,"handleLoadingChange",1);__decorateClass$d([watch("disabled")],WaTreeItem.prototype,"handleDisabledChange",1);__decorateClass$d([watch("expanded")],WaTreeItem.prototype,"handleExpandedState",1);__decorateClass$d([watch("indeterminate")],WaTreeItem.prototype,"handleIndeterminateStateChange",1);__decorateClass$d([watch("selected")],WaTreeItem.prototype,"handleSelectedChange",1);__decorateClass$d([watch("expanded",{waitUntilFirstUpdate:!0})],WaTreeItem.prototype,"handleExpandedChange",1);__decorateClass$d([watch("expanded",{waitUntilFirstUpdate:!0})],WaTreeItem.prototype,"handleExpandAnimation",1);__decorateClass$d([watch("lazy",{waitUntilFirstUpdate:!0})],WaTreeItem.prototype,"handleLazyChange",1);WaTreeItem=__decorateClass$d([t$b("wa-tree-item")],WaTreeItem);var WaSelectionChangeEvent=class extends Event{constructor(ee){super("wa-selection-change",{bubbles:!0,cancelable:!1,composed:!0}),this.detail=ee}},tree_default=`:host {
  /*
     * These are actually used by tree item, but we define them here so they can more easily be set and all tree items
     * stay consistent.
     */
  --indent-guide-color: var(--wa-color-surface-border);
  --indent-guide-offset: 0;
  --indent-guide-style: solid;
  --indent-guide-width: 0;
  --indent-size: var(--wa-space-l);

  display: block;

  /*
     * Tree item indentation uses the "em" unit to increment its width on each level, so setting the font size to zero
     * here removes the indentation for all the nodes on the first level.
     */
  font-size: 0;
}
`;function syncCheckboxes(ee,O=!1){function Y(xe){const et=xe.getChildrenItems({includeDisabled:!1});if(et.length){const tt=et.every(st=>st.selected),it=et.every(st=>!st.selected&&!st.indeterminate);xe.selected=tt,xe.indeterminate=!tt&&!it}}function te(xe){const et=xe.parentElement;WaTreeItem.isTreeItem(et)&&(Y(et),te(et))}function ne(xe){for(const et of xe.getChildrenItems())et.selected=O?xe.selected||et.selected:!et.disabled&&xe.selected,ne(et);O&&Y(xe)}ne(ee),te(ee)}var WaTree=class extends WebAwesomeElement{constructor(){super(),this.selection="single",this.clickTarget=null,this.localize=new LocalizeController(this),this.initTreeItem=ee=>{ee.updateComplete.then(()=>{ee.selectable=this.selection==="multiple",["expand","collapse"].filter(O=>!!this.querySelector(`[slot="${O}-icon"]`)).forEach(O=>{const Y=ee.querySelector(`[slot="${O}-icon"]`),te=this.getExpandButtonIcon(O);te&&(Y===null?ee.append(te):Y.hasAttribute("data-default")&&Y.replaceWith(te))})})},this.handleTreeChanged=ee=>{for(const O of ee){const Y=[...O.addedNodes].filter(WaTreeItem.isTreeItem),te=[...O.removedNodes].filter(WaTreeItem.isTreeItem);Y.forEach(this.initTreeItem),this.lastFocusedItem&&te.includes(this.lastFocusedItem)&&(this.lastFocusedItem=null)}},this.handleFocusOut=ee=>{const O=ee.relatedTarget;(!O||!this.contains(O))&&(this.tabIndex=0)},this.handleFocusIn=ee=>{const O=ee.target;ee.target===this&&this.focusItem(this.lastFocusedItem||this.getAllTreeItems()[0]),WaTreeItem.isTreeItem(O)&&!O.disabled&&(this.lastFocusedItem&&(this.lastFocusedItem.tabIndex=-1),this.lastFocusedItem=O,this.tabIndex=-1,O.tabIndex=0)},this.addEventListener("focusin",this.handleFocusIn),this.addEventListener("focusout",this.handleFocusOut),this.addEventListener("wa-lazy-change",this.handleSlotChange)}async connectedCallback(){super.connectedCallback(),this.setAttribute("role","tree"),this.setAttribute("tabindex","0"),await this.updateComplete,this.mutationObserver=new MutationObserver(this.handleTreeChanged),this.mutationObserver.observe(this,{childList:!0,subtree:!0})}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect()}getExpandButtonIcon(ee){const Y=(ee==="expand"?this.expandedIconSlot:this.collapsedIconSlot).assignedElements({flatten:!0})[0];if(Y){const te=Y.cloneNode(!0);return[te,...te.querySelectorAll("[id]")].forEach(ne=>ne.removeAttribute("id")),te.setAttribute("data-default",""),te.slot=`${ee}-icon`,te}return null}selectItem(ee){const O=[...this.selectedItems];if(this.selection==="multiple")ee.selected=!ee.selected,ee.lazy&&(ee.expanded=!0),syncCheckboxes(ee);else if(this.selection==="single"||ee.isLeaf){const te=this.getAllTreeItems();for(const ne of te)ne.selected=ne===ee}else this.selection==="leaf"&&(ee.expanded=!ee.expanded);const Y=this.selectedItems;(O.length!==Y.length||Y.some(te=>!O.includes(te)))&&Promise.all(Y.map(te=>te.updateComplete)).then(()=>{this.dispatchEvent(new WaSelectionChangeEvent({selection:Y}))})}getAllTreeItems(){return[...this.querySelectorAll("wa-tree-item")]}focusItem(ee){ee?.focus()}handleKeyDown(ee){if(!["ArrowDown","ArrowUp","ArrowRight","ArrowLeft","Home","End","Enter"," "].includes(ee.key)||ee.composedPath().some(ne=>["input","textarea"].includes(ne?.tagName?.toLowerCase())))return;const O=this.getFocusableItems(),Y=this.matches(":dir(ltr)"),te=this.localize.dir()==="rtl";if(O.length>0){ee.preventDefault();const ne=O.findIndex(it=>it.matches(":focus")),xe=O[ne],et=it=>{const st=O[clamp$3(it,0,O.length-1)];this.focusItem(st)},tt=it=>{xe.expanded=it};ee.key==="ArrowDown"?et(ne+1):ee.key==="ArrowUp"?et(ne-1):Y&&ee.key==="ArrowRight"||te&&ee.key==="ArrowLeft"?!xe||xe.disabled||xe.expanded||xe.isLeaf&&!xe.lazy?et(ne+1):tt(!0):Y&&ee.key==="ArrowLeft"||te&&ee.key==="ArrowRight"?!xe||xe.disabled||xe.isLeaf||!xe.expanded?et(ne-1):tt(!1):ee.key==="Home"?et(0):ee.key==="End"?et(O.length-1):(ee.key==="Enter"||ee.key===" ")&&(xe.disabled||this.selectItem(xe))}}handleClick(ee){const O=ee.target,Y=O.closest("wa-tree-item"),te=ee.composedPath().some(ne=>ne?.classList?.contains("expand-button"));!Y||Y.disabled||O!==this.clickTarget||(te?Y.expanded=!Y.expanded:this.selectItem(Y))}handleMouseDown(ee){this.clickTarget=ee.target}handleSlotChange(){this.getAllTreeItems().forEach(this.initTreeItem)}async handleSelectionChange(){const ee=this.selection==="multiple",O=this.getAllTreeItems();this.setAttribute("aria-multiselectable",ee?"true":"false");for(const Y of O)Y.updateComplete.then(()=>{Y.selectable=ee});ee&&(await this.updateComplete,[...this.querySelectorAll(":scope > wa-tree-item")].forEach(Y=>{Y.updateComplete.then(()=>{syncCheckboxes(Y,!0)})}))}get selectedItems(){const ee=this.getAllTreeItems(),O=Y=>Y.selected;return ee.filter(O)}getFocusableItems(){const ee=this.getAllTreeItems(),O=new Set;return ee.filter(Y=>{if(Y.disabled)return!1;const te=Y.parentElement?.closest("[role=treeitem]");return te&&(!te.expanded||te.loading||O.has(te))&&O.add(Y),!O.has(Y)})}render(){return x$1`
      <div
        part="base"
        class="tree"
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleMouseDown}
      >
        <slot @slotchange=${this.handleSlotChange}></slot>
        <span hidden aria-hidden="true"><slot name="expand-icon"></slot></span>
        <span hidden aria-hidden="true"><slot name="collapse-icon"></slot></span>
      </div>
    `}};WaTree.css=tree_default;__decorateClass$d([e$9("slot:not([name])")],WaTree.prototype,"defaultSlot",2);__decorateClass$d([e$9("slot[name=expand-icon]")],WaTree.prototype,"expandedIconSlot",2);__decorateClass$d([e$9("slot[name=collapse-icon]")],WaTree.prototype,"collapsedIconSlot",2);__decorateClass$d([n$7()],WaTree.prototype,"selection",2);__decorateClass$d([watch("selection")],WaTree.prototype,"handleSelectionChange",1);WaTree=__decorateClass$d([t$b("wa-tree")],WaTree);var zoomable_frame_default=`:host {
  display: block;
  position: relative;
  aspect-ratio: 16 / 9;
  width: 100%;
  overflow: hidden;
  border-radius: var(--wa-border-radius-m);
}

#frame-container {
  position: absolute;
  top: 0;
  left: 0;
  width: calc(100% / var(--zoom));
  height: calc(100% / var(--zoom));
  transform: scale(var(--zoom));
  transform-origin: 0 0;
}

#iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: inherit;
  /* Prevent the iframe from being selected, e.g. by a double click. Doesn't affect selection withing the iframe. */
  user-select: none;
  -webkit-user-select: none;
}

#controls {
  display: flex;
  position: absolute;
  bottom: 0.5em;
  align-items: center;
  font-weight: var(--wa-font-weight-semibold);
  padding: 0.25em 0.5em;
  gap: 0.5em;
  border-radius: var(--wa-border-radius-s);
  background: #000b;
  color: white;
  font-size: min(12px, 0.75em);
  user-select: none;
  -webkit-user-select: none;

  &:dir(ltr) {
    right: 0.5em;
  }

  &:dir(rtl) {
    left: 0.5em;
  }

  button {
    display: flex;
    align-items: center;
    padding: 0.25em;
    border: none;
    background: none;
    color: inherit;
    cursor: pointer;

    &:focus {
      outline: none;
    }

    &:focus-visible {
      outline: var(--wa-focus-ring);
      outline-offset: var(--wa-focus-ring-offset);
    }

    &:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
  }

  span {
    min-width: 4.5ch; /* extra space so numbers don't shift */
    font-variant-numeric: tabular-nums;
    text-align: center;
  }
}
`,WaZoomableFrame=class extends WebAwesomeElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.availableZoomLevels=[],this.allowfullscreen=!1,this.loading="eager",this.zoom=1,this.zoomLevels="25% 50% 75% 100% 125% 150% 175% 200%",this.withoutControls=!1,this.withoutInteraction=!1}get contentWindow(){return this.iframe?.contentWindow||null}get contentDocument(){return this.iframe?.contentDocument||null}parseZoomLevels(ee){const O=parseSpaceDelimitedTokens(ee),Y=[];for(const te of O){let ne;if(te.endsWith("%")){const xe=parseFloat(te.slice(0,-1));if(!isNaN(xe))ne=Math.max(0,xe/100);else continue}else if(ne=parseFloat(te),!isNaN(ne))ne=Math.max(0,ne);else continue;Y.push(ne)}return[...new Set(Y)].sort((te,ne)=>te-ne)}getCurrentZoomIndex(){if(this.availableZoomLevels.length===0)return-1;let ee=0,O=Math.abs(this.availableZoomLevels[0]-this.zoom);for(let Y=1;Y<this.availableZoomLevels.length;Y++){const te=Math.abs(this.availableZoomLevels[Y]-this.zoom);te<O&&(O=te,ee=Y)}return ee}isZoomInDisabled(){return this.availableZoomLevels.length===0?!1:this.getCurrentZoomIndex()>=this.availableZoomLevels.length-1}isZoomOutDisabled(){return this.availableZoomLevels.length===0?!1:this.getCurrentZoomIndex()<=0}updated(ee){if(ee.has("zoom")&&this.style.setProperty("--zoom",`${this.zoom}`),ee.has("zoomLevels")&&(this.availableZoomLevels=this.parseZoomLevels(this.zoomLevels),this.availableZoomLevels.length>0)){const O=this.getCurrentZoomIndex();Math.abs(this.availableZoomLevels[O]-this.zoom)>.001&&(this.zoom=this.availableZoomLevels[O])}}zoomIn(){if(this.availableZoomLevels.length===0){this.zoom=Math.min(this.zoom+.05,2);return}const ee=this.getCurrentZoomIndex();ee<this.availableZoomLevels.length-1&&(this.zoom=this.availableZoomLevels[ee+1])}zoomOut(){if(this.availableZoomLevels.length===0){this.zoom=Math.max(this.zoom-.05,0);return}const ee=this.getCurrentZoomIndex();ee>0&&(this.zoom=this.availableZoomLevels[ee-1])}handleLoad(){this.dispatchEvent(new Event("load",{bubbles:!1,cancelable:!1,composed:!0}))}handleError(){this.dispatchEvent(new Event("error",{bubbles:!1,cancelable:!1,composed:!0}))}render(){return x$1`
      <div id="frame-container">
        <iframe
          id="iframe"
          part="iframe"
          ?inert=${this.withoutInteraction}
          ?allowfullscreen=${this.allowfullscreen}
          loading=${this.loading}
          referrerpolicy=${this.referrerpolicy}
          sandbox=${o$6(this.sandbox??void 0)}
          src=${o$6(this.src??void 0)}
          srcdoc=${o$6(this.srcdoc??void 0)}
          @load=${this.handleLoad}
          @error=${this.handleError}
        ></iframe>
      </div>

      ${this.withoutControls?"":x$1`
            <div id="controls" part="controls">
              <button
                part="zoom-out-button"
                aria-label=${this.localize.term("zoomOut")}
                @click=${this.zoomOut}
                ?disabled=${this.isZoomOutDisabled()}
              >
                <slot name="zoom-out-icon">
                  <wa-icon name="minus" label="Zoom out"></wa-icon>
                </slot>
              </button>
              <span>${this.localize.number(this.zoom,{style:"percent",maximumFractionDigits:1})}</span>
              <button
                part="zoom-in-button"
                aria-label=${this.localize.term("zoomIn")}
                @click=${this.zoomIn}
                ?disabled=${this.isZoomInDisabled()}
              >
                <slot name="zoom-in-icon">
                  <wa-icon name="plus" label="Zoom in"></wa-icon>
                </slot>
              </button>
            </div>
          `}
    `}};WaZoomableFrame.css=zoomable_frame_default;__decorateClass$d([e$9("#iframe")],WaZoomableFrame.prototype,"iframe",2);__decorateClass$d([n$7()],WaZoomableFrame.prototype,"src",2);__decorateClass$d([n$7()],WaZoomableFrame.prototype,"srcdoc",2);__decorateClass$d([n$7({type:Boolean})],WaZoomableFrame.prototype,"allowfullscreen",2);__decorateClass$d([n$7()],WaZoomableFrame.prototype,"loading",2);__decorateClass$d([n$7()],WaZoomableFrame.prototype,"referrerpolicy",2);__decorateClass$d([n$7()],WaZoomableFrame.prototype,"sandbox",2);__decorateClass$d([n$7({type:Number,reflect:!0})],WaZoomableFrame.prototype,"zoom",2);__decorateClass$d([n$7({attribute:"zoom-levels"})],WaZoomableFrame.prototype,"zoomLevels",2);__decorateClass$d([n$7({type:Boolean,attribute:"without-controls",reflect:!0})],WaZoomableFrame.prototype,"withoutControls",2);__decorateClass$d([n$7({type:Boolean,attribute:"without-interaction",reflect:!0})],WaZoomableFrame.prototype,"withoutInteraction",2);WaZoomableFrame=__decorateClass$d([t$b("wa-zoomable-frame")],WaZoomableFrame);var __defProp$6=Object.defineProperty,__getOwnPropDesc$a=Object.getOwnPropertyDescriptor,__decorateClass$a=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$a(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$6(O,Y,ne),ne};let KNoContent=class extends KWidget{constructor(){super(...arguments),this.message="No content.",this.icon="info-circle"}render(){return x$1`
            <h3>
                <wa-icon name=${this.icon} label="${this.message}"></wa-icon>
                ${this.message}
            </h3>
        `}};KNoContent.styles=i$c`
        :host {
            display: flex;
            margin: 10px;
        }

        * {
            flex: 1;
        }
    `;__decorateClass$a([n$7()],KNoContent.prototype,"message",2);__decorateClass$a([n$7()],KNoContent.prototype,"icon",2);KNoContent=__decorateClass$a([t$b("k-no-content")],KNoContent);function dispatchCallback(ee,O){ee&&ee(O)}function reverseDictionary(ee){return Object.fromEntries(Object.entries(ee).map(([O,Y])=>[Y,O]))}function escapeRegExp(ee){return ee.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Callable=class{constructor(){let ee=function(...O){return ee._call(...O)};return Object.setPrototypeOf(ee,new.target.prototype)}_call(...ee){throw Error("Must implement _call method in subclass")}};function isTypedArray(ee){return ee?.prototype?.__proto__?.constructor?.name==="TypedArray"}function isIntegralNumber(ee){return Number.isInteger(ee)||typeof ee=="bigint"}function exists(ee){return ee!=null}function calculateDimensions(ee){const O=[];let Y=ee;for(;Array.isArray(Y);)O.push(Y.length),Y=Y[0];return O}function pop(ee,O,Y=void 0){const te=ee[O];if(te!==void 0)return delete ee[O],te;if(Y===void 0)throw Error(`Key ${O} does not exist in object.`);return Y}function mergeArrays(...ee){return Array.prototype.concat.apply([],ee)}function product(...ee){return ee.reduce((O,Y)=>O.flatMap(te=>Y.map(ne=>[te,ne])))}function calculateReflectOffset(ee,O){return Math.abs((ee+O)%(2*O)-O)}const fs={},__viteBrowserExternal=Object.freeze(Object.defineProperty({__proto__:null,default:fs},Symbol.toStringTag,{value:"Module"}));var ortWeb_min$1={exports:{}};const backends={},backendsSortedByPriority=[],registerBackend=(ee,O,Y)=>{if(O&&typeof O.init=="function"&&typeof O.createSessionHandler=="function"){const te=backends[ee];if(te===void 0)backends[ee]={backend:O,priority:Y};else{if(te.priority>Y)return;if(te.priority===Y&&te.backend!==O)throw new Error(`cannot register backend "${ee}" using priority ${Y}`)}if(Y>=0){const ne=backendsSortedByPriority.indexOf(ee);ne!==-1&&backendsSortedByPriority.splice(ne,1);for(let xe=0;xe<backendsSortedByPriority.length;xe++)if(backends[backendsSortedByPriority[xe]].priority<=Y){backendsSortedByPriority.splice(xe,0,ee);return}backendsSortedByPriority.push(ee)}return}throw new TypeError("not a valid backend")},resolveBackend=async ee=>{const O=ee.length===0?backendsSortedByPriority:ee,Y=[];for(const te of O){const ne=backends[te];if(ne){if(ne.initialized)return ne.backend;if(ne.aborted)continue;const xe=!!ne.initPromise;try{return xe||(ne.initPromise=ne.backend.init()),await ne.initPromise,ne.initialized=!0,ne.backend}catch(et){xe||Y.push({name:te,err:et}),ne.aborted=!0}finally{delete ne.initPromise}}}throw new Error(`no available backend found. ERR: ${Y.map(te=>`[${te.name}] ${te.err}`).join(", ")}`)};class EnvImpl{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(O){if(O!==void 0){if(typeof O!="string"||["verbose","info","warning","error","fatal"].indexOf(O)===-1)throw new Error(`Unsupported logging level: ${O}`);this.logLevelInternal=O}}get logLevel(){return this.logLevelInternal}}const env$2=new EnvImpl,isBigInt64ArrayAvailable=typeof BigInt64Array<"u"&&typeof BigInt64Array.from=="function",isBigUint64ArrayAvailable=typeof BigUint64Array<"u"&&typeof BigUint64Array.from=="function",NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);isBigInt64ArrayAvailable&&(NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("int64",BigInt64Array),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigInt64Array,"int64"));isBigUint64ArrayAvailable&&(NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.set("uint64",BigUint64Array),NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.set(BigUint64Array,"uint64"));const calculateSize=ee=>{let O=1;for(let Y=0;Y<ee.length;Y++){const te=ee[Y];if(typeof te!="number"||!Number.isSafeInteger(te))throw new TypeError(`dims[${Y}] must be an integer, got: ${te}`);if(te<0)throw new RangeError(`dims[${Y}] must be a non-negative integer, got: ${te}`);O*=te}return O};let Tensor$2=class Br{constructor(O,Y,te){let ne,xe,et;if(typeof O=="string")if(ne=O,et=te,O==="string"){if(!Array.isArray(Y))throw new TypeError("A string tensor's data must be a string array.");xe=Y}else{const it=NUMERIC_TENSOR_TYPE_TO_TYPEDARRAY_MAP.get(O);if(it===void 0)throw new TypeError(`Unsupported tensor type: ${O}.`);if(Array.isArray(Y))xe=it.from(Y);else if(Y instanceof it)xe=Y;else throw new TypeError(`A ${ne} tensor's data must be type of ${it}`)}else if(et=Y,Array.isArray(O)){if(O.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const it=typeof O[0];if(it==="string")ne="string",xe=O;else if(it==="boolean")ne="bool",xe=Uint8Array.from(O);else throw new TypeError(`Invalid element type of data array: ${it}.`)}else{const it=NUMERIC_TENSOR_TYPEDARRAY_TO_TYPE_MAP.get(O.constructor);if(it===void 0)throw new TypeError(`Unsupported type for tensor data: ${O.constructor}.`);ne=it,xe=O}if(et===void 0)et=[xe.length];else if(!Array.isArray(et))throw new TypeError("A tensor's dims must be a number array");const tt=calculateSize(et);if(tt!==xe.length)throw new Error(`Tensor's size(${tt}) does not match data length(${xe.length}).`);this.dims=et,this.type=ne,this.data=xe,this.size=tt}static bufferToTensor(O,Y){if(O===void 0)throw new Error("Image buffer must be defined");if(Y.height===void 0||Y.width===void 0)throw new Error("Image height and width must be defined");const{height:te,width:ne}=Y,xe=Y.norm;let et,tt;xe===void 0||xe.mean===void 0?et=255:et=xe.mean,xe===void 0||xe.bias===void 0?tt=0:tt=xe.bias;const it=Y.bitmapFormat!==void 0?Y.bitmapFormat:"RGBA",st=Y.tensorFormat!==void 0&&Y.tensorFormat!==void 0?Y.tensorFormat:"RGB",ot=te*ne,rt=st==="RGBA"?new Float32Array(ot*4):new Float32Array(ot*3);let nt=4,at=0,ct=1,ut=2,dt=3,ht=0,pt=ot,ft=ot*2,mt=-1;it==="RGB"&&(nt=3,at=0,ct=1,ut=2,dt=-1),st==="RGBA"?mt=ot*3:st==="RBG"?(ht=0,ft=ot,pt=ot*2):st==="BGR"&&(ft=0,pt=ot,ht=ot*2);for(let bt=0;bt<ot;bt++,at+=nt,ut+=nt,ct+=nt,dt+=nt)rt[ht++]=(O[at]+tt)/et,rt[pt++]=(O[ct]+tt)/et,rt[ft++]=(O[ut]+tt)/et,mt!==-1&&dt!==-1&&(rt[mt++]=(O[dt]+tt)/et);return st==="RGBA"?new Br("float32",rt,[1,4,te,ne]):new Br("float32",rt,[1,3,te,ne])}static async fromImage(O,Y){const te=typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement,ne=typeof ImageData<"u"&&O instanceof ImageData,xe=typeof ImageBitmap<"u"&&O instanceof ImageBitmap,et=typeof String<"u"&&(O instanceof String||typeof O=="string");let tt,it={};if(te){const st=document.createElement("canvas"),ot=st.getContext("2d");if(ot!=null){let rt=O.naturalHeight,nt=O.naturalWidth;if(Y!==void 0&&Y.resizedHeight!==void 0&&Y.resizedWidth!==void 0&&(rt=Y.resizedHeight,nt=Y.resizedWidth),Y!==void 0){if(it=Y,Y.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");if(it.tensorFormat="RGBA",Y.height!==void 0&&Y.height!==rt)throw new Error("Image input config height doesn't match HTMLImageElement height");if(it.height=rt,Y.width!==void 0&&Y.width!==nt)throw new Error("Image input config width doesn't match HTMLImageElement width");it.width=nt}else it.tensorFormat="RGBA",it.height=rt,it.width=nt;st.width=nt,st.height=rt,ot.drawImage(O,0,0,nt,rt),tt=ot.getImageData(0,0,nt,rt).data}else throw new Error("Can not access image data")}else if(ne){const st="RGBA";let ot,rt;if(Y!==void 0&&Y.resizedWidth!==void 0&&Y.resizedHeight!==void 0?(ot=Y.resizedHeight,rt=Y.resizedWidth):(ot=O.height,rt=O.width),Y!==void 0){if(it=Y,Y.bitmapFormat!==void 0&&Y.bitmapFormat!==st)throw new Error("Image input config format must be RGBA for ImageData");it.bitmapFormat="RGBA"}else it.bitmapFormat="RGBA";if(it.height=ot,it.width=rt,Y!==void 0){const nt=document.createElement("canvas");nt.width=rt,nt.height=ot;const at=nt.getContext("2d");if(at!=null)at.putImageData(O,0,0),tt=at.getImageData(0,0,rt,ot).data;else throw new Error("Can not access image data")}else tt=O.data}else if(xe){if(Y===void 0)throw new Error("Please provide image config with format for Imagebitmap");if(Y.bitmapFormat!==void 0)throw new Error("Image input config format must be defined for ImageBitmap");const st=document.createElement("canvas").getContext("2d");if(st!=null){const ot=O.height,rt=O.width;if(st.drawImage(O,0,0,rt,ot),tt=st.getImageData(0,0,rt,ot).data,Y!==void 0){if(Y.height!==void 0&&Y.height!==ot)throw new Error("Image input config height doesn't match ImageBitmap height");if(it.height=ot,Y.width!==void 0&&Y.width!==rt)throw new Error("Image input config width doesn't match ImageBitmap width");it.width=rt}else it.height=ot,it.width=rt;return Br.bufferToTensor(tt,it)}else throw new Error("Can not access image data")}else{if(et)return new Promise((st,ot)=>{const rt=document.createElement("canvas"),nt=rt.getContext("2d");if(!O||!nt)return ot();const at=new Image;at.crossOrigin="Anonymous",at.src=O,at.onload=()=>{rt.width=at.width,rt.height=at.height,nt.drawImage(at,0,0,rt.width,rt.height);const ct=nt.getImageData(0,0,rt.width,rt.height);if(Y!==void 0){if(Y.height!==void 0&&Y.height!==rt.height)throw new Error("Image input config height doesn't match ImageBitmap height");if(it.height=rt.height,Y.width!==void 0&&Y.width!==rt.width)throw new Error("Image input config width doesn't match ImageBitmap width");it.width=rt.width}else it.height=rt.height,it.width=rt.width;st(Br.bufferToTensor(ct.data,it))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(tt!==void 0)return Br.bufferToTensor(tt,it);throw new Error("Input data provided is not supported - aborted tensor creation")}toImageData(O){var Y,te;const ne=document.createElement("canvas").getContext("2d");let xe;if(ne!=null){const et=this.dims[3],tt=this.dims[2],it=this.dims[1],st=O!==void 0&&O.format!==void 0?O.format:"RGB",ot=O!==void 0&&((Y=O.norm)===null||Y===void 0?void 0:Y.mean)!==void 0?O.norm.mean:255,rt=O!==void 0&&((te=O.norm)===null||te===void 0?void 0:te.bias)!==void 0?O.norm.bias:0,nt=tt*et;if(O!==void 0){if(O.height!==void 0&&O.height!==tt)throw new Error("Image output config height doesn't match tensor height");if(O.width!==void 0&&O.width!==et)throw new Error("Image output config width doesn't match tensor width");if(O.format!==void 0&&it===4&&O.format!=="RGBA"||it===3&&O.format!=="RGB"&&O.format!=="BGR")throw new Error("Tensor format doesn't match input tensor dims")}const at=4;let ct=0,ut=1,dt=2,ht=3,pt=0,ft=nt,mt=nt*2,yt=-1;st==="RGBA"?(pt=0,ft=nt,mt=nt*2,yt=nt*3):st==="RGB"?(pt=0,ft=nt,mt=nt*2):st==="RBG"&&(pt=0,mt=nt,ft=nt*2),xe=ne.createImageData(et,tt);for(let bt=0;bt<tt*et;ct+=at,ut+=at,dt+=at,ht+=at,bt++)xe.data[ct]=(this.data[pt++]-rt)*ot,xe.data[ut]=(this.data[ft++]-rt)*ot,xe.data[dt]=(this.data[mt++]-rt)*ot,xe.data[ht]=yt===-1?255:(this.data[yt++]-rt)*ot}else throw new Error("Can not access image data");return xe}reshape(O){return new Br(this.type,this.data,O)}};const Tensor$1=Tensor$2;let InferenceSession$2=class _i{constructor(O){this.handler=O}async run(O,Y,te){const ne={};let xe={};if(typeof O!="object"||O===null||O instanceof Tensor$1||Array.isArray(O))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let et=!0;if(typeof Y=="object"){if(Y===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(Y instanceof Tensor$1)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(Y)){if(Y.length===0)throw new TypeError("'fetches' cannot be an empty array.");et=!1;for(const st of Y){if(typeof st!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(st)===-1)throw new RangeError(`'fetches' contains invalid output name: ${st}.`);ne[st]=null}if(typeof te=="object"&&te!==null)xe=te;else if(typeof te<"u")throw new TypeError("'options' must be an object.")}else{let st=!1;const ot=Object.getOwnPropertyNames(Y);for(const rt of this.outputNames)if(ot.indexOf(rt)!==-1){const nt=Y[rt];(nt===null||nt instanceof Tensor$1)&&(st=!0,et=!1,ne[rt]=nt)}if(st){if(typeof te=="object"&&te!==null)xe=te;else if(typeof te<"u")throw new TypeError("'options' must be an object.")}else xe=Y}}else if(typeof Y<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const st of this.inputNames)if(typeof O[st]>"u")throw new Error(`input '${st}' is missing in 'feeds'.`);if(et)for(const st of this.outputNames)ne[st]=null;const tt=await this.handler.run(O,ne,xe),it={};for(const st in tt)Object.hasOwnProperty.call(tt,st)&&(it[st]=new Tensor$1(tt[st].type,tt[st].data,tt[st].dims));return it}static async create(O,Y,te,ne){let xe,et={};if(typeof O=="string"){if(xe=O,typeof Y=="object"&&Y!==null)et=Y;else if(typeof Y<"u")throw new TypeError("'options' must be an object.")}else if(O instanceof Uint8Array){if(xe=O,typeof Y=="object"&&Y!==null)et=Y;else if(typeof Y<"u")throw new TypeError("'options' must be an object.")}else if(O instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&O instanceof SharedArrayBuffer){const rt=O;let nt=0,at=O.byteLength;if(typeof Y=="object"&&Y!==null)et=Y;else if(typeof Y=="number"){if(nt=Y,!Number.isSafeInteger(nt))throw new RangeError("'byteOffset' must be an integer.");if(nt<0||nt>=rt.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${rt.byteLength}).`);if(at=O.byteLength-nt,typeof te=="number"){if(at=te,!Number.isSafeInteger(at))throw new RangeError("'byteLength' must be an integer.");if(at<=0||nt+at>rt.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${rt.byteLength-nt}].`);if(typeof ne=="object"&&ne!==null)et=ne;else if(typeof ne<"u")throw new TypeError("'options' must be an object.")}else if(typeof te<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof Y<"u")throw new TypeError("'options' must be an object.");xe=new Uint8Array(rt,nt,at)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const it=(et.executionProviders||[]).map(rt=>typeof rt=="string"?rt:rt.name),ot=await(await resolveBackend(it)).createSessionHandler(xe,et);return new _i(ot)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const InferenceSession$1=InferenceSession$2,lib=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:InferenceSession$1,Tensor:Tensor$1,env:env$2,registerBackend},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(lib);var hasRequiredOrtWeb_min;function requireOrtWeb_min(){return hasRequiredOrtWeb_min||(hasRequiredOrtWeb_min=1,(function(module,exports$1){(function(ee,O){module.exports=O(require$$0)})(self,(__WEBPACK_EXTERNAL_MODULE__1670__=>(()=>{var __webpack_modules__={3474:(ee,O,Y)=>{var te,ne=(te=(te=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(xe){function et(){return zt.buffer!=qt&&Ln(zt.buffer),Xt}function tt(){return zt.buffer!=qt&&Ln(zt.buffer),an}function it(){return zt.buffer!=qt&&Ln(zt.buffer),pn}function st(){return zt.buffer!=qt&&Ln(zt.buffer),ln}function ot(){return zt.buffer!=qt&&Ln(zt.buffer),dn}var rt,nt,at;xe=xe||{},rt||(rt=xe!==void 0?xe:{}),rt.ready=new Promise((function(xt,It){nt=xt,at=It}));var ct,ut,dt,ht,pt,ft,mt=Object.assign({},rt),yt="./this.program",bt=(xt,It)=>{throw It},vt=typeof window=="object",Et=typeof importScripts=="function",wt=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",St=rt.ENVIRONMENT_IS_PTHREAD||!1,Ot="";function $t(xt){return rt.locateFile?rt.locateFile(xt,Ot):Ot+xt}if(wt){let xt;Ot=Et?Y(908).dirname(Ot)+"/":"//",ft=()=>{pt||(ht=Y(1384),pt=Y(908))},ct=function(It,Dt){return ft(),It=pt.normalize(It),ht.readFileSync(It,Dt?void 0:"utf8")},dt=It=>((It=ct(It,!0)).buffer||(It=new Uint8Array(It)),It),ut=(It,Dt,Ut)=>{ft(),It=pt.normalize(It),ht.readFile(It,(function(Bt,jt){Bt?Ut(Bt):Dt(jt.buffer)}))},1<process.argv.length&&(yt=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(It){if(!(It instanceof er))throw It})),process.on("unhandledRejection",(function(It){throw It})),bt=(It,Dt)=>{if(sr())throw process.exitCode=It,Dt;Dt instanceof er||kt("exiting due to exception: "+Dt),process.exit(It)},rt.inspect=function(){return"[Emscripten Module object]"};try{xt=Y(9925)}catch(It){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),It}Y.g.Worker=xt.Worker}else(vt||Et)&&(Et?Ot=self.location.href:typeof document<"u"&&document.currentScript&&(Ot=document.currentScript.src),te&&(Ot=te),Ot=Ot.indexOf("blob:")!==0?Ot.substr(0,Ot.replace(/[?#].*/,"").lastIndexOf("/")+1):"",wt||(ct=xt=>{var It=new XMLHttpRequest;return It.open("GET",xt,!1),It.send(null),It.responseText},Et&&(dt=xt=>{var It=new XMLHttpRequest;return It.open("GET",xt,!1),It.responseType="arraybuffer",It.send(null),new Uint8Array(It.response)}),ut=(xt,It,Dt)=>{var Ut=new XMLHttpRequest;Ut.open("GET",xt,!0),Ut.responseType="arraybuffer",Ut.onload=()=>{Ut.status==200||Ut.status==0&&Ut.response?It(Ut.response):Dt()},Ut.onerror=Dt,Ut.send(null)}));wt&&typeof performance>"u"&&(Y.g.performance=Y(6953).performance);var Mt=console.log.bind(console),Nt=console.warn.bind(console);wt&&(ft(),Mt=xt=>ht.writeSync(1,xt+`
`),Nt=xt=>ht.writeSync(2,xt+`
`));var Rt,Pt=rt.print||Mt,kt=rt.printErr||Nt;Object.assign(rt,mt),mt=null,rt.thisProgram&&(yt=rt.thisProgram),rt.quit&&(bt=rt.quit),rt.wasmBinary&&(Rt=rt.wasmBinary);var Wt=rt.noExitRuntime||!1;typeof WebAssembly!="object"&&mn("no native wasm support detected");var zt,Kt,qt,Xt,an,pn,ln,dn,un=!1,Tn=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Sn(xt,It,Dt){var Ut=(It>>>=0)+Dt;for(Dt=It;xt[Dt]&&!(Dt>=Ut);)++Dt;if(16<Dt-It&&xt.buffer&&Tn)return Tn.decode(xt.buffer instanceof SharedArrayBuffer?xt.slice(It,Dt):xt.subarray(It,Dt));for(Ut="";It<Dt;){var Bt=xt[It++];if(128&Bt){var jt=63&xt[It++];if((224&Bt)==192)Ut+=String.fromCharCode((31&Bt)<<6|jt);else{var Qt=63&xt[It++];65536>(Bt=(240&Bt)==224?(15&Bt)<<12|jt<<6|Qt:(7&Bt)<<18|jt<<12|Qt<<6|63&xt[It++])?Ut+=String.fromCharCode(Bt):(Bt-=65536,Ut+=String.fromCharCode(55296|Bt>>10,56320|1023&Bt))}}else Ut+=String.fromCharCode(Bt)}return Ut}function bn(xt,It){return(xt>>>=0)?Sn(tt(),xt,It):""}function on(xt,It,Dt,Ut){if(!(0<Ut))return 0;var Bt=Dt>>>=0;Ut=Dt+Ut-1;for(var jt=0;jt<xt.length;++jt){var Qt=xt.charCodeAt(jt);if(55296<=Qt&&57343>=Qt&&(Qt=65536+((1023&Qt)<<10)|1023&xt.charCodeAt(++jt)),127>=Qt){if(Dt>=Ut)break;It[Dt++>>>0]=Qt}else{if(2047>=Qt){if(Dt+1>=Ut)break;It[Dt++>>>0]=192|Qt>>6}else{if(65535>=Qt){if(Dt+2>=Ut)break;It[Dt++>>>0]=224|Qt>>12}else{if(Dt+3>=Ut)break;It[Dt++>>>0]=240|Qt>>18,It[Dt++>>>0]=128|Qt>>12&63}It[Dt++>>>0]=128|Qt>>6&63}It[Dt++>>>0]=128|63&Qt}}return It[Dt>>>0]=0,Dt-Bt}function zn(xt){for(var It=0,Dt=0;Dt<xt.length;++Dt){var Ut=xt.charCodeAt(Dt);127>=Ut?It++:2047>=Ut?It+=2:55296<=Ut&&57343>=Ut?(It+=4,++Dt):It+=3}return It}function Ln(xt){qt=xt,rt.HEAP8=Xt=new Int8Array(xt),rt.HEAP16=new Int16Array(xt),rt.HEAP32=pn=new Int32Array(xt),rt.HEAPU8=an=new Uint8Array(xt),rt.HEAPU16=new Uint16Array(xt),rt.HEAPU32=ln=new Uint32Array(xt),rt.HEAPF32=new Float32Array(xt),rt.HEAPF64=dn=new Float64Array(xt)}St&&(qt=rt.buffer);var hn=rt.INITIAL_MEMORY||16777216;if(St)zt=rt.wasmMemory,qt=rt.buffer;else if(rt.wasmMemory)zt=rt.wasmMemory;else if(!((zt=new WebAssembly.Memory({initial:hn/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw kt("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),wt&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");zt&&(qt=zt.buffer),hn=qt.byteLength,Ln(qt);var Hn,Wn=[],Gn=[],gr=[],Qn=[];function sr(){return Wt||!1}function cr(){var xt=rt.preRun.shift();Wn.unshift(xt)}var On,kn=0,br=null;function mn(xt){throw St?postMessage({cmd:"onAbort",arg:xt}):rt.onAbort&&rt.onAbort(xt),kt(xt="Aborted("+xt+")"),un=!0,xt=new WebAssembly.RuntimeError(xt+". Build with -sASSERTIONS for more info."),at(xt),xt}function jn(){return On.startsWith("data:application/octet-stream;base64,")}function Un(){var xt=On;try{if(xt==On&&Rt)return new Uint8Array(Rt);if(dt)return dt(xt);throw"both async and sync fetching of the wasm failed"}catch(It){mn(It)}}On="ort-wasm-threaded.wasm",jn()||(On=$t(On));var qn={};function er(xt){this.name="ExitStatus",this.message="Program terminated with exit("+xt+")",this.status=xt}function Pn(xt){(xt=yn.Vb[xt])||mn(),yn.mc(xt)}function Rn(xt){var It=yn.Cc();if(!It)return 6;yn.ac.push(It),yn.Vb[xt.Ub]=It,It.Ub=xt.Ub;var Dt={cmd:"run",start_routine:xt.Ic,arg:xt.zc,pthread_ptr:xt.Ub};return It.$b=()=>{Dt.time=performance.now(),It.postMessage(Dt,xt.Nc)},It.loaded&&(It.$b(),delete It.$b),0}function Dn(xt){if(St)return fn(1,1,xt);sr()||(yn.oc(),rt.onExit&&rt.onExit(xt),un=!0),bt(xt,new er(xt))}function or(xt,It){if(!It&&St)throw Vn(xt),"unwind";sr()||St||(qr(),ur(gr),ei(0),Gr[1].length&&zr(1,10),Gr[2].length&&zr(2,10),yn.oc()),Dn(xt)}var yn={Yb:[],ac:[],qc:[],Vb:{},fc:function(){St&&yn.Ec()},Pc:function(){},Ec:function(){yn.receiveObjectTransfer=yn.Gc,yn.threadInitTLS=yn.pc,yn.setExitStatus=yn.nc,Wt=!1},nc:function(){},oc:function(){for(var xt of Object.values(yn.Vb))yn.mc(xt);for(xt of yn.Yb)xt.terminate();yn.Yb=[]},mc:function(xt){var It=xt.Ub;delete yn.Vb[It],yn.Yb.push(xt),yn.ac.splice(yn.ac.indexOf(xt),1),xt.Ub=0,Yr(It)},Gc:function(){},pc:function(){yn.qc.forEach((xt=>xt()))},Fc:function(xt,It){xt.onmessage=Dt=>{var Ut=(Dt=Dt.data).cmd;if(xt.Ub&&(yn.Bc=xt.Ub),Dt.targetThread&&Dt.targetThread!=Nr()){var Bt=yn.Vb[Dt.Qc];Bt?Bt.postMessage(Dt,Dt.transferList):kt('Internal error! Worker sent a message "'+Ut+'" to target pthread '+Dt.targetThread+", but that thread no longer exists!")}else Ut==="processProxyingQueue"?Yt(Dt.queue):Ut==="spawnThread"?Rn(Dt):Ut==="cleanupThread"?Pn(Dt.thread):Ut==="killThread"?(Dt=Dt.thread,Ut=yn.Vb[Dt],delete yn.Vb[Dt],Ut.terminate(),Yr(Dt),yn.ac.splice(yn.ac.indexOf(Ut),1),Ut.Ub=0):Ut==="cancelThread"?yn.Vb[Dt.thread].postMessage({cmd:"cancel"}):Ut==="loaded"?(xt.loaded=!0,It&&It(xt),xt.$b&&(xt.$b(),delete xt.$b)):Ut==="print"?Pt("Thread "+Dt.threadId+": "+Dt.text):Ut==="printErr"?kt("Thread "+Dt.threadId+": "+Dt.text):Ut==="alert"?alert("Thread "+Dt.threadId+": "+Dt.text):Dt.target==="setimmediate"?xt.postMessage(Dt):Ut==="onAbort"?rt.onAbort&&rt.onAbort(Dt.arg):Ut&&kt("worker sent an unknown command "+Ut);yn.Bc=void 0},xt.onerror=Dt=>{throw kt("worker sent an error! "+Dt.filename+":"+Dt.lineno+": "+Dt.message),Dt},wt&&(xt.on("message",(function(Dt){xt.onmessage({data:Dt})})),xt.on("error",(function(Dt){xt.onerror(Dt)})),xt.on("detachedExit",(function(){}))),xt.postMessage({cmd:"load",urlOrBlob:rt.mainScriptUrlOrBlob||te,wasmMemory:zt,wasmModule:Kt})},yc:function(){var xt=$t("ort-wasm-threaded.worker.js");yn.Yb.push(new Worker(xt))},Cc:function(){return yn.Yb.length==0&&(yn.yc(),yn.Fc(yn.Yb[0])),yn.Yb.pop()}};function ur(xt){for(;0<xt.length;)xt.shift()(rt)}function dr(xt){var It=$n();return xt=xt(),Nn(It),xt}function Vn(xt){if(St)return fn(2,0,xt);try{or(xt)}catch(It){It instanceof er||It=="unwind"||bt(1,It)}}rt.PThread=yn,rt.establishStackSpace=function(){var xt=Nr(),It=it()[xt+44>>2>>>0];xt=it()[xt+48>>2>>>0],ci(It,It-xt),Nn(It)};var Kn=[];function wn(xt){var It=Kn[xt];return It||(xt>=Kn.length&&(Kn.length=xt+1),Kn[xt]=It=Hn.get(xt)),It}rt.invokeEntryPoint=function(xt,It){xt=wn(xt)(It),sr()?yn.nc(xt):ti(xt)};var ar,Jn,hr=[],An=0,xn=0;function _n(xt){this.Zb=xt,this.Sb=xt-24,this.xc=function(It){st()[this.Sb+4>>2>>>0]=It},this.bc=function(){return st()[this.Sb+4>>2>>>0]},this.wc=function(It){st()[this.Sb+8>>2>>>0]=It},this.Dc=function(){return st()[this.Sb+8>>2>>>0]},this.rc=function(){it()[this.Sb>>2>>>0]=0},this.hc=function(It){It=It?1:0,et()[this.Sb+12>>0>>>0]=It},this.uc=function(){return et()[this.Sb+12>>0>>>0]!=0},this.ic=function(It){It=It?1:0,et()[this.Sb+13>>0>>>0]=It},this.kc=function(){return et()[this.Sb+13>>0>>>0]!=0},this.fc=function(It,Dt){this.cc(0),this.xc(It),this.wc(Dt),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(it(),this.Sb>>2,1)},this.Hc=function(){return Atomics.sub(it(),this.Sb>>2,1)===1},this.cc=function(It){st()[this.Sb+16>>2>>>0]=It},this.tc=function(){return st()[this.Sb+16>>2>>>0]},this.vc=function(){if(ri(this.bc()))return st()[this.Zb>>2>>>0];var It=this.tc();return It!==0?It:this.Zb}}function Sr(xt){return jr(new _n(xt).Sb)}function pr(xt,It,Dt,Ut){return St?fn(3,1,xt,It,Dt,Ut):wr(xt,It,Dt,Ut)}function wr(xt,It,Dt,Ut){if(typeof SharedArrayBuffer>"u")return kt("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var Bt=[];return St&&Bt.length===0?pr(xt,It,Dt,Ut):(xt={Ic:Dt,Ub:xt,zc:Ut,Nc:Bt},St?(xt.Oc="spawnThread",postMessage(xt,Bt),0):Rn(xt))}function _r(xt,It,Dt){return St?fn(4,1,xt,It,Dt):0}function Cr(xt,It){if(St)return fn(5,1,xt,It)}function Ar(xt,It){if(St)return fn(6,1,xt,It)}function nr(xt,It,Dt){if(St)return fn(7,1,xt,It,Dt)}function ir(xt,It,Dt){return St?fn(8,1,xt,It,Dt):0}function vr(xt,It){if(St)return fn(9,1,xt,It)}function Lr(xt,It,Dt){if(St)return fn(10,1,xt,It,Dt)}function kr(xt,It,Dt,Ut){if(St)return fn(11,1,xt,It,Dt,Ut)}function Or(xt,It,Dt,Ut){if(St)return fn(12,1,xt,It,Dt,Ut)}function Fr(xt,It,Dt,Ut){if(St)return fn(13,1,xt,It,Dt,Ut)}function $r(xt){if(St)return fn(14,1,xt)}function Ft(xt,It){if(St)return fn(15,1,xt,It)}function Vt(xt,It,Dt){if(St)return fn(16,1,xt,It,Dt)}function Yt(xt){Atomics.store(it(),xt>>2,1),Nr()&&li(xt),Atomics.compareExchange(it(),xt>>2,1,0)}function Zt(xt){return st()[xt>>>2]+4294967296*it()[xt+4>>>2]}function Jt(xt,It,Dt,Ut,Bt,jt){return St?fn(17,1,xt,It,Dt,Ut,Bt,jt):-52}function tn(xt,It,Dt,Ut,Bt,jt){if(St)return fn(18,1,xt,It,Dt,Ut,Bt,jt)}function cn(xt){var It=zn(xt)+1,Dt=Dr(It);return Dt&&on(xt,et(),Dt,It),Dt}function vn(xt,It,Dt){function Ut(En){return(En=En.toTimeString().match(/\(([A-Za-z ]+)\)$/))?En[1]:"GMT"}if(St)return fn(19,1,xt,It,Dt);var Bt=new Date().getFullYear(),jt=new Date(Bt,0,1),Qt=new Date(Bt,6,1);Bt=jt.getTimezoneOffset();var sn=Qt.getTimezoneOffset(),gn=Math.max(Bt,sn);it()[xt>>2>>>0]=60*gn,it()[It>>2>>>0]=+(Bt!=sn),xt=Ut(jt),It=Ut(Qt),xt=cn(xt),It=cn(It),sn<Bt?(st()[Dt>>2>>>0]=xt,st()[Dt+4>>2>>>0]=It):(st()[Dt>>2>>>0]=It,st()[Dt+4>>2>>>0]=xt)}function fn(xt,It){var Dt=arguments.length-2,Ut=arguments;return dr((()=>{for(var Bt=ni(8*Dt),jt=Bt>>3,Qt=0;Qt<Dt;Qt++){var sn=Ut[2+Qt];ot()[jt+Qt>>>0]=sn}return ai(xt,Dt,Bt,It)}))}rt.executeNotifiedProxyingQueue=Yt,Jn=wt?()=>{var xt=process.hrtime();return 1e3*xt[0]+xt[1]/1e6}:St?()=>performance.now()-rt.__performance_now_clock_drift:()=>performance.now();var Mn,rr=[],fr={};function mr(){if(!Mn){var xt,It={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:yt||"./this.program"};for(xt in fr)fr[xt]===void 0?delete It[xt]:It[xt]=fr[xt];var Dt=[];for(xt in It)Dt.push(xt+"="+It[xt]);Mn=Dt}return Mn}function nn(xt,It){if(St)return fn(20,1,xt,It);var Dt=0;return mr().forEach((function(Ut,Bt){var jt=It+Dt;for(Bt=st()[xt+4*Bt>>2>>>0]=jt,jt=0;jt<Ut.length;++jt)et()[Bt++>>0>>>0]=Ut.charCodeAt(jt);et()[Bt>>0>>>0]=0,Dt+=Ut.length+1})),0}function Cn(xt,It){if(St)return fn(21,1,xt,It);var Dt=mr();st()[xt>>2>>>0]=Dt.length;var Ut=0;return Dt.forEach((function(Bt){Ut+=Bt.length+1})),st()[It>>2>>>0]=Ut,0}function lr(xt){return St?fn(22,1,xt):52}function Rr(xt,It,Dt,Ut){return St?fn(23,1,xt,It,Dt,Ut):52}function Ir(xt,It,Dt,Ut,Bt){return St?fn(24,1,xt,It,Dt,Ut,Bt):70}var Gr=[null,[],[]];function zr(xt,It){var Dt=Gr[xt];It===0||It===10?((xt===1?Pt:kt)(Sn(Dt,0)),Dt.length=0):Dt.push(It)}function Zr(xt,It,Dt,Ut){if(St)return fn(25,1,xt,It,Dt,Ut);for(var Bt=0,jt=0;jt<Dt;jt++){var Qt=st()[It>>2>>>0],sn=st()[It+4>>2>>>0];It+=8;for(var gn=0;gn<sn;gn++)zr(xt,tt()[Qt+gn>>>0]);Bt+=sn}return st()[Ut>>2>>>0]=Bt,0}var Pr=0;function Ur(xt){return xt%4==0&&(xt%100!=0||xt%400==0)}var Jr=[31,29,31,30,31,30,31,31,30,31,30,31],Er=[31,28,31,30,31,30,31,31,30,31,30,31];function Qr(xt,It,Dt,Ut){function Bt(rn,tr,yr){for(rn=typeof rn=="number"?rn.toString():rn||"";rn.length<tr;)rn=yr[0]+rn;return rn}function jt(rn,tr){return Bt(rn,tr,"0")}function Qt(rn,tr){function yr(Xr){return 0>Xr?-1:0<Xr?1:0}var Mr;return(Mr=yr(rn.getFullYear()-tr.getFullYear()))===0&&(Mr=yr(rn.getMonth()-tr.getMonth()))===0&&(Mr=yr(rn.getDate()-tr.getDate())),Mr}function sn(rn){switch(rn.getDay()){case 0:return new Date(rn.getFullYear()-1,11,29);case 1:return rn;case 2:return new Date(rn.getFullYear(),0,3);case 3:return new Date(rn.getFullYear(),0,2);case 4:return new Date(rn.getFullYear(),0,1);case 5:return new Date(rn.getFullYear()-1,11,31);case 6:return new Date(rn.getFullYear()-1,11,30)}}function gn(rn){var tr=rn.Wb;for(rn=new Date(new Date(rn.Xb+1900,0,1).getTime());0<tr;){var yr=rn.getMonth(),Mr=(Ur(rn.getFullYear())?Jr:Er)[yr];if(!(tr>Mr-rn.getDate())){rn.setDate(rn.getDate()+tr);break}tr-=Mr-rn.getDate()+1,rn.setDate(1),11>yr?rn.setMonth(yr+1):(rn.setMonth(0),rn.setFullYear(rn.getFullYear()+1))}return yr=new Date(rn.getFullYear()+1,0,4),tr=sn(new Date(rn.getFullYear(),0,4)),yr=sn(yr),0>=Qt(tr,rn)?0>=Qt(yr,rn)?rn.getFullYear()+1:rn.getFullYear():rn.getFullYear()-1}var En=it()[Ut+40>>2>>>0];for(var Bn in Ut={Lc:it()[Ut>>2>>>0],Kc:it()[Ut+4>>2>>>0],dc:it()[Ut+8>>2>>>0],jc:it()[Ut+12>>2>>>0],ec:it()[Ut+16>>2>>>0],Xb:it()[Ut+20>>2>>>0],Tb:it()[Ut+24>>2>>>0],Wb:it()[Ut+28>>2>>>0],Rc:it()[Ut+32>>2>>>0],Jc:it()[Ut+36>>2>>>0],Mc:En?bn(En):""},Dt=bn(Dt),En={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})Dt=Dt.replace(new RegExp(Bn,"g"),En[Bn]);var xr="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Tr="January February March April May June July August September October November December".split(" ");for(Bn in En={"%a":function(rn){return xr[rn.Tb].substring(0,3)},"%A":function(rn){return xr[rn.Tb]},"%b":function(rn){return Tr[rn.ec].substring(0,3)},"%B":function(rn){return Tr[rn.ec]},"%C":function(rn){return jt((rn.Xb+1900)/100|0,2)},"%d":function(rn){return jt(rn.jc,2)},"%e":function(rn){return Bt(rn.jc,2," ")},"%g":function(rn){return gn(rn).toString().substring(2)},"%G":function(rn){return gn(rn)},"%H":function(rn){return jt(rn.dc,2)},"%I":function(rn){return(rn=rn.dc)==0?rn=12:12<rn&&(rn-=12),jt(rn,2)},"%j":function(rn){for(var tr=0,yr=0;yr<=rn.ec-1;tr+=(Ur(rn.Xb+1900)?Jr:Er)[yr++]);return jt(rn.jc+tr,3)},"%m":function(rn){return jt(rn.ec+1,2)},"%M":function(rn){return jt(rn.Kc,2)},"%n":function(){return`
`},"%p":function(rn){return 0<=rn.dc&&12>rn.dc?"AM":"PM"},"%S":function(rn){return jt(rn.Lc,2)},"%t":function(){return"	"},"%u":function(rn){return rn.Tb||7},"%U":function(rn){return jt(Math.floor((rn.Wb+7-rn.Tb)/7),2)},"%V":function(rn){var tr=Math.floor((rn.Wb+7-(rn.Tb+6)%7)/7);if(2>=(rn.Tb+371-rn.Wb-2)%7&&tr++,tr)tr==53&&((yr=(rn.Tb+371-rn.Wb)%7)==4||yr==3&&Ur(rn.Xb)||(tr=1));else{tr=52;var yr=(rn.Tb+7-rn.Wb-1)%7;(yr==4||yr==5&&Ur(rn.Xb%400-1))&&tr++}return jt(tr,2)},"%w":function(rn){return rn.Tb},"%W":function(rn){return jt(Math.floor((rn.Wb+7-(rn.Tb+6)%7)/7),2)},"%y":function(rn){return(rn.Xb+1900).toString().substring(2)},"%Y":function(rn){return rn.Xb+1900},"%z":function(rn){var tr=0<=(rn=rn.Jc);return rn=Math.abs(rn)/60,(tr?"+":"-")+("0000"+(rn/60*100+rn%60)).slice(-4)},"%Z":function(rn){return rn.Mc},"%%":function(){return"%"}},Dt=Dt.replace(/%%/g,"\0\0"),En)Dt.includes(Bn)&&(Dt=Dt.replace(new RegExp(Bn,"g"),En[Bn](Ut)));return Bn=(function(rn){var tr=Array(zn(rn)+1);return on(rn,tr,0,tr.length),tr})(Dt=Dt.replace(/\0\0/g,"%")),Bn.length>It?0:((function(rn,tr){et().set(rn,tr>>>0)})(Bn,xt),Bn.length-1)}yn.fc();var Vr=[null,Dn,Vn,pr,_r,Cr,Ar,nr,ir,vr,Lr,kr,Or,Fr,$r,Ft,Vt,Jt,tn,vn,nn,Cn,lr,Rr,Ir,Zr],Wr={b:function(xt){return Dr(xt+24)+24},n:function(xt){return(xt=new _n(xt)).uc()||(xt.hc(!0),An--),xt.ic(!1),hr.push(xt),xt.sc(),xt.vc()},ma:function(xt){throw kt("Unexpected exception thrown, this is not properly supported - aborting"),un=!0,xt},x:function(){Fn(0);var xt=hr.pop();if(xt.Hc()&&!xt.kc()){var It=xt.Dc();It&&wn(It)(xt.Zb),Sr(xt.Zb)}xn=0},e:function(){var xt=xn;if(!xt)return Pr=0;var It=new _n(xt);It.cc(xt);var Dt=It.bc();if(!Dt)return Pr=0,xt;for(var Ut=Array.prototype.slice.call(arguments),Bt=0;Bt<Ut.length;Bt++){var jt=Ut[Bt];if(jt===0||jt===Dt)break;if(Kr(jt,Dt,It.Sb+16))return Pr=jt,xt}return Pr=Dt,xt},l:function(){var xt=xn;if(!xt)return Pr=0;var It=new _n(xt);It.cc(xt);var Dt=It.bc();if(!Dt)return Pr=0,xt;for(var Ut=Array.prototype.slice.call(arguments),Bt=0;Bt<Ut.length;Bt++){var jt=Ut[Bt];if(jt===0||jt===Dt)break;if(Kr(jt,Dt,It.Sb+16))return Pr=jt,xt}return Pr=Dt,xt},h:function(){var xt=xn;if(!xt)return Pr=0;var It=new _n(xt);It.cc(xt);var Dt=It.bc();if(!Dt)return Pr=0,xt;for(var Ut=Array.prototype.slice.call(arguments),Bt=0;Bt<Ut.length;Bt++){var jt=Ut[Bt];if(jt===0||jt===Dt)break;if(Kr(jt,Dt,It.Sb+16))return Pr=jt,xt}return Pr=Dt,xt},t:Sr,M:function(){var xt=hr.pop();xt||mn("no exception to throw");var It=xt.Zb;throw xt.kc()||(hr.push(xt),xt.ic(!0),xt.hc(!1),An++),xn=It,It},c:function(xt,It,Dt){throw new _n(xt).fc(It,Dt),xn=xt,An++,xt},pa:function(){return An},Fa:function(xt){oi(xt,!Et,1,!vt),yn.pc()},T:function(xt){St?postMessage({cmd:"cleanupThread",thread:xt}):Pn(xt)},xa:wr,j:function(xt){throw xn||(xn=xt),xt},H:_r,Ma:Cr,ua:Ar,wa:nr,oa:ir,Ka:vr,Ca:Lr,Ja:kr,V:Or,va:Fr,sa:$r,La:Ft,ta:Vt,Ta:function(){},X:function(){mn("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){mn("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(xt,It,Dt,Ut){if(xt==It)setTimeout((()=>Yt(Ut)));else if(St)postMessage({targetThread:xt,cmd:"processProxyingQueue",queue:Ut});else{if(!(xt=yn.Vb[xt]))return;xt.postMessage({cmd:"processProxyingQueue",queue:Ut})}return 1},Ea:function(){return-1},Pa:function(xt,It){xt=new Date(1e3*Zt(xt)),it()[It>>2>>>0]=xt.getUTCSeconds(),it()[It+4>>2>>>0]=xt.getUTCMinutes(),it()[It+8>>2>>>0]=xt.getUTCHours(),it()[It+12>>2>>>0]=xt.getUTCDate(),it()[It+16>>2>>>0]=xt.getUTCMonth(),it()[It+20>>2>>>0]=xt.getUTCFullYear()-1900,it()[It+24>>2>>>0]=xt.getUTCDay(),xt=(xt.getTime()-Date.UTC(xt.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,it()[It+28>>2>>>0]=xt},Qa:function(xt,It){xt=new Date(1e3*Zt(xt)),it()[It>>2>>>0]=xt.getSeconds(),it()[It+4>>2>>>0]=xt.getMinutes(),it()[It+8>>2>>>0]=xt.getHours(),it()[It+12>>2>>>0]=xt.getDate(),it()[It+16>>2>>>0]=xt.getMonth(),it()[It+20>>2>>>0]=xt.getFullYear()-1900,it()[It+24>>2>>>0]=xt.getDay();var Dt=new Date(xt.getFullYear(),0,1),Ut=(xt.getTime()-Dt.getTime())/864e5|0;it()[It+28>>2>>>0]=Ut,it()[It+36>>2>>>0]=-60*xt.getTimezoneOffset(),Ut=new Date(xt.getFullYear(),6,1).getTimezoneOffset(),xt=0|(Ut!=(Dt=Dt.getTimezoneOffset())&&xt.getTimezoneOffset()==Math.min(Dt,Ut)),it()[It+32>>2>>>0]=xt},Ra:function(xt){var It=new Date(it()[xt+20>>2>>>0]+1900,it()[xt+16>>2>>>0],it()[xt+12>>2>>>0],it()[xt+8>>2>>>0],it()[xt+4>>2>>>0],it()[xt>>2>>>0],0),Dt=it()[xt+32>>2>>>0],Ut=It.getTimezoneOffset(),Bt=new Date(It.getFullYear(),0,1),jt=new Date(It.getFullYear(),6,1).getTimezoneOffset(),Qt=Bt.getTimezoneOffset(),sn=Math.min(Qt,jt);return 0>Dt?it()[xt+32>>2>>>0]=+(jt!=Qt&&sn==Ut):0<Dt!=(sn==Ut)&&(jt=Math.max(Qt,jt),It.setTime(It.getTime()+6e4*((0<Dt?sn:jt)-Ut))),it()[xt+24>>2>>>0]=It.getDay(),Dt=(It.getTime()-Bt.getTime())/864e5|0,it()[xt+28>>2>>>0]=Dt,it()[xt>>2>>>0]=It.getSeconds(),it()[xt+4>>2>>>0]=It.getMinutes(),it()[xt+8>>2>>>0]=It.getHours(),it()[xt+12>>2>>>0]=It.getDate(),it()[xt+16>>2>>>0]=It.getMonth(),It.getTime()/1e3|0},Aa:Jt,Ba:tn,Sa:function xt(It,Dt,Ut){xt.Ac||(xt.Ac=!0,vn(It,Dt,Ut))},y:function(){mn("")},U:function(){if(!wt&&!Et){var xt="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";ar||(ar={}),ar[xt]||(ar[xt]=1,wt&&(xt="warning: "+xt),kt(xt))}},ra:function(){return 4294901760},B:Jn,Ia:function(xt,It,Dt){tt().copyWithin(xt>>>0,It>>>0,It+Dt>>>0)},F:function(){return wt?Y(3993).cpus().length:navigator.hardwareConcurrency},Da:function(xt,It,Dt){rr.length=It,Dt>>=3;for(var Ut=0;Ut<It;Ut++)rr[Ut]=ot()[Dt+Ut>>>0];return(0>xt?qn[-xt-1]:Vr[xt]).apply(null,rr)},qa:function(xt){var It=tt().length;if((xt>>>=0)<=It||4294901760<xt)return!1;for(var Dt=1;4>=Dt;Dt*=2){var Ut=It*(1+.2/Dt);Ut=Math.min(Ut,xt+100663296);var Bt=Math;Ut=Math.max(xt,Ut),Bt=Bt.min.call(Bt,4294901760,Ut+(65536-Ut%65536)%65536);e:{try{zt.grow(Bt-qt.byteLength+65535>>>16),Ln(zt.buffer);var jt=1;break e}catch{}jt=void 0}if(jt)return!0}return!1},Na:function(){throw"unwind"},Ga:nn,Ha:Cn,J:or,I:lr,S:Rr,ga:Ir,R:Zr,d:function(){return Pr},na:function xt(It,Dt){xt.lc||(xt.lc=(function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var Bt=new Uint8Array(1);return()=>(crypto.getRandomValues(Bt),Bt[0])}if(wt)try{var jt=Y(Object((function(){var Qt=new Error("Cannot find module 'crypto'");throw Qt.code="MODULE_NOT_FOUND",Qt})()));return()=>jt.randomBytes(1)[0]}catch{}return()=>mn("randomDevice")})());for(var Ut=0;Ut<Dt;Ut++)et()[It+Ut>>0>>>0]=xt.lc();return 0},ia:function(xt,It,Dt){var Ut=$n();try{return wn(xt)(It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},ja:function(xt,It,Dt){var Ut=$n();try{return wn(xt)(It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},K:function(xt){var It=$n();try{return wn(xt)()}catch(Dt){if(Nn(It),Dt!==Dt+0)throw Dt;Fn(1,0)}},f:function(xt,It){var Dt=$n();try{return wn(xt)(It)}catch(Ut){if(Nn(Dt),Ut!==Ut+0)throw Ut;Fn(1,0)}},P:function(xt,It,Dt){var Ut=$n();try{return wn(xt)(It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},Q:function(xt,It,Dt){var Ut=$n();try{return wn(xt)(It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},k:function(xt,It,Dt){var Ut=$n();try{return wn(xt)(It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},p:function(xt,It,Dt,Ut){var Bt=$n();try{return wn(xt)(It,Dt,Ut)}catch(jt){if(Nn(Bt),jt!==jt+0)throw jt;Fn(1,0)}},q:function(xt,It,Dt,Ut,Bt){var jt=$n();try{return wn(xt)(It,Dt,Ut,Bt)}catch(Qt){if(Nn(jt),Qt!==Qt+0)throw Qt;Fn(1,0)}},N:function(xt,It,Dt,Ut,Bt,jt){var Qt=$n();try{return wn(xt)(It,Dt,Ut,Bt,jt)}catch(sn){if(Nn(Qt),sn!==sn+0)throw sn;Fn(1,0)}},s:function(xt,It,Dt,Ut,Bt,jt){var Qt=$n();try{return wn(xt)(It,Dt,Ut,Bt,jt)}catch(sn){if(Nn(Qt),sn!==sn+0)throw sn;Fn(1,0)}},w:function(xt,It,Dt,Ut,Bt,jt,Qt){var sn=$n();try{return wn(xt)(It,Dt,Ut,Bt,jt,Qt)}catch(gn){if(Nn(sn),gn!==gn+0)throw gn;Fn(1,0)}},L:function(xt,It,Dt,Ut,Bt,jt,Qt,sn){var gn=$n();try{return wn(xt)(It,Dt,Ut,Bt,jt,Qt,sn)}catch(En){if(Nn(gn),En!==En+0)throw En;Fn(1,0)}},E:function(xt,It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn,xr){var Tr=$n();try{return wn(xt)(It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn,xr)}catch(rn){if(Nn(Tr),rn!==rn+0)throw rn;Fn(1,0)}},aa:function(xt,It,Dt,Ut,Bt,jt,Qt,sn){var gn=$n();try{return Lt(xt,It,Dt,Ut,Bt,jt,Qt,sn)}catch(En){if(Nn(gn),En!==En+0)throw En;Fn(1,0)}},_:function(xt,It,Dt,Ut,Bt,jt,Qt){var sn=$n();try{return di(xt,It,Dt,Ut,Bt,jt,Qt)}catch(gn){if(Nn(sn),gn!==gn+0)throw gn;Fn(1,0)}},Z:function(xt,It,Dt,Ut,Bt){var jt=$n();try{return Gt(xt,It,Dt,Ut,Bt)}catch(Qt){if(Nn(jt),Qt!==Qt+0)throw Qt;Fn(1,0)}},ca:function(xt,It,Dt,Ut){var Bt=$n();try{return _t(xt,It,Dt,Ut)}catch(jt){if(Nn(Bt),jt!==jt+0)throw jt;Fn(1,0)}},$:function(xt){var It=$n();try{return ui(xt)}catch(Dt){if(Nn(It),Dt!==Dt+0)throw Dt;Fn(1,0)}},ba:function(xt,It){var Dt=$n();try{return Tt(xt,It)}catch(Ut){if(Nn(Dt),Ut!==Ut+0)throw Ut;Fn(1,0)}},Y:function(xt,It,Dt){var Ut=$n();try{return hi(xt,It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},g:function(xt){var It=$n();try{wn(xt)()}catch(Dt){if(Nn(It),Dt!==Dt+0)throw Dt;Fn(1,0)}},r:function(xt,It){var Dt=$n();try{wn(xt)(It)}catch(Ut){if(Nn(Dt),Ut!==Ut+0)throw Ut;Fn(1,0)}},i:function(xt,It,Dt){var Ut=$n();try{wn(xt)(It,Dt)}catch(Bt){if(Nn(Ut),Bt!==Bt+0)throw Bt;Fn(1,0)}},ha:function(xt,It,Dt,Ut){var Bt=$n();try{wn(xt)(It,Dt,Ut)}catch(jt){if(Nn(Bt),jt!==jt+0)throw jt;Fn(1,0)}},m:function(xt,It,Dt,Ut){var Bt=$n();try{wn(xt)(It,Dt,Ut)}catch(jt){if(Nn(Bt),jt!==jt+0)throw jt;Fn(1,0)}},v:function(xt,It,Dt,Ut,Bt){var jt=$n();try{wn(xt)(It,Dt,Ut,Bt)}catch(Qt){if(Nn(jt),Qt!==Qt+0)throw Qt;Fn(1,0)}},u:function(xt,It,Dt,Ut,Bt,jt){var Qt=$n();try{wn(xt)(It,Dt,Ut,Bt,jt)}catch(sn){if(Nn(Qt),sn!==sn+0)throw sn;Fn(1,0)}},O:function(xt,It,Dt,Ut,Bt,jt,Qt){var sn=$n();try{wn(xt)(It,Dt,Ut,Bt,jt,Qt)}catch(gn){if(Nn(sn),gn!==gn+0)throw gn;Fn(1,0)}},A:function(xt,It,Dt,Ut,Bt,jt,Qt,sn){var gn=$n();try{wn(xt)(It,Dt,Ut,Bt,jt,Qt,sn)}catch(En){if(Nn(gn),En!==En+0)throw En;Fn(1,0)}},ka:function(xt,It,Dt,Ut,Bt,jt,Qt,sn,gn){var En=$n();try{wn(xt)(It,Dt,Ut,Bt,jt,Qt,sn,gn)}catch(Bn){if(Nn(En),Bn!==Bn+0)throw Bn;Fn(1,0)}},C:function(xt,It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn){var xr=$n();try{wn(xt)(It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn)}catch(Tr){if(Nn(xr),Tr!==Tr+0)throw Tr;Fn(1,0)}},D:function(xt,It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn,xr,Tr,rn,tr,yr){var Mr=$n();try{wn(xt)(It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn,xr,Tr,rn,tr,yr)}catch(Xr){if(Nn(Mr),Xr!==Xr+0)throw Xr;Fn(1,0)}},fa:function(xt,It,Dt,Ut,Bt,jt,Qt,sn){var gn=$n();try{pi(xt,It,Dt,Ut,Bt,jt,Qt,sn)}catch(En){if(Nn(gn),En!==En+0)throw En;Fn(1,0)}},da:function(xt,It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn,xr){var Tr=$n();try{Ct(xt,It,Dt,Ut,Bt,jt,Qt,sn,gn,En,Bn,xr)}catch(rn){if(Nn(Tr),rn!==rn+0)throw rn;Fn(1,0)}},ea:function(xt,It,Dt,Ut,Bt,jt){var Qt=$n();try{ii(xt,It,Dt,Ut,Bt,jt)}catch(sn){if(Nn(Qt),sn!==sn+0)throw sn;Fn(1,0)}},o:function(xt){return xt},a:zt||rt.wasmMemory,G:function(xt){Pr=xt},la:Qr,z:function(xt,It,Dt,Ut){return Qr(xt,It,Dt,Ut)}};(function(){function xt(Bt,jt){rt.asm=Bt.exports,yn.qc.push(rt.asm.sb),Hn=rt.asm.ub,Gn.unshift(rt.asm.Va),Kt=jt,St||(kn--,rt.monitorRunDependencies&&rt.monitorRunDependencies(kn),kn==0&&br&&(Bt=br,br=null,Bt()))}function It(Bt){xt(Bt.instance,Bt.module)}function Dt(Bt){return(function(){if(!Rt&&(vt||Et)){if(typeof fetch=="function"&&!On.startsWith("file://"))return fetch(On,{credentials:"same-origin"}).then((function(jt){if(!jt.ok)throw"failed to load wasm binary file at '"+On+"'";return jt.arrayBuffer()})).catch((function(){return Un()}));if(ut)return new Promise((function(jt,Qt){ut(On,(function(sn){jt(new Uint8Array(sn))}),Qt)}))}return Promise.resolve().then((function(){return Un()}))})().then((function(jt){return WebAssembly.instantiate(jt,Ut)})).then((function(jt){return jt})).then(Bt,(function(jt){kt("failed to asynchronously prepare wasm: "+jt),mn(jt)}))}var Ut={a:Wr};if(St||(kn++,rt.monitorRunDependencies&&rt.monitorRunDependencies(kn)),rt.instantiateWasm)try{return rt.instantiateWasm(Ut,xt)}catch(Bt){return kt("Module.instantiateWasm callback failed with error: "+Bt),!1}(Rt||typeof WebAssembly.instantiateStreaming!="function"||jn()||On.startsWith("file://")||wt||typeof fetch!="function"?Dt(It):fetch(On,{credentials:"same-origin"}).then((function(Bt){return WebAssembly.instantiateStreaming(Bt,Ut).then(It,(function(jt){return kt("wasm streaming compile failed: "+jt),kt("falling back to ArrayBuffer instantiation"),Dt(It)}))}))).catch(at)})(),rt.___wasm_call_ctors=function(){return(rt.___wasm_call_ctors=rt.asm.Va).apply(null,arguments)},rt._OrtInit=function(){return(rt._OrtInit=rt.asm.Wa).apply(null,arguments)},rt._OrtCreateSessionOptions=function(){return(rt._OrtCreateSessionOptions=rt.asm.Xa).apply(null,arguments)},rt._OrtAppendExecutionProvider=function(){return(rt._OrtAppendExecutionProvider=rt.asm.Ya).apply(null,arguments)},rt._OrtAddSessionConfigEntry=function(){return(rt._OrtAddSessionConfigEntry=rt.asm.Za).apply(null,arguments)},rt._OrtReleaseSessionOptions=function(){return(rt._OrtReleaseSessionOptions=rt.asm._a).apply(null,arguments)},rt._OrtCreateSession=function(){return(rt._OrtCreateSession=rt.asm.$a).apply(null,arguments)},rt._OrtReleaseSession=function(){return(rt._OrtReleaseSession=rt.asm.ab).apply(null,arguments)},rt._OrtGetInputCount=function(){return(rt._OrtGetInputCount=rt.asm.bb).apply(null,arguments)},rt._OrtGetOutputCount=function(){return(rt._OrtGetOutputCount=rt.asm.cb).apply(null,arguments)},rt._OrtGetInputName=function(){return(rt._OrtGetInputName=rt.asm.db).apply(null,arguments)},rt._OrtGetOutputName=function(){return(rt._OrtGetOutputName=rt.asm.eb).apply(null,arguments)},rt._OrtFree=function(){return(rt._OrtFree=rt.asm.fb).apply(null,arguments)},rt._OrtCreateTensor=function(){return(rt._OrtCreateTensor=rt.asm.gb).apply(null,arguments)},rt._OrtGetTensorData=function(){return(rt._OrtGetTensorData=rt.asm.hb).apply(null,arguments)},rt._OrtReleaseTensor=function(){return(rt._OrtReleaseTensor=rt.asm.ib).apply(null,arguments)},rt._OrtCreateRunOptions=function(){return(rt._OrtCreateRunOptions=rt.asm.jb).apply(null,arguments)},rt._OrtAddRunConfigEntry=function(){return(rt._OrtAddRunConfigEntry=rt.asm.kb).apply(null,arguments)},rt._OrtReleaseRunOptions=function(){return(rt._OrtReleaseRunOptions=rt.asm.lb).apply(null,arguments)},rt._OrtRun=function(){return(rt._OrtRun=rt.asm.mb).apply(null,arguments)},rt._OrtEndProfiling=function(){return(rt._OrtEndProfiling=rt.asm.nb).apply(null,arguments)};var Nr=rt._pthread_self=function(){return(Nr=rt._pthread_self=rt.asm.ob).apply(null,arguments)},Dr=rt._malloc=function(){return(Dr=rt._malloc=rt.asm.pb).apply(null,arguments)},jr=rt._free=function(){return(jr=rt._free=rt.asm.qb).apply(null,arguments)},ei=rt._fflush=function(){return(ei=rt._fflush=rt.asm.rb).apply(null,arguments)};rt.__emscripten_tls_init=function(){return(rt.__emscripten_tls_init=rt.asm.sb).apply(null,arguments)};var qr=rt.___funcs_on_exit=function(){return(qr=rt.___funcs_on_exit=rt.asm.tb).apply(null,arguments)},oi=rt.__emscripten_thread_init=function(){return(oi=rt.__emscripten_thread_init=rt.asm.vb).apply(null,arguments)};rt.__emscripten_thread_crashed=function(){return(rt.__emscripten_thread_crashed=rt.asm.wb).apply(null,arguments)};var Hr,ai=rt._emscripten_run_in_main_runtime_thread_js=function(){return(ai=rt._emscripten_run_in_main_runtime_thread_js=rt.asm.xb).apply(null,arguments)},li=rt.__emscripten_proxy_execute_task_queue=function(){return(li=rt.__emscripten_proxy_execute_task_queue=rt.asm.yb).apply(null,arguments)},Yr=rt.__emscripten_thread_free_data=function(){return(Yr=rt.__emscripten_thread_free_data=rt.asm.zb).apply(null,arguments)},ti=rt.__emscripten_thread_exit=function(){return(ti=rt.__emscripten_thread_exit=rt.asm.Ab).apply(null,arguments)},Fn=rt._setThrew=function(){return(Fn=rt._setThrew=rt.asm.Bb).apply(null,arguments)},ci=rt._emscripten_stack_set_limits=function(){return(ci=rt._emscripten_stack_set_limits=rt.asm.Cb).apply(null,arguments)},$n=rt.stackSave=function(){return($n=rt.stackSave=rt.asm.Db).apply(null,arguments)},Nn=rt.stackRestore=function(){return(Nn=rt.stackRestore=rt.asm.Eb).apply(null,arguments)},ni=rt.stackAlloc=function(){return(ni=rt.stackAlloc=rt.asm.Fb).apply(null,arguments)},Kr=rt.___cxa_can_catch=function(){return(Kr=rt.___cxa_can_catch=rt.asm.Gb).apply(null,arguments)},ri=rt.___cxa_is_pointer_type=function(){return(ri=rt.___cxa_is_pointer_type=rt.asm.Hb).apply(null,arguments)},ui=rt.dynCall_j=function(){return(ui=rt.dynCall_j=rt.asm.Ib).apply(null,arguments)},di=rt.dynCall_iiiiij=function(){return(di=rt.dynCall_iiiiij=rt.asm.Jb).apply(null,arguments)},hi=rt.dynCall_jii=function(){return(hi=rt.dynCall_jii=rt.asm.Kb).apply(null,arguments)},pi=rt.dynCall_viiiiij=function(){return(pi=rt.dynCall_viiiiij=rt.asm.Lb).apply(null,arguments)},ii=rt.dynCall_vjji=function(){return(ii=rt.dynCall_vjji=rt.asm.Mb).apply(null,arguments)},Ct=rt.dynCall_viiijjjii=function(){return(Ct=rt.dynCall_viiijjjii=rt.asm.Nb).apply(null,arguments)},_t=rt.dynCall_iij=function(){return(_t=rt.dynCall_iij=rt.asm.Ob).apply(null,arguments)},Tt=rt.dynCall_ji=function(){return(Tt=rt.dynCall_ji=rt.asm.Pb).apply(null,arguments)},Lt=rt.dynCall_iiiiiij=function(){return(Lt=rt.dynCall_iiiiiij=rt.asm.Qb).apply(null,arguments)},Gt=rt.dynCall_iiij=function(){return(Gt=rt.dynCall_iiij=rt.asm.Rb).apply(null,arguments)};function Ht(){function xt(){if(!Hr&&(Hr=!0,rt.calledRun=!0,!un)&&(St||ur(Gn),nt(rt),rt.onRuntimeInitialized&&rt.onRuntimeInitialized(),!St)){if(rt.postRun)for(typeof rt.postRun=="function"&&(rt.postRun=[rt.postRun]);rt.postRun.length;){var It=rt.postRun.shift();Qn.unshift(It)}ur(Qn)}}if(!(0<kn))if(St)nt(rt),St||ur(Gn),postMessage({cmd:"loaded"});else{if(rt.preRun)for(typeof rt.preRun=="function"&&(rt.preRun=[rt.preRun]);rt.preRun.length;)cr();ur(Wn),0<kn||(rt.setStatus?(rt.setStatus("Running..."),setTimeout((function(){setTimeout((function(){rt.setStatus("")}),1),xt()}),1)):xt())}}if(rt.UTF8ToString=bn,rt.stringToUTF8=function(xt,It,Dt){return on(xt,tt(),It,Dt)},rt.lengthBytesUTF8=zn,rt.keepRuntimeAlive=sr,rt.wasmMemory=zt,rt.stackSave=$n,rt.stackRestore=Nn,rt.stackAlloc=ni,rt.ExitStatus=er,rt.PThread=yn,br=function xt(){Hr||Ht(),Hr||(br=xt)},rt.preInit)for(typeof rt.preInit=="function"&&(rt.preInit=[rt.preInit]);0<rt.preInit.length;)rt.preInit.pop()();return Ht(),xe.ready});ee.exports=ne},932:(ee,O,Y)=>{var te,ne=(te=(te=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(xe){var et,tt,it;xe=xe||{},et||(et=xe!==void 0?xe:{}),et.ready=new Promise((function(Ft,Vt){tt=Ft,it=Vt}));var st,ot,rt,nt,at,ct,ut=Object.assign({},et),dt="./this.program",ht=(Ft,Vt)=>{throw Vt},pt=typeof window=="object",ft=typeof importScripts=="function",mt=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",yt="";mt?(yt=ft?Y(908).dirname(yt)+"/":"//",ct=()=>{at||(nt=Y(1384),at=Y(908))},st=function(Ft,Vt){return ct(),Ft=at.normalize(Ft),nt.readFileSync(Ft,Vt?void 0:"utf8")},rt=Ft=>((Ft=st(Ft,!0)).buffer||(Ft=new Uint8Array(Ft)),Ft),ot=(Ft,Vt,Yt)=>{ct(),Ft=at.normalize(Ft),nt.readFile(Ft,(function(Zt,Jt){Zt?Yt(Zt):Vt(Jt.buffer)}))},1<process.argv.length&&(dt=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(Ft){if(!(Ft instanceof Gn))throw Ft})),process.on("unhandledRejection",(function(Ft){throw Ft})),ht=(Ft,Vt)=>{if(wt||0<Tn)throw process.exitCode=Ft,Vt;Vt instanceof Gn||Et("exiting due to exception: "+Vt),process.exit(Ft)},et.inspect=function(){return"[Emscripten Module object]"}):(pt||ft)&&(ft?yt=self.location.href:typeof document<"u"&&document.currentScript&&(yt=document.currentScript.src),te&&(yt=te),yt=yt.indexOf("blob:")!==0?yt.substr(0,yt.replace(/[?#].*/,"").lastIndexOf("/")+1):"",st=Ft=>{var Vt=new XMLHttpRequest;return Vt.open("GET",Ft,!1),Vt.send(null),Vt.responseText},ft&&(rt=Ft=>{var Vt=new XMLHttpRequest;return Vt.open("GET",Ft,!1),Vt.responseType="arraybuffer",Vt.send(null),new Uint8Array(Vt.response)}),ot=(Ft,Vt,Yt)=>{var Zt=new XMLHttpRequest;Zt.open("GET",Ft,!0),Zt.responseType="arraybuffer",Zt.onload=()=>{Zt.status==200||Zt.status==0&&Zt.response?Vt(Zt.response):Yt()},Zt.onerror=Yt,Zt.send(null)});var bt,vt=et.print||console.log.bind(console),Et=et.printErr||console.warn.bind(console);Object.assign(et,ut),ut=null,et.thisProgram&&(dt=et.thisProgram),et.quit&&(ht=et.quit),et.wasmBinary&&(bt=et.wasmBinary);var wt=et.noExitRuntime||!1;typeof WebAssembly!="object"&&Ln("no native wasm support detected");var St,Ot,$t,Mt,Nt,Rt,Pt=!1,kt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Wt(Ft,Vt,Yt){var Zt=(Vt>>>=0)+Yt;for(Yt=Vt;Ft[Yt]&&!(Yt>=Zt);)++Yt;if(16<Yt-Vt&&Ft.buffer&&kt)return kt.decode(Ft.subarray(Vt,Yt));for(Zt="";Vt<Yt;){var Jt=Ft[Vt++];if(128&Jt){var tn=63&Ft[Vt++];if((224&Jt)==192)Zt+=String.fromCharCode((31&Jt)<<6|tn);else{var cn=63&Ft[Vt++];65536>(Jt=(240&Jt)==224?(15&Jt)<<12|tn<<6|cn:(7&Jt)<<18|tn<<12|cn<<6|63&Ft[Vt++])?Zt+=String.fromCharCode(Jt):(Jt-=65536,Zt+=String.fromCharCode(55296|Jt>>10,56320|1023&Jt))}}else Zt+=String.fromCharCode(Jt)}return Zt}function zt(Ft,Vt){return(Ft>>>=0)?Wt(Mt,Ft,Vt):""}function Kt(Ft,Vt,Yt,Zt){if(!(0<Zt))return 0;var Jt=Yt>>>=0;Zt=Yt+Zt-1;for(var tn=0;tn<Ft.length;++tn){var cn=Ft.charCodeAt(tn);if(55296<=cn&&57343>=cn&&(cn=65536+((1023&cn)<<10)|1023&Ft.charCodeAt(++tn)),127>=cn){if(Yt>=Zt)break;Vt[Yt++>>>0]=cn}else{if(2047>=cn){if(Yt+1>=Zt)break;Vt[Yt++>>>0]=192|cn>>6}else{if(65535>=cn){if(Yt+2>=Zt)break;Vt[Yt++>>>0]=224|cn>>12}else{if(Yt+3>=Zt)break;Vt[Yt++>>>0]=240|cn>>18,Vt[Yt++>>>0]=128|cn>>12&63}Vt[Yt++>>>0]=128|cn>>6&63}Vt[Yt++>>>0]=128|63&cn}}return Vt[Yt>>>0]=0,Yt-Jt}function qt(Ft){for(var Vt=0,Yt=0;Yt<Ft.length;++Yt){var Zt=Ft.charCodeAt(Yt);127>=Zt?Vt++:2047>=Zt?Vt+=2:55296<=Zt&&57343>=Zt?(Vt+=4,++Yt):Vt+=3}return Vt}function Xt(){var Ft=St.buffer;Ot=Ft,et.HEAP8=$t=new Int8Array(Ft),et.HEAP16=new Int16Array(Ft),et.HEAP32=Nt=new Int32Array(Ft),et.HEAPU8=Mt=new Uint8Array(Ft),et.HEAPU16=new Uint16Array(Ft),et.HEAPU32=Rt=new Uint32Array(Ft),et.HEAPF32=new Float32Array(Ft),et.HEAPF64=new Float64Array(Ft)}var an,pn=[],ln=[],dn=[],un=[],Tn=0;function Sn(){var Ft=et.preRun.shift();pn.unshift(Ft)}var bn,on=0,zn=null;function Ln(Ft){throw et.onAbort&&et.onAbort(Ft),Et(Ft="Aborted("+Ft+")"),Pt=!0,Ft=new WebAssembly.RuntimeError(Ft+". Build with -sASSERTIONS for more info."),it(Ft),Ft}function hn(){return bn.startsWith("data:application/octet-stream;base64,")}if(bn="ort-wasm.wasm",!hn()){var Hn=bn;bn=et.locateFile?et.locateFile(Hn,yt):yt+Hn}function Wn(){var Ft=bn;try{if(Ft==bn&&bt)return new Uint8Array(bt);if(rt)return rt(Ft);throw"both async and sync fetching of the wasm failed"}catch(Vt){Ln(Vt)}}function Gn(Ft){this.name="ExitStatus",this.message="Program terminated with exit("+Ft+")",this.status=Ft}function gr(Ft){for(;0<Ft.length;)Ft.shift()(et)}var Qn=[],sr=0,cr=0;function On(Ft){this.Db=Ft,this.zb=Ft-24,this.Ub=function(Vt){Rt[this.zb+4>>2>>>0]=Vt},this.Eb=function(){return Rt[this.zb+4>>2>>>0]},this.Sb=function(Vt){Rt[this.zb+8>>2>>>0]=Vt},this.Wb=function(){return Rt[this.zb+8>>2>>>0]},this.Tb=function(){Nt[this.zb>>2>>>0]=0},this.Ib=function(Vt){$t[this.zb+12>>0>>>0]=Vt?1:0},this.Pb=function(){return $t[this.zb+12>>0>>>0]!=0},this.Jb=function(Vt){$t[this.zb+13>>0>>>0]=Vt?1:0},this.Lb=function(){return $t[this.zb+13>>0>>>0]!=0},this.Rb=function(Vt,Yt){this.Fb(0),this.Ub(Vt),this.Sb(Yt),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){Nt[this.zb>>2>>>0]+=1},this.Xb=function(){var Vt=Nt[this.zb>>2>>>0];return Nt[this.zb>>2>>>0]=Vt-1,Vt===1},this.Fb=function(Vt){Rt[this.zb+16>>2>>>0]=Vt},this.Ob=function(){return Rt[this.zb+16>>2>>>0]},this.Qb=function(){if(wr(this.Eb()))return Rt[this.Db>>2>>>0];var Vt=this.Ob();return Vt!==0?Vt:this.Db}}function kn(Ft){return ar(new On(Ft).zb)}var br=[];function mn(Ft){var Vt=br[Ft];return Vt||(Ft>=br.length&&(br.length=Ft+1),br[Ft]=Vt=an.get(Ft)),Vt}function jn(Ft){var Vt=qt(Ft)+1,Yt=wn(Vt);return Yt&&Kt(Ft,$t,Yt,Vt),Yt}var Un={};function qn(){if(!er){var Ft,Vt={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:dt||"./this.program"};for(Ft in Un)Un[Ft]===void 0?delete Vt[Ft]:Vt[Ft]=Un[Ft];var Yt=[];for(Ft in Vt)Yt.push(Ft+"="+Vt[Ft]);er=Yt}return er}var er,Pn=[null,[],[]];function Rn(Ft,Vt){var Yt=Pn[Ft];Vt===0||Vt===10?((Ft===1?vt:Et)(Wt(Yt,0)),Yt.length=0):Yt.push(Vt)}var Dn=0;function or(Ft){return Ft%4==0&&(Ft%100!=0||Ft%400==0)}var yn=[31,29,31,30,31,30,31,31,30,31,30,31],ur=[31,28,31,30,31,30,31,31,30,31,30,31];function dr(Ft,Vt,Yt,Zt){function Jt(nn,Cn,lr){for(nn=typeof nn=="number"?nn.toString():nn||"";nn.length<Cn;)nn=lr[0]+nn;return nn}function tn(nn,Cn){return Jt(nn,Cn,"0")}function cn(nn,Cn){function lr(Ir){return 0>Ir?-1:0<Ir?1:0}var Rr;return(Rr=lr(nn.getFullYear()-Cn.getFullYear()))===0&&(Rr=lr(nn.getMonth()-Cn.getMonth()))===0&&(Rr=lr(nn.getDate()-Cn.getDate())),Rr}function vn(nn){switch(nn.getDay()){case 0:return new Date(nn.getFullYear()-1,11,29);case 1:return nn;case 2:return new Date(nn.getFullYear(),0,3);case 3:return new Date(nn.getFullYear(),0,2);case 4:return new Date(nn.getFullYear(),0,1);case 5:return new Date(nn.getFullYear()-1,11,31);case 6:return new Date(nn.getFullYear()-1,11,30)}}function fn(nn){var Cn=nn.Bb;for(nn=new Date(new Date(nn.Cb+1900,0,1).getTime());0<Cn;){var lr=nn.getMonth(),Rr=(or(nn.getFullYear())?yn:ur)[lr];if(!(Cn>Rr-nn.getDate())){nn.setDate(nn.getDate()+Cn);break}Cn-=Rr-nn.getDate()+1,nn.setDate(1),11>lr?nn.setMonth(lr+1):(nn.setMonth(0),nn.setFullYear(nn.getFullYear()+1))}return lr=new Date(nn.getFullYear()+1,0,4),Cn=vn(new Date(nn.getFullYear(),0,4)),lr=vn(lr),0>=cn(Cn,nn)?0>=cn(lr,nn)?nn.getFullYear()+1:nn.getFullYear():nn.getFullYear()-1}var Mn=Nt[Zt+40>>2>>>0];for(var rr in Zt={$b:Nt[Zt>>2>>>0],Zb:Nt[Zt+4>>2>>>0],Gb:Nt[Zt+8>>2>>>0],Kb:Nt[Zt+12>>2>>>0],Hb:Nt[Zt+16>>2>>>0],Cb:Nt[Zt+20>>2>>>0],Ab:Nt[Zt+24>>2>>>0],Bb:Nt[Zt+28>>2>>>0],bc:Nt[Zt+32>>2>>>0],Yb:Nt[Zt+36>>2>>>0],ac:Mn?zt(Mn):""},Yt=zt(Yt),Mn={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})Yt=Yt.replace(new RegExp(rr,"g"),Mn[rr]);var fr="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),mr="January February March April May June July August September October November December".split(" ");for(rr in Mn={"%a":function(nn){return fr[nn.Ab].substring(0,3)},"%A":function(nn){return fr[nn.Ab]},"%b":function(nn){return mr[nn.Hb].substring(0,3)},"%B":function(nn){return mr[nn.Hb]},"%C":function(nn){return tn((nn.Cb+1900)/100|0,2)},"%d":function(nn){return tn(nn.Kb,2)},"%e":function(nn){return Jt(nn.Kb,2," ")},"%g":function(nn){return fn(nn).toString().substring(2)},"%G":function(nn){return fn(nn)},"%H":function(nn){return tn(nn.Gb,2)},"%I":function(nn){return(nn=nn.Gb)==0?nn=12:12<nn&&(nn-=12),tn(nn,2)},"%j":function(nn){for(var Cn=0,lr=0;lr<=nn.Hb-1;Cn+=(or(nn.Cb+1900)?yn:ur)[lr++]);return tn(nn.Kb+Cn,3)},"%m":function(nn){return tn(nn.Hb+1,2)},"%M":function(nn){return tn(nn.Zb,2)},"%n":function(){return`
`},"%p":function(nn){return 0<=nn.Gb&&12>nn.Gb?"AM":"PM"},"%S":function(nn){return tn(nn.$b,2)},"%t":function(){return"	"},"%u":function(nn){return nn.Ab||7},"%U":function(nn){return tn(Math.floor((nn.Bb+7-nn.Ab)/7),2)},"%V":function(nn){var Cn=Math.floor((nn.Bb+7-(nn.Ab+6)%7)/7);if(2>=(nn.Ab+371-nn.Bb-2)%7&&Cn++,Cn)Cn==53&&((lr=(nn.Ab+371-nn.Bb)%7)==4||lr==3&&or(nn.Cb)||(Cn=1));else{Cn=52;var lr=(nn.Ab+7-nn.Bb-1)%7;(lr==4||lr==5&&or(nn.Cb%400-1))&&Cn++}return tn(Cn,2)},"%w":function(nn){return nn.Ab},"%W":function(nn){return tn(Math.floor((nn.Bb+7-(nn.Ab+6)%7)/7),2)},"%y":function(nn){return(nn.Cb+1900).toString().substring(2)},"%Y":function(nn){return nn.Cb+1900},"%z":function(nn){var Cn=0<=(nn=nn.Yb);return nn=Math.abs(nn)/60,(Cn?"+":"-")+("0000"+(nn/60*100+nn%60)).slice(-4)},"%Z":function(nn){return nn.ac},"%%":function(){return"%"}},Yt=Yt.replace(/%%/g,"\0\0"),Mn)Yt.includes(rr)&&(Yt=Yt.replace(new RegExp(rr,"g"),Mn[rr](Zt)));return rr=(function(nn){var Cn=Array(qt(nn)+1);return Kt(nn,Cn,0,Cn.length),Cn})(Yt=Yt.replace(/\0\0/g,"%")),rr.length>Vt?0:($t.set(rr,Ft>>>0),rr.length-1)}var Vn={a:function(Ft){return wn(Ft+24)+24},m:function(Ft){return(Ft=new On(Ft)).Pb()||(Ft.Ib(!0),sr--),Ft.Jb(!1),Qn.push(Ft),Ft.Nb(),Ft.Qb()},ia:function(Ft){throw Et("Unexpected exception thrown, this is not properly supported - aborting"),Pt=!0,Ft},w:function(){An(0);var Ft=Qn.pop();if(Ft.Xb()&&!Ft.Lb()){var Vt=Ft.Wb();Vt&&mn(Vt)(Ft.Db),kn(Ft.Db)}cr=0},d:function(){var Ft=cr;if(!Ft)return Dn=0;var Vt=new On(Ft);Vt.Fb(Ft);var Yt=Vt.Eb();if(!Yt)return Dn=0,Ft;for(var Zt=Array.prototype.slice.call(arguments),Jt=0;Jt<Zt.length;Jt++){var tn=Zt[Jt];if(tn===0||tn===Yt)break;if(pr(tn,Yt,Vt.zb+16))return Dn=tn,Ft}return Dn=Yt,Ft},k:function(){var Ft=cr;if(!Ft)return Dn=0;var Vt=new On(Ft);Vt.Fb(Ft);var Yt=Vt.Eb();if(!Yt)return Dn=0,Ft;for(var Zt=Array.prototype.slice.call(arguments),Jt=0;Jt<Zt.length;Jt++){var tn=Zt[Jt];if(tn===0||tn===Yt)break;if(pr(tn,Yt,Vt.zb+16))return Dn=tn,Ft}return Dn=Yt,Ft},g:function(){var Ft=cr;if(!Ft)return Dn=0;var Vt=new On(Ft);Vt.Fb(Ft);var Yt=Vt.Eb();if(!Yt)return Dn=0,Ft;for(var Zt=Array.prototype.slice.call(arguments),Jt=0;Jt<Zt.length;Jt++){var tn=Zt[Jt];if(tn===0||tn===Yt)break;if(pr(tn,Yt,Vt.zb+16))return Dn=tn,Ft}return Dn=Yt,Ft},s:kn,L:function(){var Ft=Qn.pop();Ft||Ln("no exception to throw");var Vt=Ft.Db;throw Ft.Lb()||(Qn.push(Ft),Ft.Jb(!0),Ft.Ib(!1),sr++),cr=Vt,Vt},b:function(Ft,Vt,Yt){throw new On(Ft).Rb(Vt,Yt),cr=Ft,sr++,Ft},la:function(){return sr},i:function(Ft){throw cr||(cr=Ft),Ft},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){Ln("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){Ln("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(Ft,Vt){Ft=new Date(1e3*(Rt[Ft>>>2]+4294967296*Nt[Ft+4>>>2])),Nt[Vt>>2>>>0]=Ft.getUTCSeconds(),Nt[Vt+4>>2>>>0]=Ft.getUTCMinutes(),Nt[Vt+8>>2>>>0]=Ft.getUTCHours(),Nt[Vt+12>>2>>>0]=Ft.getUTCDate(),Nt[Vt+16>>2>>>0]=Ft.getUTCMonth(),Nt[Vt+20>>2>>>0]=Ft.getUTCFullYear()-1900,Nt[Vt+24>>2>>>0]=Ft.getUTCDay(),Nt[Vt+28>>2>>>0]=(Ft.getTime()-Date.UTC(Ft.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(Ft,Vt){Ft=new Date(1e3*(Rt[Ft>>>2]+4294967296*Nt[Ft+4>>>2])),Nt[Vt>>2>>>0]=Ft.getSeconds(),Nt[Vt+4>>2>>>0]=Ft.getMinutes(),Nt[Vt+8>>2>>>0]=Ft.getHours(),Nt[Vt+12>>2>>>0]=Ft.getDate(),Nt[Vt+16>>2>>>0]=Ft.getMonth(),Nt[Vt+20>>2>>>0]=Ft.getFullYear()-1900,Nt[Vt+24>>2>>>0]=Ft.getDay();var Yt=new Date(Ft.getFullYear(),0,1);Nt[Vt+28>>2>>>0]=(Ft.getTime()-Yt.getTime())/864e5|0,Nt[Vt+36>>2>>>0]=-60*Ft.getTimezoneOffset();var Zt=new Date(Ft.getFullYear(),6,1).getTimezoneOffset();Yt=Yt.getTimezoneOffset(),Nt[Vt+32>>2>>>0]=0|(Zt!=Yt&&Ft.getTimezoneOffset()==Math.min(Yt,Zt))},Fa:function(Ft){var Vt=new Date(Nt[Ft+20>>2>>>0]+1900,Nt[Ft+16>>2>>>0],Nt[Ft+12>>2>>>0],Nt[Ft+8>>2>>>0],Nt[Ft+4>>2>>>0],Nt[Ft>>2>>>0],0),Yt=Nt[Ft+32>>2>>>0],Zt=Vt.getTimezoneOffset(),Jt=new Date(Vt.getFullYear(),0,1),tn=new Date(Vt.getFullYear(),6,1).getTimezoneOffset(),cn=Jt.getTimezoneOffset(),vn=Math.min(cn,tn);return 0>Yt?Nt[Ft+32>>2>>>0]=+(tn!=cn&&vn==Zt):0<Yt!=(vn==Zt)&&(tn=Math.max(cn,tn),Vt.setTime(Vt.getTime()+6e4*((0<Yt?vn:tn)-Zt))),Nt[Ft+24>>2>>>0]=Vt.getDay(),Nt[Ft+28>>2>>>0]=(Vt.getTime()-Jt.getTime())/864e5|0,Nt[Ft>>2>>>0]=Vt.getSeconds(),Nt[Ft+4>>2>>>0]=Vt.getMinutes(),Nt[Ft+8>>2>>>0]=Vt.getHours(),Nt[Ft+12>>2>>>0]=Vt.getDate(),Nt[Ft+16>>2>>>0]=Vt.getMonth(),Vt.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function Ft(Vt,Yt,Zt){Ft.Vb||(Ft.Vb=!0,(function(Jt,tn,cn){function vn(mr){return(mr=mr.toTimeString().match(/\(([A-Za-z ]+)\)$/))?mr[1]:"GMT"}var fn=new Date().getFullYear(),Mn=new Date(fn,0,1),rr=new Date(fn,6,1);fn=Mn.getTimezoneOffset();var fr=rr.getTimezoneOffset();Nt[Jt>>2>>>0]=60*Math.max(fn,fr),Nt[tn>>2>>>0]=+(fn!=fr),Jt=vn(Mn),tn=vn(rr),Jt=jn(Jt),tn=jn(tn),fr<fn?(Rt[cn>>2>>>0]=Jt,Rt[cn+4>>2>>>0]=tn):(Rt[cn>>2>>>0]=tn,Rt[cn+4>>2>>>0]=Jt)})(Vt,Yt,Zt))},B:function(){Ln("")},ma:function(){return 4294901760},I:mt?()=>{var Ft=process.hrtime();return 1e3*Ft[0]+Ft[1]/1e6}:()=>performance.now(),xa:function(Ft,Vt,Yt){Mt.copyWithin(Ft>>>0,Vt>>>0,Vt+Yt>>>0)},G:function(Ft){var Vt=Mt.length;if(4294901760<(Ft>>>=0))return!1;for(var Yt=1;4>=Yt;Yt*=2){var Zt=Vt*(1+.2/Yt);Zt=Math.min(Zt,Ft+100663296);var Jt=Math;Zt=Math.max(Ft,Zt),Jt=Jt.min.call(Jt,4294901760,Zt+(65536-Zt%65536)%65536);e:{try{St.grow(Jt-Ot.byteLength+65535>>>16),Xt();var tn=1;break e}catch{}tn=void 0}if(tn)return!0}return!1},va:function(Ft,Vt){var Yt=0;return qn().forEach((function(Zt,Jt){var tn=Vt+Yt;for(Jt=Rt[Ft+4*Jt>>2>>>0]=tn,tn=0;tn<Zt.length;++tn)$t[Jt++>>0>>>0]=Zt.charCodeAt(tn);$t[Jt>>0>>>0]=0,Yt+=Zt.length+1})),0},wa:function(Ft,Vt){var Yt=qn();Rt[Ft>>2>>>0]=Yt.length;var Zt=0;return Yt.forEach((function(Jt){Zt+=Jt.length+1})),Rt[Vt>>2>>>0]=Zt,0},ba:function(Ft){wt||0<Tn||(hr(),gr(dn),Jn(0),Pn[1].length&&Rn(1,10),Pn[2].length&&Rn(2,10)),wt||0<Tn||(et.onExit&&et.onExit(Ft),Pt=!0),ht(Ft,new Gn(Ft))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(Ft,Vt,Yt,Zt){for(var Jt=0,tn=0;tn<Yt;tn++){var cn=Rt[Vt>>2>>>0],vn=Rt[Vt+4>>2>>>0];Vt+=8;for(var fn=0;fn<vn;fn++)Rn(Ft,Mt[cn+fn>>>0]);Jt+=vn}return Rt[Zt>>2>>>0]=Jt,0},c:function(){return Dn},ja:function Ft(Vt,Yt){Ft.Mb||(Ft.Mb=(function(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var Jt=new Uint8Array(1);return()=>(crypto.getRandomValues(Jt),Jt[0])}if(mt)try{var tn=Y(Object((function(){var cn=new Error("Cannot find module 'crypto'");throw cn.code="MODULE_NOT_FOUND",cn})()));return()=>tn.randomBytes(1)[0]}catch{}return()=>Ln("randomDevice")})());for(var Zt=0;Zt<Yt;Zt++)$t[Vt+Zt>>0>>>0]=Ft.Mb();return 0},ea:function(Ft,Vt,Yt){var Zt=xn();try{return mn(Ft)(Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},fa:function(Ft,Vt,Yt){var Zt=xn();try{return mn(Ft)(Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},J:function(Ft){var Vt=xn();try{return mn(Ft)()}catch(Yt){if(_n(Vt),Yt!==Yt+0)throw Yt;An(1,0)}},e:function(Ft,Vt){var Yt=xn();try{return mn(Ft)(Vt)}catch(Zt){if(_n(Yt),Zt!==Zt+0)throw Zt;An(1,0)}},N:function(Ft,Vt,Yt){var Zt=xn();try{return mn(Ft)(Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},O:function(Ft,Vt,Yt){var Zt=xn();try{return mn(Ft)(Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},j:function(Ft,Vt,Yt){var Zt=xn();try{return mn(Ft)(Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},o:function(Ft,Vt,Yt,Zt){var Jt=xn();try{return mn(Ft)(Vt,Yt,Zt)}catch(tn){if(_n(Jt),tn!==tn+0)throw tn;An(1,0)}},p:function(Ft,Vt,Yt,Zt,Jt){var tn=xn();try{return mn(Ft)(Vt,Yt,Zt,Jt)}catch(cn){if(_n(tn),cn!==cn+0)throw cn;An(1,0)}},M:function(Ft,Vt,Yt,Zt,Jt,tn){var cn=xn();try{return mn(Ft)(Vt,Yt,Zt,Jt,tn)}catch(vn){if(_n(cn),vn!==vn+0)throw vn;An(1,0)}},r:function(Ft,Vt,Yt,Zt,Jt,tn){var cn=xn();try{return mn(Ft)(Vt,Yt,Zt,Jt,tn)}catch(vn){if(_n(cn),vn!==vn+0)throw vn;An(1,0)}},v:function(Ft,Vt,Yt,Zt,Jt,tn,cn){var vn=xn();try{return mn(Ft)(Vt,Yt,Zt,Jt,tn,cn)}catch(fn){if(_n(vn),fn!==fn+0)throw fn;An(1,0)}},K:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn){var fn=xn();try{return mn(Ft)(Vt,Yt,Zt,Jt,tn,cn,vn)}catch(Mn){if(_n(fn),Mn!==Mn+0)throw Mn;An(1,0)}},D:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr,fr){var mr=xn();try{return mn(Ft)(Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr,fr)}catch(nn){if(_n(mr),nn!==nn+0)throw nn;An(1,0)}},X:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn){var fn=xn();try{return Or(Ft,Vt,Yt,Zt,Jt,tn,cn,vn)}catch(Mn){if(_n(fn),Mn!==Mn+0)throw Mn;An(1,0)}},V:function(Ft,Vt,Yt,Zt,Jt,tn,cn){var vn=xn();try{return Cr(Ft,Vt,Yt,Zt,Jt,tn,cn)}catch(fn){if(_n(vn),fn!==fn+0)throw fn;An(1,0)}},U:function(Ft,Vt,Yt,Zt,Jt){var tn=xn();try{return Fr(Ft,Vt,Yt,Zt,Jt)}catch(cn){if(_n(tn),cn!==cn+0)throw cn;An(1,0)}},Z:function(Ft,Vt,Yt,Zt){var Jt=xn();try{return Lr(Ft,Vt,Yt,Zt)}catch(tn){if(_n(Jt),tn!==tn+0)throw tn;An(1,0)}},W:function(Ft){var Vt=xn();try{return _r(Ft)}catch(Yt){if(_n(Vt),Yt!==Yt+0)throw Yt;An(1,0)}},Y:function(Ft,Vt){var Yt=xn();try{return kr(Ft,Vt)}catch(Zt){if(_n(Yt),Zt!==Zt+0)throw Zt;An(1,0)}},T:function(Ft,Vt,Yt){var Zt=xn();try{return Ar(Ft,Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},f:function(Ft){var Vt=xn();try{mn(Ft)()}catch(Yt){if(_n(Vt),Yt!==Yt+0)throw Yt;An(1,0)}},q:function(Ft,Vt){var Yt=xn();try{mn(Ft)(Vt)}catch(Zt){if(_n(Yt),Zt!==Zt+0)throw Zt;An(1,0)}},h:function(Ft,Vt,Yt){var Zt=xn();try{mn(Ft)(Vt,Yt)}catch(Jt){if(_n(Zt),Jt!==Jt+0)throw Jt;An(1,0)}},da:function(Ft,Vt,Yt,Zt){var Jt=xn();try{mn(Ft)(Vt,Yt,Zt)}catch(tn){if(_n(Jt),tn!==tn+0)throw tn;An(1,0)}},l:function(Ft,Vt,Yt,Zt){var Jt=xn();try{mn(Ft)(Vt,Yt,Zt)}catch(tn){if(_n(Jt),tn!==tn+0)throw tn;An(1,0)}},t:function(Ft,Vt,Yt,Zt,Jt){var tn=xn();try{mn(Ft)(Vt,Yt,Zt,Jt)}catch(cn){if(_n(tn),cn!==cn+0)throw cn;An(1,0)}},u:function(Ft,Vt,Yt,Zt,Jt,tn){var cn=xn();try{mn(Ft)(Vt,Yt,Zt,Jt,tn)}catch(vn){if(_n(cn),vn!==vn+0)throw vn;An(1,0)}},x:function(Ft,Vt,Yt,Zt,Jt,tn,cn){var vn=xn();try{mn(Ft)(Vt,Yt,Zt,Jt,tn,cn)}catch(fn){if(_n(vn),fn!==fn+0)throw fn;An(1,0)}},z:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn){var fn=xn();try{mn(Ft)(Vt,Yt,Zt,Jt,tn,cn,vn)}catch(Mn){if(_n(fn),Mn!==Mn+0)throw Mn;An(1,0)}},ga:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn,fn){var Mn=xn();try{mn(Ft)(Vt,Yt,Zt,Jt,tn,cn,vn,fn)}catch(rr){if(_n(Mn),rr!==rr+0)throw rr;An(1,0)}},A:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr){var fr=xn();try{mn(Ft)(Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr)}catch(mr){if(_n(fr),mr!==mr+0)throw mr;An(1,0)}},C:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr,fr,mr,nn,Cn,lr){var Rr=xn();try{mn(Ft)(Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr,fr,mr,nn,Cn,lr)}catch(Ir){if(_n(Rr),Ir!==Ir+0)throw Ir;An(1,0)}},aa:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn){var fn=xn();try{nr(Ft,Vt,Yt,Zt,Jt,tn,cn,vn)}catch(Mn){if(_n(fn),Mn!==Mn+0)throw Mn;An(1,0)}},_:function(Ft,Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr,fr){var mr=xn();try{vr(Ft,Vt,Yt,Zt,Jt,tn,cn,vn,fn,Mn,rr,fr)}catch(nn){if(_n(mr),nn!==nn+0)throw nn;An(1,0)}},$:function(Ft,Vt,Yt,Zt,Jt,tn){var cn=xn();try{ir(Ft,Vt,Yt,Zt,Jt,tn)}catch(vn){if(_n(cn),vn!==vn+0)throw vn;An(1,0)}},n:function(Ft){return Ft},F:function(Ft){Dn=Ft},ha:dr,y:function(Ft,Vt,Yt,Zt){return dr(Ft,Vt,Yt,Zt)}};(function(){function Ft(Jt){et.asm=Jt.exports,St=et.asm.Ka,Xt(),an=et.asm.ib,ln.unshift(et.asm.La),on--,et.monitorRunDependencies&&et.monitorRunDependencies(on),on==0&&zn&&(Jt=zn,zn=null,Jt())}function Vt(Jt){Ft(Jt.instance)}function Yt(Jt){return(function(){if(!bt&&(pt||ft)){if(typeof fetch=="function"&&!bn.startsWith("file://"))return fetch(bn,{credentials:"same-origin"}).then((function(tn){if(!tn.ok)throw"failed to load wasm binary file at '"+bn+"'";return tn.arrayBuffer()})).catch((function(){return Wn()}));if(ot)return new Promise((function(tn,cn){ot(bn,(function(vn){tn(new Uint8Array(vn))}),cn)}))}return Promise.resolve().then((function(){return Wn()}))})().then((function(tn){return WebAssembly.instantiate(tn,Zt)})).then((function(tn){return tn})).then(Jt,(function(tn){Et("failed to asynchronously prepare wasm: "+tn),Ln(tn)}))}var Zt={a:Vn};if(on++,et.monitorRunDependencies&&et.monitorRunDependencies(on),et.instantiateWasm)try{return et.instantiateWasm(Zt,Ft)}catch(Jt){return Et("Module.instantiateWasm callback failed with error: "+Jt),!1}(bt||typeof WebAssembly.instantiateStreaming!="function"||hn()||bn.startsWith("file://")||mt||typeof fetch!="function"?Yt(Vt):fetch(bn,{credentials:"same-origin"}).then((function(Jt){return WebAssembly.instantiateStreaming(Jt,Zt).then(Vt,(function(tn){return Et("wasm streaming compile failed: "+tn),Et("falling back to ArrayBuffer instantiation"),Yt(Vt)}))}))).catch(it)})(),et.___wasm_call_ctors=function(){return(et.___wasm_call_ctors=et.asm.La).apply(null,arguments)},et._OrtInit=function(){return(et._OrtInit=et.asm.Ma).apply(null,arguments)},et._OrtCreateSessionOptions=function(){return(et._OrtCreateSessionOptions=et.asm.Na).apply(null,arguments)},et._OrtAppendExecutionProvider=function(){return(et._OrtAppendExecutionProvider=et.asm.Oa).apply(null,arguments)},et._OrtAddSessionConfigEntry=function(){return(et._OrtAddSessionConfigEntry=et.asm.Pa).apply(null,arguments)},et._OrtReleaseSessionOptions=function(){return(et._OrtReleaseSessionOptions=et.asm.Qa).apply(null,arguments)},et._OrtCreateSession=function(){return(et._OrtCreateSession=et.asm.Ra).apply(null,arguments)},et._OrtReleaseSession=function(){return(et._OrtReleaseSession=et.asm.Sa).apply(null,arguments)},et._OrtGetInputCount=function(){return(et._OrtGetInputCount=et.asm.Ta).apply(null,arguments)},et._OrtGetOutputCount=function(){return(et._OrtGetOutputCount=et.asm.Ua).apply(null,arguments)},et._OrtGetInputName=function(){return(et._OrtGetInputName=et.asm.Va).apply(null,arguments)},et._OrtGetOutputName=function(){return(et._OrtGetOutputName=et.asm.Wa).apply(null,arguments)},et._OrtFree=function(){return(et._OrtFree=et.asm.Xa).apply(null,arguments)},et._OrtCreateTensor=function(){return(et._OrtCreateTensor=et.asm.Ya).apply(null,arguments)},et._OrtGetTensorData=function(){return(et._OrtGetTensorData=et.asm.Za).apply(null,arguments)},et._OrtReleaseTensor=function(){return(et._OrtReleaseTensor=et.asm._a).apply(null,arguments)},et._OrtCreateRunOptions=function(){return(et._OrtCreateRunOptions=et.asm.$a).apply(null,arguments)},et._OrtAddRunConfigEntry=function(){return(et._OrtAddRunConfigEntry=et.asm.ab).apply(null,arguments)},et._OrtReleaseRunOptions=function(){return(et._OrtReleaseRunOptions=et.asm.bb).apply(null,arguments)},et._OrtRun=function(){return(et._OrtRun=et.asm.cb).apply(null,arguments)},et._OrtEndProfiling=function(){return(et._OrtEndProfiling=et.asm.db).apply(null,arguments)};var Kn,wn=et._malloc=function(){return(wn=et._malloc=et.asm.eb).apply(null,arguments)},ar=et._free=function(){return(ar=et._free=et.asm.fb).apply(null,arguments)},Jn=et._fflush=function(){return(Jn=et._fflush=et.asm.gb).apply(null,arguments)},hr=et.___funcs_on_exit=function(){return(hr=et.___funcs_on_exit=et.asm.hb).apply(null,arguments)},An=et._setThrew=function(){return(An=et._setThrew=et.asm.jb).apply(null,arguments)},xn=et.stackSave=function(){return(xn=et.stackSave=et.asm.kb).apply(null,arguments)},_n=et.stackRestore=function(){return(_n=et.stackRestore=et.asm.lb).apply(null,arguments)},Sr=et.stackAlloc=function(){return(Sr=et.stackAlloc=et.asm.mb).apply(null,arguments)},pr=et.___cxa_can_catch=function(){return(pr=et.___cxa_can_catch=et.asm.nb).apply(null,arguments)},wr=et.___cxa_is_pointer_type=function(){return(wr=et.___cxa_is_pointer_type=et.asm.ob).apply(null,arguments)},_r=et.dynCall_j=function(){return(_r=et.dynCall_j=et.asm.pb).apply(null,arguments)},Cr=et.dynCall_iiiiij=function(){return(Cr=et.dynCall_iiiiij=et.asm.qb).apply(null,arguments)},Ar=et.dynCall_jii=function(){return(Ar=et.dynCall_jii=et.asm.rb).apply(null,arguments)},nr=et.dynCall_viiiiij=function(){return(nr=et.dynCall_viiiiij=et.asm.sb).apply(null,arguments)},ir=et.dynCall_vjji=function(){return(ir=et.dynCall_vjji=et.asm.tb).apply(null,arguments)},vr=et.dynCall_viiijjjii=function(){return(vr=et.dynCall_viiijjjii=et.asm.ub).apply(null,arguments)},Lr=et.dynCall_iij=function(){return(Lr=et.dynCall_iij=et.asm.vb).apply(null,arguments)},kr=et.dynCall_ji=function(){return(kr=et.dynCall_ji=et.asm.wb).apply(null,arguments)},Or=et.dynCall_iiiiiij=function(){return(Or=et.dynCall_iiiiiij=et.asm.xb).apply(null,arguments)},Fr=et.dynCall_iiij=function(){return(Fr=et.dynCall_iiij=et.asm.yb).apply(null,arguments)};function $r(){function Ft(){if(!Kn&&(Kn=!0,et.calledRun=!0,!Pt)){if(gr(ln),tt(et),et.onRuntimeInitialized&&et.onRuntimeInitialized(),et.postRun)for(typeof et.postRun=="function"&&(et.postRun=[et.postRun]);et.postRun.length;){var Vt=et.postRun.shift();un.unshift(Vt)}gr(un)}}if(!(0<on)){if(et.preRun)for(typeof et.preRun=="function"&&(et.preRun=[et.preRun]);et.preRun.length;)Sn();gr(pn),0<on||(et.setStatus?(et.setStatus("Running..."),setTimeout((function(){setTimeout((function(){et.setStatus("")}),1),Ft()}),1)):Ft())}}if(et.UTF8ToString=zt,et.stringToUTF8=function(Ft,Vt,Yt){return Kt(Ft,Mt,Vt,Yt)},et.lengthBytesUTF8=qt,et.stackSave=xn,et.stackRestore=_n,et.stackAlloc=Sr,zn=function Ft(){Kn||$r(),Kn||(zn=Ft)},et.preInit)for(typeof et.preInit=="function"&&(et.preInit=[et.preInit]);0<et.preInit.length;)et.preInit.pop()();return $r(),xe.ready});ee.exports=ne},4537:ee=>{ee.exports=function(O,Y){for(var te=new Array(arguments.length-1),ne=0,xe=2,et=!0;xe<arguments.length;)te[ne++]=arguments[xe++];return new Promise((function(tt,it){te[ne]=function(st){if(et)if(et=!1,st)it(st);else{for(var ot=new Array(arguments.length-1),rt=0;rt<ot.length;)ot[rt++]=arguments[rt];tt.apply(null,ot)}};try{O.apply(Y||null,te)}catch(st){et&&(et=!1,it(st))}}))}},7419:(ee,O)=>{var Y=O;Y.length=function(tt){var it=tt.length;if(!it)return 0;for(var st=0;--it%4>1&&tt.charAt(it)==="=";)++st;return Math.ceil(3*tt.length)/4-st};for(var te=new Array(64),ne=new Array(123),xe=0;xe<64;)ne[te[xe]=xe<26?xe+65:xe<52?xe+71:xe<62?xe-4:xe-59|43]=xe++;Y.encode=function(tt,it,st){for(var ot,rt=null,nt=[],at=0,ct=0;it<st;){var ut=tt[it++];switch(ct){case 0:nt[at++]=te[ut>>2],ot=(3&ut)<<4,ct=1;break;case 1:nt[at++]=te[ot|ut>>4],ot=(15&ut)<<2,ct=2;break;case 2:nt[at++]=te[ot|ut>>6],nt[at++]=te[63&ut],ct=0}at>8191&&((rt||(rt=[])).push(String.fromCharCode.apply(String,nt)),at=0)}return ct&&(nt[at++]=te[ot],nt[at++]=61,ct===1&&(nt[at++]=61)),rt?(at&&rt.push(String.fromCharCode.apply(String,nt.slice(0,at))),rt.join("")):String.fromCharCode.apply(String,nt.slice(0,at))};var et="invalid encoding";Y.decode=function(tt,it,st){for(var ot,rt=st,nt=0,at=0;at<tt.length;){var ct=tt.charCodeAt(at++);if(ct===61&&nt>1)break;if((ct=ne[ct])===void 0)throw Error(et);switch(nt){case 0:ot=ct,nt=1;break;case 1:it[st++]=ot<<2|(48&ct)>>4,ot=ct,nt=2;break;case 2:it[st++]=(15&ot)<<4|(60&ct)>>2,ot=ct,nt=3;break;case 3:it[st++]=(3&ot)<<6|ct,nt=0}}if(nt===1)throw Error(et);return st-rt},Y.test=function(tt){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(tt)}},9211:ee=>{function O(){this._listeners={}}ee.exports=O,O.prototype.on=function(Y,te,ne){return(this._listeners[Y]||(this._listeners[Y]=[])).push({fn:te,ctx:ne||this}),this},O.prototype.off=function(Y,te){if(Y===void 0)this._listeners={};else if(te===void 0)this._listeners[Y]=[];else for(var ne=this._listeners[Y],xe=0;xe<ne.length;)ne[xe].fn===te?ne.splice(xe,1):++xe;return this},O.prototype.emit=function(Y){var te=this._listeners[Y];if(te){for(var ne=[],xe=1;xe<arguments.length;)ne.push(arguments[xe++]);for(xe=0;xe<te.length;)te[xe].fn.apply(te[xe++].ctx,ne)}return this}},945:ee=>{function O(et){return typeof Float32Array<"u"?(function(){var tt=new Float32Array([-0]),it=new Uint8Array(tt.buffer),st=it[3]===128;function ot(ct,ut,dt){tt[0]=ct,ut[dt]=it[0],ut[dt+1]=it[1],ut[dt+2]=it[2],ut[dt+3]=it[3]}function rt(ct,ut,dt){tt[0]=ct,ut[dt]=it[3],ut[dt+1]=it[2],ut[dt+2]=it[1],ut[dt+3]=it[0]}function nt(ct,ut){return it[0]=ct[ut],it[1]=ct[ut+1],it[2]=ct[ut+2],it[3]=ct[ut+3],tt[0]}function at(ct,ut){return it[3]=ct[ut],it[2]=ct[ut+1],it[1]=ct[ut+2],it[0]=ct[ut+3],tt[0]}et.writeFloatLE=st?ot:rt,et.writeFloatBE=st?rt:ot,et.readFloatLE=st?nt:at,et.readFloatBE=st?at:nt})():(function(){function tt(st,ot,rt,nt){var at=ot<0?1:0;if(at&&(ot=-ot),ot===0)st(1/ot>0?0:2147483648,rt,nt);else if(isNaN(ot))st(2143289344,rt,nt);else if(ot>34028234663852886e22)st((at<<31|2139095040)>>>0,rt,nt);else if(ot<11754943508222875e-54)st((at<<31|Math.round(ot/1401298464324817e-60))>>>0,rt,nt);else{var ct=Math.floor(Math.log(ot)/Math.LN2);st((at<<31|ct+127<<23|8388607&Math.round(ot*Math.pow(2,-ct)*8388608))>>>0,rt,nt)}}function it(st,ot,rt){var nt=st(ot,rt),at=2*(nt>>31)+1,ct=nt>>>23&255,ut=8388607&nt;return ct===255?ut?NaN:at*(1/0):ct===0?1401298464324817e-60*at*ut:at*Math.pow(2,ct-150)*(ut+8388608)}et.writeFloatLE=tt.bind(null,Y),et.writeFloatBE=tt.bind(null,te),et.readFloatLE=it.bind(null,ne),et.readFloatBE=it.bind(null,xe)})(),typeof Float64Array<"u"?(function(){var tt=new Float64Array([-0]),it=new Uint8Array(tt.buffer),st=it[7]===128;function ot(ct,ut,dt){tt[0]=ct,ut[dt]=it[0],ut[dt+1]=it[1],ut[dt+2]=it[2],ut[dt+3]=it[3],ut[dt+4]=it[4],ut[dt+5]=it[5],ut[dt+6]=it[6],ut[dt+7]=it[7]}function rt(ct,ut,dt){tt[0]=ct,ut[dt]=it[7],ut[dt+1]=it[6],ut[dt+2]=it[5],ut[dt+3]=it[4],ut[dt+4]=it[3],ut[dt+5]=it[2],ut[dt+6]=it[1],ut[dt+7]=it[0]}function nt(ct,ut){return it[0]=ct[ut],it[1]=ct[ut+1],it[2]=ct[ut+2],it[3]=ct[ut+3],it[4]=ct[ut+4],it[5]=ct[ut+5],it[6]=ct[ut+6],it[7]=ct[ut+7],tt[0]}function at(ct,ut){return it[7]=ct[ut],it[6]=ct[ut+1],it[5]=ct[ut+2],it[4]=ct[ut+3],it[3]=ct[ut+4],it[2]=ct[ut+5],it[1]=ct[ut+6],it[0]=ct[ut+7],tt[0]}et.writeDoubleLE=st?ot:rt,et.writeDoubleBE=st?rt:ot,et.readDoubleLE=st?nt:at,et.readDoubleBE=st?at:nt})():(function(){function tt(st,ot,rt,nt,at,ct){var ut=nt<0?1:0;if(ut&&(nt=-nt),nt===0)st(0,at,ct+ot),st(1/nt>0?0:2147483648,at,ct+rt);else if(isNaN(nt))st(0,at,ct+ot),st(2146959360,at,ct+rt);else if(nt>17976931348623157e292)st(0,at,ct+ot),st((ut<<31|2146435072)>>>0,at,ct+rt);else{var dt;if(nt<22250738585072014e-324)st((dt=nt/5e-324)>>>0,at,ct+ot),st((ut<<31|dt/4294967296)>>>0,at,ct+rt);else{var ht=Math.floor(Math.log(nt)/Math.LN2);ht===1024&&(ht=1023),st(4503599627370496*(dt=nt*Math.pow(2,-ht))>>>0,at,ct+ot),st((ut<<31|ht+1023<<20|1048576*dt&1048575)>>>0,at,ct+rt)}}}function it(st,ot,rt,nt,at){var ct=st(nt,at+ot),ut=st(nt,at+rt),dt=2*(ut>>31)+1,ht=ut>>>20&2047,pt=4294967296*(1048575&ut)+ct;return ht===2047?pt?NaN:dt*(1/0):ht===0?5e-324*dt*pt:dt*Math.pow(2,ht-1075)*(pt+4503599627370496)}et.writeDoubleLE=tt.bind(null,Y,0,4),et.writeDoubleBE=tt.bind(null,te,4,0),et.readDoubleLE=it.bind(null,ne,0,4),et.readDoubleBE=it.bind(null,xe,4,0)})(),et}function Y(et,tt,it){tt[it]=255&et,tt[it+1]=et>>>8&255,tt[it+2]=et>>>16&255,tt[it+3]=et>>>24}function te(et,tt,it){tt[it]=et>>>24,tt[it+1]=et>>>16&255,tt[it+2]=et>>>8&255,tt[it+3]=255&et}function ne(et,tt){return(et[tt]|et[tt+1]<<8|et[tt+2]<<16|et[tt+3]<<24)>>>0}function xe(et,tt){return(et[tt]<<24|et[tt+1]<<16|et[tt+2]<<8|et[tt+3])>>>0}ee.exports=O(O)},7199:module=>{function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(ee){}return null}module.exports=inquire},6662:ee=>{ee.exports=function(O,Y,te){var ne=te||8192,xe=ne>>>1,et=null,tt=ne;return function(it){if(it<1||it>xe)return O(it);tt+it>ne&&(et=O(ne),tt=0);var st=Y.call(et,tt,tt+=it);return 7&tt&&(tt=1+(7|tt)),st}}},4997:(ee,O)=>{var Y=O;Y.length=function(te){for(var ne=0,xe=0,et=0;et<te.length;++et)(xe=te.charCodeAt(et))<128?ne+=1:xe<2048?ne+=2:(64512&xe)==55296&&(64512&te.charCodeAt(et+1))==56320?(++et,ne+=4):ne+=3;return ne},Y.read=function(te,ne,xe){if(xe-ne<1)return"";for(var et,tt=null,it=[],st=0;ne<xe;)(et=te[ne++])<128?it[st++]=et:et>191&&et<224?it[st++]=(31&et)<<6|63&te[ne++]:et>239&&et<365?(et=((7&et)<<18|(63&te[ne++])<<12|(63&te[ne++])<<6|63&te[ne++])-65536,it[st++]=55296+(et>>10),it[st++]=56320+(1023&et)):it[st++]=(15&et)<<12|(63&te[ne++])<<6|63&te[ne++],st>8191&&((tt||(tt=[])).push(String.fromCharCode.apply(String,it)),st=0);return tt?(st&&tt.push(String.fromCharCode.apply(String,it.slice(0,st))),tt.join("")):String.fromCharCode.apply(String,it.slice(0,st))},Y.write=function(te,ne,xe){for(var et,tt,it=xe,st=0;st<te.length;++st)(et=te.charCodeAt(st))<128?ne[xe++]=et:et<2048?(ne[xe++]=et>>6|192,ne[xe++]=63&et|128):(64512&et)==55296&&(64512&(tt=te.charCodeAt(st+1)))==56320?(et=65536+((1023&et)<<10)+(1023&tt),++st,ne[xe++]=et>>18|240,ne[xe++]=et>>12&63|128,ne[xe++]=et>>6&63|128,ne[xe++]=63&et|128):(ne[xe++]=et>>12|224,ne[xe++]=et>>6&63|128,ne[xe++]=63&et|128);return xe-it}},3442:(ee,O)=>{O.__esModule=!0;var Y=(function(){function te(ne){if(!ne)throw new TypeError("Invalid argument; `value` has no value.");this.value=te.EMPTY,ne&&te.isGuid(ne)&&(this.value=ne)}return te.isGuid=function(ne){var xe=ne.toString();return ne&&(ne instanceof te||te.validator.test(xe))},te.create=function(){return new te([te.gen(2),te.gen(1),te.gen(1),te.gen(1),te.gen(3)].join("-"))},te.createEmpty=function(){return new te("emptyguid")},te.parse=function(ne){return new te(ne)},te.raw=function(){return[te.gen(2),te.gen(1),te.gen(1),te.gen(1),te.gen(3)].join("-")},te.gen=function(ne){for(var xe="",et=0;et<ne;et++)xe+=(65536*(1+Math.random())|0).toString(16).substring(1);return xe},te.prototype.equals=function(ne){return te.isGuid(ne)&&this.value===ne.toString()},te.prototype.isEmpty=function(){return this.value===te.EMPTY},te.prototype.toString=function(){return this.value},te.prototype.toJSON=function(){return{value:this.value}},te.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),te.EMPTY="00000000-0000-0000-0000-000000000000",te})();O.Guid=Y},3720:ee=>{ee.exports=Y;var O=null;try{O=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Y(wt,St,Ot){this.low=0|wt,this.high=0|St,this.unsigned=!!Ot}function te(wt){return(wt&&wt.__isLong__)===!0}Y.prototype.__isLong__,Object.defineProperty(Y.prototype,"__isLong__",{value:!0}),Y.isLong=te;var ne={},xe={};function et(wt,St){var Ot,$t,Mt;return St?(Mt=0<=(wt>>>=0)&&wt<256)&&($t=xe[wt])?$t:(Ot=it(wt,(0|wt)<0?-1:0,!0),Mt&&(xe[wt]=Ot),Ot):(Mt=-128<=(wt|=0)&&wt<128)&&($t=ne[wt])?$t:(Ot=it(wt,wt<0?-1:0,!1),Mt&&(ne[wt]=Ot),Ot)}function tt(wt,St){if(isNaN(wt))return St?ht:dt;if(St){if(wt<0)return ht;if(wt>=at)return bt}else{if(wt<=-ct)return vt;if(wt+1>=ct)return yt}return wt<0?tt(-wt,St).neg():it(wt%nt|0,wt/nt|0,St)}function it(wt,St,Ot){return new Y(wt,St,Ot)}Y.fromInt=et,Y.fromNumber=tt,Y.fromBits=it;var st=Math.pow;function ot(wt,St,Ot){if(wt.length===0)throw Error("empty string");if(wt==="NaN"||wt==="Infinity"||wt==="+Infinity"||wt==="-Infinity")return dt;if(typeof St=="number"?(Ot=St,St=!1):St=!!St,(Ot=Ot||10)<2||36<Ot)throw RangeError("radix");var $t;if(($t=wt.indexOf("-"))>0)throw Error("interior hyphen");if($t===0)return ot(wt.substring(1),St,Ot).neg();for(var Mt=tt(st(Ot,8)),Nt=dt,Rt=0;Rt<wt.length;Rt+=8){var Pt=Math.min(8,wt.length-Rt),kt=parseInt(wt.substring(Rt,Rt+Pt),Ot);if(Pt<8){var Wt=tt(st(Ot,Pt));Nt=Nt.mul(Wt).add(tt(kt))}else Nt=(Nt=Nt.mul(Mt)).add(tt(kt))}return Nt.unsigned=St,Nt}function rt(wt,St){return typeof wt=="number"?tt(wt,St):typeof wt=="string"?ot(wt,St):it(wt.low,wt.high,typeof St=="boolean"?St:wt.unsigned)}Y.fromString=ot,Y.fromValue=rt;var nt=4294967296,at=nt*nt,ct=at/2,ut=et(1<<24),dt=et(0);Y.ZERO=dt;var ht=et(0,!0);Y.UZERO=ht;var pt=et(1);Y.ONE=pt;var ft=et(1,!0);Y.UONE=ft;var mt=et(-1);Y.NEG_ONE=mt;var yt=it(-1,2147483647,!1);Y.MAX_VALUE=yt;var bt=it(-1,-1,!0);Y.MAX_UNSIGNED_VALUE=bt;var vt=it(0,-2147483648,!1);Y.MIN_VALUE=vt;var Et=Y.prototype;Et.toInt=function(){return this.unsigned?this.low>>>0:this.low},Et.toNumber=function(){return this.unsigned?(this.high>>>0)*nt+(this.low>>>0):this.high*nt+(this.low>>>0)},Et.toString=function(wt){if((wt=wt||10)<2||36<wt)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(vt)){var St=tt(wt),Ot=this.div(St),$t=Ot.mul(St).sub(this);return Ot.toString(wt)+$t.toInt().toString(wt)}return"-"+this.neg().toString(wt)}for(var Mt=tt(st(wt,6),this.unsigned),Nt=this,Rt="";;){var Pt=Nt.div(Mt),kt=(Nt.sub(Pt.mul(Mt)).toInt()>>>0).toString(wt);if((Nt=Pt).isZero())return kt+Rt;for(;kt.length<6;)kt="0"+kt;Rt=""+kt+Rt}},Et.getHighBits=function(){return this.high},Et.getHighBitsUnsigned=function(){return this.high>>>0},Et.getLowBits=function(){return this.low},Et.getLowBitsUnsigned=function(){return this.low>>>0},Et.getNumBitsAbs=function(){if(this.isNegative())return this.eq(vt)?64:this.neg().getNumBitsAbs();for(var wt=this.high!=0?this.high:this.low,St=31;St>0&&(wt&1<<St)==0;St--);return this.high!=0?St+33:St+1},Et.isZero=function(){return this.high===0&&this.low===0},Et.eqz=Et.isZero,Et.isNegative=function(){return!this.unsigned&&this.high<0},Et.isPositive=function(){return this.unsigned||this.high>=0},Et.isOdd=function(){return(1&this.low)==1},Et.isEven=function(){return(1&this.low)==0},Et.equals=function(wt){return te(wt)||(wt=rt(wt)),(this.unsigned===wt.unsigned||this.high>>>31!=1||wt.high>>>31!=1)&&this.high===wt.high&&this.low===wt.low},Et.eq=Et.equals,Et.notEquals=function(wt){return!this.eq(wt)},Et.neq=Et.notEquals,Et.ne=Et.notEquals,Et.lessThan=function(wt){return this.comp(wt)<0},Et.lt=Et.lessThan,Et.lessThanOrEqual=function(wt){return this.comp(wt)<=0},Et.lte=Et.lessThanOrEqual,Et.le=Et.lessThanOrEqual,Et.greaterThan=function(wt){return this.comp(wt)>0},Et.gt=Et.greaterThan,Et.greaterThanOrEqual=function(wt){return this.comp(wt)>=0},Et.gte=Et.greaterThanOrEqual,Et.ge=Et.greaterThanOrEqual,Et.compare=function(wt){if(te(wt)||(wt=rt(wt)),this.eq(wt))return 0;var St=this.isNegative(),Ot=wt.isNegative();return St&&!Ot?-1:!St&&Ot?1:this.unsigned?wt.high>>>0>this.high>>>0||wt.high===this.high&&wt.low>>>0>this.low>>>0?-1:1:this.sub(wt).isNegative()?-1:1},Et.comp=Et.compare,Et.negate=function(){return!this.unsigned&&this.eq(vt)?vt:this.not().add(pt)},Et.neg=Et.negate,Et.add=function(wt){te(wt)||(wt=rt(wt));var St=this.high>>>16,Ot=65535&this.high,$t=this.low>>>16,Mt=65535&this.low,Nt=wt.high>>>16,Rt=65535&wt.high,Pt=wt.low>>>16,kt=0,Wt=0,zt=0,Kt=0;return zt+=(Kt+=Mt+(65535&wt.low))>>>16,Wt+=(zt+=$t+Pt)>>>16,kt+=(Wt+=Ot+Rt)>>>16,kt+=St+Nt,it((zt&=65535)<<16|(Kt&=65535),(kt&=65535)<<16|(Wt&=65535),this.unsigned)},Et.subtract=function(wt){return te(wt)||(wt=rt(wt)),this.add(wt.neg())},Et.sub=Et.subtract,Et.multiply=function(wt){if(this.isZero())return dt;if(te(wt)||(wt=rt(wt)),O)return it(O.mul(this.low,this.high,wt.low,wt.high),O.get_high(),this.unsigned);if(wt.isZero())return dt;if(this.eq(vt))return wt.isOdd()?vt:dt;if(wt.eq(vt))return this.isOdd()?vt:dt;if(this.isNegative())return wt.isNegative()?this.neg().mul(wt.neg()):this.neg().mul(wt).neg();if(wt.isNegative())return this.mul(wt.neg()).neg();if(this.lt(ut)&&wt.lt(ut))return tt(this.toNumber()*wt.toNumber(),this.unsigned);var St=this.high>>>16,Ot=65535&this.high,$t=this.low>>>16,Mt=65535&this.low,Nt=wt.high>>>16,Rt=65535&wt.high,Pt=wt.low>>>16,kt=65535&wt.low,Wt=0,zt=0,Kt=0,qt=0;return Kt+=(qt+=Mt*kt)>>>16,zt+=(Kt+=$t*kt)>>>16,Kt&=65535,zt+=(Kt+=Mt*Pt)>>>16,Wt+=(zt+=Ot*kt)>>>16,zt&=65535,Wt+=(zt+=$t*Pt)>>>16,zt&=65535,Wt+=(zt+=Mt*Rt)>>>16,Wt+=St*kt+Ot*Pt+$t*Rt+Mt*Nt,it((Kt&=65535)<<16|(qt&=65535),(Wt&=65535)<<16|(zt&=65535),this.unsigned)},Et.mul=Et.multiply,Et.divide=function(wt){if(te(wt)||(wt=rt(wt)),wt.isZero())throw Error("division by zero");var St,Ot,$t;if(O)return this.unsigned||this.high!==-2147483648||wt.low!==-1||wt.high!==-1?it((this.unsigned?O.div_u:O.div_s)(this.low,this.high,wt.low,wt.high),O.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?ht:dt;if(this.unsigned){if(wt.unsigned||(wt=wt.toUnsigned()),wt.gt(this))return ht;if(wt.gt(this.shru(1)))return ft;$t=ht}else{if(this.eq(vt))return wt.eq(pt)||wt.eq(mt)?vt:wt.eq(vt)?pt:(St=this.shr(1).div(wt).shl(1)).eq(dt)?wt.isNegative()?pt:mt:(Ot=this.sub(wt.mul(St)),$t=St.add(Ot.div(wt)));if(wt.eq(vt))return this.unsigned?ht:dt;if(this.isNegative())return wt.isNegative()?this.neg().div(wt.neg()):this.neg().div(wt).neg();if(wt.isNegative())return this.div(wt.neg()).neg();$t=dt}for(Ot=this;Ot.gte(wt);){St=Math.max(1,Math.floor(Ot.toNumber()/wt.toNumber()));for(var Mt=Math.ceil(Math.log(St)/Math.LN2),Nt=Mt<=48?1:st(2,Mt-48),Rt=tt(St),Pt=Rt.mul(wt);Pt.isNegative()||Pt.gt(Ot);)Pt=(Rt=tt(St-=Nt,this.unsigned)).mul(wt);Rt.isZero()&&(Rt=pt),$t=$t.add(Rt),Ot=Ot.sub(Pt)}return $t},Et.div=Et.divide,Et.modulo=function(wt){return te(wt)||(wt=rt(wt)),O?it((this.unsigned?O.rem_u:O.rem_s)(this.low,this.high,wt.low,wt.high),O.get_high(),this.unsigned):this.sub(this.div(wt).mul(wt))},Et.mod=Et.modulo,Et.rem=Et.modulo,Et.not=function(){return it(~this.low,~this.high,this.unsigned)},Et.and=function(wt){return te(wt)||(wt=rt(wt)),it(this.low&wt.low,this.high&wt.high,this.unsigned)},Et.or=function(wt){return te(wt)||(wt=rt(wt)),it(this.low|wt.low,this.high|wt.high,this.unsigned)},Et.xor=function(wt){return te(wt)||(wt=rt(wt)),it(this.low^wt.low,this.high^wt.high,this.unsigned)},Et.shiftLeft=function(wt){return te(wt)&&(wt=wt.toInt()),(wt&=63)==0?this:wt<32?it(this.low<<wt,this.high<<wt|this.low>>>32-wt,this.unsigned):it(0,this.low<<wt-32,this.unsigned)},Et.shl=Et.shiftLeft,Et.shiftRight=function(wt){return te(wt)&&(wt=wt.toInt()),(wt&=63)==0?this:wt<32?it(this.low>>>wt|this.high<<32-wt,this.high>>wt,this.unsigned):it(this.high>>wt-32,this.high>=0?0:-1,this.unsigned)},Et.shr=Et.shiftRight,Et.shiftRightUnsigned=function(wt){if(te(wt)&&(wt=wt.toInt()),(wt&=63)==0)return this;var St=this.high;return wt<32?it(this.low>>>wt|St<<32-wt,St>>>wt,this.unsigned):it(wt===32?St:St>>>wt-32,0,this.unsigned)},Et.shru=Et.shiftRightUnsigned,Et.shr_u=Et.shiftRightUnsigned,Et.toSigned=function(){return this.unsigned?it(this.low,this.high,!1):this},Et.toUnsigned=function(){return this.unsigned?this:it(this.low,this.high,!0)},Et.toBytes=function(wt){return wt?this.toBytesLE():this.toBytesBE()},Et.toBytesLE=function(){var wt=this.high,St=this.low;return[255&St,St>>>8&255,St>>>16&255,St>>>24,255&wt,wt>>>8&255,wt>>>16&255,wt>>>24]},Et.toBytesBE=function(){var wt=this.high,St=this.low;return[wt>>>24,wt>>>16&255,wt>>>8&255,255&wt,St>>>24,St>>>16&255,St>>>8&255,255&St]},Y.fromBytes=function(wt,St,Ot){return Ot?Y.fromBytesLE(wt,St):Y.fromBytesBE(wt,St)},Y.fromBytesLE=function(wt,St){return new Y(wt[0]|wt[1]<<8|wt[2]<<16|wt[3]<<24,wt[4]|wt[5]<<8|wt[6]<<16|wt[7]<<24,St)},Y.fromBytesBE=function(wt,St){return new Y(wt[4]<<24|wt[5]<<16|wt[6]<<8|wt[7],wt[0]<<24|wt[1]<<16|wt[2]<<8|wt[3],St)}},1446:(ee,O,Y)=>{var te,ne,xe,et=Y(2100),tt=et.Reader,it=et.Writer,st=et.util,ot=et.roots.default||(et.roots.default={});ot.onnx=((xe={}).Version=(te={},(ne=Object.create(te))[te[0]="_START_VERSION"]=0,ne[te[1]="IR_VERSION_2017_10_10"]=1,ne[te[2]="IR_VERSION_2017_10_30"]=2,ne[te[3]="IR_VERSION_2017_11_3"]=3,ne[te[4]="IR_VERSION_2019_1_22"]=4,ne[te[5]="IR_VERSION"]=5,ne),xe.AttributeProto=(function(){function rt(nt){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.name="",rt.prototype.refAttrName="",rt.prototype.docString="",rt.prototype.type=0,rt.prototype.f=0,rt.prototype.i=st.Long?st.Long.fromBits(0,0,!1):0,rt.prototype.s=st.newBuffer([]),rt.prototype.t=null,rt.prototype.g=null,rt.prototype.floats=st.emptyArray,rt.prototype.ints=st.emptyArray,rt.prototype.strings=st.emptyArray,rt.prototype.tensors=st.emptyArray,rt.prototype.graphs=st.emptyArray,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.name!=null&&nt.hasOwnProperty("name")&&at.uint32(10).string(nt.name),nt.f!=null&&nt.hasOwnProperty("f")&&at.uint32(21).float(nt.f),nt.i!=null&&nt.hasOwnProperty("i")&&at.uint32(24).int64(nt.i),nt.s!=null&&nt.hasOwnProperty("s")&&at.uint32(34).bytes(nt.s),nt.t!=null&&nt.hasOwnProperty("t")&&ot.onnx.TensorProto.encode(nt.t,at.uint32(42).fork()).ldelim(),nt.g!=null&&nt.hasOwnProperty("g")&&ot.onnx.GraphProto.encode(nt.g,at.uint32(50).fork()).ldelim(),nt.floats!=null&&nt.floats.length){at.uint32(58).fork();for(var ct=0;ct<nt.floats.length;++ct)at.float(nt.floats[ct]);at.ldelim()}if(nt.ints!=null&&nt.ints.length){for(at.uint32(66).fork(),ct=0;ct<nt.ints.length;++ct)at.int64(nt.ints[ct]);at.ldelim()}if(nt.strings!=null&&nt.strings.length)for(ct=0;ct<nt.strings.length;++ct)at.uint32(74).bytes(nt.strings[ct]);if(nt.tensors!=null&&nt.tensors.length)for(ct=0;ct<nt.tensors.length;++ct)ot.onnx.TensorProto.encode(nt.tensors[ct],at.uint32(82).fork()).ldelim();if(nt.graphs!=null&&nt.graphs.length)for(ct=0;ct<nt.graphs.length;++ct)ot.onnx.GraphProto.encode(nt.graphs[ct],at.uint32(90).fork()).ldelim();return nt.docString!=null&&nt.hasOwnProperty("docString")&&at.uint32(106).string(nt.docString),nt.type!=null&&nt.hasOwnProperty("type")&&at.uint32(160).int32(nt.type),nt.refAttrName!=null&&nt.hasOwnProperty("refAttrName")&&at.uint32(170).string(nt.refAttrName),at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.AttributeProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.name=nt.string();break;case 21:ut.refAttrName=nt.string();break;case 13:ut.docString=nt.string();break;case 20:ut.type=nt.int32();break;case 2:ut.f=nt.float();break;case 3:ut.i=nt.int64();break;case 4:ut.s=nt.bytes();break;case 5:ut.t=ot.onnx.TensorProto.decode(nt,nt.uint32());break;case 6:ut.g=ot.onnx.GraphProto.decode(nt,nt.uint32());break;case 7:if(ut.floats&&ut.floats.length||(ut.floats=[]),(7&dt)==2)for(var ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.floats.push(nt.float());else ut.floats.push(nt.float());break;case 8:if(ut.ints&&ut.ints.length||(ut.ints=[]),(7&dt)==2)for(ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.ints.push(nt.int64());else ut.ints.push(nt.int64());break;case 9:ut.strings&&ut.strings.length||(ut.strings=[]),ut.strings.push(nt.bytes());break;case 10:ut.tensors&&ut.tensors.length||(ut.tensors=[]),ut.tensors.push(ot.onnx.TensorProto.decode(nt,nt.uint32()));break;case 11:ut.graphs&&ut.graphs.length||(ut.graphs=[]),ut.graphs.push(ot.onnx.GraphProto.decode(nt,nt.uint32()));break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.name!=null&&nt.hasOwnProperty("name")&&!st.isString(nt.name))return"name: string expected";if(nt.refAttrName!=null&&nt.hasOwnProperty("refAttrName")&&!st.isString(nt.refAttrName))return"refAttrName: string expected";if(nt.docString!=null&&nt.hasOwnProperty("docString")&&!st.isString(nt.docString))return"docString: string expected";if(nt.type!=null&&nt.hasOwnProperty("type"))switch(nt.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}if(nt.f!=null&&nt.hasOwnProperty("f")&&typeof nt.f!="number")return"f: number expected";if(nt.i!=null&&nt.hasOwnProperty("i")&&!(st.isInteger(nt.i)||nt.i&&st.isInteger(nt.i.low)&&st.isInteger(nt.i.high)))return"i: integer|Long expected";if(nt.s!=null&&nt.hasOwnProperty("s")&&!(nt.s&&typeof nt.s.length=="number"||st.isString(nt.s)))return"s: buffer expected";if(nt.t!=null&&nt.hasOwnProperty("t")&&(ct=ot.onnx.TensorProto.verify(nt.t)))return"t."+ct;if(nt.g!=null&&nt.hasOwnProperty("g")&&(ct=ot.onnx.GraphProto.verify(nt.g)))return"g."+ct;if(nt.floats!=null&&nt.hasOwnProperty("floats")){if(!Array.isArray(nt.floats))return"floats: array expected";for(var at=0;at<nt.floats.length;++at)if(typeof nt.floats[at]!="number")return"floats: number[] expected"}if(nt.ints!=null&&nt.hasOwnProperty("ints")){if(!Array.isArray(nt.ints))return"ints: array expected";for(at=0;at<nt.ints.length;++at)if(!(st.isInteger(nt.ints[at])||nt.ints[at]&&st.isInteger(nt.ints[at].low)&&st.isInteger(nt.ints[at].high)))return"ints: integer|Long[] expected"}if(nt.strings!=null&&nt.hasOwnProperty("strings")){if(!Array.isArray(nt.strings))return"strings: array expected";for(at=0;at<nt.strings.length;++at)if(!(nt.strings[at]&&typeof nt.strings[at].length=="number"||st.isString(nt.strings[at])))return"strings: buffer[] expected"}if(nt.tensors!=null&&nt.hasOwnProperty("tensors")){if(!Array.isArray(nt.tensors))return"tensors: array expected";for(at=0;at<nt.tensors.length;++at)if(ct=ot.onnx.TensorProto.verify(nt.tensors[at]))return"tensors."+ct}if(nt.graphs!=null&&nt.hasOwnProperty("graphs")){if(!Array.isArray(nt.graphs))return"graphs: array expected";for(at=0;at<nt.graphs.length;++at){var ct;if(ct=ot.onnx.GraphProto.verify(nt.graphs[at]))return"graphs."+ct}}return null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.AttributeProto)return nt;var at=new ot.onnx.AttributeProto;switch(nt.name!=null&&(at.name=String(nt.name)),nt.refAttrName!=null&&(at.refAttrName=String(nt.refAttrName)),nt.docString!=null&&(at.docString=String(nt.docString)),nt.type){case"UNDEFINED":case 0:at.type=0;break;case"FLOAT":case 1:at.type=1;break;case"INT":case 2:at.type=2;break;case"STRING":case 3:at.type=3;break;case"TENSOR":case 4:at.type=4;break;case"GRAPH":case 5:at.type=5;break;case"FLOATS":case 6:at.type=6;break;case"INTS":case 7:at.type=7;break;case"STRINGS":case 8:at.type=8;break;case"TENSORS":case 9:at.type=9;break;case"GRAPHS":case 10:at.type=10}if(nt.f!=null&&(at.f=Number(nt.f)),nt.i!=null&&(st.Long?(at.i=st.Long.fromValue(nt.i)).unsigned=!1:typeof nt.i=="string"?at.i=parseInt(nt.i,10):typeof nt.i=="number"?at.i=nt.i:typeof nt.i=="object"&&(at.i=new st.LongBits(nt.i.low>>>0,nt.i.high>>>0).toNumber())),nt.s!=null&&(typeof nt.s=="string"?st.base64.decode(nt.s,at.s=st.newBuffer(st.base64.length(nt.s)),0):nt.s.length&&(at.s=nt.s)),nt.t!=null){if(typeof nt.t!="object")throw TypeError(".onnx.AttributeProto.t: object expected");at.t=ot.onnx.TensorProto.fromObject(nt.t)}if(nt.g!=null){if(typeof nt.g!="object")throw TypeError(".onnx.AttributeProto.g: object expected");at.g=ot.onnx.GraphProto.fromObject(nt.g)}if(nt.floats){if(!Array.isArray(nt.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");at.floats=[];for(var ct=0;ct<nt.floats.length;++ct)at.floats[ct]=Number(nt.floats[ct])}if(nt.ints){if(!Array.isArray(nt.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");for(at.ints=[],ct=0;ct<nt.ints.length;++ct)st.Long?(at.ints[ct]=st.Long.fromValue(nt.ints[ct])).unsigned=!1:typeof nt.ints[ct]=="string"?at.ints[ct]=parseInt(nt.ints[ct],10):typeof nt.ints[ct]=="number"?at.ints[ct]=nt.ints[ct]:typeof nt.ints[ct]=="object"&&(at.ints[ct]=new st.LongBits(nt.ints[ct].low>>>0,nt.ints[ct].high>>>0).toNumber())}if(nt.strings){if(!Array.isArray(nt.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");for(at.strings=[],ct=0;ct<nt.strings.length;++ct)typeof nt.strings[ct]=="string"?st.base64.decode(nt.strings[ct],at.strings[ct]=st.newBuffer(st.base64.length(nt.strings[ct])),0):nt.strings[ct].length&&(at.strings[ct]=nt.strings[ct])}if(nt.tensors){if(!Array.isArray(nt.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");for(at.tensors=[],ct=0;ct<nt.tensors.length;++ct){if(typeof nt.tensors[ct]!="object")throw TypeError(".onnx.AttributeProto.tensors: object expected");at.tensors[ct]=ot.onnx.TensorProto.fromObject(nt.tensors[ct])}}if(nt.graphs){if(!Array.isArray(nt.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");for(at.graphs=[],ct=0;ct<nt.graphs.length;++ct){if(typeof nt.graphs[ct]!="object")throw TypeError(".onnx.AttributeProto.graphs: object expected");at.graphs[ct]=ot.onnx.GraphProto.fromObject(nt.graphs[ct])}}return at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.floats=[],ct.ints=[],ct.strings=[],ct.tensors=[],ct.graphs=[]),at.defaults){if(ct.name="",ct.f=0,st.Long){var ut=new st.Long(0,0,!1);ct.i=at.longs===String?ut.toString():at.longs===Number?ut.toNumber():ut}else ct.i=at.longs===String?"0":0;at.bytes===String?ct.s="":(ct.s=[],at.bytes!==Array&&(ct.s=st.newBuffer(ct.s))),ct.t=null,ct.g=null,ct.docString="",ct.type=at.enums===String?"UNDEFINED":0,ct.refAttrName=""}if(nt.name!=null&&nt.hasOwnProperty("name")&&(ct.name=nt.name),nt.f!=null&&nt.hasOwnProperty("f")&&(ct.f=at.json&&!isFinite(nt.f)?String(nt.f):nt.f),nt.i!=null&&nt.hasOwnProperty("i")&&(typeof nt.i=="number"?ct.i=at.longs===String?String(nt.i):nt.i:ct.i=at.longs===String?st.Long.prototype.toString.call(nt.i):at.longs===Number?new st.LongBits(nt.i.low>>>0,nt.i.high>>>0).toNumber():nt.i),nt.s!=null&&nt.hasOwnProperty("s")&&(ct.s=at.bytes===String?st.base64.encode(nt.s,0,nt.s.length):at.bytes===Array?Array.prototype.slice.call(nt.s):nt.s),nt.t!=null&&nt.hasOwnProperty("t")&&(ct.t=ot.onnx.TensorProto.toObject(nt.t,at)),nt.g!=null&&nt.hasOwnProperty("g")&&(ct.g=ot.onnx.GraphProto.toObject(nt.g,at)),nt.floats&&nt.floats.length){ct.floats=[];for(var dt=0;dt<nt.floats.length;++dt)ct.floats[dt]=at.json&&!isFinite(nt.floats[dt])?String(nt.floats[dt]):nt.floats[dt]}if(nt.ints&&nt.ints.length)for(ct.ints=[],dt=0;dt<nt.ints.length;++dt)typeof nt.ints[dt]=="number"?ct.ints[dt]=at.longs===String?String(nt.ints[dt]):nt.ints[dt]:ct.ints[dt]=at.longs===String?st.Long.prototype.toString.call(nt.ints[dt]):at.longs===Number?new st.LongBits(nt.ints[dt].low>>>0,nt.ints[dt].high>>>0).toNumber():nt.ints[dt];if(nt.strings&&nt.strings.length)for(ct.strings=[],dt=0;dt<nt.strings.length;++dt)ct.strings[dt]=at.bytes===String?st.base64.encode(nt.strings[dt],0,nt.strings[dt].length):at.bytes===Array?Array.prototype.slice.call(nt.strings[dt]):nt.strings[dt];if(nt.tensors&&nt.tensors.length)for(ct.tensors=[],dt=0;dt<nt.tensors.length;++dt)ct.tensors[dt]=ot.onnx.TensorProto.toObject(nt.tensors[dt],at);if(nt.graphs&&nt.graphs.length)for(ct.graphs=[],dt=0;dt<nt.graphs.length;++dt)ct.graphs[dt]=ot.onnx.GraphProto.toObject(nt.graphs[dt],at);return nt.docString!=null&&nt.hasOwnProperty("docString")&&(ct.docString=nt.docString),nt.type!=null&&nt.hasOwnProperty("type")&&(ct.type=at.enums===String?ot.onnx.AttributeProto.AttributeType[nt.type]:nt.type),nt.refAttrName!=null&&nt.hasOwnProperty("refAttrName")&&(ct.refAttrName=nt.refAttrName),ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt.AttributeType=(function(){var nt={},at=Object.create(nt);return at[nt[0]="UNDEFINED"]=0,at[nt[1]="FLOAT"]=1,at[nt[2]="INT"]=2,at[nt[3]="STRING"]=3,at[nt[4]="TENSOR"]=4,at[nt[5]="GRAPH"]=5,at[nt[6]="FLOATS"]=6,at[nt[7]="INTS"]=7,at[nt[8]="STRINGS"]=8,at[nt[9]="TENSORS"]=9,at[nt[10]="GRAPHS"]=10,at})(),rt})(),xe.ValueInfoProto=(function(){function rt(nt){if(nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.name="",rt.prototype.type=null,rt.prototype.docString="",rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){return at||(at=it.create()),nt.name!=null&&nt.hasOwnProperty("name")&&at.uint32(10).string(nt.name),nt.type!=null&&nt.hasOwnProperty("type")&&ot.onnx.TypeProto.encode(nt.type,at.uint32(18).fork()).ldelim(),nt.docString!=null&&nt.hasOwnProperty("docString")&&at.uint32(26).string(nt.docString),at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.ValueInfoProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.name=nt.string();break;case 2:ut.type=ot.onnx.TypeProto.decode(nt,nt.uint32());break;case 3:ut.docString=nt.string();break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.name!=null&&nt.hasOwnProperty("name")&&!st.isString(nt.name))return"name: string expected";if(nt.type!=null&&nt.hasOwnProperty("type")){var at=ot.onnx.TypeProto.verify(nt.type);if(at)return"type."+at}return nt.docString!=null&&nt.hasOwnProperty("docString")&&!st.isString(nt.docString)?"docString: string expected":null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.ValueInfoProto)return nt;var at=new ot.onnx.ValueInfoProto;if(nt.name!=null&&(at.name=String(nt.name)),nt.type!=null){if(typeof nt.type!="object")throw TypeError(".onnx.ValueInfoProto.type: object expected");at.type=ot.onnx.TypeProto.fromObject(nt.type)}return nt.docString!=null&&(at.docString=String(nt.docString)),at},rt.toObject=function(nt,at){at||(at={});var ct={};return at.defaults&&(ct.name="",ct.type=null,ct.docString=""),nt.name!=null&&nt.hasOwnProperty("name")&&(ct.name=nt.name),nt.type!=null&&nt.hasOwnProperty("type")&&(ct.type=ot.onnx.TypeProto.toObject(nt.type,at)),nt.docString!=null&&nt.hasOwnProperty("docString")&&(ct.docString=nt.docString),ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe.NodeProto=(function(){function rt(nt){if(this.input=[],this.output=[],this.attribute=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.input=st.emptyArray,rt.prototype.output=st.emptyArray,rt.prototype.name="",rt.prototype.opType="",rt.prototype.domain="",rt.prototype.attribute=st.emptyArray,rt.prototype.docString="",rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.input!=null&&nt.input.length)for(var ct=0;ct<nt.input.length;++ct)at.uint32(10).string(nt.input[ct]);if(nt.output!=null&&nt.output.length)for(ct=0;ct<nt.output.length;++ct)at.uint32(18).string(nt.output[ct]);if(nt.name!=null&&nt.hasOwnProperty("name")&&at.uint32(26).string(nt.name),nt.opType!=null&&nt.hasOwnProperty("opType")&&at.uint32(34).string(nt.opType),nt.attribute!=null&&nt.attribute.length)for(ct=0;ct<nt.attribute.length;++ct)ot.onnx.AttributeProto.encode(nt.attribute[ct],at.uint32(42).fork()).ldelim();return nt.docString!=null&&nt.hasOwnProperty("docString")&&at.uint32(50).string(nt.docString),nt.domain!=null&&nt.hasOwnProperty("domain")&&at.uint32(58).string(nt.domain),at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.NodeProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.input&&ut.input.length||(ut.input=[]),ut.input.push(nt.string());break;case 2:ut.output&&ut.output.length||(ut.output=[]),ut.output.push(nt.string());break;case 3:ut.name=nt.string();break;case 4:ut.opType=nt.string();break;case 7:ut.domain=nt.string();break;case 5:ut.attribute&&ut.attribute.length||(ut.attribute=[]),ut.attribute.push(ot.onnx.AttributeProto.decode(nt,nt.uint32()));break;case 6:ut.docString=nt.string();break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.input!=null&&nt.hasOwnProperty("input")){if(!Array.isArray(nt.input))return"input: array expected";for(var at=0;at<nt.input.length;++at)if(!st.isString(nt.input[at]))return"input: string[] expected"}if(nt.output!=null&&nt.hasOwnProperty("output")){if(!Array.isArray(nt.output))return"output: array expected";for(at=0;at<nt.output.length;++at)if(!st.isString(nt.output[at]))return"output: string[] expected"}if(nt.name!=null&&nt.hasOwnProperty("name")&&!st.isString(nt.name))return"name: string expected";if(nt.opType!=null&&nt.hasOwnProperty("opType")&&!st.isString(nt.opType))return"opType: string expected";if(nt.domain!=null&&nt.hasOwnProperty("domain")&&!st.isString(nt.domain))return"domain: string expected";if(nt.attribute!=null&&nt.hasOwnProperty("attribute")){if(!Array.isArray(nt.attribute))return"attribute: array expected";for(at=0;at<nt.attribute.length;++at){var ct=ot.onnx.AttributeProto.verify(nt.attribute[at]);if(ct)return"attribute."+ct}}return nt.docString!=null&&nt.hasOwnProperty("docString")&&!st.isString(nt.docString)?"docString: string expected":null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.NodeProto)return nt;var at=new ot.onnx.NodeProto;if(nt.input){if(!Array.isArray(nt.input))throw TypeError(".onnx.NodeProto.input: array expected");at.input=[];for(var ct=0;ct<nt.input.length;++ct)at.input[ct]=String(nt.input[ct])}if(nt.output){if(!Array.isArray(nt.output))throw TypeError(".onnx.NodeProto.output: array expected");for(at.output=[],ct=0;ct<nt.output.length;++ct)at.output[ct]=String(nt.output[ct])}if(nt.name!=null&&(at.name=String(nt.name)),nt.opType!=null&&(at.opType=String(nt.opType)),nt.domain!=null&&(at.domain=String(nt.domain)),nt.attribute){if(!Array.isArray(nt.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");for(at.attribute=[],ct=0;ct<nt.attribute.length;++ct){if(typeof nt.attribute[ct]!="object")throw TypeError(".onnx.NodeProto.attribute: object expected");at.attribute[ct]=ot.onnx.AttributeProto.fromObject(nt.attribute[ct])}}return nt.docString!=null&&(at.docString=String(nt.docString)),at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.input=[],ct.output=[],ct.attribute=[]),at.defaults&&(ct.name="",ct.opType="",ct.docString="",ct.domain=""),nt.input&&nt.input.length){ct.input=[];for(var ut=0;ut<nt.input.length;++ut)ct.input[ut]=nt.input[ut]}if(nt.output&&nt.output.length)for(ct.output=[],ut=0;ut<nt.output.length;++ut)ct.output[ut]=nt.output[ut];if(nt.name!=null&&nt.hasOwnProperty("name")&&(ct.name=nt.name),nt.opType!=null&&nt.hasOwnProperty("opType")&&(ct.opType=nt.opType),nt.attribute&&nt.attribute.length)for(ct.attribute=[],ut=0;ut<nt.attribute.length;++ut)ct.attribute[ut]=ot.onnx.AttributeProto.toObject(nt.attribute[ut],at);return nt.docString!=null&&nt.hasOwnProperty("docString")&&(ct.docString=nt.docString),nt.domain!=null&&nt.hasOwnProperty("domain")&&(ct.domain=nt.domain),ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe.ModelProto=(function(){function rt(nt){if(this.opsetImport=[],this.metadataProps=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.irVersion=st.Long?st.Long.fromBits(0,0,!1):0,rt.prototype.opsetImport=st.emptyArray,rt.prototype.producerName="",rt.prototype.producerVersion="",rt.prototype.domain="",rt.prototype.modelVersion=st.Long?st.Long.fromBits(0,0,!1):0,rt.prototype.docString="",rt.prototype.graph=null,rt.prototype.metadataProps=st.emptyArray,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.irVersion!=null&&nt.hasOwnProperty("irVersion")&&at.uint32(8).int64(nt.irVersion),nt.producerName!=null&&nt.hasOwnProperty("producerName")&&at.uint32(18).string(nt.producerName),nt.producerVersion!=null&&nt.hasOwnProperty("producerVersion")&&at.uint32(26).string(nt.producerVersion),nt.domain!=null&&nt.hasOwnProperty("domain")&&at.uint32(34).string(nt.domain),nt.modelVersion!=null&&nt.hasOwnProperty("modelVersion")&&at.uint32(40).int64(nt.modelVersion),nt.docString!=null&&nt.hasOwnProperty("docString")&&at.uint32(50).string(nt.docString),nt.graph!=null&&nt.hasOwnProperty("graph")&&ot.onnx.GraphProto.encode(nt.graph,at.uint32(58).fork()).ldelim(),nt.opsetImport!=null&&nt.opsetImport.length)for(var ct=0;ct<nt.opsetImport.length;++ct)ot.onnx.OperatorSetIdProto.encode(nt.opsetImport[ct],at.uint32(66).fork()).ldelim();if(nt.metadataProps!=null&&nt.metadataProps.length)for(ct=0;ct<nt.metadataProps.length;++ct)ot.onnx.StringStringEntryProto.encode(nt.metadataProps[ct],at.uint32(114).fork()).ldelim();return at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.ModelProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.irVersion=nt.int64();break;case 8:ut.opsetImport&&ut.opsetImport.length||(ut.opsetImport=[]),ut.opsetImport.push(ot.onnx.OperatorSetIdProto.decode(nt,nt.uint32()));break;case 2:ut.producerName=nt.string();break;case 3:ut.producerVersion=nt.string();break;case 4:ut.domain=nt.string();break;case 5:ut.modelVersion=nt.int64();break;case 6:ut.docString=nt.string();break;case 7:ut.graph=ot.onnx.GraphProto.decode(nt,nt.uint32());break;case 14:ut.metadataProps&&ut.metadataProps.length||(ut.metadataProps=[]),ut.metadataProps.push(ot.onnx.StringStringEntryProto.decode(nt,nt.uint32()));break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.irVersion!=null&&nt.hasOwnProperty("irVersion")&&!(st.isInteger(nt.irVersion)||nt.irVersion&&st.isInteger(nt.irVersion.low)&&st.isInteger(nt.irVersion.high)))return"irVersion: integer|Long expected";if(nt.opsetImport!=null&&nt.hasOwnProperty("opsetImport")){if(!Array.isArray(nt.opsetImport))return"opsetImport: array expected";for(var at=0;at<nt.opsetImport.length;++at)if(ct=ot.onnx.OperatorSetIdProto.verify(nt.opsetImport[at]))return"opsetImport."+ct}if(nt.producerName!=null&&nt.hasOwnProperty("producerName")&&!st.isString(nt.producerName))return"producerName: string expected";if(nt.producerVersion!=null&&nt.hasOwnProperty("producerVersion")&&!st.isString(nt.producerVersion))return"producerVersion: string expected";if(nt.domain!=null&&nt.hasOwnProperty("domain")&&!st.isString(nt.domain))return"domain: string expected";if(nt.modelVersion!=null&&nt.hasOwnProperty("modelVersion")&&!(st.isInteger(nt.modelVersion)||nt.modelVersion&&st.isInteger(nt.modelVersion.low)&&st.isInteger(nt.modelVersion.high)))return"modelVersion: integer|Long expected";if(nt.docString!=null&&nt.hasOwnProperty("docString")&&!st.isString(nt.docString))return"docString: string expected";if(nt.graph!=null&&nt.hasOwnProperty("graph")&&(ct=ot.onnx.GraphProto.verify(nt.graph)))return"graph."+ct;if(nt.metadataProps!=null&&nt.hasOwnProperty("metadataProps")){if(!Array.isArray(nt.metadataProps))return"metadataProps: array expected";for(at=0;at<nt.metadataProps.length;++at){var ct;if(ct=ot.onnx.StringStringEntryProto.verify(nt.metadataProps[at]))return"metadataProps."+ct}}return null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.ModelProto)return nt;var at=new ot.onnx.ModelProto;if(nt.irVersion!=null&&(st.Long?(at.irVersion=st.Long.fromValue(nt.irVersion)).unsigned=!1:typeof nt.irVersion=="string"?at.irVersion=parseInt(nt.irVersion,10):typeof nt.irVersion=="number"?at.irVersion=nt.irVersion:typeof nt.irVersion=="object"&&(at.irVersion=new st.LongBits(nt.irVersion.low>>>0,nt.irVersion.high>>>0).toNumber())),nt.opsetImport){if(!Array.isArray(nt.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");at.opsetImport=[];for(var ct=0;ct<nt.opsetImport.length;++ct){if(typeof nt.opsetImport[ct]!="object")throw TypeError(".onnx.ModelProto.opsetImport: object expected");at.opsetImport[ct]=ot.onnx.OperatorSetIdProto.fromObject(nt.opsetImport[ct])}}if(nt.producerName!=null&&(at.producerName=String(nt.producerName)),nt.producerVersion!=null&&(at.producerVersion=String(nt.producerVersion)),nt.domain!=null&&(at.domain=String(nt.domain)),nt.modelVersion!=null&&(st.Long?(at.modelVersion=st.Long.fromValue(nt.modelVersion)).unsigned=!1:typeof nt.modelVersion=="string"?at.modelVersion=parseInt(nt.modelVersion,10):typeof nt.modelVersion=="number"?at.modelVersion=nt.modelVersion:typeof nt.modelVersion=="object"&&(at.modelVersion=new st.LongBits(nt.modelVersion.low>>>0,nt.modelVersion.high>>>0).toNumber())),nt.docString!=null&&(at.docString=String(nt.docString)),nt.graph!=null){if(typeof nt.graph!="object")throw TypeError(".onnx.ModelProto.graph: object expected");at.graph=ot.onnx.GraphProto.fromObject(nt.graph)}if(nt.metadataProps){if(!Array.isArray(nt.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");for(at.metadataProps=[],ct=0;ct<nt.metadataProps.length;++ct){if(typeof nt.metadataProps[ct]!="object")throw TypeError(".onnx.ModelProto.metadataProps: object expected");at.metadataProps[ct]=ot.onnx.StringStringEntryProto.fromObject(nt.metadataProps[ct])}}return at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.opsetImport=[],ct.metadataProps=[]),at.defaults){if(st.Long){var ut=new st.Long(0,0,!1);ct.irVersion=at.longs===String?ut.toString():at.longs===Number?ut.toNumber():ut}else ct.irVersion=at.longs===String?"0":0;ct.producerName="",ct.producerVersion="",ct.domain="",st.Long?(ut=new st.Long(0,0,!1),ct.modelVersion=at.longs===String?ut.toString():at.longs===Number?ut.toNumber():ut):ct.modelVersion=at.longs===String?"0":0,ct.docString="",ct.graph=null}if(nt.irVersion!=null&&nt.hasOwnProperty("irVersion")&&(typeof nt.irVersion=="number"?ct.irVersion=at.longs===String?String(nt.irVersion):nt.irVersion:ct.irVersion=at.longs===String?st.Long.prototype.toString.call(nt.irVersion):at.longs===Number?new st.LongBits(nt.irVersion.low>>>0,nt.irVersion.high>>>0).toNumber():nt.irVersion),nt.producerName!=null&&nt.hasOwnProperty("producerName")&&(ct.producerName=nt.producerName),nt.producerVersion!=null&&nt.hasOwnProperty("producerVersion")&&(ct.producerVersion=nt.producerVersion),nt.domain!=null&&nt.hasOwnProperty("domain")&&(ct.domain=nt.domain),nt.modelVersion!=null&&nt.hasOwnProperty("modelVersion")&&(typeof nt.modelVersion=="number"?ct.modelVersion=at.longs===String?String(nt.modelVersion):nt.modelVersion:ct.modelVersion=at.longs===String?st.Long.prototype.toString.call(nt.modelVersion):at.longs===Number?new st.LongBits(nt.modelVersion.low>>>0,nt.modelVersion.high>>>0).toNumber():nt.modelVersion),nt.docString!=null&&nt.hasOwnProperty("docString")&&(ct.docString=nt.docString),nt.graph!=null&&nt.hasOwnProperty("graph")&&(ct.graph=ot.onnx.GraphProto.toObject(nt.graph,at)),nt.opsetImport&&nt.opsetImport.length){ct.opsetImport=[];for(var dt=0;dt<nt.opsetImport.length;++dt)ct.opsetImport[dt]=ot.onnx.OperatorSetIdProto.toObject(nt.opsetImport[dt],at)}if(nt.metadataProps&&nt.metadataProps.length)for(ct.metadataProps=[],dt=0;dt<nt.metadataProps.length;++dt)ct.metadataProps[dt]=ot.onnx.StringStringEntryProto.toObject(nt.metadataProps[dt],at);return ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe.StringStringEntryProto=(function(){function rt(nt){if(nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.key="",rt.prototype.value="",rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){return at||(at=it.create()),nt.key!=null&&nt.hasOwnProperty("key")&&at.uint32(10).string(nt.key),nt.value!=null&&nt.hasOwnProperty("value")&&at.uint32(18).string(nt.value),at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.StringStringEntryProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.key=nt.string();break;case 2:ut.value=nt.string();break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){return typeof nt!="object"||nt===null?"object expected":nt.key!=null&&nt.hasOwnProperty("key")&&!st.isString(nt.key)?"key: string expected":nt.value!=null&&nt.hasOwnProperty("value")&&!st.isString(nt.value)?"value: string expected":null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.StringStringEntryProto)return nt;var at=new ot.onnx.StringStringEntryProto;return nt.key!=null&&(at.key=String(nt.key)),nt.value!=null&&(at.value=String(nt.value)),at},rt.toObject=function(nt,at){at||(at={});var ct={};return at.defaults&&(ct.key="",ct.value=""),nt.key!=null&&nt.hasOwnProperty("key")&&(ct.key=nt.key),nt.value!=null&&nt.hasOwnProperty("value")&&(ct.value=nt.value),ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe.TensorAnnotation=(function(){function rt(nt){if(this.quantParameterTensorNames=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.tensorName="",rt.prototype.quantParameterTensorNames=st.emptyArray,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.tensorName!=null&&nt.hasOwnProperty("tensorName")&&at.uint32(10).string(nt.tensorName),nt.quantParameterTensorNames!=null&&nt.quantParameterTensorNames.length)for(var ct=0;ct<nt.quantParameterTensorNames.length;++ct)ot.onnx.StringStringEntryProto.encode(nt.quantParameterTensorNames[ct],at.uint32(18).fork()).ldelim();return at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.TensorAnnotation;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.tensorName=nt.string();break;case 2:ut.quantParameterTensorNames&&ut.quantParameterTensorNames.length||(ut.quantParameterTensorNames=[]),ut.quantParameterTensorNames.push(ot.onnx.StringStringEntryProto.decode(nt,nt.uint32()));break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.tensorName!=null&&nt.hasOwnProperty("tensorName")&&!st.isString(nt.tensorName))return"tensorName: string expected";if(nt.quantParameterTensorNames!=null&&nt.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(nt.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var at=0;at<nt.quantParameterTensorNames.length;++at){var ct=ot.onnx.StringStringEntryProto.verify(nt.quantParameterTensorNames[at]);if(ct)return"quantParameterTensorNames."+ct}}return null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.TensorAnnotation)return nt;var at=new ot.onnx.TensorAnnotation;if(nt.tensorName!=null&&(at.tensorName=String(nt.tensorName)),nt.quantParameterTensorNames){if(!Array.isArray(nt.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");at.quantParameterTensorNames=[];for(var ct=0;ct<nt.quantParameterTensorNames.length;++ct){if(typeof nt.quantParameterTensorNames[ct]!="object")throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");at.quantParameterTensorNames[ct]=ot.onnx.StringStringEntryProto.fromObject(nt.quantParameterTensorNames[ct])}}return at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.quantParameterTensorNames=[]),at.defaults&&(ct.tensorName=""),nt.tensorName!=null&&nt.hasOwnProperty("tensorName")&&(ct.tensorName=nt.tensorName),nt.quantParameterTensorNames&&nt.quantParameterTensorNames.length){ct.quantParameterTensorNames=[];for(var ut=0;ut<nt.quantParameterTensorNames.length;++ut)ct.quantParameterTensorNames[ut]=ot.onnx.StringStringEntryProto.toObject(nt.quantParameterTensorNames[ut],at)}return ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe.GraphProto=(function(){function rt(nt){if(this.node=[],this.initializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.node=st.emptyArray,rt.prototype.name="",rt.prototype.initializer=st.emptyArray,rt.prototype.docString="",rt.prototype.input=st.emptyArray,rt.prototype.output=st.emptyArray,rt.prototype.valueInfo=st.emptyArray,rt.prototype.quantizationAnnotation=st.emptyArray,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.node!=null&&nt.node.length)for(var ct=0;ct<nt.node.length;++ct)ot.onnx.NodeProto.encode(nt.node[ct],at.uint32(10).fork()).ldelim();if(nt.name!=null&&nt.hasOwnProperty("name")&&at.uint32(18).string(nt.name),nt.initializer!=null&&nt.initializer.length)for(ct=0;ct<nt.initializer.length;++ct)ot.onnx.TensorProto.encode(nt.initializer[ct],at.uint32(42).fork()).ldelim();if(nt.docString!=null&&nt.hasOwnProperty("docString")&&at.uint32(82).string(nt.docString),nt.input!=null&&nt.input.length)for(ct=0;ct<nt.input.length;++ct)ot.onnx.ValueInfoProto.encode(nt.input[ct],at.uint32(90).fork()).ldelim();if(nt.output!=null&&nt.output.length)for(ct=0;ct<nt.output.length;++ct)ot.onnx.ValueInfoProto.encode(nt.output[ct],at.uint32(98).fork()).ldelim();if(nt.valueInfo!=null&&nt.valueInfo.length)for(ct=0;ct<nt.valueInfo.length;++ct)ot.onnx.ValueInfoProto.encode(nt.valueInfo[ct],at.uint32(106).fork()).ldelim();if(nt.quantizationAnnotation!=null&&nt.quantizationAnnotation.length)for(ct=0;ct<nt.quantizationAnnotation.length;++ct)ot.onnx.TensorAnnotation.encode(nt.quantizationAnnotation[ct],at.uint32(114).fork()).ldelim();return at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.GraphProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.node&&ut.node.length||(ut.node=[]),ut.node.push(ot.onnx.NodeProto.decode(nt,nt.uint32()));break;case 2:ut.name=nt.string();break;case 5:ut.initializer&&ut.initializer.length||(ut.initializer=[]),ut.initializer.push(ot.onnx.TensorProto.decode(nt,nt.uint32()));break;case 10:ut.docString=nt.string();break;case 11:ut.input&&ut.input.length||(ut.input=[]),ut.input.push(ot.onnx.ValueInfoProto.decode(nt,nt.uint32()));break;case 12:ut.output&&ut.output.length||(ut.output=[]),ut.output.push(ot.onnx.ValueInfoProto.decode(nt,nt.uint32()));break;case 13:ut.valueInfo&&ut.valueInfo.length||(ut.valueInfo=[]),ut.valueInfo.push(ot.onnx.ValueInfoProto.decode(nt,nt.uint32()));break;case 14:ut.quantizationAnnotation&&ut.quantizationAnnotation.length||(ut.quantizationAnnotation=[]),ut.quantizationAnnotation.push(ot.onnx.TensorAnnotation.decode(nt,nt.uint32()));break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.node!=null&&nt.hasOwnProperty("node")){if(!Array.isArray(nt.node))return"node: array expected";for(var at=0;at<nt.node.length;++at)if(ct=ot.onnx.NodeProto.verify(nt.node[at]))return"node."+ct}if(nt.name!=null&&nt.hasOwnProperty("name")&&!st.isString(nt.name))return"name: string expected";if(nt.initializer!=null&&nt.hasOwnProperty("initializer")){if(!Array.isArray(nt.initializer))return"initializer: array expected";for(at=0;at<nt.initializer.length;++at)if(ct=ot.onnx.TensorProto.verify(nt.initializer[at]))return"initializer."+ct}if(nt.docString!=null&&nt.hasOwnProperty("docString")&&!st.isString(nt.docString))return"docString: string expected";if(nt.input!=null&&nt.hasOwnProperty("input")){if(!Array.isArray(nt.input))return"input: array expected";for(at=0;at<nt.input.length;++at)if(ct=ot.onnx.ValueInfoProto.verify(nt.input[at]))return"input."+ct}if(nt.output!=null&&nt.hasOwnProperty("output")){if(!Array.isArray(nt.output))return"output: array expected";for(at=0;at<nt.output.length;++at)if(ct=ot.onnx.ValueInfoProto.verify(nt.output[at]))return"output."+ct}if(nt.valueInfo!=null&&nt.hasOwnProperty("valueInfo")){if(!Array.isArray(nt.valueInfo))return"valueInfo: array expected";for(at=0;at<nt.valueInfo.length;++at)if(ct=ot.onnx.ValueInfoProto.verify(nt.valueInfo[at]))return"valueInfo."+ct}if(nt.quantizationAnnotation!=null&&nt.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(nt.quantizationAnnotation))return"quantizationAnnotation: array expected";for(at=0;at<nt.quantizationAnnotation.length;++at){var ct;if(ct=ot.onnx.TensorAnnotation.verify(nt.quantizationAnnotation[at]))return"quantizationAnnotation."+ct}}return null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.GraphProto)return nt;var at=new ot.onnx.GraphProto;if(nt.node){if(!Array.isArray(nt.node))throw TypeError(".onnx.GraphProto.node: array expected");at.node=[];for(var ct=0;ct<nt.node.length;++ct){if(typeof nt.node[ct]!="object")throw TypeError(".onnx.GraphProto.node: object expected");at.node[ct]=ot.onnx.NodeProto.fromObject(nt.node[ct])}}if(nt.name!=null&&(at.name=String(nt.name)),nt.initializer){if(!Array.isArray(nt.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");for(at.initializer=[],ct=0;ct<nt.initializer.length;++ct){if(typeof nt.initializer[ct]!="object")throw TypeError(".onnx.GraphProto.initializer: object expected");at.initializer[ct]=ot.onnx.TensorProto.fromObject(nt.initializer[ct])}}if(nt.docString!=null&&(at.docString=String(nt.docString)),nt.input){if(!Array.isArray(nt.input))throw TypeError(".onnx.GraphProto.input: array expected");for(at.input=[],ct=0;ct<nt.input.length;++ct){if(typeof nt.input[ct]!="object")throw TypeError(".onnx.GraphProto.input: object expected");at.input[ct]=ot.onnx.ValueInfoProto.fromObject(nt.input[ct])}}if(nt.output){if(!Array.isArray(nt.output))throw TypeError(".onnx.GraphProto.output: array expected");for(at.output=[],ct=0;ct<nt.output.length;++ct){if(typeof nt.output[ct]!="object")throw TypeError(".onnx.GraphProto.output: object expected");at.output[ct]=ot.onnx.ValueInfoProto.fromObject(nt.output[ct])}}if(nt.valueInfo){if(!Array.isArray(nt.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");for(at.valueInfo=[],ct=0;ct<nt.valueInfo.length;++ct){if(typeof nt.valueInfo[ct]!="object")throw TypeError(".onnx.GraphProto.valueInfo: object expected");at.valueInfo[ct]=ot.onnx.ValueInfoProto.fromObject(nt.valueInfo[ct])}}if(nt.quantizationAnnotation){if(!Array.isArray(nt.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");for(at.quantizationAnnotation=[],ct=0;ct<nt.quantizationAnnotation.length;++ct){if(typeof nt.quantizationAnnotation[ct]!="object")throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");at.quantizationAnnotation[ct]=ot.onnx.TensorAnnotation.fromObject(nt.quantizationAnnotation[ct])}}return at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.node=[],ct.initializer=[],ct.input=[],ct.output=[],ct.valueInfo=[],ct.quantizationAnnotation=[]),at.defaults&&(ct.name="",ct.docString=""),nt.node&&nt.node.length){ct.node=[];for(var ut=0;ut<nt.node.length;++ut)ct.node[ut]=ot.onnx.NodeProto.toObject(nt.node[ut],at)}if(nt.name!=null&&nt.hasOwnProperty("name")&&(ct.name=nt.name),nt.initializer&&nt.initializer.length)for(ct.initializer=[],ut=0;ut<nt.initializer.length;++ut)ct.initializer[ut]=ot.onnx.TensorProto.toObject(nt.initializer[ut],at);if(nt.docString!=null&&nt.hasOwnProperty("docString")&&(ct.docString=nt.docString),nt.input&&nt.input.length)for(ct.input=[],ut=0;ut<nt.input.length;++ut)ct.input[ut]=ot.onnx.ValueInfoProto.toObject(nt.input[ut],at);if(nt.output&&nt.output.length)for(ct.output=[],ut=0;ut<nt.output.length;++ut)ct.output[ut]=ot.onnx.ValueInfoProto.toObject(nt.output[ut],at);if(nt.valueInfo&&nt.valueInfo.length)for(ct.valueInfo=[],ut=0;ut<nt.valueInfo.length;++ut)ct.valueInfo[ut]=ot.onnx.ValueInfoProto.toObject(nt.valueInfo[ut],at);if(nt.quantizationAnnotation&&nt.quantizationAnnotation.length)for(ct.quantizationAnnotation=[],ut=0;ut<nt.quantizationAnnotation.length;++ut)ct.quantizationAnnotation[ut]=ot.onnx.TensorAnnotation.toObject(nt.quantizationAnnotation[ut],at);return ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe.TensorProto=(function(){function rt(nt){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.dims=st.emptyArray,rt.prototype.dataType=0,rt.prototype.segment=null,rt.prototype.floatData=st.emptyArray,rt.prototype.int32Data=st.emptyArray,rt.prototype.stringData=st.emptyArray,rt.prototype.int64Data=st.emptyArray,rt.prototype.name="",rt.prototype.docString="",rt.prototype.rawData=st.newBuffer([]),rt.prototype.externalData=st.emptyArray,rt.prototype.dataLocation=0,rt.prototype.doubleData=st.emptyArray,rt.prototype.uint64Data=st.emptyArray,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.dims!=null&&nt.dims.length){at.uint32(10).fork();for(var ct=0;ct<nt.dims.length;++ct)at.int64(nt.dims[ct]);at.ldelim()}if(nt.dataType!=null&&nt.hasOwnProperty("dataType")&&at.uint32(16).int32(nt.dataType),nt.segment!=null&&nt.hasOwnProperty("segment")&&ot.onnx.TensorProto.Segment.encode(nt.segment,at.uint32(26).fork()).ldelim(),nt.floatData!=null&&nt.floatData.length){for(at.uint32(34).fork(),ct=0;ct<nt.floatData.length;++ct)at.float(nt.floatData[ct]);at.ldelim()}if(nt.int32Data!=null&&nt.int32Data.length){for(at.uint32(42).fork(),ct=0;ct<nt.int32Data.length;++ct)at.int32(nt.int32Data[ct]);at.ldelim()}if(nt.stringData!=null&&nt.stringData.length)for(ct=0;ct<nt.stringData.length;++ct)at.uint32(50).bytes(nt.stringData[ct]);if(nt.int64Data!=null&&nt.int64Data.length){for(at.uint32(58).fork(),ct=0;ct<nt.int64Data.length;++ct)at.int64(nt.int64Data[ct]);at.ldelim()}if(nt.name!=null&&nt.hasOwnProperty("name")&&at.uint32(66).string(nt.name),nt.rawData!=null&&nt.hasOwnProperty("rawData")&&at.uint32(74).bytes(nt.rawData),nt.doubleData!=null&&nt.doubleData.length){for(at.uint32(82).fork(),ct=0;ct<nt.doubleData.length;++ct)at.double(nt.doubleData[ct]);at.ldelim()}if(nt.uint64Data!=null&&nt.uint64Data.length){for(at.uint32(90).fork(),ct=0;ct<nt.uint64Data.length;++ct)at.uint64(nt.uint64Data[ct]);at.ldelim()}if(nt.docString!=null&&nt.hasOwnProperty("docString")&&at.uint32(98).string(nt.docString),nt.externalData!=null&&nt.externalData.length)for(ct=0;ct<nt.externalData.length;++ct)ot.onnx.StringStringEntryProto.encode(nt.externalData[ct],at.uint32(106).fork()).ldelim();return nt.dataLocation!=null&&nt.hasOwnProperty("dataLocation")&&at.uint32(112).int32(nt.dataLocation),at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.TensorProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:if(ut.dims&&ut.dims.length||(ut.dims=[]),(7&dt)==2)for(var ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.dims.push(nt.int64());else ut.dims.push(nt.int64());break;case 2:ut.dataType=nt.int32();break;case 3:ut.segment=ot.onnx.TensorProto.Segment.decode(nt,nt.uint32());break;case 4:if(ut.floatData&&ut.floatData.length||(ut.floatData=[]),(7&dt)==2)for(ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.floatData.push(nt.float());else ut.floatData.push(nt.float());break;case 5:if(ut.int32Data&&ut.int32Data.length||(ut.int32Data=[]),(7&dt)==2)for(ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.int32Data.push(nt.int32());else ut.int32Data.push(nt.int32());break;case 6:ut.stringData&&ut.stringData.length||(ut.stringData=[]),ut.stringData.push(nt.bytes());break;case 7:if(ut.int64Data&&ut.int64Data.length||(ut.int64Data=[]),(7&dt)==2)for(ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.int64Data.push(nt.int64());else ut.int64Data.push(nt.int64());break;case 8:ut.name=nt.string();break;case 12:ut.docString=nt.string();break;case 9:ut.rawData=nt.bytes();break;case 13:ut.externalData&&ut.externalData.length||(ut.externalData=[]),ut.externalData.push(ot.onnx.StringStringEntryProto.decode(nt,nt.uint32()));break;case 14:ut.dataLocation=nt.int32();break;case 10:if(ut.doubleData&&ut.doubleData.length||(ut.doubleData=[]),(7&dt)==2)for(ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.doubleData.push(nt.double());else ut.doubleData.push(nt.double());break;case 11:if(ut.uint64Data&&ut.uint64Data.length||(ut.uint64Data=[]),(7&dt)==2)for(ht=nt.uint32()+nt.pos;nt.pos<ht;)ut.uint64Data.push(nt.uint64());else ut.uint64Data.push(nt.uint64());break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.dims!=null&&nt.hasOwnProperty("dims")){if(!Array.isArray(nt.dims))return"dims: array expected";for(var at=0;at<nt.dims.length;++at)if(!(st.isInteger(nt.dims[at])||nt.dims[at]&&st.isInteger(nt.dims[at].low)&&st.isInteger(nt.dims[at].high)))return"dims: integer|Long[] expected"}if(nt.dataType!=null&&nt.hasOwnProperty("dataType")&&!st.isInteger(nt.dataType))return"dataType: integer expected";if(nt.segment!=null&&nt.hasOwnProperty("segment")&&(ct=ot.onnx.TensorProto.Segment.verify(nt.segment)))return"segment."+ct;if(nt.floatData!=null&&nt.hasOwnProperty("floatData")){if(!Array.isArray(nt.floatData))return"floatData: array expected";for(at=0;at<nt.floatData.length;++at)if(typeof nt.floatData[at]!="number")return"floatData: number[] expected"}if(nt.int32Data!=null&&nt.hasOwnProperty("int32Data")){if(!Array.isArray(nt.int32Data))return"int32Data: array expected";for(at=0;at<nt.int32Data.length;++at)if(!st.isInteger(nt.int32Data[at]))return"int32Data: integer[] expected"}if(nt.stringData!=null&&nt.hasOwnProperty("stringData")){if(!Array.isArray(nt.stringData))return"stringData: array expected";for(at=0;at<nt.stringData.length;++at)if(!(nt.stringData[at]&&typeof nt.stringData[at].length=="number"||st.isString(nt.stringData[at])))return"stringData: buffer[] expected"}if(nt.int64Data!=null&&nt.hasOwnProperty("int64Data")){if(!Array.isArray(nt.int64Data))return"int64Data: array expected";for(at=0;at<nt.int64Data.length;++at)if(!(st.isInteger(nt.int64Data[at])||nt.int64Data[at]&&st.isInteger(nt.int64Data[at].low)&&st.isInteger(nt.int64Data[at].high)))return"int64Data: integer|Long[] expected"}if(nt.name!=null&&nt.hasOwnProperty("name")&&!st.isString(nt.name))return"name: string expected";if(nt.docString!=null&&nt.hasOwnProperty("docString")&&!st.isString(nt.docString))return"docString: string expected";if(nt.rawData!=null&&nt.hasOwnProperty("rawData")&&!(nt.rawData&&typeof nt.rawData.length=="number"||st.isString(nt.rawData)))return"rawData: buffer expected";if(nt.externalData!=null&&nt.hasOwnProperty("externalData")){if(!Array.isArray(nt.externalData))return"externalData: array expected";for(at=0;at<nt.externalData.length;++at){var ct;if(ct=ot.onnx.StringStringEntryProto.verify(nt.externalData[at]))return"externalData."+ct}}if(nt.dataLocation!=null&&nt.hasOwnProperty("dataLocation"))switch(nt.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:}if(nt.doubleData!=null&&nt.hasOwnProperty("doubleData")){if(!Array.isArray(nt.doubleData))return"doubleData: array expected";for(at=0;at<nt.doubleData.length;++at)if(typeof nt.doubleData[at]!="number")return"doubleData: number[] expected"}if(nt.uint64Data!=null&&nt.hasOwnProperty("uint64Data")){if(!Array.isArray(nt.uint64Data))return"uint64Data: array expected";for(at=0;at<nt.uint64Data.length;++at)if(!(st.isInteger(nt.uint64Data[at])||nt.uint64Data[at]&&st.isInteger(nt.uint64Data[at].low)&&st.isInteger(nt.uint64Data[at].high)))return"uint64Data: integer|Long[] expected"}return null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.TensorProto)return nt;var at=new ot.onnx.TensorProto;if(nt.dims){if(!Array.isArray(nt.dims))throw TypeError(".onnx.TensorProto.dims: array expected");at.dims=[];for(var ct=0;ct<nt.dims.length;++ct)st.Long?(at.dims[ct]=st.Long.fromValue(nt.dims[ct])).unsigned=!1:typeof nt.dims[ct]=="string"?at.dims[ct]=parseInt(nt.dims[ct],10):typeof nt.dims[ct]=="number"?at.dims[ct]=nt.dims[ct]:typeof nt.dims[ct]=="object"&&(at.dims[ct]=new st.LongBits(nt.dims[ct].low>>>0,nt.dims[ct].high>>>0).toNumber())}if(nt.dataType!=null&&(at.dataType=0|nt.dataType),nt.segment!=null){if(typeof nt.segment!="object")throw TypeError(".onnx.TensorProto.segment: object expected");at.segment=ot.onnx.TensorProto.Segment.fromObject(nt.segment)}if(nt.floatData){if(!Array.isArray(nt.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");for(at.floatData=[],ct=0;ct<nt.floatData.length;++ct)at.floatData[ct]=Number(nt.floatData[ct])}if(nt.int32Data){if(!Array.isArray(nt.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");for(at.int32Data=[],ct=0;ct<nt.int32Data.length;++ct)at.int32Data[ct]=0|nt.int32Data[ct]}if(nt.stringData){if(!Array.isArray(nt.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");for(at.stringData=[],ct=0;ct<nt.stringData.length;++ct)typeof nt.stringData[ct]=="string"?st.base64.decode(nt.stringData[ct],at.stringData[ct]=st.newBuffer(st.base64.length(nt.stringData[ct])),0):nt.stringData[ct].length&&(at.stringData[ct]=nt.stringData[ct])}if(nt.int64Data){if(!Array.isArray(nt.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");for(at.int64Data=[],ct=0;ct<nt.int64Data.length;++ct)st.Long?(at.int64Data[ct]=st.Long.fromValue(nt.int64Data[ct])).unsigned=!1:typeof nt.int64Data[ct]=="string"?at.int64Data[ct]=parseInt(nt.int64Data[ct],10):typeof nt.int64Data[ct]=="number"?at.int64Data[ct]=nt.int64Data[ct]:typeof nt.int64Data[ct]=="object"&&(at.int64Data[ct]=new st.LongBits(nt.int64Data[ct].low>>>0,nt.int64Data[ct].high>>>0).toNumber())}if(nt.name!=null&&(at.name=String(nt.name)),nt.docString!=null&&(at.docString=String(nt.docString)),nt.rawData!=null&&(typeof nt.rawData=="string"?st.base64.decode(nt.rawData,at.rawData=st.newBuffer(st.base64.length(nt.rawData)),0):nt.rawData.length&&(at.rawData=nt.rawData)),nt.externalData){if(!Array.isArray(nt.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");for(at.externalData=[],ct=0;ct<nt.externalData.length;++ct){if(typeof nt.externalData[ct]!="object")throw TypeError(".onnx.TensorProto.externalData: object expected");at.externalData[ct]=ot.onnx.StringStringEntryProto.fromObject(nt.externalData[ct])}}switch(nt.dataLocation){case"DEFAULT":case 0:at.dataLocation=0;break;case"EXTERNAL":case 1:at.dataLocation=1}if(nt.doubleData){if(!Array.isArray(nt.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");for(at.doubleData=[],ct=0;ct<nt.doubleData.length;++ct)at.doubleData[ct]=Number(nt.doubleData[ct])}if(nt.uint64Data){if(!Array.isArray(nt.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");for(at.uint64Data=[],ct=0;ct<nt.uint64Data.length;++ct)st.Long?(at.uint64Data[ct]=st.Long.fromValue(nt.uint64Data[ct])).unsigned=!0:typeof nt.uint64Data[ct]=="string"?at.uint64Data[ct]=parseInt(nt.uint64Data[ct],10):typeof nt.uint64Data[ct]=="number"?at.uint64Data[ct]=nt.uint64Data[ct]:typeof nt.uint64Data[ct]=="object"&&(at.uint64Data[ct]=new st.LongBits(nt.uint64Data[ct].low>>>0,nt.uint64Data[ct].high>>>0).toNumber(!0))}return at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.dims=[],ct.floatData=[],ct.int32Data=[],ct.stringData=[],ct.int64Data=[],ct.doubleData=[],ct.uint64Data=[],ct.externalData=[]),at.defaults&&(ct.dataType=0,ct.segment=null,ct.name="",at.bytes===String?ct.rawData="":(ct.rawData=[],at.bytes!==Array&&(ct.rawData=st.newBuffer(ct.rawData))),ct.docString="",ct.dataLocation=at.enums===String?"DEFAULT":0),nt.dims&&nt.dims.length){ct.dims=[];for(var ut=0;ut<nt.dims.length;++ut)typeof nt.dims[ut]=="number"?ct.dims[ut]=at.longs===String?String(nt.dims[ut]):nt.dims[ut]:ct.dims[ut]=at.longs===String?st.Long.prototype.toString.call(nt.dims[ut]):at.longs===Number?new st.LongBits(nt.dims[ut].low>>>0,nt.dims[ut].high>>>0).toNumber():nt.dims[ut]}if(nt.dataType!=null&&nt.hasOwnProperty("dataType")&&(ct.dataType=nt.dataType),nt.segment!=null&&nt.hasOwnProperty("segment")&&(ct.segment=ot.onnx.TensorProto.Segment.toObject(nt.segment,at)),nt.floatData&&nt.floatData.length)for(ct.floatData=[],ut=0;ut<nt.floatData.length;++ut)ct.floatData[ut]=at.json&&!isFinite(nt.floatData[ut])?String(nt.floatData[ut]):nt.floatData[ut];if(nt.int32Data&&nt.int32Data.length)for(ct.int32Data=[],ut=0;ut<nt.int32Data.length;++ut)ct.int32Data[ut]=nt.int32Data[ut];if(nt.stringData&&nt.stringData.length)for(ct.stringData=[],ut=0;ut<nt.stringData.length;++ut)ct.stringData[ut]=at.bytes===String?st.base64.encode(nt.stringData[ut],0,nt.stringData[ut].length):at.bytes===Array?Array.prototype.slice.call(nt.stringData[ut]):nt.stringData[ut];if(nt.int64Data&&nt.int64Data.length)for(ct.int64Data=[],ut=0;ut<nt.int64Data.length;++ut)typeof nt.int64Data[ut]=="number"?ct.int64Data[ut]=at.longs===String?String(nt.int64Data[ut]):nt.int64Data[ut]:ct.int64Data[ut]=at.longs===String?st.Long.prototype.toString.call(nt.int64Data[ut]):at.longs===Number?new st.LongBits(nt.int64Data[ut].low>>>0,nt.int64Data[ut].high>>>0).toNumber():nt.int64Data[ut];if(nt.name!=null&&nt.hasOwnProperty("name")&&(ct.name=nt.name),nt.rawData!=null&&nt.hasOwnProperty("rawData")&&(ct.rawData=at.bytes===String?st.base64.encode(nt.rawData,0,nt.rawData.length):at.bytes===Array?Array.prototype.slice.call(nt.rawData):nt.rawData),nt.doubleData&&nt.doubleData.length)for(ct.doubleData=[],ut=0;ut<nt.doubleData.length;++ut)ct.doubleData[ut]=at.json&&!isFinite(nt.doubleData[ut])?String(nt.doubleData[ut]):nt.doubleData[ut];if(nt.uint64Data&&nt.uint64Data.length)for(ct.uint64Data=[],ut=0;ut<nt.uint64Data.length;++ut)typeof nt.uint64Data[ut]=="number"?ct.uint64Data[ut]=at.longs===String?String(nt.uint64Data[ut]):nt.uint64Data[ut]:ct.uint64Data[ut]=at.longs===String?st.Long.prototype.toString.call(nt.uint64Data[ut]):at.longs===Number?new st.LongBits(nt.uint64Data[ut].low>>>0,nt.uint64Data[ut].high>>>0).toNumber(!0):nt.uint64Data[ut];if(nt.docString!=null&&nt.hasOwnProperty("docString")&&(ct.docString=nt.docString),nt.externalData&&nt.externalData.length)for(ct.externalData=[],ut=0;ut<nt.externalData.length;++ut)ct.externalData[ut]=ot.onnx.StringStringEntryProto.toObject(nt.externalData[ut],at);return nt.dataLocation!=null&&nt.hasOwnProperty("dataLocation")&&(ct.dataLocation=at.enums===String?ot.onnx.TensorProto.DataLocation[nt.dataLocation]:nt.dataLocation),ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt.DataType=(function(){var nt={},at=Object.create(nt);return at[nt[0]="UNDEFINED"]=0,at[nt[1]="FLOAT"]=1,at[nt[2]="UINT8"]=2,at[nt[3]="INT8"]=3,at[nt[4]="UINT16"]=4,at[nt[5]="INT16"]=5,at[nt[6]="INT32"]=6,at[nt[7]="INT64"]=7,at[nt[8]="STRING"]=8,at[nt[9]="BOOL"]=9,at[nt[10]="FLOAT16"]=10,at[nt[11]="DOUBLE"]=11,at[nt[12]="UINT32"]=12,at[nt[13]="UINT64"]=13,at[nt[14]="COMPLEX64"]=14,at[nt[15]="COMPLEX128"]=15,at[nt[16]="BFLOAT16"]=16,at})(),rt.Segment=(function(){function nt(at){if(at)for(var ct=Object.keys(at),ut=0;ut<ct.length;++ut)at[ct[ut]]!=null&&(this[ct[ut]]=at[ct[ut]])}return nt.prototype.begin=st.Long?st.Long.fromBits(0,0,!1):0,nt.prototype.end=st.Long?st.Long.fromBits(0,0,!1):0,nt.create=function(at){return new nt(at)},nt.encode=function(at,ct){return ct||(ct=it.create()),at.begin!=null&&at.hasOwnProperty("begin")&&ct.uint32(8).int64(at.begin),at.end!=null&&at.hasOwnProperty("end")&&ct.uint32(16).int64(at.end),ct},nt.encodeDelimited=function(at,ct){return this.encode(at,ct).ldelim()},nt.decode=function(at,ct){at instanceof tt||(at=tt.create(at));for(var ut=ct===void 0?at.len:at.pos+ct,dt=new ot.onnx.TensorProto.Segment;at.pos<ut;){var ht=at.uint32();switch(ht>>>3){case 1:dt.begin=at.int64();break;case 2:dt.end=at.int64();break;default:at.skipType(7&ht)}}return dt},nt.decodeDelimited=function(at){return at instanceof tt||(at=new tt(at)),this.decode(at,at.uint32())},nt.verify=function(at){return typeof at!="object"||at===null?"object expected":at.begin!=null&&at.hasOwnProperty("begin")&&!(st.isInteger(at.begin)||at.begin&&st.isInteger(at.begin.low)&&st.isInteger(at.begin.high))?"begin: integer|Long expected":at.end!=null&&at.hasOwnProperty("end")&&!(st.isInteger(at.end)||at.end&&st.isInteger(at.end.low)&&st.isInteger(at.end.high))?"end: integer|Long expected":null},nt.fromObject=function(at){if(at instanceof ot.onnx.TensorProto.Segment)return at;var ct=new ot.onnx.TensorProto.Segment;return at.begin!=null&&(st.Long?(ct.begin=st.Long.fromValue(at.begin)).unsigned=!1:typeof at.begin=="string"?ct.begin=parseInt(at.begin,10):typeof at.begin=="number"?ct.begin=at.begin:typeof at.begin=="object"&&(ct.begin=new st.LongBits(at.begin.low>>>0,at.begin.high>>>0).toNumber())),at.end!=null&&(st.Long?(ct.end=st.Long.fromValue(at.end)).unsigned=!1:typeof at.end=="string"?ct.end=parseInt(at.end,10):typeof at.end=="number"?ct.end=at.end:typeof at.end=="object"&&(ct.end=new st.LongBits(at.end.low>>>0,at.end.high>>>0).toNumber())),ct},nt.toObject=function(at,ct){ct||(ct={});var ut={};if(ct.defaults){if(st.Long){var dt=new st.Long(0,0,!1);ut.begin=ct.longs===String?dt.toString():ct.longs===Number?dt.toNumber():dt}else ut.begin=ct.longs===String?"0":0;st.Long?(dt=new st.Long(0,0,!1),ut.end=ct.longs===String?dt.toString():ct.longs===Number?dt.toNumber():dt):ut.end=ct.longs===String?"0":0}return at.begin!=null&&at.hasOwnProperty("begin")&&(typeof at.begin=="number"?ut.begin=ct.longs===String?String(at.begin):at.begin:ut.begin=ct.longs===String?st.Long.prototype.toString.call(at.begin):ct.longs===Number?new st.LongBits(at.begin.low>>>0,at.begin.high>>>0).toNumber():at.begin),at.end!=null&&at.hasOwnProperty("end")&&(typeof at.end=="number"?ut.end=ct.longs===String?String(at.end):at.end:ut.end=ct.longs===String?st.Long.prototype.toString.call(at.end):ct.longs===Number?new st.LongBits(at.end.low>>>0,at.end.high>>>0).toNumber():at.end),ut},nt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},nt})(),rt.DataLocation=(function(){var nt={},at=Object.create(nt);return at[nt[0]="DEFAULT"]=0,at[nt[1]="EXTERNAL"]=1,at})(),rt})(),xe.TensorShapeProto=(function(){function rt(nt){if(this.dim=[],nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.dim=st.emptyArray,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){if(at||(at=it.create()),nt.dim!=null&&nt.dim.length)for(var ct=0;ct<nt.dim.length;++ct)ot.onnx.TensorShapeProto.Dimension.encode(nt.dim[ct],at.uint32(10).fork()).ldelim();return at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.TensorShapeProto;nt.pos<ct;){var dt=nt.uint32();dt>>>3==1?(ut.dim&&ut.dim.length||(ut.dim=[]),ut.dim.push(ot.onnx.TensorShapeProto.Dimension.decode(nt,nt.uint32()))):nt.skipType(7&dt)}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){if(typeof nt!="object"||nt===null)return"object expected";if(nt.dim!=null&&nt.hasOwnProperty("dim")){if(!Array.isArray(nt.dim))return"dim: array expected";for(var at=0;at<nt.dim.length;++at){var ct=ot.onnx.TensorShapeProto.Dimension.verify(nt.dim[at]);if(ct)return"dim."+ct}}return null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.TensorShapeProto)return nt;var at=new ot.onnx.TensorShapeProto;if(nt.dim){if(!Array.isArray(nt.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");at.dim=[];for(var ct=0;ct<nt.dim.length;++ct){if(typeof nt.dim[ct]!="object")throw TypeError(".onnx.TensorShapeProto.dim: object expected");at.dim[ct]=ot.onnx.TensorShapeProto.Dimension.fromObject(nt.dim[ct])}}return at},rt.toObject=function(nt,at){at||(at={});var ct={};if((at.arrays||at.defaults)&&(ct.dim=[]),nt.dim&&nt.dim.length){ct.dim=[];for(var ut=0;ut<nt.dim.length;++ut)ct.dim[ut]=ot.onnx.TensorShapeProto.Dimension.toObject(nt.dim[ut],at)}return ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt.Dimension=(function(){function nt(ct){if(ct)for(var ut=Object.keys(ct),dt=0;dt<ut.length;++dt)ct[ut[dt]]!=null&&(this[ut[dt]]=ct[ut[dt]])}var at;return nt.prototype.dimValue=st.Long?st.Long.fromBits(0,0,!1):0,nt.prototype.dimParam="",nt.prototype.denotation="",Object.defineProperty(nt.prototype,"value",{get:st.oneOfGetter(at=["dimValue","dimParam"]),set:st.oneOfSetter(at)}),nt.create=function(ct){return new nt(ct)},nt.encode=function(ct,ut){return ut||(ut=it.create()),ct.dimValue!=null&&ct.hasOwnProperty("dimValue")&&ut.uint32(8).int64(ct.dimValue),ct.dimParam!=null&&ct.hasOwnProperty("dimParam")&&ut.uint32(18).string(ct.dimParam),ct.denotation!=null&&ct.hasOwnProperty("denotation")&&ut.uint32(26).string(ct.denotation),ut},nt.encodeDelimited=function(ct,ut){return this.encode(ct,ut).ldelim()},nt.decode=function(ct,ut){ct instanceof tt||(ct=tt.create(ct));for(var dt=ut===void 0?ct.len:ct.pos+ut,ht=new ot.onnx.TensorShapeProto.Dimension;ct.pos<dt;){var pt=ct.uint32();switch(pt>>>3){case 1:ht.dimValue=ct.int64();break;case 2:ht.dimParam=ct.string();break;case 3:ht.denotation=ct.string();break;default:ct.skipType(7&pt)}}return ht},nt.decodeDelimited=function(ct){return ct instanceof tt||(ct=new tt(ct)),this.decode(ct,ct.uint32())},nt.verify=function(ct){if(typeof ct!="object"||ct===null)return"object expected";var ut={};if(ct.dimValue!=null&&ct.hasOwnProperty("dimValue")&&(ut.value=1,!(st.isInteger(ct.dimValue)||ct.dimValue&&st.isInteger(ct.dimValue.low)&&st.isInteger(ct.dimValue.high))))return"dimValue: integer|Long expected";if(ct.dimParam!=null&&ct.hasOwnProperty("dimParam")){if(ut.value===1)return"value: multiple values";if(ut.value=1,!st.isString(ct.dimParam))return"dimParam: string expected"}return ct.denotation!=null&&ct.hasOwnProperty("denotation")&&!st.isString(ct.denotation)?"denotation: string expected":null},nt.fromObject=function(ct){if(ct instanceof ot.onnx.TensorShapeProto.Dimension)return ct;var ut=new ot.onnx.TensorShapeProto.Dimension;return ct.dimValue!=null&&(st.Long?(ut.dimValue=st.Long.fromValue(ct.dimValue)).unsigned=!1:typeof ct.dimValue=="string"?ut.dimValue=parseInt(ct.dimValue,10):typeof ct.dimValue=="number"?ut.dimValue=ct.dimValue:typeof ct.dimValue=="object"&&(ut.dimValue=new st.LongBits(ct.dimValue.low>>>0,ct.dimValue.high>>>0).toNumber())),ct.dimParam!=null&&(ut.dimParam=String(ct.dimParam)),ct.denotation!=null&&(ut.denotation=String(ct.denotation)),ut},nt.toObject=function(ct,ut){ut||(ut={});var dt={};return ut.defaults&&(dt.denotation=""),ct.dimValue!=null&&ct.hasOwnProperty("dimValue")&&(typeof ct.dimValue=="number"?dt.dimValue=ut.longs===String?String(ct.dimValue):ct.dimValue:dt.dimValue=ut.longs===String?st.Long.prototype.toString.call(ct.dimValue):ut.longs===Number?new st.LongBits(ct.dimValue.low>>>0,ct.dimValue.high>>>0).toNumber():ct.dimValue,ut.oneofs&&(dt.value="dimValue")),ct.dimParam!=null&&ct.hasOwnProperty("dimParam")&&(dt.dimParam=ct.dimParam,ut.oneofs&&(dt.value="dimParam")),ct.denotation!=null&&ct.hasOwnProperty("denotation")&&(dt.denotation=ct.denotation),dt},nt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},nt})(),rt})(),xe.TypeProto=(function(){function rt(at){if(at)for(var ct=Object.keys(at),ut=0;ut<ct.length;++ut)at[ct[ut]]!=null&&(this[ct[ut]]=at[ct[ut]])}var nt;return rt.prototype.tensorType=null,rt.prototype.denotation="",Object.defineProperty(rt.prototype,"value",{get:st.oneOfGetter(nt=["tensorType"]),set:st.oneOfSetter(nt)}),rt.create=function(at){return new rt(at)},rt.encode=function(at,ct){return ct||(ct=it.create()),at.tensorType!=null&&at.hasOwnProperty("tensorType")&&ot.onnx.TypeProto.Tensor.encode(at.tensorType,ct.uint32(10).fork()).ldelim(),at.denotation!=null&&at.hasOwnProperty("denotation")&&ct.uint32(50).string(at.denotation),ct},rt.encodeDelimited=function(at,ct){return this.encode(at,ct).ldelim()},rt.decode=function(at,ct){at instanceof tt||(at=tt.create(at));for(var ut=ct===void 0?at.len:at.pos+ct,dt=new ot.onnx.TypeProto;at.pos<ut;){var ht=at.uint32();switch(ht>>>3){case 1:dt.tensorType=ot.onnx.TypeProto.Tensor.decode(at,at.uint32());break;case 6:dt.denotation=at.string();break;default:at.skipType(7&ht)}}return dt},rt.decodeDelimited=function(at){return at instanceof tt||(at=new tt(at)),this.decode(at,at.uint32())},rt.verify=function(at){if(typeof at!="object"||at===null)return"object expected";if(at.tensorType!=null&&at.hasOwnProperty("tensorType")){var ct=ot.onnx.TypeProto.Tensor.verify(at.tensorType);if(ct)return"tensorType."+ct}return at.denotation!=null&&at.hasOwnProperty("denotation")&&!st.isString(at.denotation)?"denotation: string expected":null},rt.fromObject=function(at){if(at instanceof ot.onnx.TypeProto)return at;var ct=new ot.onnx.TypeProto;if(at.tensorType!=null){if(typeof at.tensorType!="object")throw TypeError(".onnx.TypeProto.tensorType: object expected");ct.tensorType=ot.onnx.TypeProto.Tensor.fromObject(at.tensorType)}return at.denotation!=null&&(ct.denotation=String(at.denotation)),ct},rt.toObject=function(at,ct){ct||(ct={});var ut={};return ct.defaults&&(ut.denotation=""),at.tensorType!=null&&at.hasOwnProperty("tensorType")&&(ut.tensorType=ot.onnx.TypeProto.Tensor.toObject(at.tensorType,ct),ct.oneofs&&(ut.value="tensorType")),at.denotation!=null&&at.hasOwnProperty("denotation")&&(ut.denotation=at.denotation),ut},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt.Tensor=(function(){function at(ct){if(ct)for(var ut=Object.keys(ct),dt=0;dt<ut.length;++dt)ct[ut[dt]]!=null&&(this[ut[dt]]=ct[ut[dt]])}return at.prototype.elemType=0,at.prototype.shape=null,at.create=function(ct){return new at(ct)},at.encode=function(ct,ut){return ut||(ut=it.create()),ct.elemType!=null&&ct.hasOwnProperty("elemType")&&ut.uint32(8).int32(ct.elemType),ct.shape!=null&&ct.hasOwnProperty("shape")&&ot.onnx.TensorShapeProto.encode(ct.shape,ut.uint32(18).fork()).ldelim(),ut},at.encodeDelimited=function(ct,ut){return this.encode(ct,ut).ldelim()},at.decode=function(ct,ut){ct instanceof tt||(ct=tt.create(ct));for(var dt=ut===void 0?ct.len:ct.pos+ut,ht=new ot.onnx.TypeProto.Tensor;ct.pos<dt;){var pt=ct.uint32();switch(pt>>>3){case 1:ht.elemType=ct.int32();break;case 2:ht.shape=ot.onnx.TensorShapeProto.decode(ct,ct.uint32());break;default:ct.skipType(7&pt)}}return ht},at.decodeDelimited=function(ct){return ct instanceof tt||(ct=new tt(ct)),this.decode(ct,ct.uint32())},at.verify=function(ct){if(typeof ct!="object"||ct===null)return"object expected";if(ct.elemType!=null&&ct.hasOwnProperty("elemType")&&!st.isInteger(ct.elemType))return"elemType: integer expected";if(ct.shape!=null&&ct.hasOwnProperty("shape")){var ut=ot.onnx.TensorShapeProto.verify(ct.shape);if(ut)return"shape."+ut}return null},at.fromObject=function(ct){if(ct instanceof ot.onnx.TypeProto.Tensor)return ct;var ut=new ot.onnx.TypeProto.Tensor;if(ct.elemType!=null&&(ut.elemType=0|ct.elemType),ct.shape!=null){if(typeof ct.shape!="object")throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");ut.shape=ot.onnx.TensorShapeProto.fromObject(ct.shape)}return ut},at.toObject=function(ct,ut){ut||(ut={});var dt={};return ut.defaults&&(dt.elemType=0,dt.shape=null),ct.elemType!=null&&ct.hasOwnProperty("elemType")&&(dt.elemType=ct.elemType),ct.shape!=null&&ct.hasOwnProperty("shape")&&(dt.shape=ot.onnx.TensorShapeProto.toObject(ct.shape,ut)),dt},at.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},at})(),rt})(),xe.OperatorSetIdProto=(function(){function rt(nt){if(nt)for(var at=Object.keys(nt),ct=0;ct<at.length;++ct)nt[at[ct]]!=null&&(this[at[ct]]=nt[at[ct]])}return rt.prototype.domain="",rt.prototype.version=st.Long?st.Long.fromBits(0,0,!1):0,rt.create=function(nt){return new rt(nt)},rt.encode=function(nt,at){return at||(at=it.create()),nt.domain!=null&&nt.hasOwnProperty("domain")&&at.uint32(10).string(nt.domain),nt.version!=null&&nt.hasOwnProperty("version")&&at.uint32(16).int64(nt.version),at},rt.encodeDelimited=function(nt,at){return this.encode(nt,at).ldelim()},rt.decode=function(nt,at){nt instanceof tt||(nt=tt.create(nt));for(var ct=at===void 0?nt.len:nt.pos+at,ut=new ot.onnx.OperatorSetIdProto;nt.pos<ct;){var dt=nt.uint32();switch(dt>>>3){case 1:ut.domain=nt.string();break;case 2:ut.version=nt.int64();break;default:nt.skipType(7&dt)}}return ut},rt.decodeDelimited=function(nt){return nt instanceof tt||(nt=new tt(nt)),this.decode(nt,nt.uint32())},rt.verify=function(nt){return typeof nt!="object"||nt===null?"object expected":nt.domain!=null&&nt.hasOwnProperty("domain")&&!st.isString(nt.domain)?"domain: string expected":nt.version!=null&&nt.hasOwnProperty("version")&&!(st.isInteger(nt.version)||nt.version&&st.isInteger(nt.version.low)&&st.isInteger(nt.version.high))?"version: integer|Long expected":null},rt.fromObject=function(nt){if(nt instanceof ot.onnx.OperatorSetIdProto)return nt;var at=new ot.onnx.OperatorSetIdProto;return nt.domain!=null&&(at.domain=String(nt.domain)),nt.version!=null&&(st.Long?(at.version=st.Long.fromValue(nt.version)).unsigned=!1:typeof nt.version=="string"?at.version=parseInt(nt.version,10):typeof nt.version=="number"?at.version=nt.version:typeof nt.version=="object"&&(at.version=new st.LongBits(nt.version.low>>>0,nt.version.high>>>0).toNumber())),at},rt.toObject=function(nt,at){at||(at={});var ct={};if(at.defaults)if(ct.domain="",st.Long){var ut=new st.Long(0,0,!1);ct.version=at.longs===String?ut.toString():at.longs===Number?ut.toNumber():ut}else ct.version=at.longs===String?"0":0;return nt.domain!=null&&nt.hasOwnProperty("domain")&&(ct.domain=nt.domain),nt.version!=null&&nt.hasOwnProperty("version")&&(typeof nt.version=="number"?ct.version=at.longs===String?String(nt.version):nt.version:ct.version=at.longs===String?st.Long.prototype.toString.call(nt.version):at.longs===Number?new st.LongBits(nt.version.low>>>0,nt.version.high>>>0).toNumber():nt.version),ct},rt.prototype.toJSON=function(){return this.constructor.toObject(this,et.util.toJSONOptions)},rt})(),xe),ee.exports=ot},2100:(ee,O,Y)=>{ee.exports=Y(9482)},9482:(ee,O,Y)=>{var te=O;function ne(){te.util._configure(),te.Writer._configure(te.BufferWriter),te.Reader._configure(te.BufferReader)}te.build="minimal",te.Writer=Y(1173),te.BufferWriter=Y(3155),te.Reader=Y(1408),te.BufferReader=Y(593),te.util=Y(9693),te.rpc=Y(5994),te.roots=Y(5054),te.configure=ne,ne()},1408:(ee,O,Y)=>{ee.exports=it;var te,ne=Y(9693),xe=ne.LongBits,et=ne.utf8;function tt(ut,dt){return RangeError("index out of range: "+ut.pos+" + "+(dt||1)+" > "+ut.len)}function it(ut){this.buf=ut,this.pos=0,this.len=ut.length}var st,ot=typeof Uint8Array<"u"?function(ut){if(ut instanceof Uint8Array||Array.isArray(ut))return new it(ut);throw Error("illegal buffer")}:function(ut){if(Array.isArray(ut))return new it(ut);throw Error("illegal buffer")},rt=function(){return ne.Buffer?function(ut){return(it.create=function(dt){return ne.Buffer.isBuffer(dt)?new te(dt):ot(dt)})(ut)}:ot};function nt(){var ut=new xe(0,0),dt=0;if(!(this.len-this.pos>4)){for(;dt<3;++dt){if(this.pos>=this.len)throw tt(this);if(ut.lo=(ut.lo|(127&this.buf[this.pos])<<7*dt)>>>0,this.buf[this.pos++]<128)return ut}return ut.lo=(ut.lo|(127&this.buf[this.pos++])<<7*dt)>>>0,ut}for(;dt<4;++dt)if(ut.lo=(ut.lo|(127&this.buf[this.pos])<<7*dt)>>>0,this.buf[this.pos++]<128)return ut;if(ut.lo=(ut.lo|(127&this.buf[this.pos])<<28)>>>0,ut.hi=(ut.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return ut;if(dt=0,this.len-this.pos>4){for(;dt<5;++dt)if(ut.hi=(ut.hi|(127&this.buf[this.pos])<<7*dt+3)>>>0,this.buf[this.pos++]<128)return ut}else for(;dt<5;++dt){if(this.pos>=this.len)throw tt(this);if(ut.hi=(ut.hi|(127&this.buf[this.pos])<<7*dt+3)>>>0,this.buf[this.pos++]<128)return ut}throw Error("invalid varint encoding")}function at(ut,dt){return(ut[dt-4]|ut[dt-3]<<8|ut[dt-2]<<16|ut[dt-1]<<24)>>>0}function ct(){if(this.pos+8>this.len)throw tt(this,8);return new xe(at(this.buf,this.pos+=4),at(this.buf,this.pos+=4))}it.create=rt(),it.prototype._slice=ne.Array.prototype.subarray||ne.Array.prototype.slice,it.prototype.uint32=(st=4294967295,function(){if(st=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(st=(st|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(st=(st|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(st=(st|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(st=(st|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return st;if((this.pos+=5)>this.len)throw this.pos=this.len,tt(this,10);return st}),it.prototype.int32=function(){return 0|this.uint32()},it.prototype.sint32=function(){var ut=this.uint32();return ut>>>1^-(1&ut)|0},it.prototype.bool=function(){return this.uint32()!==0},it.prototype.fixed32=function(){if(this.pos+4>this.len)throw tt(this,4);return at(this.buf,this.pos+=4)},it.prototype.sfixed32=function(){if(this.pos+4>this.len)throw tt(this,4);return 0|at(this.buf,this.pos+=4)},it.prototype.float=function(){if(this.pos+4>this.len)throw tt(this,4);var ut=ne.float.readFloatLE(this.buf,this.pos);return this.pos+=4,ut},it.prototype.double=function(){if(this.pos+8>this.len)throw tt(this,4);var ut=ne.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,ut},it.prototype.bytes=function(){var ut=this.uint32(),dt=this.pos,ht=this.pos+ut;if(ht>this.len)throw tt(this,ut);return this.pos+=ut,Array.isArray(this.buf)?this.buf.slice(dt,ht):dt===ht?new this.buf.constructor(0):this._slice.call(this.buf,dt,ht)},it.prototype.string=function(){var ut=this.bytes();return et.read(ut,0,ut.length)},it.prototype.skip=function(ut){if(typeof ut=="number"){if(this.pos+ut>this.len)throw tt(this,ut);this.pos+=ut}else do if(this.pos>=this.len)throw tt(this);while(128&this.buf[this.pos++]);return this},it.prototype.skipType=function(ut){switch(ut){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(ut=7&this.uint32())!=4;)this.skipType(ut);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+ut+" at offset "+this.pos)}return this},it._configure=function(ut){te=ut,it.create=rt(),te._configure();var dt=ne.Long?"toLong":"toNumber";ne.merge(it.prototype,{int64:function(){return nt.call(this)[dt](!1)},uint64:function(){return nt.call(this)[dt](!0)},sint64:function(){return nt.call(this).zzDecode()[dt](!1)},fixed64:function(){return ct.call(this)[dt](!0)},sfixed64:function(){return ct.call(this)[dt](!1)}})}},593:(ee,O,Y)=>{ee.exports=xe;var te=Y(1408);(xe.prototype=Object.create(te.prototype)).constructor=xe;var ne=Y(9693);function xe(et){te.call(this,et)}xe._configure=function(){ne.Buffer&&(xe.prototype._slice=ne.Buffer.prototype.slice)},xe.prototype.string=function(){var et=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+et,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+et,this.len))},xe._configure()},5054:ee=>{ee.exports={}},5994:(ee,O,Y)=>{O.Service=Y(7948)},7948:(ee,O,Y)=>{ee.exports=ne;var te=Y(9693);function ne(xe,et,tt){if(typeof xe!="function")throw TypeError("rpcImpl must be a function");te.EventEmitter.call(this),this.rpcImpl=xe,this.requestDelimited=!!et,this.responseDelimited=!!tt}(ne.prototype=Object.create(te.EventEmitter.prototype)).constructor=ne,ne.prototype.rpcCall=function xe(et,tt,it,st,ot){if(!st)throw TypeError("request must be specified");var rt=this;if(!ot)return te.asPromise(xe,rt,et,tt,it,st);if(rt.rpcImpl)try{return rt.rpcImpl(et,tt[rt.requestDelimited?"encodeDelimited":"encode"](st).finish(),(function(nt,at){if(nt)return rt.emit("error",nt,et),ot(nt);if(at!==null){if(!(at instanceof it))try{at=it[rt.responseDelimited?"decodeDelimited":"decode"](at)}catch(ct){return rt.emit("error",ct,et),ot(ct)}return rt.emit("data",at,et),ot(null,at)}rt.end(!0)}))}catch(nt){return rt.emit("error",nt,et),void setTimeout((function(){ot(nt)}),0)}else setTimeout((function(){ot(Error("already ended"))}),0)},ne.prototype.end=function(xe){return this.rpcImpl&&(xe||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:(ee,O,Y)=>{ee.exports=ne;var te=Y(9693);function ne(it,st){this.lo=it>>>0,this.hi=st>>>0}var xe=ne.zero=new ne(0,0);xe.toNumber=function(){return 0},xe.zzEncode=xe.zzDecode=function(){return this},xe.length=function(){return 1};var et=ne.zeroHash="\0\0\0\0\0\0\0\0";ne.fromNumber=function(it){if(it===0)return xe;var st=it<0;st&&(it=-it);var ot=it>>>0,rt=(it-ot)/4294967296>>>0;return st&&(rt=~rt>>>0,ot=~ot>>>0,++ot>4294967295&&(ot=0,++rt>4294967295&&(rt=0))),new ne(ot,rt)},ne.from=function(it){if(typeof it=="number")return ne.fromNumber(it);if(te.isString(it)){if(!te.Long)return ne.fromNumber(parseInt(it,10));it=te.Long.fromString(it)}return it.low||it.high?new ne(it.low>>>0,it.high>>>0):xe},ne.prototype.toNumber=function(it){if(!it&&this.hi>>>31){var st=1+~this.lo>>>0,ot=~this.hi>>>0;return st||(ot=ot+1>>>0),-(st+4294967296*ot)}return this.lo+4294967296*this.hi},ne.prototype.toLong=function(it){return te.Long?new te.Long(0|this.lo,0|this.hi,!!it):{low:0|this.lo,high:0|this.hi,unsigned:!!it}};var tt=String.prototype.charCodeAt;ne.fromHash=function(it){return it===et?xe:new ne((tt.call(it,0)|tt.call(it,1)<<8|tt.call(it,2)<<16|tt.call(it,3)<<24)>>>0,(tt.call(it,4)|tt.call(it,5)<<8|tt.call(it,6)<<16|tt.call(it,7)<<24)>>>0)},ne.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},ne.prototype.zzEncode=function(){var it=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^it)>>>0,this.lo=(this.lo<<1^it)>>>0,this},ne.prototype.zzDecode=function(){var it=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^it)>>>0,this.hi=(this.hi>>>1^it)>>>0,this},ne.prototype.length=function(){var it=this.lo,st=(this.lo>>>28|this.hi<<4)>>>0,ot=this.hi>>>24;return ot===0?st===0?it<16384?it<128?1:2:it<2097152?3:4:st<16384?st<128?5:6:st<2097152?7:8:ot<128?9:10}},9693:function(ee,O,Y){var te=O;function ne(et,tt,it){for(var st=Object.keys(tt),ot=0;ot<st.length;++ot)et[st[ot]]!==void 0&&it||(et[st[ot]]=tt[st[ot]]);return et}function xe(et){function tt(it,st){if(!(this instanceof tt))return new tt(it,st);Object.defineProperty(this,"message",{get:function(){return it}}),Error.captureStackTrace?Error.captureStackTrace(this,tt):Object.defineProperty(this,"stack",{value:new Error().stack||""}),st&&ne(this,st)}return(tt.prototype=Object.create(Error.prototype)).constructor=tt,Object.defineProperty(tt.prototype,"name",{get:function(){return et}}),tt.prototype.toString=function(){return this.name+": "+this.message},tt}te.asPromise=Y(4537),te.base64=Y(7419),te.EventEmitter=Y(9211),te.float=Y(945),te.inquire=Y(7199),te.utf8=Y(4997),te.pool=Y(6662),te.LongBits=Y(1945),te.isNode=!!(Y.g!==void 0&&Y.g&&Y.g.process&&Y.g.process.versions&&Y.g.process.versions.node),te.global=te.isNode&&Y.g||typeof window<"u"&&window||typeof self<"u"&&self||this,te.emptyArray=Object.freeze?Object.freeze([]):[],te.emptyObject=Object.freeze?Object.freeze({}):{},te.isInteger=Number.isInteger||function(et){return typeof et=="number"&&isFinite(et)&&Math.floor(et)===et},te.isString=function(et){return typeof et=="string"||et instanceof String},te.isObject=function(et){return et&&typeof et=="object"},te.isset=te.isSet=function(et,tt){var it=et[tt];return!(it==null||!et.hasOwnProperty(tt))&&(typeof it!="object"||(Array.isArray(it)?it.length:Object.keys(it).length)>0)},te.Buffer=(function(){try{var et=te.inquire("buffer").Buffer;return et.prototype.utf8Write?et:null}catch{return null}})(),te._Buffer_from=null,te._Buffer_allocUnsafe=null,te.newBuffer=function(et){return typeof et=="number"?te.Buffer?te._Buffer_allocUnsafe(et):new te.Array(et):te.Buffer?te._Buffer_from(et):typeof Uint8Array>"u"?et:new Uint8Array(et)},te.Array=typeof Uint8Array<"u"?Uint8Array:Array,te.Long=te.global.dcodeIO&&te.global.dcodeIO.Long||te.global.Long||te.inquire("long"),te.key2Re=/^true|false|0|1$/,te.key32Re=/^-?(?:0|[1-9][0-9]*)$/,te.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,te.longToHash=function(et){return et?te.LongBits.from(et).toHash():te.LongBits.zeroHash},te.longFromHash=function(et,tt){var it=te.LongBits.fromHash(et);return te.Long?te.Long.fromBits(it.lo,it.hi,tt):it.toNumber(!!tt)},te.merge=ne,te.lcFirst=function(et){return et.charAt(0).toLowerCase()+et.substring(1)},te.newError=xe,te.ProtocolError=xe("ProtocolError"),te.oneOfGetter=function(et){for(var tt={},it=0;it<et.length;++it)tt[et[it]]=1;return function(){for(var st=Object.keys(this),ot=st.length-1;ot>-1;--ot)if(tt[st[ot]]===1&&this[st[ot]]!==void 0&&this[st[ot]]!==null)return st[ot]}},te.oneOfSetter=function(et){return function(tt){for(var it=0;it<et.length;++it)et[it]!==tt&&delete this[et[it]]}},te.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},te._configure=function(){var et=te.Buffer;et?(te._Buffer_from=et.from!==Uint8Array.from&&et.from||function(tt,it){return new et(tt,it)},te._Buffer_allocUnsafe=et.allocUnsafe||function(tt){return new et(tt)}):te._Buffer_from=te._Buffer_allocUnsafe=null}},1173:(ee,O,Y)=>{ee.exports=rt;var te,ne=Y(9693),xe=ne.LongBits,et=ne.base64,tt=ne.utf8;function it(pt,ft,mt){this.fn=pt,this.len=ft,this.next=void 0,this.val=mt}function st(){}function ot(pt){this.head=pt.head,this.tail=pt.tail,this.len=pt.len,this.next=pt.states}function rt(){this.len=0,this.head=new it(st,0,0),this.tail=this.head,this.states=null}var nt=function(){return ne.Buffer?function(){return(rt.create=function(){return new te})()}:function(){return new rt}};function at(pt,ft,mt){ft[mt]=255&pt}function ct(pt,ft){this.len=pt,this.next=void 0,this.val=ft}function ut(pt,ft,mt){for(;pt.hi;)ft[mt++]=127&pt.lo|128,pt.lo=(pt.lo>>>7|pt.hi<<25)>>>0,pt.hi>>>=7;for(;pt.lo>127;)ft[mt++]=127&pt.lo|128,pt.lo=pt.lo>>>7;ft[mt++]=pt.lo}function dt(pt,ft,mt){ft[mt]=255&pt,ft[mt+1]=pt>>>8&255,ft[mt+2]=pt>>>16&255,ft[mt+3]=pt>>>24}rt.create=nt(),rt.alloc=function(pt){return new ne.Array(pt)},ne.Array!==Array&&(rt.alloc=ne.pool(rt.alloc,ne.Array.prototype.subarray)),rt.prototype._push=function(pt,ft,mt){return this.tail=this.tail.next=new it(pt,ft,mt),this.len+=ft,this},ct.prototype=Object.create(it.prototype),ct.prototype.fn=function(pt,ft,mt){for(;pt>127;)ft[mt++]=127&pt|128,pt>>>=7;ft[mt]=pt},rt.prototype.uint32=function(pt){return this.len+=(this.tail=this.tail.next=new ct((pt>>>=0)<128?1:pt<16384?2:pt<2097152?3:pt<268435456?4:5,pt)).len,this},rt.prototype.int32=function(pt){return pt<0?this._push(ut,10,xe.fromNumber(pt)):this.uint32(pt)},rt.prototype.sint32=function(pt){return this.uint32((pt<<1^pt>>31)>>>0)},rt.prototype.uint64=function(pt){var ft=xe.from(pt);return this._push(ut,ft.length(),ft)},rt.prototype.int64=rt.prototype.uint64,rt.prototype.sint64=function(pt){var ft=xe.from(pt).zzEncode();return this._push(ut,ft.length(),ft)},rt.prototype.bool=function(pt){return this._push(at,1,pt?1:0)},rt.prototype.fixed32=function(pt){return this._push(dt,4,pt>>>0)},rt.prototype.sfixed32=rt.prototype.fixed32,rt.prototype.fixed64=function(pt){var ft=xe.from(pt);return this._push(dt,4,ft.lo)._push(dt,4,ft.hi)},rt.prototype.sfixed64=rt.prototype.fixed64,rt.prototype.float=function(pt){return this._push(ne.float.writeFloatLE,4,pt)},rt.prototype.double=function(pt){return this._push(ne.float.writeDoubleLE,8,pt)};var ht=ne.Array.prototype.set?function(pt,ft,mt){ft.set(pt,mt)}:function(pt,ft,mt){for(var yt=0;yt<pt.length;++yt)ft[mt+yt]=pt[yt]};rt.prototype.bytes=function(pt){var ft=pt.length>>>0;if(!ft)return this._push(at,1,0);if(ne.isString(pt)){var mt=rt.alloc(ft=et.length(pt));et.decode(pt,mt,0),pt=mt}return this.uint32(ft)._push(ht,ft,pt)},rt.prototype.string=function(pt){var ft=tt.length(pt);return ft?this.uint32(ft)._push(tt.write,ft,pt):this._push(at,1,0)},rt.prototype.fork=function(){return this.states=new ot(this),this.head=this.tail=new it(st,0,0),this.len=0,this},rt.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new it(st,0,0),this.len=0),this},rt.prototype.ldelim=function(){var pt=this.head,ft=this.tail,mt=this.len;return this.reset().uint32(mt),mt&&(this.tail.next=pt.next,this.tail=ft,this.len+=mt),this},rt.prototype.finish=function(){for(var pt=this.head.next,ft=this.constructor.alloc(this.len),mt=0;pt;)pt.fn(pt.val,ft,mt),mt+=pt.len,pt=pt.next;return ft},rt._configure=function(pt){te=pt,rt.create=nt(),te._configure()}},3155:(ee,O,Y)=>{ee.exports=xe;var te=Y(1173);(xe.prototype=Object.create(te.prototype)).constructor=xe;var ne=Y(9693);function xe(){te.call(this)}function et(tt,it,st){tt.length<40?ne.utf8.write(tt,it,st):it.utf8Write?it.utf8Write(tt,st):it.write(tt,st)}xe._configure=function(){xe.alloc=ne._Buffer_allocUnsafe,xe.writeBytesBuffer=ne.Buffer&&ne.Buffer.prototype instanceof Uint8Array&&ne.Buffer.prototype.set.name==="set"?function(tt,it,st){it.set(tt,st)}:function(tt,it,st){if(tt.copy)tt.copy(it,st,0,tt.length);else for(var ot=0;ot<tt.length;)it[st++]=tt[ot++]}},xe.prototype.bytes=function(tt){ne.isString(tt)&&(tt=ne._Buffer_from(tt,"base64"));var it=tt.length>>>0;return this.uint32(it),it&&this._push(xe.writeBytesBuffer,it,tt),this},xe.prototype.string=function(tt){var it=ne.Buffer.byteLength(tt);return this.uint32(it),it&&this._push(et,it,tt),this},xe._configure()},7714:(ee,O,Y)=>{O.R=void 0;const te=Y(6919),ne=Y(7448);O.R=new class{async init(){}async createSessionHandler(xe,et){const tt=new te.Session(et);return await tt.loadModel(xe),new ne.OnnxjsSessionHandler(tt)}}},4200:(ee,O,Y)=>{O.c8=O.rX=void 0;const te=Y(1670),ne=Y(5381),xe=Y(2157),et=Y(2306);O.rX=()=>{if((typeof te.env.wasm.initTimeout!="number"||te.env.wasm.initTimeout<0)&&(te.env.wasm.initTimeout=0),typeof te.env.wasm.simd!="boolean"&&(te.env.wasm.simd=!0),typeof te.env.wasm.proxy!="boolean"&&(te.env.wasm.proxy=!1),typeof te.env.wasm.numThreads!="number"||!Number.isInteger(te.env.wasm.numThreads)||te.env.wasm.numThreads<=0){const tt=typeof navigator>"u"?(0,ne.cpus)().length:navigator.hardwareConcurrency;te.env.wasm.numThreads=Math.min(4,Math.ceil((tt||1)/2))}},O.c8=new class{async init(){(0,O.rX)(),await(0,xe.initWasm)()}async createSessionHandler(tt,it){const st=new et.OnnxruntimeWebAssemblySessionHandler;return await st.loadModel(tt,it),Promise.resolve(st)}}},6018:function(ee,O,Y){var te=this&&this.__createBinding||(Object.create?function(et,tt,it,st){st===void 0&&(st=it);var ot=Object.getOwnPropertyDescriptor(tt,it);ot&&!("get"in ot?!tt.__esModule:ot.writable||ot.configurable)||(ot={enumerable:!0,get:function(){return tt[it]}}),Object.defineProperty(et,st,ot)}:function(et,tt,it,st){st===void 0&&(st=it),et[st]=tt[it]}),ne=this&&this.__exportStar||function(et,tt){for(var it in et)it==="default"||Object.prototype.hasOwnProperty.call(tt,it)||te(tt,et,it)};Object.defineProperty(O,"__esModule",{value:!0}),ne(Y(1670),O);const xe=Y(1670);{const et=Y(7714).R;(0,xe.registerBackend)("webgl",et,-10)}{const et=Y(4200).c8;(0,xe.registerBackend)("cpu",et,10),(0,xe.registerBackend)("wasm",et,10),(0,xe.registerBackend)("xnnpack",et,9)}},246:(ee,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createAttributeWithCacheKey=void 0;class Y{constructor(ne){Object.assign(this,ne)}get cacheKey(){return this._cacheKey||(this._cacheKey=Object.getOwnPropertyNames(this).sort().map((ne=>`${this[ne]}`)).join(";")),this._cacheKey}}O.createAttributeWithCacheKey=te=>new Y(te)},7778:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.Attribute=void 0;const te=Y(1446),ne=Y(9395),xe=Y(9162),et=Y(2517);var tt=ne.onnxruntime.experimental.fbs;class it{constructor(ot){if(this._attributes=new Map,ot!=null){for(const rt of ot)rt instanceof te.onnx.AttributeProto?this._attributes.set(rt.name,[it.getValue(rt),it.getType(rt)]):rt instanceof tt.Attribute&&this._attributes.set(rt.name(),[it.getValue(rt),it.getType(rt)]);if(this._attributes.size<ot.length)throw new Error("duplicated attribute names")}}set(ot,rt,nt){this._attributes.set(ot,[nt,rt])}delete(ot){this._attributes.delete(ot)}getFloat(ot,rt){return this.get(ot,"float",rt)}getInt(ot,rt){return this.get(ot,"int",rt)}getString(ot,rt){return this.get(ot,"string",rt)}getTensor(ot,rt){return this.get(ot,"tensor",rt)}getFloats(ot,rt){return this.get(ot,"floats",rt)}getInts(ot,rt){return this.get(ot,"ints",rt)}getStrings(ot,rt){return this.get(ot,"strings",rt)}getTensors(ot,rt){return this.get(ot,"tensors",rt)}get(ot,rt,nt){const at=this._attributes.get(ot);if(at===void 0){if(nt!==void 0)return nt;throw new Error(`required attribute not found: ${ot}`)}if(at[1]!==rt)throw new Error(`type mismatch: expected ${rt} but got ${at[1]}`);return at[0]}static getType(ot){const rt=ot instanceof te.onnx.AttributeProto?ot.type:ot.type();switch(rt){case te.onnx.AttributeProto.AttributeType.FLOAT:return"float";case te.onnx.AttributeProto.AttributeType.INT:return"int";case te.onnx.AttributeProto.AttributeType.STRING:return"string";case te.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case te.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case te.onnx.AttributeProto.AttributeType.INTS:return"ints";case te.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case te.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw new Error(`attribute type is not supported yet: ${te.onnx.AttributeProto.AttributeType[rt]}`)}}static getValue(ot){const rt=ot instanceof te.onnx.AttributeProto?ot.type:ot.type();if(rt===te.onnx.AttributeProto.AttributeType.GRAPH||rt===te.onnx.AttributeProto.AttributeType.GRAPHS)throw new Error("graph attribute is not supported yet");const nt=this.getValueNoCheck(ot);if(rt===te.onnx.AttributeProto.AttributeType.INT&&et.LongUtil.isLong(nt))return et.LongUtil.longToNumber(nt);if(rt===te.onnx.AttributeProto.AttributeType.INTS){const at=nt,ct=new Array(at.length);for(let ut=0;ut<at.length;ut++){const dt=at[ut];ct[ut]=et.LongUtil.longToNumber(dt)}return ct}if(rt===te.onnx.AttributeProto.AttributeType.TENSOR)return ot instanceof te.onnx.AttributeProto?xe.Tensor.fromProto(nt):xe.Tensor.fromOrtTensor(nt);if(rt===te.onnx.AttributeProto.AttributeType.TENSORS){if(ot instanceof te.onnx.AttributeProto)return nt.map((at=>xe.Tensor.fromProto(at)));if(ot instanceof tt.Attribute)return nt.map((at=>xe.Tensor.fromOrtTensor(at)))}if(rt===te.onnx.AttributeProto.AttributeType.STRING&&ot instanceof te.onnx.AttributeProto){const at=nt;return(0,et.decodeUtf8String)(at)}return rt===te.onnx.AttributeProto.AttributeType.STRINGS&&ot instanceof te.onnx.AttributeProto?nt.map(et.decodeUtf8String):nt}static getValueNoCheck(ot){return ot instanceof te.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(ot):this.getValueNoCheckFromOrtFormat(ot)}static getValueNoCheckFromOnnxFormat(ot){switch(ot.type){case te.onnx.AttributeProto.AttributeType.FLOAT:return ot.f;case te.onnx.AttributeProto.AttributeType.INT:return ot.i;case te.onnx.AttributeProto.AttributeType.STRING:return ot.s;case te.onnx.AttributeProto.AttributeType.TENSOR:return ot.t;case te.onnx.AttributeProto.AttributeType.GRAPH:return ot.g;case te.onnx.AttributeProto.AttributeType.FLOATS:return ot.floats;case te.onnx.AttributeProto.AttributeType.INTS:return ot.ints;case te.onnx.AttributeProto.AttributeType.STRINGS:return ot.strings;case te.onnx.AttributeProto.AttributeType.TENSORS:return ot.tensors;case te.onnx.AttributeProto.AttributeType.GRAPHS:return ot.graphs;default:throw new Error(`unsupported attribute type: ${te.onnx.AttributeProto.AttributeType[ot.type]}`)}}static getValueNoCheckFromOrtFormat(ot){switch(ot.type()){case tt.AttributeType.FLOAT:return ot.f();case tt.AttributeType.INT:return ot.i();case tt.AttributeType.STRING:return ot.s();case tt.AttributeType.TENSOR:return ot.t();case tt.AttributeType.GRAPH:return ot.g();case tt.AttributeType.FLOATS:return ot.floatsArray();case tt.AttributeType.INTS:{const rt=[];for(let nt=0;nt<ot.intsLength();nt++)rt.push(ot.ints(nt));return rt}case tt.AttributeType.STRINGS:{const rt=[];for(let nt=0;nt<ot.stringsLength();nt++)rt.push(ot.strings(nt));return rt}case tt.AttributeType.TENSORS:{const rt=[];for(let nt=0;nt<ot.tensorsLength();nt++)rt.push(ot.tensors(nt));return rt}default:throw new Error(`unsupported attribute type: ${tt.AttributeType[ot.type()]}`)}}}O.Attribute=it},7091:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.resolveBackend=O.backend=void 0;const te=Y(5038),ne=new Map;async function xe(et){const tt=O.backend;if(tt[et]!==void 0&&(function(it){const st=it;return"initialize"in st&&typeof st.initialize=="function"&&"createSessionHandler"in st&&typeof st.createSessionHandler=="function"&&"dispose"in st&&typeof st.dispose=="function"})(tt[et])){const it=tt[et];let st=it.initialize();if(typeof st=="object"&&"then"in st&&(st=await st),st)return ne.set(et,it),it}}O.backend={webgl:new te.WebGLBackend},O.resolveBackend=async function et(tt){if(!tt)return et(["webgl"]);{const it=typeof tt=="string"?[tt]:tt;for(const st of it){const ot=ne.get(st);if(ot)return ot;const rt=await xe(st);if(rt)return rt}}throw new Error("no available backend to use")}},5038:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.WebGLBackend=void 0;const te=Y(1670),ne=Y(6231),xe=Y(6416),et=Y(7305);O.WebGLBackend=class{get contextId(){return te.env.webgl.contextId}set contextId(tt){te.env.webgl.contextId=tt}get matmulMaxBatchSize(){return te.env.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(tt){te.env.webgl.matmulMaxBatchSize=tt}get textureCacheMode(){return te.env.webgl.textureCacheMode}set textureCacheMode(tt){te.env.webgl.textureCacheMode=tt}get pack(){return te.env.webgl.pack}set pack(tt){te.env.webgl.pack=tt}get async(){return te.env.webgl.async}set async(tt){te.env.webgl.async=tt}initialize(){try{return this.glContext=(0,et.createWebGLContext)(this.contextId),typeof this.matmulMaxBatchSize!="number"&&(this.matmulMaxBatchSize=16),typeof this.textureCacheMode!="string"&&(this.textureCacheMode="full"),typeof this.pack!="boolean"&&(this.pack=!1),typeof this.async!="boolean"&&(this.async=!1),ne.Logger.setWithEnv(te.env),ne.Logger.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(tt){return ne.Logger.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${tt}`),!1}}createSessionHandler(tt){return new xe.WebGLSessionHandler(this,tt)}dispose(){this.glContext.dispose()}}},5107:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.CoordsGlslLib=void 0;const te=Y(2517),ne=Y(8520),xe=Y(5060),et=Y(7859),tt=Y(9390);class it extends ne.GlslLib{constructor(ot){super(ot)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.offsetToCoords()),this.coordsToOffset()),this.toVec()),this.valueFrom()),this.getCommonUtilFuncs()),this.getInputsSamplingSnippets()),this.getOutputSamplingSnippet())}getCustomTypes(){return{}}offsetToCoords(){return{offsetToCoords:new ne.GlslLibRoutine(`
      vec2 offsetToCoords(int offset, int width, int height) {
        int t = offset / width;
        int s = offset - t*width;
        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);
        return coords;
      }
      `)}}coordsToOffset(){return{coordsToOffset:new ne.GlslLibRoutine(`
      int coordsToOffset(vec2 coords, int width, int height) {
        float s = coords.s * float(width);
        float t = coords.t * float(height);
        int offset = int(t) * width + int(s);
        return offset;
      }
      `)}}getOutputSamplingSnippet(){const ot=this.context.outputTextureLayout;return ot.isPacked?this.getPackedOutputSamplingSnippet(ot):this.getUnpackedOutputSamplingSnippet(ot)}getPackedOutputSamplingSnippet(ot){const rt=ot.unpackedShape,nt=[ot.width,ot.height],at={},ct="getOutputCoords";switch(rt.length){case 0:at[ct]=this.getOutputScalarCoords();break;case 1:at[ct]=this.getOutputPacked1DCoords(rt,nt);break;case 2:at[ct]=this.getOutputPacked2DCoords(rt,nt);break;case 3:at[ct]=this.getOutputPacked3DCoords(rt,nt);break;default:at[ct]=this.getOutputPackedNDCoords(rt,nt)}const ut=`
      void setOutput(vec4 val) {
        ${(0,xe.getGlsl)(this.context.glContext.version).output} = val;
      }
    `;return at.floatTextureSetRGBA=new ne.GlslLibRoutine(ut),at}getUnpackedOutputSamplingSnippet(ot){const rt=ot.unpackedShape,nt=[ot.width,ot.height],at={},ct="getOutputCoords";switch(rt.length){case 0:at[ct]=this.getOutputScalarCoords();break;case 1:at[ct]=this.getOutputUnpacked1DCoords(rt,nt);break;case 2:at[ct]=this.getOutputUnpacked2DCoords(rt,nt);break;case 3:at[ct]=this.getOutputUnpacked3DCoords(rt,nt);break;case 4:at[ct]=this.getOutputUnpacked4DCoords(rt,nt);break;case 5:at[ct]=this.getOutputUnpacked5DCoords(rt,nt);break;case 6:at[ct]=this.getOutputUnpacked6DCoords(rt,nt);break;default:throw new Error(`Unsupported output dimensionality: ${rt.length}`)}const ut=`
        void setOutput(float val) {
          ${(0,xe.getGlsl)(this.context.glContext.version).output} = vec4(val, 0, 0, 0);
        }
    `;return at.floatTextureSetR=new ne.GlslLibRoutine(ut),at}getOutputScalarCoords(){return new ne.GlslLibRoutine(`
      int getOutputCoords() {
        return 0;
      }
    `)}getOutputPacked1DCoords(ot,rt){const nt=rt;let at="";return nt[0]===1?(at=`
          int getOutputCoords() {
            return 2 * int(TexCoords.y * ${nt[1]}.0);
          }
        `,new ne.GlslLibRoutine(at)):nt[1]===1?(at=`
          int getOutputCoords() {
            return 2 * int(TexCoords.x * ${nt[0]}.0);
          }
        `,new ne.GlslLibRoutine(at)):(at=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                 vec2(${nt[0]}, ${nt[1]}));
          return 2 * (resTexRC.y * ${nt[0]} + resTexRC.x);
        }
      `,new ne.GlslLibRoutine(at))}getOutputPacked2DCoords(ot,rt){let nt="";if(te.ArrayUtil.arraysEqual(ot,rt))return nt=`
        ivec2 getOutputCoords() {
          return 2 * ivec2(TexCoords.xy * vec2(${rt[0]}, ${rt[1]}));
        }
      `,new ne.GlslLibRoutine(nt);const at=rt,ct=Math.ceil(ot[1]/2);return nt=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${at[0]}, ${at[1]}));

          int index = resTexRC.y * ${at[0]} + resTexRC.x;

          // reverse r and c order for packed texture
          int r = imod(index, ${ct}) * 2;
          int c = 2 * (index / ${ct});

          return ivec2(r, c);
        }
      `,new ne.GlslLibRoutine(nt)}getOutputPacked3DCoords(ot,rt){const nt=[rt[0],rt[1]],at=Math.ceil(ot[2]/2),ct=at*Math.ceil(ot[1]/2),ut=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${nt[0]}, ${nt[1]}));
          int index = resTexRC.y * ${nt[0]} + resTexRC.x;

          int b = index / ${ct};
          index -= b * ${ct};

          // reverse r and c order for packed texture
          int r = imod(index, ${at}) * 2;
          int c = 2 * (index / ${at});

          return ivec3(b, r, c);
        }
      `;return new ne.GlslLibRoutine(ut)}getOutputPackedNDCoords(ot,rt){const nt=[rt[0],rt[1]],at=Math.ceil(ot[ot.length-1]/2),ct=at*Math.ceil(ot[ot.length-2]/2);let ut=ct,dt="",ht="b, r, c";for(let ft=2;ft<ot.length-1;ft++)ut*=ot[ot.length-ft-1],dt=`
      int b${ft} = index / ${ut};
      index -= b${ft} * ${ut};
    `+dt,ht=`b${ft}, `+ht;const pt=`
      ivec${ot.length} getOutputCoords() {
        ivec2 resTexRC = ivec2(TexCoords.xy *
                              vec2(${nt[0]}, ${nt[1]}));
        int index = resTexRC.y * ${nt[0]} + resTexRC.x;

        ${dt}

        int b = index / ${ct};
        index -= b * ${ct};

        // reverse r and c order for packed texture
        int r = imod(index, ${at}) * 2;
        int c = 2 * (index / ${at});

        return ivec${ot.length}(${ht});
      }
    `;return new ne.GlslLibRoutine(pt)}getOutputUnpacked1DCoords(ot,rt){const nt=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${rt[0]}, ${rt[1]}));
          return resTexRC.y * ${rt[0]} + resTexRC.x;
        }
      `;return new ne.GlslLibRoutine(nt)}getOutputUnpacked2DCoords(ot,rt){const nt=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${rt[0]}, ${rt[1]}));
          int index = resTexRC.y * ${rt[0]} + resTexRC.x;
          int r = index / ${ot[1]};
          int c = index - r * ${ot[1]};
          return ivec2(r, c);
        }
      `;return new ne.GlslLibRoutine(nt)}getOutputUnpacked3DCoords(ot,rt){let nt="";const at=ot.length;let ct=null;at<2&&(ct=[]),ct=new Array(at-1),ct[at-2]=ot[at-1];for(let ht=at-3;ht>=0;--ht)ct[ht]=ct[ht+1]*ot[ht+1];const ut=["r","c","d"],dt=ct.map(((ht,pt)=>`int ${ut[pt]} = index / ${ht}; ${pt===ct.length-1?`int ${ut[pt+1]} = index - ${ut[pt]} * ${ht}`:`index -= ${ut[pt]} * ${ht}`};`)).join("");return nt=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${rt[0]}, ${rt[1]}));
          int index = resTexRC.y * ${rt[0]} + resTexRC.x;
          ${dt}
          return ivec3(r, c, d);
        }
      `,new ne.GlslLibRoutine(nt)}getOutputUnpacked4DCoords(ot,rt){let nt="";const at=ot.length;let ct=null;at<2&&(ct=[]),ct=new Array(at-1),ct[at-2]=ot[at-1];for(let ht=at-3;ht>=0;--ht)ct[ht]=ct[ht+1]*ot[ht+1];const ut=["r","c","d","d2"],dt=ct.map(((ht,pt)=>`int ${ut[pt]} = index / ${ht}; ${pt===ct.length-1?`int ${ut[pt+1]} = index - ${ut[pt]} * ${ht}`:`index -= ${ut[pt]} * ${ht}`};`)).join("");return nt=`
      ivec4 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${rt[0]}, ${rt[1]}));
          int index = resTexRC.y * ${rt[0]} + resTexRC.x;
          ${dt}
          return ivec4(r, c, d, d2);
        }
      `,new ne.GlslLibRoutine(nt)}getOutputUnpacked5DCoords(ot,rt){let nt="";const at=ot.length;let ct=null;at<2&&(ct=[]),ct=new Array(at-1),ct[at-2]=ot[at-1];for(let ht=at-3;ht>=0;--ht)ct[ht]=ct[ht+1]*ot[ht+1];const ut=["r","c","d","d2","d3"],dt=ct.map(((ht,pt)=>`int ${ut[pt]} = index / ${ht}; ${pt===ct.length-1?`int ${ut[pt+1]} = index - ${ut[pt]} * ${ht}`:`index -= ${ut[pt]} * ${ht}`};`)).join("");return nt=`
      ivec5 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${rt[0]}, ${rt[1]}));
          int index = resTexRC.y * ${rt[0]} + resTexRC.x;
          ${dt}
          return ivec5(r, c, d, d2, d3);
        }
      `,new ne.GlslLibRoutine(nt)}getOutputUnpacked6DCoords(ot,rt){let nt="";const at=ot.length;let ct=null;at<2&&(ct=[]),ct=new Array(at-1),ct[at-2]=ot[at-1];for(let ht=at-3;ht>=0;--ht)ct[ht]=ct[ht+1]*ot[ht+1];const ut=["r","c","d","d2","d3","d4"],dt=ct.map(((ht,pt)=>`int ${ut[pt]} = index / ${ht}; ${pt===ct.length-1?`int ${ut[pt+1]} = index - ${ut[pt]} * ${ht}`:`index -= ${ut[pt]} * ${ht}`};`)).join("");return nt=`
     ivec6 getOutputCoords() {
         ivec2 resTexRC = ivec2(TexCoords.xy *
                               vec2(${rt[0]}, ${rt[1]}));
         int index = resTexRC.y * ${rt[0]} + resTexRC.x;
         ${dt}
         return ivec6(r, c, d, d2, d3, d4);
       }
     `,new ne.GlslLibRoutine(nt)}getCommonUtilFuncs(){const ot={};let rt="uvFromFlat";ot[rt]=new ne.GlslLibRoutine(`
    vec2 uvFromFlat(int texNumR, int texNumC, int index) {
      int texC = index / texNumR;
      int texR = index - texC * texNumR;
      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to
      //       v.
      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);
    }
    `),rt="packedUVfrom1D",ot[rt]=new ne.GlslLibRoutine(`
      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
        int texelIndex = index / 2;
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),rt="packedUVfrom2D",ot[rt]=new ne.GlslLibRoutine(`
      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {
        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = texelIndex / texNumC;
        int texC = texelIndex - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),rt="packedUVfrom3D",ot[rt]=new ne.GlslLibRoutine(`
      vec2 packedUVfrom3D(int texNumR, int texNumC,
          int texelsInBatch, int texelsInLogicalRow, int b,
          int row, int col) {
        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
        int texR = index / texNumC;
        int texC = index - texR * texNumC;
        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
      }
      `),rt="sampleTexture";const nt=(0,xe.getGlsl)(this.context.glContext.version);return ot[rt]=new ne.GlslLibRoutine(`
        float sampleTexture(sampler2D textureSampler, vec2 uv) {
            return ${nt.texture2D}(textureSampler, uv).r;
        }`),ot}getInputsSamplingSnippets(){const ot={},rt=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach(((nt,at)=>{const ct=this.context.inputTextureLayouts[at],ut=(0,tt.generateShaderFuncNameFromInputSamplerName)(nt);ct.isPacked?ot[ut]=this.getPackedSamplerFromInput(ut,nt,ct):ot[ut]=this.getUnpackedSamplerFromInput(ut,nt,ct);const dt=(0,tt.generateShaderFuncNameFromInputSamplerNameAtOutCoords)(nt);ct.unpackedShape.length<=rt.unpackedShape.length&&(ct.isPacked?ot[dt]=this.getPackedSamplerAtOutputCoords(dt,ct,rt,nt):ot[dt]=this.getUnpackedSamplerAtOutputCoords(dt,ct,rt,nt))})),ot}getPackedSamplerAtOutputCoords(ot,rt,nt,at){const ct=rt.unpackedShape,ut=nt.unpackedShape,dt=at,ht=(0,tt.generateShaderFuncNameFromInputSamplerName)(dt),pt=ct.length,ft=ut.length,mt=te.BroadcastUtil.getBroadcastDims(ct,ut),yt=(0,tt.getCoordsDataType)(ft),bt=ft-pt;let vt;const Et=(0,tt.getGlChannels)();vt=pt===0?"":ft<2&&mt.length>=1?"coords = 0;":mt.map((Nt=>`coords.${Et[Nt+bt]} = 0;`)).join(`
`);let wt="";wt=ft<2&&pt>0?"coords":ct.map(((Nt,Rt)=>`coords.${Et[Rt+bt]}`)).join(", ");let St="return outputValue;";const Ot=te.ShapeUtil.size(ct)===1,$t=te.ShapeUtil.size(ut)===1;if(pt!==1||Ot||$t){if(Ot&&!$t)St=ft===1?`
          return vec4(outputValue.x, outputValue.x, 0., 0.);
        `:`
          return vec4(outputValue.x);
        `;else if(mt.length){const Nt=pt-2,Rt=pt-1;mt.indexOf(Nt)>-1&&mt.indexOf(Rt)>-1?St="return vec4(outputValue.x);":mt.indexOf(Nt)>-1?St="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":mt.indexOf(Rt)>-1&&(St="return vec4(outputValue.xx, outputValue.zz);")}}else St=`
        return vec4(outputValue.xy, outputValue.xy);
      `;const Mt=`
      vec4 ${ot}() {
        ${yt} coords = getOutputCoords();
        
        int lastDim = coords.${Et[ft-1]};
        coords.${Et[ft-1]} = coords.${Et[ft-2]};
        coords.${Et[ft-2]} = lastDim;
      
        ${vt}
        vec4 outputValue = ${ht}(${wt});
        ${St}
      }
    `;return new ne.GlslLibRoutine(Mt,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(ot,rt,nt,at){const ct=[nt.width,nt.height],ut=[rt.width,rt.height],dt=rt.unpackedShape.length,ht=nt.unpackedShape.length,pt=rt.unpackedShape,ft=nt.unpackedShape,mt=(0,tt.generateShaderFuncNameFromInputSamplerName)(at);if(dt===ht&&te.ArrayUtil.arraysEqual(ut,ct)){const $t=`
          float ${ot}() {
            return sampleTexture(${at}, TexCoords);
          }
        `;return new ne.GlslLibRoutine($t,["coordinates.sampleTexture"])}const yt=(0,tt.getCoordsDataType)(ht),bt=te.BroadcastUtil.getBroadcastDims(pt,ft),vt=ht-dt;let Et;const wt=(0,tt.getGlChannels)();Et=dt===0?"":ht<2&&bt.length>=1?"coords = 0;":bt.map(($t=>`coords.${wt[$t+vt]} = 0;`)).join(`
`);let St="";St=ht<2&&dt>0?"coords":rt.unpackedShape.map((($t,Mt)=>`coords.${wt[Mt+vt]}`)).join(", ");const Ot=`
        float ${ot}() {
          ${yt} coords = getOutputCoords();
          ${Et}
          return ${mt}(${St});
        }
      `;return new ne.GlslLibRoutine(Ot,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(ot,rt,nt){switch(nt.unpackedShape.length){case 0:return this.getPackedSamplerScalar(ot,rt);case 1:return this.getPackedSampler1D(ot,rt,nt);case 2:return this.getPackedSampler2D(ot,rt,nt);case 3:return this.getPackedSampler3D(ot,rt,nt);default:return this.getPackedSamplerND(ot,rt,nt)}}getUnpackedSamplerFromInput(ot,rt,nt){const at=nt.unpackedShape;switch(at.length){case 0:return this.getUnpackedSamplerScalar(ot,rt,nt);case 1:return this.getUnpackedSampler1D(ot,rt,nt);case 2:return this.getUnpackedSampler2D(ot,rt,nt);case 3:return this.getUnpackedSampler3D(ot,rt,nt);case 4:return this.getUnpackedSampler4D(ot,rt,nt);case 5:return this.getUnpackedSampler5D(ot,rt,nt);case 6:return this.getUnpackedSampler6D(ot,rt,nt);default:throw new Error(`Unsupported dimension ${at.length}-D`)}}getPackedSamplerScalar(ot,rt){const nt=`
          vec4 ${ot}() {
            return ${(0,xe.getGlsl)(this.context.glContext.version).texture2D}(${rt}, halfCR);
          }
        `;return new ne.GlslLibRoutine(nt)}getPackedSampler1D(ot,rt,nt){const at=[nt.width,nt.height],ct=[at[1],at[0]],ut=(0,xe.getGlsl)(this.context.glContext.version),dt=`vec4 ${ot}(int index) {
      vec2 uv = packedUVfrom1D(
      ${ct[0]}, ${ct[1]}, index);
      return ${ut.texture2D}(${rt}, uv);
    }`;return new ne.GlslLibRoutine(dt,["coordinates.packedUVfrom1D"])}getPackedSampler2D(ot,rt,nt){const at=nt.unpackedShape,ct=[nt.width,nt.height],ut=(0,xe.getGlsl)(this.context.glContext.version),dt=ct[0],ht=ct[1];if(ct!=null&&te.ArrayUtil.arraysEqual(at,ct)){const yt=`vec4 ${ot}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${ht}.0, ${dt}.0);
        return ${ut.texture2D}(${rt}, uv);
      }`;return new ne.GlslLibRoutine(yt)}const pt=ct,ft=Math.ceil(at[1]/2),mt=`vec4 ${ot}(int row, int col) {
      vec2 uv = packedUVfrom2D(${pt[1]}, ${pt[0]}, ${ft}, row, col);
      return ${ut.texture2D}(${rt}, uv);
    }`;return new ne.GlslLibRoutine(mt,["coordinates.packedUVfrom2D"])}getPackedSampler3D(ot,rt,nt){const at=nt.unpackedShape,ct=[nt.width,nt.height],ut=[ct[0],ct[1]],dt=(0,xe.getGlsl)(this.context.glContext.version);if(at[0]===1){const yt=at.slice(1),bt=[1,2],vt=(0,tt.squeezeInputShape)(at,yt),Et=["b","row","col"],wt=JSON.parse(JSON.stringify(nt));wt.unpackedShape=vt;const St=this.getPackedSamplerFromInput(ot,rt,wt),Ot=`${St.routineBody}
      vec4 ${ot}(int b, int row, int col) {
        return ${ot}(${(0,tt.getSqueezedParams)(Et,bt)});
      } `;return new ne.GlslLibRoutine(Ot,St.dependencies)}const ht=ut[0],pt=ut[1],ft=Math.ceil(at[2]/2),mt=`vec4 ${ot}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${pt}, ${ht}, ${ft*Math.ceil(at[1]/2)}, ${ft}, b, row, col);
      return ${dt.texture2D}(${rt}, uv);}`;return new ne.GlslLibRoutine(mt,["coordinates.packedUVfrom3D"])}getPackedSamplerND(ot,rt,nt){const at=nt.unpackedShape,ct=at.length,ut=[nt.width,nt.height],dt=(0,xe.getGlsl)(this.context.glContext.version),ht=[ut[0],ut[1]],pt=ht[1],ft=ht[0],mt=Math.ceil(at[ct-1]/2);let yt=mt*Math.ceil(at[ct-2]/2),bt="int b, int row, int col",vt=`b * ${yt} + (row / 2) * ${mt} + (col / 2)`;for(let wt=2;wt<ct-1;wt++)bt=`int b${wt}, `+bt,yt*=at[ct-wt-1],vt=`b${wt} * ${yt} + `+vt;const Et=`vec4 ${ot}(${bt}) {
      int index = ${vt};
      int texR = index / ${ft};
      int texC = index - texR * ${ft};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${ft}, ${pt});
      return ${dt.texture2D}(${rt}, uv);
    }`;return new ne.GlslLibRoutine(Et)}getUnpackedSamplerScalar(ot,rt,nt){const[at,ct]=[nt.width,nt.height];if(at===1&&ct===1){const dt=`
          float ${ot}() {
            return sampleTexture(${rt}, halfCR);
          }
        `;return new ne.GlslLibRoutine(dt,["coordinates.sampleTexture"])}const ut=`
        float ${ot}() {
          int offset_${rt} = coordsToOffset(TexCoords, ${at}, ${ct});
          vec2 uv = uvFromFlat(${at}, ${ct}, offset_${rt});
          return sampleTexture(${rt}, uv);
        }
      `;return new ne.GlslLibRoutine(ut,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(ot,rt,nt){const at=nt.width,ct=nt.height;if(ct===1&&at===1){const dt=`
        float ${ot}(int index) {
          return sampleTexture(${rt}, halfCR);
        }
      `;return new ne.GlslLibRoutine(dt,["coordinates.sampleTexture"])}if(ct===1){const dt=`
          float ${ot}(int index) {
            vec2 uv = vec2((float(index) + 0.5) / ${at}.0, 0.5);
            return sampleTexture(${rt}, uv);
          }
        `;return new ne.GlslLibRoutine(dt,["coordinates.sampleTexture"])}if(at===1){const dt=`
          float ${ot}(int index) {
            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${ct}.0);
            return sampleTexture(${rt}, uv);
          }
        `;return new ne.GlslLibRoutine(dt,["coordinates.sampleTexture"])}const ut=`
        float ${ot}(int index) {
          vec2 uv = uvFromFlat(${at}, ${ct}, index);
          return sampleTexture(${rt}, uv);
        }
      `;return new ne.GlslLibRoutine(ut,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(ot,rt,nt){const at=nt.unpackedShape,ct=[nt.height,nt.width];if(ct!=null&&te.ArrayUtil.arraysEqual(at,ct)){const yt=`
          float ${ot}(int row, int col) {
            vec2 uv = (vec2(row, col) + halfCR) / vec2(${ct[1]}.0, ${ct[0]}.0);
            return sampleTexture(${rt}, uv);
          }
        `;return new ne.GlslLibRoutine(yt,["coordinates.sampleTexture"])}const{newShape:ut,keptDims:dt}=(0,et.squeezeShape)(at),ht=ut;if(ht.length<at.length){const yt=(0,tt.squeezeInputShape)(at,ht),bt=JSON.parse(JSON.stringify(nt));bt.unpackedShape=yt;const vt=["col","row"],Et=`
          ${this.getUnpackedSamplerFromInput(ot,rt,bt).routineBody}
          float ${ot}(int row, int col) {
            return ${ot}(${(0,tt.getSqueezedParams)(vt,dt)});
          }
        `;return new ne.GlslLibRoutine(Et,["coordinates.sampleTexture"])}const pt=ct[1],ft=ct[0];if(ft===1){const yt=`
          float ${ot}(int row, int col) {
            int offset_${rt} = coordsToOffset(TexCoords, ${pt}, ${ft});
            float index = dot(vec3(row, col, offset_${rt}), vec3(${at[1]}, 1, 1));
            vec2 uv = vec2(0.5, (index + 0.5) / ${pt}.0);
            return sampleTexture(${rt}, uv);
          }
        `;return new ne.GlslLibRoutine(yt,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(pt===1){const yt=`
          float ${ot}(int row, int col) {
            int offset_${rt} = coordsToOffset(TexCoords, ${pt}, ${ft});
            float index = dot(vec3(row, col, offset_${rt}), vec3(${at[1]}, 1, 1));
            vec2 uv = vec2((index + 0.5) / ${ft}.0, 0.5);
            return sampleTexture(${rt}, uv);
          }
        `;return new ne.GlslLibRoutine(yt,["coordinates.sampleTexture","coordinates.coordsToOffset"])}const mt=`
        float ${ot}(int row, int col) {
          int index = col * ${at[1]} + row;
          vec2 uv = uvFromFlat(${pt}, ${ft}, index);
          return sampleTexture(${rt}, uv);
        }
      `;return new ne.GlslLibRoutine(mt,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(ot,rt,nt){const at=nt.unpackedShape,ct=at[1]*at[2],ut=at[2],{newShape:dt,keptDims:ht}=(0,et.squeezeShape)(at),pt=dt;if(pt.length<at.length){const mt=(0,tt.squeezeInputShape)(at,pt),yt=["batch","col","row"],bt=JSON.parse(JSON.stringify(nt));bt.unpackedShape=mt;const vt=this.getUnpackedSamplerFromInput(ot,rt,bt),Et=ht.reverse(),wt=`
          ${vt.routineBody}
          float ${ot}(int batch, int row, int col) {
            return ${ot}(${(0,tt.getSqueezedParams)(yt,Et)});
          }
        `;return new ne.GlslLibRoutine(wt,vt.dependencies)}const ft=`
          float ${ot}(int depth, int row, int col) {
            // Explicitly use integer operations as dot() only works on floats.
            int index = depth * ${ct} + col * ${ut} + row;
            vec2 uv = uvFromFlat(${nt.width}, ${nt.height}, index);
            return sampleTexture(${rt}, uv);
          }
      `;return new ne.GlslLibRoutine(ft,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(ot,rt,nt){const at=nt.unpackedShape,ct=at[3],ut=at[2]*ct,dt=`
        float ${ot}(int row, int col, int depth, int depth2) {
          int index = row * ${at[1]*ut} + col * ${ut} +
              depth2 * ${ct} + depth;
          vec2 uv = uvFromFlat(${nt.width}, ${nt.height}, index);
          return sampleTexture(${rt}, uv);
        }
      `;return new ne.GlslLibRoutine(dt,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(ot,rt,nt){const at=nt.unpackedShape,ct=at[4],ut=at[3]*ct,dt=at[2]*ut,ht=at[1]*dt,{newShape:pt,keptDims:ft}=(0,et.squeezeShape)(at);if(pt.length<at.length){const yt=(0,tt.squeezeInputShape)(at,pt),bt=["row","col","depth","depth2","depth3"],vt=JSON.parse(JSON.stringify(nt));vt.unpackedShape=yt;const Et=`
          ${this.getUnpackedSamplerFromInput(ot,rt,vt).routineBody}
          float ${ot}(int row, int col, int depth, int depth2, int depth3) {
            return ${ot}(${(0,tt.getSqueezedParams)(bt,ft)});
          }
        `;return new ne.GlslLibRoutine(Et,["coordinates.sampleTexture","coordinates.uvFromFlat"])}const mt=`
        float ${ot}(int row, int col, int depth, int depth2, int depth3) {
          int index = row * ${ht} + col * ${dt} + depth * ${ut} +
          depth3 * ${ct} + depth2;
          vec2 uv = uvFromFlat(${nt.width}, ${nt.height}, index);
          return sampleTexture(${rt}, uv);
        }
      `;return new ne.GlslLibRoutine(mt,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(ot,rt,nt){const at=nt.unpackedShape,ct=at[5],ut=at[4]*ct,dt=at[3]*ut,ht=at[2]*dt,pt=at[1]*ht,{newShape:ft,keptDims:mt}=(0,et.squeezeShape)(at);if(ft.length<at.length){const bt=(0,tt.squeezeInputShape)(at,ft),vt=["row","col","depth","depth2","depth3","depth4"],Et=JSON.parse(JSON.stringify(nt));Et.unpackedShape=bt;const wt=`
            ${this.getUnpackedSamplerFromInput(ot,rt,Et).routineBody}
            float ${ot}(int row, int col, int depth,
              int depth2, int depth3, int depth4) {
              return ${ot}(${(0,tt.getSqueezedParams)(vt,mt)});
            }
          `;return new ne.GlslLibRoutine(wt,["coordinates.sampleTexture","coordinates.uvFromFlat"])}const yt=`
          float ${ot}(int row, int col, int depth,
            int depth2, int depth3, int depth4) {
            int index = row * ${pt} + col * ${ht} + depth * ${dt} +
            depth2 * ${ut} + depth3 * ${ct} + depth4;
            vec2 uv = uvFromFlat(${nt.width}, ${nt.height}, index);
            return sampleTexture(${rt}, uv);
          }
        `;return new ne.GlslLibRoutine(yt,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){const ot=this.context.outputTextureLayout,rt=ot.shape.length,nt=ot.strides,at=ot.width,ct=ot.height,ut=[];for(let ht=0;ht<rt-1;++ht)ut.push(`
        c[${ht}] = offset / ${nt[ht]};`),ut.push(`
        offset -= c[${ht}] * ${nt[ht]};`);ut.push(`
        c[${rt-1}] = offset;`);const dt=`
      void toVec(vec2 texCoords, out int c[${rt}]) {
        int offset = coordsToOffset(texCoords, ${at}, ${ct});
        ${ut.join("")}
      }
      void toVec(int offset, out int c[${rt}]) {
        ${ut.join("")}
      }
    `;return{toVec:new ne.GlslLibRoutine(dt,["coordinates.coordsToOffset"])}}valueFrom(){const ot={};return this.context.programInfo.inputNames.forEach(((rt,nt)=>{const at=this.context.inputTextureLayouts[nt],ct=(at.unpackedShape.length>0?at.unpackedShape:at.shape).length;let ut=`_${rt}`;ot[ut]=new ne.GlslLibRoutine(this.getValueFromSingle(rt,ct,at.width,at.height,!1),[`shapeUtils.indicesToOffset${ut}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),ut+="_T",ot[ut]=new ne.GlslLibRoutine(this.getValueFromSingle(rt,ct,at.width,at.height,!0),[`shapeUtils.indicesToOffset${ut}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])})),ot}getValueFromSingle(ot,rt,nt,at,ct){let ut=`_${ot}`;return ct&&(ut+="_T"),`
        float ${ut}(int m[${rt}]) {
          int offset = indicesToOffset${ut}(m);
          vec2 coords = offsetToCoords(offset, ${nt}, ${at});
          float value = getColorAsFloat(${(0,xe.getGlsl)(this.context.glContext.version).texture2D}(${ot}, coords));
          return value;
        }
        `}getPackedValueFrom(ot,rt,nt,at,ct){let ut=`_${ot}_Pack`;return ct&&(ut+="_T"),`
        vec4 ${ut}(int m[${rt}]) {
          int offset = indicesToOffset_${ot}(m);
          vec2 coords = offsetToCoords(offset, ${nt}, ${at});
          return ${(0,xe.getGlsl)(this.context.glContext.version).texture2D}(${ot}, coords);
        }
        `}}O.CoordsGlslLib=it},8520:(ee,O)=>{var Y;Object.defineProperty(O,"__esModule",{value:!0}),O.TopologicalSortGlslRoutines=O.GlslLibRoutineNode=O.GlslLibRoutine=O.GlslLib=O.GlslContext=O.FunctionType=void 0,(Y=O.FunctionType||(O.FunctionType={}))[Y.ValueBased=0]="ValueBased",Y[Y.Positional=1]="Positional",O.GlslContext=class{constructor(te,ne,xe,et){this.glContext=te,this.programInfo=ne,this.inputTextureLayouts=xe,this.outputTextureLayout=et}},O.GlslLib=class{constructor(te){this.context=te}},O.GlslLibRoutine=class{constructor(te,ne){this.routineBody=te,this.dependencies=ne}},O.GlslLibRoutineNode=class{constructor(te,ne,xe){this.name=te,this.dependencies=xe||[],ne&&(this.routineBody=ne)}addDependency(te){te&&this.dependencies.push(te)}},O.TopologicalSortGlslRoutines=class{static returnOrderedNodes(te){if(!te||te.length===0)return[];if(te.length===1)return te;const ne=new Set,xe=new Set,et=new Array;return this.createOrderedNodes(te,ne,xe,et),et}static createOrderedNodes(te,ne,xe,et){for(let tt=0;tt<te.length;++tt)this.dfsTraverse(te[tt],ne,xe,et)}static dfsTraverse(te,ne,xe,et){if(!te||xe.has(te.name))return;if(ne.has(te.name))throw new Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");ne.add(te.name);const tt=te.dependencies;if(tt&&tt.length>0)for(let it=0;it<tt.length;++it)this.dfsTraverse(tt[it],ne,xe,et);et.push(te),xe.add(te.name),ne.delete(te.name)}}},7341:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.EncodingGlslLib=void 0;const te=Y(8520);class ne extends te.GlslLib{constructor(et){super(et)}getFunctions(){return Object.assign(Object.assign({},this.encodeFloat32()),this.decodeFloat32())}getCustomTypes(){return{}}encodeFloat32(){return{encode:new te.GlslLibRoutine(`highp vec4 encode(highp float f) {
        return vec4(f, 0.0, 0.0, 0.0);
      }
        `)}}decodeFloat32(){return{decode:new te.GlslLibRoutine(`highp float decode(highp vec4 rgba) {
        return rgba.r;
      }
        `)}}encodeUint8(){const et=ne.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new te.GlslLibRoutine(`
      highp vec4 encode(highp float f) {
        highp float F = abs(f);
        highp float Sign = step(0.0,-f);
        highp float Exponent = floor(log2(F));
        highp float Mantissa = (exp2(- Exponent) * F);
        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));
        highp vec4 rgba;
        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));
        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);
        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));
        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));
        ${et}
        rgba = rgba / 255.0; // values need to be normalized to [0,1]
        return rgba;
    }
        `)}}decodeUint8(){const et=ne.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new te.GlslLibRoutine(`
        highp float decode(highp vec4 rgba) {
          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]
          ${et}
          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;
          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;
          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);
          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));
          return Result;
      }
        `)}}static isLittleEndian(){const et=new ArrayBuffer(4),tt=new Uint32Array(et),it=new Uint8Array(et);if(tt[0]=3735928559,it[0]===239)return!0;if(it[0]===222)return!1;throw new Error("unknown endianness")}}O.EncodingGlslLib=ne},9894:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.FragColorGlslLib=void 0;const te=Y(8520),ne=Y(5060);class xe extends te.GlslLib{constructor(tt){super(tt)}getFunctions(){return Object.assign(Object.assign({},this.setFragColor()),this.getColorAsFloat())}getCustomTypes(){return{}}setFragColor(){const tt=(0,ne.getGlsl)(this.context.glContext.version);return{setFragColor:new te.GlslLibRoutine(`
        void setFragColor(float value) {
            ${tt.output} = encode(value);
        }
        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new te.GlslLibRoutine(`
        float getColorAsFloat(vec4 color) {
            return decode(color);
        }
        `,["encoding.decode"])}}}O.FragColorGlslLib=xe},2848:(ee,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.replaceInlines=void 0;const Y=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm;O.replaceInlines=function(te){const ne={};let xe;for(;(xe=Y.exec(te))!==null;){const et=xe[3].split(",").map((tt=>{const it=tt.trim().split(" ");return it&&it.length===2?{type:it[0],name:it[1]}:null})).filter((tt=>tt!==null));ne[xe[2]]={params:et,body:xe[4]}}for(const et in ne){const tt="(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;".replace("__FUNC__",et),it=new RegExp(tt,"gm");for(;(xe=it.exec(te))!==null;){const st=xe[1],ot=xe[2],rt=xe[3].split(","),nt=st?`${st} ${ot};`:"";let at=ne[et].body,ct="";ne[et].params.forEach(((dt,ht)=>{dt&&(ct+=`${dt.type} ${dt.name} = ${rt[ht]};
`)})),at=`${ct}
 ${at}`,at=at.replace("return",`${ot} = `);const ut=`
      ${nt}
      {
        ${at}
      }
      `;te=te.replace(xe[0],ut)}}return te.replace(Y,"")}},8879:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.GlslPreprocessor=void 0;const te=Y(8520),ne=Y(2848),xe=Y(5483),et=Y(5060);O.GlslPreprocessor=class{constructor(tt,it,st,ot){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new te.GlslContext(tt,it,st,ot),Object.keys(xe.glslRegistry).forEach((nt=>{const at=new xe.glslRegistry[nt](this.context);this.libs[nt]=at}));const rt=this.glslLibRoutineDependencyGraph;for(const nt in this.libs){const at=this.libs[nt].getFunctions();for(const ct in at){const ut=nt+"."+ct;let dt;rt[ut]?(dt=rt[ut],dt.routineBody=at[ct].routineBody):(dt=new te.GlslLibRoutineNode(ut,at[ct].routineBody),rt[ut]=dt);const ht=at[ct].dependencies;if(ht)for(let pt=0;pt<ht.length;++pt)if(rt[ht[pt]])dt.addDependency(rt[ht[pt]]);else{const ft=new te.GlslLibRoutineNode(ht[pt]);rt[ht[pt]]=ft,dt.addDependency(ft)}}}}preprocess(){const tt=this.context.programInfo;let it=tt.shaderSource;return this.context.programInfo.hasMain||(it=`${it}
      ${(0,et.getDefaultFragShaderMain)(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),it=(0,ne.replaceInlines)(it),`${(0,et.getFragShaderPreamble)(this.context.glContext.version)}
    ${this.getUniforms(tt.inputNames,tt.variables)}
    ${this.getImports(it)}
    ${it}`}getImports(tt){const it=this.selectGlslLibRoutinesToBeIncluded(tt);if(it.length===0)return"";let st="";for(let ot=0;ot<it.length;++ot){if(!it[ot].routineBody)throw new Error(`Missing body for the Glsl Library routine: ${it[ot].name}`);st+=it[ot].routineBody+`
`}return st}selectGlslLibRoutinesToBeIncluded(tt){const it=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach((st=>{const ot=st.split(".")[1];tt.indexOf(ot)!==-1&&it.push(this.glslLibRoutineDependencyGraph[st])})),te.TopologicalSortGlslRoutines.returnOrderedNodes(it)}getUniforms(tt,it){const st=[];if(tt)for(const ot of tt)st.push(`uniform sampler2D ${ot};`);if(it)for(const ot of it)st.push(`uniform ${ot.type} ${ot.name}${ot.arrayLength?`[${ot.arrayLength}]`:""};`);return st.join(`
`)}}},5483:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.glslRegistry=void 0;const te=Y(5107),ne=Y(7341),xe=Y(9894),et=Y(2655),tt=Y(3891);O.glslRegistry={encoding:ne.EncodingGlslLib,fragcolor:xe.FragColorGlslLib,vec:tt.VecGlslLib,shapeUtils:et.ShapeUtilsGlslLib,coordinates:te.CoordsGlslLib}},2655:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.ShapeUtilsGlslLib=void 0;const te=Y(8520);class ne extends te.GlslLib{constructor(et){super(et)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.bcastIndex()),this.bcastMatmulIndex()),this.offsetToIndices()),this.indicesToOffset()),this.incrementIndices())}getCustomTypes(){return{}}bcastIndex(){const et=this.context.outputTextureLayout.shape.length,tt={};return this.context.programInfo.inputNames.forEach(((it,st)=>{const ot=this.context.inputTextureLayouts[st].unpackedShape;if(ot.length<=et){const rt=ot.length,nt=et-rt,at=`bcastIndices_${it}`;let ct="";for(let dt=0;dt<rt;++dt)ct+=`
          realIndices[${dt}] = int( mod(float(bcastedIndices[${nt+dt}]), ${ot[dt]}.0) );
          `;const ut=`
        void ${at} (int bcastedIndices[${et}], out int realIndices[${rt}]) {
          ${ct}
        }
        `;tt[at]=new te.GlslLibRoutine(ut)}})),tt}bcastMatmulIndex(){const et=this.context.outputTextureLayout.shape.length,tt={};return this.context.programInfo.inputNames.forEach(((it,st)=>{const ot=this.context.inputTextureLayouts[st].shape;if(!(ot.length<2||ot.length>et)){const rt=ot.length,nt=et-rt,at=`bcastMatmulIndices_${it}`;let ct="";for(let dt=0;dt<rt-2;++dt)ct+=`
          realIndices[${dt}] = int( mod(float(bcastedIndices[${nt+dt}]), ${ot[dt]}.0) );
          `;const ut=`
        void ${at}(int bcastedIndices[${et}], out int realIndices[${rt}]) {
          ${ct}
          realIndices[${rt-1}] = bcastedIndices[${et-1}];
          realIndices[${rt-2}] = bcastedIndices[${et-2}];
        }
        `;tt[at]=new te.GlslLibRoutine(ut)}})),tt}indicesToOffset(){const et={};return this.context.programInfo.inputNames.forEach(((tt,it)=>{const st=this.context.inputTextureLayouts[it].shape,ot=this.context.inputTextureLayouts[it].strides,rt=st.length;let nt=`indicesToOffset_${tt}`;et[nt]=new te.GlslLibRoutine(ne.indexToOffsetSingle(nt,rt,ot)),nt=`indicesToOffset_${tt}_T`,et[nt]=new te.GlslLibRoutine(ne.indexToOffsetSingle(nt,rt,ot.slice().reverse()))})),et}static indexToOffsetSingle(et,tt,it){let st="";for(let ot=tt-1;ot>=0;--ot)st+=`
        offset += indices[${ot}] * ${it[ot]};
        `;return`
      int ${et}(int indices[${tt}]) {
        int offset = 0;
        ${st}
        return offset;
      }
      `}offsetToIndices(){const et={};return this.context.programInfo.inputNames.forEach(((tt,it)=>{const st=this.context.inputTextureLayouts[it].shape,ot=this.context.inputTextureLayouts[it].strides,rt=st.length;let nt=`offsetToIndices_${tt}`;et[nt]=new te.GlslLibRoutine(ne.offsetToIndicesSingle(nt,rt,ot)),nt=`offsetToIndices_${tt}_T`,et[nt]=new te.GlslLibRoutine(ne.offsetToIndicesSingle(nt,rt,ot.slice().reverse()))})),et}static offsetToIndicesSingle(et,tt,it){const st=[];for(let ot=0;ot<tt-1;++ot)st.push(`
      indices[${ot}] = offset / ${it[ot]};`),st.push(`
        offset -= indices[${ot}] * ${it[ot]};`);return st.push(`
      indices[${tt-1}] = offset;`),`
      void ${et}(int offset, out int indices[${tt}]) {
        ${st.join("")}
      }
      `}incrementIndices(){const et={};return this.context.programInfo.inputNames.forEach(((tt,it)=>{const st=this.context.inputTextureLayouts[it].shape,ot=st.length,rt=`incrementIndices_${tt}`;let nt="";for(let ct=0;ct<ot;++ct)nt+=`
        shape[${ct}] = ${st[ct]};`;const at=`
        void ${rt}(int axis, out int indices[${ot}]) {
          int shape[${ot}];
          ${nt};
          for(int i = ${ot} -1 ; i >= 0; --i) {
            if(i > axis) continue;
            indices[i] += 1;
            if(indices[i] < shape[i]) {
              break;
            }
            indices[i] = 0;
          }
        }
        `;et[rt]=new te.GlslLibRoutine(at)})),et}}O.ShapeUtilsGlslLib=ne},5060:(ee,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.getDefaultFragShaderMain=O.getFragShaderPreamble=O.getVertexShaderSource=O.getGlsl=void 0;const Y={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},te={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"};function ne(xe){return xe===1?Y:te}O.getGlsl=ne,O.getVertexShaderSource=function(xe){const et=ne(xe);return`${et.version}
      precision highp float;
      ${et.attribute} vec3 position;
      ${et.attribute} vec2 textureCoord;

      ${et.varyingVertex} vec2 TexCoords;

      void main()
      {
          gl_Position = vec4(position, 1.0);
          TexCoords = textureCoord;
      }`},O.getFragShaderPreamble=function(xe){const et=ne(xe);return`${et.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${et.varyingFrag} vec2 TexCoords;
    ${et.outputDeclaration}
    const vec2 halfCR = vec2(0.5, 0.5);

    // Custom vector types to handle higher dimenalities.
    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    `},O.getDefaultFragShaderMain=function(xe,et){return`
  void main() {
    int indices[${et}];
    toVec(TexCoords, indices);
    vec4 result = vec4(process(indices));
    ${ne(xe).output} = result;
  }
  `}},3891:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.VecGlslLib=void 0;const te=Y(8520);class ne extends te.GlslLib{constructor(et){super(et)}getCustomTypes(){return{}}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign({},this.binaryVecFunctions()),this.copyVec()),this.setVecItem()),this.getVecItem())}binaryVecFunctions(){const et=this.context.outputTextureLayout.shape.length,tt={add:"+=",sub:"-=",mul:"*=",div:"/="},it={};for(const st in tt){const ot=`${st}Vec`;let rt="";for(let at=0;at<et;++at)rt+=`
          dest[${at}] ${tt[st]} src[${at}];
          `;const nt=`
        void ${ot}(int src[${et}], out int dest[${et}]) {
          ${rt}
        }
        `;it[ot]=new te.GlslLibRoutine(nt)}return it}copyVec(){const et=this.context.outputTextureLayout.shape.length;let tt="";for(let st=0;st<et;++st)tt+=`
        dest[${st}] = src[${st}];
        `;const it=`
      void copyVec(int src[${et}], out int dest[${et}]) {
        ${tt}
      }
      `;return{copyVec:new te.GlslLibRoutine(it)}}setVecItem(){const et=this.context.outputTextureLayout.shape.length;let tt=`
        if(index < 0)
            index =${et} + index;
        if (index == 0)
            m[0] = value;
        `;for(let st=1;st<et-1;++st)tt+=`
        else if (index == ${st})
            m[${st}] = value;
            `;tt+=`
        else
            m[${et-1}] = value;
        `;const it=`
      void setVecItem(out int m[${et}], int index, int value) {
        ${tt}
      }
        `;return{setVecItem:new te.GlslLibRoutine(it)}}getVecItem(){const et=this.context.outputTextureLayout.shape.length;let tt=`
        if(index < 0)
            index = ${et} + index;
        if (index == 0)
            return m[0];
      `;for(let st=1;st<et-1;++st)tt+=`
        else if (index == ${st})
            return m[${st}];
      `;tt+=`
        else
            return m[${et-1}];
        `;const it=`
      int getVecItem(int m[${et}], int index) {
        ${tt}
      }
    `;return{getVecItem:new te.GlslLibRoutine(it)}}}O.VecGlslLib=ne},8316:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.WebGLInferenceHandler=void 0;const te=Y(6231),ne=Y(9162),xe=Y(2517),et=Y(2403),tt=Y(7019),it=Y(8710),st=Y(5611),ot=Y(4057),rt=Y(2039);O.WebGLInferenceHandler=class{constructor(nt){this.session=nt,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(nt,at){return(0,ot.calculateTextureWidthAndHeight)(this.session.layoutStrategy,nt,at)}executeProgram(nt,at){if(at.length<nt.inputNames.length)throw new Error(`Input size mustn't be less than ${nt.inputNames.length}.`);if(nt.inputNames.length!==nt.inputTypes.length)throw new Error("input names size does not match input types");const ct=[];for(let mt=0;mt<nt.inputNames.length;++mt)ct[mt]=this.getOrCreateTextureData(at[mt],nt.inputTypes[mt]);const ut=((mt,yt)=>{const bt=yt.map((Et=>`${Et.unpackedShape.join(",")};${Et.width}x${Et.height}`)).join("_");let vt=mt.name;return mt.cacheHint&&(vt+="["+mt.cacheHint+"]"),vt+=":"+bt,vt})(nt,ct);let dt=this.session.programManager.getArtifact(ut);const ht=dt?dt.programInfo:typeof nt.get=="function"?nt.get():nt,pt=(0,ot.createTextureLayoutFromTextureType)(this.session.layoutStrategy,ht.output.dims,ht.output.textureType),ft=this.createTextureData(pt,ht.output.type);return dt||(dt=this.session.programManager.build(ht,ct,ft),this.session.programManager.setArtifact(ut,dt)),this.runProgram(dt,ct,ft),ft}run(nt,at){return this.executeProgram(nt,at).tensor}runProgram(nt,at,ct){for(let ut=0;ut<at.length;++ut)if(!!at[ut].isPacked!=(nt.programInfo.inputTypes[ut]===rt.TextureType.packed))throw new Error(`input[${ut}] property packed inconsistent`);if(!!ct.isPacked!=(nt.programInfo.output.textureType===rt.TextureType.packed))throw new Error("output property packed inconsistent");this.session.programManager.run(nt,at,ct)}getOrCreateTextureData(nt,at){let ct=this.getTextureData(nt.dataId,at===rt.TextureType.packed);if(!ct&&(ct=this.getTextureData(nt.dataId,at!==rt.TextureType.packed),ct))return at===rt.TextureType.packed?this.pack(ct):this.unpack(ct);if(!ct){const ut=(0,ot.createTextureLayoutFromTextureType)(this.session.layoutStrategy,nt.dims,at);if(at===rt.TextureType.packedLastDimension){const pt=nt.dims;if(pt.length===4){const ft=[pt[0],Math.ceil(pt[1]*pt[2]*pt[3]/4)],mt=(0,ot.createTextureLayoutFromTextureType)(this.session.layoutStrategy,ft,at);let yt=nt.numberData;if(pt[1]*pt[2]*pt[3]%4!=0){const bt=pt[0],vt=pt[1]*pt[2]*pt[3],Et=Math.ceil(vt*1/4)*4;yt=new Float32Array(bt*Et);for(let wt=0;wt<bt;++wt){const St=wt*vt,Ot=wt*Et+wt%1*vt;yt.set(nt.numberData.subarray(St,St+vt),Ot)}}return this.createTextureData(mt,nt.type,yt,nt,1)}}if(at===rt.TextureType.packed){const dt=(0,ot.createTextureLayoutFromShape)(this.session.layoutStrategy,nt.dims,1,[],{reverseWH:!0}),ht=this.createTextureData(dt,nt.type,nt.numberData,nt,1);ct=this.pack(ht)}else ct=this.createTextureData(ut,nt.type,nt.numberData,nt,1)}return ct}createTextureDataFromLayoutBindTensor(nt,at,ct,ut){return this.createTextureData(nt,at,ct,ut,1)}createTextureData(nt,at,ct,ut,dt){te.Logger.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(nt)}]`);const ht=this.session.textureManager.createTextureFromLayout(at,nt,ct,dt);return this.createTextureDataFromTexture(nt,at,ht,ut)}reshapeUnpacked(nt,at){const ct=this.getOrCreateTextureData(nt,rt.TextureType.unpacked),ut={channels:ct.channels,height:ct.height,width:ct.width,shape:at.length!==0?at:[1],strides:xe.ShapeUtil.computeStrides(at),unpackedShape:at};return this.createTextureDataFromTexture(ut,nt.type,ct.texture).tensor}reshapePacked(nt,at){const ct=this.getOrCreateTextureData(nt,rt.TextureType.packed);if((0,tt.isReshapeCheap)(nt.dims,at)){const ft={channels:ct.channels,height:ct.height,width:ct.width,shape:at.length!==0?at:[1],strides:xe.ShapeUtil.computeStrides(at),unpackedShape:at,isPacked:!0};return this.createTextureDataFromTexture(ft,nt.type,ct.texture).tensor}const ut=(0,tt.processDims3D)(nt.dims),dt=(0,tt.processDims3D)(at),ht=this.reshapePacked(nt,ut),pt=this.run((0,tt.createPackedReshape3DProgramInfoLoader)(this,ht,dt),[ht]);return this.reshapePacked(pt,at)}cast(nt,at){const ct=this.getOrCreateTextureData(nt,rt.TextureType.unpacked);return this.createTextureDataFromTexture(ct,at,ct.texture).tensor}createTextureDataFromTexture(nt,at,ct,ut,dt){const ht=Object.assign(Object.assign({},nt),{tensor:ut||new ne.Tensor(nt.unpackedShape,at,(pt=>this.readTexture(ht)),(async pt=>this.readTextureAsync(ht)),void 0,dt),texture:ct});return this.setTextureData(ht.tensor.dataId,ht,nt.isPacked),ht}getTextureData(nt,at=!1){return this.session.isInitializer(nt)?this.session.getTextureData(nt,at):at?this.packedTextureDataCache.get(nt):this.unpackedTextureDataCache.get(nt)}setTextureData(nt,at,ct=!1){this.session.isInitializer(nt)?this.session.setTextureData(nt,at,ct):(ct?this.packedTextureDataCache:this.unpackedTextureDataCache).set(nt,at)}isTextureLayoutCached(nt,at=!1){return!!this.getTextureData(nt.dataId,at)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((nt=>this.session.textureManager.releaseTexture(nt))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((nt=>this.session.textureManager.releaseTexture(nt))),this.unpackedTextureDataCache=new Map}readTexture(nt){return nt.isPacked?this.readTexture(this.unpack(nt)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(nt,nt.tensor.type,nt.channels):this.session.textureManager.readUint8TextureAsFloat((0,it.encodeAsUint8)(this,nt))}async readTextureAsync(nt){return nt.isPacked?this.readTextureAsync(this.unpack(nt)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(nt,nt.tensor.type,nt.channels):this.session.textureManager.readUint8TextureAsFloat((0,it.encodeAsUint8)(this,nt))}pack(nt){return this.executeProgram((0,et.createPackProgramInfoLoader)(this,nt.tensor),[nt.tensor])}unpack(nt){return this.executeProgram((0,st.createUnpackProgramInfoLoader)(this,nt.tensor),[nt.tensor])}}},1640:function(ee,O,Y){var te=this&&this.__createBinding||(Object.create?function(zt,Kt,qt,Xt){Xt===void 0&&(Xt=qt);var an=Object.getOwnPropertyDescriptor(Kt,qt);an&&!("get"in an?!Kt.__esModule:an.writable||an.configurable)||(an={enumerable:!0,get:function(){return Kt[qt]}}),Object.defineProperty(zt,Xt,an)}:function(zt,Kt,qt,Xt){Xt===void 0&&(Xt=qt),zt[Xt]=Kt[qt]}),ne=this&&this.__setModuleDefault||(Object.create?function(zt,Kt){Object.defineProperty(zt,"default",{enumerable:!0,value:Kt})}:function(zt,Kt){zt.default=Kt}),xe=this&&this.__importStar||function(zt){if(zt&&zt.__esModule)return zt;var Kt={};if(zt!=null)for(var qt in zt)qt!=="default"&&Object.prototype.hasOwnProperty.call(zt,qt)&&te(Kt,zt,qt);return ne(Kt,zt),Kt};Object.defineProperty(O,"__esModule",{value:!0}),O.WEBGL_OP_RESOLVE_RULES=void 0;const et=Y(2898),tt=xe(Y(7839)),it=Y(4196),st=Y(2069),ot=Y(8138),rt=Y(9663),nt=Y(5193),at=Y(7992),ct=Y(1253),ut=Y(4776),dt=Y(6572),ht=Y(3346),pt=Y(5623),ft=Y(2870),mt=Y(2143),yt=Y(4939),bt=Y(718),vt=Y(2268),Et=Y(8117),wt=Y(2278),St=Y(5524),Ot=Y(5975),$t=Y(3933),Mt=Y(6558),Nt=Y(5723),Rt=Y(3738),Pt=xe(Y(4909)),kt=Y(8428),Wt=Y(9793);O.WEBGL_OP_RESOLVE_RULES=[["Abs","","6+",Pt.abs],["Acos","","7+",Pt.acos],["Add","","7+",tt.add],["And","","7+",tt.and],["Asin","","7+",Pt.asin],["Atan","","7+",Pt.atan],["AveragePool","","7+",mt.averagePool,mt.parseAveragePoolAttributes],["BatchNormalization","","7+",et.batchNormalization,et.parseBatchNormalizationAttributes],["Cast","","6+",it.cast,it.parseCastAttributes],["Ceil","","6+",Pt.ceil],["Clip","","6-10",Pt.clip,Pt.parseClipAttributes],["Clip","","11+",Pt.clipV11],["Concat","","4+",st.concat,st.parseConcatAttributes],["Conv","","1+",ot.conv,ot.parseConvAttributes],["ConvTranspose","","1+",rt.convTranspose,rt.parseConvTransposeAttributes],["Cos","","7+",Pt.cos],["Div","","7+",tt.div],["Dropout","","7+",Pt.identity],["DepthToSpace","","1+",nt.depthToSpace,nt.parseDepthToSpaceAttributes],["Equal","","7+",tt.equal],["Elu","","6+",Pt.elu,Pt.parseEluAttributes],["Exp","","6+",Pt.exp],["Flatten","","1+",at.flatten,at.parseFlattenAttributes],["Floor","","6+",Pt.floor],["FusedConv","com.microsoft","1+",ot.conv,ot.parseConvAttributes],["Gather","","1+",ct.gather,ct.parseGatherAttributes],["Gemm","","7-10",ut.gemm,ut.parseGemmAttributesV7],["Gemm","","11+",ut.gemm,ut.parseGemmAttributesV11],["GlobalAveragePool","","1+",mt.globalAveragePool,mt.parseGlobalAveragePoolAttributes],["GlobalMaxPool","","1+",mt.globalMaxPool],["Greater","","7+",tt.greater],["Identity","","1+",Pt.identity],["ImageScaler","","1+",dt.imageScaler,dt.parseImageScalerAttributes],["InstanceNormalization","","6+",ht.instanceNormalization,ht.parseInstanceNormalizationAttributes],["LeakyRelu","","6+",Pt.leakyRelu,Pt.parseLeakyReluAttributes],["Less","","7+",tt.less],["Log","","6+",Pt.log],["MatMul","","1+",pt.matMul,pt.parseMatMulAttributes],["MaxPool","","1+",mt.maxPool,mt.parseMaxPoolAttributes],["Mul","","7+",tt.mul],["Neg","","6+",Pt.neg],["Not","","1+",Pt.not],["Or","","7+",tt.or],["Pad","","2-10",ft.padV2,ft.parsePadAttributesV2],["Pad","","11+",ft.padV11,ft.parsePadAttributesV11],["Pow","","7+",tt.pow],["PRelu","","7+",tt.pRelu],["ReduceLogSum","","1+",yt.reduceLogSum,yt.parseReduceAttributes],["ReduceMax","","1+",yt.reduceMax,yt.parseReduceAttributes],["ReduceMean","","1+",yt.reduceMean,yt.parseReduceAttributes],["ReduceMin","","1+",yt.reduceMin,yt.parseReduceAttributes],["ReduceProd","","1+",yt.reduceProd,yt.parseReduceAttributes],["ReduceSum","","1-12",yt.reduceSum,yt.parseReduceAttributes],["ReduceSumSquare","","1+",yt.reduceLogSumSquare,yt.parseReduceAttributes],["Relu","","6+",Pt.relu],["Reshape","","5+",bt.reshape],["Resize","","10",vt.resize,vt.parseResizeAttributesV10],["Resize","","11+",vt.resize,vt.parseResizeAttributesV11],["Shape","","1+",Et.shape],["Sigmoid","","6+",Pt.sigmoid],["Sin","","7+",Pt.sin],["Slice","","10+",wt.sliceV10],["Slice","","1-9",wt.slice,wt.parseSliceAttributes],["Softmax","","1-12",St.softmax,St.parseSoftmaxAttributes],["Softmax","","13+",St.softmaxV13,St.parseSoftmaxAttributesV13],["Split","","2-12",Ot.split,Ot.parseSplitAttributes],["Sqrt","","6+",Pt.sqrt],["Squeeze","","1-12",$t.squeeze,$t.parseSqueezeAttributes],["Squeeze","","13+",$t.squeezeV13],["Sub","","7+",tt.sub],["Sum","","6+",Mt.sum],["Tan","","7+",Pt.tan],["Tanh","","6+",Pt.tanh],["Tile","","6+",Nt.tile],["Transpose","","1+",Rt.transpose,Rt.parseTransposeAttributes],["Upsample","","7-8",Wt.upsample,Wt.parseUpsampleAttributesV7],["Upsample","","9",Wt.upsample,Wt.parseUpsampleAttributesV9],["Unsqueeze","","1-12",kt.unsqueeze,kt.parseUnsqueezeAttributes],["Unsqueeze","","13+",kt.unsqueezeV13],["Xor","","7+",tt.xor]]},2898:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseBatchNormalizationAttributes=O.batchNormalization=void 0;const te=Y(246),ne=Y(5060),xe=Y(2039),et={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[xe.TextureType.unpacked,xe.TextureType.unpacked,xe.TextureType.unpacked,xe.TextureType.unpacked,xe.TextureType.unpacked]};O.batchNormalization=(st,ot,rt)=>(it(ot),[st.run(Object.assign(Object.assign({},et),{cacheHint:rt.cacheKey,get:()=>tt(st,ot,rt)}),ot)]),O.parseBatchNormalizationAttributes=st=>{const ot=st.attributes.getFloat("epsilon",1e-5),rt=st.attributes.getFloat("momentum",.9),nt=st.attributes.getInt("spatial",1);return(0,te.createAttributeWithCacheKey)({epsilon:ot,momentum:rt,spatial:nt})};const tt=(st,ot,rt)=>{const nt=(0,ne.getGlsl)(st.session.backend.glContext.version),at=ot[0].dims.length,[ct,ut]=st.calculateTextureWidthAndHeight(ot[1].dims,xe.TextureType.unpacked),dt=`
  float process(int[${at}] indices) {
    vec2 position = offsetToCoords(indices[1], ${ct}, ${ut});
    float scale = getColorAsFloat(${nt.texture2D}(Scale, position));
    float mean = getColorAsFloat(${nt.texture2D}(Mean, position));
    float variance = getColorAsFloat(${nt.texture2D}(Variance, position));
    float b = getColorAsFloat(${nt.texture2D}(B, position));

    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${rt.epsilon})) ) + b;
  }`;return Object.assign(Object.assign({},et),{output:{dims:ot[0].dims,type:ot[0].type,textureType:xe.TextureType.unpacked},shaderSource:dt})},it=st=>{if(!st||st.length!==5)throw new Error("BatchNormalization requires 5 inputs.");const ot=st[0],rt=st[1],nt=st[2],at=st[3],ct=st[4];if(ot.dims.length<3||rt.dims.length!==1||nt.dims.length!==1||at.dims.length!==1||ct.dims.length!==1)throw new Error("invalid input shape.");if(rt.dims[0]!==ot.dims[1]||nt.dims[0]!==ot.dims[1]||at.dims[0]!==ot.dims[1]||ct.dims[0]!==ot.dims[1])throw new Error("invalid input shape.");if(ot.type!=="float32"&&ot.type!=="float64"||rt.type!=="float32"&&rt.type!=="float64"||nt.type!=="float32"&&nt.type!=="float64"||at.type!=="float32"&&at.type!=="float64"||ct.type!=="float32"&&ct.type!=="float64")throw new Error("invalid input tensor types.")}},7839:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.xor=O.sub=O.pRelu=O.pow=O.or=O.mul=O.less=O.greater=O.equal=O.div=O.and=O.add=O.glslPRelu=O.glslPow=O.glslXor=O.glslOr=O.glslAnd=O.glslLess=O.glslGreater=O.glslEqual=O.glslSub=O.glslMul=O.glslDiv=O.glslAdd=void 0;const te=Y(2517),ne=Y(8520),xe=Y(5060),et=Y(2039);function tt(){const yt="add_";return{body:`
  float ${yt}(float a, float b) {
    return a + b;
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return v1 + v2;
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function it(){const yt="div_";return{body:`
  float ${yt}(float a, float b) {
    return a / b;
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return v1 / v2;
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function st(){const yt="mul_";return{body:`
  float ${yt}(float a, float b) {
    return a * b;
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return v1 * v2;
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function ot(){const yt="sub_";return{body:`
  float ${yt}(float a, float b) {
    return a - b;
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return v1 - v2;
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function rt(){const yt="equal_";return{body:`
  float ${yt}(float a, float b) {
    return float(a == b);
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return vec4(equal(v1, v2));
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function nt(){const yt="greater_";return{body:`
  float ${yt}(float a, float b) {
    return float(a > b);
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return vec4( v1.r > v2.r ,
      v1.g > v2.g,
      v1.b > v2.b,
      v1.a > v2.a );
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function at(){const yt="less_";return{body:`
  float ${yt}(float a, float b) {
    return float(a < b);
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return vec4( v1.r < v2.r ,
                v1.g < v2.g,
                v1.b < v2.b,
                v1.a < v2.a );
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function ct(){const yt="and_";return{body:`
  float ${yt}(float a, float b) {
    return float( bool(a) && bool(b) );
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r && b2.r ,
                b1.g && b2.g,
                b1.b && b2.b,
                b1.a && b2.a );
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function ut(){return{body:`
  float or_(float a, float b) {
    return float( bool(a) || bool(b) );
  }
  vec4 or_(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r || b2.r ,
                b1.g || b2.g,
                b1.b || b2.b,
                b1.a || b2.a );
  }
  `,name:"or_",type:ne.FunctionType.ValueBased}}function dt(){const yt="xor_";return{body:`
  float ${yt}(float a, float b) {
    return float( bool(a) ^^ bool(b) );
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r ^^ b2.r ,
                b1.g ^^ b2.g,
                b1.b ^^ b2.b,
                b1.a ^^ b2.a );
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}function ht(){return(function(yt){const bt=`${yt}_`;return{body:`
  float ${bt}(float a, float b) {
    return ${yt}(a, b);
  }
  vec4 ${bt}(vec4 v1, vec4 v2) {
    return ${yt}(v1, v2);
  }
  `,name:bt,type:ne.FunctionType.ValueBased}})("pow")}function pt(){const yt="prelu_";return{body:`
  float ${yt}(float a, float b) {
    return a < 0.0 ? a * b: a;
  }
  vec4 ${yt}(vec4 v1, vec4 v2) {
    return vec4(
      v1.r < 0.0 ? v1.r * v2.r: v1.r,
      v1.g < 0.0 ? v1.g * v2.g: v1.g,
      v1.b < 0.0 ? v1.b * v2.b: v1.b,
      v1.a < 0.0 ? v1.a * v2.a: v1.a
      );
  }
  `,name:yt,type:ne.FunctionType.ValueBased}}O.glslAdd=tt,O.glslDiv=it,O.glslMul=st,O.glslSub=ot,O.glslEqual=rt,O.glslGreater=nt,O.glslLess=at,O.glslAnd=ct,O.glslOr=ut,O.glslXor=dt,O.glslPow=ht,O.glslPRelu=pt;const ft=(yt,bt,vt,Et=bt[0].type,wt)=>{const St=yt.session.pack?et.TextureType.packed:et.TextureType.unpacked;return{name:vt.name,inputNames:["A","B"],inputTypes:[St,St],cacheHint:wt,get:()=>mt(yt,bt,vt,Et)}},mt=(yt,bt,vt,Et=bt[0].type)=>{const wt=yt.session.pack?et.TextureType.packed:et.TextureType.unpacked,St=!te.ShapeUtil.areEqual(bt[0].dims,bt[1].dims);let Ot=bt[0].dims;const $t=yt.session.pack;if(St){const Rt=te.BroadcastUtil.calcShape(bt[0].dims,bt[1].dims,!1);if(!Rt)throw new Error("Can't perform binary op on the given tensors");Ot=Rt;const Pt=Ot.length,kt=bt[0].dims.length!==0?bt[0].dims.length:1,Wt=bt[1].dims.length!==0?bt[1].dims.length:1,zt=bt[0].dims.length!==0?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",Kt=bt[1].dims.length!==0?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",qt=(0,xe.getGlsl)(yt.session.backend.glContext.version),Xt=$t?`
      ${vt.body}
      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        vec4 result = ${vt.name}(a, b);
        ${qt.output} = result;
      }`:`
      ${vt.body}
      float process(int indices[${Pt}]) {
        int aindices[${kt}];
        int bindices[${Wt}];
        ${zt}
        ${Kt}
        return ${vt.name}(_A(aindices), _B(bindices));
      }`;return{name:vt.name,inputNames:["A","B"],inputTypes:[wt,wt],output:{dims:Ot,type:Et,textureType:wt},shaderSource:Xt,hasMain:$t}}const Mt=(0,xe.getGlsl)(yt.session.backend.glContext.version),Nt=`
    ${vt.body}
    void main() {
      vec4 v1 = ${Mt.texture2D}(A, TexCoords);
      vec4 v2 = ${Mt.texture2D}(B, TexCoords);
      vec4 result = ${vt.name}(v1, v2);
      ${Mt.output} = result;
    }
    `;return{name:vt.name,inputNames:["A","B"],inputTypes:[wt,wt],output:{dims:bt[0].dims,type:Et,textureType:wt},shaderSource:Nt,hasMain:!0}};O.add=(yt,bt)=>[yt.run(ft(yt,bt,tt()),bt)],O.and=(yt,bt)=>[yt.run(ft(yt,bt,ct(),"bool"),bt)],O.div=(yt,bt)=>[yt.run(ft(yt,bt,it()),bt)],O.equal=(yt,bt)=>[yt.run(ft(yt,bt,rt(),"bool"),bt)],O.greater=(yt,bt)=>[yt.run(ft(yt,bt,nt(),"bool"),bt)],O.less=(yt,bt)=>[yt.run(ft(yt,bt,at(),"bool"),bt)],O.mul=(yt,bt)=>[yt.run(ft(yt,bt,st()),bt)],O.or=(yt,bt)=>[yt.run(ft(yt,bt,ut(),"bool"),bt)],O.pow=(yt,bt)=>[yt.run(ft(yt,bt,ht()),bt)],O.pRelu=(yt,bt)=>[yt.run(ft(yt,bt,pt()),bt)],O.sub=(yt,bt)=>[yt.run(ft(yt,bt,ot()),bt)],O.xor=(yt,bt)=>[yt.run(ft(yt,bt,dt(),"bool"),bt)]},4196:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseCastAttributes=O.cast=void 0;const te=Y(2517);O.cast=(xe,et,tt)=>(ne(et),[xe.cast(et[0],tt)]),O.parseCastAttributes=xe=>te.ProtoUtil.tensorDataTypeFromProto(xe.attributes.getInt("to"));const ne=xe=>{if(!xe||xe.length!==1)throw new Error("Cast requires 1 input.");if(xe[0].type==="string")throw new Error("Invalid input type.")}},1163:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createPackedConcatProgramInfoLoader=void 0;const te=Y(5060),ne=Y(2039),xe=Y(9390),et=Y(2827);O.createPackedConcatProgramInfoLoader=(it,st,ot)=>{const rt=(nt=st.length,at=ot.cacheKey,{name:"Concat (packed)",inputNames:Array.from({length:nt},((ct,ut)=>`X${ut}`)),inputTypes:Array(nt).fill(ne.TextureType.packed),cacheHint:at});var nt,at;return Object.assign(Object.assign({},rt),{get:()=>((ct,ut,dt,ht)=>{const pt=dt[0].dims.slice();if(ht>=pt.length||ht<-1*pt.length)throw new Error("axis specified for concat doesn't match input dimensionality");ht<0&&(ht=pt.length+ht);const ft=pt.slice(0);for(let zt=1;zt<dt.length;zt++){const Kt=dt[zt].dims.slice();for(let qt=0;qt<pt.length;qt++)if(qt===ht)ft[ht]+=Kt[qt];else if(pt[qt]!==Kt[qt])throw new Error("non concat dimensions must match")}const mt=ft.length,yt=(0,et.getChannels)("coords",mt),bt=(0,xe.getCoordsDataType)(mt),vt=(0,et.unpackFromChannel)(),Et=dt.map((zt=>zt.dims)),wt=(0,xe.getGlChannels)(mt),St=new Array(Et.length-1);St[0]=Et[0][ht];for(let zt=1;zt<St.length;zt++)St[zt]=St[zt-1]+Et[zt][ht];const Ot=wt[ht],$t=wt.slice(-2),Mt=wt.join();let Nt=`if (${Ot} < ${St[0]}) {
        return getChannel(
            getX0(${Mt}), vec2(${$t.join()}));
        }`;for(let zt=1;zt<St.length;zt++){const Kt=St[zt-1];Nt+=`
            if (${Ot} < ${St[zt]}  && ${Ot} >= ${St[zt-1]}) {
              return getChannel(
                getX${zt}(${tt(wt,Ot,Kt)}),
                vec2(${tt($t,Ot,Kt)}));
            }`}const Rt=St.length,Pt=St[St.length-1];Nt+=`
            return getChannel(
              getX${Rt}(${tt(wt,Ot,Pt)}),
              vec2(${tt($t,Ot,Pt)}));`;const kt=(0,te.getGlsl)(ct.session.backend.glContext.version),Wt=`
          ${vt}
          float getValue(${wt.map((zt=>"int "+zt))}) {
            ${Nt}
          }

          void main() {
            ${bt} coords = getOutputCoords();
            int lastDim = coords.${wt[mt-1]};
            coords.${wt[mt-1]} = coords.${wt[mt-2]};
            coords.${wt[mt-2]} = lastDim;

            vec4 result = vec4(getValue(${yt}), 0., 0., 0.);

            ${yt[mt-1]} = ${yt[mt-1]} + 1;
            if (${yt[mt-1]} < ${ft[mt-1]}) {
              result.g = getValue(${yt});
            }

            ${yt[mt-2]} = ${yt[mt-2]} + 1;
            if (${yt[mt-2]} < ${ft[mt-2]}) {
              result.a = getValue(${yt});
            }

            ${yt[mt-1]} = ${yt[mt-1]} - 1;
            if (${yt[mt-2]} < ${ft[mt-2]} &&
                ${yt[mt-1]} < ${ft[mt-1]}) {
              result.b = getValue(${yt});
            }
            ${kt.output} = result;
          }
        `;return Object.assign(Object.assign({},ut),{output:{dims:ft,type:dt[0].type,textureType:ne.TextureType.packed},shaderSource:Wt,hasMain:!0})})(it,rt,st,ot.axis)})};const tt=(it,st,ot)=>{const rt=it.indexOf(st);return it.map(((nt,at)=>at===rt?`${nt} - ${ot}`:nt)).join()}},2069:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseConcatAttributes=O.concat=void 0;const te=Y(246),ne=Y(2039),xe=Y(1163);O.concat=(nt,at,ct)=>(rt(at),nt.session.pack&&at[0].dims.length>1?[nt.run((0,xe.createPackedConcatProgramInfoLoader)(nt,at,ct),at)]:[nt.run(et(nt,at,ct),at)]);const et=(nt,at,ct)=>{const ut=(dt=at.length,ht=ct.cacheKey,{name:"Concat",inputNames:Array.from({length:dt},((pt,ft)=>`X${ft}`)),inputTypes:Array(dt).fill(ne.TextureType.unpacked),cacheHint:ht});var dt,ht;return Object.assign(Object.assign({},ut),{get:()=>((pt,ft,mt,yt)=>{const bt=mt[0].dims.slice();if(yt>=bt.length||yt<-1*bt.length)throw new Error("axis specified for concat doesn't match input dimensionality");yt<0&&(yt=bt.length+yt);const vt=bt.slice(0);for(let Mt=1;Mt<mt.length;Mt++){const Nt=mt[Mt].dims.slice();for(let Rt=0;Rt<bt.length;Rt++)if(Rt===yt)vt[yt]+=Nt[Rt];else if(bt[Rt]!==Nt[Rt])throw new Error("non concat dimensions must match")}const Et=vt.length,wt=new Array(mt.length);let St=0;for(let Mt=0;Mt<wt.length;++Mt)St+=mt[Mt].dims[yt],wt[Mt]=St;let Ot="";Ot=mt.length<5?tt(wt):it(wt);const $t=`
        ${st(mt.length,Et)}
        ${ot(wt)}
        ${Ot}
        float process(int indices[${Et}]) {
          int textureIndex = getTextureWhereDataResides (indices[${yt}]);

          if(textureIndex != 0) {
            indices[${yt}] = indices[${yt}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));
          }

          return fetchDataFromCorrectTexture(textureIndex, indices);
        }`;return Object.assign(Object.assign({},ft),{output:{dims:vt,type:mt[0].type,textureType:ne.TextureType.unpacked},shaderSource:$t})})(0,ut,at,ct.axis)})},tt=nt=>`int getTextureWhereDataResides(int index) {
      ${nt.map(((at,ct)=>`if(index<${at}) {return ${ct};}
`)).join("")}
    }`,it=nt=>tt(nt),st=(nt,at)=>{const ct=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${at}]) {`];for(let ut=0;ut<nt;++ut)ut===0?ct.push(`	if (textureIndex == ${ut}) { return _X${ut}(indices); }`):ut===nt-1?ct.push(`	else { return _X${ut}(indices); }`):ct.push(`	else if (textureIndex == ${ut}) { return _X${ut}(indices); }`);return ct.push("	}"),ct.join(`
`)},ot=nt=>{const at=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let ct=0;ct<nt.length;++ct)ct===0?at.push(`	if (index == ${ct}) { return ${nt[ct]}; }`):ct===nt.length-1?at.push(`	else { return ${nt[ct]}; }`):at.push(`	else if (index == ${ct}) { return ${nt[ct]}; }`);return at.push("	}"),at.join(`
`)};O.parseConcatAttributes=nt=>(0,te.createAttributeWithCacheKey)({axis:nt.attributes.getInt("axis")});const rt=nt=>{if(!nt||nt.length<1)throw new Error("too few inputs");const at=nt[0].type,ct=nt[0].dims.length;if(at==="string")throw new Error("string tensor is not supported yet");for(const ut of nt){if(ut.type!==at)throw new Error("input tensors should be one type");if(ut.dims.length!==ct)throw new Error("input tensors should have the same shape")}}},4770:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createUnpackedGroupedConvProgramInfoLoader=void 0;const te=Y(6231),ne=Y(5060),xe=Y(2039),et=Y(8138),tt=Y(2823);O.createUnpackedGroupedConvProgramInfoLoader=(it,st,ot)=>{const rt=(nt=st.length>2,at=ot.cacheKey,{name:"GroupedConv",inputNames:nt?["X","W","Bias"]:["X","W"],inputTypes:nt?[xe.TextureType.unpacked,xe.TextureType.unpacked,xe.TextureType.unpacked]:[xe.TextureType.unpacked,xe.TextureType.unpacked],cacheHint:at});var nt,at;return Object.assign(Object.assign({},rt),{get:()=>((ct,ut,dt,ht)=>{const pt=ut.length>2?"value += getBias(output_channel);":"",ft=ut[0].dims.slice(),mt=ut[1].dims.slice(),yt=mt[0]/ht.group;te.Logger.verbose("GroupedConv",`autpPad:${ht.autoPad}, dilations:${ht.dilations}, group:${ht.group}, kernelShape:${ht.kernelShape}, pads:${ht.pads}, strides:${ht.strides}`);const bt=(0,et.calculateOutputShape)(ft,mt,ht.dilations,ht.pads,ht.strides),vt=(0,ne.getGlsl)(ct.session.backend.glContext.version),{activationFunction:Et,applyActivation:wt}=(0,tt.getActivationSnippet)(ht),St=`
  const ivec2 strides = ivec2(${ht.strides[0]}, ${ht.strides[1]});
  const ivec2 pads = ivec2(${ht.pads[0]}, ${ht.pads[1]});
  ${Et}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;
    ivec2 xRCCorner = coords.zw * strides - pads;
    int group_id = output_channel / ${yt};

    float value = 0.0;
    for (int wInChannel = 0; wInChannel < ${mt[1]}; wInChannel++) {
      int input_channel = group_id * ${mt[1]} + wInChannel;
      for (int wHeight = 0; wHeight < ${mt[2]}; wHeight++) {
        int xHeight = xRCCorner.x + wHeight * ${ht.dilations[0]};

        if (xHeight < 0 || xHeight >= ${ft[2]}) {
          continue;
        }

        for (int wWidth = 0; wWidth < ${mt[3]}; wWidth++) {
          int xWidth = xRCCorner.y + wWidth * ${ht.dilations[1]};
          if (xWidth < 0 || xWidth >= ${ft[3]}) {
            continue;
          }

          float xVal = getX(batch, input_channel, xWidth, xHeight);
          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);
          value += xVal*wVal;
        }
      }
    }
    ${pt}
    ${wt}
    ${vt.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},dt),{output:{dims:bt,type:ut[0].type,textureType:xe.TextureType.unpacked},shaderSource:St,hasMain:!0})})(it,st,rt,ot)})}},1386:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.conv2DPacked=O.conv2DPackedPointwise=void 0;const te=Y(8138),ne=Y(8555),xe=Y(708);O.conv2DPackedPointwise=(et,tt,it)=>{const st=tt[0].dims,ot=tt[1].dims,rt=(0,te.calculateOutputShape)(st,ot,it.dilations,it.pads,it.strides),nt=et.reshapePacked(tt[0],[st[1],st[2]*st[3]]),at=et.reshapePacked(tt[1],[ot[0],ot[1]]),ct=tt.length>2?[at,nt,tt[2]]:[at,nt],ut=et.run((0,xe.createPackedMatmulProgramInfoLoader)(et,ct,it),ct);return et.reshapePacked(ut,rt)},O.conv2DPacked=(et,tt,it)=>{const st=tt[0].dims,ot=tt[1].dims,rt=(0,te.calculateOutputShape)(st,ot,it.dilations,it.pads,it.strides),nt=et.run((0,ne.createPackedIm2ColProgramInfoLoader)(et,tt[0],tt[1],rt,it),[tt[0]]),at=et.reshapePacked(tt[1],[ot[0],ot[1]*ot[2]*ot[3]]),ct=tt.length===3?[at,nt,tt[2]]:[at,nt],ut=et.run((0,xe.createPackedMatmulProgramInfoLoader)(et,ct,it),ct);return et.reshapePacked(ut,rt)}},9663:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseConvTransposeAttributes=O.convTranspose=void 0;const te=Y(246),ne=Y(5060),xe=Y(2039),et=Y(2823),tt=(at,ct,ut,dt,ht,pt)=>(at-1)*ct+ut+(dt-1)*ht+1-pt,it=(at,ct,ut,dt,ht)=>{const pt=Math.floor(at/2);ct==="SAME_UPPER"?(ut[dt]=pt,ut[ht]=at-pt):ct==="SAME_LOWER"&&(ut[dt]=at-pt,ut[ht]=pt)};O.convTranspose=(at,ct,ut)=>(nt(ct,ut),st(at,ct,ut));const st=(at,ct,ut)=>{const dt=rt(ut,ct);return[ot(at,ct,dt)]},ot=(at,ct,ut)=>at.run(((dt,ht,pt)=>{const ft=(mt=ht.length>2,yt=pt.cacheKey,{name:"ConvTranspose",inputNames:mt?["X","W","B"]:["X","W"],inputTypes:mt?[xe.TextureType.unpacked,xe.TextureType.unpacked,xe.TextureType.unpacked]:[xe.TextureType.unpacked,xe.TextureType.unpacked],cacheHint:yt});var mt,yt;return Object.assign(Object.assign({},ft),{get:()=>((bt,vt,Et,wt)=>{const St=vt.length>2?"getB(output_channel)":"0.0",Ot=vt[0].dims,$t=vt[1].dims,Mt=$t[1],Nt=$t[0]/wt.group,Rt=[vt[0].dims[0],vt[1].dims[1]*wt.group,...wt.outputShape],Pt=(0,ne.getGlsl)(bt.session.backend.glContext.version),{activationFunction:kt,applyActivation:Wt}=(0,et.getActivationSnippet)(wt),zt=`
  const ivec2 strides = ivec2(${wt.strides[0]}, ${wt.strides[1]});
  const ivec2 pads = ivec2(${wt.pads[0]}, ${wt.pads[1]});
  ${kt}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;

    ivec2 loc = coords.zw + pads;

    int group_id = output_channel / ${Mt};
    int wOutChannel = output_channel - group_id * ${Mt};

    float value = ${St};
    for (int inChannelOffset = 0; inChannelOffset < ${Nt}; inChannelOffset++) {
      int input_channel = group_id * ${Nt} + inChannelOffset;
      for (int wWOff = 0; wWOff < ${$t[2]}; wWOff++) {
        for (int wHOff = 0; wHOff < ${$t[3]}; wHOff++) {
          ivec2 wOff = ivec2(wWOff * ${wt.dilations[0]}, wHOff * ${wt.dilations[1]});
          ivec2 wLoc = loc - wOff;
          ivec2 wLocIn = wLoc / strides;
          if (
            wLocIn * strides == wLoc &&
            wLocIn.x >= 0 && wLocIn.x < ${Ot[2]} &&
            wLocIn.y >= 0 && wLocIn.y < ${Ot[3]}
          ) {
            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);
            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);
            value += xVal * wVal;
          }
        }
      }
    }
    ${Wt}
    ${Pt.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},Et),{output:{dims:Rt,type:vt[0].type,textureType:xe.TextureType.unpacked},shaderSource:zt,hasMain:!0})})(dt,ht,ft,pt)})})(at,ct,ut),ct),rt=(at,ct)=>{const ut=at.kernelShape.slice();if(at.kernelShape.length===0)for(let ft=2;ft<ct[1].dims.length;++ft)ut.push(ct[1].dims[ft]);const dt=at.pads.slice(),ht=at.outputShape.slice();((ft,mt,yt,bt,vt,Et,wt,St)=>{const Ot=ft.length-2,$t=St.length===0;for(let Mt=0;Mt<Ot;++Mt){const Nt=$t?ft[Mt+2]*Et[Mt]:St[Mt],Rt=tt(ft[Mt+2],Et[Mt],vt[Mt],mt[Mt],yt[Mt],Nt);it(Rt,bt,vt,Mt,Mt+Ot),$t&&St.push(Et[Mt]*(ft[Mt+2]-1)+wt[Mt]+(mt[Mt]-1)*yt[Mt]+1-vt[Mt]-vt[Mt+Ot])}})(ct[0].dims,ut,at.dilations,at.autoPad,dt,at.strides,at.outputPadding,ht);const pt=Object.assign({},at);return Object.assign(pt,{kernelShape:ut,pads:dt,outputShape:ht,cacheKey:at.cacheKey}),pt};O.parseConvTransposeAttributes=at=>{const ct=at.attributes,ut=(0,et.parseInternalActivationAttributes)(ct),dt=ct.getString("auto_pad","NOTSET"),ht=ct.getInts("dilations",[1,1]),pt=ct.getInt("group",1),ft=ct.getInts("kernel_shape",[]),mt=ct.getInts("output_padding",[0,0]),yt=ct.getInts("output_shape",[]),bt=ct.getInts("pads",[0,0,0,0]),vt=ct.getInts("strides",[1,1]);return(0,te.createAttributeWithCacheKey)(Object.assign({autoPad:dt,dilations:ht,group:pt,kernelShape:ft,outputPadding:mt,outputShape:yt,pads:bt,strides:vt},ut))};const nt=(at,ct)=>{if(!at||at.length!==2&&at.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(at[0].dims.length!==4||at[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(at[0].dims[1]!==at[1].dims[0])throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");const ut=at[1].dims[1]*ct.group;if(at.length===3&&(at[2].dims.length!==1||at[2].dims[0]!==ut))throw new Error("invalid bias");const dt=at[0].dims.length-2;if(ct.dilations.length!==dt)throw new Error(`dilations should be ${dt}D`);if(ct.strides.length!==dt)throw new Error(`strides should be ${dt}D`);if(ct.pads.length!==2*dt)throw new Error(`pads should be ${2*dt}D`);if(ct.outputPadding.length!==dt)throw new Error(`output_padding should be ${dt}D`);if(ct.kernelShape.length!==0&&ct.kernelShape.length!==at[1].dims.length-2)throw new Error("invalid kernel shape");if(ct.outputShape.length!==0&&ct.outputShape.length!==at[0].dims.length-2)throw new Error("invalid output shape");if(at[0].type!=="float32"||at[1].type!=="float32")throw new Error("ConvTranspose input(X,W) should be float tensor");if(at.length===3&&at[2].type!=="float32")throw new Error("ConvTranspose input(bias) should be float tensor")}},8138:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseConvAttributes=O.conv=O.calculateOutputShape=void 0;const te=Y(246),ne=Y(2517),xe=Y(4770),et=Y(1386),tt=Y(9828),it=Y(2823),st=Y(3248),ot=Y(5623);O.calculateOutputShape=(dt,ht,pt,ft,mt)=>{const yt=dt[0],bt=dt.slice(2),vt=bt.length,Et=ht[0],wt=ht.slice(2).map(((Ot,$t)=>Ot+(Ot-1)*(pt[$t]-1))),St=bt.map(((Ot,$t)=>Ot+ft[$t]+ft[$t+vt])).map(((Ot,$t)=>Math.floor((Ot-wt[$t]+mt[$t])/mt[$t])));return[yt,Et].concat(...St)},O.conv=(dt,ht,pt)=>(ut(ht,pt),rt(dt,ht,pt));const rt=(dt,ht,pt)=>{const ft=ct(pt,ht),mt=dt.session.pack,yt=ft.kernelShape[0]===1&&ft.kernelShape[1]===1;return ft.group>1?[dt.run((0,xe.createUnpackedGroupedConvProgramInfoLoader)(dt,ht,ft),ht)]:yt&&mt?[nt(dt,ht,ft)]:mt&&ht[0].dims.length===4&&ht[0].dims[0]===1&&!yt?[(0,et.conv2DPacked)(dt,ht,ft)]:[at(dt,ht,ft)]},nt=(dt,ht,pt)=>{const ft=ht[0].dims,mt=ht[1].dims,yt=(0,O.calculateOutputShape)(ft,mt,pt.dilations,pt.pads,pt.strides),bt=dt.reshapeUnpacked(ht[0],[ft[1],ft[2]*ft[3]]),vt=dt.reshapeUnpacked(ht[1],[mt[0],mt[1]]),Et=ht.length>2?[vt,bt,ht[2]]:[vt,bt],wt=dt.run((0,ot.createMatmulProgramInfoLoader)(Et,pt),Et);return dt.reshapeUnpacked(wt,yt)},at=(dt,ht,pt)=>{const ft=ht[0].dims,mt=ht[1].dims,yt=(0,O.calculateOutputShape)(ft,mt,pt.dilations,pt.pads,pt.strides),bt=dt.run((0,st.createIm2ColProgramInfoLoader)(dt,ht[0],ht[1],yt,pt),[ht[0]]),vt=ht.length===3?[bt,ht[1],ht[2]]:[bt,ht[1]];return dt.run((0,tt.createDotProductProgramInfoLoader)(dt,ht,yt,pt),vt)},ct=(dt,ht)=>{const pt=dt.kernelShape.slice();if(dt.kernelShape.length===0)for(let yt=2;yt<ht[1].dims.length;++yt)pt.push(ht[1].dims[yt]);const ft=dt.pads.slice();ne.PoolConvUtil.adjustPadsBasedOnAutoPad(ht[0].dims,dt.strides,dt.dilations,pt,ft,dt.autoPad);const mt=Object.assign({},dt);return Object.assign(mt,{kernelShape:pt,pads:ft,cacheKey:dt.cacheKey}),mt};O.parseConvAttributes=dt=>{const ht=dt.attributes,pt=(0,it.parseInternalActivationAttributes)(ht),ft=ht.getString("auto_pad","NOTSET"),mt=ht.getInts("dilations",[1,1]),yt=ht.getInt("group",1),bt=ht.getInts("kernel_shape",[]),vt=ht.getInts("pads",[0,0,0,0]),Et=ht.getInts("strides",[1,1]);return(0,te.createAttributeWithCacheKey)(Object.assign({autoPad:ft,dilations:mt,group:yt,kernelShape:bt,pads:vt,strides:Et},pt))};const ut=(dt,ht)=>{if(!dt||dt.length!==2&&dt.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(dt[0].dims.length!==4||dt[1].dims.length!==4)throw new Error("currently only support 2-dimensional conv");if(dt[0].dims[1]!==dt[1].dims[1]*ht.group)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(dt.length===3&&(dt[2].dims.length!==1||dt[1].dims[0]!==dt[2].dims[0]))throw new Error("invalid bias");const pt=dt[0].dims.length-2;if(ht.dilations.length!==pt)throw new Error(`dilations should be ${pt}D`);if(ht.strides.length!==pt)throw new Error(`strides should be ${pt}D`);if(ht.pads.length!==2*pt)throw new Error(`pads should be ${2*pt}D`);if(ht.kernelShape.length!==0&&ht.kernelShape.length!==dt[1].dims.length-2)throw new Error("invalid kernel shape");if(dt[0].type!=="float32"||dt[1].type!=="float32")throw new Error("Conv input(X,W) should be float tensor");if(dt.length===3&&dt[2].type!=="float32")throw new Error("Conv input(bias) should be float tensor")}},5193:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseDepthToSpaceAttributes=O.depthToSpace=void 0;const te=Y(3738);O.depthToSpace=(xe,et,tt)=>{ne(et);const it=tt.blocksize,st=it*it,ot=tt.mode==="DCR"?[0,3,4,1,5,2]:[0,1,4,2,5,3],rt=tt.mode==="DCR"?[et[0].dims[0],it,it,et[0].dims[1]/st,et[0].dims[2],et[0].dims[3]]:[et[0].dims[0],et[0].dims[1]/st,it,it,et[0].dims[2],et[0].dims[3]],nt=xe.reshapeUnpacked(et[0],rt),at={perm:ot,cacheKey:`${ot}`},[ct]=(0,te.transpose)(xe,[nt],at),ut=[et[0].dims[0],et[0].dims[1]/st,et[0].dims[2]*it,et[0].dims[3]*it];return[xe.reshapeUnpacked(ct,ut)]},O.parseDepthToSpaceAttributes=xe=>{const et=xe.attributes.getInt("blocksize");if(et<1)throw new Error(`blocksize must be >= 1, but got : ${et} for DepthToSpace`);const tt=xe.attributes.getString("mode","DCR");if(tt!=="DCR"&&tt!=="CRD")throw new Error(`unrecognized mode: ${tt} for DepthToSpace`);return{mode:tt,blocksize:et}};const ne=xe=>{if(xe.length!==1)throw new Error(`DepthToSpace expect 1 inputs, but got ${xe.length}`);if(xe[0].type==="string"||xe[0].dims.length!==4)throw new TypeError("DepthToSpace input should be a 4-D numeric tensor")}},9828:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createDotProductProgramInfoLoader=void 0;const te=Y(2517),ne=Y(5060),xe=Y(2039),et=Y(2823),tt=Y(3248);O.createDotProductProgramInfoLoader=(it,st,ot,rt)=>{const nt=((at,ct)=>({name:"ConvDotProduct",inputNames:at?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:at?[xe.TextureType.unpacked,xe.TextureType.packedLastDimension,xe.TextureType.unpacked]:[xe.TextureType.unpacked,xe.TextureType.packedLastDimension],cacheKey:ct.activationCacheKey}))(st.length>2,rt);return Object.assign(Object.assign({},nt),{get:()=>((at,ct,ut,dt,ht)=>{const pt=ut[0].dims,ft=ut[1].dims,mt=[ft[0],Math.ceil(pt[1]*ft[2]*ft[3]/4)],yt=(0,tt.calculateIm2ColDims)(pt,ft,dt),[bt,vt]=at.calculateTextureWidthAndHeight(mt,xe.TextureType.packedLastDimension),Et=te.ShapeUtil.computeStrides(yt),[wt,St]=at.calculateTextureWidthAndHeight(yt,xe.TextureType.packedLastDimension),Ot=dt.length,$t=ut.length<3?"0.0":"_B(b)",Mt=Math.ceil(pt[1]*ft[2]*ft[3]/4),{activationFunction:Nt,applyActivation:Rt}=(0,et.getActivationSnippet)(ht),Pt=(0,ne.getGlsl)(at.session.backend.glContext.version),kt=`
${Nt}
float process(int indices[${Ot}]) {
  int b[1];
  b[0] = indices[1];
  int im2col[4];
  im2col[0] = indices[0];
  im2col[1] = indices[2];
  im2col[2] = indices[3];
  int im2colOffset = im2col[0] * ${Et[0]} + im2col[1] * ${Et[1]} + im2col[2] * ${Et[2]};
  int kernelOffset = indices[1] * ${mt[1]};
  float value = ${$t};
  for (int i = 0; i < ${Mt}; ++i) {
    vec2 im2colCoords = offsetToCoords(im2colOffset, ${wt}, ${St});
    vec2 kernelCoords = offsetToCoords(kernelOffset, ${bt}, ${vt});
    value += dot(${Pt.texture2D}(Im2Col, im2colCoords), ${Pt.texture2D}(K, kernelCoords));
    ++im2colOffset;
    ++kernelOffset;
  }
  ${Rt}
  return value;
}`;return Object.assign(Object.assign({},ct),{output:{dims:dt,type:ut[0].type,textureType:xe.TextureType.unpacked},shaderSource:kt})})(it,nt,st,ot,rt)})}},7992:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseFlattenAttributes=O.flatten=void 0;const te=Y(2517);O.flatten=(xe,et,tt)=>{ne(et,tt);const it=te.ShapeUtil.flattenShape(et[0].dims,tt);return[xe.reshapeUnpacked(et[0],it)]},O.parseFlattenAttributes=xe=>xe.attributes.getInt("axis",1);const ne=(xe,et)=>{if(!xe||xe.length!==1)throw new Error("Flatten requires 1 input.");const tt=xe[0].dims.length;if(tt===0)throw new Error("scalar tensor is not supported.");if(et<-tt||et>tt)throw new Error("Invalid axis");if(xe[0].type==="string")throw new Error("string tensor is not supported.")}},2823:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseInternalActivationAttributes=O.getActivationSnippet=void 0;const te=Y(2517),ne=Y(4909);O.getActivationSnippet=function(xe){let et;switch(xe.activation){case"Relu":et=(0,ne.glslRelu)();break;case"Sigmoid":et=(0,ne.glslSigmoid)();break;case"Clip":et=(0,ne.glslClip)(xe.clipMin,xe.clipMax);break;default:return{activationFunction:"",applyActivation:""}}const tt=et.name;return{activationFunction:et.body,applyActivation:`value = ${tt}_(value);`}},O.parseInternalActivationAttributes=xe=>{const et=xe.getString("activation","");if(et==="Clip"){const[tt,it]=xe.getFloats("activation_params",[te.MIN_CLIP,te.MAX_CLIP]);return{activation:et,clipMax:it,clipMin:tt,activationCacheKey:`${et}:${tt},${it}`}}return{activation:et,activationCacheKey:et}}},1253:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseGatherAttributes=O.gather=void 0;const te=Y(246),ne=Y(782),xe=Y(2517),et=Y(2039);O.gather=(ot,rt,nt)=>(st(rt,nt.axis),[ot.run(it(ot,rt,nt),rt)]),O.parseGatherAttributes=ot=>(0,te.createAttributeWithCacheKey)({axis:ot.attributes.getInt("axis",0)});const tt={name:"Gather",inputNames:["A","B"],inputTypes:[et.TextureType.unpacked,et.TextureType.unpacked]},it=(ot,rt,nt)=>{const at=Object.assign(Object.assign({},tt),{cacheHint:nt.cacheKey});return Object.assign(Object.assign({},at),{get:()=>((ct,ut,dt,ht)=>{const pt=dt[0].dims.slice(),ft=dt[1].dims.slice(),mt=new Array(pt.length+ft.length-1);ht=xe.ShapeUtil.normalizeAxis(ht,pt.length);const yt=[];for(let vt=0;vt<mt.length;vt++)vt<ht?(mt[vt]=pt[vt],yt.push(`inputIdx[${vt}] = outputIdx[${vt}];`)):vt<ht+ft.length?(mt[vt]=ft[vt-ht],yt.push(`indexDataIdx[${vt-ht}] = outputIdx[${vt}];`)):(mt[vt]=pt[vt-ft.length+1],yt.push(`inputIdx[${vt-ft.length+1}] = outputIdx[${vt}];`));const bt=`
      float process(int outputIdx[${mt.length||1}]) {
        int inputIdx[${pt.length}];
        int indexDataIdx[${ft.length||1}];
        indexDataIdx[0] = 0;
        ${yt.join(`
        `)}
        int idx = int(_B(indexDataIdx));
        inputIdx[${ht}] = idx < 0 ? idx + ${pt[ht]} : idx;
        return _A(inputIdx);
      }`;return Object.assign(Object.assign({},ut),{output:{dims:mt,type:dt[0].type,textureType:et.TextureType.unpacked},shaderSource:bt})})(0,at,rt,nt.axis)})},st=(ot,rt)=>{if(!ot||ot.length!==2)throw new Error("Gather requires 2 inputs.");const nt=ot[0].dims.length;if(nt<1)throw new Error("Invalid input shape.");if(rt<-nt||rt>nt-1)throw new Error("Invalid axis.");if(ne.NUMBER_TYPES.indexOf(ot[0].type)===-1)throw new Error("Invaid input type.");if(ot[1].type!=="int32"&&ot[1].type!=="int16")throw new Error("Invaid input type.")}},4776:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseGemmAttributesV11=O.parseGemmAttributesV7=O.gemm=void 0;const te=Y(246),ne=Y(2517),xe=Y(2039);O.gemm=(ot,rt,nt)=>(st(rt,nt),[ot.run(tt(rt,nt),rt)]);const et=(ot,rt)=>{const nt=ot.attributes.getInt("transA",0)!==0,at=ot.attributes.getInt("transB",0)!==0,ct=ot.attributes.getFloat("alpha",1),ut=ot.attributes.getFloat("beta",1);return(0,te.createAttributeWithCacheKey)({transA:nt,transB:at,alpha:ct,beta:ut,isOptionalC:rt})};O.parseGemmAttributesV7=ot=>et(ot,!1),O.parseGemmAttributesV11=ot=>et(ot,!0);const tt=(ot,rt)=>{const nt={name:"Gemm",inputNames:ot.length===3?["A","B","C"]:["A","B"],inputTypes:ot.length===3?[xe.TextureType.unpacked,xe.TextureType.unpacked,xe.TextureType.unpacked]:[xe.TextureType.unpacked,xe.TextureType.unpacked],key:rt.cacheKey};return Object.assign(Object.assign({},nt),{get:()=>it(nt,ot,rt)})},it=(ot,rt,nt)=>{const at=rt[0].dims.slice(),ct=rt[1].dims.slice(),[ut,dt]=ne.GemmUtil.getShapeOfGemmResult(at,nt.transA,ct,nt.transB,rt.length===3?rt[2].dims:void 0),ht=[ut,dt];if(!ht)throw new Error("Can't use gemm on the given tensors");let pt=at[at.length-1],ft="";nt.transA&&(pt=at[0]),nt.transA&&nt.transB?ft="value += _A_T(a) * _B_T(b);":nt.transA&&!nt.transB?ft="value += _A_T(a) * _B(b);":!nt.transA&&nt.transB?ft="value += _A(a) * _B_T(b);":nt.transA||nt.transB||(ft="value += _A(a) * _B(b);");const mt=ht.length,yt=`
      float process(int indices[${mt}]) {
          int a[${mt}];
          int b[${mt}];
          ${rt.length===3?`int c[${rt[2].dims.length}];`:""}

          copyVec(indices, a);
          copyVec(indices, b);
          ${rt.length===3?"bcastIndices_C(indices, c);":""}

          float value = 0.0;
          for (int k=0; k<${pt}; ++k) {
              a[${mt-1}] = k;
              b[${mt-2}] = k;
              ${ft}
          }

          value = value * alpha;
          ${rt.length===3?"value += beta * _C(c);":""}
          return value;
      }`;return Object.assign(Object.assign({},ot),{output:{dims:ht,type:rt[0].type,textureType:xe.TextureType.unpacked},variables:[{name:"alpha",type:"float",data:nt.alpha},{name:"beta",type:"float",data:nt.beta}],shaderSource:yt})},st=(ot,rt)=>{if(!ot)throw new Error("Input is missing");if(rt.isOptionalC&&(ot.length<2||ot.length>3))throw new Error("Invaid input shape.");if(!rt.isOptionalC&&ot.length!==3)throw new Error("Gemm requires 3 inputs");if(ot.length===3&&ot[2].dims.length!==1&&ot[2].dims.length!==2)throw new Error("Invalid input shape of C");if(ot[0].type!=="float32"&&ot[0].type!=="float64"||ot[1].type!=="float32"&&ot[1].type!=="float64"||ot.length===3&&ot[2].type!=="float32"&&ot[2].type!=="float64")throw new Error("Invalid input type.");if(ot[0].type!==ot[1].type||ot.length===3&&ot[0].type!==ot[2].type)throw new Error("Input types are mismatched")}},8555:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createPackedIm2ColProgramInfoLoader=void 0;const te=Y(5060),ne=Y(2039),xe=Y(2827);O.createPackedIm2ColProgramInfoLoader=(et,tt,it,st,ot)=>{const rt=(nt=ot.cacheKey,{name:"Im2Col (packed)",inputNames:["A"],inputTypes:[ne.TextureType.packed],cacheHint:nt});var nt;return Object.assign(Object.assign({},rt),{get:()=>((at,ct,ut,dt,ht,pt)=>{const ft=ut.dims,mt=dt.dims,yt=ht.length,bt=[mt[1]*mt[2]*mt[3],ht[2]*ht[3]],vt=mt[2]*mt[3],Et=(0,xe.unpackFromChannel)(),wt=(0,te.getGlsl)(at.session.backend.glContext.version);let St="";for(let $t=0;$t<=1;$t++)for(let Mt=0;Mt<=1;Mt++)St+=`
            blockIndex = rc.x + ${Mt};
            pos = rc.y + ${$t};

            if(blockIndex < ${bt[1]} && pos < ${bt[0]}) {
              offsetY = int(blockIndex / (${ht[yt-1]})) * ${pt.strides[0]} -
                ${pt.pads[0]};
              d0 = offsetY + ${pt.dilations[0]} * (imod(pos, ${vt}) / ${mt[2]});

              if(d0 < ${ft[2]} && d0 >= 0) {
                offsetX = imod(blockIndex, ${ht[yt-1]}) * ${pt.strides[1]} -
                  ${pt.pads[1]};
                d1 = offsetX + ${pt.dilations[1]} * imod(imod(pos, ${vt}), ${mt[2]});

                if(d1 < ${ft[3]} && d1 >= 0) {

                  ch = int(float(pos)/ ${vt}.);
                    innerDims = vec2(d0, d1);
                    result[${2*$t+Mt}] = getChannel(
                      getA(0, ch, int(innerDims.x),
                      int(innerDims.y)), innerDims);
                }
              }
            }

          `;const Ot=`
      ${Et}

      void main() {
        ivec2 rc = getOutputCoords();
          vec4 result = vec4(0.0);
          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
          vec2 innerDims;
          ${St}
          ${wt.output} = result;
      }
            `;return Object.assign(Object.assign({},ct),{output:{dims:bt,type:ut.type,textureType:ne.TextureType.packed},shaderSource:Ot,hasMain:!0})})(et,rt,tt,it,st,ot)})}},3248:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.calculateIm2ColDims=O.createIm2ColProgramInfoLoader=void 0;const te=Y(2039);O.createIm2ColProgramInfoLoader=(ne,xe,et,tt,it)=>{const st=(ot=it.cacheKey,{name:"Im2Col",inputNames:["X"],inputTypes:[te.TextureType.unpacked],cacheHint:ot});var ot;return Object.assign(Object.assign({},st),{get:()=>((rt,nt,at,ct,ut,dt)=>{const ht=at.dims,pt=ct.dims,ft=ut.length,mt=(0,O.calculateIm2ColDims)(ht,pt,ut,4),yt=`
        const int XC = ${ht[1]};
        const int XH = ${ht[2]};
        const int XW = ${ht[3]};
        const int KH = ${dt.kernelShape[0]};
        const int KW = ${dt.kernelShape[1]};
        const int dilationH = ${dt.dilations[0]};
        const int dilationW = ${dt.dilations[1]};
        const int strideH = ${dt.strides[0]};
        const int strideW = ${dt.strides[1]};
        const int padH = ${dt.pads[0]};
        const int padW = ${dt.pads[1]};
        const int KHKW = KH*KW;
        const int XCKHKW = XC * KHKW;
        const int outputChannels = 4;
        vec4 process(int indices[${ft}]) {
          int b  = indices[0]; // batch size
          int oh = indices[1] * strideH - padH; //output height
          int ow = indices[2] * strideW - padW; //output width
          int p = indices[3] * outputChannels; //patch
          vec4 value = vec4(0.0);
          for(int i=0; i < outputChannels; ++i) {
            if(p < XCKHKW) {
              int patchC = p / KHKW;
              int patchH = (p - patchC*KHKW) / KW;
              int patchW = (p - patchC*KHKW) - patchH * KW;
              int xh2 = oh + patchH * dilationH;
              int xw2 = ow + patchW * dilationW;
              int x[${ht.length}];
              x[0] = b;
              x[1] = patchC;
              x[2] = xh2;
              x[3] = xw2;
              if(xh2 >= 0 &&
                  xh2 < XH &&
                  xw2 >= 0 &&
                  xw2 < XW) {
                value[i] = _X(x);
              }
            }
            ++p;
          }
          return value;
        }
        `;return Object.assign(Object.assign({},nt),{output:{dims:mt,type:at.type,textureType:te.TextureType.packedLastDimension},shaderSource:yt})})(0,st,xe,et,tt,it)})},O.calculateIm2ColDims=(ne,xe,et,tt=4)=>[et[0],et[2],et[3],Math.ceil(ne[1]*xe[2]*xe[3]/tt)]},6572:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseImageScalerAttributes=O.imageScaler=void 0;const te=Y(246),ne=Y(2039);O.imageScaler=(st,ot,rt)=>(it(ot),[st.run(et(st,ot,rt),ot)]),O.parseImageScalerAttributes=st=>{const ot=st.attributes.getFloat("scale"),rt=st.attributes.getFloats("bias");return(0,te.createAttributeWithCacheKey)({scale:ot,bias:rt})};const xe={name:"ImageScaler",inputNames:["X"],inputTypes:[ne.TextureType.unpacked]},et=(st,ot,rt)=>{const nt=Object.assign(Object.assign({},xe),{cacheHint:rt.cacheKey});return Object.assign(Object.assign({},nt),{get:()=>((at,ct,ut,dt)=>{const ht=ut[0].dims.slice(),pt=ht.length,ft=`
      ${tt(dt.bias.length)}
      float process(int indices[${pt}]) {
        return _X(indices) * scale + getBias(bias, indices[1]);
      }`;return Object.assign(Object.assign({},ct),{output:{dims:ht,type:ut[0].type,textureType:ne.TextureType.unpacked},variables:[{name:"bias",type:"float",arrayLength:dt.bias.length,data:dt.bias},{name:"scale",type:"float",data:dt.scale}],shaderSource:ft})})(0,nt,ot,rt)})},tt=st=>{const ot=[`float getBias(float bias[${st}], int channel) {`];for(let rt=0;rt<st;++rt)rt===0?ot.push(`	if (channel == ${rt}) { return bias[${rt}]; }`):rt===st-1?ot.push(`	else { return bias[${rt}]; }`):ot.push(`	else if (channel == ${rt}) { return bias[${rt}]; }`);return ot.push("	}"),ot.join(`
`)},it=st=>{if(!st||st.length!==1)throw new Error("ImageScaler requires 1 input.");if(st[0].dims.length!==4)throw new Error("Invalid input shape.");if(st[0].type!=="float32"&&st[0].type!=="float64")throw new Error("Invalid input type.")}},3346:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseInstanceNormalizationAttributes=O.instanceNormalization=void 0;const te=Y(5060),ne=Y(2039);O.instanceNormalization=(ot,rt,nt)=>{st(rt);const at=ot.run(et(rt[0]),rt);return[ot.run(it(ot,rt[0],nt,at.dims),[rt[0],at,rt[1],rt[2]])]},O.parseInstanceNormalizationAttributes=ot=>ot.attributes.getFloat("epsilon",1e-5);const xe={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[ne.TextureType.unpacked]},et=ot=>Object.assign(Object.assign({},xe),{get:()=>((rt,nt)=>{const at=nt.dims.slice(),ct=at[1],ut=at[2]*at[3],dt=[at[0],ct],ht=`
      vec4 process(int[2] indices) {
        vec4 v = vec4(0.0);
        int a[4];
        a[0] = indices[0];
        a[1] = indices[1];
        float temp = 0.0;
        for(int a2=0; a2<${at[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${at[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += x;
          }
        }
        float mean = temp / float(${ut});
        temp = 0.0;
        for(int a2=0; a2<${at[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${at[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += (x - mean) * (x - mean);
          }
        }
        v.r = mean;
        v.g = temp / float(${ut});

        return v;
      }`;return Object.assign(Object.assign({},rt),{output:{dims:dt,type:nt.type,textureType:ne.TextureType.packedLastDimension},shaderSource:ht})})(xe,ot)}),tt={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[ne.TextureType.unpacked,ne.TextureType.packedLastDimension,ne.TextureType.unpacked,ne.TextureType.unpacked]},it=(ot,rt,nt,at)=>{const ct=Object.assign(Object.assign({},tt),{cacheHint:`${nt}`});return Object.assign(Object.assign({},ct),{get:()=>((ut,dt,ht,pt,ft)=>{const mt=(0,te.getGlsl)(ut.session.backend.glContext.version),[yt,bt]=ut.calculateTextureWidthAndHeight(ft,ne.TextureType.packedLastDimension),[vt,Et]=[yt/4,bt],wt=`
      vec4 get_MeanAndVariance(int[2] mv) {
        int offset = indicesToOffset_MeanAndVariance(mv);
        vec2 coords = offsetToCoords(offset, ${vt}, ${Et});
        return ${mt.texture2D}(MeanAndVariance, coords);
      }

      float process(int[4] indices) {
        int mv[2];
        mv[0] = indices[0];
        mv[1] = indices[1];
        vec4 mean_and_variance = get_MeanAndVariance(mv);
        float mean = mean_and_variance.r;
        float variance = mean_and_variance.g;

        int sb[1];
        sb[0] = indices[1];
        float scale = _Scale(sb);
        float b = _B(sb);

        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;
      }`;return Object.assign(Object.assign({},dt),{output:{dims:ht.dims,type:ht.type,textureType:ne.TextureType.unpacked},variables:[{name:"epsilon",type:"float",data:pt}],shaderSource:wt})})(ot,ct,rt,nt,at)})},st=ot=>{if(!ot||ot.length!==3)throw new Error("InstanceNormalization requires 3 inputs.");const rt=ot[0],nt=ot[1],at=ot[2];if(rt.dims.length<3||nt.dims.length!==1||at.dims.length!==1)throw new Error("Invalid input shape.");if(nt.dims[0]!==rt.dims[1]||at.dims[0]!==rt.dims[1])throw new Error("Input shapes are mismatched.");if(rt.type!=="float32"&&rt.type!=="float64"||nt.type!=="float32"&&nt.type!=="float64"||at.type!=="float32"&&at.type!=="float64")throw new Error("Invalid input type.");if(ot[0].dims.length!==4)throw new Error("Only support 4-D input shape.")}},708:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createPackedMatmulProgramInfoLoader=void 0;const te=Y(2517),ne=Y(5060),xe=Y(2039),et=Y(9390),tt=Y(2823),it=Y(5623);O.createPackedMatmulProgramInfoLoader=(st,ot,rt)=>{const nt=(at=ot.length>2,ct=rt.activationCacheKey,{name:"MatMul (packed)",inputNames:at?["A","B","Bias"]:["A","B"],inputTypes:at?[xe.TextureType.packed,xe.TextureType.packed,xe.TextureType.packed]:[xe.TextureType.packed,xe.TextureType.packed],cacheHint:ct});var at,ct;return Object.assign(Object.assign({},nt),{get:()=>((ut,dt,ht,pt)=>{const ft=ht.length>2,mt=ft?"value += getBiasForMatmul();":"",yt=ht[0].dims,bt=ht[1].dims,vt=te.BroadcastUtil.calcShape(yt,bt,!0),Et=!te.ShapeUtil.areEqual(ht[0].dims,ht[1].dims);if(!vt)throw new Error("Can't use matmul on the given tensors");const wt=yt[yt.length-1],St=Math.ceil(wt/2),Ot=yt.length,$t=bt.length,Mt=(0,ne.getGlsl)(ut.session.backend.glContext.version),Nt=(0,et.getCoordsDataType)(vt.length),Rt=vt.length,Pt=(0,et.getGlChannels)(),{activationFunction:kt,applyActivation:Wt}=(0,tt.getActivationSnippet)(pt),zt=ft?`${(0,it.getBiasForMatmul)(Nt,Pt,ht[2].dims,vt,!0)}`:"",Kt=Et?`${(function(pn,ln,dn,un){let Tn=[],Sn=[];const bn=dn[0].dims,on=dn[1].dims,zn=bn.length,Ln=on.length,hn=un.length,Hn=hn-zn,Wn=hn-Ln;Tn=bn.map(((On,kn)=>`coords.${ln[kn+Hn]}`)),Tn[zn-1]="i*2",Tn.join(", "),Sn=on.map(((On,kn)=>`coords.${ln[kn+Wn]}`)),Sn[Ln-2]="i*2",Sn.join(", ");const Gn=te.BroadcastUtil.getBroadcastDims(bn,un),gr=te.BroadcastUtil.getBroadcastDims(on,un),Qn=Gn.map((On=>`coords.${ln[On+Hn]} = 0;`)).join(`
`),sr=gr.map((On=>`coords.${ln[On+Wn]} = 0;`)).join(`
`),cr=`int lastDim = coords.${ln[hn-1]};
  coords.${ln[hn-1]} = coords.${ln[hn-2]};
  coords.${ln[hn-2]} = lastDim;`;return`
vec4 getAAtOutCoordsMatmul(int i) {
  ${pn} coords = getOutputCoords();
  ${cr}
  ${Qn}
  vec4 outputValue = getA(${Tn});
  return outputValue;
}

vec4 getBAtOutCoordsMatmul(int i) {
  ${pn} coords = getOutputCoords();
  ${cr}
  ${sr}
  vec4 outputValue = getB(${Sn});
  return outputValue;
}`})(Nt,Pt,ht,vt)}`:"",qt=Et?"getAAtOutCoordsMatmul(i)":`getA(${(function(pn,ln){let dn="";for(let un=0;un<ln-2;un++)dn+=`rc.${pn[un]}, `;return dn+=`rc.${pn[ln-2]}, i*2`,dn})(Pt,Ot)})`,Xt=Et?"getBAtOutCoordsMatmul(i)":`getB(${(function(pn,ln){let dn="";for(let un=0;un<ln-2;un++)dn+=`rc.${pn[un]}, `;return dn+=`i*2, rc.${pn[ln-1]}`,dn})(Pt,$t)})`,an=`
            ${Kt}
            ${zt}
            ${kt}
            void main() {
              ${Et?"":`${Nt} rc =
          getOutputCoords(); int lastDim = rc.${Pt[Rt-1]}; rc.${Pt[Rt-1]} =
          rc.${Pt[Rt-2]}; rc.${Pt[Rt-2]} = lastDim;
      `}

              vec4 value = vec4(0);
              for (int i = 0; i < ${St}; i++) {
                vec4 a = ${qt};
                vec4 b = ${Xt};

                value += (a.rrbb * b.rgrg);
                value += (a.ggaa * b.baba);
              }
              ${mt}
              ${Wt}
              ${Mt.output} = value;
            }`;return Object.assign(Object.assign({},dt),{output:{dims:vt,type:ht[0].type,textureType:xe.TextureType.packed},shaderSource:an,hasMain:!0})})(st,nt,ot,rt)})}},5623:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.getBiasForMatmul=O.createMatmulProgramInfoLoader=O.parseMatMulAttributes=O.matMul=void 0;const te=Y(2517),ne=Y(2039),xe=Y(9390),et=Y(2823),tt=Y(708);function it(rt,nt){const at=(ct=rt.length>2,ut=nt.activationCacheKey,{name:"MatMul",inputNames:ct?["A","B","Bias"]:["A","B"],inputTypes:ct?[ne.TextureType.unpacked,ne.TextureType.unpacked,ne.TextureType.unpacked]:[ne.TextureType.unpacked,ne.TextureType.unpacked],cacheHint:ut});var ct,ut;return Object.assign(Object.assign({},at),{get:()=>(function(dt,ht,pt){const ft=ht[0].dims,mt=ht[1].dims,yt=te.BroadcastUtil.calcShape(ft,mt,!0);if(!yt)throw new Error("Can't use matmul on the given tensors");const bt=(0,xe.getCoordsDataType)(yt.length),vt=(0,xe.getGlChannels)(),{activationFunction:Et,applyActivation:wt}=(0,et.getActivationSnippet)(pt),St=ht.length>2,Ot=St?"value += getBiasForMatmul();":"",$t=St?`${ot(bt,vt,ht[2].dims,yt,!1)}`:"",Mt=yt.length,Nt=ft.length,Rt=mt.length,Pt=`
    ${Et}
    ${$t}
    float process(int indices[${Mt}]) {
        int a[${Nt}];
        int b[${Rt}];
        bcastMatmulIndices_A(indices, a);
        bcastMatmulIndices_B(indices, b);

        float value;
        for (int k=0; k<${ft[ft.length-1]}; ++k) {
            a[${Nt-1}] = k;
            b[${Rt-2}] = k;
            value += _A(a) * _B(b);
        }
        ${Ot}
        ${wt}
        return value;
    }`;return Object.assign(Object.assign({},dt),{output:{dims:yt,type:ht[0].type,textureType:ne.TextureType.unpacked},shaderSource:Pt})})(at,rt,nt)})}O.matMul=(rt,nt,at)=>(st(nt),rt.session.pack?[rt.run((0,tt.createPackedMatmulProgramInfoLoader)(rt,nt,at),nt)]:[rt.run(it(nt,at),nt)]),O.parseMatMulAttributes=rt=>(0,et.parseInternalActivationAttributes)(rt.attributes),O.createMatmulProgramInfoLoader=it;const st=rt=>{if(!rt||rt.length!==2)throw new Error("MatMul requires 2 inputs.");if(rt[0].dims[rt[0].dims.length-1]!==rt[1].dims[rt[1].dims.length-2])throw new Error("shared dimension does not match.");if(rt[0].type!=="float32"&&rt[0].type!=="float64"||rt[1].type!=="float32"&&rt[1].type!=="float64")throw new Error("inputs should be float type");if(rt[0].type!==rt[1].type)throw new Error("inputs types should match")};function ot(rt,nt,at,ct,ut){let dt="";const ht=at.length,pt=ct.length,ft=pt-ht;dt=pt<2&&ht>0?"coords":at.map(((bt,vt)=>`coords.${nt[vt+ft]}`)).join(", ");const mt=te.BroadcastUtil.getBroadcastDims(at,ct).map((bt=>`coords.${nt[bt+ft]} = 0;`)).join(`
`);let yt="vec4(outputValue.xx, outputValue.yy)";return te.ShapeUtil.size(at)===1&&(yt="vec4(outputValue.x)"),ut?`
vec4 getBiasForMatmul() {
  ${rt} coords = getOutputCoords();
  ${mt}
  vec4 outputValue = getBias(${dt});
  return ${yt};
}`:`
float getBiasForMatmul() {
  ${rt} coords = getOutputCoords();
  ${mt}
  return getBias(coords.x);
}`}O.getBiasForMatmul=ot},2403:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createPackProgramInfoLoader=void 0;const te=Y(5060),ne=Y(2039),xe=Y(9390),et=Y(2827),tt={name:"pack",inputNames:["A"],inputTypes:[ne.TextureType.unpackedReversed]};O.createPackProgramInfoLoader=(it,st)=>Object.assign(Object.assign({},tt),{get:()=>((ot,rt)=>{const nt=(0,te.getGlsl)(ot.session.backend.glContext.version),at=rt.dims,ct=at.length,ut=rt.dims.length,dt=(0,xe.getCoordsDataType)(ut),ht=(0,et.getChannels)("rc",ut),pt=(ft=ut,mt=ht,yt=at[at.length-2],bt=at[at.length-1],ft===0||ft===1?"":`
    int r = ${mt[ft-2]};
    int c = ${mt[ft-1]};
    int rp1 = ${mt[ft-2]} + 1;
    int cp1 = ${mt[ft-1]} + 1;
    bool rEdge = rp1 >= ${bt};
    bool cEdge = cp1 >= ${yt};
    `);var ft,mt,yt,bt;let vt;vt=ct===0?[1,1]:ct===1?[at[0],1]:[at[ut-1],at[ut-2]];const Et=(function(Ot,$t,Mt){if(Ot===0)return"false";if(Ot===1)return`rc > ${$t[0]}`;let Nt="";for(let Rt=Ot-2;Rt<Ot;Rt++)Nt+=`${Mt[Rt]} >= ${$t[Rt-Ot+2]}`,Rt<Ot-1&&(Nt+="||");return Nt})(ut,vt,ht),wt=(function(Ot,$t){const Mt=Ot.length;if(Mt===0)return"getA(), 0, 0, 0";if(Mt===1)return`getA(rc),
            rc + 1 >= ${Ot[0]} ? 0. : getA(rc + 1),
            0, 0`;let Nt="";if(Mt>2)for(let Rt=0;Rt<Mt-2;++Rt)Nt+=`${$t[Rt]},`;return`getA(${Nt}r, c),
          rEdge ? 0. : getA(${Nt}rp1, c),
          cEdge ? 0. : getA(${Nt}r, cp1),
          rEdge || cEdge ? 0. : getA(${Nt}rp1, cp1)`})(at,ht),St=`
        void main() {
          ${dt} rc = getOutputCoords();

          if(${Et}) {
            ${nt.output} = vec4(0);
          } else {
            ${pt}

            ${nt.output} = vec4(${wt});
          }
        }
      `;return Object.assign(Object.assign({},tt),{hasMain:!0,output:{dims:rt.dims,type:rt.type,textureType:ne.TextureType.packed},shaderSource:St})})(it,st)})},2827:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.unpackFromChannel=O.getChannels=O.getVecChannels=void 0;const te=Y(9390);function ne(xe,et){return(0,te.getGlChannels)(et).map((tt=>`${xe}.${tt}`))}O.getVecChannels=ne,O.getChannels=function(xe,et){return et===1?[xe]:ne(xe,et)},O.unpackFromChannel=function(){return`
    float getChannel(vec4 frag, int dim) {
      int modCoord = imod(dim, 2);
      return modCoord == 0 ? frag.r : frag.g;
    }

    float getChannel(vec4 frag, vec2 innerDims) {
      vec2 modCoord = mod(innerDims, 2.);
      return modCoord.x == 0. ?
        (modCoord.y == 0. ? frag.r : frag.g) :
        (modCoord.y == 0. ? frag.b : frag.a);
    }
  `}},2870:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parsePadAttributesV11=O.padV11=O.parsePadAttributesV2=O.padV2=void 0;const te=Y(246),ne=Y(2517),xe=Y(5060),et=Y(2039),tt={name:"Pad",inputNames:["A"],inputTypes:[et.TextureType.unpacked]};O.padV2=(dt,ht,pt)=>(ot(ht),[dt.run(Object.assign(Object.assign({},tt),{cacheHint:pt.cacheKey,get:()=>st(dt,ht[0],pt)}),ht)]),O.parsePadAttributesV2=dt=>{const ht=dt.attributes.getString("mode","constant"),pt=dt.attributes.getFloat("value",0),ft=dt.attributes.getInts("pads");return(0,te.createAttributeWithCacheKey)({mode:ht,value:pt,pads:ft})},O.padV11=(dt,ht,pt)=>{rt(ht);const ft=it(dt,ht,pt);return(0,O.padV2)(dt,[ht[0]],ft)},O.parsePadAttributesV11=dt=>dt.attributes.getString("mode","constant");const it=(dt,ht,pt)=>{if(!dt.session.isInitializer(ht[1].dataId)||ht.length>=3&&!dt.session.isInitializer(ht[2].dataId))throw new Error("dynamic pad attributes are not allowed");const ft=Array.from(ht[1].integerData),mt=ht.length>=3?ht[2].floatData[0]:0;return(0,te.createAttributeWithCacheKey)({mode:pt,pads:ft,value:mt})},st=(dt,ht,pt)=>{const ft=ne.ShapeUtil.padShape(ht.dims.slice(),pt.pads),mt=ft.length,yt=`
      ${nt(dt,ht,pt)}
      float process(int[${mt}] indices) {
          return padA(indices);
      }`;return{name:"Pad",inputNames:["A"],inputTypes:[et.TextureType.unpacked],output:{dims:ft,type:ht.type,textureType:et.TextureType.unpacked},shaderSource:yt}},ot=dt=>{if(!dt||dt.length!==1)throw new Error("Pad requires 1 input");if(dt[0].type!=="float32"&&dt[0].type!=="float64")throw new Error("Invalid input type.")},rt=dt=>{if(!dt||dt.length!==2&&dt.length!==3)throw new Error("Pad requires 2 or 3 inputs");if(dt[1].type!=="int32")throw new Error("Invalid input type.");if(dt.length>=3&&dt[2].type==="string")throw new Error("Invalid input type.")},nt=(dt,ht,pt)=>{const ft=(0,xe.getGlsl)(dt.session.backend.glContext.version),[mt,yt]=dt.calculateTextureWidthAndHeight(ht.dims,et.TextureType.unpacked),bt=ne.ShapeUtil.computeStrides(ht.dims);switch(pt.mode){case"constant":return at(ft,ht.dims,bt,mt,yt,pt.pads,pt.value);case"reflect":return ct(ft,ht.dims,bt,mt,yt,pt.pads);case"edge":return ut(ft,ht.dims,bt,mt,yt,pt.pads);default:throw new Error("Invalid mode")}},at=(dt,ht,pt,ft,mt,yt,bt)=>{const vt=ht.length;let Et="";for(let wt=vt-1;wt>=0;--wt)Et+=`
        k = m[${wt}] - ${yt[wt]};
        if (k < 0)  return constant;
        if (k >= ${ht[wt]}) return constant;
        offset += k * ${pt[wt]};
        `;return`
      float padA(int m[${vt}]) {
        const float constant = float(${bt});
        int offset = 0;
        int k = 0;
        ${Et}
        vec2 coords = offsetToCoords(offset, ${ft}, ${mt});
        float value = getColorAsFloat(${dt.texture2D}(A, coords));
        return value;
      }
      `},ct=(dt,ht,pt,ft,mt,yt)=>{const bt=ht.length;let vt="";for(let Et=bt-1;Et>=0;--Et)vt+=`
        k = m[${Et}] - ${yt[Et]};
        if (k < 0) { k = -k; }
        {
          const int _2n_1 = ${2*(ht[Et]-1)};
          k = int( mod( float(k), float(_2n_1) ) ) ;
          if(k >= ${ht[Et]}) { k = _2n_1 - k; }
        }
        offset += k * ${pt[Et]};
        `;return`
      float padA(int m[${bt}]) {
        int offset = 0;
        int k = 0;
        ${vt}
        vec2 coords = offsetToCoords(offset, ${ft}, ${mt});
        float value = getColorAsFloat(${dt.texture2D}(A, coords));
        return value;
      }
      `},ut=(dt,ht,pt,ft,mt,yt)=>{const bt=ht.length;let vt="";for(let Et=bt-1;Et>=0;--Et)vt+=`
        k = m[${Et}] - ${yt[Et]};
        if (k < 0)  k = 0;
        if (k >= ${ht[Et]}) k = ${ht[Et]-1};
        offset += k * ${pt[Et]};
      `;return`
      float padA(int m[${bt}]) {
        int offset = 0;
        int k = 0;
        ${vt}
        vec2 coords = offsetToCoords(offset, ${ft}, ${mt});
        float value = getColorAsFloat(${dt.texture2D}(A, coords));
        return value;
      }
      `}},2143:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.globalMaxPool=O.parseMaxPoolAttributes=O.maxPool=O.parseGlobalAveragePoolAttributes=O.globalAveragePool=O.parseAveragePoolAttributes=O.averagePool=void 0;const te=Y(246),ne=Y(2517),xe=Y(2039);O.averagePool=(ut,dt,ht)=>{rt(dt);const pt={name:"AveragePool",inputNames:["X"],inputTypes:[xe.TextureType.unpacked],cacheHint:ht.cacheKey};return[ut.run(Object.assign(Object.assign({},pt),{get:()=>et(dt,pt,!1,ht)}),dt)]},O.parseAveragePoolAttributes=ut=>{const dt=ut.attributes.getString("auto_pad","NOTSET"),ht=ut.attributes.getInt("ceil_mode",0),pt=ut.attributes.getInt("count_include_pad",0)!==0,ft=ut.attributes.getInts("kernel_shape"),mt=ut.attributes.getInts("strides",[]),yt=ut.attributes.getInts("pads",[]);if(ht!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");return(0,te.createAttributeWithCacheKey)({autoPad:dt,ceilMode:ht,countIncludePad:pt,kernelShape:ft,strides:mt,pads:yt})};const et=(ut,dt,ht,pt)=>{const[ft,mt]=it(ut,pt,ht),yt=ne.ShapeUtil.size(ft.kernelShape);let bt="";ft.countIncludePad?bt+=`value /= float(${yt});`:bt+=`value /= float(${yt} - pad);`;const vt=`
        ${nt(ut[0].dims,ft,"value += _X(x);",bt,"0.0")}
      `;return Object.assign(Object.assign({},dt),{output:{dims:mt,type:ut[0].type,textureType:xe.TextureType.unpacked},shaderSource:vt})};O.globalAveragePool=(ut,dt,ht)=>{rt(dt);const pt={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[xe.TextureType.unpacked],cacheHint:`${ht.countIncludePad}`};return[ut.run(Object.assign(Object.assign({},pt),{get:()=>et(dt,pt,!0,ht)}),dt)]},O.parseGlobalAveragePoolAttributes=ut=>{const dt=ut.attributes.getInt("count_include_pad",0)!==0;return(0,te.createAttributeWithCacheKey)({autoPad:"",ceilMode:0,countIncludePad:dt,kernelShape:[],strides:[],pads:[]})},O.maxPool=(ut,dt,ht)=>{rt(dt);const pt={name:"MaxPool",inputNames:["X"],inputTypes:[xe.TextureType.unpacked],cacheHint:ht.cacheKey};return[ut.run(Object.assign(Object.assign({},pt),{get:()=>tt(dt,pt,!1,ht)}),dt)]},O.parseMaxPoolAttributes=ut=>{const dt=ut.attributes.getString("auto_pad","NOTSET"),ht=ut.attributes.getInt("ceil_mode",0),pt=ut.attributes.getInts("kernel_shape"),ft=ut.attributes.getInts("strides",[]),mt=ut.attributes.getInts("pads",[]),yt=ut.attributes.getInt("storage_order",0),bt=ut.attributes.getInts("dilations",[]);if(yt!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(ht!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");return(0,te.createAttributeWithCacheKey)({autoPad:dt,ceilMode:ht,countIncludePad:!1,kernelShape:pt,strides:ft,pads:mt,storageOrder:yt,dilations:bt})};const tt=(ut,dt,ht,pt)=>{const[ft,mt]=it(ut,pt,ht),yt=`
      ${nt(ut[0].dims,ft,`
      value = max(_X(x), value);
    `,"","-1e5")}
    `;return Object.assign(Object.assign({},dt),{output:{dims:mt,type:ut[0].type,textureType:xe.TextureType.unpacked},shaderSource:yt})},it=(ut,dt,ht)=>{const pt=ut[0].dims.slice(),ft=Object.hasOwnProperty.call(dt,"dilations"),mt=dt.kernelShape.slice(),yt=dt.strides.slice(),bt=ft?dt.dilations.slice():[],vt=dt.pads.slice();ne.PoolConvUtil.adjustPoolAttributes(ht,pt,mt,yt,bt,vt);const Et=ne.PoolConvUtil.computePoolOutputShape(ht,pt,yt,bt,mt,vt,dt.autoPad),wt=Object.assign({},dt);return ft?Object.assign(wt,{kernelShape:mt,strides:yt,pads:vt,dilations:bt,cacheKey:dt.cacheKey}):Object.assign(wt,{kernelShape:mt,strides:yt,pads:vt,cacheKey:dt.cacheKey}),[wt,Et]},st={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},ot={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[xe.TextureType.unpacked]};O.globalMaxPool=(ut,dt)=>(rt(dt),[ut.run(Object.assign(Object.assign({},ot),{get:()=>tt(dt,ot,!0,st)}),dt)]);const rt=ut=>{if(!ut||ut.length!==1)throw new Error("Pool ops requires 1 input.");if(ut[0].type!=="float32"&&ut[0].type!=="float64")throw new Error("Invalid input type.")},nt=(ut,dt,ht,pt,ft)=>{const mt=ut.length;if(dt.kernelShape.length<=2){const yt=dt.kernelShape[dt.kernelShape.length-1],bt=dt.strides[dt.strides.length-1],vt=dt.pads[dt.pads.length/2-1],Et=dt.pads[dt.pads.length-1],wt=ut[mt-1];let St="",Ot="",$t="";if(St=vt+Et!==0?`
          for (int i = 0; i < ${yt}; i++) {
            x[${mt} - 1] = indices[${mt} - 1] * ${bt} - ${vt} + i;
            if (x[${mt} - 1] < 0 || x[${mt} - 1] >= ${wt}) {
              pad++;
              continue;
            }
            ${ht}
          }`:`
          for (int i = 0; i < ${yt}; i++) {
            x[${mt} - 1] = indices[${mt} - 1] * ${bt} - ${vt} + i;
            ${ht}
          }`,dt.kernelShape.length===2){const Mt=dt.kernelShape[dt.kernelShape.length-2],Nt=dt.strides[dt.strides.length-2],Rt=dt.pads[dt.pads.length/2-2],Pt=dt.pads[dt.pads.length-2],kt=ut[mt-2];Ot=Rt+Pt!==0?`
            for (int j = 0; j < ${Mt}; j++) {
              x[${mt} - 2] = indices[${mt} - 2] * ${Nt} - ${Rt} + j;
              if (x[${mt} - 2] < 0 || x[${mt} - 2] >= ${kt}) {
                pad+= ${yt};
                continue;
              }
          `:`
            for (int j = 0; j < ${Mt}; j++) {
              x[${mt} - 2] = indices[${mt} - 2] * ${Nt} - ${Rt} + j;
            `,$t=`
          }
        `}return`
        float process(int indices[${mt}]) {
          int x[${mt}];
          copyVec(indices, x);

          float value = ${ft};
          int pad = 0;
          ${Ot}
          ${St}
          ${$t}
          ${pt}
          return value;
        }
      `}{const yt=ne.ShapeUtil.size(dt.kernelShape),bt=ne.ShapeUtil.computeStrides(dt.kernelShape),vt=bt.length,Et=dt.pads.length,wt=ct(vt),St=at(ut,"inputDims"),Ot=at(dt.pads,"pads"),$t=at(bt,"kernelStrides"),Mt=at(dt.strides,"strides");let Nt="";return Nt=dt.pads.reduce(((Rt,Pt)=>Rt+Pt))?`
            if (x[j] >= inputDims[j] || x[j] < 0) {
              pad++;
              isPad = true;
              break;
            }
          }
          if (!isPad) {
            ${ht}
          }`:`
          }
          ${ht}
        `,`
        ${wt}
        float process(int indices[${mt}]) {
          int x[${mt}];
          copyVec(indices, x);
          int offset[${vt}];
          int pads[${Et}];
          int inputDims[${mt}];
          int kernelStrides[${vt}];
          int strides[${vt}];
          ${Ot}
          ${St}
          ${Mt}
          ${$t}

          float value = ${ft};
          int pad = 0;
          bool isPad = false;
          for (int i = 0; i < ${yt}; i++) {
            offsetToIndices(i, kernelStrides, offset);
            isPad = false;
            for (int j = ${mt} - ${vt}; j < ${mt}; j++) {
              x[j] = indices[j] * strides[j - ${mt} + ${vt}]
                + offset[j - ${mt} + ${vt}] - pads[j - 2];
              ${Nt}
          }
          ${pt}

          return value;
        }
      `}},at=(ut,dt)=>{let ht="";for(let pt=0;pt<ut.length;pt++)ht+=`
      ${dt}[${pt}] = ${ut[pt]};
    `;return ht},ct=ut=>`
  void offsetToIndices(int offset, int[${ut}] strides, out int[${ut}] indices) {
    if (${ut} == 0) {
      return;
    }
    for (int i = 0; i < ${ut} - 1; ++i) {
      indices[i] = offset / strides[i];
      offset -= indices[i] * strides[i];
    }
    indices[${ut} - 1] = offset;
  }`},4939:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.reduceLogSumSquare=O.reduceLogSum=O.reduceProd=O.reduceMin=O.reduceMax=O.reduceMean=O.reduceSum=O.parseReduceAttributes=void 0;const te=Y(246),ne=Y(782),xe=Y(2517),et=Y(2039),tt=(ot,rt,nt,at,ct)=>{st(rt);const ut={name:at,inputNames:["A"],inputTypes:[et.TextureType.unpacked]};return[ot.run(Object.assign(Object.assign({},ut),{cacheHint:nt.cacheKey,get:()=>it(ot,rt,nt,at,ct,ut)}),rt)]};O.parseReduceAttributes=ot=>{const rt=ot.attributes.getInts("axes",[]),nt=ot.attributes.getInt("keepdims",1)===1;return(0,te.createAttributeWithCacheKey)({axes:rt,keepDims:nt})};const it=(ot,rt,nt,at,ct,ut)=>{const dt=[],ht=rt[0].dims.length||1,pt=[],ft=xe.ShapeUtil.normalizeAxes(nt.axes,rt[0].dims.length),mt=ct(rt,ft);let yt=mt[1];for(let vt=0;vt<rt[0].dims.length;vt++)ft.indexOf(vt)>=0||ft.length===0?(nt.keepDims&&dt.push(1),yt=`
          for(int j${vt} = 0; j${vt} < ${rt[0].dims[vt]}; j${vt}++) {
            inputIdx[${vt}] = j${vt};
            ${yt}
          }`):(pt.push(`inputIdx[${vt}] = outputIdx[${dt.length}];`),dt.push(rt[0].dims[vt]));const bt=`
      float process(int outputIdx[${dt.length||1}]) {
        float value;                 // final result
        int inputIdx[${ht}];      // addressing input data
        ${pt.join(`
`)}
        ${mt[0]}       // init ops for reduce max/min
        ${yt}
        ${mt[2]}       // final computation for reduce mean
        return value;
      }`;return Object.assign(Object.assign({},ut),{output:{dims:dt,type:rt[0].type,textureType:et.TextureType.unpacked},shaderSource:bt})},st=ot=>{if(!ot||ot.length!==1)throw new Error("Reduce op requires 1 input.");if(ne.NUMBER_TYPES.indexOf(ot[0].type)===-1)throw new Error("Invalid input type.")};O.reduceSum=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceSum",(()=>["value = 0.0;","value += _A(inputIdx);",""])),O.reduceMean=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceMean",((at,ct)=>{let ut=1;for(let dt=0;dt<at[0].dims.length;dt++)(ct.indexOf(dt)>=0||ct.length===0)&&(ut*=at[0].dims[dt]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${ut}.;`]})),O.reduceMax=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceMax",((at,ct)=>{const ut=[];for(let dt=0;dt<at[0].dims.length;dt++)(ct.indexOf(dt)>=0||ct.length===0)&&ut.push(`inputIdx[${dt}] = 0;`);return[`${ut.join(`
`)}
value = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]})),O.reduceMin=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceMin",((at,ct)=>{const ut=[];for(let dt=0;dt<at[0].dims.length;dt++)(ct.indexOf(dt)>=0||ct.length===0)&&ut.push(`inputIdx[${dt}] = 0;`);return[`${ut.join(`
`)}
value = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]})),O.reduceProd=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceProd",(()=>["value = 1.0;","value *= _A(inputIdx);",""])),O.reduceLogSum=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceLogSum",(()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"])),O.reduceLogSumSquare=(ot,rt,nt)=>tt(ot,rt,nt,"ReduceLogSumSquare",(()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""]))},7019:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.isReshapeCheap=O.processDims3D=O.createPackedReshape3DProgramInfoLoader=void 0;const te=Y(2517),ne=Y(5060),xe=Y(2039),et=Y(2827);O.createPackedReshape3DProgramInfoLoader=(tt,it,st)=>{const ot=(rt=>({name:"Reshape (packed)",inputTypes:[xe.TextureType.packed],inputNames:["A"],cacheHint:`${rt}`}))(st);return Object.assign(Object.assign({},ot),{get:()=>((rt,nt,at,ct)=>{const ut=nt.dims,dt=ct;let ht="";for(let mt=0;mt<4;mt++){let yt="";switch(mt){case 0:yt="outputCoords = rc;";break;case 1:yt="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:yt="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:yt="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw new Error}ht+=`
        ${yt}
        ${mt>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}
          int flattenedIndex = getFlattenedIndex(outputCoords);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);
          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${mt}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);

        ${mt>0?"}":""}
      `}const pt=(0,ne.getGlsl)(rt.session.backend.glContext.version),ft=`
      ${(function(mt){const yt=te.ShapeUtil.computeStrides(mt),bt=["b","r","c"],vt="index";return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${yt.map(((Et,wt)=>`int ${bt[wt]} = ${vt} / ${Et}; ${wt===yt.length-1?`int ${bt[wt+1]} = ${vt} - ${bt[wt]} * ${Et}`:`index -= ${bt[wt]} * ${Et}`};`)).join("")}
      return ivec3(b, r, c);
    }
  `})(ut)}
      ${(function(mt){const yt=te.ShapeUtil.computeStrides(mt);return`
  int getFlattenedIndex(ivec3 coords) {
    // reverse y, z order
    return coords.x * ${yt[0]} + coords.z * ${yt[1]} + coords.y;
  }
`})(dt)}
      ${(0,et.unpackFromChannel)()}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.0);

        ivec3 outputCoords;
        int rows = ${dt[2]};
        int cols = ${dt[1]};

        ${ht}
        ${pt.output} = result;
      }
    `;return Object.assign(Object.assign({},at),{output:{dims:dt,type:nt.type,textureType:xe.TextureType.packed},shaderSource:ft,hasMain:!0})})(tt,it,ot,st)})},O.processDims3D=function(tt){if(tt.length===0)return[1,1,1];let it=1;for(let st=0;st<tt.length-2;++st)it*=tt[st];return[it,tt.length>1?tt[tt.length-2]:1,tt[tt.length-1]]},O.isReshapeCheap=function(tt,it){let st=!1;return st=tt.length===0||it.length===0||(tt.length<2||it.length<2?tt[tt.length-1]===it[it.length-1]:tt[tt.length-1]===it[it.length-1]&&tt[tt.length-2]===it[it.length-2]),st}},718:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.reshape=void 0;const te=Y(2517);O.reshape=(ne,xe)=>{const et=te.ShapeUtil.calculateReshapedDims(xe[0].dims,xe[1].integerData);return ne.session.pack?[ne.reshapePacked(xe[0],et)]:[ne.reshapeUnpacked(xe[0],et)]}},2268:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseResizeAttributesV11=O.parseResizeAttributesV10=O.resize=void 0;const te=Y(5060),ne=Y(2039),xe=Y(9390),et=Y(2827),tt=Y(9793),it={name:"Resize",inputNames:["A"],inputTypes:[ne.TextureType.packed]};O.resize=(at,ct,ut)=>((0,tt.validateInputs)(ct,ut),[at.run(Object.assign(Object.assign({},it),{cacheHint:ut.cacheKey,get:()=>st(at,ct,ut)}),ct)]),O.parseResizeAttributesV10=at=>(0,tt.parseUpsampleAttributes)(at,10),O.parseResizeAttributesV11=at=>(0,tt.parseUpsampleAttributes)(at,11);const st=(at,ct,ut)=>{const dt=(0,te.getGlsl)(at.session.backend.glContext.version),[ht,pt]=ot(ct,ut);if(ht.every((Nt=>Nt===1))&&ut.coordinateTransformMode!=="tf_crop_and_resize")return Object.assign(Object.assign({},it),{output:{dims:pt,type:ct[0].type,textureType:ne.TextureType.packed},hasMain:!0,shaderSource:`void main() {
                    vec4 v = ${dt.texture2D}(X, TexCoords);
                    ${dt.output} = v;
                }`});const ft=pt.length;if(ft<2)throw new Error(`output dimension should be at least 2, but got ${ft}`);const mt=pt[ft-2],yt=pt[ft-1],bt=ct[0].dims;if(ft!==bt.length)throw new Error(`output dimension should match input ${bt.length}, but got ${ft}`);const vt=bt[ft-2],Et=bt[ft-1],wt=ht[ft-2],St=ht[ft-1];let Ot="";if(ut.mode!=="linear")throw new Error(`resize (packed) does not support mode: '${ut.mode}'`);switch(ut.coordinateTransformMode){case"asymmetric":Ot=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return vec4(coords) / scaleWHWH;
                    }
                `;break;case"half_pixel":Ot=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;
                    }
                `;break;case"pytorch_half_pixel":Ot=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 fcoords = vec4(coords);
                        return vec4(
                            ${yt}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,
                            ${mt}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,
                            ${yt}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,
                            ${mt}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0
                          );
                    }
                `;break;case"align_corners":Ot=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 resized = vec4(${yt}.0 - 1.0, ${mt}.0 - 1.0, ${yt}.0 - 1.0,
                            ${mt}.0 - 1.0);
                        vec4 original = vec4(${Et}.0 - 1.0, ${vt}.0 - 1.0, ${Et}.0 - 1.0,
                            ${vt}.0 - 1.0);
                        vec4 new_scale = original / resized;
                        return vec4(coords) * new_scale;
                    }
                `;break;default:throw new Error(`resize (packed) does not support coordinateTransformMode:                                 '${ut.coordinateTransformMode}'`)}const $t=(0,xe.getCoordsDataType)(ft),Mt=`
            const vec2 inputWH = vec2(${vt}.0, ${Et}.0);
            const vec4 scaleWHWH = vec4(float(${wt}), float(${St}), float(${wt}), float(${St}));
            ${(0,et.unpackFromChannel)()}
            ${Ot}
            float getAValue(int x10, int r, int c, int d) {
                return getChannel(getA(x10, r, c, d), vec2(c, d));
            }
            void main() {
                ${$t} rc = getOutputCoords();

                int batch = rc[0];
                int depth = rc[1];

                // retrieve the 4 coordinates that is used in the 4 packed output values.
                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);

                // calculate the source index in fraction
                vec4 sourceFrac = getSourceFracIndex(coords);

                // get the lower and upper bound of the 4 values that will be packed into one texel.
                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));
                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));
                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));
                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));

                bool hasNextRow = rc.w < ${mt-1};
                bool hasNextCol = rc.z < ${yt-1};

                // pack x00, x01, x10, x11's top-left corner into one vec4 structure
                vec4 topLeft = vec4(
                    getAValue(batch, depth, x00.x, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);

                // pack x00, x01, x10, x11's top-right corner into one vec4 structure
                vec4 topRight = vec4(
                    getAValue(batch, depth, x00.x, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);

                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure
                vec4 bottomLeft = vec4(
                    getAValue(batch, depth, x00.z, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);

                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure
                vec4 bottomRight = vec4(
                    getAValue(batch, depth, x00.z, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);

                // calculate the interpolation fraction on u and v direction
                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);
                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));

                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);
                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);
                vec4 newValue = mix(top, bottom, clampFrac.xxzz);

                ${dt.output} = vec4(newValue);
            }
        `;return Object.assign(Object.assign({},it),{output:{dims:pt,type:ct[0].type,textureType:ne.TextureType.packed},hasMain:!0,shaderSource:Mt})},ot=(at,ct)=>{const ut=at[0].dims;let dt,ht=ct.scales;if(ht.length===0){const ft=at[ct.scalesInputIdx];if(ft&&ft.size!==0){if(at[ct.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");ht=rt(ft,ct.mode,ct.isResize)}else{const mt=at[ct.sizesInputIdx];if(!mt||mt.size===0)throw new Error("Either scales or sizes MUST be provided as input.");dt=Array.from(mt.integerData),ht=nt(dt,ut,ct.mode,ct.isResize)}}else if(at[ct.sizesInputIdx])throw new Error("Only one of scales or sizes must be provided as input.");const pt=dt||ut.map(((ft,mt)=>Math.floor(ft*ht[mt])));return[ht,pt]},rt=(at,ct,ut)=>{const dt=Array.from(at.floatData);return(0,tt.scalesValidation)(dt,ct,ut),dt},nt=(at,ct,ut,dt)=>{const ht=ct.length,pt=new Array(ht);for(let ft=0,mt=ht;ft<mt;ft++)if(ct[ft]===0){if(at[ft]!==0)throw new Error("Input dim is zero but required output dim is non-zero.");pt[ft]=1}else pt[ft]=at[ft]/ct[ft];return(0,tt.scalesValidation)(pt,ut,dt),pt}},8117:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.shape=void 0;const te=Y(9162);O.shape=(xe,et)=>(ne(et),[new te.Tensor([et[0].dims.length],"int32",void 0,void 0,new Int32Array(et[0].dims))]);const ne=xe=>{if(!xe||xe.length!==1)throw new Error("Shape requires 1 input.")}},2278:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.sliceV10=O.parseSliceAttributes=O.slice=void 0;const te=Y(246),ne=Y(782),xe=Y(2517),et=Y(2039),tt={name:"Slice",inputNames:["A"],inputTypes:[et.TextureType.unpacked]};O.slice=(nt,at,ct)=>(st(at),[nt.run(Object.assign(Object.assign({},tt),{cacheHint:ct.cacheKey,get:()=>it(nt,at[0],ct)}),at)]),O.parseSliceAttributes=nt=>{const at=nt.attributes.getInts("starts"),ct=nt.attributes.getInts("ends"),ut=nt.attributes.getInts("axes",[]);return(0,te.createAttributeWithCacheKey)({starts:at,ends:ct,axes:ut})};const it=(nt,at,ct)=>{const ut=ct.axes.length===0?at.dims.slice(0).map(((bt,vt)=>vt)):ct.axes,dt=xe.ShapeUtil.normalizeAxes(ut,at.dims.length),ht=ct.starts.map(((bt,vt)=>bt>at.dims[dt[vt]]-1?at.dims[dt[vt]]:xe.ShapeUtil.normalizeAxis(bt,at.dims[dt[vt]]))),pt=ct.ends.map(((bt,vt)=>bt>at.dims[dt[vt]]-1?at.dims[dt[vt]]:xe.ShapeUtil.normalizeAxis(bt,at.dims[dt[vt]]))),ft=at.dims.slice(),mt=[];for(let bt=0;bt<dt.length;bt++)ft[dt[bt]]=pt[bt]-ht[bt],ht[bt]>0&&mt.push(`outputIdx[${dt[bt]}] += ${ht[bt]};`);const yt=`
      float process(int outputIdx[${ft.length}]) {
        ${mt.join(`
      `)}
        return _A(outputIdx);
      }`;return Object.assign(Object.assign({},tt),{output:{dims:ft,type:at.type,textureType:et.TextureType.unpacked},shaderSource:yt})},st=nt=>{if(!nt||nt.length!==1)throw new Error("Slice requires 1 input.");if(ne.NUMBER_TYPES.indexOf(nt[0].type)===-1)throw new Error("Invalid input type.")};O.sliceV10=(nt,at)=>{rt(at);const ct=ot(nt,at);return[nt.run(Object.assign(Object.assign({},tt),{cacheHint:ct.cacheKey,get:()=>it(nt,at[0],ct)}),[at[0]])]};const ot=(nt,at)=>{if(!nt.session.isInitializer(at[1].dataId)||!nt.session.isInitializer(at[2].dataId)||at.length>=4&&!nt.session.isInitializer(at[3].dataId)||at.length>=5&&!nt.session.isInitializer(at[4].dataId))throw new Error("dynamic slice attributes are not allowed");if(at.length>=5&&at[4].integerData.some((ht=>ht!==1)))throw new Error("currently non-1 steps is not supported for Slice");const ct=Array.from(at[1].integerData),ut=Array.from(at[2].integerData),dt=at.length>=4?Array.from(at[3].integerData):[];return{starts:ct,ends:ut,axes:dt,cacheKey:`${dt};${ct};${ut}`}},rt=nt=>{if(!nt||nt.length<3||nt.length>5)throw new Error("Invalid input number.");if(nt[1].type!=="int32"||nt[1].dims.length!==1)throw new Error("Invalid input type.");if(nt[2].type!=="int32"||nt[2].dims.length!==1)throw new Error("Invalid input type.");if(nt.length>=4&&(nt[3].type!=="int32"||nt[3].dims.length!==1))throw new Error("Invalid input type.");if(nt.length>=5&&(nt[4].type!=="int32"||nt[4].dims.length!==1))throw new Error("Invalid input type.")}},5524:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.softmaxV13=O.parseSoftmaxAttributesV13=O.parseSoftmaxAttributes=O.softmax=void 0;const te=Y(246),ne=Y(2517),xe=Y(5060),et=Y(2039),tt=Y(3738),it={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[et.TextureType.unpacked]},st={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[et.TextureType.unpacked,et.TextureType.unpacked]},ot={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[et.TextureType.unpacked,et.TextureType.unpacked,et.TextureType.unpacked]};O.softmax=(dt,ht,pt)=>{ut(ht);const ft=ht[0].dims.slice(),mt=ne.ShapeUtil.normalizeAxis(pt.axis,ft.length),yt=ne.ShapeUtil.sizeToDimension(ft,mt),bt=ne.ShapeUtil.sizeFromDimension(ft,mt);return rt(dt,ht,pt,yt,bt)},O.parseSoftmaxAttributes=dt=>(0,te.createAttributeWithCacheKey)({axis:dt.attributes.getInt("axis",1)}),O.parseSoftmaxAttributesV13=dt=>(0,te.createAttributeWithCacheKey)({axis:dt.attributes.getInt("axis",-1)}),O.softmaxV13=(dt,ht,pt)=>{ut(ht);const ft=ht[0].dims.slice(),mt=ne.ShapeUtil.normalizeAxis(pt.axis,ft.length),yt=ft.length,bt=mt!==yt-1,vt=[];let Et,wt=[],St=[];bt&&(wt=Array.from({length:yt}).map(((Nt,Rt)=>Rt)),wt[mt]=yt-1,wt[yt-1]=mt,wt.map((Nt=>vt.push(ft[Nt]))),Et=(0,te.createAttributeWithCacheKey)({perm:wt}),St=(0,tt.transpose)(dt,ht,Et));const Ot=bt?ne.ShapeUtil.sizeToDimension(vt,yt-1):ne.ShapeUtil.sizeToDimension(ft,yt-1),$t=bt?ne.ShapeUtil.sizeFromDimension(vt,yt-1):ne.ShapeUtil.sizeFromDimension(ft,yt-1),Mt=rt(dt,bt?St:ht,pt,Ot,$t);return bt?(0,tt.transpose)(dt,Mt,Et):Mt};const rt=(dt,ht,pt,ft,mt)=>{const yt=nt(dt,ht[0],ft,mt,[ft]),bt=dt.run(Object.assign(Object.assign({},it),{cacheHint:pt.cacheKey,get:()=>yt}),ht),vt=at(dt,ht[0],ft,mt,yt.output.dims,[ft]),Et=dt.run(Object.assign(Object.assign({},st),{cacheHint:pt.cacheKey,get:()=>vt}),[ht[0],bt]),wt=ct(dt,ht[0],ft,mt,yt.output.dims,vt.output.dims);return[dt.run(Object.assign(Object.assign({},ot),{cacheHint:pt.cacheKey,get:()=>wt}),[ht[0],bt,Et])]},nt=(dt,ht,pt,ft,mt)=>{const[yt,bt]=dt.calculateTextureWidthAndHeight(ht.dims,et.TextureType.unpacked),vt=mt.length;if(pt<1||ft<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(mt.length!==1)throw new Error("Dimensionality of the output should be 1");if(mt[0]!==pt)throw new Error("Shape of the output should be equal to logical row count");const Et=(0,xe.getGlsl)(dt.session.backend.glContext.version),wt=`
      float process(int[${vt}] indices) {
        int logical_row_start_offset = indices[0] * ${ft};

        float max = getColorAsFloat(${Et.texture2D}(A, offsetToCoords(logical_row_start_offset, ${yt},
        ${bt} )));
        for(int i=1; i<${ft}; ++i)
        {
          float current = getColorAsFloat(${Et.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${yt}, ${bt})));
          if(current > max)
          max = current;
        }

        return max;
      }`;return Object.assign(Object.assign({},it),{output:{dims:mt,type:ht.type,textureType:et.TextureType.unpacked},shaderSource:wt})},at=(dt,ht,pt,ft,mt,yt)=>{const[bt,vt]=dt.calculateTextureWidthAndHeight(ht.dims,et.TextureType.unpacked),Et=yt.length;if(pt<1||ft<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(yt.length!==1)throw new Error("Dimensionality of the output should be 1");if(yt[0]!==pt)throw new Error("Shape of the output should be equal to logical row count");if(mt.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(mt[0]!==pt)throw new Error("Shape of the intermediate results should be equal to logical row count");const wt=`
      float process(int[${Et}] indices) {
        int logical_row_start_offset = indices[0] * ${ft};

        float norm_factor = 0.0;
        float max = _Max(indices);
        for(int i=0; i<${ft}; ++i)
        {
          norm_factor += exp(getColorAsFloat(${(0,xe.getGlsl)(dt.session.backend.glContext.version).texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${bt}, ${vt}))) - max);
        }

        return norm_factor;
      }`;return Object.assign(Object.assign({},st),{output:{dims:yt,type:ht.type,textureType:et.TextureType.unpacked},shaderSource:wt})},ct=(dt,ht,pt,ft,mt,yt)=>{const[bt,vt]=dt.calculateTextureWidthAndHeight(ht.dims,et.TextureType.unpacked),Et=ht.dims.length;if(pt<1||ft<1)throw new Error("Logical row count N and feature count D must be greater than or equal to 1");if(mt.length!==1||yt.length!==1)throw new Error("Dimensionality of the intermediate results should be 1");if(mt[0]!==pt||yt[0]!==pt)throw new Error("Shape of the intermediate results should be equal to logical row count");const wt=`
      float process(int[${Et}] indices) {

      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)
      int offset = coordsToOffset(TexCoords, ${bt}, ${vt});

      //determine the logical row for this index
      int logical_row_index[1];
      logical_row_index[0] = offset / ${ft};

      float norm_factor = _Norm(logical_row_index);

      // avoid possible division by 0
      // if norm_facor is 0, all elements are zero
      // if so, return 0
      if(norm_factor == 0.0)
        return 0.0;

      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;
    }`;return Object.assign(Object.assign({},ot),{output:{dims:ht.dims,type:ht.type,textureType:et.TextureType.unpacked},shaderSource:wt})},ut=dt=>{if(!dt||dt.length!==1)throw new Error("Softmax requires 1 input.");if(dt[0].type!=="float32"&&dt[0].type!=="float64")throw new Error("Invalid input type")}},5975:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseSplitAttributes=O.split=void 0;const te=Y(246),ne=Y(2517),xe=Y(2039),et={name:"Split",inputNames:["A"],inputTypes:[xe.TextureType.unpacked]};O.split=(ot,rt,nt)=>{st(rt);const at=ne.ShapeUtil.normalizeAxis(nt.axis,rt[0].dims.length),ct=tt(ot,rt,at,nt),ut=[];for(let dt=0;dt<ct;++dt)ut.push(ot.run(Object.assign(Object.assign({},et),{cacheHint:`${nt.cacheKey};${dt}`,get:()=>it(ot,rt[0],nt,at,dt)}),rt));return ut},O.parseSplitAttributes=ot=>{const rt=ot.attributes.getInt("axis",0),nt=ot.attributes.getInts("split",[]),at=ot.outputs.length;return(0,te.createAttributeWithCacheKey)({axis:rt,split:nt,numOutputs:at})};const tt=(ot,rt,nt,at)=>{const[,ct]=ne.SplitUtil.splitShape(rt[0].dims,nt,at.split,at.numOutputs);return ct.length},it=(ot,rt,nt,at,ct)=>{const[ut,dt]=ne.SplitUtil.splitShape(rt.dims,at,nt.split,nt.numOutputs),ht=dt[ct],pt=ut[ct],ft=`
      float process(int indices[${pt.length}]) {
        indices[${at}] += ${ht};
        return _A(indices);
      }
    `;return Object.assign(Object.assign({},et),{cacheHint:`${nt.cacheKey}:${ct}`,output:{dims:pt,type:rt.type,textureType:xe.TextureType.unpacked},shaderSource:ft})},st=ot=>{if(!ot||ot.length!==1)throw new Error("Split requires one input.");if(ot[0].type!=="int8"&&ot[0].type!=="uint8"&&ot[0].type!=="int16"&&ot[0].type!=="uint16"&&ot[0].type!=="int32"&&ot[0].type!=="uint32"&&ot[0].type!=="float32"&&ot[0].type!=="float64"&&ot[0].type!=="bool")throw new Error("Invalid input type.")}},3933:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseSqueezeAttributes=O.squeezeV13=O.squeeze=void 0;const te=Y(2517);O.squeeze=(et,tt,it)=>{ne(tt);const st=te.ShapeUtil.squeezeShape(tt[0].dims,it);return[et.reshapeUnpacked(tt[0],st)]},O.squeezeV13=(et,tt)=>(xe(tt),(0,O.squeeze)(et,[tt[0]],Array.from(tt[1].integerData))),O.parseSqueezeAttributes=et=>et.attributes.getInts("axes");const ne=et=>{if(!et||et.length!==1)throw new Error("Squeeze requires 1 input.");if(et[0].type==="string")throw new Error("invalid input tensor types.")},xe=et=>{if(!et||et.length!==2)throw new Error("Squeeze requires 2 inputs.");if(et[1].type!=="int32")throw new Error("Invalid input type.")}},6558:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.sum=void 0;const te=Y(5060),ne=Y(2039);O.sum=(tt,it)=>{et(it);const st={name:"Sum",inputNames:it.map(((ot,rt)=>`X${rt}`)),inputTypes:new Array(it.length).fill(ne.TextureType.unpacked)};return[tt.run(Object.assign(Object.assign({},st),{get:()=>xe(tt,it,st)}),it)]};const xe=(tt,it,st)=>{const ot=(0,te.getGlsl)(tt.session.backend.glContext.version),rt=it[0].dims.slice(),nt=`
      void main() {
        vec4 result = ${it.map(((at,ct)=>`${ot.texture2D}(X${ct},TexCoords)`)).join(" + ")};
        ${ot.output} = result;
      }
    `;return Object.assign(Object.assign({},st),{output:{dims:rt,type:it[0].type,textureType:ne.TextureType.unpacked},hasMain:!0,shaderSource:nt})},et=tt=>{if(!tt||tt.length===0)throw new Error("Sum requires inputs.");const it=tt[0].dims.length;for(let st=1;st<tt.length;st++){if(it!==tt[st].dims.length)throw new Error("Input shapes are mismatched.");for(let ot=0;ot<it;ot++)if(tt[0].dims[ot]!==tt[st].dims[ot])throw new Error("Input shapes are not matched.")}if(tt[0].type!=="float32"&&tt[0].type!=="float64")throw new Error("Invalid input type.");for(let st=1;st<tt.length;st++)if(tt[0].type!==tt[st].type)throw new Error("Input types are not matched.")}},5723:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.tile=void 0;const te=Y(782),ne=Y(2039);O.tile=(tt,it)=>{et(it);const st={name:"Tile",inputNames:["A"],inputTypes:[ne.TextureType.unpacked]};return[tt.run(Object.assign(Object.assign({},st),{get:()=>xe(tt,it,st)}),it)]};const xe=(tt,it,st)=>{const ot=it[0].dims.slice(),rt=new Array(ot.length),nt=[];for(let ut=0;ut<ot.length;ut++)rt[ut]=ot[ut]*it[1].numberData[ut],nt.push(`inputIdx[${ut}] = int(mod(float(outputIdx[${ut}]), ${ot[ut]}.));`);const at=rt.length,ct=`
      float process(int outputIdx[${at}]) {
        int inputIdx[${at}];
        ${nt.join(`
`)}
        return _A(inputIdx);
      }
    `;return Object.assign(Object.assign({},st),{output:{dims:rt,type:it[0].type,textureType:ne.TextureType.unpacked},shaderSource:ct})},et=tt=>{if(!tt||tt.length!==2)throw new Error("Tile requires 2 input.");if(tt[1].dims.length!==1)throw new Error("The second input shape must 1 dimension.");if(tt[1].dims[0]!==tt[0].dims.length)throw new Error("Invalid input shape.");if(te.NUMBER_TYPES.indexOf(tt[0].type)===-1)throw new Error("Invalid input type.");if(tt[1].type!=="int32"&&tt[1].type!=="int16")throw new Error("Invalid repeat type.")}},3738:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseTransposeAttributes=O.transpose=void 0;const te=Y(246),ne=Y(2517),xe=Y(2039),et={name:"Transpose",inputNames:["A"],inputTypes:[xe.TextureType.unpacked]};O.transpose=(nt,at,ct)=>(rt(at),[nt.run(Object.assign(Object.assign({},et),{cacheHint:ct.cacheKey,get:()=>tt(nt,at[0],ct.perm)}),at)]),O.parseTransposeAttributes=nt=>(0,te.createAttributeWithCacheKey)({perm:nt.attributes.getInts("perm",[])});const tt=(nt,at,ct)=>{const ut=at.dims;ct=it(ut,ct);const dt=st(ut,ct),ht=ut.length,pt=`
      ${ot("perm",ct,ht)}
      float process(int indices[${ht}]) {
        int a[${ht}];
        perm(a, indices);
        return _A(a);
      }`;return Object.assign(Object.assign({},et),{output:{dims:dt,type:at.type,textureType:xe.TextureType.unpacked},shaderSource:pt})},it=(nt,at)=>(at&&at.length!==nt.length&&(at=[...nt.keys()].reverse()),at),st=(nt,at)=>(at=it(nt,at),ne.ShapeUtil.sortBasedOnPerm(nt,at)),ot=(nt,at,ct)=>{const ut=[];ut.push(`void ${nt}(out int a[${ct}], int src[${ct}]) {`);for(let dt=0;dt<ct;++dt)ut.push(`	a[${at[dt]}]=src[${dt}];`);return ut.push("	}"),ut.join(`
`)},rt=nt=>{if(!nt||nt.length!==1)throw new Error("Transpose requires 1 input.");if(nt[0].type!=="float32"&&nt[0].type!=="float64")throw new Error("input should be float tensor")}},8710:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.encodeAsUint8=void 0;const te=Y(5060),ne=Y(2039);O.encodeAsUint8=(xe,et)=>{const tt=et.shape,it=(0,te.getGlsl)(xe.session.backend.glContext.version),st=`
    const float FLOAT_MAX = 1.70141184e38;
    const float FLOAT_MIN = 1.17549435e-38;

    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    highp vec4 encodeAsUint8(highp float v) {
      if (isNaN(v)) {
        return vec4(255, 255, 255, 255);
      }

      highp float av = abs(v);

      if(av < FLOAT_MIN) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      } else if(v > FLOAT_MAX) {
        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
      } else if(v < -FLOAT_MAX) {
        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
      }

      highp vec4 c = vec4(0,0,0,0);

      highp float e = floor(log2(av));
      highp float m = exp2(fract(log2(av))) - 1.0;

      c[2] = floor(128.0 * m);
      m -= c[2] / 128.0;
      c[1] = floor(32768.0 * m);
      m -= c[1] / 32768.0;
      c[0] = floor(8388608.0 * m);

      highp float ebias = e + 127.0;
      c[3] = floor(ebias / 2.0);
      ebias -= c[3] * 2.0;
      c[2] += floor(ebias) * 128.0;

      c[3] += 128.0 * step(0.0, -v);

      return c / 255.0;
    }

    void main() {
      float value = ${it.texture2D}(X,TexCoords).r;
      ${it.output} = encodeAsUint8(value);
    }`,ot={name:"Uint8Encode",inputTypes:[ne.TextureType.unpacked],inputNames:["X"],output:{dims:tt,type:et.tensor.type,textureType:ne.TextureType.downloadUint8AsFloat},shaderSource:st,hasMain:!0};return xe.executeProgram(ot,[et.tensor])}},4909:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.tanh=O.tan=O.sqrt=O.sin=O.sigmoid=O.relu=O.not=O.neg=O.log=O.parseLeakyReluAttributes=O.leakyRelu=O.identity=O.floor=O.exp=O.parseEluAttributes=O.elu=O.cos=O.ceil=O.clipV11=O.parseClipAttributes=O.clip=O.atan=O.asin=O.acos=O.abs=O.glslTanh=O.glslTan=O.glslSqrt=O.glslSigmoid=O.glslRelu=O.glslSin=O.glslNot=O.glslNeg=O.glslLog=O.glslLeakyRelu=O.glslIdentity=O.glslClip=O.glslFloor=O.glslExp=O.glslElu=O.glslCos=O.glslCeil=O.glslAtan=O.glslAsin=O.glslAcos=O.glslAbs=void 0;const te=Y(246),ne=Y(2517),xe=Y(8520),et=Y(5060),tt=Y(2039);function it(){return Mt("abs")}function st(){return Mt("acos")}function ot(){return Mt("asin")}function rt(){return Mt("atan")}function nt(){return Mt("ceil")}function at(){return Mt("cos")}function ct(Pt){return{body:`
  const float alpha = float(${Pt});

  float elu_(float a) {
    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;
  }
  vec4 elu_(vec4 v) {
    return vec4(elu_(v.x), elu_(v.y), elu_(v.z), elu_(v.w));
  }
  `,name:"elu",type:xe.FunctionType.ValueBased}}function ut(){return Mt("exp")}function dt(){return Mt("floor")}function ht(Pt,kt){const Wt="clip";return{body:`
  const float min = float(${Pt});
  const float max = float(${kt});

  float ${Wt}_(float a) {
    return clamp(a, min, max);
  }
  vec4 ${Wt}_(vec4 v) {
    return clamp(v, min, max);
  }
  `,name:Wt,type:xe.FunctionType.ValueBased}}function pt(){const Pt="indentity";return{body:`
  float ${Pt}_(float a) {
    return a;
  }
  vec4 ${Pt}_(vec4 v) {
    return v;
  }
  `,name:Pt,type:xe.FunctionType.ValueBased}}function ft(Pt){const kt="leakyRelu";return{body:`
  const float alpha = float(${Pt});

  float ${kt}_(float a) {
    return a < 0.0 ? a * alpha : a;
  }
  vec4 ${kt}_(vec4 v) {
    return vec4(${kt}_(v.x), ${kt}_(v.y), ${kt}_(v.z), ${kt}_(v.w));
  }
  `,name:kt,type:xe.FunctionType.ValueBased}}function mt(){return Mt("log")}function yt(){return{body:`
  float neg_(float a) {
    return -a;
  }
  vec4 neg_(vec4 v) {
    return -v;
  }
  `,name:"neg",type:xe.FunctionType.ValueBased}}function bt(){return{body:`
  float not_(float a) {
    return float( ! bool(a) );
  }
  bool not_(bool a) {
    return !a;
  }
  vec4 not_(vec4 v) {
    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));
  }
  bvec4 not_(bvec4 v) {
    return bvec4(!v.x, !v.y, !v.z, !v.w);
  }
  `,name:"not",type:xe.FunctionType.ValueBased}}function vt(){return Mt("sin")}function Et(){const Pt="relu";return{body:`
  float ${Pt}_(float a) {
    return max( a, 0.0 );
  }
  vec4 ${Pt}_(vec4 v) {
    return max( v, 0.0 );
  }
  `,name:Pt,type:xe.FunctionType.ValueBased}}function wt(){const Pt="sigmoid";return{body:`
  float ${Pt}_(float a) {
    return 1.0 / (1.0 + exp(-a));
  }
  vec4 ${Pt}_(vec4 v) {
    return 1.0 / (1.0 + exp(-v));
  }
  `,name:Pt,type:xe.FunctionType.ValueBased}}function St(){return Mt("sqrt")}function Ot(){return Mt("tan")}function $t(){const Pt="tanh";return{body:`
  float ${Pt}_(float a) {
    a = clamp(a, -10., 10.);
    a = exp(2.*a);
    return (a - 1.) / (a + 1.);
  }
  vec4 ${Pt}_(vec4 v) {
    v = clamp(v, -10., 10.);
    v = exp(2.*v);
    return (v - 1.) / (v + 1.);
  }
  `,name:Pt,type:xe.FunctionType.ValueBased}}function Mt(Pt){return{body:`
  float ${Pt}_(float a) {
    return ${Pt}(a);
  }
  vec4 ${Pt}_(vec4 v) {
    return ${Pt}(v);
  }
  `,name:Pt,type:xe.FunctionType.ValueBased}}O.glslAbs=it,O.glslAcos=st,O.glslAsin=ot,O.glslAtan=rt,O.glslCeil=nt,O.glslCos=at,O.glslElu=ct,O.glslExp=ut,O.glslFloor=dt,O.glslClip=ht,O.glslIdentity=pt,O.glslLeakyRelu=ft,O.glslLog=mt,O.glslNeg=yt,O.glslNot=bt,O.glslSin=vt,O.glslRelu=Et,O.glslSigmoid=wt,O.glslSqrt=St,O.glslTan=Ot,O.glslTanh=$t;const Nt=(Pt,kt,Wt,zt)=>{const Kt=Pt.session.pack?tt.TextureType.packed:tt.TextureType.unpacked,qt={name:Wt.name,inputTypes:[Kt],inputNames:["A"],cacheHint:zt};return Object.assign(Object.assign({},qt),{get:()=>((Xt,an,pn,ln)=>{const dn=Xt.session.pack?tt.TextureType.packed:tt.TextureType.unpacked,un=(0,et.getGlsl)(Xt.session.backend.glContext.version);return Object.assign(Object.assign({},an),{output:{dims:pn.dims,type:pn.type,textureType:dn},shaderSource:`
     ${ln.body}
     void main() {
       vec4 v = ${un.texture2D}(A, TexCoords);
       v = ${ln.name}_(v);
       ${un.output} = v;
     }
     `,hasMain:!0})})(Pt,qt,kt,Wt)})};O.abs=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],it()),kt)],O.acos=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],st()),kt)],O.asin=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],ot()),kt)],O.atan=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],rt()),kt)],O.clip=(Pt,kt,Wt)=>[Pt.run(Nt(Pt,kt[0],ht(Wt.min,Wt.max),Wt.cacheKey),kt)],O.parseClipAttributes=Pt=>(0,te.createAttributeWithCacheKey)({min:Pt.attributes.getFloat("min",ne.MIN_CLIP),max:Pt.attributes.getFloat("max",ne.MAX_CLIP)}),O.clipV11=(Pt,kt)=>{const Wt=Rt(Pt,kt);return(0,O.clip)(Pt,[kt[0]],Wt)};const Rt=(Pt,kt)=>{if(kt.length>=3&&(!Pt.session.isInitializer(kt[1].dataId)||!Pt.session.isInitializer(kt[2].dataId)))throw new Error("dynamic clip attributes are not allowed");const Wt=kt.length>=3?kt[1].numberData[0]:ne.MIN_CLIP,zt=kt.length>=3?kt[2].numberData[0]:ne.MAX_CLIP;return(0,te.createAttributeWithCacheKey)({min:Wt,max:zt})};O.ceil=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],nt()),kt)],O.cos=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],at()),kt)],O.elu=(Pt,kt,Wt)=>[Pt.run(Nt(Pt,kt[0],ct(Wt.alpha),Wt.cacheKey),kt)],O.parseEluAttributes=Pt=>(0,te.createAttributeWithCacheKey)({alpha:Pt.attributes.getFloat("alpha",1)}),O.exp=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],ut()),kt)],O.floor=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],dt()),kt)],O.identity=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],pt()),kt)],O.leakyRelu=(Pt,kt,Wt)=>[Pt.run(Nt(Pt,kt[0],ft(Wt.alpha),Wt.cacheKey),kt)],O.parseLeakyReluAttributes=Pt=>(0,te.createAttributeWithCacheKey)({alpha:Pt.attributes.getFloat("alpha",.01)}),O.log=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],mt()),kt)],O.neg=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],yt()),kt)],O.not=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],bt()),kt)],O.relu=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],Et()),kt)],O.sigmoid=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],wt()),kt)],O.sin=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],vt()),kt)],O.sqrt=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],St()),kt)],O.tan=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],Ot()),kt)],O.tanh=(Pt,kt)=>[Pt.run(Nt(Pt,kt[0],$t()),kt)]},5611:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createUnpackProgramInfoLoader=O.createUnpackProgramInfo=void 0;const te=Y(5060),ne=Y(2039),xe=Y(9390),et=Y(2827),tt={name:"unpack",inputNames:["A"],inputTypes:[ne.TextureType.packed]};O.createUnpackProgramInfo=(it,st)=>{const ot=st.dims.length,rt=(0,et.getChannels)("rc",ot),nt=rt.slice(-2),at=(0,xe.getCoordsDataType)(ot),ct=(0,et.unpackFromChannel)(),ut=st.dims.length===0?"":(function(pt,ft){if(pt===1)return"rc";let mt="";for(let yt=0;yt<pt;yt++)mt+=ft[yt],yt<pt-1&&(mt+=",");return mt})(ot,rt),dt=ot<=1?"rc":`vec2(${nt.join(",")})`,ht=`
    ${ct}
    void main() {
      ${at} rc = getOutputCoords();

       // Sample the texture with the coords to get the rgba channel value.
       vec4 packedInput = getA(${ut});

       ${(0,te.getGlsl)(it.session.backend.glContext.version).output} = vec4(getChannel(packedInput, ${dt}), 0, 0, 0);
     }
   `;return Object.assign(Object.assign({},tt),{hasMain:!0,output:{dims:st.dims,type:st.type,textureType:ne.TextureType.unpacked},shaderSource:ht})},O.createUnpackProgramInfoLoader=(it,st)=>Object.assign(Object.assign({},tt),{get:()=>(0,O.createUnpackProgramInfo)(it,st)})},8428:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.parseUnsqueezeAttributes=O.unsqueezeV13=O.unsqueeze=void 0;const te=Y(2517);O.unsqueeze=(et,tt,it)=>{ne(tt);const st=te.ShapeUtil.unsqueezeShape(tt[0].dims,it);return[et.reshapeUnpacked(tt[0],st)]},O.unsqueezeV13=(et,tt)=>(xe(tt),(0,O.unsqueeze)(et,[tt[0]],Array.from(tt[1].integerData))),O.parseUnsqueezeAttributes=et=>et.attributes.getInts("axes");const ne=et=>{if(!et||et.length!==1)throw new Error("Unsqueeze requires 1 input.");if(et[0].type==="string")throw new Error("invalid input tensor types.")},xe=et=>{if(!et||et.length!==2)throw new Error("Unsqueeze requires 2 inputs.");if(et[1].type!=="int32")throw new Error("Invalid input type.")}},9793:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.scalesValidation=O.validateInputs=O.parseUpsampleAttributes=O.parseUpsampleAttributesV9=O.parseUpsampleAttributesV7=O.upsample=void 0;const te=Y(246),ne=Y(5060),xe=Y(2039),et={name:"Upsample",inputNames:["X"],inputTypes:[xe.TextureType.unpacked]};O.upsample=(it,st,ot)=>((0,O.validateInputs)(st,ot),[it.run(Object.assign(Object.assign({},et),{cacheHint:ot.cacheKey,get:()=>tt(it,st,ot)}),st)]),O.parseUpsampleAttributesV7=it=>(0,O.parseUpsampleAttributes)(it,7),O.parseUpsampleAttributesV9=it=>(0,O.parseUpsampleAttributes)(it,9),O.parseUpsampleAttributes=(it,st)=>{const ot=st>=10,rt=it.attributes.getString("mode","nearest");if(rt!=="nearest"&&rt!=="linear"&&(st<11||rt!=="cubic"))throw new Error(`unrecognized mode: ${rt}`);let nt=[];st<9&&(nt=it.attributes.getFloats("scales"),(0,O.scalesValidation)(nt,rt,ot));const at=it.attributes.getFloat("extrapolation_value",0),ct=st>10?it.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(ct)===-1)throw new Error(`coordinate_transform_mode '${ct}' is not supported`);const ut=ct==="tf_crop_and_resize",dt=ut,ht=rt==="nearest"&&st>=11?it.attributes.getString("nearest_mode","round_prefer_floor"):"";if(["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(ht)===-1)throw new Error(`nearest_mode '${ht}' is not supported`);const pt=it.attributes.getFloat("cubic_coeff_a",-.75),ft=it.attributes.getInt("exclude_outside",0)!==0;if(ft&&rt!=="cubic")throw new Error("exclude_outside can be set to 1 only when mode is CUBIC.");const mt=st<11||rt==="nearest"&&ct==="asymmetric"&&ht==="floor";let yt=0,bt=0,vt=0;return st>10?it.inputs.length>2?(yt=1,bt=2,vt=3):(bt=1,vt=2):st===9&&(bt=1),(0,te.createAttributeWithCacheKey)({opset:st,isResize:ot,mode:rt,scales:nt,extrapolationValue:at,coordinateTransformMode:ct,useExtrapolation:dt,needRoiInput:ut,nearestMode:ht,cubicCoefficientA:pt,excludeOutside:ft,useNearest2xOptimization:mt,roiInputIdx:yt,scalesInputIdx:bt,sizesInputIdx:vt})};const tt=(it,st,ot)=>{const rt=(0,ne.getGlsl)(it.session.backend.glContext.version),[nt,at]=it.calculateTextureWidthAndHeight(st[0].dims,xe.TextureType.unpacked),ct=st[0].dims.map(((vt,Et)=>Math.floor(vt*ot.scales[Et]))),[ut,dt]=it.calculateTextureWidthAndHeight(ct,xe.TextureType.unpacked),ht=ct.length,pt=new Array(ht),ft=new Array(ht);let mt=`
      int output_pitches[${ht}];
      int input_pitches[${ht}];
      `;for(let vt=ht-1;vt>=0;vt--)pt[vt]=vt===ht-1?1:pt[vt+1]*ct[vt+1],ft[vt]=vt===ht-1?1:ft[vt+1]*st[0].dims[vt+1],mt+=`
        output_pitches[${vt}] = ${pt[vt]};
        input_pitches[${vt}] = ${ft[vt]};
        `;const yt=`
      float getInputFloat(int index) {
        vec2 coords = offsetToCoords(index, ${nt}, ${at});
        float value = getColorAsFloat(${rt.texture2D}(X, coords));
        return value;
      }
      `,bt=ot.mode==="nearest"?`
    ${yt}
    float process(int indices[${ht}]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${ut}, ${dt});

      ${mt}

      int d, m;
      for (int dim = 0; dim < ${ht}; ++dim) {
        d = output_index / output_pitches[dim];
        m = output_index - d * output_pitches[dim];
        output_index = m;

        if (scales[dim] != 1 && d > 0) {
          int d2 = d / scales[dim];
          m = d - d2 * scales[dim];
          d = d2;
        }
        input_index += input_pitches[dim] * d;
      }

      return getInputFloat(input_index);
    }`:ht===4?`
    ${yt}
    float process(int indices[4]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${ut}, ${dt});

      ${mt}

      int m;
      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m / output_pitches[1];
      m = m - index_of_dim1 * output_pitches[1];
      index_of_dim2 = m / output_pitches[2];
      m = m - index_of_dim2 * output_pitches[2];
      index_of_dim3 = m;

      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;
      index_of_input_dim2 = index_of_dim2 / scales[2];
      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];
      index_of_input_dim3 = index_of_dim3 / scales[3];
      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];

      input_index = index_of_dim0 * input_pitches[0] +
            index_of_dim1 * input_pitches[1] +
            index_of_input_dim2 * input_pitches[2] +
            index_of_input_dim3;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim2 = false;
      if (index_of_input_dim2 == (${st[0].dims[2]} - 1)) {
        // It's the end in dimension 2
        x01 = x00;
        end_of_dim2 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[2]);
      }

      if (index_of_input_dim3 == (input_pitches[2] - 1)) {
        // It's the end in dimension 3
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);
    }`:`
    ${yt}
    float process(int indices[2]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${ut}, ${dt});

      ${mt}

      int m;
      int index_of_dim0, index_of_dim1;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m;

      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;
      index_of_input_dim0 = index_of_dim0 / scales[0];
      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];
      index_of_input_dim1 = index_of_dim1 / scales[1];
      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];

      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim0 = false;
      if (index_of_input_dim0 == (${st[0].dims[0]} - 1)) {
        // It's the end in dimension 0
        x01 = x00;
        end_of_dim0 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[0]);
      }

      if (index_of_input_dim1 == (input_pitches[0] - 1)) {
        // It's the end in dimension 1
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);
    }`;return Object.assign(Object.assign({},et),{output:{dims:ct,type:st[0].type,textureType:xe.TextureType.unpacked},shaderSource:bt,variables:[{name:"scales",type:"int",arrayLength:ot.scales.length,data:ot.scales.map((vt=>Math.ceil(vt)))}]})};O.validateInputs=(it,st)=>{if(!it||st.opset<9&&it.length!==1||st.opset>=9&&st.opset<11&&it.length!==2||st.opset>=11&&it.length<2)throw new Error("invalid inputs.");if(st.scales.length>0&&it[0].dims.length!==st.scales.length)throw new Error("Invalid input shape.");if(it[0].type==="string")throw new Error("Invalid input tensor types.")},O.scalesValidation=(it,st,ot)=>{if(ot){for(const rt of it)if(rt<=0)throw new Error("Scale value should be greater than 0.")}else for(const rt of it)if(rt<1)throw new Error("Scale value should be greater than or equal to 1.");if(!(st!=="linear"&&st!=="cubic"||it.length===2||it.length===4&&it[0]===1&&it[1]===1))throw new Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${ot?"Resize":"Upsample"} opeartor.`)}},1958:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.ProgramManager=void 0;const te=Y(1670),ne=Y(6231),xe=Y(8879),et=Y(5060);O.ProgramManager=class{constructor(tt,it,st){this.profiler=tt,this.glContext=it,this.textureLayoutStrategy=st,this.repo=new Map,this.attributesBound=!1}getArtifact(tt){return this.repo.get(tt)}setArtifact(tt,it){this.repo.set(tt,it)}run(tt,it,st){var ot;this.profiler.event("op",`ProgramManager.run ${(ot=tt.programInfo.name)!==null&&ot!==void 0?ot:"unknown kernel"}`,(()=>{var rt;const nt=this.glContext.gl,at=tt.program;nt.useProgram(at);try{this.bindOutput(st),this.attributesBound||this.bindAttributes(tt.attribLocations),this.bindUniforms(tt.uniformLocations,(rt=tt.programInfo.variables)!==null&&rt!==void 0?rt:[],it)}catch(ct){throw ne.Logger.error("ProgramManager",tt.programInfo.shaderSource),ct}this.profiler.event("backend","GlContext.draw()",(()=>{this.glContext.draw()}))}),this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach((tt=>this.glContext.deleteProgram(tt.program)))}build(tt,it,st){return this.profiler.event("backend","ProgramManager.build",(()=>{const ot=new xe.GlslPreprocessor(this.glContext,tt,it,st),rt=ot.preprocess(),nt=this.compile(rt);return{programInfo:tt,program:nt,uniformLocations:this.getUniformLocations(nt,ot.context.programInfo.inputNames,ot.context.programInfo.variables),attribLocations:this.getAttribLocations(nt)}}))}compile(tt){if(!this.vertexShader){ne.Logger.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");const ot=(0,et.getVertexShaderSource)(this.glContext.version);this.vertexShader=this.glContext.compileShader(ot,this.glContext.gl.VERTEX_SHADER)}te.env.debug&&ne.Logger.verbose("ProrgramManager",`FragShader:
${tt}
`);const it=this.glContext.compileShader(tt,this.glContext.gl.FRAGMENT_SHADER),st=this.glContext.createProgram(this.vertexShader,it);return this.glContext.deleteShader(it),st}bindOutput(tt){const it=tt.width,st=tt.height;ne.Logger.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${it}/${st}, shape=${tt.shape}, type=${tt.tensor.type}`),this.glContext.attachFramebuffer(tt.texture,it,st)}bindAttributes(tt){const it=tt.position,st=tt.textureCoord;this.glContext.setVertexAttributes(it,st),this.attributesBound=!0}bindUniforms(tt,it,st){var ot;const rt=this.glContext.gl;let nt=0;for(const{name:at,type:ct,location:ut,arrayLength:dt}of tt){const ht=(ot=it.find((pt=>pt.name===at)))===null||ot===void 0?void 0:ot.data;if(ct!=="sampler2D"&&!ht)throw new Error(`variable '${at}' does not have data defined in program info`);switch(ct){case"sampler2D":this.bindTexture(st[nt],ut,nt),nt++;break;case"float":dt?rt.uniform1fv(ut,ht):rt.uniform1f(ut,ht);break;case"int":dt?rt.uniform1iv(ut,ht):rt.uniform1i(ut,ht);break;default:throw new Error(`Uniform not implemented: ${ct}`)}}}bindTexture(tt,it,st){this.glContext.bindTextureToUniform(tt.texture,st,it)}getAttribLocations(tt){return{position:this.getAttribLocation(tt,"position"),textureCoord:this.getAttribLocation(tt,"textureCoord")}}getUniformLocations(tt,it,st){const ot=[];if(it)for(const rt of it)ot.push({name:rt,type:"sampler2D",location:this.getUniformLocation(tt,rt)});if(st)for(const rt of st)ot.push(Object.assign(Object.assign({},rt),{location:this.getUniformLocation(tt,rt.name)}));return ot}getUniformLocation(tt,it){const st=this.glContext.gl.getUniformLocation(tt,it);if(st===null)throw new Error(`Uniform ${it} not found.`);return st}getAttribLocation(tt,it){return this.glContext.gl.getAttribLocation(tt,it)}}},6416:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.WebGLSessionHandler=void 0;const te=Y(6231),ne=Y(1047),xe=Y(8316),et=Y(1640),tt=Y(1958),it=Y(7859),st=Y(5702);O.WebGLSessionHandler=class{constructor(ot,rt){this.backend=ot,this.context=rt,this.layoutStrategy=new it.PreferLogicalStrategy(ot.glContext.maxTextureSize),this.programManager=new tt.ProgramManager(this.context.profiler,ot.glContext,this.layoutStrategy),this.textureManager=new st.TextureManager(ot.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:ot.textureCacheMode==="full"}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=ot.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new xe.WebGLInferenceHandler(this)}onGraphInitialized(ot){const rt=ot.getValues().filter((nt=>nt.from===-1&&nt.tensor)).map((nt=>nt.tensor.dataId));this.initializers=new Set(rt)}isInitializer(ot){return!!this.initializers&&this.initializers.has(ot)}addInitializer(ot){this.initializers.add(ot)}getTextureData(ot,rt){return rt?this.packedTextureDataCache.get(ot):this.unpackedTextureDataCache.get(ot)}setTextureData(ot,rt,nt=!1){te.Logger.verbose("WebGLSessionHandler","Storing Texture data in cache"),nt?this.packedTextureDataCache.set(ot,rt):this.unpackedTextureDataCache.set(ot,rt)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach((ot=>this.textureManager.releaseTexture(ot,!0))),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach((ot=>this.textureManager.releaseTexture(ot,!0))),this.unpackedTextureDataCache=new Map}resolve(ot,rt,nt){const at=(0,ne.resolveOperator)(ot,rt,et.WEBGL_OP_RESOLVE_RULES);return{impl:at.opImpl,context:at.opInit?at.opInit(ot,nt):ot}}}},7769:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.Uint8DataEncoder=O.RGBAFloatDataEncoder=O.RedFloat32DataEncoder=void 0;const te=Y(6231);O.RedFloat32DataEncoder=class{constructor(ne,xe=1){if(xe===1)this.internalFormat=ne.R32F,this.format=ne.RED,this.textureType=ne.FLOAT,this.channelSize=xe;else{if(xe!==4)throw new Error(`Invalid number of channels: ${xe}`);this.internalFormat=ne.RGBA32F,this.format=ne.RGBA,this.textureType=ne.FLOAT,this.channelSize=xe}}encode(ne,xe){let et,tt;return ne.constructor!==Float32Array&&(te.Logger.warning("Encoder","data was not of type Float32; creating new Float32Array"),tt=new Float32Array(ne)),xe*this.channelSize>ne.length?(te.Logger.warning("Encoder","Source data too small. Allocating larger array"),tt=ne,et=this.allocate(xe*this.channelSize),tt.forEach(((it,st)=>et[st]=it))):(tt=ne,et=tt),et}allocate(ne){return new Float32Array(4*ne)}decode(ne,xe){return this.channelSize===1?ne.filter(((et,tt)=>tt%4==0)).subarray(0,xe):ne.subarray(0,xe)}},O.RGBAFloatDataEncoder=class{constructor(ne,xe=1,et){if(xe!==1&&xe!==4)throw new Error(`Invalid number of channels: ${xe}`);this.internalFormat=ne.RGBA,this.format=ne.RGBA,this.channelSize=xe,this.textureType=et||ne.FLOAT}encode(ne,xe){let et=ne;return this.channelSize===1&&(te.Logger.verbose("Encoder","Exploding into a larger array"),et=this.allocate(xe),ne.forEach(((tt,it)=>et[4*it]=tt))),et}allocate(ne){return new Float32Array(4*ne)}decode(ne,xe){return this.channelSize===1?ne.filter(((et,tt)=>tt%4==0)).subarray(0,xe):ne.subarray(0,xe)}},O.Uint8DataEncoder=class{constructor(ne,xe=1){if(this.channelSize=4,xe===1)this.internalFormat=ne.ALPHA,this.format=ne.ALPHA,this.textureType=ne.UNSIGNED_BYTE,this.channelSize=xe;else{if(xe!==4)throw new Error(`Invalid number of channels: ${xe}`);this.internalFormat=ne.RGBA,this.format=ne.RGBA,this.textureType=ne.UNSIGNED_BYTE,this.channelSize=xe}}encode(ne,xe){return new Uint8Array(ne.buffer,ne.byteOffset,ne.byteLength)}allocate(ne){return new Uint8Array(ne*this.channelSize)}decode(ne,xe){if(ne instanceof Uint8Array)return ne.subarray(0,xe);throw new Error(`Invalid array type: ${ne.constructor}`)}}},7859:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.getBatchDim=O.sizeToSquarishShape=O.getRowsCols=O.sizeFromShape=O.isInt=O.parseAxisParam=O.squeezeShape=O.PreferLogicalStrategy=O.AlwaysKeepOriginalSizeStrategy=void 0;const te=Y(6231),ne=Y(2517);function xe(ot,rt){const nt=[],at=[],ct=rt!=null&&Array.isArray(rt)&&rt.length===0,ut=rt==null||ct?null:et(rt,ot).sort();let dt=0;for(let ht=0;ht<ot.length;++ht){if(ut!=null){if(ut[dt]===ht&&ot[ht]!==1)throw new Error(`Can't squeeze axis ${ht} since its dim '${ot[ht]}' is not 1`);(ut[dt]==null||ut[dt]>ht)&&ot[ht]===1&&(nt.push(ot[ht]),at.push(ht)),ut[dt]<=ht&&dt++}ot[ht]!==1&&(nt.push(ot[ht]),at.push(ht))}return{newShape:nt,keptDims:at}}function et(ot,rt){const nt=rt.length;return ot=ot==null?rt.map(((at,ct)=>ct)):[].concat(ot),(0,ne.assert)(ot.every((at=>at>=-nt&&at<nt)),(()=>`All values in axis param must be in range [-${nt}, ${nt}) but got axis ${ot}`)),(0,ne.assert)(ot.every(tt),(()=>`All values in axis param must be integers but got axis ${ot}`)),ot.map((at=>at<0?nt+at:at))}function tt(ot){return ot%1==0}function it(ot){if(ot.length===0)return 1;let rt=ot[0];for(let nt=1;nt<ot.length;nt++)rt*=ot[nt];return rt}function st(ot){const rt=Math.ceil(Math.sqrt(ot));return[rt,Math.ceil(ot/rt)]}O.AlwaysKeepOriginalSizeStrategy=class{constructor(ot){this.maxTextureSize=ot}computeTextureWH(ot,rt){if(ot.length===0)return[1,1];const nt=this.maxTextureSize;if(rt&&rt.breakAxis!==void 0){const ut=rt.breakAxis>=ot.length?1:ot.slice(rt.breakAxis).reduce(((ht,pt)=>ht*pt)),dt=rt.breakAxis<=0?1:ot.slice(0,rt.breakAxis).reduce(((ht,pt)=>ht*pt));if(!(ut>nt||dt>nt))return[ut,dt];te.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${ot}, breakAxis:${rt.breakAxis}`)}const at=ot.reduce(((ut,dt)=>ut*dt));let ct=Math.floor(Math.sqrt(at));for(;ct<nt&&ct<at&&at%ct!=0;ct++);if(ct>=nt||at%ct!=0)throw new Error(`The given dimensions are outside this GPU's boundaries: ${ot}`);return[ct,at/ct]}},O.PreferLogicalStrategy=class{constructor(ot){this.maxTextureSize=ot}computeTextureWH(ot,rt){const nt=this.computeTexture(ot,rt);return rt&&rt.isPacked&&(nt[0]/=2,nt[1]/=2),rt&&rt.reverseWH?[nt[1],nt[0]]:nt}computeTexture(ot,rt){const nt=rt&&rt.isPacked;if(ot.length===0)return nt?[2,2]:[1,1];let at=this.maxTextureSize;if(rt&&rt.breakAxis!==void 0){const dt=rt.breakAxis>=ot.length?1:ot.slice(rt.breakAxis).reduce(((pt,ft)=>pt*ft)),ht=rt.breakAxis<=0?1:ot.slice(0,rt.breakAxis).reduce(((pt,ft)=>pt*ft));if(!(dt>at||ht>at))return[dt,ht];te.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${ot}, breakAxis:${rt.breakAxis}`)}let ct=ot.slice(0);nt&&(at*=2,ct=ct.map(((dt,ht)=>ht>=ct.length-2?ct[ht]%2==0?ct[ht]:ct[ht]+1:ct[ht])),ct.length===1&&(ct=[2,ct[0]])),ct.length!==2&&(ct=xe(ct).newShape);const ut=it(ct);return ct.length<=1&&ut<=at?[1,ut]:ct.length===2&&ct[0]<=at&&ct[1]<=at?ct:ct.length===3&&ct[0]*ct[1]<=at&&ct[2]<=at?[ct[0]*ct[1],ct[2]]:ct.length===3&&ct[0]<=at&&ct[1]*ct[2]<=at?[ct[0],ct[1]*ct[2]]:ct.length===4&&ct[0]*ct[1]*ct[2]<=at&&ct[3]<=at?[ct[0]*ct[1]*ct[2],ct[3]]:ct.length===4&&ct[0]<=at&&ct[1]*ct[2]*ct[3]<=at?[ct[0],ct[1]*ct[2]*ct[3]]:nt?st(ut/4).map((dt=>2*dt)):st(ut)}},O.squeezeShape=xe,O.parseAxisParam=et,O.isInt=tt,O.sizeFromShape=it,O.getRowsCols=function(ot){if(ot.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[ot.length>1?ot[ot.length-2]:1,ot[ot.length-1]]},O.sizeToSquarishShape=st,O.getBatchDim=function(ot,rt=2){return it(ot.slice(0,ot.length-rt))}},4057:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createTextureLayoutFromShape=O.calculateTextureWidthAndHeight=O.createTextureLayoutFromTextureType=void 0;const te=Y(2517),ne=Y(2039);O.createTextureLayoutFromTextureType=(xe,et,tt)=>{const it=tt===ne.TextureType.unpacked||tt===ne.TextureType.unpackedReversed?1:4,st=tt===ne.TextureType.packed,ot=tt===ne.TextureType.unpackedReversed||tt===ne.TextureType.packed,rt=tt===ne.TextureType.packedLastDimension?et.length-1:void 0,nt=tt===ne.TextureType.packedLastDimension?et.map(((at,ct)=>ct===et.length-1?4*at:at)):void 0;return(0,O.createTextureLayoutFromShape)(xe,et,it,nt,{isPacked:st,reverseWH:ot,breakAxis:rt})},O.calculateTextureWidthAndHeight=(xe,et,tt)=>{const it=(0,O.createTextureLayoutFromTextureType)(xe,et,tt);return[it.width,it.height]},O.createTextureLayoutFromShape=(xe,et,tt=1,it,st)=>{const ot=!(!st||!st.isPacked),[rt,nt]=xe.computeTextureWH(ot&&it||et,st),at=et.length;let ct=et.slice(0);if(at===0&&(ct=[1]),tt===1)it=et;else if(ot){if(tt!==4)throw new Error("a packed texture must be 4-channel");it=et,at>0&&(ct[at-1]=Math.ceil(ct[at-1]/2)),at>1&&(ct[at-2]=Math.ceil(ct[at-2]/2))}else if(!it)throw new Error("Unpacked shape is needed when using channels > 1");return{width:rt,height:nt,channels:tt,isPacked:ot,shape:ct,strides:te.ShapeUtil.computeStrides(ct),unpackedShape:it,reversedWH:st&&st.reverseWH}}},5702:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.TextureManager=void 0;const te=Y(6231);O.TextureManager=class{constructor(ne,xe,et,tt){this.glContext=ne,this.layoutStrategy=xe,this.profiler=et,this.config=tt,this.pendingRead=new Map,tt.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(ne,xe,et,tt){const it=this.toEncoderType(ne),st=this.glContext.getEncoder(it,xe.channels||1,tt);if(xe.isPacked&&tt===1)throw new Error("not implemented");const ot=xe.width,rt=xe.height;let nt,at;if(this.config.reuseTextures){nt=`${ot}x${rt}_${st.format}_${st.internalFormat}_${st.textureType}`,at=this.inUseTextures.get(nt),at||(at=[],this.inUseTextures.set(nt,at));const ut=this.idleTextures.get(nt);if(ut&&ut.length>0){const dt=ut.pop();return at.push(dt),tt===1&&this.glContext.updateTexture(dt,ot,rt,st,this.toTextureData(ne,et)),dt}}te.Logger.verbose("TextureManager",`Creating new texture of size ${xe.width}x${xe.height}`);const ct=this.glContext.allocateTexture(ot,rt,st,this.toTextureData(ne,et));return this.config.reuseTextures&&(at.push(ct),this.textureLookup.set(ct,nt)),ct}readTexture(ne,xe,et){return et||(et=1),this.profiler.event("backend","TextureManager.readTexture",(()=>{const tt=ne.shape.reduce(((st,ot)=>st*ot))*et,it=this.glContext.readTexture(ne.texture,ne.width,ne.height,tt,this.toEncoderType(xe),et);return this.toTensorData(xe,it)}))}async readTextureAsync(ne,xe,et){const tt=ne.tensor.dataId;if(et||(et=1),this.pendingRead.has(tt)){const it=this.pendingRead.get(tt);return new Promise((st=>it?.push(st)))}return this.profiler.event("backend","TextureManager.readTextureAsync",(async()=>{this.pendingRead.set(tt,[]);const it=ne.shape.reduce(((nt,at)=>nt*at))*et;await this.glContext.createAndWaitForFence();const st=this.glContext.readTexture(ne.texture,ne.width,ne.height,it,this.toEncoderType(xe),et),ot=this.toTensorData(xe,st),rt=this.pendingRead.get(tt);return this.pendingRead.delete(tt),rt?.forEach((nt=>nt(ot))),ot}))}readUint8TextureAsFloat(ne){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",(()=>{const xe=ne.shape.reduce(((tt,it)=>tt*it)),et=this.glContext.readTexture(ne.texture,ne.width,ne.height,4*xe,"byte",4);return new Float32Array(et.buffer,et.byteOffset,xe)}))}releaseTexture(ne,xe){let et;if(this.config.reuseTextures&&(et=this.textureLookup.get(ne.texture),et)){xe&&this.textureLookup.delete(et);const tt=this.inUseTextures.get(et);if(tt){const it=tt.indexOf(ne.texture);if(it!==-1){tt.splice(it,1);let st=this.idleTextures.get(et);st||(st=[],this.idleTextures.set(et,st)),st.push(ne.texture)}}}et&&!xe||(te.Logger.verbose("TextureManager",`Deleting texture of size ${ne.width}x${ne.height}`),this.glContext.deleteTexture(ne.texture))}toTensorData(ne,xe){switch(ne){case"int16":return xe instanceof Int16Array?xe:Int16Array.from(xe);case"int32":return xe instanceof Int32Array?xe:Int32Array.from(xe);case"int8":return xe instanceof Int8Array?xe:Int8Array.from(xe);case"uint16":return xe instanceof Uint16Array?xe:Uint16Array.from(xe);case"uint32":return xe instanceof Uint32Array?xe:Uint32Array.from(xe);case"uint8":case"bool":return xe instanceof Uint8Array?xe:Uint8Array.from(xe);case"float32":return xe instanceof Float32Array?xe:Float32Array.from(xe);case"float64":return xe instanceof Float64Array?xe:Float64Array.from(xe);default:throw new Error(`TensorData type ${ne} is not supported`)}}toTextureData(ne,xe){if(xe)return xe instanceof Float32Array?xe:new Float32Array(xe)}toEncoderType(ne){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}},2039:(ee,O)=>{var Y;Object.defineProperty(O,"__esModule",{value:!0}),O.TextureType=void 0,(Y=O.TextureType||(O.TextureType={}))[Y.unpacked=0]="unpacked",Y[Y.unpackedReversed=1]="unpackedReversed",Y[Y.packed=2]="packed",Y[Y.downloadUint8AsFloat=3]="downloadUint8AsFloat",Y[Y.packedLastDimension=4]="packedLastDimension"},9390:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.getGlChannels=O.getCoordsDataType=O.getSqueezedParams=O.squeezeInputShape=O.generateShaderFuncNameFromInputSamplerNameAtOutCoords=O.generateShaderFuncNameFromInputSamplerName=O.repeatedTry=O.getPackedShape=void 0;const te=Y(2517);O.getPackedShape=function(ne){const xe=ne.length;return ne.slice(0,xe-1).concat(ne[xe-1]/4)},O.repeatedTry=async function(ne,xe=(tt=>0),et){return new Promise(((tt,it)=>{let st=0;const ot=()=>{if(ne())return void tt();st++;const rt=xe(st);et!=null&&st>=et?it():setTimeout(ot,rt)};ot()}))},O.generateShaderFuncNameFromInputSamplerName=function(ne){return(0,te.assert)(ne!==void 0&&ne.length!==0,(()=>"empty string found for sampler name")),"get"+ne.charAt(0).toUpperCase()+ne.slice(1)},O.generateShaderFuncNameFromInputSamplerNameAtOutCoords=function(ne){return(0,te.assert)(ne!==void 0&&ne.length!==0,(()=>"empty string found for sampler name")),"get"+ne.charAt(0).toUpperCase()+ne.slice(1)+"AtOutCoords"},O.squeezeInputShape=function(ne,xe){let et=JSON.parse(JSON.stringify(ne));return et=xe,et},O.getSqueezedParams=function(ne,xe){return xe.map((et=>ne[et])).join(", ")},O.getCoordsDataType=function(ne){if(ne<=1)return"int";if(ne===2)return"ivec2";if(ne===3)return"ivec3";if(ne===4)return"ivec4";if(ne===5)return"ivec5";if(ne===6)return"ivec6";throw Error(`GPU for rank ${ne} is not yet supported`)},O.getGlChannels=function(ne=6){return["x","y","z","w","u","v"].slice(0,ne)}},7305:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.createNewWebGLContext=O.createWebGLContext=void 0;const te=Y(6231),ne=Y(1713),xe={};function et(tt){const it=(function(){if(typeof document>"u"){if(typeof OffscreenCanvas>"u")throw new TypeError("failed to create canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}const rt=document.createElement("canvas");return rt.width=1,rt.height=1,rt})();let st;const ot={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1};if((!tt||tt==="webgl2")&&(st=it.getContext("webgl2",ot),st))try{return new ne.WebGLContext(st,2)}catch(rt){te.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${rt}`)}if((!tt||tt==="webgl")&&(st=it.getContext("webgl",ot)||it.getContext("experimental-webgl",ot),st))try{return new ne.WebGLContext(st,1)}catch(rt){te.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${rt}`)}throw new Error("WebGL is not supported")}O.createWebGLContext=function tt(it){let st;it&&it!=="webgl2"||!("webgl2"in xe)?it&&it!=="webgl"||!("webgl"in xe)||(st=xe.webgl):st=xe.webgl2,st=st||et(it),it=it||st.version===1?"webgl":"webgl2";const ot=st.gl;return xe[it]=st,ot.isContextLost()?(delete xe[it],tt(it)):(ot.disable(ot.DEPTH_TEST),ot.disable(ot.STENCIL_TEST),ot.disable(ot.BLEND),ot.disable(ot.DITHER),ot.disable(ot.POLYGON_OFFSET_FILL),ot.disable(ot.SAMPLE_COVERAGE),ot.enable(ot.SCISSOR_TEST),ot.enable(ot.CULL_FACE),ot.cullFace(ot.BACK),st)},O.createNewWebGLContext=et},1713:function(ee,O,Y){var te=this&&this.__createBinding||(Object.create?function(ot,rt,nt,at){at===void 0&&(at=nt);var ct=Object.getOwnPropertyDescriptor(rt,nt);ct&&!("get"in ct?!rt.__esModule:ct.writable||ct.configurable)||(ct={enumerable:!0,get:function(){return rt[nt]}}),Object.defineProperty(ot,at,ct)}:function(ot,rt,nt,at){at===void 0&&(at=nt),ot[at]=rt[nt]}),ne=this&&this.__setModuleDefault||(Object.create?function(ot,rt){Object.defineProperty(ot,"default",{enumerable:!0,value:rt})}:function(ot,rt){ot.default=rt}),xe=this&&this.__importStar||function(ot){if(ot&&ot.__esModule)return ot;var rt={};if(ot!=null)for(var nt in ot)nt!=="default"&&Object.prototype.hasOwnProperty.call(ot,nt)&&te(rt,ot,nt);return ne(rt,ot),rt};Object.defineProperty(O,"__esModule",{value:!0}),O.WebGLContext=O.linearSearchLastTrue=void 0;const et=Y(1670),tt=xe(Y(7769)),it=Y(9390);function st(ot){let rt=0;for(;rt<ot.length&&ot[rt]();++rt);return rt-1}O.linearSearchLastTrue=st,O.WebGLContext=class{constructor(ot,rt){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=ot,this.version=rt,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(ot,rt,nt,at){const ct=this.gl,ut=ct.createTexture();ct.bindTexture(ct.TEXTURE_2D,ut),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_MIN_FILTER,ct.NEAREST),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_MAG_FILTER,ct.NEAREST),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_WRAP_S,ct.CLAMP_TO_EDGE),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_WRAP_T,ct.CLAMP_TO_EDGE);const dt=at?nt.encode(at,ot*rt):null;return ct.texImage2D(ct.TEXTURE_2D,0,nt.internalFormat,ot,rt,0,nt.format,nt.textureType,dt),this.checkError(),ut}updateTexture(ot,rt,nt,at,ct){const ut=this.gl;ut.bindTexture(ut.TEXTURE_2D,ot);const dt=at.encode(ct,rt*nt);ut.texSubImage2D(ut.TEXTURE_2D,0,0,0,rt,nt,at.format,at.textureType,dt),this.checkError()}attachFramebuffer(ot,rt,nt){const at=this.gl;at.bindTexture(at.TEXTURE_2D,ot),at.bindFramebuffer(at.FRAMEBUFFER,this.framebuffer),at.framebufferTexture2D(at.FRAMEBUFFER,at.COLOR_ATTACHMENT0,at.TEXTURE_2D,ot,0),this.checkError(),at.viewport(0,0,rt,nt),at.scissor(0,0,rt,nt)}readTexture(ot,rt,nt,at,ct,ut){const dt=this.gl;ut||(ut=1),this.frameBufferBound||this.attachFramebuffer(ot,rt,nt);const ht=this.getEncoder(ct,ut),pt=ht.allocate(rt*nt);return dt.bindTexture(dt.TEXTURE_2D,ot),dt.framebufferTexture2D(dt.FRAMEBUFFER,dt.COLOR_ATTACHMENT0,dt.TEXTURE_2D,ot,0),dt.readPixels(0,0,rt,nt,dt.RGBA,ht.textureType,pt),this.checkError(),ht.decode(pt,at)}isFramebufferReady(){return!0}getActiveTexture(){const ot=this.gl;return"TEXTURE"+(ot.getParameter(this.gl.ACTIVE_TEXTURE)-ot.TEXTURE0)}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(ot,rt){const nt=this.gl;nt.vertexAttribPointer(ot,3,nt.FLOAT,!1,20,0),nt.enableVertexAttribArray(ot),rt!==-1&&(nt.vertexAttribPointer(rt,2,nt.FLOAT,!1,20,12),nt.enableVertexAttribArray(rt)),this.checkError()}createProgram(ot,rt){const nt=this.gl,at=nt.createProgram();return nt.attachShader(at,ot),nt.attachShader(at,rt),nt.linkProgram(at),at}compileShader(ot,rt){const nt=this.gl,at=nt.createShader(rt);if(!at)throw new Error(`createShader() returned null with type ${rt}`);if(nt.shaderSource(at,ot),nt.compileShader(at),nt.getShaderParameter(at,nt.COMPILE_STATUS)===!1)throw new Error(`Failed to compile shader: ${nt.getShaderInfoLog(at)}
Shader source:
${ot}`);return at}deleteShader(ot){this.gl.deleteShader(ot)}bindTextureToUniform(ot,rt,nt){const at=this.gl;at.activeTexture(at.TEXTURE0+rt),this.checkError(),at.bindTexture(at.TEXTURE_2D,ot),this.checkError(),at.uniform1i(nt,rt),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if(et.env.debug){const ot=this.gl,rt=ot.getError();let nt="";switch(rt){case ot.NO_ERROR:return;case ot.INVALID_ENUM:nt="INVALID_ENUM";break;case ot.INVALID_VALUE:nt="INVALID_VALUE";break;case ot.INVALID_OPERATION:nt="INVALID_OPERATION";break;case ot.INVALID_FRAMEBUFFER_OPERATION:nt="INVALID_FRAMEBUFFER_OPERATION";break;case ot.OUT_OF_MEMORY:nt="OUT_OF_MEMORY";break;case ot.CONTEXT_LOST_WEBGL:nt="CONTEXT_LOST_WEBGL";break;default:nt=`Unknown WebGL Error: ${rt.toString(16)}`}throw new Error(nt)}}deleteTexture(ot){this.gl.deleteTexture(ot)}deleteProgram(ot){this.gl.deleteProgram(ot)}getEncoder(ot,rt,nt=0){if(this.version===2)return new tt.RedFloat32DataEncoder(this.gl,rt);switch(ot){case"float":return nt===1||this.isRenderFloat32Supported?new tt.RGBAFloatDataEncoder(this.gl,rt):new tt.RGBAFloatDataEncoder(this.gl,rt,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw new Error("not implemented");case"byte":return new tt.Uint8DataEncoder(this.gl,rt);default:throw new Error(`Invalid dataType: ${ot}`)}}clearActiveTextures(){const ot=this.gl;for(let rt=0;rt<this.maxTextureImageUnits;++rt)ot.activeTexture(ot.TEXTURE0+rt),ot.bindTexture(ot.TEXTURE_2D,null)}dispose(){if(this.disposed)return;const ot=this.gl;ot.bindFramebuffer(ot.FRAMEBUFFER,null),ot.deleteFramebuffer(this.framebuffer),ot.bindBuffer(ot.ARRAY_BUFFER,null),ot.deleteBuffer(this.vertexbuffer),ot.bindBuffer(ot.ELEMENT_ARRAY_BUFFER,null),ot.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){const ot=this.gl,rt=ot.createBuffer();if(!rt)throw new Error("createBuffer() returned null");const nt=this.createDefaultGeometry();return ot.bindBuffer(ot.ARRAY_BUFFER,rt),ot.bufferData(ot.ARRAY_BUFFER,nt,ot.STATIC_DRAW),this.checkError(),rt}createFramebuffer(){const ot=this.gl.createFramebuffer();if(!ot)throw new Error("createFramebuffer returned null");return ot}queryVitalParameters(){const ot=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),this.version===1&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw new Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=ot.getParameter(ot.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=ot.getParameter(ot.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){this.version===2?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){const ot=this.gl,rt=ot.createTexture();ot.bindTexture(ot.TEXTURE_2D,rt);const nt=this.version===2?ot.RGBA32F:ot.RGBA;ot.texImage2D(ot.TEXTURE_2D,0,nt,1,1,0,ot.RGBA,ot.FLOAT,null);const at=ot.createFramebuffer();ot.bindFramebuffer(ot.FRAMEBUFFER,at),ot.framebufferTexture2D(ot.FRAMEBUFFER,ot.COLOR_ATTACHMENT0,ot.TEXTURE_2D,rt,0);const ct=ot.checkFramebufferStatus(ot.FRAMEBUFFER)===ot.FRAMEBUFFER_COMPLETE;return ot.bindTexture(ot.TEXTURE_2D,null),ot.bindFramebuffer(ot.FRAMEBUFFER,null),ot.deleteTexture(rt),ot.deleteFramebuffer(at),ct}checkRenderFloat32(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(this.version===2){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){const ot=this.gl;let rt,nt,at,ct,ut;try{rt=ot.createTexture(),nt=ot.createFramebuffer(),ot.bindTexture(ot.TEXTURE_2D,rt);const dt=this.version===2?ot.RGBA32F:ot.RGBA;return ot.texImage2D(ot.TEXTURE_2D,0,dt,1,1,0,ot.RGBA,ot.FLOAT,null),ot.bindFramebuffer(ot.FRAMEBUFFER,nt),ot.framebufferTexture2D(ot.FRAMEBUFFER,ot.COLOR_ATTACHMENT0,ot.TEXTURE_2D,rt,0),ot.enable(ot.BLEND),at=ot.createShader(ot.VERTEX_SHADER),!!at&&(ot.shaderSource(at,"void main(){}"),ot.compileShader(at),ct=ot.createShader(ot.FRAGMENT_SHADER),!!ct&&(ot.shaderSource(ct,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),ot.compileShader(ct),ut=ot.createProgram(),!!ut&&(ot.attachShader(ut,at),ot.attachShader(ut,ct),ot.linkProgram(ut),ot.useProgram(ut),ot.drawArrays(ot.POINTS,0,1),ot.getError()===ot.NO_ERROR)))}finally{ot.disable(ot.BLEND),ut&&ot.deleteProgram(ut),at&&ot.deleteShader(at),ct&&ot.deleteShader(ct),nt&&(ot.bindFramebuffer(ot.FRAMEBUFFER,null),ot.deleteFramebuffer(nt)),rt&&(ot.bindTexture(ot.TEXTURE_2D,null),ot.deleteTexture(rt))}}beginTimer(){if(this.version===2&&this.disjointTimerQueryWebgl2Extension){const ot=this.gl,rt=this.disjointTimerQueryWebgl2Extension,nt=ot.createQuery();return ot.beginQuery(rt.TIME_ELAPSED_EXT,nt),nt}throw new Error("WebGL1 profiling currently not supported.")}endTimer(){if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{const ot=this.gl,rt=this.disjointTimerQueryWebgl2Extension;ot.endQuery(rt.TIME_ELAPSED_EXT)}}isTimerResultAvailable(ot){let rt=!1,nt=!1;if(this.version!==2||!this.disjointTimerQueryWebgl2Extension)throw new Error("WebGL1 profiling currently not supported");{const at=this.gl,ct=this.disjointTimerQueryWebgl2Extension;rt=at.getQueryParameter(ot,at.QUERY_RESULT_AVAILABLE),nt=at.getParameter(ct.GPU_DISJOINT_EXT)}return rt&&!nt}getTimerResult(ot){let rt=0;if(this.version!==2)throw new Error("WebGL1 profiling currently not supported");{const nt=this.gl;rt=nt.getQueryParameter(ot,nt.QUERY_RESULT),nt.deleteQuery(ot)}return rt/1e6}async waitForQueryAndGetTime(ot){return await(0,it.repeatedTry)((()=>this.isTimerResultAvailable(ot))),this.getTimerResult(ot)}async createAndWaitForFence(){const ot=this.createFence(this.gl);return this.pollFence(ot)}createFence(ot){let rt;const nt=ot,at=nt.fenceSync(nt.SYNC_GPU_COMMANDS_COMPLETE,0);return ot.flush(),rt=at===null?()=>!0:()=>{const ct=nt.clientWaitSync(at,0,0);return ct===nt.ALREADY_SIGNALED||ct===nt.CONDITION_SATISFIED},{query:at,isFencePassed:rt}}async pollFence(ot){return new Promise((rt=>{this.addItemToPoll((()=>ot.isFencePassed()),(()=>rt()))}))}pollItems(){const ot=st(this.itemsToPoll.map((rt=>rt.isDoneFn)));for(let rt=0;rt<=ot;++rt){const{resolveFn:nt}=this.itemsToPoll[rt];nt()}this.itemsToPoll=this.itemsToPoll.slice(ot+1)}async addItemToPoll(ot,rt){this.itemsToPoll.push({isDoneFn:ot,resolveFn:rt}),this.itemsToPoll.length>1||await(0,it.repeatedTry)((()=>(this.pollItems(),this.itemsToPoll.length===0)))}}},1036:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.ExecutionPlan=void 0;const te=Y(6231);class ne{constructor(et,tt){this.op=et,this.node=tt}}O.ExecutionPlan=class{constructor(xe,et,tt){this.graph=xe,this.profiler=tt,this.initialize(et)}initialize(xe){this.profiler.event("session","ExecutionPlan.initialize",(()=>{const et=this.graph.getNodes();if(et.length!==xe.length)throw new Error("The size of nodes and OPs do not match.");this._ops=xe.map(((tt,it)=>new ne(tt,et[it]))),this.reset(),this._starter=[],this._ops.forEach(((tt,it)=>{let st=!0;for(const ot of tt.node.inputs)if(!this._values[ot]&&this.graph.getInputIndices().indexOf(ot)===-1){st=!1;break}st&&this._starter.push(it)}))}))}reset(){this._values=this.graph.getValues().map((xe=>xe.tensor))}async execute(xe,et){return this.profiler.event("session","ExecutionPlan.execute",(async()=>{this.reset();const tt=xe.createInferenceHandler(),it=this.graph.getInputIndices();if(et.length!==it.length)throw new Error(`number of input tensors don't match the number of inputs to the model: actual: ${et.length} expected: ${it.length}`);et.forEach(((ct,ut)=>{const dt=it[ut];this._values[dt]=ct}));const st=this._starter.slice(0),ot=this.graph.getValues(),rt=this.graph.getNodes();let nt=0;for(;nt<st.length;){const ct=st[nt++],ut=this._ops[ct],dt=ut.node.inputs.map((mt=>this._values[mt]));if(dt.indexOf(void 0)!==-1)throw new Error(`unresolved input detected: op: ${ut.node}`);const ht=dt;te.Logger.verbose("ExecPlan",`Runing op:${ut.node.name} (${ht.map(((mt,yt)=>`'${ut.node.inputs[yt]}': ${mt.type}[${mt.dims.join(",")}]`)).join(", ")})`);const pt=await this.profiler.event("node",ut.node.name,(async()=>ut.op.impl(tt,ht,ut.op.context)));if(pt.length!==ut.node.outputs.length)throw new Error("the size of output does not match model definition.");pt.forEach(((mt,yt)=>{const bt=ut.node.outputs[yt];if(this._values[bt])throw new Error(`output [${bt}] already has value: op:${ut.node.name}`);this._values[bt]=mt}));const ft=new Set;pt.forEach(((mt,yt)=>{const bt=ut.node.outputs[yt];for(const vt of ot[bt].to){const Et=rt[vt];let wt=!0;for(const St of Et.inputs)if(!this._values[St]){wt=!1;break}wt&&ft.add(vt)}})),st.push(...ft)}const at=[];for(let ct=0;ct<this.graph.getOutputIndices().length;ct++){const ut=this.graph.getOutputIndices()[ct],dt=this._values[ut];if(dt===void 0)throw new Error(`required output [${ut}] does not have value`);ut===0?await dt.getData():dt.data,at.push(dt)}return te.Logger.verbose("ExecPlan","disposing of inferenceHandler"),tt.dispose(),at}))}}},7070:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.Graph=void 0;const te=Y(1446),ne=Y(7778),xe=Y(9395),et=Y(9162),tt=Y(2517);var it=xe.onnxruntime.experimental.fbs;O.Graph={from:(nt,at)=>new rt(nt,at)};class st{constructor(at){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,at&&(this.type=tt.ProtoUtil.tensorValueTypeFromProto(at.type.tensorType))}get from(){return this._from}get to(){return this._to}}class ot{constructor(at,ct){at instanceof te.onnx.NodeProto?(this.name=at.name,this.opType=at.opType,this.attributes=new ne.Attribute(at.attribute)):at instanceof it.Node&&(this.name=ct??at.name(),this.opType=at.opType(),this.attributes=new ne.Attribute(tt.ProtoUtil.tensorAttributesFromORTFormat(at))),this.inputs=[],this.outputs=[],this.executeNode=!0}}class rt{constructor(at,ct){if(!at)throw new TypeError("graph is empty");this.buildGraph(at),this.transformGraph(ct),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(at){if(at instanceof te.onnx.GraphProto)this.buildGraphFromOnnxFormat(at);else{if(!(at instanceof it.Graph))throw new TypeError("Graph type is not supported.");this.buildGraphFromOrtFormat(at)}}buildGraphFromOnnxFormat(at){const ct=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];const ut=new Map;if(!at.input)throw new Error("missing information in graph: input");const dt=[];for(const ht of at.input){if(ct.has(ht.name))throw new Error(`duplicated input name: ${ht.name}`);const pt=this._allData.push(new st(ht))-1;ct.set(ht.name,pt),dt.push(ht.name)}if(!at.initializer)throw new Error("missing information in graph: initializer");for(const ht of at.initializer){let pt=ct.get(ht.name);if(pt===void 0){const ft=new st;ft.type={shape:{dims:tt.ProtoUtil.tensorDimsFromProto(ht.dims)},tensorType:tt.ProtoUtil.tensorDataTypeFromProto(ht.dataType)},pt=this._allData.push(ft)-1,ct.set(ht.name,pt)}this._allData[pt]._from=-1,this._allData[pt].tensor=et.Tensor.fromProto(ht)}for(let ht=0;ht<this._allData.length;ht++)this._allData[ht].tensor||(this._allInputIndices.push(ht),this._allInputNames.push(dt[ht]));if(!at.output)throw new Error("missing information in graph: output");for(const ht of at.output){if(ct.has(ht.name))throw new Error(`duplicated output name: ${ht.name}`);const pt=this._allData.push(new st(ht))-1;ct.set(ht.name,pt),this._allOutputIndices.push(pt),this._allOutputNames.push(ht.name)}if(!at.node)throw new Error("missing information in graph: node");for(const ht of at.node){if(!ht.name)for(let ft=0;;ft++){const mt=`unnamed_${ht.opType}_${ft}`;if(!ut.has(mt)){ht.name=mt;break}}if(ut.has(ht.name))throw new Error(`duplicated node name: ${ht.name}`);const pt=this._nodes.push(new ot(ht))-1;ut.set(ht.name,pt)}for(let ht=0;ht<this._nodes.length;ht++){const pt=this._nodes[ht],ft=at.node[ht];if(!ft.output)throw new Error(`missing output for node: ${ft.name}`);for(const mt of ft.output){let yt=ct.get(mt);if(yt===void 0&&(yt=this._allData.push(new st)-1,ct.set(mt,yt)),pt.outputs.push(yt),this._allData[yt]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${yt}`);if(this._allData[yt]._from=ht,ft.opType==="Constant"){if(!ft.attribute||ft.attribute.length!==1||!ft.attribute[0].t)throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!ft.output||ft.output.length!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");pt.outputs.pop(),pt.executeNode=!1,this._allData[yt]._from=-1,this._allData[yt].tensor=et.Tensor.fromProto(ft.attribute[0].t)}}}for(let ht=0;ht<this._nodes.length;ht++){const pt=this._nodes[ht],ft=at.node[ht];if(!ft.input)throw new Error(`missing input for node: ${ft.name}`);for(const mt of ft.input){const yt=ct.get(mt);if(yt===void 0){if(mt===""&&ft.input.length===3&&ft.opType==="Resize")continue;throw new Error(`unrecognized input '${mt}' for node: ${ft.name}`)}pt.inputs.push(yt),this._allData[yt]._to.push(ht)}}return!0}buildGraphFromOrtFormat(at){var ct,ut,dt;const ht=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];const pt=new Map,ft=[];for(let mt=0;mt<at.inputsLength();mt++){const yt=at.inputs(mt);if(ht.has(yt))throw new Error(`duplicated input name: ${yt}`);for(let bt=0;bt<at.nodeArgsLength();bt++)if(((ct=at.nodeArgs(bt))===null||ct===void 0?void 0:ct.name())===yt){const vt=new st;if(((dt=(ut=at.nodeArgs(bt))===null||ut===void 0?void 0:ut.type())===null||dt===void 0?void 0:dt.valueType())!==it.TypeInfoValue.tensor_type)throw new Error("Unexpected value type for the nodeArg.");const Et=at.nodeArgs(bt).type().value(new it.TensorTypeAndShape),wt=tt.ProtoUtil.tensorDataTypeFromProto(Et.elemType()),St=Et.shape(),Ot=[];for(let Mt=0;Mt<St.dimLength();Mt++)Ot.push(tt.LongUtil.longToNumber(St.dim(Mt).value().dimValue()));vt.type={shape:{dims:Ot},tensorType:wt};const $t=this._allData.push(vt)-1;ht.set(yt,$t),ft.push(yt)}}for(let mt=0;mt<at.initializersLength();mt++){const yt=at.initializers(mt);let bt=ht.get(yt.name());if(bt===void 0){const vt=new st,Et=tt.ProtoUtil.tensorDimsFromORTFormat(yt),wt=tt.ProtoUtil.tensorDataTypeFromProto(yt.dataType());vt.type={shape:{dims:Et},tensorType:wt},bt=this._allData.push(vt)-1,ht.set(yt.name(),bt)}this._allData[bt]._from=-1,this._allData[bt].tensor=et.Tensor.fromOrtTensor(yt)}for(let mt=0;mt<this._allData.length;mt++)this._allData[mt].tensor||(this._allInputIndices.push(mt),this._allInputNames.push(ft[mt]));for(let mt=0;mt<at.outputsLength();mt++){const yt=at.outputs(mt);if(ht.has(yt))throw new Error(`duplicated output name: ${yt}`);const bt=this._allData.push(new st)-1;ht.set(yt,bt),this._allOutputIndices.push(bt),this._allOutputNames.push(yt)}if(!at.nodes)throw new Error("missing information in graph: node");for(let mt=0;mt<at.nodesLength();mt++){const yt=at.nodes(mt);let bt=yt.name();if(!bt)for(let Et=0;bt=`unnamed_${yt.opType()}_${Et}`,pt.has(bt);Et++);if(pt.has(bt))throw new Error(`duplicated node name: ${bt}`);const vt=this._nodes.push(new ot(yt,bt))-1;pt.set(bt,vt)}for(let mt=0;mt<this._nodes.length;mt++){const yt=this._nodes[mt],bt=at.nodes(mt);if(bt==null)throw new Error(`No node exists at index ${mt}`);if(bt?.outputsLength()===0)throw new Error(`missing output for node: ${bt.name}`);for(let vt=0;vt<bt?.outputsLength();vt++){const Et=bt?.outputs(vt);let wt=ht.get(Et);if(wt===void 0&&(wt=this._allData.push(new st)-1,ht.set(Et,wt)),yt.outputs.push(wt),this._allData[wt]._from!==void 0)throw new Error(`multiple nodes output to one data value: ${wt}`);if(this._allData[wt]._from=mt,bt.opType()==="Constant"){if(bt.attributesLength()!==1||!bt.attributes(0).t())throw new Error("missing attributes or missing tensor value in attributes for this Constant operator");if(bt.outputsLength()!==1)throw new Error("missing output or incorrect number of outputs for this Constant operator");yt.outputs.pop(),yt.executeNode=!1,this._allData[wt]._from=-1,this._allData[wt].tensor=et.Tensor.fromOrtTensor(bt.attributes(0).t())}}}for(let mt=0;mt<this._nodes.length;mt++){const yt=this._nodes[mt],bt=at.nodes(mt);if(bt.inputsLength()===0)throw new Error(`missing input for node: ${bt.name}`);for(let vt=0;vt<bt.inputsLength();vt++){const Et=bt.inputs(vt),wt=ht.get(Et);if(wt===void 0)throw new Error(`unrecognized input '${Et}' for node: ${bt.name()}`);yt.inputs.push(wt),this._allData[wt]._to.push(mt)}}}checkIsAcyclic(){const at=new Set;this._allInputIndices.forEach((dt=>{this._allData[dt]._to.forEach((ht=>{at.add(ht)}))}));const ct=Array.from(at),ut=new Array(this._nodes.length).fill("white");for(;ct.length>0;){const dt=ct.pop();ut[dt]==="gray"?ut[dt]="black":(ct.push(dt),ut[dt]="gray",this._nodes[dt].outputs.forEach((ht=>{const pt=this._allData[ht];if(pt.tensor!==void 0)throw new Error("node outputs should not be initialized");if(pt._from!==dt)throw new Error("from property of the Value object doesn't match index of Node being processed");pt._to.forEach((ft=>{if(ut[ft]==="gray")throw new Error("model graph is cyclic");ut[ft]==="white"&&ct.push(ft)}))})))}}transformGraph(at){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),at&&at.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let at=0;for(let ct=0;ct<this._nodes.length;ct++)this._nodes[ct].executeNode?at>0&&(this._nodes[ct].inputs.forEach((ut=>{const dt=this._allData[ut]._to.indexOf(ct+at);dt!==-1&&(this._allData[ut]._to[dt]=ct)})),this._nodes[ct].outputs.forEach((ut=>{this._allData[ut]._from&&this._allData[ut]._from===ct+at&&(this._allData[ut]._from=ct)}))):(at++,this._nodes[ct].outputs.forEach((ut=>{this._allData[ut]._from=-2})),this._nodes.splice(ct,1),ct--);at=0;for(let ct=0;ct<this._allData.length;ct++)if(this._allData[ct].from!==-2||this._allOutputIndices.indexOf(ct+at)!==-1){if(at>0){let ut=-1;this._allData[ct].from!==void 0&&this._allData[ct].from!==-1?(ut=this._nodes[this._allData[ct].from].outputs.indexOf(ct+at),ut!==-1&&(this._nodes[this._allData[ct].from].outputs[ut]=ct)):(ut=this._allInputIndices.indexOf(ct+at),ut!==-1&&(this._allInputIndices[ut]=ct)),this._allData[ct].to.forEach((dt=>{ut=this._nodes[dt].inputs.indexOf(ct+at),ut!==-1&&(this._nodes[dt].inputs[ut]=ct)})),this._allData[ct].to.length===0&&(ut=this._allOutputIndices.indexOf(ct+at),ut!==-1&&(this._allOutputIndices[ut]=ct))}}else at++,this._allData.splice(ct,1),ct--}deleteNode(at){const ct=this._nodes[at];if(ct.outputs.length>1){for(let mt=1;mt<ct.outputs.length;mt++)if(this._allData[ct.outputs[mt]].to.length>0)throw new Error("Node deletion with more than one output connected to other nodes is not supported. ")}ct.executeNode=!1;const ut=ct.inputs[0],dt=ct.outputs[0],ht=this._allData[dt].to,pt=this._allData[ut].to.indexOf(at);if(pt===-1)throw new Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[ut].to.splice(pt,1),this._allData[dt]._to=[];const ft=this._allOutputIndices.indexOf(dt);if(ft!==-1&&(this._allOutputIndices[ft]=ut),ht&&ht.length>0)for(const mt of ht){const yt=this._nodes[mt].inputs.indexOf(dt);if(yt===-1)throw new Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[mt].inputs[yt]=ut,this._allData[ut].to.push(mt)}}removeAllDropoutNodes(){let at=0;for(const ct of this._nodes){if(ct.opType==="Dropout"){if(ct.inputs.length!==1)throw new Error("Dropout nodes should only contain one input. ");if(ct.outputs.length!==1&&ct.outputs.length!==2)throw new Error("Dropout nodes should contain either 1 or 2 output(s)");if(ct.outputs.length===2&&this._allData[ct.outputs[1]]._to.length!==0)throw new Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(at)}at++}}removeAllIdentityNodes(){let at=0;for(const ct of this._nodes)ct.opType==="Identity"&&this.deleteNode(at),at++}isActivation(at){switch(at.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(const at of this._nodes)if(at.opType==="Conv"){const ct=this._allData[at.outputs[0]]._to;if(ct.length===1&&this.isActivation(this._nodes[ct[0]])){const ut=this._nodes[ct[0]];if(ut.opType==="Clip")if(ut.inputs.length===1)try{at.attributes.set("activation_params","floats",[ut.attributes.getFloat("min"),ut.attributes.getFloat("max")])}catch{at.attributes.set("activation_params","floats",[tt.MIN_CLIP,tt.MAX_CLIP])}else{if(!(ut.inputs.length>=3&&this._allData[ut.inputs[1]].tensor!==void 0&&this._allData[ut.inputs[2]].tensor!==void 0))continue;at.attributes.set("activation_params","floats",[this._allData[ut.inputs[1]].tensor.floatData[0],this._allData[ut.inputs[2]].tensor.floatData[0]])}at.attributes.set("activation","string",ut.opType),this.deleteNode(ct[0])}}}}},6231:(ee,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.now=O.Profiler=O.Logger=void 0;const Y={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},te={none:new class{log(ot,rt,nt){}},console:new class{log(ot,rt,nt){console.log(`${this.color(ot)} ${nt?"\x1B[35m"+nt+"\x1B[0m ":""}${rt}`)}color(ot){switch(ot){case"verbose":return"\x1B[34;40mv\x1B[0m";case"info":return"\x1B[32mi\x1B[0m";case"warning":return"\x1B[30;43mw\x1B[0m";case"error":return"\x1B[31;40me\x1B[0m";case"fatal":return"\x1B[101mf\x1B[0m";default:throw new Error(`unsupported severity: ${ot}`)}}}},ne={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1};let xe={"":ne};function et(ot,rt,nt,at){if(rt===void 0)return ct=ot,{verbose:et.verbose.bind(null,ct),info:et.info.bind(null,ct),warning:et.warning.bind(null,ct),error:et.error.bind(null,ct),fatal:et.fatal.bind(null,ct)};if(nt===void 0)tt(ot,rt);else if(typeof nt=="number"&&at===void 0)tt(ot,rt);else if(typeof nt=="string"&&at===void 0)tt(ot,nt,0,rt);else{if(typeof nt!="string"||typeof at!="number")throw new TypeError("input is valid");tt(ot,nt,0,rt)}var ct}function tt(ot,rt,nt,at){const ct=xe[at||""]||xe[""];Y[ot]<Y[ct.minimalSeverity]||(ct.logDateTime&&(rt=`${new Date().toISOString()}|${rt}`),ct.logSourceLocation,te[ct.provider].log(ot,rt,at))}(function(ot){function rt(at){xe={},nt("",at||{})}function nt(at,ct){if(at==="*")rt(ct);else{const ut=xe[at]||ne;xe[at]={provider:ct.provider||ut.provider,minimalSeverity:ct.minimalSeverity||ut.minimalSeverity,logDateTime:ct.logDateTime===void 0?ut.logDateTime:ct.logDateTime,logSourceLocation:ct.logSourceLocation===void 0?ut.logSourceLocation:ct.logSourceLocation}}}ot.verbose=function(at,ct){ot("verbose",at,ct)},ot.info=function(at,ct){ot("info",at,ct)},ot.warning=function(at,ct){ot("warning",at,ct)},ot.error=function(at,ct){ot("error",at,ct)},ot.fatal=function(at,ct){ot("fatal",at,ct)},ot.reset=rt,ot.set=nt,ot.setWithEnv=function(at){const ct={};at.logLevel&&(ct.minimalSeverity=at.logLevel),nt("",ct)}})(et||(et={})),O.Logger=et;class it{constructor(rt,nt,at,ct,ut,dt){this.category=rt,this.name=nt,this.startTime=at,this.endCallback=ct,this.timer=ut,this.ctx=dt}end(){return this.endCallback(this)}async checkTimer(){if(this.ctx===void 0||this.timer===void 0)throw new Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}}class st{constructor(rt,nt,at,ct){this.category=rt,this.name=nt,this.startTime=at,this.endTime=ct}}O.Profiler=class{static create(ot){return ot===void 0?new this:new this(ot.maxNumberEvents,ot.flushBatchSize,ot.flushIntervalInMilliseconds)}constructor(ot,rt,nt){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=ot===void 0?1e4:ot,this._flushBatchSize=rt===void 0?10:rt,this._flushIntervalInMilliseconds=nt===void 0?5e3:nt}start(){this._started=!0,this._timingEvents=[],this._flushTime=(0,O.now)(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(ot,rt,nt,at){const ct=this._started?this.begin(ot,rt,at):void 0;let ut=!1;const dt=nt();if(dt&&typeof dt.then=="function")return ut=!0,new Promise(((ht,pt)=>{dt.then((async ft=>{ct&&await ct.end(),ht(ft)}),(async ft=>{ct&&await ct.end(),pt(ft)}))}));if(!ut&&ct){const ht=ct.end();if(ht&&typeof ht.then=="function")return new Promise(((pt,ft)=>{ht.then((()=>{pt(dt)}),(mt=>{ft(mt)}))}))}return dt}begin(ot,rt,nt){if(!this._started)throw new Error("profiler is not started yet");if(nt===void 0){const at=(0,O.now)();return this.flush(at),new it(ot,rt,at,(ct=>this.endSync(ct)))}{const at=nt.beginTimer();return new it(ot,rt,0,(async ct=>this.end(ct)),at,nt)}}async end(ot){const rt=await ot.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new st(ot.category,ot.name,ot.startTime,rt)),this.flush(rt))}endSync(ot){const rt=(0,O.now)();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new st(ot.category,ot.name,ot.startTime,rt)),this.flush(rt))}logOneEvent(ot){O.Logger.verbose(`Profiler.${ot.category}`,`${(ot.endTime-ot.startTime).toFixed(2)}ms on event '${ot.name}' at ${ot.endTime.toFixed(2)}`)}flush(ot){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||ot-this._flushTime>=this._flushIntervalInMilliseconds){for(const rt=this._flushPointer;this._flushPointer<rt+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=(0,O.now)()}}get started(){return this._started}},O.now=typeof performance<"u"&&performance.now?()=>performance.now():Date.now},2644:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.Model=void 0;const te=Y(5686),ne=Y(1446),xe=Y(7070),et=Y(9395),tt=Y(2517);var it=et.onnxruntime.experimental.fbs;O.Model=class{constructor(){}load(st,ot,rt){if(!rt)try{return void this.loadFromOnnxFormat(st,ot)}catch(nt){if(rt!==void 0)throw nt}this.loadFromOrtFormat(st,ot)}loadFromOnnxFormat(st,ot){const rt=ne.onnx.ModelProto.decode(st);if(tt.LongUtil.longToNumber(rt.irVersion)<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=rt.opsetImport.map((nt=>({domain:nt.domain,version:tt.LongUtil.longToNumber(nt.version)}))),this._graph=xe.Graph.from(rt.graph,ot)}loadFromOrtFormat(st,ot){const rt=new te.flatbuffers.ByteBuffer(st),nt=it.InferenceSession.getRootAsInferenceSession(rt).model();if(tt.LongUtil.longToNumber(nt.irVersion())<3)throw new Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let at=0;at<nt.opsetImportLength();at++){const ct=nt.opsetImport(at);this._opsets.push({domain:ct?.domain(),version:tt.LongUtil.longToNumber(ct.version())})}this._graph=xe.Graph.from(nt.graph(),ot)}get graph(){return this._graph}get opsets(){return this._opsets}}},782:(ee,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.FLOAT_TYPES=O.INT_TYPES=O.NUMBER_TYPES=void 0,O.NUMBER_TYPES=["float32","float64","int32","int16","int8","uint16","uint32","uint8"],O.INT_TYPES=["int32","int16","int8","uint16","uint32","uint8"],O.FLOAT_TYPES=["float32","float64"]},1047:(ee,O)=>{function Y(te,ne){if(ne.endsWith("+")){const xe=Number.parseInt(ne.substring(0,ne.length-1),10);return!isNaN(xe)&&xe<=te}if(ne.split("-").length===2){const xe=ne.split("-"),et=Number.parseInt(xe[0],10),tt=Number.parseInt(xe[1],10);return!isNaN(et)&&!isNaN(tt)&&et<=te&&te<=tt}return Number.parseInt(ne,10)===te}Object.defineProperty(O,"__esModule",{value:!0}),O.resolveOperator=void 0,O.resolveOperator=function(te,ne,xe){for(const et of xe){const tt=et[0],it=et[1],st=et[2],ot=et[3],rt=et[4];if(te.opType===tt){for(const nt of ne)if((nt.domain===it||nt.domain==="ai.onnx"&&it==="")&&Y(nt.version,st))return{opImpl:ot,opInit:rt}}}throw new TypeError(`cannot resolve operator '${te.opType}' with opsets: ${ne.map((et=>`${et.domain||"ai.onnx"} v${et.version}`)).join(", ")}`)}},9395:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.onnxruntime=void 0;const te=Y(5686);var ne,xe;ne=O.onnxruntime||(O.onnxruntime={}),(function(et){(function(tt){tt[tt.UNDEFINED=0]="UNDEFINED",tt[tt.FLOAT=1]="FLOAT",tt[tt.INT=2]="INT",tt[tt.STRING=3]="STRING",tt[tt.TENSOR=4]="TENSOR",tt[tt.GRAPH=5]="GRAPH",tt[tt.FLOATS=6]="FLOATS",tt[tt.INTS=7]="INTS",tt[tt.STRINGS=8]="STRINGS",tt[tt.TENSORS=9]="TENSORS",tt[tt.GRAPHS=10]="GRAPHS",tt[tt.SPARSE_TENSOR=11]="SPARSE_TENSOR",tt[tt.SPARSE_TENSORS=12]="SPARSE_TENSORS"})(et.AttributeType||(et.AttributeType={}))})((xe=ne.experimental||(ne.experimental={})).fbs||(xe.fbs={})),(function(et){(function(tt){(function(it){(function(st){st[st.UNKNOWN=0]="UNKNOWN",st[st.VALUE=1]="VALUE",st[st.PARAM=2]="PARAM"})(it.DimensionValueType||(it.DimensionValueType={}))})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){(function(st){st[st.UNDEFINED=0]="UNDEFINED",st[st.FLOAT=1]="FLOAT",st[st.UINT8=2]="UINT8",st[st.INT8=3]="INT8",st[st.UINT16=4]="UINT16",st[st.INT16=5]="INT16",st[st.INT32=6]="INT32",st[st.INT64=7]="INT64",st[st.STRING=8]="STRING",st[st.BOOL=9]="BOOL",st[st.FLOAT16=10]="FLOAT16",st[st.DOUBLE=11]="DOUBLE",st[st.UINT32=12]="UINT32",st[st.UINT64=13]="UINT64",st[st.COMPLEX64=14]="COMPLEX64",st[st.COMPLEX128=15]="COMPLEX128",st[st.BFLOAT16=16]="BFLOAT16"})(it.TensorDataType||(it.TensorDataType={}))})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){(function(st){st[st.Primitive=0]="Primitive",st[st.Fused=1]="Fused"})(it.NodeType||(it.NodeType={}))})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){(function(st){st[st.NONE=0]="NONE",st[st.tensor_type=1]="tensor_type",st[st.sequence_type=2]="sequence_type",st[st.map_type=3]="map_type"})(it.TypeInfoValue||(it.TypeInfoValue={}))})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsShape(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsShape(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}dim(rt,nt){let at=this.bb.__offset(this.bb_pos,4);return at?(nt||new et.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}dimLength(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startShape(rt){rt.startObject(1)}static addDim(rt,nt){rt.addFieldOffset(0,nt,0)}static createDimVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startDimVector(rt,nt){rt.startVector(4,nt,4)}static endShape(rt){return rt.endObject()}static createShape(rt,nt){return st.startShape(rt),st.addDim(rt,nt),st.endShape(rt)}}it.Shape=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsDimension(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsDimension(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}value(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?(rt||new et.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}denotation(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?this.bb.__string(this.bb_pos+nt,rt):null}static startDimension(rt){rt.startObject(2)}static addValue(rt,nt){rt.addFieldOffset(0,nt,0)}static addDenotation(rt,nt){rt.addFieldOffset(1,nt,0)}static endDimension(rt){return rt.endObject()}static createDimension(rt,nt,at){return st.startDimension(rt),st.addValue(rt,nt),st.addDenotation(rt,at),st.endDimension(rt)}}it.Dimension=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsDimensionValue(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsDimensionValue(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}dimType(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.readInt8(this.bb_pos+rt):et.experimental.fbs.DimensionValueType.UNKNOWN}dimValue(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.readInt64(this.bb_pos+rt):this.bb.createLong(0,0)}dimParam(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?this.bb.__string(this.bb_pos+nt,rt):null}static startDimensionValue(rt){rt.startObject(3)}static addDimType(rt,nt){rt.addFieldInt8(0,nt,et.experimental.fbs.DimensionValueType.UNKNOWN)}static addDimValue(rt,nt){rt.addFieldInt64(1,nt,rt.createLong(0,0))}static addDimParam(rt,nt){rt.addFieldOffset(2,nt,0)}static endDimensionValue(rt){return rt.endObject()}static createDimensionValue(rt,nt,at,ct){return st.startDimensionValue(rt),st.addDimType(rt,nt),st.addDimValue(rt,at),st.addDimParam(rt,ct),st.endDimensionValue(rt)}}it.DimensionValue=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsTensorTypeAndShape(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsTensorTypeAndShape(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}elemType(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.readInt32(this.bb_pos+rt):et.experimental.fbs.TensorDataType.UNDEFINED}shape(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?(rt||new et.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}static startTensorTypeAndShape(rt){rt.startObject(2)}static addElemType(rt,nt){rt.addFieldInt32(0,nt,et.experimental.fbs.TensorDataType.UNDEFINED)}static addShape(rt,nt){rt.addFieldOffset(1,nt,0)}static endTensorTypeAndShape(rt){return rt.endObject()}static createTensorTypeAndShape(rt,nt,at){return st.startTensorTypeAndShape(rt),st.addElemType(rt,nt),st.addShape(rt,at),st.endTensorTypeAndShape(rt)}}it.TensorTypeAndShape=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsMapType(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsMapType(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}keyType(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.readInt32(this.bb_pos+rt):et.experimental.fbs.TensorDataType.UNDEFINED}valueType(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?(rt||new et.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}static startMapType(rt){rt.startObject(2)}static addKeyType(rt,nt){rt.addFieldInt32(0,nt,et.experimental.fbs.TensorDataType.UNDEFINED)}static addValueType(rt,nt){rt.addFieldOffset(1,nt,0)}static endMapType(rt){return rt.endObject()}static createMapType(rt,nt,at){return st.startMapType(rt),st.addKeyType(rt,nt),st.addValueType(rt,at),st.endMapType(rt)}}it.MapType=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsSequenceType(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsSequenceType(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}elemType(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?(rt||new et.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}static startSequenceType(rt){rt.startObject(1)}static addElemType(rt,nt){rt.addFieldOffset(0,nt,0)}static endSequenceType(rt){return rt.endObject()}static createSequenceType(rt,nt){return st.startSequenceType(rt),st.addElemType(rt,nt),st.endSequenceType(rt)}}it.SequenceType=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(tt.fbs||(tt.fbs={})).EdgeEnd=class{constructor(){this.bb=null,this.bb_pos=0}__init(it,st){return this.bb_pos=it,this.bb=st,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(it,st,ot,rt){return it.prep(4,12),it.writeInt32(rt),it.writeInt32(ot),it.writeInt32(st),it.offset()}}})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsNodeEdge(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsNodeEdge(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}nodeIndex(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.readUint32(this.bb_pos+rt):0}inputEdges(rt,nt){let at=this.bb.__offset(this.bb_pos,6);return at?(nt||new et.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+at)+12*rt,this.bb):null}inputEdgesLength(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.__vector_len(this.bb_pos+rt):0}outputEdges(rt,nt){let at=this.bb.__offset(this.bb_pos,8);return at?(nt||new et.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+at)+12*rt,this.bb):null}outputEdgesLength(){let rt=this.bb.__offset(this.bb_pos,8);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startNodeEdge(rt){rt.startObject(3)}static addNodeIndex(rt,nt){rt.addFieldInt32(0,nt,0)}static addInputEdges(rt,nt){rt.addFieldOffset(1,nt,0)}static startInputEdgesVector(rt,nt){rt.startVector(12,nt,4)}static addOutputEdges(rt,nt){rt.addFieldOffset(2,nt,0)}static startOutputEdgesVector(rt,nt){rt.startVector(12,nt,4)}static endNodeEdge(rt){return rt.endObject()}static createNodeEdge(rt,nt,at,ct){return st.startNodeEdge(rt),st.addNodeIndex(rt,nt),st.addInputEdges(rt,at),st.addOutputEdges(rt,ct),st.endNodeEdge(rt)}}it.NodeEdge=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsNode(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsNode(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}name(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}docString(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?this.bb.__string(this.bb_pos+nt,rt):null}domain(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?this.bb.__string(this.bb_pos+nt,rt):null}sinceVersion(){let rt=this.bb.__offset(this.bb_pos,10);return rt?this.bb.readInt32(this.bb_pos+rt):0}index(){let rt=this.bb.__offset(this.bb_pos,12);return rt?this.bb.readUint32(this.bb_pos+rt):0}opType(rt){let nt=this.bb.__offset(this.bb_pos,14);return nt?this.bb.__string(this.bb_pos+nt,rt):null}type(){let rt=this.bb.__offset(this.bb_pos,16);return rt?this.bb.readInt32(this.bb_pos+rt):et.experimental.fbs.NodeType.Primitive}executionProviderType(rt){let nt=this.bb.__offset(this.bb_pos,18);return nt?this.bb.__string(this.bb_pos+nt,rt):null}inputs(rt,nt){let at=this.bb.__offset(this.bb_pos,20);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}inputsLength(){let rt=this.bb.__offset(this.bb_pos,20);return rt?this.bb.__vector_len(this.bb_pos+rt):0}outputs(rt,nt){let at=this.bb.__offset(this.bb_pos,22);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}outputsLength(){let rt=this.bb.__offset(this.bb_pos,22);return rt?this.bb.__vector_len(this.bb_pos+rt):0}attributes(rt,nt){let at=this.bb.__offset(this.bb_pos,24);return at?(nt||new et.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}attributesLength(){let rt=this.bb.__offset(this.bb_pos,24);return rt?this.bb.__vector_len(this.bb_pos+rt):0}inputArgCounts(rt){let nt=this.bb.__offset(this.bb_pos,26);return nt?this.bb.readInt32(this.bb.__vector(this.bb_pos+nt)+4*rt):0}inputArgCountsLength(){let rt=this.bb.__offset(this.bb_pos,26);return rt?this.bb.__vector_len(this.bb_pos+rt):0}inputArgCountsArray(){let rt=this.bb.__offset(this.bb_pos,26);return rt?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+rt),this.bb.__vector_len(this.bb_pos+rt)):null}implicitInputs(rt,nt){let at=this.bb.__offset(this.bb_pos,28);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}implicitInputsLength(){let rt=this.bb.__offset(this.bb_pos,28);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startNode(rt){rt.startObject(13)}static addName(rt,nt){rt.addFieldOffset(0,nt,0)}static addDocString(rt,nt){rt.addFieldOffset(1,nt,0)}static addDomain(rt,nt){rt.addFieldOffset(2,nt,0)}static addSinceVersion(rt,nt){rt.addFieldInt32(3,nt,0)}static addIndex(rt,nt){rt.addFieldInt32(4,nt,0)}static addOpType(rt,nt){rt.addFieldOffset(5,nt,0)}static addType(rt,nt){rt.addFieldInt32(6,nt,et.experimental.fbs.NodeType.Primitive)}static addExecutionProviderType(rt,nt){rt.addFieldOffset(7,nt,0)}static addInputs(rt,nt){rt.addFieldOffset(8,nt,0)}static createInputsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startInputsVector(rt,nt){rt.startVector(4,nt,4)}static addOutputs(rt,nt){rt.addFieldOffset(9,nt,0)}static createOutputsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startOutputsVector(rt,nt){rt.startVector(4,nt,4)}static addAttributes(rt,nt){rt.addFieldOffset(10,nt,0)}static createAttributesVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startAttributesVector(rt,nt){rt.startVector(4,nt,4)}static addInputArgCounts(rt,nt){rt.addFieldOffset(11,nt,0)}static createInputArgCountsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addInt32(nt[at]);return rt.endVector()}static startInputArgCountsVector(rt,nt){rt.startVector(4,nt,4)}static addImplicitInputs(rt,nt){rt.addFieldOffset(12,nt,0)}static createImplicitInputsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startImplicitInputsVector(rt,nt){rt.startVector(4,nt,4)}static endNode(rt){return rt.endObject()}static createNode(rt,nt,at,ct,ut,dt,ht,pt,ft,mt,yt,bt,vt,Et){return st.startNode(rt),st.addName(rt,nt),st.addDocString(rt,at),st.addDomain(rt,ct),st.addSinceVersion(rt,ut),st.addIndex(rt,dt),st.addOpType(rt,ht),st.addType(rt,pt),st.addExecutionProviderType(rt,ft),st.addInputs(rt,mt),st.addOutputs(rt,yt),st.addAttributes(rt,bt),st.addInputArgCounts(rt,vt),st.addImplicitInputs(rt,Et),st.endNode(rt)}}it.Node=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsValueInfo(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsValueInfo(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}name(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}docString(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?this.bb.__string(this.bb_pos+nt,rt):null}type(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?(rt||new et.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}static startValueInfo(rt){rt.startObject(3)}static addName(rt,nt){rt.addFieldOffset(0,nt,0)}static addDocString(rt,nt){rt.addFieldOffset(1,nt,0)}static addType(rt,nt){rt.addFieldOffset(2,nt,0)}static endValueInfo(rt){return rt.endObject()}static createValueInfo(rt,nt,at,ct){return st.startValueInfo(rt),st.addName(rt,nt),st.addDocString(rt,at),st.addType(rt,ct),st.endValueInfo(rt)}}it.ValueInfo=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsTypeInfo(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsTypeInfo(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}denotation(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}valueType(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.readUint8(this.bb_pos+rt):et.experimental.fbs.TypeInfoValue.NONE}value(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?this.bb.__union(rt,this.bb_pos+nt):null}static startTypeInfo(rt){rt.startObject(3)}static addDenotation(rt,nt){rt.addFieldOffset(0,nt,0)}static addValueType(rt,nt){rt.addFieldInt8(1,nt,et.experimental.fbs.TypeInfoValue.NONE)}static addValue(rt,nt){rt.addFieldOffset(2,nt,0)}static endTypeInfo(rt){return rt.endObject()}static createTypeInfo(rt,nt,at,ct){return st.startTypeInfo(rt),st.addDenotation(rt,nt),st.addValueType(rt,at),st.addValue(rt,ct),st.endTypeInfo(rt)}}it.TypeInfo=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsOperatorSetId(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsOperatorSetId(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}domain(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}version(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.readInt64(this.bb_pos+rt):this.bb.createLong(0,0)}static startOperatorSetId(rt){rt.startObject(2)}static addDomain(rt,nt){rt.addFieldOffset(0,nt,0)}static addVersion(rt,nt){rt.addFieldInt64(1,nt,rt.createLong(0,0))}static endOperatorSetId(rt){return rt.endObject()}static createOperatorSetId(rt,nt,at){return st.startOperatorSetId(rt),st.addDomain(rt,nt),st.addVersion(rt,at),st.endOperatorSetId(rt)}}it.OperatorSetId=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsTensor(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsTensor(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}name(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}docString(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?this.bb.__string(this.bb_pos+nt,rt):null}dims(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?this.bb.readInt64(this.bb.__vector(this.bb_pos+nt)+8*rt):this.bb.createLong(0,0)}dimsLength(){let rt=this.bb.__offset(this.bb_pos,8);return rt?this.bb.__vector_len(this.bb_pos+rt):0}dataType(){let rt=this.bb.__offset(this.bb_pos,10);return rt?this.bb.readInt32(this.bb_pos+rt):et.experimental.fbs.TensorDataType.UNDEFINED}rawData(rt){let nt=this.bb.__offset(this.bb_pos,12);return nt?this.bb.readUint8(this.bb.__vector(this.bb_pos+nt)+rt):0}rawDataLength(){let rt=this.bb.__offset(this.bb_pos,12);return rt?this.bb.__vector_len(this.bb_pos+rt):0}rawDataArray(){let rt=this.bb.__offset(this.bb_pos,12);return rt?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+rt),this.bb.__vector_len(this.bb_pos+rt)):null}stringData(rt,nt){let at=this.bb.__offset(this.bb_pos,14);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}stringDataLength(){let rt=this.bb.__offset(this.bb_pos,14);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startTensor(rt){rt.startObject(6)}static addName(rt,nt){rt.addFieldOffset(0,nt,0)}static addDocString(rt,nt){rt.addFieldOffset(1,nt,0)}static addDims(rt,nt){rt.addFieldOffset(2,nt,0)}static createDimsVector(rt,nt){rt.startVector(8,nt.length,8);for(let at=nt.length-1;at>=0;at--)rt.addInt64(nt[at]);return rt.endVector()}static startDimsVector(rt,nt){rt.startVector(8,nt,8)}static addDataType(rt,nt){rt.addFieldInt32(3,nt,et.experimental.fbs.TensorDataType.UNDEFINED)}static addRawData(rt,nt){rt.addFieldOffset(4,nt,0)}static createRawDataVector(rt,nt){rt.startVector(1,nt.length,1);for(let at=nt.length-1;at>=0;at--)rt.addInt8(nt[at]);return rt.endVector()}static startRawDataVector(rt,nt){rt.startVector(1,nt,1)}static addStringData(rt,nt){rt.addFieldOffset(5,nt,0)}static createStringDataVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startStringDataVector(rt,nt){rt.startVector(4,nt,4)}static endTensor(rt){return rt.endObject()}static createTensor(rt,nt,at,ct,ut,dt,ht){return st.startTensor(rt),st.addName(rt,nt),st.addDocString(rt,at),st.addDims(rt,ct),st.addDataType(rt,ut),st.addRawData(rt,dt),st.addStringData(rt,ht),st.endTensor(rt)}}it.Tensor=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsSparseTensor(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsSparseTensor(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}values(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?(rt||new et.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}indices(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?(rt||new et.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}dims(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?this.bb.readInt64(this.bb.__vector(this.bb_pos+nt)+8*rt):this.bb.createLong(0,0)}dimsLength(){let rt=this.bb.__offset(this.bb_pos,8);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startSparseTensor(rt){rt.startObject(3)}static addValues(rt,nt){rt.addFieldOffset(0,nt,0)}static addIndices(rt,nt){rt.addFieldOffset(1,nt,0)}static addDims(rt,nt){rt.addFieldOffset(2,nt,0)}static createDimsVector(rt,nt){rt.startVector(8,nt.length,8);for(let at=nt.length-1;at>=0;at--)rt.addInt64(nt[at]);return rt.endVector()}static startDimsVector(rt,nt){rt.startVector(8,nt,8)}static endSparseTensor(rt){return rt.endObject()}static createSparseTensor(rt,nt,at,ct){return st.startSparseTensor(rt),st.addValues(rt,nt),st.addIndices(rt,at),st.addDims(rt,ct),st.endSparseTensor(rt)}}it.SparseTensor=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsAttribute(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsAttribute(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}name(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}docString(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?this.bb.__string(this.bb_pos+nt,rt):null}type(){let rt=this.bb.__offset(this.bb_pos,8);return rt?this.bb.readInt32(this.bb_pos+rt):et.experimental.fbs.AttributeType.UNDEFINED}f(){let rt=this.bb.__offset(this.bb_pos,10);return rt?this.bb.readFloat32(this.bb_pos+rt):0}i(){let rt=this.bb.__offset(this.bb_pos,12);return rt?this.bb.readInt64(this.bb_pos+rt):this.bb.createLong(0,0)}s(rt){let nt=this.bb.__offset(this.bb_pos,14);return nt?this.bb.__string(this.bb_pos+nt,rt):null}t(rt){let nt=this.bb.__offset(this.bb_pos,16);return nt?(rt||new et.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}g(rt){let nt=this.bb.__offset(this.bb_pos,18);return nt?(rt||new et.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}floats(rt){let nt=this.bb.__offset(this.bb_pos,20);return nt?this.bb.readFloat32(this.bb.__vector(this.bb_pos+nt)+4*rt):0}floatsLength(){let rt=this.bb.__offset(this.bb_pos,20);return rt?this.bb.__vector_len(this.bb_pos+rt):0}floatsArray(){let rt=this.bb.__offset(this.bb_pos,20);return rt?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+rt),this.bb.__vector_len(this.bb_pos+rt)):null}ints(rt){let nt=this.bb.__offset(this.bb_pos,22);return nt?this.bb.readInt64(this.bb.__vector(this.bb_pos+nt)+8*rt):this.bb.createLong(0,0)}intsLength(){let rt=this.bb.__offset(this.bb_pos,22);return rt?this.bb.__vector_len(this.bb_pos+rt):0}strings(rt,nt){let at=this.bb.__offset(this.bb_pos,24);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}stringsLength(){let rt=this.bb.__offset(this.bb_pos,24);return rt?this.bb.__vector_len(this.bb_pos+rt):0}tensors(rt,nt){let at=this.bb.__offset(this.bb_pos,26);return at?(nt||new et.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}tensorsLength(){let rt=this.bb.__offset(this.bb_pos,26);return rt?this.bb.__vector_len(this.bb_pos+rt):0}graphs(rt,nt){let at=this.bb.__offset(this.bb_pos,28);return at?(nt||new et.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}graphsLength(){let rt=this.bb.__offset(this.bb_pos,28);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startAttribute(rt){rt.startObject(13)}static addName(rt,nt){rt.addFieldOffset(0,nt,0)}static addDocString(rt,nt){rt.addFieldOffset(1,nt,0)}static addType(rt,nt){rt.addFieldInt32(2,nt,et.experimental.fbs.AttributeType.UNDEFINED)}static addF(rt,nt){rt.addFieldFloat32(3,nt,0)}static addI(rt,nt){rt.addFieldInt64(4,nt,rt.createLong(0,0))}static addS(rt,nt){rt.addFieldOffset(5,nt,0)}static addT(rt,nt){rt.addFieldOffset(6,nt,0)}static addG(rt,nt){rt.addFieldOffset(7,nt,0)}static addFloats(rt,nt){rt.addFieldOffset(8,nt,0)}static createFloatsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addFloat32(nt[at]);return rt.endVector()}static startFloatsVector(rt,nt){rt.startVector(4,nt,4)}static addInts(rt,nt){rt.addFieldOffset(9,nt,0)}static createIntsVector(rt,nt){rt.startVector(8,nt.length,8);for(let at=nt.length-1;at>=0;at--)rt.addInt64(nt[at]);return rt.endVector()}static startIntsVector(rt,nt){rt.startVector(8,nt,8)}static addStrings(rt,nt){rt.addFieldOffset(10,nt,0)}static createStringsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startStringsVector(rt,nt){rt.startVector(4,nt,4)}static addTensors(rt,nt){rt.addFieldOffset(11,nt,0)}static createTensorsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startTensorsVector(rt,nt){rt.startVector(4,nt,4)}static addGraphs(rt,nt){rt.addFieldOffset(12,nt,0)}static createGraphsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startGraphsVector(rt,nt){rt.startVector(4,nt,4)}static endAttribute(rt){return rt.endObject()}static createAttribute(rt,nt,at,ct,ut,dt,ht,pt,ft,mt,yt,bt,vt,Et){return st.startAttribute(rt),st.addName(rt,nt),st.addDocString(rt,at),st.addType(rt,ct),st.addF(rt,ut),st.addI(rt,dt),st.addS(rt,ht),st.addT(rt,pt),st.addG(rt,ft),st.addFloats(rt,mt),st.addInts(rt,yt),st.addStrings(rt,bt),st.addTensors(rt,vt),st.addGraphs(rt,Et),st.endAttribute(rt)}}it.Attribute=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsGraph(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsGraph(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}initializers(rt,nt){let at=this.bb.__offset(this.bb_pos,4);return at?(nt||new et.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}initializersLength(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.__vector_len(this.bb_pos+rt):0}nodeArgs(rt,nt){let at=this.bb.__offset(this.bb_pos,6);return at?(nt||new et.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}nodeArgsLength(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.__vector_len(this.bb_pos+rt):0}nodes(rt,nt){let at=this.bb.__offset(this.bb_pos,8);return at?(nt||new et.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}nodesLength(){let rt=this.bb.__offset(this.bb_pos,8);return rt?this.bb.__vector_len(this.bb_pos+rt):0}maxNodeIndex(){let rt=this.bb.__offset(this.bb_pos,10);return rt?this.bb.readUint32(this.bb_pos+rt):0}nodeEdges(rt,nt){let at=this.bb.__offset(this.bb_pos,12);return at?(nt||new et.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}nodeEdgesLength(){let rt=this.bb.__offset(this.bb_pos,12);return rt?this.bb.__vector_len(this.bb_pos+rt):0}inputs(rt,nt){let at=this.bb.__offset(this.bb_pos,14);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}inputsLength(){let rt=this.bb.__offset(this.bb_pos,14);return rt?this.bb.__vector_len(this.bb_pos+rt):0}outputs(rt,nt){let at=this.bb.__offset(this.bb_pos,16);return at?this.bb.__string(this.bb.__vector(this.bb_pos+at)+4*rt,nt):null}outputsLength(){let rt=this.bb.__offset(this.bb_pos,16);return rt?this.bb.__vector_len(this.bb_pos+rt):0}sparseInitializers(rt,nt){let at=this.bb.__offset(this.bb_pos,18);return at?(nt||new et.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}sparseInitializersLength(){let rt=this.bb.__offset(this.bb_pos,18);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startGraph(rt){rt.startObject(8)}static addInitializers(rt,nt){rt.addFieldOffset(0,nt,0)}static createInitializersVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startInitializersVector(rt,nt){rt.startVector(4,nt,4)}static addNodeArgs(rt,nt){rt.addFieldOffset(1,nt,0)}static createNodeArgsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startNodeArgsVector(rt,nt){rt.startVector(4,nt,4)}static addNodes(rt,nt){rt.addFieldOffset(2,nt,0)}static createNodesVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startNodesVector(rt,nt){rt.startVector(4,nt,4)}static addMaxNodeIndex(rt,nt){rt.addFieldInt32(3,nt,0)}static addNodeEdges(rt,nt){rt.addFieldOffset(4,nt,0)}static createNodeEdgesVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startNodeEdgesVector(rt,nt){rt.startVector(4,nt,4)}static addInputs(rt,nt){rt.addFieldOffset(5,nt,0)}static createInputsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startInputsVector(rt,nt){rt.startVector(4,nt,4)}static addOutputs(rt,nt){rt.addFieldOffset(6,nt,0)}static createOutputsVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startOutputsVector(rt,nt){rt.startVector(4,nt,4)}static addSparseInitializers(rt,nt){rt.addFieldOffset(7,nt,0)}static createSparseInitializersVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startSparseInitializersVector(rt,nt){rt.startVector(4,nt,4)}static endGraph(rt){return rt.endObject()}static createGraph(rt,nt,at,ct,ut,dt,ht,pt,ft){return st.startGraph(rt),st.addInitializers(rt,nt),st.addNodeArgs(rt,at),st.addNodes(rt,ct),st.addMaxNodeIndex(rt,ut),st.addNodeEdges(rt,dt),st.addInputs(rt,ht),st.addOutputs(rt,pt),st.addSparseInitializers(rt,ft),st.endGraph(rt)}}it.Graph=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsModel(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsModel(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}irVersion(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.readInt64(this.bb_pos+rt):this.bb.createLong(0,0)}opsetImport(rt,nt){let at=this.bb.__offset(this.bb_pos,6);return at?(nt||new et.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}opsetImportLength(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.__vector_len(this.bb_pos+rt):0}producerName(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?this.bb.__string(this.bb_pos+nt,rt):null}producerVersion(rt){let nt=this.bb.__offset(this.bb_pos,10);return nt?this.bb.__string(this.bb_pos+nt,rt):null}domain(rt){let nt=this.bb.__offset(this.bb_pos,12);return nt?this.bb.__string(this.bb_pos+nt,rt):null}modelVersion(){let rt=this.bb.__offset(this.bb_pos,14);return rt?this.bb.readInt64(this.bb_pos+rt):this.bb.createLong(0,0)}docString(rt){let nt=this.bb.__offset(this.bb_pos,16);return nt?this.bb.__string(this.bb_pos+nt,rt):null}graph(rt){let nt=this.bb.__offset(this.bb_pos,18);return nt?(rt||new et.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}graphDocString(rt){let nt=this.bb.__offset(this.bb_pos,20);return nt?this.bb.__string(this.bb_pos+nt,rt):null}static startModel(rt){rt.startObject(9)}static addIrVersion(rt,nt){rt.addFieldInt64(0,nt,rt.createLong(0,0))}static addOpsetImport(rt,nt){rt.addFieldOffset(1,nt,0)}static createOpsetImportVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startOpsetImportVector(rt,nt){rt.startVector(4,nt,4)}static addProducerName(rt,nt){rt.addFieldOffset(2,nt,0)}static addProducerVersion(rt,nt){rt.addFieldOffset(3,nt,0)}static addDomain(rt,nt){rt.addFieldOffset(4,nt,0)}static addModelVersion(rt,nt){rt.addFieldInt64(5,nt,rt.createLong(0,0))}static addDocString(rt,nt){rt.addFieldOffset(6,nt,0)}static addGraph(rt,nt){rt.addFieldOffset(7,nt,0)}static addGraphDocString(rt,nt){rt.addFieldOffset(8,nt,0)}static endModel(rt){return rt.endObject()}static createModel(rt,nt,at,ct,ut,dt,ht,pt,ft,mt){return st.startModel(rt),st.addIrVersion(rt,nt),st.addOpsetImport(rt,at),st.addProducerName(rt,ct),st.addProducerVersion(rt,ut),st.addDomain(rt,dt),st.addModelVersion(rt,ht),st.addDocString(rt,pt),st.addGraph(rt,ft),st.addGraphDocString(rt,mt),st.endModel(rt)}}it.Model=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsKernelCreateInfos(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsKernelCreateInfos(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}nodeIndices(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.readUint32(this.bb.__vector(this.bb_pos+nt)+4*rt):0}nodeIndicesLength(){let rt=this.bb.__offset(this.bb_pos,4);return rt?this.bb.__vector_len(this.bb_pos+rt):0}nodeIndicesArray(){let rt=this.bb.__offset(this.bb_pos,4);return rt?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+rt),this.bb.__vector_len(this.bb_pos+rt)):null}kernelDefHashes(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?this.bb.readUint64(this.bb.__vector(this.bb_pos+nt)+8*rt):this.bb.createLong(0,0)}kernelDefHashesLength(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startKernelCreateInfos(rt){rt.startObject(2)}static addNodeIndices(rt,nt){rt.addFieldOffset(0,nt,0)}static createNodeIndicesVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addInt32(nt[at]);return rt.endVector()}static startNodeIndicesVector(rt,nt){rt.startVector(4,nt,4)}static addKernelDefHashes(rt,nt){rt.addFieldOffset(1,nt,0)}static createKernelDefHashesVector(rt,nt){rt.startVector(8,nt.length,8);for(let at=nt.length-1;at>=0;at--)rt.addInt64(nt[at]);return rt.endVector()}static startKernelDefHashesVector(rt,nt){rt.startVector(8,nt,8)}static endKernelCreateInfos(rt){return rt.endObject()}static createKernelCreateInfos(rt,nt,at){return st.startKernelCreateInfos(rt),st.addNodeIndices(rt,nt),st.addKernelDefHashes(rt,at),st.endKernelCreateInfos(rt)}}it.KernelCreateInfos=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsSubGraphSessionState(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsSubGraphSessionState(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}graphId(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}sessionState(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?(rt||new et.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}static startSubGraphSessionState(rt){rt.startObject(2)}static addGraphId(rt,nt){rt.addFieldOffset(0,nt,0)}static addSessionState(rt,nt){rt.addFieldOffset(1,nt,0)}static endSubGraphSessionState(rt){let nt=rt.endObject();return rt.requiredField(nt,4),nt}static createSubGraphSessionState(rt,nt,at){return st.startSubGraphSessionState(rt),st.addGraphId(rt,nt),st.addSessionState(rt,at),st.endSubGraphSessionState(rt)}}it.SubGraphSessionState=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsSessionState(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsSessionState(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}kernels(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?(rt||new et.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}subGraphSessionStates(rt,nt){let at=this.bb.__offset(this.bb_pos,6);return at?(nt||new et.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+at)+4*rt),this.bb):null}subGraphSessionStatesLength(){let rt=this.bb.__offset(this.bb_pos,6);return rt?this.bb.__vector_len(this.bb_pos+rt):0}static startSessionState(rt){rt.startObject(2)}static addKernels(rt,nt){rt.addFieldOffset(0,nt,0)}static addSubGraphSessionStates(rt,nt){rt.addFieldOffset(1,nt,0)}static createSubGraphSessionStatesVector(rt,nt){rt.startVector(4,nt.length,4);for(let at=nt.length-1;at>=0;at--)rt.addOffset(nt[at]);return rt.endVector()}static startSubGraphSessionStatesVector(rt,nt){rt.startVector(4,nt,4)}static endSessionState(rt){return rt.endObject()}static createSessionState(rt,nt,at){return st.startSessionState(rt),st.addKernels(rt,nt),st.addSubGraphSessionStates(rt,at),st.endSessionState(rt)}}it.SessionState=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={})),(function(et){(function(tt){(function(it){class st{constructor(){this.bb=null,this.bb_pos=0}__init(rt,nt){return this.bb_pos=rt,this.bb=nt,this}static getRootAsInferenceSession(rt,nt){return(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static getSizePrefixedRootAsInferenceSession(rt,nt){return rt.setPosition(rt.position()+te.flatbuffers.SIZE_PREFIX_LENGTH),(nt||new st).__init(rt.readInt32(rt.position())+rt.position(),rt)}static bufferHasIdentifier(rt){return rt.__has_identifier("ORTM")}ortVersion(rt){let nt=this.bb.__offset(this.bb_pos,4);return nt?this.bb.__string(this.bb_pos+nt,rt):null}model(rt){let nt=this.bb.__offset(this.bb_pos,6);return nt?(rt||new et.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}sessionState(rt){let nt=this.bb.__offset(this.bb_pos,8);return nt?(rt||new et.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+nt),this.bb):null}static startInferenceSession(rt){rt.startObject(3)}static addOrtVersion(rt,nt){rt.addFieldOffset(0,nt,0)}static addModel(rt,nt){rt.addFieldOffset(1,nt,0)}static addSessionState(rt,nt){rt.addFieldOffset(2,nt,0)}static endInferenceSession(rt){return rt.endObject()}static finishInferenceSessionBuffer(rt,nt){rt.finish(nt,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(rt,nt){rt.finish(nt,"ORTM",!0)}static createInferenceSession(rt,nt,at,ct){return st.startInferenceSession(rt),st.addOrtVersion(rt,nt),st.addModel(rt,at),st.addSessionState(rt,ct),st.endInferenceSession(rt)}}it.InferenceSession=st})(tt.fbs||(tt.fbs={}))})(et.experimental||(et.experimental={}))})(O.onnxruntime||(O.onnxruntime={}))},7448:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.OnnxjsSessionHandler=void 0;const te=Y(1670),ne=Y(9162);O.OnnxjsSessionHandler=class{constructor(xe){this.session=xe,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(xe,et,tt){const it=new Map;for(const rt in xe)if(Object.hasOwnProperty.call(xe,rt)){const nt=xe[rt];it.set(rt,new ne.Tensor(nt.dims,nt.type,void 0,void 0,nt.data))}const st=await this.session.run(it),ot={};return st.forEach(((rt,nt)=>{ot[nt]=new te.Tensor(rt.type,rt.data,rt.dims)})),ot}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}},6919:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.Session=void 0;const te=Y(7067),ne=Y(1296),xe=Y(7091),et=Y(1036),tt=Y(6231),it=Y(2644);O.Session=class{constructor(st={}){this._initialized=!1,this.backendHint=st.backendHint,this.profiler=tt.Profiler.create(st.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(st,ot,rt){await this.profiler.event("session","Session.loadModel",(async()=>{const nt=await(0,xe.resolveBackend)(this.backendHint);if(this.sessionHandler=nt.createSessionHandler(this.context),this._model=new it.Model,typeof st=="string"){const at=st.endsWith(".ort");if(typeof fetch>"u"){const ct=await(0,ne.promisify)(te.readFile)(st);this.initialize(ct,at)}else{const ct=await fetch(st),ut=await ct.arrayBuffer();this.initialize(new Uint8Array(ut),at)}}else if(ArrayBuffer.isView(st))this.initialize(st);else{const at=new Uint8Array(st,ot||0,rt||st.byteLength);this.initialize(at)}}))}initialize(st,ot){if(this._initialized)throw new Error("already initialized");this.profiler.event("session","Session.initialize",(()=>{const rt=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(st,rt,ot),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new et.ExecutionPlan(this._model.graph,this._ops,this.profiler)})),this._initialized=!0}async run(st){if(!this._initialized)throw new Error("session not initialized yet");return this.profiler.event("session","Session.run",(async()=>{const ot=this.normalizeAndValidateInputs(st),rt=await this._executionPlan.execute(this.sessionHandler,ot);return this.createOutput(rt)}))}normalizeAndValidateInputs(st){const ot=this._model.graph.getInputNames();if(Array.isArray(st)){if(st.length!==ot.length)throw new Error(`incorrect input array length: expected ${ot.length} but got ${st.length}`)}else{if(st.size!==ot.length)throw new Error(`incorrect input map size: expected ${ot.length} but got ${st.size}`);const rt=new Array(st.size);let nt=0;for(let at=0;at<ot.length;++at){const ct=st.get(ot[at]);if(!ct)throw new Error(`missing input tensor for: '${name}'`);rt[nt++]=ct}st=rt}if(this.context.graphInputTypes&&this.context.graphInputTypes.length!==0&&this.context.graphInputDims&&this.context.graphInputDims.length!==0)this.validateInputTensorDims(this.context.graphInputDims,st,!1);else{const rt=this._model.graph.getInputIndices(),nt=this._model.graph.getValues(),at=new Array(rt.length);for(let ct=0;ct<rt.length;++ct){const ut=nt[rt[ct]];at[ct]=ut.type.shape.dims,this.context.graphInputTypes.push(ut.type.tensorType),this.context.graphInputDims.push(st[ct].dims)}this.validateInputTensorDims(at,st,!0)}return this.validateInputTensorTypes(this.context.graphInputTypes,st),st}validateInputTensorTypes(st,ot){for(let rt=0;rt<ot.length;rt++){const nt=st[rt],at=ot[rt].type;if(nt!==at)throw new Error(`input tensor[${rt}] check failed: expected type '${nt}' but got ${at}`)}}validateInputTensorDims(st,ot,rt){for(let nt=0;nt<ot.length;nt++){const at=st[nt],ct=ot[nt].dims;if(!this.compareTensorDims(at,ct,rt))throw new Error(`input tensor[${nt}] check failed: expected shape '[${at.join(",")}]' but got [${ct.join(",")}]`)}}compareTensorDims(st,ot,rt){if(st.length!==ot.length)return!1;for(let nt=0;nt<st.length;++nt)if(st[nt]!==ot[nt]&&(!rt||st[nt]!==0))return!1;return!0}createOutput(st){const ot=this._model.graph.getOutputNames();if(st.length!==ot.length)throw new Error("expected number of outputs do not match number of generated outputs");const rt=new Map;for(let nt=0;nt<ot.length;++nt)rt.set(ot[nt],st[nt]);return rt}initializeOps(st){const ot=st.getNodes();this._ops=new Array(ot.length);for(let rt=0;rt<ot.length;rt++)this._ops[rt]=this.sessionHandler.resolve(ot[rt],this._model.opsets,st)}}},9162:function(ee,O,Y){var te=this&&this.__importDefault||function(ut){return ut&&ut.__esModule?ut:{default:ut}};Object.defineProperty(O,"__esModule",{value:!0}),O.Tensor=void 0;const ne=Y(3442),xe=te(Y(3720)),et=Y(1446),tt=Y(9395),it=Y(2517);var st=tt.onnxruntime.experimental.fbs;class ot{get data(){if(this.cache===void 0){const dt=this.dataProvider(this.dataId);if(dt.length!==this.size)throw new Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=dt}return this.cache}get stringData(){if(this.type!=="string")throw new TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw new TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw new TypeError("data type is not float (float32, float64)")}}get numberData(){if(this.type!=="string")return this.data;throw new TypeError("type cannot be non-number (string)")}get(dt){return this.data[it.ShapeUtil.indicesToOffset(dt,this.strides)]}set(dt,ht){this.data[it.ShapeUtil.indicesToOffset(dt,this.strides)]=ht}async getData(){return this.cache===void 0&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=it.ShapeUtil.computeStrides(this.dims)),this._strides}constructor(dt,ht,pt,ft,mt,yt=ne.Guid.create()){this.dims=dt,this.type=ht,this.dataProvider=pt,this.asyncDataProvider=ft,this.cache=mt,this.dataId=yt,this.size=it.ShapeUtil.validateDimsAndCalcSize(dt);const bt=this.size,vt=pt===void 0&&ft===void 0&&mt===void 0;if(mt!==void 0&&mt.length!==bt)throw new RangeError("Input dims doesn't match data length.");if(ht==="string"){if(!(mt===void 0||Array.isArray(mt)&&mt.every((Et=>typeof Et=="string"))))throw new TypeError("cache should be a string array");vt&&(this.cache=new Array(bt))}else{if(mt!==void 0){const Et=nt(ht);if(!(mt instanceof Et))throw new TypeError(`cache should be type ${Et.name}`)}if(vt){const Et=new ArrayBuffer(bt*(function(wt){switch(wt){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw new Error(`cannot calculate sizeof() on type ${wt}`)}})(ht));this.cache=(function(wt,St){return new(nt(St))(wt)})(Et,ht)}}}static fromProto(dt){if(!dt)throw new Error("cannot construct Value from an empty tensor");const ht=it.ProtoUtil.tensorDataTypeFromProto(dt.dataType),pt=it.ProtoUtil.tensorDimsFromProto(dt.dims),ft=new ot(pt,ht);if(ht==="string")dt.stringData.forEach(((mt,yt)=>{ft.data[yt]=(0,it.decodeUtf8String)(mt)}));else if(dt.rawData&&typeof dt.rawData.byteLength=="number"&&dt.rawData.byteLength>0){const mt=ft.data,yt=new DataView(dt.rawData.buffer,dt.rawData.byteOffset,dt.rawData.byteLength),bt=rt(dt.dataType),vt=dt.rawData.byteLength/bt;if(dt.rawData.byteLength%bt!=0)throw new Error("invalid buffer length");if(mt.length!==vt)throw new Error("buffer length mismatch");for(let Et=0;Et<vt;Et++){const wt=ct(yt,dt.dataType,Et*bt);mt[Et]=wt}}else{let mt;switch(dt.dataType){case et.onnx.TensorProto.DataType.FLOAT:mt=dt.floatData;break;case et.onnx.TensorProto.DataType.INT32:case et.onnx.TensorProto.DataType.INT16:case et.onnx.TensorProto.DataType.UINT16:case et.onnx.TensorProto.DataType.INT8:case et.onnx.TensorProto.DataType.UINT8:case et.onnx.TensorProto.DataType.BOOL:mt=dt.int32Data;break;case et.onnx.TensorProto.DataType.INT64:mt=dt.int64Data;break;case et.onnx.TensorProto.DataType.DOUBLE:mt=dt.doubleData;break;case et.onnx.TensorProto.DataType.UINT32:case et.onnx.TensorProto.DataType.UINT64:mt=dt.uint64Data;break;default:throw new Error("unspecific error")}if(mt==null)throw new Error("failed to populate data from a tensorproto value");const yt=ft.data;if(yt.length!==mt.length)throw new Error("array length mismatch");for(let bt=0;bt<mt.length;bt++){const vt=mt[bt];xe.default.isLong(vt)?yt[bt]=at(vt,dt.dataType):yt[bt]=vt}}return ft}static fromData(dt,ht,pt){return new ot(ht,pt,void 0,void 0,dt)}static fromOrtTensor(dt){if(!dt)throw new Error("cannot construct Value from an empty tensor");const ht=it.ProtoUtil.tensorDimsFromORTFormat(dt),pt=it.ProtoUtil.tensorDataTypeFromProto(dt.dataType()),ft=new ot(ht,pt);if(pt==="string")for(let mt=0;mt<dt.stringDataLength();mt++)ft.data[mt]=dt.stringData(mt);else if(dt.rawDataArray()&&typeof dt.rawDataLength()=="number"&&dt.rawDataLength()>0){const mt=ft.data,yt=new DataView(dt.rawDataArray().buffer,dt.rawDataArray().byteOffset,dt.rawDataLength()),bt=rt(dt.dataType()),vt=dt.rawDataLength()/bt;if(dt.rawDataLength()%bt!=0)throw new Error("invalid buffer length");if(mt.length!==vt)throw new Error("buffer length mismatch");for(let Et=0;Et<vt;Et++){const wt=ct(yt,dt.dataType(),Et*bt);mt[Et]=wt}}return ft}}function rt(ut){switch(ut){case et.onnx.TensorProto.DataType.UINT8:case et.onnx.TensorProto.DataType.INT8:case et.onnx.TensorProto.DataType.BOOL:return 1;case et.onnx.TensorProto.DataType.UINT16:case et.onnx.TensorProto.DataType.INT16:return 2;case et.onnx.TensorProto.DataType.FLOAT:case et.onnx.TensorProto.DataType.INT32:case et.onnx.TensorProto.DataType.UINT32:return 4;case et.onnx.TensorProto.DataType.INT64:case et.onnx.TensorProto.DataType.DOUBLE:case et.onnx.TensorProto.DataType.UINT64:return 8;default:throw new Error(`cannot calculate sizeof() on type ${et.onnx.TensorProto.DataType[ut]}`)}}function nt(ut){switch(ut){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw new Error("unspecified error")}}function at(ut,dt){if(dt===et.onnx.TensorProto.DataType.INT64||dt===st.TensorDataType.INT64){if(ut.greaterThanOrEqual(2147483648)||ut.lessThan(-2147483648))throw new TypeError("int64 is not supported")}else{if(dt!==et.onnx.TensorProto.DataType.UINT32&&dt!==st.TensorDataType.UINT32&&dt!==et.onnx.TensorProto.DataType.UINT64&&dt!==st.TensorDataType.UINT64)throw new TypeError(`not a LONG type: ${et.onnx.TensorProto.DataType[dt]}`);if(ut.greaterThanOrEqual(4294967296)||ut.lessThan(0))throw new TypeError("uint64 is not supported")}return ut.toNumber()}function ct(ut,dt,ht){switch(dt){case et.onnx.TensorProto.DataType.BOOL:case et.onnx.TensorProto.DataType.UINT8:return ut.getUint8(ht);case et.onnx.TensorProto.DataType.INT8:return ut.getInt8(ht);case et.onnx.TensorProto.DataType.UINT16:return ut.getUint16(ht,!0);case et.onnx.TensorProto.DataType.INT16:return ut.getInt16(ht,!0);case et.onnx.TensorProto.DataType.FLOAT:return ut.getFloat32(ht,!0);case et.onnx.TensorProto.DataType.INT32:return ut.getInt32(ht,!0);case et.onnx.TensorProto.DataType.UINT32:return ut.getUint32(ht,!0);case et.onnx.TensorProto.DataType.INT64:return at(xe.default.fromBits(ut.getUint32(ht,!0),ut.getUint32(ht+4,!0),!1),dt);case et.onnx.TensorProto.DataType.DOUBLE:return ut.getFloat64(ht,!0);case et.onnx.TensorProto.DataType.UINT64:return at(xe.default.fromBits(ut.getUint32(ht,!0),ut.getUint32(ht+4,!0),!0),dt);default:throw new Error(`cannot read from DataView for type ${et.onnx.TensorProto.DataType[dt]}`)}}O.Tensor=ot},2517:function(ee,O,Y){var te=this&&this.__importDefault||function(dt){return dt&&dt.__esModule?dt:{default:dt}};Object.defineProperty(O,"__esModule",{value:!0}),O.decodeUtf8String=O.MAX_CLIP=O.MIN_CLIP=O.PoolConvUtil=O.ReduceUtil=O.SplitUtil=O.MathUtil=O.ShapeUtil=O.LongUtil=O.ProtoUtil=O.GemmUtil=O.arrayCopyHelper=O.BroadcastUtil=O.MatMulUtil=O.ArrayUtil=O.assert=O.checkInputsShape=void 0;const ne=Y(5686),xe=te(Y(3720)),et=Y(1446),tt=Y(9162);O.checkInputsShape=function(dt,...ht){if(!dt||dt.length!==ht.length)return!1;for(let pt=0;pt<dt.length;pt++)if(!dt[pt].dims||dt[pt].dims.length!==ht[pt])return!1;return!0},O.assert=function(dt,ht){if(!dt)throw new Error(typeof ht=="string"?ht:ht())},O.ArrayUtil=class{static arraysEqual(dt,ht){if(dt.length!==ht.length)return!1;for(let pt=0;pt<dt.length;pt++)if(dt[pt]!==ht[pt])return!1;return!0}};class it{static preprocessInputShapes(ht,pt){return[ht.length===1?[1,ht[0]]:ht,pt.length===1?[pt[0],1]:pt]}static postprocessOutputShape(ht,pt,ft){pt===1&&ht.splice(ht.length-2,1),ft===1&&ht.pop()}static calcMatMulShape(ht,pt){return ht[1]!==pt[0]?void 0:[ht[0],pt[1]]}}O.MatMulUtil=it;class st{static calcShape(ht,pt,ft=!1){const mt=ht.length,yt=pt.length;if(mt===0)return pt;if(yt===0)return ht;const bt=Math.max(ht.length,pt.length),vt=new Array(bt);if(ft){if(mt<2||yt<2)return;const Et=it.calcMatMulShape([ht[mt-2],ht[mt-1]],[pt[yt-2],pt[yt-1]]);if(Et===void 0)return;[vt[bt-2],vt[bt-1]]=Et}for(let Et=ft?3:1;Et<=bt;Et++){const wt=mt-Et<0?1:ht[mt-Et],St=yt-Et<0?1:pt[yt-Et];if(wt!==St&&wt>1&&St>1)return;vt[bt-Et]=Math.max(wt,St)}return vt}static index(ht,pt){const ft=new Array(pt.length);return st.fillIndex(ht,pt,ft),ft}static fillIndex(ht,pt,ft){const mt=ht.length-pt.length;for(let yt=0;yt<pt.length;yt++)ft[yt]=ht[mt+yt]%pt[yt]}static calc(ht,pt,ft,mt,yt){const bt=st.calcShape(ht.dims,pt.dims);if(bt){if(mt&&!nt.areEqual(bt,ht.dims))return;const vt=nt.size(bt),Et=mt?ht:new tt.Tensor(bt,yt||ht.type);if(bt.length===0)Et.set([],ft(ht.get([]),pt.get([])));else{const wt=new Array(bt.length),St=new Array(ht.dims.length),Ot=new Array(pt.dims.length);let $t,Mt=0,Nt=0,Rt=!1,Pt=!1;ht.dims.length===0&&(Mt=ht.get([]),Rt=!0),pt.dims.length===0&&(Nt=pt.get([]),Pt=!0);for(let kt=0;kt<vt;kt++){$t=kt;for(let Wt=bt.length-1;Wt>=0;Wt--)wt[Wt]=$t%bt[Wt],$t=Math.floor($t/bt[Wt]);Rt||(st.fillIndex(wt,ht.dims,St),Mt=ht.get(St)),Pt||(st.fillIndex(wt,pt.dims,Ot),Nt=pt.get(Ot)),Et.set(wt,ft(Mt,Nt))}}return Et}}static isValidBroadcast(ht,pt){const ft=ht.length,mt=pt.length;if(ft>mt)return!1;for(let yt=1;yt<=ft;yt++)if(ht[ft-yt]!==1&&ht[ft-yt]!==pt[mt-yt])return!1;return!0}static getBroadcastDims(ht,pt){const ft=ht.length,mt=[];for(let yt=0;yt<ft;yt++){const bt=ft-1-yt,vt=ht[bt]||1;(pt[pt.length-1-yt]||1)>1&&vt===1&&mt.unshift(bt)}return mt}}O.BroadcastUtil=st,O.arrayCopyHelper=function(dt,ht,pt,ft,mt){if(ft<0||ft>=ht.length)throw new Error("sourceIndex out of bounds");if(pt<0||pt>=dt.length)throw new Error("targetIndex out of bounds");if(ft+mt>ht.length)throw new Error("source indices to be copied are outside bounds");if(pt+mt>dt.length)throw new Error("target array is too small to hold result");for(let yt=0;yt<mt;yt++)dt[pt+yt]=ht[ft+yt]},O.GemmUtil=class{static getShapeOfGemmResult(dt,ht,pt,ft,mt){if(dt.length!==2||pt.length!==2)throw new Error("shape need to be of size 2");let yt,bt,vt;ht?(yt=dt[1],bt=dt[0]):(yt=dt[0],bt=dt[1]);let Et=-1;if(ft?(vt=pt[0],Et=1):(vt=pt[1],Et=0),pt[Et]!==bt)throw new Error("dimension mismatch");if(yt<=0||vt<=0||bt<=0)throw new Error("invalid shape specified");if(mt&&!st.isValidBroadcast(mt,[yt,vt]))throw new Error("gemm: invalid bias shape for broadcast");return[yt,vt,bt]}};class ot{static tensorDataTypeFromProto(ht){switch(ht){case et.onnx.TensorProto.DataType.INT8:return"int8";case et.onnx.TensorProto.DataType.UINT8:return"uint8";case et.onnx.TensorProto.DataType.BOOL:return"bool";case et.onnx.TensorProto.DataType.INT16:return"int16";case et.onnx.TensorProto.DataType.UINT16:return"uint16";case et.onnx.TensorProto.DataType.INT32:return"int32";case et.onnx.TensorProto.DataType.UINT32:return"uint32";case et.onnx.TensorProto.DataType.FLOAT:return"float32";case et.onnx.TensorProto.DataType.DOUBLE:return"float64";case et.onnx.TensorProto.DataType.STRING:return"string";case et.onnx.TensorProto.DataType.INT64:return"int32";case et.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw new Error(`unsupported data type: ${et.onnx.TensorProto.DataType[ht]}`)}}static tensorDataTypeStringToEnum(ht){switch(ht){case"int8":return et.onnx.TensorProto.DataType.INT8;case"uint8":return et.onnx.TensorProto.DataType.UINT8;case"bool":return et.onnx.TensorProto.DataType.BOOL;case"int16":return et.onnx.TensorProto.DataType.INT16;case"uint16":return et.onnx.TensorProto.DataType.UINT16;case"int32":return et.onnx.TensorProto.DataType.INT32;case"uint32":return et.onnx.TensorProto.DataType.UINT32;case"float32":return et.onnx.TensorProto.DataType.FLOAT;case"float64":return et.onnx.TensorProto.DataType.DOUBLE;case"string":return et.onnx.TensorProto.DataType.STRING;case"int64":return et.onnx.TensorProto.DataType.INT64;case"uint64":return et.onnx.TensorProto.DataType.UINT64;default:throw new Error(`unsupported data type: ${ht}`)}}static tensorDimsFromProto(ht){return ht.map((pt=>xe.default.isLong(pt)?pt.toNumber():pt))}static tensorValueTypeFromProto(ht){return{tensorType:ot.tensorDataTypeFromProto(ht.elemType),shape:{dims:ot.tensorDimsFromProto(ht.shape.dim.map((pt=>pt.dimValue)))}}}static tensorDimsFromORTFormat(ht){const pt=[];for(let ft=0;ft<ht.dimsLength();ft++)pt.push(rt.longToNumber(ht.dims(ft)));return pt}static tensorAttributesFromORTFormat(ht){const pt=[];for(let ft=0;ft<ht.attributesLength();ft++)pt.push(ht.attributes(ft));return pt}}O.ProtoUtil=ot;class rt{static longToNumber(ht,pt){return xe.default.isLong(ht)?ht.toNumber():ht instanceof ne.flatbuffers.Long?xe.default.fromValue({low:ht.low,high:ht.high,unsigned:pt!=null&&pt}).toNumber():ht}static isLong(ht){return xe.default.isLong(ht)||ht instanceof ne.flatbuffers.Long}}O.LongUtil=rt;class nt{static size(ht){return nt.getSizeFromDimensionRange(ht,0,ht.length)}static sizeFromDimension(ht,pt){if(pt<0||pt>ht.length)throw new Error(`invalid dimension of ${pt} for sizeFromDimension as Tensor has ${ht.length} dimensions.`);return nt.getSizeFromDimensionRange(ht,pt,ht.length)}static sizeToDimension(ht,pt){if(pt<0||pt>ht.length)throw new Error(`invalid dimension of ${pt} for sizeToDimension as Tensor has ${ht.length} dimensions.`);return nt.getSizeFromDimensionRange(ht,0,pt)}static getSizeFromDimensionRange(ht,pt,ft){let mt=1;for(let yt=pt;yt<ft;yt++){if(ht[yt]<=0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");mt*=ht[yt]}return mt}static computeStrides(ht){const pt=ht.length;if(pt===0)return[];if(pt===1)return[1];const ft=new Array(pt);ft[pt-1]=1,ft[pt-2]=ht[pt-1];for(let mt=pt-3;mt>=0;--mt)ft[mt]=ft[mt+1]*ht[mt+1];return ft}static transpose(ht){return ht.slice().reverse()}static indicesToOffset(ht,pt,ft){ft===void 0&&(ft=ht.length);let mt=0;for(let yt=0;yt<ft;++yt)mt+=pt[yt]*ht[yt];return mt}static offsetToIndices(ht,pt){const ft=pt.length;if(ft===0)return[];if(ft===1)return[ht*pt[0]];const mt=new Array(pt.length);for(let yt=0;yt<mt.length-1;++yt)mt[yt]=Math.floor(ht/pt[yt]),ht-=mt[yt]*pt[yt];return mt[mt.length-1]=ht,mt}static normalizeAxis(ht,pt){if(ht<-pt&&ht>=pt)throw new Error("unsupported axis for this operation.");return ht<0?ht+pt:ht}static normalizeAxes(ht,pt){return ht.map((ft=>this.normalizeAxis(ft,pt)))}static incrementIndex(ht,pt,ft){if(pt.length===0||ht.length===0)throw new Error("Index incrementing unsupported for scalar Tensor");if(ft===void 0)ft=pt.length;else if(ft<=0||ft>pt.length)throw new Error("Incorrect axis to increment on");for(let mt=ft-1;mt>=0&&(ht[mt]++,!(ht[mt]<pt[mt]));--mt)ht[mt]=0}static calculateReshapedDims(ht,pt){if(pt.length===0){if(ht.length===0||nt.size(ht)===1)return[];throw new Error("cannot reshape to a scalar Tensor")}const ft=pt.length,mt=new Array(ft);let yt=-1,bt=1;for(let Et=0;Et<ft;Et++){if(pt[Et]<-1)throw new Error("a dimension in shape hints cannot be less than -1");if(pt[Et]===-1){if(yt!==-1)throw new Error("at most one dimension in shape hints can be -1");yt=Et}else{if(pt[Et]===0){if(Et>=ht.length)throw new Error("the dimension with value zero exceeds the dimension size of the input tensor");mt[Et]=ht[Et]}else mt[Et]=pt[Et];bt*=mt[Et]}}const vt=nt.size(ht);if(yt!==-1){if(vt%bt!=0)throw new Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${ht}] Output shape: [${pt}]`);mt[yt]=vt/bt}else if(bt!==vt)throw new Error("reshapedDims and originalDims don't have matching sizes");return mt}static sortBasedOnPerm(ht,pt){return pt?pt.map((ft=>ht[ft])):ht.slice().reverse()}static padShape(ht,pt){const ft=ht.length;return ht.map(((mt,yt)=>mt+pt[yt]+pt[yt+ft]))}static areEqual(ht,pt){return ht.length===pt.length&&ht.every(((ft,mt)=>ft===pt[mt]))}static validateDimsAndCalcSize(ht){if(ht.length>6)throw new TypeError("Only rank 0 to 6 is supported for tensor shape.");let pt=1;for(const ft of ht){if(!Number.isInteger(ft))throw new TypeError(`Invalid shape: ${ft} is not an integer`);if(ft<0||ft>2147483647)throw new TypeError(`Invalid shape: length ${ft} is not allowed`);pt*=ft}return pt}static flattenShape(ht,pt){pt<0&&(pt+=ht.length);const ft=ht.reduce(((yt,bt)=>yt*bt),1),mt=ht.slice(pt).reduce(((yt,bt)=>yt*bt),1);return[ft/mt,mt]}static squeezeShape(ht,pt){const ft=new Array;pt=nt.normalizeAxes(pt,ht.length);for(let mt=0;mt<ht.length;mt++){const yt=pt.indexOf(mt)>=0;if(yt&&ht[mt]!==1)throw new Error("squeeze an axis of size different than 1");(pt.length===0&&ht[mt]>1||pt.length>0&&!yt)&&ft.push(ht[mt])}return ft}static unsqueezeShape(ht,pt){const ft=new Array(ht.length+pt.length);ft.fill(0);for(let yt=0;yt<pt.length;yt++){const bt=nt.normalizeAxis(pt[yt],ft.length);if(bt>=ft.length)throw new Error("'axes' has an out of range axis");if(ft[bt]!==0)throw new Error("'axes' has a duplicate axis");ft[bt]=1}let mt=0;for(let yt=0;yt<ft.length;yt++)ft[yt]===0&&(ft[yt]=ht[mt++]);if(mt!==ht.length)throw new Error("the unsqueezed dimension could not be established");return ft}}O.ShapeUtil=nt,O.MathUtil=class{static sqr(dt,ht,pt,ft,mt){if(ft<0||ft>=ht.length)throw new Error("sourceIndex out of bounds");if(pt<0||pt>=dt.length)throw new Error("targetIndex out of bounds");if(ft+mt>ht.length)throw new Error("source indices to be copied are outside bounds");if(pt+mt>dt.length)throw new Error("target array is too small to hold result");for(let yt=0;yt<mt;yt++)dt[pt+yt]+=Math.pow(ht[ft+yt],2)}static axpy(dt,ht,pt,ft,mt,yt){if(ft<0||ft>=ht.length)throw new Error("sourceIndex out of bounds");if(pt<0||pt>=dt.length)throw new Error("targetIndex out of bounds");if(ft+mt>ht.length)throw new Error("source indices to be copied are outside bounds");if(pt+mt>dt.length)throw new Error("target array is too small to hold result");for(let bt=0;bt<mt;bt++)dt[pt+bt]+=yt*ht[ft+bt]}static powx(dt,ht,pt,ft,mt,yt){if(ft<0||ft>=ht.length)throw new Error("sourceIndex out of bounds");if(pt<0||pt>=dt.length)throw new Error("targetIndex out of bounds");if(ft+mt>ht.length)throw new Error("source indices to be copied are outside bounds");if(pt+mt>dt.length)throw new Error("target array is too small to hold result");for(let bt=0;bt<mt;bt++)dt[pt+bt]=Math.pow(ht[ft+bt],yt)}static mul(dt,ht,pt,ft,mt){if(ft<0||ft>=ht.length)throw new Error("sourceIndex out of bounds");if(pt<0||pt>=dt.length)throw new Error("targetIndex out of bounds");if(ft+mt>ht.length)throw new Error("source indices to be copied are outside bounds");if(pt+mt>dt.length)throw new Error("target array is too small to hold result");for(let yt=0;yt<mt;yt++)dt[pt+yt]=ht[ft+yt]*dt[pt+yt]}};class at{static splitShape(ht,pt,ft,mt){if(ft.length===0){if(!mt)throw new Error("need to know number of outputs when the 'split' attribute is not specified");at.determineSplit(ht[pt],mt,ft)}const yt=[],bt=[0];for(let vt=0;vt<ft.length;++vt){vt!==0&&bt.push(bt[vt-1]+ft[vt-1]);const Et=ht.slice();Et[pt]=ft[vt],yt.push(Et)}return[yt,bt]}static determineSplit(ht,pt,ft){if(ht%pt!=0)throw new Error("cannot split tensor to equal sized parts");for(let mt=0;mt<pt;++mt)ft.push(ht/pt)}}O.SplitUtil=at;class ct{static calcReduce(ht,pt,ft,mt,yt){const bt=ht.dims.slice(0);pt.length===0&&bt.forEach(((Mt,Nt)=>pt.push(Nt)));const vt=ct.calcReduceShape(bt,pt,!0),Et=nt.size(vt),wt=new tt.Tensor(vt,ht.type),St=nt.computeStrides(vt),Ot=nt.computeStrides(bt),$t=new Array(bt.length);for(let Mt=0;Mt<Et;Mt++){const Nt=nt.offsetToIndices(Mt,St);st.fillIndex(Nt,bt,$t),wt.set(Nt,ct.calcReduceByAxis(ht.numberData,pt,bt,0,nt.indicesToOffset($t,Ot),mt,yt))}return ft?wt:new tt.Tensor(ct.calcReduceShape(bt,pt,ft),wt.type,void 0,void 0,wt.data,wt.dataId)}static calcReduceByAxis(ht,pt,ft,mt,yt,bt,vt){let Et=0;if(mt>=pt.length)return bt(ht[yt]);const wt=pt[mt],St=wt>=ft.length?1:nt.size(ft.slice(wt+1));for(let Ot=0;Ot<ft[wt];Ot++)Et=Ot===0?ct.calcReduceByAxis(ht,pt,ft,mt+1,yt,bt,vt):vt(Et,ct.calcReduceByAxis(ht,pt,ft,mt+1,yt,bt,vt)),yt+=St;return Et}static calcReduceShape(ht,pt,ft){const mt=ht.slice();for(let yt=0;yt<pt.length;yt++)mt[pt[yt]]=ft?1:0;return mt.filter((yt=>yt!==0))}}O.ReduceUtil=ct;class ut{static adjustPoolAttributes(ht,pt,ft,mt,yt,bt){if(!ht&&ft.length!==pt.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(ht)for(let vt=0;vt<pt.length-2;vt++)vt>=ft.length?ft.push(pt[vt+2]):ft[vt]=pt[vt+2];for(let vt=0;vt<ft.length;vt++)if(vt<mt.length){if(mt[vt]<0)throw new Error("strides should be greater than or equal to 1")}else mt.push(1);for(let vt=0;vt<ft.length;vt++)if(vt<yt.length){if(yt[vt]<0)throw new Error("dilations should be greater than or equal to 1")}else yt.push(1);for(let vt=0;vt<2*ft.length;vt++)if(vt<bt.length){if(bt[vt]<0)throw new Error("pad should be greater than or equal to 1")}else bt.push(0);for(let vt=0;vt<ft.length;vt++){if(ft[vt]<=0)throw new Error("kernel shapes need to be greater than 0");if(bt[vt]>=ft[vt]||bt[vt+ft.length]>=ft[vt])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(ht,pt,ft,mt,yt,bt){if(bt){if(yt.length!==2*(ht.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(pt.length!==ht.length-2)throw new Error("length of strides should be the length of data dimensions");if(mt.length!==ht.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let vt=0;vt<ht.length-2;vt++)ut.adjustPadAndReturnShape(ht[vt+2],pt[vt],ft[vt],mt[vt],yt,vt,vt+ht.length-2,bt)}}static computePoolOutputShape(ht,pt,ft,mt,yt,bt,vt){if(pt.length<=0)throw new Error("input shape must be of size greater than 0");const Et=[pt[0],pt[1]];return ut.computeShapeHelper(ht,pt,Et,ft,mt,yt,bt,vt),Et}static computeConvOutputShape(ht,pt,ft,mt,yt,bt,vt){if(ht.length<=0||pt.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");const Et=[ht[0],pt[0]];return ut.computeShapeHelper(!1,ht,Et,ft,mt,yt,bt,vt),Et}static computeShapeHelper(ht,pt,ft,mt,yt,bt,vt,Et){if(ht)for(let wt=0;wt<pt.length-2;wt++)ft.push(1);else for(let wt=0;wt<pt.length-2;wt++)ft.push(ut.adjustPadAndReturnShape(pt[wt+2],mt[wt],yt[wt],bt[wt],vt,wt,wt+pt.length-2,Et))}static adjustPadAndReturnShape(ht,pt,ft,mt,yt,bt,vt,Et){const wt=ft*(mt-1)+1;if(!Et||Et==="NOTSET")return Math.floor((ht+yt[bt]+yt[vt]-wt)/pt+1);switch(Et){case"VALID":return yt[bt]=0,yt[vt]=0,Math.floor((ht-wt)/pt+1);case"SAME_LOWER":case"SAME_UPPER":if(ft!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{const St=((ht+pt-1)/pt-1)*pt+mt-ht;return yt[bt]=Math.floor(Et==="SAME_LOWER"?(St+1)/2:St/2),yt[vt]=St-yt[bt],Math.floor((ht+St-mt)/pt+1)}default:throw new Error("Unsupported AutoPad type")}}}O.PoolConvUtil=ut,O.MIN_CLIP=-34028234663852886e22,O.MAX_CLIP=34028234663852886e22,O.decodeUtf8String=function(dt){return new TextDecoder().decode(dt)}},7967:(ee,O)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.iterateExtraOptions=void 0,O.iterateExtraOptions=(Y,te,ne,xe)=>{if(typeof Y=="object"&&Y!==null){if(ne.has(Y))throw new Error("Circular reference in options");ne.add(Y)}Object.entries(Y).forEach((([et,tt])=>{const it=te?te+et:et;if(typeof tt=="object")(0,O.iterateExtraOptions)(tt,it+".",ne,xe);else if(typeof tt=="string"||typeof tt=="number")xe(it,tt.toString());else{if(typeof tt!="boolean")throw new Error("Can't handle extra config type: "+typeof tt);xe(it,tt?"1":"0")}}))}},2157:function(ee,O,Y){var te,ne=this&&this.__createBinding||(Object.create?function(St,Ot,$t,Mt){Mt===void 0&&(Mt=$t);var Nt=Object.getOwnPropertyDescriptor(Ot,$t);Nt&&!("get"in Nt?!Ot.__esModule:Nt.writable||Nt.configurable)||(Nt={enumerable:!0,get:function(){return Ot[$t]}}),Object.defineProperty(St,Mt,Nt)}:function(St,Ot,$t,Mt){Mt===void 0&&(Mt=$t),St[Mt]=Ot[$t]}),xe=this&&this.__setModuleDefault||(Object.create?function(St,Ot){Object.defineProperty(St,"default",{enumerable:!0,value:Ot})}:function(St,Ot){St.default=Ot}),et=this&&this.__importStar||function(St){if(St&&St.__esModule)return St;var Ot={};if(St!=null)for(var $t in St)$t!=="default"&&Object.prototype.hasOwnProperty.call(St,$t)&&ne(Ot,St,$t);return xe(Ot,St),Ot};Object.defineProperty(O,"__esModule",{value:!0}),O.endProfiling=O.run=O.releaseSession=O.createSession=O.createSessionFinalize=O.createSessionAllocate=O.initOrt=O.initWasm=void 0;const tt=Y(1670),it=et(Y(349)),st=Y(6361),ot=()=>!!tt.env.wasm.proxy&&typeof document<"u";let rt,nt,at,ct=!1,ut=!1,dt=!1;const ht=[],pt=[],ft=[],mt=[],yt=[],bt=[],vt=()=>{if(ct||!ut||dt||!rt)throw new Error("worker not ready")},Et=St=>{switch(St.data.type){case"init-wasm":ct=!1,St.data.err?(dt=!0,nt[1](St.data.err)):(ut=!0,nt[0]());break;case"init-ort":St.data.err?at[1](St.data.err):at[0]();break;case"create_allocate":St.data.err?ht.shift()[1](St.data.err):ht.shift()[0](St.data.out);break;case"create_finalize":St.data.err?pt.shift()[1](St.data.err):pt.shift()[0](St.data.out);break;case"create":St.data.err?ft.shift()[1](St.data.err):ft.shift()[0](St.data.out);break;case"release":St.data.err?mt.shift()[1](St.data.err):mt.shift()[0]();break;case"run":St.data.err?yt.shift()[1](St.data.err):yt.shift()[0](St.data.out);break;case"end-profiling":St.data.err?bt.shift()[1](St.data.err):bt.shift()[0]()}},wt=typeof document<"u"?(te=document?.currentScript)===null||te===void 0?void 0:te.src:void 0;O.initWasm=async()=>{if(ot()){if(ut)return;if(ct)throw new Error("multiple calls to 'initWasm()' detected.");if(dt)throw new Error("previous call to 'initWasm()' failed.");return ct=!0,tt.env.wasm.wasmPaths===void 0&&wt&&wt.indexOf("blob:")!==0&&(tt.env.wasm.wasmPaths=wt.substr(0,+wt.lastIndexOf("/")+1)),new Promise(((St,Ot)=>{rt?.terminate(),rt=Y(9710).Z(),rt.onmessage=Et,nt=[St,Ot];const $t={type:"init-wasm",in:tt.env.wasm};rt.postMessage($t)}))}return(0,st.initializeWebAssembly)(tt.env.wasm)},O.initOrt=async(St,Ot)=>{if(ot())return vt(),new Promise((($t,Mt)=>{at=[$t,Mt];const Nt={type:"init-ort",in:{numThreads:St,loggingLevel:Ot}};rt.postMessage(Nt)}));it.initOrt(St,Ot)},O.createSessionAllocate=async St=>ot()?(vt(),new Promise(((Ot,$t)=>{ht.push([Ot,$t]);const Mt={type:"create_allocate",in:{model:St}};rt.postMessage(Mt,[St.buffer])}))):it.createSessionAllocate(St),O.createSessionFinalize=async(St,Ot)=>ot()?(vt(),new Promise((($t,Mt)=>{pt.push([$t,Mt]);const Nt={type:"create_finalize",in:{modeldata:St,options:Ot}};rt.postMessage(Nt)}))):it.createSessionFinalize(St,Ot),O.createSession=async(St,Ot)=>ot()?(vt(),new Promise((($t,Mt)=>{ft.push([$t,Mt]);const Nt={type:"create",in:{model:St,options:Ot}};rt.postMessage(Nt,[St.buffer])}))):it.createSession(St,Ot),O.releaseSession=async St=>{if(ot())return vt(),new Promise(((Ot,$t)=>{mt.push([Ot,$t]);const Mt={type:"release",in:St};rt.postMessage(Mt)}));it.releaseSession(St)},O.run=async(St,Ot,$t,Mt,Nt)=>ot()?(vt(),new Promise(((Rt,Pt)=>{yt.push([Rt,Pt]);const kt={type:"run",in:{sessionId:St,inputIndices:Ot,inputs:$t,outputIndices:Mt,options:Nt}};rt.postMessage(kt,it.extractTransferableBuffers($t))}))):it.run(St,Ot,$t,Mt,Nt),O.endProfiling=async St=>{if(ot())return vt(),new Promise(((Ot,$t)=>{bt.push([Ot,$t]);const Mt={type:"end-profiling",in:St};rt.postMessage(Mt)}));it.endProfiling(St)}},586:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.setRunOptions=void 0;const te=Y(7967),ne=Y(4983),xe=Y(6361);O.setRunOptions=et=>{const tt=(0,xe.getInstance)();let it=0;const st=[],ot=et||{};try{if(et?.logSeverityLevel===void 0)ot.logSeverityLevel=2;else if(typeof et.logSeverityLevel!="number"||!Number.isInteger(et.logSeverityLevel)||et.logSeverityLevel<0||et.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${et.logSeverityLevel}`);if(et?.logVerbosityLevel===void 0)ot.logVerbosityLevel=0;else if(typeof et.logVerbosityLevel!="number"||!Number.isInteger(et.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${et.logVerbosityLevel}`);et?.terminate===void 0&&(ot.terminate=!1);let rt=0;if(et?.tag!==void 0&&(rt=(0,ne.allocWasmString)(et.tag,st)),it=tt._OrtCreateRunOptions(ot.logSeverityLevel,ot.logVerbosityLevel,!!ot.terminate,rt),it===0)throw new Error("Can't create run options");return et?.extra!==void 0&&(0,te.iterateExtraOptions)(et.extra,"",new WeakSet,((nt,at)=>{const ct=(0,ne.allocWasmString)(nt,st),ut=(0,ne.allocWasmString)(at,st);if(tt._OrtAddRunConfigEntry(it,ct,ut)!==0)throw new Error(`Can't set a run config entry: ${nt} - ${at}`)})),[it,st]}catch(rt){throw it!==0&&tt._OrtReleaseRunOptions(it),st.forEach(tt._free),rt}}},2306:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.OnnxruntimeWebAssemblySessionHandler=void 0;const te=Y(2806),ne=Y(1670),xe=Y(2850),et=Y(2157);let tt;O.OnnxruntimeWebAssemblySessionHandler=class{async createSessionAllocate(it){const st=await fetch(it),ot=await st.arrayBuffer();return(0,et.createSessionAllocate)(new Uint8Array(ot))}async loadModel(it,st){if(tt||(await(0,et.initOrt)(ne.env.wasm.numThreads,(ot=>{switch(ot){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${ot}`)}})(ne.env.logLevel)),tt=!0),typeof it=="string")if(typeof fetch>"u"){const ot=await(0,xe.promisify)(te.readFile)(it);[this.sessionId,this.inputNames,this.outputNames]=await(0,et.createSession)(ot,st)}else{const ot=await this.createSessionAllocate(it);[this.sessionId,this.inputNames,this.outputNames]=await(0,et.createSessionFinalize)(ot,st)}else[this.sessionId,this.inputNames,this.outputNames]=await(0,et.createSession)(it,st)}async dispose(){return(0,et.releaseSession)(this.sessionId)}async run(it,st,ot){const rt=[],nt=[];Object.entries(it).forEach((dt=>{const ht=dt[0],pt=dt[1],ft=this.inputNames.indexOf(ht);if(ft===-1)throw new Error(`invalid input '${ht}'`);rt.push(pt),nt.push(ft)}));const at=[];Object.entries(st).forEach((dt=>{const ht=dt[0],pt=this.outputNames.indexOf(ht);if(pt===-1)throw new Error(`invalid output '${ht}'`);at.push(pt)}));const ct=await(0,et.run)(this.sessionId,nt,rt.map((dt=>[dt.type,dt.dims,dt.data])),at,ot),ut={};for(let dt=0;dt<ct.length;dt++)ut[this.outputNames[at[dt]]]=new ne.Tensor(ct[dt][0],ct[dt][2],ct[dt][1]);return ut}startProfiling(){}endProfiling(){(0,et.endProfiling)(this.sessionId)}}},4919:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.setSessionOptions=void 0;const te=Y(7967),ne=Y(4983),xe=Y(6361);O.setSessionOptions=et=>{const tt=(0,xe.getInstance)();let it=0;const st=[],ot=et||{};(rt=>{rt.extra||(rt.extra={}),rt.extra.session||(rt.extra.session={});const nt=rt.extra.session;nt.use_ort_model_bytes_directly||(nt.use_ort_model_bytes_directly="1")})(ot);try{et?.graphOptimizationLevel===void 0&&(ot.graphOptimizationLevel="all");const rt=(ct=>{switch(ct){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${ct}`)}})(ot.graphOptimizationLevel);et?.enableCpuMemArena===void 0&&(ot.enableCpuMemArena=!0),et?.enableMemPattern===void 0&&(ot.enableMemPattern=!0),et?.executionMode===void 0&&(ot.executionMode="sequential");const nt=(ct=>{switch(ct){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${ct}`)}})(ot.executionMode);let at=0;if(et?.logId!==void 0&&(at=(0,ne.allocWasmString)(et.logId,st)),et?.logSeverityLevel===void 0)ot.logSeverityLevel=2;else if(typeof et.logSeverityLevel!="number"||!Number.isInteger(et.logSeverityLevel)||et.logSeverityLevel<0||et.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${et.logSeverityLevel}`);if(et?.logVerbosityLevel===void 0)ot.logVerbosityLevel=0;else if(typeof et.logVerbosityLevel!="number"||!Number.isInteger(et.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${et.logVerbosityLevel}`);if(et?.enableProfiling===void 0&&(ot.enableProfiling=!1),it=tt._OrtCreateSessionOptions(rt,!!ot.enableCpuMemArena,!!ot.enableMemPattern,nt,!!ot.enableProfiling,0,at,ot.logSeverityLevel,ot.logVerbosityLevel),it===0)throw new Error("Can't create session options");return et?.executionProviders&&((ct,ut,dt)=>{for(const ht of ut){let pt=typeof ht=="string"?ht:ht.name;switch(pt){case"xnnpack":pt="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${pt}`)}const ft=(0,ne.allocWasmString)(pt,dt);if((0,xe.getInstance)()._OrtAppendExecutionProvider(ct,ft)!==0)throw new Error(`Can't append execution provider: ${pt}`)}})(it,et.executionProviders,st),et?.extra!==void 0&&(0,te.iterateExtraOptions)(et.extra,"",new WeakSet,((ct,ut)=>{const dt=(0,ne.allocWasmString)(ct,st),ht=(0,ne.allocWasmString)(ut,st);if(tt._OrtAddSessionConfigEntry(it,dt,ht)!==0)throw new Error(`Can't set a session config entry: ${ct} - ${ut}`)})),[it,st]}catch(rt){throw it!==0&&tt._OrtReleaseSessionOptions(it),st.forEach(tt._free),rt}}},4983:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.allocWasmString=void 0;const te=Y(6361);O.allocWasmString=(ne,xe)=>{const et=(0,te.getInstance)(),tt=et.lengthBytesUTF8(ne)+1,it=et._malloc(tt);return et.stringToUTF8(ne,it,tt),xe.push(it),it}},349:(ee,O,Y)=>{Object.defineProperty(O,"__esModule",{value:!0}),O.extractTransferableBuffers=O.endProfiling=O.run=O.releaseSession=O.createSession=O.createSessionFinalize=O.createSessionAllocate=O.initOrt=void 0;const te=Y(586),ne=Y(4919),xe=Y(4983),et=Y(6361);O.initOrt=(rt,nt)=>{const at=(0,et.getInstance)()._OrtInit(rt,nt);if(at!==0)throw new Error(`Can't initialize onnxruntime. error code = ${at}`)};const tt=new Map;O.createSessionAllocate=rt=>{const nt=(0,et.getInstance)(),at=nt._malloc(rt.byteLength);return nt.HEAPU8.set(rt,at),[at,rt.byteLength]},O.createSessionFinalize=(rt,nt)=>{const at=(0,et.getInstance)();let ct=0,ut=0,dt=[];try{if([ut,dt]=(0,ne.setSessionOptions)(nt),ct=at._OrtCreateSession(rt[0],rt[1],ut),ct===0)throw new Error("Can't create a session")}finally{at._free(rt[0]),at._OrtReleaseSessionOptions(ut),dt.forEach(at._free)}const ht=at._OrtGetInputCount(ct),pt=at._OrtGetOutputCount(ct),ft=[],mt=[],yt=[],bt=[];for(let vt=0;vt<ht;vt++){const Et=at._OrtGetInputName(ct,vt);if(Et===0)throw new Error("Can't get an input name");mt.push(Et),ft.push(at.UTF8ToString(Et))}for(let vt=0;vt<pt;vt++){const Et=at._OrtGetOutputName(ct,vt);if(Et===0)throw new Error("Can't get an output name");bt.push(Et),yt.push(at.UTF8ToString(Et))}return tt.set(ct,[ct,mt,bt]),[ct,ft,yt]},O.createSession=(rt,nt)=>{const at=(0,O.createSessionAllocate)(rt);return(0,O.createSessionFinalize)(at,nt)},O.releaseSession=rt=>{const nt=(0,et.getInstance)(),at=tt.get(rt);if(!at)throw new Error("invalid session id");const ct=at[0],ut=at[1],dt=at[2];ut.forEach(nt._OrtFree),dt.forEach(nt._OrtFree),nt._OrtReleaseSession(ct),tt.delete(rt)};const it=rt=>{switch(rt){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${rt}`)}},st=rt=>{switch(rt){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${rt}`)}},ot=rt=>{switch(rt){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${rt}`)}};O.run=(rt,nt,at,ct,ut)=>{const dt=(0,et.getInstance)(),ht=tt.get(rt);if(!ht)throw new Error("invalid session id");const pt=ht[0],ft=ht[1],mt=ht[2],yt=nt.length,bt=ct.length;let vt=0,Et=[];const wt=[],St=[];try{[vt,Et]=(0,te.setRunOptions)(ut);for(let Pt=0;Pt<yt;Pt++){const kt=at[Pt][0],Wt=at[Pt][1],zt=at[Pt][2];let Kt,qt;if(Array.isArray(zt)){qt=4*zt.length,Kt=dt._malloc(qt),St.push(Kt);let pn=Kt/4;for(let ln=0;ln<zt.length;ln++){if(typeof zt[ln]!="string")throw new TypeError(`tensor data at index ${ln} is not a string`);dt.HEAPU32[pn++]=(0,xe.allocWasmString)(zt[ln],St)}}else qt=zt.byteLength,Kt=dt._malloc(qt),St.push(Kt),dt.HEAPU8.set(new Uint8Array(zt.buffer,zt.byteOffset,qt),Kt);const Xt=dt.stackSave(),an=dt.stackAlloc(4*Wt.length);try{let pn=an/4;Wt.forEach((dn=>dt.HEAP32[pn++]=dn));const ln=dt._OrtCreateTensor(it(kt),Kt,qt,an,Wt.length);if(ln===0)throw new Error("Can't create a tensor");wt.push(ln)}finally{dt.stackRestore(Xt)}}const Ot=dt.stackSave(),$t=dt.stackAlloc(4*yt),Mt=dt.stackAlloc(4*yt),Nt=dt.stackAlloc(4*bt),Rt=dt.stackAlloc(4*bt);try{let Pt=$t/4,kt=Mt/4,Wt=Nt/4,zt=Rt/4;for(let Xt=0;Xt<yt;Xt++)dt.HEAPU32[Pt++]=wt[Xt],dt.HEAPU32[kt++]=ft[nt[Xt]];for(let Xt=0;Xt<bt;Xt++)dt.HEAPU32[Wt++]=0,dt.HEAPU32[zt++]=mt[ct[Xt]];let Kt=dt._OrtRun(pt,Mt,$t,yt,Rt,bt,Nt,vt);const qt=[];if(Kt===0)for(let Xt=0;Xt<bt;Xt++){const an=dt.HEAPU32[Nt/4+Xt],pn=dt.stackSave(),ln=dt.stackAlloc(16);let dn,un=0;try{if(Kt=dt._OrtGetTensorData(an,ln,ln+4,ln+8,ln+12),Kt!==0)throw new Error(`Can't access output tensor data. error code = ${Kt}`);let Tn=ln/4;const Sn=dt.HEAPU32[Tn++];un=dt.HEAPU32[Tn++];const bn=dt.HEAPU32[Tn++],on=dt.HEAPU32[Tn++],zn=[];for(let hn=0;hn<on;hn++)zn.push(dt.HEAPU32[bn/4+hn]);dt._OrtFree(bn);const Ln=zn.length===0?1:zn.reduce(((hn,Hn)=>hn*Hn));if(dn=st(Sn),dn==="string"){const hn=[];let Hn=un/4;for(let Wn=0;Wn<Ln;Wn++){const Gn=dt.HEAPU32[Hn++],gr=Wn===Ln-1?void 0:dt.HEAPU32[Hn]-Gn;hn.push(dt.UTF8ToString(Gn,gr))}qt.push([dn,zn,hn])}else{const hn=new(ot(dn))(Ln);new Uint8Array(hn.buffer,hn.byteOffset,hn.byteLength).set(dt.HEAPU8.subarray(un,un+hn.byteLength)),qt.push([dn,zn,hn])}}finally{dt.stackRestore(pn),dn==="string"&&un&&dt._free(un),dt._OrtReleaseTensor(an)}}if(Kt===0)return qt;throw new Error(`failed to call OrtRun(). error code = ${Kt}.`)}finally{dt.stackRestore(Ot)}}finally{wt.forEach(dt._OrtReleaseTensor),St.forEach(dt._free),dt._OrtReleaseRunOptions(vt),Et.forEach(dt._free)}},O.endProfiling=rt=>{const nt=(0,et.getInstance)(),at=tt.get(rt);if(!at)throw new Error("invalid session id");const ct=at[0],ut=nt._OrtEndProfiling(ct);if(ut===0)throw new Error("Can't get an profile file name");nt._OrtFree(ut)},O.extractTransferableBuffers=rt=>{const nt=[];for(const at of rt){const ct=at[2];!Array.isArray(ct)&&ct.buffer&&nt.push(ct.buffer)}return nt}},6361:function(ee,O,Y){var te=this&&this.__createBinding||(Object.create?function(ut,dt,ht,pt){pt===void 0&&(pt=ht);var ft=Object.getOwnPropertyDescriptor(dt,ht);ft&&!("get"in ft?!dt.__esModule:ft.writable||ft.configurable)||(ft={enumerable:!0,get:function(){return dt[ht]}}),Object.defineProperty(ut,pt,ft)}:function(ut,dt,ht,pt){pt===void 0&&(pt=ht),ut[pt]=dt[ht]}),ne=this&&this.__setModuleDefault||(Object.create?function(ut,dt){Object.defineProperty(ut,"default",{enumerable:!0,value:dt})}:function(ut,dt){ut.default=dt}),xe=this&&this.__importStar||function(ut){if(ut&&ut.__esModule)return ut;var dt={};if(ut!=null)for(var ht in ut)ht!=="default"&&Object.prototype.hasOwnProperty.call(ut,ht)&&te(dt,ut,ht);return ne(dt,ut),dt},et=this&&this.__importDefault||function(ut){return ut&&ut.__esModule?ut:{default:ut}};Object.defineProperty(O,"__esModule",{value:!0}),O.dispose=O.getInstance=O.initializeWebAssembly=void 0;const tt=xe(Y(6449)),it=et(Y(932)),st=Y(3474);let ot,rt=!1,nt=!1,at=!1;const ct=(ut,dt)=>dt?ut?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":ut?"ort-wasm-simd.wasm":"ort-wasm.wasm";O.initializeWebAssembly=async ut=>{if(rt)return Promise.resolve();if(nt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(at)throw new Error("previous call to 'initializeWebAssembly()' failed.");nt=!0;const dt=ut.initTimeout,ht=ut.numThreads,pt=ut.simd,ft=ht>1&&(()=>{try{return typeof SharedArrayBuffer<"u"&&(typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch{return!1}})(),mt=pt&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}})(),yt=typeof ut.wasmPaths=="string"?ut.wasmPaths:void 0,bt=ct(!1,ft),vt=ct(mt,ft),Et=typeof ut.wasmPaths=="object"?ut.wasmPaths[vt]:void 0;let wt=!1;const St=[];if(dt>0&&St.push(new Promise((Ot=>{setTimeout((()=>{wt=!0,Ot()}),dt)}))),St.push(new Promise(((Ot,$t)=>{const Mt=ft?st:it.default,Nt={locateFile:(Rt,Pt)=>ft&&Rt.endsWith(".worker.js")&&typeof Blob<"u"?URL.createObjectURL(new Blob([Y(4154)],{type:"text/javascript"})):Rt===bt?Et??(yt??Pt)+vt:Pt+Rt};if(ft)if(typeof Blob>"u")Nt.mainScriptUrlOrBlob=tt.join("/","ort-wasm-threaded.js");else{const Rt=`var ortWasmThreaded=(function(){var _scriptDir;return ${Mt.toString()}})();`;Nt.mainScriptUrlOrBlob=new Blob([Rt],{type:"text/javascript"})}Mt(Nt).then((Rt=>{nt=!1,rt=!0,ot=Rt,Ot()}),(Rt=>{nt=!1,at=!0,$t(Rt)}))}))),await Promise.race(St),wt)throw new Error(`WebAssembly backend initializing failed due to timeout: ${dt}ms`)},O.getInstance=()=>{if(rt&&ot)return ot;throw new Error("WebAssembly is not initialized yet.")},O.dispose=()=>{var ut;!rt||nt||at||(nt=!0,(ut=ot.PThread)===null||ut===void 0||ut.terminateAllThreads(),ot=void 0,nt=!1,rt=!1,at=!0)}},9710:(ee,O,Y)=>{Y.d(O,{Z:()=>xe});var te=Y(477),ne=Y.n(te);function xe(){return ne()('/*!\n* ONNX Runtime Web v1.14.0\n* Copyright (c) Microsoft Corporation. All rights reserved.\n* Licensed under the MIT License.\n*/\n(()=>{var t={474:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){function e(){return j.buffer!=D&&N(j.buffer),P}function r(){return j.buffer!=D&&N(j.buffer),U}function a(){return j.buffer!=D&&N(j.buffer),F}function i(){return j.buffer!=D&&N(j.buffer),I}function o(){return j.buffer!=D&&N(j.buffer),W}var u,c,s;t=t||{},u||(u=void 0!==t?t:{}),u.ready=new Promise((function(t,e){c=t,s=e}));var l,f,p,h,d,y,b=Object.assign({},u),m="./this.program",g=(t,e)=>{throw e},v="object"==typeof window,w="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,O=u.ENVIRONMENT_IS_PTHREAD||!1,A="";function S(t){return u.locateFile?u.locateFile(t,A):A+t}if(_){let e;A=w?n(908).dirname(A)+"/":"//",y=()=>{d||(h=n(384),d=n(908))},l=function(t,e){return y(),t=d.normalize(t),h.readFileSync(t,e?void 0:"utf8")},p=t=>((t=l(t,!0)).buffer||(t=new Uint8Array(t)),t),f=(t,e,n)=>{y(),t=d.normalize(t),h.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(m=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof ct))throw t})),process.on("unhandledRejection",(function(t){throw t})),g=(t,e)=>{if(Q())throw process.exitCode=t,e;e instanceof ct||x("exiting due to exception: "+e),process.exit(t)},u.inspect=function(){return"[Emscripten Module object]"};try{e=n(925)}catch(t){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),t}n.g.Worker=e.Worker}else(v||w)&&(w?A=self.location.href:"undefined"!=typeof document&&document.currentScript&&(A=document.currentScript.src),_scriptDir&&(A=_scriptDir),A=0!==A.indexOf("blob:")?A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):"",_||(l=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},w&&(p=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)}));_&&"undefined"==typeof performance&&(n.g.performance=n(953).performance);var T=console.log.bind(console),E=console.warn.bind(console);_&&(y(),T=t=>h.writeSync(1,t+"\\n"),E=t=>h.writeSync(2,t+"\\n"));var M,C=u.print||T,x=u.printErr||E;Object.assign(u,b),b=null,u.thisProgram&&(m=u.thisProgram),u.quit&&(g=u.quit),u.wasmBinary&&(M=u.wasmBinary);var R=u.noExitRuntime||!1;"object"!=typeof WebAssembly&&at("no native wasm support detected");var j,k,D,P,U,F,I,W,H=!1,L="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function z(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&L)return L.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,n):t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function Y(t,e){return(t>>>=0)?z(r(),t,e):""}function B(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function G(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function N(t){D=t,u.HEAP8=P=new Int8Array(t),u.HEAP16=new Int16Array(t),u.HEAP32=F=new Int32Array(t),u.HEAPU8=U=new Uint8Array(t),u.HEAPU16=new Uint16Array(t),u.HEAPU32=I=new Uint32Array(t),u.HEAPF32=new Float32Array(t),u.HEAPF64=W=new Float64Array(t)}O&&(D=u.buffer);var V=u.INITIAL_MEMORY||16777216;if(O)j=u.wasmMemory,D=u.buffer;else if(u.wasmMemory)j=u.wasmMemory;else if(!((j=new WebAssembly.Memory({initial:V/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw x("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");j&&(D=j.buffer),V=D.byteLength,N(D);var $,q=[],X=[],J=[],Z=[];function Q(){return R||!1}function K(){var t=u.preRun.shift();q.unshift(t)}var tt,et=0,nt=null,rt=null;function at(t){throw O?postMessage({cmd:"onAbort",arg:t}):u.onAbort&&u.onAbort(t),x(t="Aborted("+t+")"),H=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),s(t),t}function it(){return tt.startsWith("data:application/octet-stream;base64,")}function ot(){var t=tt;try{if(t==tt&&M)return new Uint8Array(M);if(p)return p(t);throw"both async and sync fetching of the wasm failed"}catch(t){at(t)}}tt="ort-wasm-threaded.wasm",it()||(tt=S(tt));var ut={};function ct(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function st(t){(t=ht.Vb[t])||at(),ht.mc(t)}function lt(t){var e=ht.Cc();if(!e)return 6;ht.ac.push(e),ht.Vb[t.Ub]=e,e.Ub=t.Ub;var n={cmd:"run",start_routine:t.Ic,arg:t.zc,pthread_ptr:t.Ub};return e.$b=()=>{n.time=performance.now(),e.postMessage(n,t.Nc)},e.loaded&&(e.$b(),delete e.$b),0}function ft(t){if(O)return $t(1,1,t);Q()||(ht.oc(),u.onExit&&u.onExit(t),H=!0),g(t,new ct(t))}function pt(t,e){if(!e&&O)throw bt(t),"unwind";Q()||O||(me(),dt(J),be(0),re[1].length&&ae(1,10),re[2].length&&ae(2,10),ht.oc()),ft(t)}var ht={Yb:[],ac:[],qc:[],Vb:{},fc:function(){O&&ht.Ec()},Pc:function(){},Ec:function(){ht.receiveObjectTransfer=ht.Gc,ht.threadInitTLS=ht.pc,ht.setExitStatus=ht.nc,R=!1},nc:function(){},oc:function(){for(var t of Object.values(ht.Vb))ht.mc(t);for(t of ht.Yb)t.terminate();ht.Yb=[]},mc:function(t){var e=t.Ub;delete ht.Vb[e],ht.Yb.push(t),ht.ac.splice(ht.ac.indexOf(t),1),t.Ub=0,Oe(e)},Gc:function(){},pc:function(){ht.qc.forEach((t=>t()))},Fc:function(t,e){t.onmessage=n=>{var r=(n=n.data).cmd;if(t.Ub&&(ht.Bc=t.Ub),n.targetThread&&n.targetThread!=he()){var a=ht.Vb[n.Qc];a?a.postMessage(n,n.transferList):x(\'Internal error! Worker sent a message "\'+r+\'" to target pthread \'+n.targetThread+", but that thread no longer exists!")}else"processProxyingQueue"===r?zt(n.queue):"spawnThread"===r?lt(n):"cleanupThread"===r?st(n.thread):"killThread"===r?(n=n.thread,r=ht.Vb[n],delete ht.Vb[n],r.terminate(),Oe(n),ht.ac.splice(ht.ac.indexOf(r),1),r.Ub=0):"cancelThread"===r?ht.Vb[n.thread].postMessage({cmd:"cancel"}):"loaded"===r?(t.loaded=!0,e&&e(t),t.$b&&(t.$b(),delete t.$b)):"print"===r?C("Thread "+n.threadId+": "+n.text):"printErr"===r?x("Thread "+n.threadId+": "+n.text):"alert"===r?alert("Thread "+n.threadId+": "+n.text):"setimmediate"===n.target?t.postMessage(n):"onAbort"===r?u.onAbort&&u.onAbort(n.arg):r&&x("worker sent an unknown command "+r);ht.Bc=void 0},t.onerror=t=>{throw x("worker sent an error! "+t.filename+":"+t.lineno+": "+t.message),t},_&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){}))),t.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||_scriptDir,wasmMemory:j,wasmModule:k})},yc:function(){var t=S("ort-wasm-threaded.worker.js");ht.Yb.push(new Worker(t))},Cc:function(){return 0==ht.Yb.length&&(ht.yc(),ht.Fc(ht.Yb[0])),ht.Yb.pop()}};function dt(t){for(;0<t.length;)t.shift()(u)}function yt(t){var e=Ee();return t=t(),Me(e),t}function bt(t){if(O)return $t(2,0,t);try{pt(t)}catch(t){t instanceof ct||"unwind"==t||g(1,t)}}u.PThread=ht,u.establishStackSpace=function(){var t=he(),e=a()[t+44>>2>>>0];t=a()[t+48>>2>>>0],Te(e,e-t),Me(e)};var mt=[];function gt(t){var e=mt[t];return e||(t>=mt.length&&(mt.length=t+1),mt[t]=e=$.get(t)),e}u.invokeEntryPoint=function(t,e){t=gt(t)(e),Q()?ht.nc(t):Ae(t)};var vt,wt,_t=[],Ot=0,At=0;function St(t){this.Zb=t,this.Sb=t-24,this.xc=function(t){i()[this.Sb+4>>2>>>0]=t},this.bc=function(){return i()[this.Sb+4>>2>>>0]},this.wc=function(t){i()[this.Sb+8>>2>>>0]=t},this.Dc=function(){return i()[this.Sb+8>>2>>>0]},this.rc=function(){a()[this.Sb>>2>>>0]=0},this.hc=function(t){t=t?1:0,e()[this.Sb+12>>0>>>0]=t},this.uc=function(){return 0!=e()[this.Sb+12>>0>>>0]},this.ic=function(t){t=t?1:0,e()[this.Sb+13>>0>>>0]=t},this.kc=function(){return 0!=e()[this.Sb+13>>0>>>0]},this.fc=function(t,e){this.cc(0),this.xc(t),this.wc(e),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(a(),this.Sb>>2,1)},this.Hc=function(){return 1===Atomics.sub(a(),this.Sb>>2,1)},this.cc=function(t){i()[this.Sb+16>>2>>>0]=t},this.tc=function(){return i()[this.Sb+16>>2>>>0]},this.vc=function(){if(Re(this.bc()))return i()[this.Zb>>2>>>0];var t=this.tc();return 0!==t?t:this.Zb}}function Tt(t){return ye(new St(t).Sb)}function Et(t,e,n,r){return O?$t(3,1,t,e,n,r):Mt(t,e,n,r)}function Mt(t,e,n,r){if("undefined"==typeof SharedArrayBuffer)return x("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];return O&&0===a.length?Et(t,e,n,r):(t={Ic:n,Ub:t,zc:r,Nc:a},O?(t.Oc="spawnThread",postMessage(t,a),0):lt(t))}function Ct(t,e,n){return O?$t(4,1,t,e,n):0}function xt(t,e){if(O)return $t(5,1,t,e)}function Rt(t,e){if(O)return $t(6,1,t,e)}function jt(t,e,n){if(O)return $t(7,1,t,e,n)}function kt(t,e,n){return O?$t(8,1,t,e,n):0}function Dt(t,e){if(O)return $t(9,1,t,e)}function Pt(t,e,n){if(O)return $t(10,1,t,e,n)}function Ut(t,e,n,r){if(O)return $t(11,1,t,e,n,r)}function Ft(t,e,n,r){if(O)return $t(12,1,t,e,n,r)}function It(t,e,n,r){if(O)return $t(13,1,t,e,n,r)}function Wt(t){if(O)return $t(14,1,t)}function Ht(t,e){if(O)return $t(15,1,t,e)}function Lt(t,e,n){if(O)return $t(16,1,t,e,n)}function zt(t){Atomics.store(a(),t>>2,1),he()&&_e(t),Atomics.compareExchange(a(),t>>2,1,0)}function Yt(t){return i()[t>>>2]+4294967296*a()[t+4>>>2]}function Bt(t,e,n,r,a,i){return O?$t(17,1,t,e,n,r,a,i):-52}function Gt(t,e,n,r,a,i){if(O)return $t(18,1,t,e,n,r,a,i)}function Nt(t){var n=G(t)+1,r=de(n);return r&&B(t,e(),r,n),r}function Vt(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}if(O)return $t(19,1,t,e,n);var o=(new Date).getFullYear(),u=new Date(o,0,1),c=new Date(o,6,1);o=u.getTimezoneOffset();var s=c.getTimezoneOffset(),l=Math.max(o,s);a()[t>>2>>>0]=60*l,a()[e>>2>>>0]=Number(o!=s),t=r(u),e=r(c),t=Nt(t),e=Nt(e),s<o?(i()[n>>2>>>0]=t,i()[n+4>>2>>>0]=e):(i()[n>>2>>>0]=e,i()[n+4>>2>>>0]=t)}function $t(t,e){var n=arguments.length-2,r=arguments;return yt((()=>{for(var a=Ce(8*n),i=a>>3,u=0;u<n;u++){var c=r[2+u];o()[i+u>>>0]=c}return we(t,n,a,e)}))}u.executeNotifiedProxyingQueue=zt,wt=_?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:O?()=>performance.now()-u.__performance_now_clock_drift:()=>performance.now();var qt,Xt=[],Jt={};function Zt(){if(!qt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in Jt)void 0===Jt[t]?delete e[t]:e[t]=Jt[t];var n=[];for(t in e)n.push(t+"="+e[t]);qt=n}return qt}function Qt(t,n){if(O)return $t(20,1,t,n);var r=0;return Zt().forEach((function(a,o){var u=n+r;for(o=i()[t+4*o>>2>>>0]=u,u=0;u<a.length;++u)e()[o++>>0>>>0]=a.charCodeAt(u);e()[o>>0>>>0]=0,r+=a.length+1})),0}function Kt(t,e){if(O)return $t(21,1,t,e);var n=Zt();i()[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),i()[e>>2>>>0]=r,0}function te(t){return O?$t(22,1,t):52}function ee(t,e,n,r){return O?$t(23,1,t,e,n,r):52}function ne(t,e,n,r,a){return O?$t(24,1,t,e,n,r,a):70}var re=[null,[],[]];function ae(t,e){var n=re[t];0===e||10===e?((1===t?C:x)(z(n,0)),n.length=0):n.push(e)}function ie(t,e,n,a){if(O)return $t(25,1,t,e,n,a);for(var o=0,u=0;u<n;u++){var c=i()[e>>2>>>0],s=i()[e+4>>2>>>0];e+=8;for(var l=0;l<s;l++)ae(t,r()[c+l>>>0]);o+=s}return i()[a>>2>>>0]=o,0}var oe=0;function ue(t){return 0==t%4&&(0!=t%100||0==t%400)}var ce=[31,29,31,30,31,30,31,31,30,31,30,31],se=[31,28,31,30,31,30,31,31,30,31,30,31];function le(t,n,r,i){function o(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function u(t,e){return o(t,e,"0")}function c(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function s(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function l(t){var e=t.Wb;for(t=new Date(new Date(t.Xb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(ue(t.getFullYear())?ce:se)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=s(new Date(t.getFullYear(),0,4)),n=s(n),0>=c(e,t)?0>=c(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var f=a()[i+40>>2>>>0];for(var p in i={Lc:a()[i>>2>>>0],Kc:a()[i+4>>2>>>0],dc:a()[i+8>>2>>>0],jc:a()[i+12>>2>>>0],ec:a()[i+16>>2>>>0],Xb:a()[i+20>>2>>>0],Tb:a()[i+24>>2>>>0],Wb:a()[i+28>>2>>>0],Rc:a()[i+32>>2>>>0],Jc:a()[i+36>>2>>>0],Mc:f?Y(f):""},r=Y(r),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(p,"g"),f[p]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="January February March April May June July August September October November December".split(" ");for(p in f={"%a":function(t){return h[t.Tb].substring(0,3)},"%A":function(t){return h[t.Tb]},"%b":function(t){return d[t.ec].substring(0,3)},"%B":function(t){return d[t.ec]},"%C":function(t){return u((t.Xb+1900)/100|0,2)},"%d":function(t){return u(t.jc,2)},"%e":function(t){return o(t.jc,2," ")},"%g":function(t){return l(t).toString().substring(2)},"%G":function(t){return l(t)},"%H":function(t){return u(t.dc,2)},"%I":function(t){return 0==(t=t.dc)?t=12:12<t&&(t-=12),u(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.ec-1;e+=(ue(t.Xb+1900)?ce:se)[n++]);return u(t.jc+e,3)},"%m":function(t){return u(t.ec+1,2)},"%M":function(t){return u(t.Kc,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.dc&&12>t.dc?"AM":"PM"},"%S":function(t){return u(t.Lc,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Tb||7},"%U":function(t){return u(Math.floor((t.Wb+7-t.Tb)/7),2)},"%V":function(t){var e=Math.floor((t.Wb+7-(t.Tb+6)%7)/7);if(2>=(t.Tb+371-t.Wb-2)%7&&e++,e)53==e&&(4==(n=(t.Tb+371-t.Wb)%7)||3==n&&ue(t.Xb)||(e=1));else{e=52;var n=(t.Tb+7-t.Wb-1)%7;(4==n||5==n&&ue(t.Xb%400-1))&&e++}return u(e,2)},"%w":function(t){return t.Tb},"%W":function(t){return u(Math.floor((t.Wb+7-(t.Tb+6)%7)/7),2)},"%y":function(t){return(t.Xb+1900).toString().substring(2)},"%Y":function(t){return t.Xb+1900},"%z":function(t){var e=0<=(t=t.Jc);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.Mc},"%%":function(){return"%"}},r=r.replace(/%%/g,"\\0\\0"),f)r.includes(p)&&(r=r.replace(new RegExp(p,"g"),f[p](i)));return p=function(t){var e=Array(G(t)+1);return B(t,e,0,e.length),e}(r=r.replace(/\\0\\0/g,"%")),p.length>n?0:(function(t,n){e().set(t,n>>>0)}(p,t),p.length-1)}ht.fc();var fe=[null,ft,bt,Et,Ct,xt,Rt,jt,kt,Dt,Pt,Ut,Ft,It,Wt,Ht,Lt,Bt,Gt,Vt,Qt,Kt,te,ee,ne,ie],pe={b:function(t){return de(t+24)+24},n:function(t){return(t=new St(t)).uc()||(t.hc(!0),Ot--),t.ic(!1),_t.push(t),t.sc(),t.vc()},ma:function(t){throw x("Unexpected exception thrown, this is not properly supported - aborting"),H=!0,t},x:function(){Se(0);var t=_t.pop();if(t.Hc()&&!t.kc()){var e=t.Dc();e&&gt(e)(t.Zb),Tt(t.Zb)}At=0},e:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},l:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},h:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},t:Tt,M:function(){var t=_t.pop();t||at("no exception to throw");var e=t.Zb;throw t.kc()||(_t.push(t),t.ic(!0),t.hc(!1),Ot++),At=e,e},c:function(t,e,n){throw new St(t).fc(e,n),At=t,Ot++,t},pa:function(){return Ot},Fa:function(t){ge(t,!w,1,!v),ht.pc()},T:function(t){O?postMessage({cmd:"cleanupThread",thread:t}):st(t)},xa:Mt,j:function(t){throw At||(At=t),t},H:Ct,Ma:xt,ua:Rt,wa:jt,oa:kt,Ka:Dt,Ca:Pt,Ja:Ut,V:Ft,va:It,sa:Wt,La:Ht,ta:Lt,Ta:function(){},X:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(t,e,n,r){if(t==e)setTimeout((()=>zt(r)));else if(O)postMessage({targetThread:t,cmd:"processProxyingQueue",queue:r});else{if(!(t=ht.Vb[t]))return;t.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},Ea:function(){return-1},Pa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getUTCSeconds(),a()[e+4>>2>>>0]=t.getUTCMinutes(),a()[e+8>>2>>>0]=t.getUTCHours(),a()[e+12>>2>>>0]=t.getUTCDate(),a()[e+16>>2>>>0]=t.getUTCMonth(),a()[e+20>>2>>>0]=t.getUTCFullYear()-1900,a()[e+24>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,a()[e+28>>2>>>0]=t},Qa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getSeconds(),a()[e+4>>2>>>0]=t.getMinutes(),a()[e+8>>2>>>0]=t.getHours(),a()[e+12>>2>>>0]=t.getDate(),a()[e+16>>2>>>0]=t.getMonth(),a()[e+20>>2>>>0]=t.getFullYear()-1900,a()[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1),r=(t.getTime()-n.getTime())/864e5|0;a()[e+28>>2>>>0]=r,a()[e+36>>2>>>0]=-60*t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset(),t=0|(r!=(n=n.getTimezoneOffset())&&t.getTimezoneOffset()==Math.min(n,r)),a()[e+32>>2>>>0]=t},Ra:function(t){var e=new Date(a()[t+20>>2>>>0]+1900,a()[t+16>>2>>>0],a()[t+12>>2>>>0],a()[t+8>>2>>>0],a()[t+4>>2>>>0],a()[t>>2>>>0],0),n=a()[t+32>>2>>>0],r=e.getTimezoneOffset(),i=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),c=Math.min(u,o);return 0>n?a()[t+32>>2>>>0]=Number(o!=u&&c==r):0<n!=(c==r)&&(o=Math.max(u,o),e.setTime(e.getTime()+6e4*((0<n?c:o)-r))),a()[t+24>>2>>>0]=e.getDay(),n=(e.getTime()-i.getTime())/864e5|0,a()[t+28>>2>>>0]=n,a()[t>>2>>>0]=e.getSeconds(),a()[t+4>>2>>>0]=e.getMinutes(),a()[t+8>>2>>>0]=e.getHours(),a()[t+12>>2>>>0]=e.getDate(),a()[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},Aa:Bt,Ba:Gt,Sa:function t(e,n,r){t.Ac||(t.Ac=!0,Vt(e,n,r))},y:function(){at("")},U:function(){if(!_&&!w){var t="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";vt||(vt={}),vt[t]||(vt[t]=1,_&&(t="warning: "+t),x(t))}},ra:function(){return 4294901760},B:wt,Ia:function(t,e,n){r().copyWithin(t>>>0,e>>>0,e+n>>>0)},F:function(){return _?n(993).cpus().length:navigator.hardwareConcurrency},Da:function(t,e,n){Xt.length=e,n>>=3;for(var r=0;r<e;r++)Xt[r]=o()[n+r>>>0];return(0>t?ut[-t-1]:fe[t]).apply(null,Xt)},qa:function(t){var e=r().length;if((t>>>=0)<=e||4294901760<t)return!1;for(var n=1;4>=n;n*=2){var a=e*(1+.2/n);a=Math.min(a,t+100663296);var i=Math;a=Math.max(t,a),i=i.min.call(i,4294901760,a+(65536-a%65536)%65536);t:{try{j.grow(i-D.byteLength+65535>>>16),N(j.buffer);var o=1;break t}catch(t){}o=void 0}if(o)return!0}return!1},Na:function(){throw"unwind"},Ga:Qt,Ha:Kt,J:pt,I:te,S:ee,ga:ne,R:ie,d:function(){return oe},na:function t(r,a){t.lc||(t.lc=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(_)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>at("randomDevice")}());for(var i=0;i<a;i++)e()[r+i>>0>>>0]=t.lc();return 0},ia:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ja:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},K:function(t){var e=Ee();try{return gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},f:function(t,e){var n=Ee();try{return gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},P:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},Q:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},k:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},p:function(t,e,n,r){var a=Ee();try{return gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},q:function(t,e,n,r,a){var i=Ee();try{return gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},N:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},s:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},w:function(t,e,n,r,a,i,o){var u=Ee();try{return gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},L:function(t,e,n,r,a,i,o,u){var c=Ee();try{return gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},E:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{return gt(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=Ee();try{return He(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},_:function(t,e,n,r,a,i,o){var u=Ee();try{return ke(t,e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},Z:function(t,e,n,r,a){var i=Ee();try{return Le(t,e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},ca:function(t,e,n,r){var a=Ee();try{return Ie(t,e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},$:function(t){var e=Ee();try{return je(t)}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},ba:function(t,e){var n=Ee();try{return We(t,e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},Y:function(t,e,n){var r=Ee();try{return De(t,e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},g:function(t){var e=Ee();try{gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},r:function(t,e){var n=Ee();try{gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},i:function(t,e,n){var r=Ee();try{gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ha:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},m:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},v:function(t,e,n,r,a){var i=Ee();try{gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},u:function(t,e,n,r,a,i){var o=Ee();try{gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},O:function(t,e,n,r,a,i,o){var u=Ee();try{gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},A:function(t,e,n,r,a,i,o,u){var c=Ee();try{gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},ka:function(t,e,n,r,a,i,o,u,c){var s=Ee();try{gt(t)(e,n,r,a,i,o,u,c)}catch(t){if(Me(s),t!==t+0)throw t;Se(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l){var f=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(Me(f),t!==t+0)throw t;Se(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(Me(b),t!==t+0)throw t;Se(1,0)}},fa:function(t,e,n,r,a,i,o,u){var c=Ee();try{Pe(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},da:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{Fe(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},ea:function(t,e,n,r,a,i){var o=Ee();try{Ue(t,e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},o:function(t){return t},a:j||u.wasmMemory,G:function(t){oe=t},la:le,z:function(t,e,n,r){return le(t,e,n,r)}};!function(){function t(t,e){u.asm=t.exports,ht.qc.push(u.asm.sb),$=u.asm.ub,X.unshift(u.asm.Va),k=e,O||(et--,u.monitorRunDependencies&&u.monitorRunDependencies(et),0==et&&(null!==nt&&(clearInterval(nt),nt=null),rt&&(t=rt,rt=null,t())))}function e(e){t(e.instance,e.module)}function n(t){return function(){if(!M&&(v||w)){if("function"==typeof fetch&&!tt.startsWith("file://"))return fetch(tt,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+tt+"\'";return t.arrayBuffer()})).catch((function(){return ot()}));if(f)return new Promise((function(t,e){f(tt,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return ot()}))}().then((function(t){return WebAssembly.instantiate(t,r)})).then((function(t){return t})).then(t,(function(t){x("failed to asynchronously prepare wasm: "+t),at(t)}))}var r={a:pe};if(O||(et++,u.monitorRunDependencies&&u.monitorRunDependencies(et)),u.instantiateWasm)try{return u.instantiateWasm(r,t)}catch(t){return x("Module.instantiateWasm callback failed with error: "+t),!1}(M||"function"!=typeof WebAssembly.instantiateStreaming||it()||tt.startsWith("file://")||_||"function"!=typeof fetch?n(e):fetch(tt,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,r).then(e,(function(t){return x("wasm streaming compile failed: "+t),x("falling back to ArrayBuffer instantiation"),n(e)}))}))).catch(s)}(),u.___wasm_call_ctors=function(){return(u.___wasm_call_ctors=u.asm.Va).apply(null,arguments)},u._OrtInit=function(){return(u._OrtInit=u.asm.Wa).apply(null,arguments)},u._OrtCreateSessionOptions=function(){return(u._OrtCreateSessionOptions=u.asm.Xa).apply(null,arguments)},u._OrtAppendExecutionProvider=function(){return(u._OrtAppendExecutionProvider=u.asm.Ya).apply(null,arguments)},u._OrtAddSessionConfigEntry=function(){return(u._OrtAddSessionConfigEntry=u.asm.Za).apply(null,arguments)},u._OrtReleaseSessionOptions=function(){return(u._OrtReleaseSessionOptions=u.asm._a).apply(null,arguments)},u._OrtCreateSession=function(){return(u._OrtCreateSession=u.asm.$a).apply(null,arguments)},u._OrtReleaseSession=function(){return(u._OrtReleaseSession=u.asm.ab).apply(null,arguments)},u._OrtGetInputCount=function(){return(u._OrtGetInputCount=u.asm.bb).apply(null,arguments)},u._OrtGetOutputCount=function(){return(u._OrtGetOutputCount=u.asm.cb).apply(null,arguments)},u._OrtGetInputName=function(){return(u._OrtGetInputName=u.asm.db).apply(null,arguments)},u._OrtGetOutputName=function(){return(u._OrtGetOutputName=u.asm.eb).apply(null,arguments)},u._OrtFree=function(){return(u._OrtFree=u.asm.fb).apply(null,arguments)},u._OrtCreateTensor=function(){return(u._OrtCreateTensor=u.asm.gb).apply(null,arguments)},u._OrtGetTensorData=function(){return(u._OrtGetTensorData=u.asm.hb).apply(null,arguments)},u._OrtReleaseTensor=function(){return(u._OrtReleaseTensor=u.asm.ib).apply(null,arguments)},u._OrtCreateRunOptions=function(){return(u._OrtCreateRunOptions=u.asm.jb).apply(null,arguments)},u._OrtAddRunConfigEntry=function(){return(u._OrtAddRunConfigEntry=u.asm.kb).apply(null,arguments)},u._OrtReleaseRunOptions=function(){return(u._OrtReleaseRunOptions=u.asm.lb).apply(null,arguments)},u._OrtRun=function(){return(u._OrtRun=u.asm.mb).apply(null,arguments)},u._OrtEndProfiling=function(){return(u._OrtEndProfiling=u.asm.nb).apply(null,arguments)};var he=u._pthread_self=function(){return(he=u._pthread_self=u.asm.ob).apply(null,arguments)},de=u._malloc=function(){return(de=u._malloc=u.asm.pb).apply(null,arguments)},ye=u._free=function(){return(ye=u._free=u.asm.qb).apply(null,arguments)},be=u._fflush=function(){return(be=u._fflush=u.asm.rb).apply(null,arguments)};u.__emscripten_tls_init=function(){return(u.__emscripten_tls_init=u.asm.sb).apply(null,arguments)};var me=u.___funcs_on_exit=function(){return(me=u.___funcs_on_exit=u.asm.tb).apply(null,arguments)},ge=u.__emscripten_thread_init=function(){return(ge=u.__emscripten_thread_init=u.asm.vb).apply(null,arguments)};u.__emscripten_thread_crashed=function(){return(u.__emscripten_thread_crashed=u.asm.wb).apply(null,arguments)};var ve,we=u._emscripten_run_in_main_runtime_thread_js=function(){return(we=u._emscripten_run_in_main_runtime_thread_js=u.asm.xb).apply(null,arguments)},_e=u.__emscripten_proxy_execute_task_queue=function(){return(_e=u.__emscripten_proxy_execute_task_queue=u.asm.yb).apply(null,arguments)},Oe=u.__emscripten_thread_free_data=function(){return(Oe=u.__emscripten_thread_free_data=u.asm.zb).apply(null,arguments)},Ae=u.__emscripten_thread_exit=function(){return(Ae=u.__emscripten_thread_exit=u.asm.Ab).apply(null,arguments)},Se=u._setThrew=function(){return(Se=u._setThrew=u.asm.Bb).apply(null,arguments)},Te=u._emscripten_stack_set_limits=function(){return(Te=u._emscripten_stack_set_limits=u.asm.Cb).apply(null,arguments)},Ee=u.stackSave=function(){return(Ee=u.stackSave=u.asm.Db).apply(null,arguments)},Me=u.stackRestore=function(){return(Me=u.stackRestore=u.asm.Eb).apply(null,arguments)},Ce=u.stackAlloc=function(){return(Ce=u.stackAlloc=u.asm.Fb).apply(null,arguments)},xe=u.___cxa_can_catch=function(){return(xe=u.___cxa_can_catch=u.asm.Gb).apply(null,arguments)},Re=u.___cxa_is_pointer_type=function(){return(Re=u.___cxa_is_pointer_type=u.asm.Hb).apply(null,arguments)},je=u.dynCall_j=function(){return(je=u.dynCall_j=u.asm.Ib).apply(null,arguments)},ke=u.dynCall_iiiiij=function(){return(ke=u.dynCall_iiiiij=u.asm.Jb).apply(null,arguments)},De=u.dynCall_jii=function(){return(De=u.dynCall_jii=u.asm.Kb).apply(null,arguments)},Pe=u.dynCall_viiiiij=function(){return(Pe=u.dynCall_viiiiij=u.asm.Lb).apply(null,arguments)},Ue=u.dynCall_vjji=function(){return(Ue=u.dynCall_vjji=u.asm.Mb).apply(null,arguments)},Fe=u.dynCall_viiijjjii=function(){return(Fe=u.dynCall_viiijjjii=u.asm.Nb).apply(null,arguments)},Ie=u.dynCall_iij=function(){return(Ie=u.dynCall_iij=u.asm.Ob).apply(null,arguments)},We=u.dynCall_ji=function(){return(We=u.dynCall_ji=u.asm.Pb).apply(null,arguments)},He=u.dynCall_iiiiiij=function(){return(He=u.dynCall_iiiiiij=u.asm.Qb).apply(null,arguments)},Le=u.dynCall_iiij=function(){return(Le=u.dynCall_iiij=u.asm.Rb).apply(null,arguments)};function ze(){function t(){if(!ve&&(ve=!0,u.calledRun=!0,!H)&&(O||dt(X),c(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),!O)){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;){var t=u.postRun.shift();Z.unshift(t)}dt(Z)}}if(!(0<et))if(O)c(u),O||dt(X),postMessage({cmd:"loaded"});else{if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)K();dt(q),0<et||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t())}}if(u.UTF8ToString=Y,u.stringToUTF8=function(t,e,n){return B(t,r(),e,n)},u.lengthBytesUTF8=G,u.keepRuntimeAlive=Q,u.wasmMemory=j,u.stackSave=Ee,u.stackRestore=Me,u.stackAlloc=Ce,u.ExitStatus=ct,u.PThread=ht,rt=function t(){ve||ze(),ve||(rt=t)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();return ze(),t.ready});t.exports=r},932:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){var e,r,a;t=t||{},e||(e=void 0!==t?t:{}),e.ready=new Promise((function(t,e){r=t,a=e}));var i,o,u,c,s,l,f=Object.assign({},e),p="./this.program",h=(t,e)=>{throw e},d="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";b?(m=y?n(908).dirname(m)+"/":"//",l=()=>{s||(c=n(384),s=n(908))},i=function(t,e){return l(),t=s.normalize(t),c.readFileSync(t,e?void 0:"utf8")},u=t=>((t=i(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,n)=>{l(),t=s.normalize(t),c.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(p=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof J))throw t})),process.on("unhandledRejection",(function(t){throw t})),h=(t,e)=>{if(_||0<L)throw process.exitCode=t,e;e instanceof J||w("exiting due to exception: "+e),process.exit(t)},e.inspect=function(){return"[Emscripten Module object]"}):(d||y)&&(y?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),_scriptDir&&(m=_scriptDir),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},y&&(u=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)});var g,v=e.print||console.log.bind(console),w=e.printErr||console.warn.bind(console);Object.assign(e,f),f=null,e.thisProgram&&(p=e.thisProgram),e.quit&&(h=e.quit),e.wasmBinary&&(g=e.wasmBinary);var _=e.noExitRuntime||!1;"object"!=typeof WebAssembly&&V("no native wasm support detected");var O,A,S,T,E,M,C=!1,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&x)return x.decode(t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function j(t,e){return(t>>>=0)?R(T,t,e):""}function k(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function D(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function P(){var t=O.buffer;A=t,e.HEAP8=S=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAP32=E=new Int32Array(t),e.HEAPU8=T=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}var U,F=[],I=[],W=[],H=[],L=0;function z(){var t=e.preRun.shift();F.unshift(t)}var Y,B=0,G=null,N=null;function V(t){throw e.onAbort&&e.onAbort(t),w(t="Aborted("+t+")"),C=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),a(t),t}function $(){return Y.startsWith("data:application/octet-stream;base64,")}if(Y="ort-wasm.wasm",!$()){var q=Y;Y=e.locateFile?e.locateFile(q,m):m+q}function X(){var t=Y;try{if(t==Y&&g)return new Uint8Array(g);if(u)return u(t);throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function J(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function Z(t){for(;0<t.length;)t.shift()(e)}var Q=[],K=0,tt=0;function et(t){this.Db=t,this.zb=t-24,this.Ub=function(t){M[this.zb+4>>2>>>0]=t},this.Eb=function(){return M[this.zb+4>>2>>>0]},this.Sb=function(t){M[this.zb+8>>2>>>0]=t},this.Wb=function(){return M[this.zb+8>>2>>>0]},this.Tb=function(){E[this.zb>>2>>>0]=0},this.Ib=function(t){S[this.zb+12>>0>>>0]=t?1:0},this.Pb=function(){return 0!=S[this.zb+12>>0>>>0]},this.Jb=function(t){S[this.zb+13>>0>>>0]=t?1:0},this.Lb=function(){return 0!=S[this.zb+13>>0>>>0]},this.Rb=function(t,e){this.Fb(0),this.Ub(t),this.Sb(e),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){E[this.zb>>2>>>0]+=1},this.Xb=function(){var t=E[this.zb>>2>>>0];return E[this.zb>>2>>>0]=t-1,1===t},this.Fb=function(t){M[this.zb+16>>2>>>0]=t},this.Ob=function(){return M[this.zb+16>>2>>>0]},this.Qb=function(){if(Mt(this.Eb()))return M[this.Db>>2>>>0];var t=this.Ob();return 0!==t?t:this.Db}}function nt(t){return vt(new et(t).zb)}var rt=[];function at(t){var e=rt[t];return e||(t>=rt.length&&(rt.length=t+1),rt[t]=e=U.get(t)),e}function it(t){var e=D(t)+1,n=gt(e);return n&&k(t,S,n,e),n}var ot={};function ut(){if(!ct){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(t in ot)void 0===ot[t]?delete e[t]:e[t]=ot[t];var n=[];for(t in e)n.push(t+"="+e[t]);ct=n}return ct}var ct,st=[null,[],[]];function lt(t,e){var n=st[t];0===e||10===e?((1===t?v:w)(R(n,0)),n.length=0):n.push(e)}var ft=0;function pt(t){return 0==t%4&&(0!=t%100||0==t%400)}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function yt(t,e,n,r){function a(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function i(t,e){return a(t,e,"0")}function o(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function u(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function c(t){var e=t.Bb;for(t=new Date(new Date(t.Cb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(pt(t.getFullYear())?ht:dt)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=u(new Date(t.getFullYear(),0,4)),n=u(n),0>=o(e,t)?0>=o(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var s=E[r+40>>2>>>0];for(var l in r={$b:E[r>>2>>>0],Zb:E[r+4>>2>>>0],Gb:E[r+8>>2>>>0],Kb:E[r+12>>2>>>0],Hb:E[r+16>>2>>>0],Cb:E[r+20>>2>>>0],Ab:E[r+24>>2>>>0],Bb:E[r+28>>2>>>0],bc:E[r+32>>2>>>0],Yb:E[r+36>>2>>>0],ac:s?j(s):""},n=j(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),s[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(l in s={"%a":function(t){return f[t.Ab].substring(0,3)},"%A":function(t){return f[t.Ab]},"%b":function(t){return p[t.Hb].substring(0,3)},"%B":function(t){return p[t.Hb]},"%C":function(t){return i((t.Cb+1900)/100|0,2)},"%d":function(t){return i(t.Kb,2)},"%e":function(t){return a(t.Kb,2," ")},"%g":function(t){return c(t).toString().substring(2)},"%G":function(t){return c(t)},"%H":function(t){return i(t.Gb,2)},"%I":function(t){return 0==(t=t.Gb)?t=12:12<t&&(t-=12),i(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.Hb-1;e+=(pt(t.Cb+1900)?ht:dt)[n++]);return i(t.Kb+e,3)},"%m":function(t){return i(t.Hb+1,2)},"%M":function(t){return i(t.Zb,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.Gb&&12>t.Gb?"AM":"PM"},"%S":function(t){return i(t.$b,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Ab||7},"%U":function(t){return i(Math.floor((t.Bb+7-t.Ab)/7),2)},"%V":function(t){var e=Math.floor((t.Bb+7-(t.Ab+6)%7)/7);if(2>=(t.Ab+371-t.Bb-2)%7&&e++,e)53==e&&(4==(n=(t.Ab+371-t.Bb)%7)||3==n&&pt(t.Cb)||(e=1));else{e=52;var n=(t.Ab+7-t.Bb-1)%7;(4==n||5==n&&pt(t.Cb%400-1))&&e++}return i(e,2)},"%w":function(t){return t.Ab},"%W":function(t){return i(Math.floor((t.Bb+7-(t.Ab+6)%7)/7),2)},"%y":function(t){return(t.Cb+1900).toString().substring(2)},"%Y":function(t){return t.Cb+1900},"%z":function(t){var e=0<=(t=t.Yb);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.ac},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),s)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),s[l](r)));return l=function(t){var e=Array(D(t)+1);return k(t,e,0,e.length),e}(n=n.replace(/\\0\\0/g,"%")),l.length>e?0:(S.set(l,t>>>0),l.length-1)}var bt={a:function(t){return gt(t+24)+24},m:function(t){return(t=new et(t)).Pb()||(t.Ib(!0),K--),t.Jb(!1),Q.push(t),t.Nb(),t.Qb()},ia:function(t){throw w("Unexpected exception thrown, this is not properly supported - aborting"),C=!0,t},w:function(){Ot(0);var t=Q.pop();if(t.Xb()&&!t.Lb()){var e=t.Wb();e&&at(e)(t.Db),nt(t.Db)}tt=0},d:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},k:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},g:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},s:nt,L:function(){var t=Q.pop();t||V("no exception to throw");var e=t.Db;throw t.Lb()||(Q.push(t),t.Jb(!0),t.Ib(!1),K++),tt=e,e},b:function(t,e,n){throw new et(t).Rb(e,n),tt=t,K++,t},la:function(){return K},i:function(t){throw tt||(tt=t),t},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getUTCSeconds(),E[e+4>>2>>>0]=t.getUTCMinutes(),E[e+8>>2>>>0]=t.getUTCHours(),E[e+12>>2>>>0]=t.getUTCDate(),E[e+16>>2>>>0]=t.getUTCMonth(),E[e+20>>2>>>0]=t.getUTCFullYear()-1900,E[e+24>>2>>>0]=t.getUTCDay(),E[e+28>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getSeconds(),E[e+4>>2>>>0]=t.getMinutes(),E[e+8>>2>>>0]=t.getHours(),E[e+12>>2>>>0]=t.getDate(),E[e+16>>2>>>0]=t.getMonth(),E[e+20>>2>>>0]=t.getFullYear()-1900,E[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1);E[e+28>>2>>>0]=(t.getTime()-n.getTime())/864e5|0,E[e+36>>2>>>0]=-60*t.getTimezoneOffset();var r=new Date(t.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),E[e+32>>2>>>0]=0|(r!=n&&t.getTimezoneOffset()==Math.min(n,r))},Fa:function(t){var e=new Date(E[t+20>>2>>>0]+1900,E[t+16>>2>>>0],E[t+12>>2>>>0],E[t+8>>2>>>0],E[t+4>>2>>>0],E[t>>2>>>0],0),n=E[t+32>>2>>>0],r=e.getTimezoneOffset(),a=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),u=Math.min(o,i);return 0>n?E[t+32>>2>>>0]=Number(i!=o&&u==r):0<n!=(u==r)&&(i=Math.max(o,i),e.setTime(e.getTime()+6e4*((0<n?u:i)-r))),E[t+24>>2>>>0]=e.getDay(),E[t+28>>2>>>0]=(e.getTime()-a.getTime())/864e5|0,E[t>>2>>>0]=e.getSeconds(),E[t+4>>2>>>0]=e.getMinutes(),E[t+8>>2>>>0]=e.getHours(),E[t+12>>2>>>0]=e.getDate(),E[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function t(e,n,r){t.Vb||(t.Vb=!0,function(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}var a=(new Date).getFullYear(),i=new Date(a,0,1),o=new Date(a,6,1);a=i.getTimezoneOffset();var u=o.getTimezoneOffset();E[t>>2>>>0]=60*Math.max(a,u),E[e>>2>>>0]=Number(a!=u),t=r(i),e=r(o),t=it(t),e=it(e),u<a?(M[n>>2>>>0]=t,M[n+4>>2>>>0]=e):(M[n>>2>>>0]=e,M[n+4>>2>>>0]=t)}(e,n,r))},B:function(){V("")},ma:function(){return 4294901760},I:b?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:()=>performance.now(),xa:function(t,e,n){T.copyWithin(t>>>0,e>>>0,e+n>>>0)},G:function(t){var e=T.length;if(4294901760<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var a=Math;r=Math.max(t,r),a=a.min.call(a,4294901760,r+(65536-r%65536)%65536);t:{try{O.grow(a-A.byteLength+65535>>>16),P();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},va:function(t,e){var n=0;return ut().forEach((function(r,a){var i=e+n;for(a=M[t+4*a>>2>>>0]=i,i=0;i<r.length;++i)S[a++>>0>>>0]=r.charCodeAt(i);S[a>>0>>>0]=0,n+=r.length+1})),0},wa:function(t,e){var n=ut();M[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),M[e>>2>>>0]=r,0},ba:function(t){_||0<L||(_t(),Z(W),wt(0),st[1].length&&lt(1,10),st[2].length&&lt(2,10)),_||0<L||(e.onExit&&e.onExit(t),C=!0),h(t,new J(t))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(t,e,n,r){for(var a=0,i=0;i<n;i++){var o=M[e>>2>>>0],u=M[e+4>>2>>>0];e+=8;for(var c=0;c<u;c++)lt(t,T[o+c>>>0]);a+=u}return M[r>>2>>>0]=a,0},c:function(){return ft},ja:function t(e,r){t.Mb||(t.Mb=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(b)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>V("randomDevice")}());for(var a=0;a<r;a++)S[e+a>>0>>>0]=t.Mb();return 0},ea:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},fa:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},J:function(t){var e=At();try{return at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},e:function(t,e){var n=At();try{return at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},N:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},O:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},j:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},o:function(t,e,n,r){var a=At();try{return at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},p:function(t,e,n,r,a){var i=At();try{return at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},M:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},r:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},v:function(t,e,n,r,a,i,o){var u=At();try{return at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},K:function(t,e,n,r,a,i,o,u){var c=At();try{return at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{return at(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},X:function(t,e,n,r,a,i,o,u){var c=At();try{return Ft(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},V:function(t,e,n,r,a,i,o){var u=At();try{return xt(t,e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},U:function(t,e,n,r,a){var i=At();try{return It(t,e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},Z:function(t,e,n,r){var a=At();try{return Pt(t,e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},W:function(t){var e=At();try{return Ct(t)}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},Y:function(t,e){var n=At();try{return Ut(t,e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},T:function(t,e,n){var r=At();try{return Rt(t,e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},f:function(t){var e=At();try{at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},q:function(t,e){var n=At();try{at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},h:function(t,e,n){var r=At();try{at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},da:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},l:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},t:function(t,e,n,r,a){var i=At();try{at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},u:function(t,e,n,r,a,i){var o=At();try{at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},x:function(t,e,n,r,a,i,o){var u=At();try{at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},z:function(t,e,n,r,a,i,o,u){var c=At();try{at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},ga:function(t,e,n,r,a,i,o,u,c){var s=At();try{at(t)(e,n,r,a,i,o,u,c)}catch(t){if(St(s),t!==t+0)throw t;Ot(1,0)}},A:function(t,e,n,r,a,i,o,u,c,s,l){var f=At();try{at(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(St(f),t!==t+0)throw t;Ot(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=At();try{at(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(St(b),t!==t+0)throw t;Ot(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=At();try{jt(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},_:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{Dt(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},$:function(t,e,n,r,a,i){var o=At();try{kt(t,e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},n:function(t){return t},F:function(t){ft=t},ha:yt,y:function(t,e,n,r){return yt(t,e,n,r)}};!function(){function t(t){e.asm=t.exports,O=e.asm.Ka,P(),U=e.asm.ib,I.unshift(e.asm.La),B--,e.monitorRunDependencies&&e.monitorRunDependencies(B),0==B&&(null!==G&&(clearInterval(G),G=null),N&&(t=N,N=null,t()))}function n(e){t(e.instance)}function r(t){return function(){if(!g&&(d||y)){if("function"==typeof fetch&&!Y.startsWith("file://"))return fetch(Y,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+Y+"\'";return t.arrayBuffer()})).catch((function(){return X()}));if(o)return new Promise((function(t,e){o(Y,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return X()}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){w("failed to asynchronously prepare wasm: "+t),V(t)}))}var i={a:bt};if(B++,e.monitorRunDependencies&&e.monitorRunDependencies(B),e.instantiateWasm)try{return e.instantiateWasm(i,t)}catch(t){return w("Module.instantiateWasm callback failed with error: "+t),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||$()||Y.startsWith("file://")||b||"function"!=typeof fetch?r(n):fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(n,(function(t){return w("wasm streaming compile failed: "+t),w("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.La).apply(null,arguments)},e._OrtInit=function(){return(e._OrtInit=e.asm.Ma).apply(null,arguments)},e._OrtCreateSessionOptions=function(){return(e._OrtCreateSessionOptions=e.asm.Na).apply(null,arguments)},e._OrtAppendExecutionProvider=function(){return(e._OrtAppendExecutionProvider=e.asm.Oa).apply(null,arguments)},e._OrtAddSessionConfigEntry=function(){return(e._OrtAddSessionConfigEntry=e.asm.Pa).apply(null,arguments)},e._OrtReleaseSessionOptions=function(){return(e._OrtReleaseSessionOptions=e.asm.Qa).apply(null,arguments)},e._OrtCreateSession=function(){return(e._OrtCreateSession=e.asm.Ra).apply(null,arguments)},e._OrtReleaseSession=function(){return(e._OrtReleaseSession=e.asm.Sa).apply(null,arguments)},e._OrtGetInputCount=function(){return(e._OrtGetInputCount=e.asm.Ta).apply(null,arguments)},e._OrtGetOutputCount=function(){return(e._OrtGetOutputCount=e.asm.Ua).apply(null,arguments)},e._OrtGetInputName=function(){return(e._OrtGetInputName=e.asm.Va).apply(null,arguments)},e._OrtGetOutputName=function(){return(e._OrtGetOutputName=e.asm.Wa).apply(null,arguments)},e._OrtFree=function(){return(e._OrtFree=e.asm.Xa).apply(null,arguments)},e._OrtCreateTensor=function(){return(e._OrtCreateTensor=e.asm.Ya).apply(null,arguments)},e._OrtGetTensorData=function(){return(e._OrtGetTensorData=e.asm.Za).apply(null,arguments)},e._OrtReleaseTensor=function(){return(e._OrtReleaseTensor=e.asm._a).apply(null,arguments)},e._OrtCreateRunOptions=function(){return(e._OrtCreateRunOptions=e.asm.$a).apply(null,arguments)},e._OrtAddRunConfigEntry=function(){return(e._OrtAddRunConfigEntry=e.asm.ab).apply(null,arguments)},e._OrtReleaseRunOptions=function(){return(e._OrtReleaseRunOptions=e.asm.bb).apply(null,arguments)},e._OrtRun=function(){return(e._OrtRun=e.asm.cb).apply(null,arguments)},e._OrtEndProfiling=function(){return(e._OrtEndProfiling=e.asm.db).apply(null,arguments)};var mt,gt=e._malloc=function(){return(gt=e._malloc=e.asm.eb).apply(null,arguments)},vt=e._free=function(){return(vt=e._free=e.asm.fb).apply(null,arguments)},wt=e._fflush=function(){return(wt=e._fflush=e.asm.gb).apply(null,arguments)},_t=e.___funcs_on_exit=function(){return(_t=e.___funcs_on_exit=e.asm.hb).apply(null,arguments)},Ot=e._setThrew=function(){return(Ot=e._setThrew=e.asm.jb).apply(null,arguments)},At=e.stackSave=function(){return(At=e.stackSave=e.asm.kb).apply(null,arguments)},St=e.stackRestore=function(){return(St=e.stackRestore=e.asm.lb).apply(null,arguments)},Tt=e.stackAlloc=function(){return(Tt=e.stackAlloc=e.asm.mb).apply(null,arguments)},Et=e.___cxa_can_catch=function(){return(Et=e.___cxa_can_catch=e.asm.nb).apply(null,arguments)},Mt=e.___cxa_is_pointer_type=function(){return(Mt=e.___cxa_is_pointer_type=e.asm.ob).apply(null,arguments)},Ct=e.dynCall_j=function(){return(Ct=e.dynCall_j=e.asm.pb).apply(null,arguments)},xt=e.dynCall_iiiiij=function(){return(xt=e.dynCall_iiiiij=e.asm.qb).apply(null,arguments)},Rt=e.dynCall_jii=function(){return(Rt=e.dynCall_jii=e.asm.rb).apply(null,arguments)},jt=e.dynCall_viiiiij=function(){return(jt=e.dynCall_viiiiij=e.asm.sb).apply(null,arguments)},kt=e.dynCall_vjji=function(){return(kt=e.dynCall_vjji=e.asm.tb).apply(null,arguments)},Dt=e.dynCall_viiijjjii=function(){return(Dt=e.dynCall_viiijjjii=e.asm.ub).apply(null,arguments)},Pt=e.dynCall_iij=function(){return(Pt=e.dynCall_iij=e.asm.vb).apply(null,arguments)},Ut=e.dynCall_ji=function(){return(Ut=e.dynCall_ji=e.asm.wb).apply(null,arguments)},Ft=e.dynCall_iiiiiij=function(){return(Ft=e.dynCall_iiiiiij=e.asm.xb).apply(null,arguments)},It=e.dynCall_iiij=function(){return(It=e.dynCall_iiij=e.asm.yb).apply(null,arguments)};function Wt(){function t(){if(!mt&&(mt=!0,e.calledRun=!0,!C)){if(Z(I),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();H.unshift(t)}Z(H)}}if(!(0<B)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)z();Z(F),0<B||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t())}}if(e.UTF8ToString=j,e.stringToUTF8=function(t,e,n){return k(t,T,e,n)},e.lengthBytesUTF8=D,e.stackSave=At,e.stackRestore=St,e.stackAlloc=Tt,N=function t(){mt||Wt(),mt||(N=t)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Wt(),t.ready});t.exports=r},967:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,n,r,a)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{const o=n?n+t:t;if("object"==typeof i)(0,e.iterateExtraOptions)(i,o+".",r,a);else if("string"==typeof i||"number"==typeof i)a(o,i.toString());else{if("boolean"!=typeof i)throw new Error("Can\'t handle extra config type: "+typeof i);a(o,i?"1":"0")}}))}},586:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setRunOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};try{if(void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===(null==t?void 0:t.terminate)&&(u.terminate=!1);let i=0;if(void 0!==(null==t?void 0:t.tag)&&(i=(0,a.allocWasmString)(t.tag,o)),n=e._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,i),0===n)throw new Error("Can\'t create run options");return void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddRunConfigEntry(n,i,u))throw new Error(`Can\'t set a run config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseRunOptions(n),o.forEach(e._free),t}}},919:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setSessionOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};(t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});const e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1")})(u);try{void 0===(null==t?void 0:t.graphOptimizationLevel)&&(u.graphOptimizationLevel="all");const c=(t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}})(u.graphOptimizationLevel);void 0===(null==t?void 0:t.enableCpuMemArena)&&(u.enableCpuMemArena=!0),void 0===(null==t?void 0:t.enableMemPattern)&&(u.enableMemPattern=!0),void 0===(null==t?void 0:t.executionMode)&&(u.executionMode="sequential");const s=(t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}})(u.executionMode);let l=0;if(void 0!==(null==t?void 0:t.logId)&&(l=(0,a.allocWasmString)(t.logId,o)),void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);if(void 0===(null==t?void 0:t.enableProfiling)&&(u.enableProfiling=!1),n=e._OrtCreateSessionOptions(c,!!u.enableCpuMemArena,!!u.enableMemPattern,s,!!u.enableProfiling,0,l,u.logSeverityLevel,u.logVerbosityLevel),0===n)throw new Error("Can\'t create session options");return(null==t?void 0:t.executionProviders)&&((t,e,n)=>{for(const r of e){let e="string"==typeof r?r:r.name;switch(e){case"xnnpack":e="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${e}`)}const o=(0,a.allocWasmString)(e,n);if(0!==(0,i.getInstance)()._OrtAppendExecutionProvider(t,o))throw new Error(`Can\'t append execution provider: ${e}`)}})(n,t.executionProviders,o),void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddSessionConfigEntry(n,i,u))throw new Error(`Can\'t set a session config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseSessionOptions(n),o.forEach(e._free),t}}},983:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;const r=n(361);e.allocWasmString=(t,e)=>{const n=(0,r.getInstance)(),a=n.lengthBytesUTF8(t)+1,i=n._malloc(a);return n.stringToUTF8(t,i,a),e.push(i),i}},349:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;const r=n(586),a=n(919),i=n(983),o=n(361);e.initOrt=(t,e)=>{const n=(0,o.getInstance)()._OrtInit(t,e);if(0!==n)throw new Error(`Can\'t initialize onnxruntime. error code = ${n}`)};const u=new Map;e.createSessionAllocate=t=>{const e=(0,o.getInstance)(),n=e._malloc(t.byteLength);return e.HEAPU8.set(t,n),[n,t.byteLength]},e.createSessionFinalize=(t,e)=>{const n=(0,o.getInstance)();let r=0,i=0,c=[];try{if([i,c]=(0,a.setSessionOptions)(e),r=n._OrtCreateSession(t[0],t[1],i),0===r)throw new Error("Can\'t create a session")}finally{n._free(t[0]),n._OrtReleaseSessionOptions(i),c.forEach(n._free)}const s=n._OrtGetInputCount(r),l=n._OrtGetOutputCount(r),f=[],p=[],h=[],d=[];for(let t=0;t<s;t++){const e=n._OrtGetInputName(r,t);if(0===e)throw new Error("Can\'t get an input name");p.push(e),f.push(n.UTF8ToString(e))}for(let t=0;t<l;t++){const e=n._OrtGetOutputName(r,t);if(0===e)throw new Error("Can\'t get an output name");d.push(e),h.push(n.UTF8ToString(e))}return u.set(r,[r,p,d]),[r,f,h]},e.createSession=(t,n)=>{const r=(0,e.createSessionAllocate)(t);return(0,e.createSessionFinalize)(r,n)},e.releaseSession=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=n[1],i=n[2];a.forEach(e._OrtFree),i.forEach(e._OrtFree),e._OrtReleaseSession(r),u.delete(t)};const c=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},s=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},l=t=>{switch(t){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}};e.run=(t,e,n,a,f)=>{const p=(0,o.getInstance)(),h=u.get(t);if(!h)throw new Error("invalid session id");const d=h[0],y=h[1],b=h[2],m=e.length,g=a.length;let v=0,w=[];const _=[],O=[];try{[v,w]=(0,r.setRunOptions)(f);for(let t=0;t<m;t++){const e=n[t][0],r=n[t][1],a=n[t][2];let o,u;if(Array.isArray(a)){u=4*a.length,o=p._malloc(u),O.push(o);let t=o/4;for(let e=0;e<a.length;e++){if("string"!=typeof a[e])throw new TypeError(`tensor data at index ${e} is not a string`);p.HEAPU32[t++]=(0,i.allocWasmString)(a[e],O)}}else u=a.byteLength,o=p._malloc(u),O.push(o),p.HEAPU8.set(new Uint8Array(a.buffer,a.byteOffset,u),o);const s=p.stackSave(),l=p.stackAlloc(4*r.length);try{let t=l/4;r.forEach((e=>p.HEAP32[t++]=e));const n=p._OrtCreateTensor(c(e),o,u,l,r.length);if(0===n)throw new Error("Can\'t create a tensor");_.push(n)}finally{p.stackRestore(s)}}const t=p.stackSave(),o=p.stackAlloc(4*m),u=p.stackAlloc(4*m),h=p.stackAlloc(4*g),A=p.stackAlloc(4*g);try{let n=o/4,r=u/4,i=h/4,c=A/4;for(let t=0;t<m;t++)p.HEAPU32[n++]=_[t],p.HEAPU32[r++]=y[e[t]];for(let t=0;t<g;t++)p.HEAPU32[i++]=0,p.HEAPU32[c++]=b[a[t]];let f=p._OrtRun(d,u,o,m,A,g,h,v);const w=[];if(0===f)for(let t=0;t<g;t++){const e=p.HEAPU32[h/4+t],n=p.stackSave(),r=p.stackAlloc(16);let a,i=0;try{if(f=p._OrtGetTensorData(e,r,r+4,r+8,r+12),0!==f)throw new Error(`Can\'t access output tensor data. error code = ${f}`);let t=r/4;const o=p.HEAPU32[t++];i=p.HEAPU32[t++];const u=p.HEAPU32[t++],c=p.HEAPU32[t++],h=[];for(let t=0;t<c;t++)h.push(p.HEAPU32[u/4+t]);p._OrtFree(u);const d=0===h.length?1:h.reduce(((t,e)=>t*e));if(a=s(o),"string"===a){const t=[];let e=i/4;for(let n=0;n<d;n++){const r=p.HEAPU32[e++],a=n===d-1?void 0:p.HEAPU32[e]-r;t.push(p.UTF8ToString(r,a))}w.push([a,h,t])}else{const t=new(l(a))(d);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(p.HEAPU8.subarray(i,i+t.byteLength)),w.push([a,h,t])}}finally{p.stackRestore(n),"string"===a&&i&&p._free(i),p._OrtReleaseTensor(e)}}if(0===f)return w;throw new Error(`failed to call OrtRun(). error code = ${f}.`)}finally{p.stackRestore(t)}}finally{_.forEach(p._OrtReleaseTensor),O.forEach(p._free),p._OrtReleaseRunOptions(v),w.forEach(p._free)}},e.endProfiling=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=e._OrtEndProfiling(r);if(0===a)throw new Error("Can\'t get an profile file name");e._OrtFree(a)},e.extractTransferableBuffers=t=>{const e=[];for(const n of t){const t=n[2];!Array.isArray(t)&&t.buffer&&e.push(t.buffer)}return e}},361:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return a(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;const u=i(n(449)),c=o(n(932)),s=n(474);let l,f=!1,p=!1,h=!1;const d=(t,e)=>e?t?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":t?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async t=>{if(f)return Promise.resolve();if(p)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(h)throw new Error("previous call to \'initializeWebAssembly()\' failed.");p=!0;const e=t.initTimeout,r=t.numThreads,a=t.simd,i=r>1&&(()=>{try{return"undefined"!=typeof SharedArrayBuffer&&("undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch(t){return!1}})(),o=a&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(t){return!1}})(),y="string"==typeof t.wasmPaths?t.wasmPaths:void 0,b=d(!1,i),m=d(o,i),g="object"==typeof t.wasmPaths?t.wasmPaths[m]:void 0;let v=!1;const w=[];if(e>0&&w.push(new Promise((t=>{setTimeout((()=>{v=!0,t()}),e)}))),w.push(new Promise(((t,e)=>{const r=i?s:c.default,a={locateFile:(t,e)=>i&&t.endsWith(".worker.js")&&"undefined"!=typeof Blob?URL.createObjectURL(new Blob([n(154)],{type:"text/javascript"})):t===b?null!=g?g:(null!=y?y:e)+m:e+t};if(i)if("undefined"==typeof Blob)a.mainScriptUrlOrBlob=u.join("/","ort-wasm-threaded.js");else{const t=`var ortWasmThreaded=(function(){var _scriptDir;return ${r.toString()}})();`;a.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}r(a).then((e=>{p=!1,f=!0,l=e,t()}),(t=>{p=!1,h=!0,e(t)}))}))),await Promise.race(w),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},e.getInstance=()=>{if(f&&l)return l;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var t;!f||p||h||(p=!0,null===(t=l.PThread)||void 0===t||t.terminateAllThreads(),l=void 0,p=!1,f=!1,h=!0)}},154:t=>{"use strict";t.exports=\'"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};\\n\'},384:()=>{},993:()=>{},908:()=>{},953:()=>{},925:()=>{},449:()=>{}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=n(349),e=n(361);self.onmessage=n=>{switch(n.data.type){case"init-wasm":(0,e.initializeWebAssembly)(n.data.in).then((()=>postMessage({type:"init-wasm"})),(t=>postMessage({type:"init-wasm",err:t})));break;case"init-ort":try{const{numThreads:e,loggingLevel:r}=n.data.in;(0,t.initOrt)(e,r),postMessage({type:"init-ort"})}catch(t){postMessage({type:"init-ort",err:t})}break;case"create_allocate":try{const{model:e}=n.data.in,r=(0,t.createSessionAllocate)(e);postMessage({type:"create_allocate",out:r})}catch(t){postMessage({type:"create_allocate",err:t})}break;case"create_finalize":try{const{modeldata:e,options:r}=n.data.in,a=(0,t.createSessionFinalize)(e,r);postMessage({type:"create_finalize",out:a})}catch(t){postMessage({type:"create_finalize",err:t})}break;case"create":try{const{model:e,options:r}=n.data.in,a=(0,t.createSession)(e,r);postMessage({type:"create",out:a})}catch(t){postMessage({type:"create",err:t})}break;case"release":try{const e=n.data.in;(0,t.releaseSession)(e),postMessage({type:"release"})}catch(t){postMessage({type:"release",err:t})}break;case"run":try{const{sessionId:e,inputIndices:r,inputs:a,outputIndices:i,options:o}=n.data.in,u=(0,t.run)(e,r,a,i,o);postMessage({type:"run",out:u},(0,t.extractTransferableBuffers)(u))}catch(t){postMessage({type:"run",err:t})}break;case"end-profiling":try{const e=n.data.in;(0,t.endProfiling)(e),postMessage({type:"end-profiling"})}catch(t){postMessage({type:"end-profiling",err:t})}}}})()})();\n',"Worker",void 0,void 0)}},477:ee=>{ee.exports=function(O,Y,te,ne){var xe=self||window;try{try{var et;try{et=new xe.Blob([O])}catch{(et=new(xe.BlobBuilder||xe.WebKitBlobBuilder||xe.MozBlobBuilder||xe.MSBlobBuilder)).append(O),et=et.getBlob()}var tt=xe.URL||xe.webkitURL,it=tt.createObjectURL(et),st=new xe[Y](it,te);return tt.revokeObjectURL(it),st}catch{return new xe[Y]("data:application/javascript,".concat(encodeURIComponent(O)),te)}}catch{if(!ne)throw Error("Inline worker is not supported");return new xe[Y](ne,te)}}},4154:ee=>{ee.exports=`"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};
`},1670:ee=>{ee.exports=__WEBPACK_EXTERNAL_MODULE__1670__},7067:()=>{},1296:()=>{},1384:()=>{},3993:()=>{},908:()=>{},6953:()=>{},9925:()=>{},2806:()=>{},6449:()=>{},2850:()=>{},5381:()=>{},5686:(ee,O,Y)=>{Y.r(O),Y.d(O,{flatbuffers:()=>te});var te={};te.Offset,te.Table,te.SIZEOF_SHORT=2,te.SIZEOF_INT=4,te.FILE_IDENTIFIER_LENGTH=4,te.SIZE_PREFIX_LENGTH=4,te.Encoding={UTF8_BYTES:1,UTF16_STRING:2},te.int32=new Int32Array(2),te.float32=new Float32Array(te.int32.buffer),te.float64=new Float64Array(te.int32.buffer),te.isLittleEndian=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1,te.Long=function(ne,xe){this.low=0|ne,this.high=0|xe},te.Long.create=function(ne,xe){return ne==0&&xe==0?te.Long.ZERO:new te.Long(ne,xe)},te.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},te.Long.prototype.equals=function(ne){return this.low==ne.low&&this.high==ne.high},te.Long.ZERO=new te.Long(0,0),te.Builder=function(ne){if(ne)xe=ne;else var xe=1024;this.bb=te.ByteBuffer.allocate(xe),this.space=xe,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},te.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},te.Builder.prototype.forceDefaults=function(ne){this.force_defaults=ne},te.Builder.prototype.dataBuffer=function(){return this.bb},te.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},te.Builder.prototype.prep=function(ne,xe){ne>this.minalign&&(this.minalign=ne);for(var et=1+~(this.bb.capacity()-this.space+xe)&ne-1;this.space<et+ne+xe;){var tt=this.bb.capacity();this.bb=te.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-tt}this.pad(et)},te.Builder.prototype.pad=function(ne){for(var xe=0;xe<ne;xe++)this.bb.writeInt8(--this.space,0)},te.Builder.prototype.writeInt8=function(ne){this.bb.writeInt8(this.space-=1,ne)},te.Builder.prototype.writeInt16=function(ne){this.bb.writeInt16(this.space-=2,ne)},te.Builder.prototype.writeInt32=function(ne){this.bb.writeInt32(this.space-=4,ne)},te.Builder.prototype.writeInt64=function(ne){this.bb.writeInt64(this.space-=8,ne)},te.Builder.prototype.writeFloat32=function(ne){this.bb.writeFloat32(this.space-=4,ne)},te.Builder.prototype.writeFloat64=function(ne){this.bb.writeFloat64(this.space-=8,ne)},te.Builder.prototype.addInt8=function(ne){this.prep(1,0),this.writeInt8(ne)},te.Builder.prototype.addInt16=function(ne){this.prep(2,0),this.writeInt16(ne)},te.Builder.prototype.addInt32=function(ne){this.prep(4,0),this.writeInt32(ne)},te.Builder.prototype.addInt64=function(ne){this.prep(8,0),this.writeInt64(ne)},te.Builder.prototype.addFloat32=function(ne){this.prep(4,0),this.writeFloat32(ne)},te.Builder.prototype.addFloat64=function(ne){this.prep(8,0),this.writeFloat64(ne)},te.Builder.prototype.addFieldInt8=function(ne,xe,et){(this.force_defaults||xe!=et)&&(this.addInt8(xe),this.slot(ne))},te.Builder.prototype.addFieldInt16=function(ne,xe,et){(this.force_defaults||xe!=et)&&(this.addInt16(xe),this.slot(ne))},te.Builder.prototype.addFieldInt32=function(ne,xe,et){(this.force_defaults||xe!=et)&&(this.addInt32(xe),this.slot(ne))},te.Builder.prototype.addFieldInt64=function(ne,xe,et){!this.force_defaults&&xe.equals(et)||(this.addInt64(xe),this.slot(ne))},te.Builder.prototype.addFieldFloat32=function(ne,xe,et){(this.force_defaults||xe!=et)&&(this.addFloat32(xe),this.slot(ne))},te.Builder.prototype.addFieldFloat64=function(ne,xe,et){(this.force_defaults||xe!=et)&&(this.addFloat64(xe),this.slot(ne))},te.Builder.prototype.addFieldOffset=function(ne,xe,et){(this.force_defaults||xe!=et)&&(this.addOffset(xe),this.slot(ne))},te.Builder.prototype.addFieldStruct=function(ne,xe,et){xe!=et&&(this.nested(xe),this.slot(ne))},te.Builder.prototype.nested=function(ne){if(ne!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},te.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},te.Builder.prototype.slot=function(ne){this.vtable[ne]=this.offset()},te.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},te.Builder.growByteBuffer=function(ne){var xe=ne.capacity();if(3221225472&xe)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var et=xe<<1,tt=te.ByteBuffer.allocate(et);return tt.setPosition(et-xe),tt.bytes().set(ne.bytes(),et-xe),tt},te.Builder.prototype.addOffset=function(ne){this.prep(te.SIZEOF_INT,0),this.writeInt32(this.offset()-ne+te.SIZEOF_INT)},te.Builder.prototype.startObject=function(ne){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=ne;for(var xe=0;xe<ne;xe++)this.vtable[xe]=0;this.isNested=!0,this.object_start=this.offset()},te.Builder.prototype.endObject=function(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var ne=this.offset(),xe=this.vtable_in_use-1;xe>=0&&this.vtable[xe]==0;xe--);for(var et=xe+1;xe>=0;xe--)this.addInt16(this.vtable[xe]!=0?ne-this.vtable[xe]:0);this.addInt16(ne-this.object_start);var tt=(et+2)*te.SIZEOF_SHORT;this.addInt16(tt);var it=0,st=this.space;e:for(xe=0;xe<this.vtables.length;xe++){var ot=this.bb.capacity()-this.vtables[xe];if(tt==this.bb.readInt16(ot)){for(var rt=te.SIZEOF_SHORT;rt<tt;rt+=te.SIZEOF_SHORT)if(this.bb.readInt16(st+rt)!=this.bb.readInt16(ot+rt))continue e;it=this.vtables[xe];break}}return it?(this.space=this.bb.capacity()-ne,this.bb.writeInt32(this.space,it-ne)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-ne,this.offset()-ne)),this.isNested=!1,ne},te.Builder.prototype.finish=function(ne,xe,et){var tt=et?te.SIZE_PREFIX_LENGTH:0;if(xe){var it=xe;if(this.prep(this.minalign,te.SIZEOF_INT+te.FILE_IDENTIFIER_LENGTH+tt),it.length!=te.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+te.FILE_IDENTIFIER_LENGTH);for(var st=te.FILE_IDENTIFIER_LENGTH-1;st>=0;st--)this.writeInt8(it.charCodeAt(st))}this.prep(this.minalign,te.SIZEOF_INT+tt),this.addOffset(ne),tt&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},te.Builder.prototype.finishSizePrefixed=function(ne,xe){this.finish(ne,xe,!0)},te.Builder.prototype.requiredField=function(ne,xe){var et=this.bb.capacity()-ne,tt=et-this.bb.readInt32(et);if(this.bb.readInt16(tt+xe)==0)throw new Error("FlatBuffers: field "+xe+" must be set")},te.Builder.prototype.startVector=function(ne,xe,et){this.notNested(),this.vector_num_elems=xe,this.prep(te.SIZEOF_INT,ne*xe),this.prep(et,ne*xe)},te.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},te.Builder.prototype.createString=function(ne){if(ne instanceof Uint8Array)var xe=ne;else{xe=[];for(var et=0;et<ne.length;){var tt,it=ne.charCodeAt(et++);(tt=it<55296||it>=56320?it:(it<<10)+ne.charCodeAt(et++)+-56613888)<128?xe.push(tt):(tt<2048?xe.push(tt>>6&31|192):(tt<65536?xe.push(tt>>12&15|224):xe.push(tt>>18&7|240,tt>>12&63|128),xe.push(tt>>6&63|128)),xe.push(63&tt|128))}}this.addInt8(0),this.startVector(1,xe.length,1),this.bb.setPosition(this.space-=xe.length),et=0;for(var st=this.space,ot=this.bb.bytes();et<xe.length;et++)ot[st++]=xe[et];return this.endVector()},te.Builder.prototype.createLong=function(ne,xe){return te.Long.create(ne,xe)},te.ByteBuffer=function(ne){this.bytes_=ne,this.position_=0},te.ByteBuffer.allocate=function(ne){return new te.ByteBuffer(new Uint8Array(ne))},te.ByteBuffer.prototype.clear=function(){this.position_=0},te.ByteBuffer.prototype.bytes=function(){return this.bytes_},te.ByteBuffer.prototype.position=function(){return this.position_},te.ByteBuffer.prototype.setPosition=function(ne){this.position_=ne},te.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},te.ByteBuffer.prototype.readInt8=function(ne){return this.readUint8(ne)<<24>>24},te.ByteBuffer.prototype.readUint8=function(ne){return this.bytes_[ne]},te.ByteBuffer.prototype.readInt16=function(ne){return this.readUint16(ne)<<16>>16},te.ByteBuffer.prototype.readUint16=function(ne){return this.bytes_[ne]|this.bytes_[ne+1]<<8},te.ByteBuffer.prototype.readInt32=function(ne){return this.bytes_[ne]|this.bytes_[ne+1]<<8|this.bytes_[ne+2]<<16|this.bytes_[ne+3]<<24},te.ByteBuffer.prototype.readUint32=function(ne){return this.readInt32(ne)>>>0},te.ByteBuffer.prototype.readInt64=function(ne){return new te.Long(this.readInt32(ne),this.readInt32(ne+4))},te.ByteBuffer.prototype.readUint64=function(ne){return new te.Long(this.readUint32(ne),this.readUint32(ne+4))},te.ByteBuffer.prototype.readFloat32=function(ne){return te.int32[0]=this.readInt32(ne),te.float32[0]},te.ByteBuffer.prototype.readFloat64=function(ne){return te.int32[te.isLittleEndian?0:1]=this.readInt32(ne),te.int32[te.isLittleEndian?1:0]=this.readInt32(ne+4),te.float64[0]},te.ByteBuffer.prototype.writeInt8=function(ne,xe){this.bytes_[ne]=xe},te.ByteBuffer.prototype.writeUint8=function(ne,xe){this.bytes_[ne]=xe},te.ByteBuffer.prototype.writeInt16=function(ne,xe){this.bytes_[ne]=xe,this.bytes_[ne+1]=xe>>8},te.ByteBuffer.prototype.writeUint16=function(ne,xe){this.bytes_[ne]=xe,this.bytes_[ne+1]=xe>>8},te.ByteBuffer.prototype.writeInt32=function(ne,xe){this.bytes_[ne]=xe,this.bytes_[ne+1]=xe>>8,this.bytes_[ne+2]=xe>>16,this.bytes_[ne+3]=xe>>24},te.ByteBuffer.prototype.writeUint32=function(ne,xe){this.bytes_[ne]=xe,this.bytes_[ne+1]=xe>>8,this.bytes_[ne+2]=xe>>16,this.bytes_[ne+3]=xe>>24},te.ByteBuffer.prototype.writeInt64=function(ne,xe){this.writeInt32(ne,xe.low),this.writeInt32(ne+4,xe.high)},te.ByteBuffer.prototype.writeUint64=function(ne,xe){this.writeUint32(ne,xe.low),this.writeUint32(ne+4,xe.high)},te.ByteBuffer.prototype.writeFloat32=function(ne,xe){te.float32[0]=xe,this.writeInt32(ne,te.int32[0])},te.ByteBuffer.prototype.writeFloat64=function(ne,xe){te.float64[0]=xe,this.writeInt32(ne,te.int32[te.isLittleEndian?0:1]),this.writeInt32(ne+4,te.int32[te.isLittleEndian?1:0])},te.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+te.SIZEOF_INT+te.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var ne="",xe=0;xe<te.FILE_IDENTIFIER_LENGTH;xe++)ne+=String.fromCharCode(this.readInt8(this.position_+te.SIZEOF_INT+xe));return ne},te.ByteBuffer.prototype.__offset=function(ne,xe){var et=ne-this.readInt32(ne);return xe<this.readInt16(et)?this.readInt16(et+xe):0},te.ByteBuffer.prototype.__union=function(ne,xe){return ne.bb_pos=xe+this.readInt32(xe),ne.bb=this,ne},te.ByteBuffer.prototype.__string=function(ne,xe){ne+=this.readInt32(ne);var et=this.readInt32(ne),tt="",it=0;if(ne+=te.SIZEOF_INT,xe===te.Encoding.UTF8_BYTES)return this.bytes_.subarray(ne,ne+et);for(;it<et;){var st,ot=this.readUint8(ne+it++);if(ot<192)st=ot;else{var rt=this.readUint8(ne+it++);if(ot<224)st=(31&ot)<<6|63&rt;else{var nt=this.readUint8(ne+it++);st=ot<240?(15&ot)<<12|(63&rt)<<6|63&nt:(7&ot)<<18|(63&rt)<<12|(63&nt)<<6|63&this.readUint8(ne+it++)}}st<65536?tt+=String.fromCharCode(st):(st-=65536,tt+=String.fromCharCode(55296+(st>>10),56320+(1023&st)))}return tt},te.ByteBuffer.prototype.__indirect=function(ne){return ne+this.readInt32(ne)},te.ByteBuffer.prototype.__vector=function(ne){return ne+this.readInt32(ne)+te.SIZEOF_INT},te.ByteBuffer.prototype.__vector_len=function(ne){return this.readInt32(ne+this.readInt32(ne))},te.ByteBuffer.prototype.__has_identifier=function(ne){if(ne.length!=te.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+te.FILE_IDENTIFIER_LENGTH);for(var xe=0;xe<te.FILE_IDENTIFIER_LENGTH;xe++)if(ne.charCodeAt(xe)!=this.readInt8(this.position_+te.SIZEOF_INT+xe))return!1;return!0},te.ByteBuffer.prototype.createLong=function(ne,xe){return te.Long.create(ne,xe)}}},__webpack_module_cache__={};function __webpack_require__(ee){var O=__webpack_module_cache__[ee];if(O!==void 0)return O.exports;var Y=__webpack_module_cache__[ee]={exports:{}};return __webpack_modules__[ee].call(Y.exports,Y,Y.exports,__webpack_require__),Y.exports}__webpack_require__.n=ee=>{var O=ee&&ee.__esModule?()=>ee.default:()=>ee;return __webpack_require__.d(O,{a:O}),O},__webpack_require__.d=(ee,O)=>{for(var Y in O)__webpack_require__.o(O,Y)&&!__webpack_require__.o(ee,Y)&&Object.defineProperty(ee,Y,{enumerable:!0,get:O[Y]})},__webpack_require__.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),__webpack_require__.o=(ee,O)=>Object.prototype.hasOwnProperty.call(ee,O),__webpack_require__.r=ee=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ee,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ee,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(6018);return __webpack_exports__})()))})(ortWeb_min$1)),ortWeb_min$1.exports}var ortWeb_minExports=requireOrtWeb_min();const ortWeb_min=getDefaultExportFromCjs$1(ortWeb_minExports),ONNX_WEB=_mergeNamespaces({__proto__:null,default:ortWeb_min},[ortWeb_minExports]);let ONNX;const executionProviders=["wasm"];typeof process<"u"&&process?.release?.name==="node"?(ONNX=fs??__viteBrowserExternal,executionProviders.unshift("cpu")):(ONNX=ortWeb_min??ONNX_WEB,typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(ONNX.env.wasm.simd=!1));const{env:onnx_env}=ONNX,VERSION$1="2.17.2",WEB_CACHE_AVAILABLE=typeof self<"u"&&"caches"in self,FS_AVAILABLE=!isEmpty$2(fs),PATH_AVAILABLE=!isEmpty$2(fs),RUNNING_LOCALLY=FS_AVAILABLE&&PATH_AVAILABLE,__dirname$1=RUNNING_LOCALLY?fs.dirname(fs.dirname(fs.fileURLToPath(import.meta.url))):"./",DEFAULT_CACHE_DIR=RUNNING_LOCALLY?fs.join(__dirname$1,"/.cache/"):null,DEFAULT_LOCAL_MODEL_PATH="/models/",localModelPath=RUNNING_LOCALLY?fs.join(__dirname$1,DEFAULT_LOCAL_MODEL_PATH):DEFAULT_LOCAL_MODEL_PATH;onnx_env?.wasm&&(onnx_env.wasm.wasmPaths=RUNNING_LOCALLY?fs.join(__dirname$1,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${VERSION$1}/dist/`);const env$1={version:VERSION$1,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath,useFS:FS_AVAILABLE,useBrowserCache:WEB_CACHE_AVAILABLE,useFSCache:FS_AVAILABLE,cacheDir:DEFAULT_CACHE_DIR};function isEmpty$2(ee){return Object.keys(ee).length===0}var define_process_env_default={};class FileResponse{_CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(O){if(this.filePath=O,this.headers=new Headers,this.exists=fs.existsSync(O),this.exists){this.status=200,this.statusText="OK";let Y=fs.statSync(O);this.headers.set("content-length",Y.size.toString()),this.updateContentType();let te=this;this.body=new ReadableStream({start(ne){te.arrayBuffer().then(xe=>{ne.enqueue(new Uint8Array(xe)),ne.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const O=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[O]??"application/octet-stream")}clone(){let O=new FileResponse(this.filePath);return O.exists=this.exists,O.status=this.status,O.statusText=this.statusText,O.headers=new Headers(this.headers),O}async arrayBuffer(){return(await fs.promises.readFile(this.filePath)).buffer}async blob(){const O=await fs.promises.readFile(this.filePath);return new Blob([O],{type:this.headers.get("content-type")})}async text(){return await fs.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function isValidUrl(ee,O=null,Y=null){let te;try{te=new URL(ee)}catch{return!1}return!(O&&!O.includes(te.protocol)||Y&&!Y.includes(te.hostname))}async function getFile(ee){if(env$1.useFS&&!isValidUrl(ee,["http:","https:","blob:"]))return new FileResponse(ee);if(typeof process<"u"&&process?.release?.name==="node"){const O=!!define_process_env_default?.TESTING_REMOTELY,Y=env$1.version,te=new Headers;if(te.set("User-Agent",`transformers.js/${Y}; is_ci/${O};`),isValidUrl(ee,["http:","https:"],["huggingface.co","hf.co"])){const xe=define_process_env_default?.HF_TOKEN??define_process_env_default?.HF_ACCESS_TOKEN;xe&&te.set("Authorization",`Bearer ${xe}`)}return fetch(ee,{headers:te})}else return fetch(ee)}const ERROR_MAPPING={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function handleError(ee,O,Y){if(!Y)return null;const te=ERROR_MAPPING[ee]??`Error (${ee}) occurred while trying to load file`;throw Error(`${te}: "${O}".`)}class FileCache{constructor(O){this.path=O}async match(O){let Y=fs.join(this.path,O),te=new FileResponse(Y);if(te.exists)return te}async put(O,Y){const te=Buffer.from(await Y.arrayBuffer());let ne=fs.join(this.path,O);try{await fs.promises.mkdir(fs.dirname(ne),{recursive:!0}),await fs.promises.writeFile(ne,te)}catch(xe){console.warn("An error occurred while writing the file to cache:",xe)}}}async function tryCache(ee,...O){for(let Y of O)try{let te=await ee.match(Y);if(te)return te}catch{continue}}async function getModelFile(ee,O,Y=!0,te={}){if(!env$1.allowLocalModels){if(te.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!env$1.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}dispatchCallback(te.progress_callback,{status:"initiate",name:ee,file:O});let ne;if(!ne&&env$1.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{ne=await caches.open("transformers-cache")}catch(ht){console.warn("An error occurred while opening the browser cache:",ht)}}!ne&&env$1.useFSCache&&(ne=new FileCache(te.cache_dir??env$1.cacheDir));const xe=te.revision??"main";let et=pathJoin(ee,O),tt=pathJoin(env$1.localModelPath,et),it=pathJoin(env$1.remoteHost,env$1.remotePathTemplate.replaceAll("{model}",ee).replaceAll("{revision}",encodeURIComponent(xe)),O),st=xe==="main"?et:pathJoin(ee,xe,O),ot,rt=ne instanceof FileCache?st:it,nt=!1,at;ne&&(at=await tryCache(ne,tt,rt));const ct=at!==void 0;if(at===void 0){if(env$1.allowLocalModels)if(isValidUrl(et,["http:","https:"])){if(te.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${et}.`);if(!env$1.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${et}.`)}else try{at=await getFile(tt),ot=tt}catch(pt){console.warn(`Unable to load from local path "${tt}": "${pt}"`)}if(at===void 0||at.status===404){if(te.local_files_only||!env$1.allowRemoteModels){if(Y)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${tt}".`);return null}if(at=await getFile(it),at.status!==200)return handleError(at.status,it,Y);ot=rt}nt=ne&&typeof Response<"u"&&at instanceof Response&&at.status===200}dispatchCallback(te.progress_callback,{status:"download",name:ee,file:O});const ut={status:"progress",name:ee,file:O};let dt;return te.progress_callback?ct&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(dt=new Uint8Array(await at.arrayBuffer()),dispatchCallback(te.progress_callback,{...ut,progress:100,loaded:dt.length,total:dt.length})):dt=await readResponse(at,ht=>{dispatchCallback(te.progress_callback,{...ut,...ht})}):dt=new Uint8Array(await at.arrayBuffer()),nt&&ot&&await ne.match(ot)===void 0&&await ne.put(ot,new Response(dt,{headers:at.headers})).catch(ht=>{console.warn(`Unable to add response to browser cache: ${ht}.`)}),dispatchCallback(te.progress_callback,{status:"done",name:ee,file:O}),dt}async function getModelJSON(ee,O,Y=!0,te={}){let ne=await getModelFile(ee,O,Y,te);if(ne===null)return{};let et=new TextDecoder("utf-8").decode(ne);return JSON.parse(et)}async function readResponse(ee,O){const Y=ee.headers.get("Content-Length");Y===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let te=parseInt(Y??"0"),ne=new Uint8Array(te),xe=0;const et=ee.body.getReader();async function tt(){const{done:it,value:st}=await et.read();if(it)return;let ot=xe+st.length;if(ot>te){te=ot;let nt=new Uint8Array(te);nt.set(ne),ne=nt}ne.set(st,xe),xe=ot;const rt=xe/te*100;return O({progress:rt,loaded:xe,total:te}),tt()}return await tt(),ne}function pathJoin(...ee){return ee=ee.map((O,Y)=>(Y&&(O=O.replace(new RegExp("^/"),"")),Y!==ee.length-1&&(O=O.replace(new RegExp("/$"),"")),O)),ee.join("/")}function interpolate_data(ee,[O,Y,te],[ne,xe],et="bilinear",tt=!1){const it=xe/te,st=ne/Y,ot=new ee.constructor(ne*xe*O),rt=Y*te,nt=ne*xe;for(let at=0;at<ne;++at)for(let ct=0;ct<xe;++ct){const ut=at*xe+ct,dt=(ct+.5)/it-.5,ht=(at+.5)/st-.5;let pt=Math.floor(dt),ft=Math.floor(ht);const mt=Math.min(pt+1,te-1),yt=Math.min(ft+1,Y-1);pt=Math.max(pt,0),ft=Math.max(ft,0);const bt=dt-pt,vt=ht-ft,Et=(1-bt)*(1-vt),wt=bt*(1-vt),St=(1-bt)*vt,Ot=bt*vt,$t=ft*te,Mt=yt*te,Nt=$t+pt,Rt=$t+mt,Pt=Mt+pt,kt=Mt+mt;for(let Wt=0;Wt<O;++Wt){const zt=Wt*rt;ot[Wt*nt+ut]=Et*ee[zt+Nt]+wt*ee[zt+Rt]+St*ee[zt+Pt]+Ot*ee[zt+kt]}}return ot}function permute_data(ee,O,Y){const te=new Array(Y.length),ne=new Array(Y.length);for(let tt=Y.length-1,it=1;tt>=0;--tt)ne[tt]=it,te[tt]=O[Y[tt]],it*=te[tt];const xe=Y.map((tt,it)=>ne[Y.indexOf(it)]),et=new ee.constructor(ee.length);for(let tt=0;tt<ee.length;++tt){let it=0;for(let st=O.length-1,ot=tt;st>=0;--st)it+=ot%O[st]*xe[st],ot=Math.floor(ot/O[st]);et[it]=ee[tt]}return[et,te]}function softmax(ee){const O=max(ee)[0],Y=ee.map(xe=>Math.exp(xe-O)),te=Y.reduce((xe,et)=>xe+et,0);return Y.map(xe=>xe/te)}function log_softmax(ee){return softmax(ee).map(te=>Math.log(te))}function getTopItems(ee,O=0){return ee=Array.from(ee).map((Y,te)=>[te,Y]).sort((Y,te)=>te[1]-Y[1]),O!==null&&O>0&&(ee=ee.slice(0,O)),ee}function min(ee){if(ee.length===0)throw Error("Array must not be empty");let O=ee[0],Y=0;for(let te=1;te<ee.length;++te)ee[te]<O&&(O=ee[te],Y=te);return[O,Y]}function max(ee){if(ee.length===0)throw Error("Array must not be empty");let O=ee[0],Y=0;for(let te=1;te<ee.length;++te)ee[te]>O&&(O=ee[te],Y=te);return[Number(O),Y]}function isPowerOfTwo(ee){return ee>0&&(ee&ee-1)===0}class P2FFT{constructor(O){if(this.size=O|0,this.size<=1||!isPowerOfTwo(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=O<<1,this.table=new Float64Array(this.size*2);for(let te=0;te<this.table.length;te+=2){const ne=Math.PI*te/this.size;this.table[te]=Math.cos(ne),this.table[te+1]=-Math.sin(ne)}let Y=0;for(let te=1;this.size>te;te<<=1)++Y;this._width=Y%2===0?Y-1:Y,this._bitrev=new Int32Array(1<<this._width);for(let te=0;te<this._bitrev.length;++te){this._bitrev[te]=0;for(let ne=0;ne<this._width;ne+=2){const xe=this._width-ne-2;this._bitrev[te]|=(te>>>ne&3)<<xe}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(O,Y){const te=Y||new Array(O.length>>>1);for(let ne=0;ne<O.length;ne+=2)te[ne>>>1]=O[ne];return te}toComplexArray(O,Y){const te=Y||this.createComplexArray();for(let ne=0;ne<te.length;ne+=2)te[ne]=O[ne>>>1],te[ne+1]=0;return te}transform(O,Y){if(O===Y)throw new Error("Input and output buffers must be different");this._transform4(O,Y,1)}realTransform(O,Y){if(O===Y)throw new Error("Input and output buffers must be different");this._realTransform4(O,Y,1)}inverseTransform(O,Y){if(O===Y)throw new Error("Input and output buffers must be different");this._transform4(O,Y,-1);for(let te=0;te<O.length;++te)O[te]/=this.size}_transform4(O,Y,te){const ne=this._csize;let et=1<<this._width,tt=ne/et<<1,it,st;const ot=this._bitrev;if(tt===4)for(it=0,st=0;it<ne;it+=tt,++st){const nt=ot[st];this._singleTransform2(Y,O,it,nt,et)}else for(it=0,st=0;it<ne;it+=tt,++st){const nt=ot[st];this._singleTransform4(Y,O,it,nt,et,te)}const rt=this.table;for(et>>=2;et>=2;et>>=2){tt=ne/et<<1;const nt=tt>>>2;for(it=0;it<ne;it+=tt){const at=it+nt-1;for(let ct=it,ut=0;ct<at;ct+=2,ut+=et){const dt=ct,ht=dt+nt,pt=ht+nt,ft=pt+nt,mt=O[dt],yt=O[dt+1],bt=O[ht],vt=O[ht+1],Et=O[pt],wt=O[pt+1],St=O[ft],Ot=O[ft+1],$t=rt[ut],Mt=te*rt[ut+1],Nt=bt*$t-vt*Mt,Rt=bt*Mt+vt*$t,Pt=rt[2*ut],kt=te*rt[2*ut+1],Wt=Et*Pt-wt*kt,zt=Et*kt+wt*Pt,Kt=rt[3*ut],qt=te*rt[3*ut+1],Xt=St*Kt-Ot*qt,an=St*qt+Ot*Kt,pn=mt+Wt,ln=yt+zt,dn=mt-Wt,un=yt-zt,Tn=Nt+Xt,Sn=Rt+an,bn=te*(Nt-Xt),on=te*(Rt-an);O[dt]=pn+Tn,O[dt+1]=ln+Sn,O[ht]=dn+on,O[ht+1]=un-bn,O[pt]=pn-Tn,O[pt+1]=ln-Sn,O[ft]=dn-on,O[ft+1]=un+bn}}}}_singleTransform2(O,Y,te,ne,xe){const et=O[ne],tt=O[ne+1],it=O[ne+xe],st=O[ne+xe+1];Y[te]=et+it,Y[te+1]=tt+st,Y[te+2]=et-it,Y[te+3]=tt-st}_singleTransform4(O,Y,te,ne,xe,et){const tt=xe*2,it=xe*3,st=O[ne],ot=O[ne+1],rt=O[ne+xe],nt=O[ne+xe+1],at=O[ne+tt],ct=O[ne+tt+1],ut=O[ne+it],dt=O[ne+it+1],ht=st+at,pt=ot+ct,ft=st-at,mt=ot-ct,yt=rt+ut,bt=nt+dt,vt=et*(rt-ut),Et=et*(nt-dt);Y[te]=ht+yt,Y[te+1]=pt+bt,Y[te+2]=ft+Et,Y[te+3]=mt-vt,Y[te+4]=ht-yt,Y[te+5]=pt-bt,Y[te+6]=ft-Et,Y[te+7]=mt+vt}_realTransform4(O,Y,te){const ne=this._csize;let et=1<<this._width,tt=ne/et<<1,it,st;const ot=this._bitrev;if(tt===4)for(it=0,st=0;it<ne;it+=tt,++st){const at=ot[st];this._singleRealTransform2(Y,O,it,at>>>1,et>>>1)}else for(it=0,st=0;it<ne;it+=tt,++st){const at=ot[st];this._singleRealTransform4(Y,O,it,at>>>1,et>>>1,te)}const rt=this.table;for(et>>=2;et>=2;et>>=2){tt=ne/et<<1;const at=tt>>>1,ct=at>>>1,ut=ct>>>1;for(it=0;it<ne;it+=tt)for(let dt=0,ht=0;dt<=ut;dt+=2,ht+=et){const pt=it+dt,ft=pt+ct,mt=ft+ct,yt=mt+ct,bt=O[pt],vt=O[pt+1],Et=O[ft],wt=O[ft+1],St=O[mt],Ot=O[mt+1],$t=O[yt],Mt=O[yt+1],Nt=bt,Rt=vt,Pt=rt[ht],kt=te*rt[ht+1],Wt=Et*Pt-wt*kt,zt=Et*kt+wt*Pt,Kt=rt[2*ht],qt=te*rt[2*ht+1],Xt=St*Kt-Ot*qt,an=St*qt+Ot*Kt,pn=rt[3*ht],ln=te*rt[3*ht+1],dn=$t*pn-Mt*ln,un=$t*ln+Mt*pn,Tn=Nt+Xt,Sn=Rt+an,bn=Nt-Xt,on=Rt-an,zn=Wt+dn,Ln=zt+un,hn=te*(Wt-dn),Hn=te*(zt-un);if(O[pt]=Tn+zn,O[pt+1]=Sn+Ln,O[ft]=bn+Hn,O[ft+1]=on-hn,dt===0){O[mt]=Tn-zn,O[mt+1]=Sn-Ln;continue}if(dt===ut)continue;const Wn=it+ct-dt,Gn=it+at-dt;O[Wn]=bn-te*Hn,O[Wn+1]=-on-te*hn,O[Gn]=Tn-te*zn,O[Gn+1]=-Sn+te*Ln}}const nt=ne>>>1;for(let at=2;at<nt;at+=2)O[ne-at]=O[at],O[ne-at+1]=-O[at+1]}_singleRealTransform2(O,Y,te,ne,xe){const et=O[ne],tt=O[ne+xe];Y[te]=et+tt,Y[te+1]=0,Y[te+2]=et-tt,Y[te+3]=0}_singleRealTransform4(O,Y,te,ne,xe,et){const tt=xe*2,it=xe*3,st=O[ne],ot=O[ne+xe],rt=O[ne+tt],nt=O[ne+it],at=st+rt,ct=st-rt,ut=ot+nt,dt=et*(ot-nt);Y[te]=at+ut,Y[te+1]=0,Y[te+2]=ct,Y[te+3]=-dt,Y[te+4]=at-ut,Y[te+5]=0,Y[te+6]=ct,Y[te+7]=dt}}class NP2FFT{constructor(O){const Y=2*(O-1),te=2*(2*O-1),ne=2**Math.ceil(Math.log2(te));this.bufferSize=ne,this._a=Y;const xe=new Float64Array(te),et=new Float64Array(ne);this._chirpBuffer=new Float64Array(ne),this._buffer1=new Float64Array(ne),this._buffer2=new Float64Array(ne),this._outBuffer1=new Float64Array(ne),this._outBuffer2=new Float64Array(ne);const tt=-2*Math.PI/O,it=Math.cos(tt),st=Math.sin(tt);for(let ot=0;ot<te>>1;++ot){const rt=(ot+1-O)**2/2,nt=Math.sqrt(it**2+st**2)**rt,at=rt*Math.atan2(st,it),ct=2*ot;xe[ct]=nt*Math.cos(at),xe[ct+1]=nt*Math.sin(at),et[ct]=xe[ct],et[ct+1]=-xe[ct+1]}this._slicedChirpBuffer=xe.subarray(Y,te),this._f=new P2FFT(ne>>1),this._f.transform(this._chirpBuffer,et)}_transform(O,Y,te){const ne=this._buffer1,xe=this._buffer2,et=this._outBuffer1,tt=this._outBuffer2,it=this._chirpBuffer,st=this._slicedChirpBuffer,ot=this._a;if(te)for(let rt=0;rt<st.length;rt+=2){const nt=rt+1,at=rt>>1,ct=Y[at];ne[rt]=ct*st[rt],ne[nt]=ct*st[nt]}else for(let rt=0;rt<st.length;rt+=2){const nt=rt+1;ne[rt]=Y[rt]*st[rt]-Y[nt]*st[nt],ne[nt]=Y[rt]*st[nt]+Y[nt]*st[rt]}this._f.transform(et,ne);for(let rt=0;rt<it.length;rt+=2){const nt=rt+1;xe[rt]=et[rt]*it[rt]-et[nt]*it[nt],xe[nt]=et[rt]*it[nt]+et[nt]*it[rt]}this._f.inverseTransform(tt,xe);for(let rt=0;rt<tt.length;rt+=2){const nt=tt[rt+ot],at=tt[rt+ot+1],ct=st[rt],ut=st[rt+1];O[rt]=nt*ct-at*ut,O[rt+1]=nt*ut+at*ct}}transform(O,Y){this._transform(O,Y,!1)}realTransform(O,Y){this._transform(O,Y,!0)}}class FFT{constructor(O){this.fft_length=O,this.isPowerOfTwo=isPowerOfTwo(O),this.isPowerOfTwo?(this.fft=new P2FFT(O),this.outputBufferSize=2*O):(this.fft=new NP2FFT(O),this.outputBufferSize=this.fft.bufferSize)}realTransform(O,Y){this.fft.realTransform(O,Y)}transform(O,Y){this.fft.transform(O,Y)}}function medianFilter(ee,O){if(O%2===0||O<=0)throw new Error("Window size must be a positive odd number");const Y=new ee.constructor(ee.length),te=new ee.constructor(O),ne=Math.floor(O/2);for(let xe=0;xe<ee.length;++xe){let et=0;for(let tt=-ne;tt<=ne;++tt){let it=xe+tt;it<0?it=Math.abs(it):it>=ee.length&&(it=2*(ee.length-1)-it),te[et++]=ee[it]}te.sort(),Y[xe]=te[ne]}return Y}function round$1(ee,O){const Y=Math.pow(10,O);return Math.round(ee*Y)/Y}function bankers_round(ee){const O=Math.round(ee);return Math.abs(ee)%1===.5?O%2===0?O:O-1:O}const DataTypeMap=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),ONNXTensor$1=ONNX.Tensor;class Tensor{dims;type;data;size;constructor(...O){return O[0]instanceof ONNXTensor$1?Object.assign(this,O[0]):Object.assign(this,new ONNXTensor$1(O[0],O[1],O[2])),new Proxy(this,{get:(Y,te)=>{if(typeof te=="string"){let ne=Number(te);if(Number.isInteger(ne))return Y._getitem(ne)}return Y[te]},set:(Y,te,ne)=>Y[te]=ne})}*[Symbol.iterator](){const[O,...Y]=this.dims;if(Y.length>0){const te=Y.reduce((ne,xe)=>ne*xe);for(let ne=0;ne<O;++ne)yield this._subarray(ne,te,Y)}else yield*this.data}_getitem(O){const[Y,...te]=this.dims;if(O=safeIndex(O,Y),te.length>0){const ne=te.reduce((xe,et)=>xe*et);return this._subarray(O,ne,te)}else return new Tensor(this.type,[this.data[O]],te)}indexOf(O){for(let Y=0;Y<this.data.length;++Y)if(this.data[Y]==O)return Y;return-1}_subarray(O,Y,te){const ne=O*Y,xe=(O+1)*Y,et="subarray"in this.data?this.data.subarray(ne,xe):this.data.slice(ne,xe);return new Tensor(this.type,et,te)}item(){if(this.data.length!==1)throw new Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return reshape(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let O=0;O<this.data.length;++O)this.data[O]=1/(1+Math.exp(-this.data[O]));return this}mul(O){return this.clone().mul_(O)}mul_(O){for(let Y=0;Y<this.data.length;++Y)this.data[Y]*=O;return this}add(O){return this.clone().add_(O)}add_(O){for(let Y=0;Y<this.data.length;++Y)this.data[Y]+=O;return this}clone(){return new Tensor(this.type,this.data.slice(),this.dims.slice())}slice(...O){let Y=[],te=[];for(let it=0;it<this.dims.length;++it){let st=O[it];if(st==null)te.push([0,this.dims[it]]),Y.push(this.dims[it]);else if(typeof st=="number")st=safeIndex(st,this.dims[it],it),te.push([st,st+1]);else if(Array.isArray(st)&&st.length===2){if(st[0]>st[1])throw new Error(`Invalid slice: ${st}`);let ot=[Math.max(st[0],0),Math.min(st[1],this.dims[it])];te.push(ot),Y.push(ot[1]-ot[0])}else throw new Error(`Invalid slice: ${st}`)}let ne=te.map(([it,st])=>st-it),xe=ne.reduce((it,st)=>it*st),et=new this.data.constructor(xe);const tt=this.stride();for(let it=0;it<xe;++it){let st=0;for(let ot=ne.length-1,rt=it;ot>=0;--ot){const nt=ne[ot];st+=(rt%nt+te[ot][0])*tt[ot],rt=Math.floor(rt/nt)}et[it]=this.data[st]}return new Tensor(this.type,et,Y)}permute(...O){return permute(this,O)}transpose(...O){return this.permute(...O)}sum(O=null,Y=!1){return this.norm(1,O,Y)}norm(O="fro",Y=null,te=!1){if(O==="fro")O=2;else if(typeof O=="string")throw Error(`Unsupported norm: ${O}`);if(Y===null){let et=this.data.reduce((tt,it)=>tt+it**O,0)**(1/O);return new Tensor(this.type,[et],[])}Y=safeIndex(Y,this.dims.length);const ne=this.dims.slice();ne[Y]=1;const xe=new this.data.constructor(this.data.length/this.dims[Y]);for(let et=0;et<this.data.length;++et){let tt=0;for(let it=this.dims.length-1,st=et,ot=1;it>=0;--it){const rt=this.dims[it];if(it!==Y){const nt=st%rt;tt+=nt*ot,ot*=ne[it]}st=Math.floor(st/rt)}xe[tt]+=this.data[et]**O}if(O!==1)for(let et=0;et<xe.length;++et)xe[et]=xe[et]**(1/O);return te||ne.splice(Y,1),new Tensor(this.type,xe,ne)}normalize_(O=2,Y=1){Y=safeIndex(Y,this.dims.length);const te=this.norm(O,Y,!0);for(let ne=0;ne<this.data.length;++ne){let xe=0;for(let et=this.dims.length-1,tt=ne,it=1;et>=0;--et){const st=this.dims[et];if(et!==Y){const ot=tt%st;xe+=ot*it,it*=this.dims[et]}tt=Math.floor(tt/st)}this.data[ne]/=te.data[xe]}return this}normalize(O=2,Y=1){return this.clone().normalize_(O,Y)}stride(){return dimsToStride(this.dims)}squeeze(O=null){return new Tensor(this.type,this.data,calc_squeeze_dims(this.dims,O))}squeeze_(O=null){return this.dims=calc_squeeze_dims(this.dims,O),this}unsqueeze(O=null){return new Tensor(this.type,this.data,calc_unsqueeze_dims(this.dims,O))}unsqueeze_(O=null){return this.dims=calc_unsqueeze_dims(this.dims,O),this}flatten_(O=0,Y=-1){Y=(Y+this.dims.length)%this.dims.length;let te=this.dims.slice(0,O),ne=this.dims.slice(O,Y+1),xe=this.dims.slice(Y+1);return this.dims=[...te,ne.reduce((et,tt)=>et*tt,1),...xe],this}flatten(O=0,Y=-1){return this.clone().flatten_(O,Y)}view(...O){let Y=-1;for(let te=0;te<O.length;++te)if(O[te]===-1){if(Y!==-1)throw new Error("Only one dimension can be inferred");Y=te}if(Y!==-1){const te=O.reduce((ne,xe,et)=>et!==Y?ne*xe:ne,1);O[Y]=this.data.length/te}return new Tensor(this.type,this.data,O)}neg_(){for(let O=0;O<this.data.length;++O)this.data[O]=-this.data[O];return this}neg(){return this.clone().neg_()}clamp_(O,Y){for(let te=0;te<this.data.length;++te)this.data[te]=Math.min(Math.max(this.data[te],O),Y);return this}clamp(O,Y){return this.clone().clamp_(O,Y)}round_(){for(let O=0;O<this.data.length;++O)this.data[O]=Math.round(this.data[O]);return this}round(){return this.clone().round_()}to(O){if(this.type===O)return this;if(!DataTypeMap.hasOwnProperty(O))throw new Error(`Unsupported type: ${O}`);return new Tensor(O,DataTypeMap[O].from(this.data),this.dims)}}function reshape(ee,O){const Y=ee.length,te=O.reduce((xe,et)=>xe*et);if(Y!==te)throw Error(`cannot reshape array of size ${Y} into shape (${O})`);let ne=ee;for(let xe=O.length-1;xe>=0;xe--)ne=ne.reduce((et,tt)=>{let it=et[et.length-1];return it.length<O[xe]?it.push(tt):et.push([tt]),et},[[]]);return ne[0]}function permute(ee,O){const[Y,te]=permute_data(ee.data,ee.dims,O);return new Tensor(ee.type,Y,te)}function interpolate(ee,[O,Y],te="bilinear",ne=!1){const xe=ee.dims.at(-3)??1,et=ee.dims.at(-2),tt=ee.dims.at(-1);let it=interpolate_data(ee.data,[xe,et,tt],[O,Y],te,ne);return new Tensor(ee.type,it,[xe,O,Y])}function mean_pooling(ee,O){let Y=[ee.dims[0],ee.dims[2]],te=new ee.data.constructor(Y[0]*Y[1]),[ne,xe,et]=ee.dims,tt=0;for(let it=0;it<ne;++it){let st=it*et*xe;for(let ot=0;ot<et;++ot){let rt=0,nt=0,at=it*xe,ct=st+ot;for(let dt=0;dt<xe;++dt){let ht=Number(O.data[at+dt]);nt+=ht,rt+=ee.data[ct+dt*et]*ht}let ut=rt/nt;te[tt++]=ut}}return new Tensor(ee.type,te,Y)}function calc_squeeze_dims(ee,O){return ee=ee.slice(),O===null?ee=ee.filter(Y=>Y!==1):typeof O=="number"?ee[O]===1&&ee.splice(O,1):Array.isArray(O)&&(ee=ee.filter((Y,te)=>Y!==1||!O.includes(te))),ee}function calc_unsqueeze_dims(ee,O){return O=safeIndex(O,ee.length+1),ee=ee.slice(),ee.splice(O,0,1),ee}function safeIndex(ee,O,Y=null){if(ee<-O||ee>=O)throw new Error(`IndexError: index ${ee} is out of bounds for dimension${Y===null?"":" "+Y} with size ${O}`);return ee<0&&(ee=(ee%O+O)%O),ee}function cat(ee,O=0){O=safeIndex(O,ee[0].dims.length);const Y=ee[0].dims.slice();Y[O]=ee.reduce((et,tt)=>et+tt.dims[O],0);const te=Y.reduce((et,tt)=>et*tt,1),ne=new ee[0].data.constructor(te),xe=ee[0].type;if(O===0){let et=0;for(let tt of ee)ne.set(tt.data,et),et+=tt.data.length}else{let et=0;for(let tt=0;tt<ee.length;++tt){let it=ee[tt];for(let st=0;st<it.data.length;++st){let ot=0;for(let rt=it.dims.length-1,nt=st,at=1;rt>=0;--rt){const ct=it.dims[rt];let ut=nt%ct;rt===O&&(ut+=et),ot+=ut*at,at*=Y[rt],nt=Math.floor(nt/ct)}ne[ot]=it.data[st]}et+=it.dims[O]}}return new Tensor(xe,ne,Y)}function stack(ee,O=0){return cat(ee.map(Y=>Y.unsqueeze(O)),O)}function std_mean(ee,O=null,Y=1,te=!1){if(O===null){const st=ee.data.reduce((at,ct)=>at+ct,0)/ee.data.length,ot=Math.sqrt(ee.data.reduce((at,ct)=>at+(ct-st)**2,0)/(ee.data.length-Y)),rt=new Tensor(ee.type,[st],[]);return[new Tensor(ee.type,[ot],[]),rt]}O=safeIndex(O,ee.dims.length);const ne=mean(ee,O,te),xe=ee.dims.slice();xe[O]=1;const et=new ee.data.constructor(ee.data.length/ee.dims[O]);for(let it=0;it<ee.data.length;++it){let st=0;for(let ot=ee.dims.length-1,rt=it,nt=1;ot>=0;--ot){const at=ee.dims[ot];if(ot!==O){const ct=rt%at;st+=ct*nt,nt*=xe[ot]}rt=Math.floor(rt/at)}et[st]+=(ee.data[it]-ne.data[st])**2}for(let it=0;it<et.length;++it)et[it]=Math.sqrt(et[it]/(ee.dims[O]-Y));return te||xe.splice(O,1),[new Tensor(ee.type,et,xe),ne]}function mean(ee,O=null,Y=!1){if(O===null){let xe=ee.data.reduce((et,tt)=>et+tt,0);return new Tensor(ee.type,[xe/ee.data.length],[])}O=safeIndex(O,ee.dims.length);const te=ee.dims.slice();te[O]=1;const ne=new ee.data.constructor(ee.data.length/ee.dims[O]);for(let xe=0;xe<ee.data.length;++xe){let et=0;for(let tt=ee.dims.length-1,it=xe,st=1;tt>=0;--tt){const ot=ee.dims[tt];if(tt!==O){const rt=it%ot;et+=rt*st,st*=te[tt]}it=Math.floor(it/ot)}ne[et]+=ee.data[xe]}if(ee.dims[O]!==1)for(let xe=0;xe<ne.length;++xe)ne[xe]=ne[xe]/ee.dims[O];return Y||te.splice(O,1),new Tensor(ee.type,ne,te)}function dynamicTimeWarping(ee){const[O,Y]=ee.dims,te=[O+1,Y+1],ne=new Tensor("float32",new Float32Array(te[0]*te[1]).fill(1/0),te),xe=new Tensor("float32",new Float32Array(te[0]*te[1]).fill(-1),te);ne[0].data[0]=0;for(let ot=1;ot<Y+1;++ot)for(let rt=1;rt<O+1;++rt){const nt=ne[rt-1][ot-1].item(),at=ne[rt-1][ot].item(),ct=ne[rt][ot-1].item();let ut,dt;nt<at&&nt<ct?(ut=nt,dt=0):at<nt&&at<ct?(ut=at,dt=1):(ut=ct,dt=2),ne[rt].data[ot]=ee[rt-1][ot-1].item()+ut,xe[rt].data[ot]=dt}let et=O,tt=Y;xe.data.fill(2,0,te[1]);for(let ot=0;ot<te[0];++ot)xe[ot].data[0]=1;let it=[],st=[];for(;et>0||tt>0;)switch(it.push(et-1),st.push(tt-1),xe[et][tt].item()){case 0:--et,--tt;break;case 1:--et;break;case 2:--tt;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${et}, ${tt}]. Please file a bug report.`)}return it.reverse(),st.reverse(),[it,st]}function dimsToStride(ee){const O=new Array(ee.length);for(let Y=ee.length-1,te=1;Y>=0;--Y)O[Y]=te,te*=ee[Y];return O}function ones(ee){const O=ee.reduce((Y,te)=>Y*te,1);return new Tensor("int64",new BigInt64Array(O).fill(1n),ee)}function ones_like(ee){return ones(ee.dims)}function quantize_embeddings(ee,O){if(ee.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(ee.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(O))throw new Error("The precision must be either 'binary' or 'ubinary'");const Y=O==="binary",te=Y?"int8":"uint8",ne=Y?Int8Array:Uint8Array,xe=ee.data,et=new ne(xe.length/8);for(let tt=0;tt<xe.length;++tt){const it=xe[tt]>0?1:0,st=Math.floor(tt/8),ot=tt%8;et[st]|=it<<7-ot,Y&&ot===0&&(et[st]-=128)}return new Tensor(te,et,[ee.dims[0],ee.dims[1]/8])}let PriorityQueue$1=class{constructor(O=(Y,te)=>Y>te){this._heap=[],this._comparator=O}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...O){return this.extend(O)}extend(O){for(const Y of O)this._heap.push(Y),this._siftUp();return this.size}pop(){const O=this.peek(),Y=this.size-1;return Y>0&&this._swap(0,Y),this._heap.pop(),this._siftDown(),O}replace(O){const Y=this.peek();return this._heap[0]=O,this._siftDown(),Y}_parent(O){return(O+1>>>1)-1}_left(O){return(O<<1)+1}_right(O){return O+1<<1}_greater(O,Y){return this._comparator(this._heap[O],this._heap[Y])}_swap(O,Y){const te=this._heap[O];this._heap[O]=this._heap[Y],this._heap[Y]=te}_siftUp(){let O=this.size-1;for(;O>0&&this._greater(O,this._parent(O));)this._swap(O,this._parent(O)),O=this._parent(O)}_siftDown(){let O=0;for(;this._left(O)<this.size&&this._greater(this._left(O),O)||this._right(O)<this.size&&this._greater(this._right(O),O);){const Y=this._right(O)<this.size&&this._greater(this._right(O),this._left(O))?this._right(O):this._left(O);this._swap(O,Y),O=Y}}};class CharTrie{constructor(){this.root=CharTrieNode.default()}extend(O){for(let Y of O)this.push(Y)}push(O){let Y=this.root;for(let te of O){let ne=Y.children.get(te);ne===void 0&&(ne=CharTrieNode.default(),Y.children.set(te,ne)),Y=ne}Y.isLeaf=!0}*commonPrefixSearch(O){let Y=this.root,te="";for(let ne=0;ne<O.length&&Y!==void 0;++ne){const xe=O[ne];te+=xe,Y=Y.children.get(xe),Y!==void 0&&Y.isLeaf&&(yield te)}}}class CharTrieNode{constructor(O,Y){this.isLeaf=O,this.children=Y}static default(){return new CharTrieNode(!1,new Map)}}class TokenLattice{constructor(O,Y,te){this.sentence=O,this.len=O.length,this.bosTokenId=Y,this.eosTokenId=te,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const ne=new TokenLatticeNode(this.bosTokenId,0,0,0,0),xe=new TokenLatticeNode(this.eosTokenId,1,this.len,0,0);this.nodes.push(ne.clone()),this.nodes.push(xe.clone()),this.beginNodes[this.len].push(xe),this.endNodes[0].push(ne)}insert(O,Y,te,ne){const xe=this.nodes.length,et=new TokenLatticeNode(ne,xe,O,Y,te);this.beginNodes[O].push(et),this.endNodes[O+Y].push(et),this.nodes.push(et)}viterbi(){const O=this.len;let Y=0;for(;Y<=O;){if(this.beginNodes[Y].length==0)return[];for(let tt of this.beginNodes[Y]){tt.prev=null;let it=0,st=null;for(let ot of this.endNodes[Y]){const rt=ot.backtraceScore+tt.score;(st===null||rt>it)&&(st=ot.clone(),it=rt)}if(st!==null)tt.prev=st,tt.backtraceScore=it;else return[]}++Y}const te=[],xe=this.beginNodes[O][0].prev;if(xe===null)return[];let et=xe.clone();for(;et.prev!==null;)te.push(et.clone()),et=et.clone().prev.clone();return te.reverse(),te}piece(O){return this.sentence.slice(O.pos,O.pos+O.length)}tokens(){return this.viterbi().map(Y=>this.piece(Y))}tokenIds(){return this.viterbi().map(Y=>Y.tokenId)}}class TokenLatticeNode{constructor(O,Y,te,ne,xe){this.tokenId=O,this.nodeId=Y,this.pos=te,this.length=ne,this.score=xe,this.prev=null,this.backtraceScore=0}clone(){const O=new TokenLatticeNode(this.tokenId,this.nodeId,this.pos,this.length,this.score);return O.prev=this.prev,O.backtraceScore=this.backtraceScore,O}}var TOKEN_TYPES=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),KEYWORDS=Object.freeze({set:TOKEN_TYPES.Set,for:TOKEN_TYPES.For,in:TOKEN_TYPES.In,is:TOKEN_TYPES.Is,if:TOKEN_TYPES.If,else:TOKEN_TYPES.Else,endif:TOKEN_TYPES.EndIf,elif:TOKEN_TYPES.ElseIf,endfor:TOKEN_TYPES.EndFor,and:TOKEN_TYPES.And,or:TOKEN_TYPES.Or,not:TOKEN_TYPES.Not,"not in":TOKEN_TYPES.NotIn,true:TOKEN_TYPES.BooleanLiteral,false:TOKEN_TYPES.BooleanLiteral}),Token=class{constructor(ee,O){this.value=ee,this.type=O}};function isWord(ee){return/\w/.test(ee)}function isInteger(ee){return/[0-9]/.test(ee)}var ORDERED_MAPPING_TABLE=[["{%",TOKEN_TYPES.OpenStatement],["%}",TOKEN_TYPES.CloseStatement],["{{",TOKEN_TYPES.OpenExpression],["}}",TOKEN_TYPES.CloseExpression],["(",TOKEN_TYPES.OpenParen],[")",TOKEN_TYPES.CloseParen],["{",TOKEN_TYPES.OpenCurlyBracket],["}",TOKEN_TYPES.CloseCurlyBracket],["[",TOKEN_TYPES.OpenSquareBracket],["]",TOKEN_TYPES.CloseSquareBracket],[",",TOKEN_TYPES.Comma],[".",TOKEN_TYPES.Dot],[":",TOKEN_TYPES.Colon],["|",TOKEN_TYPES.Pipe],["<=",TOKEN_TYPES.ComparisonBinaryOperator],[">=",TOKEN_TYPES.ComparisonBinaryOperator],["==",TOKEN_TYPES.ComparisonBinaryOperator],["!=",TOKEN_TYPES.ComparisonBinaryOperator],["<",TOKEN_TYPES.ComparisonBinaryOperator],[">",TOKEN_TYPES.ComparisonBinaryOperator],["+",TOKEN_TYPES.AdditiveBinaryOperator],["-",TOKEN_TYPES.AdditiveBinaryOperator],["*",TOKEN_TYPES.MultiplicativeBinaryOperator],["/",TOKEN_TYPES.MultiplicativeBinaryOperator],["%",TOKEN_TYPES.MultiplicativeBinaryOperator],["=",TOKEN_TYPES.Equals]],ESCAPE_CHARACTERS=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function preprocess(ee,O={}){return ee.endsWith(`
`)&&(ee=ee.slice(0,-1)),ee=ee.replace(/{#.*?#}/gs,"{##}"),O.lstrip_blocks&&(ee=ee.replace(/^[ \t]*({[#%])/gm,"$1")),O.trim_blocks&&(ee=ee.replace(/([#%]})\n/g,"$1")),ee.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function tokenize(ee,O={}){const Y=[],te=preprocess(ee,O);let ne=0;const xe=et=>{let tt="";for(;et(te[ne]);){if(te[ne]==="\\"){if(++ne,ne>=te.length)throw new SyntaxError("Unexpected end of input");const it=te[ne++],st=ESCAPE_CHARACTERS.get(it);if(st===void 0)throw new SyntaxError(`Unexpected escaped character: ${it}`);tt+=st;continue}if(tt+=te[ne++],ne>=te.length)throw new SyntaxError("Unexpected end of input")}return tt};e:for(;ne<te.length;){const et=Y.at(-1)?.type;if(et===void 0||et===TOKEN_TYPES.CloseStatement||et===TOKEN_TYPES.CloseExpression){let it="";for(;ne<te.length&&!(te[ne]==="{"&&(te[ne+1]==="%"||te[ne+1]==="{"));)it+=te[ne++];if(it.length>0){Y.push(new Token(it,TOKEN_TYPES.Text));continue}}xe(it=>/\s/.test(it));const tt=te[ne];if(tt==="-"||tt==="+"){const it=Y.at(-1)?.type;if(it===TOKEN_TYPES.Text||it===void 0)throw new SyntaxError(`Unexpected character: ${tt}`);switch(it){case TOKEN_TYPES.Identifier:case TOKEN_TYPES.NumericLiteral:case TOKEN_TYPES.BooleanLiteral:case TOKEN_TYPES.StringLiteral:case TOKEN_TYPES.CloseParen:case TOKEN_TYPES.CloseSquareBracket:break;default:{++ne;const st=xe(isInteger);Y.push(new Token(`${tt}${st}`,st.length>0?TOKEN_TYPES.NumericLiteral:TOKEN_TYPES.UnaryOperator));continue}}}for(const[it,st]of ORDERED_MAPPING_TABLE)if(te.slice(ne,ne+it.length)===it){Y.push(new Token(it,st)),ne+=it.length;continue e}if(tt==="'"||tt==='"'){++ne;const it=xe(st=>st!==tt);Y.push(new Token(it,TOKEN_TYPES.StringLiteral)),++ne;continue}if(isInteger(tt)){const it=xe(isInteger);Y.push(new Token(it,TOKEN_TYPES.NumericLiteral));continue}if(isWord(tt)){const it=xe(isWord),st=Object.hasOwn(KEYWORDS,it)?KEYWORDS[it]:TOKEN_TYPES.Identifier;st===TOKEN_TYPES.In&&Y.at(-1)?.type===TOKEN_TYPES.Not?(Y.pop(),Y.push(new Token("not in",TOKEN_TYPES.NotIn))):Y.push(new Token(it,st));continue}throw new SyntaxError(`Unexpected character: ${tt}`)}return Y}var Statement=class{type="Statement"},Program=class extends Statement{constructor(ee){super(),this.body=ee}type="Program"},If=class extends Statement{constructor(ee,O,Y){super(),this.test=ee,this.body=O,this.alternate=Y}type="If"},For=class extends Statement{constructor(ee,O,Y){super(),this.loopvar=ee,this.iterable=O,this.body=Y}type="For"},SetStatement=class extends Statement{constructor(ee,O){super(),this.assignee=ee,this.value=O}type="Set"},Expression=class extends Statement{type="Expression"},MemberExpression=class extends Expression{constructor(ee,O,Y){super(),this.object=ee,this.property=O,this.computed=Y}type="MemberExpression"},CallExpression$1=class extends Expression{constructor(O,Y){super(),this.callee=O,this.args=Y}type="CallExpression"},Identifier=class extends Expression{constructor(ee){super(),this.value=ee}type="Identifier"},Literal$1=class extends Expression{constructor(O){super(),this.value=O}type="Literal"},NumericLiteral=class extends Literal$1{type="NumericLiteral"},StringLiteral=class extends Literal$1{type="StringLiteral"},BooleanLiteral=class extends Literal$1{type="BooleanLiteral"},ArrayLiteral=class extends Literal$1{type="ArrayLiteral"},TupleLiteral=class extends Literal$1{type="TupleLiteral"},ObjectLiteral=class extends Literal$1{type="ObjectLiteral"},BinaryExpression=class extends Expression{constructor(ee,O,Y){super(),this.operator=ee,this.left=O,this.right=Y}type="BinaryExpression"},FilterExpression=class extends Expression{constructor(ee,O){super(),this.operand=ee,this.filter=O}type="FilterExpression"},TestExpression=class extends Expression{constructor(ee,O,Y){super(),this.operand=ee,this.negate=O,this.test=Y}type="TestExpression"},UnaryExpression=class extends Expression{constructor(ee,O){super(),this.operator=ee,this.argument=O}type="UnaryExpression"},SliceExpression=class extends Expression{constructor(ee=void 0,O=void 0,Y=void 0){super(),this.start=ee,this.stop=O,this.step=Y}type="SliceExpression"},KeywordArgumentExpression=class extends Expression{constructor(ee,O){super(),this.key=ee,this.value=O}type="KeywordArgumentExpression"};function parse$2(ee){const O=new Program([]);let Y=0;function te(Rt,Pt){const kt=ee[Y++];if(!kt||kt.type!==Rt)throw new Error(`Parser Error: ${Pt}. ${kt.type} !== ${Rt}.`);return kt}function ne(){switch(ee[Y].type){case TOKEN_TYPES.Text:return tt();case TOKEN_TYPES.OpenStatement:return it();case TOKEN_TYPES.OpenExpression:return st();default:throw new SyntaxError(`Unexpected token type: ${ee[Y].type}`)}}function xe(...Rt){return Y+Rt.length<=ee.length&&Rt.some((Pt,kt)=>Pt!==ee[Y+kt].type)}function et(...Rt){return Y+Rt.length<=ee.length&&Rt.every((Pt,kt)=>Pt===ee[Y+kt].type)}function tt(){return new StringLiteral(te(TOKEN_TYPES.Text,"Expected text token").value)}function it(){te(TOKEN_TYPES.OpenStatement,"Expected opening statement token");let Rt;switch(ee[Y].type){case TOKEN_TYPES.Set:++Y,Rt=ot(),te(TOKEN_TYPES.CloseStatement,"Expected closing statement token");break;case TOKEN_TYPES.If:++Y,Rt=rt(),te(TOKEN_TYPES.OpenStatement,"Expected {% token"),te(TOKEN_TYPES.EndIf,"Expected endif token"),te(TOKEN_TYPES.CloseStatement,"Expected %} token");break;case TOKEN_TYPES.For:++Y,Rt=at(),te(TOKEN_TYPES.OpenStatement,"Expected {% token"),te(TOKEN_TYPES.EndFor,"Expected endfor token"),te(TOKEN_TYPES.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${ee[Y].type}`)}return Rt}function st(){te(TOKEN_TYPES.OpenExpression,"Expected opening expression token");const Rt=ct();return te(TOKEN_TYPES.CloseExpression,"Expected closing expression token"),Rt}function ot(){const Rt=ct();if(et(TOKEN_TYPES.Equals)){++Y;const Pt=ot();return new SetStatement(Rt,Pt)}return Rt}function rt(){const Rt=ct();te(TOKEN_TYPES.CloseStatement,"Expected closing statement token");const Pt=[],kt=[];for(;!(ee[Y]?.type===TOKEN_TYPES.OpenStatement&&(ee[Y+1]?.type===TOKEN_TYPES.ElseIf||ee[Y+1]?.type===TOKEN_TYPES.Else||ee[Y+1]?.type===TOKEN_TYPES.EndIf));)Pt.push(ne());if(ee[Y]?.type===TOKEN_TYPES.OpenStatement&&ee[Y+1]?.type!==TOKEN_TYPES.EndIf)if(++Y,et(TOKEN_TYPES.ElseIf))te(TOKEN_TYPES.ElseIf,"Expected elseif token"),kt.push(rt());else for(te(TOKEN_TYPES.Else,"Expected else token"),te(TOKEN_TYPES.CloseStatement,"Expected closing statement token");!(ee[Y]?.type===TOKEN_TYPES.OpenStatement&&ee[Y+1]?.type===TOKEN_TYPES.EndIf);)kt.push(ne());return new If(Rt,Pt,kt)}function nt(Rt=!1){const Pt=Rt?Nt:ct,kt=[Pt()],Wt=et(TOKEN_TYPES.Comma);for(;Wt&&(++Y,kt.push(Pt()),!!et(TOKEN_TYPES.Comma)););return Wt?new TupleLiteral(kt):kt[0]}function at(){const Rt=nt(!0);if(!(Rt instanceof Identifier||Rt instanceof TupleLiteral))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${Rt.type} instead`);te(TOKEN_TYPES.In,"Expected `in` keyword following loop variable");const Pt=ct();te(TOKEN_TYPES.CloseStatement,"Expected closing statement token");const kt=[];for(;xe(TOKEN_TYPES.OpenStatement,TOKEN_TYPES.EndFor);)kt.push(ne());return new For(Rt,Pt,kt)}function ct(){return ut()}function ut(){const Rt=dt();if(et(TOKEN_TYPES.If)){++Y;const Pt=dt();te(TOKEN_TYPES.Else,"Expected else token");const kt=dt();return new If(Pt,[Rt],[kt])}return Rt}function dt(){let Rt=ht();for(;et(TOKEN_TYPES.Or);){const Pt=ee[Y];++Y;const kt=ht();Rt=new BinaryExpression(Pt,Rt,kt)}return Rt}function ht(){let Rt=pt();for(;et(TOKEN_TYPES.And);){const Pt=ee[Y];++Y;const kt=pt();Rt=new BinaryExpression(Pt,Rt,kt)}return Rt}function pt(){let Rt;for(;et(TOKEN_TYPES.Not);){const Pt=ee[Y];++Y;const kt=pt();Rt=new UnaryExpression(Pt,kt)}return Rt??ft()}function ft(){let Rt=mt();for(;et(TOKEN_TYPES.ComparisonBinaryOperator)||et(TOKEN_TYPES.In)||et(TOKEN_TYPES.NotIn);){const Pt=ee[Y];++Y;const kt=mt();Rt=new BinaryExpression(Pt,Rt,kt)}return Rt}function mt(){let Rt=Ot();for(;et(TOKEN_TYPES.AdditiveBinaryOperator);){const Pt=ee[Y];++Y;const kt=Ot();Rt=new BinaryExpression(Pt,Rt,kt)}return Rt}function yt(){const Rt=St();return et(TOKEN_TYPES.OpenParen)?bt(Rt):Rt}function bt(Rt){let Pt=new CallExpression$1(Rt,vt());return et(TOKEN_TYPES.OpenParen)&&(Pt=bt(Pt)),Pt}function vt(){te(TOKEN_TYPES.OpenParen,"Expected opening parenthesis for arguments list");const Rt=Et();return te(TOKEN_TYPES.CloseParen,"Expected closing parenthesis for arguments list"),Rt}function Et(){const Rt=[];for(;!et(TOKEN_TYPES.CloseParen);){let Pt=ct();if(et(TOKEN_TYPES.Equals)){if(++Y,!(Pt instanceof Identifier))throw new SyntaxError("Expected identifier for keyword argument");const kt=ct();Pt=new KeywordArgumentExpression(Pt,kt)}Rt.push(Pt),et(TOKEN_TYPES.Comma)&&++Y}return Rt}function wt(){const Rt=[];let Pt=!1;for(;!et(TOKEN_TYPES.CloseSquareBracket);)et(TOKEN_TYPES.Colon)?(Rt.push(void 0),++Y,Pt=!0):(Rt.push(ct()),et(TOKEN_TYPES.Colon)&&(++Y,Pt=!0));if(Rt.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(Pt){if(Rt.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new SliceExpression(...Rt)}return Rt[0]}function St(){let Rt=Nt();for(;et(TOKEN_TYPES.Dot)||et(TOKEN_TYPES.OpenSquareBracket);){const Pt=ee[Y];++Y;let kt;const Wt=Pt.type!==TOKEN_TYPES.Dot;if(Wt)kt=wt(),te(TOKEN_TYPES.CloseSquareBracket,"Expected closing square bracket");else if(kt=Nt(),kt.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");Rt=new MemberExpression(Rt,kt,Wt)}return Rt}function Ot(){let Rt=$t();for(;et(TOKEN_TYPES.MultiplicativeBinaryOperator);){const Pt=ee[Y];++Y;const kt=$t();Rt=new BinaryExpression(Pt,Rt,kt)}return Rt}function $t(){let Rt=Mt();for(;et(TOKEN_TYPES.Is);){++Y;const Pt=et(TOKEN_TYPES.Not);Pt&&++Y;let kt=Nt();if(kt instanceof BooleanLiteral&&(kt=new Identifier(kt.value.toString())),!(kt instanceof Identifier))throw new SyntaxError("Expected identifier for the test");Rt=new TestExpression(Rt,Pt,kt)}return Rt}function Mt(){let Rt=yt();for(;et(TOKEN_TYPES.Pipe);){++Y;let Pt=Nt();if(!(Pt instanceof Identifier))throw new SyntaxError("Expected identifier for the filter");et(TOKEN_TYPES.OpenParen)&&(Pt=bt(Pt)),Rt=new FilterExpression(Rt,Pt)}return Rt}function Nt(){const Rt=ee[Y];switch(Rt.type){case TOKEN_TYPES.NumericLiteral:return++Y,new NumericLiteral(Number(Rt.value));case TOKEN_TYPES.StringLiteral:return++Y,new StringLiteral(Rt.value);case TOKEN_TYPES.BooleanLiteral:return++Y,new BooleanLiteral(Rt.value==="true");case TOKEN_TYPES.Identifier:return++Y,new Identifier(Rt.value);case TOKEN_TYPES.OpenParen:{++Y;const Pt=nt();if(ee[Y].type!==TOKEN_TYPES.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${ee[Y].type} instead`);return++Y,Pt}case TOKEN_TYPES.OpenSquareBracket:{++Y;const Pt=[];for(;!et(TOKEN_TYPES.CloseSquareBracket);)Pt.push(ct()),et(TOKEN_TYPES.Comma)&&++Y;return++Y,new ArrayLiteral(Pt)}case TOKEN_TYPES.OpenCurlyBracket:{++Y;const Pt=new Map;for(;!et(TOKEN_TYPES.CloseCurlyBracket);){const kt=ct();te(TOKEN_TYPES.Colon,"Expected colon between key and value in object literal");const Wt=ct();Pt.set(kt,Wt),et(TOKEN_TYPES.Comma)&&++Y}return++Y,new ObjectLiteral(Pt)}default:throw new SyntaxError(`Unexpected token: ${Rt.type}`)}}for(;Y<ee.length;)O.body.push(ne());return O}function range(ee,O,Y=1){O===void 0&&(O=ee,ee=0);const te=[];for(let ne=ee;ne<O;ne+=Y)te.push(ne);return te}function slice(ee,O,Y,te=1){const ne=Math.sign(te);ne>=0?(O=(O??=0)<0?Math.max(ee.length+O,0):Math.min(O,ee.length),Y=(Y??=ee.length)<0?Math.max(ee.length+Y,0):Math.min(Y,ee.length)):(O=(O??=ee.length-1)<0?Math.max(ee.length+O,-1):Math.min(O,ee.length-1),Y=(Y??=-1)<-1?Math.max(ee.length+Y,-1):Math.min(Y,ee.length-1));const xe=[];for(let et=O;ne*et<ne*Y;et+=te)xe.push(ee[et]);return xe}function titleCase(ee){return ee.replace(/\b\w/g,O=>O.toUpperCase())}var RuntimeValue=class{type="RuntimeValue";value;builtins=new Map;constructor(ee=void 0){this.value=ee}__bool__(){return new BooleanValue(!!this.value)}},NumericValue=class extends RuntimeValue{type="NumericValue"},StringValue=class extends RuntimeValue{type="StringValue";builtins=new Map([["upper",new FunctionValue(()=>new StringValue(this.value.toUpperCase()))],["lower",new FunctionValue(()=>new StringValue(this.value.toLowerCase()))],["strip",new FunctionValue(()=>new StringValue(this.value.trim()))],["title",new FunctionValue(()=>new StringValue(titleCase(this.value)))],["length",new NumericValue(this.value.length)]])},BooleanValue=class extends RuntimeValue{type="BooleanValue"},ObjectValue=class extends RuntimeValue{type="ObjectValue";__bool__(){return new BooleanValue(this.value.size>0)}builtins=new Map([["get",new FunctionValue(([ee,O])=>{if(!(ee instanceof StringValue))throw new Error(`Object key must be a string: got ${ee.type}`);return this.value.get(ee.value)??O??new NullValue})],["items",new FunctionValue(()=>new ArrayValue(Array.from(this.value.entries()).map(([ee,O])=>new ArrayValue([new StringValue(ee),O]))))]])},ArrayValue=class extends RuntimeValue{type="ArrayValue";builtins=new Map([["length",new NumericValue(this.value.length)]]);__bool__(){return new BooleanValue(this.value.length>0)}},TupleValue=class extends ArrayValue{type="TupleValue"},FunctionValue=class extends RuntimeValue{type="FunctionValue"},NullValue=class extends RuntimeValue{type="NullValue"},UndefinedValue=class extends RuntimeValue{type="UndefinedValue"},Environment=class{constructor(ee){this.parent=ee}variables=new Map([["namespace",new FunctionValue(ee=>{if(ee.length===0)return new ObjectValue(new Map);if(ee.length!==1||!(ee[0]instanceof ObjectValue))throw new Error("`namespace` expects either zero arguments or a single object argument");return ee[0]})]]);tests=new Map([["boolean",ee=>ee.type==="BooleanValue"],["callable",ee=>ee instanceof FunctionValue],["odd",ee=>{if(ee.type!=="NumericValue")throw new Error(`Cannot apply test "odd" to type: ${ee.type}`);return ee.value%2!==0}],["even",ee=>{if(ee.type!=="NumericValue")throw new Error(`Cannot apply test "even" to type: ${ee.type}`);return ee.value%2===0}],["false",ee=>ee.type==="BooleanValue"&&!ee.value],["true",ee=>ee.type==="BooleanValue"&&ee.value],["number",ee=>ee.type==="NumericValue"],["integer",ee=>ee.type==="NumericValue"&&Number.isInteger(ee.value)],["iterable",ee=>ee instanceof ArrayValue||ee instanceof StringValue],["lower",ee=>{const O=ee.value;return ee.type==="StringValue"&&O===O.toLowerCase()}],["upper",ee=>{const O=ee.value;return ee.type==="StringValue"&&O===O.toUpperCase()}],["none",ee=>ee.type==="NullValue"],["defined",ee=>ee.type!=="UndefinedValue"],["undefined",ee=>ee.type==="UndefinedValue"],["equalto",(ee,O)=>ee.value===O.value]]);set(ee,O){return this.declareVariable(ee,convertToRuntimeValues(O))}declareVariable(ee,O){if(this.variables.has(ee))throw new SyntaxError(`Variable already declared: ${ee}`);return this.variables.set(ee,O),O}setVariable(ee,O){return this.variables.set(ee,O),O}resolve(ee){if(this.variables.has(ee))return this;if(this.parent)return this.parent.resolve(ee);throw new Error(`Unknown variable: ${ee}`)}lookupVariable(ee){try{return this.resolve(ee).variables.get(ee)??new UndefinedValue}catch{return new UndefinedValue}}},Interpreter=class{global;constructor(ee){this.global=ee??new Environment}run(ee){return this.evaluate(ee,this.global)}evaluateBinaryExpression(ee,O){const Y=this.evaluate(ee.left,O);switch(ee.operator.value){case"and":return Y.__bool__().value?this.evaluate(ee.right,O):Y;case"or":return Y.__bool__().value?Y:this.evaluate(ee.right,O)}const te=this.evaluate(ee.right,O);switch(ee.operator.value){case"==":return new BooleanValue(Y.value==te.value);case"!=":return new BooleanValue(Y.value!=te.value)}if(Y instanceof UndefinedValue||te instanceof UndefinedValue)throw new Error("Cannot perform operation on undefined values");if(Y instanceof NullValue||te instanceof NullValue)throw new Error("Cannot perform operation on null values");if(Y instanceof NumericValue&&te instanceof NumericValue)switch(ee.operator.value){case"+":return new NumericValue(Y.value+te.value);case"-":return new NumericValue(Y.value-te.value);case"*":return new NumericValue(Y.value*te.value);case"/":return new NumericValue(Y.value/te.value);case"%":return new NumericValue(Y.value%te.value);case"<":return new BooleanValue(Y.value<te.value);case">":return new BooleanValue(Y.value>te.value);case">=":return new BooleanValue(Y.value>=te.value);case"<=":return new BooleanValue(Y.value<=te.value)}else if(Y instanceof ArrayValue&&te instanceof ArrayValue)switch(ee.operator.value){case"+":return new ArrayValue(Y.value.concat(te.value))}else if(te instanceof ArrayValue){const ne=te.value.find(xe=>xe.value===Y.value)!==void 0;switch(ee.operator.value){case"in":return new BooleanValue(ne);case"not in":return new BooleanValue(!ne)}}if(Y instanceof StringValue||te instanceof StringValue)switch(ee.operator.value){case"+":return new StringValue(Y.value.toString()+te.value.toString())}if(Y instanceof StringValue&&te instanceof StringValue)switch(ee.operator.value){case"in":return new BooleanValue(te.value.includes(Y.value));case"not in":return new BooleanValue(!te.value.includes(Y.value))}if(Y instanceof StringValue&&te instanceof ObjectValue)switch(ee.operator.value){case"in":return new BooleanValue(te.value.has(Y.value));case"not in":return new BooleanValue(!te.value.has(Y.value))}throw new SyntaxError(`Unknown operator "${ee.operator.value}" between ${Y.type} and ${te.type}`)}evaluateFilterExpression(ee,O){const Y=this.evaluate(ee.operand,O);if(ee.filter.type==="Identifier"){const te=ee.filter;if(Y instanceof ArrayValue)switch(te.value){case"list":return Y;case"first":return Y.value[0];case"last":return Y.value[Y.value.length-1];case"length":return new NumericValue(Y.value.length);case"reverse":return new ArrayValue(Y.value.reverse());case"sort":return new ArrayValue(Y.value.sort((ne,xe)=>{if(ne.type!==xe.type)throw new Error(`Cannot compare different types: ${ne.type} and ${xe.type}`);switch(ne.type){case"NumericValue":return ne.value-xe.value;case"StringValue":return ne.value.localeCompare(xe.value);default:throw new Error(`Cannot compare type: ${ne.type}`)}}));default:throw new Error(`Unknown ArrayValue filter: ${te.value}`)}else if(Y instanceof StringValue)switch(te.value){case"length":return new NumericValue(Y.value.length);case"upper":return new StringValue(Y.value.toUpperCase());case"lower":return new StringValue(Y.value.toLowerCase());case"title":return new StringValue(titleCase(Y.value));case"capitalize":return new StringValue(Y.value.charAt(0).toUpperCase()+Y.value.slice(1));case"trim":return new StringValue(Y.value.trim());default:throw new Error(`Unknown StringValue filter: ${te.value}`)}else if(Y instanceof NumericValue)switch(te.value){case"abs":return new NumericValue(Math.abs(Y.value));default:throw new Error(`Unknown NumericValue filter: ${te.value}`)}else if(Y instanceof ObjectValue)switch(te.value){case"items":return new ArrayValue(Array.from(Y.value.entries()).map(([ne,xe])=>new ArrayValue([new StringValue(ne),xe])));case"length":return new NumericValue(Y.value.size);default:throw new Error(`Unknown ObjectValue filter: ${te.value}`)}throw new Error(`Cannot apply filter "${te.value}" to type: ${Y.type}`)}else if(ee.filter.type==="CallExpression"){const te=ee.filter;if(te.callee.type!=="Identifier")throw new Error(`Unknown filter: ${te.callee.type}`);const ne=te.callee.value;if(Y instanceof ArrayValue){switch(ne){case"selectattr":{if(Y.value.some(ot=>!(ot instanceof ObjectValue)))throw new Error("`selectattr` can only be applied to array of objects");if(te.args.some(ot=>ot.type!=="StringLiteral"))throw new Error("arguments of `selectattr` must be strings");const[xe,et,tt]=te.args.map(ot=>this.evaluate(ot,O));let it;if(et){const ot=O.tests.get(et.value);if(!ot)throw new Error(`Unknown test: ${et.value}`);it=ot}else it=(...ot)=>ot[0].__bool__().value;const st=Y.value.filter(ot=>{const rt=ot.value.get(xe.value);return rt?it(rt,tt):!1});return new ArrayValue(st)}}throw new Error(`Unknown ArrayValue filter: ${ne}`)}else throw new Error(`Cannot apply filter "${ne}" to type: ${Y.type}`)}throw new Error(`Unknown filter: ${ee.filter.type}`)}evaluateTestExpression(ee,O){const Y=this.evaluate(ee.operand,O),te=O.tests.get(ee.test.value);if(!te)throw new Error(`Unknown test: ${ee.test.value}`);const ne=te(Y);return new BooleanValue(ee.negate?!ne:ne)}evaluateUnaryExpression(ee,O){const Y=this.evaluate(ee.argument,O);switch(ee.operator.value){case"not":return new BooleanValue(!Y.value);default:throw new SyntaxError(`Unknown operator: ${ee.operator.value}`)}}evalProgram(ee,O){return this.evaluateBlock(ee.body,O)}evaluateBlock(ee,O){let Y="";for(const te of ee){const ne=this.evaluate(te,O);ne.type!=="NullValue"&&ne.type!=="UndefinedValue"&&(Y+=ne.value)}return new StringValue(Y)}evaluateIdentifier(ee,O){return O.lookupVariable(ee.value)}evaluateCallExpression(ee,O){const Y=[],te=new Map;for(const xe of ee.args)if(xe.type==="KeywordArgumentExpression"){const et=xe;te.set(et.key.value,this.evaluate(et.value,O))}else Y.push(this.evaluate(xe,O));te.size>0&&Y.push(new ObjectValue(te));const ne=this.evaluate(ee.callee,O);if(ne.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${ne.type}`);return ne.value(Y,O)}evaluateSliceExpression(ee,O,Y){if(!(ee instanceof ArrayValue||ee instanceof StringValue))throw new Error("Slice object must be an array or string");const te=this.evaluate(O.start,Y),ne=this.evaluate(O.stop,Y),xe=this.evaluate(O.step,Y);if(!(te instanceof NumericValue||te instanceof UndefinedValue))throw new Error("Slice start must be numeric or undefined");if(!(ne instanceof NumericValue||ne instanceof UndefinedValue))throw new Error("Slice stop must be numeric or undefined");if(!(xe instanceof NumericValue||xe instanceof UndefinedValue))throw new Error("Slice step must be numeric or undefined");return ee instanceof ArrayValue?new ArrayValue(slice(ee.value,te.value,ne.value,xe.value)):new StringValue(slice(Array.from(ee.value),te.value,ne.value,xe.value).join(""))}evaluateMemberExpression(ee,O){const Y=this.evaluate(ee.object,O);let te;if(ee.computed){if(ee.property.type==="SliceExpression")return this.evaluateSliceExpression(Y,ee.property,O);te=this.evaluate(ee.property,O)}else te=new StringValue(ee.property.value);let ne;if(Y instanceof ObjectValue){if(!(te instanceof StringValue))throw new Error(`Cannot access property with non-string: got ${te.type}`);ne=Y.value.get(te.value)??Y.builtins.get(te.value)}else if(Y instanceof ArrayValue||Y instanceof StringValue)if(te instanceof NumericValue)ne=Y.value.at(te.value),Y instanceof StringValue&&(ne=new StringValue(Y.value.at(te.value)));else if(te instanceof StringValue)ne=Y.builtins.get(te.value);else throw new Error(`Cannot access property with non-string/non-number: got ${te.type}`);else{if(!(te instanceof StringValue))throw new Error(`Cannot access property with non-string: got ${te.type}`);ne=Y.builtins.get(te.value)}return ne instanceof RuntimeValue?ne:new UndefinedValue}evaluateSet(ee,O){const Y=this.evaluate(ee.value,O);if(ee.assignee.type==="Identifier"){const te=ee.assignee.value;O.setVariable(te,Y)}else if(ee.assignee.type==="MemberExpression"){const te=ee.assignee,ne=this.evaluate(te.object,O);if(!(ne instanceof ObjectValue))throw new Error("Cannot assign to member of non-object");if(te.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");ne.value.set(te.property.value,Y)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(ee.assignee)}`);return new NullValue}evaluateIf(ee,O){const Y=this.evaluate(ee.test,O);return this.evaluateBlock(Y.__bool__().value?ee.body:ee.alternate,O)}evaluateFor(ee,O){const Y=new Environment(O),te=this.evaluate(ee.iterable,Y);if(!(te instanceof ArrayValue))throw new Error(`Expected iterable type in for loop: got ${te.type}`);let ne="";for(let xe=0;xe<te.value.length;++xe){const et=new Map([["index",new NumericValue(xe+1)],["index0",new NumericValue(xe)],["revindex",new NumericValue(te.value.length-xe)],["revindex0",new NumericValue(te.value.length-xe-1)],["first",new BooleanValue(xe===0)],["last",new BooleanValue(xe===te.value.length-1)],["length",new NumericValue(te.value.length)],["previtem",xe>0?te.value[xe-1]:new UndefinedValue],["nextitem",xe<te.value.length-1?te.value[xe+1]:new UndefinedValue]]);Y.setVariable("loop",new ObjectValue(et));const tt=te.value[xe];if(ee.loopvar.type==="Identifier")Y.setVariable(ee.loopvar.value,tt);else if(ee.loopvar.type==="TupleLiteral"){const st=ee.loopvar;if(tt.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${tt.type}`);const ot=tt;if(st.value.length!==ot.value.length)throw new Error(`Too ${st.value.length>ot.value.length?"few":"many"} items to unpack`);for(let rt=0;rt<st.value.length;++rt){if(st.value[rt].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${st.value[rt].type}`);Y.setVariable(st.value[rt].value,ot.value[rt])}}const it=this.evaluateBlock(ee.body,Y);ne+=it.value}return new StringValue(ne)}evaluate(ee,O){if(ee===void 0)return new UndefinedValue;switch(ee.type){case"Program":return this.evalProgram(ee,O);case"Set":return this.evaluateSet(ee,O);case"If":return this.evaluateIf(ee,O);case"For":return this.evaluateFor(ee,O);case"NumericLiteral":return new NumericValue(Number(ee.value));case"StringLiteral":return new StringValue(ee.value);case"BooleanLiteral":return new BooleanValue(ee.value);case"ArrayLiteral":return new ArrayValue(ee.value.map(Y=>this.evaluate(Y,O)));case"TupleLiteral":return new TupleValue(ee.value.map(Y=>this.evaluate(Y,O)));case"ObjectLiteral":{const Y=new Map;for(const[te,ne]of ee.value){const xe=this.evaluate(te,O);if(!(xe instanceof StringValue))throw new Error(`Object keys must be strings: got ${xe.type}`);Y.set(xe.value,this.evaluate(ne,O))}return new ObjectValue(Y)}case"Identifier":return this.evaluateIdentifier(ee,O);case"CallExpression":return this.evaluateCallExpression(ee,O);case"MemberExpression":return this.evaluateMemberExpression(ee,O);case"UnaryExpression":return this.evaluateUnaryExpression(ee,O);case"BinaryExpression":return this.evaluateBinaryExpression(ee,O);case"FilterExpression":return this.evaluateFilterExpression(ee,O);case"TestExpression":return this.evaluateTestExpression(ee,O);default:throw new SyntaxError(`Unknown node type: ${ee.type}`)}}};function convertToRuntimeValues(ee){switch(typeof ee){case"number":return new NumericValue(ee);case"string":return new StringValue(ee);case"boolean":return new BooleanValue(ee);case"object":return ee===null?new NullValue:Array.isArray(ee)?new ArrayValue(ee.map(convertToRuntimeValues)):new ObjectValue(new Map(Object.entries(ee).map(([O,Y])=>[O,convertToRuntimeValues(Y)])));case"function":return new FunctionValue((O,Y)=>{const te=ee(...O.map(ne=>ne.value))??null;return convertToRuntimeValues(te)});default:throw new Error(`Cannot convert to runtime value: ${ee}`)}}var Template=class{parsed;constructor(ee){const O=tokenize(ee,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=parse$2(O)}render(ee){const O=new Environment;O.set("false",!1),O.set("true",!0),O.set("raise_exception",ne=>{throw new Error(ne)}),O.set("range",range);for(const[ne,xe]of Object.entries(ee))O.set(ne,xe);return new Interpreter(O).run(this.parsed).value}};async function loadTokenizer(ee,O){const Y=await Promise.all([getModelJSON(ee,"tokenizer.json",!0,O),getModelJSON(ee,"tokenizer_config.json",!0,O)]);return O.legacy!==null&&(Y[1].legacy=O.legacy),Y}function regexSplit(ee,O){const Y=[];let te=0;for(const ne of ee.matchAll(O)){const xe=ne[0];te<ne.index&&Y.push(ee.slice(te,ne.index)),xe.length>0&&Y.push(xe),te=ne.index+xe.length}return te<ee.length&&Y.push(ee.slice(te)),Y}function createPattern(ee,O=!0){if(ee.Regex!==void 0){let Y=ee.Regex.replace(/\\([#&~])/g,"$1");for(const[te,ne]of PROBLEMATIC_REGEX_MAP)Y=Y.replaceAll(te,ne);return new RegExp(Y,"gu")}else if(ee.String!==void 0){const Y=escapeRegExp(ee.String);return new RegExp(O?Y:`(${Y})`,"gu")}else return console.warn("Unknown pattern type:",ee),null}function objectToMap(ee){return new Map(Object.entries(ee))}function prepareTensorForDecode(ee){const O=ee.dims;switch(O.length){case 1:return ee.tolist();case 2:if(O[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return ee.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${O.length}.`)}}function clean_up_tokenization(ee){return ee.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function remove_accents(ee){return ee.replace(/[\u0300-\u036f]/g,"")}function lowercase_and_remove_accent(ee){return remove_accents(ee.toLowerCase())}function fuse(ee,O,Y){const te=[];let ne=0;for(;ne<ee.length;){if(te.push(ee[ne]),(Y.get(ee[ne])??O)!==O){++ne;continue}for(;ne<ee.length&&(Y.get(ee[ne])??O)===O;)++ne}return te}function whitespace_split(ee){return ee.match(/\S+/g)||[]}const PUNCTUATION_REGEX="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",PROBLEMATIC_REGEX_MAP=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"]]);class AddedToken{constructor(O){this.content=O.content,this.id=O.id,this.single_word=O.single_word??!1,this.lstrip=O.lstrip??!1,this.rstrip=O.rstrip??!1,this.special=O.special??!1,this.normalized=O.normalized??null}}class TokenizerModel extends Callable{constructor(O){super(),this.config=O,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(O,...Y){switch(O.type){case"WordPiece":return new WordPieceTokenizer(O);case"Unigram":return new Unigram(O,...Y);case"BPE":return new BPE(O);default:if(O.vocab)return new LegacyTokenizerModel(O,...Y);throw new Error(`Unknown TokenizerModel type: ${O.type}`)}}_call(O){let Y=this.encode(O);return this.fuse_unk&&(Y=fuse(Y,this.unk_token_id,this.tokens_to_ids)),Y}encode(O){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(O){return O.map(Y=>this.tokens_to_ids.get(Y)??this.unk_token_id)}convert_ids_to_tokens(O){return O.map(Y=>this.vocab[Y]??this.unk_token)}}class WordPieceTokenizer extends TokenizerModel{constructor(O){super(O),this.tokens_to_ids=objectToMap(O.vocab),this.unk_token_id=this.tokens_to_ids.get(O.unk_token),this.unk_token=O.unk_token,this.max_input_chars_per_word=O.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[Y,te]of this.tokens_to_ids)this.vocab[te]=Y}encode(O){const Y=[];for(const te of O){const ne=[...te];if(ne.length>this.max_input_chars_per_word){Y.push(this.unk_token);continue}let xe=!1,et=0;const tt=[];for(;et<ne.length;){let it=ne.length,st=null;for(;et<it;){let ot=ne.slice(et,it).join("");if(et>0&&(ot=this.config.continuing_subword_prefix+ot),this.tokens_to_ids.has(ot)){st=ot;break}--it}if(st===null){xe=!0;break}tt.push(st),et=it}xe?Y.push(this.unk_token):Y.push(...tt)}return Y}}class Unigram extends TokenizerModel{constructor(O,Y){super(O);const te=O.vocab.length;this.vocab=new Array(te),this.scores=new Array(te);for(let ne=0;ne<te;++ne){const xe=O.vocab[ne];this.vocab[ne]=xe[0],this.scores[ne]=xe[1]}this.unk_token_id=O.unk_id,this.unk_token=this.vocab[O.unk_id],this.tokens_to_ids=new Map(this.vocab.map((ne,xe)=>[ne,xe])),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=Y.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=min(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(O){const Y=O.sentence,te=Y.length;let ne=0;for(;ne<te;){let et=!1;for(let tt of this.trie.commonPrefixSearch(Y.slice(ne))){const it=this.tokens_to_ids.get(tt),st=this.scores[it],ot=tt.length;O.insert(ne,ot,st,it),!et&&ot===1&&(et=!0)}et||O.insert(ne,1,this.unkScore,this.unk_token_id),ne+=1}}tokenize(O){const Y=new TokenLattice(O,this.bosTokenId,this.eosTokenId);return this.populateNodes(Y),Y.tokens()}encode(O){const Y=[];for(const te of O){const ne=this.tokenize(te);Y.push(...ne)}return Y}}const BYTES_TO_UNICODE=(()=>{const ee=[...Array.from({length:94},(ne,xe)=>xe+33),...Array.from({length:12},(ne,xe)=>xe+161),...Array.from({length:82},(ne,xe)=>xe+174)],O=ee.slice();let Y=0;for(let ne=0;ne<256;++ne)ee.includes(ne)||(ee.push(ne),O.push(256+Y),Y+=1);const te=O.map(ne=>String.fromCharCode(ne));return Object.fromEntries(ee.map((ne,xe)=>[ne,te[xe]]))})(),UNICODE_TO_BYTES=reverseDictionary(BYTES_TO_UNICODE);class BPE extends TokenizerModel{constructor(O){super(O),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=objectToMap(O.vocab),this.unk_token_id=this.tokens_to_ids.get(O.unk_token),this.unk_token=O.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[Y,te]of this.tokens_to_ids)this.vocab[te]=Y;this.bpe_ranks=new Map(O.merges.map((Y,te)=>[Y,te])),this.merges=O.merges.map(Y=>Y.split(this.BPE_SPLIT_TOKEN)),this.end_of_word_suffix=O.end_of_word_suffix,this.continuing_subword_suffix=O.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.cache=new Map}bpe(O){if(O.length===0)return[];const Y=this.cache.get(O);if(Y!==void 0)return Y;const te=Array.from(O);this.end_of_word_suffix&&(te[te.length-1]+=this.end_of_word_suffix);let ne=[];if(te.length>1){const xe=new PriorityQueue$1((it,st)=>it.score<st.score);let et={token:te[0],bias:0,prev:null,next:null},tt=et;for(let it=1;it<te.length;++it){const st={bias:it/te.length,token:te[it],prev:tt,next:null};tt.next=st,this._add_node(xe,tt),tt=st}for(;!xe.isEmpty();){const it=xe.pop();if(it.deleted||!it.next||it.next.deleted)continue;if(it.deleted=!0,it.next.deleted=!0,it.prev){const ot={...it.prev};it.prev.deleted=!0,it.prev=ot,ot.prev?ot.prev.next=ot:et=ot}const st={token:it.token+it.next.token,bias:it.bias,prev:it.prev,next:it.next.next};st.prev?(st.prev.next=st,this._add_node(xe,st.prev)):et=st,st.next&&(st.next.prev=st,this._add_node(xe,st))}for(let it=et;it!==null;it=it.next)ne.push(it.token)}else ne=te;if(this.continuing_subword_suffix)for(let xe=0;xe<ne.length-1;++xe)ne[xe]+=this.continuing_subword_suffix;return this.cache.set(O,ne),ne}_add_node(O,Y){const te=this.bpe_ranks.get(Y.token+this.BPE_SPLIT_TOKEN+Y.next.token);te!==void 0&&(Y.score=te+Y.bias,O.push(Y))}encode(O){const Y=[];for(const te of O){if(this.ignore_merges&&this.tokens_to_ids.has(te)){Y.push(te);continue}const ne=this.bpe(te);for(const xe of ne)this.tokens_to_ids.has(xe)?Y.push(xe):this.byte_fallback?Y.push(...Array.from(this.text_encoder.encode(xe)).map(et=>`<0x${et.toString(16).toUpperCase().padStart(2,"0")}>`)):Y.push(this.unk_token)}return Y}}class LegacyTokenizerModel extends TokenizerModel{constructor(O,Y){super(O),this.tokens_to_ids=objectToMap(Y.target_lang?O.vocab[Y.target_lang]:O.vocab),this.bos_token=Y.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=Y.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=Y.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=Y.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[te,ne]of this.tokens_to_ids)this.vocab[ne]=te}encode(O){return O}}class Normalizer extends Callable{constructor(O){super(),this.config=O}static fromConfig(O){if(O===null)return null;switch(O.type){case"BertNormalizer":return new BertNormalizer(O);case"Precompiled":return new Precompiled(O);case"Sequence":return new NormalizerSequence(O);case"Replace":return new Replace(O);case"NFC":return new NFC(O);case"NFKC":return new NFKC(O);case"NFKD":return new NFKD(O);case"Strip":return new StripNormalizer(O);case"StripAccents":return new StripAccents(O);case"Lowercase":return new Lowercase(O);case"Prepend":return new Prepend(O);default:throw new Error(`Unknown Normalizer type: ${O.type}`)}}normalize(O){throw Error("normalize should be implemented in subclass.")}_call(O){return this.normalize(O)}}class Replace extends Normalizer{normalize(O){const Y=createPattern(this.config.pattern);return Y===null?O:O.replaceAll(Y,this.config.content)}}class NFC extends Normalizer{normalize(O){return O=O.normalize("NFC"),O}}class NFKC extends Normalizer{normalize(O){return O=O.normalize("NFKC"),O}}class NFKD extends Normalizer{normalize(O){return O=O.normalize("NFKD"),O}}class StripNormalizer extends Normalizer{normalize(O){return this.config.strip_left&&this.config.strip_right?O=O.trim():(this.config.strip_left&&(O=O.trimStart()),this.config.strip_right&&(O=O.trimEnd())),O}}class StripAccents extends Normalizer{normalize(O){return O=remove_accents(O),O}}class Lowercase extends Normalizer{normalize(O){return O=O.toLowerCase(),O}}class Prepend extends Normalizer{normalize(O){return O=this.config.prepend+O,O}}class NormalizerSequence extends Normalizer{constructor(O){super(O),this.normalizers=O.normalizers.map(Y=>Normalizer.fromConfig(Y))}normalize(O){return this.normalizers.reduce((Y,te)=>te.normalize(Y),O)}}class BertNormalizer extends Normalizer{_tokenize_chinese_chars(O){const Y=[];for(let te=0;te<O.length;++te){const ne=O[te],xe=ne.charCodeAt(0);this._is_chinese_char(xe)?(Y.push(" "),Y.push(ne),Y.push(" ")):Y.push(ne)}return Y.join("")}_is_chinese_char(O){return O>=19968&&O<=40959||O>=13312&&O<=19903||O>=131072&&O<=173791||O>=173824&&O<=177983||O>=177984&&O<=178207||O>=178208&&O<=183983||O>=63744&&O<=64255||O>=194560&&O<=195103}stripAccents(O){return O.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}_is_control(O){switch(O){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(O)}}_clean_text(O){const Y=[];for(const te of O){const ne=te.charCodeAt(0);ne===0||ne===65533||this._is_control(te)||(/^\s$/.test(te)?Y.push(" "):Y.push(te))}return Y.join("")}normalize(O){return this.config.clean_text&&(O=this._clean_text(O)),this.config.handle_chinese_chars&&(O=this._tokenize_chinese_chars(O)),this.config.lowercase?(O=O.toLowerCase(),this.config.strip_accents!==!1&&(O=this.stripAccents(O))):this.config.strip_accents&&(O=this.stripAccents(O)),O}}class PreTokenizer extends Callable{static fromConfig(O){if(O===null)return null;switch(O.type){case"BertPreTokenizer":return new BertPreTokenizer(O);case"Sequence":return new PreTokenizerSequence(O);case"Whitespace":return new WhitespacePreTokenizer(O);case"WhitespaceSplit":return new WhitespaceSplit(O);case"Metaspace":return new MetaspacePreTokenizer(O);case"ByteLevel":return new ByteLevelPreTokenizer(O);case"Split":return new SplitPreTokenizer(O);case"Punctuation":return new PunctuationPreTokenizer(O);case"Digits":return new DigitsPreTokenizer(O);case"Replace":return new ReplacePreTokenizer(O);default:throw new Error(`Unknown PreTokenizer type: ${O.type}`)}}pre_tokenize_text(O,Y){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(O,Y){return(Array.isArray(O)?O.map(te=>this.pre_tokenize_text(te,Y)):this.pre_tokenize_text(O,Y)).flat()}_call(O,Y){return this.pre_tokenize(O,Y)}}class BertPreTokenizer extends PreTokenizer{constructor(O){super(),this.pattern=new RegExp(`[^\\s${PUNCTUATION_REGEX}]+|[${PUNCTUATION_REGEX}]`,"gu")}pre_tokenize_text(O,Y){return O.trim().match(this.pattern)||[]}}class ByteLevelPreTokenizer extends PreTokenizer{constructor(O){super(),this.config=O,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=BYTES_TO_UNICODE,this.text_encoder=new TextEncoder}pre_tokenize_text(O,Y){return this.add_prefix_space&&!O.startsWith(" ")&&(O=" "+O),(this.use_regex?O.match(this.pattern)||[]:[O]).map(ne=>Array.from(this.text_encoder.encode(ne),xe=>this.byte_encoder[xe]).join(""))}}class SplitPreTokenizer extends PreTokenizer{constructor(O){super(),this.config=O,this.pattern=createPattern(this.config.pattern,this.config.invert)}pre_tokenize_text(O,Y){return this.pattern===null?[]:this.config.invert?O.match(this.pattern)||[]:regexSplit(O,this.pattern)}}class PunctuationPreTokenizer extends PreTokenizer{constructor(O){super(),this.config=O,this.pattern=new RegExp(`[^${PUNCTUATION_REGEX}]+|[${PUNCTUATION_REGEX}]+`,"gu")}pre_tokenize_text(O,Y){return O.match(this.pattern)||[]}}class DigitsPreTokenizer extends PreTokenizer{constructor(O){super(),this.config=O;const Y=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(Y,"gu")}pre_tokenize_text(O,Y){return O.match(this.pattern)||[]}}class PostProcessor extends Callable{constructor(O){super(),this.config=O}static fromConfig(O){if(O===null)return null;switch(O.type){case"TemplateProcessing":return new TemplateProcessing(O);case"ByteLevel":return new ByteLevelPostProcessor(O);case"RobertaProcessing":return new RobertaProcessing(O);case"BertProcessing":return new BertProcessing(O);case"Sequence":return new PostProcessorSequence(O);default:throw new Error(`Unknown PostProcessor type: ${O.type}`)}}post_process(O,...Y){throw Error("post_process should be implemented in subclass.")}_call(O,...Y){return this.post_process(O,...Y)}}class BertProcessing extends PostProcessor{constructor(O){super(O),this.cls=O.cls[0],this.sep=O.sep[0]}post_process(O,Y=null,{add_special_tokens:te=!0}={}){te&&(O=mergeArrays([this.cls],O,[this.sep]));let ne=new Array(O.length).fill(0);if(Y!==null){const xe=te&&this instanceof RobertaProcessing?[this.sep]:[],et=te?[this.sep]:[];O=mergeArrays(O,xe,Y,et),ne=mergeArrays(ne,new Array(Y.length+xe.length+et.length).fill(1))}return{tokens:O,token_type_ids:ne}}}class RobertaProcessing extends BertProcessing{}class TemplateProcessing extends PostProcessor{constructor(O){super(O),this.single=O.single,this.pair=O.pair}post_process(O,Y=null,{add_special_tokens:te=!0}={}){const ne=Y===null?this.single:this.pair;let xe=[],et=[];for(const tt of ne)"SpecialToken"in tt?te&&(xe.push(tt.SpecialToken.id),et.push(tt.SpecialToken.type_id)):"Sequence"in tt&&(tt.Sequence.id==="A"?(xe=mergeArrays(xe,O),et=mergeArrays(et,new Array(O.length).fill(tt.Sequence.type_id))):tt.Sequence.id==="B"&&(xe=mergeArrays(xe,Y),et=mergeArrays(et,new Array(Y.length).fill(tt.Sequence.type_id))));return{tokens:xe,token_type_ids:et}}}class ByteLevelPostProcessor extends PostProcessor{post_process(O,Y=null){return Y&&(O=mergeArrays(O,Y)),{tokens:O}}}class PostProcessorSequence extends PostProcessor{constructor(O){super(O),this.processors=O.processors.map(Y=>PostProcessor.fromConfig(Y))}post_process(O,Y=null,te={}){let ne;for(const xe of this.processors)if(xe instanceof ByteLevelPostProcessor)O=xe.post_process(O).tokens,Y&&(Y=xe.post_process(Y).tokens);else{const et=xe.post_process(O,Y,te);O=et.tokens,ne=et.token_type_ids}return{tokens:O,token_type_ids:ne}}}class Decoder extends Callable{constructor(O){super(),this.config=O,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=O.trim_offsets}static fromConfig(O){if(O===null)return null;switch(O.type){case"WordPiece":return new WordPieceDecoder(O);case"Metaspace":return new MetaspaceDecoder(O);case"ByteLevel":return new ByteLevelDecoder(O);case"Replace":return new ReplaceDecoder(O);case"ByteFallback":return new ByteFallback(O);case"Fuse":return new FuseDecoder(O);case"Strip":return new StripDecoder(O);case"Sequence":return new DecoderSequence(O);case"CTC":return new CTCDecoder(O);case"BPEDecoder":return new BPEDecoder(O);default:throw new Error(`Unknown Decoder type: ${O.type}`)}}_call(O){return this.decode(O)}decode(O){return this.decode_chain(O).join("")}decode_chain(O){throw Error("`decode_chain` should be implemented in subclass.")}}class ReplaceDecoder extends Decoder{decode_chain(O){const Y=createPattern(this.config.pattern);return Y===null?O:O.map(te=>te.replaceAll(Y,this.config.content))}}class ByteFallback extends Decoder{constructor(O){super(O),this.text_decoder=new TextDecoder}decode_chain(O){const Y=[];let te=[];for(const ne of O){let xe=null;if(ne.length===6&&ne.startsWith("<0x")&&ne.endsWith(">")){const et=parseInt(ne.slice(3,5),16);isNaN(et)||(xe=et)}if(xe!==null)te.push(xe);else{if(te.length>0){const et=this.text_decoder.decode(Uint8Array.from(te));Y.push(et),te=[]}Y.push(ne)}}if(te.length>0){const ne=this.text_decoder.decode(Uint8Array.from(te));Y.push(ne),te=[]}return Y}}class FuseDecoder extends Decoder{decode_chain(O){return[O.join("")]}}class StripDecoder extends Decoder{constructor(O){super(O),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(O){return O.map(Y=>{let te=0;for(let xe=0;xe<this.start&&Y[xe]===this.content;++xe){te=xe+1;continue}let ne=Y.length;for(let xe=0;xe<this.stop;++xe){const et=Y.length-xe-1;if(Y[et]===this.content){ne=et;continue}else break}return Y.slice(te,ne)})}}class WordPieceDecoder extends Decoder{constructor(O){super(O),this.cleanup=O.cleanup}decode_chain(O){return O.map((Y,te)=>(te!==0&&(Y.startsWith(this.config.prefix)?Y=Y.replace(this.config.prefix,""):Y=" "+Y),this.cleanup&&(Y=clean_up_tokenization(Y)),Y))}}class ByteLevelDecoder extends Decoder{constructor(O){super(O),this.byte_decoder=UNICODE_TO_BYTES,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(O){const Y=O.join(""),te=new Uint8Array([...Y].map(xe=>this.byte_decoder[xe]));return this.text_decoder.decode(te)}decode_chain(O){const Y=[];let te=[];for(const ne of O)this.added_tokens.find(xe=>xe.content===ne)!==void 0?(te.length>0&&(Y.push(this.convert_tokens_to_string(te)),te=[]),Y.push(ne)):te.push(ne);return te.length>0&&Y.push(this.convert_tokens_to_string(te)),Y}}class CTCDecoder extends Decoder{constructor(O){super(O),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(O){if(O.length===0)return"";const Y=[O[0]];for(let xe=1;xe<O.length;++xe)O[xe]!==Y.at(-1)&&Y.push(O[xe]);let ne=Y.filter(xe=>xe!==this.pad_token).join("");return this.cleanup&&(ne=clean_up_tokenization(ne).replaceAll(this.word_delimiter_token," ").trim()),ne}decode_chain(O){return[this.convert_tokens_to_string(O)]}}class DecoderSequence extends Decoder{constructor(O){super(O),this.decoders=O.decoders.map(Y=>Decoder.fromConfig(Y))}decode_chain(O){return this.decoders.reduce((Y,te)=>te.decode_chain(Y),O)}}class BPEDecoder extends Decoder{constructor(O){super(O),this.suffix=this.config.suffix}decode_chain(O){return O.map((Y,te)=>Y.replaceAll(this.suffix,te===O.length-1?"":" "))}}class VitsDecoder extends Decoder{decode_chain(O){let Y="";for(let te=1;te<O.length;te+=2)Y+=O[te];return[Y]}}class MetaspacePreTokenizer extends PreTokenizer{constructor(O){super(),this.addPrefixSpace=O.add_prefix_space,this.replacement=O.replacement,this.strRep=O.str_rep||this.replacement,this.prepend_scheme=O.prepend_scheme??"always"}pre_tokenize_text(O,{section_index:Y=void 0}={}){let te=O.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!te.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&Y===0)&&(te=this.strRep+te),[te]}}class MetaspaceDecoder extends Decoder{constructor(O){super(O),this.addPrefixSpace=O.add_prefix_space,this.replacement=O.replacement}decode_chain(O){const Y=[];for(let te=0;te<O.length;++te){let ne=O[te].replaceAll(this.replacement," ");this.addPrefixSpace&&te==0&&ne.startsWith(" ")&&(ne=ne.substring(1)),Y.push(ne)}return Y}}class Precompiled extends Normalizer{constructor(O){super(O),this.charsmap=O.precompiled_charsmap}normalize(O){return O=O.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),O=O.replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," "),O.includes("")?O=O.split("").map(te=>te.normalize("NFKC")).join(""):O=O.normalize("NFKC"),O}}class PreTokenizerSequence extends PreTokenizer{constructor(O){super(),this.tokenizers=O.pretokenizers.map(Y=>PreTokenizer.fromConfig(Y))}pre_tokenize_text(O,Y){return this.tokenizers.reduce((te,ne)=>ne.pre_tokenize(te,Y),[O])}}class WhitespacePreTokenizer extends PreTokenizer{constructor(O){super()}pre_tokenize_text(O,Y){return O.match(/\w+|[^\w\s]+/g)||[]}}class WhitespaceSplit extends PreTokenizer{constructor(O){super()}pre_tokenize_text(O,Y){return whitespace_split(O)}}class ReplacePreTokenizer extends PreTokenizer{constructor(O){super(),this.config=O,this.pattern=createPattern(this.config.pattern),this.content=this.config.content}pre_tokenize_text(O,Y){return this.pattern===null?[O]:[O.replaceAll(this.pattern,this.config.content)]}}const SPECIAL_TOKEN_ATTRIBUTES=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function padHelper(ee,O,Y,te){for(const ne of Object.keys(ee)){const xe=O-ee[ne].length,et=Y(ne),tt=new Array(xe).fill(et);ee[ne]=te==="right"?mergeArrays(ee[ne],tt):mergeArrays(tt,ee[ne])}}function truncateHelper(ee,O){for(const Y of Object.keys(ee))ee[Y].length=O}class PreTrainedTokenizer extends Callable{return_token_type_ids=!1;_default_chat_template=`{% for message in messages %}{{'<|im_start|>' + message['role'] + '
' + message['content'] + '<|im_end|>' + '
'}}{% endfor %}{% if add_generation_prompt %}{{ '<|im_start|>assistant
' }}{% endif %}`;constructor(O,Y){super(),this._tokenizer_config=Y,this.normalizer=Normalizer.fromConfig(O.normalizer),this.pre_tokenizer=PreTokenizer.fromConfig(O.pre_tokenizer),this.model=TokenizerModel.fromConfig(O.model,Y),this.post_processor=PostProcessor.fromConfig(O.post_processor),this.decoder=Decoder.fromConfig(O.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const te of O.added_tokens){const ne=new AddedToken(te);this.added_tokens.push(ne),this.model.tokens_to_ids.set(ne.content,ne.id),this.model.vocab[ne.id]=ne.content,ne.special&&(this.special_tokens.push(ne.content),this.all_special_ids.push(ne.id))}if(this.additional_special_tokens=Y.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.map(te=>`${te.lstrip?"\\s*":""}(${escapeRegExp(te.content)})${te.rstrip?"\\s*":""}`).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.model_max_length=Y.model_max_length,this.remove_space=Y.remove_space,this.clean_up_tokenization_spaces=Y.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=Y.do_lowercase_and_remove_accent??!1,this.padding_side="right",this.legacy=!1,this.chat_template=Y.chat_template??null,Array.isArray(this.chat_template)){const te=Object.create(null);for(const{name:ne,template:xe}of this.chat_template){if(typeof ne!="string"||typeof xe!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');te[ne]=xe}this.chat_template=te}this._compiled_template_cache=new Map}getToken(...O){for(const Y of O){const te=this._tokenizer_config[Y];if(te)if(typeof te=="object"){if(te.__type==="AddedToken")return te.content;throw Error(`Unknown token: ${te}`)}else return te}return null}static async from_pretrained(O,{progress_callback:Y=null,config:te=null,cache_dir:ne=null,local_files_only:xe=!1,revision:et="main",legacy:tt=null}={}){const it=await loadTokenizer(O,{progress_callback:Y,cache_dir:ne,local_files_only:xe,revision:et,legacy:tt});return new this(...it)}_call(O,{text_pair:Y=null,add_special_tokens:te=!0,padding:ne=!1,truncation:xe=null,max_length:et=null,return_tensor:tt=!0,return_token_type_ids:it=null}={}){const st=Array.isArray(O);let ot;if(st){if(O.length===0)throw Error("text array must be non-empty");if(Y!==null){if(Array.isArray(Y)){if(O.length!==Y.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");ot=O.map((nt,at)=>this._encode_plus(nt,Y[at],{add_special_tokens:te,return_token_type_ids:it}))}else ot=O.map(nt=>this._encode_plus(nt,null,{add_special_tokens:te,return_token_type_ids:it}))}else{if(O==null)throw Error("text may not be null or undefined");if(Array.isArray(Y))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");ot=[this._encode_plus(O,Y,{add_special_tokens:te,return_token_type_ids:it})]}if(et===null?ne==="max_length"?et=this.model_max_length:et=max(ot.map(nt=>nt.input_ids.length))[0]:xe||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),et=Math.min(et,this.model_max_length),ne||xe)for(let nt=0;nt<ot.length;++nt)ot[nt].input_ids.length!==et&&(ot[nt].input_ids.length>et?xe&&truncateHelper(ot[nt],et):ne&&padHelper(ot[nt],et,at=>at==="input_ids"?this.pad_token_id:0,this.padding_side));const rt={};if(tt){if(!(ne&&xe)&&ot.some(at=>{for(const ct of Object.keys(at))if(at[ct].length!==ot[0][ct]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const nt=[ot.length,ot[0].input_ids.length];for(const at of Object.keys(ot[0]))rt[at]=new Tensor("int64",BigInt64Array.from(ot.flatMap(ct=>ct[at]).map(BigInt)),nt)}else{for(const nt of Object.keys(ot[0]))rt[nt]=ot.map(at=>at[nt]);if(!st)for(const nt of Object.keys(rt))rt[nt]=rt[nt][0]}return rt}_encode_text(O){return O===null?null:(this.added_tokens_regex?O.split(this.added_tokens_regex).filter(ne=>ne):[O]).map((ne,xe)=>{if(this.added_tokens.find(tt=>tt.content===ne)!==void 0)return ne;{if(this.remove_space===!0&&(ne=ne.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(ne=lowercase_and_remove_accent(ne)),this.normalizer!==null&&(ne=this.normalizer(ne)),ne.length===0)return[];const tt=this.pre_tokenizer!==null?this.pre_tokenizer(ne,{section_index:xe}):[ne];return this.model(tt)}}).flat()}_encode_plus(O,Y=null,{add_special_tokens:te=!0,return_token_type_ids:ne=null}={}){const xe=this._encode_text(O),et=this._encode_text(Y),tt=this.post_processor?this.post_processor(xe,et,{add_special_tokens:te}):{tokens:mergeArrays(xe??[],et??[])},it=this.model.convert_tokens_to_ids(tt.tokens),st={input_ids:it,attention_mask:new Array(it.length).fill(1)};return(ne??this.return_token_type_ids)&&tt.token_type_ids&&(st.token_type_ids=tt.token_type_ids),st}encode(O,Y=null,{add_special_tokens:te=!0,return_token_type_ids:ne=null}={}){const{input_ids:xe}=this._encode_plus(O,Y,{add_special_tokens:te,return_token_type_ids:ne});return xe}batch_decode(O,Y={}){return O instanceof Tensor&&(O=O.tolist()),O.map(te=>this.decode(te,Y))}decode(O,Y={}){if(O instanceof Tensor&&(O=prepareTensorForDecode(O)),!Array.isArray(O)||O.length===0||!isIntegralNumber(O[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(O,Y)}decode_single(O,{skip_special_tokens:Y=!1,clean_up_tokenization_spaces:te=null}){let ne=this.model.convert_ids_to_tokens(O);Y&&(ne=ne.filter(et=>!this.special_tokens.includes(et)));let xe=this.decoder?this.decoder(ne):ne.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(xe=xe.replaceAll(this.decoder.end_of_word_suffix," "),Y&&(xe=xe.trim())),(te??this.clean_up_tokenization_spaces)&&(xe=clean_up_tokenization(xe)),xe}get default_chat_template(){return this._warned_about_chat_template||(console.warn("No chat template is defined for this tokenizer - using a default chat template that implements the ChatML format. If the default is not appropriate for your model, please set `tokenizer.chat_template` to an appropriate template. See https://huggingface.co/docs/transformers/main/chat_templating for more information."),this._warned_about_chat_template=!0),this._default_chat_template}apply_chat_template(O,{chat_template:Y=null,add_generation_prompt:te=!1,tokenize:ne=!0,padding:xe=!1,truncation:et=!1,max_length:tt=null,return_tensor:it=!0,tokenizer_kwargs:st={},...ot}={}){if(this.chat_template&&typeof this.chat_template=="object"||this.chat_template===null&&this.default_chat_template&&typeof this.default_chat_template=="object"){const ct=this.chat_template??this.default_chat_template;if(Y!==null&&Object.hasOwn(ct,Y))Y=ct[Y];else if(Y===null&&"default"in ct)Y=ct.default;else if(Y===null)throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(ct).sort()}.`)}else Y??=this.chat_template??this.default_chat_template;if(typeof Y!="string")throw Error(`chat_template must be a string, but got ${typeof Y}`);let rt=this._compiled_template_cache.get(Y);rt===void 0&&(rt=new Template(Y),this._compiled_template_cache.set(Y,rt));const nt=Object.create(null);for(const ct of SPECIAL_TOKEN_ATTRIBUTES){const ut=this.getToken(ct);ut&&(nt[ct]=ut)}const at=rt.render({messages:O,add_generation_prompt:te,...nt,...ot});return ne?this._call(at,{add_special_tokens:!1,padding:xe,truncation:et,max_length:tt,return_tensor:it,...st}).input_ids:at}}class BertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class AlbertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class MobileBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class SqueezeBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DebertaTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DebertaV2Tokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class HerbertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class ConvBertTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class RoFormerTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class DistilBertTokenizer extends PreTrainedTokenizer{}class CamembertTokenizer extends PreTrainedTokenizer{}class XLMTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0;constructor(O,Y){super(O,Y),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class ElectraTokenizer extends PreTrainedTokenizer{return_token_type_ids=!0}class T5Tokenizer extends PreTrainedTokenizer{}class GPT2Tokenizer extends PreTrainedTokenizer{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}'}class BartTokenizer extends PreTrainedTokenizer{}class MBartTokenizer extends PreTrainedTokenizer{constructor(O,Y){super(O,Y),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(te=>this.languageRegex.test(te)),this.lang_to_token=te=>te}_build_translation_inputs(O,Y,te){return _build_translation_inputs(this,O,Y,te)}}class MBart50Tokenizer extends MBartTokenizer{}class RobertaTokenizer extends PreTrainedTokenizer{}class BloomTokenizer extends GPT2Tokenizer{constructor(O,Y){const te=".,!?",ne=O.pre_tokenizer?.pretokenizers[0]?.pattern;ne&&ne.Regex===` ?[^(\\s|[${te}])]+`&&(ne.Regex=` ?[^\\s${te}]+`),super(O,Y)}}const SPIECE_UNDERLINE="";class LlamaTokenizer extends PreTrainedTokenizer{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{% set loop_messages = messages[1:] %}{% set system_message = messages[0]['content'] %}{% elif USE_DEFAULT_PROMPT == true and not '<<SYS>>' in messages[0]['content'] %}{% set loop_messages = messages %}{% set system_message = 'DEFAULT_SYSTEM_MESSAGE' %}{% else %}{% set loop_messages = messages %}{% set system_message = false %}{% endif %}{% for message in loop_messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if loop.index0 == 0 and system_message != false %}{% set content = '<<SYS>>
' + system_message + '
<</SYS>>

' + message['content'] %}{% else %}{% set content = message['content'] %}{% endif %}{% if message['role'] == 'user' %}{{ bos_token + '[INST] ' + content.strip() + ' [/INST]' }}{% elif message['role'] == 'system' %}{{ '<<SYS>>
' + content.strip() + '
<</SYS>>

' }}{% elif message['role'] == 'assistant' %}{{ ' '  + content.strip() + ' ' + eos_token }}{% endif %}{% endfor %}`;DEFAULT_SYSTEM_PROMPT=`You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.

If a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information.`;constructor(O,Y){super(O,Y),this.use_default_system_prompt=Y.use_default_system_prompt??!1,this.legacy=Y.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new MetaspacePreTokenizer({replacement:SPIECE_UNDERLINE,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(O){if(O===null)return null;if(this.legacy||O.length===0)return super._encode_text(O);let Y=super._encode_text(SPIECE_UNDERLINE+O.replaceAll(SPIECE_UNDERLINE," "));return Y.length>1&&Y[0]===SPIECE_UNDERLINE&&this.special_tokens.includes(Y[1])&&(Y=Y.slice(1)),Y}get default_chat_template(){return super.default_chat_template.replaceAll("USE_DEFAULT_PROMPT",this.use_default_system_prompt?"true":"false").replaceAll("DEFAULT_SYSTEM_MESSAGE",this.DEFAULT_SYSTEM_PROMPT.replaceAll(`
`,"\\n").replaceAll("'","\\'"))}}class CodeLlamaTokenizer extends LlamaTokenizer{}class XLMRobertaTokenizer extends PreTrainedTokenizer{}class MPNetTokenizer extends PreTrainedTokenizer{}class FalconTokenizer extends PreTrainedTokenizer{}class GPTNeoXTokenizer extends PreTrainedTokenizer{}class EsmTokenizer extends PreTrainedTokenizer{}class Qwen2Tokenizer extends PreTrainedTokenizer{}class GemmaTokenizer extends PreTrainedTokenizer{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{{ raise_exception('System role not supported') }}{% endif %}{% for message in messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if (message['role'] == 'assistant') %}{% set role = 'model' %}{% else %}{% set role = message['role'] %}{% endif %}{{ '<start_of_turn>' + role + '
' + message['content'] | trim + '<end_of_turn>
' }}{% endfor %}{% if add_generation_prompt %}{{'<start_of_turn>model
'}}{% endif %}`}class Grok1Tokenizer extends PreTrainedTokenizer{}function _build_translation_inputs(ee,O,Y,te){if(!("language_codes"in ee)||!Array.isArray(ee.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in ee)||!(ee.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in ee)||typeof ee.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const ne=te.src_lang,xe=te.tgt_lang;if(!ee.language_codes.includes(xe))throw new Error(`Target language code "${xe}" is not valid. Must be one of: {${ee.language_codes.join(", ")}}`);if(ne!==void 0){if(!ee.language_codes.includes(ne))throw new Error(`Source language code "${ne}" is not valid. Must be one of: {${ee.language_codes.join(", ")}}`);for(const et of ee.post_processor.config.single)if("SpecialToken"in et&&ee.languageRegex.test(et.SpecialToken.id)){et.SpecialToken.id=ee.lang_to_token(ne);break}}return te.forced_bos_token_id=ee.model.convert_tokens_to_ids([ee.lang_to_token(xe)])[0],ee._call(O,Y)}class NllbTokenizer extends PreTrainedTokenizer{constructor(O,Y){super(O,Y),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(te=>this.languageRegex.test(te)),this.lang_to_token=te=>te}_build_translation_inputs(O,Y,te){return _build_translation_inputs(this,O,Y,te)}}class M2M100Tokenizer extends PreTrainedTokenizer{constructor(O,Y){super(O,Y),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(te=>this.languageRegex.test(te)).map(te=>te.slice(2,-2)),this.lang_to_token=te=>`__${te}__`}_build_translation_inputs(O,Y,te){return _build_translation_inputs(this,O,Y,te)}}const WHISPER_LANGUAGES=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],WHISPER_LANGUAGE_MAPPING=new Map(WHISPER_LANGUAGES),WHISPER_TO_LANGUAGE_CODE_MAPPING=new Map([...WHISPER_LANGUAGES.map(([ee,O])=>[O,ee]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);class WhisperTokenizer extends PreTrainedTokenizer{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}';_decode_asr(O,{return_timestamps:Y=!1,return_language:te=!1,time_precision:ne=null,force_full_sequences:xe=!0}={}){if(ne===null)throw Error("Must specify time_precision");let et=null;const tt=Y==="word";function it(){return{language:et,timestamp:[null,null],text:""}}const st=[];let ot=it(),rt=0;const nt=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1;let at=[],ct=[],ut=!1,dt=null;const ht=new Set(this.all_special_ids);for(const mt of O){const yt=mt.tokens,bt=tt?mt.token_timestamps:null;let vt=null,Et=nt;if("stride"in mt){const[Ot,$t,Mt]=mt.stride;if(rt-=$t,dt=Ot-Mt,$t&&(Et=$t/ne+nt),Mt)for(let Nt=yt.length-1;Nt>=0;--Nt){const Rt=yt[Nt];if(Rt>=nt){if(vt!==null&&(Rt-nt)*ne<dt)break;vt=Rt}}}let wt=[],St=[];for(let Ot=0;Ot<yt.length;++Ot){const $t=yt[Ot];if(ht.has($t)){const Mt=this.decode([$t]),Nt=WHISPER_LANGUAGE_MAPPING.get(Mt.slice(2,-2));if(Nt!==void 0){if(et!==null&&Nt!==et&&!Y){at.push(wt);const Rt=this.findLongestCommonSequence(at)[0],Pt=this.decode(Rt);ot.text=Pt,st.push(ot),at=[],wt=[],ot=it()}et=ot.language=Nt}}else if($t>=nt){const Mt=($t-nt)*ne+rt,Nt=round$1(Mt,2);if(vt!==null&&$t>=vt)ut=!0;else if(ut||at.length>0&&$t<Et)ut=!1;else if(ot.timestamp[0]===null)ot.timestamp[0]=Nt;else if(Nt!==ot.timestamp[0]){ot.timestamp[1]=Nt,at.push(wt),tt&&ct.push(St);const[Rt,Pt]=this.findLongestCommonSequence(at,ct),kt=this.decode(Rt);ot.text=kt,tt&&(ot.words=this.collateWordTimestamps(Rt,Pt,et)),st.push(ot),at=[],wt=[],ct=[],St=[],ot=it()}}else if(wt.push($t),tt){let Mt=round$1(bt[Ot]+rt,2),Nt;Ot+1<bt.length?Nt=round$1(bt[Ot+1]+rt,2):Nt=null,St.push([Mt,Nt])}}if("stride"in mt){const[Ot,$t,Mt]=mt.stride;rt+=Ot-Mt}wt.length>0?(at.push(wt),tt&&ct.push(St)):at.every(Ot=>Ot.length===0)&&(ot=it(),at=[],wt=[],ct=[],St=[])}if(at.length>0){if(xe&&Y)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[mt,yt]=this.findLongestCommonSequence(at,ct),bt=this.decode(mt);ot.text=bt,tt&&(ot.words=this.collateWordTimestamps(mt,yt,et)),st.push(ot)}let pt=Object.create(null);const ft=st.map(mt=>mt.text).join("");if(Y||te){for(let mt=0;mt<st.length;++mt){const yt=st[mt];Y||delete yt.timestamp,te||delete yt.language}if(tt){const mt=[];for(const yt of st)for(const bt of yt.words)mt.push(bt);pt={chunks:mt}}else pt={chunks:st}}return[ft,pt]}findLongestCommonSequence(O,Y=null){let te=O[0],ne=te.length,xe=[];const et=Array.isArray(Y)&&Y.length>0;let tt=et?[]:null,it=et?Y[0]:null;for(let st=1;st<O.length;++st){const ot=O[st];let rt=0,nt=[ne,ne,0,0];const at=ot.length;for(let mt=1;mt<ne+at;++mt){const yt=mt/1e4,bt=Math.max(0,ne-mt),vt=Math.min(ne,ne+at-mt),Et=te.slice(bt,vt),wt=Math.max(0,mt-ne),St=Math.min(at,mt),Ot=ot.slice(wt,St);if(Et.length!==Ot.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");const $t=Et.filter((Nt,Rt)=>Nt===Ot[Rt]).length,Mt=$t/mt+yt;$t>1&&Mt>rt&&(rt=Mt,nt=[bt,vt,wt,St])}const[ct,ut,dt,ht]=nt,pt=Math.floor((ut+ct)/2),ft=Math.floor((ht+dt)/2);xe.push(...te.slice(0,pt)),te=ot.slice(ft),ne=te.length,et&&(tt.push(...it.slice(0,pt)),it=Y[st].slice(ft))}return xe.push(...te),et?(tt.push(...it),[xe,tt]):[xe,[]]}collateWordTimestamps(O,Y,te){const[ne,xe,et]=this.combineTokensIntoWords(O,te),tt=[];for(let it=0;it<ne.length;++it){const st=et[it];tt.push({text:ne[it],timestamp:[Y[st.at(0)][0],Y[st.at(-1)][1]]})}return tt}combineTokensIntoWords(O,Y,te=`"'([{-`,ne=`"'.,!?:)]}`){Y=Y??"english";let xe,et,tt;return["chinese","japanese","thai","lao","myanmar"].includes(Y)?[xe,et,tt]=this.splitTokensOnUnicode(O):[xe,et,tt]=this.splitTokensOnSpaces(O),this.mergePunctuations(xe,et,tt,te,ne)}decode(O,Y){let te;return Y&&Y.decode_with_timestamps?(O instanceof Tensor&&(O=prepareTensorForDecode(O)),te=this.decodeWithTimestamps(O,Y)):te=super.decode(O,Y),te}decodeWithTimestamps(O,Y){const te=Y?.time_precision??.02,ne=Array.from(this.all_special_ids).at(-1)+1;let xe=[[]];for(const et of O)if(et>=ne){const tt=round$1((et-ne)*te,2);xe.push(`<|${tt}|>`),xe.push([])}else xe[xe.length-1].push(et);return xe=xe.map(et=>typeof et=="string"?et:super.decode(et,Y)),xe.join("")}splitTokensOnUnicode(O){const Y=this.decode(O,{decode_with_timestamps:!0}),te="",ne=[],xe=[],et=[];let tt=[],it=[],st=0;for(let ot=0;ot<O.length;++ot){const rt=O[ot];tt.push(rt),it.push(ot);const nt=this.decode(tt,{decode_with_timestamps:!0});(!nt.includes(te)||Y[st+nt.indexOf(te)]===te)&&(ne.push(nt),xe.push(tt),et.push(it),tt=[],it=[],st+=nt.length)}return[ne,xe,et]}splitTokensOnSpaces(O){const[Y,te,ne]=this.splitTokensOnUnicode(O),xe=[],et=[],tt=[],it=new RegExp(`^[${PUNCTUATION_REGEX}]$`,"gu");for(let st=0;st<Y.length;++st){const ot=Y[st],rt=te[st],nt=ne[st],at=rt[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),ct=ot.startsWith(" "),ut=ot.trim(),dt=it.test(ut);if(at||ct||dt||xe.length===0)xe.push(ot),et.push(rt),tt.push(nt);else{const ht=xe.length-1;xe[ht]+=ot,et[ht].push(...rt),tt[ht].push(...nt)}}return[xe,et,tt]}mergePunctuations(O,Y,te,ne,xe){const et=structuredClone(O),tt=structuredClone(Y),it=structuredClone(te);let st=et.length-2,ot=et.length-1;for(;st>=0;)et[st].startsWith(" ")&&ne.includes(et[st].trim())?(et[ot]=et[st]+et[ot],tt[ot]=mergeArrays(tt[st],tt[ot]),it[ot]=mergeArrays(it[st],it[ot]),et[st]="",tt[st]=[],it[st]=[]):ot=st,--st;for(st=0,ot=1;ot<et.length;)!et[st].endsWith(" ")&&xe.includes(et[ot])?(et[st]+=et[ot],tt[st]=mergeArrays(tt[st],tt[ot]),it[st]=mergeArrays(it[st],it[ot]),et[ot]="",tt[ot]=[],it[ot]=[]):st=ot,++ot;return[et.filter(rt=>rt),tt.filter(rt=>rt.length>0),it.filter(rt=>rt.length>0)]}get_decoder_prompt_ids({language:O=null,task:Y=null,no_timestamps:te=!0}={}){const ne=[];if(O){O=O.toLowerCase();let xe=WHISPER_TO_LANGUAGE_CODE_MAPPING.get(O);if(xe===void 0)if(WHISPER_LANGUAGE_MAPPING.has(O))xe=O;else{const it=O.length===2?WHISPER_LANGUAGE_MAPPING.keys():WHISPER_LANGUAGE_MAPPING.values();throw new Error(`Language "${O}" is not supported. Must be one of: ${JSON.stringify(it)}`)}const et=this.model.tokens_to_ids.get(`<|${xe}|>`);if(et===void 0)throw new Error(`Unable to find language "${xe}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);ne.push(et)}else ne.push(null);if(Y){if(Y=Y.toLowerCase(),Y!=="transcribe"&&Y!=="translate")throw new Error(`Task "${Y}" is not supported. Must be one of: ["transcribe", "translate"]`);const xe=this.model.tokens_to_ids.get(`<|${Y}|>`);if(xe===void 0)throw new Error(`Unable to find task "${Y}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);ne.push(xe)}else ne.push(null);if(te){const xe=this.model.tokens_to_ids.get("<|notimestamps|>");if(xe===void 0)throw new Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');ne.push(xe)}return ne.map((xe,et)=>[et+1,xe]).filter(xe=>xe[1]!==null)}}class CodeGenTokenizer extends PreTrainedTokenizer{}class CLIPTokenizer extends PreTrainedTokenizer{}class SiglipTokenizer extends PreTrainedTokenizer{}class MarianTokenizer extends PreTrainedTokenizer{constructor(O,Y){super(O,Y),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(te=>this.languageRegex.test(te)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(O){if(O===null)return null;const[Y,...te]=O.trim().split(this.languageRegex);if(te.length===0)return super._encode_text(Y);if(te.length===2){const[ne,xe]=te;return this.supported_language_codes.includes(ne)||console.warn(`Unsupported language code "${ne}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),mergeArrays([ne],super._encode_text(xe))}}}class Wav2Vec2CTCTokenizer extends PreTrainedTokenizer{}class BlenderbotTokenizer extends PreTrainedTokenizer{_default_chat_template="{% for message in messages %}{% if message['role'] == 'user' %}{{ ' ' }}{% endif %}{{ message['content'] }}{% if not loop.last %}{{ '  ' }}{% endif %}{% endfor %}{{ eos_token }}"}class BlenderbotSmallTokenizer extends BlenderbotTokenizer{}class SpeechT5Tokenizer extends PreTrainedTokenizer{}class NougatTokenizer extends PreTrainedTokenizer{}class VitsTokenizer extends PreTrainedTokenizer{constructor(O,Y){super(O,Y),this.decoder=new VitsDecoder({})}}class CohereTokenizer extends PreTrainedTokenizer{}class AutoTokenizer{static TOKENIZER_CLASS_MAPPING={T5Tokenizer,DistilBertTokenizer,CamembertTokenizer,DebertaTokenizer,DebertaV2Tokenizer,BertTokenizer,HerbertTokenizer,ConvBertTokenizer,RoFormerTokenizer,XLMTokenizer,ElectraTokenizer,MobileBertTokenizer,SqueezeBertTokenizer,AlbertTokenizer,GPT2Tokenizer,BartTokenizer,MBartTokenizer,MBart50Tokenizer,RobertaTokenizer,WhisperTokenizer,CodeGenTokenizer,CLIPTokenizer,SiglipTokenizer,MarianTokenizer,BloomTokenizer,NllbTokenizer,M2M100Tokenizer,LlamaTokenizer,CodeLlamaTokenizer,XLMRobertaTokenizer,MPNetTokenizer,FalconTokenizer,GPTNeoXTokenizer,EsmTokenizer,Wav2Vec2CTCTokenizer,BlenderbotTokenizer,BlenderbotSmallTokenizer,SpeechT5Tokenizer,NougatTokenizer,VitsTokenizer,Qwen2Tokenizer,GemmaTokenizer,Grok1Tokenizer,CohereTokenizer,PreTrainedTokenizer};static async from_pretrained(O,{quantized:Y=!0,progress_callback:te=null,config:ne=null,cache_dir:xe=null,local_files_only:et=!1,revision:tt="main",legacy:it=null}={}){const[st,ot]=await loadTokenizer(O,{progress_callback:te,cache_dir:xe,local_files_only:et,revision:tt,legacy:it}),rt=ot.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer";let nt=this.TOKENIZER_CLASS_MAPPING[rt];return nt||(console.warn(`Unknown tokenizer class "${rt}", attempting to construct from base class.`),nt=PreTrainedTokenizer),new nt(st,ot)}}async function loadConfig(ee,O){return await getModelJSON(ee,"config.json",!0,O)}class PretrainedConfig{constructor(O){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,O)}static async from_pretrained(O,{progress_callback:Y=null,config:te=null,cache_dir:ne=null,local_files_only:xe=!1,revision:et="main"}={}){let tt=te??await loadConfig(O,{progress_callback:Y,cache_dir:ne,local_files_only:xe,revision:et});return new this(tt)}}class AutoConfig{static async from_pretrained(...O){return PretrainedConfig.from_pretrained(...O)}}class LogitsProcessorList extends Callable{constructor(){super(),this.processors=[]}push(O){this.processors.push(O)}extend(O){this.processors.push(...O)}_call(O,Y){for(let te of Y)this.processors.forEach(ne=>ne(O,te))}[Symbol.iterator](){return this.processors.values()}}class LogitsProcessor extends Callable{_call(O,Y){throw Error("`_call` should be implemented in a subclass")}}class ForceTokensLogitsProcessor extends LogitsProcessor{constructor(O){super(),this.force_token_map=Object.fromEntries(O??[])}_call(O,Y){let te=this.force_token_map[O.length];return exists(te)&&(Y.data.fill(-1/0),Y.data[te]=0),Y}}class ForcedBOSTokenLogitsProcessor extends LogitsProcessor{constructor(O){super(),this.bos_token_id=O}_call(O,Y){return O.length===1&&(Y.data.fill(-1/0),Y.data[this.bos_token_id]=0),Y}}class ForcedEOSTokenLogitsProcessor extends LogitsProcessor{constructor(O,Y){super(),this.max_length=O,this.forced_eos_token_id=Y}_call(O,Y){}}class SuppressTokensAtBeginLogitsProcessor extends LogitsProcessor{constructor(O,Y){super(),this.begin_suppress_tokens=O,this.begin_index=Y}_call(O,Y){if(O.length===this.begin_index)for(let te of this.begin_suppress_tokens)Y.data[te]=-1/0;return Y}}class WhisperTimeStampLogitsProcessor extends LogitsProcessor{constructor(O){super(),this.eos_token_id=O.eos_token_id,this.no_timestamps_token_id=O.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(O.forced_decoder_ids||[]).length+2,O.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=O.max_initial_timestamp_index}_call(O,Y){const te=Y.data;if(te[this.no_timestamps_token_id]=-1/0,O.length===this.begin_index-1)return te.fill(-1/0),te[this.timestamp_begin]=0,Y;const ne=O.slice(this.begin_index),xe=ne.length>=1&&ne[ne.length-1]>=this.timestamp_begin,et=ne.length<2||ne[ne.length-2]>=this.timestamp_begin;if(xe&&(et?te.subarray(this.timestamp_begin).fill(-1/0):te.subarray(0,this.eos_token_id).fill(-1/0)),O.length===this.begin_index&&this.max_initial_timestamp_index!==null){const ot=this.timestamp_begin+this.max_initial_timestamp_index;te.subarray(ot+1).fill(-1/0)}const tt=log_softmax(te),it=Math.log(tt.subarray(this.timestamp_begin).map(Math.exp).reduce((ot,rt)=>ot+rt)),st=max(tt.subarray(0,this.timestamp_begin))[0];return it>st&&te.subarray(0,this.timestamp_begin).fill(-1/0),Y}}class NoRepeatNGramLogitsProcessor extends LogitsProcessor{constructor(O){super(),this.no_repeat_ngram_size=O}getNgrams(O){const Y=O.length,te=[];for(let xe=0;xe<Y+1-this.no_repeat_ngram_size;++xe){const et=[];for(let tt=0;tt<this.no_repeat_ngram_size;++tt)et.push(O[xe+tt]);te.push(et)}const ne=new Map;for(const xe of te){const et=xe.slice(0,xe.length-1),tt=JSON.stringify(et),it=ne.get(tt)??[];it.push(xe[xe.length-1]),ne.set(tt,it)}return ne}getGeneratedNgrams(O,Y){const te=Y.slice(Y.length+1-this.no_repeat_ngram_size,Y.length);return O.get(JSON.stringify(te))??[]}calcBannedNgramTokens(O){const Y=[];if(O.length+1<this.no_repeat_ngram_size)return Y;{const te=this.getNgrams(O);return this.getGeneratedNgrams(te,O)}}_call(O,Y){const te=this.calcBannedNgramTokens(O);for(const ne of te)Y.data[ne]=-1/0;return Y}}class RepetitionPenaltyLogitsProcessor extends LogitsProcessor{constructor(O){super(),this.penalty=O}_call(O,Y){for(const te of O)Y.data[te]<0?Y.data[te]*=this.penalty:Y.data[te]/=this.penalty;return Y}}class MinLengthLogitsProcessor extends LogitsProcessor{constructor(O,Y){super(),this.min_length=O,this.eos_token_id=Array.isArray(Y)?Y:[Y]}_call(O,Y){if(O.length<this.min_length)for(const te of this.eos_token_id)Y.data[te]=-1/0;return Y}}class MinNewTokensLengthLogitsProcessor extends LogitsProcessor{constructor(O,Y,te){super(),this.prompt_length_to_skip=O,this.min_new_tokens=Y,this.eos_token_id=Array.isArray(te)?te:[te]}_call(O,Y){if(O.length-this.prompt_length_to_skip<this.min_new_tokens)for(const ne of this.eos_token_id)Y.data[ne]=-1/0;return Y}}class NoBadWordsLogitsProcessor extends LogitsProcessor{constructor(O,Y){super(),this.bad_words_ids=O,this.eos_token_id=Array.isArray(Y)?Y:[Y]}_call(O,Y){for(const te of this.bad_words_ids){let ne=!0;for(let xe=1;xe<=te.length-1&&te.length<O.length;++xe)if(te.at(-xe-1)!==O.at(-xe)){ne=!1;break}ne&&(Y.data[te.at(-1)]=-1/0)}return Y}}const GenerationConfig=class{constructor(ee={}){this.max_length=ee.max_length??20,this.max_new_tokens=ee.max_new_tokens??null,this.min_length=ee.min_length??0,this.min_new_tokens=ee.min_new_tokens??null,this.early_stopping=ee.early_stopping??!1,this.max_time=ee.max_time??null,this.do_sample=ee.do_sample??!1,this.num_beams=ee.num_beams??1,this.num_beam_groups=ee.num_beam_groups??1,this.penalty_alpha=ee.penalty_alpha??null,this.use_cache=ee.use_cache??!0,this.temperature=ee.temperature??1,this.top_k=ee.top_k??50,this.top_p=ee.top_p??1,this.typical_p=ee.typical_p??1,this.epsilon_cutoff=ee.epsilon_cutoff??0,this.eta_cutoff=ee.eta_cutoff??0,this.diversity_penalty=ee.diversity_penalty??0,this.repetition_penalty=ee.repetition_penalty??1,this.encoder_repetition_penalty=ee.encoder_repetition_penalty??1,this.length_penalty=ee.length_penalty??1,this.no_repeat_ngram_size=ee.no_repeat_ngram_size??0,this.bad_words_ids=ee.bad_words_ids??null,this.force_words_ids=ee.force_words_ids??null,this.renormalize_logits=ee.renormalize_logits??!1,this.constraints=ee.constraints??null,this.forced_bos_token_id=ee.forced_bos_token_id??null,this.forced_eos_token_id=ee.forced_eos_token_id??null,this.remove_invalid_values=ee.remove_invalid_values??!1,this.exponential_decay_length_penalty=ee.exponential_decay_length_penalty??null,this.suppress_tokens=ee.suppress_tokens??null,this.begin_suppress_tokens=ee.begin_suppress_tokens??null,this.forced_decoder_ids=ee.forced_decoder_ids??null,this.num_return_sequences=ee.num_return_sequences??1,this.output_attentions=ee.output_attentions??!1,this.output_hidden_states=ee.output_hidden_states??!1,this.output_scores=ee.output_scores??!1,this.return_dict_in_generate=ee.return_dict_in_generate??!1,this.pad_token_id=ee.pad_token_id??null,this.bos_token_id=ee.bos_token_id??null,this.eos_token_id=ee.eos_token_id??null,this.encoder_no_repeat_ngram_size=ee.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=ee.decoder_start_token_id??null,this.generation_kwargs=ee.generation_kwargs??{}}};class Sampler extends Callable{constructor(O){super(),this.generation_config=O}_call(O,Y=-1){return this.sample(O,Y)}sample(O,Y){throw Error("sample should be implemented in subclasses.")}getLogits(O,Y){let te=O.dims.at(-1),ne=O.data;if(Y===-1)ne=ne.slice(-te);else{let xe=Y*te;ne=ne.slice(xe,xe+te)}return this.generation_config.temperature>0&&(ne=ne.map(xe=>xe/this.generation_config.temperature)),ne}randomSelect(O){let Y=O.reduce((ne,xe)=>ne+xe,0),te=Math.random()*Y;for(let ne=0;ne<O.length;++ne)if(te-=O[ne],te<=0)return ne;return 0}static getSampler(O){if(O.do_sample)return new MultinomialSampler(O);if(O.num_beams>1)return new BeamSearchSampler(O);if(O.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${O.num_return_sequences}.`);return new GreedySampler(O)}}class GreedySampler extends Sampler{sample(O,Y=-1){let te=this.getLogits(O,Y);return[[max(te)[1],0]]}}class MultinomialSampler extends Sampler{sample(O,Y=-1){let te=O.dims.at(-1);this.generation_config.top_k>0&&(te=Math.min(this.generation_config.top_k,te));const ne=this.getLogits(O,Y),xe=getTopItems(ne,te),et=softmax(xe.map(tt=>tt[1]));return Array.from({length:this.generation_config.num_beams},()=>{const tt=this.randomSelect(et);return[xe[tt][0],Math.log(et[tt])]})}}class BeamSearchSampler extends Sampler{sample(O,Y=-1){let te=O.dims.at(-1);this.generation_config.top_k>0&&(te=Math.min(this.generation_config.top_k,te));const ne=this.getLogits(O,Y),xe=getTopItems(ne,te),et=softmax(xe.map(tt=>tt[1]));return Array.from({length:this.generation_config.num_beams},(tt,it)=>[xe[it][0],Math.log(et[it])])}}const{InferenceSession,Tensor:ONNXTensor,env}=ONNX,MODEL_TYPES={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5},MODEL_TYPE_MAPPING=new Map,MODEL_NAME_TO_CLASS_MAPPING=new Map,MODEL_CLASS_TO_NAME_MAPPING=new Map;async function constructSession(ee,O,Y){let te=`onnx/${O}${Y.quantized?"_quantized":""}.onnx`,ne=await getModelFile(ee,te,!0,Y);try{return await InferenceSession.create(ne,{executionProviders})}catch(xe){if(executionProviders.length===1&&executionProviders[0]==="wasm")throw xe;return console.warn(xe),console.warn("Something went wrong during model construction (most likely a missing operation). Using `wasm` as a fallback. "),await InferenceSession.create(ne,{executionProviders:["wasm"]})}}function validateInputs(ee,O){const Y=Object.create(null),te=[];for(const et of ee.inputNames){const tt=O[et];if(!(tt instanceof Tensor)){te.push(et);continue}Y[et]=env.wasm.proxy?tt.clone():tt}if(te.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${te.join(", ")}.`);const ne=Object.keys(O).length,xe=ee.inputNames.length;if(ne>xe){let et=Object.keys(O).filter(tt=>!ee.inputNames.includes(tt));console.warn(`WARNING: Too many inputs were provided (${ne} > ${xe}). The following inputs will be ignored: "${et.join(", ")}".`)}return Y}async function sessionRun(ee,O){const Y=validateInputs(ee,O);try{let te=await ee.run(Y);return te=replaceTensors(te),te}catch(te){throw console.error(`An error occurred during model execution: "${te}".`),console.error("Inputs given to model:",Y),te}}function replaceTensors(ee){for(let O in ee)ee[O]instanceof ONNXTensor?ee[O]=new Tensor(ee[O]):typeof ee[O]=="object"&&replaceTensors(ee[O]);return ee}function toI64Tensor(ee){if(ee instanceof Tensor)return ee;if(ee.length===0)throw Error("items must be non-empty");if(Array.isArray(ee[0])){if(ee.some(O=>O.length!==ee[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new Tensor("int64",BigInt64Array.from(ee.flat().map(O=>BigInt(O))),[ee.length,ee[0].length])}else return new Tensor("int64",BigInt64Array.from(ee.map(O=>BigInt(O))),[1,ee.length])}function prepareAttentionMask(ee,O){let Y=ee.config.pad_token_id??null,te=ee.config.eos_token_id??null;isIntegralNumber(te)&&(te=[te]);let ne=O.indexOf(Y)!==-1,xe=te===null||!te.includes(Y);if(ne&&xe){let et=BigInt64Array.from(O.data.map(tt=>tt!=Y));return new Tensor("int64",et,O.dims)}else return ones_like(O)}function preparePositionIds(ee,O,Y){if(!ee.inputNames.includes("position_ids"))return;const te=new BigInt64Array(O.attention_mask.data.length);for(let ne=0;ne<O.attention_mask.dims[0];++ne){let xe=ne*O.attention_mask.dims[1],et=BigInt(0);for(let tt=0;tt<O.attention_mask.dims[1];++tt){const it=xe+tt;O.attention_mask.data[it]===0n?te[it]=BigInt(1):(te[it]=et,et+=O.attention_mask.data[it])}}O.position_ids=new Tensor("int64",te,O.attention_mask.dims),Y&&(O.position_ids=O.position_ids.slice(null,-1).unsqueeze_(-1))}function boolTensor(ee){return new Tensor("bool",[ee],[1])}async function seq2seqForward(ee,O){let{encoder_outputs:Y,past_key_values:te}=O;Y||(Y=(await encoderForward(ee,O)).last_hidden_state);let ne={input_ids:O.decoder_input_ids,encoder_hidden_states:Y};const xe=!!te;ee.decoder_merged_session.inputNames.includes("use_cache_branch")&&(ne.use_cache_branch=boolTensor(xe)),ee.decoder_merged_session.inputNames.includes("encoder_attention_mask")&&(ne.encoder_attention_mask=O.attention_mask),preparePositionIds(ee.decoder_merged_session,ne,xe),ee.addPastKeyValues(ne,te);const et=await sessionRun(ee.decoder_merged_session,ne);let tt=et.logits;te=ee.getPastKeyValues(et,te);const it=ee.getAttentions(et);return new Seq2SeqLMOutput({logits:tt,past_key_values:te,encoder_outputs:Y,...it})}function seq2seqStartBeams(ee,O,Y,te){let ne=[],xe=0;const et=ee.requires_attention_mask??!0;let tt=Y.decoder_input_ids??Y.decoder_start_token_id??Y.bos_token_id??Y.eos_token_id;tt instanceof Tensor?tt=tt.tolist().flat():Array.isArray(tt)||(tt=[tt]);for(let it of O){it.dims=[1,...it.dims];let st={inputs:it,encoder_outputs:null,prev_model_outputs:null,output_token_ids:tt,done:!1,score:0,id:xe++};et&&(st.attention_mask=prepareAttentionMask(ee,it)),ne.push(st)}return ne}async function seq2seqRunBeam(ee,O){const Y=ee.main_input_name;let te=O.output_token_ids;O.prev_model_outputs&&(te=te.slice(-1));let ne={[Y]:O.inputs,decoder_input_ids:toI64Tensor(te),encoder_outputs:O.encoder_outputs,past_key_values:O.prev_model_outputs?.past_key_values};O.attention_mask&&(ne.attention_mask=O.attention_mask);let xe=await ee.forward(ne);return O.prev_model_outputs=xe,O.encoder_outputs=xe.encoder_outputs,xe}function seq2seqUpdatebeam(ee,O){ee.output_token_ids=[...ee.output_token_ids,O]}async function encoderForward(ee,O){const Y=Object.create(null);for(const te of ee.session.inputNames)Y[te]=O[te];return ee.session.inputNames.includes("token_type_ids")&&!Y.token_type_ids&&(Y.token_type_ids=new Tensor("int64",new BigInt64Array(Y.input_ids.data.length),Y.input_ids.dims)),await sessionRun(ee.session,Y)}async function decoderForward(ee,O){let{input_ids:Y,past_key_values:te,attention_mask:ne}=O,xe={input_ids:Y,attention_mask:ne??prepareAttentionMask(ee,Y)};const et=!!te;ee.session.inputNames.includes("use_cache_branch")&&(xe.use_cache_branch=boolTensor(et)),preparePositionIds(ee.session,xe,et),ee.addPastKeyValues(xe,te);let tt=await sessionRun(ee.session,xe),it=tt.logits;return te=ee.getPastKeyValues(tt,te),{logits:it,past_key_values:te}}function decoderStartBeams(ee,O,Y,te,ne){let xe=[],et=0;for(let tt of O){let it=tt.tolist().map(Number);tt.dims=[1,...tt.dims];let st;ne?(st=ne[et],st.dims=[1,...st.dims]):st=prepareAttentionMask(ee,tt);let ot={input:tt,model_input_ids:tt,attention_mask:st,prev_model_outputs:null,output_token_ids:it,num_output_tokens:te,done:!1,score:0,id:et++};xe.push(ot)}return xe}async function decoderRunBeam(ee,O){let Y=new BigInt64Array(O.output_token_ids.length).fill(1n),te={input_ids:O.model_input_ids,attention_mask:new Tensor("int64",Y,[1,Y.length]),past_key_values:O.prev_model_outputs?.past_key_values},ne=await ee.forward(te);return O.prev_model_outputs=ne,ne}function decoderUpdatebeam(ee,O){ee.output_token_ids=[...ee.output_token_ids,O],ee.model_input_ids=new Tensor("int64",[BigInt(O)],[1,1])}class PreTrainedModel extends Callable{main_input_name="input_ids";constructor(O,Y){super(),this.config=O,this.session=Y;const te=MODEL_CLASS_TO_NAME_MAPPING.get(this.constructor),ne=MODEL_TYPE_MAPPING.get(te);this.can_generate=!1,this._runBeam=null,this._getStartBeams=null,this._updateBeam=null,this._forward=null,ne===MODEL_TYPES.DecoderOnly?(this.can_generate=!0,this._runBeam=decoderRunBeam,this._getStartBeams=decoderStartBeams,this._updateBeam=decoderUpdatebeam,this._forward=decoderForward):ne===MODEL_TYPES.Seq2Seq||ne===MODEL_TYPES.Vision2Seq?(this.can_generate=!0,this._runBeam=seq2seqRunBeam,this._getStartBeams=seq2seqStartBeams,this._updateBeam=seq2seqUpdatebeam,this._forward=seq2seqForward):ne===MODEL_TYPES.EncoderDecoder?this._forward=encoderForward:this._forward=encoderForward}async dispose(){const O=[];for(let Y of Object.keys(this)){const te=this[Y];te instanceof InferenceSession&&O.push(te.handler.dispose())}return await Promise.all(O)}static async from_pretrained(O,{quantized:Y=!0,progress_callback:te=null,config:ne=null,cache_dir:xe=null,local_files_only:et=!1,revision:tt="main",model_file_name:it=null}={}){let st={quantized:Y,progress_callback:te,config:ne,cache_dir:xe,local_files_only:et,revision:tt,model_file_name:it};const ot=MODEL_CLASS_TO_NAME_MAPPING.get(this),rt=MODEL_TYPE_MAPPING.get(ot);let nt;return rt===MODEL_TYPES.DecoderOnly?nt=await Promise.all([AutoConfig.from_pretrained(O,st),constructSession(O,st.model_file_name??"decoder_model_merged",st),getModelJSON(O,"generation_config.json",!1,st)]):rt===MODEL_TYPES.Seq2Seq||rt===MODEL_TYPES.Vision2Seq?nt=await Promise.all([AutoConfig.from_pretrained(O,st),constructSession(O,"encoder_model",st),constructSession(O,"decoder_model_merged",st),getModelJSON(O,"generation_config.json",!1,st)]):rt===MODEL_TYPES.MaskGeneration?nt=await Promise.all([AutoConfig.from_pretrained(O,st),constructSession(O,"vision_encoder",st),constructSession(O,"prompt_encoder_mask_decoder",st)]):rt===MODEL_TYPES.EncoderDecoder?nt=await Promise.all([AutoConfig.from_pretrained(O,st),constructSession(O,"encoder_model",st),constructSession(O,"decoder_model_merged",st)]):(rt!==MODEL_TYPES.EncoderOnly&&console.warn(`Model type for '${ot??ne?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),nt=await Promise.all([AutoConfig.from_pretrained(O,st),constructSession(O,st.model_file_name??"model",st)])),new this(...nt)}async _call(O){return await this.forward(O)}async forward(O){return await this._forward(this,O)}_get_logits_processor(O,Y,te=null){const ne=new LogitsProcessorList;if(O.repetition_penalty!==null&&O.repetition_penalty!==1&&ne.push(new RepetitionPenaltyLogitsProcessor(O.repetition_penalty)),O.no_repeat_ngram_size!==null&&O.no_repeat_ngram_size>0&&ne.push(new NoRepeatNGramLogitsProcessor(O.no_repeat_ngram_size)),O.bad_words_ids!==null&&ne.push(new NoBadWordsLogitsProcessor(O.bad_words_ids,O.eos_token_id)),O.min_length!==null&&O.eos_token_id!==null&&O.min_length>0&&ne.push(new MinLengthLogitsProcessor(O.min_length,O.eos_token_id)),O.min_new_tokens!==null&&O.eos_token_id!==null&&O.min_new_tokens>0&&ne.push(new MinNewTokensLengthLogitsProcessor(Y,O.min_new_tokens,O.eos_token_id)),O.forced_bos_token_id!==null&&ne.push(new ForcedBOSTokenLogitsProcessor(O.forced_bos_token_id)),O.forced_eos_token_id!==null&&ne.push(new ForcedEOSTokenLogitsProcessor(O.max_length,O.forced_eos_token_id)),O.begin_suppress_tokens!==null){let xe=Y>1||O.forced_bos_token_id===null?Y:Y+1;O.forced_decoder_ids!==null&&(xe+=O.forced_decoder_ids[O.forced_decoder_ids.length-1][0]),ne.push(new SuppressTokensAtBeginLogitsProcessor(O.begin_suppress_tokens,xe))}return O.forced_decoder_ids!==null&&ne.push(new ForceTokensLogitsProcessor(O.forced_decoder_ids)),te!==null&&ne.extend(te),ne}_get_generation_config(O){let Y=new GenerationConfig(this.config);return"generation_config"in this&&Object.assign(Y,this.generation_config),O!==null&&Object.assign(Y,O),Y}async generate(O,Y=null,te=null,{inputs_attention_mask:ne=null}={}){if(!this.can_generate){let dt=`The current model class (${MODEL_CLASS_TO_NAME_MAPPING.get(this.constructor)}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;const ht=this.config.model_type,pt=MODEL_WITH_LM_HEAD_MAPPING_NAMES.get(ht)??MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES.get(ht)??MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES.get(ht)??MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES.get(ht);throw pt&&(dt+=` Please use the following class instead: '${pt[0]}'`),Error(dt)}if(!(O instanceof Tensor)&&!isTypedArray(O)&&!Array.isArray(O))throw Error(`\`inputs\` must be a Tensor, TypedArray, or Array, but is "${O.constructor.name}".`);let xe;if(this.config.is_encoder_decoder)xe=0;else if(xe=O instanceof Tensor?O.dims.at(-1):O.length,xe===0)throw Error("Must supply a non-empty array of input token ids.");Y=this._get_generation_config(Y),te=te??new LogitsProcessorList,te=this._get_logits_processor(Y,xe,te);let et=Y.eos_token_id;et!==null&&!Array.isArray(et)&&(et=[et]);let tt=1;const it=tt+(Y.max_new_tokens??1/0),st=Number.isInteger(Y.max_length)&&(Y.max_new_tokens??null)===null;let ot=Sampler.getSampler(Y),rt=this.getStartBeams(O,Y,tt,ne);for(;rt.some(ut=>!ut.done)&&tt<it;){let ut=[];for(let dt of rt){if(dt.done){ut.push(dt);continue}if(st&&dt.output_token_ids.length>=Y.max_length){dt.done=!0,ut.push(dt);continue}let ht=await this.runBeam(dt);Y.output_attentions&&this.addAttentionsToBeam(dt,ht),Y.output_scores;let pt=ht.logits.slice(null,-1,null);te(dt.output_token_ids,pt);let ft=ot(pt);for(let[mt,yt]of ft){let bt={...dt};this.updateBeam(bt,mt),bt.score+=yt,et&&et.includes(mt)&&(bt.done=!0),ut.push(bt)}}++tt,ut=this.groupBeams(ut).map(dt=>dt.sort((ht,pt)=>pt.score-ht.score).slice(0,Y.num_beams)),rt=ut.flat(),Y.callback_function&&Y.callback_function(rt)}const nt=this.groupBeams(rt),at=ut=>nt.map(dt=>Y.num_return_sequences>1?dt.slice(0,Y.num_return_sequences).map(ht=>ht[ut]):[dt[0][ut]]).flat(),ct=at("output_token_ids");if(Y.return_dict_in_generate){const ut=at("decoder_attentions"),dt=at("cross_attentions");return{sequences:ct,decoder_attentions:ut,cross_attentions:dt}}else return ct}addAttentionsToBeam(O,Y){if(this.config.is_encoder_decoder){if(!Y.cross_attentions||Y.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");O.cross_attentions||(O.cross_attentions=[]),O.cross_attentions.push(Y.cross_attentions)}if(!Y.decoder_attentions||Y.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");O.decoder_attentions||(O.decoder_attentions=[]),O.decoder_attentions.push(Y.decoder_attentions)}groupBeams(O){const Y=Object.create(null);for(const te of O)Y[te.id]===void 0?Y[te.id]=[te]:Y[te.id].push(te);return Object.values(Y)}getPastKeyValues(O,Y){const te=Object.create(null);for(const ne in O)if(ne.startsWith("present")){let xe=ne.replace("present","past_key_values");Y&&ne.includes("encoder")?te[xe]=Y[xe]:te[xe]=O[ne]}return te}getAttentions(O){const Y=Object.create(null);for(const te of["cross_attentions","decoder_attentions"]){const ne=[];for(const xe in O)if(xe.startsWith(te)){const et=xe.split(".").pop();ne[et]=O[xe]}Y[te]=ne}return Y}addPastKeyValues(O,Y){if(Y)Object.assign(O,Y);else if(this.config.is_encoder_decoder&&(this.add_encoder_pkv??!0)){let ne=[1,this.num_encoder_heads,0,this.encoder_dim_kv],xe=[1,this.num_decoder_heads,0,this.decoder_dim_kv];for(let et=0;et<this.num_decoder_layers;++et)O[`past_key_values.${et}.encoder.key`]=new Tensor("float32",[],ne),O[`past_key_values.${et}.encoder.value`]=new Tensor("float32",[],ne),O[`past_key_values.${et}.decoder.key`]=new Tensor("float32",[],xe),O[`past_key_values.${et}.decoder.value`]=new Tensor("float32",[],xe)}else if(this.config.model_type==="falcon"){let ne=[1*this.num_heads,0,this.dim_kv];for(let xe=0;xe<this.num_layers;++xe)O[`past_key_values.${xe}.key`]=new Tensor("float32",[],ne),O[`past_key_values.${xe}.value`]=new Tensor("float32",[],ne)}else if(this.config.multi_query){let ne=[1*this.num_heads,0,2*this.dim_kv];for(let xe=0;xe<this.num_layers;++xe)O[`past_key_values.${xe}.key_value`]=new Tensor("float32",[],ne)}else if(this.config.model_type==="bloom"){let ne=[1*this.num_heads,this.dim_kv,0],xe=[1*this.num_heads,0,this.dim_kv];for(let et=0;et<this.num_layers;++et)O[`past_key_values.${et}.key`]=new Tensor("float32",[],ne),O[`past_key_values.${et}.value`]=new Tensor("float32",[],xe)}else{let ne=[1,this.num_heads,0,this.dim_kv];for(let xe=0;xe<this.num_layers;++xe)O[`past_key_values.${xe}.key`]=new Tensor("float32",[],ne),O[`past_key_values.${xe}.value`]=new Tensor("float32",[],ne)}}getStartBeams(O,Y,te,ne){return this._getStartBeams(this,O,Y,te,ne)}async runBeam(O){return await this._runBeam(this,O)}updateBeam(O,Y){return this._updateBeam(O,Y)}}class ModelOutput{}class BertPreTrainedModel extends PreTrainedModel{}class BertModel extends BertPreTrainedModel{}class BertForMaskedLM extends BertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class BertForSequenceClassification extends BertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class BertForTokenClassification extends BertPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class BertForQuestionAnswering extends BertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class NomicBertPreTrainedModel extends PreTrainedModel{}class NomicBertModel extends NomicBertPreTrainedModel{}class RoFormerPreTrainedModel extends PreTrainedModel{}class RoFormerModel extends RoFormerPreTrainedModel{}class RoFormerForMaskedLM extends RoFormerPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class RoFormerForSequenceClassification extends RoFormerPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class RoFormerForTokenClassification extends RoFormerPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class RoFormerForQuestionAnswering extends RoFormerPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class ConvBertPreTrainedModel extends PreTrainedModel{}class ConvBertModel extends ConvBertPreTrainedModel{}class ConvBertForMaskedLM extends ConvBertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class ConvBertForSequenceClassification extends ConvBertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class ConvBertForTokenClassification extends ConvBertPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class ConvBertForQuestionAnswering extends ConvBertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class ElectraPreTrainedModel extends PreTrainedModel{}class ElectraModel extends ElectraPreTrainedModel{}class ElectraForMaskedLM extends ElectraPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class ElectraForSequenceClassification extends ElectraPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class ElectraForTokenClassification extends ElectraPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class ElectraForQuestionAnswering extends ElectraPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class CamembertPreTrainedModel extends PreTrainedModel{}class CamembertModel extends CamembertPreTrainedModel{}class CamembertForMaskedLM extends CamembertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class CamembertForSequenceClassification extends CamembertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class CamembertForTokenClassification extends CamembertPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class CamembertForQuestionAnswering extends CamembertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class DebertaPreTrainedModel extends PreTrainedModel{}class DebertaModel extends DebertaPreTrainedModel{}class DebertaForMaskedLM extends DebertaPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class DebertaForSequenceClassification extends DebertaPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class DebertaForTokenClassification extends DebertaPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class DebertaForQuestionAnswering extends DebertaPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class DebertaV2PreTrainedModel extends PreTrainedModel{}class DebertaV2Model extends DebertaV2PreTrainedModel{}class DebertaV2ForMaskedLM extends DebertaV2PreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class DebertaV2ForSequenceClassification extends DebertaV2PreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class DebertaV2ForTokenClassification extends DebertaV2PreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class DebertaV2ForQuestionAnswering extends DebertaV2PreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class DistilBertPreTrainedModel extends PreTrainedModel{}class DistilBertModel extends DistilBertPreTrainedModel{}class DistilBertForSequenceClassification extends DistilBertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class DistilBertForTokenClassification extends DistilBertPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class DistilBertForQuestionAnswering extends DistilBertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class DistilBertForMaskedLM extends DistilBertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class EsmPreTrainedModel extends PreTrainedModel{}class EsmModel extends EsmPreTrainedModel{}class EsmForMaskedLM extends EsmPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class EsmForSequenceClassification extends EsmPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class EsmForTokenClassification extends EsmPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class MobileBertPreTrainedModel extends PreTrainedModel{}class MobileBertModel extends MobileBertPreTrainedModel{}class MobileBertForMaskedLM extends MobileBertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class MobileBertForSequenceClassification extends MobileBertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class MobileBertForQuestionAnswering extends MobileBertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class MPNetPreTrainedModel extends PreTrainedModel{}class MPNetModel extends MPNetPreTrainedModel{}class MPNetForMaskedLM extends MPNetPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class MPNetForSequenceClassification extends MPNetPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class MPNetForTokenClassification extends MPNetPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class MPNetForQuestionAnswering extends MPNetPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class SqueezeBertPreTrainedModel extends PreTrainedModel{}class SqueezeBertModel extends SqueezeBertPreTrainedModel{}class SqueezeBertForMaskedLM extends SqueezeBertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class SqueezeBertForSequenceClassification extends SqueezeBertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class SqueezeBertForQuestionAnswering extends SqueezeBertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class AlbertPreTrainedModel extends PreTrainedModel{}class AlbertModel extends AlbertPreTrainedModel{}class AlbertForSequenceClassification extends AlbertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class AlbertForQuestionAnswering extends AlbertPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class AlbertForMaskedLM extends AlbertPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class T5PreTrainedModel extends PreTrainedModel{}class T5Model extends T5PreTrainedModel{}class T5ForConditionalGeneration extends T5PreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class LongT5PreTrainedModel extends PreTrainedModel{}class LongT5Model extends LongT5PreTrainedModel{}class LongT5ForConditionalGeneration extends LongT5PreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class MT5PreTrainedModel extends PreTrainedModel{}class MT5Model extends MT5PreTrainedModel{}class MT5ForConditionalGeneration extends MT5PreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class BartPretrainedModel extends PreTrainedModel{}class BartModel extends BartPretrainedModel{}class BartForConditionalGeneration extends BartPretrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BartForSequenceClassification extends BartPretrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class MBartPreTrainedModel extends PreTrainedModel{}class MBartModel extends MBartPreTrainedModel{}class MBartForConditionalGeneration extends MBartPreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class MBartForSequenceClassification extends MBartPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class MBartForCausalLM extends MBartPreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BlenderbotPreTrainedModel extends PreTrainedModel{}class BlenderbotModel extends BlenderbotPreTrainedModel{}class BlenderbotForConditionalGeneration extends BlenderbotPreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class BlenderbotSmallPreTrainedModel extends PreTrainedModel{}class BlenderbotSmallModel extends BlenderbotSmallPreTrainedModel{}class BlenderbotSmallForConditionalGeneration extends BlenderbotSmallPreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class RobertaPreTrainedModel extends PreTrainedModel{}class RobertaModel extends RobertaPreTrainedModel{}class RobertaForMaskedLM extends RobertaPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class RobertaForSequenceClassification extends RobertaPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class RobertaForTokenClassification extends RobertaPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class RobertaForQuestionAnswering extends RobertaPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class XLMPreTrainedModel extends PreTrainedModel{}class XLMModel extends XLMPreTrainedModel{}class XLMWithLMHeadModel extends XLMPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class XLMForSequenceClassification extends XLMPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class XLMForTokenClassification extends XLMPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class XLMForQuestionAnswering extends XLMPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class XLMRobertaPreTrainedModel extends PreTrainedModel{}class XLMRobertaModel extends XLMRobertaPreTrainedModel{}class XLMRobertaForMaskedLM extends XLMRobertaPreTrainedModel{async _call(O){return new MaskedLMOutput(await super._call(O))}}class XLMRobertaForSequenceClassification extends XLMRobertaPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class XLMRobertaForTokenClassification extends XLMRobertaPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class XLMRobertaForQuestionAnswering extends XLMRobertaPreTrainedModel{async _call(O){return new QuestionAnsweringModelOutput(await super._call(O))}}class ASTPreTrainedModel extends PreTrainedModel{}class ASTModel extends ASTPreTrainedModel{}class ASTForAudioClassification extends ASTPreTrainedModel{}class WhisperPreTrainedModel extends PreTrainedModel{}class WhisperModel extends WhisperPreTrainedModel{}class WhisperForConditionalGeneration extends WhisperPreTrainedModel{requires_attention_mask=!1;main_input_name="input_features";constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}async generate(O,Y=null,te=null){if(Y=this._get_generation_config(Y),Y.return_timestamps??=!1,Y.return_timestamps&&(te=[new WhisperTimeStampLogitsProcessor(Y)]),Y.return_token_timestamps&&(Y.output_attentions=!0,Y.return_dict_in_generate=!0,Y.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),!Y.alignment_heads))throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");const ne=await super.generate(O,Y,te);return Y.return_token_timestamps&&Y.alignment_heads&&(ne.token_timestamps=this._extract_token_timestamps(ne,Y.alignment_heads,Y.num_frames)),ne}_extract_token_timestamps(O,Y,te=null,ne=.02){if(!O.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let xe=this.config.median_filter_width;xe===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),xe=7);const et=O.cross_attentions.map(st=>{let ot=Array.from({length:this.config.decoder_layers},(dt,ht)=>cat(st.map(pt=>pt[ht]),2)),rt=stack(Y.map(([dt,ht])=>te?ot[dt].slice(null,ht,null,[0,te]):ot[dt].slice(null,ht)));rt=rt.transpose(1,0,2,3);let[nt,at]=std_mean(rt,-2,0,!0),ct=rt.clone();for(let dt=0;dt<ct.dims[0];++dt){let ht=ct[dt];for(let pt=0;pt<ht.dims[0];++pt){let ft=ht[pt];const mt=nt[dt][pt][0],yt=at[dt][pt][0];for(let bt=0;bt<ft.dims[0];++bt){let vt=ft[bt];for(let Et=0;Et<vt.data.length;++Et)vt.data[Et]=(vt.data[Et]-yt.data[Et])/mt.data[Et];vt.data.set(medianFilter(vt.data,xe))}}}return mean(ct,1)}),tt=[O.sequences.length,O.sequences[0].length],it=new Tensor("float32",new Float32Array(tt[0]*tt[1]),tt);for(let st=0;st<tt[0];++st){const ot=et[st].neg().squeeze_(0);let[rt,nt]=dynamicTimeWarping(ot),at=Array.from({length:rt.length-1},(dt,ht)=>rt[ht+1]-rt[ht]),ct=mergeArrays([1],at).map(dt=>!!dt),ut=[];for(let dt=0;dt<ct.length;++dt)ct[dt]&&ut.push(nt[dt]*ne);it[st].data.set(ut,1)}return it}}class VisionEncoderDecoderModel extends PreTrainedModel{main_input_name="pixel_values";constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne;const xe=this.config.encoder,et=this.config.decoder,tt=xe.model_type;(MODEL_MAPPING_NAMES_ENCODER_ONLY.get(tt)??MODEL_MAPPING_NAMES_ENCODER_DECODER.get(tt))||console.warn(`Model type for encoder '${tt}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`);const st=MODEL_WITH_LM_HEAD_MAPPING_NAMES.get(et.model_type);if(!st)throw new Error(`Unable to construct \`VisionEncoderDecoder\` due to unsupported decoder: "${this.config.decoder.model_type}"`);const ot=st[1],rt=new ot(et,te,ne);this.add_encoder_pkv="num_decoder_layers"in rt,this.add_encoder_pkv?(this.num_decoder_layers=rt.num_decoder_layers,this.num_decoder_heads=rt.num_decoder_heads,this.decoder_dim_kv=rt.decoder_dim_kv,this.num_encoder_layers=rt.num_encoder_layers,this.num_encoder_heads=rt.num_encoder_heads,this.encoder_dim_kv=rt.encoder_dim_kv):(this.num_layers=rt.num_layers,this.num_heads=rt.num_heads,this.dim_kv=rt.dim_kv)}}class CLIPPreTrainedModel extends PreTrainedModel{}class CLIPModel extends CLIPPreTrainedModel{}class CLIPTextModelWithProjection extends CLIPPreTrainedModel{static async from_pretrained(O,Y={}){return Y.model_file_name??="text_model",super.from_pretrained(O,Y)}}class CLIPVisionModelWithProjection extends CLIPPreTrainedModel{static async from_pretrained(O,Y={}){return Y.model_file_name??="vision_model",super.from_pretrained(O,Y)}}class SiglipPreTrainedModel extends PreTrainedModel{}class SiglipModel extends SiglipPreTrainedModel{}class SiglipTextModel extends SiglipPreTrainedModel{static async from_pretrained(O,Y={}){return Y.model_file_name??="text_model",super.from_pretrained(O,Y)}}class SiglipVisionModel extends CLIPPreTrainedModel{static async from_pretrained(O,Y={}){return Y.model_file_name??="vision_model",super.from_pretrained(O,Y)}}class ChineseCLIPPreTrainedModel extends PreTrainedModel{}class ChineseCLIPModel extends ChineseCLIPPreTrainedModel{}class CLIPSegPreTrainedModel extends PreTrainedModel{}class CLIPSegModel extends CLIPSegPreTrainedModel{}class CLIPSegForImageSegmentation extends CLIPSegPreTrainedModel{}class GPT2PreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPT2Model extends GPT2PreTrainedModel{}class GPT2LMHeadModel extends GPT2PreTrainedModel{}class GPTNeoPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_heads,this.num_layers=this.config.num_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class GPTNeoModel extends GPTNeoPreTrainedModel{}class GPTNeoForCausalLM extends GPTNeoPreTrainedModel{}class GPTNeoXPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class GPTNeoXModel extends GPTNeoXPreTrainedModel{}class GPTNeoXForCausalLM extends GPTNeoXPreTrainedModel{}class GPTJPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPTJModel extends GPTJPreTrainedModel{}class GPTJForCausalLM extends GPTJPreTrainedModel{}class GPTBigCodePreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class GPTBigCodeModel extends GPTBigCodePreTrainedModel{}class GPTBigCodeForCausalLM extends GPTBigCodePreTrainedModel{}class CodeGenPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class CodeGenModel extends CodeGenPreTrainedModel{}class CodeGenForCausalLM extends CodeGenPreTrainedModel{}class LlamaPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class LlamaModel extends LlamaPreTrainedModel{}class LlamaForCausalLM extends LlamaPreTrainedModel{}class Qwen2PreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Qwen2Model extends Qwen2PreTrainedModel{}class Qwen2ForCausalLM extends Qwen2PreTrainedModel{}class PhiPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class PhiModel extends PhiPreTrainedModel{}class PhiForCausalLM extends PhiPreTrainedModel{}class BloomPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.hidden_size/this.num_heads}}class BloomModel extends BloomPreTrainedModel{}class BloomForCausalLM extends BloomPreTrainedModel{}class MptPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_heads,this.num_layers=this.config.n_layers,this.dim_kv=this.config.d_model/this.num_heads}}class MptModel extends MptPreTrainedModel{}class MptForCausalLM extends MptPreTrainedModel{}class OPTPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class OPTModel extends OPTPreTrainedModel{}class OPTForCausalLM extends OPTPreTrainedModel{}class ViTPreTrainedModel extends PreTrainedModel{}class ViTModel extends ViTPreTrainedModel{}class ViTForImageClassification extends ViTPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class FastViTPreTrainedModel extends PreTrainedModel{}class FastViTModel extends FastViTPreTrainedModel{}class FastViTForImageClassification extends FastViTPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class VitMattePreTrainedModel extends PreTrainedModel{}class VitMatteForImageMatting extends VitMattePreTrainedModel{async _call(O){return new ImageMattingOutput(await super._call(O))}}class MobileViTPreTrainedModel extends PreTrainedModel{}class MobileViTModel extends MobileViTPreTrainedModel{}class MobileViTForImageClassification extends MobileViTPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class MobileViTV2PreTrainedModel extends PreTrainedModel{}class MobileViTV2Model extends MobileViTV2PreTrainedModel{}class MobileViTV2ForImageClassification extends MobileViTV2PreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class OwlViTPreTrainedModel extends PreTrainedModel{}class OwlViTModel extends OwlViTPreTrainedModel{}class OwlViTForObjectDetection extends OwlViTPreTrainedModel{}class Owlv2PreTrainedModel extends PreTrainedModel{}class Owlv2Model extends Owlv2PreTrainedModel{}class Owlv2ForObjectDetection extends Owlv2PreTrainedModel{}class BeitPreTrainedModel extends PreTrainedModel{}class BeitModel extends BeitPreTrainedModel{}class BeitForImageClassification extends BeitPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class DetrPreTrainedModel extends PreTrainedModel{}class DetrModel extends DetrPreTrainedModel{}class DetrForObjectDetection extends DetrPreTrainedModel{async _call(O){return new DetrObjectDetectionOutput(await super._call(O))}}class DetrForSegmentation extends DetrPreTrainedModel{async _call(O){return new DetrSegmentationOutput(await super._call(O))}}class DetrObjectDetectionOutput extends ModelOutput{constructor({logits:O,pred_boxes:Y}){super(),this.logits=O,this.pred_boxes=Y}}class DetrSegmentationOutput extends ModelOutput{constructor({logits:O,pred_boxes:Y,pred_masks:te}){super(),this.logits=O,this.pred_boxes=Y,this.pred_masks=te}}class TableTransformerPreTrainedModel extends PreTrainedModel{}class TableTransformerModel extends TableTransformerPreTrainedModel{}class TableTransformerForObjectDetection extends TableTransformerPreTrainedModel{async _call(O){return new TableTransformerObjectDetectionOutput(await super._call(O))}}class TableTransformerObjectDetectionOutput extends DetrObjectDetectionOutput{}class DeiTPreTrainedModel extends PreTrainedModel{}class DeiTModel extends DeiTPreTrainedModel{}class DeiTForImageClassification extends DeiTPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class ResNetPreTrainedModel extends PreTrainedModel{}class ResNetModel extends ResNetPreTrainedModel{}class ResNetForImageClassification extends ResNetPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class SwinPreTrainedModel extends PreTrainedModel{}class SwinModel extends SwinPreTrainedModel{}class SwinForImageClassification extends SwinPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class Swin2SRPreTrainedModel extends PreTrainedModel{}class Swin2SRModel extends Swin2SRPreTrainedModel{}class Swin2SRForImageSuperResolution extends Swin2SRPreTrainedModel{}class DPTPreTrainedModel extends PreTrainedModel{}class DPTModel extends DPTPreTrainedModel{}class DPTForDepthEstimation extends DPTPreTrainedModel{}class DepthAnythingPreTrainedModel extends PreTrainedModel{}class DepthAnythingForDepthEstimation extends DepthAnythingPreTrainedModel{}class GLPNPreTrainedModel extends PreTrainedModel{}class GLPNModel extends GLPNPreTrainedModel{}class GLPNForDepthEstimation extends GLPNPreTrainedModel{}class DonutSwinPreTrainedModel extends PreTrainedModel{}class DonutSwinModel extends DonutSwinPreTrainedModel{}class ConvNextPreTrainedModel extends PreTrainedModel{}class ConvNextModel extends ConvNextPreTrainedModel{}class ConvNextForImageClassification extends ConvNextPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class ConvNextV2PreTrainedModel extends PreTrainedModel{}class ConvNextV2Model extends ConvNextV2PreTrainedModel{}class ConvNextV2ForImageClassification extends ConvNextV2PreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class Dinov2PreTrainedModel extends PreTrainedModel{}class Dinov2Model extends Dinov2PreTrainedModel{}class Dinov2ForImageClassification extends Dinov2PreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class YolosPreTrainedModel extends PreTrainedModel{}class YolosModel extends YolosPreTrainedModel{}class YolosForObjectDetection extends YolosPreTrainedModel{async _call(O){return new YolosObjectDetectionOutput(await super._call(O))}}class YolosObjectDetectionOutput extends ModelOutput{constructor({logits:O,pred_boxes:Y}){super(),this.logits=O,this.pred_boxes=Y}}class SamPreTrainedModel extends PreTrainedModel{}class SamModel extends SamPreTrainedModel{constructor(O,Y,te){super(O,Y),this.prompt_encoder_mask_decoder=te}async get_image_embeddings({pixel_values:O}){return await encoderForward(this,{pixel_values:O})}async forward(O){if((!O.image_embeddings||!O.image_positional_embeddings)&&(O={...O,...await this.get_image_embeddings(O)}),!O.input_labels){const Y=O.input_points.dims.slice(0,-1),te=Y.reduce((ne,xe)=>ne*xe,1);O.input_labels=new Tensor("int64",new BigInt64Array(te).fill(1n),Y)}return await sessionRun(this.prompt_encoder_mask_decoder,{input_points:O.input_points,input_labels:O.input_labels,image_embeddings:O.image_embeddings,image_positional_embeddings:O.image_positional_embeddings})}async _call(O){return new SamImageSegmentationOutput(await super._call(O))}}class SamImageSegmentationOutput extends ModelOutput{constructor({iou_scores:O,pred_masks:Y}){super(),this.iou_scores=O,this.pred_masks=Y}}class MarianPreTrainedModel extends PreTrainedModel{}class MarianModel extends MarianPreTrainedModel{}class MarianMTModel extends MarianPreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class M2M100PreTrainedModel extends PreTrainedModel{}class M2M100Model extends M2M100PreTrainedModel{}class M2M100ForConditionalGeneration extends M2M100PreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Wav2Vec2PreTrainedModel extends PreTrainedModel{}class Wav2Vec2Model extends Wav2Vec2PreTrainedModel{}class Wav2Vec2ForCTC extends Wav2Vec2PreTrainedModel{async _call(O){return new CausalLMOutput(await super._call(O))}}class Wav2Vec2ForSequenceClassification extends Wav2Vec2PreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class Wav2Vec2ForAudioFrameClassification extends Wav2Vec2PreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class UniSpeechPreTrainedModel extends PreTrainedModel{}class UniSpeechModel extends UniSpeechPreTrainedModel{}class UniSpeechForCTC extends UniSpeechPreTrainedModel{async _call(O){return new CausalLMOutput(await super._call(O))}}class UniSpeechForSequenceClassification extends UniSpeechPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class UniSpeechSatPreTrainedModel extends PreTrainedModel{}class UniSpeechSatModel extends UniSpeechSatPreTrainedModel{}class UniSpeechSatForCTC extends UniSpeechSatPreTrainedModel{async _call(O){return new CausalLMOutput(await super._call(O))}}class UniSpeechSatForSequenceClassification extends UniSpeechSatPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class UniSpeechSatForAudioFrameClassification extends UniSpeechSatPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class Wav2Vec2BertPreTrainedModel extends PreTrainedModel{}class Wav2Vec2BertModel extends Wav2Vec2BertPreTrainedModel{}class Wav2Vec2BertForCTC extends Wav2Vec2BertPreTrainedModel{async _call(O){return new CausalLMOutput(await super._call(O))}}class Wav2Vec2BertForSequenceClassification extends Wav2Vec2BertPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class HubertModel extends Wav2Vec2PreTrainedModel{}class HubertForCTC extends Wav2Vec2PreTrainedModel{async _call(O){return new CausalLMOutput(await super._call(O))}}class HubertForSequenceClassification extends Wav2Vec2PreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class WavLMPreTrainedModel extends PreTrainedModel{}class WavLMModel extends WavLMPreTrainedModel{}class WavLMForCTC extends WavLMPreTrainedModel{async _call(O){return new CausalLMOutput(await super._call(O))}}class WavLMForSequenceClassification extends WavLMPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class WavLMForXVector extends WavLMPreTrainedModel{async _call(O){return new XVectorOutput(await super._call(O))}}class WavLMForAudioFrameClassification extends WavLMPreTrainedModel{async _call(O){return new TokenClassifierOutput(await super._call(O))}}class SpeechT5PreTrainedModel extends PreTrainedModel{}class SpeechT5ForSpeechToText extends SpeechT5PreTrainedModel{}class SpeechT5ForTextToSpeech extends SpeechT5PreTrainedModel{constructor(O,Y,te,ne){super(O,Y),this.decoder_merged_session=te,this.generation_config=ne,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.hidden_size/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.hidden_size/this.num_encoder_heads}async generate_speech(O,Y,{threshold:te=.5,minlenratio:ne=0,maxlenratio:xe=20,vocoder:et=null}={}){const tt={input_ids:O},{encoder_outputs:it,encoder_attention_mask:st}=await encoderForward(this,tt),ot=it.dims[1]/this.config.reduction_factor,rt=Math.floor(ot*xe),nt=Math.floor(ot*ne),at=this.config.num_mel_bins;let ct=[],ut=null,dt=null,ht=0;for(;;){++ht;const mt=boolTensor(!!dt);let yt;dt?yt=dt.output_sequence_out:yt=new Tensor("float32",new Float32Array(at),[1,1,at]);let bt={use_cache_branch:mt,output_sequence:yt,encoder_attention_mask:st,speaker_embeddings:Y,encoder_hidden_states:it};this.addPastKeyValues(bt,ut),dt=await sessionRun(this.decoder_merged_session,bt),ut=this.getPastKeyValues(dt,ut);const{prob:vt,spectrum:Et}=dt;if(ct.push(Et),ht>=nt&&(Array.from(vt.data).filter(wt=>wt>=te).length>0||ht>=rt))break}const pt=cat(ct),{waveform:ft}=await sessionRun(et.session,{spectrogram:pt});return{spectrogram:pt,waveform:ft}}}class SpeechT5HifiGan extends PreTrainedModel{main_input_name="spectrogram"}class TrOCRPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_encoder_layers=this.num_decoder_layers=this.config.decoder_layers,this.num_encoder_heads=this.num_decoder_heads=this.config.decoder_attention_heads,this.encoder_dim_kv=this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads}}class TrOCRForCausalLM extends TrOCRPreTrainedModel{}class MistralPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class MistralModel extends MistralPreTrainedModel{}class MistralForCausalLM extends MistralPreTrainedModel{}class Starcoder2PreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Starcoder2Model extends Starcoder2PreTrainedModel{}class Starcoder2ForCausalLM extends Starcoder2PreTrainedModel{}class FalconPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class FalconModel extends FalconPreTrainedModel{}class FalconForCausalLM extends FalconPreTrainedModel{}class ClapPreTrainedModel extends PreTrainedModel{}class ClapModel extends ClapPreTrainedModel{}class ClapTextModelWithProjection extends ClapPreTrainedModel{static async from_pretrained(O,Y={}){return Y.model_file_name??="text_model",super.from_pretrained(O,Y)}}class ClapAudioModelWithProjection extends ClapPreTrainedModel{static async from_pretrained(O,Y={}){return Y.model_file_name??="audio_model",super.from_pretrained(O,Y)}}class VitsPreTrainedModel extends PreTrainedModel{}class VitsModel extends VitsPreTrainedModel{async _call(O){return new VitsModelOutput(await super._call(O))}}class SegformerPreTrainedModel extends PreTrainedModel{}class SegformerForImageClassification extends SegformerPreTrainedModel{}class SegformerForSemanticSegmentation extends SegformerPreTrainedModel{}class StableLmPreTrainedModel extends PreTrainedModel{constructor(O,Y,te){super(O,Y),this.generation_config=te,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class StableLmForCausalLM extends StableLmPreTrainedModel{}class EfficientNetPreTrainedModel extends PreTrainedModel{}class EfficientNetModel extends EfficientNetPreTrainedModel{}class EfficientNetForImageClassification extends EfficientNetPreTrainedModel{async _call(O){return new SequenceClassifierOutput(await super._call(O))}}class PretrainedMixin{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(O,{quantized:Y=!0,progress_callback:te=null,config:ne=null,cache_dir:xe=null,local_files_only:et=!1,revision:tt="main",model_file_name:it=null}={}){let st={quantized:Y,progress_callback:te,config:ne,cache_dir:xe,local_files_only:et,revision:tt,model_file_name:it};if(ne=await AutoConfig.from_pretrained(O,st),st.config||(st.config=ne),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let ot of this.MODEL_CLASS_MAPPINGS){const rt=ot.get(ne.model_type);if(rt)return await rt[1].from_pretrained(O,st)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${ne.model_type}", attempting to construct from base class.`),await PreTrainedModel.from_pretrained(O,st);throw Error(`Unsupported model type: ${ne.model_type}`)}}const MODEL_MAPPING_NAMES_ENCODER_ONLY=new Map([["bert",["BertModel",BertModel]],["nomic_bert",["NomicBertModel",NomicBertModel]],["roformer",["RoFormerModel",RoFormerModel]],["electra",["ElectraModel",ElectraModel]],["esm",["EsmModel",EsmModel]],["convbert",["ConvBertModel",ConvBertModel]],["camembert",["CamembertModel",CamembertModel]],["deberta",["DebertaModel",DebertaModel]],["deberta-v2",["DebertaV2Model",DebertaV2Model]],["mpnet",["MPNetModel",MPNetModel]],["albert",["AlbertModel",AlbertModel]],["distilbert",["DistilBertModel",DistilBertModel]],["roberta",["RobertaModel",RobertaModel]],["xlm",["XLMModel",XLMModel]],["xlm-roberta",["XLMRobertaModel",XLMRobertaModel]],["clap",["ClapModel",ClapModel]],["clip",["CLIPModel",CLIPModel]],["clipseg",["CLIPSegModel",CLIPSegModel]],["chinese_clip",["ChineseCLIPModel",ChineseCLIPModel]],["siglip",["SiglipModel",SiglipModel]],["mobilebert",["MobileBertModel",MobileBertModel]],["squeezebert",["SqueezeBertModel",SqueezeBertModel]],["wav2vec2",["Wav2Vec2Model",Wav2Vec2Model]],["wav2vec2-bert",["Wav2Vec2BertModel",Wav2Vec2BertModel]],["unispeech",["UniSpeechModel",UniSpeechModel]],["unispeech-sat",["UniSpeechSatModel",UniSpeechSatModel]],["hubert",["HubertModel",HubertModel]],["wavlm",["WavLMModel",WavLMModel]],["audio-spectrogram-transformer",["ASTModel",ASTModel]],["vits",["VitsModel",VitsModel]],["detr",["DetrModel",DetrModel]],["table-transformer",["TableTransformerModel",TableTransformerModel]],["vit",["ViTModel",ViTModel]],["fastvit",["FastViTModel",FastViTModel]],["mobilevit",["MobileViTModel",MobileViTModel]],["mobilevitv2",["MobileViTV2Model",MobileViTV2Model]],["owlvit",["OwlViTModel",OwlViTModel]],["owlv2",["Owlv2Model",Owlv2Model]],["beit",["BeitModel",BeitModel]],["deit",["DeiTModel",DeiTModel]],["convnext",["ConvNextModel",ConvNextModel]],["convnextv2",["ConvNextV2Model",ConvNextV2Model]],["dinov2",["Dinov2Model",Dinov2Model]],["resnet",["ResNetModel",ResNetModel]],["swin",["SwinModel",SwinModel]],["swin2sr",["Swin2SRModel",Swin2SRModel]],["donut-swin",["DonutSwinModel",DonutSwinModel]],["yolos",["YolosModel",YolosModel]],["dpt",["DPTModel",DPTModel]],["glpn",["GLPNModel",GLPNModel]],["hifigan",["SpeechT5HifiGan",SpeechT5HifiGan]],["efficientnet",["EfficientNetModel",EfficientNetModel]]]),MODEL_MAPPING_NAMES_ENCODER_DECODER=new Map([["t5",["T5Model",T5Model]],["longt5",["LongT5Model",LongT5Model]],["mt5",["MT5Model",MT5Model]],["bart",["BartModel",BartModel]],["mbart",["MBartModel",MBartModel]],["marian",["MarianModel",MarianModel]],["whisper",["WhisperModel",WhisperModel]],["m2m_100",["M2M100Model",M2M100Model]],["blenderbot",["BlenderbotModel",BlenderbotModel]],["blenderbot-small",["BlenderbotSmallModel",BlenderbotSmallModel]]]),MODEL_MAPPING_NAMES_DECODER_ONLY=new Map([["bloom",["BloomModel",BloomModel]],["gpt2",["GPT2Model",GPT2Model]],["gptj",["GPTJModel",GPTJModel]],["gpt_bigcode",["GPTBigCodeModel",GPTBigCodeModel]],["gpt_neo",["GPTNeoModel",GPTNeoModel]],["gpt_neox",["GPTNeoXModel",GPTNeoXModel]],["codegen",["CodeGenModel",CodeGenModel]],["llama",["LlamaModel",LlamaModel]],["qwen2",["Qwen2Model",Qwen2Model]],["phi",["PhiModel",PhiModel]],["mpt",["MptModel",MptModel]],["opt",["OPTModel",OPTModel]],["mistral",["MistralModel",MistralModel]],["starcoder2",["Starcoder2Model",Starcoder2Model]],["falcon",["FalconModel",FalconModel]]]),MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES=new Map([["speecht5",["SpeechT5ForSpeechToText",SpeechT5ForSpeechToText]],["whisper",["WhisperForConditionalGeneration",WhisperForConditionalGeneration]]]),MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES=new Map([["speecht5",["SpeechT5ForTextToSpeech",SpeechT5ForTextToSpeech]]]),MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES=new Map([["vits",["VitsModel",VitsModel]]]),MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES=new Map([["bert",["BertForSequenceClassification",BertForSequenceClassification]],["roformer",["RoFormerForSequenceClassification",RoFormerForSequenceClassification]],["electra",["ElectraForSequenceClassification",ElectraForSequenceClassification]],["esm",["EsmForSequenceClassification",EsmForSequenceClassification]],["convbert",["ConvBertForSequenceClassification",ConvBertForSequenceClassification]],["camembert",["CamembertForSequenceClassification",CamembertForSequenceClassification]],["deberta",["DebertaForSequenceClassification",DebertaForSequenceClassification]],["deberta-v2",["DebertaV2ForSequenceClassification",DebertaV2ForSequenceClassification]],["mpnet",["MPNetForSequenceClassification",MPNetForSequenceClassification]],["albert",["AlbertForSequenceClassification",AlbertForSequenceClassification]],["distilbert",["DistilBertForSequenceClassification",DistilBertForSequenceClassification]],["roberta",["RobertaForSequenceClassification",RobertaForSequenceClassification]],["xlm",["XLMForSequenceClassification",XLMForSequenceClassification]],["xlm-roberta",["XLMRobertaForSequenceClassification",XLMRobertaForSequenceClassification]],["bart",["BartForSequenceClassification",BartForSequenceClassification]],["mbart",["MBartForSequenceClassification",MBartForSequenceClassification]],["mobilebert",["MobileBertForSequenceClassification",MobileBertForSequenceClassification]],["squeezebert",["SqueezeBertForSequenceClassification",SqueezeBertForSequenceClassification]]]),MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES=new Map([["bert",["BertForTokenClassification",BertForTokenClassification]],["roformer",["RoFormerForTokenClassification",RoFormerForTokenClassification]],["electra",["ElectraForTokenClassification",ElectraForTokenClassification]],["esm",["EsmForTokenClassification",EsmForTokenClassification]],["convbert",["ConvBertForTokenClassification",ConvBertForTokenClassification]],["camembert",["CamembertForTokenClassification",CamembertForTokenClassification]],["deberta",["DebertaForTokenClassification",DebertaForTokenClassification]],["deberta-v2",["DebertaV2ForTokenClassification",DebertaV2ForTokenClassification]],["mpnet",["MPNetForTokenClassification",MPNetForTokenClassification]],["distilbert",["DistilBertForTokenClassification",DistilBertForTokenClassification]],["roberta",["RobertaForTokenClassification",RobertaForTokenClassification]],["xlm",["XLMForTokenClassification",XLMForTokenClassification]],["xlm-roberta",["XLMRobertaForTokenClassification",XLMRobertaForTokenClassification]]]),MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES=new Map([["t5",["T5ForConditionalGeneration",T5ForConditionalGeneration]],["longt5",["LongT5ForConditionalGeneration",LongT5ForConditionalGeneration]],["mt5",["MT5ForConditionalGeneration",MT5ForConditionalGeneration]],["bart",["BartForConditionalGeneration",BartForConditionalGeneration]],["mbart",["MBartForConditionalGeneration",MBartForConditionalGeneration]],["marian",["MarianMTModel",MarianMTModel]],["m2m_100",["M2M100ForConditionalGeneration",M2M100ForConditionalGeneration]],["blenderbot",["BlenderbotForConditionalGeneration",BlenderbotForConditionalGeneration]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",BlenderbotSmallForConditionalGeneration]]]),MODEL_WITH_LM_HEAD_MAPPING_NAMES=new Map([["bloom",["BloomForCausalLM",BloomForCausalLM]],["gpt2",["GPT2LMHeadModel",GPT2LMHeadModel]],["gptj",["GPTJForCausalLM",GPTJForCausalLM]],["gpt_bigcode",["GPTBigCodeForCausalLM",GPTBigCodeForCausalLM]],["gpt_neo",["GPTNeoForCausalLM",GPTNeoForCausalLM]],["gpt_neox",["GPTNeoXForCausalLM",GPTNeoXForCausalLM]],["codegen",["CodeGenForCausalLM",CodeGenForCausalLM]],["llama",["LlamaForCausalLM",LlamaForCausalLM]],["qwen2",["Qwen2ForCausalLM",Qwen2ForCausalLM]],["phi",["PhiForCausalLM",PhiForCausalLM]],["mpt",["MptForCausalLM",MptForCausalLM]],["opt",["OPTForCausalLM",OPTForCausalLM]],["mbart",["MBartForCausalLM",MBartForCausalLM]],["mistral",["MistralForCausalLM",MistralForCausalLM]],["starcoder2",["Starcoder2ForCausalLM",Starcoder2ForCausalLM]],["falcon",["FalconForCausalLM",FalconForCausalLM]],["trocr",["TrOCRForCausalLM",TrOCRForCausalLM]],["stablelm",["StableLmForCausalLM",StableLmForCausalLM]]]),MODEL_FOR_MASKED_LM_MAPPING_NAMES=new Map([["bert",["BertForMaskedLM",BertForMaskedLM]],["roformer",["RoFormerForMaskedLM",RoFormerForMaskedLM]],["electra",["ElectraForMaskedLM",ElectraForMaskedLM]],["esm",["EsmForMaskedLM",EsmForMaskedLM]],["convbert",["ConvBertForMaskedLM",ConvBertForMaskedLM]],["camembert",["CamembertForMaskedLM",CamembertForMaskedLM]],["deberta",["DebertaForMaskedLM",DebertaForMaskedLM]],["deberta-v2",["DebertaV2ForMaskedLM",DebertaV2ForMaskedLM]],["mpnet",["MPNetForMaskedLM",MPNetForMaskedLM]],["albert",["AlbertForMaskedLM",AlbertForMaskedLM]],["distilbert",["DistilBertForMaskedLM",DistilBertForMaskedLM]],["roberta",["RobertaForMaskedLM",RobertaForMaskedLM]],["xlm",["XLMWithLMHeadModel",XLMWithLMHeadModel]],["xlm-roberta",["XLMRobertaForMaskedLM",XLMRobertaForMaskedLM]],["mobilebert",["MobileBertForMaskedLM",MobileBertForMaskedLM]],["squeezebert",["SqueezeBertForMaskedLM",SqueezeBertForMaskedLM]]]),MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES=new Map([["bert",["BertForQuestionAnswering",BertForQuestionAnswering]],["roformer",["RoFormerForQuestionAnswering",RoFormerForQuestionAnswering]],["electra",["ElectraForQuestionAnswering",ElectraForQuestionAnswering]],["convbert",["ConvBertForQuestionAnswering",ConvBertForQuestionAnswering]],["camembert",["CamembertForQuestionAnswering",CamembertForQuestionAnswering]],["deberta",["DebertaForQuestionAnswering",DebertaForQuestionAnswering]],["deberta-v2",["DebertaV2ForQuestionAnswering",DebertaV2ForQuestionAnswering]],["mpnet",["MPNetForQuestionAnswering",MPNetForQuestionAnswering]],["albert",["AlbertForQuestionAnswering",AlbertForQuestionAnswering]],["distilbert",["DistilBertForQuestionAnswering",DistilBertForQuestionAnswering]],["roberta",["RobertaForQuestionAnswering",RobertaForQuestionAnswering]],["xlm",["XLMForQuestionAnswering",XLMForQuestionAnswering]],["xlm-roberta",["XLMRobertaForQuestionAnswering",XLMRobertaForQuestionAnswering]],["mobilebert",["MobileBertForQuestionAnswering",MobileBertForQuestionAnswering]],["squeezebert",["SqueezeBertForQuestionAnswering",SqueezeBertForQuestionAnswering]]]),MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",VisionEncoderDecoderModel]]]),MODEL_FOR_DOCUMENT_QUESTION_ANSWERING_MAPPING_NAMES=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",VisionEncoderDecoderModel]]]),MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES=new Map([["vit",["ViTForImageClassification",ViTForImageClassification]],["fastvit",["FastViTForImageClassification",FastViTForImageClassification]],["mobilevit",["MobileViTForImageClassification",MobileViTForImageClassification]],["mobilevitv2",["MobileViTV2ForImageClassification",MobileViTV2ForImageClassification]],["beit",["BeitForImageClassification",BeitForImageClassification]],["deit",["DeiTForImageClassification",DeiTForImageClassification]],["convnext",["ConvNextForImageClassification",ConvNextForImageClassification]],["convnextv2",["ConvNextV2ForImageClassification",ConvNextV2ForImageClassification]],["dinov2",["Dinov2ForImageClassification",Dinov2ForImageClassification]],["resnet",["ResNetForImageClassification",ResNetForImageClassification]],["swin",["SwinForImageClassification",SwinForImageClassification]],["segformer",["SegformerForImageClassification",SegformerForImageClassification]],["efficientnet",["EfficientNetForImageClassification",EfficientNetForImageClassification]]]),MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES=new Map([["detr",["DetrForObjectDetection",DetrForObjectDetection]],["table-transformer",["TableTransformerForObjectDetection",TableTransformerForObjectDetection]],["yolos",["YolosForObjectDetection",YolosForObjectDetection]]]),MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES=new Map([["owlvit",["OwlViTForObjectDetection",OwlViTForObjectDetection]],["owlv2",["Owlv2ForObjectDetection",Owlv2ForObjectDetection]]]),MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES=new Map([["detr",["DetrForSegmentation",DetrForSegmentation]],["clipseg",["CLIPSegForImageSegmentation",CLIPSegForImageSegmentation]]]),MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES=new Map([["segformer",["SegformerForSemanticSegmentation",SegformerForSemanticSegmentation]]]),MODEL_FOR_MASK_GENERATION_MAPPING_NAMES=new Map([["sam",["SamModel",SamModel]]]),MODEL_FOR_CTC_MAPPING_NAMES=new Map([["wav2vec2",["Wav2Vec2ForCTC",Wav2Vec2ForCTC]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Wav2Vec2BertForCTC]],["unispeech",["UniSpeechForCTC",UniSpeechForCTC]],["unispeech-sat",["UniSpeechSatForCTC",UniSpeechSatForCTC]],["wavlm",["WavLMForCTC",WavLMForCTC]],["hubert",["HubertForCTC",HubertForCTC]]]),MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Wav2Vec2ForSequenceClassification]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Wav2Vec2BertForSequenceClassification]],["unispeech",["UniSpeechForSequenceClassification",UniSpeechForSequenceClassification]],["unispeech-sat",["UniSpeechSatForSequenceClassification",UniSpeechSatForSequenceClassification]],["wavlm",["WavLMForSequenceClassification",WavLMForSequenceClassification]],["hubert",["HubertForSequenceClassification",HubertForSequenceClassification]],["audio-spectrogram-transformer",["ASTForAudioClassification",ASTForAudioClassification]]]),MODEL_FOR_AUDIO_XVECTOR_MAPPING_NAMES=new Map([["wavlm",["WavLMForXVector",WavLMForXVector]]]),MODEL_FOR_AUDIO_FRAME_CLASSIFICATION_MAPPING_NAMES=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",UniSpeechSatForAudioFrameClassification]],["wavlm",["WavLMForAudioFrameClassification",WavLMForAudioFrameClassification]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Wav2Vec2ForAudioFrameClassification]]]),MODEL_FOR_IMAGE_MATTING_MAPPING_NAMES=new Map([["vitmatte",["VitMatteForImageMatting",VitMatteForImageMatting]]]),MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES=new Map([["swin2sr",["Swin2SRForImageSuperResolution",Swin2SRForImageSuperResolution]]]),MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES=new Map([["dpt",["DPTForDepthEstimation",DPTForDepthEstimation]],["depth_anything",["DepthAnythingForDepthEstimation",DepthAnythingForDepthEstimation]],["glpn",["GLPNForDepthEstimation",GLPNForDepthEstimation]]]),MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES=new Map([["clip",["CLIPVisionModelWithProjection",CLIPVisionModelWithProjection]],["siglip",["SiglipVisionModel",SiglipVisionModel]]]),MODEL_CLASS_TYPE_MAPPING=[[MODEL_MAPPING_NAMES_ENCODER_ONLY,MODEL_TYPES.EncoderOnly],[MODEL_MAPPING_NAMES_ENCODER_DECODER,MODEL_TYPES.EncoderDecoder],[MODEL_MAPPING_NAMES_DECODER_ONLY,MODEL_TYPES.DecoderOnly],[MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_WITH_LM_HEAD_MAPPING_NAMES,MODEL_TYPES.DecoderOnly],[MODEL_FOR_MASKED_LM_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES,MODEL_TYPES.Vision2Seq],[MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_MATTING_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_MASK_GENERATION_MAPPING_NAMES,MODEL_TYPES.MaskGeneration],[MODEL_FOR_CTC_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES,MODEL_TYPES.Seq2Seq],[MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_XVECTOR_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_AUDIO_FRAME_CLASSIFICATION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly],[MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES,MODEL_TYPES.EncoderOnly]];for(const[ee,O]of MODEL_CLASS_TYPE_MAPPING)for(const[Y,te]of ee.values())MODEL_TYPE_MAPPING.set(Y,O),MODEL_CLASS_TO_NAME_MAPPING.set(te,Y),MODEL_NAME_TO_CLASS_MAPPING.set(Y,te);const CUSTOM_MAPPING=[["CLIPTextModelWithProjection",CLIPTextModelWithProjection,MODEL_TYPES.EncoderOnly],["SiglipTextModel",SiglipTextModel,MODEL_TYPES.EncoderOnly],["ClapTextModelWithProjection",ClapTextModelWithProjection,MODEL_TYPES.EncoderOnly],["ClapAudioModelWithProjection",ClapAudioModelWithProjection,MODEL_TYPES.EncoderOnly]];for(const[ee,O,Y]of CUSTOM_MAPPING)MODEL_TYPE_MAPPING.set(ee,Y),MODEL_CLASS_TO_NAME_MAPPING.set(O,ee),MODEL_NAME_TO_CLASS_MAPPING.set(ee,O);class AutoModel extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=MODEL_CLASS_TYPE_MAPPING.map(O=>O[0]);static BASE_IF_FAIL=!0}class AutoModelForSequenceClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEQUENCE_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForTokenClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TOKEN_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForSeq2SeqLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEQ_TO_SEQ_CAUSAL_LM_MAPPING_NAMES]}class AutoModelForSpeechSeq2Seq extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES]}class AutoModelForTextToSpectrogram extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TEXT_TO_SPECTROGRAM_MAPPING_NAMES]}class AutoModelForTextToWaveform extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_TEXT_TO_WAVEFORM_MAPPING_NAMES]}class AutoModelForCausalLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_WITH_LM_HEAD_MAPPING_NAMES]}class AutoModelForMaskedLM extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_MASKED_LM_MAPPING_NAMES]}class AutoModelForQuestionAnswering extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_QUESTION_ANSWERING_MAPPING_NAMES]}class AutoModelForVision2Seq extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_VISION_2_SEQ_MAPPING_NAMES]}class AutoModelForImageClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForImageSegmentation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_SEGMENTATION_MAPPING_NAMES]}class AutoModelForSemanticSegmentation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_SEMANTIC_SEGMENTATION_MAPPING_NAMES]}class AutoModelForObjectDetection extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_OBJECT_DETECTION_MAPPING_NAMES]}class AutoModelForZeroShotObjectDetection extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_ZERO_SHOT_OBJECT_DETECTION_MAPPING_NAMES]}class AutoModelForCTC extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_CTC_MAPPING_NAMES]}class AutoModelForAudioClassification extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_AUDIO_CLASSIFICATION_MAPPING_NAMES]}class AutoModelForDocumentQuestionAnswering extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_DOCUMENT_QUESTION_ANSWERING_MAPPING_NAMES]}class AutoModelForImageToImage extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_TO_IMAGE_MAPPING_NAMES]}class AutoModelForDepthEstimation extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_DEPTH_ESTIMATION_MAPPING_NAMES]}class AutoModelForImageFeatureExtraction extends PretrainedMixin{static MODEL_CLASS_MAPPINGS=[MODEL_FOR_IMAGE_FEATURE_EXTRACTION_MAPPING_NAMES]}class Seq2SeqLMOutput extends ModelOutput{constructor({logits:O,past_key_values:Y,encoder_outputs:te,decoder_attentions:ne=null,cross_attentions:xe=null}){super(),this.logits=O,this.past_key_values=Y,this.encoder_outputs=te,this.decoder_attentions=ne,this.cross_attentions=xe}}class SequenceClassifierOutput extends ModelOutput{constructor({logits:O}){super(),this.logits=O}}class XVectorOutput extends ModelOutput{constructor({logits:O,embeddings:Y}){super(),this.logits=O,this.embeddings=Y}}class TokenClassifierOutput extends ModelOutput{constructor({logits:O}){super(),this.logits=O}}class MaskedLMOutput extends ModelOutput{constructor({logits:O}){super(),this.logits=O}}class QuestionAnsweringModelOutput extends ModelOutput{constructor({start_logits:O,end_logits:Y}){super(),this.start_logits=O,this.end_logits=Y}}class CausalLMOutput extends ModelOutput{constructor({logits:O}){super(),this.logits=O}}class ImageMattingOutput extends ModelOutput{constructor({alphas:O}){super(),this.alphas=O}}class VitsModelOutput extends ModelOutput{constructor({waveform:O,spectrogram:Y}){super(),this.waveform=O,this.spectrogram=Y}}const BROWSER_ENV=typeof self<"u",WEBWORKER_ENV=BROWSER_ENV&&self.constructor.name==="DedicatedWorkerGlobalScope";let createCanvasFunction,ImageDataClass,loadImageFunction;if(BROWSER_ENV)createCanvasFunction=(ee,O)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(ee,O)},loadImageFunction=self.createImageBitmap,ImageDataClass=self.ImageData;else if(fs)loadImageFunction=async ee=>{const Y=(await ee.metadata()).channels;let{data:te,info:ne}=await ee.rotate().raw().toBuffer({resolveWithObject:!0});const xe=new RawImage(new Uint8ClampedArray(te),ne.width,ne.height,ne.channels);return Y!==void 0&&Y!==ne.channels&&xe.convert(Y),xe};else throw new Error("Unable to load image processing library.");const RESAMPLING_MAPPING={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},CONTENT_TYPE_MAP=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class RawImage{constructor(O,Y,te,ne){this.data=O,this.width=Y,this.height=te,this.channels=ne}get size(){return[this.width,this.height]}static async read(O){if(O instanceof RawImage)return O;if(typeof O=="string"||O instanceof URL)return await this.fromURL(O);throw new Error(`Unsupported input type: ${typeof O}`)}static async fromURL(O){let Y=await getFile(O);if(Y.status!==200)throw new Error(`Unable to read image from "${O}" (${Y.status} ${Y.statusText})`);let te=await Y.blob();return this.fromBlob(te)}static async fromBlob(O){if(BROWSER_ENV){let Y=await loadImageFunction(O);const te=createCanvasFunction(Y.width,Y.height).getContext("2d");return te.drawImage(Y,0,0),new this(te.getImageData(0,0,Y.width,Y.height).data,Y.width,Y.height,4)}else{let Y=fs(await O.arrayBuffer());return await loadImageFunction(Y)}}static fromTensor(O,Y="CHW"){if(O.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${O.dims.length} dimensions.`);if(Y==="CHW")O=O.transpose(1,2,0);else if(Y!=="HWC")throw new Error(`Unsupported channel format: ${Y}`);if(!(O.data instanceof Uint8ClampedArray||O.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${O.type}`);switch(O.dims[2]){case 1:case 2:case 3:case 4:return new RawImage(O.data,O.dims[1],O.dims[0],O.dims[2]);default:throw new Error(`Unsupported number of channels: ${O.dims[2]}`)}}grayscale(){if(this.channels===1)return this;let O=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let Y=0,te=0;Y<this.data.length;Y+=this.channels){const ne=this.data[Y],xe=this.data[Y+1],et=this.data[Y+2];O[te++]=Math.round(.2989*ne+.587*xe+.114*et)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(O,this.width,this.height,1)}rgb(){if(this.channels===3)return this;let O=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let Y=0,te=0;Y<this.data.length;++Y)O[te++]=this.data[Y],O[te++]=this.data[Y],O[te++]=this.data[Y];break;case 4:for(let Y=0,te=0;Y<this.data.length;Y+=4)O[te++]=this.data[Y],O[te++]=this.data[Y+1],O[te++]=this.data[Y+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(O,this.width,this.height,3)}rgba(){if(this.channels===4)return this;let O=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let Y=0,te=0;Y<this.data.length;++Y)O[te++]=this.data[Y],O[te++]=this.data[Y],O[te++]=this.data[Y],O[te++]=255;break;case 3:for(let Y=0,te=0;Y<this.data.length;Y+=3)O[te++]=this.data[Y],O[te++]=this.data[Y+1],O[te++]=this.data[Y+2],O[te++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(O,this.width,this.height,4)}async resize(O,Y,{resample:te=2}={}){let ne=RESAMPLING_MAPPING[te]??te;if(BROWSER_ENV){let xe=this.channels,et=this.toCanvas();const tt=createCanvasFunction(O,Y).getContext("2d");return tt.drawImage(et,0,0,O,Y),new RawImage(tt.getImageData(0,0,O,Y).data,O,Y,4).convert(xe)}else{let xe=this.toSharp();switch(ne){case"box":case"hamming":(ne==="box"||ne==="hamming")&&(console.warn(`Resampling method ${ne} is not yet supported. Using bilinear instead.`),ne="bilinear");case"nearest":case"bilinear":case"bicubic":xe=xe.affine([O/this.width,0,0,Y/this.height],{interpolator:ne});break;case"lanczos":xe=xe.resize({width:O,height:Y,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${ne} is not supported.`)}return await loadImageFunction(xe)}}async pad([O,Y,te,ne]){if(O=Math.max(O,0),Y=Math.max(Y,0),te=Math.max(te,0),ne=Math.max(ne,0),O===0&&Y===0&&te===0&&ne===0)return this;if(BROWSER_ENV){let xe=this.channels,et=this.toCanvas(),tt=this.width+O+Y,it=this.height+te+ne;const st=createCanvasFunction(tt,it).getContext("2d");return st.drawImage(et,0,0,this.width,this.height,O,te,tt,it),new RawImage(st.getImageData(0,0,tt,it).data,tt,it,4).convert(xe)}else{let xe=this.toSharp().extend({left:O,right:Y,top:te,bottom:ne});return await loadImageFunction(xe)}}async crop([O,Y,te,ne]){if(O=Math.max(O,0),Y=Math.max(Y,0),te=Math.min(te,this.width-1),ne=Math.min(ne,this.height-1),O===0&&Y===0&&te===this.width-1&&ne===this.height-1)return this;const xe=te-O+1,et=ne-Y+1;if(BROWSER_ENV){const tt=this.channels,it=this.toCanvas(),st=createCanvasFunction(xe,et).getContext("2d");return st.drawImage(it,O,Y,xe,et,0,0,xe,et),new RawImage(st.getImageData(0,0,xe,et).data,xe,et,4).convert(tt)}else{const tt=this.toSharp().extract({left:O,top:Y,width:xe,height:et});return await loadImageFunction(tt)}}async center_crop(O,Y){if(this.width===O&&this.height===Y)return this;let te=(this.width-O)/2,ne=(this.height-Y)/2;if(BROWSER_ENV){let xe=this.channels,et=this.toCanvas();const tt=createCanvasFunction(O,Y).getContext("2d");let it=0,st=0,ot=0,rt=0;return te>=0?it=te:ot=-te,ne>=0?st=ne:rt=-ne,tt.drawImage(et,it,st,O,Y,ot,rt,O,Y),new RawImage(tt.getImageData(0,0,O,Y).data,O,Y,4).convert(xe)}else{let xe=this.toSharp();if(te>=0&&ne>=0)xe=xe.extract({left:Math.floor(te),top:Math.floor(ne),width:O,height:Y});else if(te<=0&&ne<=0){let et=Math.floor(-ne),tt=Math.floor(-te);xe=xe.extend({top:et,left:tt,right:O-this.width-tt,bottom:Y-this.height-et})}else{let et=[0,0],tt=0;ne<0?(et[0]=Math.floor(-ne),et[1]=Y-this.height-et[0]):tt=Math.floor(ne);let it=[0,0],st=0;te<0?(it[0]=Math.floor(-te),it[1]=O-this.width-it[0]):st=Math.floor(te),xe=xe.extend({top:et[0],bottom:et[1],left:it[0],right:it[1]}).extract({left:st,top:tt,width:O,height:Y})}return await loadImageFunction(xe)}}async toBlob(O="image/png",Y=1){if(!BROWSER_ENV)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:O,quality:Y})}toTensor(O="CHW"){let Y=new Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(O!=="HWC")if(O==="CHW")Y=Y.permute(2,0,1);else throw new Error(`Unsupported channel format: ${O}`);return Y}toCanvas(){if(!BROWSER_ENV)throw new Error("toCanvas() is only supported in browser environments.");let O=this.clone().rgba(),Y=createCanvasFunction(O.width,O.height),te=new ImageDataClass(O.data,O.width,O.height);return Y.getContext("2d").putImageData(te,0,0),Y}_update(O,Y,te,ne=null){return this.data=O,this.width=Y,this.height=te,ne!==null&&(this.channels=ne),this}clone(){return new RawImage(this.data.slice(),this.width,this.height,this.channels)}convert(O){if(this.channels===O)return this;switch(O){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(O){if(BROWSER_ENV){if(WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const Y=O.split(".").pop().toLowerCase(),te=CONTENT_TYPE_MAP.get(Y)??"image/png",ne=await this.toBlob(te),xe=URL.createObjectURL(ne),et=document.createElement("a");et.href=xe,et.download=O,et.click(),et.remove()}else{if(env$1.useFS)return await this.toSharp().toFile(O);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(BROWSER_ENV)throw new Error("toSharp() is only supported in server-side environments.");return fs(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}async function read_audio(ee,O){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const Y=await(await getFile(ee)).arrayBuffer(),te=new AudioContext({sampleRate:O});typeof O>"u"&&console.warn(`No sampling rate provided, using default of ${te.sampleRate}Hz.`);const ne=await te.decodeAudioData(Y);let xe;if(ne.numberOfChannels===2){const et=Math.sqrt(2),tt=ne.getChannelData(0),it=ne.getChannelData(1);xe=new Float32Array(tt.length);for(let st=0;st<ne.length;++st)xe[st]=et*(tt[st]+it[st])/2}else xe=ne.getChannelData(0);return xe}function hanning(ee){if(ee<1)return new Float64Array;if(ee===1)return new Float64Array([1]);const O=ee-1,Y=Math.PI/O,te=new Float64Array(ee);for(let ne=0;ne<ee;++ne){const xe=2*ne-O;te[ne]=.5+.5*Math.cos(Y*xe)}return te}const HERTZ_TO_MEL_MAPPING={htk:ee=>2595*Math.log10(1+ee/700),kaldi:ee=>1127*Math.log(1+ee/700),slaney:(ee,O=1e3,Y=15,te=27/Math.log(6.4))=>ee>=O?Y+Math.log(ee/O)*te:3*ee/200};function hertz_to_mel(ee,O="htk"){const Y=HERTZ_TO_MEL_MAPPING[O];if(!Y)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof ee=="number"?Y(ee):ee.map(te=>Y(te))}const MEL_TO_HERTZ_MAPPING={htk:ee=>700*(10**(ee/2595)-1),kaldi:ee=>700*(Math.exp(ee/1127)-1),slaney:(ee,O=1e3,Y=15,te=Math.log(6.4)/27)=>ee>=Y?O*Math.exp(te*(ee-Y)):200*ee/3};function mel_to_hertz(ee,O="htk"){const Y=MEL_TO_HERTZ_MAPPING[O];if(!Y)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof ee=="number"?Y(ee):ee.map(te=>Y(te))}function _create_triangular_filter_bank(ee,O){const Y=Float64Array.from({length:O.length-1},(et,tt)=>O[tt+1]-O[tt]),te=Array.from({length:ee.length},()=>new Array(O.length));for(let et=0;et<ee.length;++et){const tt=te[et];for(let it=0;it<O.length;++it)tt[it]=O[it]-ee[et]}const ne=O.length-2,xe=Array.from({length:ne},()=>new Array(ee.length));for(let et=0;et<ee.length;++et){const tt=te[et];for(let it=0;it<ne;++it){const st=-tt[it]/Y[it],ot=tt[it+2]/Y[it+1];xe[it][et]=Math.max(0,Math.min(st,ot))}}return xe}function linspace(ee,O,Y){const te=(O-ee)/(Y-1);return Float64Array.from({length:Y},(ne,xe)=>ee+te*xe)}function mel_filter_bank(ee,O,Y,te,ne,xe=null,et="htk",tt=!1){if(xe!==null&&xe!=="slaney")throw new Error('norm must be one of null or "slaney"');const it=hertz_to_mel(Y,et),st=hertz_to_mel(te,et),ot=linspace(it,st,O+2);let rt=mel_to_hertz(ot,et),nt;if(tt){const ct=ne/(ee*2);nt=hertz_to_mel(Float64Array.from({length:ee},(ut,dt)=>dt*ct),et),rt=ot}else nt=linspace(0,Math.floor(ne/2),ee);const at=_create_triangular_filter_bank(nt,rt);if(xe!==null&&xe==="slaney")for(let ct=0;ct<O;++ct){const ut=at[ct],dt=2/(rt[ct+2]-rt[ct]);for(let ht=0;ht<ee;++ht)ut[ht]*=dt}return at}function padReflect(ee,O,Y){const te=new ee.constructor(ee.length+O+Y),ne=ee.length-1;for(let xe=0;xe<ee.length;++xe)te[O+xe]=ee[xe];for(let xe=1;xe<=O;++xe)te[O-xe]=ee[calculateReflectOffset(xe,ne)];for(let xe=1;xe<=Y;++xe)te[ne+O+xe]=ee[calculateReflectOffset(ne-xe,ne)];return te}function _db_conversion_helper(ee,O,Y,te,ne){if(Y<=0)throw new Error("reference must be greater than zero");if(te<=0)throw new Error("min_value must be greater than zero");Y=Math.max(te,Y);const xe=Math.log10(Y);for(let et=0;et<ee.length;++et)ee[et]=O*Math.log10(Math.max(te,ee[et])-xe);if(ne!==null){if(ne<=0)throw new Error("db_range must be greater than zero");const et=max(ee)[0]-ne;for(let tt=0;tt<ee.length;++tt)ee[tt]=Math.max(ee[tt],et)}return ee}function amplitude_to_db(ee,O=1,Y=1e-5,te=null){return _db_conversion_helper(ee,20,O,Y,te)}function power_to_db(ee,O=1,Y=1e-10,te=null){return _db_conversion_helper(ee,10,O,Y,te)}function spectrogram(ee,O,Y,te,{fft_length:ne=null,power:xe=1,center:et=!0,pad_mode:tt="reflect",onesided:it=!0,preemphasis:st=null,mel_filters:ot=null,mel_floor:rt=1e-10,log_mel:nt=null,reference:at=1,min_value:ct=1e-10,db_range:ut=null,remove_dc_offset:dt=null,max_num_frames:ht=null,do_pad:pt=!0,transpose:ft=!1}={}){const mt=O.length;if(ne===null&&(ne=Y),Y>ne)throw Error(`frame_length (${Y}) may not be larger than fft_length (${ne})`);if(mt!==Y)throw new Error(`Length of the window (${mt}) must equal frame_length (${Y})`);if(te<=0)throw new Error("hop_length must be greater than zero");if(xe===null&&ot!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(et){if(tt!=="reflect")throw new Error(`pad_mode="${tt}" not implemented yet.`);const Pt=Math.floor((ne-1)/2)+1;ee=padReflect(ee,Pt,Pt)}const yt=Math.floor(1+Math.floor((ee.length-Y)/te)),bt=it?Math.floor(ne/2)+1:ne;let vt=yt,Et=yt;ht!==null&&(ht>yt?pt&&(Et=ht):Et=vt=ht);const wt=new FFT(ne),St=new Float64Array(ne),Ot=new Float64Array(wt.outputBufferSize),$t=new Array(vt);for(let Pt=0;Pt<vt;++Pt){const kt=Pt*te;for(let zt=0;zt<Y;++zt)St[zt]=ee[kt+zt];if(dt){let zt=0;for(let qt=0;qt<Y;++qt)zt+=St[qt];const Kt=zt/Y;for(let qt=0;qt<Y;++qt)St[qt]-=Kt}if(st!==null){for(let zt=Y-1;zt>=1;--zt)St[zt]-=st*St[zt-1];St[0]*=1-st}for(let zt=0;zt<O.length;++zt)St[zt]*=O[zt];wt.realTransform(Ot,St);const Wt=new Array(bt);for(let zt=0;zt<Wt.length;++zt){const Kt=zt<<1;Wt[zt]=Ot[Kt]**2+Ot[Kt+1]**2}$t[Pt]=Wt}if(xe!==null&&xe!==2){const Pt=2/xe;for(let kt=0;kt<$t.length;++kt){const Wt=$t[kt];for(let zt=0;zt<Wt.length;++zt)Wt[zt]**=Pt}}const Mt=ot.length,Nt=new Float32Array(Mt*Et),Rt=ft?[Et,Mt]:[Mt,Et];for(let Pt=0;Pt<Mt;++Pt){const kt=ot[Pt];for(let Wt=0;Wt<vt;++Wt){const zt=$t[Wt];let Kt=0;for(let qt=0;qt<bt;++qt)Kt+=kt[qt]*zt[qt];Nt[ft?Wt*Mt+Pt:Pt*vt+Wt]=Math.max(rt,Kt)}}if(xe!==null&&nt!==null){const Pt=Math.min(Nt.length,vt*Mt);switch(nt){case"log":for(let kt=0;kt<Pt;++kt)Nt[kt]=Math.log(Nt[kt]);break;case"log10":for(let kt=0;kt<Pt;++kt)Nt[kt]=Math.log10(Nt[kt]);break;case"dB":if(xe===1)amplitude_to_db(Nt,at,ct,ut);else if(xe===2)power_to_db(Nt,at,ct,ut);else throw new Error(`Cannot use log_mel option '${nt}' with power ${xe}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${nt}'`)}}return{data:Nt,dims:Rt}}function window_function(ee,O,{periodic:Y=!0,frame_length:te=null,center:ne=!0}={}){const xe=Y?ee+1:ee;let et;switch(O){case"boxcar":et=new Float64Array(xe).fill(1);break;case"hann":case"hann_window":et=hanning(xe);break;case"povey":et=hanning(xe).map(tt=>Math.pow(tt,.85));break;default:throw new Error(`Unknown window type ${O}.`)}if(Y&&(et=et.subarray(0,ee)),te===null)return et;if(ee>te)throw new Error(`Length of the window (${ee}) may not be larger than frame_length (${te})`);return et}function center_to_corners_format([ee,O,Y,te]){return[ee-Y/2,O-te/2,ee+Y/2,O+te/2]}function post_process_object_detection(ee,O=.5,Y=null,te=!1){const ne=ee.logits,xe=ee.pred_boxes,[et,tt,it]=ne.dims;if(Y!==null&&Y.length!==et)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let st=[];for(let ot=0;ot<et;++ot){let rt=Y!==null?Y[ot]:null,nt={boxes:[],classes:[],scores:[]},at=ne[ot],ct=xe[ot];for(let ut=0;ut<tt;++ut){let dt=at[ut],ht=[],pt;if(te){pt=dt.sigmoid().data;for(let ft=0;ft<pt.length;++ft)pt[ft]>O&&ht.push(ft)}else{let ft=max(dt.data)[1];if(ft===it-1)continue;ht.push(ft),pt=softmax(dt.data)}for(const ft of ht){let mt=ct[ut].data;mt=center_to_corners_format(mt),rt!==null&&(mt=mt.map((yt,bt)=>yt*rt[(bt+1)%2])),nt.boxes.push(mt),nt.classes.push(ft),nt.scores.push(pt[ft])}}st.push(nt)}return st}function validate_audio_inputs(ee,O){if(!(ee instanceof Float32Array||ee instanceof Float64Array))throw new Error(`${O} expects input to be a Float32Array or a Float64Array, but got ${ee?.constructor?.name??typeof ee} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function constraint_to_multiple_of(ee,O,Y=0,te=null){const ne=ee/O;let xe=bankers_round(ne)*O;return te!==null&&xe>te&&(xe=Math.floor(ne)*O),xe<Y&&(xe=Math.ceil(ne)*O),xe}function enforce_size_divisibility([ee,O],Y){return[Math.max(Math.floor(ee/Y),1)*Y,Math.max(Math.floor(O/Y),1)*Y]}class FeatureExtractor extends Callable{constructor(O){super(),this.config=O}}class ImageFeatureExtractor extends FeatureExtractor{constructor(O){super(O),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??!1}async thumbnail(O,Y,te=2){const ne=O.height,xe=O.width,et=Y.height,tt=Y.width;let it=Math.min(ne,et),st=Math.min(xe,tt);return it===ne&&st===xe?O:(ne>xe?st=Math.floor(xe*it/ne):xe>ne&&(it=Math.floor(ne*st/xe)),await O.resize(st,it,{resample:te}))}async crop_margin(O,Y=200){const te=O.clone().grayscale(),ne=min(te.data)[0],et=max(te.data)[0]-ne;if(et===0)return O;const tt=Y/255;let it=te.width,st=te.height,ot=0,rt=0;for(let nt=0;nt<te.height;++nt){const at=nt*te.width;for(let ct=0;ct<te.width;++ct)(te.data[at+ct]-ne)/et<tt&&(it=Math.min(it,ct),st=Math.min(st,nt),ot=Math.max(ot,ct),rt=Math.max(rt,nt))}return O=await O.crop([it,st,ot,rt]),O}pad_image(O,Y,te,{mode:ne="constant",center:xe=!1,constant_values:et=0}={}){const[tt,it,st]=Y;let ot,rt;if(typeof te=="number"?(ot=te,rt=te):(ot=te.width,rt=te.height),ot!==it||rt!==tt){const nt=new Float32Array(ot*rt*st);if(Array.isArray(et))for(let ut=0;ut<nt.length;++ut)nt[ut]=et[ut%st];else et!==0&&nt.fill(et);const[at,ct]=xe?[Math.floor((ot-it)/2),Math.floor((rt-tt)/2)]:[0,0];for(let ut=0;ut<tt;++ut){const dt=(ut+ct)*ot,ht=ut*it;for(let pt=0;pt<it;++pt){const ft=(dt+pt+at)*st,mt=(ht+pt)*st;for(let yt=0;yt<st;++yt)nt[ft+yt]=O[mt+yt]}}if(ne==="symmetric"){if(xe)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const ut=tt-1,dt=it-1;for(let ht=0;ht<rt;++ht){const pt=ht*ot,ft=calculateReflectOffset(ht,ut)*it;for(let mt=0;mt<ot;++mt){if(ht<tt&&mt<it)continue;const yt=(pt+mt)*st,bt=(ft+calculateReflectOffset(mt,dt))*st;for(let vt=0;vt<st;++vt)nt[yt+vt]=O[bt+vt]}}}O=nt,Y=[rt,ot,st]}return[O,Y]}rescale(O){for(let Y=0;Y<O.length;++Y)O[Y]=this.rescale_factor*O[Y]}get_resize_output_image_size(O,Y){const[te,ne]=O.size;let xe,et;if(this.do_thumbnail){const{height:tt,width:it}=Y;xe=Math.min(tt,it)}else Number.isInteger(Y)?(xe=Y,et=this.config.max_size??xe):Y!==void 0&&(xe=Y.shortest_edge,et=Y.longest_edge);if(xe!==void 0||et!==void 0){const tt=xe===void 0?1:Math.max(xe/te,xe/ne),it=te*tt,st=ne*tt,ot=et===void 0?1:Math.min(et/it,et/st);let rt=Math.floor(Number((it*ot).toFixed(2))),nt=Math.floor(Number((st*ot).toFixed(2)));return this.size_divisibility!==void 0&&([rt,nt]=enforce_size_divisibility([rt,nt],this.size_divisibility)),[rt,nt]}else if(Y!==void 0&&Y.width!==void 0&&Y.height!==void 0){let tt=Y.width,it=Y.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let st=it/ne,ot=tt/te;Math.abs(1-ot)<Math.abs(1-st)?st=ot:ot=st,it=constraint_to_multiple_of(st*ne,this.config.ensure_multiple_of),tt=constraint_to_multiple_of(ot*te,this.config.ensure_multiple_of)}return[tt,it]}else{if(this.size_divisibility!==void 0)return enforce_size_divisibility([te,ne],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(Y)}`)}}async resize(O){const[Y,te]=this.get_resize_output_image_size(O,this.size);return await O.resize(Y,te,{resample:this.resample})}async preprocess(O,{do_normalize:Y=null,do_pad:te=null,do_convert_rgb:ne=null,do_convert_grayscale:xe=null,do_flip_channel_order:et=null}={}){this.do_crop_margin&&(O=await this.crop_margin(O));const[tt,it]=O.size;if(ne??this.do_convert_rgb?O=O.rgb():xe&&(O=O.grayscale()),this.do_resize&&(O=await this.resize(O)),this.do_thumbnail&&(O=await this.thumbnail(O,this.size,this.resample)),this.do_center_crop){let at,ct;Number.isInteger(this.crop_size)?(at=this.crop_size,ct=this.crop_size):(at=this.crop_size.width,ct=this.crop_size.height),O=await O.center_crop(at,ct)}const st=[O.height,O.width];let ot=Float32Array.from(O.data),rt=[O.height,O.width,O.channels];if(this.do_rescale&&this.rescale(ot),Y??this.do_normalize){let at=this.image_mean;Array.isArray(this.image_mean)||(at=new Array(O.channels).fill(at));let ct=this.image_std;if(Array.isArray(this.image_std)||(ct=new Array(O.channels).fill(at)),at.length!==O.channels||ct.length!==O.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${at.length}) and \`image_std\` (${ct.length}) must match the number of channels in the image (${O.channels}).`);for(let ut=0;ut<ot.length;ut+=O.channels)for(let dt=0;dt<O.channels;++dt)ot[ut+dt]=(ot[ut+dt]-at[dt])/ct[dt]}if(te??this.do_pad){if(this.pad_size)[ot,rt]=this.pad_image(ot,[O.height,O.width,O.channels],this.pad_size);else if(this.size_divisibility){const[at,ct]=enforce_size_divisibility([rt[1],rt[0]],this.size_divisibility);[ot,rt]=this.pad_image(ot,rt,{width:at,height:ct})}}if(et??this.do_flip_channel_order){if(rt[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let at=0;at<ot.length;at+=3){const ct=ot[at];ot[at]=ot[at+2],ot[at+2]=ct}}const nt=new Tensor("float32",ot,rt).permute(2,0,1);return{original_size:[it,tt],reshaped_input_size:st,pixel_values:nt}}async _call(O,...Y){Array.isArray(O)||(O=[O]);const te=await Promise.all(O.map(xe=>this.preprocess(xe)));return{pixel_values:stack(te.map(xe=>xe.pixel_values),0),original_sizes:te.map(xe=>xe.original_size),reshaped_input_sizes:te.map(xe=>xe.reshaped_input_size)}}}class SegformerFeatureExtractor extends ImageFeatureExtractor{post_process_semantic_segmentation(O,Y=null){const te=O.logits,ne=te.dims[0];if(Y!==null&&Y.length!==ne)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const xe=[];for(let et=0;et<ne;++et){const tt=Y!==null?Y[et]:null;let it=te[et];tt!==null&&(it=interpolate(it,tt,"bilinear",!1));const[st,ot]=tt??it.dims.slice(-2),rt=new Tensor("int32",new Int32Array(st*ot),[st,ot]),nt=it[0].data;for(let dt=1;dt<it.dims[0];++dt){const ht=it[dt].data;for(let pt=0;pt<ht.length;++pt)ht[pt]>nt[pt]&&(nt[pt]=ht[pt],rt.data[pt]=dt)}const at=new Array(it.dims[0]),ct=rt.data;for(let dt=0;dt<ct.length;++dt){const ht=ct[dt];at[ht]=ht}const ut=at.filter(dt=>dt!==void 0);xe.push({segmentation:rt,labels:ut})}return xe}}class DPTFeatureExtractor extends ImageFeatureExtractor{}class DPTImageProcessor extends DPTFeatureExtractor{}class BitImageProcessor extends ImageFeatureExtractor{}class GLPNFeatureExtractor extends ImageFeatureExtractor{}class CLIPFeatureExtractor extends ImageFeatureExtractor{}class ChineseCLIPFeatureExtractor extends ImageFeatureExtractor{}class SiglipImageProcessor extends ImageFeatureExtractor{}class ConvNextFeatureExtractor extends ImageFeatureExtractor{constructor(O){super(O),this.crop_pct=this.config.crop_pct??224/256}async resize(O){const Y=this.size?.shortest_edge;if(Y===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(Y<384){const te=Math.floor(Y/this.crop_pct),[ne,xe]=this.get_resize_output_image_size(O,{shortest_edge:te});O=await O.resize(ne,xe,{resample:this.resample}),O=await O.center_crop(Y,Y)}else O=await O.resize(Y,Y,{resample:this.resample});return O}}class ConvNextImageProcessor extends ConvNextFeatureExtractor{}class ViTFeatureExtractor extends ImageFeatureExtractor{}class ViTImageProcessor extends ImageFeatureExtractor{}class EfficientNetImageProcessor extends ImageFeatureExtractor{constructor(O){super(O),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(Y=>Y*Y))}}class MobileViTFeatureExtractor extends ImageFeatureExtractor{}class MobileViTImageProcessor extends MobileViTFeatureExtractor{}class OwlViTFeatureExtractor extends ImageFeatureExtractor{post_process_object_detection(...O){return post_process_object_detection(...O)}}class Owlv2ImageProcessor extends OwlViTFeatureExtractor{}class DeiTFeatureExtractor extends ImageFeatureExtractor{}class BeitFeatureExtractor extends ImageFeatureExtractor{}class DonutFeatureExtractor extends ImageFeatureExtractor{pad_image(O,Y,te,ne={}){const[xe,et,tt]=Y;let it=this.image_mean;Array.isArray(this.image_mean)||(it=new Array(tt).fill(it));let st=this.image_std;Array.isArray(st)||(st=new Array(tt).fill(it));const ot=it.map((rt,nt)=>-rt/st[nt]);return super.pad_image(O,Y,te,{center:!0,constant_values:ot,...ne})}}class NougatImageProcessor extends DonutFeatureExtractor{}class DetrFeatureExtractor extends ImageFeatureExtractor{async _call(O){const Y=await super._call(O),te=[Y.pixel_values.dims[0],64,64],ne=new Tensor("int64",new BigInt64Array(te.reduce((xe,et)=>xe*et)).fill(1n),te);return{...Y,pixel_mask:ne}}post_process_object_detection(...O){return post_process_object_detection(...O)}remove_low_and_no_objects(O,Y,te,ne){let xe=[],et=[],tt=[];for(let it=0;it<O.dims[0];++it){let st=O[it],ot=Y[it],rt=max(st.data)[1];if(rt===ne)continue;let at=softmax(st.data)[rt];at>te&&(xe.push(ot),et.push(at),tt.push(rt))}return[xe,et,tt]}check_segment_validity(O,Y,te,ne=.5,xe=.8){let et=[],tt=0,it=0;for(let ot=0;ot<O.length;++ot)O[ot]===te&&(et.push(ot),++tt),Y[te].data[ot]>=ne&&++it;let st=tt>0&&it>0;return st&&(st=tt/it>xe),[st,et]}compute_segments(O,Y,te,ne,xe,et=null,tt=null){let[it,st]=tt??O[0].dims,ot=new Tensor("int32",new Int32Array(it*st),[it,st]),rt=[];if(tt!==null)for(let ut=0;ut<O.length;++ut)O[ut]=interpolate(O[ut],tt,"bilinear",!1);let nt=new Int32Array(O[0].data.length),at=new Float32Array(O[0].data.length);for(let ut=0;ut<O.length;++ut){let dt=Y[ut];for(let ht=0;ht<O[ut].data.length;++ht)O[ut].data[ht]*=dt,O[ut].data[ht]>at[ht]&&(nt[ht]=ut,at[ht]=O[ut].data[ht])}let ct=0;for(let ut=0;ut<te.length;++ut){let dt=te[ut],[ht,pt]=this.check_segment_validity(nt,O,ut,ne,xe);if(ht){++ct;for(let ft of pt)ot.data[ft]=ct;rt.push({id:ct,label_id:dt,score:Y[ut]})}}return[ot,rt]}post_process_panoptic_segmentation(O,Y=.5,te=.5,ne=.8,xe=null,et=null){xe===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),xe=new Set);const tt=O.logits,st=O.pred_masks.sigmoid();let[ot,rt,nt]=tt.dims;if(nt-=1,et!==null&&et.length!==ot)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let at=[];for(let ct=0;ct<ot;++ct){let ut=et!==null?et[ct]:null,dt=tt[ct],ht=st[ct],[pt,ft,mt]=this.remove_low_and_no_objects(dt,ht,Y,nt);if(mt.length===0){let[vt,Et]=ut??ht.dims.slice(-2),wt=new Tensor("int32",new Int32Array(vt*Et).fill(-1),[vt,Et]);at.push({segmentation:wt,segments_info:[]});continue}let[yt,bt]=this.compute_segments(pt,ft,mt,te,ne,xe,ut);at.push({segmentation:yt,segments_info:bt})}return at}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class YolosFeatureExtractor extends ImageFeatureExtractor{post_process_object_detection(...O){return post_process_object_detection(...O)}}class SamImageProcessor extends ImageFeatureExtractor{reshape_input_points(O,Y,te){O=structuredClone(O);let ne=calculateDimensions(O);if(ne.length===3)ne=[1,...ne],O=[O];else if(ne.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let xe=0;xe<O.length;++xe){let et=Y[xe],tt=te[xe],it=[tt[0]/et[0],tt[1]/et[1]];for(let st=0;st<O[xe].length;++st)for(let ot=0;ot<O[xe][st].length;++ot)for(let rt=0;rt<O[xe][st][ot].length;++rt)O[xe][st][ot][rt]*=it[rt]}return new Tensor("float32",Float32Array.from(O.flat(1/0)),ne)}add_input_labels(O,Y){let te=calculateDimensions(O);if(te.length===2)te=[1,...te],O=[O];else if(te.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(te.some((ne,xe)=>ne!==Y.dims[xe]))throw Error(`The first ${te.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new Tensor("int64",O.flat(1/0).map(BigInt),te)}async _call(O,Y=null,te=null){const ne=await super._call(O);if(Y&&(ne.input_points=this.reshape_input_points(Y,ne.original_sizes,ne.reshaped_input_sizes)),te){if(!ne.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");ne.input_labels=this.add_input_labels(te,ne.input_points)}return ne}post_process_masks(O,Y,te,{mask_threshold:ne=0,binarize:xe=!0,pad_size:et=null}={}){const tt=[];et=et??this.pad_size;const it=[et.height,et.width];for(let st=0;st<Y.length;++st){const ot=Y[st],rt=te[st],nt=O[st],at=[];for(let ct=0;ct<nt.dims[0];++ct){const ut=nt[ct];let dt=interpolate(ut,it,"bilinear",!1);if(dt=dt.slice(null,[0,rt[0]],[0,rt[1]]),dt=interpolate(dt,ot,"bilinear",!1),xe){const ht=new Uint8Array(dt.data.length);for(let pt=0;pt<dt.data.length;++pt)dt.data[pt]>ne&&(ht[pt]=1);dt=new Tensor("bool",ht,dt.dims)}at.push(dt)}tt.push(stack(at))}return tt}}class Swin2SRImageProcessor extends ImageFeatureExtractor{pad_image(O,Y,te,ne={}){const[xe,et,tt]=Y;return super.pad_image(O,Y,{width:et+(te-et%te)%te,height:xe+(te-xe%te)%te},{mode:"symmetric",center:!1,constant_values:-1,...ne})}}class VitMatteImageProcessor extends ImageFeatureExtractor{async _call(O,Y){Array.isArray(O)||(O=[O]),Array.isArray(Y)||(Y=[Y]);const te=await Promise.all(O.map(et=>this.preprocess(et))),ne=await Promise.all(Y.map(et=>this.preprocess(et,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:stack(te.map((et,tt)=>cat([et.pixel_values,ne[tt].pixel_values],0)),0),original_sizes:te.map(et=>et.original_size),reshaped_input_sizes:te.map(et=>et.reshaped_input_size)}}}class WhisperFeatureExtractor extends FeatureExtractor{constructor(O){super(O),this.config.mel_filters??=mel_filter_bank(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=window_function(this.config.n_fft,"hann")}_extract_fbank_features(O){const{data:Y,dims:te}=spectrogram(O,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),ne=max(Y)[0];for(let xe=0;xe<Y.length;++xe)Y[xe]=(Math.max(Y[xe],ne-8)+4)/4;return{data:Y,dims:te}}async _call(O){validate_audio_inputs(O,"WhisperFeatureExtractor");let Y;O.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),Y=O.slice(0,this.config.n_samples)):(Y=new Float32Array(this.config.n_samples),Y.set(O));const{data:te,dims:ne}=this._extract_fbank_features(Y);return{input_features:new Tensor("float32",te,[1,...ne])}}}class Wav2Vec2FeatureExtractor extends FeatureExtractor{_zero_mean_unit_var_norm(O){const te=O.reduce((xe,et)=>xe+et,0)/O.length,ne=O.reduce((xe,et)=>xe+(et-te)**2,0)/O.length;return O.map(xe=>(xe-te)/Math.sqrt(ne+1e-7))}async _call(O){validate_audio_inputs(O,"Wav2Vec2FeatureExtractor"),O instanceof Float64Array&&(O=new Float32Array(O));let Y=O;this.config.do_normalize&&(Y=this._zero_mean_unit_var_norm(Y));const te=[1,Y.length];return{input_values:new Tensor("float32",Y,te),attention_mask:new Tensor("int64",new BigInt64Array(Y.length).fill(1n),te)}}}class SeamlessM4TFeatureExtractor extends FeatureExtractor{constructor(O){super(O);const Y=this.config.sampling_rate,te=mel_filter_bank(256,this.config.num_mel_bins,20,Math.floor(Y/2),Y,null,"kaldi",!0);for(let ne=0;ne<te.length;++ne)te[ne].push(0);this.mel_filters=te,this.window=window_function(400,"povey",{periodic:!1})}_extract_fbank_features(O,Y){return O=O.map(te=>te*32768),spectrogram(O,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:Y,transpose:!0})}async _call(O,{padding:Y=!0,pad_to_multiple_of:te=2,do_normalize_per_mel_bins:ne=!0,return_attention_mask:xe=!0}={}){validate_audio_inputs(O,"SeamlessM4TFeatureExtractor");let et=this._extract_fbank_features(O,this.config.max_length);if(ne){const[ct,ut]=et.dims;for(let dt=0;dt<ut;++dt){let ht=0;for(let yt=0;yt<ct;++yt)ht+=et.data[yt*ut+dt];const pt=ht/ct;let ft=0;for(let yt=0;yt<ct;++yt)ft+=(et.data[yt*ut+dt]-pt)**2;ft/=ct-1;const mt=Math.sqrt(ft+1e-7);for(let yt=0;yt<ct;++yt){const bt=yt*ut+dt;et.data[bt]=(et.data[bt]-pt)/mt}}}let tt;if(Y){const[ct,ut]=et.dims,dt=ct%te;if(dt>0){const ht=new Float32Array(ut*(ct+dt));ht.set(et.data),ht.fill(this.config.padding_value,et.data.length);const pt=ct+dt;et={data:ht,dims:[pt,ut]},xe&&(tt=new Tensor("int64",new BigInt64Array(pt),[1,pt]),tt.data.fill(1n,0,ct))}}const[it,st]=et.dims,ot=this.config.stride;if(it%ot!==0)throw new Error(`The number of frames (${it}) must be a multiple of the stride (${ot}).`);const nt=new Tensor("float32",et.data,et.dims).view(1,Math.floor(it/ot),st*ot),at={input_features:nt};if(xe){const ct=nt.dims[1],ut=new Tensor("int64",new BigInt64Array(ct),[1,ct]);if(tt)for(let dt=1,ht=0;dt<it;dt+=ot,++ht)ut.data[ht]=tt.data[dt];else ut.data.fill(1n);at.attention_mask=ut}return at}}class ASTFeatureExtractor extends FeatureExtractor{constructor(O){super(O);const Y=this.config.sampling_rate,te=mel_filter_bank(256,this.config.num_mel_bins,20,Math.floor(Y/2),Y,null,"kaldi",!0);for(let ne=0;ne<te.length;++ne)te[ne].push(0);this.mel_filters=te,this.window=window_function(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}_extract_fbank_features(O,Y){return spectrogram(O,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:Y,transpose:!0})}async _call(O){validate_audio_inputs(O,"ASTFeatureExtractor");const Y=this._extract_fbank_features(O,this.config.max_length);if(this.config.do_normalize){const te=this.std*2;for(let ne=0;ne<Y.data.length;++ne)Y.data[ne]=(Y.data[ne]-this.mean)/te}return{input_values:new Tensor("float32",Y.data,[1,...Y.dims])}}}class ClapFeatureExtractor extends FeatureExtractor{constructor(O){super(O),this.mel_filters=mel_filter_bank(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=mel_filter_bank(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=window_function(this.config.fft_window_size,"hann")}_get_input_mel(O,Y,te,ne){let xe,et=!1;const tt=O.length-Y;if(tt>0)if(te==="rand_trunc"){et=!0;const it=Math.floor(Math.random()*(tt+1));O=O.subarray(it,it+Y),xe=this._extract_fbank_features(O,this.mel_filters_slaney,this.config.nb_max_samples),xe.dims=[1,...xe.dims]}else throw new Error(`Truncation strategy "${te}" not implemented`);else{if(tt<0){let it=new Float64Array(Y);if(it.set(O),ne==="repeat")for(let st=O.length;st<Y;st+=O.length)it.set(O.subarray(0,Math.min(O.length,Y-st)),st);else if(ne==="repeatpad")for(let st=O.length;st<-tt;st+=O.length)it.set(O,st);O=it}if(te==="fusion")throw new Error(`Truncation strategy "${te}" not implemented`);xe=this._extract_fbank_features(O,this.mel_filters_slaney,this.config.nb_max_samples),xe.dims=[1,...xe.dims]}return{...xe,longer:et}}_extract_fbank_features(O,Y,te=null){return spectrogram(O,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:Y,log_mel:"dB",max_num_frames:te,do_pad:!1,transpose:!0})}async _call(O,{max_length:Y=null}={}){validate_audio_inputs(O,"ClapFeatureExtractor");const te=this._get_input_mel(O,Y??this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new Tensor("float32",te.data,[1,...te.dims])}}}class SpeechT5FeatureExtractor extends FeatureExtractor{}let Processor$1=class extends Callable{constructor(O){super(),this.feature_extractor=O}async _call(O,...Y){return await this.feature_extractor(O,...Y)}};class SamProcessor extends Processor$1{async _call(...O){return await this.feature_extractor(...O)}post_process_masks(...O){return this.feature_extractor.post_process_masks(...O)}reshape_input_points(...O){return this.feature_extractor.reshape_input_points(...O)}}class WhisperProcessor extends Processor$1{async _call(O){return await this.feature_extractor(O)}}class Wav2Vec2ProcessorWithLM extends Processor$1{async _call(O){return await this.feature_extractor(O)}}class SpeechT5Processor extends Processor$1{async _call(O){return await this.feature_extractor(O)}}class OwlViTProcessor extends Processor$1{}class AutoProcessor{static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor,WhisperFeatureExtractor,ViTFeatureExtractor,MobileViTFeatureExtractor,MobileViTImageProcessor,OwlViTFeatureExtractor,Owlv2ImageProcessor,CLIPFeatureExtractor,ChineseCLIPFeatureExtractor,SiglipImageProcessor,ConvNextFeatureExtractor,ConvNextImageProcessor,SegformerFeatureExtractor,BitImageProcessor,DPTImageProcessor,DPTFeatureExtractor,GLPNFeatureExtractor,BeitFeatureExtractor,DeiTFeatureExtractor,DetrFeatureExtractor,YolosFeatureExtractor,DonutFeatureExtractor,NougatImageProcessor,EfficientNetImageProcessor,ViTImageProcessor,VitMatteImageProcessor,SamImageProcessor,Swin2SRImageProcessor,Wav2Vec2FeatureExtractor,SeamlessM4TFeatureExtractor,SpeechT5FeatureExtractor,ASTFeatureExtractor,ClapFeatureExtractor};static PROCESSOR_CLASS_MAPPING={WhisperProcessor,Wav2Vec2ProcessorWithLM,SamProcessor,SpeechT5Processor,OwlViTProcessor};static async from_pretrained(O,{progress_callback:Y=null,config:te=null,cache_dir:ne=null,local_files_only:xe=!1,revision:et="main"}={}){let tt=te??await getModelJSON(O,"preprocessor_config.json",!0,{progress_callback:Y,cache_dir:ne,local_files_only:xe,revision:et}),it=tt.feature_extractor_type??tt.image_processor_type,st=this.FEATURE_EXTRACTOR_CLASS_MAPPING[it];if(!st)if(tt.size!==void 0)console.warn(`Feature extractor type "${it}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),st=ImageFeatureExtractor;else throw new Error(`Unknown Feature Extractor type: ${it}`);let ot=this.PROCESSOR_CLASS_MAPPING[tt.processor_class]??Processor$1,rt=new st(tt);return new ot(rt)}}async function prepareImages(ee){return Array.isArray(ee)||(ee=[ee]),await Promise.all(ee.map(O=>RawImage.read(O)))}async function prepareAudios(ee,O){return Array.isArray(ee)||(ee=[ee]),await Promise.all(ee.map(Y=>typeof Y=="string"||Y instanceof URL?read_audio(Y,O):Y instanceof Float64Array?new Float32Array(Y):Y))}function get_bounding_box(ee,O){O&&(ee=ee.map(et=>et|0));const[Y,te,ne,xe]=ee;return{xmin:Y,ymin:te,xmax:ne,ymax:xe}}class Pipeline extends Callable{constructor({task:O,model:Y,tokenizer:te=null,processor:ne=null}){super(),this.task=O,this.model=Y,this.tokenizer=te,this.processor=ne}async dispose(){await this.model.dispose()}}class TextClassificationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{topk:Y=1}={}){const te=this.tokenizer(O,{padding:!0,truncation:!0}),ne=await this.model(te),xe=this.model.config.problem_type==="multi_label_classification"?it=>it.sigmoid().data:it=>softmax(it.data),et=this.model.config.id2label,tt=[];for(const it of ne.logits){const st=xe(it),rt=getTopItems(st,Y).map(nt=>({label:et[nt[0]],score:nt[1]}));Y===1?tt.push(...rt):tt.push(rt)}return Array.isArray(O)||Y===1?tt:tt[0]}}class TokenClassificationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{ignore_labels:Y=["O"]}={}){const te=Array.isArray(O),ne=this.tokenizer(te?O:[O],{padding:!0,truncation:!0}),et=(await this.model(ne)).logits,tt=this.model.config.id2label,it=[];for(let st=0;st<et.dims[0];++st){const ot=ne.input_ids[st],rt=et[st],nt=[];for(let at=0;at<rt.dims[0];++at){const ct=rt[at],ut=max(ct.data)[1],dt=tt?tt[ut]:`LABEL_${ut}`;if(Y.includes(dt))continue;const ht=this.tokenizer.decode([ot[at].item()],{skip_special_tokens:!0});if(ht==="")continue;const pt=softmax(ct.data);nt.push({entity:dt,score:pt[ut],index:at,word:ht,start:null,end:null})}it.push(nt)}return te?it:it[0]}}class QuestionAnsweringPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y,{topk:te=1}={}){const ne=this.tokenizer(O,{text_pair:Y,padding:!0,truncation:!0}),xe=await this.model(ne),et=[];for(let tt=0;tt<xe.start_logits.dims[0];++tt){const it=ne.input_ids[tt],st=it.indexOf(this.tokenizer.sep_token_id),ot=Array.from(softmax(xe.start_logits[tt].data)).map((at,ct)=>[at,ct]).filter(at=>at[1]>st),rt=Array.from(softmax(xe.end_logits[tt].data)).map((at,ct)=>[at,ct]).filter(at=>at[1]>st),nt=product(ot,rt).filter(at=>at[0][1]<=at[1][1]).map(at=>[at[0][1],at[1][1],at[0][0]*at[1][0]]).sort((at,ct)=>ct[2]-at[2]);for(let at=0;at<Math.min(nt.length,te);++at){const[ct,ut,dt]=nt[at],ht=[...it].slice(ct,ut+1),pt=this.tokenizer.decode(ht,{skip_special_tokens:!0});et.push({answer:pt,score:dt})}}return te===1?et[0]:et}}class FillMaskPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{topk:Y=5}={}){const te=this.tokenizer(O,{padding:!0,truncation:!0}),ne=await this.model(te),xe=[];for(let et=0;et<te.input_ids.dims[0];++et){const tt=te.input_ids[et],it=tt.indexOf(this.tokenizer.mask_token_id);if(it===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const ot=ne.logits[et][it],rt=getTopItems(softmax(ot.data),Y);xe.push(rt.map(nt=>{const at=[...tt];return at[it]=nt[0],{score:nt[1],token:nt[0],token_str:this.tokenizer.model.vocab[nt[0]],sequence:this.tokenizer.decode(at,{skip_special_tokens:!0})}}))}return Array.isArray(O)?xe:xe[0]}}class Text2TextGenerationPipeline extends Pipeline{_key="generated_text";constructor(O){super(O)}async _call(O,Y={}){Array.isArray(O)||(O=[O]),this.model.config.prefix&&(O=O.map(it=>this.model.config.prefix+it));const te=this.model.config.task_specific_params;te&&te[this.task]&&te[this.task].prefix&&(O=O.map(it=>te[this.task].prefix+it));const ne=this.tokenizer,xe={padding:!0,truncation:!0};let et;this instanceof TranslationPipeline&&"_build_translation_inputs"in ne?et=ne._build_translation_inputs(O,xe,Y).input_ids:et=ne(O,xe).input_ids;const tt=await this.model.generate(et,Y);return ne.batch_decode(tt,{skip_special_tokens:!0}).map(it=>({[this._key]:it}))}}class SummarizationPipeline extends Text2TextGenerationPipeline{_key="summary_text";constructor(O){super(O)}}class TranslationPipeline extends Text2TextGenerationPipeline{_key="translation_text";constructor(O){super(O)}}function isChat(ee){return Array.isArray(ee)&&ee.every(O=>"role"in O&&"content"in O)}class TextGenerationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y={}){let te=!1,ne=!1,xe;if(typeof O=="string")xe=O=[O];else if(Array.isArray(O)&&O.every(ct=>typeof ct=="string"))te=!0,xe=O;else{if(isChat(O))O=[O];else if(Array.isArray(O)&&O.every(isChat))te=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");ne=!0,xe=O.map(ct=>this.tokenizer.apply_chat_template(ct,{tokenize:!1,add_generation_prompt:!0}))}const et=Y.add_special_tokens??!1,tt=ne?!1:Y.return_full_text??!0;this.tokenizer.padding_side="left";const{input_ids:it,attention_mask:st}=this.tokenizer(xe,{add_special_tokens:et,padding:!0,truncation:!0}),ot=await this.model.generate(it,Y,null,{inputs_attention_mask:st});let rt=this.tokenizer.batch_decode(ot,{skip_special_tokens:!0}),nt;!tt&&it.dims.at(-1)>0&&(nt=this.tokenizer.batch_decode(it,{skip_special_tokens:!0}).map(ct=>ct.length));const at=Array.from({length:O.length},ct=>[]);for(let ct=0;ct<rt.length;++ct){const ut=Math.floor(ct/ot.length*O.length);nt&&(rt[ct]=rt[ct].slice(nt[ut])),at[ut].push({generated_text:ne?[...O[ut],{role:"assistant",content:rt[ct]}]:rt[ct]})}return!te&&at.length===1?at[0]:at}}class ZeroShotClassificationPipeline extends Pipeline{constructor(O){super(O),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([Y,te])=>[Y.toLowerCase(),te])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(O,Y,{hypothesis_template:te="This example is {}.",multi_label:ne=!1}={}){const xe=Array.isArray(O);xe||(O=[O]),Array.isArray(Y)||(Y=[Y]);const et=Y.map(st=>te.replace("{}",st)),tt=ne||Y.length===1,it=[];for(const st of O){const ot=[];for(const at of et){const ct=this.tokenizer(st,{text_pair:at,padding:!0,truncation:!0}),ut=await this.model(ct);tt?ot.push([ut.logits.data[this.contradiction_id],ut.logits.data[this.entailment_id]]):ot.push(ut.logits.data[this.entailment_id])}const nt=(tt?ot.map(at=>softmax(at)[1]):softmax(ot)).map((at,ct)=>[at,ct]).sort((at,ct)=>ct[0]-at[0]);it.push({sequence:st,labels:nt.map(at=>Y[at[1]]),scores:nt.map(at=>at[0])})}return xe?it:it[0]}}class FeatureExtractionPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{pooling:Y="none",normalize:te=!1,quantize:ne=!1,precision:xe="binary"}={}){const et=this.tokenizer(O,{padding:!0,truncation:!0}),tt=await this.model(et);let it=tt.last_hidden_state??tt.logits??tt.token_embeddings;if(Y!=="none")if(Y==="mean")it=mean_pooling(it,et.attention_mask);else if(Y==="cls")it=it.slice(null,0);else throw Error(`Pooling method '${Y}' not supported.`);return te&&(it=it.normalize(2,-1)),ne&&(it=quantize_embeddings(it,xe)),it}}class ImageFeatureExtractionPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{pool:Y=null}={}){const te=await prepareImages(O),{pixel_values:ne}=await this.processor(te),xe=await this.model({pixel_values:ne});let et;if(Y){if(!("pooler_output"in xe))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");et=xe.pooler_output}else et=xe.last_hidden_state??xe.logits??xe.image_embeds;return et}}class AudioClassificationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{topk:Y=null}={}){const te=!Array.isArray(O),ne=this.processor.feature_extractor.config.sampling_rate,xe=await prepareAudios(O,ne),et=this.model.config.id2label,tt=[];for(const it of xe){const st=await this.processor(it),rt=(await this.model(st)).logits[0],at=getTopItems(softmax(rt.data),Y).map(ct=>({label:et[ct[0]],score:ct[1]}));Y===1?tt.push(...at):tt.push(at)}return!te||Y===1?tt:tt[0]}}class ZeroShotAudioClassificationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y,{hypothesis_template:te="This is a sound of {}."}={}){const ne=!Array.isArray(O);ne&&(O=[O]);const xe=Y.map(ot=>te.replace("{}",ot)),et=this.tokenizer(xe,{padding:!0,truncation:!0}),tt=this.processor.feature_extractor.config.sampling_rate,it=await prepareAudios(O,tt),st=[];for(const ot of it){const rt=await this.processor(ot),nt=await this.model({...et,...rt}),at=softmax(nt.logits_per_audio.data);st.push([...at].map((ct,ut)=>({score:ct,label:Y[ut]})))}return ne?st[0]:st}}class AutomaticSpeechRecognitionPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(O,Y);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(O,Y);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(O,Y={}){Y.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),Y.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const te=!Array.isArray(O);te&&(O=[O]);const ne=this.processor.feature_extractor.config.sampling_rate,xe=await prepareAudios(O,ne),et=[];for(const tt of xe){const it=await this.processor(tt),ot=(await this.model(it)).logits[0],rt=[];for(const at of ot)rt.push(max(at.data)[1]);const nt=this.tokenizer.decode(rt);et.push({text:nt})}return te?et[0]:et}async _call_whisper(O,Y={}){const te=Y.return_timestamps??!1,ne=Y.chunk_length_s??0,xe=Y.chunk_callback??null,et=Y.force_full_sequences??!1;let tt=Y.stride_length_s??null;te==="word"&&(Y.return_token_timestamps=!0);const it=pop(Y,"language",null),st=pop(Y,"task",null);if(it||st||te){if(Y.forced_decoder_ids)throw new Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");const dt=this.tokenizer.get_decoder_prompt_ids({language:it,task:st,no_timestamps:!te});dt.length>0&&(Y.forced_decoder_ids=dt)}const ot=!Array.isArray(O);ot&&(O=[O]);const rt=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,nt=this.processor.feature_extractor.config.hop_length,at=this.processor.feature_extractor.config.sampling_rate,ct=await prepareAudios(O,at),ut=[];for(const dt of ct){let ht=[];if(ne>0){if(tt===null)tt=ne/6;else if(ne<=tt)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const mt=at*ne,yt=at*tt,bt=mt-2*yt;let vt=0;for(;vt<dt.length;){const Et=dt.subarray(vt,vt+mt),wt=await this.processor(Et),St=vt===0,Ot=vt+bt>=dt.length;ht.push({stride:[Et.length,St?0:yt,Ot?0:yt],input_features:wt.input_features,is_last:Ot}),vt+=bt}}else ht=[{stride:[dt.length,0,0],input_features:(await this.processor(dt)).input_features,is_last:!0}];for(const mt of ht){Y.num_frames=Math.floor(mt.stride[0]/nt);const yt=await this.model.generate(mt.input_features,Y);te==="word"?(mt.tokens=yt.sequences[0],mt.token_timestamps=yt.token_timestamps.tolist()[0].map(bt=>round$1(bt,2))):mt.tokens=yt[0],mt.stride=mt.stride.map(bt=>bt/at),xe!==null&&xe(mt)}const[pt,ft]=this.tokenizer._decode_asr(ht,{time_precision:rt,return_timestamps:te,force_full_sequences:et});ut.push({text:pt,...ft})}return ot?ut[0]:ut}}class ImageToTextPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y={}){const te=Array.isArray(O),ne=await prepareImages(O),{pixel_values:xe}=await this.processor(ne),et=[];for(const tt of xe){tt.dims=[1,...tt.dims];const it=await this.model.generate(tt,Y),st=this.tokenizer.batch_decode(it,{skip_special_tokens:!0}).map(ot=>({generated_text:ot.trim()}));et.push(st)}return te?et:et[0]}}class ImageClassificationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{topk:Y=1}={}){const te=Array.isArray(O),ne=await prepareImages(O),{pixel_values:xe}=await this.processor(ne),et=await this.model({pixel_values:xe}),tt=this.model.config.id2label,it=[];for(const st of et.logits){const rt=getTopItems(softmax(st.data),Y).map(nt=>({label:tt[nt[0]],score:nt[1]}));Y===1?it.push(...rt):it.push(rt)}return te||Y===1?it:it[0]}}class ImageSegmentationPipeline extends Pipeline{constructor(O){super(O),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(O,{threshold:Y=.5,mask_threshold:te=.5,overlap_mask_area_threshold:ne=.8,label_ids_to_fuse:xe=null,target_sizes:et=null,subtask:tt=null}={}){if(Array.isArray(O)&&O.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const st=await prepareImages(O),ot=st.map(ht=>[ht.height,ht.width]),{pixel_values:rt,pixel_mask:nt}=await this.processor(st),at=await this.model({pixel_values:rt,pixel_mask:nt});let ct=null;if(tt!==null)ct=this.subtasks_mapping[tt];else for(let[ht,pt]of Object.entries(this.subtasks_mapping))if(pt in this.processor.feature_extractor){ct=this.processor.feature_extractor[pt].bind(this.processor.feature_extractor),tt=ht;break}const ut=this.model.config.id2label,dt=[];if(tt==="panoptic"||tt==="instance"){const ht=ct(at,Y,te,ne,xe,et??ot)[0],pt=ht.segmentation;for(const ft of ht.segments_info){const mt=new Uint8ClampedArray(pt.data.length);for(let bt=0;bt<pt.data.length;++bt)pt.data[bt]===ft.id&&(mt[bt]=255);const yt=new RawImage(mt,pt.dims[1],pt.dims[0],1);dt.push({score:ft.score,label:ut[ft.label_id],mask:yt})}}else if(tt==="semantic"){const{segmentation:ht,labels:pt}=ct(at,et??ot)[0];for(const ft of pt){const mt=new Uint8ClampedArray(ht.data.length);for(let bt=0;bt<ht.data.length;++bt)ht.data[bt]===ft&&(mt[bt]=255);const yt=new RawImage(mt,ht.dims[1],ht.dims[0],1);dt.push({score:null,label:ut[ft],mask:yt})}}else throw Error(`Subtask ${tt} not supported.`);return dt}}class ZeroShotImageClassificationPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y,{hypothesis_template:te="This is a photo of {}"}={}){const ne=Array.isArray(O),xe=await prepareImages(O),et=Y.map(nt=>te.replace("{}",nt)),tt=this.tokenizer(et,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:it}=await this.processor(xe),st=await this.model({...tt,pixel_values:it}),ot=this.model.config.model_type==="siglip"?nt=>nt.sigmoid().data:nt=>softmax(nt.data),rt=[];for(const nt of st.logits_per_image){const ct=[...ot(nt)].map((ut,dt)=>({score:ut,label:Y[dt]}));ct.sort((ut,dt)=>dt.score-ut.score),rt.push(ct)}return ne?rt:rt[0]}}class ObjectDetectionPipeline extends Pipeline{constructor(O){super(O)}async _call(O,{threshold:Y=.9,percentage:te=!1}={}){const ne=Array.isArray(O);if(ne&&O.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const xe=await prepareImages(O),et=te?null:xe.map(at=>[at.height,at.width]),{pixel_values:tt,pixel_mask:it}=await this.processor(xe),st=await this.model({pixel_values:tt,pixel_mask:it}),ot=this.processor.feature_extractor.post_process_object_detection(st,Y,et),rt=this.model.config.id2label,nt=ot.map(at=>at.boxes.map((ct,ut)=>({score:at.scores[ut],label:rt[at.classes[ut]],box:get_bounding_box(ct,!te)})));return ne?nt:nt[0]}}class ZeroShotObjectDetectionPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y,{threshold:te=.1,topk:ne=null,percentage:xe=!1}={}){const et=Array.isArray(O),tt=await prepareImages(O),it=this.tokenizer(Y,{padding:!0,truncation:!0}),st=await this.processor(tt),ot=[];for(let rt=0;rt<tt.length;++rt){const nt=tt[rt],at=xe?null:[[nt.height,nt.width]],ct=st.pixel_values[rt].unsqueeze_(0),ut=await this.model({...it,pixel_values:ct}),dt=this.processor.feature_extractor.post_process_object_detection(ut,te,at,!0)[0];let ht=dt.boxes.map((pt,ft)=>({score:dt.scores[ft],label:Y[dt.classes[ft]],box:get_bounding_box(pt,!xe)})).sort((pt,ft)=>ft.score-pt.score);ne!==null&&(ht=ht.slice(0,ne)),ot.push(ht)}return et?ot:ot[0]}}class DocumentQuestionAnsweringPipeline extends Pipeline{constructor(O){super(O)}async _call(O,Y,te={}){const ne=(await prepareImages(O))[0],{pixel_values:xe}=await this.processor(ne),et=`<s_docvqa><s_question>${Y}</s_question><s_answer>`,tt=this.tokenizer(et,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,it=await this.model.generate(xe,{...te,decoder_input_ids:tt,max_length:this.model.config.decoder.max_position_embeddings}),ot=this.tokenizer.batch_decode(it)[0].match(/<s_answer>(.*?)<\/s_answer>/);let rt=null;return ot&&ot.length>=2&&(rt=ot[1].trim()),[{answer:rt}]}}class TextToAudioPipeline extends Pipeline{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(O){super(O),this.vocoder=O.vocoder??null}async _call(O,{speaker_embeddings:Y=null}={}){return this.processor?this._call_text_to_spectrogram(O,{speaker_embeddings:Y}):this._call_text_to_waveform(O)}async _call_text_to_waveform(O){const Y=this.tokenizer(O,{padding:!0,truncation:!0}),{waveform:te}=await this.model(Y),ne=this.model.config.sampling_rate;return{audio:te.data,sampling_rate:ne}}async _call_text_to_spectrogram(O,{speaker_embeddings:Y}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),(typeof Y=="string"||Y instanceof URL)&&(Y=new Float32Array(await(await fetch(Y)).arrayBuffer())),Y instanceof Float32Array)Y=new Tensor("float32",Y,[1,Y.length]);else if(!(Y instanceof Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");const{input_ids:te}=this.tokenizer(O,{padding:!0,truncation:!0}),{waveform:ne}=await this.model.generate_speech(te,Y,{vocoder:this.vocoder}),xe=this.processor.feature_extractor.config.sampling_rate;return{audio:ne.data,sampling_rate:xe}}}class ImageToImagePipeline extends Pipeline{constructor(O){super(O)}async _call(O){const Y=await prepareImages(O),te=await this.processor(Y),ne=await this.model(te),xe=[];for(const et of ne.reconstruction){const tt=et.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");xe.push(RawImage.fromTensor(tt))}return xe.length>1?xe:xe[0]}}class DepthEstimationPipeline extends Pipeline{constructor(O){super(O)}async _call(O){const Y=await prepareImages(O),te=await this.processor(Y),{predicted_depth:ne}=await this.model(te),xe=[];for(let et=0;et<Y.length;++et){const tt=interpolate(ne[et],Y[et].size.reverse(),"bilinear",!1),it=tt.mul_(255/max(tt.data)[0]).to("uint8");xe.push({predicted_depth:ne[et],depth:RawImage.fromTensor(it)})}return xe.length>1?xe:xe[0]}}const SUPPORTED_TASKS=Object.freeze({"text-classification":{tokenizer:AutoTokenizer,pipeline:TextClassificationPipeline,model:AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:AutoTokenizer,pipeline:TokenClassificationPipeline,model:AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:AutoTokenizer,pipeline:QuestionAnsweringPipeline,model:AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:AutoTokenizer,pipeline:FillMaskPipeline,model:AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:AutoTokenizer,pipeline:SummarizationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:AutoTokenizer,pipeline:TranslationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:AutoTokenizer,pipeline:Text2TextGenerationPipeline,model:AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:AutoTokenizer,pipeline:TextGenerationPipeline,model:AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotClassificationPipeline,model:AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:AudioClassificationPipeline,model:AutoModelForAudioClassification,processor:AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotAudioClassificationPipeline,model:AutoModel,processor:AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:AutoTokenizer,pipeline:AutomaticSpeechRecognitionPipeline,model:[AutoModelForSpeechSeq2Seq,AutoModelForCTC],processor:AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:AutoTokenizer,pipeline:TextToAudioPipeline,model:[AutoModelForTextToWaveform,AutoModelForTextToSpectrogram],processor:[AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:AutoTokenizer,pipeline:ImageToTextPipeline,model:AutoModelForVision2Seq,processor:AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:ImageClassificationPipeline,model:AutoModelForImageClassification,processor:AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ImageSegmentationPipeline,model:[AutoModelForImageSegmentation,AutoModelForSemanticSegmentation],processor:AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:AutoTokenizer,pipeline:ZeroShotImageClassificationPipeline,model:AutoModel,processor:AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:ObjectDetectionPipeline,model:AutoModelForObjectDetection,processor:AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:AutoTokenizer,pipeline:ZeroShotObjectDetectionPipeline,model:AutoModelForZeroShotObjectDetection,processor:AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:AutoTokenizer,pipeline:DocumentQuestionAnsweringPipeline,model:AutoModelForDocumentQuestionAnswering,processor:AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:ImageToImagePipeline,model:AutoModelForImageToImage,processor:AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:DepthEstimationPipeline,model:AutoModelForDepthEstimation,processor:AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:AutoTokenizer,pipeline:FeatureExtractionPipeline,model:AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:AutoProcessor,pipeline:ImageFeatureExtractionPipeline,model:[AutoModelForImageFeatureExtraction,AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),TASK_ALIASES=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function pipeline(ee,O=null,{quantized:Y=!0,progress_callback:te=null,config:ne=null,cache_dir:xe=null,local_files_only:et=!1,revision:tt="main",model_file_name:it=null}={}){ee=TASK_ALIASES[ee]??ee;const st=SUPPORTED_TASKS[ee.split("_",1)[0]];if(!st)throw Error(`Unsupported pipeline: ${ee}. Must be one of [${Object.keys(SUPPORTED_TASKS)}]`);O||(O=st.default.model,console.log(`No model specified. Using default model: "${O}".`));const ot={quantized:Y,progress_callback:te,config:ne,cache_dir:xe,local_files_only:et,revision:tt,model_file_name:it},rt=new Map([["tokenizer",st.tokenizer],["model",st.model],["processor",st.processor]]),nt=await loadItems(rt,O,ot);nt.task=ee,dispatchCallback(te,{status:"ready",task:ee,model:O});const at=st.pipeline;return new at(nt)}async function loadItems(ee,O,Y){const te=Object.create(null),ne=[];for(let[xe,et]of ee.entries()){if(!et)continue;let tt;Array.isArray(et)?tt=new Promise(async(it,st)=>{let ot;for(let rt of et){if(rt===null){it(null);return}try{it(await rt.from_pretrained(O,Y));return}catch(nt){ot=nt}}st(ot)}):tt=et.from_pretrained(O,Y),te[xe]=tt,ne.push(tt)}await Promise.all(ne);for(let[xe,et]of Object.entries(te))te[xe]=await et;return te}var MLModel=(ee=>(ee.ZERO_SHOT_CLASSIFICATION="Xenova/distilbert-base-uncased-mnli",ee.FEATURE_EXTRACTION="Xenova/all-MiniLM-L6-v2",ee.TEXT_CLASSIFICATION="Xenova/distilbert-base-uncased-finetuned-sst-2-english",ee.QUESTION_ANSWERING="Xenova/distilbert-base-cased-distilled-squad",ee.SUMMARIZATION="Xenova/distilbart-cnn-6-6",ee.TRANSLATION_EN_FR="Xenova/opus-mt-en-fr",ee.FILL_MASK="Xenova/distilbert-base-uncased",ee.SENTENCE_SIMILARITY="Xenova/all-MiniLM-L6-v2",ee.TOKEN_CLASSIFICATION="Xenova/distilbert-base-uncased-finetuned-conll03-english",ee.IMAGE_CLASSIFICATION="Xenova/vit-base-patch16-224",ee.OBJECT_DETECTION="Xenova/detr-resnet-50",ee.AUTOMATIC_SPEECH_RECOGNITION="Xenova/whisper-tiny",ee.AUDIO_CLASSIFICATION="Xenova/wav2vec2-base",ee))(MLModel||{}),MLTask=(ee=>(ee.ZERO_SHOT_CLASSIFICATION="zero-shot-classification",ee.FEATURE_EXTRACTION="feature-extraction",ee.TEXT_CLASSIFICATION="text-classification",ee.SENTIMENT_ANALYSIS="sentiment-analysis",ee.QUESTION_ANSWERING="question-answering",ee.SUMMARIZATION="summarization",ee.TRANSLATION="translation",ee.FILL_MASK="fill-mask",ee.SENTENCE_SIMILARITY="sentence-similarity",ee.TOKEN_CLASSIFICATION="token-classification",ee.IMAGE_CLASSIFICATION="image-classification",ee.OBJECT_DETECTION="object-detection",ee.AUTOMATIC_SPEECH_RECOGNITION="automatic-speech-recognition",ee.AUDIO_CLASSIFICATION="audio-classification",ee.IMAGE_TO_TEXT="image-to-text",ee.TEXT_TO_IMAGE="text-to-image",ee.IMAGE_SEGMENTATION="image-segmentation",ee.DEPTH_ESTIMATION="depth-estimation",ee))(MLTask||{});function getModelForTask(ee){switch(ee){case"zero-shot-classification":return"Xenova/distilbert-base-uncased-mnli";case"feature-extraction":return"Xenova/all-MiniLM-L6-v2";case"text-classification":case"sentiment-analysis":return"Xenova/distilbert-base-uncased-finetuned-sst-2-english";case"question-answering":return"Xenova/distilbert-base-cased-distilled-squad";case"summarization":return"Xenova/distilbart-cnn-6-6";case"translation":return"Xenova/opus-mt-en-fr";case"fill-mask":return"Xenova/distilbert-base-uncased";case"sentence-similarity":return"Xenova/all-MiniLM-L6-v2";case"token-classification":return"Xenova/distilbert-base-uncased-finetuned-conll03-english";case"image-classification":return"Xenova/vit-base-patch16-224";case"object-detection":return"Xenova/detr-resnet-50";case"automatic-speech-recognition":return"Xenova/whisper-tiny";case"audio-classification":return"Xenova/wav2vec2-base";default:return null}}const logger$4=createLogger("InBrowserMLService");class InBrowserMLService{constructor(){this.pipelines=new Map,this.loadingPipelines=new Set,env$1.allowRemoteModels=!0,env$1.allowLocalModels=!1,env$1.remoteHost="https://huggingface.co"}static getInstance(){return InBrowserMLService.instance||(InBrowserMLService.instance=new InBrowserMLService),InBrowserMLService.instance}setAuthToken(O){O&&O.trim()?(env$1.useAuthToken=O.trim(),logger$4.info("Hugging Face token set for authenticated model access")):env$1.useAuthToken=null}async getPipeline(O,Y,te={}){if(!Y&&typeof O!="string"){const tt=getModelForTask(O);tt&&(Y=tt)}const ne=O,xe=Y,et=`${ne}:${xe}`;if(this.pipelines.has(et))return this.pipelines.get(et);if(this.loadingPipelines.has(et)){for(;this.loadingPipelines.has(et);)await new Promise(tt=>setTimeout(tt,100));return this.pipelines.get(et)}this.loadingPipelines.add(et);try{logger$4.info(`Loading transformers.js pipeline: ${ne} with model ${xe}...`);const tt=await pipeline(ne,xe,{quantized:!0,...te});return this.pipelines.set(et,tt),logger$4.info(`Pipeline ${et} loaded successfully`),tt}catch(tt){const it=tt instanceof Error?tt.message:String(tt);throw logger$4.error(`Failed to load pipeline ${et}: ${it}`),tt}finally{this.loadingPipelines.delete(et)}}clearPipeline(O,Y){const xe=`${O}:${Y}`;this.pipelines.delete(xe)}clearAllPipelines(){this.pipelines.clear()}}const inBrowserMLService=InBrowserMLService.getInstance(),TOPIC_AI_STREAM_STARTED="events/aiservice/streamStarted",TOPIC_AI_STREAM_CHUNK="events/aiservice/streamChunk",TOPIC_AI_STREAM_COMPLETE="events/aiservice/streamComplete",TOPIC_AI_STREAM_ERROR="events/aiservice/streamError",TOPIC_AICONFIG_CHANGED="events/aiservice/aiConfigChanged",TOPIC_AGENT_WORKFLOW_STARTED="events/aiservice/agentWorkflowStarted",TOPIC_AGENT_WORKFLOW_COMPLETE="events/aiservice/agentWorkflowComplete",TOPIC_AGENT_WORKFLOW_ERROR="events/aiservice/agentWorkflowError",CID_AGENTS="aiservice.agents",CID_CHAT_PROVIDERS="aiservice.chatProviders",CID_PROMPT_ENHANCERS="aiservice.promptEnhancers",KEY_AI_CONFIG="aiConfig",AI_CONFIG_TEMPLATE={defaultProvider:"openai",providers:[]},MAX_TOOL_ITERATIONS=10,MAX_RECENT_TOOL_CALLS=5,constants=Object.freeze(Object.defineProperty({__proto__:null,AI_CONFIG_TEMPLATE,CID_AGENTS,CID_CHAT_PROVIDERS,CID_PROMPT_ENHANCERS,KEY_AI_CONFIG,MAX_RECENT_TOOL_CALLS,MAX_TOOL_ITERATIONS,TOPIC_AGENT_WORKFLOW_COMPLETE,TOPIC_AGENT_WORKFLOW_ERROR,TOPIC_AGENT_WORKFLOW_STARTED,TOPIC_AICONFIG_CHANGED,TOPIC_AI_STREAM_CHUNK,TOPIC_AI_STREAM_COMPLETE,TOPIC_AI_STREAM_ERROR,TOPIC_AI_STREAM_STARTED},Symbol.toStringTag,{value:"Module"}));class StreamParser{constructor(){this.decoder=new TextDecoder}*processLines(O){for(const Y of O)Y.trim()!==""&&(yield Y)}}class SSEParser extends StreamParser{constructor(){super(...arguments),this.usage=null}async*parse(O){let Y="";this.usage=null;try{for(;;){const{done:ne,value:xe}=await O.read();if(ne)break;Y+=this.decoder.decode(xe,{stream:!0});const et=Y.split(`
`);Y=et.pop()||"";for(const tt of this.processLines(et))if(tt.startsWith("data: ")){const it=tt.slice(6).trim();if(it==="[DONE]"){const st={type:"done",content:""};this.usage&&(st.metadata={usage:this.usage}),yield st;continue}try{const st=JSON.parse(it);if(st.error){yield{type:"error",content:st.error.message||"Unknown error",metadata:st.error};continue}this.extractUsage(st);const ot=this.parseChunk(st);ot&&(yield ot)}catch{continue}}}if(Y.trim()&&Y.startsWith("data: ")){const ne=Y.slice(6).trim();if(ne!=="[DONE]")try{const xe=JSON.parse(ne);this.extractUsage(xe);const et=this.parseChunk(xe);et&&(yield et)}catch{}}const te={type:"done",content:""};this.usage&&(te.metadata={usage:this.usage}),yield te}finally{O.releaseLock()}}extractUsage(O){if(O.usage){const Y=O.usage;this.usage={promptTokens:Y.prompt_tokens||0,completionTokens:Y.completion_tokens||0,totalTokens:Y.total_tokens||0,estimated:!1}}}parseChunk(O){const Y=O.choices?.[0]?.delta,te=O.choices?.[0];if(Y?.content)return{type:"token",content:Y.content,message:{role:Y.role||"assistant",content:te?.message?.content||Y.content}};if(te?.message?.tool_calls){const ne=this.parseToolCalls(te.message.tool_calls,!0);if(ne.length>0)return{type:"token",content:"",toolCalls:ne}}else if(Y?.tool_calls||te?.delta?.tool_calls){const ne=this.parseToolCalls(Y?.tool_calls||te?.delta?.tool_calls||[],!1);if(ne.length>0)return{type:"token",content:"",toolCalls:ne}}return null}parseToolCalls(O,Y=!1){return O.filter(te=>te.function!==void 0).map((te,ne)=>({id:te.id||`call_${te.index!==void 0?te.index:ne}_${Date.now()}`,type:"function",function:{name:te.function?.name||"",arguments:te.function?.arguments||(Y?"{}":"")},_index:te.index!==void 0?te.index:ne}))}}class OllamaParser extends StreamParser{constructor(){super(...arguments),this.usage=null}async*parse(O){let Y="";this.usage=null;try{for(;;){const{done:ne,value:xe}=await O.read();if(ne)break;Y+=this.decoder.decode(xe,{stream:!0});const et=Y.split(`
`);Y=et.pop()||"";for(const tt of this.processLines(et))try{const it=JSON.parse(tt);if(it.error){yield{type:"error",content:it.error,metadata:it};continue}if(it.done){this.extractUsage(it);const st={type:"done",content:""};this.usage&&(st.metadata={usage:this.usage}),yield st;continue}it.message?.content?yield{type:"token",content:it.message.content,message:{role:it.message.role||"assistant",content:it.message.content}}:it.response&&(yield{type:"token",content:it.response,message:{role:"assistant",content:it.response}})}catch{continue}}if(Y.trim())try{const ne=JSON.parse(Y);ne.done&&this.extractUsage(ne),ne.message?.content&&(yield{type:"token",content:ne.message.content,message:{role:ne.message.role||"assistant",content:ne.message.content}})}catch{}const te={type:"done",content:""};this.usage&&(te.metadata={usage:this.usage}),yield te}finally{O.releaseLock()}}extractUsage(O){if(O.prompt_eval_count!==void 0||O.eval_count!==void 0){const Y=O.prompt_eval_count||0,te=O.eval_count||0;this.usage={promptTokens:Y,completionTokens:te,totalTokens:Y+te,estimated:!1}}}}class BaseProvider{createParser(O,Y){return O.includes("text/event-stream")||Y.includes("openai")?new SSEParser:new OllamaParser}async getAvailableModels(O){if(!O.chatApiEndpoint)return[];try{const Y=O.chatApiEndpoint;let te=Y;if(Y.includes("/v1/chat/completions"))te=Y.replace("/v1/chat/completions","");else if(Y.includes("/api/v1/chat/completions"))te=Y.replace("/api/v1/chat/completions","");else if(Y.includes("/api/chat/completion"))te=Y.replace("/api/chat/completion","");else try{const st=new URL(Y);te=`${st.protocol}//${st.host}`}catch{return[]}const ne=`${te}/v1/models`,xe={"Content-Type":"application/json"};O.apiKey&&(xe.Authorization=`Bearer ${O.apiKey}`);const et=await fetch(ne,{method:"GET",headers:xe});return et.ok?((await et.json()).data||[]).map(st=>({id:st.id,name:st.name||st.id})):[]}catch{return[]}}async*stream(O){const Y={model:O.model,stream:!0,messages:O.messages,...O.chatConfig.parameters};O.tools&&O.tools.length>0&&(Y.tools=O.tools,Y.tool_choice="auto");const te=await fetch(O.chatConfig.chatApiEndpoint,{method:"POST",headers:{Authorization:`Bearer ${O.chatConfig.apiKey}`,"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(Y),signal:O.signal});if(!te.ok){const it=await te.text().catch(()=>"Unknown error");yield{type:"error",content:`HTTP ${te.status}: ${it}`,metadata:{status:te.status,statusText:te.statusText}};return}const ne=te.headers.get("content-type")||"",xe=te.headers.get("content-length");if(!te.body){yield{type:"error",content:`Response body is null or empty (Content-Length: ${xe||"unknown"}). This may indicate: 1) The endpoint doesn't support streaming, 2) Authentication is required/invalid, 3) The endpoint URL is incorrect. For Open WebUI, ensure you're using the correct endpoint and API key.`,metadata:{status:te.status,contentType:ne,contentLength:xe,endpoint:O.chatConfig.chatApiEndpoint,hasApiKey:!!O.chatConfig.apiKey}};return}const et=te.body.getReader();if(!et){yield{type:"error",content:"Response body is not readable"};return}const tt=this.createParser(ne,O.chatConfig.chatApiEndpoint);try{for await(const it of tt.parse(et))yield it}catch(it){yield{type:"error",content:it instanceof Error?it.message:"Failed to parse response stream",metadata:{error:it,contentType:ne,endpoint:O.chatConfig.chatApiEndpoint}}}}}class OpenAIProvider extends BaseProvider{constructor(){super(...arguments),this.name="openai"}canHandle(O){return O.chatApiEndpoint.includes("openai")||O.chatApiEndpoint.includes("v1/chat/completions")}}class OllamaProvider extends BaseProvider{constructor(){super(...arguments),this.name="ollama"}canHandle(O){return O.name.toLowerCase()==="ollama"||O.chatApiEndpoint.includes("ollama")||O.chatApiEndpoint.includes("localhost:11434")}}class ProviderFactory{constructor(){this.providers=[],this.registerDefaultProviders()}registerDefaultProviders(){this.providers.push(new OpenAIProvider),this.providers.push(new OllamaProvider)}registerProvider(O){this.providers.push(O)}getProvider(O){const Y=this.providers.find(te=>te.canHandle(O));return Y||this.providers[0]}getAllProviders(){return[...this.providers]}}class AgentRegistry{getAgentContributions(){return contributionRegistry.getContributions(CID_AGENTS)}filterAndSortAgents(O,Y){return O.filter(te=>te.canHandle?te.canHandle(Y):!0).sort((te,ne)=>(ne.priority||0)-(te.priority||0))}getMatchingAgents(O,Y){const te=this.getAgentContributions();if(te.length===0)throw new Error("No agents are registered. The App Support agent should be available from the AI system extension.");let ne=te.filter(xe=>Y&&!Y.includes(xe.role)?!1:xe.canHandle?xe.canHandle(O):!0);if(Y&&Y.length>0){if(ne=ne.sort((xe,et)=>(et.priority||0)-(xe.priority||0)),ne.length===0){const xe=Y.join(", ");throw new Error(`No agents found for requested roles: ${xe}. Available agents: ${te.map(et=>et.role).join(", ")}`)}}else if(ne=this.filterAndSortAgents(ne,O),ne.length===0)throw new Error(`No agents can handle the current context. Available agents: ${te.map(xe=>xe.role).join(", ")}`);return ne}}class ToolRegistry{sanitizeFunctionName(O){return O.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}commandToTool(O,Y){const te={},ne=[];return O.parameters?.forEach(tt=>{const it=this.sanitizeFunctionName(tt.name);te[it]={type:tt.type||"string",description:tt.description,...tt.allowedValues&&{enum:tt.allowedValues}},tt.required===!0&&ne.push(it)}),{type:"function",function:{name:this.sanitizeFunctionName(O.id),description:O.description||O.name,parameters:{type:"object",properties:te,required:ne}}}}getAvailableTools(O,Y){const te=commandRegistry.listCommands();let ne=Object.values(te);return Y&&(ne=ne.filter(xe=>Y(xe,O))),ne.map(xe=>this.commandToTool(xe,O))}}const logger$3=createLogger("ToolDetector");class ToolDetector{constructor(){this.classifier=null,this.loading=!1,this.loadPromise=null}async ensureLoaded(){if(!this.classifier)return this.loading&&this.loadPromise?this.loadPromise:(this.loading=!0,this.loadPromise=(async()=>{try{logger$3.info("Loading ML model for tool detection..."),this.classifier=await inBrowserMLService.getPipeline(MLTask.ZERO_SHOT_CLASSIFICATION,MLModel.ZERO_SHOT_CLASSIFICATION,{quantized:!0}),logger$3.info("ML model loaded successfully - will use for tool detection")}catch(O){const Y=O instanceof Error?O.message:String(O);logger$3.warn(`Failed to load ML model, will use keyword-based detection fallback: ${Y}`),this.classifier=null}finally{this.loading=!1}})(),this.loadPromise)}async needsTools(O){if(!O||O.trim().length===0)return!1;const Y=O.toLowerCase().trim();if(["hello","hi","hey","thanks","thank you","bye","goodbye"].some(xe=>Y===xe||Y.startsWith(xe+" ")))return!1;try{if(await this.ensureLoaded(),this.classifier){logger$3.info(`Using ML model to classify prompt: "${Y.substring(0,50)}${Y.length>50?"...":""}"`);const xe=await this.classifier(Y,["requires executing commands or actions","is a simple greeting or question"]),et=xe.labels[0]==="requires executing commands or actions"&&xe.scores[0]>.6;return logger$3.info(`ML classification result: ${xe.labels[0]} (confidence: ${(xe.scores[0]*100).toFixed(1)}%) - needsTools: ${et}`),et}}catch(xe){const et=xe instanceof Error?xe.message:String(xe);logger$3.warn(`ML classification failed, using keyword fallback: ${et}`)}logger$3.info("Using keyword-based detection (ML model not available)");const ne=this.keywordBasedDetection(Y);return logger$3.info(`Keyword detection result: needsTools=${ne}`),ne}keywordBasedDetection(O){const Y=["create","open","delete","read","write","edit","save","rename","move","copy","list","show","display","run","execute","build","add","remove","update","modify","change","set","get","find","search","filter","sort","install","uninstall","load","import","export","generate","make","do","perform","call","invoke"],te=["file","folder","directory","workspace","editor","map","layer","command","tool","extension","script","code","project"],ne=Y.some(et=>O.includes(et)),xe=te.some(et=>O.includes(et));return ne&&(xe||O.length>20)}dispose(){this.classifier=null,this.loading=!1,this.loadPromise=null}}const toolDetector=new ToolDetector;class PromptBuilder{constructor(){this.toolRegistry=new ToolRegistry,this.enhancers=[]}addEnhancer(O){this.enhancers.push(O)}async getSysPrompt(O,Y){let te=O.sysPrompt;if(typeof te=="function"&&(te=te()),!te||typeof te!="string")throw new Error(`Agent "${O.role}" (${O.label}) is missing a system prompt. All agents must provide a sysPrompt.`);const ne=[...O.promptEnhancers||[],...this.enhancers,...this.getContributedEnhancers()].sort((et,tt)=>(tt.priority||0)-(et.priority||0));let xe=te;for(const et of ne)try{xe=await et.enhance(xe,Y),(!xe||typeof xe!="string")&&(xe=te)}catch(tt){console.warn("[PromptBuilder] Enhancer failed:",tt)}return xe}rewriteChatHistoryForAgent(O,Y){return O.map(te=>te.role==="user"?{role:te.role,content:te.content}:te.role===Y?{role:"assistant",content:te.content}:{role:"user",content:`***Agent '${te.role}' replied:***
${te.content}`})}getContributedEnhancers(){return contributionRegistry.getContributions(CID_PROMPT_ENHANCERS).map(Y=>({...Y.enhancer,priority:Y.priority??Y.enhancer.priority}))}async build(O,Y,te,ne){ne?.beforeSend&&await ne.beforeSend(Y,te);const xe=this.sanitizeMessagesForAPI(Y),et=this.rewriteChatHistoryForAgent(xe,O.role);let tt=O.tools;typeof tt=="function"&&(tt=await tt());let it;if(tt?.enabled)if(tt.smartToolDetection){const nt=Y[Y.length-1]?.content||"";await toolDetector.needsTools(nt)&&(it=this.toolRegistry.getAvailableTools(te,tt.commandFilter))}else it=this.toolRegistry.getAvailableTools(te,tt.commandFilter);const st=await this.getSysPrompt(O,te);et.unshift({role:"system",content:st});const ot=et.length-1;return{messages:et,userPromptIndex:ot,tools:it}}sanitizeMessageForAPI(O){const Y={role:O.role,content:O.content};return"tool_call_id"in O&&O.tool_call_id&&(Y.tool_call_id=O.tool_call_id),"tool_calls"in O&&O.tool_calls&&(Y.tool_calls=O.tool_calls),Y}sanitizeMessagesForAPI(O){return O.map(Y=>this.sanitizeMessageForAPI(Y))}}class MessageProcessorService{constructor(){this.processors=[]}addProcessor(O){this.processors.push(O)}getSortedProcessors(){return[...this.processors].sort((O,Y)=>(Y.priority||0)-(O.priority||0))}async process(O,Y,te){let ne={...O};const xe=[...Y.messageProcessors||[],...this.processors].sort((tt,it)=>(it.priority||0)-(tt.priority||0));for(const tt of xe)ne=await tt.process(ne,te);const et=ne.actions?.some(tt=>tt.requiresAttention)||ne.attentionRequests?.some(tt=>tt.requiresAction)||!1;return{...ne,requiresAttention:et}}checkRequiresAttention(O){return O.actions?.some(Y=>Y.requiresAttention)||O.attentionRequests?.some(Y=>Y.requiresAction)||!1}}class ToolCallAccumulator{constructor(){this.accumulatedToolCalls=new Map,this.toolCallIndexMap=new Map}processChunk(O){if(O.type==="token"&&O.toolCalls&&O.toolCalls.length>0)for(const Y of O.toolCalls){const te=Y._index,ne=Y.id;let xe,et;if(te!==void 0&&this.toolCallIndexMap.has(te)?(et=this.toolCallIndexMap.get(te),xe=this.accumulatedToolCalls.get(et)):ne&&this.accumulatedToolCalls.has(ne)?(et=ne,xe=this.accumulatedToolCalls.get(et)):(et=ne||`call_${te!==void 0?te:Date.now()}_${Math.random()}`,xe=void 0),xe){const tt=xe.function.arguments||"",it=Y.function.arguments||"",st=tt+it;this.accumulatedToolCalls.set(et,{id:et,type:Y.type||xe.type,function:{name:Y.function.name||xe.function.name,arguments:st}}),te!==void 0&&!this.toolCallIndexMap.has(te)&&this.toolCallIndexMap.set(te,et)}else this.accumulatedToolCalls.set(et,{...Y,id:et}),te!==void 0&&this.toolCallIndexMap.set(te,et)}}getFinalToolCalls(){return Array.from(this.accumulatedToolCalls.values()).filter(O=>O.function.name&&O.function.name.trim().length>0).map(O=>{let Y=O.function.arguments||"";return(!Y||Y.trim()==="")&&(Y="{}"),{...O,function:{...O.function,arguments:Y}}})}reset(){this.accumulatedToolCalls.clear(),this.toolCallIndexMap.clear()}}class ToolExecutor{sanitizeFunctionName(O){return O.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/^[^a-zA-Z]/,"cmd_$&").replace(/_+/g,"_").replace(/^_|_$/g,"")}findCommand(O,Y){const te=O.function.name,ne=commandRegistry.getCommand(te);if(ne)return ne;const xe=commandRegistry.listCommands();for(const[et,tt]of Object.entries(xe))if(this.sanitizeFunctionName(et)===te)return tt;return null}parseArguments(O){if(!O||O.trim()===""||O==="{}")return{};try{const Y=JSON.parse(O);return Y&&typeof Y=="object"?Y:{}}catch(Y){const te=Y instanceof Error?Y.message:String(Y);return console.error(`[ToolExecutor] Failed to parse arguments: ${O} - ${te}`),{}}}sanitizeArguments(O,Y){if(!Y||!Y.parameters||!O||typeof O!="object")return O||{};const te={};return Y.parameters.forEach(ne=>{const xe=this.sanitizeFunctionName(ne.name);xe in O&&(te[ne.name]=O[xe])}),te}async executeToolCall(O,Y){try{const te=this.findCommand(O,Y),ne=te?.id||O.function.name,xe=O.function.arguments||"{}",et=this.parseArguments(xe),tt=this.sanitizeArguments(et,te),it=commandRegistry.createExecutionContext(tt),st={...Y,...it,params:tt};let ot=await commandRegistry.execute(ne,st);const nt={success:!0,message:`Command "${te?.name||ne}" executed successfully`,command:ne};if(tt&&typeof tt=="object"&&Object.keys(tt).length>0&&(nt.parameters=tt),ot){let at=ot;if(at instanceof Promise&&(at=await at),nt.result=at,te?.output&&te.output.length>0){const ct=te.output.map(ut=>`${ut.name}: ${ut.description||ut.type||"value"}`).join(", ");nt.output=ct}}return{id:O.id,result:nt}}catch(te){const ne=te instanceof Error?te.message:String(te);let xe=null;try{xe=this.findCommand(O,Y)}catch{xe=null}const et=xe?.name||O.function.name;let tt=ne;return ne.includes("No handler found")||ne.includes("No handlers registered")?tt=`Command "${et}" cannot be executed. ${ne}. This usually means the command is not available in the current context (e.g., a map editor may not be open or active).`:(ne.includes("not available")||ne.includes("GsMapEditor"))&&(tt=`Command "${et}" cannot be executed: ${ne}. Please ensure the required editor or component is open and active.`),{id:O.id,result:null,error:tt}}}async executeToolCalls(O,Y){const te=[];for(const ne of O){const xe=await this.executeToolCall(ne,Y);te.push(xe)}return te}createToolCallAccumulator(){return new ToolCallAccumulator}createToolCallSignature(O){const Y=O.function.arguments||"{}";let te={};try{const xe=JSON.parse(Y);te=xe&&typeof xe=="object"?xe:{}}catch{te={}}const ne=te&&typeof te=="object"?Object.keys(te).sort().reduce((xe,et)=>(xe[et]=te[et],xe),{}):{};return`${O.function.name}:${JSON.stringify(ne)}`}}const toolExecutor=Object.freeze(Object.defineProperty({__proto__:null,ToolExecutor},Symbol.toStringTag,{value:"Module"}));class ParallelWorkflowStrategy{async execute(O,Y,te,ne){const xe=Y.chatConfig;if(!xe)throw new Error("Chat config is required");const et=O.map(async tt=>{try{await ne(tt,Y.chatContext.history,te.sharedState,xe,Y,te)}catch(it){const st=it instanceof Error?it:new Error(String(it));te.errors.set(tt.role,st),Y.onAgentError?.(tt.role,st)}});await Promise.all(et)}}class SequentialWorkflowStrategy{async execute(O,Y,te,ne){const xe=Y.chatConfig;if(!xe)throw new Error("Chat config is required");let et=[...Y.chatContext.history],tt={...te.sharedState};for(const it of O)try{const st=this.createAgentContextWithPreviousAgents(tt,Y,te),ot=await ne(it,et,tt,xe,Y,te);if(!ot)break;const rt=this.updateWorkflowState(ot,et,tt,st,te);et=rt.currentMessages,tt=rt.accumulatedState}catch(st){const ot=st instanceof Error?st:new Error(String(st));te.errors.set(it.role,ot),Y.onAgentError?.(it.role,ot);break}}createAgentContextWithPreviousAgents(O,Y,te){return{...O,...Y.callContext.getProxy(),previousAgents:Array.from(te.messages.entries()).map(([ne,xe])=>({role:ne,content:xe.content}))}}updateWorkflowState(O,Y,te,ne,xe){return Y.push(O),te={...te,...ne,message:O},xe.sharedState=te,{currentMessages:Y,accumulatedState:te}}}class ConditionalWorkflowStrategy{async execute(O,Y,te,ne){const xe=Y.chatConfig;if(!xe)throw new Error("Chat config is required");let et=[...Y.chatContext.history],tt={...te.sharedState};for(const it of O)try{const st=this.createAgentContextWithPreviousAgents(tt,Y,te);if(it.canHandle&&!it.canHandle(st))continue;const ot=await ne(it,et,tt,xe,Y,te);if(!ot)break;const rt=this.updateWorkflowState(ot,et,tt,st,te);et=rt.currentMessages,tt=rt.accumulatedState}catch(st){const ot=st instanceof Error?st:new Error(String(st));te.errors.set(it.role,ot),Y.onAgentError?.(it.role,ot)}}createAgentContextWithPreviousAgents(O,Y,te){return{...O,...Y.callContext.getProxy(),previousAgents:Array.from(te.messages.entries()).map(([ne,xe])=>({role:ne,content:xe.content}))}}updateWorkflowState(O,Y,te,ne,xe){return Y.push(O),te={...te,...ne,message:O},xe.sharedState=te,{currentMessages:Y,accumulatedState:te}}}class WorkflowEngine{constructor(){this.strategies=new Map([["parallel",new ParallelWorkflowStrategy],["sequential",new SequentialWorkflowStrategy],["conditional",new ConditionalWorkflowStrategy]])}registerStrategy(O,Y){this.strategies.set(O,Y)}async execute(O,Y,te){const ne=`workflow-${Date.now()}-${Math.random()}`,xe=Y.execution||"parallel",et=Y.sharedState||{},tt={messages:new Map,sharedState:{...et},errors:new Map};publish(TOPIC_AGENT_WORKFLOW_STARTED,{workflowId:ne,options:Y});try{const it=this.strategies.get(xe);if(!it)throw new Error(`Unknown workflow execution strategy: ${xe}`);return await it.execute(O,Y,tt,te),publish(TOPIC_AGENT_WORKFLOW_COMPLETE,{workflowId:ne,results:tt}),tt}catch(it){const st=it instanceof Error?it:new Error(String(it));throw publish(TOPIC_AGENT_WORKFLOW_ERROR,{workflowId:ne,error:st}),st}}}const _TokenEstimator=class{static estimateTokens(O){if(!O||O.trim().length===0)return 0;const Y=O.trim(),te=Y.length,ne=Y.split(/\s+/).filter(et=>et.length>0).length,xe=Math.ceil(te/this.AVERAGE_CHARS_PER_TOKEN+ne*.3);return Math.max(1,xe)}static estimateMessageTokens(O){let Y=this.MESSAGE_OVERHEAD;if(O.content&&(Y+=this.estimateTokens(O.content)),O.role&&(Y+=this.estimateTokens(O.role)),O.tool_calls)for(const te of O.tool_calls)Y+=this.estimateTokens(te.function.name||""),Y+=this.estimateTokens(te.function.arguments||"{}"),Y+=10;return O.tool_call_id&&(Y+=this.estimateTokens(O.tool_call_id)),Y}static estimatePromptTokens(O,Y){let te=0;for(const ne of O)te+=this.estimateMessageTokens(ne);if(Y&&Y.length>0){for(const ne of Y)if(te+=this.TOOL_DEFINITION_OVERHEAD,te+=this.estimateTokens(ne.function.name||""),te+=this.estimateTokens(ne.function.description||""),ne.function.parameters){const xe=JSON.stringify(ne.function.parameters);te+=this.estimateTokens(xe)}}return te}static estimateCompletionTokens(O,Y){let te=this.estimateTokens(O);if(Y&&Y.length>0)for(const ne of Y)te+=10,te+=this.estimateTokens(ne.function?.name||""),te+=this.estimateTokens(ne.function?.arguments||"{}");return te}};_TokenEstimator.AVERAGE_CHARS_PER_TOKEN=4;_TokenEstimator.TOOL_DEFINITION_OVERHEAD=50;_TokenEstimator.MESSAGE_OVERHEAD=4;let TokenEstimator=_TokenEstimator;const TOKEN_USAGE_KEY="ai_token_usage";class TokenUsageTracker{constructor(){this.data=null,this.loadPromise=null}async loadData(){return this.data?this.data:this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{const O=await persistenceService.getObject(TOKEN_USAGE_KEY);return O?this.data=O:(this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()),this.loadPromise=null,this.data})(),this.loadPromise)}async saveData(){this.data&&(this.data.lastUpdated=Date.now(),await persistenceService.persistObject(TOKEN_USAGE_KEY,this.data))}async recordUsage(O,Y){if(await this.loadData(),!this.data)return;this.data.providers[O]||(this.data.providers[O]={promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0});const te=this.data.providers[O];te.promptTokens+=Y.promptTokens,te.completionTokens+=Y.completionTokens,te.totalTokens+=Y.totalTokens,te.requestCount+=1,this.data.total.promptTokens+=Y.promptTokens,this.data.total.completionTokens+=Y.completionTokens,this.data.total.totalTokens+=Y.totalTokens,this.data.total.requestCount+=1,await this.saveData()}async getProviderUsage(O){return await this.loadData(),this.data?.providers[O]||null}async getAllProviderUsage(){return await this.loadData(),this.data?.providers||{}}async getTotalUsage(){return await this.loadData(),this.data?.total||{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0}}async reset(){this.data={providers:{},total:{promptTokens:0,completionTokens:0,totalTokens:0,requestCount:0},lastUpdated:Date.now()},await this.saveData()}async resetProvider(O){if(await this.loadData(),!this.data)return;const Y=this.data.providers[O];Y&&(this.data.total.promptTokens-=Y.promptTokens,this.data.total.completionTokens-=Y.completionTokens,this.data.total.totalTokens-=Y.totalTokens,this.data.total.requestCount-=Y.requestCount,delete this.data.providers[O],await this.saveData())}}const tokenUsageTracker=new TokenUsageTracker;class AIService{constructor(){this.activeRequests=new Map,this.providerFactory=new ProviderFactory,this.agentRegistry=new AgentRegistry,this.promptBuilder=new PromptBuilder,this.messageProcessor=new MessageProcessorService,this.toolExecutor=new ToolExecutor,this.workflowEngine=new WorkflowEngine,this.toolRegistry=new ToolRegistry,subscribe(TOPIC_SETTINGS_CHANGED,()=>{this.aiConfig=void 0,this.configCheckPromise=void 0,this.checkAIConfig().then()}),this.checkAIConfig().then()}getAgentContributions(){return this.agentRegistry.getAgentContributions()}async getProviders(){return await this.checkAIConfig(),this.aiConfig?.providers||[]}async getDefaultProvider(){await this.checkAIConfig();const O=await this.getProviders();if(this.aiConfig?.defaultProvider){const Y=O.find(te=>te.name===this.aiConfig?.defaultProvider);if(Y)return Y}return O[0]}async setDefaultProvider(O){return await this.checkAIConfig(),this.aiConfig&&(this.aiConfig.defaultProvider=O,await appSettings.set(KEY_AI_CONFIG,this.aiConfig)),this.getDefaultProvider()}createMessage(O){return{role:"user",content:O}}registerStreamingFetcher(O){this.providerFactory.registerProvider(O)}getContributedProviders(){return contributionRegistry.getContributions(CID_CHAT_PROVIDERS).map(Y=>Y.provider)}mergeProviders(O,Y){const te=new Set(O.map(xe=>xe.name)),ne=Y.filter(xe=>!te.has(xe.name));return ne.length>0?[...O,...ne]:O}async createInitialConfig(){const O=this.getContributedProviders(),Y={...AI_CONFIG_TEMPLATE,providers:O};return await appSettings.set(KEY_AI_CONFIG,Y),await appSettings.get(KEY_AI_CONFIG)}async updateConfigWithMissingProviders(O){const Y=this.getContributedProviders(),te=this.mergeProviders(O.providers,Y);if(te.length!==O.providers.length){const ne={...O,providers:te};return await appSettings.set(KEY_AI_CONFIG,ne),ne}return O}async checkAIConfig(){if(!this.aiConfig)return this.configCheckPromise?this.configCheckPromise:(this.configCheckPromise=this.performConfigCheck(),this.configCheckPromise)}async performConfigCheck(){try{this.aiConfig=await appSettings.get(KEY_AI_CONFIG),this.aiConfig?this.aiConfig=await this.updateConfigWithMissingProviders(this.aiConfig):this.aiConfig=await this.createInitialConfig(),publish(TOPIC_AICONFIG_CHANGED,this.aiConfig)}finally{this.configCheckPromise=void 0}}createAgentContext(O,Y,te={}){return{...O,...Y.getProxy(),...te}}createFinalMessage(O,Y){return{role:O.role,content:Y.content,actions:Y.actions,requiresAttention:Y.requiresAttention,attentionRequests:Y.attentionRequests,canContinue:Y.canContinue}}async handleUserAttention(O,Y,te,ne){if(!Y.requiresAttention||!te.userAttentionHandler)return!0;const xe=[];if(Y.attentionRequests&&xe.push(...Y.attentionRequests),Y.actions)for(const it of Y.actions)it.requiresAttention&&it.attentionRequest&&xe.push(it.attentionRequest);if(xe.length===0)return!0;if(ne.pendingAttention||(ne.pendingAttention=new Map),ne.pendingAttention.set(O,xe),te.onAttentionRequest)for(const it of xe)te.onAttentionRequest(O,it);if(te.pauseOnAttention)return ne.paused=!0,ne.continuationToken=`${O}-${Date.now()}-${Math.random()}`,!1;const et=te.userAttentionHandler,tt=this.createAgentContext(te.sharedState||{},te.callContext,{message:Y});for(const it of xe)if(et.onAttentionRequest){const st=await et.onAttentionRequest(it,tt);if(it.requiresAction&&(st===!1||st===null))return!1;st&&typeof st=="string"&&(tt[`attention_${it.type}_result`]=st)}else switch(it.type){case"confirmation":if(et.onConfirmation&&!await et.onConfirmation(it.message,tt)&&it.requiresAction)return!1;break;case"input":if(et.onInput){const st=await et.onInput(it.message,void 0,tt);if(!st&&it.requiresAction)return!1;st&&(tt.attention_input_result=st)}break}return!0}async*streamCompletion(O){const Y=`${Date.now()}-${Math.random()}`,te=new AbortController;this.activeRequests.set(Y,te),O.signal&&O.signal.addEventListener("abort",()=>{te.abort()});const ne=O.signal||te.signal;try{O.onStatus?.("starting"),publish(TOPIC_AI_STREAM_STARTED,{requestId:Y,options:O});const xe=O.chatConfig||await this.getDefaultProvider(),et=this.sanitizeMessagesForAPI(O.chatContext.history),tt=this.providerFactory.getProvider(xe),it=this.toolExecutor.createToolCallAccumulator();let st="",ot={role:"assistant",content:""},rt;for await(const ct of tt.stream({model:xe.model,messages:et,chatConfig:xe,tools:O.tools,signal:ne})){if(ct.type==="error"){O.onStatus?.("error"),publish(TOPIC_AI_STREAM_ERROR,{requestId:Y,chunk:ct}),yield ct;break}if(ct.type==="token")it.processChunk(ct),(!ct.toolCalls||ct.toolCalls.length===0)&&(st+=ct.content,ot.content=st),ct.message?.role&&(ot.role=ct.message.role),ct.content&&O.onToken?.(ct.content),O.onStatus?.("streaming"),O.onProgress?.({received:st.length}),publish(TOPIC_AI_STREAM_CHUNK,{requestId:Y,chunk:ct}),yield ct;else if(ct.type==="done"){ct.metadata?.usage&&(rt=ct.metadata.usage),O.onStatus?.("complete"),publish(TOPIC_AI_STREAM_COMPLETE,{requestId:Y}),yield ct;break}else yield ct}const nt=it.getFinalToolCalls(),at={role:ot.role||"assistant",content:st||"",...nt.length>0&&{toolCalls:nt}};if(!rt){const ct=TokenEstimator.estimatePromptTokens(et,O.tools),ut=TokenEstimator.estimateCompletionTokens(st,nt);rt={promptTokens:ct,completionTokens:ut,totalTokens:ct+ut,estimated:!0}}return tokenUsageTracker.recordUsage(xe.name,rt).catch(ct=>{defaultLogger.error(`Failed to record token usage: ${ct instanceof Error?ct.message:String(ct)}`)}),{message:at,tokenUsage:rt}}catch(xe){if(xe instanceof Error&&xe.name==="AbortError")throw O.onStatus?.("error"),publish(TOPIC_AI_STREAM_ERROR,{requestId:Y,error:"Request cancelled"}),xe;O.onStatus?.("error");const et=xe instanceof Error?xe.message:String(xe);throw publish(TOPIC_AI_STREAM_ERROR,{requestId:Y,error:et}),yield{type:"error",content:et,metadata:{error:xe}},xe}finally{this.activeRequests.delete(Y)}}async handleStreamingPromptDirect(O){const Y=this.streamCompletion(O);let te;for(;;){if(te=await Y.next(),te.done)return te.value.message;const ne=te.value;if(ne.type==="error")throw new Error(ne.content);if(ne.type==="done"){const xe=await Y.next();if(xe.done&&xe.value)return xe.value.message;if(!xe.done)continue;throw new Error("Stream completed without return value")}}}sanitizeMessageForAPI(O){const Y={role:O.role,content:O.content};return"tool_call_id"in O&&O.tool_call_id&&(Y.tool_call_id=O.tool_call_id),"tool_calls"in O&&O.tool_calls&&(Y.tool_calls=O.tool_calls),Y}sanitizeMessagesForAPI(O){return O.map(Y=>this.sanitizeMessageForAPI(Y))}async handleStreamingPrompt(O){const Y=O.callContext||rootContext.createChild({}),te=this.createAgentContext({},Y,{userPrompt:O.chatContext.history[O.chatContext.history.length-1]?.content||""}),ne=this.agentRegistry.getMatchingAgents(te),xe=ne.length>0?ne.map(it=>it.role):["assistant"],et=await this.executeAgentWorkflow({chatContext:O.chatContext,chatConfig:O.chatConfig,callContext:Y,execution:"parallel",stream:O.stream,signal:O.signal,onToken:(it,st)=>{O.onToken?.(st)},onStatus:(it,st)=>{O.onStatus?.(st)},roles:xe}),tt=Array.from(et.messages.values());return tt.length===1?tt[0]:tt}async continueWorkflow(O,Y,te){const ne={sharedState:{...te.sharedState,...Object.fromEntries(Y)}},xe={...te,sharedState:ne.sharedState,pauseOnAttention:!1};return this.executeAgentWorkflow(xe)}cancelRequest(O){const Y=this.activeRequests.get(O);return Y?(Y.abort(),this.activeRequests.delete(O),!0):!1}async executeAgentWorkflow(O){const Y=this.createAgentContext(O.sharedState||{},O.callContext),te=this.agentRegistry.getMatchingAgents(Y,O.roles);return this.workflowEngine.execute(te,O,async(ne,xe,et,tt,it,st)=>this.executeAgent(ne,xe,et,tt,it,st))}async executeAgent(O,Y,te,ne,xe,et){xe.onAgentStart?.(O.role);const tt=this.createAgentContext(te,xe.callContext,{userPrompt:Y[Y.length-1]?.content||""}),{messages:it,tools:st}=await this.promptBuilder.build(O,Y,tt,O.hooks),ot=it.map(ht=>{const pt={role:ht.role,content:ht.content};return ht.tool_call_id&&(pt.tool_call_id=ht.tool_call_id),ht.tool_calls&&(pt.tool_calls=ht.tool_calls),pt});let rt=await this.handleStreamingPromptDirect({chatContext:{history:ot},chatConfig:ne,callContext:xe.callContext,stream:xe.stream??!0,signal:xe.signal,tools:st}),nt=0;const at=[...it];for(;rt.toolCalls&&rt.toolCalls.length>0;){if(nt++,nt>MAX_TOOL_ITERATIONS){console.warn(`[AIService] Maximum tool call iterations (${MAX_TOOL_ITERATIONS}) reached`);break}let ht=[];if(xe.requireToolApproval&&xe.onToolApprovalRequest){const vt=rt.toolCalls.map(St=>{const Ot=St.function.arguments||"{}";let $t={};try{$t=JSON.parse(Ot)}catch{$t={}}return`${St.function.name}(${Object.entries($t).map(([Mt,Nt])=>`${Mt}=${Nt}`).join(", ")})`}).join(", "),Et={toolCalls:rt.toolCalls,message:`The AI wants to execute: ${vt}`};await xe.onToolApprovalRequest(O.role,Et)?ht=await this.toolExecutor.executeToolCalls(rt.toolCalls,tt):ht=rt.toolCalls.map(St=>({id:St.id,result:{success:!1,message:"Tool execution cancelled by user",cancelled:!0}}))}else ht=await this.toolExecutor.executeToolCalls(rt.toolCalls,tt);const pt=ht.map(vt=>({role:"tool",content:vt.error?JSON.stringify({error:vt.error}):JSON.stringify(vt.result),tool_call_id:vt.id})),ft={role:"assistant",content:rt.content||""};rt.toolCalls&&rt.toolCalls.length>0&&(ft.tool_calls=rt.toolCalls.filter(vt=>vt.function.name&&vt.function.name.trim().length>0).map(vt=>({id:vt.id,type:vt.type,function:{name:vt.function.name,arguments:vt.function.arguments||"{}"}}))),at.push(ft,...pt);const mt=at;rt=await this.handleStreamingPromptDirect({chatContext:{history:mt.map(vt=>({role:vt.role,content:vt.content,...vt.tool_call_id&&{tool_call_id:vt.tool_call_id},...vt.tool_calls&&{tool_calls:vt.tool_calls}}))},chatConfig:ne,callContext:xe.callContext,stream:xe.stream??!0,signal:xe.signal,tools:st});const yt=rt.content&&rt.content.trim().length>0,bt=rt.toolCalls&&rt.toolCalls.length>0;if(yt&&!bt)break;if(yt&&bt){console.warn("[AIService] Model provided content but also called tools - treating as completion");break}}const ct=await this.messageProcessor.process(rt,O,this.createAgentContext(te,xe.callContext,{message:rt}));O.hooks?.afterReceive&&await O.hooks.afterReceive(ct,this.createAgentContext(te,xe.callContext));const ut=this.createFinalMessage(O,ct);return!await this.handleUserAttention(O.role,ut,xe,et)&&xe.pauseOnAttention?null:(et.messages.set(O.role,ut),xe.onAgentComplete?.(O.role,ut),ut)}}const aiService=new AIService,aiServiceBDom9KD1=Object.freeze(Object.defineProperty({__proto__:null,A:AgentRegistry,B:BaseProvider,C:CID_AGENTS,K:KEY_AI_CONFIG,M:MessageProcessorService,O:OpenAIProvider,P:PromptBuilder,S:SequentialWorkflowStrategy,T:TOPIC_AI_STREAM_STARTED,W:WorkflowEngine,a:aiService,b:TOPIC_AI_STREAM_CHUNK,c:TOPIC_AI_STREAM_COMPLETE,d:TOPIC_AI_STREAM_ERROR,e:TOPIC_AICONFIG_CHANGED,f:TOPIC_AGENT_WORKFLOW_STARTED,g:TOPIC_AGENT_WORKFLOW_COMPLETE,h:TOPIC_AGENT_WORKFLOW_ERROR,i:CID_CHAT_PROVIDERS,j:CID_PROMPT_ENHANCERS,k:AI_CONFIG_TEMPLATE,l:MAX_TOOL_ITERATIONS,m:MAX_RECENT_TOOL_CALLS,n:OllamaProvider,o:ProviderFactory,p:ToolExecutor,q:ToolCallAccumulator,r:ToolRegistry,s:ParallelWorkflowStrategy,t:ConditionalWorkflowStrategy,u:tokenUsageTracker,v:constants,w:toolExecutor},Symbol.toStringTag,{value:"Module"}));var dist={},ohm={},hasRequiredOhm;function requireOhm(){if(hasRequiredOhm)return ohm;hasRequiredOhm=1,Object.defineProperty(ohm,"__esModule",{value:!0});function ee(Ct){const _t=Ct||"";return function(){throw new Error("this method "+_t+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function O(Ct,_t){if(!Ct)throw new Error(_t||"Assertion failed")}function Y(Ct,_t,Tt){let Lt;Object.defineProperty(Ct,_t,{get(){return Lt||(Lt=Tt.call(this)),Lt}})}function te(Ct){return Ct&&Object.assign({},Ct)}function ne(Ct,_t){const Tt=[];for(;_t-- >0;)Tt.push(Ct());return Tt}function xe(Ct,_t){return new Array(_t+1).join(Ct)}function et(Ct,_t){return ne(()=>Ct,_t)}function tt(Ct){const _t=[];for(let Tt=0;Tt<Ct.length;Tt++){const Lt=Ct[Tt];Ct.lastIndexOf(Lt)!==Tt&&_t.indexOf(Lt)<0&&_t.push(Lt)}return _t}function it(Ct){const _t=[];return Ct.forEach(Tt=>{_t.indexOf(Tt)<0&&_t.push(Tt)}),_t}function st(Ct){const _t=Ct[0];return _t===_t.toUpperCase()}function ot(Ct){return!st(Ct)}function rt(Ct,_t,Tt){const Lt=Tt||" ";return Ct.length<_t?xe(Lt,_t-Ct.length)+Ct:Ct}function nt(){this.strings=[]}nt.prototype.append=function(Ct){this.strings.push(Ct)},nt.prototype.contents=function(){return this.strings.join("")};const at=Ct=>String.fromCodePoint(parseInt(Ct,16));function ct(Ct){if(Ct.charAt(0)==="\\")switch(Ct.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return at(Ct.slice(2,4));case"u":return Ct.charAt(2)==="{"?at(Ct.slice(3,-1)):at(Ct.slice(2,6));default:return Ct.charAt(1)}else return Ct}function ut(Ct){if(Ct==null)return String(Ct);const _t=Object.prototype.toString.call(Ct);try{let Tt;return Ct.constructor&&Ct.constructor.name?Tt=Ct.constructor.name:_t.indexOf("[object ")===0?Tt=_t.slice(8,-1):Tt=typeof Ct,Tt+": "+JSON.stringify(String(Ct))}catch{return _t}}function dt(Ct,_t="unexpected null value"){if(Ct==null)throw new Error(_t);return Ct}var ht=Object.freeze({__proto__:null,abstract:ee,assert:O,defineLazyProperty:Y,clone:te,repeatFn:ne,repeatStr:xe,repeat:et,getDuplicates:tt,copyWithoutDuplicates:it,isSyntactic:st,isLexical:ot,padLeft:rt,StringBuffer:nt,unescapeCodePoint:ct,unexpectedObjToString:ut,checkNotNull:dt});const pt={Lu:new RegExp("\\p{Lu}","u"),Ll:new RegExp("\\p{Ll}","u"),Lt:new RegExp("\\p{Lt}","u"),Lm:new RegExp("\\p{Lm}","u"),Lo:new RegExp("\\p{Lo}","u"),Nl:new RegExp("\\p{Nl}","u"),Nd:new RegExp("\\p{Nd}","u"),Mn:new RegExp("\\p{Mn}","u"),Mc:new RegExp("\\p{Mc}","u"),Pc:new RegExp("\\p{Pc}","u"),Zs:new RegExp("\\p{Zs}","u"),L:new RegExp("\\p{Letter}","u"),Ltmo:new RegExp("\\p{Lt}|\\p{Lm}|\\p{Lo}","u")};class ft{constructor(){if(this.constructor===ft)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(_t){return _t&&(this.source=_t.trimmed()),this}}const mt=Object.create(ft.prototype),yt=Object.create(ft.prototype);class bt extends ft{constructor(_t){super(),this.obj=_t}}class vt extends ft{constructor(_t,Tt){super(),this.from=_t,this.to=Tt,this.matchCodePoint=_t.length>1||Tt.length>1}}class Et extends ft{constructor(_t){super(),this.index=_t}}class wt extends ft{constructor(_t){super(),this.terms=_t}}class St extends wt{constructor(_t,Tt,Lt){const Gt=_t.rules[Tt].body;super([Lt,Gt]),this.superGrammar=_t,this.name=Tt,this.body=Lt}}class Ot extends wt{constructor(_t,Tt,Lt,Gt){const Ht=_t.rules[Tt].body;super([...Lt,Ht,...Gt]),this.superGrammar=_t,this.ruleName=Tt,this.expansionPos=Lt.length}}class $t extends ft{constructor(_t){super(),this.factors=_t}}class Mt extends ft{constructor(_t){super(),this.expr=_t}}class Nt extends Mt{}class Rt extends Mt{}class Pt extends Mt{}Nt.prototype.operator="*",Rt.prototype.operator="+",Pt.prototype.operator="?",Nt.prototype.minNumMatches=0,Rt.prototype.minNumMatches=1,Pt.prototype.minNumMatches=0,Nt.prototype.maxNumMatches=Number.POSITIVE_INFINITY,Rt.prototype.maxNumMatches=Number.POSITIVE_INFINITY,Pt.prototype.maxNumMatches=1;class kt extends ft{constructor(_t){super(),this.expr=_t}}class Wt extends ft{constructor(_t){super(),this.expr=_t}}class zt extends ft{constructor(_t){super(),this.expr=_t}}class Kt extends ft{constructor(_t,Tt=[]){super(),this.ruleName=_t,this.args=Tt}isSyntactic(){return st(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}}class qt extends ft{constructor(_t){super(),this.category=_t,this.pattern=pt[_t]}}function Xt(Ct,_t){let Tt;return _t?(Tt=new Error(_t.getLineAndColumnMessage()+Ct),Tt.shortMessage=Ct,Tt.interval=_t):Tt=new Error(Ct),Tt}function an(){return Xt("Interval sources don't match")}function pn(Ct){const _t=new Error;return Object.defineProperty(_t,"message",{enumerable:!0,get(){return Ct.message}}),Object.defineProperty(_t,"shortMessage",{enumerable:!0,get(){return"Expected "+Ct.getExpectedText()}}),_t.interval=Ct.getInterval(),_t}function ln(Ct,_t,Tt){const Lt=_t?`Grammar ${Ct} is not declared in namespace '${_t}'`:"Undeclared grammar "+Ct;return Xt(Lt,Tt)}function dn(Ct,_t){return Xt("Grammar "+Ct.name+" is already declared in this namespace")}function un(Ct){return Xt(`Grammar '${Ct.name}' does not support incremental parsing`)}function Tn(Ct,_t,Tt){return Xt("Rule "+Ct+" is not declared in grammar "+_t,Tt)}function Sn(Ct,_t,Tt){return Xt("Cannot override rule "+Ct+" because it is not declared in "+_t,Tt)}function bn(Ct,_t,Tt){return Xt("Cannot extend rule "+Ct+" because it is not declared in "+_t,Tt)}function on(Ct,_t,Tt,Lt){let Gt="Duplicate declaration for rule '"+Ct+"' in grammar '"+_t+"'";return _t!==Tt&&(Gt+=" (originally declared in '"+Tt+"')"),Xt(Gt,Lt)}function zn(Ct,_t,Tt,Lt){return Xt("Wrong number of parameters for rule "+Ct+" (expected "+_t+", got "+Tt+")",Lt)}function Ln(Ct,_t,Tt,Lt){return Xt("Wrong number of arguments for rule "+Ct+" (expected "+_t+", got "+Tt+")",Lt)}function hn(Ct,_t,Tt){return Xt("Duplicate parameter names in rule "+Ct+": "+_t.join(", "),Tt)}function Hn(Ct,_t){return Xt("Invalid parameter to rule "+Ct+": "+_t+" has arity "+_t.getArity()+", but parameter expressions must have arity 1",_t.source)}const Wn="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function Gn(Ct,_t){return Xt("Cannot apply syntactic rule "+Ct+" from here (inside a lexical context)",_t.source)}function gr(Ct){const{ruleName:_t}=Ct;return Xt(`applySyntactic is for syntactic rules, but '${_t}' is a lexical rule. `+Wn,Ct.source)}function Qn(Ct){return Xt("applySyntactic is not required here (in a syntactic context)",Ct.source)}function sr(Ct,_t){return Xt("Incorrect argument type: expected "+Ct,_t.source)}function cr(Ct){return Xt("'...' can appear at most once in a rule body",Ct.source)}function On(Ct){const _t=Ct._node;O(_t&&_t.isNonterminal()&&_t.ctorName==="escapeChar_unicodeCodePoint");const Tt=Ct.children.slice(1,-1).map(Gt=>Gt.source),Lt=Tt[0].coverageWith(...Tt.slice(1));return Xt(`U+${Lt.contents} is not a valid Unicode code point`,Lt)}function kn(Ct,_t){const Tt=_t.length>0?_t[_t.length-1].args:[];let Gt="Nullable expression "+Ct.expr.substituteParams(Tt)+" is not allowed inside '"+Ct.operator+"' (possible infinite loop)";if(_t.length>0){const Ht=_t.map(xt=>new Kt(xt.ruleName,xt.args)).join(`
`);Gt+=`
Application stack (most recent application last):
`+Ht}return Xt(Gt,Ct.expr.source)}function br(Ct,_t,Tt,Lt){return Xt("Rule "+Ct+" involves an alternation which has inconsistent arity (expected "+_t+", got "+Tt+")",Lt.source)}function mn(Ct){const _t=Ct.map(Tt=>Tt.message);return Xt(["Errors:"].concat(_t).join(`
- `),Ct[0].interval)}function jn(Ct,_t,Tt,Lt){let Gt=Lt.slice(0,-1).map(Dt=>{const Ut="  "+Dt[0].name+" > "+Dt[1];return Dt.length===3?Ut+" for '"+Dt[2]+"'":Ut}).join(`
`);Gt+=`
  `+_t+" > "+Ct;let Ht="";Ct==="_iter"&&(Ht=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes  see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));const xt=[`Missing semantic action for '${Ct}' in ${Tt} '${_t}'.${Ht}`,"Action stack (most recent call last):",Gt].join(`
`),It=Xt(xt);return It.name="missingSemanticAction",It}function Un(Ct){if(Ct.length===1)throw Ct[0];if(Ct.length>1)throw mn(Ct)}function qn(Ct){let _t=0;return Ct.map(Lt=>{const Gt=Lt.toString();return _t=Math.max(_t,Gt.length),Gt}).map(Lt=>rt(Lt,_t))}function er(Ct,_t,Tt){const Lt=Ct.length,Gt=Ct.slice(0,Tt),Ht=Ct.slice(Tt+_t.length);return(Gt+_t+Ht).substr(0,Lt)}function Pn(...Ct){const _t=this,{offset:Tt}=_t,{repeatStr:Lt}=ht,Gt=new nt;Gt.append("Line "+_t.lineNum+", col "+_t.colNum+`:
`);const Ht=qn([_t.prevLine==null?0:_t.lineNum-1,_t.lineNum,_t.nextLine==null?0:_t.lineNum+1]),xt=(Bt,jt,Qt)=>{Gt.append(Qt+Ht[Bt]+" | "+jt+`
`)};_t.prevLine!=null&&xt(0,_t.prevLine,"  "),xt(1,_t.line,"> ");const It=_t.line.length;let Dt=Lt(" ",It+1);for(let Bt=0;Bt<Ct.length;++Bt){let jt=Ct[Bt][0],Qt=Ct[Bt][1];O(jt>=0&&jt<=Qt,"range start must be >= 0 and <= end");const sn=Tt-_t.colNum+1;jt=Math.max(0,jt-sn),Qt=Math.min(Qt-sn,It),Dt=er(Dt,Lt("~",Qt-jt),jt)}const Ut=2+Ht[1].length+3;return Gt.append(Lt(" ",Ut)),Dt=er(Dt,"^",_t.colNum-1),Gt.append(Dt.replace(/ +$/,"")+`
`),_t.nextLine!=null&&xt(2,_t.nextLine,"  "),Gt.contents()}let Rn=[];function Dn(Ct){Rn.push(Ct)}function or(Ct){Rn.forEach(_t=>{_t(Ct)}),Rn=null}function yn(Ct,_t){let Tt=1,Lt=1,Gt=0,Ht=0,xt=null,It=null,Dt=-1;for(;Gt<_t;){const jt=Ct.charAt(Gt++);jt===`
`?(Tt++,Lt=1,Dt=Ht,Ht=Gt):jt!=="\r"&&Lt++}let Ut=Ct.indexOf(`
`,Ht);if(Ut===-1)Ut=Ct.length;else{const jt=Ct.indexOf(`
`,Ut+1);xt=jt===-1?Ct.slice(Ut):Ct.slice(Ut,jt),xt=xt.replace(/^\r?\n/,"").replace(/\r$/,"")}Dt>=0&&(It=Ct.slice(Dt,Ht).replace(/\r?\n$/,""));const Bt=Ct.slice(Ht,Ut).replace(/\r$/,"");return{offset:_t,lineNum:Tt,colNum:Lt,line:Bt,prevLine:It,nextLine:xt,toString:Pn}}function ur(Ct,_t,...Tt){return yn(Ct,_t).toString(...Tt)}const dr=(()=>{let Ct=0;return _t=>""+_t+Ct++})();class Vn{constructor(_t,Tt,Lt){this.sourceString=_t,this.startIdx=Tt,this.endIdx=Lt}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(..._t){return Vn.coverage(..._t,this)}collapsedLeft(){return new Vn(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new Vn(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return yn(this.sourceString,this.startIdx)}getLineAndColumnMessage(){const _t=[this.startIdx,this.endIdx];return ur(this.sourceString,this.startIdx,_t)}minus(_t){if(this.sourceString!==_t.sourceString)throw an();return this.startIdx===_t.startIdx&&this.endIdx===_t.endIdx?[]:this.startIdx<_t.startIdx&&_t.endIdx<this.endIdx?[new Vn(this.sourceString,this.startIdx,_t.startIdx),new Vn(this.sourceString,_t.endIdx,this.endIdx)]:this.startIdx<_t.endIdx&&_t.endIdx<this.endIdx?[new Vn(this.sourceString,_t.endIdx,this.endIdx)]:this.startIdx<_t.startIdx&&_t.startIdx<this.endIdx?[new Vn(this.sourceString,this.startIdx,_t.startIdx)]:[this]}relativeTo(_t){if(this.sourceString!==_t.sourceString)throw an();return O(this.startIdx>=_t.startIdx&&this.endIdx<=_t.endIdx,"other interval does not cover this one"),new Vn(this.sourceString,this.startIdx-_t.startIdx,this.endIdx-_t.startIdx)}trimmed(){const{contents:_t}=this,Tt=this.startIdx+_t.match(/^\s*/)[0].length,Lt=this.endIdx-_t.match(/\s*$/)[0].length;return new Vn(this.sourceString,Tt,Lt)}subInterval(_t,Tt){const Lt=this.startIdx+_t;return new Vn(this.sourceString,Lt,Lt+Tt)}}Vn.coverage=function(Ct,..._t){let{startIdx:Tt,endIdx:Lt}=Ct;for(const Gt of _t){if(Gt.sourceString!==Ct.sourceString)throw an();Tt=Math.min(Tt,Gt.startIdx),Lt=Math.max(Lt,Gt.endIdx)}return new Vn(Ct.sourceString,Tt,Lt)};const Kn=65535;class wn{constructor(_t){this.source=_t,this.pos=0,this.examinedLength=0}atEnd(){const _t=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),_t}next(){const _t=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),_t}nextCharCode(){const _t=this.next();return _t&&_t.charCodeAt(0)}nextCodePoint(){const _t=this.source.slice(this.pos++).codePointAt(0);return _t>Kn&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),_t}matchString(_t,Tt){let Lt;if(Tt){for(Lt=0;Lt<_t.length;Lt++){const Gt=this.next(),Ht=_t[Lt];if(Gt==null||Gt.toUpperCase()!==Ht.toUpperCase())return!1}return!0}for(Lt=0;Lt<_t.length;Lt++)if(this.next()!==_t[Lt])return!1;return!0}sourceSlice(_t,Tt){return this.source.slice(_t,Tt)}interval(_t,Tt){return new Vn(this.source,_t,Tt||this.pos)}}class ar{constructor(_t,Tt,Lt,Gt,Ht,xt,It){this.matcher=_t,this.input=Tt,this.startExpr=Lt,this._cst=Gt,this._cstOffset=Ht,this._rightmostFailurePosition=xt,this._rightmostFailures=It,this.failed()&&(Y(this,"message",function(){const Dt="Expected "+this.getExpectedText();return ur(this.input,this.getRightmostFailurePosition())+Dt}),Y(this,"shortMessage",function(){const Dt="expected "+this.getExpectedText(),Ut=yn(this.input,this.getRightmostFailurePosition());return"Line "+Ut.lineNum+", col "+Ut.colNum+": "+Dt}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);const _t=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=_t.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");const _t=new nt;let Tt=this.getRightmostFailures();Tt=Tt.filter(Lt=>!Lt.isFluffy());for(let Lt=0;Lt<Tt.length;Lt++)Lt>0&&(Lt===Tt.length-1?_t.append(Tt.length>2?", or ":" or "):_t.append(", ")),_t.append(Tt[Lt].toString());return _t.contents()}getInterval(){const _t=this.getRightmostFailurePosition();return new Vn(this.input,_t,_t)}}class Jn{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(_t){return this.applicationMemoKeyStack.indexOf(_t.toMemoKey())>=0}enter(_t){this.applicationMemoKeyStack.push(_t.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(_t,Tt){Tt.isLeftRecursion=!0,Tt.headApplication=_t,Tt.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=Tt;const{applicationMemoKeyStack:Lt}=this,Gt=Lt.indexOf(_t.toMemoKey())+1,Ht=Lt.slice(Gt);Tt.isInvolved=function(xt){return Ht.indexOf(xt)>=0},Tt.updateInvolvedApplicationMemoKeys=function(){for(let xt=Gt;xt<Lt.length;xt++){const It=Lt[xt];this.isInvolved(It)||Ht.push(It)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(_t){if(!_t.isLeftRecursion)return!0;const{applicationMemoKeyStack:Tt}=this;for(let Lt=0;Lt<Tt.length;Lt++){const Gt=Tt[Lt];if(_t.isInvolved(Gt))return!1}return!0}memoize(_t,Tt){return this.memo[_t]=Tt,this.maxExaminedLength=Math.max(this.maxExaminedLength,Tt.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,Tt.rightmostFailureOffset),Tt}clearObsoleteEntries(_t,Tt){if(_t+this.maxExaminedLength<=Tt)return;const{memo:Lt}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(Lt).forEach(Gt=>{const Ht=Lt[Gt];_t+Ht.examinedLength>Tt?delete Lt[Gt]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,Ht.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,Ht.rightmostFailureOffset))})}}const hr="",An="",xn="",_n="",Sr="",pr="",wr="",_r={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function Cr(Ct){return et(" ",Ct).join("")}function Ar(Ct,_t,Tt){const Lt=nr(Ct.slice(_t,_t+Tt));return Lt.length<Tt?Lt+et(" ",Tt-Lt.length).join(""):Lt}function nr(Ct){return typeof Ct=="string"?Ct.replace(/ /g,xn).replace(/\t/g,Sr).replace(/\n/g,pr).replace(/\r/g,wr):String(Ct)}class ir{constructor(_t,Tt,Lt,Gt,Ht,xt,It){this.input=_t,this.pos=this.pos1=Tt,this.pos2=Lt,this.source=new Vn(_t,Tt,Lt),this.expr=Gt,this.bindings=xt,this.children=It||[],this.terminatingLREntry=null,this._flags=Ht?_r.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(_t){const Tt=new ir(this.input,this.pos,this.pos2,_t,this.succeeded,this.bindings,this.children);return Tt.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,Tt.isImplicitSpaces=this.isImplicitSpaces,Tt.isMemoized=this.isMemoized,Tt.isRootNode=this.isRootNode,Tt.terminatesLR=this.terminatesLR,Tt.terminatingLREntry=this.terminatingLREntry,Tt}recordLRTermination(_t,Tt){this.terminatingLREntry=new ir(this.input,this.pos,this.pos2,this.expr,!1,[Tt],[_t]),this.terminatingLREntry.terminatesLR=!0}walk(_t,Tt){let Lt=_t;typeof Lt=="function"&&(Lt={enter:Lt});function Gt(Ht,xt,It){let Dt=!0;Lt.enter&&Lt.enter.call(Tt,Ht,xt,It)===ir.prototype.SKIP&&(Dt=!1),Dt&&(Ht.children.forEach(Ut=>{Gt(Ut,Ht,It+1)}),Lt.exit&&Lt.exit.call(Tt,Ht,xt,It))}this.isRootNode?this.children.forEach(Ht=>{Gt(Ht,null,0)}):Gt(this,null,0)}toString(){const _t=new nt;return this.walk((Tt,Lt,Gt)=>{if(!Tt)return this.SKIP;if(Tt.expr.constructor.name!=="Alt"){if(_t.append(Ar(Tt.input,Tt.pos,10)+Cr(Gt*2+1)),_t.append((Tt.succeeded?An:hr)+" "+Tt.displayString),Tt.isHeadOfLeftRecursion&&_t.append(" (LR)"),Tt.succeeded){const xt=nr(Tt.source.contents);_t.append(" "+_n+"  "),_t.append(typeof xt=="string"?'"'+xt+'"':xt)}_t.append(`
`)}}),_t.contents()}}ir.prototype.SKIP={},Object.keys(_r).forEach(Ct=>{const _t=_r[Ct];Object.defineProperty(ir.prototype,Ct,{get(){return(this._flags&_t)!==0},set(Tt){Tt?this._flags|=_t:this._flags&=~_t}})}),ft.prototype.allowsSkippingPrecedingSpace=ee("allowsSkippingPrecedingSpace"),mt.allowsSkippingPrecedingSpace=yt.allowsSkippingPrecedingSpace=Kt.prototype.allowsSkippingPrecedingSpace=bt.prototype.allowsSkippingPrecedingSpace=vt.prototype.allowsSkippingPrecedingSpace=qt.prototype.allowsSkippingPrecedingSpace=function(){return!0},wt.prototype.allowsSkippingPrecedingSpace=Mt.prototype.allowsSkippingPrecedingSpace=zt.prototype.allowsSkippingPrecedingSpace=Wt.prototype.allowsSkippingPrecedingSpace=kt.prototype.allowsSkippingPrecedingSpace=Et.prototype.allowsSkippingPrecedingSpace=$t.prototype.allowsSkippingPrecedingSpace=function(){return!1};let vr;Dn(Ct=>{vr=Ct});let Lr;ft.prototype.assertAllApplicationsAreValid=function(Ct,_t){Lr=0,this._assertAllApplicationsAreValid(Ct,_t)},ft.prototype._assertAllApplicationsAreValid=ee("_assertAllApplicationsAreValid"),mt._assertAllApplicationsAreValid=yt._assertAllApplicationsAreValid=bt.prototype._assertAllApplicationsAreValid=vt.prototype._assertAllApplicationsAreValid=Et.prototype._assertAllApplicationsAreValid=qt.prototype._assertAllApplicationsAreValid=function(Ct,_t){},zt.prototype._assertAllApplicationsAreValid=function(Ct,_t){Lr++,this.expr._assertAllApplicationsAreValid(Ct,_t),Lr--},wt.prototype._assertAllApplicationsAreValid=function(Ct,_t){for(let Tt=0;Tt<this.terms.length;Tt++)this.terms[Tt]._assertAllApplicationsAreValid(Ct,_t)},$t.prototype._assertAllApplicationsAreValid=function(Ct,_t){for(let Tt=0;Tt<this.factors.length;Tt++)this.factors[Tt]._assertAllApplicationsAreValid(Ct,_t)},Mt.prototype._assertAllApplicationsAreValid=kt.prototype._assertAllApplicationsAreValid=Wt.prototype._assertAllApplicationsAreValid=function(Ct,_t){this.expr._assertAllApplicationsAreValid(Ct,_t)},Kt.prototype._assertAllApplicationsAreValid=function(Ct,_t,Tt=!1){const Lt=_t.rules[this.ruleName],Gt=st(Ct)&&Lr===0;if(!Lt)throw Tn(this.ruleName,_t.name,this.source);if(!Tt&&st(this.ruleName)&&!Gt)throw Gn(this.ruleName,this);const Ht=this.args.length,xt=Lt.formals.length;if(Ht!==xt)throw Ln(this.ruleName,xt,Ht,this.source);const It=vr&&Lt===vr.rules.applySyntactic;if(vr&&Lt===vr.rules.caseInsensitive&&!(this.args[0]instanceof bt))throw sr('a Terminal (e.g. "abc")',this.args[0]);if(It){const Ut=this.args[0];if(!(Ut instanceof Kt))throw sr("a syntactic rule application",Ut);if(!st(Ut.ruleName))throw gr(Ut);if(Gt)throw Qn(this)}this.args.forEach(Ut=>{if(Ut._assertAllApplicationsAreValid(Ct,_t,It),Ut.getArity()!==1)throw Hn(this.ruleName,Ut)})},ft.prototype.assertChoicesHaveUniformArity=ee("assertChoicesHaveUniformArity"),mt.assertChoicesHaveUniformArity=yt.assertChoicesHaveUniformArity=bt.prototype.assertChoicesHaveUniformArity=vt.prototype.assertChoicesHaveUniformArity=Et.prototype.assertChoicesHaveUniformArity=zt.prototype.assertChoicesHaveUniformArity=qt.prototype.assertChoicesHaveUniformArity=function(Ct){},wt.prototype.assertChoicesHaveUniformArity=function(Ct){if(this.terms.length===0)return;const _t=this.terms[0].getArity();for(let Tt=0;Tt<this.terms.length;Tt++){const Lt=this.terms[Tt];Lt.assertChoicesHaveUniformArity();const Gt=Lt.getArity();if(_t!==Gt)throw br(Ct,_t,Gt,Lt)}},St.prototype.assertChoicesHaveUniformArity=function(Ct){const _t=this.terms[0].getArity(),Tt=this.terms[1].getArity();if(_t!==Tt)throw br(Ct,Tt,_t,this.terms[0])},$t.prototype.assertChoicesHaveUniformArity=function(Ct){for(let _t=0;_t<this.factors.length;_t++)this.factors[_t].assertChoicesHaveUniformArity(Ct)},Mt.prototype.assertChoicesHaveUniformArity=function(Ct){this.expr.assertChoicesHaveUniformArity(Ct)},kt.prototype.assertChoicesHaveUniformArity=function(Ct){},Wt.prototype.assertChoicesHaveUniformArity=function(Ct){this.expr.assertChoicesHaveUniformArity(Ct)},Kt.prototype.assertChoicesHaveUniformArity=function(Ct){},ft.prototype.assertIteratedExprsAreNotNullable=ee("assertIteratedExprsAreNotNullable"),mt.assertIteratedExprsAreNotNullable=yt.assertIteratedExprsAreNotNullable=bt.prototype.assertIteratedExprsAreNotNullable=vt.prototype.assertIteratedExprsAreNotNullable=Et.prototype.assertIteratedExprsAreNotNullable=qt.prototype.assertIteratedExprsAreNotNullable=function(Ct){},wt.prototype.assertIteratedExprsAreNotNullable=function(Ct){for(let _t=0;_t<this.terms.length;_t++)this.terms[_t].assertIteratedExprsAreNotNullable(Ct)},$t.prototype.assertIteratedExprsAreNotNullable=function(Ct){for(let _t=0;_t<this.factors.length;_t++)this.factors[_t].assertIteratedExprsAreNotNullable(Ct)},Mt.prototype.assertIteratedExprsAreNotNullable=function(Ct){if(this.expr.assertIteratedExprsAreNotNullable(Ct),this.expr.isNullable(Ct))throw kn(this,[])},Pt.prototype.assertIteratedExprsAreNotNullable=kt.prototype.assertIteratedExprsAreNotNullable=Wt.prototype.assertIteratedExprsAreNotNullable=zt.prototype.assertIteratedExprsAreNotNullable=function(Ct){this.expr.assertIteratedExprsAreNotNullable(Ct)},Kt.prototype.assertIteratedExprsAreNotNullable=function(Ct){this.args.forEach(_t=>{_t.assertIteratedExprsAreNotNullable(Ct)})};class kr{constructor(_t){this.matchLength=_t}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(_t){if(this.children)return this.children[_t]}indexOfChild(_t){return this.children.indexOf(_t)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(_t){const Tt=this.indexOfChild(_t);if(Tt<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(Tt===0)throw new Error("cannot get child before first child");return this.childAt(Tt-1)}childAfter(_t){const Tt=this.indexOfChild(_t);if(Tt<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(Tt===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(Tt+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}}class Or extends kr{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}}class Fr extends kr{constructor(_t,Tt,Lt,Gt){super(Gt),this.ruleName=_t,this.children=Tt,this.childOffsets=Lt}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return ot(this.ctorName)}isSyntactic(){return st(this.ctorName)}}class $r extends kr{constructor(_t,Tt,Lt,Gt){super(Lt),this.children=_t,this.childOffsets=Tt,this.optional=Gt}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}}ft.prototype.eval=ee("eval"),mt.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos,Lt=_t.nextCodePoint();return Lt!==void 0?(Ct.pushBinding(new Or(String.fromCodePoint(Lt).length),Tt),!0):(Ct.processFailure(Tt,this),!1)},yt.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos;return _t.atEnd()?(Ct.pushBinding(new Or(0),Tt),!0):(Ct.processFailure(Tt,this),!1)},bt.prototype.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos;return _t.matchString(this.obj)?(Ct.pushBinding(new Or(this.obj.length),Tt),!0):(Ct.processFailure(Tt,this),!1)},vt.prototype.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos,Lt=this.matchCodePoint?_t.nextCodePoint():_t.nextCharCode();return Lt!==void 0&&this.from.codePointAt(0)<=Lt&&Lt<=this.to.codePointAt(0)?(Ct.pushBinding(new Or(String.fromCodePoint(Lt).length),Tt),!0):(Ct.processFailure(Tt,this),!1)},Et.prototype.eval=function(Ct){return Ct.eval(Ct.currentApplication().args[this.index])},zt.prototype.eval=function(Ct){Ct.enterLexifiedContext();const _t=Ct.eval(this.expr);return Ct.exitLexifiedContext(),_t},wt.prototype.eval=function(Ct){for(let _t=0;_t<this.terms.length;_t++)if(Ct.eval(this.terms[_t]))return!0;return!1},$t.prototype.eval=function(Ct){for(let _t=0;_t<this.factors.length;_t++){const Tt=this.factors[_t];if(!Ct.eval(Tt))return!1}return!0},Mt.prototype.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos,Lt=this.getArity(),Gt=[],Ht=[];for(;Gt.length<Lt;)Gt.push([]),Ht.push([]);let xt=0,It=Tt,Dt;for(;xt<this.maxNumMatches&&Ct.eval(this.expr);){if(_t.pos===It)throw kn(this,Ct._applicationStack);It=_t.pos,xt++;const Qt=Ct._bindings.splice(Ct._bindings.length-Lt,Lt),sn=Ct._bindingOffsets.splice(Ct._bindingOffsets.length-Lt,Lt);for(Dt=0;Dt<Qt.length;Dt++)Gt[Dt].push(Qt[Dt]),Ht[Dt].push(sn[Dt])}if(xt<this.minNumMatches)return!1;let Ut=Ct.posToOffset(Tt),Bt=0;if(xt>0){const Qt=Gt[Lt-1],sn=Ht[Lt-1],gn=sn[sn.length-1]+Qt[Qt.length-1].matchLength;Ut=Ht[0][0],Bt=gn-Ut}const jt=this instanceof Pt;for(Dt=0;Dt<Gt.length;Dt++)Ct._bindings.push(new $r(Gt[Dt],Ht[Dt],Bt,jt)),Ct._bindingOffsets.push(Ut);return!0},kt.prototype.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos;Ct.pushFailuresInfo();const Lt=Ct.eval(this.expr);return Ct.popFailuresInfo(),Lt?(Ct.processFailure(Tt,this),!1):(_t.pos=Tt,!0)},Wt.prototype.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos;return Ct.eval(this.expr)?(_t.pos=Tt,!0):!1},Kt.prototype.eval=function(Ct){const _t=Ct.currentApplication(),Tt=_t?_t.args:[],Lt=this.substituteParams(Tt),Gt=Ct.getCurrentPosInfo();if(Gt.isActive(Lt))return Lt.handleCycle(Ct);const Ht=Lt.toMemoKey(),xt=Gt.memo[Ht];if(xt&&Gt.shouldUseMemoizedResult(xt)){if(Ct.hasNecessaryInfo(xt))return Ct.useMemoizedResult(Ct.inputStream.pos,xt);delete Gt.memo[Ht]}return Lt.reallyEval(Ct)},Kt.prototype.handleCycle=function(Ct){const _t=Ct.getCurrentPosInfo(),{currentLeftRecursion:Tt}=_t,Lt=this.toMemoKey();let Gt=_t.memo[Lt];return Tt&&Tt.headApplication.toMemoKey()===Lt?Gt.updateInvolvedApplicationMemoKeys():Gt||(Gt=_t.memoize(Lt,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),_t.startLeftRecursion(this,Gt)),Ct.useMemoizedResult(Ct.inputStream.pos,Gt)},Kt.prototype.reallyEval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos,Lt=Ct.getCurrentPosInfo(),Gt=Ct.grammar.rules[this.ruleName],{body:Ht}=Gt,{description:xt}=Gt;Ct.enterApplication(Lt,this),xt&&Ct.pushFailuresInfo();const It=_t.examinedLength;_t.examinedLength=0;let Dt=this.evalOnce(Ht,Ct);const Ut=Lt.currentLeftRecursion,Bt=this.toMemoKey(),jt=Ut&&Ut.headApplication.toMemoKey()===Bt;let Qt;Ct.doNotMemoize?Ct.doNotMemoize=!1:jt?(Dt=this.growSeedResult(Ht,Ct,Tt,Ut,Dt),Lt.endLeftRecursion(),Qt=Ut,Qt.examinedLength=_t.examinedLength-Tt,Qt.rightmostFailureOffset=Ct._getRightmostFailureOffset(),Lt.memoize(Bt,Qt)):(!Ut||!Ut.isInvolved(Bt))&&(Qt=Lt.memoize(Bt,{matchLength:_t.pos-Tt,examinedLength:_t.examinedLength-Tt,value:Dt,failuresAtRightmostPosition:Ct.cloneRecordedFailures(),rightmostFailureOffset:Ct._getRightmostFailureOffset()}));const sn=!!Dt;if(xt&&(Ct.popFailuresInfo(),sn||Ct.processFailure(Tt,this),Qt&&(Qt.failuresAtRightmostPosition=Ct.cloneRecordedFailures())),Ct.isTracing()&&Qt){const gn=Ct.getTraceEntry(Tt,this,sn,sn?[Dt]:[]);jt&&(O(gn.terminatingLREntry!=null||!sn),gn.isHeadOfLeftRecursion=!0),Qt.traceEntry=gn}return _t.examinedLength=Math.max(_t.examinedLength,It),Ct.exitApplication(Lt,Dt),sn},Kt.prototype.evalOnce=function(Ct,_t){const{inputStream:Tt}=_t,Lt=Tt.pos;if(_t.eval(Ct)){const Gt=Ct.getArity(),Ht=_t._bindings.splice(_t._bindings.length-Gt,Gt),xt=_t._bindingOffsets.splice(_t._bindingOffsets.length-Gt,Gt),It=Tt.pos-Lt;return new Fr(this.ruleName,Ht,xt,It)}else return!1},Kt.prototype.growSeedResult=function(Ct,_t,Tt,Lt,Gt){if(!Gt)return!1;const{inputStream:Ht}=_t;for(;;){if(Lt.matchLength=Ht.pos-Tt,Lt.value=Gt,Lt.failuresAtRightmostPosition=_t.cloneRecordedFailures(),_t.isTracing()){const xt=_t.trace[_t.trace.length-1];Lt.traceEntry=new ir(_t.input,Tt,Ht.pos,this,!0,[Gt],[xt.clone()])}if(Ht.pos=Tt,Gt=this.evalOnce(Ct,_t),Ht.pos-Tt<=Lt.matchLength)break;_t.isTracing()&&_t.trace.splice(-2,1)}return _t.isTracing()&&Lt.traceEntry.recordLRTermination(_t.trace.pop(),Gt),Ht.pos=Tt+Lt.matchLength,Lt.value},qt.prototype.eval=function(Ct){const{inputStream:_t}=Ct,Tt=_t.pos,Lt=_t.next();return Lt&&this.pattern.test(Lt)?(Ct.pushBinding(new Or(Lt.length),Tt),!0):(Ct.processFailure(Tt,this),!1)},ft.prototype.getArity=ee("getArity"),mt.getArity=yt.getArity=bt.prototype.getArity=vt.prototype.getArity=Et.prototype.getArity=Kt.prototype.getArity=qt.prototype.getArity=function(){return 1},wt.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()},$t.prototype.getArity=function(){let Ct=0;for(let _t=0;_t<this.factors.length;_t++)Ct+=this.factors[_t].getArity();return Ct},Mt.prototype.getArity=function(){return this.expr.getArity()},kt.prototype.getArity=function(){return 0},Wt.prototype.getArity=zt.prototype.getArity=function(){return this.expr.getArity()};function Ft(Ct,_t){const Tt={};if(Ct.source&&_t){const Lt=Ct.source.relativeTo(_t);Tt.sourceInterval=[Lt.startIdx,Lt.endIdx]}return Tt}ft.prototype.outputRecipe=ee("outputRecipe"),mt.outputRecipe=function(Ct,_t){return["any",Ft(this,_t)]},yt.outputRecipe=function(Ct,_t){return["end",Ft(this,_t)]},bt.prototype.outputRecipe=function(Ct,_t){return["terminal",Ft(this,_t),this.obj]},vt.prototype.outputRecipe=function(Ct,_t){return["range",Ft(this,_t),this.from,this.to]},Et.prototype.outputRecipe=function(Ct,_t){return["param",Ft(this,_t),this.index]},wt.prototype.outputRecipe=function(Ct,_t){return["alt",Ft(this,_t)].concat(this.terms.map(Tt=>Tt.outputRecipe(Ct,_t)))},St.prototype.outputRecipe=function(Ct,_t){return this.terms[0].outputRecipe(Ct,_t)},Ot.prototype.outputRecipe=function(Ct,_t){const Tt=this.terms.slice(0,this.expansionPos),Lt=this.terms.slice(this.expansionPos+1);return["splice",Ft(this,_t),Tt.map(Gt=>Gt.outputRecipe(Ct,_t)),Lt.map(Gt=>Gt.outputRecipe(Ct,_t))]},$t.prototype.outputRecipe=function(Ct,_t){return["seq",Ft(this,_t)].concat(this.factors.map(Tt=>Tt.outputRecipe(Ct,_t)))},Nt.prototype.outputRecipe=Rt.prototype.outputRecipe=Pt.prototype.outputRecipe=kt.prototype.outputRecipe=Wt.prototype.outputRecipe=zt.prototype.outputRecipe=function(Ct,_t){return[this.constructor.name.toLowerCase(),Ft(this,_t),this.expr.outputRecipe(Ct,_t)]},Kt.prototype.outputRecipe=function(Ct,_t){return["app",Ft(this,_t),this.ruleName,this.args.map(Tt=>Tt.outputRecipe(Ct,_t))]},qt.prototype.outputRecipe=function(Ct,_t){return["unicodeChar",Ft(this,_t),this.category]},ft.prototype.introduceParams=ee("introduceParams"),mt.introduceParams=yt.introduceParams=bt.prototype.introduceParams=vt.prototype.introduceParams=Et.prototype.introduceParams=qt.prototype.introduceParams=function(Ct){return this},wt.prototype.introduceParams=function(Ct){return this.terms.forEach((_t,Tt,Lt)=>{Lt[Tt]=_t.introduceParams(Ct)}),this},$t.prototype.introduceParams=function(Ct){return this.factors.forEach((_t,Tt,Lt)=>{Lt[Tt]=_t.introduceParams(Ct)}),this},Mt.prototype.introduceParams=kt.prototype.introduceParams=Wt.prototype.introduceParams=zt.prototype.introduceParams=function(Ct){return this.expr=this.expr.introduceParams(Ct),this},Kt.prototype.introduceParams=function(Ct){const _t=Ct.indexOf(this.ruleName);if(_t>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new Et(_t).withSource(this.source)}else return this.args.forEach((Tt,Lt,Gt)=>{Gt[Lt]=Tt.introduceParams(Ct)}),this},ft.prototype.isNullable=function(Ct){return this._isNullable(Ct,Object.create(null))},ft.prototype._isNullable=ee("_isNullable"),mt._isNullable=vt.prototype._isNullable=Et.prototype._isNullable=Rt.prototype._isNullable=qt.prototype._isNullable=function(Ct,_t){return!1},yt._isNullable=function(Ct,_t){return!0},bt.prototype._isNullable=function(Ct,_t){return typeof this.obj=="string"?this.obj==="":!1},wt.prototype._isNullable=function(Ct,_t){return this.terms.length===0||this.terms.some(Tt=>Tt._isNullable(Ct,_t))},$t.prototype._isNullable=function(Ct,_t){return this.factors.every(Tt=>Tt._isNullable(Ct,_t))},Nt.prototype._isNullable=Pt.prototype._isNullable=kt.prototype._isNullable=Wt.prototype._isNullable=function(Ct,_t){return!0},zt.prototype._isNullable=function(Ct,_t){return this.expr._isNullable(Ct,_t)},Kt.prototype._isNullable=function(Ct,_t){const Tt=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(_t,Tt)){const{body:Lt}=Ct.rules[this.ruleName],Gt=Lt.substituteParams(this.args);_t[Tt]=!1,_t[Tt]=Gt._isNullable(Ct,_t)}return _t[Tt]},ft.prototype.substituteParams=ee("substituteParams"),mt.substituteParams=yt.substituteParams=bt.prototype.substituteParams=vt.prototype.substituteParams=qt.prototype.substituteParams=function(Ct){return this},Et.prototype.substituteParams=function(Ct){return dt(Ct[this.index])},wt.prototype.substituteParams=function(Ct){return new wt(this.terms.map(_t=>_t.substituteParams(Ct)))},$t.prototype.substituteParams=function(Ct){return new $t(this.factors.map(_t=>_t.substituteParams(Ct)))},Mt.prototype.substituteParams=kt.prototype.substituteParams=Wt.prototype.substituteParams=zt.prototype.substituteParams=function(Ct){return new this.constructor(this.expr.substituteParams(Ct))},Kt.prototype.substituteParams=function(Ct){if(this.args.length===0)return this;{const _t=this.args.map(Tt=>Tt.substituteParams(Ct));return new Kt(this.ruleName,_t)}};function Vt(Ct){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(Ct)}function Yt(Ct){const _t=Object.create(null);Ct.forEach(Tt=>{_t[Tt]=(_t[Tt]||0)+1}),Object.keys(_t).forEach(Tt=>{if(_t[Tt]<=1)return;let Lt=1;Ct.forEach((Gt,Ht)=>{Gt===Tt&&(Ct[Ht]=Gt+"_"+Lt++)})})}ft.prototype.toArgumentNameList=ee("toArgumentNameList"),mt.toArgumentNameList=function(Ct,_t){return["any"]},yt.toArgumentNameList=function(Ct,_t){return["end"]},bt.prototype.toArgumentNameList=function(Ct,_t){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+Ct]},vt.prototype.toArgumentNameList=function(Ct,_t){let Tt=this.from+"_to_"+this.to;return Vt(Tt)||(Tt="_"+Tt),Vt(Tt)||(Tt="$"+Ct),[Tt]},wt.prototype.toArgumentNameList=function(Ct,_t){const Tt=this.terms.map(Ht=>Ht.toArgumentNameList(Ct,!0)),Lt=[],Gt=Tt[0].length;for(let Ht=0;Ht<Gt;Ht++){const xt=[];for(let Dt=0;Dt<this.terms.length;Dt++)xt.push(Tt[Dt][Ht]);const It=it(xt);Lt.push(It.join("_or_"))}return _t||Yt(Lt),Lt},$t.prototype.toArgumentNameList=function(Ct,_t){let Tt=[];return this.factors.forEach(Lt=>{const Gt=Lt.toArgumentNameList(Ct,!0);Tt=Tt.concat(Gt),Ct+=Gt.length}),_t||Yt(Tt),Tt},Mt.prototype.toArgumentNameList=function(Ct,_t){const Tt=this.expr.toArgumentNameList(Ct,_t).map(Lt=>Lt[Lt.length-1]==="s"?Lt+"es":Lt+"s");return _t||Yt(Tt),Tt},Pt.prototype.toArgumentNameList=function(Ct,_t){return this.expr.toArgumentNameList(Ct,_t).map(Tt=>"opt"+Tt[0].toUpperCase()+Tt.slice(1))},kt.prototype.toArgumentNameList=function(Ct,_t){return[]},Wt.prototype.toArgumentNameList=zt.prototype.toArgumentNameList=function(Ct,_t){return this.expr.toArgumentNameList(Ct,_t)},Kt.prototype.toArgumentNameList=function(Ct,_t){return[this.ruleName]},qt.prototype.toArgumentNameList=function(Ct,_t){return["$"+Ct]},Et.prototype.toArgumentNameList=function(Ct,_t){return["param"+this.index]},ft.prototype.toDisplayString=ee("toDisplayString"),wt.prototype.toDisplayString=$t.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"},mt.toDisplayString=yt.toDisplayString=Mt.prototype.toDisplayString=kt.prototype.toDisplayString=Wt.prototype.toDisplayString=zt.prototype.toDisplayString=bt.prototype.toDisplayString=vt.prototype.toDisplayString=Et.prototype.toDisplayString=function(){return this.toString()},Kt.prototype.toDisplayString=function(){if(this.args.length>0){const Ct=this.args.map(_t=>_t.toDisplayString());return this.ruleName+"<"+Ct.join(",")+">"}else return this.ruleName},qt.prototype.toDisplayString=function(){return"Unicode ["+this.category+"] character"};function Zt(Ct){return Ct==="description"||Ct==="string"||Ct==="code"}class Jt{constructor(_t,Tt,Lt){if(!Zt(Lt))throw new Error("invalid Failure type: "+Lt);this.pexpr=_t,this.text=Tt,this.type=Lt,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(_t){return this.getText()===_t.getText()&&this.type===_t.type&&(!this.isFluffy()||this.isFluffy()&&_t.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){const _t=new Jt(this.pexpr,this.text,this.type);return this.isFluffy()&&_t.makeFluffy(),_t}toKey(){return this.toString()+"#"+this.type}}ft.prototype.toFailure=ee("toFailure"),mt.toFailure=function(Ct){return new Jt(this,"any object","description")},yt.toFailure=function(Ct){return new Jt(this,"end of input","description")},bt.prototype.toFailure=function(Ct){return new Jt(this,this.obj,"string")},vt.prototype.toFailure=function(Ct){return new Jt(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")},kt.prototype.toFailure=function(Ct){const _t=this.expr===mt?"nothing":"not "+this.expr.toFailure(Ct);return new Jt(this,_t,"description")},Wt.prototype.toFailure=function(Ct){return this.expr.toFailure(Ct)},Kt.prototype.toFailure=function(Ct){let{description:_t}=Ct.rules[this.ruleName];return _t||(_t=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new Jt(this,_t,"description")},qt.prototype.toFailure=function(Ct){return new Jt(this,"a Unicode ["+this.category+"] character","description")},wt.prototype.toFailure=function(Ct){const Tt="("+this.terms.map(Lt=>Lt.toFailure(Ct)).join(" or ")+")";return new Jt(this,Tt,"description")},$t.prototype.toFailure=function(Ct){const Tt="("+this.factors.map(Lt=>Lt.toFailure(Ct)).join(" ")+")";return new Jt(this,Tt,"description")},Mt.prototype.toFailure=function(Ct){const _t="("+this.expr.toFailure(Ct)+this.operator+")";return new Jt(this,_t,"description")},ft.prototype.toString=ee("toString"),mt.toString=function(){return"any"},yt.toString=function(){return"end"},bt.prototype.toString=function(){return JSON.stringify(this.obj)},vt.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)},Et.prototype.toString=function(){return"$"+this.index},zt.prototype.toString=function(){return"#("+this.expr.toString()+")"},wt.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(Ct=>Ct.toString()).join(" | ")+")"},$t.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(Ct=>Ct.toString()).join(" ")+")"},Mt.prototype.toString=function(){return this.expr+this.operator},kt.prototype.toString=function(){return"~"+this.expr},Wt.prototype.toString=function(){return"&"+this.expr},Kt.prototype.toString=function(){if(this.args.length>0){const Ct=this.args.map(_t=>_t.toString());return this.ruleName+"<"+Ct.join(",")+">"}else return this.ruleName},qt.prototype.toString=function(){return"\\p{"+this.category+"}"};class tn extends ft{constructor(_t){super(),this.obj=_t}_getString(_t){const Tt=_t.currentApplication().args[this.obj.index];return O(Tt instanceof bt,"expected a Terminal expression"),Tt.obj}allowsSkippingPrecedingSpace(){return!0}eval(_t){const{inputStream:Tt}=_t,Lt=Tt.pos,Gt=this._getString(_t);return Tt.matchString(Gt,!0)?(_t.pushBinding(new Or(Gt.length),Lt),!0):(_t.processFailure(Lt,this),!1)}getArity(){return 1}substituteParams(_t){return new tn(this.obj.substituteParams(_t))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(_t){return new Jt(this,this.obj.toFailure(_t)+" (case-insensitive)","description")}_isNullable(_t,Tt){return this.obj._isNullable(_t,Tt)}}var cn=Object.freeze({__proto__:null,CaseInsensitiveTerminal:tn,PExpr:ft,any:mt,end:yt,Terminal:bt,Range:vt,Param:Et,Alt:wt,Extend:St,Splice:Ot,Seq:$t,Iter:Mt,Star:Nt,Plus:Rt,Opt:Pt,Not:kt,Lookahead:Wt,Lex:zt,Apply:Kt,UnicodeChar:qt});let vn;Dn(Ct=>{vn=Ct.rules.applySyntactic.body});const fn=new Kt("spaces");class Mn{constructor(_t,Tt,Lt){this.matcher=_t,this.startExpr=Tt,this.grammar=_t.grammar,this.input=_t.getInput(),this.inputStream=new wn(this.input),this.memoTable=_t._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],Lt!==void 0&&(this.positionToRecordFailures=Lt,this.recordedFailures=Object.create(null))}posToOffset(_t){return _t-this._posStack[this._posStack.length-1]}enterApplication(_t,Tt){this._posStack.push(this.inputStream.pos),this._applicationStack.push(Tt),this.inLexifiedContextStack.push(!1),_t.enter(Tt),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(_t,Tt){const Lt=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),_t.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),Tt&&this.pushBinding(Tt,Lt)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){const _t=this.currentApplication();return _t?_t.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(fn),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(_t){return _t.allowsSkippingPrecedingSpace()&&_t!==fn?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(_t,Tt){this._bindings.push(_t),this._bindingOffsets.push(this.posToOffset(Tt))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(_t){for(;this._bindings.length>_t;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(_t){let Tt=this.memoTable[_t];return Tt||(Tt=this.memoTable[_t]=new Jn),Tt}processFailure(_t,Tt){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,_t),this.recordedFailures&&_t===this.positionToRecordFailures){const Lt=this.currentApplication();Lt&&(Tt=Tt.substituteParams(Lt.args)),this.recordFailure(Tt.toFailure(this.grammar),!1)}}recordFailure(_t,Tt){const Lt=_t.toKey();this.recordedFailures[Lt]?this.recordedFailures[Lt].isFluffy()&&!_t.isFluffy()&&this.recordedFailures[Lt].clearFluffy():this.recordedFailures[Lt]=Tt?_t.clone():_t}recordFailures(_t,Tt){Object.keys(_t).forEach(Lt=>{this.recordFailure(_t[Lt],Tt)})}cloneRecordedFailures(){if(!this.recordedFailures)return;const _t=Object.create(null);return Object.keys(this.recordedFailures).forEach(Tt=>{_t[Tt]=this.recordedFailures[Tt].clone()}),_t}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(_t,Tt){const Lt=this.memoTable[_t];if(Lt&&Tt instanceof Kt){const Gt=Lt.memo[Tt.toMemoKey()];if(Gt&&Gt.traceEntry){const Ht=Gt.traceEntry.cloneWithExpr(Tt);return Ht.isMemoized=!0,Ht}}return null}getTraceEntry(_t,Tt,Lt,Gt){if(Tt instanceof Kt){const Ht=this.currentApplication(),xt=Ht?Ht.args:[];Tt=Tt.substituteParams(xt)}return this.getMemoizedTraceEntry(_t,Tt)||new ir(this.input,_t,this.inputStream.pos,Tt,Lt,Gt,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(_t){return this.trace&&!_t.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+_t.rightmostFailureOffset===this.positionToRecordFailures?!!_t.failuresAtRightmostPosition:!0}useMemoizedResult(_t,Tt){this.trace&&this.trace.push(Tt.traceEntry);const Lt=this.inputStream.pos+Tt.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,Lt),this.recordedFailures&&this.positionToRecordFailures===Lt&&Tt.failuresAtRightmostPosition&&this.recordFailures(Tt.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,Tt.examinedLength+_t),Tt.value?(this.inputStream.pos+=Tt.matchLength,this.pushBinding(Tt.value,_t),!0):!1}eval(_t){const{inputStream:Tt}=this,Lt=this._bindings.length,Gt=this.userData;let Ht;this.recordedFailures&&(Ht=this.recordedFailures,this.recordedFailures=Object.create(null));const xt=Tt.pos,It=this.maybeSkipSpacesBefore(_t);let Dt;this.trace&&(Dt=this.trace,this.trace=[]);const Ut=_t.eval(this);if(this.trace){const Bt=this._bindings.slice(Lt),jt=this.getTraceEntry(It,_t,Ut,Bt);jt.isImplicitSpaces=_t===fn,jt.isRootNode=_t===this.startExpr,Dt.push(jt),this.trace=Dt}return Ut?this.recordedFailures&&Tt.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(Bt=>{this.recordedFailures[Bt].makeFluffy()}):(Tt.pos=xt,this.truncateBindings(Lt),this.userData=Gt),this.recordedFailures&&this.recordFailures(Ht,!1),_t===vn&&this.skipSpaces(),Ut}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let _t;this.recordedFailures&&(_t=Object.keys(this.recordedFailures).map(Lt=>this.recordedFailures[Lt]));const Tt=this._bindings[0];return Tt&&(Tt.grammar=this.grammar),new ar(this.matcher,this.input,this.startExpr,Tt,this._bindingOffsets[0],this.rightmostFailurePosition,_t)}getTrace(){this.trace=[];const _t=this.getMatchResult(),Tt=this.trace[this.trace.length-1];return Tt.result=_t,Tt}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}}class rr{constructor(_t){this.grammar=_t,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(_t){return this._input!==_t&&this.replaceInputRange(0,this._input.length,_t),this}replaceInputRange(_t,Tt,Lt){const Gt=this._input,Ht=this._memoTable;if(_t<0||_t>Gt.length||Tt<0||Tt>Gt.length||_t>Tt)throw new Error("Invalid indices: "+_t+" and "+Tt);this._input=Gt.slice(0,_t)+Lt+Gt.slice(Tt),this._input!==Gt&&Ht.length>0&&(this._isMemoTableStale=!0);const xt=Ht.slice(Tt);Ht.length=_t;for(let It=0;It<Lt.length;It++)Ht.push(void 0);for(const It of xt)Ht.push(It);for(let It=0;It<_t;It++){const Dt=Ht[It];Dt&&Dt.clearObsoleteEntries(It,_t)}return this}match(_t,Tt={incremental:!0}){return this._match(this._getStartExpr(_t),{incremental:Tt.incremental,tracing:!1})}trace(_t,Tt={incremental:!0}){return this._match(this._getStartExpr(_t),{incremental:Tt.incremental,tracing:!0})}_match(_t,Tt={}){const Lt={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...Tt};if(!Lt.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw un(this.grammar);const Gt=new Mn(this,_t,Lt.positionToRecordFailures);return Lt.tracing?Gt.getTrace():Gt.getMatchResult()}_getStartExpr(_t){const Tt=_t||this.grammar.defaultStartRule;if(!Tt)throw new Error("Missing start rule argument -- the grammar has no default start rule.");const Lt=this.grammar.parseApplication(Tt);return new $t([Lt,yt])}}const fr=[],mr=(Ct,_t)=>Object.prototype.hasOwnProperty.call(Ct,_t);class nn{constructor(_t,Tt,Lt){this._node=_t,this.source=Tt,this._baseInterval=Lt,_t.isNonterminal()&&O(Tt===Lt),this._childWrappers=[]}_forgetMemoizedResultFor(_t){delete this._node[this._semantics.attributeKeys[_t]],this.children.forEach(Tt=>{Tt._forgetMemoizedResultFor(_t)})}child(_t){if(!(0<=_t&&_t<this._node.numChildren()))return;let Tt=this._childWrappers[_t];if(!Tt){const Lt=this._node.childAt(_t),Gt=this._node.childOffsets[_t],Ht=this._baseInterval.subInterval(Gt,Lt.matchLength),xt=Lt.isNonterminal()?Ht:this._baseInterval;Tt=this._childWrappers[_t]=this._semantics.wrap(Lt,Ht,xt)}return Tt}_children(){for(let _t=0;_t<this._node.numChildren();_t++)this.child(_t);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(_t){const Tt=_t||[],Lt=Tt.map(xt=>xt._node),Gt=new $r(Lt,[],-1,!1),Ht=this._semantics.wrap(Gt,null,null);return Ht._childWrappers=Tt,Ht}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}}class Cn{constructor(_t,Tt){const Lt=this;if(this.grammar=_t,this.checkedActionDicts=!1,this.Wrapper=class extends(Tt?Tt.Wrapper:nn){constructor(Gt,Ht,xt){super(Gt,Ht,xt),Lt.checkActionDictsIfHaventAlready(),this._semantics=Lt}toString(){return"[semantics wrapper for "+Lt.grammar.name+"]"}},this.super=Tt,Tt){if(!(_t.equals(this.super.grammar)||_t._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+_t.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(const Gt in this.attributes)Object.defineProperty(this.attributeKeys,Gt,{value:dr(Gt)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let _t;for(_t in this.operations)this.operations[_t].checkActionDict(this.grammar);for(_t in this.attributes)this.attributes[_t].checkActionDict(this.grammar)}toRecipe(_t){function Tt(Gt){return Gt.super!==Cn.BuiltInSemantics._getSemantics()}let Lt=`(function(g) {
`;if(Tt(this)){Lt+="  var semantics = "+this.super.toRecipe(!0)+"(g";const Gt=this.super.grammar;let Ht=this.grammar;for(;Ht!==Gt;)Lt+=".superGrammar",Ht=Ht.superGrammar;Lt+=`);
`,Lt+="  return g.extendSemantics(semantics)"}else Lt+="  return g.createSemantics()";return["Operation","Attribute"].forEach(Gt=>{const Ht=this[Gt.toLowerCase()+"s"];Object.keys(Ht).forEach(xt=>{const{actionDict:It,formals:Dt,builtInDefault:Ut}=Ht[xt];let Bt=xt;Dt.length>0&&(Bt+="("+Dt.join(", ")+")");let jt;Tt(this)&&this.super[Gt.toLowerCase()+"s"][xt]?jt="extend"+Gt:jt="add"+Gt,Lt+=`
    .`+jt+"("+JSON.stringify(Bt)+", {";const Qt=[];Object.keys(It).forEach(sn=>{if(It[sn]!==Ut){let gn=It[sn].toString().trim();gn=gn.replace(/^.*\(/,"function("),Qt.push(`
      `+JSON.stringify(sn)+": "+gn)}}),Lt+=Qt.join(",")+`
    })`})}),Lt+=`;
  })`,_t||(Lt=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+Lt+`(grammar);
  return semantics;
});
`),Lt}addOperationOrAttribute(_t,Tt,Lt){const Gt=_t+"s",Ht=lr(Tt,_t),{name:xt}=Ht,{formals:It}=Ht;this.assertNewName(xt,_t);const Dt=Rr(_t,xt,jt),Ut={_default:Dt};Object.keys(Lt).forEach(Qt=>{Ut[Qt]=Lt[Qt]});const Bt=_t==="operation"?new Ir(xt,It,Ut,Dt):new Gr(xt,Ut,Dt);Bt.checkActionDict(this.grammar),this[Gt][xt]=Bt;function jt(...Qt){const sn=this._semantics[Gt][xt];if(arguments.length!==sn.formals.length)throw new Error("Invalid number of arguments passed to "+xt+" "+_t+" (expected "+sn.formals.length+", got "+arguments.length+")");const gn=Object.create(null);for(const[xr,Tr]of Object.entries(Qt)){const rn=sn.formals[xr];gn[rn]=Tr}const En=this.args;this.args=gn;const Bn=sn.execute(this._semantics,this);return this.args=En,Bn}_t==="operation"?(this.Wrapper.prototype[xt]=jt,this.Wrapper.prototype[xt].toString=function(){return"["+xt+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,xt,{get:jt,configurable:!0}),Object.defineProperty(this.attributeKeys,xt,{value:dr(xt)}))}extendOperationOrAttribute(_t,Tt,Lt){const Gt=_t+"s";if(lr(Tt,"attribute"),!(this.super&&Tt in this.super[Gt]))throw new Error("Cannot extend "+_t+" '"+Tt+"': did not inherit an "+_t+" with that name");if(mr(this[Gt],Tt))throw new Error("Cannot extend "+_t+" '"+Tt+"' again");const Ht=this[Gt][Tt].formals,xt=this[Gt][Tt].actionDict,It=Object.create(xt);Object.keys(Lt).forEach(Dt=>{It[Dt]=Lt[Dt]}),this[Gt][Tt]=_t==="operation"?new Ir(Tt,Ht,It):new Gr(Tt,It),this[Gt][Tt].checkActionDict(this.grammar)}assertNewName(_t,Tt){if(mr(nn.prototype,_t))throw new Error("Cannot add "+Tt+" '"+_t+"': that's a reserved name");if(_t in this.operations)throw new Error("Cannot add "+Tt+" '"+_t+"': an operation with that name already exists");if(_t in this.attributes)throw new Error("Cannot add "+Tt+" '"+_t+"': an attribute with that name already exists")}wrap(_t,Tt,Lt){const Gt=Lt||Tt;return _t instanceof this.Wrapper?_t:new this.Wrapper(_t,Tt,Gt)}}function lr(Ct,_t){if(!Cn.prototypeGrammar)return O(Ct.indexOf("(")===-1),{name:Ct,formals:[]};const Tt=Cn.prototypeGrammar.match(Ct,_t==="operation"?"OperationSignature":"AttributeSignature");if(Tt.failed())throw new Error(Tt.message);return Cn.prototypeGrammarSemantics(Tt).parse()}function Rr(Ct,_t,Tt){return function(...Lt){const Ht=(this._semantics.operations[_t]||this._semantics.attributes[_t]).formals.map(xt=>this.args[xt]);if(!this.isIteration()&&Lt.length===1)return Tt.apply(Lt[0],Ht);throw jn(this.ctorName,_t,Ct,fr)}}Cn.createSemantics=function(Ct,_t){const Tt=new Cn(Ct,_t!==void 0?_t:Cn.BuiltInSemantics._getSemantics()),Lt=function(Ht){if(!(Ht instanceof ar))throw new TypeError("Semantics expected a MatchResult, but got "+ut(Ht));if(Ht.failed())throw new TypeError("cannot apply Semantics to "+Ht.toString());const xt=Ht._cst;if(xt.grammar!==Ct)throw new Error("Cannot use a MatchResult from grammar '"+xt.grammar.name+"' with a semantics for '"+Ct.name+"'");const It=new wn(Ht.input);return Tt.wrap(xt,It.interval(Ht._cstOffset,Ht.input.length))};return Lt.addOperation=function(Gt,Ht){return Tt.addOperationOrAttribute("operation",Gt,Ht),Lt},Lt.extendOperation=function(Gt,Ht){return Tt.extendOperationOrAttribute("operation",Gt,Ht),Lt},Lt.addAttribute=function(Gt,Ht){return Tt.addOperationOrAttribute("attribute",Gt,Ht),Lt},Lt.extendAttribute=function(Gt,Ht){return Tt.extendOperationOrAttribute("attribute",Gt,Ht),Lt},Lt._getActionDict=function(Gt){const Ht=Tt.operations[Gt]||Tt.attributes[Gt];if(!Ht)throw new Error('"'+Gt+'" is not a valid operation or attribute name in this semantics for "'+Ct.name+'"');return Ht.actionDict},Lt._remove=function(Gt){let Ht;return Gt in Tt.operations?(Ht=Tt.operations[Gt],delete Tt.operations[Gt]):Gt in Tt.attributes&&(Ht=Tt.attributes[Gt],delete Tt.attributes[Gt]),delete Tt.Wrapper.prototype[Gt],Ht},Lt.getOperationNames=function(){return Object.keys(Tt.operations)},Lt.getAttributeNames=function(){return Object.keys(Tt.attributes)},Lt.getGrammar=function(){return Tt.grammar},Lt.toRecipe=function(Gt){return Tt.toRecipe(Gt)},Lt.toString=Tt.toString.bind(Tt),Lt._getSemantics=function(){return Tt},Lt};class Ir{constructor(_t,Tt,Lt,Gt){this.name=_t,this.formals=Tt,this.actionDict=Lt,this.builtInDefault=Gt}checkActionDict(_t){_t._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(_t,Tt){try{const{ctorName:Lt}=Tt._node;let Gt=this.actionDict[Lt];return Gt?(fr.push([this,Lt]),Gt.apply(Tt,Tt._children())):Tt.isNonterminal()&&(Gt=this.actionDict._nonterminal,Gt)?(fr.push([this,"_nonterminal",Lt]),Gt.apply(Tt,Tt._children())):(fr.push([this,"default action",Lt]),this.actionDict._default.apply(Tt,Tt._children()))}finally{fr.pop()}}}Ir.prototype.typeName="operation";class Gr extends Ir{constructor(_t,Tt,Lt){super(_t,[],Tt,Lt)}execute(_t,Tt){const Lt=Tt._node,Gt=_t.attributeKeys[this.name];return mr(Lt,Gt)||(Lt[Gt]=Ir.prototype.execute.call(this,_t,Tt)),Lt[Gt]}}Gr.prototype.typeName="attribute";const zr=["_iter","_terminal","_nonterminal","_default"];function Zr(Ct){return Object.keys(Ct.rules).sort().map(_t=>Ct.rules[_t])}const Pr=Ct=>Ct.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");let Ur,Jr;class Er{constructor(_t,Tt,Lt,Gt){if(this.name=_t,this.superGrammar=Tt,this.rules=Lt,Gt){if(!(Gt in Lt))throw new Error("Invalid start rule: '"+Gt+"' is not a rule in grammar '"+_t+"'");this.defaultStartRule=Gt}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new rr(this)}isBuiltIn(){return this===Er.ProtoBuiltInRules||this===Er.BuiltInRules}equals(_t){if(this===_t)return!0;if(_t==null||this.name!==_t.name||this.defaultStartRule!==_t.defaultStartRule||!(this.superGrammar===_t.superGrammar||this.superGrammar.equals(_t.superGrammar)))return!1;const Tt=Zr(this),Lt=Zr(_t);return Tt.length===Lt.length&&Tt.every((Gt,Ht)=>Gt.description===Lt[Ht].description&&Gt.formals.join(",")===Lt[Ht].formals.join(",")&&Gt.body.toString()===Lt[Ht].body.toString())}match(_t,Tt){const Lt=this.matcher();return Lt.replaceInputRange(0,0,_t),Lt.match(Tt)}trace(_t,Tt){const Lt=this.matcher();return Lt.replaceInputRange(0,0,_t),Lt.trace(Tt)}createSemantics(){return Cn.createSemantics(this)}extendSemantics(_t){return Cn.createSemantics(this,_t._getSemantics())}_checkTopDownActionDict(_t,Tt,Lt){const Gt=[];for(const Ht in Lt){const xt=Lt[Ht];if(!zr.includes(Ht)&&!(Ht in this.rules)){Gt.push(`'${Ht}' is not a valid semantic action for '${this.name}'`);continue}if(typeof xt!="function"){Gt.push(`'${Ht}' must be a function in an action dictionary for '${this.name}'`);continue}const Dt=xt.length,Ut=this._topDownActionArity(Ht);if(Dt!==Ut){let Bt;Ht==="_iter"||Ht==="_nonterminal"?Bt=`it should use a rest parameter, e.g. \`${Ht}(...children) {}\`. NOTE: this is new in Ohm v16  see https://ohmjs.org/d/ati for details.`:Bt=`expected ${Ut}, got ${Dt}`,Gt.push(`Semantic action '${Ht}' has the wrong arity: ${Bt}`)}}if(Gt.length>0){const Ht=Gt.map(It=>"- "+It),xt=new Error([`Found errors in the action dictionary of the '${Tt}' ${_t}:`,...Ht].join(`
`));throw xt.problems=Gt,xt}}_topDownActionArity(_t){return zr.includes(_t)?0:this.rules[_t].body.getArity()}_inheritsFrom(_t){let Tt=this.superGrammar;for(;Tt;){if(Tt.equals(_t,!0))return!0;Tt=Tt.superGrammar}return!1}toRecipe(_t=void 0){const Tt={};this.source&&(Tt.source=this.source.contents);let Lt=null;this.defaultStartRule&&(Lt=this.defaultStartRule);const Gt={};Object.keys(this.rules).forEach(It=>{const Dt=this.rules[It],{body:Ut}=Dt,Bt=!this.superGrammar||!this.superGrammar.rules[It];let jt;Bt?jt="define":jt=Ut instanceof St?"extend":"override";const Qt={};if(Dt.source&&this.source){const En=Dt.source.relativeTo(this.source);Qt.sourceInterval=[En.startIdx,En.endIdx]}const sn=Bt?Dt.description:null,gn=Ut.outputRecipe(Dt.formals,this.source);Gt[It]=[jt,Qt,sn,Dt.formals,gn]});let Ht="null";_t?Ht=_t:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(Ht=this.superGrammar.toRecipe());const xt=[...["grammar",Tt,this.name].map(JSON.stringify),Ht,...[Lt,Gt].map(JSON.stringify)];return Pr(`[${xt.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){const _t=new nt;_t.append("{");let Tt=!0;for(const Lt in this.rules){const{body:Gt}=this.rules[Lt];Tt?Tt=!1:_t.append(","),_t.append(`
`),_t.append("  "),this.addSemanticActionTemplate(Lt,Gt,_t)}return _t.append(`
}`),_t.contents()}addSemanticActionTemplate(_t,Tt,Lt){Lt.append(_t),Lt.append(": function(");const Gt=this._topDownActionArity(_t);Lt.append(et("_",Gt).join(", ")),Lt.append(`) {
`),Lt.append("  }")}parseApplication(_t){let Tt;if(_t.indexOf("<")===-1)Tt=new Kt(_t);else{const Gt=Ur.match(_t,"Base_application");Tt=Jr(Gt,{})}if(!(Tt.ruleName in this.rules))throw Tn(Tt.ruleName,this.name);const{formals:Lt}=this.rules[Tt.ruleName];if(Lt.length!==Tt.args.length){const{source:Gt}=this.rules[Tt.ruleName];throw zn(Tt.ruleName,Lt.length,Tt.args.length,Gt)}return Tt}_setUpMatchState(_t){this._matchStateInitializer&&this._matchStateInitializer(_t)}}Er.ProtoBuiltInRules=new Er("ProtoBuiltInRules",void 0,{any:{body:mt,formals:[],description:"any character",primitive:!0},end:{body:yt,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new tn(new Et(0)),formals:["str"],primitive:!0},lower:{body:new qt("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new qt("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new qt("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new Nt(new Kt("space")),formals:[]},space:{body:new vt("\0"," "),formals:[],description:"a space"}}),Er.initApplicationParser=function(Ct,_t){Ur=Ct,Jr=_t};class Qr{constructor(_t){this.name=_t}sourceInterval(_t,Tt){return this.source.subInterval(_t,Tt-_t)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?Er.ProtoBuiltInRules:Er.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(_t,Tt){const Lt=this.ensureSuperGrammar().rules[_t];if(!Lt)throw Sn(_t,this.superGrammar.name,Tt);return Lt}installOverriddenOrExtendedRule(_t,Tt,Lt,Gt){const Ht=tt(Tt);if(Ht.length>0)throw hn(_t,Ht,Gt);const xt=this.ensureSuperGrammar().rules[_t],It=xt.formals,Dt=It?It.length:0;if(Tt.length!==Dt)throw zn(_t,Dt,Tt.length,Gt);return this.install(_t,Tt,Lt,xt.description,Gt)}install(_t,Tt,Lt,Gt,Ht,xt=!1){return this.rules[_t]={body:Lt.introduceParams(Tt),formals:Tt,description:Gt,source:Ht,primitive:xt},this}withSuperGrammar(_t){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=_t,this.rules=Object.create(_t.rules),_t.isBuiltIn()||(this.defaultStartRule=_t.defaultStartRule),this}withDefaultStartRule(_t){return this.defaultStartRule=_t,this}withSource(_t){return this.source=new wn(_t).interval(0,_t.length),this}build(){const _t=new Er(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);_t._matchStateInitializer=_t.superGrammar._matchStateInitializer,_t.supportsIncrementalParsing=_t.superGrammar.supportsIncrementalParsing;const Tt=[];let Lt=!1;return Object.keys(_t.rules).forEach(Gt=>{const{body:Ht}=_t.rules[Gt];try{Ht.assertChoicesHaveUniformArity(Gt)}catch(xt){Tt.push(xt)}try{Ht.assertAllApplicationsAreValid(Gt,_t)}catch(xt){Tt.push(xt),Lt=!0}}),Lt||Object.keys(_t.rules).forEach(Gt=>{const{body:Ht}=_t.rules[Gt];try{Ht.assertIteratedExprsAreNotNullable(_t,[])}catch(xt){Tt.push(xt)}}),Tt.length>0&&Un(Tt),this.source&&(_t.source=this.source),_t}define(_t,Tt,Lt,Gt,Ht,xt){if(this.ensureSuperGrammar(),this.superGrammar.rules[_t])throw on(_t,this.name,this.superGrammar.name,Ht);if(this.rules[_t])throw on(_t,this.name,this.name,Ht);const It=tt(Tt);if(It.length>0)throw hn(_t,It,Ht);return this.install(_t,Tt,Lt,Gt,Ht,xt)}override(_t,Tt,Lt,Gt,Ht){return this.ensureSuperGrammarRuleForOverriding(_t,Ht),this.installOverriddenOrExtendedRule(_t,Tt,Lt,Ht),this}extend(_t,Tt,Lt,Gt,Ht){if(!this.ensureSuperGrammar().rules[_t])throw bn(_t,this.superGrammar.name,Ht);const It=new St(this.superGrammar,_t,Lt);return It.source=Lt.source,this.installOverriddenOrExtendedRule(_t,Tt,It,Ht),this}}class Vr{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(_t){return new Qr(_t)}grammar(_t,Tt,Lt,Gt,Ht){const xt=new Qr(Tt);return Lt&&xt.withSuperGrammar(Lt instanceof Er?Lt:this.fromRecipe(Lt)),Gt&&xt.withDefaultStartRule(Gt),_t&&_t.source&&xt.withSource(_t.source),this.currentDecl=xt,Object.keys(Ht).forEach(It=>{this.currentRuleName=It;const Dt=Ht[It],Ut=Dt[0],Bt=Dt[1],jt=Dt[2],Qt=Dt[3],sn=this.fromRecipe(Dt[4]);let gn;xt.source&&Bt&&Bt.sourceInterval&&(gn=xt.source.subInterval(Bt.sourceInterval[0],Bt.sourceInterval[1]-Bt.sourceInterval[0])),xt[Ut](It,Qt,sn,jt,gn)}),this.currentRuleName=this.currentDecl=null,xt.build()}terminal(_t){return new bt(_t)}range(_t,Tt){return new vt(_t,Tt)}param(_t){return new Et(_t)}alt(..._t){let Tt=[];for(let Lt of _t)Lt instanceof ft||(Lt=this.fromRecipe(Lt)),Lt instanceof wt?Tt=Tt.concat(Lt.terms):Tt.push(Lt);return Tt.length===1?Tt[0]:new wt(Tt)}seq(..._t){let Tt=[];for(let Lt of _t)Lt instanceof ft||(Lt=this.fromRecipe(Lt)),Lt instanceof $t?Tt=Tt.concat(Lt.factors):Tt.push(Lt);return Tt.length===1?Tt[0]:new $t(Tt)}star(_t){return _t instanceof ft||(_t=this.fromRecipe(_t)),new Nt(_t)}plus(_t){return _t instanceof ft||(_t=this.fromRecipe(_t)),new Rt(_t)}opt(_t){return _t instanceof ft||(_t=this.fromRecipe(_t)),new Pt(_t)}not(_t){return _t instanceof ft||(_t=this.fromRecipe(_t)),new kt(_t)}lookahead(_t){return _t instanceof ft||(_t=this.fromRecipe(_t)),new Wt(_t)}lex(_t){return _t instanceof ft||(_t=this.fromRecipe(_t)),new zt(_t)}app(_t,Tt){return Tt&&Tt.length>0&&(Tt=Tt.map(function(Lt){return Lt instanceof ft?Lt:this.fromRecipe(Lt)},this)),new Kt(_t,Tt)}splice(_t,Tt){return new Ot(this.currentDecl.superGrammar,this.currentRuleName,_t.map(Lt=>this.fromRecipe(Lt)),Tt.map(Lt=>this.fromRecipe(Lt)))}fromRecipe(_t){const Tt=_t[0]==="grammar"?_t.slice(1):_t.slice(2),Lt=this[_t[0]](...Tt),Gt=_t[1];return Gt&&Gt.sourceInterval&&this.currentDecl&&Lt.withSource(this.currentDecl.sourceInterval(...Gt.sourceInterval)),Lt}}function Wr(Ct){return typeof Ct=="function"?Ct.call(new Vr):(typeof Ct=="string"&&(Ct=JSON.parse(Ct)),new Vr().fromRecipe(Ct))}var Nr=Wr(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);Er.BuiltInRules=Nr,or(Er.BuiltInRules);var Dr=Wr(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0",""]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]);const jr=Object.create(ft.prototype);function ei(Ct,_t){for(const Tt in Ct)if(Tt===_t)return!0;return!1}function qr(Ct,_t,Tt){const Lt=new Vr;let Gt,Ht,xt,It=!1;return(Tt||Dr).createSemantics().addOperation("visit",{Grammars(Bt){return Bt.children.map(jt=>jt.visit())},Grammar(Bt,jt,Qt,sn,gn){const En=Bt.visit();Gt=Lt.newGrammar(En),jt.child(0)&&jt.child(0).visit(),sn.children.map(xr=>xr.visit());const Bn=Gt.build();if(Bn.source=this.source.trimmed(),ei(_t,En))throw dn(Bn);return _t[En]=Bn,Bn},SuperGrammar(Bt,jt){const Qt=jt.visit();if(Qt==="null")Gt.withSuperGrammar(null);else{if(!_t||!ei(_t,Qt))throw ln(Qt,_t,jt.source);Gt.withSuperGrammar(_t[Qt])}},Rule_define(Bt,jt,Qt,sn,gn){Ht=Bt.visit(),xt=jt.children.map(Tr=>Tr.visit())[0]||[],!Gt.defaultStartRule&&Gt.ensureSuperGrammar()!==Er.ProtoBuiltInRules&&Gt.withDefaultStartRule(Ht);const En=gn.visit(),Bn=Qt.children.map(Tr=>Tr.visit())[0],xr=this.source.trimmed();return Gt.define(Ht,xt,En,Bn,xr)},Rule_override(Bt,jt,Qt,sn){Ht=Bt.visit(),xt=jt.children.map(Bn=>Bn.visit())[0]||[];const gn=this.source.trimmed();Gt.ensureSuperGrammarRuleForOverriding(Ht,gn),It=!0;const En=sn.visit();return It=!1,Gt.override(Ht,xt,En,null,gn)},Rule_extend(Bt,jt,Qt,sn){Ht=Bt.visit(),xt=jt.children.map(Bn=>Bn.visit())[0]||[];const gn=sn.visit(),En=this.source.trimmed();return Gt.extend(Ht,xt,gn,null,En)},RuleBody(Bt,jt){return Lt.alt(...jt.visit()).withSource(this.source)},OverrideRuleBody(Bt,jt){const Qt=jt.visit(),sn=Qt.indexOf(jr);if(sn>=0){const gn=Qt.slice(0,sn),En=Qt.slice(sn+1);return En.forEach(Bn=>{if(Bn===jr)throw cr(Bn)}),new Ot(Gt.superGrammar,Ht,gn,En).withSource(this.source)}else return Lt.alt(...Qt).withSource(this.source)},Formals(Bt,jt,Qt){return jt.visit()},Params(Bt,jt,Qt){return jt.visit()},Alt(Bt){return Lt.alt(...Bt.visit()).withSource(this.source)},TopLevelTerm_inline(Bt,jt){const Qt=Ht+"_"+jt.visit(),sn=Bt.visit(),gn=this.source.trimmed(),En=!(Gt.superGrammar&&Gt.superGrammar.rules[Qt]);It&&!En?Gt.override(Qt,xt,sn,null,gn):Gt.define(Qt,xt,sn,null,gn);const Bn=xt.map(xr=>Lt.app(xr));return Lt.app(Qt,Bn).withSource(sn.source)},OverrideTopLevelTerm_superSplice(Bt){return jr},Seq(Bt){return Lt.seq(...Bt.children.map(jt=>jt.visit())).withSource(this.source)},Iter_star(Bt,jt){return Lt.star(Bt.visit()).withSource(this.source)},Iter_plus(Bt,jt){return Lt.plus(Bt.visit()).withSource(this.source)},Iter_opt(Bt,jt){return Lt.opt(Bt.visit()).withSource(this.source)},Pred_not(Bt,jt){return Lt.not(jt.visit()).withSource(this.source)},Pred_lookahead(Bt,jt){return Lt.lookahead(jt.visit()).withSource(this.source)},Lex_lex(Bt,jt){return Lt.lex(jt.visit()).withSource(this.source)},Base_application(Bt,jt){const Qt=jt.children.map(sn=>sn.visit())[0]||[];return Lt.app(Bt.visit(),Qt).withSource(this.source)},Base_range(Bt,jt,Qt){return Lt.range(Bt.visit(),Qt.visit()).withSource(this.source)},Base_terminal(Bt){return Lt.terminal(Bt.visit()).withSource(this.source)},Base_paren(Bt,jt,Qt){return jt.visit()},ruleDescr(Bt,jt,Qt){return jt.visit()},ruleDescrText(Bt){return this.sourceString.trim()},caseName(Bt,jt,Qt,sn,gn){return Qt.visit()},name(Bt,jt){return this.sourceString},nameFirst(Bt){},nameRest(Bt){},terminal(Bt,jt,Qt){return jt.children.map(sn=>sn.visit()).join("")},oneCharTerminal(Bt,jt,Qt){return jt.visit()},escapeChar(Bt){try{return ct(this.sourceString)}catch(jt){throw jt instanceof RangeError&&jt.message.startsWith("Invalid code point ")?On(Bt):jt}},NonemptyListOf(Bt,jt,Qt){return[Bt.visit()].concat(Qt.children.map(sn=>sn.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(Ct).visit()}var oi=Wr(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);Hr(Er.BuiltInRules),ai(oi);function Hr(Ct){const _t={empty(){return this.iteration()},nonEmpty(Tt,Lt,Gt){return this.iteration([Tt].concat(Gt.children))},self(...Tt){return this}};Cn.BuiltInSemantics=Cn.createSemantics(Ct,null).addOperation("asIteration",{emptyListOf:_t.empty,nonemptyListOf:_t.nonEmpty,EmptyListOf:_t.empty,NonemptyListOf:_t.nonEmpty,_iter:_t.self})}function ai(Ct){Cn.prototypeGrammarSemantics=Ct.createSemantics().addOperation("parse",{AttributeSignature(_t){return{name:_t.parse(),formals:[]}},OperationSignature(_t,Tt){return{name:_t.parse(),formals:Tt.children.map(Lt=>Lt.parse())[0]||[]}},Formals(_t,Tt,Lt){return Tt.asIteration().children.map(Gt=>Gt.parse())},name(_t,Tt){return this.sourceString}}),Cn.prototypeGrammar=Ct}function li(Ct){let _t=0;const Tt=[0],Lt=()=>Tt[Tt.length-1],Gt={},Ht=/( *).*(?:$|\r?\n|\r)/g;let xt;for(;(xt=Ht.exec(Ct))!=null;){const[It,Dt]=xt;if(It.length===0)break;const Ut=Dt.length,Bt=Lt(),jt=_t+Ut;if(Ut>Bt)Tt.push(Ut),Gt[jt]=1;else if(Ut<Bt){const Qt=Tt.length;for(;Lt()!==Ut;)Tt.pop();Gt[jt]=-1*(Qt-Tt.length)}_t+=It.length}return Tt.length>1&&(Gt[_t]=1-Tt.length),Gt}const Yr="an indented block",ti="a dedent",Fn=1114112;class ci extends wn{constructor(_t){super(_t.input),this.state=_t}_indentationAt(_t){return this.state.userData[_t]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Fn):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Fn):super.nextCodePoint()}}class $n extends ft{constructor(_t=!0){super(),this.isIndent=_t}allowsSkippingPrecedingSpace(){return!0}eval(_t){const{inputStream:Tt}=_t,Lt=_t.userData;_t.doNotMemoize=!0;const Gt=Tt.pos,Ht=this.isIndent?1:-1;return(Lt[Gt]||0)*Ht>0?(_t.userData=Object.create(Lt),_t.userData[Gt]-=Ht,_t.pushBinding(new Or(0),Gt),!0):(_t.processFailure(Gt,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(_t,Tt){}_isNullable(_t,Tt){return!1}assertChoicesHaveUniformArity(_t){}assertIteratedExprsAreNotNullable(_t){}introduceParams(_t){return this}substituteParams(_t){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(_t){const Tt=this.isIndent?Yr:ti;return new Jt(this,Tt,"description")}}const Nn=new Kt("indent"),ni=new Kt("dedent"),Kr=new Ot(Nr,"any",[Nn,ni],[]),ri=new Vr().newGrammar("IndentationSensitive").withSuperGrammar(Nr).define("indent",[],new $n(!0),Yr,void 0,!0).define("dedent",[],new $n(!1),ti,void 0,!0).extend("any",[],Kr,"any character",void 0).build();Object.assign(ri,{_matchStateInitializer(Ct){Ct.userData=li(Ct.input),Ct.inputStream=new ci(Ct)},supportsIncrementalParsing:!1});const ui="17.2.1";Er.initApplicationParser(Dr,qr);const di=Ct=>!!Ct.constructor&&typeof Ct.constructor.isBuffer=="function"&&Ct.constructor.isBuffer(Ct);function hi(Ct,_t){const Tt=Dr.match(Ct,"Grammars");if(Tt.failed())throw pn(Tt);return qr(Tt,_t)}function pi(Ct,_t){const Tt=ii(Ct,_t),Lt=Object.keys(Tt);if(Lt.length===0)throw new Error("Missing grammar definition");if(Lt.length>1){const Ht=Tt[Lt[1]].source;throw new Error(ur(Ht.sourceString,Ht.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return Tt[Lt[0]]}function ii(Ct,_t){const Tt=Object.create(_t||{});if(typeof Ct!="string")if(di(Ct))Ct=Ct.toString();else throw new TypeError("Expected string as first argument, got "+ut(Ct));return hi(Ct,Tt),Tt}return ohm.ExperimentalIndentationSensitive=ri,ohm._buildGrammar=qr,ohm.grammar=pi,ohm.grammars=ii,ohm.makeRecipe=Wr,ohm.ohmGrammar=Dr,ohm.pexprs=cn,ohm.version=ui,ohm}var pep508_ohmBundle,hasRequiredPep508_ohmBundle;function requirePep508_ohmBundle(){if(hasRequiredPep508_ohmBundle)return pep508_ohmBundle;hasRequiredPep508_ohmBundle=1;const{makeRecipe:ee}=requireOhm();return pep508_ohmBundle=ee(["grammar",{source:`PEP508 {
    // Grammar adapted from https://peps.python.org/pep-0508/#complete-grammar
    // (naming retained, just reordered and camelCased)
    File = ListOf<Line, "\\n">
    Line = Req? comment?
    Req = UrlReq | NameReq | RequirementsReq | ConstraintsReq

    NameReq = Name Extras? VersionSpec QuotedMarker?
    UrlReq  = Name Extras? UrlSpec (space QuotedMarker)?
    Extras  = "[" ListOf<identifier, ","> "]"
    Name    = identifier
    identifier    = alnum identifierEnd*
    identifierEnd = alnum -- single
                  | (("-" | "_" | "." )* alnum) -- multi

    // Requirements based on other requirements files (not in PEP 508, but supported by pip)
    RequirementsReq = "-r" filePath
    ConstraintsReq  = "-c" filePath
    filePath        = (~("\\n" | "#") any)+

    UrlSpec      = "@" uriReference
    uriReference = uri | relativeRef
    uri          = scheme ":" hierPart? ("?" query )? ("#" fragment)?
    hierPart     = ("//" authority pathAbempty) -- abempty
                 | pathAbsolute -- absolute
                 | pathRootless -- rootless
    absoluteUri  = scheme ":" hierPart? ("?" query )?
    relativeRef  = relativePart? ("?" query )? ("#" fragment )?
    relativePart = "//" authority pathAbempty -- abempty
                 | pathAbsolute -- absolute
                 | pathNoscheme -- noscheme
    scheme       = letter (alnum | "+" | "-" | ".")*
    authority    = (userinfo "@" )? host (":" port )?
    userinfo     = (unreserved | pctEncoded | subDelims | ":")*
    host         = ipLiteral | ipv4Address | regName
    port         = digit*
    ipLiteral    = "[" (ipv6Address | ipvFuture) "]"
    ipvFuture    = "v" hexdig+ "." (unreserved | subDelims | ":")+
    ipv6Address  = (hexdig | ":" | ".")+ // dumbed down a lot, mostly due to lack of quantifier support in Ohm
    ipv4Address  = decOctet "." decOctet "." decOctet "." decOctet
    nz           = ~"0" digit
    decOctet     = digit -- zeroToNine
                 | nz digit -- tenToNinetyNine
                 | "1" digit digit -- oneHundredToOneNinetyNine
                 | "2" ("0" | "1" | "2" | "3" | "4") digit -- twoHundredToTwoFortyNine
                 | "25" ("0" | "1" | "2" | "3" | "4" | "5") -- twoFiftyToTwoFiftyFive
    regName      = (unreserved | pctEncoded | subDelims)*
    path         = pathAbempty // begins with "/" or is empty
                 | pathAbsolute // begins with "/" but not "//"
                 | pathNoscheme // begins with a non-colon segment
                 | pathRootless // begins with a segment
    pathAbempty  = ("/" segment)*
    pathAbsolute = "/" (segmentNz ("/" segment)* )?
    pathNoscheme = segmentNzNc ("/" segment)*
    pathRootless = segmentNz ("/" segment)*
    segment      = pchar*
    segmentNz    = pchar+
    segmentNzNc  = (unreserved | pctEncoded | subDelims | "@")+ // non-zero-length segment without any colon ":"
    pchar        = unreserved | pctEncoded | subDelims | ":" | "@"
    query        = (pchar | "/" | "?")*
    fragment     = (pchar | "/" | "?")*
    pctEncoded   = "%" hexdig
    unreserved   = alnum | "-" | "." | "_" | "~"
    reserved     = genDelims | subDelims
    genDelims    = ":" | "/" | "?" | "#" | "(" | ")?" | "@"
    subDelims    = "!" | "$" | "&" | "'" | "(" | ")" | "*" | "+" | "," | ";" | "="
    hexdig       = digit | "a" | "A" | "b" | "B" | "c" | "C" | "d" | "D" | "e" | "E" | "f" | "F"

    // Environment markers
    QuotedMarker  = ";" Marker
    Marker        = MarkerOr
    MarkerOr      = MarkerAnd "or" MarkerAnd -- node
                  | MarkerAnd -- leaf
    MarkerAnd     = MarkerExpr "and" MarkerExpr -- node
                  | MarkerExpr -- leaf
    MarkerExpr    = MarkerVar markerOp MarkerVar -- leaf
                  | "(" Marker ")" -- node
    MarkerVar     = envVar | pythonStr
    markerOp      = versionCmp -- versionCmp
                  | "in" -- in
                  | ("not" space+ "in") -- notIn
    pythonStr     = "'" (pythonStrChar | "\\"")* "'"
                  | "\\"" (pythonStrChar | "'")* "\\""
    pythonStrChar = space | alnum | "(" | ")" | "." | "{" | "}" | "-" | "_" | "*" | "#" | ":" | ";" | "," | "/" | "?"
                  | "[" | "]" | "!" | "~" | "\`" | "@" | "$" | "%" | "^" | "&" | "=" | "+" | "|" | "<" | ">"
    envVar        = "python_version" | "python_full_version" | "os_name" | "sys_platform" | "platform_release"
                  | "platform_system" | "platform_version" | "platform_machine" | "platform_python_implementation"
                  | "implementation_name" | "implementation_version" | "extra" // ONLY when defined by a containing layer

    // Version specifiers, defined in PEP 440 (https://peps.python.org/pep-0440/)
    VersionSpec   = "(" VersionMany ")" -- parenthesized
                  | VersionMany -- direct
    VersionMany   = ListOf<VersionOne, ",">
    VersionOne    = versionCmp version
    versionCmp    = "<=" | "<" | "!=" | "==" | ">=" | ">" | "~=" | "==="
    version       = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+

    comment = "#" (~"\\n" any)*

    space := " " | "\\t" // Overriding Ohm's definition of whitespace to kick out newlines and other Unicode whitespace

    // Loose grammar for parsing unfinished requirements - focused on extracting the name, extras, and version spec
    LooseFile         = ListOf<LooseLine, "\\n">
    LooseLine         = LooseReq comment?
    LooseReq          = LooseNonNameReq | LooseNameReq
    LooseNameReq      = Name LooseExtras? LooseVersionSpec LooseQuotedMarker?
    LooseNonNameReq   = (~(~(Name "@") Name) looseAnything) // Non-name req can start with Name only if followed by "@"
    LooseExtras       = "[" ListOf<identifier, ","> ","* "]"?
    LooseQuotedMarker = ";" looseAnything
    LooseVersionSpec  = "(" LooseVersionMany ")"? -- parenthesized
                      | LooseVersionMany -- direct
    LooseVersionMany  = ListOf<LooseVersionOne, ","> ","*
    LooseVersionOne   = looseVersionCmp looseVersion?
    looseVersionCmp   = ("<" | "=" | "!" | ">" | "~")+
    looseVersion      = (alnum | "-" | "_" | "." | "*" | "+" | "!" )+
    looseAnything     = (~("\\n" | "#") any)* // Any non-comment line content
}`},"PEP508",null,"File",{File:["define",{sourceInterval:[148,173]},null,[],["app",{sourceInterval:[155,173]},"ListOf",[["app",{sourceInterval:[162,166]},"Line",[]],["terminal",{sourceInterval:[168,172]},`
`]]]],Line:["define",{sourceInterval:[178,198]},null,[],["seq",{sourceInterval:[185,198]},["opt",{sourceInterval:[185,189]},["app",{sourceInterval:[185,188]},"Req",[]]],["opt",{sourceInterval:[190,198]},["app",{sourceInterval:[190,197]},"comment",[]]]]],Req:["define",{sourceInterval:[203,260]},null,[],["alt",{sourceInterval:[209,260]},["app",{sourceInterval:[209,215]},"UrlReq",[]],["app",{sourceInterval:[218,225]},"NameReq",[]],["app",{sourceInterval:[228,243]},"RequirementsReq",[]],["app",{sourceInterval:[246,260]},"ConstraintsReq",[]]]],NameReq:["define",{sourceInterval:[266,314]},null,[],["seq",{sourceInterval:[276,314]},["app",{sourceInterval:[276,280]},"Name",[]],["opt",{sourceInterval:[281,288]},["app",{sourceInterval:[281,287]},"Extras",[]]],["app",{sourceInterval:[289,300]},"VersionSpec",[]],["opt",{sourceInterval:[301,314]},["app",{sourceInterval:[301,313]},"QuotedMarker",[]]]]],UrlReq:["define",{sourceInterval:[319,371]},null,[],["seq",{sourceInterval:[329,371]},["app",{sourceInterval:[329,333]},"Name",[]],["opt",{sourceInterval:[334,341]},["app",{sourceInterval:[334,340]},"Extras",[]]],["app",{sourceInterval:[342,349]},"UrlSpec",[]],["opt",{sourceInterval:[350,371]},["seq",{sourceInterval:[351,369]},["app",{sourceInterval:[351,356]},"space",[]],["app",{sourceInterval:[357,369]},"QuotedMarker",[]]]]]],Extras:["define",{sourceInterval:[376,417]},null,[],["seq",{sourceInterval:[386,417]},["terminal",{sourceInterval:[386,389]},"["],["app",{sourceInterval:[390,413]},"ListOf",[["app",{sourceInterval:[397,407]},"identifier",[]],["terminal",{sourceInterval:[409,412]},","]]],["terminal",{sourceInterval:[414,417]},"]"]]],Name:["define",{sourceInterval:[422,442]},null,[],["app",{sourceInterval:[432,442]},"identifier",[]]],identifier:["define",{sourceInterval:[447,483]},null,[],["seq",{sourceInterval:[463,483]},["app",{sourceInterval:[463,468]},"alnum",[]],["star",{sourceInterval:[469,483]},["app",{sourceInterval:[469,482]},"identifierEnd",[]]]]],identifierEnd_single:["define",{sourceInterval:[504,519]},null,[],["app",{sourceInterval:[504,509]},"alnum",[]]],identifierEnd_multi:["define",{sourceInterval:[540,576]},null,[],["seq",{sourceInterval:[540,567]},["star",{sourceInterval:[541,560]},["alt",{sourceInterval:[542,557]},["terminal",{sourceInterval:[542,545]},"-"],["terminal",{sourceInterval:[548,551]},"_"],["terminal",{sourceInterval:[554,557]},"."]]],["app",{sourceInterval:[561,566]},"alnum",[]]]],identifierEnd:["define",{sourceInterval:[488,576]},null,[],["alt",{sourceInterval:[504,576]},["app",{sourceInterval:[504,509]},"identifierEnd_single",[]],["app",{sourceInterval:[540,567]},"identifierEnd_multi",[]]]],RequirementsReq:["define",{sourceInterval:[675,706]},null,[],["seq",{sourceInterval:[693,706]},["terminal",{sourceInterval:[693,697]},"-r"],["app",{sourceInterval:[698,706]},"filePath",[]]]],ConstraintsReq:["define",{sourceInterval:[711,742]},null,[],["seq",{sourceInterval:[729,742]},["terminal",{sourceInterval:[729,733]},"-c"],["app",{sourceInterval:[734,742]},"filePath",[]]]],filePath:["define",{sourceInterval:[747,785]},null,[],["plus",{sourceInterval:[765,785]},["seq",{sourceInterval:[766,783]},["not",{sourceInterval:[766,779]},["alt",{sourceInterval:[768,778]},["terminal",{sourceInterval:[768,772]},`
`],["terminal",{sourceInterval:[775,778]},"#"]]],["app",{sourceInterval:[780,783]},"any",[]]]]],UrlSpec:["define",{sourceInterval:[791,822]},null,[],["seq",{sourceInterval:[806,822]},["terminal",{sourceInterval:[806,809]},"@"],["app",{sourceInterval:[810,822]},"uriReference",[]]]],uriReference:["define",{sourceInterval:[827,859]},null,[],["alt",{sourceInterval:[842,859]},["app",{sourceInterval:[842,845]},"uri",[]],["app",{sourceInterval:[848,859]},"relativeRef",[]]]],uri:["define",{sourceInterval:[864,929]},null,[],["seq",{sourceInterval:[879,929]},["app",{sourceInterval:[879,885]},"scheme",[]],["terminal",{sourceInterval:[886,889]},":"],["opt",{sourceInterval:[890,899]},["app",{sourceInterval:[890,898]},"hierPart",[]]],["opt",{sourceInterval:[900,913]},["seq",{sourceInterval:[901,910]},["terminal",{sourceInterval:[901,904]},"?"],["app",{sourceInterval:[905,910]},"query",[]]]],["opt",{sourceInterval:[914,929]},["seq",{sourceInterval:[915,927]},["terminal",{sourceInterval:[915,918]},"#"],["app",{sourceInterval:[919,927]},"fragment",[]]]]]],hierPart_abempty:["define",{sourceInterval:[949,988]},null,[],["seq",{sourceInterval:[949,977]},["terminal",{sourceInterval:[950,954]},"//"],["app",{sourceInterval:[955,964]},"authority",[]],["app",{sourceInterval:[965,976]},"pathAbempty",[]]]],hierPart_absolute:["define",{sourceInterval:[1008,1032]},null,[],["app",{sourceInterval:[1008,1020]},"pathAbsolute",[]]],hierPart_rootless:["define",{sourceInterval:[1052,1076]},null,[],["app",{sourceInterval:[1052,1064]},"pathRootless",[]]],hierPart:["define",{sourceInterval:[934,1076]},null,[],["alt",{sourceInterval:[949,1076]},["app",{sourceInterval:[949,977]},"hierPart_abempty",[]],["app",{sourceInterval:[1008,1020]},"hierPart_absolute",[]],["app",{sourceInterval:[1052,1064]},"hierPart_rootless",[]]]],absoluteUri:["define",{sourceInterval:[1081,1130]},null,[],["seq",{sourceInterval:[1096,1130]},["app",{sourceInterval:[1096,1102]},"scheme",[]],["terminal",{sourceInterval:[1103,1106]},":"],["opt",{sourceInterval:[1107,1116]},["app",{sourceInterval:[1107,1115]},"hierPart",[]]],["opt",{sourceInterval:[1117,1130]},["seq",{sourceInterval:[1118,1127]},["terminal",{sourceInterval:[1118,1121]},"?"],["app",{sourceInterval:[1122,1127]},"query",[]]]]]],relativeRef:["define",{sourceInterval:[1135,1194]},null,[],["seq",{sourceInterval:[1150,1194]},["opt",{sourceInterval:[1150,1163]},["app",{sourceInterval:[1150,1162]},"relativePart",[]]],["opt",{sourceInterval:[1164,1177]},["seq",{sourceInterval:[1165,1174]},["terminal",{sourceInterval:[1165,1168]},"?"],["app",{sourceInterval:[1169,1174]},"query",[]]]],["opt",{sourceInterval:[1178,1194]},["seq",{sourceInterval:[1179,1191]},["terminal",{sourceInterval:[1179,1182]},"#"],["app",{sourceInterval:[1183,1191]},"fragment",[]]]]]],relativePart_abempty:["define",{sourceInterval:[1214,1251]},null,[],["seq",{sourceInterval:[1214,1240]},["terminal",{sourceInterval:[1214,1218]},"//"],["app",{sourceInterval:[1219,1228]},"authority",[]],["app",{sourceInterval:[1229,1240]},"pathAbempty",[]]]],relativePart_absolute:["define",{sourceInterval:[1271,1295]},null,[],["app",{sourceInterval:[1271,1283]},"pathAbsolute",[]]],relativePart_noscheme:["define",{sourceInterval:[1315,1339]},null,[],["app",{sourceInterval:[1315,1327]},"pathNoscheme",[]]],relativePart:["define",{sourceInterval:[1199,1339]},null,[],["alt",{sourceInterval:[1214,1339]},["app",{sourceInterval:[1214,1240]},"relativePart_abempty",[]],["app",{sourceInterval:[1271,1283]},"relativePart_absolute",[]],["app",{sourceInterval:[1315,1327]},"relativePart_noscheme",[]]]],scheme:["define",{sourceInterval:[1344,1392]},null,[],["seq",{sourceInterval:[1359,1392]},["app",{sourceInterval:[1359,1365]},"letter",[]],["star",{sourceInterval:[1366,1392]},["alt",{sourceInterval:[1367,1390]},["app",{sourceInterval:[1367,1372]},"alnum",[]],["terminal",{sourceInterval:[1375,1378]},"+"],["terminal",{sourceInterval:[1381,1384]},"-"],["terminal",{sourceInterval:[1387,1390]},"."]]]]],authority:["define",{sourceInterval:[1397,1446]},null,[],["seq",{sourceInterval:[1412,1446]},["opt",{sourceInterval:[1412,1428]},["seq",{sourceInterval:[1413,1425]},["app",{sourceInterval:[1413,1421]},"userinfo",[]],["terminal",{sourceInterval:[1422,1425]},"@"]]],["app",{sourceInterval:[1429,1433]},"host",[]],["opt",{sourceInterval:[1434,1446]},["seq",{sourceInterval:[1435,1443]},["terminal",{sourceInterval:[1435,1438]},":"],["app",{sourceInterval:[1439,1443]},"port",[]]]]]],userinfo:["define",{sourceInterval:[1451,1510]},null,[],["star",{sourceInterval:[1466,1510]},["alt",{sourceInterval:[1467,1508]},["app",{sourceInterval:[1467,1477]},"unreserved",[]],["app",{sourceInterval:[1480,1490]},"pctEncoded",[]],["app",{sourceInterval:[1493,1502]},"subDelims",[]],["terminal",{sourceInterval:[1505,1508]},":"]]]],host:["define",{sourceInterval:[1515,1563]},null,[],["alt",{sourceInterval:[1530,1563]},["app",{sourceInterval:[1530,1539]},"ipLiteral",[]],["app",{sourceInterval:[1542,1553]},"ipv4Address",[]],["app",{sourceInterval:[1556,1563]},"regName",[]]]],port:["define",{sourceInterval:[1568,1589]},null,[],["star",{sourceInterval:[1583,1589]},["app",{sourceInterval:[1583,1588]},"digit",[]]]],ipLiteral:["define",{sourceInterval:[1594,1642]},null,[],["seq",{sourceInterval:[1609,1642]},["terminal",{sourceInterval:[1609,1612]},"["],["alt",{sourceInterval:[1614,1637]},["app",{sourceInterval:[1614,1625]},"ipv6Address",[]],["app",{sourceInterval:[1628,1637]},"ipvFuture",[]]],["terminal",{sourceInterval:[1639,1642]},"]"]]],ipvFuture:["define",{sourceInterval:[1647,1709]},null,[],["seq",{sourceInterval:[1662,1709]},["terminal",{sourceInterval:[1662,1665]},"v"],["plus",{sourceInterval:[1666,1673]},["app",{sourceInterval:[1666,1672]},"hexdig",[]]],["terminal",{sourceInterval:[1674,1677]},"."],["plus",{sourceInterval:[1678,1709]},["alt",{sourceInterval:[1679,1707]},["app",{sourceInterval:[1679,1689]},"unreserved",[]],["app",{sourceInterval:[1692,1701]},"subDelims",[]],["terminal",{sourceInterval:[1704,1707]},":"]]]]],ipv6Address:["define",{sourceInterval:[1714,1750]},null,[],["plus",{sourceInterval:[1729,1750]},["alt",{sourceInterval:[1730,1748]},["app",{sourceInterval:[1730,1736]},"hexdig",[]],["terminal",{sourceInterval:[1739,1742]},":"],["terminal",{sourceInterval:[1745,1748]},"."]]]],ipv4Address:["define",{sourceInterval:[1825,1887]},null,[],["seq",{sourceInterval:[1840,1887]},["app",{sourceInterval:[1840,1848]},"decOctet",[]],["terminal",{sourceInterval:[1849,1852]},"."],["app",{sourceInterval:[1853,1861]},"decOctet",[]],["terminal",{sourceInterval:[1862,1865]},"."],["app",{sourceInterval:[1866,1874]},"decOctet",[]],["terminal",{sourceInterval:[1875,1878]},"."],["app",{sourceInterval:[1879,1887]},"decOctet",[]]]],nz:["define",{sourceInterval:[1892,1917]},null,[],["seq",{sourceInterval:[1907,1917]},["not",{sourceInterval:[1907,1911]},["terminal",{sourceInterval:[1908,1911]},"0"]],["app",{sourceInterval:[1912,1917]},"digit",[]]]],decOctet_zeroToNine:["define",{sourceInterval:[1937,1956]},null,[],["app",{sourceInterval:[1937,1942]},"digit",[]]],decOctet_tenToNinetyNine:["define",{sourceInterval:[1976,2003]},null,[],["seq",{sourceInterval:[1976,1984]},["app",{sourceInterval:[1976,1978]},"nz",[]],["app",{sourceInterval:[1979,1984]},"digit",[]]]],decOctet_oneHundredToOneNinetyNine:["define",{sourceInterval:[2023,2067]},null,[],["seq",{sourceInterval:[2023,2038]},["terminal",{sourceInterval:[2023,2026]},"1"],["app",{sourceInterval:[2027,2032]},"digit",[]],["app",{sourceInterval:[2033,2038]},"digit",[]]]],decOctet_twoHundredToTwoFortyNine:["define",{sourceInterval:[2087,2154]},null,[],["seq",{sourceInterval:[2087,2126]},["terminal",{sourceInterval:[2087,2090]},"2"],["alt",{sourceInterval:[2092,2119]},["terminal",{sourceInterval:[2092,2095]},"0"],["terminal",{sourceInterval:[2098,2101]},"1"],["terminal",{sourceInterval:[2104,2107]},"2"],["terminal",{sourceInterval:[2110,2113]},"3"],["terminal",{sourceInterval:[2116,2119]},"4"]],["app",{sourceInterval:[2121,2126]},"digit",[]]]],decOctet_twoFiftyToTwoFiftyFive:["define",{sourceInterval:[2174,2240]},null,[],["seq",{sourceInterval:[2174,2214]},["terminal",{sourceInterval:[2174,2178]},"25"],["alt",{sourceInterval:[2180,2213]},["terminal",{sourceInterval:[2180,2183]},"0"],["terminal",{sourceInterval:[2186,2189]},"1"],["terminal",{sourceInterval:[2192,2195]},"2"],["terminal",{sourceInterval:[2198,2201]},"3"],["terminal",{sourceInterval:[2204,2207]},"4"],["terminal",{sourceInterval:[2210,2213]},"5"]]]],decOctet:["define",{sourceInterval:[1922,2240]},null,[],["alt",{sourceInterval:[1937,2240]},["app",{sourceInterval:[1937,1942]},"decOctet_zeroToNine",[]],["app",{sourceInterval:[1976,1984]},"decOctet_tenToNinetyNine",[]],["app",{sourceInterval:[2023,2038]},"decOctet_oneHundredToOneNinetyNine",[]],["app",{sourceInterval:[2087,2126]},"decOctet_twoHundredToTwoFortyNine",[]],["app",{sourceInterval:[2174,2214]},"decOctet_twoFiftyToTwoFiftyFive",[]]]],regName:["define",{sourceInterval:[2245,2298]},null,[],["star",{sourceInterval:[2260,2298]},["alt",{sourceInterval:[2261,2296]},["app",{sourceInterval:[2261,2271]},"unreserved",[]],["app",{sourceInterval:[2274,2284]},"pctEncoded",[]],["app",{sourceInterval:[2287,2296]},"subDelims",[]]]]],path:["define",{sourceInterval:[2303,2523]},null,[],["alt",{sourceInterval:[2318,2523]},["app",{sourceInterval:[2318,2329]},"pathAbempty",[]],["app",{sourceInterval:[2380,2392]},"pathAbsolute",[]],["app",{sourceInterval:[2444,2456]},"pathNoscheme",[]],["app",{sourceInterval:[2511,2523]},"pathRootless",[]]]],pathAbempty:["define",{sourceInterval:[2553,2582]},null,[],["star",{sourceInterval:[2568,2582]},["seq",{sourceInterval:[2569,2580]},["terminal",{sourceInterval:[2569,2572]},"/"],["app",{sourceInterval:[2573,2580]},"segment",[]]]]],pathAbsolute:["define",{sourceInterval:[2587,2634]},null,[],["seq",{sourceInterval:[2602,2634]},["terminal",{sourceInterval:[2602,2605]},"/"],["opt",{sourceInterval:[2606,2634]},["seq",{sourceInterval:[2607,2631]},["app",{sourceInterval:[2607,2616]},"segmentNz",[]],["star",{sourceInterval:[2617,2631]},["seq",{sourceInterval:[2618,2629]},["terminal",{sourceInterval:[2618,2621]},"/"],["app",{sourceInterval:[2622,2629]},"segment",[]]]]]]]],pathNoscheme:["define",{sourceInterval:[2639,2680]},null,[],["seq",{sourceInterval:[2654,2680]},["app",{sourceInterval:[2654,2665]},"segmentNzNc",[]],["star",{sourceInterval:[2666,2680]},["seq",{sourceInterval:[2667,2678]},["terminal",{sourceInterval:[2667,2670]},"/"],["app",{sourceInterval:[2671,2678]},"segment",[]]]]]],pathRootless:["define",{sourceInterval:[2685,2724]},null,[],["seq",{sourceInterval:[2700,2724]},["app",{sourceInterval:[2700,2709]},"segmentNz",[]],["star",{sourceInterval:[2710,2724]},["seq",{sourceInterval:[2711,2722]},["terminal",{sourceInterval:[2711,2714]},"/"],["app",{sourceInterval:[2715,2722]},"segment",[]]]]]],segment:["define",{sourceInterval:[2729,2750]},null,[],["star",{sourceInterval:[2744,2750]},["app",{sourceInterval:[2744,2749]},"pchar",[]]]],segmentNz:["define",{sourceInterval:[2755,2776]},null,[],["plus",{sourceInterval:[2770,2776]},["app",{sourceInterval:[2770,2775]},"pchar",[]]]],segmentNzNc:["define",{sourceInterval:[2781,2840]},null,[],["plus",{sourceInterval:[2796,2840]},["alt",{sourceInterval:[2797,2838]},["app",{sourceInterval:[2797,2807]},"unreserved",[]],["app",{sourceInterval:[2810,2820]},"pctEncoded",[]],["app",{sourceInterval:[2823,2832]},"subDelims",[]],["terminal",{sourceInterval:[2835,2838]},"@"]]]],pchar:["define",{sourceInterval:[2894,2956]},null,[],["alt",{sourceInterval:[2909,2956]},["app",{sourceInterval:[2909,2919]},"unreserved",[]],["app",{sourceInterval:[2922,2932]},"pctEncoded",[]],["app",{sourceInterval:[2935,2944]},"subDelims",[]],["terminal",{sourceInterval:[2947,2950]},":"],["terminal",{sourceInterval:[2953,2956]},"@"]]],query:["define",{sourceInterval:[2961,2996]},null,[],["star",{sourceInterval:[2976,2996]},["alt",{sourceInterval:[2977,2994]},["app",{sourceInterval:[2977,2982]},"pchar",[]],["terminal",{sourceInterval:[2985,2988]},"/"],["terminal",{sourceInterval:[2991,2994]},"?"]]]],fragment:["define",{sourceInterval:[3001,3036]},null,[],["star",{sourceInterval:[3016,3036]},["alt",{sourceInterval:[3017,3034]},["app",{sourceInterval:[3017,3022]},"pchar",[]],["terminal",{sourceInterval:[3025,3028]},"/"],["terminal",{sourceInterval:[3031,3034]},"?"]]]],pctEncoded:["define",{sourceInterval:[3041,3066]},null,[],["seq",{sourceInterval:[3056,3066]},["terminal",{sourceInterval:[3056,3059]},"%"],["app",{sourceInterval:[3060,3066]},"hexdig",[]]]],unreserved:["define",{sourceInterval:[3071,3115]},null,[],["alt",{sourceInterval:[3086,3115]},["app",{sourceInterval:[3086,3091]},"alnum",[]],["terminal",{sourceInterval:[3094,3097]},"-"],["terminal",{sourceInterval:[3100,3103]},"."],["terminal",{sourceInterval:[3106,3109]},"_"],["terminal",{sourceInterval:[3112,3115]},"~"]]],reserved:["define",{sourceInterval:[3120,3156]},null,[],["alt",{sourceInterval:[3135,3156]},["app",{sourceInterval:[3135,3144]},"genDelims",[]],["app",{sourceInterval:[3147,3156]},"subDelims",[]]]],genDelims:["define",{sourceInterval:[3161,3216]},null,[],["alt",{sourceInterval:[3176,3216]},["terminal",{sourceInterval:[3176,3179]},":"],["terminal",{sourceInterval:[3182,3185]},"/"],["terminal",{sourceInterval:[3188,3191]},"?"],["terminal",{sourceInterval:[3194,3197]},"#"],["terminal",{sourceInterval:[3200,3203]},"("],["terminal",{sourceInterval:[3206,3210]},")?"],["terminal",{sourceInterval:[3213,3216]},"@"]]],subDelims:["define",{sourceInterval:[3221,3299]},null,[],["alt",{sourceInterval:[3236,3299]},["terminal",{sourceInterval:[3236,3239]},"!"],["terminal",{sourceInterval:[3242,3245]},"$"],["terminal",{sourceInterval:[3248,3251]},"&"],["terminal",{sourceInterval:[3254,3257]},"'"],["terminal",{sourceInterval:[3260,3263]},"("],["terminal",{sourceInterval:[3266,3269]},")"],["terminal",{sourceInterval:[3272,3275]},"*"],["terminal",{sourceInterval:[3278,3281]},"+"],["terminal",{sourceInterval:[3284,3287]},","],["terminal",{sourceInterval:[3290,3293]},";"],["terminal",{sourceInterval:[3296,3299]},"="]]],hexdig:["define",{sourceInterval:[3304,3396]},null,[],["alt",{sourceInterval:[3319,3396]},["app",{sourceInterval:[3319,3324]},"digit",[]],["terminal",{sourceInterval:[3327,3330]},"a"],["terminal",{sourceInterval:[3333,3336]},"A"],["terminal",{sourceInterval:[3339,3342]},"b"],["terminal",{sourceInterval:[3345,3348]},"B"],["terminal",{sourceInterval:[3351,3354]},"c"],["terminal",{sourceInterval:[3357,3360]},"C"],["terminal",{sourceInterval:[3363,3366]},"d"],["terminal",{sourceInterval:[3369,3372]},"D"],["terminal",{sourceInterval:[3375,3378]},"e"],["terminal",{sourceInterval:[3381,3384]},"E"],["terminal",{sourceInterval:[3387,3390]},"f"],["terminal",{sourceInterval:[3393,3396]},"F"]]],QuotedMarker:["define",{sourceInterval:[3429,3455]},null,[],["seq",{sourceInterval:[3445,3455]},["terminal",{sourceInterval:[3445,3448]},";"],["app",{sourceInterval:[3449,3455]},"Marker",[]]]],Marker:["define",{sourceInterval:[3460,3484]},null,[],["app",{sourceInterval:[3476,3484]},"MarkerOr",[]]],MarkerOr_node:["define",{sourceInterval:[3505,3537]},null,[],["seq",{sourceInterval:[3505,3529]},["app",{sourceInterval:[3505,3514]},"MarkerAnd",[]],["terminal",{sourceInterval:[3515,3519]},"or"],["app",{sourceInterval:[3520,3529]},"MarkerAnd",[]]]],MarkerOr_leaf:["define",{sourceInterval:[3558,3575]},null,[],["app",{sourceInterval:[3558,3567]},"MarkerAnd",[]]],MarkerOr:["define",{sourceInterval:[3489,3575]},null,[],["alt",{sourceInterval:[3505,3575]},["app",{sourceInterval:[3505,3529]},"MarkerOr_node",[]],["app",{sourceInterval:[3558,3567]},"MarkerOr_leaf",[]]]],MarkerAnd_node:["define",{sourceInterval:[3596,3631]},null,[],["seq",{sourceInterval:[3596,3623]},["app",{sourceInterval:[3596,3606]},"MarkerExpr",[]],["terminal",{sourceInterval:[3607,3612]},"and"],["app",{sourceInterval:[3613,3623]},"MarkerExpr",[]]]],MarkerAnd_leaf:["define",{sourceInterval:[3652,3670]},null,[],["app",{sourceInterval:[3652,3662]},"MarkerExpr",[]]],MarkerAnd:["define",{sourceInterval:[3580,3670]},null,[],["alt",{sourceInterval:[3596,3670]},["app",{sourceInterval:[3596,3623]},"MarkerAnd_node",[]],["app",{sourceInterval:[3652,3662]},"MarkerAnd_leaf",[]]]],MarkerExpr_leaf:["define",{sourceInterval:[3691,3727]},null,[],["seq",{sourceInterval:[3691,3719]},["app",{sourceInterval:[3691,3700]},"MarkerVar",[]],["app",{sourceInterval:[3701,3709]},"markerOp",[]],["app",{sourceInterval:[3710,3719]},"MarkerVar",[]]]],MarkerExpr_node:["define",{sourceInterval:[3748,3770]},null,[],["seq",{sourceInterval:[3748,3762]},["terminal",{sourceInterval:[3748,3751]},"("],["app",{sourceInterval:[3752,3758]},"Marker",[]],["terminal",{sourceInterval:[3759,3762]},")"]]],MarkerExpr:["define",{sourceInterval:[3675,3770]},null,[],["alt",{sourceInterval:[3691,3770]},["app",{sourceInterval:[3691,3719]},"MarkerExpr_leaf",[]],["app",{sourceInterval:[3748,3762]},"MarkerExpr_node",[]]]],MarkerVar:["define",{sourceInterval:[3775,3809]},null,[],["alt",{sourceInterval:[3791,3809]},["app",{sourceInterval:[3791,3797]},"envVar",[]],["app",{sourceInterval:[3800,3809]},"pythonStr",[]]]],markerOp_versionCmp:["define",{sourceInterval:[3830,3854]},null,[],["app",{sourceInterval:[3830,3840]},"versionCmp",[]]],markerOp_in:["define",{sourceInterval:[3875,3885]},null,[],["terminal",{sourceInterval:[3875,3879]},"in"]],markerOp_notIn:["define",{sourceInterval:[3906,3934]},null,[],["seq",{sourceInterval:[3906,3925]},["terminal",{sourceInterval:[3907,3912]},"not"],["plus",{sourceInterval:[3913,3919]},["app",{sourceInterval:[3913,3918]},"space",[]]],["terminal",{sourceInterval:[3920,3924]},"in"]]],markerOp:["define",{sourceInterval:[3814,3934]},null,[],["alt",{sourceInterval:[3830,3934]},["app",{sourceInterval:[3830,3840]},"markerOp_versionCmp",[]],["app",{sourceInterval:[3875,3879]},"markerOp_in",[]],["app",{sourceInterval:[3906,3925]},"markerOp_notIn",[]]]],pythonStr:["define",{sourceInterval:[3939,4039]},null,[],["alt",{sourceInterval:[3955,4039]},["seq",{sourceInterval:[3955,3986]},["terminal",{sourceInterval:[3955,3958]},"'"],["star",{sourceInterval:[3959,3982]},["alt",{sourceInterval:[3960,3980]},["app",{sourceInterval:[3960,3973]},"pythonStrChar",[]],["terminal",{sourceInterval:[3976,3980]},'"']]],["terminal",{sourceInterval:[3983,3986]},"'"]],["seq",{sourceInterval:[4007,4039]},["terminal",{sourceInterval:[4007,4011]},'"'],["star",{sourceInterval:[4012,4034]},["alt",{sourceInterval:[4013,4032]},["app",{sourceInterval:[4013,4026]},"pythonStrChar",[]],["terminal",{sourceInterval:[4029,4032]},"'"]]],["terminal",{sourceInterval:[4035,4039]},'"']]]],pythonStrChar:["define",{sourceInterval:[4044,4265]},null,[],["alt",{sourceInterval:[4060,4265]},["app",{sourceInterval:[4060,4065]},"space",[]],["app",{sourceInterval:[4068,4073]},"alnum",[]],["terminal",{sourceInterval:[4076,4079]},"("],["terminal",{sourceInterval:[4082,4085]},")"],["terminal",{sourceInterval:[4088,4091]},"."],["terminal",{sourceInterval:[4094,4097]},"{"],["terminal",{sourceInterval:[4100,4103]},"}"],["terminal",{sourceInterval:[4106,4109]},"-"],["terminal",{sourceInterval:[4112,4115]},"_"],["terminal",{sourceInterval:[4118,4121]},"*"],["terminal",{sourceInterval:[4124,4127]},"#"],["terminal",{sourceInterval:[4130,4133]},":"],["terminal",{sourceInterval:[4136,4139]},";"],["terminal",{sourceInterval:[4142,4145]},","],["terminal",{sourceInterval:[4148,4151]},"/"],["terminal",{sourceInterval:[4154,4157]},"?"],["terminal",{sourceInterval:[4178,4181]},"["],["terminal",{sourceInterval:[4184,4187]},"]"],["terminal",{sourceInterval:[4190,4193]},"!"],["terminal",{sourceInterval:[4196,4199]},"~"],["terminal",{sourceInterval:[4202,4205]},"`"],["terminal",{sourceInterval:[4208,4211]},"@"],["terminal",{sourceInterval:[4214,4217]},"$"],["terminal",{sourceInterval:[4220,4223]},"%"],["terminal",{sourceInterval:[4226,4229]},"^"],["terminal",{sourceInterval:[4232,4235]},"&"],["terminal",{sourceInterval:[4238,4241]},"="],["terminal",{sourceInterval:[4244,4247]},"+"],["terminal",{sourceInterval:[4250,4253]},"|"],["terminal",{sourceInterval:[4256,4259]},"<"],["terminal",{sourceInterval:[4262,4265]},">"]]],envVar:["define",{sourceInterval:[4270,4570]},null,[],["alt",{sourceInterval:[4286,4570]},["terminal",{sourceInterval:[4286,4302]},"python_version"],["terminal",{sourceInterval:[4305,4326]},"python_full_version"],["terminal",{sourceInterval:[4329,4338]},"os_name"],["terminal",{sourceInterval:[4341,4355]},"sys_platform"],["terminal",{sourceInterval:[4358,4376]},"platform_release"],["terminal",{sourceInterval:[4397,4414]},"platform_system"],["terminal",{sourceInterval:[4417,4435]},"platform_version"],["terminal",{sourceInterval:[4438,4456]},"platform_machine"],["terminal",{sourceInterval:[4459,4491]},"platform_python_implementation"],["terminal",{sourceInterval:[4512,4533]},"implementation_name"],["terminal",{sourceInterval:[4536,4560]},"implementation_version"],["terminal",{sourceInterval:[4563,4570]},"extra"]]],VersionSpec_parenthesized:["define",{sourceInterval:[4717,4753]},null,[],["seq",{sourceInterval:[4717,4736]},["terminal",{sourceInterval:[4717,4720]},"("],["app",{sourceInterval:[4721,4732]},"VersionMany",[]],["terminal",{sourceInterval:[4733,4736]},")"]]],VersionSpec_direct:["define",{sourceInterval:[4774,4795]},null,[],["app",{sourceInterval:[4774,4785]},"VersionMany",[]]],VersionSpec:["define",{sourceInterval:[4701,4795]},null,[],["alt",{sourceInterval:[4717,4795]},["app",{sourceInterval:[4717,4736]},"VersionSpec_parenthesized",[]],["app",{sourceInterval:[4774,4785]},"VersionSpec_direct",[]]]],VersionMany:["define",{sourceInterval:[4800,4839]},null,[],["app",{sourceInterval:[4816,4839]},"ListOf",[["app",{sourceInterval:[4823,4833]},"VersionOne",[]],["terminal",{sourceInterval:[4835,4838]},","]]]],VersionOne:["define",{sourceInterval:[4844,4878]},null,[],["seq",{sourceInterval:[4860,4878]},["app",{sourceInterval:[4860,4870]},"versionCmp",[]],["app",{sourceInterval:[4871,4878]},"version",[]]]],versionCmp:["define",{sourceInterval:[4883,4951]},null,[],["alt",{sourceInterval:[4899,4951]},["terminal",{sourceInterval:[4899,4903]},"<="],["terminal",{sourceInterval:[4906,4909]},"<"],["terminal",{sourceInterval:[4912,4916]},"!="],["terminal",{sourceInterval:[4919,4923]},"=="],["terminal",{sourceInterval:[4926,4930]},">="],["terminal",{sourceInterval:[4933,4936]},">"],["terminal",{sourceInterval:[4939,4943]},"~="],["terminal",{sourceInterval:[4946,4951]},"==="]]],version:["define",{sourceInterval:[4956,5017]},null,[],["plus",{sourceInterval:[4972,5017]},["alt",{sourceInterval:[4973,5014]},["app",{sourceInterval:[4973,4978]},"alnum",[]],["terminal",{sourceInterval:[4981,4984]},"-"],["terminal",{sourceInterval:[4987,4990]},"_"],["terminal",{sourceInterval:[4993,4996]},"."],["terminal",{sourceInterval:[4999,5002]},"*"],["terminal",{sourceInterval:[5005,5008]},"+"],["terminal",{sourceInterval:[5011,5014]},"!"]]]],comment:["define",{sourceInterval:[5023,5049]},null,[],["seq",{sourceInterval:[5033,5049]},["terminal",{sourceInterval:[5033,5036]},"#"],["star",{sourceInterval:[5037,5049]},["seq",{sourceInterval:[5038,5047]},["not",{sourceInterval:[5038,5043]},["terminal",{sourceInterval:[5039,5043]},`
`]],["app",{sourceInterval:[5044,5047]},"any",[]]]]]],space:["override",{sourceInterval:[5055,5074]},null,[],["alt",{sourceInterval:[5064,5074]},["terminal",{sourceInterval:[5064,5067]}," "],["terminal",{sourceInterval:[5070,5074]},"	"]]],LooseFile:["define",{sourceInterval:[5291,5334]},null,[],["app",{sourceInterval:[5311,5334]},"ListOf",[["app",{sourceInterval:[5318,5327]},"LooseLine",[]],["terminal",{sourceInterval:[5329,5333]},`
`]]]],LooseLine:["define",{sourceInterval:[5339,5376]},null,[],["seq",{sourceInterval:[5359,5376]},["app",{sourceInterval:[5359,5367]},"LooseReq",[]],["opt",{sourceInterval:[5368,5376]},["app",{sourceInterval:[5368,5375]},"comment",[]]]]],LooseReq:["define",{sourceInterval:[5381,5431]},null,[],["alt",{sourceInterval:[5401,5431]},["app",{sourceInterval:[5401,5416]},"LooseNonNameReq",[]],["app",{sourceInterval:[5419,5431]},"LooseNameReq",[]]]],LooseNameReq:["define",{sourceInterval:[5436,5509]},null,[],["seq",{sourceInterval:[5456,5509]},["app",{sourceInterval:[5456,5460]},"Name",[]],["opt",{sourceInterval:[5461,5473]},["app",{sourceInterval:[5461,5472]},"LooseExtras",[]]],["app",{sourceInterval:[5474,5490]},"LooseVersionSpec",[]],["opt",{sourceInterval:[5491,5509]},["app",{sourceInterval:[5491,5508]},"LooseQuotedMarker",[]]]]],LooseNonNameReq:["define",{sourceInterval:[5514,5569]},null,[],["seq",{sourceInterval:[5534,5569]},["not",{sourceInterval:[5535,5554]},["seq",{sourceInterval:[5537,5553]},["not",{sourceInterval:[5537,5548]},["seq",{sourceInterval:[5539,5547]},["app",{sourceInterval:[5539,5543]},"Name",[]],["terminal",{sourceInterval:[5544,5547]},"@"]]],["app",{sourceInterval:[5549,5553]},"Name",[]]]],["app",{sourceInterval:[5555,5568]},"looseAnything",[]]]],LooseExtras:["define",{sourceInterval:[5634,5691]},null,[],["seq",{sourceInterval:[5654,5691]},["terminal",{sourceInterval:[5654,5657]},"["],["app",{sourceInterval:[5658,5681]},"ListOf",[["app",{sourceInterval:[5665,5675]},"identifier",[]],["terminal",{sourceInterval:[5677,5680]},","]]],["star",{sourceInterval:[5682,5686]},["terminal",{sourceInterval:[5682,5685]},","]],["opt",{sourceInterval:[5687,5691]},["terminal",{sourceInterval:[5687,5690]},"]"]]]],LooseQuotedMarker:["define",{sourceInterval:[5696,5733]},null,[],["seq",{sourceInterval:[5716,5733]},["terminal",{sourceInterval:[5716,5719]},";"],["app",{sourceInterval:[5720,5733]},"looseAnything",[]]]],LooseVersionSpec_parenthesized:["define",{sourceInterval:[5758,5800]},null,[],["seq",{sourceInterval:[5758,5783]},["terminal",{sourceInterval:[5758,5761]},"("],["app",{sourceInterval:[5762,5778]},"LooseVersionMany",[]],["opt",{sourceInterval:[5779,5783]},["terminal",{sourceInterval:[5779,5782]},")"]]]],LooseVersionSpec_direct:["define",{sourceInterval:[5825,5851]},null,[],["app",{sourceInterval:[5825,5841]},"LooseVersionMany",[]]],LooseVersionSpec:["define",{sourceInterval:[5738,5851]},null,[],["alt",{sourceInterval:[5758,5851]},["app",{sourceInterval:[5758,5783]},"LooseVersionSpec_parenthesized",[]],["app",{sourceInterval:[5825,5841]},"LooseVersionSpec_direct",[]]]],LooseVersionMany:["define",{sourceInterval:[5856,5909]},null,[],["seq",{sourceInterval:[5876,5909]},["app",{sourceInterval:[5876,5904]},"ListOf",[["app",{sourceInterval:[5883,5898]},"LooseVersionOne",[]],["terminal",{sourceInterval:[5900,5903]},","]]],["star",{sourceInterval:[5905,5909]},["terminal",{sourceInterval:[5905,5908]},","]]]],LooseVersionOne:["define",{sourceInterval:[5914,5963]},null,[],["seq",{sourceInterval:[5934,5963]},["app",{sourceInterval:[5934,5949]},"looseVersionCmp",[]],["opt",{sourceInterval:[5950,5963]},["app",{sourceInterval:[5950,5962]},"looseVersion",[]]]]],looseVersionCmp:["define",{sourceInterval:[5968,6018]},null,[],["plus",{sourceInterval:[5988,6018]},["alt",{sourceInterval:[5989,6016]},["terminal",{sourceInterval:[5989,5992]},"<"],["terminal",{sourceInterval:[5995,5998]},"="],["terminal",{sourceInterval:[6001,6004]},"!"],["terminal",{sourceInterval:[6007,6010]},">"],["terminal",{sourceInterval:[6013,6016]},"~"]]]],looseVersion:["define",{sourceInterval:[6023,6088]},null,[],["plus",{sourceInterval:[6043,6088]},["alt",{sourceInterval:[6044,6085]},["app",{sourceInterval:[6044,6049]},"alnum",[]],["terminal",{sourceInterval:[6052,6055]},"-"],["terminal",{sourceInterval:[6058,6061]},"_"],["terminal",{sourceInterval:[6064,6067]},"."],["terminal",{sourceInterval:[6070,6073]},"*"],["terminal",{sourceInterval:[6076,6079]},"+"],["terminal",{sourceInterval:[6082,6085]},"!"]]]],looseAnything:["define",{sourceInterval:[6093,6133]},null,[],["star",{sourceInterval:[6113,6133]},["seq",{sourceInterval:[6114,6131]},["not",{sourceInterval:[6114,6127]},["alt",{sourceInterval:[6116,6126]},["terminal",{sourceInterval:[6116,6120]},`
`],["terminal",{sourceInterval:[6123,6126]},"#"]]],["app",{sourceInterval:[6128,6131]},"any",[]]]]]}]),pep508_ohmBundle}var semantics={},hasRequiredSemantics;function requireSemantics(){return hasRequiredSemantics||(hasRequiredSemantics=1,(function(ee){var O=semantics&&semantics.__importDefault||function(et){return et&&et.__esModule?et:{default:et}};Object.defineProperty(ee,"__esModule",{value:!0}),ee.RequirementsSyntaxError=ee.semantics=void 0;const Y=O(requirePep508_ohmBundle());ee.semantics=Y.default.createSemantics();function te(et){return{startIdx:et.source.startIdx,endIdx:et.source.endIdx}}function ne(et,tt){return{data:tt,location:te(et)}}ee.semantics.addOperation("extract",{File:et=>et.asIteration().children.map(tt=>tt.extract()).filter(Boolean),Line:(et,tt)=>{var it;return((it=et.child(0))===null||it===void 0?void 0:it.extract())||null},NameReq:(et,tt,it,st)=>{var ot,rt;return{type:"ProjectName",name:et.sourceString,versionSpec:it.extract(),extras:(ot=tt.child(0))===null||ot===void 0?void 0:ot.extract(),environmentMarkerTree:(rt=st.child(0))===null||rt===void 0?void 0:rt.extract()}},UrlReq:(et,tt,it,st,ot)=>{var rt,nt;return{type:"ProjectURL",name:et.sourceString,url:it.extract(),extras:(rt=tt.child(0))===null||rt===void 0?void 0:rt.extract(),environmentMarkerTree:(nt=ot.child(0))===null||nt===void 0?void 0:nt.extract()}},Extras:(et,tt,it)=>tt.asIteration().children.map(st=>st.sourceString),RequirementsReq:(et,tt)=>({type:"RequirementsFile",path:tt.sourceString}),ConstraintsReq:(et,tt)=>({type:"ConstraintsFile",path:tt.sourceString}),UrlSpec:(et,tt)=>tt.sourceString,QuotedMarker:(et,tt)=>tt.extract(),MarkerOr_node:(et,tt,it)=>({operator:"or",left:et.extract(),right:it.extract()}),MarkerAnd_node:(et,tt,it)=>({operator:"and",left:et.extract(),right:it.extract()}),MarkerExpr_leaf:(et,tt,it)=>({left:et.sourceString,operator:tt.sourceString,right:it.sourceString}),MarkerExpr_node:(et,tt,it)=>tt.extract(),VersionSpec_parenthesized:(et,tt,it)=>tt.extract()||[],VersionMany:et=>{const tt=et.asIteration().children;if(tt.length!==0)return tt.map(it=>it.extract())},VersionOne:(et,tt)=>({operator:et.sourceString,version:tt.sourceString})}),ee.semantics.addOperation("extractLoosely",{LooseFile:et=>et.asIteration().children.map(tt=>tt.extractLoosely()).filter(Boolean),LooseLine:(et,tt)=>{var it;return((it=et.child(0))===null||it===void 0?void 0:it.extractLoosely())||null},LooseNameReq:(et,tt,it,st)=>{var ot;return{type:"ProjectName",name:et.sourceString,extras:(ot=tt.child(0))===null||ot===void 0?void 0:ot.extractLoosely(),versionSpec:it.extractLoosely()}},LooseNonNameReq:et=>null,LooseExtras:(et,tt,it,st)=>tt.asIteration().children.map(ot=>ot.sourceString),LooseVersionSpec_parenthesized:(et,tt,it)=>tt.extractLoosely()||[],LooseVersionMany:(et,tt)=>{const it=et.asIteration().children;if(it.length!==0)return it.map(st=>st.extractLoosely())},LooseVersionOne:(et,tt)=>{const it={operator:et.sourceString};return tt.sourceString&&(it.version=tt.sourceString),it}}),ee.semantics.addOperation("extractWithLocation",{File:et=>et.asIteration().children.map(tt=>tt.extractWithLocation()).filter(Boolean),Line:(et,tt)=>{var it;return((it=et.child(0))===null||it===void 0?void 0:it.extractWithLocation())||null},NameReq:function(et,tt,it,st){var ot,rt;return ne(this,{type:"ProjectName",name:ne(et,et.sourceString),versionSpec:it.extractWithLocation(),extras:(ot=tt.child(0))===null||ot===void 0?void 0:ot.extractWithLocation(),environmentMarkerTree:(rt=st.child(0))===null||rt===void 0?void 0:rt.extractWithLocation()})},UrlReq:function(et,tt,it,st,ot){var rt,nt;return ne(this,{type:"ProjectURL",name:ne(et,et.sourceString),url:it.extractWithLocation(),extras:(rt=tt.child(0))===null||rt===void 0?void 0:rt.extractWithLocation(),environmentMarkerTree:(nt=ot.child(0))===null||nt===void 0?void 0:nt.extractWithLocation()})},Extras:function(et,tt,it){return tt.asIteration().children.map(st=>ne(st,st.sourceString))},RequirementsReq:function(et,tt){return ne(this,{type:"RequirementsFile",path:tt.sourceString})},ConstraintsReq:function(et,tt){return ne(this,{type:"ConstraintsFile",path:tt.sourceString})},UrlSpec:function(et,tt){return ne(tt,tt.sourceString)},QuotedMarker:(et,tt)=>ne(tt,tt.extract()),VersionSpec_parenthesized:(et,tt,it)=>tt.extractWithLocation()||[],VersionMany:et=>{const tt=et.asIteration().children;if(tt.length!==0)return tt.map(it=>it.extractWithLocation())},VersionOne:function(et,tt){return ne(this,{operator:ne(et,et.sourceString),version:ne(tt,tt.sourceString)})}}),ee.semantics.addOperation("extractLooselyWithLocation",{LooseFile:et=>et.asIteration().children.map(tt=>tt.extractLooselyWithLocation()).filter(Boolean),LooseLine:(et,tt)=>{var it;return((it=et.child(0))===null||it===void 0?void 0:it.extractLooselyWithLocation())||null},LooseNameReq:function(et,tt,it,st){var ot;return ne(this,{type:"ProjectName",name:ne(et,et.sourceString),extras:(ot=tt.child(0))===null||ot===void 0?void 0:ot.extractLooselyWithLocation(),versionSpec:it.extractLooselyWithLocation()})},LooseNonNameReq:et=>null,LooseExtras:function(et,tt,it,st){return tt.asIteration().children.map(ot=>ne(ot,ot.sourceString))},LooseVersionSpec_parenthesized:(et,tt,it)=>tt.extractLooselyWithLocation()||[],LooseVersionMany:(et,tt)=>{const it=et.asIteration().children;if(it.length!==0)return it.map(st=>st.extractLooselyWithLocation())},LooseVersionOne:function(et,tt){return ne(this,{operator:ne(et,et.sourceString),...tt.sourceString?{version:ne(tt,tt.sourceString)}:{}})}});class xe extends Error{}ee.RequirementsSyntaxError=xe})(semantics)),semantics}var types$3={},hasRequiredTypes;function requireTypes(){if(hasRequiredTypes)return types$3;hasRequiredTypes=1,Object.defineProperty(types$3,"__esModule",{value:!0}),types$3.VersionOperator=types$3.EnvironmentMarkerVariable=void 0;var ee;(function(Y){Y.PythonVersion="python_version",Y.PythonFullVersion="python_full_version",Y.OsName="os_name",Y.SysPlatform="sys_platform",Y.PlatformRelease="platform_release",Y.PlatformSystem="platform_system",Y.PlatformVersion="platform_version",Y.PlatformMachine="platform_machine",Y.PlatformPythonImplementation="platform_python_implementation",Y.ImplementationName="implementation_name",Y.ImplementationVersion="implementation_version",Y.Extra="extra"})(ee||(types$3.EnvironmentMarkerVariable=ee={}));var O;return(function(Y){Y.CompatibleRelease="~=",Y.VersionMatching="==",Y.VersionExclusion="!=",Y.LessThanOrMatching="<=",Y.GreaterThanOrMatching=">=",Y.LessThan="<",Y.GreaterThan=">",Y.ArbitrarilyEqual="==="})(O||(types$3.VersionOperator=O={})),types$3}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,(function(ee){var O=dist&&dist.__createBinding||(Object.create?(function(rt,nt,at,ct){ct===void 0&&(ct=at);var ut=Object.getOwnPropertyDescriptor(nt,at);(!ut||("get"in ut?!nt.__esModule:ut.writable||ut.configurable))&&(ut={enumerable:!0,get:function(){return nt[at]}}),Object.defineProperty(rt,ct,ut)}):(function(rt,nt,at,ct){ct===void 0&&(ct=at),rt[ct]=nt[at]})),Y=dist&&dist.__exportStar||function(rt,nt){for(var at in rt)at!=="default"&&!Object.prototype.hasOwnProperty.call(nt,at)&&O(nt,rt,at)},te=dist&&dist.__importDefault||function(rt){return rt&&rt.__esModule?rt:{default:rt}};Object.defineProperty(ee,"__esModule",{value:!0}),ee.parsePipRequirementsLineLoosely=ee.parsePipRequirementsFileLoosely=ee.parsePipRequirementsLine=ee.parsePipRequirementsFile=ee.RequirementsSyntaxError=void 0;const ne=te(requirePep508_ohmBundle()),xe=requireSemantics();var et=requireSemantics();Object.defineProperty(ee,"RequirementsSyntaxError",{enumerable:!0,get:function(){return et.RequirementsSyntaxError}}),Y(requireTypes(),ee);function tt(rt,nt){const at=ne.default.match(rt,"File");if(at.failed())throw new xe.RequirementsSyntaxError(`Failed to parse requirements file. ${at.shortMessage}`);return nt?.includeLocations?(0,xe.semantics)(at).extractWithLocation():(0,xe.semantics)(at).extract()}ee.parsePipRequirementsFile=tt;function it(rt,nt){const at=ne.default.match(rt,"Line");if(at.failed())throw new xe.RequirementsSyntaxError(`Failed to parse requirements line. ${at.shortMessage}`);return nt?.includeLocations?(0,xe.semantics)(at).extractWithLocation():(0,xe.semantics)(at).extract()}ee.parsePipRequirementsLine=it;function st(rt,nt){const at=ne.default.match(rt,"LooseFile");if(at.failed())throw new xe.RequirementsSyntaxError(`Failed to loosely parse requirements file. ${at.shortMessage}`);return nt?.includeLocations?(0,xe.semantics)(at).extractLooselyWithLocation():(0,xe.semantics)(at).extractLoosely()}ee.parsePipRequirementsFileLoosely=st;function ot(rt,nt){const at=ne.default.match(rt,"LooseLine");if(at.failed())throw new xe.RequirementsSyntaxError(`Failed to loosely parse requirements line. ${at.shortMessage}`);return nt?.includeLocations?(0,xe.semantics)(at).extractLooselyWithLocation():(0,xe.semantics)(at).extractLoosely()}ee.parsePipRequirementsLineLoosely=ot})(dist)),dist}var distExports=requireDist();const index=getDefaultExportFromCjs$1(distExports),pipRequirements=_mergeNamespaces({__proto__:null,default:index},[distExports]),name$1="@kispace-io/appspace",version="1.1.24",dependencies={"@awesome.me/webawesome":"^3.0.0","@fortawesome/fontawesome-free":"^7.1.0","@fortawesome/fontawesome-svg-core":"^7.1.0","@fortawesome/free-solid-svg-icons":"^7.1.0","@langchain/textsplitters":"^1.0.0","@lit-labs/signals":"^0.1.3","@mlc-ai/web-llm":"^0.2.79","@xenova/transformers":"^2.17.2","@xterm/xterm":"^5.5.0",axios:"^1.13.1",dotenv:"^17.2.3","idb-keyval":"^6.2.2",jsonata:"^2.1.0",jszip:"^3.10.1",lit:"^3.2.1",marked:"^12.0.0 || ^16.4.1","monaco-editor":"0.55.1","pace-js":"^1.2.4","pdfjs-dist":"^4.0.0","pip-requirements-js":"^1.0.2",pyodide:"^0.27.7",rxdb:"^15.0.0",uuid:"^13.0.0","wasm-git":"^0.0.13"},devDependencies={typescript:"^5.9.3",vite:"^7.1.12","vite-plugin-dts":"^4.5.4"},appspacePackageJson={name:name$1,version,dependencies,devDependencies},SYSTEM_LANGUAGE_BUNDLES="system.language_bundles",SETTINGS_KEY_LANGUAGE="language";function replaceParameters(ee,O){return O?ee.replace(/\{(\w+)\}/g,(Y,te)=>O[te]!==void 0?O[te]:Y):ee}class LazyTranslation extends String{constructor(O,Y,te,ne){super(""),this.i18nService=O,this.namespace=Y,this.key=te,this.params=ne}toString(){const O=this.i18nService.currentLanguageSignal.get();return this.cachedValue!==void 0&&this.cachedLanguage===O?this.cachedValue:(this.cachedValue=this.i18nService.translate(this.namespace,this.key,this.params),this.cachedLanguage=O,this.cachedValue)}valueOf(){return this.toString()}[Symbol.toPrimitive](O){if(O==="number"){const Y=Number(this.toString());return isNaN(Y)?0:Y}return this.toString()}toJSON(){return this.toString()}}const _I18nService=class si{constructor(){this.translationCache=new Map,this.currentLanguageSignal=r$1(this.getBrowserLanguage()),this.languageContributionsSignal=r$1([]),this.initialize()}getBrowserLanguage(){return(navigator.language||navigator.languages?.[0]||si.DEFAULT_LANGUAGE).split("-")[0].toLowerCase()}async initializeLanguage(){return await appSettings.get(SETTINGS_KEY_LANGUAGE)||this.getBrowserLanguage()}async updateLanguageFromSettings(){const O=await this.initializeLanguage();this.currentLanguageSignal.set(O)}getPrimaryLanguage(O){return O.split("-")[0].toLowerCase()}updateLanguageContributions(){const O=contributionRegistry.getContributions(SYSTEM_LANGUAGE_BUNDLES);this.languageContributionsSignal.set(O)}createCacheKey(O,Y){return`${O}:${Y}`}mergeTranslationsForLanguage(O,Y,te){const ne=this.createCacheKey(Y,te),xe=this.translationCache.get(ne);if(xe!==void 0)return xe;const et={};for(const tt of O){if(tt.namespace!==Y)continue;let it;tt.translations&&tt.language===te?it=tt.translations:tt[te]&&typeof tt[te]=="object"&&(it=tt[te]),it&&Object.assign(et,it)}return this.translationCache.set(ne,et),et}invalidateTranslationCache(){this.translationCache.clear()}translate(O,Y,te){const ne=this.currentLanguageSignal.get(),xe=this.getPrimaryLanguage(ne),et=this.languageContributionsSignal.get();let tt;const it=this.mergeTranslationsForLanguage(et,O,ne);if(it[Y])tt=it[Y];else{const st=ne!==xe?this.mergeTranslationsForLanguage(et,O,xe):it;if(st[Y])tt=st[Y];else if(xe!==si.DEFAULT_LANGUAGE&&ne!==si.DEFAULT_LANGUAGE){const ot=this.mergeTranslationsForLanguage(et,O,si.DEFAULT_LANGUAGE);ot[Y]&&(tt=ot[Y])}}return tt?replaceParameters(tt,te):Y}initialize(){subscribe(TOPIC_SETTINGS_CHANGED,async O=>{const Y=O?.[SETTINGS_KEY_LANGUAGE]||this.getBrowserLanguage();this.currentLanguageSignal.set(Y),this.invalidateTranslationCache()}),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,O=>{O.target===SYSTEM_LANGUAGE_BUNDLES&&(this.invalidateTranslationCache(),this.updateLanguageContributions())}),this.updateLanguageFromSettings(),this.updateLanguageContributions()}i18n(O){return(Y,te)=>this.translate(O,Y,te)}i18nLazy(O){return(Y,te)=>new LazyTranslation(this,O,Y,te)}};_I18nService.DEFAULT_LANGUAGE="en";let I18nService=_I18nService;const i18nService=new I18nService;rootContext.put("i18nService",i18nService);const currentLanguageSignal=i18nService.currentLanguageSignal,languageContributionsSignal=i18nService.languageContributionsSignal,i18n=ee=>i18nService.i18n(ee),i18nLazy=ee=>i18nService.i18nLazy(ee),namespace$6="filebrowser",en$6={CONNECT_WORKSPACE:"Connect Workspace...",RELOAD_WORKSPACE:"Reload workspace folder",CREATE_NEW:"Create new...",RENAME_RESOURCE:"Rename selected resource",DELETE_RESOURCE:"Delete selected resource",OPEN:"Open",RENAME:"Rename",DELETE:"Delete",FILE:"File",FOLDER:"Folder",FILE_EXISTS_OVERWRITE:'File "{fileName}" already exists. Do you want to overwrite it?',SELECT_WORKSPACE:"Select a workspace.",DROP_FILES_HERE:" Drop files here"},de$6={CONNECT_WORKSPACE:"Arbeitsbereich verbinden...",RELOAD_WORKSPACE:"Arbeitsbereich-Ordner neu laden",CREATE_NEW:"Neu erstellen...",RENAME_RESOURCE:"Ausgewhlte Ressource umbenennen",DELETE_RESOURCE:"Ausgewhlte Ressource lschen",OPEN:"ffnen",RENAME:"Umbenennen",DELETE:"Lschen",FILE:"Datei",FOLDER:"Ordner",FILE_EXISTS_OVERWRITE:'Die Datei "{fileName}" existiert bereits. Mchten Sie sie berschreiben?',SELECT_WORKSPACE:"Whlen Sie einen Arbeitsbereich aus.",DROP_FILES_HERE:" Dateien hier ablegen"},filebrowserBundle={namespace:namespace$6,en:en$6,de:de$6},namespace$5="extensions",en$5={FILTER_PLACEHOLDER:"Filter extensions...",INSTALLED:"Installed",AVAILABLE:"Available",NO_MATCHES:'No extensions match "{filterText}"',EXTERNAL_EXTENSION:"External Extension",UNINSTALL:"Uninstall (requires restart)",REQUIRED_HINT:"This extension is required by the current app and cannot be uninstalled",INSTALL:"Install",EXPERIMENTAL:"This is an experimental extension!",VERSION:"Version:",AUTHOR:"Author:",DEPENDENCIES:"Dependencies",NOT_INSTALLED:"Not Installed",DEPENDENCIES_HINT:"Dependencies are automatically installed when this extension is enabled.",DISABLE_TITLE:"Disable this extension",ENABLE_TITLE:"Enable this extension",EXT_GIT_NAME:"Git Support",EXT_GIT_DESC:"Git commands and UI elements",EXT_GITHUB_SERVICE_NAME:"GitHub Service",EXT_GITHUB_SERVICE_DESC:"GitHub API service for fetching release information",EXT_PYTERMINAL_NAME:"Python terminal",EXT_PYTERMINAL_DESC:"Python terminal view",EXT_LINUXTERMINAL_NAME:"Linux terminal",EXT_LINUXTERMINAL_DESC:"Linux terminal view",EXT_WEBLLM_NAME:"WebLLM",EXT_WEBLLM_DESC:"In-Browser LLM inference",EXT_P12SPLITTER_NAME:".p12 file splitter",EXT_P12SPLITTER_DESC:"Adds a command to split/separate a .p12 file into private/public and additional .pem files",EXT_PYTHONPACKAGEMANAGER_NAME:"Python Package Manager",EXT_PYTHONPACKAGEMANAGER_DESC:"Manage Python packages for notebooks and other Python-based extensions",EXT_NOTEBOOK_NAME:"Jupyter-like Notebook Editor",EXT_NOTEBOOK_DESC:"View and execute Jupyter-like notebooks (.ipynb) with Python code execution and markdown rendering",EXT_COMMANDPALETTE_NAME:"Command Palette",EXT_COMMANDPALETTE_DESC:"VS Code-style command palette at the top center for quick command execution (Ctrl+Shift+P)",EXT_DOWNLOAD_NAME:"Download Files",EXT_DOWNLOAD_DESC:"Download files from URLs to the workspace",EXT_UNZIP_NAME:"Unzip Archives",EXT_UNZIP_DESC:"Extract zip archives to the workspace",EXT_MDEDITOR_NAME:"Markdown Editor",EXT_MDEDITOR_DESC:"View and render Markdown (.md) files",EXT_MEDIAVIEWER_NAME:"Media Viewer",EXT_MEDIAVIEWER_DESC:"View PDF, image, and HTML files in the browser",EXT_MONACO_NAME:"Monaco Code Editor",EXT_MONACO_DESC:"Code editor with syntax highlighting, code completion, and Python execution support",EXT_MEMORYUSAGE_NAME:"Memory Usage Monitor",EXT_MEMORYUSAGE_DESC:"Displays JavaScript heap memory usage in the bottom toolbar",EXT_WEBDAV_NAME:"WebDAV Workspace",EXT_WEBDAV_DESC:"Connect to WebDAV servers (Nextcloud, ownCloud) as workspace folders for cloud storage integration",EXT_SETTINGS_TREE_NAME:"Settings Tree Editor",EXT_SETTINGS_TREE_DESC:"Tree-based editor for settings with in-place editing",EXT_IN_BROWSER_ML_NAME:"In-Browser ML",EXT_IN_BROWSER_ML_DESC:"In-browser machine learning service using transformers.js for specialized tasks (zero-shot classification, embeddings, etc.)",EXT_AI_SYSTEM_NAME:"AI System",EXT_AI_SYSTEM_DESC:"Modern AI service with streaming support and agent workflows",EXT_RAG_SYSTEM_NAME:"RAG System",EXT_RAG_SYSTEM_DESC:"Retrieval-Augmented Generation system for document indexing, search and retrieval",EXT_HOWTO_NAME:"HowTo System",EXT_HOWTO_DESC:"Step-by-step workflow system with pre and post condition checks"},de$5={FILTER_PLACEHOLDER:"Erweiterungen filtern...",INSTALLED:"Installiert",AVAILABLE:"Verfgbar",NO_MATCHES:'Keine Erweiterungen entsprechen "{filterText}"',EXTERNAL_EXTENSION:"Externe Erweiterung",UNINSTALL:"Deinstallieren (Neustart erforderlich)",REQUIRED_HINT:"Diese Erweiterung ist fr die aktuelle App erforderlich und kann nicht deinstalliert werden",INSTALL:"Installieren",EXPERIMENTAL:"Dies ist eine experimentelle Erweiterung!",VERSION:"Version:",AUTHOR:"Autor:",DEPENDENCIES:"Abhngigkeiten",NOT_INSTALLED:"Nicht installiert",DEPENDENCIES_HINT:"Abhngigkeiten werden automatisch installiert, wenn diese Erweiterung aktiviert wird.",DISABLE_TITLE:"Diese Erweiterung deaktivieren",ENABLE_TITLE:"Diese Erweiterung aktivieren",EXT_GIT_NAME:"Git-Untersttzung",EXT_GIT_DESC:"Git-Befehle und UI-Elemente",EXT_GITHUB_SERVICE_NAME:"GitHub-Service",EXT_GITHUB_SERVICE_DESC:"GitHub-API-Service zum Abrufen von Release-Informationen",EXT_PYTERMINAL_NAME:"Python-Terminal",EXT_PYTERMINAL_DESC:"Python-Terminalansicht",EXT_LINUXTERMINAL_NAME:"Linux-Terminal",EXT_LINUXTERMINAL_DESC:"Linux-Terminalansicht",EXT_WEBLLM_NAME:"WebLLM",EXT_WEBLLM_DESC:"LLM-Inferenz im Browser",EXT_P12SPLITTER_NAME:".p12-Datei-Splitter",EXT_P12SPLITTER_DESC:"Fgt einen Befehl hinzu, um eine .p12-Datei in private/ffentliche und zustzliche .pem-Dateien zu trennen",EXT_PYTHONPACKAGEMANAGER_NAME:"Python-Paket-Manager",EXT_PYTHONPACKAGEMANAGER_DESC:"Verwaltet Python-Pakete fr Notebooks und andere Python-basierte Erweiterungen",EXT_NOTEBOOK_NAME:"Jupyter-hnlicher Notebook-Editor",EXT_NOTEBOOK_DESC:"Anzeigen und Ausfhren von Jupyter-hnlichen Notebooks (.ipynb) mit Python-Codeausfhrung und Markdown-Rendering",EXT_COMMANDPALETTE_NAME:"Befehls-Palette",EXT_COMMANDPALETTE_DESC:"VS Code-hnliche Befehls-Palette oben in der Mitte fr schnelle Befehlsausfhrung (Strg+Umschalt+P)",EXT_DOWNLOAD_NAME:"Dateien herunterladen",EXT_DOWNLOAD_DESC:"Dateien von URLs in den Arbeitsbereich herunterladen",EXT_UNZIP_NAME:"Archive entpacken",EXT_UNZIP_DESC:"Zip-Archive in den Arbeitsbereich extrahieren",EXT_MDEDITOR_NAME:"Markdown-Editor",EXT_MDEDITOR_DESC:"Anzeigen und Rendern von Markdown (.md) Dateien",EXT_MEDIAVIEWER_NAME:"Medien-Viewer",EXT_MEDIAVIEWER_DESC:"PDF-, Bild- und HTML-Dateien im Browser anzeigen",EXT_MONACO_NAME:"Monaco-Code-Editor",EXT_MONACO_DESC:"Code-Editor mit Syntaxhervorhebung, Code-Vervollstndigung und Python-Ausfhrungsuntersttzung",EXT_MEMORYUSAGE_NAME:"Speicherverbrauch-Monitor",EXT_MEMORYUSAGE_DESC:"Zeigt die JavaScript-Heap-Speichernutzung in der unteren Symbolleiste an",EXT_WEBDAV_NAME:"WebDAV-Arbeitsbereich",EXT_WEBDAV_DESC:"Verbinden Sie sich mit WebDAV-Servern (Nextcloud, ownCloud) als Arbeitsbereichsordner fr Cloud-Speicher-Integration",EXT_SETTINGS_TREE_NAME:"Einstellungs-Baum-Editor",EXT_SETTINGS_TREE_DESC:"Baumbasierter Editor fr Einstellungen mit direkter Bearbeitung",EXT_IN_BROWSER_ML_NAME:"ML im Browser",EXT_IN_BROWSER_ML_DESC:"Maschinelles Lernen im Browser mit transformers.js fr spezialisierte Aufgaben (Zero-Shot-Klassifizierung, Embeddings usw.)",EXT_AI_SYSTEM_NAME:"KI-System",EXT_AI_SYSTEM_DESC:"Modernes KI-Service mit Streaming-Untersttzung und Agent-Workflows",EXT_RAG_SYSTEM_NAME:"RAG-System",EXT_RAG_SYSTEM_DESC:"Retrieval-Augmented Generation System fr Dokumentenindizierung, Suche und Abruf",EXT_HOWTO_NAME:"HowTo-System",EXT_HOWTO_DESC:"Schritt-fr-Schritt-Workflow-System mit Vor- und Nachbedingungsprfungen"},extensionsBundle={namespace:namespace$5,en:en$5,de:de$5},namespace$4="tasks",en$4={ACTIVE_TASKS:"Active Tasks",ACTIVE_TASKS_TITLE:"Active tasks: {taskCount}. Click to view details."},de$4={ACTIVE_TASKS:"Aktive Aufgaben",ACTIVE_TASKS_TITLE:"Aktive Aufgaben: {taskCount}. Klicken Sie, um Details anzuzeigen."},tasksBundle={namespace:namespace$4,en:en$4,de:de$4},namespace$3="workspace",en$3={NO_WORKSPACE:"<no workspace>",LOAD_WORKSPACE:"Load workspace"},de$3={NO_WORKSPACE:"<kein Arbeitsbereich>",LOAD_WORKSPACE:"Arbeitsbereich laden"},workspaceBundle={namespace:namespace$3,en:en$3,de:de$3},namespace$2="fastviews",en$2={FAST_VIEWS:"Fast Views"},de$2={FAST_VIEWS:"Schnellansichten"},fastviewsBundle={namespace:namespace$2,en:en$2,de:de$2},namespace$1="logterminal",en$1={ALL_LOGS:"All logs",ALL:"All",INFO_LOGS:"Info logs",INFO:"Info",WARNING_LOGS:"Warning logs",WARNINGS:"Warnings",ERROR_LOGS:"Error logs",ERRORS:"Errors",DEBUG_LOGS:"Debug logs",DEBUG:"Debug",AUTO_SCROLL_ENABLED:"Auto-scroll enabled",AUTO_SCROLL_DISABLED:"Auto-scroll disabled",AUTO_SCROLL:"Auto-scroll",MANUAL:"Manual",CLEAR_LOGS:"Clear logs",CLEAR:"Clear",NO_LOG_MESSAGES:"No log messages"},de$1={ALL_LOGS:"Alle Protokolle",ALL:"Alle",INFO_LOGS:"Info-Protokolle",INFO:"Info",WARNING_LOGS:"Warnungsprotokolle",WARNINGS:"Warnungen",ERROR_LOGS:"Fehlerprotokolle",ERRORS:"Fehler",DEBUG_LOGS:"Debug-Protokolle",DEBUG:"Debug",AUTO_SCROLL_ENABLED:"Automatisches Scrollen aktiviert",AUTO_SCROLL_DISABLED:"Automatisches Scrollen deaktiviert",AUTO_SCROLL:"Automatisches Scrollen",MANUAL:"Manuell",CLEAR_LOGS:"Protokolle lschen",CLEAR:"Lschen",NO_LOG_MESSAGES:"Keine Protokollnachrichten"},logterminalBundle={namespace:namespace$1,en:en$1,de:de$1},namespace="partname",en={NO_PART:"<no part>",ACTIVE_PART:"Active part"},de={NO_PART:"<kein Bereich>",ACTIVE_PART:"Aktiver Bereich"},partnameBundle={namespace,en,de};contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,filebrowserBundle);contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,extensionsBundle);contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,tasksBundle);contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,workspaceBundle);contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,fastviewsBundle);contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,logterminalBundle);contributionRegistry.registerContribution(SYSTEM_LANGUAGE_BUNDLES,partnameBundle);class KeyBindingManager{constructor(){this.bindings=new Map,this.enabled=!0,document.addEventListener("keydown",this.handleKeyDown.bind(this),!0),this.registerExistingCommandBindings(),this.watchCommandRegistry()}registerExistingCommandBindings(){const O=commandRegistry.listCommands();Object.values(O).forEach(Y=>{Y.keyBinding&&this.registerKeyBinding(Y.id,Y.keyBinding)})}watchCommandRegistry(){const O=commandRegistry.registerCommand.bind(commandRegistry);commandRegistry.registerCommand=Y=>{O(Y),Y.keyBinding&&this.registerKeyBinding(Y.id,Y.keyBinding)}}parseKeyBinding(O){if(!O||O.trim()==="")return null;const Y=O.toUpperCase().split("+").map(et=>et.trim());if(Y.length===0)return null;const te={ctrl:!1,alt:!1,shift:!1,meta:!1},ne=Y[Y.length-1],xe=Y.slice(0,-1);for(const et of xe)switch(et){case"CTRL":case"CONTROL":te.ctrl=!0;break;case"ALT":case"OPTION":te.alt=!0;break;case"SHIFT":te.shift=!0;break;case"META":case"CMD":case"COMMAND":case"WIN":case"WINDOWS":te.meta=!0;break;default:defaultLogger.warn(`Unknown modifier: ${et}`)}return te.key=this.normalizeKey(ne),te}normalizeKey(O){return{SPACE:" ",ESC:"ESCAPE",RETURN:"ENTER",LEFT:"ARROWLEFT",RIGHT:"ARROWRIGHT",UP:"ARROWUP",DOWN:"ARROWDOWN",DEL:"DELETE",INS:"INSERT",PAGEUP:"PAGEUP",PAGEDOWN:"PAGEDOWN"}[O]||O}getBindingKey(O){const Y=[];return O.ctrl&&Y.push("ctrl"),O.alt&&Y.push("alt"),O.shift&&Y.push("shift"),O.meta&&Y.push("meta"),Y.sort(),`${Y.join("+")}+${O.key.toUpperCase()}`}registerKeyBinding(O,Y){const te=this.parseKeyBinding(Y);if(!te)return defaultLogger.error(`Invalid key binding: ${Y}`),!1;te.commandId=O;const ne=this.getBindingKey(te);this.bindings.has(ne)||this.bindings.set(ne,[]);const xe=this.bindings.get(ne);return xe.find(tt=>tt.commandId===O)?(defaultLogger.error(`Key binding ${Y} already registered for command ${O}`),!1):(xe.push(te),defaultLogger.debug(`Key binding registered: ${Y} -> ${O}`),!0)}unregisterKeyBinding(O,Y){if(Y){const te=this.parseKeyBinding(Y);if(te){const ne=this.getBindingKey(te),xe=this.bindings.get(ne);if(xe){const et=xe.filter(tt=>tt.commandId!==O);et.length===0?this.bindings.delete(ne):this.bindings.set(ne,et)}}}else for(const[te,ne]of this.bindings.entries()){const xe=ne.filter(et=>et.commandId!==O);xe.length===0?this.bindings.delete(te):this.bindings.set(te,xe)}}getKeyBindingsForCommand(O){const Y=[];for(const te of this.bindings.values())for(const ne of te)ne.commandId===O&&Y.push(this.formatKeyBinding(ne));return Y}formatKeyBinding(O){const Y=[];O.ctrl&&Y.push("Ctrl"),O.alt&&Y.push("Alt"),O.shift&&Y.push("Shift"),O.meta&&Y.push("Cmd");let te=O.key;return te.length===1?te=te.toUpperCase():te=te.charAt(0).toUpperCase()+te.slice(1).toLowerCase(),Y.push(te),Y.join("+")}handleKeyDown(O){if(!this.enabled)return;const Y=O.target;if(Y&&(Y.tagName==="INPUT"||Y.tagName==="TEXTAREA"||Y.isContentEditable)){const et=O.key.toUpperCase();if(!((O.ctrlKey||O.metaKey)&&O.shiftKey&&et==="P"))return}const te={commandId:"",key:this.normalizeKey(O.key.toUpperCase()),ctrl:O.ctrlKey,alt:O.altKey,shift:O.shiftKey,meta:O.metaKey},ne=this.getBindingKey(te),xe=this.bindings.get(ne);if(xe&&xe.length>0){const et=xe[0];try{O.preventDefault(),O.stopPropagation();const tt=commandRegistry.createExecutionContext({});commandRegistry.execute(et.commandId,tt),defaultLogger.info(`Executed command via key binding: ${et.commandId}`)}catch(tt){defaultLogger.error(`Failed to execute command ${et.commandId}: ${tt.message}`)}}}setEnabled(O){this.enabled=O}isEnabled(){return this.enabled}getAllBindings(){return new Map(this.bindings)}clearAll(){this.bindings.clear()}}defaultLogger.debug("KeyBindingManager initializing...");const keyBindingManager=new KeyBindingManager;defaultLogger.debug("KeyBindingManager initialized");rootContext.put("keyBindingManager",keyBindingManager);const treeNodeComparator=(ee,O)=>!ee.leaf&&O.leaf?-1:ee.leaf&&!O.leaf?1:ee.label.localeCompare(O.label);class EditorRegistry{constructor(){this.editorInputHandlers=[],this.listenersAttached=!1,this.cachedIconContributions=null,subscribe(TOPIC_WORKSPACE_CONNECTED,()=>{}),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,O=>{O.target==="system.icons"&&(this.cachedIconContributions=null)})}getSortedIconContributions(){if(this.cachedIconContributions!==null)return this.cachedIconContributions;const O=contributionRegistry.getContributions("system.icons");return this.cachedIconContributions=[...O].sort((Y,te)=>{const ne=Y.priority??0,xe=te.priority??0;return xe!==ne?xe-ne:Y.label.localeCompare(te.label)}),this.cachedIconContributions}setupEventListeners(O){if(this.listenersAttached)return;this.listenersAttached=!0;const Y=xe=>{const et=xe.detail;et&&Array.from(et.querySelectorAll("*")).filter(it=>it instanceof KPart).forEach(it=>{activePartSignal.set(it),it.isEditor&&activeEditorSignal.set(it)})};O.addEventListener("tab-shown",Y);const te=xe=>{const et=xe.detail;Array.from(et.querySelectorAll("*")).filter(it=>it instanceof KPart).forEach(it=>{activePartSignal.get()==it&&activePartSignal.set(null),activeEditorSignal.get()==it&&activeEditorSignal.set(null)})};O.addEventListener("tab-closed",te);const ne=xe=>{const tt=xe.closest("wa-tab-panel").getAttribute("name");O.markDirty(tt,xe.isDirty())};this.signalCleanup=watchSignal(partDirtySignal,ne)}registerEditorInputHandler(O){this.editorInputHandlers.push(O),this.editorInputHandlers.sort((Y,te)=>(te.ranking??0)-(Y.ranking??0))}async handleInput(O){for(let Y=0;Y<this.editorInputHandlers.length;Y++){const te=this.editorInputHandlers[Y];if(te.canHandle(O))return await te.handle(O)}}getEditorArea(){return document.querySelector(`k-tabs#${EDITOR_AREA_MAIN}`)}async loadEditor(O){if(!O||("widgetFactory"in O||(O=await this.handleInput(O)),!O||!("widgetFactory"in O)))return;const Y=this.getEditorArea();if(!Y){console.error("Editor area not found. The split pane system may not be initialized yet.");return}if(this.setupEventListeners(Y),Y.has(O.key)){Y.activate(O.key);return}Y.open({name:O.key,editorId:O.editorId,label:O.title,icon:O.icon,closable:!0,noOverflow:O.noOverflow,component:O.widgetFactory})}getFileIcon(O){const Y=O.includes(".")?O.split(".").pop()?.toLowerCase()||"":O.toLowerCase(),te=this.getSortedIconContributions();if(te.length===0)return"file";for(const ne of te)if(ne.mappings&&ne.mappings[Y])return ne.mappings[Y];return"file"}}const editorRegistry=new EditorRegistry;rootContext.put("editorRegistry",editorRegistry);contributionRegistry.registerContribution("system.icons",{label:"Default File Icons",mappings:{pdf:"file-pdf",md:"book",txt:"file-lines",ts:"code",tsx:"code",js:"code",jsx:"code",json:"file-code",geojson:"file-code",py:"python",html:"code",htm:"code",css:"code",scss:"code",sass:"code",xml:"file-code",yaml:"file-code",yml:"file-code",sql:"database",kml:"file-code",gpx:"file-code",jpg:"image",jpeg:"image",png:"image",gif:"image",svg:"image",webp:"image",bmp:"image",ico:"image"},priority:0});var __defProp$5=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$9(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$5(O,Y,ne),ne};const t$7=i18n("filebrowser");let KFileBrowser=class extends KPart{constructor(){super(...arguments),this.treeRef=e$2(),this.loadingNodes=new Set}doBeforeUI(){this.initializeWorkspace(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,ee=>{ee.target==="system.icons"&&this.requestUpdate()}),this.subscribe(TOPIC_WORKSPACE_CHANGED,ee=>this.onWorkspaceChanged(ee)),this.subscribe(TOPIC_WORKSPACE_CONNECTED,ee=>this.onWorkspaceConnected(ee))}firstUpdated(ee){super.firstUpdated(ee),this.setupDragAndDrop()}updated(ee){super.updated(ee),ee.has("workspaceDir")&&this.workspaceDir&&this.setupDragAndDrop()}async initializeWorkspace(){const ee=await workspaceService.getWorkspace();ee?await this.loadWorkspace(ee):commandRegistry.execute("help")}renderToolbar(){const ee=activeSelectionSignal.get()instanceof Resource;return x$1`
            <k-command icon="folder-open" title="${t$7("CONNECT_WORKSPACE")}" dropdown="filebrowser.connections"></k-command>
            <k-command cmd="reload_workspace" icon="repeat" title="${t$7("RELOAD_WORKSPACE")}"></k-command>
            <k-command cmd="create_file" icon="plus" title="${t$7("CREATE_NEW")}" dropdown="filebrowser.create"></k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!ee} title="${t$7("RENAME_RESOURCE")}"></k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!ee} title="${t$7("DELETE_RESOURCE")}"></k-command>
        `}renderContextMenu(){const ee=activeSelectionSignal.get()instanceof Resource;return x$1`
            <k-command cmd="open_editor" icon="folder-open">${t$7("OPEN")}</k-command>
            <k-command cmd="create_file" icon="plus" dropdown="filebrowser.create">${t$7("CREATE_NEW")}</k-command>
            <k-command cmd="rename_resource" icon="pen" ?disabled=${!ee}>${t$7("RENAME")}</k-command>
            <k-command cmd="delete_resource" icon="trash" ?disabled=${!ee}>${t$7("DELETE")}</k-command>
        `}async onWorkspaceChanged(ee){activeSelectionSignal.set(void 0),await this.loadWorkspace(ee),await this.syncTreeSelection()}async onWorkspaceConnected(ee){await this.loadWorkspace(ee)}async loadWorkspace(ee){this.workspaceDir=ee,ee?this.root=await this.resourceToTreeNode(ee,!0):this.root=void 0}async syncTreeSelection(){await this.updateComplete;const O=this.treeRef.value?.querySelector("wa-tree")?.selectedItems||[];O.length>0&&activeSelectionSignal.set(O[0].model?.data)}async resourceToTreeNode(ee,O=!1){const Y=ee instanceof File,te={data:ee,label:ee.getName(),leaf:Y,children:[]};if(ee instanceof Directory&&O){for(const ne of await ee.listChildren(!1)){const xe=await this.resourceToTreeNode(ne,!1);te.children.push(xe)}te.children.sort(treeNodeComparator)}return te}createTreeItems(ee,O=!1){if(!ee)return x$1``;const Y=!ee.leaf&&ee.children.length===0,te=ee.data,ne=te instanceof File,xe=ne?editorRegistry.getFileIcon(te.getName()):ee.icon||"folder-open";return x$1`
            <wa-tree-item 
                draggable=${ne}
                @dragstart=${ne?this.nobubble(et=>this.onDragStart(et,te)):void 0}
                @dblclick=${this.nobubble(this.onFileDoubleClicked)}
                @wa-lazy-load=${this.nobubble(et=>this.onLazyLoad(et,ee))}
                .model=${ee} 
                ?expanded=${O}
                ?lazy=${Y}>
                <span><wa-icon name=${xe} label="${ee.leaf?t$7("FILE"):t$7("FOLDER")}"></wa-icon> ${ee.label}</span>
                ${ee.children.map(et=>this.createTreeItems(et,!1))}
            </wa-tree-item>`}onDragStart(ee,O){if(!ee.dataTransfer)return;const Y=O.getWorkspacePath(),te=O.getName();if(ee.dataTransfer.effectAllowed="copy",ee.dataTransfer.setData("text/plain",Y),ee.dataTransfer.setData("application/x-workspace-file",Y),ee.dataTransfer.setData("text/uri-list",Y),ee.dataTransfer.setDragImage){const ne=document.createElement("div");ne.textContent=te,ne.style.position="absolute",ne.style.top="-1000px",ne.style.padding="4px 8px",ne.style.background="var(--wa-color-neutral-10)",ne.style.border="1px solid var(--wa-color-neutral-30)",ne.style.borderRadius="4px",document.body.appendChild(ne),ee.dataTransfer.setDragImage(ne,0,0),setTimeout(()=>document.body.removeChild(ne),0)}}async onLazyLoad(ee,O){const Y=O.data;Y instanceof Directory&&O.children.length===0&&await this.loadNodeChildren(O,Y)}async loadNodeChildren(ee,O){if(!this.loadingNodes.has(ee)){this.loadingNodes.add(ee);try{for(const Y of await O.listChildren(!1)){HIDE_DOT_RESOURCE&&Y.getName().startsWith(".");const te=await this.resourceToTreeNode(Y,!1);ee.children.push(te)}ee.children.sort(treeNodeComparator),this.requestUpdate()}catch(Y){console.error("Failed to load directory children:",Y)}finally{this.loadingNodes.delete(ee)}}}async onFileDoubleClicked(ee){const Y=ee.currentTarget.model.data.getWorkspacePath();this.executeCommand("open_editor",{path:Y})}onSelectionChanged(ee){const O=ee.detail.selection;if(O&&O.length>0){const Y=O[0].model;activeSelectionSignal.set(Y.data)}else activeSelectionSignal.set(void 0)}setupDragAndDrop(){const ee=this.treeRef.value;if(!ee)return;const O=xe=>{if(!xe.dataTransfer?.types.includes("Files"))return;xe.preventDefault(),xe.dataTransfer.dropEffect="copy",ee.classList.add("drag-over");const tt=xe.target.closest("wa-tree-item");tt&&tt!==this.currentDropTarget&&(this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=tt,tt.classList.add("drop-target"))},Y=xe=>{xe.dataTransfer?.types.includes("Files")&&(xe.preventDefault(),ee.classList.add("drag-over"))},te=xe=>{const et=ee.getBoundingClientRect(),tt=xe.clientX,it=xe.clientY;(tt<=et.left||tt>=et.right||it<=et.top||it>=et.bottom)&&(ee.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0)},ne=async xe=>{if(xe.preventDefault(),ee.classList.remove("drag-over"),this.currentDropTarget?.classList.remove("drop-target"),this.currentDropTarget=void 0,!xe.dataTransfer||!this.workspaceDir)return;const et=Array.from(xe.dataTransfer.files);if(et.length===0)return;const tt=await this.getDropTarget(xe);await this.handleFilesDrop(et,tt)};ee.removeEventListener("dragover",O),ee.removeEventListener("dragenter",Y),ee.removeEventListener("dragleave",te),ee.removeEventListener("drop",ne),ee.addEventListener("dragover",O),ee.addEventListener("dragenter",Y),ee.addEventListener("dragleave",te),ee.addEventListener("drop",ne)}async getDropTarget(ee){const Y=ee.target.closest("wa-tree-item");if(Y){const ne=Y.model.data;if(ne instanceof Directory)return ne;const xe=ne.getParent();if(xe)return xe}return this.workspaceDir}async handleFilesDrop(ee,O){const Y=ee.length;let te=0,ne=0,xe=0;for(const et of ee)try{const tt=this.buildTargetPath(O,et.name);if(await this.workspaceDir.getResource(tt)&&!await confirmDialog(t$7("FILE_EXISTS_OVERWRITE",{fileName:et.name}))){xe++;continue}await(await this.workspaceDir.getResource(tt,{create:!0})).saveContents(et),te++}catch(tt){console.error(`Failed to upload ${et.name}:`,tt),ne++}console.log(`Uploaded ${te}/${Y} files${xe>0?`, ${xe} skipped`:""}${ne>0?`, ${ne} failed`:""}`),await this.loadWorkspace(this.workspaceDir)}buildTargetPath(ee,O){const Y=ee.getWorkspacePath();return Y?`${Y}/${O}`:O}render(){return x$1`
            <div class="tree" ${n$1(this.treeRef)} style="--drop-files-text: '${t$7("DROP_FILES_HERE")}'">
                ${n$5(!this.workspaceDir,()=>x$1`
                    <k-no-content message="${t$7("SELECT_WORKSPACE")}"></k-no-content>`,()=>x$1`
                `)}
                <wa-tree @wa-selection-change=${this.nobubble(this.onSelectionChanged)}
                         style="--indent-guide-width: 1px;">
                    ${this.createTreeItems(this.root,!0)}
                </wa-tree>
            </div>
        `}};KFileBrowser.styles=i$c`
        :host {
        }
        
        .tree {
            height: 100%;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .tree.drag-over {
            background-color: var(--wa-color-brand-fill-quiet);
            outline: 2px dashed var(--wa-color-brand-border-normal);
            outline-offset: -4px;
            border-radius: var(--wa-border-radius-medium);
        }
        
        .tree.drag-over::before {
            content: var(--drop-files-text);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            padding: var(--wa-spacing-large);
            border-radius: var(--wa-border-radius-large);
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }
        
        wa-tree-item.drop-target {
            background-color: var(--wa-color-brand-fill-loud);
            color: var(--wa-color-brand-on-loud);
            border-radius: var(--wa-border-radius-small);
            outline: 2px solid var(--wa-color-brand-border-loud);
            outline-offset: -2px;
        }
    `;__decorateClass$9([r$6()],KFileBrowser.prototype,"root",2);KFileBrowser=__decorateClass$9([t$b("k-filebrowser")],KFileBrowser);var __getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$8(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=et(ne)||ne);return ne};const t$6=i18n("tasks");contributionRegistry.registerContribution(TOOLBAR_BOTTOM_CENTER,{html:"<k-tasks></k-tasks>"});let progressDialogContainer=null;function getProgressDialogContainer(){return progressDialogContainer||(progressDialogContainer=document.createElement("div"),progressDialogContainer.id="progress-dialog-container",document.body.appendChild(progressDialogContainer)),progressDialogContainer}function getDialogElement(){return getProgressDialogContainer().querySelector("wa-dialog")}function showProgressDialog(){updateProgressDialog(!0)}function updateProgressDialog(ee=!1){const O=getProgressDialogContainer(),Y=taskService.getActiveTasks();if(Y.length===0){B$1(x$1``,O);return}const ne=getDialogElement();if(!(ee||ne?.open===!0))return;const et=()=>{const st=getDialogElement();st&&(st.open=!1)},tt=()=>{B$1(x$1``,O)},it=x$1`
        <wa-dialog 
            label="${t$6("ACTIVE_TASKS")}" 
            open
            light-dismiss
            style="--width: 600px;"
            @wa-request-close=${et}
            @wa-after-hide=${tt}
        >
            <style>
                .progress-dialog-content {
                    display: flex;
                    flex-direction: column;
                    gap: 1.5rem;
                }
                
                .task-item {
                    display: flex;
                    flex-direction: column;
                    gap: 0.75rem;
                    padding: 1rem;
                    background: var(--wa-color-neutral-10);
                    border-radius: 8px;
                    border: 1px solid var(--wa-color-neutral-20);
                }
                
                :host-context(.wa-light) .task-item {
                    background: var(--wa-color-neutral-95);
                    border: 1px solid var(--wa-color-neutral-85);
                }
                
                .task-header {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                }
                
                .task-name {
                    font-weight: 600;
                    font-size: 1rem;
                    color: var(--wa-color-neutral-90);
                }
                
                :host-context(.wa-light) .task-name {
                    color: var(--wa-color-neutral-10);
                }
                
                .task-message {
                    font-size: 0.875rem;
                    color: var(--wa-color-neutral-70);
                    margin-top: 0.25rem;
                }
                
                :host-context(.wa-light) .task-message {
                    color: var(--wa-color-neutral-30);
                }
                
                .task-progress {
                    margin-top: 0.5rem;
                }
                
                wa-progress-bar {
                    --track-height: 1.5rem;
                }
                
                wa-progress-bar::part(label) {
                    text-align: center;
                    width: 100%;
                    font-size: 0.875rem;
                }
                
                .no-tasks {
                    text-align: center;
                    padding: 2rem;
                    color: var(--wa-color-neutral-60);
                }
                
                :host-context(.wa-light) .no-tasks {
                    color: var(--wa-color-neutral-40);
                }
            </style>
            
            <div class="progress-dialog-content">
                ${Y.map(st=>{const ot=st.progress>=0||st.totalSteps>0,rt=st.progress>=0?st.progress:st.totalSteps>0?Math.round(st.currentStep/st.totalSteps*100):0,nt=st.progress<0&&st.totalSteps>0;return x$1`
                        <div class="task-item">
                            <div class="task-header">
                                <wa-icon name="hourglass" style="color: var(--wa-color-warning-fill-loud);"></wa-icon>
                                <div style="flex: 1;">
                                    <div class="task-name">${st.name}</div>
                                    ${st.message?x$1`
                                        <div class="task-message">${st.message}</div>
                                    `:""}
                                </div>
                            </div>
                            <div class="task-progress">
                                ${ot?x$1`
                                    <wa-progress-bar value="${rt}">
                                        ${nt?`${st.currentStep}/${st.totalSteps} - `:""}${rt}%
                                    </wa-progress-bar>
                                `:x$1`
                                    <wa-progress-bar indeterminate></wa-progress-bar>
                                `}
                            </div>
                        </div>
                    `})}
            </div>
        </wa-dialog>
    `;B$1(it,O)}let KTasks=class extends KPart{doBeforeUI(){this.watch(activeTasksSignal,()=>{updateProgressDialog(),this.requestUpdate()})}handleIndicatorClick(){showProgressDialog()}render(){activeTasksSignal.get();const O=taskService.getActiveTasks().length;return O===0?x$1``:x$1`
            <div class="task-indicator" @click=${this.handleIndicatorClick} title="${t$6("ACTIVE_TASKS_TITLE",{taskCount:O.toString()})}">
                <wa-spinner 
                    style="font-size: 1rem; --indicator-color: var(--wa-color-warning-fill-loud);" 
                    label="${t$6("ACTIVE_TASKS")}"
                ></wa-spinner>
                <span class="task-count">${O}</span>
            </div>
        `}};KTasks.styles=i$c`
        :host {
            display: flex;
            align-items: center;
        }
        
        .task-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .task-indicator:hover {
            background: var(--wa-color-neutral-15);
        }
        
        :host-context(.wa-light) .task-indicator:hover {
            background: var(--wa-color-neutral-85);
        }
        
        .task-count {
            font-size: 0.875rem;
            color: var(--wa-color-neutral-70);
        }
        
        :host-context(.wa-light) .task-count {
            color: var(--wa-color-neutral-30);
        }
    `;KTasks=__decorateClass$8([t$b("k-tasks")],KTasks);var __getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$7(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=et(ne)||ne);return ne};const t$5=i18n("workspace");let KWorkspaceName=class extends KElement{constructor(){super(...arguments),this.workspaceName=t$5("NO_WORKSPACE")}doInitUI(){this.updateWorkspaceName(),subscribe(TOPIC_WORKSPACE_CONNECTED,()=>{this.updateWorkspaceName()})}updateWorkspaceName(){workspaceService.getWorkspace().then(ee=>{this.workspaceName=ee?.getName()||t$5("NO_WORKSPACE"),this.requestUpdate()})}handleLoadWorkspace(){commandRegistry.execute("load_workspace",{source:this})}render(){return x$1`
            <wa-button 
                appearance="plain"
                size="small"
                title="${t$5("LOAD_WORKSPACE")}"
                @click=${this.handleLoadWorkspace}>
                <wa-icon name="folder-open" slot="start" label="Workspace"></wa-icon>
                ${this.workspaceName}
            </wa-button>
        `}};KWorkspaceName=__decorateClass$7([t$b("k-workspace-name")],KWorkspaceName);var __getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$6(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=et(ne)||ne);return ne};const t$4=i18n("partname");contributionRegistry.registerContribution(TOOLBAR_BOTTOM_CENTER,{html:"<k-part-name></k-part-name>"});let KPartName=class extends KElement{doBeforeUI(){this.watch(activePartSignal,()=>{this.requestUpdate()})}getPartName(){const ee=activePartSignal.get();return ee&&(ee.tabContribution?.label||ee.getAttribute("id"))||t$4("NO_PART")}render(){const O=activePartSignal.get()?.tabContribution?.icon||"box";return x$1`
            <wa-button 
                appearance="plain"
                size="small"
                title="${t$4("ACTIVE_PART")}">
                <k-icon slot="start" name="${O}" label="Part"></k-icon>
                ${this.getPartName()}
            </wa-button>
        `}};KPartName=__decorateClass$6([t$b("k-part-name")],KPartName);var __defProp$4=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$5(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$4(O,Y,ne),ne};const t$3=i18n("extensions");let KExtensions=class extends KPart{constructor(){super(...arguments),this.filterText=""}doInitUI(){subscribe(TOPIC_EXTENSIONS_CHANGED,()=>{this.requestUpdate()})}onExtensionDblClick(){}enable(ee){extensionRegistry.enable(ee.id,!0),this.requestUpdate()}disable(ee){extensionRegistry.disable(ee.id,!0),this.requestUpdate()}isExtensionRequired(ee){const O=appLoaderService.getCurrentApp();return!O||!O.extensions?!1:O.extensions.includes(ee)}selectionChanged(ee){const O=ee.detail.selection||[];O.length>0&&O[0].model?this.selectedExtension=O[0].model:this.selectedExtension=void 0}getFilteredExtensions(){if(!this.filterText.trim())return extensionRegistry.getExtensions();const ee=this.filterText.toLowerCase();return extensionRegistry.getExtensions().filter(O=>String(O.name).toLowerCase().includes(ee)||(O.description?String(O.description).toLowerCase().includes(ee):!1)||O.id.toLowerCase().includes(ee))}getGroupedExtensions(){const ee=this.getFilteredExtensions(),O=[],Y=[];return ee.forEach(te=>{extensionRegistry.isEnabled(te.id)?O.push(te):Y.push(te)}),O.sort((te,ne)=>String(te.name).localeCompare(String(ne.name))),Y.sort((te,ne)=>String(te.name).localeCompare(String(ne.name))),{enabled:O,available:Y}}isExternalExtension(ee){return ee.external===!0}handleFilterInput(ee){this.filterText=ee.target.value,this.requestUpdate()}clearFilter(){this.filterText="",this.requestUpdate()}renderToolbar(){return x$1`
            <wa-input
                placeholder="${t$3("FILTER_PLACEHOLDER")}"
                .value=${this.filterText}
                @input=${ee=>this.handleFilterInput(ee)}
                @wa-clear=${()=>this.clearFilter()}
                with-clear
                size="small"
                style="width: 300px;">
                <wa-icon slot="start" name="magnifying-glass" label="Filter"></wa-icon>
            </wa-input>
        `}render(){const ee=this.getGroupedExtensions(),O=ee.enabled.length>0||ee.available.length>0;return x$1`
            <wa-split-panel position="30" style="height: 100%">
                <wa-tree 
                    selection="leaf"
                    style="--indent-guide-width: 1px;" 
                    slot="start"
                    @wa-selection-change="${this.selectionChanged}">
                    ${O?x$1`
                        ${ee.enabled.length>0?x$1`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="check-circle" style="color: var(--wa-color-success-50);"></wa-icon>
                                    ${t$3("INSTALLED")} (${ee.enabled.length})
                                </span>
                                ${ee.enabled.map(Y=>{const te=this.isExternalExtension(Y);return x$1`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${Y}>
                                            <span><k-icon name="${Y.icon}"></k-icon></span> ${Y.name}${te?x$1` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                        ${ee.available.length>0?x$1`
                            <wa-tree-item expanded>
                                <span>
                                    <wa-icon name="circle" style="color: var(--wa-color-neutral-50);"></wa-icon>
                                    ${t$3("AVAILABLE")} (${ee.available.length})
                                </span>
                                ${ee.available.map(Y=>{const te=this.isExternalExtension(Y);return x$1`
                                        <wa-tree-item @dblclick=${this.nobubble(this.onExtensionDblClick)} .model=${Y}>
                                            <span><k-icon name="${Y.icon}"></k-icon></span> ${Y.name}${te?x$1` <span style="opacity: 0.6; font-size: 0.9em; margin-left: 0.5rem;">(External)</span>`:""}
                                        </wa-tree-item>
                                    `})}
                            </wa-tree-item>
                        `:""}
                    `:""}
                    ${O?"":x$1`
                        <div style="padding: 1em; text-align: center; opacity: 0.7;">
                            ${t$3("NO_MATCHES",{filterText:this.filterText})}
                        </div>
                    `}
                </wa-tree>
                <div slot="end" style="padding: 1em;">
                    ${n$5(this.selectedExtension,Y=>{const te=this.isExternalExtension(Y),ne=extensionRegistry.isEnabled(Y.id);return x$1`
                                <h1><k-icon name="${Y.icon}"></k-icon> ${Y.name}${te?" (External)":""}</h1>
                                ${n$5(te,()=>x$1`
                                    <div class="marketplace-badge">
                                        <wa-icon name="store"></wa-icon>
                                        <span>${t$3("EXTERNAL_EXTENSION")}</span>
                                    </div>
                                `)}
                                <hr>
                                <div>
                                    ${n$5(ne,()=>x$1`
                                        <wa-button 
                                            title="${this.isExtensionRequired(Y.id)?t$3("REQUIRED_HINT"):t$3("DISABLE_TITLE")}" 
                                            @click="${()=>this.disable(Y)}"
                                            variant="danger" 
                                            appearance="plain"
                                            ?disabled=${this.isExtensionRequired(Y.id)}>
                                            <wa-icon name="xmark" label="Uninstall"></wa-icon>&nbsp;${t$3("UNINSTALL")}
                                        </wa-button>
                                        ${n$5(this.isExtensionRequired(Y.id),()=>x$1`
                                            <div class="required-hint">
                                                <wa-icon name="info-circle" style="color: var(--wa-color-primary-50);"></wa-icon>
                                                <span>${t$3("REQUIRED_HINT")}</span>
                                            </div>
                                        `)}
                                    `,()=>x$1`
                                        <wa-button 
                                            title="${t$3("ENABLE_TITLE")}" 
                                            @click="${()=>this.enable(Y)}"
                                            variant="brand" 
                                            appearance="plain">
                                            <wa-icon name="download" label="Install"></wa-icon>&nbsp;${t$3("INSTALL")}
                                        </wa-button>
                                    `)}
                                </div>

                                ${n$5(Y.experimental,()=>x$1`
                                    <div style="margin-top: 1em;">
                                        <wa-button size="small" variant="warning" appearance="plain">
                                            <wa-icon name="triangle-exclamation" label="Warning"></wa-icon>
                                        </wa-button>
                                        <small><i>${t$3("EXPERIMENTAL")}</i></small>
                                    </div>
                                `)}

                                ${n$5(Y.version||Y.author,()=>x$1`
                                    <div style="margin-top: 1em; display: flex; flex-direction: column; gap: 0.5rem;">
                                        ${n$5(Y.version,()=>x$1`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="tag" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">${t$3("VERSION")} <strong>${Y.version}</strong></span>
                                            </div>
                                        `)}
                                        ${n$5(Y.author,()=>x$1`
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <wa-icon name="user" style="font-size: 0.9em; opacity: 0.7;"></wa-icon>
                                                <span style="font-size: 0.9em; opacity: 0.8;">${t$3("AUTHOR")} <strong>${Y.author}</strong></span>
                                            </div>
                                        `)}
                                    </div>
                                `)}

                                <p style="margin-top: 1em;">${Y.description}</p>

                                ${n$5(Y.dependencies&&Y.dependencies.length>0,()=>x$1`
                                    <div style="margin-top: 1.5em;">
                                        <h3 style="margin-bottom: 0.5em;">
                                            <wa-icon name="puzzle-piece" style="font-size: 0.9em;"></wa-icon>
                                            ${t$3("DEPENDENCIES")}
                                        </h3>
                                        <div class="dependencies-list">
                                            ${Y.dependencies.map(xe=>{const et=extensionRegistry.getExtensions().find(it=>it.id===xe),tt=extensionRegistry.isEnabled(xe);return x$1`
                                                    <div class="dependency-item">
                                                        <wa-icon 
                                                            name="${tt?"check-circle":"circle"}" 
                                                            style="color: ${tt?"var(--wa-color-success-50)":"var(--wa-color-neutral-50)"};">
                                                        </wa-icon>
                                                        <k-icon name="${et?.icon||"puzzle-piece"}"></k-icon>
                                                        <span>${et?.name||xe}</span>
                                                        ${tt?"":x$1`
                                                            <span class="dependency-badge">${t$3("NOT_INSTALLED")}</span>
                                                        `}
                                                    </div>
                                                `})}
                                        </div>
                                        <small style="opacity: 0.7; display: block; margin-top: 0.5em;">
                                            <wa-icon name="info-circle" style="font-size: 0.9em;"></wa-icon>
                                            ${t$3("DEPENDENCIES_HINT")}
                                        </small>
                                    </div>
                                `)}
                            `})}
                </div>
            </wa-split-panel>
        `}};KExtensions.styles=i$c`
        :host {
        }

        wa-tree-item > span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        wa-tree-item:has(> wa-tree-item) {
            font-weight: 500;
        }

        .dependencies-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .dependency-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-surface-variant);
        }

        .dependency-item wa-icon:first-child {
            flex-shrink: 0;
        }

        .dependency-item k-icon {
            flex-shrink: 0;
        }

        .dependency-item span:not(.dependency-badge) {
            flex: 1;
        }

        .dependency-badge {
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-warning-100);
            color: var(--wa-color-warning-900);
        }

        .required-hint {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
        }

        .required-hint wa-icon {
            flex-shrink: 0;
        }

        .required-hint span {
            line-height: 1.4;
        }

        .marketplace-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.875rem;
            border-radius: 4px;
            background: var(--wa-color-primary-10);
            color: var(--wa-color-primary-70);
            font-size: 0.875rem;
            font-weight: 500;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--wa-color-primary-30);
        }
    `;__decorateClass$5([r$6()],KExtensions.prototype,"selectedExtension",2);__decorateClass$5([r$6()],KExtensions.prototype,"filterText",2);KExtensions=__decorateClass$5([t$b("k-extensions")],KExtensions);var __defProp$3=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$4(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$3(O,Y,ne),ne};const t$2=i18n("logterminal");let KLogTerminal=class extends KPart{constructor(){super(...arguments),this.messages=[],this.autoScroll=!0,this.filter="all",this.containerRef=e$2()}connectedCallback(){super.connectedCallback(),this.loadSettings(),registerLogHandler(this.log.bind(this))}disconnectedCallback(){super.disconnectedCallback(),unregisterLogHandler()}log(ee,O,Y="info"){const te={timestamp:new Date,level:Y,source:ee,message:O};this.messages=[...this.messages,te],this.updateToolbar(),this.autoScroll&&this.updateComplete.then(()=>{const ne=this.containerRef.value;ne&&(ne.scrollTop=ne.scrollHeight)})}clear(){this.messages=[],this.updateToolbar()}getFilteredMessages(){return this.filter==="all"?this.messages:this.messages.filter(ee=>ee.level===this.filter)}formatTimestamp(ee){return ee.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}getLevelIcon(ee){switch(ee){case"info":return"circle-info";case"warning":return"triangle-exclamation";case"error":return"circle-xmark";case"debug":return"bug"}}getLevelColor(ee){switch(ee){case"info":return"var(--wa-color-primary-text, #0066cc)";case"warning":return"var(--wa-color-warning-text, #ff9800)";case"error":return"var(--wa-color-danger-text, #dc3545)";case"debug":return"var(--wa-color-neutral-text-subtle, #6c757d)"}}renderToolbar(){const ee=this.messages.filter(ne=>ne.level==="info").length,O=this.messages.filter(ne=>ne.level==="warning").length,Y=this.messages.filter(ne=>ne.level==="error").length,te=this.messages.filter(ne=>ne.level==="debug").length;return x$1`
            <k-command 
                icon="list"
                title="${t$2("ALL_LOGS")}"
                appearance="${this.filter==="all"?"filled":"plain"}"
                variant="${this.filter==="all"?"brand":"neutral"}"
                .action=${()=>{this.filter="all",this.saveSettings(),this.updateToolbar()}}>
                ${t$2("ALL")} (${this.messages.length})
            </k-command>

            <k-command 
                icon="circle-info"
                title="${t$2("INFO_LOGS")}"
                appearance="${this.filter==="info"?"filled":"plain"}"
                variant="${this.filter==="info"?"brand":"neutral"}"
                .action=${()=>{this.filter="info",this.saveSettings(),this.updateToolbar()}}>
                ${t$2("INFO")}${ee>0?` (${ee})`:""}
            </k-command>

            <k-command 
                icon="triangle-exclamation"
                title="${t$2("WARNING_LOGS")}"
                appearance="${this.filter==="warning"?"filled":"plain"}"
                variant="${this.filter==="warning"?"brand":"neutral"}"
                .action=${()=>{this.filter="warning",this.saveSettings(),this.updateToolbar()}}>
                ${t$2("WARNINGS")}${O>0?` (${O})`:""}
            </k-command>

            <k-command 
                icon="circle-xmark"
                title="${t$2("ERROR_LOGS")}"
                appearance="${this.filter==="error"?"filled":"plain"}"
                variant="${this.filter==="error"?"brand":"neutral"}"
                .action=${()=>{this.filter="error",this.saveSettings(),this.updateToolbar()}}>
                ${t$2("ERRORS")}${Y>0?` (${Y})`:""}
            </k-command>

            <k-command 
                icon="bug"
                title="${t$2("DEBUG_LOGS")}"
                appearance="${this.filter==="debug"?"filled":"plain"}"
                variant="${this.filter==="debug"?"brand":"neutral"}"
                .action=${()=>{this.filter="debug",this.saveSettings(),this.updateToolbar()}}>
                ${t$2("DEBUG")}${te>0?` (${te})`:""}
            </k-command>

            <wa-divider orientation="vertical"></wa-divider>

            <k-command 
                icon="arrow-down" 
                title="${this.autoScroll?t$2("AUTO_SCROLL_ENABLED"):t$2("AUTO_SCROLL_DISABLED")}"
                appearance="${this.autoScroll?"filled":"plain"}"
                variant="${this.autoScroll?"brand":"neutral"}"
                .action=${()=>{this.autoScroll=!this.autoScroll,this.saveSettings(),this.updateToolbar()}}>
                ${this.autoScroll?t$2("AUTO_SCROLL"):t$2("MANUAL")}
            </k-command>

            <k-command 
                icon="trash" 
                title="${t$2("CLEAR_LOGS")}"
                .action=${()=>this.clear()}>
                ${t$2("CLEAR")}
            </k-command>
        `}render(){const ee=this.getFilteredMessages();return x$1`
            <div class="log-terminal">
                <div class="messages" ${n$1(this.containerRef)}>
                    ${ee.length===0?x$1`<div class="empty-state">${t$2("NO_LOG_MESSAGES")}</div>`:ee.map(O=>x$1`
                            <div class="message" data-level="${O.level}">
                                <span class="timestamp">${this.formatTimestamp(O.timestamp)}</span>
                                <wa-icon 
                                    name="${this.getLevelIcon(O.level)}" 
                                    label="${O.level}"
                                    style="color: ${this.getLevelColor(O.level)}">
                                </wa-icon>
                                <span class="source">[${O.source}]</span>
                                <span class="text">${O.message}</span>
                            </div>
                        `)}
                </div>
            </div>
        `}async loadSettings(){const ee=await this.getDialogSetting();ee&&(typeof ee.filter=="string"&&(ee.filter==="all"||["info","warning","error","debug"].includes(ee.filter))&&(this.filter=ee.filter),typeof ee.autoScroll=="boolean"&&(this.autoScroll=ee.autoScroll),this.updateToolbar())}async saveSettings(){await this.setDialogSetting({filter:this.filter,autoScroll:this.autoScroll})}};KLogTerminal.styles=i$c`
        :host {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .log-terminal {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            font-family: var(--wa-font-mono);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .message {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            align-items: baseline;
            border-radius: var(--wa-border-radius-small);
        }

        .message:hover {
            background: var(--wa-color-neutral-background-hover);
        }

        .timestamp {
            color: var(--wa-color-neutral-text-subtle);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .source {
            color: var(--wa-color-primary-text);
            font-weight: 500;
            white-space: nowrap;
        }

        .text {
            color: var(--wa-color-neutral-text);
            word-break: break-word;
        }

        .message[data-level="error"] .text {
            color: var(--wa-color-danger-text);
        }

        .message[data-level="warning"] .text {
            color: var(--wa-color-warning-text);
        }

        .message[data-level="debug"] .text {
            color: var(--wa-color-neutral-text-subtle);
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--wa-color-neutral-text-subtle);
            font-style: italic;
        }

        wa-icon {
            flex-shrink: 0;
        }
    `;__decorateClass$4([r$6()],KLogTerminal.prototype,"messages",2);__decorateClass$4([r$6()],KLogTerminal.prototype,"autoScroll",2);__decorateClass$4([r$6()],KLogTerminal.prototype,"filter",2);KLogTerminal=__decorateClass$4([t$b("k-log-terminal")],KLogTerminal);var __defProp$2=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$3(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$2(O,Y,ne),ne};let KCommand=class extends KWidget{constructor(){super(...arguments),this.cmd="",this.title="",this.label=!1,this.disabled=!1,this.appearance="plain",this.variant="neutral",this.size="small",this.params={},this.placement="bottom-start",this.dropdownContributions=[]}handleClick(ee){if(!this.disabled){if(ee&&ee.stopPropagation(),this.action){this.action(ee);return}if(this.cmd){const O=this.closest("wa-dropdown");O&&O.open!==void 0&&(O.open=!1),this.executeCommand(this.cmd,this.params)}}}handleSelect(ee){const O=ee.target;O&&O.open!==void 0&&(O.open=!1)}isInDropdown(){return!!this.closest("wa-dropdown, wa-dropdown-menu")}getKeybinding(){if(!this.cmd||this.action)return null;const ee=keyBindingManager.getKeyBindingsForCommand(this.cmd);return ee.length>0?ee[0]:null}doBeforeUI(){this.dropdown&&(this.loadDropdownContributions(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,ee=>{this.dropdown&&ee.target===this.dropdown&&(this.dropdownContributions=ee.contributions,this.requestUpdate())}))}loadDropdownContributions(){this.dropdown&&(this.dropdownContributions=contributionRegistry.getContributions(this.dropdown),this.requestUpdate())}renderContribution(ee){if("command"in ee){const O=ee,Y=O.disabled?.get();return x$1`
                <k-command 
                    cmd="${O.command}"
                    icon="${O.icon||""}"
                    .params=${O.params||{}}
                    ?disabled="${Y}">
                    ${O.label}
                </k-command>
            `}if("html"in ee){const Y=ee.html;return Y instanceof Function?Y():o$5(Y)}return E$2}render(){const ee=this.getKeybinding();return this.isInDropdown()?x$1`
                <wa-dropdown-item 
                    ?disabled=${this.disabled}
                    @click=${O=>this.handleClick(O)}>
                    <k-icon name="${this.icon}" label="${this.title}" slot="icon"></k-icon>
                    <slot></slot>
                    ${ee?x$1`<span class="keybinding">${ee}</span>`:""}
                </wa-dropdown-item>
            `:this.dropdown?x$1`
                <wa-dropdown 
                    placement=${this.placement}
                    @wa-select=${O=>this.handleSelect(O)}>
                    <wa-button 
                        slot="trigger"
                        appearance=${this.appearance}
                        variant=${this.variant}
                        size=${this.size}
                        ?disabled=${this.disabled}
                        with-caret
                        title=${ee?`${this.title} (${ee})`:this.title}>
                        <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                        <slot></slot>
                        ${this.label?this.title:E$2}
                    </wa-button>
                    
                    ${this.title?x$1`
                        <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                            ${this.title}
                        </h6>
                    `:E$2}
                    
                    ${this.dropdownContributions.map(O=>this.renderContribution(O))}
                    
                    ${this.cmd?x$1`
                        <wa-divider></wa-divider>
                        <k-command 
                            cmd="${this.cmd}"
                            icon="${this.icon||""}"
                            .params=${this.params}
                            ?disabled=${this.disabled}>
                            <slot></slot>
                            ${this.title}
                        </k-command>
                    `:E$2}
                </wa-dropdown>
            `:x$1`
            <wa-button
                appearance=${this.appearance}
                variant=${this.variant}
                size=${this.size}
                ?disabled=${this.disabled}
                title=${ee?`${this.title} (${ee})`:this.title}
                @click=${O=>this.handleClick(O)}>
                <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                <slot></slot>
            </wa-button>
        `}};KCommand.styles=i$c`
        :host {
            display: inline-block;
        }

        .keybinding {
            margin-left: auto;
            padding: 2px 6px;
            background: var(--wa-color-neutral-15);
            border: 1px solid var(--wa-color-neutral-25);
            border-radius: 3px;
            font-size: 10px;
            font-family: monospace;
            opacity: 0.7;
        }

        :host-context(.wa-light) .keybinding {
            background: var(--wa-color-neutral-85);
            border: 1px solid var(--wa-color-neutral-75);
        }
    `;__decorateClass$3([n$7()],KCommand.prototype,"cmd",2);__decorateClass$3([n$7({type:Object,attribute:!1})],KCommand.prototype,"action",2);__decorateClass$3([n$7()],KCommand.prototype,"title",2);__decorateClass$3([n$7()],KCommand.prototype,"label",2);__decorateClass$3([n$7()],KCommand.prototype,"icon",2);__decorateClass$3([n$7({type:Boolean})],KCommand.prototype,"disabled",2);__decorateClass$3([n$7()],KCommand.prototype,"appearance",2);__decorateClass$3([n$7()],KCommand.prototype,"variant",2);__decorateClass$3([n$7()],KCommand.prototype,"size",2);__decorateClass$3([n$7({type:Object,attribute:!1})],KCommand.prototype,"params",2);__decorateClass$3([n$7()],KCommand.prototype,"dropdown",2);__decorateClass$3([n$7()],KCommand.prototype,"placement",2);__decorateClass$3([r$6()],KCommand.prototype,"dropdownContributions",2);KCommand=__decorateClass$3([t$b("k-command")],KCommand);var __defProp$1=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$2(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp$1(O,Y,ne),ne};const t$1=i18n("fastviews");let KFastViews=class extends KWidget{constructor(){super(...arguments),this.target="",this.title="",this.disabled=!1,this.appearance="plain",this.size="small",this.placement="bottom-start",this.tabContributions=[],this.drawerOpen=!1,this.drawerSize="50vw",this.drawerRef=e$2(),this.tabsRef=e$2(),this.resizeHandleRef=e$2(),this.resizing=null}getDrawerTabsId(){return`fastviews-drawer-tabs-${this.target}`}handleTabClick(ee){if(!this.disabled)if(this.containerId){const O=document.querySelector(`k-tabs#${this.containerId}`);if(!O){console.error(`k-fastviews: Tab container with id "${this.containerId}" not found`);return}O.open(ee)}else this.drawerOpen=!0,this.updateComplete.then(()=>{const O=this.tabsRef.value;O&&O.open(ee)})}handleDrawerHide(){this.drawerOpen=!1}startResize(ee){ee.preventDefault(),ee.stopPropagation();const O=this.drawerRef.value;if(!O)return;let te=(()=>{const et=O.shadowRoot?.querySelector('[part="panel"]');if(et&&et.offsetWidth>0)return et.offsetWidth;const st=(window.getComputedStyle(O).getPropertyValue("--size")||this.drawerSize).match(/^(\d+(?:\.\d+)?)(px|vw|vh|%)$/);if(st){const ot=parseFloat(st[1]),rt=st[2];if(rt==="px")return ot;if(rt==="vw")return ot/100*window.innerWidth;if(rt==="vh")return ot/100*window.innerHeight;if(rt==="%")return ot/100*window.innerWidth}return 0})();te===0&&(te=window.innerWidth*.5);const ne=et=>{this.resizing&&(et.preventDefault(),et.stopPropagation(),this.resizing.rafId!==null&&cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=requestAnimationFrame(()=>{if(!this.resizing)return;const tt=this.resizing.startX-et.clientX,it=Math.round(this.resizing.startSize+tt),st=200,ot=Math.round(window.innerWidth*.9);if(it>=st&&it<=ot){this.drawerSize=`${it}px`;const rt=this.drawerRef.value;rt&&(rt.style.setProperty("--size",this.drawerSize),rt.style.setProperty("transition","none"))}this.resizing.rafId=null}))},xe=()=>{if(this.resizing){this.resizing.rafId!==null&&(cancelAnimationFrame(this.resizing.rafId),this.resizing.rafId=null),document.removeEventListener("mousemove",this.resizing.handleMouseMove),document.removeEventListener("mouseup",this.resizing.handleMouseUp),document.body.style.cursor="",document.body.style.userSelect="";const et=this.drawerRef.value;et&&et.style.removeProperty("transition"),this.resizing=null}};this.resizing={startX:ee.clientX,startSize:te,handleMouseMove:ne,handleMouseUp:xe,rafId:null},document.addEventListener("mousemove",ne,{passive:!1}),document.addEventListener("mouseup",xe,{passive:!1}),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}doBeforeUI(){this.target&&(this.loadTabContributions(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,ee=>{this.target&&ee.target===this.target&&this.loadTabContributions()}))}loadTabContributions(){if(!this.target)return;const ee=contributionRegistry.getContributions(this.target);this.tabContributions=ee.filter(O=>"name"in O),this.requestUpdate()}renderTabContribution(ee){const O=ee.disabled?.get();return x$1`
            <wa-dropdown-item 
                ?disabled=${O}
                @click=${()=>this.handleTabClick(ee)}>
                <k-icon name="${ee.icon||""}" label="${ee.label}" slot="icon"></k-icon>
                ${ee.label}
            </wa-dropdown-item>
        `}render(){return!this.target||this.tabContributions.length===0?E$2:x$1`
            <wa-dropdown placement=${this.placement}>
                <wa-button 
                    slot="trigger"
                    appearance=${this.appearance}
                    size=${this.size}
                    ?disabled=${this.disabled}
                    with-caret
                    title=${this.title}>
                    <k-icon slot="start" name="${this.icon}" label="${this.title}"></k-icon>
                    <slot></slot>
                </wa-button>
                
                ${this.title?x$1`
                    <h6 style="padding: var(--wa-space-xs) var(--wa-space-s); margin: 0; color: var(--wa-color-neutral-50); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                        ${this.title}
                    </h6>
                `:E$2}
                
                ${this.tabContributions.map(ee=>this.renderTabContribution(ee))}
            </wa-dropdown>

            ${this.containerId?E$2:x$1`
                <wa-drawer 
                    ${n$1(this.drawerRef)}
                    label="${this.title||t$1("FAST_VIEWS")}"
                    placement="end"
                    ?open=${this.drawerOpen}
                    @wa-hide=${this.handleDrawerHide}
                    style="--size: ${this.drawerSize};">
                    <div 
                        ${n$1(this.resizeHandleRef)}
                        class="resize-handle"
                        @mousedown=${this.startResize}>
                    </div>
                    <k-tabs 
                        ${n$1(this.tabsRef)}
                        id="${this.getDrawerTabsId()}"
                        style="width: 100%; height: 100%; display: flex; flex-direction: column;">
                    </k-tabs>
                </wa-drawer>
            `}
        `}};KFastViews.styles=i$c`
        :host {
            display: inline-block;
        }

        wa-drawer {
            position: relative;
        }

        wa-drawer::part(panel) {
            position: relative;
        }

        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            z-index: 1000;
            background: transparent;
            transition: background-color 0.2s;
            user-select: none;
            touch-action: none;
        }

        .resize-handle:hover {
            background: var(--wa-color-brand-fill-loud);
        }

        .resize-handle:active {
            background: var(--wa-color-brand-fill-loud);
        }
    `;__decorateClass$2([n$7()],KFastViews.prototype,"target",2);__decorateClass$2([n$7()],KFastViews.prototype,"title",2);__decorateClass$2([n$7()],KFastViews.prototype,"icon",2);__decorateClass$2([n$7({type:Boolean})],KFastViews.prototype,"disabled",2);__decorateClass$2([n$7()],KFastViews.prototype,"appearance",2);__decorateClass$2([n$7()],KFastViews.prototype,"size",2);__decorateClass$2([n$7()],KFastViews.prototype,"placement",2);__decorateClass$2([n$7()],KFastViews.prototype,"containerId",2);__decorateClass$2([r$6()],KFastViews.prototype,"tabContributions",2);__decorateClass$2([r$6()],KFastViews.prototype,"drawerOpen",2);__decorateClass$2([r$6()],KFastViews.prototype,"drawerSize",2);KFastViews=__decorateClass$2([t$b("k-fastviews")],KFastViews);var __getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc$1(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=et(ne)||ne);return ne};function getDialogContainer(){let ee=document.getElementById("global-dialog-container");return ee||(ee=document.createElement("div"),ee.id="global-dialog-container",document.body.appendChild(ee)),ee}const getLanguageName=ee=>{try{return new Intl.DisplayNames([ee],{type:"language"}).of(ee)||ee.toUpperCase()}catch{return ee.toUpperCase()}},getAvailableLanguages=()=>{const ee=languageContributionsSignal.get(),O=new Set;for(const Y of ee)if(Y.namespace){const te=Y;for(const ne in te)ne!=="namespace"&&ne!=="label"&&ne!=="language"&&ne!=="translations"&&typeof te[ne]=="object"&&O.add(ne)}return Array.from(O).sort()},showLanguageSelectorDialog=async()=>{const ee=getAvailableLanguages(),O=currentLanguageSignal.get();return new Promise(Y=>{const te=getDialogContainer();let ne=!1;const xe=()=>{const st=te.querySelector("wa-dialog");st&&!ne&&(st.open=!1)},et=()=>{ne||(ne=!0,B$1(x$1``,te),Y())},tt=async st=>{await appSettings.set(SETTINGS_KEY_LANGUAGE,st),xe()},it=x$1`
            <wa-dialog 
                label="Select Language" 
                open 
                light-dismiss
                @wa-request-close=${xe}
                @wa-after-hide=${et}>
                <style>
                    .language-list {
                        display: flex;
                        flex-direction: column;
                        gap: 0.5rem;
                        padding: 1rem;
                        min-width: 300px;
                        max-height: 400px;
                        overflow-y: auto;
                    }
                    
                    .language-item {
                        display: flex;
                        align-items: center;
                        padding: 0.75rem;
                        border-radius: var(--wa-border-radius-small);
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    
                    .language-item:hover {
                        background-color: var(--wa-color-neutral-fill-quiet);
                    }
                    
                    .language-item.active {
                        background-color: var(--wa-color-brand-fill-quiet);
                        font-weight: 600;
                    }
                    
                    .language-code {
                        font-family: monospace;
                        margin-right: 0.75rem;
                        min-width: 3rem;
                        color: var(--wa-color-neutral-600);
                    }
                    
                    .language-name {
                        flex: 1;
                    }
                </style>
                
                <div class="language-list">
                    ${ee.map(st=>x$1`
                        <div 
                            class="language-item ${st===O?"active":""}"
                            @click=${()=>tt(st)}>
                            <span class="language-code">${st.toUpperCase()}</span>
                            <span class="language-name">${getLanguageName(st)}</span>
                        </div>
                    `)}
                </div>
            </wa-dialog>
        `;B$1(it,te)})};let KLanguageSelector=class extends KElement{render(){const ee=currentLanguageSignal.get(),O=getLanguageName(ee),Y=`${ee.toUpperCase()} ${O}`;return x$1`
            <wa-button 
                appearance="plain" 
                size="small"
                title="Current language: ${O}"
                @click=${()=>showLanguageSelectorDialog()}>
                ${Y}
            </wa-button>
        `}};KLanguageSelector.styles=i$c`
        :host {
            display: inline-block;
        }
    `;KLanguageSelector=__decorateClass$1([t$b("k-language-selector")],KLanguageSelector);const t=i18nLazy("extensions");extensionRegistry.registerExtension({id:"system.git",name:t("EXT_GIT_NAME"),description:t("EXT_GIT_DESC"),loader:()=>__vitePreload(()=>import("./git-extension-BI3B_Opd-kjl5sV8T.js"),__vite__mapDeps([0,1,2])),icon:"code-branch",experimental:!0});extensionRegistry.registerExtension({id:"system.github-service",name:t("EXT_GITHUB_SERVICE_NAME"),description:t("EXT_GITHUB_SERVICE_DESC"),loader:()=>__vitePreload(()=>import("./github-service-extension-Bwyvo7DZ-C-kuSNTI.js"),[]),icon:"code-branch"});extensionRegistry.registerExtension({id:"system.pyterminal",name:t("EXT_PYTERMINAL_NAME"),description:t("EXT_PYTERMINAL_DESC"),loader:()=>__vitePreload(()=>import("./pyterminal-extension-DuNmMRB0-CW36muxI.js"),__vite__mapDeps([3,4,1,2])),icon:"k python",experimental:!0});extensionRegistry.registerExtension({id:"system.linuxterminal",name:t("EXT_LINUXTERMINAL_NAME"),description:t("EXT_LINUXTERMINAL_DESC"),loader:()=>__vitePreload(()=>import("./k-linuxterminal-C2332gGT-JB4af1LW.js"),__vite__mapDeps([5,4,1,2])),icon:"terminal",experimental:!0});extensionRegistry.registerExtension({id:"system.webllm",name:t("EXT_WEBLLM_NAME"),description:t("EXT_WEBLLM_DESC"),loader:()=>__vitePreload(()=>import("./webllmservice-B6R9uiIw-CQU2TnL8.js"),__vite__mapDeps([6,1,2])),icon:"robot"});extensionRegistry.registerExtension({id:"system.p12splitter",name:t("EXT_P12SPLITTER_NAME"),description:t("EXT_P12SPLITTER_DESC"),loader:()=>__vitePreload(()=>import("./p12-splitter-YgDzLvd--B0Zr9rWX.js"),__vite__mapDeps([7,1,2])),icon:"certificate"});extensionRegistry.registerExtension({id:"system.pythonpackagemanager",name:t("EXT_PYTHONPACKAGEMANAGER_NAME"),description:t("EXT_PYTHONPACKAGEMANAGER_DESC"),loader:()=>__vitePreload(()=>import("./package-manager-extension-Bb1gA_o0-Dqa3LTk3.js"),__vite__mapDeps([8,1,2])),icon:"box"});extensionRegistry.registerExtension({id:"system.notebook",name:t("EXT_NOTEBOOK_NAME"),description:t("EXT_NOTEBOOK_DESC"),loader:()=>__vitePreload(()=>import("./notebook-extension-DCTEZLZK-CTZBl0os.js"),__vite__mapDeps([9,10,1,11,8,2])),icon:"k jupyter",dependencies:["system.pythonpackagemanager"]});extensionRegistry.registerExtension({id:"system.commandpalette",name:t("EXT_COMMANDPALETTE_NAME"),description:t("EXT_COMMANDPALETTE_DESC"),loader:()=>__vitePreload(()=>import("./command-palette-extension-CMSgFxB5-TYmhpMnZ.js"),__vite__mapDeps([12,1,2])),icon:"terminal"});extensionRegistry.registerExtension({id:"system.download",name:t("EXT_DOWNLOAD_NAME"),description:t("EXT_DOWNLOAD_DESC"),loader:()=>__vitePreload(()=>import("./download-extension-wVyZTJUS-DYLfOw4u.js"),__vite__mapDeps([13,1,2])),icon:"download"});extensionRegistry.registerExtension({id:"system.unzip",name:t("EXT_UNZIP_NAME"),description:t("EXT_UNZIP_DESC"),loader:()=>__vitePreload(()=>import("./unzip-extension-C0R1j7RZ-CcaaAHpS.js"),__vite__mapDeps([14,1,15,2])),icon:"box-archive"});extensionRegistry.registerExtension({id:"system.mdeditor",name:t("EXT_MDEDITOR_NAME"),description:t("EXT_MDEDITOR_DESC"),loader:()=>__vitePreload(()=>import("./md-editor-extension-EKtXclAM-DdEXob9G.js"),__vite__mapDeps([16,1,2])),icon:"book"});extensionRegistry.registerExtension({id:"system.mediaviewer",name:t("EXT_MEDIAVIEWER_NAME"),description:t("EXT_MEDIAVIEWER_DESC"),loader:()=>__vitePreload(()=>import("./media-viewer-extension-BiHd9Ilz-oP73UMpy.js"),__vite__mapDeps([17,1,2])),icon:"image"});extensionRegistry.registerExtension({id:"system.monaco",name:t("EXT_MONACO_NAME"),description:t("EXT_MONACO_DESC"),loader:()=>__vitePreload(()=>import("./monaco-editor-extension-DDiTiYIe-CvL4tWZ2.js"),__vite__mapDeps([18,10,1,11,8,2])),icon:"file-pen",dependencies:["system.pythonpackagemanager"]});extensionRegistry.registerExtension({id:"system.memoryusage",name:t("EXT_MEMORYUSAGE_NAME"),description:t("EXT_MEMORYUSAGE_DESC"),loader:()=>__vitePreload(()=>import("./memory-usage-extension-5WVlmkEK-DbcXgiRa.js"),__vite__mapDeps([19,1,2])),icon:"microchip"});extensionRegistry.registerExtension({id:"system.webdav",name:t("EXT_WEBDAV_NAME"),description:t("EXT_WEBDAV_DESC"),loader:()=>__vitePreload(()=>import("./webdav-extension-DMycsJok-8nOFu50H.js"),__vite__mapDeps([20,1,2])),icon:"cloud"});extensionRegistry.registerExtension({id:"system.settings-tree",name:t("EXT_SETTINGS_TREE_NAME"),description:t("EXT_SETTINGS_TREE_DESC"),loader:()=>__vitePreload(()=>import("./settings-tree-extension-D_VN3kNz-DxqK0WOo.js"),__vite__mapDeps([21,1,2])),icon:"sitemap"});extensionRegistry.registerExtension({id:"system.in-browser-ml",name:t("EXT_IN_BROWSER_ML_NAME"),description:t("EXT_IN_BROWSER_ML_DESC"),loader:()=>__vitePreload(()=>import("./in-browser-ml-extension-BaJ20GOA-CrVEJQCS.js"),__vite__mapDeps([22,1,2])),icon:"brain"});extensionRegistry.registerExtension({id:"system.ai-system",name:t("EXT_AI_SYSTEM_NAME"),description:t("EXT_AI_SYSTEM_DESC"),loader:()=>__vitePreload(()=>import("./ai-system-extension-BvfJqFsN-Cnc_fQBN.js"),__vite__mapDeps([23,1,2])),icon:"robot",dependencies:["system.in-browser-ml"]});extensionRegistry.registerExtension({id:"system.rag-system",name:t("EXT_RAG_SYSTEM_NAME"),description:t("EXT_RAG_SYSTEM_DESC"),loader:()=>__vitePreload(()=>import("./rag-system-extension-CvV0yerw-Dmht2lIM.js").then(ee=>ee.b),__vite__mapDeps([24,1])),icon:"database",experimental:!0,dependencies:["system.ai-system"]});extensionRegistry.registerExtension({id:"system.howto",name:t("EXT_HOWTO_NAME"),description:t("EXT_HOWTO_DESC"),loader:()=>__vitePreload(()=>import("./howto-extension-5oWlvyk1-CL0loxVQ.js"),__vite__mapDeps([25,1,2])),icon:"list-check"});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Ollama (Local)",provider:{name:"ollama",model:"gemma3:12b",chatApiEndpoint:"https://<your-server>/v1/chat/completions",apiKey:""}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"OpenWebUI (Self Hosted)",provider:{name:"openwebui",model:"gemma3:12b",chatApiEndpoint:"https://<your-server>/api/v1/chat/completion",apiKey:""}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"OpenAI",provider:{name:"openai",model:"gpt-4.1",chatApiEndpoint:"https://api.openai.com/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Groq",provider:{name:"groq",model:"llama-3.1-8b-instant",chatApiEndpoint:"https://api.groq.com/openai/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Cerebras",provider:{name:"cerebras",model:"llama3.1-8b",chatApiEndpoint:"https://api.cerebras.ai/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"WebLLM",provider:{name:"webllm",model:"gemma-2-9b-it-q4f16_1-MLC",chatApiEndpoint:"",apiKey:"",parameters:{context_window_size:4096}}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"Mistral",provider:{name:"mistral",model:"mistral-large-latest",chatApiEndpoint:"https://api.mistral.ai/v1/chat/completions",apiKey:"<your api key>",ocrApiEndpoint:"https://api.mistral.ai/v1/ocr",ocrModel:"mistral-ocr-latest"}});contributionRegistry.registerContribution(CID_CHAT_PROVIDERS,{target:CID_CHAT_PROVIDERS,label:"LiteLLM",provider:{name:"litellm",model:"gpt-3.5-turbo",chatApiEndpoint:"https://<your-server>/v1/chat/completions",apiKey:"<your api key>"}});contributionRegistry.registerContribution(SIDEBAR_MAIN,{name:"filebrowser",label:"Workspace",icon:"folder-open",component:ee=>x$1`<k-filebrowser id="${ee}"></k-filebrowser>`});contributionRegistry.registerContribution(SIDEBAR_AUXILIARY,{name:"aiview",label:"AI",icon:"robot",component:ee=>x$1`<k-aiview id="${ee}"></k-aiview>`});contributionRegistry.registerContribution("system.fastviews-bottomend",{name:"log-terminal",label:"Log Messages",icon:"list",component:ee=>x$1`<k-log-terminal id="${ee}"></k-log-terminal>`});contributionRegistry.registerContribution(TOOLBAR_BOTTOM,{slot:"start",label:"Workspace",html:"<k-workspace-name></k-workspace-name>"});contributionRegistry.registerContribution(TOOLBAR_BOTTOM_END,{label:"Info",icon:"circle-info",command:"show_version_info",showLabel:!0});contributionRegistry.registerContribution(TOOLBAR_BOTTOM_END,{label:"Fast Views",html:'<k-fastviews target="system.fastviews-bottomend" icon="bolt" title="Fast Views"></k-fastviews>'});contributionRegistry.registerContribution(TOOLBAR_BOTTOM_END,{label:"Language",html:()=>x$1`<k-language-selector></k-language-selector>`});const logger$2=createLogger("MarketplaceRegistry"),TOPIC_MARKETPLACE_CHANGED="events/marketplaceregistry/changed",KEY_CATALOG_URLS="marketplace.catalogUrls";class MarketplaceRegistry{constructor(){this.catalogUrls=[],this.loadingPromises=new Map,this.loadCatalogUrls().then(()=>{this.refreshCatalogs().catch(O=>{logger$2.error(`Failed to refresh catalogs on init: ${O.message}`)})}),subscribe(TOPIC_MARKETPLACE_CHANGED,()=>{this.registerMarketplaceExtensions()})}async loadCatalogUrls(){try{const O=await appSettings.get(KEY_CATALOG_URLS);this.catalogUrls=Array.isArray(O)?O:[],logger$2.debug(`Loaded ${this.catalogUrls.length} catalog URLs`)}catch(O){logger$2.error(`Failed to load catalog URLs: ${O}`),this.catalogUrls=[]}}async saveCatalogUrls(){await appSettings.set(KEY_CATALOG_URLS,this.catalogUrls),publish(TOPIC_MARKETPLACE_CHANGED,{type:"catalogs",urls:this.catalogUrls})}async addCatalogUrl(O){if(!this.isValidUrl(O))throw new Error(`Invalid catalog URL: ${O}`);if(this.catalogUrls.includes(O)){logger$2.debug(`Catalog URL already exists: ${O}`);return}this.catalogUrls.push(O),await this.saveCatalogUrls(),logger$2.info(`Added catalog URL: ${O}`);try{await this.fetchCatalog(O),this.registerMarketplaceExtensions()}catch(Y){logger$2.warn(`Failed to fetch catalog immediately after adding: ${Y}`)}}async removeCatalogUrl(O){const Y=this.catalogUrls.indexOf(O);Y!==-1&&(this.catalogUrls.splice(Y,1),await this.saveCatalogUrls(),logger$2.info(`Removed catalog URL: ${O}`))}getCatalogUrls(){return[...this.catalogUrls]}isValidUrl(O){try{const Y=new URL(O);return Y.protocol==="http:"||Y.protocol==="https:"}catch{return!1}}async fetchCatalog(O){const Y=this.loadingPromises.get(O);if(Y)return Y;const te=(async()=>{try{logger$2.debug(`Fetching catalog from: ${O}`);const ne=await fetch(O,{method:"GET",headers:{Accept:"application/json"}});if(!ne.ok)throw new Error(`HTTP ${ne.status}: ${ne.statusText}`);const xe=await ne.json();if(!xe.extensions||!Array.isArray(xe.extensions))throw new Error("Invalid catalog format: extensions array is required");const et={name:xe.name,description:xe.description,extensions:xe.extensions};return logger$2.debug(`Successfully fetched catalog from ${O}: ${et.extensions.length} extensions`),et}catch(ne){throw logger$2.error(`Failed to fetch catalog from ${O}: ${ne}`),ne}finally{this.loadingPromises.delete(O)}})();return this.loadingPromises.set(O,te),te}async refreshCatalogs(){logger$2.info(`Refreshing ${this.catalogUrls.length} catalogs...`);const O=this.catalogUrls.map(te=>this.fetchCatalog(te).catch(ne=>(logger$2.warn(`Failed to refresh catalog ${te}: ${ne.message}`),null)));(await Promise.allSettled(O)).forEach((te,ne)=>{te.status==="fulfilled"&&te.value&&te.value.extensions.forEach(et=>{if(!extensionRegistry.getExtensions().find(tt=>tt.id===et.id)){const tt={...et,external:!0};extensionRegistry.registerExtension(tt),logger$2.debug(`Registered marketplace extension: ${et.id}`)}})}),publish(TOPIC_MARKETPLACE_CHANGED,{type:"refreshed"}),logger$2.info("Catalog refresh completed")}registerMarketplaceExtensions(){}getMarketplaceExtensions(){return[]}getMarketplaceExtension(O){const Y=extensionRegistry.getExtensions().find(te=>te.id===O);if(Y&&Y.external)return Y}getCatalogsWithExtensions(){return[]}async installExtension(O){if(extensionRegistry.isEnabled(O.id)){logger$2.info(`Extension ${O.id} is already installed`);return}logger$2.info(`Installing marketplace extension: ${O.name} from ${O.url}`);const Y={...O,external:!0};extensionRegistry.registerExtension(Y),await appLoaderService.loadExtensionFromUrl(O.url),logger$2.info(`Successfully installed marketplace extension: ${O.id}`)}isMarketplaceExtension(O){const Y=extensionRegistry.getExtensions().find(te=>te.id===O);return Y!==void 0&&Y.external===!0}}const marketplaceRegistry=new MarketplaceRegistry;rootContext.put("marketplaceRegistry",marketplaceRegistry);const logger$1=createLogger("MarketplaceCatalogContributions");marketplaceRegistry.addCatalogUrl("https://marketplace.kispace.de/externals.json").catch(ee=>{logger$1.warn(`Failed to add commercial catalog: ${ee}`)});function WorkerWrapper(ee){return new Worker("/assets/pyworker-_tLBWDbU.js",{type:"module",name:ee?.name})}const{parsePipRequirementsFile}=pipRequirements;let messageId=0;class PyEnv{constructor(){this.pendingMessages=new Map}async init(O,Y){this.workspace=O,this.vars=Y??{},this.worker=new WorkerWrapper,this.worker.onmessage=te=>{this.handleWorkerMessage(te.data)},this.worker.onerror=te=>{console.error("Python Worker error:",te)},await this.sendMessage("init",{vars:this.vars}),await this.mountWorkspace(),await this.installDependencies()}handleWorkerMessage(O){if(O.id==="interrupt-buffer"){O.type==="success"?this.interruptBuffer=new Uint8Array(O.payload):this.interruptBuffer=void 0;return}if(O.type==="inputRequest"){const te=O.payload.prompt||"Input:",ne=window.prompt(te);this.worker.postMessage({id:O.id,type:"inputResponse",payload:{value:ne,cancelled:ne===null}});return}if(O.type==="stdout"){this.stdoutCallback?this.stdoutCallback(O.payload):console.info(O.payload);return}if(O.type==="stderr"){this.stderrCallback?this.stderrCallback(O.payload):console.error(O.payload);return}if(O.type==="console"){const{level:te,message:ne}=O.payload;typeof window<"u"&&window.logToTerminal&&window.logToTerminal("Python Worker",ne,te);return}const Y=this.pendingMessages.get(O.id);Y&&(this.pendingMessages.delete(O.id),O.type==="success"?Y.resolve(O.payload):O.type==="error"&&Y.reject(new Error(O.payload.message)))}async sendMessage(O,Y){if(!this.worker)throw new Error("PyEnv not initialized yet: see init()");const te=`msg-${messageId++}`,ne={id:te,type:O,payload:Y};return new Promise((xe,et)=>{this.pendingMessages.set(te,{resolve:xe,reject:et}),this.worker.postMessage(ne)})}setStdoutCallback(O){this.stdoutCallback=O}setStderrCallback(O){this.stderrCallback=O}async runFunction(O,Y){const te=await this.sendMessage("runFunction",{name:O,args:Y});return publish(TOPIC_WORKSPACE_CHANGED,this.workspace),te}async setGlobal(O,Y){await this.sendMessage("setGlobal",{key:O,value:Y})}async mountWorkspace(O="/workspace"){const Y=await workspaceService.getWorkspace();await this.sendMessage("mountWorkspace",{handle:Y.getHandle(),mountPoint:O})}async installDependencies(){const O=await this.workspace?.getResource("requirements.txt");if(O){const Y=(await O.getContents()).replaceAll("\r",""),te=parsePipRequirementsFile(Y).filter(ne=>"name"in ne).map(ne=>ne.name);await this.loadPackages(te)}}async loadPackages(O){O.length>0&&await this.sendMessage("loadPackages",{packages:O})}async syncWorkspace(){await this.sendMessage("syncWorkspace"),publish(TOPIC_WORKSPACE_CHANGED,this.workspace)}async execCode(O){const Y=await this.sendMessage("execCode",{code:O});return publish(TOPIC_WORKSPACE_CHANGED,this.workspace),Y}async execScript(O){const Y=O.split(".")[0],te=O.includes(":")?O.split(":").reverse()[0]:void 0;return await this.execModule(Y,te)}async execModule(O,Y){const te=await this.sendMessage("execModule",{moduleName:O,entryName:Y,vars:this.vars});return publish(TOPIC_WORKSPACE_CHANGED,this.workspace),te}async getVersion(){return await this.sendMessage("getVersion")}canInterrupt(){return this.interruptBuffer!==void 0}interrupt(){this.interruptBuffer&&(this.interruptBuffer[0]=2)}close(){this.worker&&(this.worker.terminate(),this.worker=void 0),this.pendingMessages.clear()}}class PackageInfoService{constructor(){this.packages=[]}addPackage(O){this.packages.push(O)}hasPackages(){return this.packages.length>0&&this.packages.some(O=>O.dependencies&&Object.keys(O.dependencies).length>0)}renderTree(){return this.packages.length===0?x$1``:x$1`
            <wa-tree style="--indent-guide-width: 1px;">
                ${this.packages.map(O=>{const Y=O.dependencies||{},te=Object.entries(Y);return te.length===0?x$1``:x$1`
                        <wa-tree-item expanded>
                            <span>${O.name}</span>
                            ${te.map(([ne,xe])=>x$1`
                                <wa-tree-item>
                                    <span>${ne} <small>${xe}</small></span>
                                </wa-tree-item>
                            `)}
                        </wa-tree-item>
                    `})}
            </wa-tree>
        `}}const packageInfoService=new PackageInfoService;var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(ee,O,Y,te)=>{for(var ne=te>1?void 0:te?__getOwnPropDesc(O,Y):O,xe=ee.length-1,et;xe>=0;xe--)(et=ee[xe])&&(ne=(te?et(O,Y,ne):et(ne))||ne);return te&&ne&&__defProp(O,Y,ne),ne};let KStandardApp=class extends KContainer{constructor(){super(...arguments),this.showBottomSidebar=!0,this.showBottomPanel=!1}createRenderRoot(){return this}render(){return x$1`
            <style>
                *, *::before, *::after {
                    box-sizing: border-box;
                }
                
                html {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                }
                
                body {
                    height: 100%;
                    width: 100%;
                    margin: 0;
                    padding: 0;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                }
                
                k-standard-app {
                    display: flex;
                    flex-direction: column;
                    height: 100vh;
                    width: 100%;
                }
                
                k-standard-app .toolbar-top {
                    width: 100%;
                    display: grid;
                    grid-template-columns: 1fr 2fr 1fr;
                    align-items: center;
                    border-bottom: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    flex-shrink: 0;
                }
                
                k-standard-app .toolbar-bottom {
                    width: 100%;
                    border-top: solid var(--wa-border-width-s) var(--wa-color-neutral-border-loud);
                    display: grid;
                    grid-template-columns: 1fr 2fr auto;
                    align-items: center;
                    flex-shrink: 0;
                    min-height: 32px;
                    padding: 0 var(--wa-space-s);
                    box-sizing: border-box;
                }
                
                k-standard-app .main-layout {
                    flex: 1;
                    min-height: 0;
                }
                
                k-standard-app .toolbar-end {
                    justify-self: end;
                }
            </style>
            
            <div class="toolbar-top">
                <k-toolbar id=${TOOLBAR_MAIN}></k-toolbar>
                <k-toolbar id=${TOOLBAR_MAIN_CENTER}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${TOOLBAR_MAIN_RIGHT}></k-toolbar>
            </div>
            
            <k-resizable-grid 
                class="main-layout"
                id="main-layout" 
                orientation="horizontal" 
                sizes="15%, 65%, 20%">
                
                ${this.showBottomSidebar?x$1`
                        <k-resizable-grid 
                            id="left-sidebar-split" 
                            orientation="vertical" 
                            sizes="50%, 50%">
                            <k-tabs id="${SIDEBAR_MAIN}"></k-tabs>
                            <k-tabs id="${SIDEBAR_MAIN_BOTTOM}"></k-tabs>
                        </k-resizable-grid>
                    `:x$1`<k-tabs id="${SIDEBAR_MAIN}"></k-tabs>`}
                
                ${this.showBottomPanel?x$1`
                        <k-resizable-grid 
                            id="editor-area-split" 
                            orientation="vertical" 
                            sizes="70%, 30%">
                            <k-tabs id="${EDITOR_AREA_MAIN}"></k-tabs>
                            <k-tabs id="${PANEL_BOTTOM}"></k-tabs>
                        </k-resizable-grid>
                    `:x$1`<k-tabs id="${EDITOR_AREA_MAIN}"></k-tabs>`}
                
                <k-tabs id="${SIDEBAR_AUXILIARY}"></k-tabs>
            </k-resizable-grid>
            
            <div class="toolbar-bottom">
                <k-toolbar id=${TOOLBAR_BOTTOM}></k-toolbar>
                <k-toolbar id=${TOOLBAR_BOTTOM_CENTER}></k-toolbar>
                <k-toolbar class="toolbar-end" id=${TOOLBAR_BOTTOM_END}></k-toolbar>
            </div>
        `}};__decorateClass([n$7({type:Boolean,attribute:"show-bottom-sidebar"})],KStandardApp.prototype,"showBottomSidebar",2);__decorateClass([n$7({type:Boolean,attribute:"show-bottom-panel"})],KStandardApp.prototype,"showBottomPanel",2);KStandardApp=__decorateClass([t$b("k-standard-app")],KStandardApp);const appStateEnhancer={enhance:async(ee,O)=>{try{const Y=await workspaceService.getWorkspace(),te=editorRegistry.getEditorArea()?.getActiveEditor(),ne={workspace:Y?.getName()||null,activeEditor:te?{title:te.input?.title||null,editorId:te.input?.editorId||null}:null},xe=`***App's state:***
${JSON.stringify(ne,null,2)}`;return`${ee}

${xe}`}catch{return ee}},priority:20};contributionRegistry.registerContribution(CID_PROMPT_ENHANCERS,{label:"App State Enhancer",enhancer:appStateEnhancer});const logger=createLogger("HowToService"),HOWTO_CONTRIBUTION_TARGET="system.howtos";class HowToService{constructor(){this.contributions=new Map,this.loadContributions(),subscribe(TOPIC_CONTRIBUTEIONS_CHANGED,O=>{O.target===HOWTO_CONTRIBUTION_TARGET&&this.loadContributions()})}loadContributions(){const O=contributionRegistry.getContributions(HOWTO_CONTRIBUTION_TARGET);this.contributions.clear();for(const Y of O){if(!Y.id){logger.warn("HowTo contribution missing id, skipping");continue}if(!Y.label){const xe=typeof Y.title=="function"?Y.title():Y.title;Y.label=xe}if(!Y.steps||Y.steps.length===0){logger.warn(`HowTo contribution "${Y.id}" has no steps, skipping`);continue}const te=new Set;for(const xe of Y.steps){if(te.has(xe.id)){logger.warn(`HowTo contribution "${Y.id}" has duplicate step ID: "${xe.id}"`);continue}te.add(xe.id)}this.contributions.set(Y.id,Y);const ne=typeof Y.title=="function"?Y.title():Y.title;logger.debug(`Loaded HowTo contribution: ${ne} (${Y.id})`)}logger.info(`Loaded ${this.contributions.size} HowTo contributions`)}getContribution(O){return this.contributions.get(O)}getAllContributions(){return Array.from(this.contributions.values())}getContributionsByCategory(O){return Array.from(this.contributions.values()).filter(Y=>Y.category===O)}hasContribution(O){return this.contributions.has(O)}}const howToService=new HowToService,ONBOARDING_FILE_PATH="welcome.txt";function isEditorContentProvider$2(ee){return ee&&typeof ee.getFilePath=="function"}async function isWorkspaceSelected(){return workspaceService.isConnected()}async function onboardingFileExists(){const ee=await workspaceService.getWorkspace();if(!ee)return!1;try{return await ee.getResource(ONBOARDING_FILE_PATH)instanceof File}catch{return!1}}function isOnboardingFileOpen(){const ee=activeEditorSignal.get();return!ee||!isEditorContentProvider$2(ee)?!1:ee.getFilePath()===ONBOARDING_FILE_PATH}function isActiveEditorClean(){if(!isOnboardingFileOpen())return!1;const ee=activeEditorSignal.get();return ee?ee.isDirty()===!1:!1}function isOnboardingFileClosed(){return!isOnboardingFileOpen()}function getAppName$1(){return appLoaderService.getCurrentApp()?.name||"AppSpace"}const onboardingContribution={id:"appspace.onboarding",title:()=>`Welcome to ${getAppName$1()}`,description:()=>`Get started with ${getAppName$1()} by learning the basics of workspace and file management`,icon:"graduation-cap",label:"",category:"Getting Started",initialize:ee=>{const O=[];return subscribe(TOPIC_WORKSPACE_CHANGED,()=>{ee.requestUpdate()}),subscribe(TOPIC_WORKSPACE_CONNECTED,()=>{ee.requestUpdate()}),O.push(watchSignal(activeEditorSignal,()=>{ee.requestUpdate()})),O.push(watchSignal(partDirtySignal,()=>{ee.requestUpdate()})),()=>{O.forEach(Y=>Y())}},steps:[{id:"create-text-file",title:"Create welcome.txt",description:`Create a new text file called "welcome.txt" in your workspace. If you don't have a workspace selected, choose one first.`,preCondition:async()=>await isWorkspaceSelected(),postCondition:async()=>await onboardingFileExists(),command:"create_file",commandParams:{path:ONBOARDING_FILE_PATH,contents:`Welcome to AppSpace!

This is your first file. You can edit it and save your changes.`}},{id:"open-text-file",title:"Open welcome.txt",description:'Open the "welcome.txt" file in the editor.',preCondition:async()=>await onboardingFileExists(),postCondition:()=>isOnboardingFileOpen(),command:"open_editor",commandParams:{path:ONBOARDING_FILE_PATH}},{id:"edit-and-save",title:"Type something and save",description:"Type some text in the editor to modify the file, then save it using Ctrl+S or the save button.",preCondition:()=>isOnboardingFileOpen(),postCondition:()=>isActiveEditorClean()},{id:"close-text-file",title:"Close the file",description:"Close the editor tab by clicking the X button on the tab.",preCondition:()=>isOnboardingFileOpen(),postCondition:()=>isOnboardingFileClosed()}]};contributionRegistry.registerContribution(HOWTO_CONTRIBUTION_TARGET,onboardingContribution);const AI_CONFIG_EDITOR_KEY=".system.ai-config";function isEditorContentProvider$1(ee){return ee&&typeof ee.getFilePath=="function"}function isAIConfigEditorOpen(){const ee=activeEditorSignal.get();return!ee||!isEditorContentProvider$1(ee)?!1:ee.getFilePath()===AI_CONFIG_EDITOR_KEY}async function isLLMProviderConfigured(){try{const ee=await appSettings.get(KEY_AI_CONFIG);if(!ee||!ee.defaultProvider)return!1;const O=ee.providers?.find(Y=>Y.name===ee.defaultProvider);return O?!!O.apiKey&&O.apiKey.trim()!=="":!1}catch{return!1}}function isAIConfigEditorDirty(){const ee=activeEditorSignal.get();return!ee||!isEditorContentProvider$1(ee)||ee.getFilePath()!==AI_CONFIG_EDITOR_KEY?!1:ee.isDirty()===!0}function isAIConfigEditorSaved(){return isAIConfigEditorOpen()?!isAIConfigEditorDirty():!1}function isAIConfigEditorClosed(){return!isAIConfigEditorOpen()}async function hasTypedInChat(){try{const ee=await appSettings.get("aiChatSessions");if(!ee||typeof ee!="object")return!1;for(const O in ee){const Y=ee[O];if(Y?.history&&Array.isArray(Y.history)&&Y.history.some(ne=>ne.role==="user"&&ne.content&&ne.content.trim()!==""))return!0}return!1}catch{return!1}}function getAppName(){return appLoaderService.getCurrentApp()?.name||"AppSpace"}const aiSetupContribution={id:"appspace.ai-setup",title:()=>`Set up AI in ${getAppName()}`,description:()=>`Configure an LLM provider to enable AI chat features in ${getAppName()}`,icon:"robot",label:"",category:"Getting Started",initialize:ee=>{const O=[];return O.push(watchSignal(activeEditorSignal,()=>{ee.requestUpdate()})),O.push(watchSignal(partDirtySignal,()=>{ee.requestUpdate()})),subscribe(TOPIC_AICONFIG_CHANGED,()=>{ee.requestUpdate()}),()=>{O.forEach(Y=>Y())}},steps:[{id:"open-ai-settings",title:"Open AI Settings",description:"Open the AI settings editor by clicking the robot icon in the toolbar or using the command palette.",preCondition:()=>!0,postCondition:()=>isAIConfigEditorOpen(),command:"open_ai_config"},{id:"configure-llm-provider",title:"Configure LLM Provider",description:"Select a provider as default and enter an API key. Make sure to save your changes using Ctrl+S or the save button.",preCondition:()=>isAIConfigEditorOpen(),postCondition:async()=>{const ee=await isLLMProviderConfigured(),O=isAIConfigEditorSaved();return ee&&O}},{id:"save-and-close",title:"Save and Close",description:"Save your changes (if not already saved) and close the AI settings editor tab.",preCondition:()=>isAIConfigEditorOpen(),postCondition:()=>isAIConfigEditorClosed()},{id:"type-in-chat",title:"Type in Chat",description:"Open the AI chat view (if not already open) and type a message to test your AI configuration.",preCondition:async()=>await isLLMProviderConfigured(),postCondition:async()=>await hasTypedInChat()}]};contributionRegistry.registerContribution(HOWTO_CONTRIBUTION_TARGET,aiSetupContribution);async function getWorkspaceAndPath(ee,O=!0){const Y=await workspaceService.getWorkspace();if(!Y)return null;const te=ee?.path;return O&&!te?null:{workspace:Y,path:te||""}}function isEditorContentProvider(ee){return ee&&typeof ee.getContent=="function"&&typeof ee.getSelection=="function"&&typeof ee.getSnippet=="function"&&typeof ee.getLanguage=="function"&&typeof ee.getFilePath=="function"}async function getResourceFromContext(ee,O){let Y;const te=ee.params?.path;if(te){const ne=await workspaceService.getWorkspace();ne&&(Y=await ne.getResource(te))}return Y||(Y=activeSelectionSignal.get()),Y}async function readTextFile(ee){try{const O=await ee.getContents();return typeof O!="string"?(toastError("File is not a text file"),null):O}catch(O){return toastError(`Failed to read file: ${O.message}`),null}}function createNullEditorResponse(ee=!1){const O={filePath:null,language:null};return ee?{...O,snippet:null,cursorLine:null}:O}async function getWorkspaceAndFile(ee,O=!0){const Y=await getWorkspaceAndPath(ee,O);if(!Y)return null;const{workspace:te,path:ne}=Y;if(!ne)return null;try{const xe=await te.getResource(ne);return!xe||!(xe instanceof File)?null:{workspace:te,path:ne,file:xe}}catch{return null}}registerAll({command:{id:"create_file",name:"Create new file",description:"Creates a new file within the workspace. For .geospace map files, use create_map_file instead.",keyBinding:"CTRL+N",parameters:[{name:"path",description:"the path including name of the file to be created, must be relative to the workspace",required:!1},{name:"contents",description:"the textual contents of the file",required:!1},{name:"ask",description:"whether to prompt the user for the file path",required:!1},{name:"extension",description:"required file extension (e.g., '.geospace'), will be appended if missing",required:!1}],output:[{name:"path",description:"the path of the created file"}]},handler:{execute:async({params:ee})=>{let O=ee?.path;const Y=ee?.contents,te=ee?.ask,ne=ee?.extension;if((te||!O)&&(O=await promptDialog("Enter path to new file (directories will be created if not exist):",O||""),!O))return;ne&&!O.endsWith(ne)&&(O+=ne);const xe=await getWorkspaceAndPath({path:O},!0);if(!xe)return;const{workspace:et}=xe;if(await et.getResource(O)&&!await confirmDialog(`File "${O}" already exists. Do you want to overwrite it?`))return;const it=await et.getResource(O,{create:!0});return it?(Y&&await it.saveContents(Y),defaultLogger.info("File created: "+O)):toastError("Could not create file: "+O),O}}});registerAll({command:{id:"rename_resource",name:"Rename a resource (file or directory)",description:"Renames a resource (file or directory)",keyBinding:"F2",parameters:[{name:"path",description:"the path of the resource within the workspace to rename or the currently active selection",required:!1},{name:"newName",description:"the new name for the resource",required:!1}]},handler:{execute:async ee=>{const O=await getResourceFromContext(ee);if(!O){toastError("No resource to rename provided!");return}const Y=O.getName(),te=ee.params?.newName||await promptDialog(`Enter new name for "${Y}":`,Y);if(!(!te||te===Y))try{await O.rename(te),toastInfo(`Resource renamed to: ${te}`)}catch(ne){toastError(`Failed to rename ${Y}: ${ne.message}`)}}}});registerAll({command:{id:"delete_resource",name:"Delete a resource (file or directory)",description:"Deletes a resource (file or directory)",parameters:[{name:"path",description:"the path of the resource within the workspace to delete or the currently active selection",required:!1},{name:"confirm",description:"whether to ask the user to confirm the deletion, true by default",required:!1}]},handler:{execute:async ee=>{const O=await getResourceFromContext(ee);if(!O){toastError("No resource to delete provided!");return}const Y=O.getWorkspacePath(),te=ee.params&&ee.params.confirm;let ne=!0;if((te===void 0||te===!0)&&(ne=await confirmDialog(`Are you sure you want to delete ${Y}?`)),ne)try{await O.delete(),toastInfo("Resource deleted: "+Y)}catch(xe){toastError(`Resource ${Y} could not be deleted: ${xe.message||xe}`)}}}});registerAll({command:{id:"load_workspace",name:"Local Folder",description:"Connect to a local folder using File System Access API",parameters:[]},handler:{execute:async ee=>{await window.showDirectoryPicker({mode:"readwrite"}).then(O=>workspaceService.connectWorkspace(O)).catch(O=>{toastError(O.message)})}},contribution:{target:"filebrowser.connections",label:"Local Folder",icon:"folder-open"}});registerAll({command:{id:"reload_workspace",name:"Reload workspace folder",description:"Reloads the active workspace folder",parameters:[]},handler:{execute:async ee=>{const O=await workspaceService.getWorkspace();O||toastError("No workspace selected."),O.touch()}}});registerAll({command:{id:"open_editor",name:"Open editor",description:"Opens a file in an editor",parameters:[{name:"path",description:"tha path of the file to open within the workspace",required:!0}]},handler:{execute:async ee=>{const O=await getWorkspaceAndFile({path:ee.params?.path});if(!O)return;const{file:Y}=O;await editorRegistry.loadEditor(Y)}}});registerAll({command:{id:"head_file",name:"Head - Show first lines",description:"Shows the first N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the beginning (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the first N lines of the file"}]},handler:{execute:async({params:ee})=>{const O=await getWorkspaceAndFile(ee);if(!O)return;const{file:Y}=O,te=ee?.lines?parseInt(ee.lines,10):10;if(isNaN(te)||te<1){toastError("Number of lines must be a positive integer");return}const ne=await readTextFile(Y);return ne?ne.split(`
`).slice(0,te).join(`
`):void 0}}});registerAll({command:{id:"tail_file",name:"Tail - Show last lines",description:"Shows the last N lines of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0},{name:"lines",description:"number of lines to show from the end (default: 10)",type:"number",required:!1}],output:[{name:"content",description:"the last N lines of the file"}]},handler:{execute:async({params:ee})=>{const O=await getWorkspaceAndFile(ee);if(!O)return;const{file:Y}=O,te=ee?.lines?parseInt(ee.lines,10):10;if(isNaN(te)||te<1){toastError("Number of lines must be a positive integer");return}const ne=await readTextFile(Y);return ne?ne.split(`
`).slice(-te).join(`
`):void 0}}});registerAll({command:{id:"cat_file",name:"Cat - Show file contents",description:"Shows the complete contents of a file",parameters:[{name:"path",description:"the path of the file to read",required:!0}],output:[{name:"content",description:"the complete contents of the file"}]},handler:{execute:async({params:ee})=>{const O=await getWorkspaceAndFile(ee);if(!O)return;const{file:Y}=O;return await readTextFile(Y)}}});registerAll({command:{id:"wc_file",name:"Word count",description:"Counts lines, words, and characters in a file",parameters:[{name:"path",description:"the path of the file to analyze",required:!0}],output:[{name:"lines",description:"number of lines in the file"},{name:"words",description:"number of words in the file"},{name:"characters",description:"number of characters in the file"}]},handler:{execute:async({params:ee})=>{const O=await getWorkspaceAndFile(ee);if(!O)return;const{file:Y}=O,te=await readTextFile(Y);if(!te)return;const xe=te.split(`
`).length,et=te.trim()===""?0:te.trim().split(/\s+/).filter(it=>it.length>0).length,tt=te.length;return{lines:xe,words:et,characters:tt}}}});registerAll({command:{id:"file_exists",name:"Check if file exists",description:"Checks if a file exists at the given path",parameters:[{name:"path",description:"the path of the file to check, relative to the workspace",required:!0}],output:[{name:"exists",description:"true if the file exists, false otherwise"}]},handler:{execute:async({params:ee})=>{const O=await getWorkspaceAndPath(ee);if(!O)return!1;const{workspace:Y,path:te}=O;try{return await Y.getResource(te)instanceof File}catch{return!1}}}});async function collectFilesRecursive(ee){const O=[],Y=await ee.listChildren(!0);for(const te of Y)if(te instanceof File)O.push(te.getWorkspacePath());else if(te instanceof Directory){const ne=await collectFilesRecursive(te);O.push(...ne)}return O}registerAll({command:{id:"ls",name:"List files",description:"Lists files from a directory. If recursive is provided, it traverses from the provided directory down to all leaves. If no directory is provided, it will traverse from the workspace root.",parameters:[{name:"path",description:"the path of the directory to list, relative to the workspace. If not provided, uses workspace root",required:!1},{name:"recursive",description:"whether to recursively traverse all subdirectories",type:"boolean",required:!1}],output:[{name:"files",description:"array of file objects with path and size information"}]},handler:{execute:async({params:ee})=>{const O=await getWorkspaceAndPath(ee,!1);if(!O)return toastError("No workspace available"),[];const{workspace:Y,path:te}=O,ne=ee?.recursive===!0||ee?.recursive==="true";try{let xe=Y;if(te){const et=await Y.getResource(te);if(!et)return toastError(`Path not found: ${te}`),[];if(!(et instanceof Directory))return toastError(`Path is not a directory: ${te}`),[];xe=et}if(ne){const et=await collectFilesRecursive(xe),tt=[];for(const it of et){const st=await Y.getResource(it);if(st instanceof File){const ot=await st.size();tt.push({path:it,size:ot})}}return tt}else{const et=await xe.listChildren(!0),tt=[];for(const it of et)if(it instanceof File){const st=await it.size();tt.push({path:it.getWorkspacePath(),size:st})}return tt}}catch(xe){return toastError(`Failed to list files: ${xe.message}`),[]}}}});registerAll({command:{id:"get_active_editor_content",name:"Get active editor content",description:"Gets the complete contents of the currently active editor. Returns null if no editor is active or if the editor is not a code editor.",parameters:[],output:[{name:"content",description:"the complete contents of the active editor, or null if no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"}]},handler:{execute:async ee=>{const O=ee.activeEditor;if(!isEditorContentProvider(O))return{...createNullEditorResponse(),content:null};try{return{content:O.getContent(),filePath:O.getFilePath(),language:O.getLanguage()}}catch{return{...createNullEditorResponse(),content:null}}}}});registerAll({command:{id:"get_active_editor_selection",name:"Get active editor selection",description:"Gets the currently selected text in the active editor. Returns null if no editor is active, no selection exists, or if the editor is not a code editor.",parameters:[],output:[{name:"selection",description:"the selected text in the active editor, or null if no selection exists or no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"}]},handler:{execute:async ee=>{const O=ee.activeEditor;if(!isEditorContentProvider(O))return{...createNullEditorResponse(),selection:null};try{return{selection:O.getSelection(),filePath:O.getFilePath(),language:O.getLanguage()}}catch{return{...createNullEditorResponse(),selection:null}}}}});registerAll({command:{id:"get_active_editor_snippet",name:"Get active editor snippet around cursor",description:"Gets a code snippet from the active editor with n lines before and n lines after the cursor position. Useful for getting context around the cursor without loading the entire file.",parameters:[{name:"lines",description:"number of lines to include before and after the cursor position (default: 5)",type:"number",required:!1}],output:[{name:"snippet",description:"the code snippet with n lines before and after the cursor, or null if no editor is active"},{name:"filePath",description:"the workspace path of the file in the active editor, or null if no editor is active"},{name:"language",description:"the programming language of the active editor, or null if no editor is active"},{name:"cursorLine",description:"the line number where the cursor is positioned (1-based), or null if no editor is active"}]},handler:{execute:async ee=>{const O=ee.activeEditor;if(!isEditorContentProvider(O))return createNullEditorResponse(!0);try{const Y=ee.params?.lines?parseInt(ee.params.lines,10):5;if(isNaN(Y)||Y<0)return createNullEditorResponse(!0);const te=O.getSnippet(Y);return te?{snippet:te.snippet,filePath:O.getFilePath(),language:O.getLanguage(),cursorLine:te.cursorLine}:createNullEditorResponse(!0)}catch{return createNullEditorResponse(!0)}}}});registerAll({command:{id:"show_version_info",name:"Show Version Info",description:"Shows application version information",parameters:[]},handler:{execute:async ee=>{const O=appLoaderService.getCurrentApp();if(!O){toastError("No app loaded");return}const Y=packageInfoService.hasPackages(),te=packageInfoService.renderTree();let ne=null;const xe=()=>(ne||(ne=document.getElementById("global-dialog-container")||document.createElement("div"),ne.id||(ne.id="global-dialog-container",document.body.appendChild(ne))),ne),et=()=>{ne&&B$1(x$1``,ne)},tt=dt=>{const ht=k.parse(dt,{async:!1});return x$1`${o$5(ht)}`};let it=[];if(O.releaseHistory)if(typeof O.releaseHistory=="function")try{it=await O.releaseHistory()}catch(dt){console.error("Failed to load release history from app:",dt),it=[]}else it=O.releaseHistory;O.version;const st=it.length>0?it.findIndex(dt=>dt.tag_name===O.version):-1,ot=st>=0?st:0;let rt=ot;const nt=dt=>{if(it.length===0)return"";const ht=it[dt],pt=ht.tag_name===O.version;let ft=`**Version:** ${ht.tag_name}`;pt&&(ft+=" (Current)"),ft+=`

`;const mt=new Date(ht.published_at).toLocaleDateString();if(ft+=`**Released:** ${mt}

`,!pt){const yt=O.version.replace(/^v/,""),bt=ht.tag_name.replace(/^v/,""),vt=yt.split(".").map(Number),Et=bt.split(".").map(Number);let wt=!1;for(let St=0;St<Math.max(vt.length,Et.length);St++){const Ot=vt[St]||0,$t=Et[St]||0;if($t>Ot){wt=!0;break}if($t<Ot)break}wt&&(ft+=` **Update available - reload page to update**

`)}return ht.body&&(ft+=`---

${ht.body}`),ft},at=()=>{et()},ct=()=>{et()},ut=dt=>{const ht=nt(dt),pt=it.length>0,ft=x$1`
                    <wa-dialog 
                        label="About ${O.name} - ${O.version}"
                        open 
                        light-dismiss
                        style="--width: 600px;"
                        @wa-request-close=${at}
                        @wa-after-hide=${ct}
                    >
                        <style>
                            .dialog-content {
                                height: 600px;
                            }
                            
                            wa-tree-item > span small {
                                color: var(--wa-color-neutral-60);
                                font-size: 0.875em;
                                margin-left: 0.5rem;
                            }
                        </style>
                        <small>${O.description}</small>
                        <div class="dialog-content">
                            <wa-tab-group>
                                ${it.length>0?x$1`
                                    <wa-tab slot="nav" panel="release">Release History</wa-tab>
                                    <wa-tab-panel name="release">
                                        ${tt(ht)}
                                    </wa-tab-panel>
                                `:""}
                                
                                ${Y?x$1`
                                    <wa-tab slot="nav" panel="packages">NPM Packages</wa-tab>
                                    <wa-tab-panel name="packages">
                                        ${te}
                                    </wa-tab-panel>
                                `:""}
                            </wa-tab-group>
                        </div>
                        <div slot="footer">
                            ${pt?x$1`
                                <wa-button 
                                    variant="default"
                                    ?disabled=${dt===it.length-1}
                                    @click=${()=>{dt<it.length-1&&(rt=dt+1,ut(rt))}}
                                >
                                     Previous
                                </wa-button>
                                <wa-button 
                                    variant="default"
                                    ?disabled=${dt===0}
                                    @click=${()=>{dt>0&&(rt=dt-1,ut(rt))}}
                                >
                                    Next 
                                </wa-button>
                            `:""}
                            <wa-button variant="primary" data-dialog="close">Close</wa-button>
                        </div>
                    </wa-dialog>
                `;B$1(ft,xe())};return ut(ot),new Promise(dt=>{const ht=()=>{ne?.querySelector("wa-dialog[open]")?setTimeout(ht,100):dt()};ht()})}}});registerAll({command:{id:"python",name:"Run Python Script",description:"Executes a Python script given its file path",parameters:[{name:"script",description:"the path to a Python script to run",required:!1}]},handler:{execute:async ee=>{const O=ee.params.script;if(!O)return;const Y=new PyEnv,te=await workspaceService.getWorkspace();await Y.init(te,ee),await Y.installDependencies(),await Y.execScript(O)}}});registerAll({command:{id:"js",name:"Run JavaScript file",description:"Executes a JavaScript file given its path",parameters:[{name:"script",description:"the path to a JavaScript file to run",required:!1}]}});registerAll({command:{id:"save",name:"Save editor",description:"Saves the active/focused editor",keyBinding:"CTRL+S",parameters:[]},handler:{execute:async ee=>{const O=activeEditorSignal.get()||activePartSignal.get();O&&O.isDirty()&&O.save()}},contribution:{target:"toolbar:.system.editors",icon:"floppy-disk",label:"Save active editor",slot:"start",disabled:()=>{const ee=activePartSignal.get();return!ee||!ee.isDirty()}}});registerAll({command:{id:"run_python",name:"Run Python Cell",description:"Runs active Python code in a supporting context (e.g. notebook, terminal, etc.)",keyBinding:"CTRL+R",parameters:[]}});const THEME_SETTINGS_KEY="theme";async function applyTheme(ee){const O=document.documentElement;O.classList.remove("wa-dark","wa-light"),O.classList.add(ee)}async function loadTheme(){const ee=await appSettings.get(THEME_SETTINGS_KEY);await applyTheme(ee||"wa-dark")}async function saveTheme(ee){await appSettings.set(THEME_SETTINGS_KEY,ee)}registerAll({command:{id:"switch_theme",name:"Switch theme",description:"Switches between dark and light theme",parameters:[]},handler:{execute:async ee=>{const Y=document.documentElement.classList.contains("wa-dark")?"wa-light":"wa-dark";await applyTheme(Y),await saveTheme(Y)}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"circle-half-stroke",label:"Theme Switcher"}});loadTheme().catch(ee=>{console.error("Failed to load theme preference:",ee)});registerAll({command:{id:"fullscreen",name:"Toggle fullscreen",description:"Toggles fullscreen mode",parameters:[]},handler:{execute:async ee=>{document.fullscreenElement===document.body?await document.exitFullscreen():await document.body.requestFullscreen()}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"expand",label:"Fullscreen"}});registerAll({command:{id:"open_settings",name:"Open Settings",description:"Opens the settings file in an editor",parameters:[]},handler:{execute:ee=>{const O={title:"settings.json",data:{async getContents(){const Y=await appSettings.getAll();return JSON.stringify(Y,void 0,2)},getName(){return O.key},saveContents(Y){const te=JSON.parse(Y);return appSettings.setAll(te)}},key:"setting.json",editorId:"monaco-editor",icon:"gear",state:{}};O.widgetFactory=()=>x$1`
                <k-monaco-editor .input=${O}></k-monaco-editor>`,editorRegistry.loadEditor(O).then()}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"gear",label:"Open Settings"}});registerAll({command:{id:"open_extensions",name:"Open Extensions",description:"Opens the extensions registry",parameters:[]},handler:{execute:ee=>{const O={title:"Extensions",data:{},key:"system.extensions",editorId:"extensions-editor",icon:"puzzle-piece",state:{},noOverflow:!0};O.widgetFactory=()=>x$1`
                <k-extensions></k-extensions>`,editorRegistry.loadEditor(O).then()}},contribution:{target:TOOLBAR_MAIN_RIGHT,icon:"puzzle-piece",label:"Open Extensions"}});registerAll({command:{id:"list_extensions",name:"List extensions",description:"Lists all available extensions with their status (enabled/disabled)",parameters:[],output:[{name:"extensions",description:"array of extension objects with id, name, description, experimental flag, and enabled status"}]},handler:{execute:async ee=>extensionRegistry.getExtensions().map(Y=>({id:Y.id,name:Y.name,description:Y.description,experimental:Y.experimental,enabled:extensionRegistry.isEnabled(Y.id)}))}});registerAll({command:{id:"toast_message",name:"Toast message to user",description:"Shows a toast message",parameters:[{name:"message",description:"the message to toast",required:!0},{name:"type",description:"the toast type: info (default), or error",required:!1}]},handler:{execute:({params:{message:ee,type:O}})=>{ee&&(O==="error"?toastError(ee):toastInfo(ee))}}});packageInfoService.addPackage({name:appspacePackageJson.name,version:appspacePackageJson.version,dependencies:appspacePackageJson.dependencies,devDependencies:appspacePackageJson.devDependencies});const byteToHex=[];for(let ee=0;ee<256;++ee)byteToHex.push((ee+256).toString(16).slice(1));function unsafeStringify(ee,O=0){return(byteToHex[ee[O+0]]+byteToHex[ee[O+1]]+byteToHex[ee[O+2]]+byteToHex[ee[O+3]]+"-"+byteToHex[ee[O+4]]+byteToHex[ee[O+5]]+"-"+byteToHex[ee[O+6]]+byteToHex[ee[O+7]]+"-"+byteToHex[ee[O+8]]+byteToHex[ee[O+9]]+"-"+byteToHex[ee[O+10]]+byteToHex[ee[O+11]]+byteToHex[ee[O+12]]+byteToHex[ee[O+13]]+byteToHex[ee[O+14]]+byteToHex[ee[O+15]]).toLowerCase()}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");getRandomValues=crypto.getRandomValues.bind(crypto)}return getRandomValues(rnds8)}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function _v4(ee,O,Y){ee=ee||{};const te=ee.random??ee.rng?.()??rng();if(te.length<16)throw new Error("Random bytes length must be >= 16");if(te[6]=te[6]&15|64,te[8]=te[8]&63|128,O){if(Y=Y||0,Y<0||Y+16>O.length)throw new RangeError(`UUID byte range ${Y}:${Y+15} is out of buffer bounds`);for(let ne=0;ne<16;++ne)O[Y+ne]=te[ne];return O}return unsafeStringify(te)}function v4(ee,O,Y){return native.randomUUID&&!O&&!ee?native.randomUUID():_v4(ee,O,Y)}const KEY_LABEL="label",KEY_NAME="name",KEY_URL="url",KEY_FORMAT="format",KEY_STATE="_state",KEY_SRC="src",KEY_SOURCETYPE="sourceType",KEY_ENV="_env",KEY_GS_MANAGED="gsManaged",KEY_UUID="uuid",KEY_EVENT_SUBSCRIPTIONS="_eventSubscriptions";function ensureUuid(ee){return ee.uuid||(ee.uuid=v4()),ee}function ensureUuidsRecursive(ee){if(ensureUuid(ee),"geometry"in ee&&ee.geometry&&ensureUuid(ee.geometry),"source"in ee&&ee.source){const O=ee.source;ensureUuid(O),O.features&&Array.isArray(O.features)&&O.features.forEach(Y=>ensureUuidsRecursive(Y))}return"layers"in ee&&Array.isArray(ee.layers)&&ee.layers.forEach(O=>ensureUuidsRecursive(O)),"overlays"in ee&&Array.isArray(ee.overlays)&&ee.overlays.forEach(O=>ensureUuid(O)),"controls"in ee&&Array.isArray(ee.controls)&&ee.controls.forEach(O=>ensureUuid(O)),"interactions"in ee&&Array.isArray(ee.interactions)&&ee.interactions.forEach(O=>ensureUuid(O)),"view"in ee&&ee.view&&ensureUuid(ee.view),ee}var GsSourceType=(ee=>(ee.OSM="OSM",ee.GeoJSON="GeoJSON",ee.Features="Features",ee.KML="KML",ee.GeoTIFF="GeoTIFF",ee.GPX="GPX",ee.BM="BM",ee.WMS="WMS",ee.WMTS="WMTS",ee.XYZ="XYZ",ee))(GsSourceType||{}),GsLayerType=(ee=>(ee.TILE="TILE",ee.VECTOR="VECTOR",ee.GROUP="GROUP",ee))(GsLayerType||{});const DEFAULT_STYLES={"default-point":{id:"default-point",image:{type:"circle",radius:5,fill:{color:"rgba(0, 100, 255, 0.8)"},stroke:{color:"white",width:2}}},"default-line":{id:"default-line",stroke:{color:"rgba(0, 100, 255, 0.8)",width:2}},"default-polygon":{id:"default-polygon",fill:{color:"rgba(0, 100, 255, 0.3)"},stroke:{color:"rgba(0, 100, 255, 0.8)",width:2}},selection:{id:"selection",image:{type:"circle",radius:7,fill:{color:"rgba(255, 255, 0, 0.3)"},stroke:{color:"rgba(255, 255, 0, 1)",width:3}},stroke:{color:"rgba(255, 255, 0, 1)",width:3},fill:{color:"rgba(255, 255, 0, 0.3)"}}};function evaluateStyleRule(ee,O,Y){const te=ee.condition;if(te.geometryType&&!(Array.isArray(te.geometryType)?te.geometryType:[te.geometryType]).includes(O.geometry.type)||te.layerName&&te.layerName!==Y)return!1;if(te.property){const ne=te.property,xe=O.state?.[ne.key];if(!ne.operator||ne.operator==="exists")return xe!==void 0;if(ne.operator==="equals")return xe===ne.value;if(ne.operator==="not-equals")return xe!==ne.value;if(ne.operator==="contains"&&typeof xe=="string"&&typeof ne.value=="string")return xe.includes(ne.value);if(ne.operator==="greater-than"&&typeof xe=="number"&&typeof ne.value=="number")return xe>ne.value;if(ne.operator==="less-than"&&typeof xe=="number"&&typeof ne.value=="number")return xe<ne.value}return!0}function getStyleForFeature(ee,O,Y,te){const ne=[...O].sort((xe,et)=>(et.priority||0)-(xe.priority||0));for(const xe of ne)if(evaluateStyleRule(xe,ee,te))return Y[xe.styleId]}const DEFAULT_STYLE_RULES=[{id:"default-points",condition:{geometryType:["Point","MultiPoint"]},styleId:"default-point",priority:0},{id:"default-lines",condition:{geometryType:["LineString","MultiLineString"]},styleId:"default-line",priority:0},{id:"default-polygons",condition:{geometryType:["Polygon","MultiPolygon","Circle"]},styleId:"default-polygon",priority:0}],DEFAULT_GSMAP=ensureUuid({view:ensureUuid({center:[0,0],zoom:0,projection:"EPSG:3857"}),layers:[ensureUuid({type:"TILE",source:ensureUuid({type:"OSM"})})],overlays:[],controls:[],interactions:[],state:{},styles:{...DEFAULT_STYLES},styleRules:[...DEFAULT_STYLE_RULES]}),CollectionEventType={ADD:"add",REMOVE:"remove"},ObjectEventType={PROPERTYCHANGE:"propertychange"},EventType={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Disposable{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function binarySearch$1(ee,O,Y){let te,ne;Y=Y||ascending;let xe=0,et=ee.length,tt=!1;for(;xe<et;)te=xe+(et-xe>>1),ne=+Y(ee[te],O),ne<0?xe=te+1:(et=te,tt=!ne);return tt?xe:~xe}function ascending(ee,O){return ee>O?1:ee<O?-1:0}function descending(ee,O){return ee<O?1:ee>O?-1:0}function linearFindNearest(ee,O,Y){if(ee[0]<=O)return 0;const te=ee.length;if(O<=ee[te-1])return te-1;if(typeof Y=="function"){for(let ne=1;ne<te;++ne){const xe=ee[ne];if(xe===O)return ne;if(xe<O)return Y(O,ee[ne-1],xe)>0?ne-1:ne}return te-1}if(Y>0){for(let ne=1;ne<te;++ne)if(ee[ne]<O)return ne-1;return te-1}if(Y<0){for(let ne=1;ne<te;++ne)if(ee[ne]<=O)return ne;return te-1}for(let ne=1;ne<te;++ne){if(ee[ne]==O)return ne;if(ee[ne]<O)return ee[ne-1]-O<O-ee[ne]?ne-1:ne}return te-1}function reverseSubArray(ee,O,Y){for(;O<Y;){const te=ee[O];ee[O]=ee[Y],ee[Y]=te,++O,--Y}}function extend$2(ee,O){const Y=Array.isArray(O)?O:[O],te=Y.length;for(let ne=0;ne<te;ne++)ee[ee.length]=Y[ne]}function equals$2(ee,O){const Y=ee.length;if(Y!==O.length)return!1;for(let te=0;te<Y;te++)if(ee[te]!==O[te])return!1;return!0}function isSorted(ee,O,Y){const te=O||ascending;return ee.every(function(ne,xe){if(xe===0)return!0;const et=te(ee[xe-1],ne);return!(et>0||et===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(ee){let O,Y,te;return function(){const ne=Array.prototype.slice.call(arguments);return(!Y||this!==te||!equals$2(ne,Y))&&(te=this,Y=ne,O=ee.apply(this,arguments)),O}}function toPromise(ee){function O(){let Y;try{Y=ee()}catch(te){return Promise.reject(te)}return Y instanceof Promise?Y:Promise.resolve(Y)}return O()}function clear$2(ee){for(const O in ee)delete ee[O]}function isEmpty$1(ee){let O;for(O in ee)return!1;return!O}class BaseEvent{constructor(O){this.propagationStopped,this.defaultPrevented,this.type=O,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Target extends Disposable{constructor(O){super(),this.eventTarget_=O,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(O,Y){if(!O||!Y)return;const te=this.listeners_||(this.listeners_={}),ne=te[O]||(te[O]=[]);ne.includes(Y)||ne.push(Y)}dispatchEvent(O){const Y=typeof O=="string",te=Y?O:O.type,ne=this.listeners_&&this.listeners_[te];if(!ne)return;const xe=Y?new BaseEvent(O):O;xe.target||(xe.target=this.eventTarget_||this);const et=this.dispatching_||(this.dispatching_={}),tt=this.pendingRemovals_||(this.pendingRemovals_={});te in et||(et[te]=0,tt[te]=0),++et[te];let it;for(let st=0,ot=ne.length;st<ot;++st)if("handleEvent"in ne[st]?it=ne[st].handleEvent(xe):it=ne[st].call(this,xe),it===!1||xe.propagationStopped){it=!1;break}if(--et[te]===0){let st=tt[te];for(delete tt[te];st--;)this.removeEventListener(te,VOID);delete et[te]}return it}disposeInternal(){this.listeners_&&clear$2(this.listeners_)}getListeners(O){return this.listeners_&&this.listeners_[O]||void 0}hasListener(O){return this.listeners_?O?O in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(O,Y){if(!this.listeners_)return;const te=this.listeners_[O];if(!te)return;const ne=te.indexOf(Y);ne!==-1&&(this.pendingRemovals_&&O in this.pendingRemovals_?(te[ne]=VOID,++this.pendingRemovals_[O]):(te.splice(ne,1),te.length===0&&delete this.listeners_[O]))}}function listen(ee,O,Y,te,ne){if(ne){const et=Y;Y=function(tt){return ee.removeEventListener(O,Y),et.call(te??this,tt)}}else te&&te!==ee&&(Y=Y.bind(te));const xe={target:ee,type:O,listener:Y};return ee.addEventListener(O,Y),xe}function listenOnce(ee,O,Y,te){return listen(ee,O,Y,te,!0)}function unlistenByKey(ee){ee&&ee.target&&(ee.target.removeEventListener(ee.type,ee.listener),clear$2(ee))}const events=Object.freeze(Object.defineProperty({__proto__:null,listen,listenOnce,unlistenByKey},Symbol.toStringTag,{value:"Module"}));class Observable extends Target{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(EventType.CHANGE)}getRevision(){return this.revision_}onInternal(O,Y){if(Array.isArray(O)){const te=O.length,ne=new Array(te);for(let xe=0;xe<te;++xe)ne[xe]=listen(this,O[xe],Y);return ne}return listen(this,O,Y)}onceInternal(O,Y){let te;if(Array.isArray(O)){const ne=O.length;te=new Array(ne);for(let xe=0;xe<ne;++xe)te[xe]=listenOnce(this,O[xe],Y)}else te=listenOnce(this,O,Y);return Y.ol_key=te,te}unInternal(O,Y){const te=Y.ol_key;if(te)unByKey(te);else if(Array.isArray(O))for(let ne=0,xe=O.length;ne<xe;++ne)this.removeEventListener(O[ne],Y);else this.removeEventListener(O,Y)}}Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(ee){if(Array.isArray(ee))for(let O=0,Y=ee.length;O<Y;++O)unlistenByKey(ee[O]);else unlistenByKey(ee)}function abstract(){throw new Error("Unimplemented abstract method.")}let uidCounter_=0;function getUid(ee){return ee.ol_uid||(ee.ol_uid=String(++uidCounter_))}const VERSION="10.7.0";class ObjectEvent extends BaseEvent{constructor(O,Y,te){super(O),this.key=Y,this.oldValue=te}}class BaseObject extends Observable{constructor(O){super(),this.on,this.once,this.un,getUid(this),this.values_=null,O!==void 0&&this.setProperties(O)}get(O){let Y;return this.values_&&this.values_.hasOwnProperty(O)&&(Y=this.values_[O]),Y}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(O,Y){let te;te=`change:${O}`,this.hasListener(te)&&this.dispatchEvent(new ObjectEvent(te,O,Y)),te=ObjectEventType.PROPERTYCHANGE,this.hasListener(te)&&this.dispatchEvent(new ObjectEvent(te,O,Y))}addChangeListener(O,Y){this.addEventListener(`change:${O}`,Y)}removeChangeListener(O,Y){this.removeEventListener(`change:${O}`,Y)}set(O,Y,te){const ne=this.values_||(this.values_={});if(te)ne[O]=Y;else{const xe=ne[O];ne[O]=Y,xe!==Y&&this.notify(O,xe)}}setProperties(O,Y){for(const te in O)this.set(te,O[te],Y)}applyProperties(O){O.values_&&Object.assign(this.values_||(this.values_={}),O.values_)}unset(O,Y){if(this.values_&&O in this.values_){const te=this.values_[O];delete this.values_[O],isEmpty$1(this.values_)&&(this.values_=null),Y||this.notify(O,te)}}}const Property$5={LENGTH:"length"};class CollectionEvent extends BaseEvent{constructor(O,Y,te){super(O),this.element=Y,this.index=te}}class Collection extends BaseObject{constructor(O,Y){if(super(),this.on,this.once,this.un,Y=Y||{},this.unique_=!!Y.unique,this.array_=O??[],this.unique_)for(let te=1,ne=this.array_.length;te<ne;++te)this.assertUnique_(this.array_[te],te);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(O){for(let Y=0,te=O.length;Y<te;++Y)this.push(O[Y]);return this}forEach(O){const Y=this.array_;for(let te=0,ne=Y.length;te<ne;++te)O(Y[te],te,Y)}getArray(){return this.array_}item(O){return this.array_[O]}getLength(){return this.get(Property$5.LENGTH)}insertAt(O,Y){if(O<0||O>this.getLength())throw new Error("Index out of bounds: "+O);this.unique_&&this.assertUnique_(Y),this.array_.splice(O,0,Y),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,Y,O))}pop(){return this.removeAt(this.getLength()-1)}push(O){const Y=this.getLength();return this.insertAt(Y,O),this.getLength()}remove(O){const Y=this.array_;for(let te=0,ne=Y.length;te<ne;++te)if(Y[te]===O)return this.removeAt(te)}removeAt(O){if(O<0||O>=this.getLength())return;const Y=this.array_[O];return this.array_.splice(O,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,Y,O)),Y}setAt(O,Y){const te=this.getLength();if(O>=te){this.insertAt(O,Y);return}if(O<0)throw new Error("Index out of bounds: "+O);this.unique_&&this.assertUnique_(Y,O);const ne=this.array_[O];this.array_[O]=Y,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,ne,O)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,Y,O))}updateLength_(){this.set(Property$5.LENGTH,this.array_.length)}assertUnique_(O,Y){const te=this.array_;for(let ne=0,xe=te.length;ne<xe;++ne)if(te[ne]===O&&ne!==Y)throw new Error("Duplicate item added to a unique collection")}}function assert(ee,O){if(!ee)throw new Error(O)}class Feature extends BaseObject{constructor(O){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),O)if(typeof O.getSimplifiedGeometry=="function"){const Y=O;this.setGeometry(Y)}else{const Y=O;this.setProperties(Y)}}clone(){const O=new Feature(this.hasProperties()?this.getProperties():null);O.setGeometryName(this.getGeometryName());const Y=this.getGeometry();Y&&O.setGeometry(Y.clone());const te=this.getStyle();return te&&O.setStyle(te),O}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);const O=this.getGeometry();O&&(this.geometryChangeKey_=listen(O,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(O){this.set(this.geometryName_,O)}setStyle(O){this.style_=O,this.styleFunction_=O?createStyleFunction(O):void 0,this.changed()}setId(O){this.id_=O,this.changed()}setGeometryName(O){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=O,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function createStyleFunction(ee){if(typeof ee=="function")return ee;let O;return Array.isArray(ee)?O=ee:(assert(typeof ee.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),O=[ee]),function(){return O}}const Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(ee){const O=createEmpty();for(let Y=0,te=ee.length;Y<te;++Y)extendCoordinate(O,ee[Y]);return O}function _boundingExtentXYs(ee,O,Y){const te=Math.min.apply(null,ee),ne=Math.min.apply(null,O),xe=Math.max.apply(null,ee),et=Math.max.apply(null,O);return createOrUpdate$2(te,ne,xe,et,Y)}function buffer$1(ee,O,Y){return Y?(Y[0]=ee[0]-O,Y[1]=ee[1]-O,Y[2]=ee[2]+O,Y[3]=ee[3]+O,Y):[ee[0]-O,ee[1]-O,ee[2]+O,ee[3]+O]}function clone(ee,O){return O?(O[0]=ee[0],O[1]=ee[1],O[2]=ee[2],O[3]=ee[3],O):ee.slice()}function closestSquaredDistanceXY(ee,O,Y){let te,ne;return O<ee[0]?te=ee[0]-O:ee[2]<O?te=O-ee[2]:te=0,Y<ee[1]?ne=ee[1]-Y:ee[3]<Y?ne=Y-ee[3]:ne=0,te*te+ne*ne}function containsCoordinate(ee,O){return containsXY(ee,O[0],O[1])}function containsExtent(ee,O){return ee[0]<=O[0]&&O[2]<=ee[2]&&ee[1]<=O[1]&&O[3]<=ee[3]}function containsXY(ee,O,Y){return ee[0]<=O&&O<=ee[2]&&ee[1]<=Y&&Y<=ee[3]}function coordinateRelationship(ee,O){const Y=ee[0],te=ee[1],ne=ee[2],xe=ee[3],et=O[0],tt=O[1];let it=Relationship.UNKNOWN;return et<Y?it=it|Relationship.LEFT:et>ne&&(it=it|Relationship.RIGHT),tt<te?it=it|Relationship.BELOW:tt>xe&&(it=it|Relationship.ABOVE),it===Relationship.UNKNOWN&&(it=Relationship.INTERSECTING),it}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate$2(ee,O,Y,te,ne){return ne?(ne[0]=ee,ne[1]=O,ne[2]=Y,ne[3]=te,ne):[ee,O,Y,te]}function createOrUpdateEmpty(ee){return createOrUpdate$2(1/0,1/0,-1/0,-1/0,ee)}function createOrUpdateFromCoordinate(ee,O){const Y=ee[0],te=ee[1];return createOrUpdate$2(Y,te,Y,te,O)}function createOrUpdateFromCoordinates(ee,O){const Y=createOrUpdateEmpty(O);return extendCoordinates(Y,ee)}function createOrUpdateFromFlatCoordinates(ee,O,Y,te,ne){const xe=createOrUpdateEmpty(ne);return extendFlatCoordinates(xe,ee,O,Y,te)}function createOrUpdateFromRings(ee,O){const Y=createOrUpdateEmpty(O);return extendRings(Y,ee)}function equals$1(ee,O){return ee[0]==O[0]&&ee[2]==O[2]&&ee[1]==O[1]&&ee[3]==O[3]}function approximatelyEquals(ee,O,Y){return Math.abs(ee[0]-O[0])<Y&&Math.abs(ee[2]-O[2])<Y&&Math.abs(ee[1]-O[1])<Y&&Math.abs(ee[3]-O[3])<Y}function extend$1(ee,O){return O[0]<ee[0]&&(ee[0]=O[0]),O[2]>ee[2]&&(ee[2]=O[2]),O[1]<ee[1]&&(ee[1]=O[1]),O[3]>ee[3]&&(ee[3]=O[3]),ee}function extendCoordinate(ee,O){O[0]<ee[0]&&(ee[0]=O[0]),O[0]>ee[2]&&(ee[2]=O[0]),O[1]<ee[1]&&(ee[1]=O[1]),O[1]>ee[3]&&(ee[3]=O[1])}function extendCoordinates(ee,O){for(let Y=0,te=O.length;Y<te;++Y)extendCoordinate(ee,O[Y]);return ee}function extendFlatCoordinates(ee,O,Y,te,ne){for(;Y<te;Y+=ne)extendXY(ee,O[Y],O[Y+1]);return ee}function extendRings(ee,O){for(let Y=0,te=O.length;Y<te;++Y)extendCoordinates(ee,O[Y]);return ee}function extendXY(ee,O,Y){ee[0]=Math.min(ee[0],O),ee[1]=Math.min(ee[1],Y),ee[2]=Math.max(ee[2],O),ee[3]=Math.max(ee[3],Y)}function forEachCorner(ee,O){let Y;return Y=O(getBottomLeft(ee)),Y||(Y=O(getBottomRight(ee)),Y)||(Y=O(getTopRight(ee)),Y)||(Y=O(getTopLeft(ee)),Y)?Y:!1}function getArea$1(ee){let O=0;return isEmpty(ee)||(O=getWidth(ee)*getHeight(ee)),O}function getBottomLeft(ee){return[ee[0],ee[1]]}function getBottomRight(ee){return[ee[2],ee[1]]}function getCenter(ee){return[(ee[0]+ee[2])/2,(ee[1]+ee[3])/2]}function getCorner(ee,O){let Y;if(O==="bottom-left")Y=getBottomLeft(ee);else if(O==="bottom-right")Y=getBottomRight(ee);else if(O==="top-left")Y=getTopLeft(ee);else if(O==="top-right")Y=getTopRight(ee);else throw new Error("Invalid corner");return Y}function getEnlargedArea(ee,O){const Y=Math.min(ee[0],O[0]),te=Math.min(ee[1],O[1]),ne=Math.max(ee[2],O[2]),xe=Math.max(ee[3],O[3]);return(ne-Y)*(xe-te)}function getForViewAndSize(ee,O,Y,te,ne){const[xe,et,tt,it,st,ot,rt,nt]=getRotatedViewport(ee,O,Y,te);return createOrUpdate$2(Math.min(xe,tt,st,rt),Math.min(et,it,ot,nt),Math.max(xe,tt,st,rt),Math.max(et,it,ot,nt),ne)}function getRotatedViewport(ee,O,Y,te){const ne=O*te[0]/2,xe=O*te[1]/2,et=Math.cos(Y),tt=Math.sin(Y),it=ne*et,st=ne*tt,ot=xe*et,rt=xe*tt,nt=ee[0],at=ee[1];return[nt-it+rt,at-st-ot,nt-it-rt,at-st+ot,nt+it-rt,at+st+ot,nt+it+rt,at+st-ot,nt-it+rt,at-st-ot]}function getHeight(ee){return ee[3]-ee[1]}function getIntersectionArea(ee,O){const Y=getIntersection(ee,O);return getArea$1(Y)}function getIntersection(ee,O,Y){const te=Y||createEmpty();return intersects$1(ee,O)?(ee[0]>O[0]?te[0]=ee[0]:te[0]=O[0],ee[1]>O[1]?te[1]=ee[1]:te[1]=O[1],ee[2]<O[2]?te[2]=ee[2]:te[2]=O[2],ee[3]<O[3]?te[3]=ee[3]:te[3]=O[3]):createOrUpdateEmpty(te),te}function getMargin(ee){return getWidth(ee)+getHeight(ee)}function getSize(ee){return[ee[2]-ee[0],ee[3]-ee[1]]}function getTopLeft(ee){return[ee[0],ee[3]]}function getTopRight(ee){return[ee[2],ee[3]]}function getWidth(ee){return ee[2]-ee[0]}function intersects$1(ee,O){return ee[0]<=O[2]&&ee[2]>=O[0]&&ee[1]<=O[3]&&ee[3]>=O[1]}function isEmpty(ee){return ee[2]<ee[0]||ee[3]<ee[1]}function returnOrUpdate(ee,O){return O?(O[0]=ee[0],O[1]=ee[1],O[2]=ee[2],O[3]=ee[3],O):ee}function scaleFromCenter(ee,O){const Y=(ee[2]-ee[0])/2*(O-1),te=(ee[3]-ee[1])/2*(O-1);ee[0]-=Y,ee[2]+=Y,ee[1]-=te,ee[3]+=te}function intersectsSegment(ee,O,Y){let te=!1;const ne=coordinateRelationship(ee,O),xe=coordinateRelationship(ee,Y);if(ne===Relationship.INTERSECTING||xe===Relationship.INTERSECTING)te=!0;else{const et=ee[0],tt=ee[1],it=ee[2],st=ee[3],ot=O[0],rt=O[1],nt=Y[0],at=Y[1],ct=(at-rt)/(nt-ot);let ut,dt;xe&Relationship.ABOVE&&!(ne&Relationship.ABOVE)&&(ut=nt-(at-st)/ct,te=ut>=et&&ut<=it),!te&&xe&Relationship.RIGHT&&!(ne&Relationship.RIGHT)&&(dt=at-(nt-it)*ct,te=dt>=tt&&dt<=st),!te&&xe&Relationship.BELOW&&!(ne&Relationship.BELOW)&&(ut=nt-(at-tt)/ct,te=ut>=et&&ut<=it),!te&&xe&Relationship.LEFT&&!(ne&Relationship.LEFT)&&(dt=at-(nt-et)*ct,te=dt>=tt&&dt<=st)}return te}function applyTransform(ee,O,Y,te){if(isEmpty(ee))return createOrUpdateEmpty(Y);let ne=[];if(te>1){const tt=ee[2]-ee[0],it=ee[3]-ee[1];for(let st=0;st<te;++st)ne.push(ee[0]+tt*st/te,ee[1],ee[2],ee[1]+it*st/te,ee[2]-tt*st/te,ee[3],ee[0],ee[3]-it*st/te)}else ne=[ee[0],ee[1],ee[2],ee[1],ee[2],ee[3],ee[0],ee[3]];O(ne,ne,2);const xe=[],et=[];for(let tt=0,it=ne.length;tt<it;tt+=2)xe.push(ne[tt]),et.push(ne[tt+1]);return _boundingExtentXYs(xe,et,Y)}function wrapX$2(ee,O){const Y=O.getExtent(),te=getCenter(ee);if(O.canWrapX()&&(te[0]<Y[0]||te[0]>=Y[2])){const ne=getWidth(Y),et=Math.floor((te[0]-Y[0])/ne)*ne;ee[0]-=et,ee[2]-=et}return ee}function wrapAndSliceX(ee,O,Y){if(O.canWrapX()){const te=O.getExtent();if(!isFinite(ee[0])||!isFinite(ee[2]))return[[te[0],ee[1],te[2],ee[3]]];wrapX$2(ee,O);const ne=getWidth(te);if(getWidth(ee)>ne&&!Y)return[[te[0],ee[1],te[2],ee[3]]];if(ee[0]<te[0])return[[ee[0]+ne,ee[1],te[2],ee[3]],[te[0],ee[1],ee[2],ee[3]]];if(ee[2]>te[2])return[[ee[0],ee[1],te[2],ee[3]],[te[0],ee[1],ee[2]-ne,ee[3]]]}return[ee]}const extent=Object.freeze(Object.defineProperty({__proto__:null,applyTransform,approximatelyEquals,boundingExtent,buffer:buffer$1,clone,closestSquaredDistanceXY,containsCoordinate,containsExtent,containsXY,coordinateRelationship,createEmpty,createOrUpdate:createOrUpdate$2,createOrUpdateEmpty,createOrUpdateFromCoordinate,createOrUpdateFromCoordinates,createOrUpdateFromFlatCoordinates,createOrUpdateFromRings,equals:equals$1,extend:extend$1,extendCoordinate,extendCoordinates,extendFlatCoordinates,extendRings,extendXY,forEachCorner,getArea:getArea$1,getBottomLeft,getBottomRight,getCenter,getCorner,getEnlargedArea,getForViewAndSize,getHeight,getIntersection,getIntersectionArea,getMargin,getRotatedViewport,getSize,getTopLeft,getTopRight,getWidth,intersects:intersects$1,intersectsSegment,isEmpty,returnOrUpdate,scaleFromCenter,wrapAndSliceX,wrapX:wrapX$2},Symbol.toStringTag,{value:"Module"}));function clamp$1(ee,O,Y){return Math.min(Math.max(ee,O),Y)}function squaredSegmentDistance(ee,O,Y,te,ne,xe){const et=ne-Y,tt=xe-te;if(et!==0||tt!==0){const it=((ee-Y)*et+(O-te)*tt)/(et*et+tt*tt);it>1?(Y=ne,te=xe):it>0&&(Y+=et*it,te+=tt*it)}return squaredDistance$1(ee,O,Y,te)}function squaredDistance$1(ee,O,Y,te){const ne=Y-ee,xe=te-O;return ne*ne+xe*xe}function solveLinearSystem(ee){const O=ee.length;for(let te=0;te<O;te++){let ne=te,xe=Math.abs(ee[te][te]);for(let tt=te+1;tt<O;tt++){const it=Math.abs(ee[tt][te]);it>xe&&(xe=it,ne=tt)}if(xe===0)return null;const et=ee[ne];ee[ne]=ee[te],ee[te]=et;for(let tt=te+1;tt<O;tt++){const it=-ee[tt][te]/ee[te][te];for(let st=te;st<O+1;st++)te==st?ee[tt][st]=0:ee[tt][st]+=it*ee[te][st]}}const Y=new Array(O);for(let te=O-1;te>=0;te--){Y[te]=ee[te][O]/ee[te][te];for(let ne=te-1;ne>=0;ne--)ee[ne][O]-=ee[ne][te]*Y[te]}return Y}function toDegrees(ee){return ee*180/Math.PI}function toRadians(ee){return ee*Math.PI/180}function modulo(ee,O){const Y=ee%O;return Y*O<0?Y+O:Y}function lerp$1(ee,O,Y){return ee+Y*(O-ee)}function toFixed(ee,O){const Y=Math.pow(10,O);return Math.round(ee*Y)/Y}function round(ee,O){return Math.round(toFixed(ee,O))}function floor(ee,O){return Math.floor(toFixed(ee,O))}function ceil(ee,O){return Math.ceil(toFixed(ee,O))}function wrap(ee,O,Y){if(ee>=O&&ee<Y)return ee;const te=Y-O;return((ee-O)%te+te)%te+O}const DEFAULT_RADIUS=63710088e-1;function getDistance(ee,O,Y){Y=Y||DEFAULT_RADIUS;const te=toRadians(ee[1]),ne=toRadians(O[1]),xe=(ne-te)/2,et=toRadians(O[0]-ee[0])/2,tt=Math.sin(xe)*Math.sin(xe)+Math.sin(et)*Math.sin(et)*Math.cos(te)*Math.cos(ne);return 2*Y*Math.atan2(Math.sqrt(tt),Math.sqrt(1-tt))}function getLengthInternal(ee,O){let Y=0;for(let te=0,ne=ee.length;te<ne-1;++te)Y+=getDistance(ee[te],ee[te+1],O);return Y}function getLength(ee,O){O=O||{};const Y=O.radius||DEFAULT_RADIUS,te=O.projection||"EPSG:3857",ne=ee.getType();ne!=="GeometryCollection"&&(ee=ee.clone().transform(te,"EPSG:4326"));let xe=0,et,tt,it,st,ot,rt;switch(ne){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{et=ee.getCoordinates(),xe=getLengthInternal(et,Y);break}case"MultiLineString":case"Polygon":{for(et=ee.getCoordinates(),it=0,st=et.length;it<st;++it)xe+=getLengthInternal(et[it],Y);break}case"MultiPolygon":{for(et=ee.getCoordinates(),it=0,st=et.length;it<st;++it)for(tt=et[it],ot=0,rt=tt.length;ot<rt;++ot)xe+=getLengthInternal(tt[ot],Y);break}case"GeometryCollection":{const nt=ee.getGeometries();for(it=0,st=nt.length;it<st;++it)xe+=getLength(nt[it],O);break}default:throw new Error("Unsupported geometry type: "+ne)}return xe}function getAreaInternal(ee,O){let Y=0;const te=ee.length;let ne=ee[te-1][0],xe=ee[te-1][1];for(let et=0;et<te;et++){const tt=ee[et][0],it=ee[et][1];Y+=toRadians(tt-ne)*(2+Math.sin(toRadians(xe))+Math.sin(toRadians(it))),ne=tt,xe=it}return Y*O*O/2}function getArea(ee,O){O=O||{};const Y=O.radius||DEFAULT_RADIUS,te=O.projection||"EPSG:3857",ne=ee.getType();ne!=="GeometryCollection"&&(ee=ee.clone().transform(te,"EPSG:4326"));let xe=0,et,tt,it,st,ot,rt;switch(ne){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(et=ee.getCoordinates(),xe=Math.abs(getAreaInternal(et[0],Y)),it=1,st=et.length;it<st;++it)xe-=Math.abs(getAreaInternal(et[it],Y));break}case"MultiPolygon":{for(et=ee.getCoordinates(),it=0,st=et.length;it<st;++it)for(tt=et[it],xe+=Math.abs(getAreaInternal(tt[0],Y)),ot=1,rt=tt.length;ot<rt;++ot)xe-=Math.abs(getAreaInternal(tt[ot],Y));break}case"GeometryCollection":{const nt=ee.getGeometries();for(it=0,st=nt.length;it<st;++it)xe+=getArea(nt[it],O);break}default:throw new Error("Unsupported geometry type: "+ne)}return xe}function offset(ee,O,Y,te){te=te||DEFAULT_RADIUS;const ne=toRadians(ee[1]),xe=toRadians(ee[0]),et=O/te,tt=Math.asin(Math.sin(ne)*Math.cos(et)+Math.cos(ne)*Math.sin(et)*Math.cos(Y)),it=xe+Math.atan2(Math.sin(Y)*Math.sin(et)*Math.cos(ne),Math.cos(et)-Math.sin(ne)*Math.sin(tt));return[toDegrees(it),toDegrees(tt)]}const sphere=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_RADIUS,getArea,getDistance,getLength,offset},Symbol.toStringTag,{value:"Module"}));function warn(...ee){console.warn(...ee)}function error$1(...ee){console.error(...ee)}function padNumber(ee,O,Y){const te=Y!==void 0?ee.toFixed(Y):""+ee;let ne=te.indexOf(".");return ne=ne===-1?te.length:ne,ne>O?te:new Array(1+O-ne).join("0")+te}function compareVersions(ee,O){const Y=(""+ee).split("."),te=(""+O).split(".");for(let ne=0;ne<Math.max(Y.length,te.length);ne++){const xe=parseInt(Y[ne]||"0",10),et=parseInt(te[ne]||"0",10);if(xe>et)return 1;if(et>xe)return-1}return 0}function add$2(ee,O){return ee[0]+=+O[0],ee[1]+=+O[1],ee}function closestOnCircle(ee,O){const Y=O.getRadius(),te=O.getCenter(),ne=te[0],xe=te[1],et=ee[0],tt=ee[1];let it=et-ne;const st=tt-xe;it===0&&st===0&&(it=1);const ot=Math.sqrt(it*it+st*st),rt=ne+Y*it/ot,nt=xe+Y*st/ot;return[rt,nt]}function closestOnSegment(ee,O){const Y=ee[0],te=ee[1],ne=O[0],xe=O[1],et=ne[0],tt=ne[1],it=xe[0],st=xe[1],ot=it-et,rt=st-tt,nt=ot===0&&rt===0?0:(ot*(Y-et)+rt*(te-tt))/(ot*ot+rt*rt||0);let at,ct;return nt<=0?(at=et,ct=tt):nt>=1?(at=it,ct=st):(at=et+nt*ot,ct=tt+nt*rt),[at,ct]}function degreesToStringHDMS(ee,O,Y){const te=modulo(O+180,360)-180,ne=Math.abs(3600*te),xe=Y||0;let et=Math.floor(ne/3600),tt=Math.floor((ne-et*3600)/60),it=toFixed(ne-et*3600-tt*60,xe);it>=60&&(it=0,tt+=1),tt>=60&&(tt=0,et+=1);let st=et+"";return(tt!==0||it!==0)&&(st+=" "+padNumber(tt,2)+""),it!==0&&(st+=" "+padNumber(it,2,xe)+""),te!==0&&(st+=" "+ee.charAt(te<0?1:0)),st}function equals(ee,O){let Y=!0;for(let te=ee.length-1;te>=0;--te)if(ee[te]!=O[te]){Y=!1;break}return Y}function rotate$2(ee,O){const Y=Math.cos(O),te=Math.sin(O),ne=ee[0]*Y-ee[1]*te,xe=ee[1]*Y+ee[0]*te;return ee[0]=ne,ee[1]=xe,ee}function scale$4(ee,O){return ee[0]*=O,ee[1]*=O,ee}function squaredDistance(ee,O){const Y=ee[0]-O[0],te=ee[1]-O[1];return Y*Y+te*te}function distance(ee,O){return Math.sqrt(squaredDistance(ee,O))}function squaredDistanceToSegment(ee,O){return squaredDistance(ee,closestOnSegment(ee,O))}function wrapX$1(ee,O){if(O.canWrapX()){const Y=getWidth(O.getExtent()),te=getWorldsAway(ee,O,Y);te&&(ee[0]-=te*Y)}return ee}function getWorldsAway(ee,O,Y){const te=O.getExtent();let ne=0;return O.canWrapX()&&(ee[0]<te[0]||ee[0]>te[2])&&(Y=Y||getWidth(te),ne=Math.floor((ee[0]-te[0])/Y)),ne}const unitByCode={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function fromCode(ee){return unitByCode[ee]}const METERS_PER_UNIT$1={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Projection{constructor(O){this.code_=O.code,this.units_=O.units,this.extent_=O.extent!==void 0?O.extent:null,this.worldExtent_=O.worldExtent!==void 0?O.worldExtent:null,this.axisOrientation_=O.axisOrientation!==void 0?O.axisOrientation:"enu",this.global_=O.global!==void 0?O.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=O.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=O.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||METERS_PER_UNIT$1[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(O){this.global_=O,this.canWrapX_=!!(O&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(O){this.defaultTileGrid_=O}setExtent(O){this.extent_=O,this.canWrapX_=!!(this.global_&&O)}setWorldExtent(O){this.worldExtent_=O}setGetPointResolution(O){this.getPointResolutionFunc_=O}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const RADIUS$1=6378137,HALF_SIZE=Math.PI*RADIUS$1,EXTENT$2=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],MAX_SAFE_Y=RADIUS$1*Math.log(Math.tan(Math.PI/2));class EPSG3857Projection extends Projection{constructor(O){super({code:O,units:"m",extent:EXTENT$2,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(Y,te){return Y/Math.cosh(te[1]/RADIUS$1)}})}}const PROJECTIONS$1=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("http://www.opengis.net/def/crs/EPSG/0/3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(ee,O,Y,te){const ne=ee.length;Y=Y>1?Y:2,te=te??Y,O===void 0&&(Y>2?O=ee.slice():O=new Array(ne));for(let xe=0;xe<ne;xe+=te){O[xe]=HALF_SIZE*ee[xe]/180;let et=RADIUS$1*Math.log(Math.tan(Math.PI*(+ee[xe+1]+90)/360));et>MAX_SAFE_Y?et=MAX_SAFE_Y:et<-MAX_SAFE_Y&&(et=-MAX_SAFE_Y),O[xe+1]=et}return O}function toEPSG4326(ee,O,Y,te){const ne=ee.length;Y=Y>1?Y:2,te=te??Y,O===void 0&&(Y>2?O=ee.slice():O=new Array(ne));for(let xe=0;xe<ne;xe+=te)O[xe]=180*ee[xe]/HALF_SIZE,O[xe+1]=360*Math.atan(Math.exp(ee[xe+1]/RADIUS$1))/Math.PI-90;return O}const RADIUS=6378137,EXTENT$1=[-180,-90,180,90],METERS_PER_UNIT=Math.PI*RADIUS/180;class EPSG4326Projection extends Projection{constructor(O,Y){super({code:O,units:"degrees",extent:EXTENT$1,axisOrientation:Y,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT$1})}}const PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let cache$1={};function clear$1(){cache$1={}}function get$4(ee){return cache$1[ee]||cache$1[ee.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function add$1(ee,O){cache$1[ee]=O}let transforms={};function clear(){transforms={}}function add(ee,O,Y){const te=ee.getCode(),ne=O.getCode();te in transforms||(transforms[te]={}),transforms[te][ne]=Y}function get$3(ee,O){return ee in transforms&&O in transforms[ee]?transforms[ee][O]:null}const K0=.9996,E=.00669438,E2$1=E*E,E3=E2$1*E,E_P2=E/(1-E),SQRT_E=Math.sqrt(1-E),_E=(1-SQRT_E)/(1+SQRT_E),_E2=_E*_E,_E3=_E2*_E,_E4=_E3*_E,_E5=_E4*_E,M1=1-E/4-3*E2$1/64-5*E3/256,M2=3*E/8+3*E2$1/32+45*E3/1024,M3=15*E2$1/256+45*E3/1024,M4=35*E3/3072,P2=3/2*_E-27/32*_E3+269/512*_E5,P3=21/16*_E2-55/32*_E4,P4=151/96*_E3-417/128*_E5,P5=1097/512*_E4,R=6378137;function toLonLat$1(ee,O,Y){const te=ee-5e5,et=(Y.north?O:O-1e7)/K0/(R*M1),tt=et+P2*Math.sin(2*et)+P3*Math.sin(4*et)+P4*Math.sin(6*et)+P5*Math.sin(8*et),it=Math.sin(tt),st=it*it,ot=Math.cos(tt),rt=it/ot,nt=rt*rt,at=nt*nt,ct=1-E*st,ut=Math.sqrt(1-E*st),dt=R/ut,ht=(1-E)/ct,pt=E_P2*ot**2,ft=pt*pt,mt=te/(dt*K0),yt=mt*mt,bt=yt*mt,vt=bt*mt,Et=vt*mt,wt=Et*mt,St=tt-rt/ht*(yt/2-vt/24*(5+3*nt+10*pt-4*ft-9*E_P2))+wt/720*(61+90*nt+298*pt+45*at-252*E_P2-3*ft);let Ot=(mt-bt/6*(1+2*nt+pt)+Et/120*(5-2*pt+28*nt-3*ft+8*E_P2+24*at))/ot;return Ot=wrap(Ot+toRadians(zoneToCentralLongitude(Y.number)),-Math.PI,Math.PI),[toDegrees(Ot),toDegrees(St)]}const MIN_LATITUDE=-80,MAX_LATITUDE=84,MIN_LONGITUDE=-180,MAX_LONGITUDE=180;function fromLonLat$1(ee,O,Y){ee=wrap(ee,MIN_LONGITUDE,MAX_LONGITUDE),O<MIN_LATITUDE?O=MIN_LATITUDE:O>MAX_LATITUDE&&(O=MAX_LATITUDE);const te=toRadians(O),ne=Math.sin(te),xe=Math.cos(te),et=ne/xe,tt=et*et,it=tt*tt,st=toRadians(ee),ot=zoneToCentralLongitude(Y.number),rt=toRadians(ot),nt=R/Math.sqrt(1-E*ne**2),at=E_P2*xe**2,ct=xe*wrap(st-rt,-Math.PI,Math.PI),ut=ct*ct,dt=ut*ct,ht=dt*ct,pt=ht*ct,ft=pt*ct,mt=R*(M1*te-M2*Math.sin(2*te)+M3*Math.sin(4*te)-M4*Math.sin(6*te)),yt=K0*nt*(ct+dt/6*(1-tt+at)+pt/120*(5-18*tt+it+72*at-58*E_P2))+5e5;let bt=K0*(mt+nt*et*(ut/2+ht/24*(5-tt+9*at+4*at**2)+ft/720*(61-58*tt+it+600*at-330*E_P2)));return Y.north||(bt+=1e7),[yt,bt]}function zoneToCentralLongitude(ee){return(ee-1)*6-180+3}const epsgRegExes=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function zoneFromCode(ee){let O=0;for(const ne of epsgRegExes){const xe=ee.match(ne);if(xe){O=parseInt(xe[1]);break}}if(!O)return null;let Y=0,te=!1;return O>32700&&O<32761?Y=O-32700:O>32600&&O<32661&&(te=!0,Y=O-32600),Y?{number:Y,north:te}:null}function makeTransformFunction(ee,O){return function(Y,te,ne,xe){const et=Y.length;ne=ne>1?ne:2,xe=xe??ne,te||(ne>2?te=Y.slice():te=new Array(et));for(let tt=0;tt<et;tt+=xe){const it=Y[tt],st=Y[tt+1],ot=ee(it,st,O);te[tt]=ot[0],te[tt+1]=ot[1]}return te}}function makeProjection(ee){return zoneFromCode(ee)?new Projection({code:ee,units:"m"}):null}function makeTransforms(ee){const O=zoneFromCode(ee.getCode());return O?{forward:makeTransformFunction(fromLonLat$1,O),inverse:makeTransformFunction(toLonLat$1,O)}:null}const transformFactories=[makeTransforms],projectionFactories=[makeProjection];let showCoordinateWarning=!0;function disableCoordinateWarning(ee){showCoordinateWarning=!(ee===void 0?!0:ee)}function cloneTransform(ee,O){if(O!==void 0){for(let Y=0,te=ee.length;Y<te;++Y)O[Y]=ee[Y];O=O}else O=ee.slice();return O}function identityTransform(ee,O){if(O!==void 0&&ee!==O){for(let Y=0,te=ee.length;Y<te;++Y)O[Y]=ee[Y];ee=O}return ee}function addProjection(ee){add$1(ee.getCode(),ee),add(ee,ee,cloneTransform)}function addProjections(ee){ee.forEach(addProjection)}function get$2(ee){if(typeof ee!="string")return ee;const O=get$4(ee);if(O)return O;for(const Y of projectionFactories){const te=Y(ee);if(te)return te}return null}function getPointResolution(ee,O,Y,te){ee=get$2(ee);let ne;const xe=ee.getPointResolutionFunc();if(xe){if(ne=xe(O,Y),te&&te!==ee.getUnits()){const et=ee.getMetersPerUnit();et&&(ne=ne*et/METERS_PER_UNIT$1[te])}}else{const et=ee.getUnits();if(et=="degrees"&&!te||te=="degrees")ne=O;else{const tt=getTransformFromProjections(ee,get$2("EPSG:4326"));if(!tt&&et!=="degrees")ne=O*ee.getMetersPerUnit();else{let st=[Y[0]-O/2,Y[1],Y[0]+O/2,Y[1],Y[0],Y[1]-O/2,Y[0],Y[1]+O/2];st=tt(st,st,2);const ot=getDistance(st.slice(0,2),st.slice(2,4)),rt=getDistance(st.slice(4,6),st.slice(6,8));ne=(ot+rt)/2}const it=te?METERS_PER_UNIT$1[te]:ee.getMetersPerUnit();it!==void 0&&(ne/=it)}}return ne}function addEquivalentProjections(ee){addProjections(ee),ee.forEach(function(O){ee.forEach(function(Y){O!==Y&&add(O,Y,cloneTransform)})})}function addEquivalentTransforms(ee,O,Y,te){ee.forEach(function(ne){O.forEach(function(xe){add(ne,xe,Y),add(xe,ne,te)})})}function clearAllProjections(){clear$1(),clear()}function createProjection(ee,O){return ee?typeof ee=="string"?get$2(ee):ee:get$2(O)}function createTransformFromCoordinateTransform(ee){return(function(O,Y,te,ne){const xe=O.length;te=te!==void 0?te:2,ne=ne??te,Y=Y!==void 0?Y:new Array(xe);for(let et=0;et<xe;et+=ne){const tt=ee(O.slice(et,et+te)),it=tt.length;for(let st=0,ot=ne;st<ot;++st)Y[et+st]=st>=it?O[et+st]:tt[st]}return Y})}function addCoordinateTransforms(ee,O,Y,te){const ne=get$2(ee),xe=get$2(O);add(ne,xe,createTransformFromCoordinateTransform(Y)),add(xe,ne,createTransformFromCoordinateTransform(te))}function fromLonLat(ee,O){return disableCoordinateWarning(),transform(ee,"EPSG:4326",O!==void 0?O:"EPSG:3857")}function toLonLat(ee,O){const Y=transform(ee,O!==void 0?O:"EPSG:3857","EPSG:4326"),te=Y[0];return(te<-180||te>180)&&(Y[0]=modulo(te+180,360)-180),Y}function equivalent$1(ee,O){if(ee===O)return!0;const Y=ee.getUnits()===O.getUnits();return(ee.getCode()===O.getCode()||getTransformFromProjections(ee,O)===cloneTransform)&&Y}function getTransformFromProjections(ee,O){const Y=ee.getCode(),te=O.getCode();let ne=get$3(Y,te);if(ne)return ne;let xe=null,et=null;for(const it of transformFactories)xe||(xe=it(ee)),et||(et=it(O));if(!xe&&!et)return null;const tt="EPSG:4326";if(et)if(xe)ne=composeTransformFuncs(xe.inverse,et.forward);else{const it=get$3(Y,tt);it&&(ne=composeTransformFuncs(it,et.forward))}else{const it=get$3(tt,te);it&&(ne=composeTransformFuncs(xe.inverse,it))}return ne&&(addProjection(ee),addProjection(O),add(ee,O,ne)),ne}function composeTransformFuncs(ee,O){return function(Y,te,ne,xe){return te=ee(Y,te,ne,xe),O(te,te,ne,xe)}}function getTransform(ee,O){const Y=get$2(ee),te=get$2(O);return getTransformFromProjections(Y,te)}function transform(ee,O,Y){const te=getTransform(O,Y);if(!te){const ne=get$2(O).getCode(),xe=get$2(Y).getCode();throw new Error(`No transform available between ${ne} and ${xe}`)}return te(ee,void 0,ee.length)}function transformExtent(ee,O,Y,te){const ne=getTransform(O,Y);return applyTransform(ee,ne,void 0,te)}function transformWithProjections(ee,O,Y){return getTransformFromProjections(O,Y)(ee)}let userProjection=null;function setUserProjection(ee){userProjection=get$2(ee)}function clearUserProjection(){userProjection=null}function getUserProjection(){return userProjection}function useGeographic(){setUserProjection("EPSG:4326")}function toUserCoordinate(ee,O){return userProjection?transform(ee,O,userProjection):ee}function fromUserCoordinate(ee,O){return userProjection?transform(ee,userProjection,O):(showCoordinateWarning&&!equals(ee,[0,0])&&ee[0]>=-180&&ee[0]<=180&&ee[1]>=-90&&ee[1]<=90&&(showCoordinateWarning=!1,warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),ee)}function toUserExtent(ee,O){return userProjection?transformExtent(ee,O,userProjection):ee}function fromUserExtent(ee,O){return userProjection?transformExtent(ee,userProjection,O):ee}function toUserResolution(ee,O){if(!userProjection)return ee;const Y=get$2(O).getMetersPerUnit(),te=userProjection.getMetersPerUnit();return Y&&te?ee*Y/te:ee}function fromUserResolution(ee,O){if(!userProjection)return ee;const Y=get$2(O).getMetersPerUnit(),te=userProjection.getMetersPerUnit();return Y&&te?ee*te/Y:ee}function createSafeCoordinateTransform(ee,O,Y){return function(te){let ne,xe;if(ee.canWrapX()){const et=ee.getExtent(),tt=getWidth(et);te=te.slice(0),xe=getWorldsAway(te,ee,tt),xe&&(te[0]=te[0]-xe*tt),te[0]=clamp$1(te[0],et[0],et[2]),te[1]=clamp$1(te[1],et[1],et[3]),ne=Y(te)}else ne=Y(te);return xe&&O.canWrapX()&&(ne[0]+=xe*getWidth(O.getExtent())),ne}}function addCommon(){addEquivalentProjections(PROJECTIONS$1),addEquivalentProjections(PROJECTIONS),addEquivalentTransforms(PROJECTIONS,PROJECTIONS$1,fromEPSG4326,toEPSG4326)}addCommon();const proj=Object.freeze(Object.defineProperty({__proto__:null,METERS_PER_UNIT:METERS_PER_UNIT$1,Projection,addCommon,addCoordinateTransforms,addEquivalentProjections,addEquivalentTransforms,addProjection,addProjections,clearAllProjections,clearUserProjection,cloneTransform,createProjection,createSafeCoordinateTransform,createTransformFromCoordinateTransform,disableCoordinateWarning,equivalent:equivalent$1,fromLonLat,fromUserCoordinate,fromUserExtent,fromUserResolution,get:get$2,getPointResolution,getTransform,getTransformFromProjections,getUserProjection,identityTransform,setUserProjection,toLonLat,toUserCoordinate,toUserExtent,toUserResolution,transform,transformExtent,transformWithProjections,useGeographic},Symbol.toStringTag,{value:"Module"})),tmp_=new Array(6);function create$2(){return[1,0,0,1,0,0]}function reset(ee){return set(ee,1,0,0,1,0,0)}function multiply(ee,O){const Y=ee[0],te=ee[1],ne=ee[2],xe=ee[3],et=ee[4],tt=ee[5],it=O[0],st=O[1],ot=O[2],rt=O[3],nt=O[4],at=O[5];return ee[0]=Y*it+ne*st,ee[1]=te*it+xe*st,ee[2]=Y*ot+ne*rt,ee[3]=te*ot+xe*rt,ee[4]=Y*nt+ne*at+et,ee[5]=te*nt+xe*at+tt,ee}function set(ee,O,Y,te,ne,xe,et){return ee[0]=O,ee[1]=Y,ee[2]=te,ee[3]=ne,ee[4]=xe,ee[5]=et,ee}function setFromArray(ee,O){return ee[0]=O[0],ee[1]=O[1],ee[2]=O[2],ee[3]=O[3],ee[4]=O[4],ee[5]=O[5],ee}function apply$1(ee,O){const Y=O[0],te=O[1];return O[0]=ee[0]*Y+ee[2]*te+ee[4],O[1]=ee[1]*Y+ee[3]*te+ee[5],O}function rotate$1(ee,O){const Y=Math.cos(O),te=Math.sin(O);return multiply(ee,set(tmp_,Y,te,-te,Y,0,0))}function scale$3(ee,O,Y){return multiply(ee,set(tmp_,O,0,0,Y,0,0))}function translate$2(ee,O,Y){return multiply(ee,set(tmp_,1,0,0,1,O,Y))}function compose(ee,O,Y,te,ne,xe,et,tt){const it=Math.sin(xe),st=Math.cos(xe);return ee[0]=te*st,ee[1]=ne*it,ee[2]=-te*it,ee[3]=ne*st,ee[4]=et*te*st-tt*te*it+O,ee[5]=et*ne*it+tt*ne*st+Y,ee}function makeInverse(ee,O){const Y=determinant(O);assert(Y!==0,"Transformation matrix cannot be inverted");const te=O[0],ne=O[1],xe=O[2],et=O[3],tt=O[4],it=O[5];return ee[0]=et/Y,ee[1]=-ne/Y,ee[2]=-xe/Y,ee[3]=te/Y,ee[4]=(xe*it-et*tt)/Y,ee[5]=-(te*it-ne*tt)/Y,ee}function determinant(ee){return ee[0]*ee[3]-ee[1]*ee[2]}const matrixPrecision=[1e5,1e5,1e5,1e5,2,2];function toString$1(ee){return"matrix("+ee.join(", ")+")"}function fromString$1(ee){return ee.substring(7,ee.length-1).split(",").map(parseFloat)}function equivalent(ee,O){const Y=fromString$1(ee),te=fromString$1(O);for(let ne=0;ne<6;++ne)if(Math.round((Y[ne]-te[ne])*matrixPrecision[ne])!==0)return!1;return!0}function transform2D(ee,O,Y,te,ne,xe,et){xe=xe||[],et=et||2;let tt=0;for(let it=O;it<Y;it+=te){const st=ee[it],ot=ee[it+1];xe[tt++]=ne[0]*st+ne[2]*ot+ne[4],xe[tt++]=ne[1]*st+ne[3]*ot+ne[5];for(let rt=2;rt<et;rt++)xe[tt++]=ee[it+rt]}return xe&&xe.length!=tt&&(xe.length=tt),xe}function rotate(ee,O,Y,te,ne,xe,et){et=et||[];const tt=Math.cos(ne),it=Math.sin(ne),st=xe[0],ot=xe[1];let rt=0;for(let nt=O;nt<Y;nt+=te){const at=ee[nt]-st,ct=ee[nt+1]-ot;et[rt++]=st+at*tt-ct*it,et[rt++]=ot+at*it+ct*tt;for(let ut=nt+2;ut<nt+te;++ut)et[rt++]=ee[ut]}return et&&et.length!=rt&&(et.length=rt),et}function scale$2(ee,O,Y,te,ne,xe,et,tt){tt=tt||[];const it=et[0],st=et[1];let ot=0;for(let rt=O;rt<Y;rt+=te){const nt=ee[rt]-it,at=ee[rt+1]-st;tt[ot++]=it+ne*nt,tt[ot++]=st+xe*at;for(let ct=rt+2;ct<rt+te;++ct)tt[ot++]=ee[ct]}return tt&&tt.length!=ot&&(tt.length=ot),tt}function translate$1(ee,O,Y,te,ne,xe,et){et=et||[];let tt=0;for(let it=O;it<Y;it+=te){et[tt++]=ee[it]+ne,et[tt++]=ee[it+1]+xe;for(let st=it+2;st<it+te;++st)et[tt++]=ee[st]}return et&&et.length!=tt&&(et.length=tt),et}const tmpTransform$1=create$2(),tmpPoint=[NaN,NaN];class Geometry extends BaseObject{constructor(){super(),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=memoizeOne((O,Y,te)=>{if(!te)return this.getSimplifiedGeometry(Y);const ne=this.clone();return ne.applyTransform(te),ne.getSimplifiedGeometry(Y)})}simplifyTransformed(O,Y){return this.simplifyTransformedInternal(this.getRevision(),O,Y)}clone(){return abstract()}closestPointXY(O,Y,te,ne){return abstract()}containsXY(O,Y){return this.closestPointXY(O,Y,tmpPoint,Number.MIN_VALUE)===0}getClosestPoint(O,Y){return Y=Y||[NaN,NaN],this.closestPointXY(O[0],O[1],Y,1/0),Y}intersectsCoordinate(O){return this.containsXY(O[0],O[1])}computeExtent(O){return abstract()}getExtent(O){if(this.extentRevision_!=this.getRevision()){const Y=this.computeExtent(this.extent_);(isNaN(Y[0])||isNaN(Y[1]))&&createOrUpdateEmpty(Y),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,O)}rotate(O,Y){abstract()}scale(O,Y,te){abstract()}simplify(O){return this.getSimplifiedGeometry(O*O)}getSimplifiedGeometry(O){return abstract()}getType(){return abstract()}applyTransform(O){abstract()}intersectsExtent(O){return abstract()}translate(O,Y){abstract()}transform(O,Y){const te=get$2(O),ne=te.getUnits()=="tile-pixels"?function(xe,et,tt){const it=te.getExtent(),st=te.getWorldExtent(),ot=getHeight(st)/getHeight(it);compose(tmpTransform$1,st[0],st[3],ot,-ot,0,0,0);const rt=transform2D(xe,0,xe.length,tt,tmpTransform$1,et),nt=getTransform(te,Y);return nt?nt(rt,rt,tt):rt}:getTransform(te,Y);return this.applyTransform(ne),this}}class SimpleGeometry extends Geometry{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(O){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O)}getCoordinates(){return abstract()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(O){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),O<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&O<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const Y=this.getSimplifiedGeometryInternal(O);return Y.getFlatCoordinates().length<this.flatCoordinates.length?Y:(this.simplifiedGeometryMaxMinSquaredTolerance=O,this)}getSimplifiedGeometryInternal(O){return this}getStride(){return this.stride}setFlatCoordinates(O,Y){this.stride=getStrideForLayout(O),this.layout=O,this.flatCoordinates=Y}setCoordinates(O,Y){abstract()}setLayout(O,Y,te){let ne;if(O)ne=getStrideForLayout(O);else{for(let xe=0;xe<te;++xe){if(Y.length===0){this.layout="XY",this.stride=2;return}Y=Y[0]}ne=Y.length,O=getLayoutForStride(ne)}this.layout=O,this.stride=ne}applyTransform(O){this.flatCoordinates&&(O(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(O,Y){const te=this.getFlatCoordinates();if(te){const ne=this.getStride();rotate(te,0,te.length,ne,O,Y,te),this.changed()}}scale(O,Y,te){Y===void 0&&(Y=O),te||(te=getCenter(this.getExtent()));const ne=this.getFlatCoordinates();if(ne){const xe=this.getStride();scale$2(ne,0,ne.length,xe,O,Y,te,ne),this.changed()}}translate(O,Y){const te=this.getFlatCoordinates();if(te){const ne=this.getStride();translate$1(te,0,te.length,ne,O,Y,te),this.changed()}}}function getLayoutForStride(ee){let O;return ee==2?O="XY":ee==3?O="XYZ":ee==4&&(O="XYZM"),O}function getStrideForLayout(ee){let O;return ee=="XY"?O=2:ee=="XYZ"||ee=="XYM"?O=3:ee=="XYZM"&&(O=4),O}function transformGeom2D(ee,O,Y){const te=ee.getFlatCoordinates();if(!te)return null;const ne=ee.getStride();return transform2D(te,0,te.length,ne,O,Y)}function linearRing(ee,O,Y,te){let ne=0;const xe=ee[Y-te],et=ee[Y-te+1];let tt=0,it=0;for(;O<Y;O+=te){const st=ee[O]-xe,ot=ee[O+1]-et;ne+=it*st-tt*ot,tt=st,it=ot}return ne/2}function linearRings(ee,O,Y,te){let ne=0;for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe];ne+=linearRing(ee,O,tt,te),O=tt}return ne}function linearRingss$1(ee,O,Y,te){let ne=0;for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe];ne+=linearRings(ee,O,tt,te),O=tt[tt.length-1]}return ne}function assignClosest(ee,O,Y,te,ne,xe,et){const tt=ee[O],it=ee[O+1],st=ee[Y]-tt,ot=ee[Y+1]-it;let rt;if(st===0&&ot===0)rt=O;else{const nt=((ne-tt)*st+(xe-it)*ot)/(st*st+ot*ot);if(nt>1)rt=Y;else if(nt>0){for(let at=0;at<te;++at)et[at]=lerp$1(ee[O+at],ee[Y+at],nt);et.length=te;return}else rt=O}for(let nt=0;nt<te;++nt)et[nt]=ee[rt+nt];et.length=te}function maxSquaredDelta(ee,O,Y,te,ne){let xe=ee[O],et=ee[O+1];for(O+=te;O<Y;O+=te){const tt=ee[O],it=ee[O+1],st=squaredDistance$1(xe,et,tt,it);st>ne&&(ne=st),xe=tt,et=it}return ne}function arrayMaxSquaredDelta(ee,O,Y,te,ne){for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe];ne=maxSquaredDelta(ee,O,tt,te,ne),O=tt}return ne}function multiArrayMaxSquaredDelta(ee,O,Y,te,ne){for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe];ne=arrayMaxSquaredDelta(ee,O,tt,te,ne),O=tt[tt.length-1]}return ne}function assignClosestPoint(ee,O,Y,te,ne,xe,et,tt,it,st,ot){if(O==Y)return st;let rt,nt;if(ne===0){if(nt=squaredDistance$1(et,tt,ee[O],ee[O+1]),nt<st){for(rt=0;rt<te;++rt)it[rt]=ee[O+rt];return it.length=te,nt}return st}ot=ot||[NaN,NaN];let at=O+te;for(;at<Y;)if(assignClosest(ee,at-te,at,te,et,tt,ot),nt=squaredDistance$1(et,tt,ot[0],ot[1]),nt<st){for(st=nt,rt=0;rt<te;++rt)it[rt]=ot[rt];it.length=te,at+=te}else at+=te*Math.max((Math.sqrt(nt)-Math.sqrt(st))/ne|0,1);if(xe&&(assignClosest(ee,Y-te,O,te,et,tt,ot),nt=squaredDistance$1(et,tt,ot[0],ot[1]),nt<st)){for(st=nt,rt=0;rt<te;++rt)it[rt]=ot[rt];it.length=te}return st}function assignClosestArrayPoint(ee,O,Y,te,ne,xe,et,tt,it,st,ot){ot=ot||[NaN,NaN];for(let rt=0,nt=Y.length;rt<nt;++rt){const at=Y[rt];st=assignClosestPoint(ee,O,at,te,ne,xe,et,tt,it,st,ot),O=at}return st}function assignClosestMultiArrayPoint(ee,O,Y,te,ne,xe,et,tt,it,st,ot){ot=ot||[NaN,NaN];for(let rt=0,nt=Y.length;rt<nt;++rt){const at=Y[rt];st=assignClosestArrayPoint(ee,O,at,te,ne,xe,et,tt,it,st,ot),O=at[at.length-1]}return st}function deflateCoordinate(ee,O,Y,te){for(let ne=0,xe=Y.length;ne<xe;++ne)ee[O++]=Y[ne];return O}function deflateCoordinates(ee,O,Y,te){for(let ne=0,xe=Y.length;ne<xe;++ne){const et=Y[ne];for(let tt=0;tt<te;++tt)ee[O++]=et[tt]}return O}function deflateCoordinatesArray(ee,O,Y,te,ne){ne=ne||[];let xe=0;for(let et=0,tt=Y.length;et<tt;++et){const it=deflateCoordinates(ee,O,Y[et],te);ne[xe++]=it,O=it}return ne.length=xe,ne}function deflateMultiCoordinatesArray(ee,O,Y,te,ne){ne=ne||[];let xe=0;for(let et=0,tt=Y.length;et<tt;++et){const it=deflateCoordinatesArray(ee,O,Y[et],te,ne[xe]);it.length===0&&(it[0]=O),ne[xe++]=it,O=it[it.length-1]}return ne.length=xe,ne}function inflateCoordinates(ee,O,Y,te,ne){ne=ne!==void 0?ne:[];let xe=0;for(let et=O;et<Y;et+=te)ne[xe++]=ee.slice(et,et+te);return ne.length=xe,ne}function inflateCoordinatesArray(ee,O,Y,te,ne){ne=ne!==void 0?ne:[];let xe=0;for(let et=0,tt=Y.length;et<tt;++et){const it=Y[et];ne[xe++]=inflateCoordinates(ee,O,it,te,ne[xe]),O=it}return ne.length=xe,ne}function inflateMultiCoordinatesArray(ee,O,Y,te,ne){ne=ne!==void 0?ne:[];let xe=0;for(let et=0,tt=Y.length;et<tt;++et){const it=Y[et];ne[xe++]=it.length===1&&it[0]===O?[]:inflateCoordinatesArray(ee,O,it,te,ne[xe]),O=it[it.length-1]}return ne.length=xe,ne}function douglasPeucker(ee,O,Y,te,ne,xe,et){const tt=(Y-O)/te;if(tt<3){for(;O<Y;O+=te)xe[et++]=ee[O],xe[et++]=ee[O+1];return et}const it=new Array(tt);it[0]=1,it[tt-1]=1;const st=[O,Y-te];let ot=0;for(;st.length>0;){const rt=st.pop(),nt=st.pop();let at=0;const ct=ee[nt],ut=ee[nt+1],dt=ee[rt],ht=ee[rt+1];for(let pt=nt+te;pt<rt;pt+=te){const ft=ee[pt],mt=ee[pt+1],yt=squaredSegmentDistance(ft,mt,ct,ut,dt,ht);yt>at&&(ot=pt,at=yt)}at>ne&&(it[(ot-O)/te]=1,nt+te<ot&&st.push(nt,ot),ot+te<rt&&st.push(ot,rt))}for(let rt=0;rt<tt;++rt)it[rt]&&(xe[et++]=ee[O+rt*te],xe[et++]=ee[O+rt*te+1]);return et}function douglasPeuckerArray(ee,O,Y,te,ne,xe,et,tt){for(let it=0,st=Y.length;it<st;++it){const ot=Y[it];et=douglasPeucker(ee,O,ot,te,ne,xe,et),tt.push(et),O=ot}return et}function snap(ee,O){return O*Math.round(ee/O)}function quantize(ee,O,Y,te,ne,xe,et){if(O==Y)return et;let tt=snap(ee[O],ne),it=snap(ee[O+1],ne);O+=te,xe[et++]=tt,xe[et++]=it;let st,ot;do if(st=snap(ee[O],ne),ot=snap(ee[O+1],ne),O+=te,O==Y)return xe[et++]=st,xe[et++]=ot,et;while(st==tt&&ot==it);for(;O<Y;){const rt=snap(ee[O],ne),nt=snap(ee[O+1],ne);if(O+=te,rt==st&&nt==ot)continue;const at=st-tt,ct=ot-it,ut=rt-tt,dt=nt-it;if(at*dt==ct*ut&&(at<0&&ut<at||at==ut||at>0&&ut>at)&&(ct<0&&dt<ct||ct==dt||ct>0&&dt>ct)){st=rt,ot=nt;continue}xe[et++]=st,xe[et++]=ot,tt=st,it=ot,st=rt,ot=nt}return xe[et++]=st,xe[et++]=ot,et}function quantizeArray(ee,O,Y,te,ne,xe,et,tt){for(let it=0,st=Y.length;it<st;++it){const ot=Y[it];et=quantize(ee,O,ot,te,ne,xe,et),tt.push(et),O=ot}return et}function quantizeMultiArray(ee,O,Y,te,ne,xe,et,tt){for(let it=0,st=Y.length;it<st;++it){const ot=Y[it],rt=[];et=quantizeArray(ee,O,ot,te,ne,xe,et,rt),tt.push(rt),O=ot[ot.length-1]}return et}class LinearRing extends SimpleGeometry{constructor(O,Y){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,Y!==void 0&&!Array.isArray(O[0])?this.setFlatCoordinates(Y,O):this.setCoordinates(O,Y)}clone(){return new LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(O,Y,te,ne){return ne<closestSquaredDistanceXY(this.getExtent(),O,Y)?ne:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,O,Y,te,ne))}getArea(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(O){const Y=[];return Y.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O,Y,0),new LinearRing(Y,"XY")}getType(){return"LinearRing"}intersectsExtent(O){return!1}setCoordinates(O,Y){this.setLayout(Y,O,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,O,this.stride),this.changed()}}class Point extends SimpleGeometry{constructor(O,Y){super(),this.setCoordinates(O,Y)}clone(){const O=new Point(this.flatCoordinates.slice(),this.layout);return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){const xe=this.flatCoordinates,et=squaredDistance$1(O,Y,xe[0],xe[1]);if(et<ne){const tt=this.stride;for(let it=0;it<tt;++it)te[it]=xe[it];return te.length=tt,et}return ne}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(O){return createOrUpdateFromCoordinate(this.flatCoordinates,O)}getType(){return"Point"}intersectsExtent(O){return containsXY(O,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(O,Y){this.setLayout(Y,O,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,O,this.stride),this.changed()}}function linearRingContainsExtent(ee,O,Y,te,ne){return!forEachCorner(ne,function(et){return!linearRingContainsXY(ee,O,Y,te,et[0],et[1])})}function linearRingContainsXY(ee,O,Y,te,ne,xe){let et=0,tt=ee[Y-te],it=ee[Y-te+1];for(;O<Y;O+=te){const st=ee[O],ot=ee[O+1];it<=xe?ot>xe&&(st-tt)*(xe-it)-(ne-tt)*(ot-it)>0&&et++:ot<=xe&&(st-tt)*(xe-it)-(ne-tt)*(ot-it)<0&&et--,tt=st,it=ot}return et!==0}function linearRingsContainsXY(ee,O,Y,te,ne,xe){if(Y.length===0||!linearRingContainsXY(ee,O,Y[0],te,ne,xe))return!1;for(let et=1,tt=Y.length;et<tt;++et)if(linearRingContainsXY(ee,Y[et-1],Y[et],te,ne,xe))return!1;return!0}function linearRingssContainsXY(ee,O,Y,te,ne,xe){if(Y.length===0)return!1;for(let et=0,tt=Y.length;et<tt;++et){const it=Y[et];if(linearRingsContainsXY(ee,O,it,te,ne,xe))return!0;O=it[it.length-1]}return!1}function getInteriorPointOfArray(ee,O,Y,te,ne,xe,et){let tt,it,st,ot,rt,nt,at;const ct=ne[xe+1],ut=[];for(let pt=0,ft=Y.length;pt<ft;++pt){const mt=Y[pt];for(ot=ee[mt-te],nt=ee[mt-te+1],tt=O;tt<mt;tt+=te)rt=ee[tt],at=ee[tt+1],(ct<=nt&&at<=ct||nt<=ct&&ct<=at)&&(st=(ct-nt)/(at-nt)*(rt-ot)+ot,ut.push(st)),ot=rt,nt=at}let dt=NaN,ht=-1/0;for(ut.sort(ascending),ot=ut[0],tt=1,it=ut.length;tt<it;++tt){rt=ut[tt];const pt=Math.abs(rt-ot);pt>ht&&(st=(ot+rt)/2,linearRingsContainsXY(ee,O,Y,te,st,ct)&&(dt=st,ht=pt)),ot=rt}return isNaN(dt)&&(dt=ne[xe]),et?(et.push(dt,ct,ht),et):[dt,ct,ht]}function getInteriorPointsOfMultiArray(ee,O,Y,te,ne){let xe=[];for(let et=0,tt=Y.length;et<tt;++et){const it=Y[et];xe=getInteriorPointOfArray(ee,O,it,te,ne,2*et,xe),O=it[it.length-1]}return xe}function forEach(ee,O,Y,te,ne){let xe;for(O+=te;O<Y;O+=te)if(xe=ne(ee.slice(O-te,O),ee.slice(O,O+te)),xe)return xe;return!1}function getIntersectionPoint(ee,O){const[Y,te]=ee,[ne,xe]=O,et=((Y[0]-ne[0])*(ne[1]-xe[1])-(Y[1]-ne[1])*(ne[0]-xe[0]))/((Y[0]-te[0])*(ne[1]-xe[1])-(Y[1]-te[1])*(ne[0]-xe[0])),tt=((Y[0]-ne[0])*(Y[1]-te[1])-(Y[1]-ne[1])*(Y[0]-te[0]))/((Y[0]-te[0])*(ne[1]-xe[1])-(Y[1]-te[1])*(ne[0]-xe[0]));if(0<=et&&et<=1&&0<=tt&&tt<=1)return[Y[0]+et*(te[0]-Y[0]),Y[1]+et*(te[1]-Y[1])]}function intersectsLineString(ee,O,Y,te,ne,xe){return xe=xe??extendFlatCoordinates(createEmpty(),ee,O,Y,te),intersects$1(ne,xe)?xe[0]>=ne[0]&&xe[2]<=ne[2]||xe[1]>=ne[1]&&xe[3]<=ne[3]?!0:forEach(ee,O,Y,te,function(et,tt){return intersectsSegment(ne,et,tt)}):!1}function intersectsLineStringArray(ee,O,Y,te,ne){for(let xe=0,et=Y.length;xe<et;++xe){if(intersectsLineString(ee,O,Y[xe],te,ne))return!0;O=Y[xe]}return!1}function intersectsLinearRing(ee,O,Y,te,ne){return!!(intersectsLineString(ee,O,Y,te,ne)||linearRingContainsXY(ee,O,Y,te,ne[0],ne[1])||linearRingContainsXY(ee,O,Y,te,ne[0],ne[3])||linearRingContainsXY(ee,O,Y,te,ne[2],ne[1])||linearRingContainsXY(ee,O,Y,te,ne[2],ne[3]))}function intersectsLinearRingArray(ee,O,Y,te,ne){if(!intersectsLinearRing(ee,O,Y[0],te,ne))return!1;if(Y.length===1)return!0;for(let xe=1,et=Y.length;xe<et;++xe)if(linearRingContainsExtent(ee,Y[xe-1],Y[xe],te,ne)&&!intersectsLineString(ee,Y[xe-1],Y[xe],te,ne))return!1;return!0}function intersectsLinearRingMultiArray(ee,O,Y,te,ne){for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe];if(intersectsLinearRingArray(ee,O,tt,te,ne))return!0;O=tt[tt.length-1]}return!1}function coordinates(ee,O,Y,te){for(;O<Y-te;){for(let ne=0;ne<te;++ne){const xe=ee[O+ne];ee[O+ne]=ee[Y-te+ne],ee[Y-te+ne]=xe}O+=te,Y-=te}}function linearRingIsClockwise(ee,O,Y,te){let ne=0,xe=ee[Y-te],et=ee[Y-te+1];for(;O<Y;O+=te){const tt=ee[O],it=ee[O+1];ne+=(tt-xe)*(it+et),xe=tt,et=it}return ne===0?void 0:ne>0}function linearRingsAreOriented(ee,O,Y,te,ne){ne=ne!==void 0?ne:!1;for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe],it=linearRingIsClockwise(ee,O,tt,te);if(xe===0){if(ne&&it||!ne&&!it)return!1}else if(ne&&!it||!ne&&it)return!1;O=tt}return!0}function linearRingssAreOriented(ee,O,Y,te,ne){for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe];if(!linearRingsAreOriented(ee,O,tt,te,ne))return!1;tt.length&&(O=tt[tt.length-1])}return!0}function orientLinearRings(ee,O,Y,te,ne){ne=ne!==void 0?ne:!1;for(let xe=0,et=Y.length;xe<et;++xe){const tt=Y[xe],it=linearRingIsClockwise(ee,O,tt,te);(xe===0?ne&&it||!ne&&!it:ne&&!it||!ne&&it)&&coordinates(ee,O,tt,te),O=tt}return O}function orientLinearRingsArray(ee,O,Y,te,ne){for(let xe=0,et=Y.length;xe<et;++xe)O=orientLinearRings(ee,O,Y[xe],te,ne);return O}function inflateEnds(ee,O){const Y=[];let te=0,ne=0,xe;for(let et=0,tt=O.length;et<tt;++et){const it=O[et],st=linearRingIsClockwise(ee,te,it,2);if(xe===void 0&&(xe=st),st===xe)Y.push(O.slice(ne,et+1));else{if(Y.length===0)continue;Y[Y.length-1].push(O[ne])}ne=et+1,te=it}return Y}class Polygon extends SimpleGeometry{constructor(O,Y,te){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,Y!==void 0&&te?(this.setFlatCoordinates(Y,O),this.ends_=te):this.setCoordinates(O,Y)}appendLinearRing(O){this.flatCoordinates?extend$2(this.flatCoordinates,O.getFlatCoordinates()):this.flatCoordinates=O.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const O=new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){return ne<closestSquaredDistanceXY(this.getExtent(),O,Y)?ne:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,O,Y,te,ne))}containsXY(O,Y){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,O,Y)}getArea(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(O){let Y;return O!==void 0?(Y=this.getOrientedFlatCoordinates().slice(),orientLinearRings(Y,0,this.ends_,this.stride,O)):Y=this.flatCoordinates,inflateCoordinatesArray(Y,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const O=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,O,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Point(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(O){return O<0||this.ends_.length<=O?null:new LinearRing(this.flatCoordinates.slice(O===0?0:this.ends_[O-1],this.ends_[O]),this.layout)}getLinearRings(){const O=this.layout,Y=this.flatCoordinates,te=this.ends_,ne=[];let xe=0;for(let et=0,tt=te.length;et<tt;++et){const it=te[et],st=new LinearRing(Y.slice(xe,it),O);ne.push(st),xe=it}return ne}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const O=this.flatCoordinates;linearRingsAreOriented(O,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=O:(this.orientedFlatCoordinates_=O.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(O){const Y=[],te=[];return Y.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(O),Y,0,te),new Polygon(Y,"XY",te)}getType(){return"Polygon"}intersectsExtent(O){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,O)}setCoordinates(O,Y){this.setLayout(Y,O,2),this.flatCoordinates||(this.flatCoordinates=[]);const te=deflateCoordinatesArray(this.flatCoordinates,0,O,this.stride,this.ends_);this.flatCoordinates.length=te.length===0?0:te[te.length-1],this.changed()}}function circular(ee,O,Y,te){Y=Y||32;const ne=[];for(let xe=0;xe<Y;++xe)extend$2(ne,offset(ee,O,2*Math.PI*xe/Y,te));return ne.push(ne[0],ne[1]),new Polygon(ne,"XY",[ne.length])}function fromExtent(ee){if(isEmpty(ee))throw new Error("Cannot create polygon from empty extent");const O=ee[0],Y=ee[1],te=ee[2],ne=ee[3],xe=[O,Y,O,ne,te,ne,te,Y,O,Y];return new Polygon(xe,"XY",[xe.length])}function fromCircle(ee,O,Y){O=O||32;const te=ee.getStride(),ne=ee.getLayout(),xe=ee.getCenter(),et=te*(O+1),tt=new Array(et);for(let ot=0;ot<et;ot+=te){tt[ot]=0,tt[ot+1]=0;for(let rt=2;rt<te;rt++)tt[ot+rt]=xe[rt]}const it=[tt.length],st=new Polygon(tt,ne,it);return makeRegular(st,xe,ee.getRadius()),st}function makeRegular(ee,O,Y,te){const ne=ee.getFlatCoordinates(),xe=ee.getStride(),et=ne.length/xe-1,tt=0;for(let it=0;it<=et;++it){const st=it*xe,ot=tt+modulo(it,et)*2*Math.PI/et;ne[st]=O[0]+Y*Math.cos(ot),ne[st+1]=O[1]+Y*Math.sin(ot)}ee.changed()}const Property$4={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},GeolocationErrorType={ERROR:"error"};class GeolocationError extends BaseEvent{constructor(O){super(GeolocationErrorType.ERROR),this.code=O.code,this.message=O.message}}class Geolocation extends BaseObject{constructor(O){super(),this.on,this.once,this.un,O=O||{},this.position_=null,this.transform_=identityTransform,this.watchId_=void 0,this.addChangeListener(Property$4.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(Property$4.TRACKING,this.handleTrackingChanged_),O.projection!==void 0&&this.setProjection(O.projection),O.trackingOptions!==void 0&&this.setTrackingOptions(O.trackingOptions),this.setTracking(O.tracking!==void 0?O.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const O=this.getProjection();O&&(this.transform_=getTransformFromProjections(get$2("EPSG:4326"),O),this.position_&&this.set(Property$4.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const O=this.getTracking();O&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!O&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(O){const Y=O.coords;this.set(Property$4.ACCURACY,Y.accuracy),this.set(Property$4.ALTITUDE,Y.altitude===null?void 0:Y.altitude),this.set(Property$4.ALTITUDE_ACCURACY,Y.altitudeAccuracy===null?void 0:Y.altitudeAccuracy),this.set(Property$4.HEADING,Y.heading===null?void 0:toRadians(Y.heading)),this.position_?(this.position_[0]=Y.longitude,this.position_[1]=Y.latitude):this.position_=[Y.longitude,Y.latitude];const te=this.transform_(this.position_);this.set(Property$4.POSITION,te.slice()),this.set(Property$4.SPEED,Y.speed===null?void 0:Y.speed);const ne=circular(this.position_,Y.accuracy);ne.applyTransform(this.transform_),this.set(Property$4.ACCURACY_GEOMETRY,ne),this.changed()}positionError_(O){this.dispatchEvent(new GeolocationError(O))}getAccuracy(){return this.get(Property$4.ACCURACY)}getAccuracyGeometry(){return this.get(Property$4.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(Property$4.ALTITUDE)}getAltitudeAccuracy(){return this.get(Property$4.ALTITUDE_ACCURACY)}getHeading(){return this.get(Property$4.HEADING)}getPosition(){return this.get(Property$4.POSITION)}getProjection(){return this.get(Property$4.PROJECTION)}getSpeed(){return this.get(Property$4.SPEED)}getTracking(){return this.get(Property$4.TRACKING)}getTrackingOptions(){return this.get(Property$4.TRACKING_OPTIONS)}setProjection(O){this.set(Property$4.PROJECTION,get$2(O))}setTracking(O){this.set(Property$4.TRACKING,O)}setTrackingOptions(O){this.set(Property$4.TRACKING_OPTIONS,O)}}function interpolatePoint(ee,O,Y,te,ne,xe,et){let tt,it;const st=(Y-O)/te;if(st===1)tt=O;else if(st===2)tt=O,it=ne;else if(st!==0){let ot=ee[O],rt=ee[O+1],nt=0;const at=[0];for(let dt=O+te;dt<Y;dt+=te){const ht=ee[dt],pt=ee[dt+1];nt+=Math.sqrt((ht-ot)*(ht-ot)+(pt-rt)*(pt-rt)),at.push(nt),ot=ht,rt=pt}const ct=ne*nt,ut=binarySearch$1(at,ct);ut<0?(it=(ct-at[-ut-2])/(at[-ut-1]-at[-ut-2]),tt=O+(-ut-2)*te):tt=O+ut*te}et=et>1?et:2,xe=xe||new Array(et);for(let ot=0;ot<et;++ot)xe[ot]=tt===void 0?NaN:it===void 0?ee[tt+ot]:lerp$1(ee[tt+ot],ee[tt+te+ot],it);return xe}function lineStringCoordinateAtM(ee,O,Y,te,ne,xe){if(Y==O)return null;let et;if(ne<ee[O+te-1])return xe?(et=ee.slice(O,O+te),et[te-1]=ne,et):null;if(ee[Y-1]<ne)return xe?(et=ee.slice(Y-te,Y),et[te-1]=ne,et):null;if(ne==ee[O+te-1])return ee.slice(O,O+te);let tt=O/te,it=Y/te;for(;tt<it;){const nt=tt+it>>1;ne<ee[(nt+1)*te-1]?it=nt:tt=nt+1}const st=ee[tt*te-1];if(ne==st)return ee.slice((tt-1)*te,(tt-1)*te+te);const ot=ee[(tt+1)*te-1],rt=(ne-st)/(ot-st);et=[];for(let nt=0;nt<te-1;++nt)et.push(lerp$1(ee[(tt-1)*te+nt],ee[tt*te+nt],rt));return et.push(ne),et}function lineStringsCoordinateAtM(ee,O,Y,te,ne,xe,et){if(et)return lineStringCoordinateAtM(ee,O,Y[Y.length-1],te,ne,xe);let tt;if(ne<ee[te-1])return xe?(tt=ee.slice(0,te),tt[te-1]=ne,tt):null;if(ee[ee.length-1]<ne)return xe?(tt=ee.slice(ee.length-te),tt[te-1]=ne,tt):null;for(let it=0,st=Y.length;it<st;++it){const ot=Y[it];if(O!=ot){if(ne<ee[O+te-1])return null;if(ne<=ee[ot-1])return lineStringCoordinateAtM(ee,O,ot,te,ne,!1);O=ot}}return null}function lineStringLength(ee,O,Y,te){let ne=ee[O],xe=ee[O+1],et=0;for(let tt=O+te;tt<Y;tt+=te){const it=ee[tt],st=ee[tt+1];et+=Math.sqrt((it-ne)*(it-ne)+(st-xe)*(st-xe)),ne=it,xe=st}return et}class LineString extends SimpleGeometry{constructor(O,Y){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,Y!==void 0&&!Array.isArray(O[0])?this.setFlatCoordinates(Y,O):this.setCoordinates(O,Y)}appendCoordinate(O){extend$2(this.flatCoordinates,O),this.changed()}clone(){const O=new LineString(this.flatCoordinates.slice(),this.layout);return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){return ne<closestSquaredDistanceXY(this.getExtent(),O,Y)?ne:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,O,Y,te,ne))}forEachSegment(O){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O)}getCoordinateAtM(O,Y){return this.layout!="XYM"&&this.layout!="XYZM"?null:(Y=Y!==void 0?Y:!1,lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O,Y))}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(O,Y){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O,Y,this.stride)}getLength(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(O){const Y=[];return Y.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O,Y,0),new LineString(Y,"XY")}getType(){return"LineString"}intersectsExtent(O){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,O,this.getExtent())}setCoordinates(O,Y){this.setLayout(Y,O,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,O,this.stride),this.changed()}}function line(ee,O,Y){const te=[];let ne=ee(0),xe=ee(1),et=O(ne),tt=O(xe);const it=[xe,ne],st=[tt,et],ot=[1,0],rt={};let nt=1e5,at,ct,ut,dt,ht,pt;for(;--nt>0&&ot.length>0;)ut=ot.pop(),ne=it.pop(),et=st.pop(),pt=ut.toString(),pt in rt||(te.push(et[0],et[1]),rt[pt]=!0),dt=ot.pop(),xe=it.pop(),tt=st.pop(),ht=(ut+dt)/2,at=ee(ht),ct=O(at),squaredSegmentDistance(ct[0],ct[1],et[0],et[1],tt[0],tt[1])<Y?(te.push(tt[0],tt[1]),pt=dt.toString(),rt[pt]=!0):(ot.push(dt,ht,ht,ut),st.push(tt,ct,ct,et),it.push(xe,at,at,ne));return te}function meridian(ee,O,Y,te,ne){const xe=get$2("EPSG:4326");return line(function(et){return[ee,O+(Y-O)*et]},getTransform(xe,te),ne)}function parallel(ee,O,Y,te,ne){const xe=get$2("EPSG:4326");return line(function(et){return[O+(Y-O)*et,ee]},getTransform(xe,te),ne)}const RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},ua=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",SAFARI=ua.includes("safari")&&!ua.includes("chrom"),SAFARI_BUG_237906=SAFARI&&(ua.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ua)),WEBKIT=ua.includes("webkit")&&!ua.includes("edge"),MAC=ua.includes("macintosh"),DEVICE_PIXEL_RATIO=typeof devicePixelRatio<"u"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image<"u"&&Image.prototype.decode,CREATE_IMAGE_BITMAP=typeof createImageBitmap=="function",PASSIVE_EVENT_LISTENERS=(function(){let ee=!1;try{const O=Object.defineProperty({},"passive",{get:function(){ee=!0}});window.addEventListener("_",null,O),window.removeEventListener("_",null,O)}catch{}return ee})(),ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function createCanvasContext2D(ee,O,Y,te){let ne;return Y&&Y.length?ne=Y.shift():WORKER_OFFSCREEN_CANVAS?ne=new class extends OffscreenCanvas{style={}}(ee??300,O??150):ne=document.createElement("canvas"),ee&&(ne.width=ee),O&&(ne.height=O),ne.getContext("2d",te)}let sharedCanvasContext;function getSharedCanvasContext2D(){return sharedCanvasContext||(sharedCanvasContext=createCanvasContext2D(1,1)),sharedCanvasContext}function releaseCanvas$1(ee){const O=ee.canvas;O.width=1,O.height=1,ee.clearRect(0,0,1,1)}function outerWidth(ee){let O=ee.offsetWidth;const Y=getComputedStyle(ee);return O+=parseInt(Y.marginLeft,10)+parseInt(Y.marginRight,10),O}function outerHeight(ee){let O=ee.offsetHeight;const Y=getComputedStyle(ee);return O+=parseInt(Y.marginTop,10)+parseInt(Y.marginBottom,10),O}function replaceNode(ee,O){const Y=O.parentNode;Y&&Y.replaceChild(ee,O)}function removeChildren(ee){for(;ee.lastChild;)ee.lastChild.remove()}function replaceChildren(ee,O){const Y=ee.childNodes;for(let te=0;;++te){const ne=Y[te],xe=O[te];if(!ne&&!xe)break;if(ne!==xe){if(!ne){ee.appendChild(xe);continue}if(!xe){ee.removeChild(ne),--te;continue}ee.insertBefore(xe,ne)}}}function createMockDiv(){return new Proxy({childNodes:[],appendChild:function(O){return this.childNodes.push(O),O},remove:function(){},removeChild:function(O){const Y=this.childNodes.indexOf(O);if(Y===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(Y,1),O},insertBefore:function(O,Y){const te=this.childNodes.indexOf(Y);if(te===-1)throw new Error("Reference node not found");return this.childNodes.splice(te,0,O),O},style:{}},{get(O,Y,te){return Y==="firstElementChild"?O.childNodes.length>0?O.childNodes[0]:null:Reflect.get(O,Y,te)}})}function isCanvas(ee){return typeof HTMLCanvasElement<"u"&&ee instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&ee instanceof OffscreenCanvas}const NO_COLOR=[NaN,NaN,NaN,0];let colorParseContext;function getColorParseContext(){return colorParseContext||(colorParseContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),colorParseContext}const rgbModernRegEx=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyAbsoluteRegEx=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyPercentageRegEx=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,hexRegEx=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function toColorComponent(ee,O){return ee.endsWith("%")?Number(ee.substring(0,ee.length-1))/O:Number(ee)}function throwInvalidColor(ee){throw new Error('failed to parse "'+ee+'" as color')}function parseRgba(ee){if(ee.toLowerCase().startsWith("rgb")){const xe=ee.match(rgbLegacyAbsoluteRegEx)||ee.match(rgbModernRegEx)||ee.match(rgbLegacyPercentageRegEx);if(xe){const et=xe[4],tt=100/255;return[clamp$1(toColorComponent(xe[1],tt)+.5|0,0,255),clamp$1(toColorComponent(xe[2],tt)+.5|0,0,255),clamp$1(toColorComponent(xe[3],tt)+.5|0,0,255),et!==void 0?clamp$1(toColorComponent(et,100),0,1):1]}throwInvalidColor(ee)}if(ee.startsWith("#")){if(hexRegEx.test(ee)){const xe=ee.substring(1),et=xe.length<=4?1:2,tt=[0,0,0,255];for(let it=0,st=xe.length;it<st;it+=et){let ot=parseInt(xe.substring(it,it+et),16);et===1&&(ot+=ot<<4),tt[it/et]=ot}return tt[3]=tt[3]/255,tt}throwInvalidColor(ee)}const O=getColorParseContext();O.fillStyle="#abcdef";let Y=O.fillStyle;O.fillStyle=ee,O.fillStyle===Y&&(O.fillStyle="#fedcba",Y=O.fillStyle,O.fillStyle=ee,O.fillStyle===Y&&throwInvalidColor(ee));const te=O.fillStyle;if(te.startsWith("#")||te.startsWith("rgba"))return parseRgba(te);O.clearRect(0,0,1,1),O.fillRect(0,0,1,1);const ne=Array.from(O.getImageData(0,0,1,1).data);return ne[3]=toFixed(ne[3]/255,3),ne}function asString(ee){return typeof ee=="string"?ee:toString(ee)}const MAX_CACHE_SIZE=1024,cache={};let cacheSize=0;function withAlpha(ee){if(ee.length===4)return ee;const O=ee.slice();return O[3]=1,O}function b1(ee){return ee>.0031308?Math.pow(ee,1/2.4)*269.025-14.025:ee*3294.6}function b2(ee){return ee>.2068965?Math.pow(ee,3):(ee-4/29)*(108/841)}function a1(ee){return ee>10.314724?Math.pow((ee+14.025)/269.025,2.4):ee/3294.6}function a2(ee){return ee>.0088564?Math.pow(ee,1/3):ee/(108/841)+4/29}function rgbaToLcha(ee){const O=a1(ee[0]),Y=a1(ee[1]),te=a1(ee[2]),ne=a2(O*.222488403+Y*.716873169+te*.06060791),xe=500*(a2(O*.452247074+Y*.399439023+te*.148375274)-ne),et=200*(ne-a2(O*.016863605+Y*.117638439+te*.865350722)),tt=Math.atan2(et,xe)*(180/Math.PI);return[116*ne-16,Math.sqrt(xe*xe+et*et),tt<0?tt+360:tt,ee[3]]}function lchaToRgba(ee){const O=(ee[0]+16)/116,Y=ee[1],te=ee[2]*Math.PI/180,ne=b2(O),xe=b2(O+Y/500*Math.cos(te)),et=b2(O-Y/200*Math.sin(te)),tt=b1(xe*3.021973625-ne*1.617392459-et*.404875592),it=b1(xe*-.943766287+ne*1.916279586+et*.027607165),st=b1(xe*.069407491-ne*.22898585+et*1.159737864);return[clamp$1(tt+.5|0,0,255),clamp$1(it+.5|0,0,255),clamp$1(st+.5|0,0,255),ee[3]]}function fromString(ee){if(ee==="none")return NO_COLOR;if(cache.hasOwnProperty(ee))return cache[ee];if(cacheSize>=MAX_CACHE_SIZE){let Y=0;for(const te in cache)(Y++&3)===0&&(delete cache[te],--cacheSize)}const O=parseRgba(ee);O.length!==4&&throwInvalidColor(ee);for(const Y of O)isNaN(Y)&&throwInvalidColor(ee);return cache[ee]=O,++cacheSize,O}function asArray(ee){return Array.isArray(ee)?ee:fromString(ee)}function toString(ee){let O=ee[0];O!=(O|0)&&(O=O+.5|0);let Y=ee[1];Y!=(Y|0)&&(Y=Y+.5|0);let te=ee[2];te!=(te|0)&&(te=te+.5|0);const ne=ee[3]===void 0?1:Math.round(ee[3]*1e3)/1e3;return"rgba("+O+","+Y+","+te+","+ne+")"}class ImageWrapper extends Target{constructor(O,Y,te,ne){super(),this.extent=O,this.pixelRatio_=te,this.resolution=Y,this.state=typeof ne=="function"?ImageState.IDLE:ne,this.image_=null,this.loader=typeof ne=="function"?ne:null}changed(){this.dispatchEvent(EventType.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ImageState.IDLE&&this.loader){this.state=ImageState.LOADING,this.changed();const O=this.getResolution(),Y=Array.isArray(O)?O[0]:O;toPromise(()=>this.loader(this.getExtent(),Y,this.getPixelRatio())).then(te=>{"image"in te&&(this.image_=te.image),"extent"in te&&(this.extent=te.extent),"resolution"in te&&(this.resolution=te.resolution),"pixelRatio"in te&&(this.pixelRatio_=te.pixelRatio),(te instanceof HTMLImageElement||CREATE_IMAGE_BITMAP&&te instanceof ImageBitmap||te instanceof HTMLCanvasElement||te instanceof HTMLVideoElement)&&(this.image_=te),this.state=ImageState.LOADED}).catch(te=>{this.state=ImageState.ERROR,console.error(te)}).finally(()=>this.changed())}}setImage(O){this.image_=O}setResolution(O){this.resolution=O}}function listenImage(ee,O,Y){const te=ee;let ne=!0,xe=!1,et=!1;const tt=[listenOnce(te,EventType.LOAD,function(){et=!0,xe||O()})];return te.src&&IMAGE_DECODE?(xe=!0,te.decode().then(function(){ne&&O()}).catch(function(it){ne&&(et?O():Y())})):tt.push(listenOnce(te,EventType.ERROR,Y)),function(){ne=!1,tt.forEach(unlistenByKey)}}function load(ee,O){return new Promise((Y,te)=>{function ne(){et(),Y(ee)}function xe(){et(),te(new Error("Image load error"))}function et(){ee.removeEventListener("load",ne),ee.removeEventListener("error",xe)}ee.addEventListener("load",ne),ee.addEventListener("error",xe)})}function decodeFallback(ee,O){return O&&(ee.src=O),ee.src&&IMAGE_DECODE?new Promise((Y,te)=>ee.decode().then(()=>Y(ee)).catch(ne=>ee.complete&&ee.width?Y(ee):te(ne))):load(ee)}function decode(ee,O){return O&&(ee.src=O),ee.src&&IMAGE_DECODE&&CREATE_IMAGE_BITMAP?ee.decode().then(()=>createImageBitmap(ee)).catch(Y=>{if(ee.complete&&ee.width)return ee;throw Y}):decodeFallback(ee)}class IconImageCache{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let O=0;for(const Y in this.cache_){const te=this.cache_[Y];(O++&3)===0&&!te.hasListener()&&(delete this.cache_[Y],delete this.patternCache_[Y],--this.cacheSize_)}}}get(O,Y,te){const ne=getCacheKey$2(O,Y,te);return ne in this.cache_?this.cache_[ne]:null}getPattern(O,Y,te){const ne=getCacheKey$2(O,Y,te);return ne in this.patternCache_?this.patternCache_[ne]:null}set(O,Y,te,ne,xe){const et=getCacheKey$2(O,Y,te),tt=et in this.cache_;this.cache_[et]=ne,xe&&(ne.getImageState()===ImageState.IDLE&&ne.load(),ne.getImageState()===ImageState.LOADING?ne.ready().then(()=>{this.patternCache_[et]=getSharedCanvasContext2D().createPattern(ne.getImage(1),"repeat")}):this.patternCache_[et]=getSharedCanvasContext2D().createPattern(ne.getImage(1),"repeat")),tt||++this.cacheSize_}setSize(O){this.maxCacheSize_=O,this.expire()}}function getCacheKey$2(ee,O,Y){const te=Y?asArray(Y):"null";return O+":"+ee+":"+te}const shared=new IconImageCache;let taintedTestContext=null;class IconImage extends Target{constructor(O,Y,te,ne,xe){super(),this.hitDetectionImage_=null,this.image_=O,this.crossOrigin_=te,this.canvas_={},this.color_=xe,this.imageState_=ne===void 0?ImageState.IDLE:ne,this.size_=O&&O.width&&O.height?[O.width,O.height]:null,this.src_=Y,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(EventType.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(O){return this.image_||this.initializeImage_(),this.replaceColor_(O),this.canvas_[O]?this.canvas_[O]:this.image_}getPixelRatio(O){return this.replaceColor_(O),this.canvas_[O]?O:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const O=this.size_[0],Y=this.size_[1],te=createCanvasContext2D(O,Y);te.fillRect(0,0,O,Y),this.hitDetectionImage_=te.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&decodeFallback(this.image_,this.src_).then(O=>{this.image_=O,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(O){if(!this.color_||this.canvas_[O]||this.imageState_!==ImageState.LOADED)return;const Y=this.image_,te=createCanvasContext2D(Math.ceil(Y.width*O),Math.ceil(Y.height*O)),ne=te.canvas;te.scale(O,O),te.drawImage(Y,0,0),te.globalCompositeOperation="multiply",te.fillStyle=asString(this.color_),te.fillRect(0,0,ne.width/O,ne.height/O),te.globalCompositeOperation="destination-in",te.drawImage(Y,0,0),this.canvas_[O]=ne}ready(){return this.ready_||(this.ready_=new Promise(O=>{if(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)O();else{const Y=()=>{(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)&&(this.removeEventListener(EventType.CHANGE,Y),O())};this.addEventListener(EventType.CHANGE,Y)}})),this.ready_}}function get$1(ee,O,Y,te,ne,xe){let et=O===void 0?void 0:shared.get(O,Y,ne);return et||(et=new IconImage(ee,ee&&"src"in ee?ee.src||void 0:O,Y,te,ne),shared.set(O,Y,ne,et,xe)),xe&&et&&!shared.getPattern(O,Y,ne)&&shared.set(O,Y,ne,et,xe),et}function asColorLike(ee){return ee?Array.isArray(ee)?toString(ee):typeof ee=="object"&&"src"in ee?asCanvasPattern(ee):ee:null}function asCanvasPattern(ee){if(!ee.offset||!ee.size)return shared.getPattern(ee.src,"anonymous",ee.color);const O=ee.src+":"+ee.offset,Y=shared.getPattern(O,void 0,ee.color);if(Y)return Y;const te=shared.get(ee.src,"anonymous",null);if(te.getImageState()!==ImageState.LOADED)return null;const ne=createCanvasContext2D(ee.size[0],ee.size[1]);return ne.drawImage(te.getImage(1),ee.offset[0],ee.offset[1],ee.size[0],ee.size[1],0,0,ee.size[0],ee.size[1]),get$1(ne.canvas,O,void 0,ImageState.LOADED,ee.color,!0),shared.getPattern(O,void 0,ee.color)}class VectorContext{drawCustom(O,Y,te,ne,xe){}drawGeometry(O){}setStyle(O){}drawCircle(O,Y,te){}drawFeature(O,Y,te){}drawGeometryCollection(O,Y,te){}drawLineString(O,Y,te){}drawMultiLineString(O,Y,te){}drawMultiPoint(O,Y,te){}drawMultiPolygon(O,Y,te){}drawPoint(O,Y,te){}drawPolygon(O,Y,te){}drawText(O,Y,te){}setFillStrokeStyle(O,Y){}setImageStyle(O,Y){}setTextStyle(O,Y){}}const CLASS_HIDDEN="ol-hidden",CLASS_SELECTABLE="ol-selectable",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],fontWeights$1={normal:400,bold:700},getFontParameters=function(ee){const O=ee.match(fontRegEx);if(!O)return null;const Y={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let te=0,ne=fontRegExMatchIndex.length;te<ne;++te){const xe=O[te+1];xe!==void 0&&(Y[fontRegExMatchIndex[te]]=typeof xe=="string"?xe.trim():xe)}return isNaN(Number(Y.weight))&&Y.weight in fontWeights$1&&(Y.weight=fontWeights$1[Y.weight]),Y.families=Y.family.split(/,\s?/).map(te=>te.trim().replace(/^['"]|['"]$/g,"")),Y},defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject;let measureContext$1=null,measureFont;const textHeights={},genericFontFamilies=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function getFontKey(ee,O,Y){return`${ee} ${O} 16px "${Y}"`}const registerFont=(function(){let O,Y;async function te(xe){await Y.ready;const et=await Y.load(xe);if(et.length===0)return!1;const tt=getFontParameters(xe),it=tt.families[0].toLowerCase(),st=tt.weight;return et.some(ot=>{const rt=ot.family.replace(/^['"]|['"]$/g,"").toLowerCase(),nt=fontWeights$1[ot.weight]||ot.weight;return rt===it&&ot.style===tt.style&&nt==st})}async function ne(){await Y.ready;let xe=!0;const et=checkedFonts.getProperties(),tt=Object.keys(et).filter(it=>et[it]<100);for(let it=tt.length-1;it>=0;--it){const st=tt[it];let ot=et[st];ot<100&&(await te(st)?(clear$2(textHeights),checkedFonts.set(st,100)):(ot+=10,checkedFonts.set(st,ot,!0),ot<100&&(xe=!1)))}O=void 0,xe||(O=setTimeout(ne,100))}return async function(xe){Y||(Y=WORKER_OFFSCREEN_CANVAS?self.fonts:document.fonts);const et=getFontParameters(xe);if(!et)return;const tt=et.families;let it=!1;for(const st of tt){if(genericFontFamilies.has(st))continue;const ot=getFontKey(et.style,et.weight,st);checkedFonts.get(ot)===void 0&&(checkedFonts.set(ot,0,!0),it=!0)}it&&(clearTimeout(O),O=setTimeout(ne,100))}})(),measureTextHeight=(function(){let ee;return function(O){let Y=textHeights[O];if(Y==null){if(WORKER_OFFSCREEN_CANVAS){const te=getFontParameters(O),ne=measureText$1(O,"g");Y=(isNaN(Number(te.lineHeight))?1.2:Number(te.lineHeight))*(ne.actualBoundingBoxAscent+ne.actualBoundingBoxDescent)}else ee||(ee=document.createElement("div"),ee.innerHTML="M",ee.style.minHeight="0",ee.style.maxHeight="none",ee.style.height="auto",ee.style.padding="0",ee.style.border="none",ee.style.position="absolute",ee.style.display="block",ee.style.left="-99999px"),ee.style.font=O,document.body.appendChild(ee),Y=ee.offsetHeight,document.body.removeChild(ee);textHeights[O]=Y}return Y}})();function measureText$1(ee,O){return measureContext$1||(measureContext$1=createCanvasContext2D(1,1)),ee!=measureFont&&(measureContext$1.font=ee,measureFont=measureContext$1.font),measureContext$1.measureText(O)}function measureTextWidth(ee,O){return measureText$1(ee,O).width}function measureAndCacheTextWidth(ee,O,Y){if(O in Y)return Y[O];const te=O.split(`
`).reduce((ne,xe)=>Math.max(ne,measureTextWidth(ee,xe)),0);return Y[O]=te,te}function getTextDimensions(ee,O){const Y=[],te=[],ne=[];let xe=0,et=0,tt=0,it=0;for(let st=0,ot=O.length;st<=ot;st+=2){const rt=O[st];if(rt===`
`||st===ot){xe=Math.max(xe,et),ne.push(et),et=0,tt+=it,it=0;continue}const nt=O[st+1]||ee.font,at=measureTextWidth(nt,rt);Y.push(at),et+=at;const ct=measureTextHeight(nt);te.push(ct),it=Math.max(it,ct)}return{width:xe,height:tt,widths:Y,heights:te,lineWidths:ne}}function drawImageOrLabel(ee,O,Y,te,ne,xe,et,tt,it,st,ot){ee.save(),Y!==1&&(ee.globalAlpha===void 0?ee.globalAlpha=rt=>rt.globalAlpha*=Y:ee.globalAlpha*=Y),O&&ee.transform.apply(ee,O),te.contextInstructions?(ee.translate(it,st),ee.scale(ot[0],ot[1]),executeLabelInstructions(te,ee)):ot[0]<0||ot[1]<0?(ee.translate(it,st),ee.scale(ot[0],ot[1]),ee.drawImage(te,ne,xe,et,tt,0,0,et,tt)):ee.drawImage(te,ne,xe,et,tt,it,st,et*ot[0],tt*ot[1]),ee.restore()}function executeLabelInstructions(ee,O){const Y=ee.contextInstructions;for(let te=0,ne=Y.length;te<ne;te+=2)Array.isArray(Y[te+1])?O[Y[te]].apply(O,Y[te+1]):O[Y[te]]=Y[te+1]}class CanvasImmediateRenderer extends VectorContext{constructor(O,Y,te,ne,xe,et,tt){super(),this.context_=O,this.pixelRatio_=Y,this.extent_=te,this.transform_=ne,this.transformRotation_=ne?toFixed(Math.atan2(ne[1],ne[0]),10):0,this.viewRotation_=xe,this.squaredTolerance_=et,this.userTransform_=tt,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create$2()}drawImages_(O,Y,te,ne){if(!this.image_)return;const xe=transform2D(O,Y,te,ne,this.transform_,this.pixelCoordinates_),et=this.context_,tt=this.tmpLocalTransform_,it=et.globalAlpha;this.imageOpacity_!=1&&(et.globalAlpha=it*this.imageOpacity_);let st=this.imageRotation_;this.transformRotation_===0&&(st-=this.viewRotation_),this.imageRotateWithView_&&(st+=this.viewRotation_);for(let ot=0,rt=xe.length;ot<rt;ot+=2){const nt=xe[ot]-this.imageAnchorX_,at=xe[ot+1]-this.imageAnchorY_;if(st!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const ct=nt+this.imageAnchorX_,ut=at+this.imageAnchorY_;compose(tt,ct,ut,1,1,st,-ct,-ut),et.save(),et.transform.apply(et,tt),et.translate(ct,ut),et.scale(this.imageScale_[0],this.imageScale_[1]),et.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),et.restore()}else et.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,nt,at,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(et.globalAlpha=it)}drawText_(O,Y,te,ne){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const xe=transform2D(O,Y,te,ne,this.transform_,this.pixelCoordinates_),et=this.context_;let tt=this.textRotation_;for(this.transformRotation_===0&&(tt-=this.viewRotation_),this.textRotateWithView_&&(tt+=this.viewRotation_);Y<te;Y+=ne){const it=xe[Y]+this.textOffsetX_,st=xe[Y+1]+this.textOffsetY_;tt!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(et.save(),et.translate(it-this.textOffsetX_,st-this.textOffsetY_),et.rotate(tt),et.translate(this.textOffsetX_,this.textOffsetY_),et.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&et.strokeText(this.text_,0,0),this.textFillState_&&et.fillText(this.text_,0,0),et.restore()):(this.textStrokeState_&&et.strokeText(this.text_,it,st),this.textFillState_&&et.fillText(this.text_,it,st))}}moveToLineTo_(O,Y,te,ne,xe){const et=this.context_,tt=transform2D(O,Y,te,ne,this.transform_,this.pixelCoordinates_);et.moveTo(tt[0],tt[1]);let it=tt.length;xe&&(it-=2);for(let st=2;st<it;st+=2)et.lineTo(tt[st],tt[st+1]);return xe&&et.closePath(),te}drawRings_(O,Y,te,ne){for(let xe=0,et=te.length;xe<et;++xe)Y=this.moveToLineTo_(O,Y,te[xe],ne,!0);return Y}drawCircle(O){if(this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,O.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const Y=transformGeom2D(O,this.transform_,this.pixelCoordinates_),te=Y[2]-Y[0],ne=Y[3]-Y[1],xe=Math.sqrt(te*te+ne*ne),et=this.context_;et.beginPath(),et.arc(Y[0],Y[1],xe,0,2*Math.PI),this.fillState_&&et.fill(),this.strokeState_&&et.stroke()}this.text_!==""&&this.drawText_(O.getCenter(),0,2,2)}}setStyle(O){this.setFillStrokeStyle(O.getFill(),O.getStroke()),this.setImageStyle(O.getImage()),this.setTextStyle(O.getText())}setTransform(O){this.transform_=O}drawGeometry(O){switch(O.getType()){case"Point":this.drawPoint(O);break;case"LineString":this.drawLineString(O);break;case"Polygon":this.drawPolygon(O);break;case"MultiPoint":this.drawMultiPoint(O);break;case"MultiLineString":this.drawMultiLineString(O);break;case"MultiPolygon":this.drawMultiPolygon(O);break;case"GeometryCollection":this.drawGeometryCollection(O);break;case"Circle":this.drawCircle(O);break}}drawFeature(O,Y){const te=Y.getGeometryFunction()(O);te&&(this.setStyle(Y),this.drawGeometry(te))}drawGeometryCollection(O){const Y=O.getGeometriesArray();for(let te=0,ne=Y.length;te<ne;++te)this.drawGeometry(Y[te])}drawPoint(O){this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const Y=O.getFlatCoordinates(),te=O.getStride();this.image_&&this.drawImages_(Y,0,Y.length,te),this.text_!==""&&this.drawText_(Y,0,Y.length,te)}drawMultiPoint(O){this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const Y=O.getFlatCoordinates(),te=O.getStride();this.image_&&this.drawImages_(Y,0,Y.length,te),this.text_!==""&&this.drawText_(Y,0,Y.length,te)}drawLineString(O){if(this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,O.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const Y=this.context_,te=O.getFlatCoordinates();Y.beginPath(),this.moveToLineTo_(te,0,te.length,O.getStride(),!1),Y.stroke()}if(this.text_!==""){const Y=O.getFlatMidpoint();this.drawText_(Y,0,2,2)}}}drawMultiLineString(O){this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const Y=O.getExtent();if(intersects$1(this.extent_,Y)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const te=this.context_,ne=O.getFlatCoordinates();let xe=0;const et=O.getEnds(),tt=O.getStride();te.beginPath();for(let it=0,st=et.length;it<st;++it)xe=this.moveToLineTo_(ne,xe,et[it],tt,!1);te.stroke()}if(this.text_!==""){const te=O.getFlatMidpoints();this.drawText_(te,0,te.length,2)}}}drawPolygon(O){if(this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,O.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const Y=this.context_;Y.beginPath(),this.drawRings_(O.getOrientedFlatCoordinates(),0,O.getEnds(),O.getStride()),this.fillState_&&Y.fill(),this.strokeState_&&Y.stroke()}if(this.text_!==""){const Y=O.getFlatInteriorPoint();this.drawText_(Y,0,2,2)}}}drawMultiPolygon(O){if(this.squaredTolerance_&&(O=O.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,O.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const Y=this.context_,te=O.getOrientedFlatCoordinates();let ne=0;const xe=O.getEndss(),et=O.getStride();Y.beginPath();for(let tt=0,it=xe.length;tt<it;++tt){const st=xe[tt];ne=this.drawRings_(te,ne,st,et)}this.fillState_&&Y.fill(),this.strokeState_&&Y.stroke()}if(this.text_!==""){const Y=O.getFlatInteriorPoints();this.drawText_(Y,0,Y.length,2)}}}setContextFillState_(O){const Y=this.context_,te=this.contextFillState_;te?te.fillStyle!=O.fillStyle&&(te.fillStyle=O.fillStyle,Y.fillStyle=O.fillStyle):(Y.fillStyle=O.fillStyle,this.contextFillState_={fillStyle:O.fillStyle})}setContextStrokeState_(O){const Y=this.context_,te=this.contextStrokeState_;te?(te.lineCap!=O.lineCap&&(te.lineCap=O.lineCap,Y.lineCap=O.lineCap),equals$2(te.lineDash,O.lineDash)||Y.setLineDash(te.lineDash=O.lineDash),te.lineDashOffset!=O.lineDashOffset&&(te.lineDashOffset=O.lineDashOffset,Y.lineDashOffset=O.lineDashOffset),te.lineJoin!=O.lineJoin&&(te.lineJoin=O.lineJoin,Y.lineJoin=O.lineJoin),te.lineWidth!=O.lineWidth&&(te.lineWidth=O.lineWidth,Y.lineWidth=O.lineWidth),te.miterLimit!=O.miterLimit&&(te.miterLimit=O.miterLimit,Y.miterLimit=O.miterLimit),te.strokeStyle!=O.strokeStyle&&(te.strokeStyle=O.strokeStyle,Y.strokeStyle=O.strokeStyle)):(Y.lineCap=O.lineCap,Y.setLineDash(O.lineDash),Y.lineDashOffset=O.lineDashOffset,Y.lineJoin=O.lineJoin,Y.lineWidth=O.lineWidth,Y.miterLimit=O.miterLimit,Y.strokeStyle=O.strokeStyle,this.contextStrokeState_={lineCap:O.lineCap,lineDash:O.lineDash,lineDashOffset:O.lineDashOffset,lineJoin:O.lineJoin,lineWidth:O.lineWidth,miterLimit:O.miterLimit,strokeStyle:O.strokeStyle})}setContextTextState_(O){const Y=this.context_,te=this.contextTextState_,ne=O.textAlign?O.textAlign:defaultTextAlign;te?(te.font!=O.font&&(te.font=O.font,Y.font=O.font),te.textAlign!=ne&&(te.textAlign=ne,Y.textAlign=ne),te.textBaseline!=O.textBaseline&&(te.textBaseline=O.textBaseline,Y.textBaseline=O.textBaseline)):(Y.font=O.font,Y.textAlign=ne,Y.textBaseline=O.textBaseline,this.contextTextState_={font:O.font,textAlign:ne,textBaseline:O.textBaseline})}setFillStrokeStyle(O,Y){if(!O)this.fillState_=null;else{const te=O.getColor();this.fillState_={fillStyle:asColorLike(te||defaultFillStyle)}}if(!Y)this.strokeState_=null;else{const te=Y.getColor(),ne=Y.getLineCap(),xe=Y.getLineDash(),et=Y.getLineDashOffset(),tt=Y.getLineJoin(),it=Y.getWidth(),st=Y.getMiterLimit(),ot=xe||defaultLineDash;this.strokeState_={lineCap:ne!==void 0?ne:defaultLineCap,lineDash:this.pixelRatio_===1?ot:ot.map(rt=>rt*this.pixelRatio_),lineDashOffset:(et||defaultLineDashOffset)*this.pixelRatio_,lineJoin:tt!==void 0?tt:defaultLineJoin,lineWidth:(it!==void 0?it:defaultLineWidth)*this.pixelRatio_,miterLimit:st!==void 0?st:defaultMiterLimit,strokeStyle:asColorLike(te||defaultStrokeStyle)}}}setImageStyle(O){let Y;if(!O||!(Y=O.getSize())){this.image_=null;return}const te=O.getPixelRatio(this.pixelRatio_),ne=O.getAnchor(),xe=O.getOrigin();this.image_=O.getImage(this.pixelRatio_),this.imageAnchorX_=ne[0]*te,this.imageAnchorY_=ne[1]*te,this.imageHeight_=Y[1]*te,this.imageOpacity_=O.getOpacity(),this.imageOriginX_=xe[0],this.imageOriginY_=xe[1],this.imageRotateWithView_=O.getRotateWithView(),this.imageRotation_=O.getRotation();const et=O.getScaleArray();this.imageScale_=[et[0]*this.pixelRatio_/te,et[1]*this.pixelRatio_/te],this.imageWidth_=Y[0]*te}setTextStyle(O){if(!O)this.text_="";else{const Y=O.getFill();if(!Y)this.textFillState_=null;else{const at=Y.getColor();this.textFillState_={fillStyle:asColorLike(at||defaultFillStyle)}}const te=O.getStroke();if(!te)this.textStrokeState_=null;else{const at=te.getColor(),ct=te.getLineCap(),ut=te.getLineDash(),dt=te.getLineDashOffset(),ht=te.getLineJoin(),pt=te.getWidth(),ft=te.getMiterLimit();this.textStrokeState_={lineCap:ct!==void 0?ct:defaultLineCap,lineDash:ut||defaultLineDash,lineDashOffset:dt||defaultLineDashOffset,lineJoin:ht!==void 0?ht:defaultLineJoin,lineWidth:pt!==void 0?pt:defaultLineWidth,miterLimit:ft!==void 0?ft:defaultMiterLimit,strokeStyle:asColorLike(at||defaultStrokeStyle)}}const ne=O.getFont(),xe=O.getOffsetX(),et=O.getOffsetY(),tt=O.getRotateWithView(),it=O.getRotation(),st=O.getScaleArray(),ot=O.getText(),rt=O.getTextAlign(),nt=O.getTextBaseline();this.textState_={font:ne!==void 0?ne:defaultFont,textAlign:rt!==void 0?rt:defaultTextAlign,textBaseline:nt!==void 0?nt:defaultTextBaseline},this.text_=ot!==void 0?Array.isArray(ot)?ot.reduce((at,ct,ut)=>at+=ut%2?" ":ct,""):ot:"",this.textOffsetX_=xe!==void 0?this.pixelRatio_*xe:0,this.textOffsetY_=et!==void 0?this.pixelRatio_*et:0,this.textRotateWithView_=tt!==void 0?tt:!1,this.textRotation_=it!==void 0?it:0,this.textScale_=[this.pixelRatio_*st[0],this.pixelRatio_*st[1]]}}}const SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(ee,O){return parseInt(getUid(ee),10)-parseInt(getUid(O),10)}function getSquaredTolerance(ee,O){const Y=getTolerance(ee,O);return Y*Y}function getTolerance(ee,O){return SIMPLIFY_TOLERANCE*ee/O}function renderCircleGeometry(ee,O,Y,te,ne){const xe=Y.getFill(),et=Y.getStroke();if(xe||et){const it=ee.getBuilder(Y.getZIndex(),"Circle");it.setFillStrokeStyle(xe,et),it.drawCircle(O,te,ne)}const tt=Y.getText();if(tt&&tt.getText()){const it=ee.getBuilder(Y.getZIndex(),"Text");it.setTextStyle(tt),it.drawText(O,te)}}function renderFeature$1(ee,O,Y,te,ne,xe,et,tt){const it=[],st=Y.getImage();if(st){let nt=!0;const at=st.getImageState();at==ImageState.LOADED||at==ImageState.ERROR?nt=!1:at==ImageState.IDLE&&st.load(),nt&&it.push(st.ready())}const ot=Y.getFill();ot&&ot.loading()&&it.push(ot.ready());const rt=it.length>0;return rt&&Promise.all(it).then(()=>ne(null)),renderFeatureInternal(ee,O,Y,te,xe,et,tt),rt}function renderFeatureInternal(ee,O,Y,te,ne,xe,et){const tt=Y.getGeometryFunction()(O);if(!tt)return;const it=tt.simplifyTransformed(te,ne);if(Y.getRenderer())renderGeometry(ee,it,Y,O,et);else{const ot=GEOMETRY_RENDERERS[it.getType()];ot(ee,it,Y,O,et,xe)}}function renderGeometry(ee,O,Y,te,ne){if(O.getType()=="GeometryCollection"){const et=O.getGeometries();for(let tt=0,it=et.length;tt<it;++tt)renderGeometry(ee,et[tt],Y,te,ne);return}ee.getBuilder(Y.getZIndex(),"Default").drawCustom(O,te,Y.getRenderer(),Y.getHitDetectionRenderer(),ne)}function renderGeometryCollectionGeometry(ee,O,Y,te,ne,xe){const et=O.getGeometriesArray();let tt,it;for(tt=0,it=et.length;tt<it;++tt){const st=GEOMETRY_RENDERERS[et[tt].getType()];st(ee,et[tt],Y,te,ne,xe)}}function renderLineStringGeometry(ee,O,Y,te,ne){const xe=Y.getStroke();if(xe){const tt=ee.getBuilder(Y.getZIndex(),"LineString");tt.setFillStrokeStyle(null,xe),tt.drawLineString(O,te,ne)}const et=Y.getText();if(et&&et.getText()){const tt=ee.getBuilder(Y.getZIndex(),"Text");tt.setTextStyle(et),tt.drawText(O,te,ne)}}function renderMultiLineStringGeometry(ee,O,Y,te,ne){const xe=Y.getStroke();if(xe){const tt=ee.getBuilder(Y.getZIndex(),"LineString");tt.setFillStrokeStyle(null,xe),tt.drawMultiLineString(O,te,ne)}const et=Y.getText();if(et&&et.getText()){const tt=ee.getBuilder(Y.getZIndex(),"Text");tt.setTextStyle(et),tt.drawText(O,te,ne)}}function renderMultiPolygonGeometry(ee,O,Y,te,ne){const xe=Y.getFill(),et=Y.getStroke();if(et||xe){const it=ee.getBuilder(Y.getZIndex(),"Polygon");it.setFillStrokeStyle(xe,et),it.drawMultiPolygon(O,te,ne)}const tt=Y.getText();if(tt&&tt.getText()){const it=ee.getBuilder(Y.getZIndex(),"Text");it.setTextStyle(tt),it.drawText(O,te,ne)}}function renderPointGeometry(ee,O,Y,te,ne,xe){const et=Y.getImage(),tt=Y.getText(),it=tt&&tt.getText(),st=xe&&et&&it?{}:void 0;if(et){if(et.getImageState()!=ImageState.LOADED)return;const ot=ee.getBuilder(Y.getZIndex(),"Image");ot.setImageStyle(et,st),ot.drawPoint(O,te,ne)}if(it){const ot=ee.getBuilder(Y.getZIndex(),"Text");ot.setTextStyle(tt,st),ot.drawText(O,te,ne)}}function renderMultiPointGeometry(ee,O,Y,te,ne,xe){const et=Y.getImage(),tt=et&&et.getOpacity()!==0,it=Y.getText(),st=it&&it.getText(),ot=xe&&tt&&st?{}:void 0;if(tt){if(et.getImageState()!=ImageState.LOADED)return;const rt=ee.getBuilder(Y.getZIndex(),"Image");rt.setImageStyle(et,ot),rt.drawMultiPoint(O,te,ne)}if(st){const rt=ee.getBuilder(Y.getZIndex(),"Text");rt.setTextStyle(it,ot),rt.drawText(O,te,ne)}}function renderPolygonGeometry(ee,O,Y,te,ne){const xe=Y.getFill(),et=Y.getStroke();if(xe||et){const it=ee.getBuilder(Y.getZIndex(),"Polygon");it.setFillStrokeStyle(xe,et),it.drawPolygon(O,te,ne)}const tt=Y.getText();if(tt&&tt.getText()){const it=ee.getBuilder(Y.getZIndex(),"Text");it.setTextStyle(tt),it.drawText(O,te,ne)}}function getVectorContext(ee){if(!(ee.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const O=ee.inversePixelTransform[0],Y=ee.inversePixelTransform[1],te=Math.sqrt(O*O+Y*Y),ne=ee.frameState,xe=multiply(ee.inversePixelTransform.slice(),ne.coordinateToPixelTransform),et=getSquaredTolerance(ne.viewState.resolution,te);let tt;const it=getUserProjection();return it&&(tt=getTransformFromProjections(it,ne.viewState.projection)),new CanvasImmediateRenderer(ee.context,te,ne.extent,xe,ne.viewState.rotation,et,tt)}let withCredentials=!1;function loadFeaturesXhr(ee,O,Y,te,ne,xe,et){const tt=new XMLHttpRequest;tt.open("GET",typeof ee=="function"?ee(Y,te,ne):ee,!0),O.getType()=="arraybuffer"&&(tt.responseType="arraybuffer"),tt.withCredentials=withCredentials,tt.onload=function(it){if(!tt.status||tt.status>=200&&tt.status<300){const st=O.getType();try{let ot;st=="text"||st=="json"?ot=tt.responseText:st=="xml"?ot=tt.responseXML||tt.responseText:st=="arraybuffer"&&(ot=tt.response),ot?xe(O.readFeatures(ot,{extent:Y,featureProjection:ne}),O.readProjection(ot)):et()}catch{et()}}else et()},tt.onerror=et,tt.send()}function xhr(ee,O){return function(Y,te,ne,xe,et){loadFeaturesXhr(ee,O,Y,te,ne,(tt,it)=>{this.addFeatures(tt),xe!==void 0&&xe(tt)},()=>{this.changed(),et!==void 0&&et()})}}function all$1(ee,O){return[[-1/0,-1/0,1/0,1/0]]}function bbox$1(ee,O){return[ee]}function linearRingss(ee,O,Y,te){const ne=[];let xe=createEmpty();for(let et=0,tt=Y.length;et<tt;++et){const it=Y[et];xe=createOrUpdateFromFlatCoordinates(ee,O,it[0],te),ne.push((xe[0]+xe[2])/2,(xe[1]+xe[3])/2),O=it[it.length-1]}return ne}class Circle extends SimpleGeometry{constructor(O,Y,te){super(),te!==void 0&&Y===void 0?this.setFlatCoordinates(te,O):(Y=Y||0,this.setCenterAndRadius(O,Y,te))}clone(){const O=new Circle(this.flatCoordinates.slice(),void 0,this.layout);return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){const xe=this.flatCoordinates,et=O-xe[0],tt=Y-xe[1],it=et*et+tt*tt;if(it<ne){if(it===0)for(let st=0;st<this.stride;++st)te[st]=xe[st];else{const st=this.getRadius()/Math.sqrt(it);te[0]=xe[0]+st*et,te[1]=xe[1]+st*tt;for(let ot=2;ot<this.stride;++ot)te[ot]=xe[ot]}return te.length=this.stride,it}return ne}containsXY(O,Y){const te=this.flatCoordinates,ne=O-te[0],xe=Y-te[1];return ne*ne+xe*xe<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(O){const Y=this.flatCoordinates,te=Y[this.stride]-Y[0];return createOrUpdate$2(Y[0]-te,Y[1]-te,Y[0]+te,Y[1]+te,O)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const O=this.flatCoordinates[this.stride]-this.flatCoordinates[0],Y=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return O*O+Y*Y}getType(){return"Circle"}intersectsExtent(O){const Y=this.getExtent();if(intersects$1(O,Y)){const te=this.getCenter();return O[0]<=te[0]&&O[2]>=te[0]||O[1]<=te[1]&&O[3]>=te[1]?!0:forEachCorner(O,this.intersectsCoordinate.bind(this))}return!1}setCenter(O){const Y=this.stride,te=this.flatCoordinates[Y]-this.flatCoordinates[0],ne=O.slice();ne[Y]=ne[0]+te;for(let xe=1;xe<Y;++xe)ne[Y+xe]=O[xe];this.setFlatCoordinates(this.layout,ne),this.changed()}setCenterAndRadius(O,Y,te){this.setLayout(te,O,0),this.flatCoordinates||(this.flatCoordinates=[]);const ne=this.flatCoordinates;let xe=deflateCoordinate(ne,0,O,this.stride);ne[xe++]=ne[0]+Y;for(let et=1,tt=this.stride;et<tt;++et)ne[xe++]=ne[et];ne.length=xe,this.changed()}getCoordinates(){return null}setCoordinates(O,Y){}setRadius(O){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+O,this.changed()}rotate(O,Y){const te=this.getCenter(),ne=this.getStride();this.setCenter(rotate(te,0,te.length,ne,O,Y,te)),this.changed()}}Circle.prototype.transform;class GeometryCollection extends Geometry{constructor(O){super(),this.geometries_=O,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(unlistenByKey),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const O=this.geometries_;for(let Y=0,te=O.length;Y<te;++Y)this.changeEventsKeys_.push(listen(O[Y],EventType.CHANGE,this.changed,this))}clone(){const O=new GeometryCollection(cloneGeometries(this.geometries_));return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){if(ne<closestSquaredDistanceXY(this.getExtent(),O,Y))return ne;const xe=this.geometries_;for(let et=0,tt=xe.length;et<tt;++et)ne=xe[et].closestPointXY(O,Y,te,ne);return ne}containsXY(O,Y){const te=this.geometries_;for(let ne=0,xe=te.length;ne<xe;++ne)if(te[ne].containsXY(O,Y))return!0;return!1}computeExtent(O){createOrUpdateEmpty(O);const Y=this.geometries_;for(let te=0,ne=Y.length;te<ne;++te)extend$1(O,Y[te].getExtent());return O}getGeometries(){return cloneGeometries(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let O=[];const Y=this.geometries_;for(let te=0,ne=Y.length;te<ne;++te)Y[te].getType()===this.getType()?O=O.concat(Y[te].getGeometriesArrayRecursive()):O.push(Y[te]);return O}getSimplifiedGeometry(O){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),O<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&O<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const Y=[],te=this.geometries_;let ne=!1;for(let xe=0,et=te.length;xe<et;++xe){const tt=te[xe],it=tt.getSimplifiedGeometry(O);Y.push(it),it!==tt&&(ne=!0)}return ne?new GeometryCollection(Y):(this.simplifiedGeometryMaxMinSquaredTolerance=O,this)}getType(){return"GeometryCollection"}intersectsExtent(O){const Y=this.geometries_;for(let te=0,ne=Y.length;te<ne;++te)if(Y[te].intersectsExtent(O))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(O,Y){const te=this.geometries_;for(let ne=0,xe=te.length;ne<xe;++ne)te[ne].rotate(O,Y);this.changed()}scale(O,Y,te){te||(te=getCenter(this.getExtent()));const ne=this.geometries_;for(let xe=0,et=ne.length;xe<et;++xe)ne[xe].scale(O,Y,te);this.changed()}setGeometries(O){this.setGeometriesArray(cloneGeometries(O))}setGeometriesArray(O){this.unlistenGeometriesChange_(),this.geometries_=O,this.listenGeometriesChange_(),this.changed()}applyTransform(O){const Y=this.geometries_;for(let te=0,ne=Y.length;te<ne;++te)Y[te].applyTransform(O);this.changed()}translate(O,Y){const te=this.geometries_;for(let ne=0,xe=te.length;ne<xe;++ne)te[ne].translate(O,Y);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function cloneGeometries(ee){return ee.map(O=>O.clone())}class MultiLineString extends SimpleGeometry{constructor(O,Y,te){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(O[0]))this.setCoordinates(O,Y);else if(Y!==void 0&&te)this.setFlatCoordinates(Y,O),this.ends_=te;else{const ne=O,xe=[],et=[];for(let it=0,st=ne.length;it<st;++it){const ot=ne[it];extend$2(xe,ot.getFlatCoordinates()),et.push(xe.length)}const tt=ne.length===0?this.getLayout():ne[0].getLayout();this.setFlatCoordinates(tt,xe),this.ends_=et}}appendLineString(O){extend$2(this.flatCoordinates,O.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const O=new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){return ne<closestSquaredDistanceXY(this.getExtent(),O,Y)?ne:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,O,Y,te,ne))}getCoordinateAtM(O,Y,te){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(Y=Y!==void 0?Y:!1,te=te!==void 0?te:!1,lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,O,Y,te))}getCoordinates(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(O){return O<0||this.ends_.length<=O?null:new LineString(this.flatCoordinates.slice(O===0?0:this.ends_[O-1],this.ends_[O]),this.layout)}getLineStrings(){const O=this.flatCoordinates,Y=this.ends_,te=this.layout,ne=[];let xe=0;for(let et=0,tt=Y.length;et<tt;++et){const it=Y[et],st=new LineString(O.slice(xe,it),te);ne.push(st),xe=it}return ne}getLength(){const O=this.ends_;let Y=0,te=0;for(let ne=0,xe=O.length;ne<xe;++ne)te+=lineStringLength(this.flatCoordinates,Y,O[ne],this.stride),Y=O[ne];return te}getFlatMidpoints(){const O=[],Y=this.flatCoordinates;let te=0;const ne=this.ends_,xe=this.stride;for(let et=0,tt=ne.length;et<tt;++et){const it=ne[et],st=interpolatePoint(Y,te,it,xe,.5);extend$2(O,st),te=it}return O}getSimplifiedGeometryInternal(O){const Y=[],te=[];return Y.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,O,Y,0,te),new MultiLineString(Y,"XY",te)}getType(){return"MultiLineString"}intersectsExtent(O){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,O)}setCoordinates(O,Y){this.setLayout(Y,O,2),this.flatCoordinates||(this.flatCoordinates=[]);const te=deflateCoordinatesArray(this.flatCoordinates,0,O,this.stride,this.ends_);this.flatCoordinates.length=te.length===0?0:te[te.length-1],this.changed()}}class MultiPoint extends SimpleGeometry{constructor(O,Y){super(),Y&&!Array.isArray(O[0])?this.setFlatCoordinates(Y,O):this.setCoordinates(O,Y)}appendPoint(O){extend$2(this.flatCoordinates,O.getFlatCoordinates()),this.changed()}clone(){const O=new MultiPoint(this.flatCoordinates.slice(),this.layout);return O.applyProperties(this),O}closestPointXY(O,Y,te,ne){if(ne<closestSquaredDistanceXY(this.getExtent(),O,Y))return ne;const xe=this.flatCoordinates,et=this.stride;for(let tt=0,it=xe.length;tt<it;tt+=et){const st=squaredDistance$1(O,Y,xe[tt],xe[tt+1]);if(st<ne){ne=st;for(let ot=0;ot<et;++ot)te[ot]=xe[tt+ot];te.length=et}}return ne}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(O){const Y=this.flatCoordinates.length/this.stride;return O<0||Y<=O?null:new Point(this.flatCoordinates.slice(O*this.stride,(O+1)*this.stride),this.layout)}getPoints(){const O=this.flatCoordinates,Y=this.layout,te=this.stride,ne=[];for(let xe=0,et=O.length;xe<et;xe+=te){const tt=new Point(O.slice(xe,xe+te),Y);ne.push(tt)}return ne}getType(){return"MultiPoint"}intersectsExtent(O){const Y=this.flatCoordinates,te=this.stride;for(let ne=0,xe=Y.length;ne<xe;ne+=te){const et=Y[ne],tt=Y[ne+1];if(containsXY(O,et,tt))return!0}return!1}setCoordinates(O,Y){this.setLayout(Y,O,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,O,this.stride),this.changed()}}class MultiPolygon extends SimpleGeometry{constructor(O,Y,te){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!te&&!Array.isArray(O[0])){const ne=O,xe=[],et=[];for(let tt=0,it=ne.length;tt<it;++tt){const st=ne[tt],ot=xe.length,rt=st.getEnds();for(let nt=0,at=rt.length;nt<at;++nt)rt[nt]+=ot;extend$2(xe,st.getFlatCoordinates()),et.push(rt)}Y=ne.length===0?this.getLayout():ne[0].getLayout(),O=xe,te=et}Y!==void 0&&te?(this.setFlatCoordinates(Y,O),this.endss_=te):this.setCoordinates(O,Y)}appendPolygon(O){let Y;if(!this.flatCoordinates)this.flatCoordinates=O.getFlatCoordinates().slice(),Y=O.getEnds().slice(),this.endss_.push();else{const te=this.flatCoordinates.length;extend$2(this.flatCoordinates,O.getFlatCoordinates()),Y=O.getEnds().slice();for(let ne=0,xe=Y.length;ne<xe;++ne)Y[ne]+=te}this.endss_.push(Y),this.changed()}clone(){const O=this.endss_.length,Y=new Array(O);for(let ne=0;ne<O;++ne)Y[ne]=this.endss_[ne].slice();const te=new MultiPolygon(this.flatCoordinates.slice(),this.layout,Y);return te.applyProperties(this),te}closestPointXY(O,Y,te,ne){return ne<closestSquaredDistanceXY(this.getExtent(),O,Y)?ne:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,O,Y,te,ne))}containsXY(O,Y){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,O,Y)}getArea(){return linearRingss$1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(O){let Y;return O!==void 0?(Y=this.getOrientedFlatCoordinates().slice(),orientLinearRingsArray(Y,0,this.endss_,this.stride,O)):Y=this.flatCoordinates,inflateMultiCoordinatesArray(Y,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const O=linearRingss(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,O),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new MultiPoint(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const O=this.flatCoordinates;linearRingssAreOriented(O,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=O:(this.orientedFlatCoordinates_=O.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(O){const Y=[],te=[];return Y.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(O),Y,0,te),new MultiPolygon(Y,"XY",te)}getPolygon(O){if(O<0||this.endss_.length<=O)return null;let Y;if(O===0)Y=0;else{const xe=this.endss_[O-1];Y=xe[xe.length-1]}const te=this.endss_[O].slice(),ne=te[te.length-1];if(Y!==0)for(let xe=0,et=te.length;xe<et;++xe)te[xe]-=Y;return new Polygon(this.flatCoordinates.slice(Y,ne),this.layout,te)}getPolygons(){const O=this.layout,Y=this.flatCoordinates,te=this.endss_,ne=[];let xe=0;for(let et=0,tt=te.length;et<tt;++et){const it=te[et].slice(),st=it[it.length-1];if(xe!==0)for(let rt=0,nt=it.length;rt<nt;++rt)it[rt]-=xe;const ot=new Polygon(Y.slice(xe,st),O,it);ne.push(ot),xe=st}return ne}getType(){return"MultiPolygon"}intersectsExtent(O){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,O)}setCoordinates(O,Y){this.setLayout(Y,O,3),this.flatCoordinates||(this.flatCoordinates=[]);const te=deflateMultiCoordinatesArray(this.flatCoordinates,0,O,this.stride,this.endss_);if(te.length===0)this.flatCoordinates.length=0;else{const ne=te[te.length-1];this.flatCoordinates.length=ne.length===0?0:ne[ne.length-1]}this.changed()}}const olGeom=Object.freeze(Object.defineProperty({__proto__:null,Circle,Geometry,GeometryCollection,LineString,LinearRing,MultiLineString,MultiPoint,MultiPolygon,Point,Polygon,SimpleGeometry},Symbol.toStringTag,{value:"Module"})),tmpTransform=create$2();class RenderFeature{constructor(O,Y,te,ne,xe,et){this.styleFunction,this.extent_,this.id_=et,this.type_=O,this.flatCoordinates_=Y,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=te||null,this.properties_=xe,this.squaredTolerance_,this.stride_=ne,this.simplifiedGeometry_}get(O){return this.properties_[O]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?createOrUpdateFromCoordinate(this.flatCoordinates_):createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const O=getCenter(this.getExtent());this.flatInteriorPoints_=getInteriorPointOfArray(this.flatCoordinates_,0,this.ends_,2,O,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const O=inflateEnds(this.flatCoordinates_,this.ends_),Y=linearRingss(this.flatCoordinates_,0,O,2);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.flatCoordinates_,0,O,2,Y)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=interpolatePoint(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const O=this.flatCoordinates_;let Y=0;const te=this.ends_;for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne],tt=interpolatePoint(O,Y,et,2,.5);extend$2(this.flatMidpoints_,tt),Y=et}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(O){return this}simplifyTransformed(O,Y){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(O){O=get$2(O);const Y=O.getExtent(),te=O.getWorldExtent();if(Y&&te){const ne=getHeight(te)/getHeight(Y);compose(tmpTransform,te[0],te[3],ne,-ne,0,0,0),transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tmpTransform,this.flatCoordinates_)}}applyTransform(O){O(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new RenderFeature(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=memoizeOne((O,Y)=>{if(O===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),Y&&this.simplifiedGeometry_.applyTransform(Y);const te=this.simplifiedGeometry_.getFlatCoordinates();let ne;switch(this.type_){case"LineString":te.length=douglasPeucker(te,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,O,te,0),ne=[te.length];break;case"MultiLineString":ne=[],te.length=douglasPeuckerArray(te,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,O,te,0,ne);break;case"Polygon":ne=[],te.length=quantizeArray(te,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(O),te,0,ne);break}return ne&&(this.simplifiedGeometry_=new RenderFeature(this.type_,te,ne,2,this.properties_,this.id_)),this.squaredTolerance_=O,this.simplifiedGeometry_}),this}}RenderFeature.prototype.getFlatCoordinates=RenderFeature.prototype.getOrientedFlatCoordinates;function quickselect(ee,O,Y=0,te=ee.length-1,ne=defaultCompare){for(;te>Y;){if(te-Y>600){const it=te-Y+1,st=O-Y+1,ot=Math.log(it),rt=.5*Math.exp(2*ot/3),nt=.5*Math.sqrt(ot*rt*(it-rt)/it)*(st-it/2<0?-1:1),at=Math.max(Y,Math.floor(O-st*rt/it+nt)),ct=Math.min(te,Math.floor(O+(it-st)*rt/it+nt));quickselect(ee,O,at,ct,ne)}const xe=ee[O];let et=Y,tt=te;for(swap(ee,Y,O),ne(ee[te],xe)>0&&swap(ee,Y,te);et<tt;){for(swap(ee,et,tt),et++,tt--;ne(ee[et],xe)<0;)et++;for(;ne(ee[tt],xe)>0;)tt--}ne(ee[Y],xe)===0?swap(ee,Y,tt):(tt++,swap(ee,tt,te)),tt<=O&&(Y=tt+1),O<=tt&&(te=tt-1)}}function swap(ee,O,Y){const te=ee[O];ee[O]=ee[Y],ee[Y]=te}function defaultCompare(ee,O){return ee<O?-1:ee>O?1:0}let RBush$1=class{constructor(O=9){this._maxEntries=Math.max(4,O),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(O){let Y=this.data;const te=[];if(!intersects(O,Y))return te;const ne=this.toBBox,xe=[];for(;Y;){for(let et=0;et<Y.children.length;et++){const tt=Y.children[et],it=Y.leaf?ne(tt):tt;intersects(O,it)&&(Y.leaf?te.push(tt):contains(O,it)?this._all(tt,te):xe.push(tt))}Y=xe.pop()}return te}collides(O){let Y=this.data;if(!intersects(O,Y))return!1;const te=[];for(;Y;){for(let ne=0;ne<Y.children.length;ne++){const xe=Y.children[ne],et=Y.leaf?this.toBBox(xe):xe;if(intersects(O,et)){if(Y.leaf||contains(O,et))return!0;te.push(xe)}}Y=te.pop()}return!1}load(O){if(!(O&&O.length))return this;if(O.length<this._minEntries){for(let te=0;te<O.length;te++)this.insert(O[te]);return this}let Y=this._build(O.slice(),0,O.length-1,0);if(!this.data.children.length)this.data=Y;else if(this.data.height===Y.height)this._splitRoot(this.data,Y);else{if(this.data.height<Y.height){const te=this.data;this.data=Y,Y=te}this._insert(Y,this.data.height-Y.height-1,!0)}return this}insert(O){return O&&this._insert(O,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(O,Y){if(!O)return this;let te=this.data;const ne=this.toBBox(O),xe=[],et=[];let tt,it,st;for(;te||xe.length;){if(te||(te=xe.pop(),it=xe[xe.length-1],tt=et.pop(),st=!0),te.leaf){const ot=findItem(O,te.children,Y);if(ot!==-1)return te.children.splice(ot,1),xe.push(te),this._condense(xe),this}!st&&!te.leaf&&contains(te,ne)?(xe.push(te),et.push(tt),tt=0,it=te,te=te.children[0]):it?(tt++,te=it.children[tt],st=!1):te=null}return this}toBBox(O){return O}compareMinX(O,Y){return O.minX-Y.minX}compareMinY(O,Y){return O.minY-Y.minY}toJSON(){return this.data}fromJSON(O){return this.data=O,this}_all(O,Y){const te=[];for(;O;)O.leaf?Y.push(...O.children):te.push(...O.children),O=te.pop();return Y}_build(O,Y,te,ne){const xe=te-Y+1;let et=this._maxEntries,tt;if(xe<=et)return tt=createNode(O.slice(Y,te+1)),calcBBox(tt,this.toBBox),tt;ne||(ne=Math.ceil(Math.log(xe)/Math.log(et)),et=Math.ceil(xe/Math.pow(et,ne-1))),tt=createNode([]),tt.leaf=!1,tt.height=ne;const it=Math.ceil(xe/et),st=it*Math.ceil(Math.sqrt(et));multiSelect(O,Y,te,st,this.compareMinX);for(let ot=Y;ot<=te;ot+=st){const rt=Math.min(ot+st-1,te);multiSelect(O,ot,rt,it,this.compareMinY);for(let nt=ot;nt<=rt;nt+=it){const at=Math.min(nt+it-1,rt);tt.children.push(this._build(O,nt,at,ne-1))}}return calcBBox(tt,this.toBBox),tt}_chooseSubtree(O,Y,te,ne){for(;ne.push(Y),!(Y.leaf||ne.length-1===te);){let xe=1/0,et=1/0,tt;for(let it=0;it<Y.children.length;it++){const st=Y.children[it],ot=bboxArea(st),rt=enlargedArea(O,st)-ot;rt<et?(et=rt,xe=ot<xe?ot:xe,tt=st):rt===et&&ot<xe&&(xe=ot,tt=st)}Y=tt||Y.children[0]}return Y}_insert(O,Y,te){const ne=te?O:this.toBBox(O),xe=[],et=this._chooseSubtree(ne,this.data,Y,xe);for(et.children.push(O),extend(et,ne);Y>=0&&xe[Y].children.length>this._maxEntries;)this._split(xe,Y),Y--;this._adjustParentBBoxes(ne,xe,Y)}_split(O,Y){const te=O[Y],ne=te.children.length,xe=this._minEntries;this._chooseSplitAxis(te,xe,ne);const et=this._chooseSplitIndex(te,xe,ne),tt=createNode(te.children.splice(et,te.children.length-et));tt.height=te.height,tt.leaf=te.leaf,calcBBox(te,this.toBBox),calcBBox(tt,this.toBBox),Y?O[Y-1].children.push(tt):this._splitRoot(te,tt)}_splitRoot(O,Y){this.data=createNode([O,Y]),this.data.height=O.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(O,Y,te){let ne,xe=1/0,et=1/0;for(let tt=Y;tt<=te-Y;tt++){const it=distBBox(O,0,tt,this.toBBox),st=distBBox(O,tt,te,this.toBBox),ot=intersectionArea(it,st),rt=bboxArea(it)+bboxArea(st);ot<xe?(xe=ot,ne=tt,et=rt<et?rt:et):ot===xe&&rt<et&&(et=rt,ne=tt)}return ne||te-Y}_chooseSplitAxis(O,Y,te){const ne=O.leaf?this.compareMinX:compareNodeMinX,xe=O.leaf?this.compareMinY:compareNodeMinY,et=this._allDistMargin(O,Y,te,ne),tt=this._allDistMargin(O,Y,te,xe);et<tt&&O.children.sort(ne)}_allDistMargin(O,Y,te,ne){O.children.sort(ne);const xe=this.toBBox,et=distBBox(O,0,Y,xe),tt=distBBox(O,te-Y,te,xe);let it=bboxMargin(et)+bboxMargin(tt);for(let st=Y;st<te-Y;st++){const ot=O.children[st];extend(et,O.leaf?xe(ot):ot),it+=bboxMargin(et)}for(let st=te-Y-1;st>=Y;st--){const ot=O.children[st];extend(tt,O.leaf?xe(ot):ot),it+=bboxMargin(tt)}return it}_adjustParentBBoxes(O,Y,te){for(let ne=te;ne>=0;ne--)extend(Y[ne],O)}_condense(O){for(let Y=O.length-1,te;Y>=0;Y--)O[Y].children.length===0?Y>0?(te=O[Y-1].children,te.splice(te.indexOf(O[Y]),1)):this.clear():calcBBox(O[Y],this.toBBox)}};function findItem(ee,O,Y){if(!Y)return O.indexOf(ee);for(let te=0;te<O.length;te++)if(Y(ee,O[te]))return te;return-1}function calcBBox(ee,O){distBBox(ee,0,ee.children.length,O,ee)}function distBBox(ee,O,Y,te,ne){ne||(ne=createNode(null)),ne.minX=1/0,ne.minY=1/0,ne.maxX=-1/0,ne.maxY=-1/0;for(let xe=O;xe<Y;xe++){const et=ee.children[xe];extend(ne,ee.leaf?te(et):et)}return ne}function extend(ee,O){return ee.minX=Math.min(ee.minX,O.minX),ee.minY=Math.min(ee.minY,O.minY),ee.maxX=Math.max(ee.maxX,O.maxX),ee.maxY=Math.max(ee.maxY,O.maxY),ee}function compareNodeMinX(ee,O){return ee.minX-O.minX}function compareNodeMinY(ee,O){return ee.minY-O.minY}function bboxArea(ee){return(ee.maxX-ee.minX)*(ee.maxY-ee.minY)}function bboxMargin(ee){return ee.maxX-ee.minX+(ee.maxY-ee.minY)}function enlargedArea(ee,O){return(Math.max(O.maxX,ee.maxX)-Math.min(O.minX,ee.minX))*(Math.max(O.maxY,ee.maxY)-Math.min(O.minY,ee.minY))}function intersectionArea(ee,O){const Y=Math.max(ee.minX,O.minX),te=Math.max(ee.minY,O.minY),ne=Math.min(ee.maxX,O.maxX),xe=Math.min(ee.maxY,O.maxY);return Math.max(0,ne-Y)*Math.max(0,xe-te)}function contains(ee,O){return ee.minX<=O.minX&&ee.minY<=O.minY&&O.maxX<=ee.maxX&&O.maxY<=ee.maxY}function intersects(ee,O){return O.minX<=ee.maxX&&O.minY<=ee.maxY&&O.maxX>=ee.minX&&O.maxY>=ee.minY}function createNode(ee){return{children:ee,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(ee,O,Y,te,ne){const xe=[O,Y];for(;xe.length;){if(Y=xe.pop(),O=xe.pop(),Y-O<=te)continue;const et=O+Math.ceil((Y-O)/te/2)*te;quickselect(ee,et,O,Y,ne),xe.push(O,et,et,Y)}}class RBush{constructor(O){this.rbush_=new RBush$1(O),this.items_={}}insert(O,Y){const te={minX:O[0],minY:O[1],maxX:O[2],maxY:O[3],value:Y};this.rbush_.insert(te),this.items_[getUid(Y)]=te}load(O,Y){const te=new Array(Y.length);for(let ne=0,xe=Y.length;ne<xe;ne++){const et=O[ne],tt=Y[ne],it={minX:et[0],minY:et[1],maxX:et[2],maxY:et[3],value:tt};te[ne]=it,this.items_[getUid(tt)]=it}this.rbush_.load(te)}remove(O){const Y=getUid(O),te=this.items_[Y];return delete this.items_[Y],this.rbush_.remove(te)!==null}update(O,Y){const te=this.items_[getUid(Y)],ne=[te.minX,te.minY,te.maxX,te.maxY];equals$1(ne,O)||(this.remove(Y),this.insert(O,Y))}getAll(){return this.rbush_.all().map(function(Y){return Y.value})}getInExtent(O){const Y={minX:O[0],minY:O[1],maxX:O[2],maxY:O[3]};return this.rbush_.search(Y).map(function(ne){return ne.value})}forEach(O){return this.forEach_(this.getAll(),O)}forEachInExtent(O,Y){return this.forEach_(this.getInExtent(O),Y)}forEach_(O,Y){let te;for(let ne=0,xe=O.length;ne<xe;ne++)if(te=Y(O[ne]),te)return te;return te}isEmpty(){return isEmpty$1(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(O){const Y=this.rbush_.toJSON();return createOrUpdate$2(Y.minX,Y.minY,Y.maxX,Y.maxY,O)}concat(O){this.rbush_.load(O.rbush_.all());for(const Y in O.items_)this.items_[Y]=O.items_[Y]}}class Source extends BaseObject{constructor(O){super(),this.projection=get$2(O.projection),this.attributions_=adaptAttributions(O.attributions),this.attributionsCollapsible_=O.attributionsCollapsible??!0,this.loading=!1,this.state_=O.state!==void 0?O.state:"ready",this.wrapX_=O.wrapX!==void 0?O.wrapX:!1,this.interpolate_=!!O.interpolate,this.viewResolver=null,this.viewRejector=null;const Y=this;this.viewPromise_=new Promise(function(te,ne){Y.viewResolver=te,Y.viewRejector=ne})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(O){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(O){this.attributions_=adaptAttributions(O),this.changed()}setState(O){this.state_=O,this.changed()}}function adaptAttributions(ee){return ee?typeof ee=="function"?ee:(Array.isArray(ee)||(ee=[ee]),O=>ee):null}const VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class VectorSourceEvent extends BaseEvent{constructor(O,Y,te){super(O),this.feature=Y,this.features=te}}class VectorSource extends Source{constructor(O){O=O||{},super({attributions:O.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:O.wrapX!==void 0?O.wrapX:!0}),this.on,this.once,this.un,this.loader_=VOID,this.format_=O.format||null,this.overlaps_=O.overlaps===void 0?!0:O.overlaps,this.url_=O.url,O.loader!==void 0?this.loader_=O.loader:this.url_!==void 0&&(assert(this.format_,"`format` must be set when `url` is set"),this.loader_=xhr(this.url_,this.format_)),this.strategy_=O.strategy!==void 0?O.strategy:all$1;const Y=O.useSpatialIndex!==void 0?O.useSpatialIndex:!0;this.featuresRtree_=Y?new RBush:null,this.loadedExtentsRtree_=new RBush,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let te,ne;Array.isArray(O.features)?ne=O.features:O.features&&(te=O.features,ne=te.getArray()),!Y&&te===void 0&&(te=new Collection(ne)),ne!==void 0&&this.addFeaturesInternal(ne),te!==void 0&&this.bindFeaturesCollection_(te)}addFeature(O){this.addFeatureInternal(O),this.changed()}addFeatureInternal(O){const Y=getUid(O);if(!this.addToIndex_(Y,O)){this.featuresCollection_&&this.featuresCollection_.remove(O);return}this.setupChangeEvents_(Y,O);const te=O.getGeometry();if(te){const ne=te.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(ne,O)}else this.nullGeometryFeatures_[Y]=O;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,O))}setupChangeEvents_(O,Y){Y instanceof RenderFeature||(this.featureChangeKeys_[O]=[listen(Y,EventType.CHANGE,this.handleFeatureChange_,this),listen(Y,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(O,Y){let te=!0;if(Y.getId()!==void 0){const ne=String(Y.getId());if(!(ne in this.idIndex_))this.idIndex_[ne]=Y;else if(Y instanceof RenderFeature){const xe=this.idIndex_[ne];xe instanceof RenderFeature?Array.isArray(xe)?xe.push(Y):this.idIndex_[ne]=[xe,Y]:te=!1}else te=!1}return te&&(assert(!(O in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[O]=Y),te}addFeatures(O){this.addFeaturesInternal(O),this.changed()}addFeaturesInternal(O){const Y=[],te=[],ne=[];for(let xe=0,et=O.length;xe<et;xe++){const tt=O[xe],it=getUid(tt);this.addToIndex_(it,tt)&&te.push(tt)}for(let xe=0,et=te.length;xe<et;xe++){const tt=te[xe],it=getUid(tt);this.setupChangeEvents_(it,tt);const st=tt.getGeometry();if(st){const ot=st.getExtent();Y.push(ot),ne.push(tt)}else this.nullGeometryFeatures_[it]=tt}if(this.featuresRtree_&&this.featuresRtree_.load(Y,ne),this.hasListener(VectorEventType.ADDFEATURE))for(let xe=0,et=te.length;xe<et;xe++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,te[xe]))}bindFeaturesCollection_(O){let Y=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(te){Y||(Y=!0,O.push(te.feature),Y=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(te){Y||(Y=!0,O.remove(te.feature),Y=!1)}),O.addEventListener(CollectionEventType.ADD,te=>{Y||(Y=!0,this.addFeature(te.element),Y=!1)}),O.addEventListener(CollectionEventType.REMOVE,te=>{Y||(Y=!0,this.removeFeature(te.element),Y=!1)}),this.featuresCollection_=O}clear(O){if(O){for(const te in this.featureChangeKeys_)this.featureChangeKeys_[te].forEach(unlistenByKey);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(te=>{this.removeFeatureInternal(te)});for(const te in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[te])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const Y=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(Y),this.changed()}forEachFeature(O){if(this.featuresRtree_)return this.featuresRtree_.forEach(O);this.featuresCollection_&&this.featuresCollection_.forEach(O)}forEachFeatureAtCoordinateDirect(O,Y){const te=[O[0],O[1],O[0],O[1]];return this.forEachFeatureInExtent(te,function(ne){const xe=ne.getGeometry();if(xe instanceof RenderFeature||xe.intersectsCoordinate(O))return Y(ne)})}forEachFeatureInExtent(O,Y){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(O,Y);this.featuresCollection_&&this.featuresCollection_.forEach(Y)}forEachFeatureIntersectingExtent(O,Y){return this.forEachFeatureInExtent(O,function(te){const ne=te.getGeometry();if(ne instanceof RenderFeature||ne.intersectsExtent(O)){const xe=Y(te);if(xe)return xe}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let O;return this.featuresCollection_?O=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(O=this.featuresRtree_.getAll(),isEmpty$1(this.nullGeometryFeatures_)||extend$2(O,Object.values(this.nullGeometryFeatures_))),O}getFeaturesAtCoordinate(O){const Y=[];return this.forEachFeatureAtCoordinateDirect(O,function(te){Y.push(te)}),Y}getFeaturesInExtent(O,Y){if(this.featuresRtree_){if(!(Y&&Y.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(O);const ne=wrapAndSliceX(O,Y);return[].concat(...ne.map(xe=>this.featuresRtree_.getInExtent(xe)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(O,Y){const te=O[0],ne=O[1];let xe=null;const et=[NaN,NaN];let tt=1/0;const it=[-1/0,-1/0,1/0,1/0];return Y=Y||TRUE,this.featuresRtree_.forEachInExtent(it,function(st){if(Y(st)){const ot=st.getGeometry(),rt=tt;if(tt=ot instanceof RenderFeature?0:ot.closestPointXY(te,ne,et,tt),tt<rt){xe=st;const nt=Math.sqrt(tt);it[0]=te-nt,it[1]=ne-nt,it[2]=te+nt,it[3]=ne+nt}}}),xe}getExtent(O){return this.featuresRtree_.getExtent(O)}getFeatureById(O){const Y=this.idIndex_[O.toString()];return Y!==void 0?Y:null}getFeatureByUid(O){const Y=this.uidIndex_[O];return Y!==void 0?Y:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(O){const Y=O.target,te=getUid(Y),ne=Y.getGeometry();if(!ne)te in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(Y),this.nullGeometryFeatures_[te]=Y);else{const et=ne.getExtent();te in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[te],this.featuresRtree_&&this.featuresRtree_.insert(et,Y)):this.featuresRtree_&&this.featuresRtree_.update(et,Y)}const xe=Y.getId();if(xe!==void 0){const et=xe.toString();this.idIndex_[et]!==Y&&(this.removeFromIdIndex_(Y),this.idIndex_[et]=Y)}else this.removeFromIdIndex_(Y),this.uidIndex_[te]=Y;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,Y))}hasFeature(O){const Y=O.getId();return Y!==void 0?Y in this.idIndex_:getUid(O)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&isEmpty$1(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(O,Y,te){const ne=this.loadedExtentsRtree_,xe=this.strategy_(O,Y,te);for(let et=0,tt=xe.length;et<tt;++et){const it=xe[et];ne.forEachInExtent(it,function(ot){return containsExtent(ot.extent,it)})||(++this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),this.loader_.call(this,it,Y,te,ot=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,ot))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}),ne.insert(it,{extent:it.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(O){const Y=this.loadedExtentsRtree_,te=Y.forEachInExtent(O,function(ne){if(equals$1(ne.extent,O))return ne});te&&Y.remove(te)}removeFeatures(O){let Y=!1;for(let te=0,ne=O.length;te<ne;++te)Y=this.removeFeatureInternal(O[te])||Y;Y&&this.changed()}removeFeature(O){if(!O)return;this.removeFeatureInternal(O)&&this.changed()}removeFeatureInternal(O){const Y=getUid(O);if(!(Y in this.uidIndex_))return!1;Y in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[Y]:this.featuresRtree_&&this.featuresRtree_.remove(O),this.featureChangeKeys_[Y]?.forEach(unlistenByKey),delete this.featureChangeKeys_[Y];const ne=O.getId();if(ne!==void 0){const xe=ne.toString(),et=this.idIndex_[xe];et===O?delete this.idIndex_[xe]:Array.isArray(et)&&(et.splice(et.indexOf(O),1),et.length===1&&(this.idIndex_[xe]=et[0]))}return delete this.uidIndex_[Y],this.hasListener(VectorEventType.REMOVEFEATURE)&&this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,O)),!0}removeFromIdIndex_(O){for(const Y in this.idIndex_)if(this.idIndex_[Y]===O){delete this.idIndex_[Y];break}}setLoader(O){this.loader_=O}setUrl(O){assert(this.format_,"`format` must be set when `url` is set"),this.url_=O,this.setLoader(xhr(O,this.format_))}setOverlaps(O){this.overlaps_=O,this.changed()}}class Fill{constructor(O){O=O||{},this.patternImage_=null,this.color_=null,O.color!==void 0&&this.setColor(O.color)}clone(){const O=this.getColor();return new Fill({color:Array.isArray(O)?O.slice():O||void 0})}getColor(){return this.color_}setColor(O){if(O!==null&&typeof O=="object"&&"src"in O){const Y=get$1(null,O.src,"anonymous",void 0,O.offset?null:O.color?O.color:null,!(O.offset&&O.size));Y.ready().then(()=>{this.patternImage_=null}),Y.getImageState()===ImageState.IDLE&&Y.load(),Y.getImageState()===ImageState.LOADING&&(this.patternImage_=Y)}this.color_=O}getKey(){const O=this.getColor();return O?O instanceof CanvasPattern||O instanceof CanvasGradient?getUid(O):typeof O=="object"&&"src"in O?O.src+":"+O.offset:asArray(O).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Stroke{constructor(O){O=O||{},this.color_=O.color!==void 0?O.color:null,this.lineCap_=O.lineCap,this.lineDash_=O.lineDash!==void 0?O.lineDash:null,this.lineDashOffset_=O.lineDashOffset,this.lineJoin_=O.lineJoin,this.miterLimit_=O.miterLimit,this.width_=O.width}clone(){const O=this.getColor();return new Stroke({color:Array.isArray(O)?O.slice():O||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(O){this.color_=O}setLineCap(O){this.lineCap_=O}setLineDash(O){this.lineDash_=O}setLineDashOffset(O){this.lineDashOffset_=O}setLineJoin(O){this.lineJoin_=O}setMiterLimit(O){this.miterLimit_=O}setWidth(O){this.width_=O}}function hasArea(ee){return ee[0]>0&&ee[1]>0}function scale$1(ee,O,Y){return Y===void 0&&(Y=[0,0]),Y[0]=ee[0]*O+.5|0,Y[1]=ee[1]*O+.5|0,Y}function toSize(ee,O){return Array.isArray(ee)?ee:(O===void 0?O=[ee,ee]:(O[0]=ee,O[1]=ee),O)}class ImageStyle{constructor(O){this.opacity_=O.opacity,this.rotateWithView_=O.rotateWithView,this.rotation_=O.rotation,this.scale_=O.scale,this.scaleArray_=toSize(O.scale),this.displacement_=O.displacement,this.declutterMode_=O.declutterMode}clone(){const O=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(O)?O.slice():O,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return abstract()}getImage(O){return abstract()}getHitDetectionImage(){return abstract()}getPixelRatio(O){return 1}getImageState(){return abstract()}getImageSize(){return abstract()}getOrigin(){return abstract()}getSize(){return abstract()}setDisplacement(O){this.displacement_=O}setOpacity(O){this.opacity_=O}setRotateWithView(O){this.rotateWithView_=O}setRotation(O){this.rotation_=O}setScale(O){this.scale_=O,this.scaleArray_=toSize(O)}listenImageChange(O){abstract()}load(){abstract()}unlistenImageChange(O){abstract()}ready(){return Promise.resolve()}}class RegularShape extends ImageStyle{constructor(O){super({opacity:1,rotateWithView:O.rotateWithView!==void 0?O.rotateWithView:!1,rotation:O.rotation!==void 0?O.rotation:0,scale:O.scale!==void 0?O.scale:1,displacement:O.displacement!==void 0?O.displacement:[0,0],declutterMode:O.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=O.fill!==void 0?O.fill:null,this.origin_=[0,0],this.points_=O.points,this.radius=O.radius,this.radius2_=O.radius2,this.angle_=O.angle!==void 0?O.angle:0,this.stroke_=O.stroke!==void 0?O.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ImageState.LOADING:ImageState.LOADED,this.imageState_===ImageState.LOADING&&this.ready().then(()=>this.imageState_=ImageState.LOADED),this.render()}clone(){const O=this.getScale(),Y=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(O)?O.slice():O,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return Y.setOpacity(this.getOpacity()),Y}getAnchor(){const O=this.size_,Y=this.getDisplacement(),te=this.getScaleArray();return[O[0]/2-Y[0]/te[0],O[1]/2+Y[1]/te[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(O){this.fill_=O,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(O){const Y=this.fill_?.getKey(),te=`${O},${this.angle_},${this.radius},${this.radius2_},${this.points_},${Y}`+Object.values(this.renderOptions_).join(",");let ne=shared.get(te,null,null)?.getImage(1);if(!ne){const xe=this.renderOptions_,et=Math.ceil(xe.size*O),tt=createCanvasContext2D(et,et);this.draw_(xe,tt,O),ne=tt.canvas,shared.set(te,null,null,new IconImage(ne,void 0,null,ImageState.LOADED,null))}return ne}getPixelRatio(O){return O}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(O){this.stroke_=O,this.render()}listenImageChange(O){}load(){}unlistenImageChange(O){}calculateLineJoinSize_(O,Y,te){if(Y===0||this.points_===1/0||O!=="bevel"&&O!=="miter")return Y;let ne=this.radius,xe=this.radius2_===void 0?ne:this.radius2_;if(ne<xe){const bt=ne;ne=xe,xe=bt}const et=this.radius2_===void 0?this.points_:this.points_*2,tt=2*Math.PI/et,it=xe*Math.sin(tt),st=Math.sqrt(xe*xe-it*it),ot=ne-st,rt=Math.sqrt(it*it+ot*ot),nt=rt/it;if(O==="miter"&&nt<=te)return nt*Y;const at=Y/2/nt,ct=Y/2*(ot/rt),dt=Math.sqrt((ne+at)*(ne+at)+ct*ct)-ne;if(this.radius2_===void 0||O==="bevel")return dt*2;const ht=ne*Math.sin(tt),pt=Math.sqrt(ne*ne-ht*ht),ft=xe-pt,yt=Math.sqrt(ht*ht+ft*ft)/ht;if(yt<=te){const bt=yt*Y/2-xe-ne;return 2*Math.max(dt,bt)}return dt*2}createRenderOptions(){let O=defaultLineCap,Y=defaultLineJoin,te=0,ne=null,xe=0,et,tt=0;this.stroke_&&(et=asColorLike(this.stroke_.getColor()??defaultStrokeStyle),tt=this.stroke_.getWidth()??defaultLineWidth,ne=this.stroke_.getLineDash(),xe=this.stroke_.getLineDashOffset()??0,Y=this.stroke_.getLineJoin()??defaultLineJoin,O=this.stroke_.getLineCap()??defaultLineCap,te=this.stroke_.getMiterLimit()??defaultMiterLimit);const it=this.calculateLineJoinSize_(Y,tt,te),st=Math.max(this.radius,this.radius2_||0),ot=Math.ceil(2*st+it);return{strokeStyle:et,strokeWidth:tt,size:ot,lineCap:O,lineDash:ne,lineDashOffset:xe,lineJoin:Y,miterLimit:te}}render(){this.renderOptions_=this.createRenderOptions();const O=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[O,O]}draw_(O,Y,te){if(Y.scale(te,te),Y.translate(O.size/2,O.size/2),this.createPath_(Y),this.fill_){let ne=this.fill_.getColor();ne===null&&(ne=defaultFillStyle),Y.fillStyle=asColorLike(ne),Y.fill()}O.strokeStyle&&(Y.strokeStyle=O.strokeStyle,Y.lineWidth=O.strokeWidth,O.lineDash&&(Y.setLineDash(O.lineDash),Y.lineDashOffset=O.lineDashOffset),Y.lineCap=O.lineCap,Y.lineJoin=O.lineJoin,Y.miterLimit=O.miterLimit,Y.stroke())}createHitDetectionCanvas_(O){let Y;if(this.fill_){let te=this.fill_.getColor(),ne=0;typeof te=="string"&&(te=asArray(te)),te===null?ne=1:Array.isArray(te)&&(ne=te.length===4?te[3]:1),ne===0&&(Y=createCanvasContext2D(O.size,O.size),this.drawHitDetectionCanvas_(O,Y))}return Y?Y.canvas:this.getImage(1)}createPath_(O){let Y=this.points_;const te=this.radius;if(Y===1/0)O.arc(0,0,te,0,2*Math.PI);else{const ne=this.radius2_===void 0?te:this.radius2_;this.radius2_!==void 0&&(Y*=2);const xe=this.angle_-Math.PI/2,et=2*Math.PI/Y;for(let tt=0;tt<Y;tt++){const it=xe+tt*et,st=tt%2===0?te:ne;O.lineTo(st*Math.cos(it),st*Math.sin(it))}O.closePath()}}drawHitDetectionCanvas_(O,Y){Y.translate(O.size/2,O.size/2),this.createPath_(Y),Y.fillStyle=defaultFillStyle,Y.fill(),O.strokeStyle&&(Y.strokeStyle=O.strokeStyle,Y.lineWidth=O.strokeWidth,O.lineDash&&(Y.setLineDash(O.lineDash),Y.lineDashOffset=O.lineDashOffset),Y.lineJoin=O.lineJoin,Y.miterLimit=O.miterLimit,Y.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class CircleStyle extends RegularShape{constructor(O){O=O||{radius:5},super({points:1/0,fill:O.fill,radius:O.radius,stroke:O.stroke,scale:O.scale!==void 0?O.scale:1,rotation:O.rotation!==void 0?O.rotation:0,rotateWithView:O.rotateWithView!==void 0?O.rotateWithView:!1,displacement:O.displacement!==void 0?O.displacement:[0,0],declutterMode:O.declutterMode})}clone(){const O=this.getScale(),Y=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(O)?O.slice():O,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return Y.setOpacity(this.getOpacity()),Y}setRadius(O){this.radius=O,this.render()}}class Style{constructor(O){O=O||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,O.geometry!==void 0&&this.setGeometry(O.geometry),this.fill_=O.fill!==void 0?O.fill:null,this.image_=O.image!==void 0?O.image:null,this.renderer_=O.renderer!==void 0?O.renderer:null,this.hitDetectionRenderer_=O.hitDetectionRenderer!==void 0?O.hitDetectionRenderer:null,this.stroke_=O.stroke!==void 0?O.stroke:null,this.text_=O.text!==void 0?O.text:null,this.zIndex_=O.zIndex}clone(){let O=this.getGeometry();return O&&typeof O=="object"&&(O=O.clone()),new Style({geometry:O??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(O){this.renderer_=O}setHitDetectionRenderer(O){this.hitDetectionRenderer_=O}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(O){this.fill_=O}getImage(){return this.image_}setImage(O){this.image_=O}getStroke(){return this.stroke_}setStroke(O){this.stroke_=O}getText(){return this.text_}setText(O){this.text_=O}getZIndex(){return this.zIndex_}setGeometry(O){typeof O=="function"?this.geometryFunction_=O:typeof O=="string"?this.geometryFunction_=function(Y){return Y.get(O)}:O?O!==void 0&&(this.geometryFunction_=function(){return O}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=O}setZIndex(O){this.zIndex_=O}}function toFunction(ee){let O;if(typeof ee=="function")O=ee;else{let Y;Array.isArray(ee)?Y=ee:(assert(typeof ee.getZIndex=="function","Expected an `Style` or an array of `Style`"),Y=[ee]),O=function(){return Y}}return O}let defaultStyles=null;function createDefaultStyle$1(ee,O){if(!defaultStyles){const Y=new Fill({color:"rgba(255,255,255,0.4)"}),te=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new CircleStyle({fill:Y,stroke:te,radius:5}),fill:Y,stroke:te})]}return defaultStyles}function createEditingStyle(){const ee={},O=[255,255,255,1],Y=[0,153,255,1],te=3;return ee.Polygon=[new Style({fill:new Fill({color:[255,255,255,.5]})})],ee.MultiPolygon=ee.Polygon,ee.LineString=[new Style({stroke:new Stroke({color:O,width:te+2})}),new Style({stroke:new Stroke({color:Y,width:te})})],ee.MultiLineString=ee.LineString,ee.Circle=ee.Polygon.concat(ee.LineString),ee.Point=[new Style({image:new CircleStyle({radius:te*2,fill:new Fill({color:Y}),stroke:new Stroke({color:O,width:te/2})}),zIndex:1/0})],ee.MultiPoint=ee.Point,ee.GeometryCollection=ee.Polygon.concat(ee.LineString,ee.Point),ee}function defaultGeometryFunction(ee){return ee.getGeometry()}const DEFAULT_FILL_COLOR="#333";class Text{constructor(O){O=O||{},this.font_=O.font,this.rotation_=O.rotation,this.rotateWithView_=O.rotateWithView,this.keepUpright_=O.keepUpright,this.scale_=O.scale,this.scaleArray_=toSize(O.scale!==void 0?O.scale:1),this.text_=O.text,this.textAlign_=O.textAlign,this.justify_=O.justify,this.repeat_=O.repeat,this.textBaseline_=O.textBaseline,this.fill_=O.fill!==void 0?O.fill:new Fill({color:DEFAULT_FILL_COLOR}),this.maxAngle_=O.maxAngle!==void 0?O.maxAngle:Math.PI/4,this.placement_=O.placement!==void 0?O.placement:"point",this.overflow_=!!O.overflow,this.stroke_=O.stroke!==void 0?O.stroke:null,this.offsetX_=O.offsetX!==void 0?O.offsetX:0,this.offsetY_=O.offsetY!==void 0?O.offsetY:0,this.backgroundFill_=O.backgroundFill?O.backgroundFill:null,this.backgroundStroke_=O.backgroundStroke?O.backgroundStroke:null,this.padding_=O.padding===void 0?null:O.padding,this.declutterMode_=O.declutterMode}clone(){const O=this.getScale();return new Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(O)?O.slice():O,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Fill?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(O){this.overflow_=O}setFont(O){this.font_=O}setMaxAngle(O){this.maxAngle_=O}setOffsetX(O){this.offsetX_=O}setOffsetY(O){this.offsetY_=O}setPlacement(O){this.placement_=O}setRepeat(O){this.repeat_=O}setRotateWithView(O){this.rotateWithView_=O}setKeepUpright(O){this.keepUpright_=O}setFill(O){this.fill_=O}setRotation(O){this.rotation_=O}setScale(O){this.scale_=O,this.scaleArray_=toSize(O!==void 0?O:1)}setStroke(O){this.stroke_=O}setText(O){this.text_=O}setTextAlign(O){this.textAlign_=O}setJustify(O){this.justify_=O}setTextBaseline(O){this.textBaseline_=O}setBackgroundFill(O){this.backgroundFill_=O}setBackgroundStroke(O){this.backgroundStroke_=O}setPadding(O){this.padding_=O}}const ViewHint={ANIMATING:0,INTERACTING:1},Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH];class CanvasBuilder extends VectorContext{constructor(O,Y,te,ne){super(),this.tolerance=O,this.maxExtent=Y,this.pixelRatio=ne,this.maxLineWidth=0,this.resolution=te,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(O){const Y=this.pixelRatio;return Y==1?O:O.map(function(te){return te*Y})}appendFlatPointCoordinates(O,Y){const te=this.getBufferedMaxExtent(),ne=this.tmpCoordinate_,xe=this.coordinates;let et=xe.length;for(let tt=0,it=O.length;tt<it;tt+=Y)ne[0]=O[tt],ne[1]=O[tt+1],containsCoordinate(te,ne)&&(xe[et++]=ne[0],xe[et++]=ne[1]);return et}appendFlatLineCoordinates(O,Y,te,ne,xe,et){const tt=this.coordinates;let it=tt.length;const st=this.getBufferedMaxExtent();et&&(Y+=ne);let ot=O[Y],rt=O[Y+1];const nt=this.tmpCoordinate_;let at=!0,ct,ut,dt;for(ct=Y+ne;ct<te;ct+=ne)nt[0]=O[ct],nt[1]=O[ct+1],dt=coordinateRelationship(st,nt),dt!==ut?(at&&(tt[it++]=ot,tt[it++]=rt,at=!1),tt[it++]=nt[0],tt[it++]=nt[1]):dt===Relationship.INTERSECTING?(tt[it++]=nt[0],tt[it++]=nt[1],at=!1):at=!0,ot=nt[0],rt=nt[1],ut=dt;return(xe&&at||ct===Y+ne)&&(tt[it++]=ot,tt[it++]=rt),it}drawCustomCoordinates_(O,Y,te,ne,xe){for(let et=0,tt=te.length;et<tt;++et){const it=te[et],st=this.appendFlatLineCoordinates(O,Y,it,ne,!1,!1);xe.push(st),Y=it}return Y}drawCustom(O,Y,te,ne,xe){this.beginGeometry(O,Y,xe);const et=O.getType(),tt=O.getStride(),it=this.coordinates.length;let st,ot,rt,nt,at;switch(et){case"MultiPolygon":st=O.getOrientedFlatCoordinates(),nt=[];const ct=O.getEndss();at=0;for(let ut=0,dt=ct.length;ut<dt;++ut){const ht=[];at=this.drawCustomCoordinates_(st,at,ct[ut],tt,ht),nt.push(ht)}this.instructions.push([Instruction.CUSTOM,it,nt,O,te,inflateMultiCoordinatesArray,xe]),this.hitDetectionInstructions.push([Instruction.CUSTOM,it,nt,O,ne||te,inflateMultiCoordinatesArray,xe]);break;case"Polygon":case"MultiLineString":rt=[],st=et=="Polygon"?O.getOrientedFlatCoordinates():O.getFlatCoordinates(),at=this.drawCustomCoordinates_(st,0,O.getEnds(),tt,rt),this.instructions.push([Instruction.CUSTOM,it,rt,O,te,inflateCoordinatesArray,xe]),this.hitDetectionInstructions.push([Instruction.CUSTOM,it,rt,O,ne||te,inflateCoordinatesArray,xe]);break;case"LineString":case"Circle":st=O.getFlatCoordinates(),ot=this.appendFlatLineCoordinates(st,0,st.length,tt,!1,!1),this.instructions.push([Instruction.CUSTOM,it,ot,O,te,inflateCoordinates,xe]),this.hitDetectionInstructions.push([Instruction.CUSTOM,it,ot,O,ne||te,inflateCoordinates,xe]);break;case"MultiPoint":st=O.getFlatCoordinates(),ot=this.appendFlatPointCoordinates(st,tt),ot>it&&(this.instructions.push([Instruction.CUSTOM,it,ot,O,te,inflateCoordinates,xe]),this.hitDetectionInstructions.push([Instruction.CUSTOM,it,ot,O,ne||te,inflateCoordinates,xe]));break;case"Point":st=O.getFlatCoordinates(),this.coordinates.push(st[0],st[1]),ot=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,it,ot,O,te,void 0,xe]),this.hitDetectionInstructions.push([Instruction.CUSTOM,it,ot,O,ne||te,void 0,xe]);break}this.endGeometry(Y)}beginGeometry(O,Y,te){this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,Y,0,O,te],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,Y,0,O,te],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const O=this.hitDetectionInstructions;O.reverse();let Y;const te=O.length;let ne,xe,et=-1;for(Y=0;Y<te;++Y)ne=O[Y],xe=ne[0],xe==Instruction.END_GEOMETRY?et=Y:xe==Instruction.BEGIN_GEOMETRY&&(ne[2]=Y,reverseSubArray(this.hitDetectionInstructions,et,Y),et=-1)}fillStyleToState(O,Y={}){if(O){const te=O.getColor();Y.fillPatternScale=te&&typeof te=="object"&&"src"in te?this.pixelRatio:1,Y.fillStyle=asColorLike(te||defaultFillStyle)}else Y.fillStyle=void 0;return Y}strokeStyleToState(O,Y={}){if(O){const te=O.getColor();Y.strokeStyle=asColorLike(te||defaultStrokeStyle);const ne=O.getLineCap();Y.lineCap=ne!==void 0?ne:defaultLineCap;const xe=O.getLineDash();Y.lineDash=xe?xe.slice():defaultLineDash;const et=O.getLineDashOffset();Y.lineDashOffset=et||defaultLineDashOffset;const tt=O.getLineJoin();Y.lineJoin=tt!==void 0?tt:defaultLineJoin;const it=O.getWidth();Y.lineWidth=it!==void 0?it:defaultLineWidth;const st=O.getMiterLimit();Y.miterLimit=st!==void 0?st:defaultMiterLimit,Y.lineWidth>this.maxLineWidth&&(this.maxLineWidth=Y.lineWidth,this.bufferedMaxExtent_=null)}else Y.strokeStyle=void 0,Y.lineCap=void 0,Y.lineDash=null,Y.lineDashOffset=void 0,Y.lineJoin=void 0,Y.lineWidth=void 0,Y.miterLimit=void 0;return Y}setFillStrokeStyle(O,Y){const te=this.state;this.fillStyleToState(O,te),this.strokeStyleToState(Y,te)}createFill(O){const Y=O.fillStyle,te=[Instruction.SET_FILL_STYLE,Y];return typeof Y!="string"&&te.push(O.fillPatternScale),te}applyStroke(O){this.instructions.push(this.createStroke(O))}createStroke(O){return[Instruction.SET_STROKE_STYLE,O.strokeStyle,O.lineWidth*this.pixelRatio,O.lineCap,O.lineJoin,O.miterLimit,O.lineDash?this.applyPixelRatio(O.lineDash):null,O.lineDashOffset*this.pixelRatio]}updateFillStyle(O,Y){const te=O.fillStyle;(typeof te!="string"||O.currentFillStyle!=te)&&(this.instructions.push(Y.call(this,O)),O.currentFillStyle=te)}updateStrokeStyle(O,Y){const te=O.strokeStyle,ne=O.lineCap,xe=O.lineDash,et=O.lineDashOffset,tt=O.lineJoin,it=O.lineWidth,st=O.miterLimit;(O.currentStrokeStyle!=te||O.currentLineCap!=ne||xe!=O.currentLineDash&&!equals$2(O.currentLineDash,xe)||O.currentLineDashOffset!=et||O.currentLineJoin!=tt||O.currentLineWidth!=it||O.currentMiterLimit!=st)&&(Y.call(this,O),O.currentStrokeStyle=te,O.currentLineCap=ne,O.currentLineDash=xe,O.currentLineDashOffset=et,O.currentLineJoin=tt,O.currentLineWidth=it,O.currentMiterLimit=st)}endGeometry(O){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const Y=[Instruction.END_GEOMETRY,O];this.instructions.push(Y),this.hitDetectionInstructions.push(Y)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){const O=this.resolution*(this.maxLineWidth+1)/2;buffer$1(this.bufferedMaxExtent_,O,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class CanvasImageBuilder extends CanvasBuilder{constructor(O,Y,te,ne){super(O,Y,te,ne),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(O,Y,te){if(!this.image_||this.maxExtent&&!containsCoordinate(this.maxExtent,O.getFlatCoordinates()))return;this.beginGeometry(O,Y,te);const ne=O.getFlatCoordinates(),xe=O.getStride(),et=this.coordinates.length,tt=this.appendFlatPointCoordinates(ne,xe);this.instructions.push([Instruction.DRAW_IMAGE,et,tt,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,et,tt,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(Y)}drawMultiPoint(O,Y,te){if(!this.image_)return;this.beginGeometry(O,Y,te);const ne=O.getFlatCoordinates(),xe=[];for(let it=0,st=ne.length;it<st;it+=O.getStride())(!this.maxExtent||containsCoordinate(this.maxExtent,ne.slice(it,it+2)))&&xe.push(ne[it],ne[it+1]);const et=this.coordinates.length,tt=this.appendFlatPointCoordinates(xe,2);this.instructions.push([Instruction.DRAW_IMAGE,et,tt,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,et,tt,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(Y)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(O,Y){const te=O.getAnchor(),ne=O.getSize(),xe=O.getOrigin();this.imagePixelRatio_=O.getPixelRatio(this.pixelRatio),this.anchorX_=te[0],this.anchorY_=te[1],this.hitDetectionImage_=O.getHitDetectionImage(),this.image_=O.getImage(this.pixelRatio),this.height_=ne[1],this.opacity_=O.getOpacity(),this.originX_=xe[0],this.originY_=xe[1],this.rotateWithView_=O.getRotateWithView(),this.rotation_=O.getRotation(),this.scale_=O.getScaleArray(),this.width_=ne[0],this.declutterMode_=O.getDeclutterMode(),this.declutterImageWithText_=Y}}class CanvasLineStringBuilder extends CanvasBuilder{constructor(O,Y,te,ne){super(O,Y,te,ne)}drawFlatCoordinates_(O,Y,te,ne){const xe=this.coordinates.length,et=this.appendFlatLineCoordinates(O,Y,te,ne,!1,!1),tt=[Instruction.MOVE_TO_LINE_TO,xe,et];return this.instructions.push(tt),this.hitDetectionInstructions.push(tt),te}drawLineString(O,Y,te){const ne=this.state,xe=ne.strokeStyle,et=ne.lineWidth;if(xe===void 0||et===void 0)return;this.updateStrokeStyle(ne,this.applyStroke),this.beginGeometry(O,Y,te),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ne.strokeStyle,ne.lineWidth,ne.lineCap,ne.lineJoin,ne.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const tt=O.getFlatCoordinates(),it=O.getStride();this.drawFlatCoordinates_(tt,0,tt.length,it),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(Y)}drawMultiLineString(O,Y,te){const ne=this.state,xe=ne.strokeStyle,et=ne.lineWidth;if(xe===void 0||et===void 0)return;this.updateStrokeStyle(ne,this.applyStroke),this.beginGeometry(O,Y,te),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ne.strokeStyle,ne.lineWidth,ne.lineCap,ne.lineJoin,ne.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const tt=O.getEnds(),it=O.getFlatCoordinates(),st=O.getStride();let ot=0;for(let rt=0,nt=tt.length;rt<nt;++rt)ot=this.drawFlatCoordinates_(it,ot,tt[rt],st);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(Y)}finish(){const O=this.state;return O.lastStroke!=null&&O.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(O){O.lastStroke!=null&&O.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),O.lastStroke=this.coordinates.length),O.lastStroke=0,super.applyStroke(O),this.instructions.push(beginPathInstruction)}}class CanvasPolygonBuilder extends CanvasBuilder{constructor(O,Y,te,ne){super(O,Y,te,ne)}drawFlatCoordinatess_(O,Y,te,ne){const xe=this.state,et=xe.fillStyle!==void 0,tt=xe.strokeStyle!==void 0,it=te.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let st=0;st<it;++st){const ot=te[st],rt=this.coordinates.length,nt=this.appendFlatLineCoordinates(O,Y,ot,ne,!0,!tt),at=[Instruction.MOVE_TO_LINE_TO,rt,nt];this.instructions.push(at),this.hitDetectionInstructions.push(at),tt&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),Y=ot}return et&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),tt&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),Y}drawCircle(O,Y,te){const ne=this.state,xe=ne.fillStyle,et=ne.strokeStyle;if(xe===void 0&&et===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(O,Y,te),ne.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),ne.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ne.strokeStyle,ne.lineWidth,ne.lineCap,ne.lineJoin,ne.miterLimit,defaultLineDash,defaultLineDashOffset]);const tt=O.getFlatCoordinates(),it=O.getStride(),st=this.coordinates.length;this.appendFlatLineCoordinates(tt,0,tt.length,it,!1,!1);const ot=[Instruction.CIRCLE,st];this.instructions.push(beginPathInstruction,ot),this.hitDetectionInstructions.push(beginPathInstruction,ot),ne.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),ne.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(Y)}drawPolygon(O,Y,te){const ne=this.state,xe=ne.fillStyle,et=ne.strokeStyle;if(xe===void 0&&et===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(O,Y,te),ne.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),ne.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ne.strokeStyle,ne.lineWidth,ne.lineCap,ne.lineJoin,ne.miterLimit,defaultLineDash,defaultLineDashOffset]);const tt=O.getEnds(),it=O.getOrientedFlatCoordinates(),st=O.getStride();this.drawFlatCoordinatess_(it,0,tt,st),this.endGeometry(Y)}drawMultiPolygon(O,Y,te){const ne=this.state,xe=ne.fillStyle,et=ne.strokeStyle;if(xe===void 0&&et===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(O,Y,te),ne.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),ne.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,ne.strokeStyle,ne.lineWidth,ne.lineCap,ne.lineJoin,ne.miterLimit,defaultLineDash,defaultLineDashOffset]);const tt=O.getEndss(),it=O.getOrientedFlatCoordinates(),st=O.getStride();let ot=0;for(let rt=0,nt=tt.length;rt<nt;++rt)ot=this.drawFlatCoordinatess_(it,ot,tt[rt],st);this.endGeometry(Y)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const O=this.tolerance;if(O!==0){const Y=this.coordinates;for(let te=0,ne=Y.length;te<ne;++te)Y[te]=snap(Y[te],O)}return super.finish()}setFillStrokeStyles_(){const O=this.state;this.updateFillStyle(O,this.createFill),this.updateStrokeStyle(O,this.applyStroke)}}function lineChunk(ee,O,Y,te,ne){const xe=[];let et=Y,tt=0,it=O.slice(Y,2);for(;tt<ee&&et+ne<te;){const[st,ot]=it.slice(-2),rt=O[et+ne],nt=O[et+ne+1],at=Math.sqrt((rt-st)*(rt-st)+(nt-ot)*(nt-ot));if(tt+=at,tt>=ee){const ct=(ee-tt+at)/at,ut=lerp$1(st,rt,ct),dt=lerp$1(ot,nt,ct);it.push(ut,dt),xe.push(it),it=[ut,dt],tt==ee&&(et+=ne),tt=0}else if(tt<ee)it.push(O[et+ne],O[et+ne+1]),et+=ne;else{const ct=at-tt,ut=lerp$1(st,rt,ct/at),dt=lerp$1(ot,nt,ct/at);it.push(ut,dt),xe.push(it),it=[ut,dt],tt=0,et+=ne}}return tt>0&&xe.push(it),xe}function matchingChunk(ee,O,Y,te,ne){let xe=Y,et=Y,tt=0,it=0,st=Y,ot,rt,nt,at,ct,ut,dt,ht,pt,ft;for(rt=Y;rt<te;rt+=ne){const mt=O[rt],yt=O[rt+1];ct!==void 0&&(pt=mt-ct,ft=yt-ut,at=Math.sqrt(pt*pt+ft*ft),dt!==void 0&&(it+=nt,ot=Math.acos((dt*pt+ht*ft)/(nt*at)),ot>ee&&(it>tt&&(tt=it,xe=st,et=rt),it=0,st=rt-ne)),nt=at,dt=pt,ht=ft),ct=mt,ut=yt}return it+=at,it>tt?[st,rt]:[xe,et]}const TEXT_ALIGN={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CanvasTextBuilder extends CanvasBuilder{constructor(O,Y,te,ne){super(O,Y,te,ne),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[defaultFillStyle]={fillStyle:defaultFillStyle},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const O=super.finish();return O.textStates=this.textStates,O.fillStates=this.fillStates,O.strokeStates=this.strokeStates,O}drawText(O,Y,te){const ne=this.textFillState_,xe=this.textStrokeState_,et=this.textState_;if(this.text_===""||!et||!ne&&!xe)return;const tt=this.coordinates;let it=tt.length;const st=O.getType();let ot=null,rt=O.getStride();if(et.placement==="line"&&(st=="LineString"||st=="MultiLineString"||st=="Polygon"||st=="MultiPolygon")){if(!intersects$1(this.maxExtent,O.getExtent()))return;let nt;if(ot=O.getFlatCoordinates(),st=="LineString")nt=[ot.length];else if(st=="MultiLineString")nt=O.getEnds();else if(st=="Polygon")nt=O.getEnds().slice(0,1);else if(st=="MultiPolygon"){const dt=O.getEndss();nt=[];for(let ht=0,pt=dt.length;ht<pt;++ht)nt.push(dt[ht][0])}this.beginGeometry(O,Y,te);const at=et.repeat,ct=at?void 0:et.textAlign;let ut=0;for(let dt=0,ht=nt.length;dt<ht;++dt){let pt;at?pt=lineChunk(at*this.resolution,ot,ut,nt[dt],rt):pt=[ot.slice(ut,nt[dt])];for(let ft=0,mt=pt.length;ft<mt;++ft){const yt=pt[ft];let bt=0,vt=yt.length;if(ct==null){const wt=matchingChunk(et.maxAngle,yt,0,yt.length,2);bt=wt[0],vt=wt[1]}for(let wt=bt;wt<vt;wt+=rt)tt.push(yt[wt],yt[wt+1]);const Et=tt.length;ut=nt[dt],this.drawChars_(it,Et),it=Et}}this.endGeometry(Y)}else{let nt=et.overflow?null:[];switch(st){case"Point":case"MultiPoint":ot=O.getFlatCoordinates();break;case"LineString":ot=O.getFlatMidpoint();break;case"Circle":ot=O.getCenter();break;case"MultiLineString":ot=O.getFlatMidpoints(),rt=2;break;case"Polygon":ot=O.getFlatInteriorPoint(),et.overflow||nt.push(ot[2]/this.resolution),rt=3;break;case"MultiPolygon":const mt=O.getFlatInteriorPoints();ot=[];for(let yt=0,bt=mt.length;yt<bt;yt+=3)et.overflow||nt.push(mt[yt+2]/this.resolution),ot.push(mt[yt],mt[yt+1]);if(ot.length===0)return;rt=2;break}const at=this.appendFlatPointCoordinates(ot,rt);if(at===it)return;if(nt&&(at-it)/2!==ot.length/rt){let mt=it/2;nt=nt.filter((yt,bt)=>{const vt=tt[(mt+bt)*2]===ot[bt*rt]&&tt[(mt+bt)*2+1]===ot[bt*rt+1];return vt||--mt,vt})}this.saveTextStates_();const ct=et.backgroundFill?this.createFill(this.fillStyleToState(et.backgroundFill)):null,ut=et.backgroundStroke?this.createStroke(this.strokeStyleToState(et.backgroundStroke)):null;this.beginGeometry(O,Y,te);let dt=et.padding;if(dt!=defaultPadding&&(et.scale[0]<0||et.scale[1]<0)){let mt=et.padding[0],yt=et.padding[1],bt=et.padding[2],vt=et.padding[3];et.scale[0]<0&&(yt=-yt,vt=-vt),et.scale[1]<0&&(mt=-mt,bt=-bt),dt=[mt,yt,bt,vt]}const ht=this.pixelRatio;this.instructions.push([Instruction.DRAW_IMAGE,it,at,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,dt==defaultPadding?defaultPadding:dt.map(function(mt){return mt*ht}),ct,ut,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,nt]);const pt=1/ht,ft=ct?ct.slice(0):null;ft&&(ft[1]=defaultFillStyle),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,it,at,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[pt,pt],NaN,this.declutterMode_,this.declutterImageWithText_,dt,ft,ut,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?defaultFillStyle:this.fillKey_,this.textOffsetX_,this.textOffsetY_,nt]),this.endGeometry(Y)}}saveTextStates_(){const O=this.textStrokeState_,Y=this.textState_,te=this.textFillState_,ne=this.strokeKey_;O&&(ne in this.strokeStates||(this.strokeStates[ne]={strokeStyle:O.strokeStyle,lineCap:O.lineCap,lineDashOffset:O.lineDashOffset,lineWidth:O.lineWidth,lineJoin:O.lineJoin,miterLimit:O.miterLimit,lineDash:O.lineDash}));const xe=this.textKey_;xe in this.textStates||(this.textStates[xe]={font:Y.font,textAlign:Y.textAlign||defaultTextAlign,justify:Y.justify,textBaseline:Y.textBaseline||defaultTextBaseline,scale:Y.scale});const et=this.fillKey_;te&&(et in this.fillStates||(this.fillStates[et]={fillStyle:te.fillStyle}))}drawChars_(O,Y){const te=this.textStrokeState_,ne=this.textState_,xe=this.strokeKey_,et=this.textKey_,tt=this.fillKey_;this.saveTextStates_();const it=this.pixelRatio,st=TEXT_ALIGN[ne.textBaseline],ot=this.textOffsetY_*it,rt=this.text_,nt=te?te.lineWidth*Math.abs(ne.scale[0])/2:0;this.instructions.push([Instruction.DRAW_CHARS,O,Y,st,ne.overflow,tt,ne.maxAngle,it,ot,xe,nt*it,rt,et,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,O,Y,st,ne.overflow,tt&&defaultFillStyle,ne.maxAngle,it,ot,xe,nt*it,rt,et,1/it,this.declutterMode_,this.textKeepUpright_])}setTextStyle(O,Y){let te,ne,xe;if(!O)this.text_="";else{const et=O.getFill();et?(ne=this.textFillState_,ne||(ne={},this.textFillState_=ne),ne.fillStyle=asColorLike(et.getColor()||defaultFillStyle)):(ne=null,this.textFillState_=ne);const tt=O.getStroke();if(!tt)xe=null,this.textStrokeState_=xe;else{xe=this.textStrokeState_,xe||(xe={},this.textStrokeState_=xe);const ut=tt.getLineDash(),dt=tt.getLineDashOffset(),ht=tt.getWidth(),pt=tt.getMiterLimit();xe.lineCap=tt.getLineCap()||defaultLineCap,xe.lineDash=ut?ut.slice():defaultLineDash,xe.lineDashOffset=dt===void 0?defaultLineDashOffset:dt,xe.lineJoin=tt.getLineJoin()||defaultLineJoin,xe.lineWidth=ht===void 0?defaultLineWidth:ht,xe.miterLimit=pt===void 0?defaultMiterLimit:pt,xe.strokeStyle=asColorLike(tt.getColor()||defaultStrokeStyle)}te=this.textState_;const it=O.getFont()||defaultFont;registerFont(it);const st=O.getScaleArray();te.overflow=O.getOverflow(),te.font=it,te.maxAngle=O.getMaxAngle(),te.placement=O.getPlacement(),te.textAlign=O.getTextAlign(),te.repeat=O.getRepeat(),te.justify=O.getJustify(),te.textBaseline=O.getTextBaseline()||defaultTextBaseline,te.backgroundFill=O.getBackgroundFill(),te.backgroundStroke=O.getBackgroundStroke(),te.padding=O.getPadding()||defaultPadding,te.scale=st===void 0?[1,1]:st;const ot=O.getOffsetX(),rt=O.getOffsetY(),nt=O.getRotateWithView(),at=O.getKeepUpright(),ct=O.getRotation();this.text_=O.getText()||"",this.textOffsetX_=ot===void 0?0:ot,this.textOffsetY_=rt===void 0?0:rt,this.textRotateWithView_=nt===void 0?!1:nt,this.textKeepUpright_=at===void 0?!0:at,this.textRotation_=ct===void 0?0:ct,this.strokeKey_=xe?(typeof xe.strokeStyle=="string"?xe.strokeStyle:getUid(xe.strokeStyle))+xe.lineCap+xe.lineDashOffset+"|"+xe.lineWidth+xe.lineJoin+xe.miterLimit+"["+xe.lineDash.join()+"]":"",this.textKey_=te.font+te.scale+(te.textAlign||"?")+(te.repeat||"?")+(te.justify||"?")+(te.textBaseline||"?"),this.fillKey_=ne&&ne.fillStyle?typeof ne.fillStyle=="string"?ne.fillStyle:"|"+getUid(ne.fillStyle):""}this.declutterMode_=O.getDeclutterMode(),this.declutterImageWithText_=Y}}const BATCH_CONSTRUCTORS={Circle:CanvasPolygonBuilder,Default:CanvasBuilder,Image:CanvasImageBuilder,LineString:CanvasLineStringBuilder,Polygon:CanvasPolygonBuilder,Text:CanvasTextBuilder};class BuilderGroup{constructor(O,Y,te,ne){this.tolerance_=O,this.maxExtent_=Y,this.pixelRatio_=ne,this.resolution_=te,this.buildersByZIndex_={}}finish(){const O={};for(const Y in this.buildersByZIndex_){O[Y]=O[Y]||{};const te=this.buildersByZIndex_[Y];for(const ne in te){const xe=te[ne].finish();O[Y][ne]=xe}}return O}getBuilder(O,Y){const te=O!==void 0?O.toString():"0";let ne=this.buildersByZIndex_[te];ne===void 0&&(ne={},this.buildersByZIndex_[te]=ne);let xe=ne[Y];if(xe===void 0){const et=BATCH_CONSTRUCTORS[Y];xe=new et(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),ne[Y]=xe}return xe}}function drawTextOnPath(ee,O,Y,te,ne,xe,et,tt,it,st,ot,rt,nt=!0){let at=ee[O],ct=ee[O+1],ut=0,dt=0,ht=0,pt=0;function ft(){ut=at,dt=ct,O+=te,at=ee[O],ct=ee[O+1],pt+=ht,ht=Math.sqrt((at-ut)*(at-ut)+(ct-dt)*(ct-dt))}do ft();while(O<Y-te&&pt+ht<xe);let mt=ht===0?0:(xe-pt)/ht;const yt=lerp$1(ut,at,mt),bt=lerp$1(dt,ct,mt),vt=O-te,Et=pt,wt=xe+tt*it(st,ne,ot);for(;O<Y-te&&pt+ht<wt;)ft();mt=ht===0?0:(wt-pt)/ht;const St=lerp$1(ut,at,mt),Ot=lerp$1(dt,ct,mt);let $t=!1;if(nt)if(rt){const kt=[yt,bt,St,Ot];rotate(kt,0,4,2,rt,kt,kt),$t=kt[0]>kt[2]}else $t=yt>St;const Mt=Math.PI,Nt=[],Rt=vt+te===O;O=vt,ht=0,pt=Et,at=ee[O],ct=ee[O+1];let Pt;if(Rt){ft(),Pt=Math.atan2(ct-dt,at-ut),$t&&(Pt+=Pt>0?-Mt:Mt);const kt=(St+yt)/2,Wt=(Ot+bt)/2;return Nt[0]=[kt,Wt,(wt-xe)/2,Pt,ne],Nt}ne=ne.replace(/\n/g," ");for(let kt=0,Wt=ne.length;kt<Wt;){ft();let zt=Math.atan2(ct-dt,at-ut);if($t&&(zt+=zt>0?-Mt:Mt),Pt!==void 0){let ln=zt-Pt;if(ln+=ln>Mt?-2*Mt:ln<-Mt?2*Mt:0,Math.abs(ln)>et)return null}Pt=zt;const Kt=kt;let qt=0;for(;kt<Wt;++kt){const ln=$t?Wt-kt-1:kt,dn=tt*it(st,ne[ln],ot);if(O+te<Y&&pt+ht<xe+qt+dn/2)break;qt+=dn}if(kt===Kt)continue;const Xt=$t?ne.substring(Wt-Kt,Wt-kt):ne.substring(Kt,kt);mt=ht===0?0:(xe+qt/2-pt)/ht;const an=lerp$1(ut,at,mt),pn=lerp$1(dt,ct,mt);Nt.push([an,pn,qt/2,zt,Xt]),xe+=qt}return Nt}class ZIndexContext{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(getSharedCanvasContext2D(),{get:(O,Y)=>{if(typeof getSharedCanvasContext2D()[Y]=="function")return this.push_(Y),this.pushMethodArgs_},set:(O,Y,te)=>(this.push_(Y,te),!0)})}push_(...O){const Y=this.instructions_,te=this.zIndex+this.offset_;Y[te]||(Y[te]=[]),Y[te].push(...O)}pushMethodArgs_=(...O)=>(this.push_(O),this);pushFunction(O){this.push_(O)}getContext(){return this.context_}draw(O){this.instructions_.forEach(Y=>{for(let te=0,ne=Y.length;te<ne;++te){const xe=Y[te];if(typeof xe=="function"){xe(O);continue}const et=Y[++te];if(typeof O[xe]=="function")O[xe](...et);else{if(typeof et=="function"){O[xe]=et(O);continue}O[xe]=et}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(ee){return ee[3].declutterBox}const rtlRegEx=new RegExp("[-----]");function horizontalTextAlign(ee,O){return O==="start"?O=rtlRegEx.test(ee)?"right":"left":O==="end"&&(O=rtlRegEx.test(ee)?"left":"right"),TEXT_ALIGN[O]}function createTextChunks(ee,O,Y){return Y>0&&ee.push(`
`,""),ee.push(O,""),ee}function richTextToPlainText(ee,O,Y){return Y%2===0&&(ee+=O),ee}class Executor{constructor(O,Y,te,ne,xe){this.overlaps=te,this.pixelRatio=Y,this.resolution=O,this.alignAndScaleFill_,this.instructions=ne.instructions,this.coordinates=ne.coordinates,this.coordinateCache_={},this.renderedTransform_=create$2(),this.hitDetectionInstructions=ne.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=ne.fillStates||{},this.strokeStates=ne.strokeStates||{},this.textStates=ne.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=xe?new ZIndexContext:null}getZIndexContext(){return this.zIndexContext_}createLabel(O,Y,te,ne){const xe=O+Y+te+ne;if(this.labels_[xe])return this.labels_[xe];const et=ne?this.strokeStates[ne]:null,tt=te?this.fillStates[te]:null,it=this.textStates[Y],st=this.pixelRatio,ot=[it.scale[0]*st,it.scale[1]*st],rt=it.justify?TEXT_ALIGN[it.justify]:horizontalTextAlign(Array.isArray(O)?O[0]:O,it.textAlign||defaultTextAlign),nt=ne&&et.lineWidth?et.lineWidth:0,at=Array.isArray(O)?O:String(O).split(`
`).reduce(createTextChunks,[]),{width:ct,height:ut,widths:dt,heights:ht,lineWidths:pt}=getTextDimensions(it,at),ft=ct+nt,mt=[],yt=(ft+2)*ot[0],bt=(ut+nt)*ot[1],vt={width:yt<0?Math.floor(yt):Math.ceil(yt),height:bt<0?Math.floor(bt):Math.ceil(bt),contextInstructions:mt};(ot[0]!=1||ot[1]!=1)&&mt.push("scale",ot),ne&&(mt.push("strokeStyle",et.strokeStyle),mt.push("lineWidth",nt),mt.push("lineCap",et.lineCap),mt.push("lineJoin",et.lineJoin),mt.push("miterLimit",et.miterLimit),mt.push("setLineDash",[et.lineDash]),mt.push("lineDashOffset",et.lineDashOffset)),te&&mt.push("fillStyle",tt.fillStyle),mt.push("textBaseline","middle"),mt.push("textAlign","center");const Et=.5-rt;let wt=rt*ft+Et*nt;const St=[],Ot=[];let $t=0,Mt=0,Nt=0,Rt=0,Pt;for(let kt=0,Wt=at.length;kt<Wt;kt+=2){const zt=at[kt];if(zt===`
`){Mt+=$t,$t=0,wt=rt*ft+Et*nt,++Rt;continue}const Kt=at[kt+1]||it.font;Kt!==Pt&&(ne&&St.push("font",Kt),te&&Ot.push("font",Kt),Pt=Kt),$t=Math.max($t,ht[Nt]);const qt=[zt,wt+Et*dt[Nt]+rt*(dt[Nt]-pt[Rt]),.5*(nt+$t)+Mt];wt+=dt[Nt],ne&&St.push("strokeText",qt),te&&Ot.push("fillText",qt),++Nt}return Array.prototype.push.apply(mt,St),Array.prototype.push.apply(mt,Ot),this.labels_[xe]=vt,vt}replayTextBackground_(O,Y,te,ne,xe,et,tt){O.beginPath(),O.moveTo.apply(O,Y),O.lineTo.apply(O,te),O.lineTo.apply(O,ne),O.lineTo.apply(O,xe),O.lineTo.apply(O,Y),et&&(this.alignAndScaleFill_=et[2],O.fillStyle=et[1],this.fill_(O)),tt&&(this.setStrokeStyle_(O,tt),O.stroke())}calculateImageOrLabelDimensions_(O,Y,te,ne,xe,et,tt,it,st,ot,rt,nt,at,ct,ut,dt){tt*=nt[0],it*=nt[1];let ht=te-tt,pt=ne-it;const ft=xe+st>O?O-st:xe,mt=et+ot>Y?Y-ot:et,yt=ct[3]+ft*nt[0]+ct[1],bt=ct[0]+mt*nt[1]+ct[2],vt=ht-ct[3],Et=pt-ct[0];(ut||rt!==0)&&(p1[0]=vt,p4[0]=vt,p1[1]=Et,p2[1]=Et,p2[0]=vt+yt,p3[0]=p2[0],p3[1]=Et+bt,p4[1]=p3[1]);let wt;return rt!==0?(wt=compose(create$2(),te,ne,1,1,rt,-te,-ne),apply$1(wt,p1),apply$1(wt,p2),apply$1(wt,p3),apply$1(wt,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min(vt,vt+yt),Math.min(Et,Et+bt),Math.max(vt,vt+yt),Math.max(Et,Et+bt),tmpExtent),at&&(ht=Math.round(ht),pt=Math.round(pt)),{drawImageX:ht,drawImageY:pt,drawImageW:ft,drawImageH:mt,originX:st,originY:ot,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:dt},canvasTransform:wt,scale:nt}}replayImageOrLabel_(O,Y,te,ne,xe,et,tt){const it=!!(et||tt),st=ne.declutterBox,ot=tt?tt[2]*ne.scale[0]/2:0;return st.minX-ot<=Y[0]&&st.maxX+ot>=0&&st.minY-ot<=Y[1]&&st.maxY+ot>=0&&(it&&this.replayTextBackground_(O,p1,p2,p3,p4,et,tt),drawImageOrLabel(O,ne.canvasTransform,xe,te,ne.originX,ne.originY,ne.drawImageW,ne.drawImageH,ne.drawImageX,ne.drawImageY,ne.scale)),!0}fill_(O){const Y=this.alignAndScaleFill_;if(Y){const te=apply$1(this.renderedTransform_,[0,0]),ne=512*this.pixelRatio;O.save(),O.translate(te[0]%ne,te[1]%ne),Y!==1&&O.scale(Y,Y),O.rotate(this.viewRotation_)}O.fill(),Y&&O.restore()}setStrokeStyle_(O,Y){O.strokeStyle=Y[1],Y[1]&&(O.lineWidth=Y[2],O.lineCap=Y[3],O.lineJoin=Y[4],O.miterLimit=Y[5],O.lineDashOffset=Y[7],O.setLineDash(Y[6]))}drawLabelWithPointPlacement_(O,Y,te,ne){const xe=this.textStates[Y],et=this.createLabel(O,Y,ne,te),tt=this.strokeStates[te],it=this.pixelRatio,st=horizontalTextAlign(Array.isArray(O)?O[0]:O,xe.textAlign||defaultTextAlign),ot=TEXT_ALIGN[xe.textBaseline||defaultTextBaseline],rt=tt&&tt.lineWidth?tt.lineWidth:0,nt=et.width/it-2*xe.scale[0],at=st*nt+2*(.5-st)*rt,ct=ot*et.height/it+2*(.5-ot)*rt;return{label:et,anchorX:at,anchorY:ct}}execute_(O,Y,te,ne,xe,et,tt,it){const st=this.zIndexContext_;let ot;this.pixelCoordinates_&&equals$2(te,this.renderedTransform_)?ot=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),ot=transform2D(this.coordinates,0,this.coordinates.length,2,te,this.pixelCoordinates_),setFromArray(this.renderedTransform_,te));let rt=0;const nt=ne.length;let at=0,ct,ut,dt,ht,pt,ft,mt,yt,bt,vt,Et,wt,St,Ot=0,$t=0;const Mt=this.coordinateCache_,Nt=this.viewRotation_,Rt=Math.round(Math.atan2(-te[1],te[0])*1e12)/1e12,Pt={context:O,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Nt},kt=this.instructions!=ne||this.overlaps?0:200;let Wt,zt,Kt,qt;for(;rt<nt;){const Xt=ne[rt];switch(Xt[0]){case Instruction.BEGIN_GEOMETRY:Wt=Xt[1],qt=Xt[3],Wt.getGeometry()?tt!==void 0&&!intersects$1(tt,qt.getExtent())?rt=Xt[2]+1:++rt:rt=Xt[2],st&&(st.zIndex=Xt[4]);break;case Instruction.BEGIN_PATH:Ot>kt&&(this.fill_(O),Ot=0),$t>kt&&(O.stroke(),$t=0),!Ot&&!$t&&(O.beginPath(),pt=NaN,ft=NaN),++rt;break;case Instruction.CIRCLE:at=Xt[1];const pn=ot[at],ln=ot[at+1],dn=ot[at+2],un=ot[at+3],Tn=dn-pn,Sn=un-ln,bn=Math.sqrt(Tn*Tn+Sn*Sn);O.moveTo(pn+bn,ln),O.arc(pn,ln,bn,0,2*Math.PI,!0),++rt;break;case Instruction.CLOSE_PATH:O.closePath(),++rt;break;case Instruction.CUSTOM:at=Xt[1],ct=Xt[2];const on=Xt[3],zn=Xt[4],Ln=Xt[5];Pt.geometry=on,Pt.feature=Wt,rt in Mt||(Mt[rt]=[]);const hn=Mt[rt];Ln?Ln(ot,at,ct,2,hn):(hn[0]=ot[at],hn[1]=ot[at+1],hn.length=2),st&&(st.zIndex=Xt[6]),zn(hn,Pt),++rt;break;case Instruction.DRAW_IMAGE:at=Xt[1],ct=Xt[2],bt=Xt[3],ut=Xt[4],dt=Xt[5];let Hn=Xt[6];const Wn=Xt[7],Gn=Xt[8],gr=Xt[9],Qn=Xt[10];let sr=Xt[11];const cr=Xt[12];let On=Xt[13];ht=Xt[14]||"declutter";const kn=Xt[15];if(!bt&&Xt.length>=20){vt=Xt[19],Et=Xt[20],wt=Xt[21],St=Xt[22];const _n=this.drawLabelWithPointPlacement_(vt,Et,wt,St);bt=_n.label,Xt[3]=bt;const Sr=Xt[23];ut=(_n.anchorX-Sr)*this.pixelRatio,Xt[4]=ut;const pr=Xt[24];dt=(_n.anchorY-pr)*this.pixelRatio,Xt[5]=dt,Hn=bt.height,Xt[6]=Hn,On=bt.width,Xt[13]=On}let br;Xt.length>25&&(br=Xt[25]);let mn,jn,Un;Xt.length>17?(mn=Xt[16],jn=Xt[17],Un=Xt[18]):(mn=defaultPadding,jn=null,Un=null),Qn&&Rt?sr+=Nt:!Qn&&!Rt&&(sr-=Nt);let qn=0;for(;at<ct;at+=2){if(br&&br[qn++]<On/this.pixelRatio)continue;const _n=this.calculateImageOrLabelDimensions_(bt.width,bt.height,ot[at],ot[at+1],On,Hn,ut,dt,Gn,gr,sr,cr,xe,mn,!!jn||!!Un,Wt),Sr=[O,Y,bt,_n,Wn,jn,Un];if(it){let pr,wr,_r;if(kn){const nr=ct-at;if(!kn[nr]){kn[nr]={args:Sr,declutterMode:ht};continue}const ir=kn[nr];pr=ir.args,wr=ir.declutterMode,delete kn[nr],_r=getDeclutterBox(pr)}let Cr,Ar;if(pr&&(wr!=="declutter"||!it.collides(_r))&&(Cr=!0),(ht!=="declutter"||!it.collides(_n.declutterBox))&&(Ar=!0),wr==="declutter"&&ht==="declutter"){const nr=Cr&&Ar;Cr=nr,Ar=nr}Cr&&(wr!=="none"&&it.insert(_r),this.replayImageOrLabel_.apply(this,pr)),Ar&&(ht!=="none"&&it.insert(_n.declutterBox),this.replayImageOrLabel_.apply(this,Sr))}else this.replayImageOrLabel_.apply(this,Sr)}++rt;break;case Instruction.DRAW_CHARS:const er=Xt[1],Pn=Xt[2],Rn=Xt[3],Dn=Xt[4];St=Xt[5];const or=Xt[6],yn=Xt[7],ur=Xt[8];wt=Xt[9];const dr=Xt[10];vt=Xt[11],Array.isArray(vt)&&(vt=vt.reduce(richTextToPlainText,"")),Et=Xt[12];const Vn=[Xt[13],Xt[13]];ht=Xt[14]||"declutter";const Kn=Xt[15],wn=this.textStates[Et],ar=wn.font,Jn=[wn.scale[0]*yn,wn.scale[1]*yn];let hr;ar in this.widths_?hr=this.widths_[ar]:(hr={},this.widths_[ar]=hr);const An=lineStringLength(ot,er,Pn,2),xn=Math.abs(Jn[0])*measureAndCacheTextWidth(ar,vt,hr);if(Dn||xn<=An){const _n=this.textStates[Et].textAlign,Sr=(An-xn)*horizontalTextAlign(vt,_n),pr=drawTextOnPath(ot,er,Pn,2,vt,Sr,or,Math.abs(Jn[0]),measureAndCacheTextWidth,ar,hr,Rt?0:this.viewRotation_,Kn);e:if(pr){const wr=[];let _r,Cr,Ar,nr,ir;if(wt)for(_r=0,Cr=pr.length;_r<Cr;++_r){ir=pr[_r],Ar=ir[4],nr=this.createLabel(Ar,Et,"",wt),ut=ir[2]+(Jn[0]<0?-dr:dr),dt=Rn*nr.height+(.5-Rn)*2*dr*Jn[1]/Jn[0]-ur;const vr=this.calculateImageOrLabelDimensions_(nr.width,nr.height,ir[0],ir[1],nr.width,nr.height,ut,dt,0,0,ir[3],Vn,!1,defaultPadding,!1,Wt);if(it&&ht==="declutter"&&it.collides(vr.declutterBox))break e;wr.push([O,Y,nr,vr,1,null,null])}if(St)for(_r=0,Cr=pr.length;_r<Cr;++_r){ir=pr[_r],Ar=ir[4],nr=this.createLabel(Ar,Et,St,""),ut=ir[2],dt=Rn*nr.height-ur;const vr=this.calculateImageOrLabelDimensions_(nr.width,nr.height,ir[0],ir[1],nr.width,nr.height,ut,dt,0,0,ir[3],Vn,!1,defaultPadding,!1,Wt);if(it&&ht==="declutter"&&it.collides(vr.declutterBox))break e;wr.push([O,Y,nr,vr,1,null,null])}it&&ht!=="none"&&it.load(wr.map(getDeclutterBox));for(let vr=0,Lr=wr.length;vr<Lr;++vr)this.replayImageOrLabel_.apply(this,wr[vr])}}++rt;break;case Instruction.END_GEOMETRY:if(et!==void 0){Wt=Xt[1];const _n=et(Wt,qt,ht);if(_n)return _n}++rt;break;case Instruction.FILL:kt?Ot++:this.fill_(O),++rt;break;case Instruction.MOVE_TO_LINE_TO:for(at=Xt[1],ct=Xt[2],zt=ot[at],Kt=ot[at+1],O.moveTo(zt,Kt),pt=zt+.5|0,ft=Kt+.5|0,at+=2;at<ct;at+=2)zt=ot[at],Kt=ot[at+1],mt=zt+.5|0,yt=Kt+.5|0,(at==ct-2||mt!==pt||yt!==ft)&&(O.lineTo(zt,Kt),pt=mt,ft=yt);++rt;break;case Instruction.SET_FILL_STYLE:this.alignAndScaleFill_=Xt[2],Ot&&(this.fill_(O),Ot=0,$t&&(O.stroke(),$t=0)),O.fillStyle=Xt[1],++rt;break;case Instruction.SET_STROKE_STYLE:$t&&(O.stroke(),$t=0),this.setStrokeStyle_(O,Xt),++rt;break;case Instruction.STROKE:kt?$t++:O.stroke(),++rt;break;default:++rt;break}}Ot&&this.fill_(O),$t&&O.stroke()}execute(O,Y,te,ne,xe,et){this.viewRotation_=ne,this.execute_(O,Y,te,this.instructions,xe,void 0,void 0,et)}executeHitDetection(O,Y,te,ne,xe){return this.viewRotation_=te,this.execute_(O,[O.canvas.width,O.canvas.height],Y,this.hitDetectionInstructions,!0,ne,xe)}}const ALL=["Polygon","Circle","LineString","Image","Text","Default"],DECLUTTER=["Image","Text"],NON_DECLUTTER=ALL.filter(ee=>!DECLUTTER.includes(ee));class ExecutorGroup{constructor(O,Y,te,ne,xe,et,tt){this.maxExtent_=O,this.overlaps_=ne,this.pixelRatio_=te,this.resolution_=Y,this.renderBuffer_=et,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create$2(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(xe,tt)}clip(O,Y){const te=this.getClipCoords(Y);O.beginPath(),O.moveTo(te[0],te[1]),O.lineTo(te[2],te[3]),O.lineTo(te[4],te[5]),O.lineTo(te[6],te[7]),O.clip()}createExecutors_(O,Y){for(const te in O){let ne=this.executorsByZIndex_[te];ne===void 0&&(ne={},this.executorsByZIndex_[te]=ne);const xe=O[te];for(const et in xe){const tt=xe[et];ne[et]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,tt,Y)}}}hasExecutors(O){for(const Y in this.executorsByZIndex_){const te=this.executorsByZIndex_[Y];for(let ne=0,xe=O.length;ne<xe;++ne)if(O[ne]in te)return!0}return!1}forEachFeatureAtCoordinate(O,Y,te,ne,xe,et){ne=Math.round(ne);const tt=ne*2+1,it=compose(this.hitDetectionTransform_,ne+.5,ne+.5,1/Y,-1/Y,-te,-O[0],-O[1]),st=!this.hitDetectionContext_;st&&(this.hitDetectionContext_=createCanvasContext2D(tt,tt));const ot=this.hitDetectionContext_;ot.canvas.width!==tt||ot.canvas.height!==tt?(ot.canvas.width=tt,ot.canvas.height=tt):st||ot.clearRect(0,0,tt,tt);let rt;this.renderBuffer_!==void 0&&(rt=createEmpty(),extendCoordinate(rt,O),buffer$1(rt,Y*(this.renderBuffer_+ne),rt));const nt=getPixelIndexArray(ne);let at;function ct(yt,bt,vt){const Et=ot.getImageData(0,0,tt,tt).data;for(let wt=0,St=nt.length;wt<St;wt++)if(Et[nt[wt]]>0){if(!et||vt==="none"||at!=="Image"&&at!=="Text"||et.includes(yt)){const Ot=(nt[wt]-3)/4,$t=ne-Ot%tt,Mt=ne-(Ot/tt|0),Nt=xe(yt,bt,$t*$t+Mt*Mt);if(Nt)return Nt}ot.clearRect(0,0,tt,tt);break}}const ut=Object.keys(this.executorsByZIndex_).map(Number);ut.sort(ascending);let dt,ht,pt,ft,mt;for(dt=ut.length-1;dt>=0;--dt){const yt=ut[dt].toString();for(pt=this.executorsByZIndex_[yt],ht=ALL.length-1;ht>=0;--ht)if(at=ALL[ht],ft=pt[at],ft!==void 0&&(mt=ft.executeHitDetection(ot,it,te,ct,rt),mt))return mt}}getClipCoords(O){const Y=this.maxExtent_;if(!Y)return null;const te=Y[0],ne=Y[1],xe=Y[2],et=Y[3],tt=[te,ne,te,et,xe,et,xe,ne];return transform2D(tt,0,8,2,O,tt),tt}isEmpty(){return isEmpty$1(this.executorsByZIndex_)}execute(O,Y,te,ne,xe,et,tt){const it=Object.keys(this.executorsByZIndex_).map(Number);it.sort(tt?descending:ascending),et=et||ALL;const st=ALL.length;for(let ot=0,rt=it.length;ot<rt;++ot){const nt=it[ot].toString(),at=this.executorsByZIndex_[nt];for(let ct=0,ut=et.length;ct<ut;++ct){const dt=et[ct],ht=at[dt];if(ht!==void 0){const pt=tt===null?void 0:ht.getZIndexContext(),ft=pt?pt.getContext():O,mt=this.maxExtent_&&dt!=="Image"&&dt!=="Text";if(mt&&(ft.save(),this.clip(ft,te)),!pt||dt==="Text"||dt==="Image"?ht.execute(ft,Y,te,ne,xe,tt):pt.pushFunction(yt=>ht.execute(yt,Y,te,ne,xe,tt)),mt&&ft.restore(),pt){pt.offset();const yt=it[ot]*st+ALL.indexOf(dt);this.deferredZIndexContexts_[yt]||(this.deferredZIndexContexts_[yt]=[]),this.deferredZIndexContexts_[yt].push(pt)}}}}this.renderedContext_=O}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const O=this.deferredZIndexContexts_,Y=Object.keys(O).map(Number).sort(ascending);for(let te=0,ne=Y.length;te<ne;++te)O[Y[te]].forEach(xe=>{xe.draw(this.renderedContext_),xe.clear()}),O[Y[te]].length=0}}const circlePixelIndexArrayCache={};function getPixelIndexArray(ee){if(circlePixelIndexArrayCache[ee]!==void 0)return circlePixelIndexArrayCache[ee];const O=ee*2+1,Y=ee*ee,te=new Array(Y+1);for(let xe=0;xe<=ee;++xe)for(let et=0;et<=ee;++et){const tt=xe*xe+et*et;if(tt>Y)break;let it=te[tt];it||(it=[],te[tt]=it),it.push(((ee+xe)*O+(ee+et))*4+3),xe>0&&it.push(((ee-xe)*O+(ee+et))*4+3),et>0&&(it.push(((ee+xe)*O+(ee-et))*4+3),xe>0&&it.push(((ee-xe)*O+(ee-et))*4+3))}const ne=[];for(let xe=0,et=te.length;xe<et;++xe)te[xe]&&ne.push(...te[xe]);return circlePixelIndexArrayCache[ee]=ne,ne}function calculateScale(ee,O,Y,te){return Y!==void 0&&te!==void 0?[Y/ee,te/O]:Y!==void 0?Y/ee:te!==void 0?te/O:1}class Icon extends ImageStyle{constructor(O){O=O||{};const Y=O.opacity!==void 0?O.opacity:1,te=O.rotation!==void 0?O.rotation:0,ne=O.scale!==void 0?O.scale:1,xe=O.rotateWithView!==void 0?O.rotateWithView:!1;super({opacity:Y,rotation:te,scale:ne,displacement:O.displacement!==void 0?O.displacement:[0,0],rotateWithView:xe,declutterMode:O.declutterMode}),this.anchor_=O.anchor!==void 0?O.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=O.anchorOrigin!==void 0?O.anchorOrigin:"top-left",this.anchorXUnits_=O.anchorXUnits!==void 0?O.anchorXUnits:"fraction",this.anchorYUnits_=O.anchorYUnits!==void 0?O.anchorYUnits:"fraction",this.crossOrigin_=O.crossOrigin!==void 0?O.crossOrigin:null;const et=O.img!==void 0?O.img:null;let tt=O.src;assert(!(tt!==void 0&&et),"`image` and `src` cannot be provided at the same time"),(tt===void 0||tt.length===0)&&et&&(tt=et.src||getUid(et)),assert(tt!==void 0&&tt.length>0,"A defined and non-empty `src` or `image` must be provided"),assert(!((O.width!==void 0||O.height!==void 0)&&O.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let it;if(O.src!==void 0?it=ImageState.IDLE:et!==void 0&&("complete"in et?et.complete?it=et.src?ImageState.LOADED:ImageState.IDLE:it=ImageState.LOADING:it=ImageState.LOADED),this.color_=O.color!==void 0?asArray(O.color):null,this.iconImage_=get$1(et,tt,this.crossOrigin_,it,this.color_),this.offset_=O.offset!==void 0?O.offset:[0,0],this.offsetOrigin_=O.offsetOrigin!==void 0?O.offsetOrigin:"top-left",this.origin_=null,this.size_=O.size!==void 0?O.size:null,this.initialOptions_,O.width!==void 0||O.height!==void 0){let st,ot;if(O.size)[st,ot]=O.size;else{const rt=this.getImage(1);if(rt.width&&rt.height)st=rt.width,ot=rt.height;else if(rt instanceof HTMLImageElement){this.initialOptions_=O;const nt=()=>{if(this.unlistenImageChange(nt),!this.initialOptions_)return;const at=this.iconImage_.getSize();this.setScale(calculateScale(at[0],at[1],O.width,O.height))};this.listenImageChange(nt);return}}st!==void 0&&this.setScale(calculateScale(st,ot,O.width,O.height))}}clone(){let O,Y,te;return this.initialOptions_?(Y=this.initialOptions_.width,te=this.initialOptions_.height):(O=this.getScale(),O=Array.isArray(O)?O.slice():O),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:O,width:Y,height:te,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let O=this.normalizedAnchor_;if(!O){O=this.anchor_;const ne=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!ne)return null;O=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(O[0]*=ne[0]),this.anchorYUnits_=="fraction"&&(O[1]*=ne[1])}if(this.anchorOrigin_!="top-left"){if(!ne)return null;O===this.anchor_&&(O=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(O[0]=-O[0]+ne[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(O[1]=-O[1]+ne[1])}this.normalizedAnchor_=O}const Y=this.getDisplacement(),te=this.getScaleArray();return[O[0]-Y[0]/te[0],O[1]+Y[1]/te[1]]}setAnchor(O){this.anchor_=O,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(O){return this.iconImage_.getImage(O)}getPixelRatio(O){return this.iconImage_.getPixelRatio(O)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let O=this.offset_;if(this.offsetOrigin_!="top-left"){const Y=this.getSize(),te=this.iconImage_.getSize();if(!Y||!te)return null;O=O.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(O[0]=te[0]-Y[0]-O[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(O[1]=te[1]-Y[1]-O[1])}return this.origin_=O,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(O){this.iconImage_=get$1(null,O,this.crossOrigin_,ImageState.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const O=this.getScaleArray();if(this.size_)return this.size_[0]*O[0];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[0]*O[0]}getHeight(){const O=this.getScaleArray();if(this.size_)return this.size_[1]*O[1];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[1]*O[1]}setScale(O){delete this.initialOptions_,super.setScale(O)}listenImageChange(O){this.iconImage_.addEventListener(EventType.CHANGE,O)}load(){this.iconImage_.load()}unlistenImageChange(O){this.iconImage_.removeEventListener(EventType.CHANGE,O)}ready(){return this.iconImage_.ready()}}const style=Object.freeze(Object.defineProperty({__proto__:null,Circle:CircleStyle,Fill,Icon,IconImage,Image:ImageStyle,RegularShape,Stroke,Style,Text},Symbol.toStringTag,{value:"Module"})),HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(ee,O,Y,te,ne,xe,et,tt,it){const st=it?toUserExtent(ne,it):ne,ot=ee[0]*HIT_DETECT_RESOLUTION,rt=ee[1]*HIT_DETECT_RESOLUTION,nt=createCanvasContext2D(ot,rt);nt.imageSmoothingEnabled=!1;const at=nt.canvas,ct=new CanvasImmediateRenderer(nt,HIT_DETECT_RESOLUTION,ne,null,et,tt,it?getTransformFromProjections(getUserProjection(),it):null),ut=Y.length,dt=Math.floor((256*256*256-1)/ut),ht={};for(let ft=1;ft<=ut;++ft){const mt=Y[ft-1],yt=mt.getStyleFunction()||te;if(!yt)continue;let bt=yt(mt,xe);if(!bt)continue;Array.isArray(bt)||(bt=[bt]);const Et=(ft*dt).toString(16).padStart(7,"#00000");for(let wt=0,St=bt.length;wt<St;++wt){const Ot=bt[wt],$t=Ot.getGeometryFunction()(mt);if(!$t||!intersects$1(st,$t.getExtent()))continue;const Mt=Ot.clone(),Nt=Mt.getFill();Nt&&Nt.setColor(Et);const Rt=Mt.getStroke();Rt&&(Rt.setColor(Et),Rt.setLineDash(null)),Mt.setText(void 0);const Pt=Ot.getImage();if(Pt){const Kt=Pt.getImageSize();if(!Kt)continue;const qt=createCanvasContext2D(Kt[0],Kt[1],void 0,{alpha:!1}),Xt=qt.canvas;qt.fillStyle=Et,qt.fillRect(0,0,Xt.width,Xt.height),Mt.setImage(new Icon({img:Xt,anchor:Pt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Pt.getOrigin(),opacity:1,size:Pt.getSize(),scale:Pt.getScale(),rotation:Pt.getRotation(),rotateWithView:Pt.getRotateWithView()}))}const kt=Mt.getZIndex()||0;let Wt=ht[kt];Wt||(Wt={},ht[kt]=Wt,Wt.Polygon=[],Wt.Circle=[],Wt.LineString=[],Wt.Point=[]);const zt=$t.getType();if(zt==="GeometryCollection"){const Kt=$t.getGeometriesArrayRecursive();for(let qt=0,Xt=Kt.length;qt<Xt;++qt){const an=Kt[qt];Wt[an.getType().replace("Multi","")].push(an,Mt)}}else Wt[zt.replace("Multi","")].push($t,Mt)}}const pt=Object.keys(ht).map(Number).sort(ascending);for(let ft=0,mt=pt.length;ft<mt;++ft){const yt=ht[pt[ft]];for(const bt in yt){const vt=yt[bt];for(let Et=0,wt=vt.length;Et<wt;Et+=2){ct.setStyle(vt[Et+1]);for(let St=0,Ot=O.length;St<Ot;++St)ct.setTransform(O[St]),ct.drawGeometry(vt[Et])}}}return nt.getImageData(0,0,at.width,at.height)}function hitDetect(ee,O,Y){const te=[];if(Y){const ne=Math.floor(Math.round(ee[0])*HIT_DETECT_RESOLUTION),xe=Math.floor(Math.round(ee[1])*HIT_DETECT_RESOLUTION),et=(clamp$1(ne,0,Y.width-1)+clamp$1(xe,0,Y.height-1)*Y.width)*4,tt=Y.data[et],it=Y.data[et+1],ot=Y.data[et+2]+256*(it+256*tt),rt=Math.floor((256*256*256-1)/O.length);ot&&ot%rt===0&&te.push(O[ot/rt-1])}return te}class RenderEvent extends BaseEvent{constructor(O,Y,te,ne){super(O),this.inversePixelTransform=Y,this.frameState=te,this.context=ne}}const maxStaleKeys=5;class LayerRenderer extends Observable{constructor(O){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=O,this.staleKeys_=new Array,this.maxStaleKeys=maxStaleKeys}getStaleKeys(){return this.staleKeys_}prependStaleKey(O){this.staleKeys_.unshift(O),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(O){return abstract()}getData(O){return null}prepareFrame(O){return abstract()}renderFrame(O,Y){return abstract()}forEachFeatureAtCoordinate(O,Y,te,ne,xe){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(O){const Y=O.target;(Y.getState()===ImageState.LOADED||Y.getState()===ImageState.ERROR)&&this.renderIfReadyAndVisible()}loadImage(O){let Y=O.getState();return Y!=ImageState.LOADED&&Y!=ImageState.ERROR&&O.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),Y==ImageState.IDLE&&(O.load(),Y=O.getState()),Y==ImageState.LOADED}renderIfReadyAndVisible(){const O=this.getLayer();O&&O.getVisible()&&O.getSourceState()==="ready"&&O.changed()}renderDeferred(O){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const canvasPool$2=[];let pixelContext$1=null;function createPixelContext$1(){pixelContext$1=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class CanvasLayerRenderer extends LayerRenderer{constructor(O){super(O),this.container=null,this.renderedResolution,this.tempTransform=create$2(),this.pixelTransform=create$2(),this.inversePixelTransform=create$2(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(O,Y,te){pixelContext$1||createPixelContext$1(),pixelContext$1.clearRect(0,0,1,1);let ne;try{pixelContext$1.drawImage(O,Y,te,1,1,0,0,1,1),ne=pixelContext$1.getImageData(0,0,1,1).data}catch{return pixelContext$1=null,null}return ne}getBackground(O){let te=this.getLayer().getBackground();return typeof te=="function"&&(te=te(O.viewState.resolution)),te||void 0}useContainer(O,Y,te){const ne=this.getLayer().getClassName();let xe,et;if(O&&O.className===ne&&(!te||O&&O.style.backgroundColor&&equals$2(asArray(O.style.backgroundColor),asArray(te)))){const tt=O.firstElementChild;isCanvas(tt)&&(et=tt.getContext("2d"))}if(et&&equivalent(et.canvas.style.transform,Y)?(this.container=O,this.context=et,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){xe=WORKER_OFFSCREEN_CANVAS?createMockDiv():document.createElement("div"),xe.className=ne;let tt=xe.style;tt.position="absolute",tt.width="100%",tt.height="100%",et=createCanvasContext2D();const it=et.canvas;xe.appendChild(it),tt=it.style,tt.position="absolute",tt.left="0",tt.transformOrigin="top left",this.container=xe,this.context=et}!this.containerReused&&te&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=te)}clipUnrotated(O,Y,te){const ne=getTopLeft(te),xe=getTopRight(te),et=getBottomRight(te),tt=getBottomLeft(te);apply$1(Y.coordinateToPixelTransform,ne),apply$1(Y.coordinateToPixelTransform,xe),apply$1(Y.coordinateToPixelTransform,et),apply$1(Y.coordinateToPixelTransform,tt);const it=this.inversePixelTransform;apply$1(it,ne),apply$1(it,xe),apply$1(it,et),apply$1(it,tt),O.save(),O.beginPath(),O.moveTo(Math.round(ne[0]),Math.round(ne[1])),O.lineTo(Math.round(xe[0]),Math.round(xe[1])),O.lineTo(Math.round(et[0]),Math.round(et[1])),O.lineTo(Math.round(tt[0]),Math.round(tt[1])),O.clip()}prepareContainer(O,Y){const te=O.extent,ne=O.viewState.resolution,xe=O.viewState.rotation,et=O.pixelRatio,tt=Math.round(getWidth(te)/ne*et),it=Math.round(getHeight(te)/ne*et);compose(this.pixelTransform,O.size[0]/2,O.size[1]/2,1/et,1/et,xe,-tt/2,-it/2),makeInverse(this.inversePixelTransform,this.pixelTransform);const st=toString$1(this.pixelTransform);if(this.useContainer(Y,st,this.getBackground(O)),!this.containerReused){const ot=this.context.canvas;ot.width!=tt||ot.height!=it?(ot.width=tt,ot.height=it):this.context.clearRect(0,0,tt,it),st!==ot.style.transform&&(ot.style.transform=st)}}dispatchRenderEvent_(O,Y,te){const ne=this.getLayer();if(ne.hasListener(O)){const xe=new RenderEvent(O,this.inversePixelTransform,te,Y);ne.dispatchEvent(xe)}}preRender(O,Y){this.frameState=Y,!Y.declutter&&this.dispatchRenderEvent_(RenderEventType.PRERENDER,O,Y)}postRender(O,Y){Y.declutter||this.dispatchRenderEvent_(RenderEventType.POSTRENDER,O,Y)}renderDeferredInternal(O){}getRenderContext(O){return O.declutter&&!this.deferredContext_&&(this.deferredContext_=new ZIndexContext),O.declutter?this.deferredContext_.getContext():this.context}renderDeferred(O){O.declutter&&(this.dispatchRenderEvent_(RenderEventType.PRERENDER,this.context,O),O.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(O),this.dispatchRenderEvent_(RenderEventType.POSTRENDER,this.context,O))}getRenderTransform(O,Y,te,ne,xe,et,tt){const it=xe/2,st=et/2,ot=ne/Y,rt=-ot,nt=-O[0]+tt,at=-O[1];return compose(this.tempTransform,it,st,ot,rt,-te,nt,at)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class CanvasVectorLayerRenderer extends CanvasLayerRenderer{constructor(O){super(O),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=createEmpty(),this.wrappedRenderedExtent_=createEmpty(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(O,Y,te){const ne=Y.extent,xe=Y.viewState,et=xe.center,tt=xe.resolution,it=xe.projection,st=xe.rotation,ot=it.getExtent(),rt=this.getLayer().getSource(),nt=this.getLayer().getDeclutter(),at=Y.pixelRatio,ct=Y.viewHints,ut=!(ct[ViewHint.ANIMATING]||ct[ViewHint.INTERACTING]),dt=this.context,ht=Math.round(getWidth(ne)/tt*at),pt=Math.round(getHeight(ne)/tt*at),ft=rt.getWrapX()&&it.canWrapX(),mt=ft?getWidth(ot):null,yt=ft?Math.ceil((ne[2]-ot[2])/mt)+1:1;let bt=ft?Math.floor((ne[0]-ot[0])/mt):0;do{let vt=this.getRenderTransform(et,tt,0,at,ht,pt,bt*mt);Y.declutter&&(vt=vt.slice(0)),O.execute(dt,[dt.canvas.width,dt.canvas.height],vt,st,ut,te===void 0?ALL:te?DECLUTTER:NON_DECLUTTER,te?nt&&Y.declutter[nt]:void 0)}while(++bt<yt)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=createCanvasContext2D(this.context.canvas.width,this.context.canvas.height,canvasPool$2))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const O=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=O,releaseCanvas$1(this.context),canvasPool$2.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(O){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,O,!0)}renderDeferredInternal(O){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(O,Y){const te=O.layerStatesArray[O.layerIndex];this.opacity_=te.opacity;const ne=O.viewState;this.prepareContainer(O,Y);const xe=this.context,et=this.replayGroup_;let tt=et&&!et.isEmpty();if(!tt&&!(this.getLayer().hasListener(RenderEventType.PRERENDER)||this.getLayer().hasListener(RenderEventType.POSTRENDER)))return this.container;this.setDrawContext_(),this.preRender(xe,O);const it=ne.projection;if(this.clipped_=!1,tt&&te.extent&&this.clipping){const st=fromUserExtent(te.extent,it);tt=intersects$1(st,O.extent),this.clipped_=tt&&!containsExtent(st,O.extent),this.clipped_&&this.clipUnrotated(xe,O,st)}return tt&&this.renderWorlds(et,O,this.getLayer().getDeclutter()?!1:void 0),!O.declutter&&this.clipped_&&xe.restore(),this.postRender(xe,O),this.renderedRotation_!==ne.rotation&&(this.renderedRotation_=ne.rotation,this.hitDetectionImageData_=null),O.declutter||this.resetDrawContext_(),this.container}getFeatures(O){return new Promise(Y=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const te=this.frameState.size.slice(),ne=this.renderedCenter_,xe=this.renderedResolution_,et=this.renderedRotation_,tt=this.renderedProjection_,it=this.wrappedRenderedExtent_,st=this.getLayer(),ot=[],rt=te[0]*HIT_DETECT_RESOLUTION,nt=te[1]*HIT_DETECT_RESOLUTION;ot.push(this.getRenderTransform(ne,xe,et,HIT_DETECT_RESOLUTION,rt,nt,0).slice());const at=st.getSource(),ct=tt.getExtent();if(at.getWrapX()&&tt.canWrapX()&&!containsExtent(ct,it)){let dt=it[0];const ht=getWidth(ct);let pt=0,ft;for(;dt<ct[0];)--pt,ft=ht*pt,ot.push(this.getRenderTransform(ne,xe,et,HIT_DETECT_RESOLUTION,rt,nt,ft).slice()),dt+=ht;for(pt=0,dt=it[2];dt>ct[2];)++pt,ft=ht*pt,ot.push(this.getRenderTransform(ne,xe,et,HIT_DETECT_RESOLUTION,rt,nt,ft).slice()),dt-=ht}const ut=getUserProjection();this.hitDetectionImageData_=createHitDetectionImageData(te,ot,this.renderedFeatures_,st.getStyleFunction(),it,xe,et,getSquaredTolerance(xe,this.renderedPixelRatio_),ut?tt:null)}Y(hitDetect(O,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(O,Y,te,ne,xe){if(!this.replayGroup_)return;const et=Y.viewState.resolution,tt=Y.viewState.rotation,it=this.getLayer(),st={},ot=function(nt,at,ct){const ut=getUid(nt),dt=st[ut];if(dt){if(dt!==!0&&ct<dt.distanceSq){if(ct===0)return st[ut]=!0,xe.splice(xe.lastIndexOf(dt),1),ne(nt,it,at);dt.geometry=at,dt.distanceSq=ct}}else{if(ct===0)return st[ut]=!0,ne(nt,it,at);xe.push(st[ut]={feature:nt,layer:it,geometry:at,distanceSq:ct,callback:ne})}},rt=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(O,et,tt,te,ot,rt?Y.declutter?.[rt]?.all().map(nt=>nt.value):null)}handleFontsChanged(){const O=this.getLayer();O.getVisible()&&this.replayGroup_&&O.changed()}handleStyleImageChange_(O){this.renderIfReadyAndVisible()}prepareFrame(O){const Y=this.getLayer(),te=Y.getSource();if(!te)return!1;const ne=O.viewHints[ViewHint.ANIMATING],xe=O.viewHints[ViewHint.INTERACTING],et=Y.getUpdateWhileAnimating(),tt=Y.getUpdateWhileInteracting();if(this.ready&&!et&&ne||!tt&&xe)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const it=O.extent,st=O.viewState,ot=st.projection,rt=st.resolution,nt=O.pixelRatio,at=Y.getRevision(),ct=Y.getRenderBuffer();let ut=Y.getRenderOrder();ut===void 0&&(ut=defaultOrder);const dt=st.center.slice(),ht=buffer$1(it,ct*rt),pt=ht.slice(),ft=[ht.slice()],mt=ot.getExtent();if(te.getWrapX()&&ot.canWrapX()&&!containsExtent(mt,O.extent)){const Rt=getWidth(mt),Pt=Math.max(getWidth(ht)/2,Rt);ht[0]=mt[0]-Pt,ht[2]=mt[2]+Pt,wrapX$1(dt,ot);const kt=wrapX$2(ft[0],ot);kt[0]<mt[0]&&kt[2]<mt[2]?ft.push([kt[0]+Rt,kt[1],kt[2]+Rt,kt[3]]):kt[0]>mt[0]&&kt[2]>mt[2]&&ft.push([kt[0]-Rt,kt[1],kt[2]-Rt,kt[3]])}if(this.ready&&this.renderedResolution_==rt&&this.renderedRevision_==at&&this.renderedRenderOrder_==ut&&this.renderedFrameDeclutter_===!!O.declutter&&containsExtent(this.wrappedRenderedExtent_,ht))return equals$2(this.renderedExtent_,pt)||(this.hitDetectionImageData_=null,this.renderedExtent_=pt),this.renderedCenter_=dt,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const yt=new BuilderGroup(getTolerance(rt,nt),ht,rt,nt),bt=getUserProjection();let vt;if(bt){for(let Rt=0,Pt=ft.length;Rt<Pt;++Rt){const kt=ft[Rt],Wt=toUserExtent(kt,ot);te.loadFeatures(Wt,toUserResolution(rt,ot),bt)}vt=getTransformFromProjections(bt,ot)}else for(let Rt=0,Pt=ft.length;Rt<Pt;++Rt)te.loadFeatures(ft[Rt],rt,ot);const Et=getSquaredTolerance(rt,nt);let wt=!0;const St=(Rt,Pt)=>{let kt;const Wt=Rt.getStyleFunction()||Y.getStyleFunction();if(Wt&&(kt=Wt(Rt,rt)),kt){const zt=this.renderFeature(Rt,Et,kt,yt,vt,this.getLayer().getDeclutter(),Pt);wt=wt&&!zt}},Ot=toUserExtent(ht,ot),$t=te.getFeaturesInExtent(Ot);ut&&$t.sort(ut);for(let Rt=0,Pt=$t.length;Rt<Pt;++Rt)St($t[Rt],Rt);this.renderedFeatures_=$t,this.ready=wt;const Mt=yt.finish(),Nt=new ExecutorGroup(ht,rt,nt,te.getOverlaps(),Mt,Y.getRenderBuffer(),!!O.declutter);return this.renderedResolution_=rt,this.renderedRevision_=at,this.renderedRenderOrder_=ut,this.renderedFrameDeclutter_=!!O.declutter,this.renderedExtent_=pt,this.wrappedRenderedExtent_=ht,this.renderedCenter_=dt,this.renderedProjection_=ot,this.renderedPixelRatio_=nt,this.replayGroup_=Nt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(O,Y,te,ne,xe,et,tt){if(!te)return!1;let it=!1;if(Array.isArray(te))for(let st=0,ot=te.length;st<ot;++st)it=renderFeature$1(ne,O,te[st],Y,this.boundHandleStyleImageChange_,xe,et,tt)||it;else it=renderFeature$1(ne,O,te,Y,this.boundHandleStyleImageChange_,xe,et,tt);return it}}let numTypes=0;const BooleanType$1=1<<numTypes++,NumberType$1=1<<numTypes++,StringType$1=1<<numTypes++,ColorType$1=1<<numTypes++,NumberArrayType$1=1<<numTypes++,SizeType=1<<numTypes++,AnyType=Math.pow(2,numTypes)-1,typeNames={[BooleanType$1]:"boolean",[NumberType$1]:"number",[StringType$1]:"string",[ColorType$1]:"color",[NumberArrayType$1]:"number[]",[SizeType]:"size"},namedTypes=Object.keys(typeNames).map(Number).sort(ascending);function isSpecific(ee){return ee in typeNames}function typeName(ee){const O=[];for(const Y of namedTypes)includesType(ee,Y)&&O.push(typeNames[Y]);return O.length===0?"untyped":O.length<3?O.join(" or "):O.slice(0,-1).join(", ")+", or "+O[O.length-1]}function includesType(ee,O){return(ee&O)===O}function isType(ee,O){return ee===O}class LiteralExpression{constructor(O,Y){if(!isSpecific(O))throw new Error(`literal expressions must have a specific type, got ${typeName(O)}`);this.type=O,this.value=Y}}class CallExpression{constructor(O,Y,...te){this.type=O,this.operator=Y,this.args=te}}function newParsingContext(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function parse$1(ee,O,Y){switch(typeof ee){case"boolean":{if(isType(O,StringType$1))return new LiteralExpression(StringType$1,ee?"true":"false");if(!includesType(O,BooleanType$1))throw new Error(`got a boolean, but expected ${typeName(O)}`);return new LiteralExpression(BooleanType$1,ee)}case"number":{if(isType(O,SizeType))return new LiteralExpression(SizeType,toSize(ee));if(isType(O,BooleanType$1))return new LiteralExpression(BooleanType$1,!!ee);if(isType(O,StringType$1))return new LiteralExpression(StringType$1,ee.toString());if(!includesType(O,NumberType$1))throw new Error(`got a number, but expected ${typeName(O)}`);return new LiteralExpression(NumberType$1,ee)}case"string":{if(isType(O,ColorType$1))return new LiteralExpression(ColorType$1,fromString(ee));if(isType(O,BooleanType$1))return new LiteralExpression(BooleanType$1,!!ee);if(!includesType(O,StringType$1))throw new Error(`got a string, but expected ${typeName(O)}`);return new LiteralExpression(StringType$1,ee)}}if(!Array.isArray(ee))throw new Error("expression must be an array or a primitive value");if(ee.length===0)throw new Error("empty expression");if(typeof ee[0]=="string")return parseCallExpression(ee,O,Y);for(const te of ee)if(typeof te!="number")throw new Error("expected an array of numbers");if(isType(O,SizeType)){if(ee.length!==2)throw new Error(`expected an array of two values for a size, got ${ee.length}`);return new LiteralExpression(SizeType,ee)}if(isType(O,ColorType$1)){if(ee.length===3)return new LiteralExpression(ColorType$1,[...ee,1]);if(ee.length===4)return new LiteralExpression(ColorType$1,ee);throw new Error(`expected an array of 3 or 4 values for a color, got ${ee.length}`)}if(!includesType(O,NumberArrayType$1))throw new Error(`got an array of numbers, but expected ${typeName(O)}`);return new LiteralExpression(NumberArrayType$1,ee)}const Ops={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},parsers={[Ops.Get]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Var]:createCallExpressionParser(hasArgsCount(1,1),withVarArgs),[Ops.Has]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Id]:createCallExpressionParser(usesFeatureId,withNoArgs),[Ops.Concat]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(StringType$1)),[Ops.GeometryType]:createCallExpressionParser(usesGeometryType,withNoArgs),[Ops.LineMetric]:createCallExpressionParser(withNoArgs),[Ops.Resolution]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Zoom]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Time]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Any]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType$1)),[Ops.All]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType$1)),[Ops.Not]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType$1)),[Ops.Equal]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.NotEqual]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.GreaterThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.GreaterThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.LessThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.LessThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Multiply]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Coalesce]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Divide]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Add]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(NumberType$1)),[Ops.Subtract]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Clamp]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType$1)),[Ops.Mod]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Pow]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType$1)),[Ops.Abs]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Floor]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Ceil]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Round]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Sin]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Cos]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Atan]:createCallExpressionParser(hasArgsCount(1,2),withArgsOfType(NumberType$1)),[Ops.Sqrt]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType$1)),[Ops.Match]:createCallExpressionParser(hasArgsCount(4,1/0),hasEvenArgs,withMatchArgs),[Ops.Between]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType$1)),[Ops.Interpolate]:createCallExpressionParser(hasArgsCount(6,1/0),hasEvenArgs,withInterpolateArgs),[Ops.Case]:createCallExpressionParser(hasArgsCount(3,1/0),hasOddArgs,withCaseArgs),[Ops.In]:createCallExpressionParser(hasArgsCount(2,2),withInArgs),[Ops.Number]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.String]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.Array]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(NumberType$1)),[Ops.Color]:createCallExpressionParser(hasArgsCount(1,4),withArgsOfType(NumberType$1)),[Ops.Band]:createCallExpressionParser(hasArgsCount(1,3),withArgsOfType(NumberType$1)),[Ops.Palette]:createCallExpressionParser(hasArgsCount(2,2),withPaletteArgs),[Ops.ToString]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType$1|NumberType$1|StringType$1|ColorType$1))};function withGetArgs(ee,O,Y){const te=ee.length-1,ne=new Array(te);for(let xe=0;xe<te;++xe){const et=ee[xe+1];switch(typeof et){case"number":{ne[xe]=new LiteralExpression(NumberType$1,et);break}case"string":{ne[xe]=new LiteralExpression(StringType$1,et);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${et}`)}xe===0&&Y.properties.add(String(et))}return ne}function withVarArgs(ee,O,Y){const te=ee[1];if(typeof te!="string")throw new Error("expected a string argument for var operation");return Y.variables.add(te),[new LiteralExpression(StringType$1,te)]}function usesFeatureId(ee,O,Y){Y.featureId=!0}function usesGeometryType(ee,O,Y){Y.geometryType=!0}function usesMapState(ee,O,Y){Y.mapState=!0}function withNoArgs(ee,O,Y){const te=ee[0];if(ee.length!==1)throw new Error(`expected no arguments for ${te} operation`);return[]}function hasArgsCount(ee,O){return function(Y,te,ne){const xe=Y[0],et=Y.length-1;if(ee===O){if(et!==ee){const tt=ee===1?"":"s";throw new Error(`expected ${ee} argument${tt} for ${xe}, got ${et}`)}}else if(et<ee||et>O){const tt=O===1/0?`${ee} or more`:`${ee} to ${O}`;throw new Error(`expected ${tt} arguments for ${xe}, got ${et}`)}}}function withArgsOfReturnType(ee,O,Y){const te=ee.length-1,ne=new Array(te);for(let xe=0;xe<te;++xe){const et=parse$1(ee[xe+1],O,Y);ne[xe]=et}return ne}function withArgsOfType(ee){return function(O,Y,te){const ne=O.length-1,xe=new Array(ne);for(let et=0;et<ne;++et){const tt=parse$1(O[et+1],ee,te);xe[et]=tt}return xe}}function hasOddArgs(ee,O,Y){const te=ee[0],ne=ee.length-1;if(ne%2===0)throw new Error(`expected an odd number of arguments for ${te}, got ${ne} instead`)}function hasEvenArgs(ee,O,Y){const te=ee[0],ne=ee.length-1;if(ne%2===1)throw new Error(`expected an even number of arguments for operation ${te}, got ${ne} instead`)}function withMatchArgs(ee,O,Y){const te=ee.length-1,ne=StringType$1|NumberType$1|BooleanType$1,xe=parse$1(ee[1],ne,Y),et=parse$1(ee[ee.length-1],O,Y),tt=new Array(te-2);for(let it=0;it<te-2;it+=2){try{const st=parse$1(ee[it+2],xe.type,Y);tt[it]=st}catch(st){throw new Error(`failed to parse argument ${it+1} of match expression: ${st.message}`)}try{const st=parse$1(ee[it+3],et.type,Y);tt[it+1]=st}catch(st){throw new Error(`failed to parse argument ${it+2} of match expression: ${st.message}`)}}return[xe,...tt,et]}function withInterpolateArgs(ee,O,Y){const te=ee[1];let ne;switch(te[0]){case"linear":ne=1;break;case"exponential":const it=te[1];if(typeof it!="number"||it<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(it)} instead`);ne=it;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(te)}`)}const xe=new LiteralExpression(NumberType$1,ne);let et;try{et=parse$1(ee[2],NumberType$1,Y)}catch(it){throw new Error(`failed to parse argument 1 in interpolate expression: ${it.message}`)}const tt=new Array(ee.length-3);for(let it=0;it<tt.length;it+=2){try{const st=parse$1(ee[it+3],NumberType$1,Y);tt[it]=st}catch(st){throw new Error(`failed to parse argument ${it+2} for interpolate expression: ${st.message}`)}try{const st=parse$1(ee[it+4],O,Y);tt[it+1]=st}catch(st){throw new Error(`failed to parse argument ${it+3} for interpolate expression: ${st.message}`)}}return[xe,et,...tt]}function withCaseArgs(ee,O,Y){const te=parse$1(ee[ee.length-1],O,Y),ne=new Array(ee.length-1);for(let xe=0;xe<ne.length-1;xe+=2){try{const et=parse$1(ee[xe+1],BooleanType$1,Y);ne[xe]=et}catch(et){throw new Error(`failed to parse argument ${xe} of case expression: ${et.message}`)}try{const et=parse$1(ee[xe+2],te.type,Y);ne[xe+1]=et}catch(et){throw new Error(`failed to parse argument ${xe+1} of case expression: ${et.message}`)}}return ne[ne.length-1]=te,ne}function withInArgs(ee,O,Y){let te=ee[2];if(!Array.isArray(te))throw new Error('the second argument for the "in" operator must be an array');let ne;if(typeof te[0]=="string"){if(te[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(te[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');te=te[1],ne=StringType$1}else ne=NumberType$1;const xe=new Array(te.length);for(let tt=0;tt<xe.length;tt++)try{const it=parse$1(te[tt],ne,Y);xe[tt]=it}catch(it){throw new Error(`failed to parse haystack item ${tt} for "in" expression: ${it.message}`)}return[parse$1(ee[1],ne,Y),...xe]}function withPaletteArgs(ee,O,Y){let te;try{te=parse$1(ee[1],NumberType$1,Y)}catch(et){throw new Error(`failed to parse first argument in palette expression: ${et.message}`)}const ne=ee[2];if(!Array.isArray(ne))throw new Error("the second argument of palette must be an array");const xe=new Array(ne.length);for(let et=0;et<xe.length;et++){let tt;try{tt=parse$1(ne[et],ColorType$1,Y)}catch(it){throw new Error(`failed to parse color at index ${et} in palette expression: ${it.message}`)}if(!(tt instanceof LiteralExpression))throw new Error(`the palette color at index ${et} must be a literal value`);xe[et]=tt}return[te,...xe]}function createCallExpressionParser(...ee){return function(O,Y,te){const ne=O[0];let xe;for(let et=0;et<ee.length;et++){const tt=ee[et](O,Y,te);if(et==ee.length-1){if(!tt)throw new Error("expected last argument validator to return the parsed args");xe=tt}}return new CallExpression(Y,ne,...xe)}}function parseCallExpression(ee,O,Y){const te=ee[0],ne=parsers[te];if(!ne)throw new Error(`unknown operator: ${te}`);return ne(ee,O,Y)}function computeGeometryType(ee){if(!ee)return"";const O=ee.getType();switch(O){case"Point":case"LineString":case"Polygon":return O;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return O.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return computeGeometryType(ee.getGeometries()[0]);default:return""}}function newEvaluationContext(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function buildExpression$1(ee,O,Y){const te=parse$1(ee,O,Y);return compileExpression(te)}function compileExpression(ee,O){if(ee instanceof LiteralExpression){if(ee.type===ColorType$1&&typeof ee.value=="string"){const te=fromString(ee.value);return function(){return te}}return function(){return ee.value}}const Y=ee.operator;switch(Y){case Ops.Number:case Ops.String:case Ops.Coalesce:return compileAssertionExpression(ee);case Ops.Get:case Ops.Var:case Ops.Has:return compileAccessorExpression(ee);case Ops.Id:return te=>te.featureId;case Ops.GeometryType:return te=>te.geometryType;case Ops.Concat:{const te=ee.args.map(ne=>compileExpression(ne));return ne=>"".concat(...te.map(xe=>xe(ne).toString()))}case Ops.Resolution:return te=>te.resolution;case Ops.Any:case Ops.All:case Ops.Between:case Ops.In:case Ops.Not:return compileLogicalExpression(ee);case Ops.Equal:case Ops.NotEqual:case Ops.LessThan:case Ops.LessThanOrEqualTo:case Ops.GreaterThan:case Ops.GreaterThanOrEqualTo:return compileComparisonExpression(ee);case Ops.Multiply:case Ops.Divide:case Ops.Add:case Ops.Subtract:case Ops.Clamp:case Ops.Mod:case Ops.Pow:case Ops.Abs:case Ops.Floor:case Ops.Ceil:case Ops.Round:case Ops.Sin:case Ops.Cos:case Ops.Atan:case Ops.Sqrt:return compileNumericExpression(ee);case Ops.Case:return compileCaseExpression(ee);case Ops.Match:return compileMatchExpression(ee);case Ops.Interpolate:return compileInterpolateExpression(ee);case Ops.ToString:return compileConvertExpression(ee);default:throw new Error(`Unsupported operator ${Y}`)}}function compileAssertionExpression(ee,O){const Y=ee.operator,te=ee.args.length,ne=new Array(te);for(let xe=0;xe<te;++xe)ne[xe]=compileExpression(ee.args[xe]);switch(Y){case Ops.Coalesce:return xe=>{for(let et=0;et<te;++et){const tt=ne[et](xe);if(typeof tt<"u"&&tt!==null)return tt}throw new Error("Expected one of the values to be non-null")};case Ops.Number:case Ops.String:return xe=>{for(let et=0;et<te;++et){const tt=ne[et](xe);if(typeof tt===Y)return tt}throw new Error(`Expected one of the values to be a ${Y}`)};default:throw new Error(`Unsupported assertion operator ${Y}`)}}function compileAccessorExpression(ee,O){const te=ee.args[0].value;switch(ee.operator){case Ops.Get:return ne=>{const xe=ee.args;let et=ne.properties[te];for(let tt=1,it=xe.length;tt<it;++tt){const ot=xe[tt].value;et=et[ot]}return et};case Ops.Var:return ne=>ne.variables[te];case Ops.Has:return ne=>{const xe=ee.args;if(!(te in ne.properties))return!1;let et=ne.properties[te];for(let tt=1,it=xe.length;tt<it;++tt){const ot=xe[tt].value;if(!et||!Object.hasOwn(et,ot))return!1;et=et[ot]}return!0};default:throw new Error(`Unsupported accessor operator ${ee.operator}`)}}function compileComparisonExpression(ee,O){const Y=ee.operator,te=compileExpression(ee.args[0]),ne=compileExpression(ee.args[1]);switch(Y){case Ops.Equal:return xe=>te(xe)===ne(xe);case Ops.NotEqual:return xe=>te(xe)!==ne(xe);case Ops.LessThan:return xe=>te(xe)<ne(xe);case Ops.LessThanOrEqualTo:return xe=>te(xe)<=ne(xe);case Ops.GreaterThan:return xe=>te(xe)>ne(xe);case Ops.GreaterThanOrEqualTo:return xe=>te(xe)>=ne(xe);default:throw new Error(`Unsupported comparison operator ${Y}`)}}function compileLogicalExpression(ee,O){const Y=ee.operator,te=ee.args.length,ne=new Array(te);for(let xe=0;xe<te;++xe)ne[xe]=compileExpression(ee.args[xe]);switch(Y){case Ops.Any:return xe=>{for(let et=0;et<te;++et)if(ne[et](xe))return!0;return!1};case Ops.All:return xe=>{for(let et=0;et<te;++et)if(!ne[et](xe))return!1;return!0};case Ops.Between:return xe=>{const et=ne[0](xe),tt=ne[1](xe),it=ne[2](xe);return et>=tt&&et<=it};case Ops.In:return xe=>{const et=ne[0](xe);for(let tt=1;tt<te;++tt)if(et===ne[tt](xe))return!0;return!1};case Ops.Not:return xe=>!ne[0](xe);default:throw new Error(`Unsupported logical operator ${Y}`)}}function compileNumericExpression(ee,O){const Y=ee.operator,te=ee.args.length,ne=new Array(te);for(let xe=0;xe<te;++xe)ne[xe]=compileExpression(ee.args[xe]);switch(Y){case Ops.Multiply:return xe=>{let et=1;for(let tt=0;tt<te;++tt)et*=ne[tt](xe);return et};case Ops.Divide:return xe=>ne[0](xe)/ne[1](xe);case Ops.Add:return xe=>{let et=0;for(let tt=0;tt<te;++tt)et+=ne[tt](xe);return et};case Ops.Subtract:return xe=>ne[0](xe)-ne[1](xe);case Ops.Clamp:return xe=>{const et=ne[0](xe),tt=ne[1](xe);if(et<tt)return tt;const it=ne[2](xe);return et>it?it:et};case Ops.Mod:return xe=>ne[0](xe)%ne[1](xe);case Ops.Pow:return xe=>Math.pow(ne[0](xe),ne[1](xe));case Ops.Abs:return xe=>Math.abs(ne[0](xe));case Ops.Floor:return xe=>Math.floor(ne[0](xe));case Ops.Ceil:return xe=>Math.ceil(ne[0](xe));case Ops.Round:return xe=>Math.round(ne[0](xe));case Ops.Sin:return xe=>Math.sin(ne[0](xe));case Ops.Cos:return xe=>Math.cos(ne[0](xe));case Ops.Atan:return te===2?xe=>Math.atan2(ne[0](xe),ne[1](xe)):xe=>Math.atan(ne[0](xe));case Ops.Sqrt:return xe=>Math.sqrt(ne[0](xe));default:throw new Error(`Unsupported numeric operator ${Y}`)}}function compileCaseExpression(ee,O){const Y=ee.args.length,te=new Array(Y);for(let ne=0;ne<Y;++ne)te[ne]=compileExpression(ee.args[ne]);return ne=>{for(let xe=0;xe<Y-1;xe+=2)if(te[xe](ne))return te[xe+1](ne);return te[Y-1](ne)}}function compileMatchExpression(ee,O){const Y=ee.args.length,te=new Array(Y);for(let ne=0;ne<Y;++ne)te[ne]=compileExpression(ee.args[ne]);return ne=>{const xe=te[0](ne);for(let et=1;et<Y-1;et+=2)if(xe===te[et](ne))return te[et+1](ne);return te[Y-1](ne)}}function compileInterpolateExpression(ee,O){const Y=ee.args.length,te=new Array(Y);for(let ne=0;ne<Y;++ne)te[ne]=compileExpression(ee.args[ne]);return ne=>{const xe=te[0](ne),et=te[1](ne);let tt,it;for(let st=2;st<Y;st+=2){const ot=te[st](ne);let rt=te[st+1](ne);const nt=Array.isArray(rt);if(nt&&(rt=withAlpha(rt)),ot>=et)return st===2?rt:nt?interpolateColor(xe,et,tt,it,ot,rt):interpolateNumber$1(xe,et,tt,it,ot,rt);tt=ot,it=rt}return it}}function compileConvertExpression(ee,O){const Y=ee.operator,te=ee.args.length,ne=new Array(te);for(let xe=0;xe<te;++xe)ne[xe]=compileExpression(ee.args[xe]);switch(Y){case Ops.ToString:return xe=>{const et=ne[0](xe);return ee.args[0].type===ColorType$1?toString(et):et.toString()};default:throw new Error(`Unsupported convert operator ${Y}`)}}function interpolateNumber$1(ee,O,Y,te,ne,xe){const et=ne-Y;if(et===0)return te;const tt=O-Y,it=ee===1?tt/et:(Math.pow(ee,tt)-1)/(Math.pow(ee,et)-1);return te+it*(xe-te)}function interpolateColor(ee,O,Y,te,ne,xe){if(ne-Y===0)return te;const tt=rgbaToLcha(te),it=rgbaToLcha(xe);let st=it[2]-tt[2];st>180?st-=360:st<-180&&(st+=360);const ot=[interpolateNumber$1(ee,O,Y,tt[0],ne,it[0]),interpolateNumber$1(ee,O,Y,tt[1],ne,it[1]),tt[2]+interpolateNumber$1(ee,O,Y,0,ne,st),interpolateNumber$1(ee,O,Y,te[3],ne,xe[3])];return lchaToRgba(ot)}function always$1(ee){return!0}function rulesToStyleFunction(ee){const O=newParsingContext(),Y=buildRuleSet(ee,O),te=newEvaluationContext();return function(ne,xe){if(te.properties=ne.getPropertiesInternal(),te.resolution=xe,O.featureId){const et=ne.getId();et!==void 0?te.featureId=et:te.featureId=null}return O.geometryType&&(te.geometryType=computeGeometryType(ne.getGeometry())),Y(te)}}function flatStylesToStyleFunction(ee){const O=newParsingContext(),Y=ee.length,te=new Array(Y);for(let et=0;et<Y;++et)te[et]=buildStyle(ee[et],O);const ne=newEvaluationContext(),xe=new Array(Y);return function(et,tt){if(ne.properties=et.getPropertiesInternal(),ne.resolution=tt,O.featureId){const st=et.getId();st!==void 0?ne.featureId=st:ne.featureId=null}let it=0;for(let st=0;st<Y;++st){const ot=te[st](ne);ot&&(xe[it]=ot,it+=1)}return xe.length=it,xe}}function buildRuleSet(ee,O){const Y=ee.length,te=new Array(Y);for(let ne=0;ne<Y;++ne){const xe=ee[ne],et="filter"in xe?buildExpression$1(xe.filter,BooleanType$1,O):always$1;let tt;if(Array.isArray(xe.style)){const it=xe.style.length;tt=new Array(it);for(let st=0;st<it;++st)tt[st]=buildStyle(xe.style[st],O)}else tt=[buildStyle(xe.style,O)];te[ne]={filter:et,styles:tt}}return function(ne){const xe=[];let et=!1;for(let tt=0;tt<Y;++tt){const it=te[tt].filter;if(it(ne)&&!(ee[tt].else&&et)){et=!0;for(const st of te[tt].styles){const ot=st(ne);ot&&xe.push(ot)}}}return xe}}function buildStyle(ee,O){const Y=buildFill(ee,"",O),te=buildStroke(ee,"",O),ne=buildText(ee,O),xe=buildImage(ee,O),et=numberEvaluator(ee,"z-index",O);if(!Y&&!te&&!ne&&!xe&&!isEmpty$1(ee))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(ee));const tt=new Style;return function(it){let st=!0;if(Y){const ot=Y(it);ot&&(st=!1),tt.setFill(ot)}if(te){const ot=te(it);ot&&(st=!1),tt.setStroke(ot)}if(ne){const ot=ne(it);ot&&(st=!1),tt.setText(ot)}if(xe){const ot=xe(it);ot&&(st=!1),tt.setImage(ot)}return et&&tt.setZIndex(et(it)),st?null:tt}}function buildFill(ee,O,Y){let te;if(O+"fill-pattern-src"in ee)te=patternEvaluator(ee,O+"fill-",Y);else{if(ee[O+"fill-color"]==="none")return xe=>null;te=colorLikeEvaluator(ee,O+"fill-color",Y)}if(!te)return null;const ne=new Fill;return function(xe){const et=te(xe);return et===NO_COLOR?null:(ne.setColor(et),ne)}}function buildStroke(ee,O,Y){const te=numberEvaluator(ee,O+"stroke-width",Y),ne=colorLikeEvaluator(ee,O+"stroke-color",Y);if(!te&&!ne)return null;const xe=stringEvaluator(ee,O+"stroke-line-cap",Y),et=stringEvaluator(ee,O+"stroke-line-join",Y),tt=numberArrayEvaluator(ee,O+"stroke-line-dash",Y),it=numberEvaluator(ee,O+"stroke-line-dash-offset",Y),st=numberEvaluator(ee,O+"stroke-miter-limit",Y),ot=new Stroke;return function(rt){if(ne){const nt=ne(rt);if(nt===NO_COLOR)return null;ot.setColor(nt)}if(te&&ot.setWidth(te(rt)),xe){const nt=xe(rt);if(nt!=="butt"&&nt!=="round"&&nt!=="square")throw new Error("Expected butt, round, or square line cap");ot.setLineCap(nt)}if(et){const nt=et(rt);if(nt!=="bevel"&&nt!=="round"&&nt!=="miter")throw new Error("Expected bevel, round, or miter line join");ot.setLineJoin(nt)}return tt&&ot.setLineDash(tt(rt)),it&&ot.setLineDashOffset(it(rt)),st&&ot.setMiterLimit(st(rt)),ot}}function buildText(ee,O){const Y="text-",te=stringEvaluator(ee,Y+"value",O);if(!te)return null;const ne=buildFill(ee,Y,O),xe=buildFill(ee,Y+"background-",O),et=buildStroke(ee,Y,O),tt=buildStroke(ee,Y+"background-",O),it=stringEvaluator(ee,Y+"font",O),st=numberEvaluator(ee,Y+"max-angle",O),ot=numberEvaluator(ee,Y+"offset-x",O),rt=numberEvaluator(ee,Y+"offset-y",O),nt=booleanEvaluator(ee,Y+"overflow",O),at=stringEvaluator(ee,Y+"placement",O),ct=numberEvaluator(ee,Y+"repeat",O),ut=sizeLikeEvaluator(ee,Y+"scale",O),dt=booleanEvaluator(ee,Y+"rotate-with-view",O),ht=numberEvaluator(ee,Y+"rotation",O),pt=stringEvaluator(ee,Y+"align",O),ft=stringEvaluator(ee,Y+"justify",O),mt=stringEvaluator(ee,Y+"baseline",O),yt=booleanEvaluator(ee,Y+"keep-upright",O),bt=numberArrayEvaluator(ee,Y+"padding",O),vt=optionalDeclutterMode(ee,Y+"declutter-mode"),Et=new Text({declutterMode:vt});return function(wt){if(Et.setText(te(wt)),ne&&Et.setFill(ne(wt)),xe&&Et.setBackgroundFill(xe(wt)),et&&Et.setStroke(et(wt)),tt&&Et.setBackgroundStroke(tt(wt)),it&&Et.setFont(it(wt)),st&&Et.setMaxAngle(st(wt)),ot&&Et.setOffsetX(ot(wt)),rt&&Et.setOffsetY(rt(wt)),nt&&Et.setOverflow(nt(wt)),at){const St=at(wt);if(St!=="point"&&St!=="line")throw new Error("Expected point or line for text-placement");Et.setPlacement(St)}if(ct&&Et.setRepeat(ct(wt)),ut&&Et.setScale(ut(wt)),dt&&Et.setRotateWithView(dt(wt)),ht&&Et.setRotation(ht(wt)),pt){const St=pt(wt);if(St!=="left"&&St!=="center"&&St!=="right"&&St!=="end"&&St!=="start")throw new Error("Expected left, right, center, start, or end for text-align");Et.setTextAlign(St)}if(ft){const St=ft(wt);if(St!=="left"&&St!=="right"&&St!=="center")throw new Error("Expected left, right, or center for text-justify");Et.setJustify(St)}if(mt){const St=mt(wt);if(St!=="bottom"&&St!=="top"&&St!=="middle"&&St!=="alphabetic"&&St!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");Et.setTextBaseline(St)}return bt&&Et.setPadding(bt(wt)),yt&&Et.setKeepUpright(yt(wt)),Et}}function buildImage(ee,O){return"icon-src"in ee?buildIcon(ee,O):"shape-points"in ee?buildShape(ee,O):"circle-radius"in ee?buildCircle(ee,O):null}function buildIcon(ee,O){const Y="icon-",te=Y+"src",ne=requireString(ee[te],te),xe=coordinateEvaluator(ee,Y+"anchor",O),et=sizeLikeEvaluator(ee,Y+"scale",O),tt=numberEvaluator(ee,Y+"opacity",O),it=coordinateEvaluator(ee,Y+"displacement",O),st=numberEvaluator(ee,Y+"rotation",O),ot=booleanEvaluator(ee,Y+"rotate-with-view",O),rt=optionalIconOrigin(ee,Y+"anchor-origin"),nt=optionalIconAnchorUnits(ee,Y+"anchor-x-units"),at=optionalIconAnchorUnits(ee,Y+"anchor-y-units"),ct=optionalColorLike(ee,Y+"color"),ut=optionalString(ee,Y+"cross-origin"),dt=optionalNumberArray(ee,Y+"offset"),ht=optionalIconOrigin(ee,Y+"offset-origin"),pt=optionalNumber(ee,Y+"width"),ft=optionalNumber(ee,Y+"height"),mt=optionalSize(ee,Y+"size"),yt=optionalDeclutterMode(ee,Y+"declutter-mode"),bt=new Icon({src:ne,anchorOrigin:rt,anchorXUnits:nt,anchorYUnits:at,color:ct,crossOrigin:ut,offset:dt,offsetOrigin:ht,height:ft,width:pt,size:mt,declutterMode:yt});return function(vt){return tt&&bt.setOpacity(tt(vt)),it&&bt.setDisplacement(it(vt)),st&&bt.setRotation(st(vt)),ot&&bt.setRotateWithView(ot(vt)),et&&bt.setScale(et(vt)),xe&&bt.setAnchor(xe(vt)),bt}}function buildShape(ee,O){const Y="shape-",te=Y+"points",ne=Y+"radius",xe=requireNumber(ee[te],te),et=requireNumber(ee[ne],ne),tt=buildFill(ee,Y,O),it=buildStroke(ee,Y,O),st=sizeLikeEvaluator(ee,Y+"scale",O),ot=coordinateEvaluator(ee,Y+"displacement",O),rt=numberEvaluator(ee,Y+"rotation",O),nt=booleanEvaluator(ee,Y+"rotate-with-view",O),at=optionalNumber(ee,Y+"radius2"),ct=optionalNumber(ee,Y+"angle"),ut=optionalDeclutterMode(ee,Y+"declutter-mode"),dt=new RegularShape({points:xe,radius:et,radius2:at,angle:ct,declutterMode:ut});return function(ht){return tt&&dt.setFill(tt(ht)),it&&dt.setStroke(it(ht)),ot&&dt.setDisplacement(ot(ht)),rt&&dt.setRotation(rt(ht)),nt&&dt.setRotateWithView(nt(ht)),st&&dt.setScale(st(ht)),dt}}function buildCircle(ee,O){const Y="circle-",te=buildFill(ee,Y,O),ne=buildStroke(ee,Y,O),xe=numberEvaluator(ee,Y+"radius",O),et=sizeLikeEvaluator(ee,Y+"scale",O),tt=coordinateEvaluator(ee,Y+"displacement",O),it=numberEvaluator(ee,Y+"rotation",O),st=booleanEvaluator(ee,Y+"rotate-with-view",O),ot=optionalDeclutterMode(ee,Y+"declutter-mode"),rt=new CircleStyle({radius:5,declutterMode:ot});return function(nt){return xe&&rt.setRadius(xe(nt)),te&&rt.setFill(te(nt)),ne&&rt.setStroke(ne(nt)),tt&&rt.setDisplacement(tt(nt)),it&&rt.setRotation(it(nt)),st&&rt.setRotateWithView(st(nt)),et&&rt.setScale(et(nt)),rt}}function numberEvaluator(ee,O,Y){if(!(O in ee))return;const te=buildExpression$1(ee[O],NumberType$1,Y);return function(ne){return requireNumber(te(ne),O)}}function stringEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],StringType$1,Y);return function(ne){return requireString(te(ne),O)}}function patternEvaluator(ee,O,Y){const te=stringEvaluator(ee,O+"pattern-src",Y),ne=sizeEvaluator(ee,O+"pattern-offset",Y),xe=sizeEvaluator(ee,O+"pattern-size",Y),et=colorLikeEvaluator(ee,O+"color",Y);return function(tt){return{src:te(tt),offset:ne&&ne(tt),size:xe&&xe(tt),color:et&&et(tt)}}}function booleanEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],BooleanType$1,Y);return function(ne){const xe=te(ne);if(typeof xe!="boolean")throw new Error(`Expected a boolean for ${O}`);return xe}}function colorLikeEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],ColorType$1,Y);return function(ne){return requireColorLike(te(ne),O)}}function numberArrayEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],NumberArrayType$1,Y);return function(ne){return requireNumberArray(te(ne),O)}}function coordinateEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],NumberArrayType$1,Y);return function(ne){const xe=requireNumberArray(te(ne),O);if(xe.length!==2)throw new Error(`Expected two numbers for ${O}`);return xe}}function sizeEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],NumberArrayType$1,Y);return function(ne){return requireSize(te(ne),O)}}function sizeLikeEvaluator(ee,O,Y){if(!(O in ee))return null;const te=buildExpression$1(ee[O],NumberArrayType$1|NumberType$1,Y);return function(ne){return requireSizeLike(te(ne),O)}}function optionalNumber(ee,O){const Y=ee[O];if(Y!==void 0){if(typeof Y!="number")throw new Error(`Expected a number for ${O}`);return Y}}function optionalSize(ee,O){const Y=ee[O];if(Y!==void 0){if(typeof Y=="number")return toSize(Y);if(!Array.isArray(Y))throw new Error(`Expected a number or size array for ${O}`);if(Y.length!==2||typeof Y[0]!="number"||typeof Y[1]!="number")throw new Error(`Expected a number or size array for ${O}`);return Y}}function optionalString(ee,O){const Y=ee[O];if(Y!==void 0){if(typeof Y!="string")throw new Error(`Expected a string for ${O}`);return Y}}function optionalIconOrigin(ee,O){const Y=ee[O];if(Y!==void 0){if(Y!=="bottom-left"&&Y!=="bottom-right"&&Y!=="top-left"&&Y!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${O}`);return Y}}function optionalIconAnchorUnits(ee,O){const Y=ee[O];if(Y!==void 0){if(Y!=="pixels"&&Y!=="fraction")throw new Error(`Expected pixels or fraction for ${O}`);return Y}}function optionalNumberArray(ee,O){const Y=ee[O];if(Y!==void 0)return requireNumberArray(Y,O)}function optionalDeclutterMode(ee,O){const Y=ee[O];if(Y!==void 0){if(typeof Y!="string")throw new Error(`Expected a string for ${O}`);if(Y!=="declutter"&&Y!=="obstacle"&&Y!=="none")throw new Error(`Expected declutter, obstacle, or none for ${O}`);return Y}}function optionalColorLike(ee,O){const Y=ee[O];if(Y!==void 0)return requireColorLike(Y,O)}function requireNumberArray(ee,O){if(!Array.isArray(ee))throw new Error(`Expected an array for ${O}`);const Y=ee.length;for(let te=0;te<Y;++te)if(typeof ee[te]!="number")throw new Error(`Expected an array of numbers for ${O}`);return ee}function requireString(ee,O){if(typeof ee!="string")throw new Error(`Expected a string for ${O}`);return ee}function requireNumber(ee,O){if(typeof ee!="number")throw new Error(`Expected a number for ${O}`);return ee}function requireColorLike(ee,O){if(typeof ee=="string")return ee;const Y=requireNumberArray(ee,O),te=Y.length;if(te<3||te>4)throw new Error(`Expected a color with 3 or 4 values for ${O}`);return Y}function requireSize(ee,O){const Y=requireNumberArray(ee,O);if(Y.length!==2)throw new Error(`Expected an array of two numbers for ${O}`);return Y}function requireSizeLike(ee,O){return typeof ee=="number"?ee:requireSize(ee,O)}const ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function createExtent(ee,O,Y){return(function(te,ne,xe,et,tt){if(!te)return;if(!ne&&!O)return te;const it=O?0:xe[0]*ne,st=O?0:xe[1]*ne,ot=tt?tt[0]:0,rt=tt?tt[1]:0;let nt=ee[0]+it/2+ot,at=ee[2]-it/2+ot,ct=ee[1]+st/2+rt,ut=ee[3]-st/2+rt;nt>at&&(nt=(at+nt)/2,at=nt),ct>ut&&(ct=(ut+ct)/2,ut=ct);let dt=clamp$1(te[0],nt,at),ht=clamp$1(te[1],ct,ut);if(et&&Y&&ne){const pt=30*ne;dt+=-pt*Math.log(1+Math.max(0,nt-te[0])/pt)+pt*Math.log(1+Math.max(0,te[0]-at)/pt),ht+=-pt*Math.log(1+Math.max(0,ct-te[1])/pt)+pt*Math.log(1+Math.max(0,te[1]-ut)/pt)}return[dt,ht]})}function none$1(ee){return ee}function easeIn(ee){return Math.pow(ee,3)}function easeOut(ee){return 1-easeIn(1-ee)}function inAndOut(ee){return 3*ee*ee-2*ee*ee*ee}function linear(ee){return ee}function getViewportClampedResolution(ee,O,Y,te){const ne=getWidth(O)/Y[0],xe=getHeight(O)/Y[1];return te?Math.min(ee,Math.max(ne,xe)):Math.min(ee,Math.min(ne,xe))}function getSmoothClampedResolution(ee,O,Y){let te=Math.min(ee,O);const ne=50;return te*=Math.log(1+ne*Math.max(0,ee/O-1))/ne+1,Y&&(te=Math.max(te,Y),te/=Math.log(1+ne*Math.max(0,Y/ee-1))/ne+1),clamp$1(te,Y/2,O*2)}function createSnapToResolutions(ee,O,Y,te){return O=O!==void 0?O:!0,(function(ne,xe,et,tt){if(ne!==void 0){const it=ee[0],st=ee[ee.length-1],ot=Y?getViewportClampedResolution(it,Y,et,te):it;if(tt)return O?getSmoothClampedResolution(ne,ot,st):clamp$1(ne,st,ot);const rt=Math.min(ot,ne),nt=Math.floor(linearFindNearest(ee,rt,xe));return ee[nt]>ot&&nt<ee.length-1?ee[nt+1]:ee[nt]}})}function createSnapToPower(ee,O,Y,te,ne,xe){return te=te!==void 0?te:!0,Y=Y!==void 0?Y:0,(function(et,tt,it,st){if(et!==void 0){const ot=ne?getViewportClampedResolution(O,ne,it,xe):O;if(st)return te?getSmoothClampedResolution(et,ot,Y):clamp$1(et,Y,ot);const rt=1e-9,nt=Math.ceil(Math.log(O/ot)/Math.log(ee)-rt),at=-tt*(.5-rt)+.5,ct=Math.min(ot,et),ut=Math.floor(Math.log(O/ct)/Math.log(ee)+at),dt=Math.max(nt,ut),ht=O/Math.pow(ee,dt);return clamp$1(ht,Y,ot)}})}function createMinMaxResolution(ee,O,Y,te,ne){return Y=Y!==void 0?Y:!0,(function(xe,et,tt,it){if(xe!==void 0){const st=te?getViewportClampedResolution(ee,te,tt,ne):ee;return!Y||!it?clamp$1(xe,O,st):getSmoothClampedResolution(xe,st,O)}})}function disable(ee){if(ee!==void 0)return 0}function none(ee){if(ee!==void 0)return ee}function createSnapToN(ee){const O=2*Math.PI/ee;return(function(Y,te){if(te)return Y;if(Y!==void 0)return Y=Math.floor(Y/O+.5)*O,Y})}function createSnapToZero(ee){const O=toRadians(5);return(function(Y,te){return te||Y===void 0?Y:Math.abs(Y)<=O?0:Y})}const DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256,DEFAULT_MIN_ZOOM=0;class View extends BaseObject{constructor(O){super(),this.on,this.once,this.un,O=Object.assign({},O),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=createProjection(O.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,O.projection&&disableCoordinateWarning(),O.center&&(O.center=fromUserCoordinate(O.center,this.projection_)),O.extent&&(O.extent=fromUserExtent(O.extent,this.projection_)),this.applyOptions_(O)}applyOptions_(O){const Y=Object.assign({},O);for(const tt in ViewProperty)delete Y[tt];this.setProperties(Y,!0);const te=createResolutionConstraint(O);this.maxResolution_=te.maxResolution,this.minResolution_=te.minResolution,this.zoomFactor_=te.zoomFactor,this.resolutions_=O.resolutions,this.padding_=O.padding,this.minZoom_=te.minZoom;const ne=createCenterConstraint(O),xe=te.constraint,et=createRotationConstraint(O);this.constraints_={center:ne,resolution:xe,rotation:et},this.setRotation(O.rotation!==void 0?O.rotation:0),this.setCenterInternal(O.center!==void 0?O.center:null),O.resolution!==void 0?this.setResolution(O.resolution):O.zoom!==void 0&&this.setZoom(O.zoom)}get padding(){return this.padding_}set padding(O){let Y=this.padding_;this.padding_=O;const te=this.getCenterInternal();if(te){const ne=O||[0,0,0,0];Y=Y||[0,0,0,0];const xe=this.getResolution(),et=xe/2*(ne[3]-Y[3]+Y[1]-ne[1]),tt=xe/2*(ne[0]-Y[0]+Y[2]-ne[2]);this.setCenterInternal([te[0]+et,te[1]-tt])}}getUpdatedOptions_(O){const Y=this.getProperties();return Y.resolution!==void 0?Y.resolution=this.getResolution():Y.zoom=this.getZoom(),Y.center=this.getCenterInternal(),Y.rotation=this.getRotation(),Object.assign({},Y,O)}animate(O){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const Y=new Array(arguments.length);for(let te=0;te<Y.length;++te){let ne=arguments[te];ne.center&&(ne=Object.assign({},ne),ne.center=fromUserCoordinate(ne.center,this.getProjection())),ne.anchor&&(ne=Object.assign({},ne),ne.anchor=fromUserCoordinate(ne.anchor,this.getProjection())),Y[te]=ne}this.animateInternal.apply(this,Y)}animateInternal(O){let Y=arguments.length,te;Y>1&&typeof arguments[Y-1]=="function"&&(te=arguments[Y-1],--Y);let ne=0;for(;ne<Y&&!this.isDef();++ne){const ot=arguments[ne];ot.center&&this.setCenterInternal(ot.center),ot.zoom!==void 0?this.setZoom(ot.zoom):ot.resolution&&this.setResolution(ot.resolution),ot.rotation!==void 0&&this.setRotation(ot.rotation)}if(ne===Y){te&&animationCallback(te,!0);return}let xe=Date.now(),et=this.targetCenter_.slice(),tt=this.targetResolution_,it=this.targetRotation_;const st=[];for(;ne<Y;++ne){const ot=arguments[ne],rt={start:xe,complete:!1,anchor:ot.anchor,duration:ot.duration!==void 0?ot.duration:1e3,easing:ot.easing||inAndOut,callback:te};if(ot.center&&(rt.sourceCenter=et,rt.targetCenter=ot.center.slice(),et=rt.targetCenter),ot.zoom!==void 0?(rt.sourceResolution=tt,rt.targetResolution=this.getResolutionForZoom(ot.zoom),tt=rt.targetResolution):ot.resolution&&(rt.sourceResolution=tt,rt.targetResolution=ot.resolution,tt=rt.targetResolution),ot.rotation!==void 0){rt.sourceRotation=it;const nt=modulo(ot.rotation-it+Math.PI,2*Math.PI)-Math.PI;rt.targetRotation=it+nt,it=rt.targetRotation}isNoopAnimation(rt)?rt.complete=!0:xe+=rt.duration,st.push(rt)}this.animations_.push(st),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint.ANIMATING]>0}getInteracting(){return this.hints_[ViewHint.INTERACTING]>0}cancelAnimations(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);let O;for(let Y=0,te=this.animations_.length;Y<te;++Y){const ne=this.animations_[Y];if(ne[0].callback&&animationCallback(ne[0].callback,!1),!O)for(let xe=0,et=ne.length;xe<et;++xe){const tt=ne[xe];if(!tt.complete){O=tt.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=O,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const O=Date.now();let Y=!1;for(let te=this.animations_.length-1;te>=0;--te){const ne=this.animations_[te];let xe=!0;for(let et=0,tt=ne.length;et<tt;++et){const it=ne[et];if(it.complete)continue;const st=O-it.start;let ot=it.duration>0?st/it.duration:1;ot>=1?(it.complete=!0,ot=1):xe=!1;const rt=it.easing(ot);if(it.sourceCenter){const nt=it.sourceCenter[0],at=it.sourceCenter[1],ct=it.targetCenter[0],ut=it.targetCenter[1];this.nextCenter_=it.targetCenter;const dt=nt+rt*(ct-nt),ht=at+rt*(ut-at);this.targetCenter_=[dt,ht]}if(it.sourceResolution&&it.targetResolution){const nt=rt===1?it.targetResolution:it.sourceResolution+rt*(it.targetResolution-it.sourceResolution);if(it.anchor){const at=this.getViewportSize_(this.getRotation()),ct=this.constraints_.resolution(nt,0,at,!0);this.targetCenter_=this.calculateCenterZoom(ct,it.anchor)}this.nextResolution_=it.targetResolution,this.targetResolution_=nt,this.applyTargetState_(!0)}if(it.sourceRotation!==void 0&&it.targetRotation!==void 0){const nt=rt===1?modulo(it.targetRotation+Math.PI,2*Math.PI)-Math.PI:it.sourceRotation+rt*(it.targetRotation-it.sourceRotation);if(it.anchor){const at=this.constraints_.rotation(nt,!0);this.targetCenter_=this.calculateCenterRotate(at,it.anchor)}this.nextRotation_=it.targetRotation,this.targetRotation_=nt}if(this.applyTargetState_(!0),Y=!0,!it.complete)break}if(xe){this.animations_[te]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const et=ne[0].callback;et&&animationCallback(et,!0)}}this.animations_=this.animations_.filter(Boolean),Y&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(O,Y){let te;const ne=this.getCenterInternal();return ne!==void 0&&(te=[ne[0]-Y[0],ne[1]-Y[1]],rotate$2(te,O-this.getRotation()),add$2(te,Y)),te}calculateCenterZoom(O,Y){let te;const ne=this.getCenterInternal(),xe=this.getResolution();if(ne!==void 0&&xe!==void 0){const et=Y[0]-O*(Y[0]-ne[0])/xe,tt=Y[1]-O*(Y[1]-ne[1])/xe;te=[et,tt]}return te}getViewportSize_(O){const Y=this.viewportSize_;if(O){const te=Y[0],ne=Y[1];return[Math.abs(te*Math.cos(O))+Math.abs(ne*Math.sin(O)),Math.abs(te*Math.sin(O))+Math.abs(ne*Math.cos(O))]}return Y}setViewportSize(O){this.viewportSize_=Array.isArray(O)?O.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const O=this.getCenterInternal();return O&&toUserCoordinate(O,this.getProjection())}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(O){return O!==void 0?(O[0]=this.hints_[0],O[1]=this.hints_[1],O):this.hints_.slice()}calculateExtent(O){const Y=this.calculateExtentInternal(O);return toUserExtent(Y,this.getProjection())}calculateExtentInternal(O){O=O||this.getViewportSizeMinusPadding_();const Y=this.getCenterInternal();assert(Y,"The view center is not defined");const te=this.getResolution();assert(te!==void 0,"The view resolution is not defined");const ne=this.getRotation();return assert(ne!==void 0,"The view rotation is not defined"),getForViewAndSize(Y,te,ne,O)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(O){this.applyOptions_(this.getUpdatedOptions_({maxZoom:O}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(O){this.applyOptions_(this.getUpdatedOptions_({minZoom:O}))}setConstrainResolution(O){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:O}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(O,Y){return this.getResolutionForExtentInternal(fromUserExtent(O,this.getProjection()),Y)}getResolutionForExtentInternal(O,Y){Y=Y||this.getViewportSizeMinusPadding_();const te=getWidth(O)/Y[0],ne=getHeight(O)/Y[1];return Math.max(te,ne)}getResolutionForValueFunction(O){O=O||2;const Y=this.getConstrainedResolution(this.maxResolution_),te=this.minResolution_,ne=Math.log(Y/te)/Math.log(O);return(function(xe){return Y/Math.pow(O,xe*ne)})}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(O){const Y=Math.log(O||2),te=this.getConstrainedResolution(this.maxResolution_),ne=this.minResolution_,xe=Math.log(te/ne)/Y;return(function(et){return Math.log(te/et)/Y/xe})}getViewportSizeMinusPadding_(O){let Y=this.getViewportSize_(O);const te=this.padding_;return te&&(Y=[Y[0]-te[1]-te[3],Y[1]-te[0]-te[2]]),Y}getState(){const O=this.getProjection(),Y=this.getResolution(),te=this.getRotation();let ne=this.getCenterInternal();const xe=this.padding_;if(xe){const et=this.getViewportSizeMinusPadding_();ne=calculateCenterOn(ne,this.getViewportSize_(),[et[0]/2+xe[3],et[1]/2+xe[0]],Y,te)}return{center:ne.slice(0),projection:O!==void 0?O:null,resolution:Y,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:te,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let O;const Y=this.getResolution();return Y!==void 0&&(O=this.getZoomForResolution(Y)),O}getZoomForResolution(O){let Y=this.minZoom_||0,te,ne;if(this.resolutions_){const xe=linearFindNearest(this.resolutions_,O,1);Y=xe,te=this.resolutions_[xe],xe==this.resolutions_.length-1?ne=2:ne=te/this.resolutions_[xe+1]}else te=this.maxResolution_,ne=this.zoomFactor_;return Y+Math.log(te/O)/Math.log(ne)}getResolutionForZoom(O){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const Y=clamp$1(Math.floor(O),0,this.resolutions_.length-2),te=this.resolutions_[Y]/this.resolutions_[Y+1];return this.resolutions_[Y]/Math.pow(te,clamp$1(O-Y,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,O-this.minZoom_)}fit(O,Y){let te;if(assert(Array.isArray(O)||typeof O.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(O)){assert(!isEmpty(O),"Cannot fit empty extent provided as `geometry`");const ne=fromUserExtent(O,this.getProjection());te=fromExtent(ne)}else if(O.getType()==="Circle"){const ne=fromUserExtent(O.getExtent(),this.getProjection());te=fromExtent(ne),te.rotate(this.getRotation(),getCenter(ne))}else{const ne=getUserProjection();ne?te=O.clone().transform(ne,this.getProjection()):te=O}this.fitInternal(te,Y)}rotatedExtentForGeometry(O){const Y=this.getRotation(),te=Math.cos(Y),ne=Math.sin(-Y),xe=O.getFlatCoordinates(),et=O.getStride();let tt=1/0,it=1/0,st=-1/0,ot=-1/0;for(let rt=0,nt=xe.length;rt<nt;rt+=et){const at=xe[rt]*te-xe[rt+1]*ne,ct=xe[rt]*ne+xe[rt+1]*te;tt=Math.min(tt,at),it=Math.min(it,ct),st=Math.max(st,at),ot=Math.max(ot,ct)}return[tt,it,st,ot]}fitInternal(O,Y){Y=Y||{};let te=Y.size;te||(te=this.getViewportSizeMinusPadding_());const ne=Y.padding!==void 0?Y.padding:[0,0,0,0],xe=Y.nearest!==void 0?Y.nearest:!1;let et;Y.minResolution!==void 0?et=Y.minResolution:Y.maxZoom!==void 0?et=this.getResolutionForZoom(Y.maxZoom):et=0;const tt=this.rotatedExtentForGeometry(O);let it=this.getResolutionForExtentInternal(tt,[te[0]-ne[1]-ne[3],te[1]-ne[0]-ne[2]]);it=isNaN(it)?et:Math.max(it,et),it=this.getConstrainedResolution(it,xe?0:1);const st=this.getRotation(),ot=Math.sin(st),rt=Math.cos(st),nt=getCenter(tt);nt[0]+=(ne[1]-ne[3])/2*it,nt[1]+=(ne[0]-ne[2])/2*it;const at=nt[0]*rt-nt[1]*ot,ct=nt[1]*rt+nt[0]*ot,ut=this.getConstrainedCenter([at,ct],it),dt=Y.callback?Y.callback:VOID;Y.duration!==void 0?this.animateInternal({resolution:it,center:ut,duration:Y.duration,easing:Y.easing},dt):(this.targetResolution_=it,this.targetCenter_=ut,this.applyTargetState_(!1,!0),animationCallback(dt,!0))}centerOn(O,Y,te){this.centerOnInternal(fromUserCoordinate(O,this.getProjection()),Y,te)}centerOnInternal(O,Y,te){this.setCenterInternal(calculateCenterOn(O,Y,te,this.getResolution(),this.getRotation()))}calculateCenterShift(O,Y,te,ne){let xe;const et=this.padding_;if(et&&O){const tt=this.getViewportSizeMinusPadding_(-te),it=calculateCenterOn(O,ne,[tt[0]/2+et[3],tt[1]/2+et[0]],Y,te);xe=[O[0]-it[0],O[1]-it[1]]}return xe}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(O){const Y=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([Y[0]+O[0],Y[1]+O[1]])}adjustCenterInternal(O){const Y=this.targetCenter_;this.setCenterInternal([Y[0]+O[0],Y[1]+O[1]])}adjustResolution(O,Y){Y=Y&&fromUserCoordinate(Y,this.getProjection()),this.adjustResolutionInternal(O,Y)}adjustResolutionInternal(O,Y){const te=this.getAnimating()||this.getInteracting(),ne=this.getViewportSize_(this.getRotation()),xe=this.constraints_.resolution(this.targetResolution_*O,0,ne,te);Y&&(this.targetCenter_=this.calculateCenterZoom(xe,Y)),this.targetResolution_*=O,this.applyTargetState_()}adjustZoom(O,Y){this.adjustResolution(Math.pow(this.zoomFactor_,-O),Y)}adjustRotation(O,Y){Y&&(Y=fromUserCoordinate(Y,this.getProjection())),this.adjustRotationInternal(O,Y)}adjustRotationInternal(O,Y){const te=this.getAnimating()||this.getInteracting(),ne=this.constraints_.rotation(this.targetRotation_+O,te);Y&&(this.targetCenter_=this.calculateCenterRotate(ne,Y)),this.targetRotation_+=O,this.applyTargetState_()}setCenter(O){this.setCenterInternal(O&&fromUserCoordinate(O,this.getProjection()))}setCenterInternal(O){this.targetCenter_=O,this.applyTargetState_()}setHint(O,Y){return this.hints_[O]+=Y,this.changed(),this.hints_[O]}setResolution(O){this.targetResolution_=O,this.applyTargetState_()}setRotation(O){this.targetRotation_=O,this.applyTargetState_()}setZoom(O){this.setResolution(this.getResolutionForZoom(O))}applyTargetState_(O,Y){const te=this.getAnimating()||this.getInteracting()||Y,ne=this.constraints_.rotation(this.targetRotation_,te),xe=this.getViewportSize_(ne),et=this.constraints_.resolution(this.targetResolution_,0,xe,te),tt=this.constraints_.center(this.targetCenter_,et,xe,te,this.calculateCenterShift(this.targetCenter_,et,ne,xe));this.get(ViewProperty.ROTATION)!==ne&&this.set(ViewProperty.ROTATION,ne),this.get(ViewProperty.RESOLUTION)!==et&&(this.set(ViewProperty.RESOLUTION,et),this.set("zoom",this.getZoom(),!0)),(!tt||!this.get(ViewProperty.CENTER)||!equals(this.get(ViewProperty.CENTER),tt))&&this.set(ViewProperty.CENTER,tt),this.getAnimating()&&!O&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(O,Y,te){O=O!==void 0?O:200;const ne=Y||0,xe=this.constraints_.rotation(this.targetRotation_),et=this.getViewportSize_(xe),tt=this.constraints_.resolution(this.targetResolution_,ne,et),it=this.constraints_.center(this.targetCenter_,tt,et,!1,this.calculateCenterShift(this.targetCenter_,tt,xe,et));if(O===0&&!this.cancelAnchor_){this.targetResolution_=tt,this.targetRotation_=xe,this.targetCenter_=it,this.applyTargetState_();return}te=te||(O===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==tt||this.getRotation()!==xe||!this.getCenterInternal()||!equals(this.getCenterInternal(),it))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:xe,center:it,resolution:tt,duration:O,easing:easeOut,anchor:te}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)}endInteraction(O,Y,te){te=te&&fromUserCoordinate(te,this.getProjection()),this.endInteractionInternal(O,Y,te)}endInteractionInternal(O,Y,te){this.getInteracting()&&(this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(O,Y,te))}getConstrainedCenter(O,Y){const te=this.getViewportSize_(this.getRotation());return this.constraints_.center(O,Y||this.getResolution(),te)}getConstrainedZoom(O,Y){const te=this.getResolutionForZoom(O);return this.getZoomForResolution(this.getConstrainedResolution(te,Y))}getConstrainedResolution(O,Y){Y=Y||0;const te=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(O,Y,te)}}function animationCallback(ee,O){setTimeout(function(){ee(O)},0)}function createCenterConstraint(ee){if(ee.extent!==void 0){const Y=ee.smoothExtentConstraint!==void 0?ee.smoothExtentConstraint:!0;return createExtent(ee.extent,ee.constrainOnlyCenter,Y)}const O=createProjection(ee.projection,"EPSG:3857");if(ee.multiWorld!==!0&&O.isGlobal()){const Y=O.getExtent().slice();return Y[0]=-1/0,Y[2]=1/0,createExtent(Y,!1,!1)}return none$1}function createResolutionConstraint(ee){let O,Y,te,et=ee.minZoom!==void 0?ee.minZoom:DEFAULT_MIN_ZOOM,tt=ee.maxZoom!==void 0?ee.maxZoom:28;const it=ee.zoomFactor!==void 0?ee.zoomFactor:2,st=ee.multiWorld!==void 0?ee.multiWorld:!1,ot=ee.smoothResolutionConstraint!==void 0?ee.smoothResolutionConstraint:!0,rt=ee.showFullExtent!==void 0?ee.showFullExtent:!1,nt=createProjection(ee.projection,"EPSG:3857"),at=nt.getExtent();let ct=ee.constrainOnlyCenter,ut=ee.extent;if(!st&&!ut&&nt.isGlobal()&&(ct=!1,ut=at),ee.resolutions!==void 0){const dt=ee.resolutions;Y=dt[et],te=dt[tt]!==void 0?dt[tt]:dt[dt.length-1],ee.constrainResolution?O=createSnapToResolutions(dt,ot,!ct&&ut,rt):O=createMinMaxResolution(Y,te,ot,!ct&&ut,rt)}else{const ht=(at?Math.max(getWidth(at),getHeight(at)):360*METERS_PER_UNIT$1.degrees/nt.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),pt=ht/Math.pow(2,28-DEFAULT_MIN_ZOOM);Y=ee.maxResolution,Y!==void 0?et=0:Y=ht/Math.pow(it,et),te=ee.minResolution,te===void 0&&(ee.maxZoom!==void 0?ee.maxResolution!==void 0?te=Y/Math.pow(it,tt):te=ht/Math.pow(it,tt):te=pt),tt=et+Math.floor(Math.log(Y/te)/Math.log(it)),te=Y/Math.pow(it,tt-et),ee.constrainResolution?O=createSnapToPower(it,Y,te,ot,!ct&&ut,rt):O=createMinMaxResolution(Y,te,ot,!ct&&ut,rt)}return{constraint:O,maxResolution:Y,minResolution:te,minZoom:et,zoomFactor:it}}function createRotationConstraint(ee){if(ee.enableRotation!==void 0?ee.enableRotation:!0){const Y=ee.constrainRotation;return Y===void 0||Y===!0?createSnapToZero():Y===!1?none:typeof Y=="number"?createSnapToN(Y):none}return disable}function isNoopAnimation(ee){return!(ee.sourceCenter&&ee.targetCenter&&!equals(ee.sourceCenter,ee.targetCenter)||ee.sourceResolution!==ee.targetResolution||ee.sourceRotation!==ee.targetRotation)}function calculateCenterOn(ee,O,Y,te,ne){const xe=Math.cos(-ne);let et=Math.sin(-ne),tt=ee[0]*xe-ee[1]*et,it=ee[1]*xe+ee[0]*et;tt+=(O[0]/2-Y[0])*te,it+=(Y[1]-O[1]/2)*te,et=-et;const st=tt*xe-it*et,ot=it*xe+tt*et;return[st,ot]}const LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class BaseLayer extends BaseObject{constructor(O){super(),this.on,this.once,this.un,this.background_=O.background;const Y=Object.assign({},O);typeof O.properties=="object"&&(delete Y.properties,Object.assign(Y,O.properties)),Y[LayerProperty.OPACITY]=O.opacity!==void 0?O.opacity:1,assert(typeof Y[LayerProperty.OPACITY]=="number","Layer opacity must be a number"),Y[LayerProperty.VISIBLE]=O.visible!==void 0?O.visible:!0,Y[LayerProperty.Z_INDEX]=O.zIndex,Y[LayerProperty.MAX_RESOLUTION]=O.maxResolution!==void 0?O.maxResolution:1/0,Y[LayerProperty.MIN_RESOLUTION]=O.minResolution!==void 0?O.minResolution:0,Y[LayerProperty.MIN_ZOOM]=O.minZoom!==void 0?O.minZoom:-1/0,Y[LayerProperty.MAX_ZOOM]=O.maxZoom!==void 0?O.maxZoom:1/0,this.className_=Y.className!==void 0?Y.className:"ol-layer",delete Y.className,this.setProperties(Y),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(O){const Y=this.state_||{layer:this,managed:O===void 0?!0:O},te=this.getZIndex();return Y.opacity=clamp$1(Math.round(this.getOpacity()*100)/100,0,1),Y.visible=this.getVisible(),Y.extent=this.getExtent(),Y.zIndex=te===void 0&&!Y.managed?1/0:te,Y.maxResolution=this.getMaxResolution(),Y.minResolution=Math.max(this.getMinResolution(),0),Y.minZoom=this.getMinZoom(),Y.maxZoom=this.getMaxZoom(),this.state_=Y,Y}getLayersArray(O){return abstract()}getLayerStatesArray(O){return abstract()}getExtent(){return this.get(LayerProperty.EXTENT)}getMaxResolution(){return this.get(LayerProperty.MAX_RESOLUTION)}getMinResolution(){return this.get(LayerProperty.MIN_RESOLUTION)}getMinZoom(){return this.get(LayerProperty.MIN_ZOOM)}getMaxZoom(){return this.get(LayerProperty.MAX_ZOOM)}getOpacity(){return this.get(LayerProperty.OPACITY)}getSourceState(){return abstract()}getVisible(){return this.get(LayerProperty.VISIBLE)}getZIndex(){return this.get(LayerProperty.Z_INDEX)}setBackground(O){this.background_=O,this.changed()}setExtent(O){this.set(LayerProperty.EXTENT,O)}setMaxResolution(O){this.set(LayerProperty.MAX_RESOLUTION,O)}setMinResolution(O){this.set(LayerProperty.MIN_RESOLUTION,O)}setMaxZoom(O){this.set(LayerProperty.MAX_ZOOM,O)}setMinZoom(O){this.set(LayerProperty.MIN_ZOOM,O)}setOpacity(O){assert(typeof O=="number","Layer opacity must be a number"),this.set(LayerProperty.OPACITY,O)}setVisible(O){this.set(LayerProperty.VISIBLE,O)}setZIndex(O){this.set(LayerProperty.Z_INDEX,O)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class Layer extends BaseLayer{constructor(O){const Y=Object.assign({},O);delete Y.source,super(Y),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,O.render&&(this.render=O.render),O.map&&this.setMap(O.map),this.addChangeListener(LayerProperty.SOURCE,this.handleSourcePropertyChange_);const te=O.source?O.source:null;this.setSource(te)}getLayersArray(O){return O=O||[],O.push(this),O}getLayerStatesArray(O){return O=O||[],O.push(this.getLayerState()),O}getSource(){return this.get(LayerProperty.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const O=this.getSource();return O?O.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const O=this.getSource();O&&(this.sourceChangeKey_=listen(O,EventType.CHANGE,this.handleSourceChange_,this),O.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(O){return this.renderer_?this.renderer_.getFeatures(O):Promise.resolve([])}getData(O){return!this.renderer_||!this.rendered?null:this.renderer_.getData(O)}isVisible(O){let Y;const te=this.getMapInternal();!O&&te&&(O=te.getView()),O instanceof View?Y={viewState:O.getState(),extent:O.calculateExtent()}:Y=O,!Y.layerStatesArray&&te&&(Y.layerStatesArray=te.getLayerGroup().getLayerStatesArray());let ne;if(Y.layerStatesArray){if(ne=Y.layerStatesArray.find(et=>et.layer===this),!ne)return!1}else ne=this.getLayerState();const xe=this.getExtent();return inView(ne,Y.viewState)&&(!xe||intersects$1(xe,Y.extent))}getAttributions(O){if(!this.isVisible(O))return[];const Y=this.getSource()?.getAttributions();if(!Y)return[];const te=O instanceof View?O.getViewStateAndExtent():O;let ne=Y(te);return Array.isArray(ne)||(ne=[ne]),ne}render(O,Y){const te=this.getRenderer();return te.prepareFrame(O)?(this.rendered=!0,te.renderFrame(O,Y)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(O,Y){}renderDeferred(O){const Y=this.getRenderer();Y&&Y.renderDeferred(O)}setMapInternal(O){O||this.unrender(),this.set(LayerProperty.MAP,O)}getMapInternal(){return this.get(LayerProperty.MAP)}setMap(O){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),O||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),O&&(this.mapPrecomposeKey_=listen(O,RenderEventType.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=listen(this,EventType.CHANGE,O.render,O),this.changed())}handlePrecompose_(O){const Y=O.frameState.layerStatesArray,te=this.getLayerState(!1);assert(!Y.some(ne=>ne.layer===te.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),Y.push(te)}setSource(O){this.set(LayerProperty.SOURCE,O)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function inView(ee,O){if(!ee.visible)return!1;const Y=O.resolution;if(Y<ee.minResolution||Y>=ee.maxResolution)return!1;const te=O.zoom;return te>ee.minZoom&&te<=ee.maxZoom}const Property$3={RENDER_ORDER:"renderOrder"};class BaseVectorLayer extends Layer{constructor(O){O=O||{};const Y=Object.assign({},O);delete Y.style,delete Y.renderBuffer,delete Y.updateWhileAnimating,delete Y.updateWhileInteracting,super(Y),this.declutter_=O.declutter?String(O.declutter):void 0,this.renderBuffer_=O.renderBuffer!==void 0?O.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(O.style),this.updateWhileAnimating_=O.updateWhileAnimating!==void 0?O.updateWhileAnimating:!1,this.updateWhileInteracting_=O.updateWhileInteracting!==void 0?O.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(O){return super.getFeatures(O)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Property$3.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(O,Y){const te=this.getDeclutter();te in O.declutter||(O.declutter[te]=new RBush$1(9)),this.getRenderer().renderDeclutter(O,Y)}setRenderOrder(O){this.set(Property$3.RENDER_ORDER,O)}setStyle(O){this.style_=O===void 0?createDefaultStyle$1:O;const Y=toStyleLike(O);this.styleFunction_=O===null?void 0:toFunction(Y),this.changed()}setDeclutter(O){this.declutter_=O?String(O):void 0,this.changed()}}function toStyleLike(ee){if(ee===void 0)return createDefaultStyle$1;if(!ee)return null;if(typeof ee=="function"||ee instanceof Style)return ee;if(!Array.isArray(ee))return flatStylesToStyleFunction([ee]);if(ee.length===0)return[];const O=ee.length,Y=ee[0];if(Y instanceof Style){const ne=new Array(O);for(let xe=0;xe<O;++xe){const et=ee[xe];if(!(et instanceof Style))throw new Error("Expected a list of style instances");ne[xe]=et}return ne}if("style"in Y){const ne=new Array(O);for(let xe=0;xe<O;++xe){const et=ee[xe];if(!("style"in et))throw new Error("Expected a list of rules with a style property");ne[xe]=et}return rulesToStyleFunction(ne)}return flatStylesToStyleFunction(ee)}class VectorLayer extends BaseVectorLayer{constructor(O){super(O)}createRenderer(){return new CanvasVectorLayerRenderer(this)}}const DEFAULT_STROKE_STYLE$1=new Stroke({color:"rgba(0,0,0,0.2)"}),INTERVALS=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class Graticule extends VectorLayer{constructor(O){O=O||{};const Y=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},O);delete Y.maxLines,delete Y.strokeStyle,delete Y.targetSize,delete Y.showLabels,delete Y.lonLabelFormatter,delete Y.latLabelFormatter,delete Y.lonLabelPosition,delete Y.latLabelPosition,delete Y.lonLabelStyle,delete Y.latLabelStyle,delete Y.intervals,super(Y),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=O.targetSize!==void 0?O.targetSize:100,this.maxLines_=O.maxLines!==void 0?O.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=O.strokeStyle!==void 0?O.strokeStyle:DEFAULT_STROKE_STYLE$1,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,O.showLabels&&(this.lonLabelFormatter_=O.lonLabelFormatter==null?degreesToStringHDMS.bind(this,"EW"):O.lonLabelFormatter,this.latLabelFormatter_=O.latLabelFormatter==null?degreesToStringHDMS.bind(this,"NS"):O.latLabelFormatter,this.lonLabelPosition_=O.lonLabelPosition==null?0:O.lonLabelPosition,this.latLabelPosition_=O.latLabelPosition==null?1:O.latLabelPosition,this.lonLabelStyleBase_=new Style({text:O.lonLabelStyle!==void 0?O.lonLabelStyle.clone():new Text({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Fill({color:"rgba(0,0,0,1)"}),stroke:new Stroke({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=te=>{const ne=te.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(ne),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Style({text:O.latLabelStyle!==void 0?O.latLabelStyle.clone():new Text({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Fill({color:"rgba(0,0,0,1)"}),stroke:new Stroke({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=te=>{const ne=te.get("graticule_label");return this.latLabelStyleBase_.getText().setText(ne),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(RenderEventType.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=O.intervals!==void 0?O.intervals:INTERVALS,this.setSource(new VectorSource({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Collection,overlaps:!1,useSpatialIndex:!1,wrapX:O.wrapX})),this.featurePool_=[],this.lineStyle_=new Style({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(O,Y){let te=O.slice();return this.projection_&&this.getSource().getWrapX()&&wrapX$2(te,this.projection_),this.loadedExtent_&&(approximatelyEquals(this.loadedExtent_,te,Y)?te=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[te]}loaderFunction(O,Y,te){this.loadedExtent_=O;const ne=this.getSource(),xe=this.getExtent()||[-1/0,-1/0,1/0,1/0],et=getIntersection(xe,O);if(this.renderedExtent_&&equals$1(this.renderedExtent_,et)&&this.renderedResolution_===Y||(this.renderedExtent_=et,this.renderedResolution_=Y,isEmpty(et)))return;const tt=getCenter(et),it=Y*Y/4;(!this.projection_||!equivalent$1(this.projection_,te))&&this.updateProjectionInfo_(te),this.createGraticule_(et,tt,Y,it);let ot=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(ot+=this.meridians_.length),this.parallelsLabels_&&(ot+=this.parallels_.length);let rt;for(;ot>this.featurePool_.length;)rt=new Feature,this.featurePool_.push(rt);const nt=ne.getFeaturesCollection();nt.clear();let at=0,ct,ut;for(ct=0,ut=this.meridians_.length;ct<ut;++ct)rt=this.featurePool_[at++],rt.setGeometry(this.meridians_[ct]),rt.setStyle(this.lineStyle_),nt.push(rt);for(ct=0,ut=this.parallels_.length;ct<ut;++ct)rt=this.featurePool_[at++],rt.setGeometry(this.parallels_[ct]),rt.setStyle(this.lineStyle_),nt.push(rt)}addMeridian_(O,Y,te,ne,xe,et){const tt=this.getMeridian_(O,Y,te,ne,et);if(intersects$1(tt.getExtent(),xe)){if(this.meridiansLabels_){const it=this.lonLabelFormatter_(O);et in this.meridiansLabels_?this.meridiansLabels_[et].text=it:this.meridiansLabels_[et]={geom:new Point([]),text:it}}this.meridians_[et++]=tt}return et}addParallel_(O,Y,te,ne,xe,et){const tt=this.getParallel_(O,Y,te,ne,et);if(intersects$1(tt.getExtent(),xe)){if(this.parallelsLabels_){const it=this.latLabelFormatter_(O);et in this.parallelsLabels_?this.parallelsLabels_[et].text=it:this.parallelsLabels_[et]={geom:new Point([]),text:it}}this.parallels_[et++]=tt}return et}drawLabels_(O){const Y=O.frameState.viewState.rotation,te=O.frameState.viewState.resolution,ne=O.frameState.size,xe=O.frameState.extent,et=getCenter(xe);let tt=xe;if(Y){const ct=ne[0]*te,ut=ne[1]*te;tt=[et[0]-ct/2,et[1]-ut/2,et[0]+ct/2,et[1]+ut/2]}let it=0,st=0,ot=this.latLabelPosition_<.5;const rt=this.projection_.getExtent(),nt=getWidth(rt);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!containsExtent(rt,xe)){it=Math.floor((xe[0]-rt[0])/nt),st=Math.ceil((xe[2]-rt[2])/nt);const ct=Math.abs(Y)>Math.PI/2;ot=ot!==ct}const at=getVectorContext(O);for(let ct=it;ct<=st;++ct){let ut=this.meridians_.length+this.parallels_.length,dt,ht,pt,ft;if(this.meridiansLabels_)for(ht=0,pt=this.meridiansLabels_.length;ht<pt;++ht){const mt=this.meridians_[ht];if(!Y&&ct===0)ft=this.getMeridianPoint_(mt,xe,ht);else{const yt=mt.clone();yt.translate(ct*nt,0),yt.rotate(-Y,et),ft=this.getMeridianPoint_(yt,tt,ht),ft.rotate(Y,et)}dt=this.featurePool_[ut++],dt.setGeometry(ft),dt.set("graticule_label",this.meridiansLabels_[ht].text),at.drawFeature(dt,this.lonLabelStyle_(dt))}if(this.parallelsLabels_&&(ct===it&&ot||ct===st&&!ot))for(ht=0,pt=this.parallels_.length;ht<pt;++ht){const mt=this.parallels_[ht];if(!Y&&ct===0)ft=this.getParallelPoint_(mt,xe,ht);else{const yt=mt.clone();yt.translate(ct*nt,0),yt.rotate(-Y,et),ft=this.getParallelPoint_(yt,tt,ht),ft.rotate(Y,et)}dt=this.featurePool_[ut++],dt.setGeometry(ft),dt.set("graticule_label",this.parallelsLabels_[ht].text),at.drawFeature(dt,this.latLabelStyle_(dt))}}}createGraticule_(O,Y,te,ne){const xe=this.getInterval_(te);if(xe==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let et=!1;const tt=this.projection_.getExtent(),it=getWidth(tt);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!containsExtent(tt,O)&&(getWidth(O)>=it?(O[0]=tt[0],O[2]=tt[2]):et=!0);const st=[clamp$1(Y[0],this.minX_,this.maxX_),clamp$1(Y[1],this.minY_,this.maxY_)],ot=this.toLonLatTransform_(st);isNaN(ot[1])&&(ot[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let rt=clamp$1(ot[0],this.minLon_,this.maxLon_),nt=clamp$1(ot[1],this.minLat_,this.maxLat_);const at=this.maxLines_;let ct,ut,dt,ht,pt=O;et||(pt=[clamp$1(O[0],this.minX_,this.maxX_),clamp$1(O[1],this.minY_,this.maxY_),clamp$1(O[2],this.minX_,this.maxX_),clamp$1(O[3],this.minY_,this.maxY_)]);const ft=applyTransform(pt,this.toLonLatTransform_,void 0,8);let mt=ft[3],yt=ft[2],bt=ft[1],vt=ft[0];if(et||(containsCoordinate(pt,this.bottomLeft_)&&(vt=this.minLon_,bt=this.minLat_),containsCoordinate(pt,this.bottomRight_)&&(yt=this.maxLon_,bt=this.minLat_),containsCoordinate(pt,this.topLeft_)&&(vt=this.minLon_,mt=this.maxLat_),containsCoordinate(pt,this.topRight_)&&(yt=this.maxLon_,mt=this.maxLat_),mt=clamp$1(mt,nt,this.maxLat_),yt=clamp$1(yt,rt,this.maxLon_),bt=clamp$1(bt,this.minLat_,nt),vt=clamp$1(vt,this.minLon_,rt)),rt=Math.floor(rt/xe)*xe,ht=clamp$1(rt,this.minLon_,this.maxLon_),ut=this.addMeridian_(ht,bt,mt,ne,O,0),ct=0,et)for(;(ht-=xe)>=vt&&ct++<at;)ut=this.addMeridian_(ht,bt,mt,ne,O,ut);else for(;ht!=this.minLon_&&ct++<at;)ht=Math.max(ht-xe,this.minLon_),ut=this.addMeridian_(ht,bt,mt,ne,O,ut);if(ht=clamp$1(rt,this.minLon_,this.maxLon_),ct=0,et)for(;(ht+=xe)<=yt&&ct++<at;)ut=this.addMeridian_(ht,bt,mt,ne,O,ut);else for(;ht!=this.maxLon_&&ct++<at;)ht=Math.min(ht+xe,this.maxLon_),ut=this.addMeridian_(ht,bt,mt,ne,O,ut);for(this.meridians_.length=ut,this.meridiansLabels_&&(this.meridiansLabels_.length=ut),nt=Math.floor(nt/xe)*xe,dt=clamp$1(nt,this.minLat_,this.maxLat_),ut=this.addParallel_(dt,vt,yt,ne,O,0),ct=0;dt!=this.minLat_&&ct++<at;)dt=Math.max(dt-xe,this.minLat_),ut=this.addParallel_(dt,vt,yt,ne,O,ut);for(dt=clamp$1(nt,this.minLat_,this.maxLat_),ct=0;dt!=this.maxLat_&&ct++<at;)dt=Math.min(dt+xe,this.maxLat_),ut=this.addParallel_(dt,vt,yt,ne,O,ut);this.parallels_.length=ut,this.parallelsLabels_&&(this.parallelsLabels_.length=ut)}getInterval_(O){const Y=this.projectionCenterLonLat_[0],te=this.projectionCenterLonLat_[1];let ne=-1;const xe=Math.pow(this.targetSize_*O,2),et=[],tt=[];for(let it=0,st=this.intervals_.length;it<st;++it){const ot=clamp$1(this.intervals_[it]/2,0,90),rt=clamp$1(te,-90+ot,90-ot);if(et[0]=Y-ot,et[1]=rt-ot,tt[0]=Y+ot,tt[1]=rt+ot,this.fromLonLatTransform_(et,et),this.fromLonLatTransform_(tt,tt),Math.pow(tt[0]-et[0],2)+Math.pow(tt[1]-et[1],2)<=xe)break;ne=this.intervals_[it]}return ne}getMeridian_(O,Y,te,ne,xe){const et=meridian(O,Y,te,this.projection_,ne);let tt=this.meridians_[xe];return tt?(tt.setFlatCoordinates("XY",et),tt.changed()):(tt=new LineString(et,"XY"),this.meridians_[xe]=tt),tt}getMeridianPoint_(O,Y,te){const ne=O.getFlatCoordinates();let xe=1,et=ne.length-1;ne[xe]>ne[et]&&(xe=et,et=1);const tt=Math.max(Y[1],ne[xe]),it=Math.min(Y[3],ne[et]),st=clamp$1(Y[1]+Math.abs(Y[1]-Y[3])*this.lonLabelPosition_,tt,it),rt=[ne[xe-1]+(ne[et-1]-ne[xe-1])*(st-ne[xe])/(ne[et]-ne[xe]),st],nt=this.meridiansLabels_[te].geom;return nt.setCoordinates(rt),nt}getMeridians(){return this.meridians_}getParallel_(O,Y,te,ne,xe){const et=parallel(O,Y,te,this.projection_,ne);let tt=this.parallels_[xe];return tt?(tt.setFlatCoordinates("XY",et),tt.changed()):tt=new LineString(et,"XY"),tt}getParallelPoint_(O,Y,te){const ne=O.getFlatCoordinates();let xe=0,et=ne.length-2;ne[xe]>ne[et]&&(xe=et,et=0);const tt=Math.max(Y[0],ne[xe]),it=Math.min(Y[2],ne[et]),st=clamp$1(Y[0]+Math.abs(Y[0]-Y[2])*this.latLabelPosition_,tt,it),ot=ne[xe+1]+(ne[et+1]-ne[xe+1])*(st-ne[xe])/(ne[et]-ne[xe]),rt=[st,ot],nt=this.parallelsLabels_[te].geom;return nt.setCoordinates(rt),nt}getParallels(){return this.parallels_}updateProjectionInfo_(O){const Y=get$2("EPSG:4326"),te=O.getWorldExtent();this.maxLat_=te[3],this.maxLon_=te[2],this.minLat_=te[1],this.minLon_=te[0];const ne=getTransform(O,Y);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=ne;else{const et=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(tt,it,st){st=st||2;const ot=ne(tt,it,st);for(let rt=0,nt=ot.length;rt<nt;rt+=st)ot[rt]<et&&(ot[rt]+=360);return ot}}this.fromLonLatTransform_=getTransform(Y,O);const xe=applyTransform([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=xe[0],this.maxX_=xe[2],this.minY_=xe[1],this.maxY_=xe[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(getCenter(O.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=O}}class ImageCanvas extends ImageWrapper{constructor(O,Y,te,ne,xe){const et=xe!==void 0?ImageState.IDLE:ImageState.LOADED;super(O,Y,te,et),this.loader_=xe!==void 0?xe:null,this.canvas_=ne,this.error_=null}getError(){return this.error_}handleLoad_(O){O?(this.error_=O,this.state=ImageState.ERROR):this.state=ImageState.LOADED,this.changed()}load(){this.state==ImageState.IDLE&&(this.state=ImageState.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Tile extends Target{constructor(O,Y,te){super(),te=te||{},this.tileCoord=O,this.state=Y,this.key="",this.transition_=te.transition===void 0?250:te.transition,this.transitionStarts_={},this.interpolate=!!te.interpolate}changed(){this.dispatchEvent(EventType.CHANGE)}release(){this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(O){if(this.state!==TileState.EMPTY){if(this.state!==TileState.ERROR&&this.state>O)throw new Error("Tile load sequence violation");this.state=O,this.changed()}}load(){abstract()}getAlpha(O,Y){if(!this.transition_)return 1;let te=this.transitionStarts_[O];if(!te)te=Y,this.transitionStarts_[O]=te;else if(te===-1)return 1;const ne=Y-te+1e3/60;return ne>=this.transition_?1:easeIn(ne/this.transition_)}inTransition(O){return this.transition_?this.transitionStarts_[O]!==-1:!1}endTransition(O){this.transition_&&(this.transitionStarts_[O]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class ImageTile extends Tile{constructor(O,Y,te,ne,xe,et){super(O,Y,et),this.crossOrigin_=ne,this.src_=te,this.key=te,this.image_,WORKER_OFFSCREEN_CANVAS?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,ne!==null&&(this.image_.crossOrigin=ne)),this.unlisten_=null,this.tileLoadFunction_=xe}getImage(){return this.image_}setImage(O){this.image_=O,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}handleImageLoad_(){if(WORKER_OFFSCREEN_CANVAS)this.state=TileState.LOADED;else{const O=this.image_;O.naturalWidth&&O.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function getBlankImage(){const ee=createCanvasContext2D(1,1);return ee.fillStyle="rgba(0,0,0,0)",ee.fillRect(0,0,1,1),ee.canvas}class Kinetic{constructor(O,Y,te){this.decay_=O,this.minVelocity_=Y,this.delay_=te,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(O,Y){this.points_.push(O,Y,Date.now())}end(){if(this.points_.length<6)return!1;const O=Date.now()-this.delay_,Y=this.points_.length-3;if(this.points_[Y+2]<O)return!1;let te=Y-3;for(;te>0&&this.points_[te+2]>O;)te-=3;const ne=this.points_[Y+2]-this.points_[te+2];if(ne<1e3/60)return!1;const xe=this.points_[Y]-this.points_[te],et=this.points_[Y+1]-this.points_[te+1];return this.angle_=Math.atan2(et,xe),this.initialVelocity_=Math.sqrt(xe*xe+et*et)/ne,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class MapEvent extends BaseEvent{constructor(O,Y,te){super(O),this.map=Y,this.frameState=te!==void 0?te:null}}class MapBrowserEvent extends MapEvent{constructor(O,Y,te,ne,xe,et){super(O,Y,xe),this.originalEvent=te,this.pixel_=null,this.coordinate_=null,this.dragging=ne!==void 0?ne:!1,this.activePointers=et}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(O){this.pixel_=O}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(O){this.coordinate_=O}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class MapBrowserEventHandler extends Target{constructor(O,Y){super(O),this.map_=O,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=Y===void 0?1:Y,this.down_=null;const te=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=te,this.pointerdownListenerKey_=listen(te,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=listen(te,PointerEventType.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1)}emulateClick_(O){let Y=new MapBrowserEvent(MapBrowserEventType.CLICK,this.map_,O);this.dispatchEvent(Y),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,Y=new MapBrowserEvent(MapBrowserEventType.DBLCLICK,this.map_,O),this.dispatchEvent(Y)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const te=new MapBrowserEvent(MapBrowserEventType.SINGLECLICK,this.map_,O);this.dispatchEvent(te)},250)}updateActivePointers_(O){const Y=O,te=Y.pointerId;if(Y.type==MapBrowserEventType.POINTERUP||Y.type==MapBrowserEventType.POINTERCANCEL){delete this.trackedTouches_[te];for(const ne in this.trackedTouches_)if(this.trackedTouches_[ne].target!==Y.target){delete this.trackedTouches_[ne];break}}else(Y.type==MapBrowserEventType.POINTERDOWN||Y.type==MapBrowserEventType.POINTERMOVE)&&(this.trackedTouches_[te]=Y);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(O){this.updateActivePointers_(O);const Y=new MapBrowserEvent(MapBrowserEventType.POINTERUP,this.map_,O,void 0,void 0,this.activePointers_);this.dispatchEvent(Y),this.emulateClicks_&&!Y.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(O)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(O){return O.button===0}handlePointerDown_(O){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(O);const Y=new MapBrowserEvent(MapBrowserEventType.POINTERDOWN,this.map_,O,void 0,void 0,this.activePointers_);if(this.dispatchEvent(Y),this.down_=new PointerEvent(O.type,O),Object.defineProperty(this.down_,"target",{writable:!1,value:O.target}),this.dragListenerKeys_.length===0){const te=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(te,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(te,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==te&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(O){if(this.isMoving_(O)){this.updateActivePointers_(O),this.dragging_=!0;const Y=new MapBrowserEvent(MapBrowserEventType.POINTERDRAG,this.map_,O,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(Y)}}relayMoveEvent_(O){this.originalPointerMoveEvent_=O;const Y=!!(this.down_&&this.isMoving_(O));this.dispatchEvent(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,this.map_,O,Y))}handleTouchMove_(O){const Y=this.originalPointerMoveEvent_;(!Y||Y.defaultPrevented)&&(typeof O.cancelable!="boolean"||O.cancelable===!0)&&O.preventDefault()}isMoving_(O){return this.dragging_||Math.abs(O.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(O.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},DROP=1/0;class PriorityQueue{constructor(O,Y){this.priorityFunction_=O,this.keyFunction_=Y,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,clear$2(this.queuedElements_)}dequeue(){const O=this.elements_,Y=this.priorities_,te=O[0];O.length==1?(O.length=0,Y.length=0):(O[0]=O.pop(),Y[0]=Y.pop(),this.siftUp_(0));const ne=this.keyFunction_(te);return delete this.queuedElements_[ne],te}enqueue(O){assert(!(this.keyFunction_(O)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const Y=this.priorityFunction_(O);return Y!=DROP?(this.elements_.push(O),this.priorities_.push(Y),this.queuedElements_[this.keyFunction_(O)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(O){return O*2+1}getRightChildIndex_(O){return O*2+2}getParentIndex_(O){return O-1>>1}heapify_(){let O;for(O=(this.elements_.length>>1)-1;O>=0;O--)this.siftUp_(O)}isEmpty(){return this.elements_.length===0}isKeyQueued(O){return O in this.queuedElements_}isQueued(O){return this.isKeyQueued(this.keyFunction_(O))}siftUp_(O){const Y=this.elements_,te=this.priorities_,ne=Y.length,xe=Y[O],et=te[O],tt=O;for(;O<ne>>1;){const it=this.getLeftChildIndex_(O),st=this.getRightChildIndex_(O),ot=st<ne&&te[st]<te[it]?st:it;Y[O]=Y[ot],te[O]=te[ot],O=ot}Y[O]=xe,te[O]=et,this.siftDown_(tt,O)}siftDown_(O,Y){const te=this.elements_,ne=this.priorities_,xe=te[Y],et=ne[Y];for(;Y>O;){const tt=this.getParentIndex_(Y);if(ne[tt]>et)te[Y]=te[tt],ne[Y]=ne[tt],Y=tt;else break}te[Y]=xe,ne[Y]=et}reprioritize(){const O=this.priorityFunction_,Y=this.elements_,te=this.priorities_;let ne=0;const xe=Y.length;let et,tt,it;for(tt=0;tt<xe;++tt)et=Y[tt],it=O(et),it==DROP?delete this.queuedElements_[this.keyFunction_(et)]:(te[ne]=it,Y[ne++]=et);Y.length=ne,te.length=ne,this.heapify_()}}class TileQueue extends PriorityQueue{constructor(O,Y){super(te=>O.apply(null,te),te=>te[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=Y,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(O){const Y=super.enqueue(O);return Y&&O[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_),Y}getTilesLoading(){return this.tilesLoading_}handleTileChange(O){const Y=O.target,te=Y.getState();if(te===TileState.LOADED||te===TileState.ERROR||te===TileState.EMPTY){te!==TileState.ERROR&&Y.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);const ne=Y.getKey();ne in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[ne],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(O,Y){let te=0;for(;this.tilesLoading_<O&&te<Y&&this.getCount()>0;){const ne=this.dequeue()[0],xe=ne.getKey();ne.getState()===TileState.IDLE&&!(xe in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[xe]=!0,++this.tilesLoading_,++te,ne.load())}}}function getTilePriority(ee,O,Y,te,ne){if(!ee||!(Y in ee.wantedTiles)||!ee.wantedTiles[Y][O.getKey()])return DROP;const xe=ee.viewState.center,et=te[0]-xe[0],tt=te[1]-xe[1];return 65536*Math.log(ne)+Math.sqrt(et*et+tt*tt)/ne}class Control extends BaseObject{constructor(O){super();const Y=O.element;Y&&!O.target&&!Y.style.pointerEvents&&(Y.style.pointerEvents="auto"),this.element=Y||null,this.target_=null,this.map_=null,this.listenerKeys=[],O.render&&(this.render=O.render),O.target&&this.setTarget(O.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(O){this.map_&&this.element?.remove();for(let Y=0,te=this.listenerKeys.length;Y<te;++Y)unlistenByKey(this.listenerKeys[Y]);if(this.listenerKeys.length=0,this.map_=O,O){const Y=this.target_??O.getOverlayContainerStopEvent();this.element&&Y.appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(O,MapEventType.POSTRENDER,this.render,this)),O.render()}}render(O){}setTarget(O){this.target_=typeof O=="string"?document.getElementById(O):O}}class Attribution extends Control{constructor(O){O=O||{},super({element:document.createElement("div"),render:O.render,target:O.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=O.collapsed!==void 0?O.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=O.collapsible!==void 0,this.collapsible_=O.collapsible!==void 0?O.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=O.attributions;const Y=O.className!==void 0?O.className:"ol-attribution",te=O.tipLabel!==void 0?O.tipLabel:"Attributions",ne=O.expandClassName!==void 0?O.expandClassName:Y+"-expand",xe=O.collapseLabel!==void 0?O.collapseLabel:"",et=O.collapseClassName!==void 0?O.collapseClassName:Y+"-collapse";typeof xe=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=xe,this.collapseLabel_.className=et):this.collapseLabel_=xe;const tt=O.label!==void 0?O.label:"i";typeof tt=="string"?(this.label_=document.createElement("span"),this.label_.textContent=tt,this.label_.className=ne):this.label_=tt;const it=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=te,this.toggleButton_.appendChild(it),this.toggleButton_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const st=Y+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),ot=this.element;ot.className=st,ot.appendChild(this.toggleButton_),ot.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(O){const Y=this.getMap().getAllLayers(),te=new Set(Y.flatMap(ne=>ne.getAttributions(O)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(ne=>te.add(ne)):te.add(this.attributions_)),!this.overrideCollapsible_){const ne=!Y.some(xe=>xe.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(ne)}return Array.from(te)}async updateElement_(O){if(!O){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const Y=await Promise.all(this.collectSourceAttributions_(O).map(ne=>toPromise(()=>ne))),te=Y.length>0;if(this.renderedVisible_!=te&&(this.element.style.display=te?"":"none",this.renderedVisible_=te),!equals$2(Y,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let ne=0,xe=Y.length;ne<xe;++ne){const et=document.createElement("li");et.innerHTML=Y[ne],this.ulElement_.appendChild(et)}this.renderedAttributions_=Y}}handleClick_(O){O.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(O){this.collapsible_!==O&&(this.collapsible_=O,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(O){this.userCollapsed_=O,!(!this.collapsible_||this.collapsed_===O)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(O){this.updateElement_(O.frameState)}}class Rotate extends Control{constructor(O){O=O||{},super({element:document.createElement("div"),render:O.render,target:O.target});const Y=O.className!==void 0?O.className:"ol-rotate",te=O.label!==void 0?O.label:"",ne=O.compassClassName!==void 0?O.compassClassName:"ol-compass";this.label_=null,typeof te=="string"?(this.label_=document.createElement("span"),this.label_.className=ne,this.label_.textContent=te):(this.label_=te,this.label_.classList.add(ne));const xe=O.tipLabel?O.tipLabel:"Reset rotation",et=document.createElement("button");et.className=Y+"-reset",et.setAttribute("type","button"),et.title=xe,et.appendChild(this.label_),et.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const tt=Y+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,it=this.element;it.className=tt,it.appendChild(et),this.callResetNorth_=O.resetNorth?O.resetNorth:void 0,this.duration_=O.duration!==void 0?O.duration:250,this.autoHide_=O.autoHide!==void 0?O.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}handleClick_(O){O.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const Y=this.getMap().getView();if(!Y)return;const te=Y.getRotation();te!==void 0&&(this.duration_>0&&te%(2*Math.PI)!==0?Y.animate({rotation:0,duration:this.duration_,easing:easeOut}):Y.setRotation(0))}render(O){const Y=O.frameState;if(!Y)return;const te=Y.viewState.rotation;if(te!=this.rotation_){const ne="rotate("+te+"rad)";if(this.autoHide_){const xe=this.element.classList.contains(CLASS_HIDDEN);!xe&&te===0?this.element.classList.add(CLASS_HIDDEN):xe&&te!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=ne}this.rotation_=te}}class Zoom extends Control{constructor(O){O=O||{},super({element:document.createElement("div"),target:O.target});const Y=O.className!==void 0?O.className:"ol-zoom",te=O.delta!==void 0?O.delta:1,ne=O.zoomInClassName!==void 0?O.zoomInClassName:Y+"-in",xe=O.zoomOutClassName!==void 0?O.zoomOutClassName:Y+"-out",et=O.zoomInLabel!==void 0?O.zoomInLabel:"+",tt=O.zoomOutLabel!==void 0?O.zoomOutLabel:"",it=O.zoomInTipLabel!==void 0?O.zoomInTipLabel:"Zoom in",st=O.zoomOutTipLabel!==void 0?O.zoomOutTipLabel:"Zoom out",ot=document.createElement("button");ot.className=ne,ot.setAttribute("type","button"),ot.title=it,ot.appendChild(typeof et=="string"?document.createTextNode(et):et),ot.addEventListener(EventType.CLICK,this.handleClick_.bind(this,te),!1);const rt=document.createElement("button");rt.className=xe,rt.setAttribute("type","button"),rt.title=st,rt.appendChild(typeof tt=="string"?document.createTextNode(tt):tt),rt.addEventListener(EventType.CLICK,this.handleClick_.bind(this,-te),!1);const nt=Y+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,at=this.element;at.className=nt,at.appendChild(ot),at.appendChild(rt),this.duration_=O.duration!==void 0?O.duration:250}handleClick_(O,Y){Y.preventDefault(),this.zoomByDelta_(O)}zoomByDelta_(O){const te=this.getMap().getView();if(!te)return;const ne=te.getZoom();if(ne!==void 0){const xe=te.getConstrainedZoom(ne+O);this.duration_>0?(te.getAnimating()&&te.cancelAnimations(),te.animate({zoom:xe,duration:this.duration_,easing:easeOut})):te.setZoom(xe)}}}function defaults$1(ee){ee=ee||{};const O=new Collection;return(ee.zoom!==void 0?ee.zoom:!0)&&O.push(new Zoom(ee.zoomOptions)),(ee.rotate!==void 0?ee.rotate:!0)&&O.push(new Rotate(ee.rotateOptions)),(ee.attribution!==void 0?ee.attribution:!0)&&O.push(new Attribution(ee.attributionOptions)),O}const InteractionProperty={ACTIVE:"active"};class Interaction extends BaseObject{constructor(O){super(),this.on,this.once,this.un,O&&O.handleEvent&&(this.handleEvent=O.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(InteractionProperty.ACTIVE)}getMap(){return this.map_}handleEvent(O){return!0}setActive(O){this.set(InteractionProperty.ACTIVE,O)}setMap(O){this.map_=O}}function pan(ee,O,Y){const te=ee.getCenterInternal();if(te){const ne=[te[0]+O[0],te[1]+O[1]];ee.animateInternal({duration:Y!==void 0?Y:250,easing:linear,center:ee.getConstrainedCenter(ne)})}}function zoomByDelta(ee,O,Y,te){const ne=ee.getZoom();if(ne===void 0)return;const xe=ee.getConstrainedZoom(ne+O),et=ee.getResolutionForZoom(xe);ee.getAnimating()&&ee.cancelAnimations(),ee.animate({resolution:et,anchor:Y,duration:te!==void 0?te:250,easing:easeOut})}class DoubleClickZoom extends Interaction{constructor(O){super(),O=O||{},this.delta_=O.delta?O.delta:1,this.duration_=O.duration!==void 0?O.duration:250}handleEvent(O){let Y=!1;if(O.type==MapBrowserEventType.DBLCLICK){const te=O.originalEvent,ne=O.map,xe=O.coordinate,et=te.shiftKey?-this.delta_:this.delta_,tt=ne.getView();zoomByDelta(tt,et,xe,this.duration_),te.preventDefault(),Y=!0}return!Y}}function all(ee){const O=arguments;return function(Y){let te=!0;for(let ne=0,xe=O.length;ne<xe&&(te=te&&O[ne](Y),!!te);++ne);return te}}const altKeyOnly=function(ee){const O=ee.originalEvent;return O.altKey&&!(O.metaKey||O.ctrlKey)&&!O.shiftKey},altShiftKeysOnly=function(ee){const O=ee.originalEvent;return O.altKey&&!(O.metaKey||O.ctrlKey)&&O.shiftKey},focus=function(ee){const O=ee.map.getTargetElement(),Y=O.getRootNode(),te=ee.map.getOwnerDocument().activeElement;return Y instanceof ShadowRoot?Y.host.contains(te):O.contains(te)},focusWithTabindex=function(ee){const O=ee.map.getTargetElement(),Y=O.getRootNode();return(Y instanceof ShadowRoot?Y.host:O).hasAttribute("tabindex")?focus(ee):!0},always=TRUE,click=function(ee){return ee.type==MapBrowserEventType.CLICK},mouseActionButton=function(ee){const O=ee.originalEvent;return"pointerId"in O&&O.button==0&&!(WEBKIT&&MAC&&O.ctrlKey)},never=FALSE,pointerMove=function(ee){return ee.type=="pointermove"},singleClick=function(ee){return ee.type==MapBrowserEventType.SINGLECLICK},doubleClick=function(ee){return ee.type==MapBrowserEventType.DBLCLICK},noModifierKeys=function(ee){const O=ee.originalEvent;return!O.altKey&&!(O.metaKey||O.ctrlKey)&&!O.shiftKey},platformModifierKeyOnly=function(ee){const O=ee.originalEvent;return!O.altKey&&(MAC?O.metaKey:O.ctrlKey)&&!O.shiftKey},platformModifierKey=function(ee){const O=ee.originalEvent;return MAC?O.metaKey:O.ctrlKey},shiftKeyOnly=function(ee){const O=ee.originalEvent;return!O.altKey&&!(O.metaKey||O.ctrlKey)&&O.shiftKey},targetNotEditable=function(ee){const O=ee.originalEvent,Y=O.target.tagName;return Y!=="INPUT"&&Y!=="SELECT"&&Y!=="TEXTAREA"&&!O.target.isContentEditable},mouseOnly=function(ee){const O=ee.originalEvent;return"pointerId"in O&&O.pointerType=="mouse"},touchOnly=function(ee){const O=ee.originalEvent;return"pointerId"in O&&O.pointerType==="touch"},penOnly=function(ee){const O=ee.originalEvent;return"pointerId"in O&&O.pointerType==="pen"},primaryAction=function(ee){const O=ee.originalEvent;return"pointerId"in O&&O.isPrimary&&O.button===0},condition=Object.freeze(Object.defineProperty({__proto__:null,all,altKeyOnly,altShiftKeysOnly,always,click,doubleClick,focus,focusWithTabindex,mouseActionButton,mouseOnly,never,noModifierKeys,penOnly,platformModifierKey,platformModifierKeyOnly,pointerMove,primaryAction,shiftKeyOnly,singleClick,targetNotEditable,touchOnly},Symbol.toStringTag,{value:"Module"}));class PointerInteraction extends Interaction{constructor(O){O=O||{},super(O),O.handleDownEvent&&(this.handleDownEvent=O.handleDownEvent),O.handleDragEvent&&(this.handleDragEvent=O.handleDragEvent),O.handleMoveEvent&&(this.handleMoveEvent=O.handleMoveEvent),O.handleUpEvent&&(this.handleUpEvent=O.handleUpEvent),O.stopDown&&(this.stopDown=O.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(O){return!1}handleDragEvent(O){}handleEvent(O){if(!O.originalEvent)return!0;let Y=!1;if(this.updateTrackedPointers_(O),this.handlingDownUpSequence){if(O.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(O),O.originalEvent.preventDefault();else if(O.type==MapBrowserEventType.POINTERUP){const te=this.handleUpEvent(O);this.handlingDownUpSequence=te&&this.targetPointers.length>0}}else if(O.type==MapBrowserEventType.POINTERDOWN){const te=this.handleDownEvent(O);this.handlingDownUpSequence=te,Y=this.stopDown(te)}else O.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(O);return!Y}handleMoveEvent(O){}handleUpEvent(O){return!1}stopDown(O){return O}updateTrackedPointers_(O){O.activePointers&&(this.targetPointers=O.activePointers)}}function centroid(ee){const O=ee.length;let Y=0,te=0;for(let ne=0;ne<O;ne++)Y+=ee[ne].clientX,te+=ee[ne].clientY;return{clientX:Y/O,clientY:te/O}}class DragPan extends PointerInteraction{constructor(O){super({stopDown:FALSE}),O=O||{},this.kinetic_=O.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const Y=O.condition?O.condition:all(noModifierKeys,primaryAction);this.condition_=O.onFocusOnly?all(focusWithTabindex,Y):Y,this.noKinetic_=!1}handleDragEvent(O){const Y=O.map;this.panning_||(this.panning_=!0,Y.getView().beginInteraction());const te=this.targetPointers,ne=Y.getEventPixel(centroid(te));if(te.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(ne[0],ne[1]),this.lastCentroid){const xe=[this.lastCentroid[0]-ne[0],ne[1]-this.lastCentroid[1]],tt=O.map.getView();scale$4(xe,tt.getResolution()),rotate$2(xe,tt.getRotation()),tt.adjustCenterInternal(xe)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=ne,this.lastPointersCount_=te.length,O.originalEvent.preventDefault()}handleUpEvent(O){const Y=O.map,te=Y.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const ne=this.kinetic_.getDistance(),xe=this.kinetic_.getAngle(),et=te.getCenterInternal(),tt=Y.getPixelFromCoordinateInternal(et),it=Y.getCoordinateFromPixelInternal([tt[0]-ne*Math.cos(xe),tt[1]-ne*Math.sin(xe)]);te.animateInternal({center:te.getConstrainedCenter(it),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,te.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(O){if(this.targetPointers.length>0&&this.condition_(O)){const te=O.map.getView();return this.lastCentroid=null,te.getAnimating()&&te.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class DragRotate extends PointerInteraction{constructor(O){O=O||{},super({stopDown:FALSE}),this.condition_=O.condition?O.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=O.duration!==void 0?O.duration:250}handleDragEvent(O){if(!mouseOnly(O))return;const Y=O.map,te=Y.getView();if(te.getConstraints().rotation===disable)return;const ne=Y.getSize(),xe=O.pixel,et=Math.atan2(ne[1]/2-xe[1],xe[0]-ne[0]/2);if(this.lastAngle_!==void 0){const tt=et-this.lastAngle_;te.adjustRotationInternal(-tt)}this.lastAngle_=et}handleUpEvent(O){return mouseOnly(O)?(O.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(O){return mouseOnly(O)&&mouseActionButton(O)&&this.condition_(O)?(O.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class RenderBox extends Disposable{constructor(O){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+O,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const O=this.startPixel_,Y=this.endPixel_,te="px",ne=this.element_.style;ne.left=Math.min(O[0],Y[0])+te,ne.top=Math.min(O[1],Y[1])+te,ne.width=Math.abs(Y[0]-O[0])+te,ne.height=Math.abs(Y[1]-O[1])+te}setMap(O){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const Y=this.element_.style;Y.left="inherit",Y.top="inherit",Y.width="inherit",Y.height="inherit"}this.map_=O,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(O,Y){this.startPixel_=O,this.endPixel_=Y,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const O=this.startPixel_,Y=this.endPixel_,ne=[O,[O[0],Y[1]],Y,[Y[0],O[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);ne[4]=ne[0].slice(),this.geometry_?this.geometry_.setCoordinates([ne]):this.geometry_=new Polygon([ne])}getGeometry(){return this.geometry_}}const DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class DragBoxEvent extends BaseEvent{constructor(O,Y,te){super(O),this.coordinate=Y,this.mapBrowserEvent=te}}class DragBox extends PointerInteraction{constructor(O){super(),this.on,this.once,this.un,O=O??{},this.box_=new RenderBox(O.className||"ol-dragbox"),this.minArea_=O.minArea??64,O.onBoxEnd&&(this.onBoxEnd=O.onBoxEnd),this.startPixel_=null,this.condition_=O.condition??mouseActionButton,this.boxEndCondition_=O.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(O,Y,te){const ne=te[0]-Y[0],xe=te[1]-Y[1];return ne*ne+xe*xe>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(O){this.startPixel_&&(this.box_.setPixels(this.startPixel_,O.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,O.coordinate,O)))}handleUpEvent(O){if(!this.startPixel_)return!1;const Y=this.boxEndCondition_(O,this.startPixel_,O.pixel);return Y&&this.onBoxEnd(O),this.dispatchEvent(new DragBoxEvent(Y?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,O.coordinate,O)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(O){return this.condition_(O)?(this.startPixel_=O.pixel,this.box_.setMap(O.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,O.coordinate,O)),!0):!1}onBoxEnd(O){}setActive(O){O||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(O)}setMap(O){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(O)}}class DragZoom extends DragBox{constructor(O){O=O||{};const Y=O.condition?O.condition:shiftKeyOnly;super({condition:Y,className:O.className||"ol-dragzoom",minArea:O.minArea}),this.duration_=O.duration!==void 0?O.duration:200,this.out_=O.out!==void 0?O.out:!1}onBoxEnd(O){const te=this.getMap().getView();let ne=this.getGeometry();if(this.out_){const xe=te.rotatedExtentForGeometry(ne),et=te.getResolutionForExtentInternal(xe),tt=te.getResolution()/et;ne=ne.clone(),ne.scale(tt*tt)}te.fitInternal(ne,{duration:this.duration_,easing:easeOut})}}const Key={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class KeyboardPan extends Interaction{constructor(O){super(),O=O||{},this.defaultCondition_=function(Y){return noModifierKeys(Y)&&targetNotEditable(Y)},this.condition_=O.condition!==void 0?O.condition:this.defaultCondition_,this.duration_=O.duration!==void 0?O.duration:100,this.pixelDelta_=O.pixelDelta!==void 0?O.pixelDelta:128}handleEvent(O){let Y=!1;if(O.type==EventType.KEYDOWN){const te=O.originalEvent,ne=te.key;if(this.condition_(O)&&(ne==Key.DOWN||ne==Key.LEFT||ne==Key.RIGHT||ne==Key.UP)){const et=O.map.getView(),tt=et.getResolution()*this.pixelDelta_;let it=0,st=0;ne==Key.DOWN?st=-tt:ne==Key.LEFT?it=-tt:ne==Key.RIGHT?it=tt:st=tt;const ot=[it,st];rotate$2(ot,et.getRotation()),pan(et,ot,this.duration_),te.preventDefault(),Y=!0}}return!Y}}class KeyboardZoom extends Interaction{constructor(O){super(),O=O||{},this.condition_=O.condition?O.condition:function(Y){return!platformModifierKey(Y)&&targetNotEditable(Y)},this.delta_=O.delta?O.delta:1,this.duration_=O.duration!==void 0?O.duration:100}handleEvent(O){let Y=!1;if(O.type==EventType.KEYDOWN||O.type==EventType.KEYPRESS){const te=O.originalEvent,ne=te.key;if(this.condition_(O)&&(ne==="+"||ne==="-")){const xe=O.map,et=ne==="+"?this.delta_:-this.delta_,tt=xe.getView();zoomByDelta(tt,et,void 0,this.duration_),te.preventDefault(),Y=!0}}return!Y}}const DELTA_LINE_MULTIPLIER=40,DELTA_PAGE_MULTIPLIER=300;class MouseWheelZoom extends Interaction{constructor(O){O=O||{},super(O),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=O.maxDelta!==void 0?O.maxDelta:1,this.duration_=O.duration!==void 0?O.duration:250,this.timeout_=O.timeout!==void 0?O.timeout:80,this.useAnchor_=O.useAnchor!==void 0?O.useAnchor:!0,this.constrainResolution_=O.constrainResolution!==void 0?O.constrainResolution:!1;const Y=O.condition?O.condition:always;this.condition_=O.onFocusOnly?all(focusWithTabindex,Y):Y,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const O=this.getMap();if(!O)return;O.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?O.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(O){if(!this.condition_(O)||O.type!==EventType.WHEEL)return!0;const te=O.map,ne=O.originalEvent;ne.preventDefault(),this.useAnchor_&&(this.lastAnchor_=O.pixel);let xe=ne.deltaY;switch(ne.deltaMode){case WheelEvent.DOM_DELTA_LINE:xe*=DELTA_LINE_MULTIPLIER;break;case WheelEvent.DOM_DELTA_PAGE:xe*=DELTA_PAGE_MULTIPLIER;break}if(xe===0)return!1;this.lastDelta_=xe;const et=Date.now();this.startTime_===void 0&&(this.startTime_=et),(!this.mode_||et-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(xe)<4?"trackpad":"wheel");const tt=te.getView();if(this.mode_==="trackpad"&&!(tt.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(tt.getAnimating()&&tt.cancelAnimations(),tt.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),tt.adjustZoom(-xe/this.deltaPerZoom_,this.lastAnchor_?te.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=et,!1;this.totalDelta_+=xe;const it=Math.max(this.timeout_-(et-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,te),it),!1}handleWheelZoom_(O){const Y=O.getView();Y.getAnimating()&&Y.cancelAnimations();let te=-clamp$1(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(Y.getConstrainResolution()||this.constrainResolution_)&&(te=te?te>0?1:-1:0),zoomByDelta(Y,te,this.lastAnchor_?O.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(O){this.useAnchor_=O,O||(this.lastAnchor_=null)}}class PinchRotate extends PointerInteraction{constructor(O){O=O||{};const Y=O;Y.stopDown||(Y.stopDown=FALSE),super(Y),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=O.threshold!==void 0?O.threshold:.3,this.duration_=O.duration!==void 0?O.duration:250}handleDragEvent(O){let Y=0;const te=this.targetPointers[0],ne=this.targetPointers[1],xe=Math.atan2(ne.clientY-te.clientY,ne.clientX-te.clientX);if(this.lastAngle_!==void 0){const it=xe-this.lastAngle_;this.rotationDelta_+=it,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),Y=it}this.lastAngle_=xe;const et=O.map,tt=et.getView();tt.getConstraints().rotation!==disable&&(this.anchor_=et.getCoordinateFromPixelInternal(et.getEventPixel(centroid(this.targetPointers))),this.rotating_&&(et.render(),tt.adjustRotationInternal(Y,this.anchor_)))}handleUpEvent(O){return this.targetPointers.length<2?(O.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(O){if(this.targetPointers.length>=2){const Y=O.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||Y.getView().beginInteraction(),!0}return!1}}class PinchZoom extends PointerInteraction{constructor(O){O=O||{};const Y=O;Y.stopDown||(Y.stopDown=FALSE),super(Y),this.anchor_=null,this.duration_=O.duration!==void 0?O.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(O){let Y=1;const te=this.targetPointers[0],ne=this.targetPointers[1],xe=te.clientX-ne.clientX,et=te.clientY-ne.clientY,tt=Math.sqrt(xe*xe+et*et);this.lastDistance_!==void 0&&(Y=this.lastDistance_/tt),this.lastDistance_=tt;const it=O.map,st=it.getView();Y!=1&&(this.lastScaleDelta_=Y),this.anchor_=it.getCoordinateFromPixelInternal(it.getEventPixel(centroid(this.targetPointers))),it.render(),st.adjustResolutionInternal(Y,this.anchor_)}handleUpEvent(O){if(this.targetPointers.length<2){const te=O.map.getView(),ne=this.lastScaleDelta_>1?1:-1;return te.endInteraction(this.duration_,ne),!1}return!0}handleDownEvent(O){if(this.targetPointers.length>=2){const Y=O.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||Y.getView().beginInteraction(),!0}return!1}}function defaults(ee){ee=ee||{};const O=new Collection,Y=new Kinetic(-.005,.05,100);return(ee.altShiftDragRotate!==void 0?ee.altShiftDragRotate:!0)&&O.push(new DragRotate),(ee.doubleClickZoom!==void 0?ee.doubleClickZoom:!0)&&O.push(new DoubleClickZoom({delta:ee.zoomDelta,duration:ee.zoomDuration})),(ee.dragPan!==void 0?ee.dragPan:!0)&&O.push(new DragPan({onFocusOnly:ee.onFocusOnly,kinetic:Y})),(ee.pinchRotate!==void 0?ee.pinchRotate:!0)&&O.push(new PinchRotate),(ee.pinchZoom!==void 0?ee.pinchZoom:!0)&&O.push(new PinchZoom({duration:ee.zoomDuration})),(ee.keyboard!==void 0?ee.keyboard:!0)&&(O.push(new KeyboardPan),O.push(new KeyboardZoom({delta:ee.zoomDelta,duration:ee.zoomDuration}))),(ee.mouseWheelZoom!==void 0?ee.mouseWheelZoom:!0)&&O.push(new MouseWheelZoom({onFocusOnly:ee.onFocusOnly,duration:ee.zoomDuration})),(ee.shiftDragZoom!==void 0?ee.shiftDragZoom:!0)&&O.push(new DragZoom({duration:ee.zoomDuration})),O}const GroupEventType={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class GroupEvent extends BaseEvent{constructor(O,Y){super(O),this.layer=Y}}const Property$2={LAYERS:"layers"};class LayerGroup extends BaseLayer{constructor(O){O=O||{};const Y=Object.assign({},O);delete Y.layers;let te=O.layers;super(Y),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Property$2.LAYERS,this.handleLayersChanged_),te?Array.isArray(te)?te=new Collection(te.slice(),{unique:!0}):assert(typeof te.getArray=="function","Expected `layers` to be an array or a `Collection`"):te=new Collection(void 0,{unique:!0}),this.setLayers(te)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;const O=this.getLayers();this.layersListenerKeys_.push(listen(O,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(O,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(const te in this.listenerKeys_)this.listenerKeys_[te].forEach(unlistenByKey);clear$2(this.listenerKeys_);const Y=O.getArray();for(let te=0,ne=Y.length;te<ne;te++){const xe=Y[te];this.registerLayerListeners_(xe),this.dispatchEvent(new GroupEvent(GroupEventType.ADDLAYER,xe))}this.changed()}registerLayerListeners_(O){const Y=[listen(O,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(O,EventType.CHANGE,this.handleLayerChange_,this)];O instanceof LayerGroup&&Y.push(listen(O,GroupEventType.ADDLAYER,this.handleLayerGroupAdd_,this),listen(O,GroupEventType.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[getUid(O)]=Y}handleLayerGroupAdd_(O){this.dispatchEvent(new GroupEvent(GroupEventType.ADDLAYER,O.layer))}handleLayerGroupRemove_(O){this.dispatchEvent(new GroupEvent(GroupEventType.REMOVELAYER,O.layer))}handleLayersAdd_(O){const Y=O.element;this.registerLayerListeners_(Y),this.dispatchEvent(new GroupEvent(GroupEventType.ADDLAYER,Y)),this.changed()}handleLayersRemove_(O){const Y=O.element,te=getUid(Y);this.listenerKeys_[te].forEach(unlistenByKey),delete this.listenerKeys_[te],this.dispatchEvent(new GroupEvent(GroupEventType.REMOVELAYER,Y)),this.changed()}getLayers(){return this.get(Property$2.LAYERS)}setLayers(O){const Y=this.getLayers();if(Y){const te=Y.getArray();for(let ne=0,xe=te.length;ne<xe;++ne)this.dispatchEvent(new GroupEvent(GroupEventType.REMOVELAYER,te[ne]))}this.set(Property$2.LAYERS,O)}getLayersArray(O){return O=O!==void 0?O:[],this.getLayers().forEach(function(Y){Y.getLayersArray(O)}),O}getLayerStatesArray(O){const Y=O!==void 0?O:[],te=Y.length;this.getLayers().forEach(function(et){et.getLayerStatesArray(Y)});const ne=this.getLayerState();let xe=ne.zIndex;!O&&ne.zIndex===void 0&&(xe=0);for(let et=te,tt=Y.length;et<tt;et++){const it=Y[et];it.opacity*=ne.opacity,it.visible=it.visible&&ne.visible,it.maxResolution=Math.min(it.maxResolution,ne.maxResolution),it.minResolution=Math.max(it.minResolution,ne.minResolution),it.minZoom=Math.max(it.minZoom,ne.minZoom),it.maxZoom=Math.min(it.maxZoom,ne.maxZoom),ne.extent!==void 0&&(it.extent!==void 0?it.extent=getIntersection(it.extent,ne.extent):it.extent=ne.extent),it.zIndex===void 0&&(it.zIndex=xe)}return Y}getSourceState(){return"ready"}}class MapRenderer extends Disposable{constructor(O){super(),this.map_=O}dispatchRenderEvent(O,Y){abstract()}calculateMatrices2D(O){const Y=O.viewState,te=O.coordinateToPixelTransform,ne=O.pixelToCoordinateTransform;compose(te,O.size[0]/2,O.size[1]/2,1/Y.resolution,-1/Y.resolution,-Y.rotation,-Y.center[0],-Y.center[1]),makeInverse(ne,te)}forEachFeatureAtCoordinate(O,Y,te,ne,xe,et,tt,it){let st;const ot=Y.viewState;function rt(mt,yt,bt,vt){return xe.call(et,yt,mt?bt:null,vt)}const nt=ot.projection,at=wrapX$1(O.slice(),nt),ct=[[0,0]];if(nt.canWrapX()&&ne){const mt=nt.getExtent(),yt=getWidth(mt);ct.push([-yt,0],[yt,0])}const ut=Y.layerStatesArray,dt=ut.length,ht=[],pt=[];for(let mt=0;mt<ct.length;mt++)for(let yt=dt-1;yt>=0;--yt){const bt=ut[yt],vt=bt.layer;if(vt.hasRenderer()&&inView(bt,ot)&&tt.call(it,vt)){const Et=vt.getRenderer(),wt=vt.getSource();if(Et&&wt){const St=wt.getWrapX()?at:O,Ot=rt.bind(null,bt.managed);pt[0]=St[0]+ct[mt][0],pt[1]=St[1]+ct[mt][1],st=Et.forEachFeatureAtCoordinate(pt,Y,te,Ot,ht)}if(st)return st}}if(ht.length===0)return;const ft=1/ht.length;return ht.forEach((mt,yt)=>mt.distanceSq+=yt*ft),ht.sort((mt,yt)=>mt.distanceSq-yt.distanceSq),ht.some(mt=>st=mt.callback(mt.feature,mt.layer,mt.geometry)),st}hasFeatureAtCoordinate(O,Y,te,ne,xe,et){return this.forEachFeatureAtCoordinate(O,Y,te,ne,TRUE,this,xe,et)!==void 0}getMap(){return this.map_}renderFrame(O){abstract()}scheduleExpireIconCache(O){shared.canExpireCache()&&O.postRenderFunctions.push(expireIconCache)}}function expireIconCache(ee,O){shared.expire()}class CompositeMapRenderer extends MapRenderer{constructor(O){super(O),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,O.redrawText,O),this.element_=WORKER_OFFSCREEN_CANVAS?createMockDiv():document.createElement("div");const Y=this.element_.style;Y.position="absolute",Y.width="100%",Y.height="100%",Y.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const te=O.getViewport();te&&te.insertBefore(this.element_,te.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(O,Y){const te=this.getMap();if(te.hasListener(O)){const ne=new RenderEvent(O,void 0,Y);te.dispatchEvent(ne)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(O){if(!O){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(O),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,O);const Y=O.layerStatesArray.sort((st,ot)=>st.zIndex-ot.zIndex);Y.some(st=>st.layer instanceof BaseVectorLayer&&st.layer.getDeclutter())&&(O.declutter={});const ne=O.viewState;this.children_.length=0;const xe=[];let et=null;for(let st=0,ot=Y.length;st<ot;++st){const rt=Y[st];O.layerIndex=st;const nt=rt.layer,at=nt.getSourceState();if(!inView(rt,ne)||at!="ready"&&at!="undefined"){nt.unrender();continue}const ct=nt.render(O,et);ct&&(ct!==et&&(this.children_.push(ct),et=ct),xe.push(rt))}this.declutter(O,xe),replaceChildren(this.element_,this.children_);const it=this.getMap().getTargetElement();if(isCanvas(it)){const st=it.getContext("2d");for(const ot of this.children_){const rt=ot.firstElementChild||ot,nt=ot.style.backgroundColor;if(nt&&(!isCanvas(rt)||rt.width>0)&&(st.fillStyle=nt,st.fillRect(0,0,it.width,it.height)),isCanvas(rt)&&rt.width>0){const at=ot.style.opacity||rt.style.opacity;st.globalAlpha=at===""?1:Number(at);const ct=rt.style.transform;if(ct)st.setTransform(...fromString$1(ct));else{const ut=parseFloat(rt.style.width)/rt.width,dt=parseFloat(rt.style.height)/rt.height;st.setTransform(ut,0,0,dt,0,0)}st.drawImage(rt,0,0)}}st.globalAlpha=1,st.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,O),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(O)}declutter(O,Y){if(O.declutter){for(let te=Y.length-1;te>=0;--te){const ne=Y[te],xe=ne.layer;xe.getDeclutter()&&xe.renderDeclutter(O,ne)}Y.forEach(te=>te.layer.renderDeferred(O))}}}function removeLayerMapProperty(ee){if(ee instanceof Layer){ee.setMapInternal(null);return}ee instanceof LayerGroup&&ee.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(ee,O){if(ee instanceof Layer){ee.setMapInternal(O);return}if(ee instanceof LayerGroup){const Y=ee.getLayers().getArray();for(let te=0,ne=Y.length;te<ne;++te)setLayerMapProperty(Y[te],O)}}let Map$1=class extends BaseObject{constructor(O){super(),O=O||{},this.on,this.once,this.un;const Y=createOptionsInternal(O);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=O.maxTilesLoading!==void 0?O.maxTilesLoading:16,this.pixelRatio_=O.pixelRatio!==void 0?O.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=create$2(),this.pixelToCoordinateTransform_=create$2(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,WORKER_OFFSCREEN_CANVAS||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=O.moveTolerance,this.keyboardEventTarget_=Y.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,WORKER_OFFSCREEN_CANVAS||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=Y.controls||(WORKER_OFFSCREEN_CANVAS?new Collection:defaults$1()),this.interactions=Y.interactions||(WORKER_OFFSCREEN_CANVAS?new Collection:defaults({onFocusOnly:!0})),this.overlays_=Y.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(Y.values);const te=this;O.view&&!(O.view instanceof View)&&O.view.then(function(ne){te.setView(new View(ne))}),this.controls.addEventListener(CollectionEventType.ADD,ne=>{ne.element.setMap(this)}),this.controls.addEventListener(CollectionEventType.REMOVE,ne=>{ne.element.setMap(null)}),this.interactions.addEventListener(CollectionEventType.ADD,ne=>{ne.element.setMap(this)}),this.interactions.addEventListener(CollectionEventType.REMOVE,ne=>{ne.element.setMap(null)}),this.overlays_.addEventListener(CollectionEventType.ADD,ne=>{this.addOverlayInternal_(ne.element)}),this.overlays_.addEventListener(CollectionEventType.REMOVE,ne=>{const xe=ne.element.getId();xe!==void 0&&delete this.overlayIdIndex_[xe.toString()],ne.element.setMap(null)}),this.controls.forEach(ne=>{ne.setMap(this)}),this.interactions.forEach(ne=>{ne.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(O){this.getControls().push(O)}addInteraction(O){this.getInteractions().push(O)}addLayer(O){this.getLayerGroup().getLayers().push(O)}handleLayerAdd_(O){setLayerMapProperty(O.layer,this)}addOverlay(O){this.getOverlays().push(O)}addOverlayInternal_(O){const Y=O.getId();Y!==void 0&&(this.overlayIdIndex_[Y.toString()]=O),O.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(O,Y,te){if(!this.frameState_||!this.renderer_)return;const ne=this.getCoordinateFromPixelInternal(O);te=te!==void 0?te:{};const xe=te.hitTolerance!==void 0?te.hitTolerance:0,et=te.layerFilter!==void 0?te.layerFilter:TRUE,tt=te.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(ne,this.frameState_,xe,tt,Y,null,et,null)}getFeaturesAtPixel(O,Y){const te=[];return this.forEachFeatureAtPixel(O,function(ne){te.push(ne)},Y),te}getAllLayers(){const O=[];function Y(te){te.forEach(function(ne){ne instanceof LayerGroup?Y(ne.getLayers()):O.push(ne)})}return Y(this.getLayers()),O}hasFeatureAtPixel(O,Y){if(!this.frameState_||!this.renderer_)return!1;const te=this.getCoordinateFromPixelInternal(O);Y=Y!==void 0?Y:{};const ne=Y.layerFilter!==void 0?Y.layerFilter:TRUE,xe=Y.hitTolerance!==void 0?Y.hitTolerance:0,et=Y.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(te,this.frameState_,xe,et,ne,null)}getEventCoordinate(O){return this.getCoordinateFromPixel(this.getEventPixel(O))}getEventCoordinateInternal(O){return this.getCoordinateFromPixelInternal(this.getEventPixel(O))}getEventPixel(O){const te=this.viewport_.getBoundingClientRect(),ne=this.getSize(),xe=te.width/ne[0],et=te.height/ne[1],tt="changedTouches"in O?O.changedTouches[0]:O;return[(tt.clientX-te.left)/xe,(tt.clientY-te.top)/et]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(O){return toUserCoordinate(this.getCoordinateFromPixelInternal(O),this.getView().getProjection())}getCoordinateFromPixelInternal(O){const Y=this.frameState_;return Y?apply$1(Y.pixelToCoordinateTransform,O.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(O){const Y=this.overlayIdIndex_[O.toString()];return Y!==void 0?Y:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(O){const Y=this.getLayerGroup();if(O instanceof Collection){Y.setLayers(O);return}const te=Y.getLayers();te.clear(),te.extend(O)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const O=this.getLayerGroup().getLayerStatesArray();for(let Y=0,te=O.length;Y<te;++Y){const ne=O[Y];if(!ne.visible)continue;const xe=ne.layer.getRenderer();if(xe&&!xe.ready)return!0;const et=ne.layer.getSource();if(et&&et.loading)return!0}return!1}getPixelFromCoordinate(O){const Y=fromUserCoordinate(O,this.getView().getProjection());return this.getPixelFromCoordinateInternal(Y)}getPixelFromCoordinateInternal(O){const Y=this.frameState_;return Y?apply$1(Y.coordinateToPixelTransform,O.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const O=this.getTargetElement();return O?O.ownerDocument:document}getTilePriority(O,Y,te,ne){return getTilePriority(this.frameState_,O,Y,te,ne)}handleBrowserEvent(O,Y){Y=Y||O.type;const te=new MapBrowserEvent(Y,this,O);this.handleMapBrowserEvent(te)}handleMapBrowserEvent(O){if(!this.frameState_)return;const Y=O.originalEvent,te=Y.type;if(te===PointerEventType.POINTERDOWN||te===EventType.WHEEL||te===EventType.KEYDOWN){const ne=this.getOwnerDocument(),xe=this.viewport_.getRootNode?this.viewport_.getRootNode():ne,et=Y.target,tt=xe instanceof ShadowRoot?xe.host===et?xe.host.ownerDocument:xe:xe===ne?ne.documentElement:xe;if(this.overlayContainerStopEvent_.contains(et)||!tt.contains(et))return}if(O.frameState=this.frameState_,this.dispatchEvent(O)!==!1){const ne=this.getInteractions().getArray().slice();for(let xe=ne.length-1;xe>=0;xe--){const et=ne[xe];if(et.getMap()!==this||!et.getActive()||!this.getTargetElement())continue;if(!et.handleEvent(O)||O.propagationStopped)break}}}handlePostRender(){const O=this.frameState_,Y=this.tileQueue_;if(!Y.isEmpty()){let ne=this.maxTilesLoading_,xe=ne;if(O){const et=O.viewHints;if(et[ViewHint.ANIMATING]||et[ViewHint.INTERACTING]){const tt=Date.now()-O.time>8;ne=tt?0:8,xe=tt?0:2}}Y.getTilesLoading()<ne&&(Y.reprioritize(),Y.loadMoreTiles(ne,xe))}O&&this.renderer_&&!O.animate&&(this.renderComplete_?(this.hasListener(RenderEventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,O),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new MapEvent(MapEventType.LOADEND,this,O)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new MapEvent(MapEventType.LOADSTART,this,O))));const te=this.postRenderFunctions_;if(O)for(let ne=0,xe=te.length;ne<xe;++ne)te[ne](this,O);te.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let te=0,ne=this.targetChangeHandlerKeys_.length;te<ne;++te)unlistenByKey(this.targetChangeHandlerKeys_[te]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!isCanvas(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);const te=this.targetElement_.getRootNode();te instanceof ShadowRoot&&this.resizeObserver_.unobserve(te.host),this.setSize(void 0)}const O=this.getTarget(),Y=typeof O=="string"?document.getElementById(O):O;if(this.targetElement_=Y,!Y)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if(isCanvas(Y)||Y.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer(this)),!isCanvas(Y)){this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,this.moveTolerance_);for(const ne in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[ne],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);let te;if(this.keyboardEventTarget_)te=this.keyboardEventTarget_;else{const ne=Y.getRootNode();te=ne instanceof ShadowRoot?ne.host:Y}if(this.targetChangeHandlerKeys_=[listen(te,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(te,EventType.KEYPRESS,this.handleBrowserEvent,this)],Y instanceof HTMLElement){const ne=Y.getRootNode();ne instanceof ShadowRoot&&this.resizeObserver_.observe(ne.host),this.resizeObserver_?.observe(Y)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const O=this.getView();O&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=listen(O,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(O,EventType.CHANGE,this.handleViewPropertyChanged_,this),O.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const O=this.getLayerGroup();O&&(this.handleLayerAdd_(new GroupEvent("addlayer",O)),this.layerGroupPropertyListenerKeys_=[listen(O,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(O,EventType.CHANGE,this.render,this),listen(O,"addlayer",this.handleLayerAdd_,this),listen(O,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const O=this.frameState_.layerStatesArray;for(let Y=0,te=O.length;Y<te;++Y){const ne=O[Y].layer;ne.hasRenderer()&&ne.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(O){return this.getControls().remove(O)}removeInteraction(O){return this.getInteractions().remove(O)}removeLayer(O){return this.getLayerGroup().getLayers().remove(O)}handleLayerRemove_(O){removeLayerMapProperty(O.layer)}removeOverlay(O){return this.getOverlays().remove(O)}renderFrame_(O){const Y=this.getSize(),te=this.getView(),ne=this.frameState_;let xe=null;if(Y!==void 0&&hasArea(Y)&&te&&te.isDef()){const et=te.getHints(this.frameState_?this.frameState_.viewHints:void 0),tt=te.getState();if(xe={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:getForViewAndSize(tt.center,tt.resolution,tt.rotation,Y),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:Y,tileQueue:this.tileQueue_,time:O,usedTiles:{},viewState:tt,viewHints:et,wantedTiles:{},mapId:getUid(this),renderTargets:{}},tt.nextCenter&&tt.nextResolution){const it=isNaN(tt.nextRotation)?tt.rotation:tt.nextRotation;xe.nextExtent=getForViewAndSize(tt.nextCenter,tt.nextResolution,it,Y)}}this.frameState_=xe,this.renderer_.renderFrame(xe),xe&&(xe.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,xe.postRenderFunctions),ne&&(!this.previousExtent_||!isEmpty(this.previousExtent_)&&!equals$1(xe.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,ne)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_)),this.previousExtent_&&!xe.viewHints[ViewHint.ANIMATING]&&!xe.viewHints[ViewHint.INTERACTING]&&!equals$1(xe.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,xe)),clone(xe.extent,this.previousExtent_))),this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,xe)),this.renderComplete_=(this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(RenderEventType.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(O){const Y=this.getLayerGroup();Y&&this.handleLayerRemove_(new GroupEvent("removelayer",Y)),this.set(MapProperty.LAYERGROUP,O)}setSize(O){this.set(MapProperty.SIZE,O)}setTarget(O){this.set(MapProperty.TARGET,O)}setView(O){if(!O||O instanceof View){this.set(MapProperty.VIEW,O);return}this.set(MapProperty.VIEW,new View);const Y=this;O.then(function(te){Y.setView(new View(te))})}updateSize(){const O=this.getTargetElement();let Y;if(O){let ne,xe;if(isCanvas(O))ne=O.width,xe=O.height;else{const et=getComputedStyle(O);ne=O.offsetWidth-parseFloat(et.borderLeftWidth)-parseFloat(et.paddingLeft)-parseFloat(et.paddingRight)-parseFloat(et.borderRightWidth),xe=O.offsetHeight-parseFloat(et.borderTopWidth)-parseFloat(et.paddingTop)-parseFloat(et.paddingBottom)-parseFloat(et.borderBottomWidth)}!isNaN(ne)&&!isNaN(xe)&&(Y=[Math.max(0,ne),Math.max(0,xe)],!hasArea(Y)&&(O.offsetWidth||O.offsetHeight||O.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const te=this.getSize();Y&&(!te||!equals$2(Y,te))&&(this.setSize(Y),this.updateViewportSize_(Y))}updateViewportSize_(O){const Y=this.getView();Y&&Y.setViewportSize(O)}};function createOptionsInternal(ee){let O=null;ee.keyboardEventTarget!==void 0&&(O=typeof ee.keyboardEventTarget=="string"?document.getElementById(ee.keyboardEventTarget):ee.keyboardEventTarget);const Y={},te=ee.layers&&typeof ee.layers.getLayers=="function"?ee.layers:new LayerGroup({layers:ee.layers});Y[MapProperty.LAYERGROUP]=te,Y[MapProperty.TARGET]=ee.target,Y[MapProperty.VIEW]=ee.view instanceof View?ee.view:new View;let ne;ee.controls!==void 0&&(Array.isArray(ee.controls)?ne=new Collection(ee.controls.slice()):(assert(typeof ee.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),ne=ee.controls));let xe;ee.interactions!==void 0&&(Array.isArray(ee.interactions)?xe=new Collection(ee.interactions.slice()):(assert(typeof ee.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),xe=ee.interactions));let et;return ee.overlays!==void 0?Array.isArray(ee.overlays)?et=new Collection(ee.overlays.slice()):(assert(typeof ee.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),et=ee.overlays):et=new Collection,{controls:ne,interactions:xe,keyboardEventTarget:O,overlays:et,values:Y}}const Property$1={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Overlay extends BaseObject{constructor(O){super(),this.on,this.once,this.un,this.options=O,this.id=O.id,this.insertFirst=O.insertFirst!==void 0?O.insertFirst:!0,this.stopEvent=O.stopEvent!==void 0?O.stopEvent:!0,this.element=document.createElement("div"),this.element.className=O.className!==void 0?O.className:"ol-overlay-container "+CLASS_SELECTABLE,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=O.autoPan===!0?{}:O.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Property$1.ELEMENT,this.handleElementChanged),this.addChangeListener(Property$1.MAP,this.handleMapChanged),this.addChangeListener(Property$1.OFFSET,this.handleOffsetChanged),this.addChangeListener(Property$1.POSITION,this.handlePositionChanged),this.addChangeListener(Property$1.POSITIONING,this.handlePositioningChanged),O.element!==void 0&&this.setElement(O.element),this.setOffset(O.offset!==void 0?O.offset:[0,0]),this.setPositioning(O.positioning||"top-left"),O.position!==void 0&&this.setPosition(O.position)}getElement(){return this.get(Property$1.ELEMENT)}getId(){return this.id}getMap(){return this.get(Property$1.MAP)||null}getOffset(){return this.get(Property$1.OFFSET)}getPosition(){return this.get(Property$1.POSITION)}getPositioning(){return this.get(Property$1.POSITIONING)}handleElementChanged(){removeChildren(this.element);const O=this.getElement();O&&this.element.appendChild(O)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const O=this.getMap();if(O){this.mapPostrenderListenerKey=listen(O,MapEventType.POSTRENDER,this.render,this),this.updatePixelPosition();const Y=this.stopEvent?O.getOverlayContainerStopEvent():O.getOverlayContainer();this.insertFirst?Y.insertBefore(this.element,Y.childNodes[0]||null):Y.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(O){this.set(Property$1.ELEMENT,O)}setMap(O){this.set(Property$1.MAP,O)}setOffset(O){this.set(Property$1.OFFSET,O)}setPosition(O){this.set(Property$1.POSITION,O)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(O){const Y=this.getMap();if(!Y||!Y.getTargetElement()||!this.get(Property$1.POSITION))return;const te=this.getRect(Y.getTargetElement(),Y.getSize()),ne=this.getElement(),xe=this.getRect(ne,[outerWidth(ne),outerHeight(ne)]);O=O||{};const et=O.margin===void 0?20:O.margin;if(!containsExtent(te,xe)){const tt=xe[0]-te[0],it=te[2]-xe[2],st=xe[1]-te[1],ot=te[3]-xe[3],rt=[0,0];if(tt<0?rt[0]=tt-et:it<0&&(rt[0]=Math.abs(it)+et),st<0?rt[1]=st-et:ot<0&&(rt[1]=Math.abs(ot)+et),rt[0]!==0||rt[1]!==0){const nt=Y.getView().getCenterInternal(),at=Y.getPixelFromCoordinateInternal(nt);if(!at)return;const ct=[at[0]+rt[0],at[1]+rt[1]],ut=O.animation||{};Y.getView().animateInternal({center:Y.getCoordinateFromPixelInternal(ct),duration:ut.duration,easing:ut.easing})}}}getRect(O,Y){const te=O.getBoundingClientRect(),ne=te.left+window.pageXOffset,xe=te.top+window.pageYOffset;return[ne,xe,ne+Y[0],xe+Y[1]]}setPositioning(O){this.set(Property$1.POSITIONING,O)}setVisible(O){this.rendered.visible!==O&&(this.element.style.display=O?"":"none",this.rendered.visible=O)}updatePixelPosition(){const O=this.getMap(),Y=this.getPosition();if(!O||!O.isRendered()||!Y){this.setVisible(!1);return}const te=O.getPixelFromCoordinate(Y),ne=O.getSize();this.updateRenderedPosition(te,ne)}updateRenderedPosition(O,Y){const te=this.element.style,ne=this.getOffset(),xe=this.getPositioning();this.setVisible(!0);const et=`${O[0]+ne[0]}px`,tt=`${O[1]+ne[1]}px`;let it="0%",st="0%";xe=="bottom-right"||xe=="center-right"||xe=="top-right"?it="-100%":(xe=="bottom-center"||xe=="center-center"||xe=="top-center")&&(it="-50%"),xe=="bottom-left"||xe=="bottom-center"||xe=="bottom-right"?st="-100%":(xe=="center-left"||xe=="center-center"||xe=="center-right")&&(st="-50%");const ot=`translate(${it}, ${st}) translate(${et}, ${tt})`;this.rendered.transform_!=ot&&(this.rendered.transform_=ot,te.transform=ot)}getOptions(){return this.options}}class TileRange{constructor(O,Y,te,ne){this.minX=O,this.maxX=Y,this.minY=te,this.maxY=ne}contains(O){return this.containsXY(O[1],O[2])}containsTileRange(O){return this.minX<=O.minX&&O.maxX<=this.maxX&&this.minY<=O.minY&&O.maxY<=this.maxY}containsXY(O,Y){return this.minX<=O&&O<=this.maxX&&this.minY<=Y&&Y<=this.maxY}equals(O){return this.minX==O.minX&&this.minY==O.minY&&this.maxX==O.maxX&&this.maxY==O.maxY}extend(O){O.minX<this.minX&&(this.minX=O.minX),O.maxX>this.maxX&&(this.maxX=O.maxX),O.minY<this.minY&&(this.minY=O.minY),O.maxY>this.maxY&&(this.maxY=O.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(O){return this.minX<=O.maxX&&this.maxX>=O.minX&&this.minY<=O.maxY&&this.maxY>=O.minY}}function createOrUpdate$1(ee,O,Y,te,ne){return ne!==void 0?(ne.minX=ee,ne.maxX=O,ne.minY=Y,ne.maxY=te,ne):new TileRange(ee,O,Y,te)}const canvasPool$1=[];class VectorRenderTile extends Tile{constructor(O,Y,te,ne,xe){super(O,Y,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=ne.bind(void 0,this),this.removeSourceTiles_=xe,this.wrappedTileCoord=te}getContext(){return this.context_||(this.context_=createCanvasContext2D(1,1,canvasPool$1)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(O){const Y=getUid(O);return Y in this.replayState_||(this.replayState_[Y]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[Y]}load(){this.getSourceTiles()}release(){this.context_&&(releaseCanvas$1(this.context_),canvasPool$1.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let VectorTile$1=class extends Tile{constructor(O,Y,te,ne,xe,et){super(O,Y,et),this.extent=null,this.format_=ne,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=xe,this.url_=te,this.key=te}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==TileState.IDLE&&(this.setState(TileState.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(O,Y){this.setFeatures(O)}onError(){this.setState(TileState.ERROR)}setFeatures(O){this.features_=O,this.setState(TileState.LOADED)}setLoader(O){this.loader_=O}};class LRUCache{constructor(O){this.highWaterMark=O!==void 0?O:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const O=this.pop();O instanceof Disposable&&O.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(O){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(O){return this.entries_.hasOwnProperty(O)}forEach(O){let Y=this.oldest_;for(;Y;)O(Y.value_,Y.key_,this),Y=Y.newer}get(O,Y){const te=this.entries_[O];return assert(te!==void 0,"Tried to get a value for a key that does not exist in the cache"),te===this.newest_||(te===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(te.newer.older=te.older,te.older.newer=te.newer),te.newer=null,te.older=this.newest_,this.newest_.newer=te,this.newest_=te),te.value_}remove(O){const Y=this.entries_[O];return assert(Y!==void 0,"Tried to get a value for a key that does not exist in the cache"),Y===this.newest_?(this.newest_=Y.older,this.newest_&&(this.newest_.newer=null)):Y===this.oldest_?(this.oldest_=Y.newer,this.oldest_&&(this.oldest_.older=null)):(Y.newer.older=Y.older,Y.older.newer=Y.newer),delete this.entries_[O],--this.count_,Y.value_}getCount(){return this.count_}getKeys(){const O=new Array(this.count_);let Y=0,te;for(te=this.newest_;te;te=te.older)O[Y++]=te.key_;return O}getValues(){const O=new Array(this.count_);let Y=0,te;for(te=this.newest_;te;te=te.older)O[Y++]=te.value_;return O}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(O){return this.entries_[O]?.value_}pop(){const O=this.oldest_;return delete this.entries_[O.key_],O.newer&&(O.newer.older=null),this.oldest_=O.newer,this.oldest_||(this.newest_=null),--this.count_,O.value_}replace(O,Y){this.get(O),this.entries_[O].value_=Y}set(O,Y){assert(!(O in this.entries_),"Tried to set a value for a key that is used already");const te={key_:O,newer:null,older:this.newest_,value_:Y};this.newest_?this.newest_.newer=te:this.oldest_=te,this.newest_=te,this.entries_[O]=te,++this.count_}setSize(O){this.highWaterMark=O}}function createOrUpdate(ee,O,Y,te){return te!==void 0?(te[0]=ee,te[1]=O,te[2]=Y,te):[ee,O,Y]}function getKeyZXY(ee,O,Y){return ee+"/"+O+"/"+Y}function getKey(ee){return getKeyZXY(ee[0],ee[1],ee[2])}function getCacheKey$1(ee,O,Y,te,ne){return`${getUid(ee)},${O},${getKeyZXY(Y,te,ne)}`}function hash(ee){return hashZXY(ee[0],ee[1],ee[2])}function hashZXY(ee,O,Y){return(O<<ee)+Y}function withinExtentAndZ(ee,O){const Y=ee[0],te=ee[1],ne=ee[2];if(O.getMinZoom()>Y||Y>O.getMaxZoom())return!1;const xe=O.getFullTileRange(Y);return xe?xe.containsXY(te,ne):!0}const tmpTileCoord=[0,0,0],DECIMALS$1=5;class TileGrid{constructor(O){this.minZoom=O.minZoom!==void 0?O.minZoom:0,this.resolutions_=O.resolutions,assert(isSorted(this.resolutions_,(ne,xe)=>xe-ne),"`resolutions` must be sorted in descending order");let Y;if(!O.origins){for(let ne=0,xe=this.resolutions_.length-1;ne<xe;++ne)if(!Y)Y=this.resolutions_[ne]/this.resolutions_[ne+1];else if(this.resolutions_[ne]/this.resolutions_[ne+1]!==Y){Y=void 0;break}}this.zoomFactor_=Y,this.maxZoom=this.resolutions_.length-1,this.origin_=O.origin!==void 0?O.origin:null,this.origins_=null,O.origins!==void 0&&(this.origins_=O.origins,assert(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const te=O.extent;te!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(te)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,O.tileSizes!==void 0&&(this.tileSizes_=O.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=O.tileSize!==void 0?O.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=te!==void 0?te:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],O.sizes!==void 0?this.fullTileRanges_=O.sizes.map((ne,xe)=>{const et=new TileRange(Math.min(0,ne[0]),Math.max(ne[0]-1,-1),Math.min(0,ne[1]),Math.max(ne[1]-1,-1));if(te){const tt=this.getTileRangeForExtentAndZ(te,xe);et.minX=Math.max(tt.minX,et.minX),et.maxX=Math.min(tt.maxX,et.maxX),et.minY=Math.max(tt.minY,et.minY),et.maxY=Math.min(tt.maxY,et.maxY)}return et}):te&&this.calculateTileRanges_(te)}forEachTileCoord(O,Y,te){const ne=this.getTileRangeForExtentAndZ(O,Y);for(let xe=ne.minX,et=ne.maxX;xe<=et;++xe)for(let tt=ne.minY,it=ne.maxY;tt<=it;++tt)te([Y,xe,tt])}forEachTileCoordParentTileRange(O,Y,te,ne){let xe,et,tt,it=null,st=O[0]-1;for(this.zoomFactor_===2?(et=O[1],tt=O[2]):it=this.getTileCoordExtent(O,ne);st>=this.minZoom;){if(et!==void 0&&tt!==void 0?(et=Math.floor(et/2),tt=Math.floor(tt/2),xe=createOrUpdate$1(et,et,tt,tt,te)):xe=this.getTileRangeForExtentAndZ(it,st,te),Y(st,xe))return!0;--st}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(O){return this.origin_?this.origin_:this.origins_[O]}getResolution(O){return this.resolutions_[O]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(O,Y,te){if(O[0]<this.maxZoom){if(this.zoomFactor_===2){const xe=O[1]*2,et=O[2]*2;return createOrUpdate$1(xe,xe+1,et,et+1,Y)}const ne=this.getTileCoordExtent(O,te||this.tmpExtent_);return this.getTileRangeForExtentAndZ(ne,O[0]+1,Y)}return null}getTileRangeForTileCoordAndZ(O,Y,te){if(Y>this.maxZoom||Y<this.minZoom)return null;const ne=O[0],xe=O[1],et=O[2];if(Y===ne)return createOrUpdate$1(xe,et,xe,et,te);if(this.zoomFactor_){const it=Math.pow(this.zoomFactor_,Y-ne),st=Math.floor(xe*it),ot=Math.floor(et*it);if(Y<ne)return createOrUpdate$1(st,st,ot,ot,te);const rt=Math.floor(it*(xe+1))-1,nt=Math.floor(it*(et+1))-1;return createOrUpdate$1(st,rt,ot,nt,te)}const tt=this.getTileCoordExtent(O,this.tmpExtent_);return this.getTileRangeForExtentAndZ(tt,Y,te)}getTileRangeForExtentAndZ(O,Y,te){this.getTileCoordForXYAndZ_(O[0],O[3],Y,!1,tmpTileCoord);const ne=tmpTileCoord[1],xe=tmpTileCoord[2];this.getTileCoordForXYAndZ_(O[2],O[1],Y,!0,tmpTileCoord);const et=tmpTileCoord[1],tt=tmpTileCoord[2];return createOrUpdate$1(ne,et,xe,tt,te)}getTileCoordCenter(O){const Y=this.getOrigin(O[0]),te=this.getResolution(O[0]),ne=toSize(this.getTileSize(O[0]),this.tmpSize_);return[Y[0]+(O[1]+.5)*ne[0]*te,Y[1]-(O[2]+.5)*ne[1]*te]}getTileCoordExtent(O,Y){const te=this.getOrigin(O[0]),ne=this.getResolution(O[0]),xe=toSize(this.getTileSize(O[0]),this.tmpSize_),et=te[0]+O[1]*xe[0]*ne,tt=te[1]-(O[2]+1)*xe[1]*ne,it=et+xe[0]*ne,st=tt+xe[1]*ne;return createOrUpdate$2(et,tt,it,st,Y)}getTileCoordForCoordAndResolution(O,Y,te){return this.getTileCoordForXYAndResolution_(O[0],O[1],Y,!1,te)}getTileCoordForXYAndResolution_(O,Y,te,ne,xe){const et=this.getZForResolution(te),tt=te/this.getResolution(et),it=this.getOrigin(et),st=toSize(this.getTileSize(et),this.tmpSize_);let ot=tt*(O-it[0])/te/st[0],rt=tt*(it[1]-Y)/te/st[1];return ne?(ot=ceil(ot,DECIMALS$1)-1,rt=ceil(rt,DECIMALS$1)-1):(ot=floor(ot,DECIMALS$1),rt=floor(rt,DECIMALS$1)),createOrUpdate(et,ot,rt,xe)}getTileCoordForXYAndZ_(O,Y,te,ne,xe){const et=this.getOrigin(te),tt=this.getResolution(te),it=toSize(this.getTileSize(te),this.tmpSize_);let st=(O-et[0])/tt/it[0],ot=(et[1]-Y)/tt/it[1];return ne?(st=ceil(st,DECIMALS$1)-1,ot=ceil(ot,DECIMALS$1)-1):(st=floor(st,DECIMALS$1),ot=floor(ot,DECIMALS$1)),createOrUpdate(te,st,ot,xe)}getTileCoordForCoordAndZ(O,Y,te){return this.getTileCoordForXYAndZ_(O[0],O[1],Y,!1,te)}getTileCoordResolution(O){return this.resolutions_[O[0]]}getTileSize(O){return this.tileSize_?this.tileSize_:this.tileSizes_[O]}getFullTileRange(O){return this.fullTileRanges_?this.fullTileRanges_[O]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,O):null}getZForResolution(O,Y){const te=linearFindNearest(this.resolutions_,O,Y||0);return clamp$1(te,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(O,Y){return intersectsLinearRing(Y,0,Y.length,2,this.getTileCoordExtent(O))}calculateTileRanges_(O){const Y=this.resolutions_.length,te=new Array(Y);for(let ne=this.minZoom;ne<Y;++ne)te[ne]=this.getTileRangeForExtentAndZ(O,ne);this.fullTileRanges_=te}}class WMTSTileGrid extends TileGrid{constructor(O){super({extent:O.extent,origin:O.origin,origins:O.origins,resolutions:O.resolutions,tileSize:O.tileSize,tileSizes:O.tileSizes,sizes:O.sizes}),this.matrixIds_=O.matrixIds}getMatrixId(O){return this.matrixIds_[O]}getMatrixIds(){return this.matrixIds_}}function createFromCapabilitiesMatrixSet(ee,O,Y){const te=[],ne=[],xe=[],et=[],tt=[];Y=Y!==void 0?Y:[];const it="SupportedCRS",st="TileMatrix",ot="Identifier",rt="ScaleDenominator",nt="TopLeftCorner",at="TileWidth",ct="TileHeight",ut=ee[it],dt=get$2(ut),ht=dt.getMetersPerUnit(),pt=dt.getAxisOrientation().startsWith("ne");return ee[st].sort(function(ft,mt){return mt[rt]-ft[rt]}),ee[st].forEach(function(ft){let mt;if(Y.length>0?mt=Y.find(function(yt){return ft[ot]==yt[st]?!0:ft[ot].includes(":")?!1:ee[ot]+":"+ft[ot]===yt[st]}):mt=!0,mt){ne.push(ft[ot]);const yt=ft[rt]*28e-5/ht,bt=ft[at],vt=ft[ct];pt?xe.push([ft[nt][1],ft[nt][0]]):xe.push(ft[nt]),te.push(yt),et.push(bt==vt?bt:[bt,vt]),tt.push([ft.MatrixWidth,ft.MatrixHeight])}}),new WMTSTileGrid({extent:O,origins:xe,resolutions:te,matrixIds:ne,tileSizes:et,sizes:tt})}function getForProjection(ee){let O=ee.getDefaultTileGrid();return O||(O=createForProjection(ee),ee.setDefaultTileGrid(O)),O}function wrapX(ee,O,Y){const te=O[0],ne=ee.getTileCoordCenter(O),xe=extentFromProjection(Y);if(!containsCoordinate(xe,ne)){const et=getWidth(xe),tt=Math.ceil((xe[0]-ne[0])/et);return ne[0]+=et*tt,ee.getTileCoordForCoordAndZ(ne,te)}return O}function createForExtent(ee,O,Y,te){te=te!==void 0?te:"top-left";const ne=resolutionsFromExtent(ee,O,Y);return new TileGrid({extent:ee,origin:getCorner(ee,te),resolutions:ne,tileSize:Y})}function createXYZ(ee){const O=ee||{},Y=O.extent||get$2("EPSG:3857").getExtent(),te={extent:Y,minZoom:O.minZoom,tileSize:O.tileSize,resolutions:resolutionsFromExtent(Y,O.maxZoom,O.tileSize,O.maxResolution)};return new TileGrid(te)}function resolutionsFromExtent(ee,O,Y,te){O=O!==void 0?O:DEFAULT_MAX_ZOOM,Y=toSize(Y!==void 0?Y:DEFAULT_TILE_SIZE);const ne=getHeight(ee),xe=getWidth(ee);te=te>0?te:Math.max(xe/Y[0],ne/Y[1]);const et=O+1,tt=new Array(et);for(let it=0;it<et;++it)tt[it]=te/Math.pow(2,it);return tt}function createForProjection(ee,O,Y,te){const ne=extentFromProjection(ee);return createForExtent(ne,O,Y,te)}function extentFromProjection(ee){ee=get$2(ee);let O=ee.getExtent();if(!O){const Y=180*METERS_PER_UNIT$1.degrees/ee.getMetersPerUnit();O=createOrUpdate$2(-Y,-Y,Y,Y)}return O}function appendParams(ee,O){const Y=[];Object.keys(O).forEach(function(ne){O[ne]!==null&&O[ne]!==void 0&&Y.push(ne+"="+encodeURIComponent(O[ne]))});const te=Y.join("&");return ee=ee.replace(/[?&]$/,""),ee+=ee.includes("?")?"&":"?",ee+te}const zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;function renderXYZTemplate(ee,O,Y,te,ne){return ee.replace(zRegEx,O.toString()).replace(xRegEx,Y.toString()).replace(yRegEx,te.toString()).replace(dashYRegEx,function(){if(ne===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(ne-te).toString()})}function pickUrl(ee,O,Y,te){const ne=hashZXY(O,Y,te),xe=modulo(ne,ee.length);return ee[xe]}function expandUrl(ee){const O=[];let Y=/\{([a-z])-([a-z])\}/.exec(ee);if(Y){const te=Y[1].charCodeAt(0),ne=Y[2].charCodeAt(0);let xe;for(xe=te;xe<=ne;++xe)O.push(ee.replace(Y[0],String.fromCharCode(xe)));return O}if(Y=/\{(\d+)-(\d+)\}/.exec(ee),Y){const te=parseInt(Y[2],10);for(let ne=parseInt(Y[1],10);ne<=te;ne++)O.push(ee.replace(Y[0],ne.toString()));return O}return O.push(ee),O}function createFromTemplate(ee,O){return(function(Y,te,ne){if(!Y)return;let xe;const et=Y[0];if(O){const tt=O.getFullTileRange(et);tt&&(xe=tt.getHeight()-1)}return renderXYZTemplate(ee,et,Y[1],Y[2],xe)})}function createFromTemplates(ee,O){const Y=ee.length,te=new Array(Y);for(let ne=0;ne<Y;++ne)te[ne]=createFromTemplate(ee[ne],O);return createFromTileUrlFunctions(te)}function createFromTileUrlFunctions(ee){return ee.length===1?ee[0]:(function(O,Y,te){if(!O)return;const ne=hash(O),xe=modulo(ne,ee.length);return ee[xe](O,Y,te)})}function nullTileUrlFunction(ee,O,Y){}let brokenDiagonalRendering_;const canvasPool=[];function drawTestTriangle(ee,O,Y,te,ne){ee.beginPath(),ee.moveTo(0,0),ee.lineTo(O,Y),ee.lineTo(te,ne),ee.closePath(),ee.save(),ee.clip(),ee.fillRect(0,0,Math.max(O,te)+1,Math.max(Y,ne)),ee.restore()}function verifyBrokenDiagonalRendering(ee,O){return Math.abs(ee[O*4]-210)>2||Math.abs(ee[O*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){const ee=createCanvasContext2D(6,6,canvasPool);ee.globalCompositeOperation="lighter",ee.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(ee,4,5,4,0),drawTestTriangle(ee,4,5,0,5);const O=ee.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(O,0)||verifyBrokenDiagonalRendering(O,4)||verifyBrokenDiagonalRendering(O,8),releaseCanvas$1(ee),canvasPool.push(ee.canvas)}return brokenDiagonalRendering_}function calculateSourceResolution(ee,O,Y,te){const ne=transform(Y,O,ee);let xe=getPointResolution(O,te,Y);const et=O.getMetersPerUnit();et!==void 0&&(xe*=et);const tt=ee.getMetersPerUnit();tt!==void 0&&(xe/=tt);const it=ee.getExtent();if(!it||containsCoordinate(it,ne)){const st=getPointResolution(ee,xe,ne)/xe;isFinite(st)&&st>0&&(xe/=st)}return xe}function calculateSourceExtentResolution(ee,O,Y,te){const ne=getCenter(Y);let xe=calculateSourceResolution(ee,O,ne,te);return(!isFinite(xe)||xe<=0)&&forEachCorner(Y,function(et){return xe=calculateSourceResolution(ee,O,et,te),isFinite(xe)&&xe>0}),xe}function render$1(ee,O,Y,te,ne,xe,et,tt,it,st,ot,rt,nt,at){const ct=createCanvasContext2D(Math.round(Y*ee),Math.round(Y*O),canvasPool);if(rt||(ct.imageSmoothingEnabled=!1),it.length===0)return ct.canvas;ct.scale(Y,Y);function ut(yt){return Math.round(yt*Y)/Y}ct.globalCompositeOperation="lighter";const dt=createEmpty();it.forEach(function(yt,bt,vt){extend$1(dt,yt.extent)});let ht;const pt=Y/te,ft=(rt?1:1+Math.pow(2,-24))/pt;if(!nt||it.length!==1||st!==0){if(ht=createCanvasContext2D(Math.round(getWidth(dt)*pt),Math.round(getHeight(dt)*pt),canvasPool),rt||(ht.imageSmoothingEnabled=!1),ne&&at){const yt=(ne[0]-dt[0])*pt,bt=-(ne[3]-dt[3])*pt,vt=getWidth(ne)*pt,Et=getHeight(ne)*pt;ht.rect(yt,bt,vt,Et),ht.clip()}it.forEach(function(yt,bt,vt){if(yt.image.width>0&&yt.image.height>0){if(yt.clipExtent){ht.save();const $t=(yt.clipExtent[0]-dt[0])*pt,Mt=-(yt.clipExtent[3]-dt[3])*pt,Nt=getWidth(yt.clipExtent)*pt,Rt=getHeight(yt.clipExtent)*pt;ht.rect(rt?$t:Math.round($t),rt?Mt:Math.round(Mt),rt?Nt:Math.round($t+Nt)-Math.round($t),rt?Rt:Math.round(Mt+Rt)-Math.round(Mt)),ht.clip()}const Et=(yt.extent[0]-dt[0])*pt,wt=-(yt.extent[3]-dt[3])*pt,St=getWidth(yt.extent)*pt,Ot=getHeight(yt.extent)*pt;ht.drawImage(yt.image,st,st,yt.image.width-2*st,yt.image.height-2*st,rt?Et:Math.round(Et),rt?wt:Math.round(wt),rt?St:Math.round(Et+St)-Math.round(Et),rt?Ot:Math.round(wt+Ot)-Math.round(wt)),yt.clipExtent&&ht.restore()}})}const mt=getTopLeft(et);return tt.getTriangles().forEach(function(yt,bt,vt){const Et=yt.source,wt=yt.target;let St=Et[0][0],Ot=Et[0][1],$t=Et[1][0],Mt=Et[1][1],Nt=Et[2][0],Rt=Et[2][1];const Pt=ut((wt[0][0]-mt[0])/xe),kt=ut(-(wt[0][1]-mt[1])/xe),Wt=ut((wt[1][0]-mt[0])/xe),zt=ut(-(wt[1][1]-mt[1])/xe),Kt=ut((wt[2][0]-mt[0])/xe),qt=ut(-(wt[2][1]-mt[1])/xe),Xt=St,an=Ot;St=0,Ot=0,$t-=Xt,Mt-=an,Nt-=Xt,Rt-=an;const pn=[[$t,Mt,0,0,Wt-Pt],[Nt,Rt,0,0,Kt-Pt],[0,0,$t,Mt,zt-kt],[0,0,Nt,Rt,qt-kt]],ln=solveLinearSystem(pn);if(!ln)return;if(ct.save(),ct.beginPath(),isBrokenDiagonalRendering()||!rt){ct.moveTo(Wt,zt);const un=4,Tn=Pt-Wt,Sn=kt-zt;for(let bn=0;bn<un;bn++)ct.lineTo(Wt+ut((bn+1)*Tn/un),zt+ut(bn*Sn/(un-1))),bn!=un-1&&ct.lineTo(Wt+ut((bn+1)*Tn/un),zt+ut((bn+1)*Sn/(un-1)));ct.lineTo(Kt,qt)}else ct.moveTo(Wt,zt),ct.lineTo(Pt,kt),ct.lineTo(Kt,qt);ct.clip(),ct.transform(ln[0],ln[2],ln[1],ln[3],Pt,kt),ct.translate(dt[0]-Xt,dt[3]-an);let dn;if(ht)dn=ht.canvas,ct.scale(ft,-ft);else{const un=it[0],Tn=un.extent;dn=un.image,ct.scale(getWidth(Tn)/dn.width,-getHeight(Tn)/dn.height)}ct.drawImage(dn,0,0),ct.restore()}),ht&&(releaseCanvas$1(ht),canvasPool.push(ht.canvas)),ot&&(ct.save(),ct.globalCompositeOperation="source-over",ct.strokeStyle="black",ct.lineWidth=1,tt.getTriangles().forEach(function(yt,bt,vt){const Et=yt.target,wt=(Et[0][0]-mt[0])/xe,St=-(Et[0][1]-mt[1])/xe,Ot=(Et[1][0]-mt[0])/xe,$t=-(Et[1][1]-mt[1])/xe,Mt=(Et[2][0]-mt[0])/xe,Nt=-(Et[2][1]-mt[1])/xe;ct.beginPath(),ct.moveTo(Ot,$t),ct.lineTo(wt,St),ct.lineTo(Mt,Nt),ct.closePath(),ct.stroke()}),ct.restore()),ct.canvas}const MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25;class Triangulation{constructor(O,Y,te,ne,xe,et,tt){this.sourceProj_=O,this.targetProj_=Y;let it={};const st=tt?createTransformFromCoordinateTransform(ft=>apply$1(tt,transform(ft,this.targetProj_,this.sourceProj_))):getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(ft){const mt=ft[0]+"/"+ft[1];return it[mt]||(it[mt]=st(ft)),it[mt]},this.maxSourceExtent_=ne,this.errorThresholdSquared_=xe*xe,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!ne&&!!this.sourceProj_.getExtent()&&getWidth(ne)>=getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;const ot=getTopLeft(te),rt=getTopRight(te),nt=getBottomRight(te),at=getBottomLeft(te),ct=this.transformInv_(ot),ut=this.transformInv_(rt),dt=this.transformInv_(nt),ht=this.transformInv_(at),pt=MAX_SUBDIVISION+(et?Math.max(0,Math.ceil(Math.log2(getArea$1(te)/(et*et*256*256)))):0);if(this.addQuad_(ot,rt,nt,at,ct,ut,dt,ht,pt),this.wrapsXInSource_){let ft=1/0;this.triangles_.forEach(function(mt,yt,bt){ft=Math.min(ft,mt.source[0][0],mt.source[1][0],mt.source[2][0])}),this.triangles_.forEach(mt=>{if(Math.max(mt.source[0][0],mt.source[1][0],mt.source[2][0])-ft>this.sourceWorldWidth_/2){const yt=[[mt.source[0][0],mt.source[0][1]],[mt.source[1][0],mt.source[1][1]],[mt.source[2][0],mt.source[2][1]]];yt[0][0]-ft>this.sourceWorldWidth_/2&&(yt[0][0]-=this.sourceWorldWidth_),yt[1][0]-ft>this.sourceWorldWidth_/2&&(yt[1][0]-=this.sourceWorldWidth_),yt[2][0]-ft>this.sourceWorldWidth_/2&&(yt[2][0]-=this.sourceWorldWidth_);const bt=Math.min(yt[0][0],yt[1][0],yt[2][0]);Math.max(yt[0][0],yt[1][0],yt[2][0])-bt<this.sourceWorldWidth_/2&&(mt.source=yt)}})}it={}}addTriangle_(O,Y,te,ne,xe,et){this.triangles_.push({source:[ne,xe,et],target:[O,Y,te]})}addQuad_(O,Y,te,ne,xe,et,tt,it,st){const ot=boundingExtent([xe,et,tt,it]),rt=this.sourceWorldWidth_?getWidth(ot)/this.sourceWorldWidth_:null,nt=this.sourceWorldWidth_,at=this.sourceProj_.canWrapX()&&rt>.5&&rt<1;let ct=!1;if(st>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const dt=boundingExtent([O,Y,te,ne]);ct=getWidth(dt)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||ct}!at&&this.sourceProj_.isGlobal()&&rt&&(ct=rt>MAX_TRIANGLE_WIDTH||ct)}if(!ct&&this.maxSourceExtent_&&isFinite(ot[0])&&isFinite(ot[1])&&isFinite(ot[2])&&isFinite(ot[3])&&!intersects$1(ot,this.maxSourceExtent_))return;let ut=0;if(!ct&&(!isFinite(xe[0])||!isFinite(xe[1])||!isFinite(et[0])||!isFinite(et[1])||!isFinite(tt[0])||!isFinite(tt[1])||!isFinite(it[0])||!isFinite(it[1]))){if(st>0)ct=!0;else if(ut=(!isFinite(xe[0])||!isFinite(xe[1])?8:0)+(!isFinite(et[0])||!isFinite(et[1])?4:0)+(!isFinite(tt[0])||!isFinite(tt[1])?2:0)+(!isFinite(it[0])||!isFinite(it[1])?1:0),ut!=1&&ut!=2&&ut!=4&&ut!=8)return}if(st>0){if(!ct){const dt=[(O[0]+te[0])/2,(O[1]+te[1])/2],ht=this.transformInv_(dt);let pt;at?pt=(modulo(xe[0],nt)+modulo(tt[0],nt))/2-modulo(ht[0],nt):pt=(xe[0]+tt[0])/2-ht[0];const ft=(xe[1]+tt[1])/2-ht[1];ct=pt*pt+ft*ft>this.errorThresholdSquared_}if(ct){if(Math.abs(O[0]-te[0])<=Math.abs(O[1]-te[1])){const dt=[(Y[0]+te[0])/2,(Y[1]+te[1])/2],ht=this.transformInv_(dt),pt=[(ne[0]+O[0])/2,(ne[1]+O[1])/2],ft=this.transformInv_(pt);this.addQuad_(O,Y,dt,pt,xe,et,ht,ft,st-1),this.addQuad_(pt,dt,te,ne,ft,ht,tt,it,st-1)}else{const dt=[(O[0]+Y[0])/2,(O[1]+Y[1])/2],ht=this.transformInv_(dt),pt=[(te[0]+ne[0])/2,(te[1]+ne[1])/2],ft=this.transformInv_(pt);this.addQuad_(O,dt,pt,ne,xe,ht,ft,it,st-1),this.addQuad_(dt,Y,te,pt,ht,et,tt,ft,st-1)}return}}if(at){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(ut&11)==0&&this.addTriangle_(O,te,ne,xe,tt,it),(ut&14)==0&&this.addTriangle_(O,te,Y,xe,tt,et),ut&&((ut&13)==0&&this.addTriangle_(Y,ne,O,et,it,xe),(ut&7)==0&&this.addTriangle_(Y,ne,te,et,it,tt))}calculateSourceExtent(){const O=createEmpty();return this.triangles_.forEach(function(Y,te,ne){const xe=Y.source;extendCoordinate(O,xe[0]),extendCoordinate(O,xe[1]),extendCoordinate(O,xe[2])}),O}getTriangles(){return this.triangles_}}const ERROR_THRESHOLD=.5;class ReprojTile extends Tile{constructor(O,Y,te,ne,xe,et,tt,it,st,ot,rt,nt){super(xe,TileState.IDLE,nt),this.renderEdges_=rt!==void 0?rt:!1,this.pixelRatio_=tt,this.gutter_=it,this.canvas_=null,this.sourceTileGrid_=Y,this.targetTileGrid_=ne,this.wrappedTileCoord_=et||xe,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=O.canWrapX()?O.getExtent():void 0;const at=ne.getTileCoordExtent(this.wrappedTileCoord_),ct=this.targetTileGrid_.getExtent();let ut=this.sourceTileGrid_.getExtent();const dt=ct?getIntersection(at,ct):at;if(getArea$1(dt)===0){this.state=TileState.EMPTY;return}const ht=O.getExtent();ht&&(ut?ut=getIntersection(ut,ht):ut=ht);const pt=ne.getResolution(this.wrappedTileCoord_[0]),ft=calculateSourceExtentResolution(O,te,dt,pt);if(!isFinite(ft)||ft<=0){this.state=TileState.EMPTY;return}const mt=ot!==void 0?ot:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(O,te,dt,ut,ft*mt,pt),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=Y.getZForResolution(ft);let yt=this.triangulation_.calculateSourceExtent();if(ut&&(O.canWrapX()?(yt[1]=clamp$1(yt[1],ut[1],ut[3]),yt[3]=clamp$1(yt[3],ut[1],ut[3])):yt=getIntersection(yt,ut)),!getArea$1(yt))this.state=TileState.EMPTY;else{let bt=0,vt=0;O.canWrapX()&&(bt=getWidth(ht),vt=Math.floor((yt[0]-ht[0])/bt)),wrapAndSliceX(yt.slice(),O,!0).forEach(wt=>{const St=Y.getTileRangeForExtentAndZ(wt,this.sourceZ_);for(let Ot=St.minX;Ot<=St.maxX;Ot++)for(let $t=St.minY;$t<=St.maxY;$t++){const Mt=st(this.sourceZ_,Ot,$t,tt);if(Mt){const Nt=vt*bt;this.sourceTiles_.push({tile:Mt,offset:Nt})}}++vt}),this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getImage(){return this.canvas_}reproject_(){const O=[];if(this.sourceTiles_.forEach(Y=>{const te=Y.tile;if(te&&te.getState()==TileState.LOADED){const ne=this.sourceTileGrid_.getTileCoordExtent(te.tileCoord);ne[0]+=Y.offset,ne[2]+=Y.offset;const xe=this.clipExtent_?.slice();xe&&(xe[0]+=Y.offset,xe[2]+=Y.offset),O.push({extent:ne,clipExtent:xe,image:te.getImage()})}}),this.sourceTiles_.length=0,O.length===0)this.state=TileState.ERROR;else{const Y=this.wrappedTileCoord_[0],te=this.targetTileGrid_.getTileSize(Y),ne=typeof te=="number"?te:te[0],xe=typeof te=="number"?te:te[1],et=this.targetTileGrid_.getResolution(Y),tt=this.sourceTileGrid_.getResolution(this.sourceZ_),it=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render$1(ne,xe,this.pixelRatio_,tt,this.sourceTileGrid_.getExtent(),et,it,this.triangulation_,O,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()}load(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();let O=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:Y})=>{const te=Y.getState();if(te==TileState.IDLE||te==TileState.LOADING){O++;const ne=listen(Y,EventType.CHANGE,xe=>{const et=Y.getState();(et==TileState.LOADED||et==TileState.ERROR||et==TileState.EMPTY)&&(unlistenByKey(ne),O--,O===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(ne)}}),O===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:Y},te,ne){Y.getState()==TileState.IDLE&&Y.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}release(){this.canvas_&&(releaseCanvas$1(this.canvas_.getContext("2d")),canvasPool.push(this.canvas_),this.canvas_=null),super.release()}}class TileSource extends Source{constructor(O){super({attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,projection:O.projection,state:O.state,wrapX:O.wrapX,interpolate:O.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=O.tilePixelRatio!==void 0?O.tilePixelRatio:1,this.tileGrid=O.tileGrid!==void 0?O.tileGrid:null;const Y=[256,256];this.tileGrid&&toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),Y),this.tmpSize=[0,0],this.key_=O.key||getUid(this),this.tileOptions={transition:O.transition,interpolate:O.interpolate},this.zDirection=O.zDirection?O.zDirection:0}getGutterForProjection(O){return 0}getKey(){return this.key_}setKey(O){this.key_!==O&&(this.key_=O,this.changed())}getResolutions(O){const Y=O?this.getTileGridForProjection(O):this.tileGrid;return Y?Y.getResolutions():null}getTile(O,Y,te,ne,xe,et){return abstract()}getTileGrid(){return this.tileGrid}getTileGridForProjection(O){return this.tileGrid?this.tileGrid:getForProjection(O)}getTilePixelRatio(O){return this.tilePixelRatio_}getTilePixelSize(O,Y,te){const ne=this.getTileGridForProjection(te),xe=this.getTilePixelRatio(Y),et=toSize(ne.getTileSize(O),this.tmpSize);return xe==1?et:scale$1(et,xe,this.tmpSize)}getTileCoordForTileUrlFunction(O,Y){const te=Y!==void 0?Y:this.getProjection(),ne=Y!==void 0?this.getTileGridForProjection(te):this.tileGrid||this.getTileGridForProjection(te);return this.getWrapX()&&te.isGlobal()&&(O=wrapX(ne,O,te)),withinExtentAndZ(O,ne)?O:null}clear(){}refresh(){this.clear(),super.refresh()}}class TileSourceEvent extends BaseEvent{constructor(O,Y){super(O),this.tile=Y}}const TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class UrlTile extends TileSource{constructor(O){super({attributions:O.attributions,cacheSize:O.cacheSize,projection:O.projection,state:O.state,tileGrid:O.tileGrid,tilePixelRatio:O.tilePixelRatio,wrapX:O.wrapX,transition:O.transition,interpolate:O.interpolate,key:O.key,attributionsCollapsible:O.attributionsCollapsible,zDirection:O.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=O.tileLoadFunction,O.tileUrlFunction&&(this.tileUrlFunction=O.tileUrlFunction),this.urls=null,O.urls?this.setUrls(O.urls):O.url&&this.setUrl(O.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(O){const Y=O.target,te=getUid(Y),ne=Y.getState();let xe;ne==TileState.LOADING?(this.tileLoadingKeys_[te]=!0,xe=TileEventType.TILELOADSTART):te in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[te],xe=ne==TileState.ERROR?TileEventType.TILELOADERROR:ne==TileState.LOADED?TileEventType.TILELOADEND:void 0),xe!=null&&this.dispatchEvent(new TileSourceEvent(xe,Y))}setTileLoadFunction(O){this.tileLoadFunction=O,this.changed()}setTileUrlFunction(O,Y){this.tileUrlFunction=O,typeof Y<"u"?this.setKey(Y):this.changed()}setUrl(O){const Y=expandUrl(O);this.urls=Y,this.setUrls(Y)}setUrls(O){this.urls=O;const Y=O.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(O,this.tileGrid),Y):this.setKey(Y)}tileUrlFunction(O,Y,te){}}class TileImage extends UrlTile{constructor(O){super({attributions:O.attributions,cacheSize:O.cacheSize,projection:O.projection,state:O.state,tileGrid:O.tileGrid,tileLoadFunction:O.tileLoadFunction?O.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:O.tilePixelRatio,tileUrlFunction:O.tileUrlFunction,url:O.url,urls:O.urls,wrapX:O.wrapX,transition:O.transition,interpolate:O.interpolate!==void 0?O.interpolate:!0,key:O.key,attributionsCollapsible:O.attributionsCollapsible,zDirection:O.zDirection}),this.crossOrigin=O.crossOrigin!==void 0?O.crossOrigin:null,this.tileClass=O.tileClass!==void 0?O.tileClass:ImageTile,this.tileGridForProjection={},this.reprojectionErrorThreshold_=O.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(O){return this.getProjection()&&O&&!equivalent$1(this.getProjection(),O)?0:this.getGutter()}getGutter(){return 0}getKey(){let O=super.getKey();return this.getInterpolate()||(O+=":disable-interpolation"),O}getTileGridForProjection(O){const Y=this.getProjection();if(this.tileGrid&&(!Y||equivalent$1(Y,O)))return this.tileGrid;const te=getUid(O);return te in this.tileGridForProjection||(this.tileGridForProjection[te]=getForProjection(O)),this.tileGridForProjection[te]}createTile_(O,Y,te,ne,xe,et){const tt=[O,Y,te],it=this.getTileCoordForTileUrlFunction(tt,xe),st=it?this.tileUrlFunction(it,ne,xe):void 0,ot=new this.tileClass(tt,st!==void 0?TileState.IDLE:TileState.EMPTY,st!==void 0?st:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return ot.key=et,ot.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),ot}getTile(O,Y,te,ne,xe,et){const tt=this.getProjection();if(!tt||!xe||equivalent$1(tt,xe))return this.getTileInternal(O,Y,te,ne,tt||xe);const it=[O,Y,te],st=this.getKey(),ot=this.getTileGridForProjection(tt),rt=this.getTileGridForProjection(xe),nt=this.getTileCoordForTileUrlFunction(it,xe),at=new ReprojTile(tt,ot,xe,rt,it,nt,this.getTilePixelRatio(ne),this.getGutter(),(ct,ut,dt,ht)=>this.getTileInternal(ct,ut,dt,ht,tt,et),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return at.key=st,at}getTileInternal(O,Y,te,ne,xe,et){const tt=this.getKey(),it=getCacheKey$1(this,tt,O,Y,te);if(et&&et.containsKey(it))return et.get(it);const st=this.createTile_(O,Y,te,ne,xe,tt);return et?.set(it,st),st}setRenderReprojectionEdges(O){this.renderReprojectionEdges_!=O&&(this.renderReprojectionEdges_=O,this.changed())}setTileGridForProjection(O,Y){const te=get$2(O);if(te){const ne=getUid(te);ne in this.tileGridForProjection||(this.tileGridForProjection[ne]=Y)}}}function defaultTileLoadFunction(ee,O){if(WORKER_OFFSCREEN_CANVAS){const Y=ee.getCrossOrigin();let te="same-origin",ne="same-origin";Y==="anonymous"||Y===""?(te="cors",ne="omit"):Y==="use-credentials"&&(te="cors",ne="include"),fetch(O,{mode:te,credentials:ne}).then(xe=>{if(!xe.ok)throw new Error(`HTTP ${xe.status}`);return xe.blob()}).then(xe=>createImageBitmap(xe)).then(xe=>{const et=ee.getImage();et.width=xe.width,et.height=xe.height,et.getContext("2d").drawImage(xe,0,0),xe.close?.(),et.dispatchEvent(new Event("load"))}).catch(()=>{ee.getImage().dispatchEvent(new Event("error"))});return}ee.getImage().src=O}function quadKey(ee){const O=ee[0],Y=new Array(O);let te=1<<O-1,ne,xe;for(ne=0;ne<O;++ne)xe=48,ee[1]&te&&(xe+=1),ee[2]&te&&(xe+=2),Y[ne]=String.fromCharCode(xe),te>>=1;return Y.join("")}const TOS_ATTRIBUTION='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class BingMaps extends TileImage{constructor(O){const Y=O.hidpi!==void 0?O.hidpi:!1;super({cacheSize:O.cacheSize,crossOrigin:"anonymous",interpolate:O.interpolate,projection:get$2("EPSG:3857"),reprojectionErrorThreshold:O.reprojectionErrorThreshold,state:"loading",tileLoadFunction:O.tileLoadFunction,tilePixelRatio:Y?2:1,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition,zDirection:O.zDirection}),this.hidpi_=Y,this.culture_=O.culture!==void 0?O.culture:"en-us",this.maxZoom_=O.maxZoom!==void 0?O.maxZoom:-1,this.apiKey_=O.key,this.imagerySet_=O.imagerySet,this.placeholderTiles_=O.placeholderTiles;const te=(O.url||"https://dev.virtualearth.net/REST/v1/Imagery/Metadata/")+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(te).then(ne=>ne.json()).then(ne=>this.handleImageryMetadataResponse(ne))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(O){if(O.statusCode!=200||O.statusDescription!="OK"||O.authenticationResultCode!="ValidCredentials"||O.resourceSets.length!=1||O.resourceSets[0].resources.length!=1){this.setState("error");return}const Y=O.resourceSets[0].resources[0],te=this.maxZoom_==-1?Y.zoomMax:this.maxZoom_,ne=this.getProjection(),xe=extentFromProjection(ne),et=this.hidpi_?2:1,tt=Y.imageWidth==Y.imageHeight?Y.imageWidth/et:[Y.imageWidth/et,Y.imageHeight/et],it=createXYZ({extent:xe,minZoom:Y.zoomMin,maxZoom:te,tileSize:tt});this.tileGrid=it;const st=this.culture_,ot=this.hidpi_,rt=this.placeholderTiles_;if(this.tileUrlFunction=createFromTileUrlFunctions(Y.imageUrlSubdomains.map(function(nt){const at=[0,0,0],ct=Y.imageUrl.replace("{subdomain}",nt).replace("{culture}",st);return(function(ut,dt,ht){if(!ut)return;createOrUpdate(ut[0],ut[1],ut[2],at);const pt=new URL(ct.replace("{quadkey}",quadKey(at))),ft=pt.searchParams;return ot&&(ft.set("dpi","d1"),ft.set("device","mobile")),rt===!0?ft.delete("n"):rt===!1&&ft.set("n","z"),pt.toString()})})),Y.imageryProviders){const nt=getTransformFromProjections(get$2("EPSG:4326"),this.getProjection());this.setAttributions(at=>{const ct=[],ut=at.viewState,dt=this.getTileGrid(),ht=dt.getZForResolution(ut.resolution,this.zDirection),ft=dt.getTileCoordForCoordAndZ(ut.center,ht)[0];return Y.imageryProviders.map(function(mt){let yt=!1;const bt=mt.coverageAreas;for(let vt=0,Et=bt.length;vt<Et;++vt){const wt=bt[vt];if(ft>=wt.zoomMin&&ft<=wt.zoomMax){const St=wt.bbox,Ot=[St[1],St[0],St[3],St[2]],$t=applyTransform(Ot,nt);if(intersects$1($t,at.extent)){yt=!0;break}}}yt&&ct.push(mt.attribution)}),ct.push(TOS_ATTRIBUTION),ct})}this.setState("ready")}}class XYZ extends TileImage{constructor(O){O=O||{};const Y=O.projection!==void 0?O.projection:"EPSG:3857",te=O.tileGrid!==void 0?O.tileGrid:createXYZ({extent:extentFromProjection(Y),maxResolution:O.maxResolution,maxZoom:O.maxZoom,minZoom:O.minZoom,tileSize:O.tileSize});super({attributions:O.attributions,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:Y,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileGrid:te,tileLoadFunction:O.tileLoadFunction,tilePixelRatio:O.tilePixelRatio,tileUrlFunction:O.tileUrlFunction,url:O.url,urls:O.urls,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition,attributionsCollapsible:O.attributionsCollapsible,zDirection:O.zDirection}),this.gutter_=O.gutter!==void 0?O.gutter:0}getGutter(){return this.gutter_}}class CartoDB extends XYZ{constructor(O){super({attributions:O.attributions,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,maxZoom:O.maxZoom!==void 0?O.maxZoom:18,minZoom:O.minZoom,projection:O.projection,transition:O.transition,wrapX:O.wrapX,zDirection:O.zDirection}),this.account_=O.account,this.mapId_=O.map||"",this.config_=O.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(O){Object.assign(this.config_,O),this.initializeMap_()}setConfig(O){this.config_=O||{},this.initializeMap_()}initializeMap_(){const O=JSON.stringify(this.config_);if(this.templateCache_[O]){this.applyTemplate_(this.templateCache_[O]);return}let Y="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(Y+="/named/"+this.mapId_);const te=new XMLHttpRequest;te.addEventListener("load",this.handleInitResponse_.bind(this,O)),te.addEventListener("error",this.handleInitError_.bind(this)),te.open("POST",Y),te.setRequestHeader("Content-type","application/json"),te.send(JSON.stringify(this.config_))}handleInitResponse_(O,Y){const te=Y.target;if(!te.status||te.status>=200&&te.status<300){let ne;try{ne=JSON.parse(te.responseText)}catch{this.setState("error");return}this.applyTemplate_(ne),this.templateCache_[O]=ne,this.setState("ready")}else this.setState("error")}handleInitError_(O){this.setState("error")}applyTemplate_(O){const Y="https://"+O.cdn_url.https+"/"+this.account_+"/api/v1/map/"+O.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(Y)}}class Cluster extends VectorSource{constructor(O){O=O||{},super({attributions:O.attributions,wrapX:O.wrapX}),this.resolution=void 0,this.distance=O.distance!==void 0?O.distance:20,this.minDistance=O.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=O.geometryFunction||function(Y){const te=Y.getGeometry();return assert(!te||te.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),te},this.createCustomCluster_=O.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(O.source||null)}clear(O){this.features.length=0,super.clear(O)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(O,Y,te){this.source?.loadFeatures(O,Y,te),Y!==this.resolution&&(this.resolution=Y,this.refresh())}setDistance(O){this.updateDistance(O,this.minDistance)}setMinDistance(O){this.updateDistance(this.distance,O)}getMinDistance(){return this.minDistance}setSource(O){this.source&&this.source.removeEventListener(EventType.CHANGE,this.boundRefresh_),this.source=O,O&&O.addEventListener(EventType.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(O,Y){const te=O===0?0:Math.min(Y,O)/O,ne=O!==this.distance||this.interpolationRatio!==te;this.distance=O,this.minDistance=Y,this.interpolationRatio=te,ne&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const O=createEmpty(),Y=this.distance*this.resolution,te=this.source.getFeatures(),ne={};for(let xe=0,et=te.length;xe<et;xe++){const tt=te[xe];if(!(getUid(tt)in ne)){const it=this.geometryFunction(tt);if(it){const st=it.getCoordinates();createOrUpdateFromCoordinate(st,O),buffer$1(O,Y,O);const ot=this.source.getFeaturesInExtent(O).filter(function(rt){const nt=getUid(rt);return nt in ne?!1:(ne[nt]=!0,!0)});this.features.push(this.createCluster(ot,O))}}}}createCluster(O,Y){const te=[0,0];for(let tt=O.length-1;tt>=0;--tt){const it=this.geometryFunction(O[tt]);it?add$2(te,it.getCoordinates()):O.splice(tt,1)}scale$4(te,1/O.length);const ne=getCenter(Y),xe=this.interpolationRatio,et=new Point([te[0]*(1-xe)+ne[0]*xe,te[1]*(1-xe)+ne[1]*xe]);return this.createCustomCluster_?this.createCustomCluster_(et,O):new Feature({geometry:et,features:O})}}function asImageLike(ee){return ee instanceof Image||ee instanceof HTMLCanvasElement||ee instanceof HTMLVideoElement||ee instanceof ImageBitmap?ee:null}function asArrayLike(ee){return ee instanceof Uint8Array||ee instanceof Uint8ClampedArray||ee instanceof Float32Array||ee instanceof DataView?ee:null}const disposedError=new Error("disposed");let sharedContext$1=null;function toArray(ee){sharedContext$1||(sharedContext$1=createCanvasContext2D(ee.width,ee.height,void 0,{willReadFrequently:!0}));const O=sharedContext$1.canvas,Y=ee.width;O.width!==Y&&(O.width=Y);const te=ee.height;return O.height!==te&&(O.height=te),sharedContext$1.clearRect(0,0,Y,te),sharedContext$1.drawImage(ee,0,0),sharedContext$1.getImageData(0,0,Y,te).data}const defaultSize=[256,256];class DataTile extends Tile{constructor(O){const Y=TileState.IDLE;super(O.tileCoord,Y,{transition:O.transition,interpolate:O.interpolate}),this.loader_=O.loader,this.data_=null,this.error_=null,this.size_=O.size||null,this.controller_=O.controller||null}getSize(){if(this.size_)return this.size_;const O=asImageLike(this.data_);return O?[O.width,O.height]:defaultSize}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();const O=this;this.loader_().then(function(Y){O.data_=Y,O.state=TileState.LOADED,O.changed()}).catch(function(Y){O.error_=Y,O.state=TileState.ERROR,O.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(disposedError),this.controller_=null),super.disposeInternal()}}function create$1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fromTransform(ee,O){return ee[0]=O[0],ee[1]=O[1],ee[4]=O[2],ee[5]=O[3],ee[12]=O[4],ee[13]=O[5],ee}function orthographic(ee,O,Y,te,ne,xe,et){et=et??create$1();const tt=1/(ee-O),it=1/(Y-te),st=1/(ne-xe);return et[0]=-2*tt,et[1]=0,et[2]=0,et[3]=0,et[4]=0,et[5]=-2*it,et[6]=0,et[7]=0,et[8]=0,et[9]=0,et[10]=2*st,et[11]=0,et[12]=(ee+O)*tt,et[13]=(te+Y)*it,et[14]=(xe+ne)*st,et[15]=1,et}function scale(ee,O,Y,te,ne){return ne=ne??create$1(),ne[0]=ee[0]*O,ne[1]=ee[1]*O,ne[2]=ee[2]*O,ne[3]=ee[3]*O,ne[4]=ee[4]*Y,ne[5]=ee[5]*Y,ne[6]=ee[6]*Y,ne[7]=ee[7]*Y,ne[8]=ee[8]*te,ne[9]=ee[9]*te,ne[10]=ee[10]*te,ne[11]=ee[11]*te,ne[12]=ee[12],ne[13]=ee[13],ne[14]=ee[14],ne[15]=ee[15],ne}function translate(ee,O,Y,te,ne){ne=ne??create$1();let xe,et,tt,it,st,ot,rt,nt,at,ct,ut,dt;return ee===ne?(ne[12]=ee[0]*O+ee[4]*Y+ee[8]*te+ee[12],ne[13]=ee[1]*O+ee[5]*Y+ee[9]*te+ee[13],ne[14]=ee[2]*O+ee[6]*Y+ee[10]*te+ee[14],ne[15]=ee[3]*O+ee[7]*Y+ee[11]*te+ee[15]):(xe=ee[0],et=ee[1],tt=ee[2],it=ee[3],st=ee[4],ot=ee[5],rt=ee[6],nt=ee[7],at=ee[8],ct=ee[9],ut=ee[10],dt=ee[11],ne[0]=xe,ne[1]=et,ne[2]=tt,ne[3]=it,ne[4]=st,ne[5]=ot,ne[6]=rt,ne[7]=nt,ne[8]=at,ne[9]=ct,ne[10]=ut,ne[11]=dt,ne[12]=xe*O+st*Y+at*te+ee[12],ne[13]=et*O+ot*Y+ct*te+ee[13],ne[14]=tt*O+rt*Y+ut*te+ee[14],ne[15]=it*O+nt*Y+dt*te+ee[15]),ne}function translation(ee,O,Y,te){return te=te??create$1(),te[0]=1,te[1]=0,te[2]=0,te[3]=0,te[4]=0,te[5]=1,te[6]=0,te[7]=0,te[8]=0,te[9]=0,te[10]=1,te[11]=0,te[12]=ee,te[13]=O,te[14]=Y,te[15]=1,te}const VERTEX_SHADER=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,FRAGMENT_SHADER=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Canvas{constructor(O){this.gl_=O,this.program_=createProgram(O,FRAGMENT_SHADER,VERTEX_SHADER),this.positionLocation=O.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=O.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=O.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=O.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=O.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],O.bufferData(O.ARRAY_BUFFER,new Float32Array(this.positions),O.STATIC_DRAW),this.texcoordBuffer=O.createBuffer(),O.bindBuffer(O.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],O.bufferData(O.ARRAY_BUFFER,new Float32Array(this.texcoords),O.STATIC_DRAW)}drawImage(O,Y,te,ne,xe,et,tt,it,st,ot,rt,nt,at){const ct=this.gl_;it===void 0&&(it=ne),st===void 0&&(st=xe),et===void 0&&(et=Y),tt===void 0&&(tt=te),ot===void 0&&(ot=et),rt===void 0&&(rt=tt),nt===void 0&&(nt=ct.canvas.width),at===void 0&&(at=ct.canvas.height),ct.bindTexture(ct.TEXTURE_2D,O),ct.useProgram(this.program_),ct.bindBuffer(ct.ARRAY_BUFFER,this.positionBuffer),ct.enableVertexAttribArray(this.positionLocation),ct.vertexAttribPointer(this.positionLocation,2,ct.FLOAT,!1,0,0),ct.bindBuffer(ct.ARRAY_BUFFER,this.texcoordBuffer),ct.enableVertexAttribArray(this.texcoordLocation),ct.vertexAttribPointer(this.texcoordLocation,2,ct.FLOAT,!1,0,0);let ut=orthographic(0,nt,0,at,-1,1);ut=translate(ut,it,st,0),ut=scale(ut,ot,rt,1),ct.uniformMatrix4fv(this.matrixLocation,!1,ut);let dt=translation(ne/Y,xe/te,0);dt=scale(dt,et/Y,tt/te,1),ct.uniformMatrix4fv(this.textureMatrixLocation,!1,dt),ct.uniform1i(this.textureLocation,0),ct.drawArrays(ct.TRIANGLES,0,this.positions.length/2)}}function createShader(ee,O,Y){const te=ee.createShader(O);if(te===null)throw new Error("Shader compilation failed");if(ee.shaderSource(te,Y),ee.compileShader(te),!ee.getShaderParameter(te,ee.COMPILE_STATUS)){const ne=ee.getShaderInfoLog(te);throw ne===null?new Error("Shader info log creation failed"):new Error(ne)}return te}function createProgram(ee,O,Y){const te=ee.createProgram(),ne=createShader(ee,ee.VERTEX_SHADER,Y),xe=createShader(ee,ee.FRAGMENT_SHADER,O);if(te===null)throw new Error("Program creation failed");if(ee.attachShader(te,ne),ee.attachShader(te,xe),ee.linkProgram(te),!ee.getProgramParameter(te,ee.LINK_STATUS))throw ee.getProgramInfoLog(te)===null?new Error("Program info log creation failed"):new Error;return te}const EDGE_VERTEX_SHADER=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,EDGE_FRAGMENT_SHADER=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,TRIANGLE_VERTEX_SHADER=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,TRIANGLE_FRAGMENT_SHADER=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function createCanvasContextWebGL(ee,O,Y,te){let ne;return Y&&Y.length?ne=Y.shift():WORKER_OFFSCREEN_CANVAS?ne=new OffscreenCanvas(ee||300,O||300):ne=document.createElement("canvas"),ee&&(ne.width=ee),O&&(ne.height=O),ne.getContext("webgl",te)}function releaseGLCanvas(ee){const O=ee.canvas;O.width=1,O.height=1,ee.clear(ee.COLOR_BUFFER_BIT|ee.DEPTH_BUFFER_BIT|ee.STENCIL_BUFFER_BIT)}const canvasGLPool=[];function render(ee,O,Y,te,ne,xe,et,tt,it,st,ot,rt,nt,at){const ct=Math.round(te*O),ut=Math.round(te*Y);ee.canvas.width=ct,ee.canvas.height=ut;let dt,ht;if(ht=ee.createTexture(),ee.bindTexture(ee.TEXTURE_2D,ht),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),nt?(ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR)):(ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.NEAREST),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.NEAREST)),ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ct,ut,0,ee.RGBA,ot,null),dt=ee.createFramebuffer(),ee.bindFramebuffer(ee.FRAMEBUFFER,dt),ee.framebufferTexture2D(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,ee.TEXTURE_2D,ht,0),dt===null)throw new Error("Could not create framebuffer");if(ht===null)throw new Error("Could not create texture");if(it.length===0)return{width:ct,height:ut,framebuffer:dt,texture:ht};const pt=createEmpty();it.forEach(function(St,Ot,$t){extend$1(pt,St.extent)});let ft,mt,yt;const bt=1/ne;{if(ft=ee.createTexture(),ht===null)throw new Error("Could not create texture");mt=Math.round(getWidth(pt)*bt),yt=Math.round(getHeight(pt)*bt);const St=ee.getParameter(ee.MAX_TEXTURE_SIZE),Ot=Math.max(mt,yt),$t=Ot>St?St/Ot:1,Mt=Math.round(mt*$t),Nt=Math.round(yt*$t);ee.bindTexture(ee.TEXTURE_2D,ft),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),nt?(ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR)):(ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.NEAREST),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.NEAREST)),ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,Mt,Nt,0,ee.RGBA,ot,null);const Rt=ee.createFramebuffer();ee.bindFramebuffer(ee.FRAMEBUFFER,Rt),ee.framebufferTexture2D(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,ee.TEXTURE_2D,ft,0);const Pt=new Canvas(ee);it.forEach(function(kt,Wt,zt){const Kt=(kt.extent[0]-pt[0])*bt*$t,qt=-(kt.extent[3]-pt[3])*bt*$t,Xt=getWidth(kt.extent)*bt*$t,an=getHeight(kt.extent)*bt*$t;if(ee.bindFramebuffer(ee.FRAMEBUFFER,Rt),ee.viewport(0,0,Mt,Nt),kt.clipExtent){const pn=(kt.clipExtent[0]-pt[0])*bt*$t,ln=-(kt.clipExtent[3]-pt[3])*bt*$t,dn=getWidth(kt.clipExtent)*bt*$t,un=getHeight(kt.clipExtent)*bt*$t;ee.enable(ee.SCISSOR_TEST),ee.scissor(nt?pn:Math.round(pn),nt?ln:Math.round(ln),nt?dn:Math.round(pn+dn)-Math.round(pn),nt?un:Math.round(ln+un)-Math.round(ln))}Pt.drawImage(kt.texture,kt.width,kt.height,st,st,kt.width-2*st,kt.height-2*st,nt?Kt:Math.round(Kt),nt?qt:Math.round(qt),nt?Xt:Math.round(Kt+Xt)-Math.round(Kt),nt?an:Math.round(qt+an)-Math.round(qt),Mt,Nt),ee.disable(ee.SCISSOR_TEST)}),ee.deleteFramebuffer(Rt)}const vt=getTopLeft(et),Et=getTopLeft(pt),wt=St=>{const Ot=(St[0][0]-vt[0])/xe*te,$t=-(St[0][1]-vt[1])/xe*te,Mt=(St[1][0]-vt[0])/xe*te,Nt=-(St[1][1]-vt[1])/xe*te,Rt=(St[2][0]-vt[0])/xe*te,Pt=-(St[2][1]-vt[1])/xe*te;return{u1:Mt,v1:Nt,u0:Ot,v0:$t,u2:Rt,v2:Pt}};ee.bindFramebuffer(ee.FRAMEBUFFER,dt),ee.viewport(0,0,ct,ut);{const St=[],Ot=[],$t=createProgram(ee,TRIANGLE_FRAGMENT_SHADER,TRIANGLE_VERTEX_SHADER);ee.useProgram($t);const Mt=ee.getUniformLocation($t,"u_texture");ee.bindTexture(ee.TEXTURE_2D,ft),ee.uniform1i(Mt,0),tt.getTriangles().forEach(function(Kt,qt,Xt){const an=Kt.source,pn=Kt.target,{u1:ln,v1:dn,u0:un,v0:Tn,u2:Sn,v2:bn}=wt(pn),on=(an[0][0]-Et[0])/ne/mt,zn=-(an[0][1]-Et[1])/ne/yt,Ln=(an[1][0]-Et[0])/ne/mt,hn=-(an[1][1]-Et[1])/ne/yt,Hn=(an[2][0]-Et[0])/ne/mt,Wn=-(an[2][1]-Et[1])/ne/yt;St.push(ln,dn,un,Tn,Sn,bn),Ot.push(Ln,hn,on,zn,Hn,Wn)});const Nt=orthographic(0,ct,ut,0,-1,1),Rt=ee.getUniformLocation($t,"u_matrix");ee.uniformMatrix4fv(Rt,!1,Nt);const Pt=ee.getAttribLocation($t,"a_position"),kt=ee.createBuffer();ee.bindBuffer(ee.ARRAY_BUFFER,kt),ee.bufferData(ee.ARRAY_BUFFER,new Float32Array(St),ee.STATIC_DRAW),ee.vertexAttribPointer(Pt,2,ee.FLOAT,!1,0,0),ee.enableVertexAttribArray(Pt);const Wt=ee.getAttribLocation($t,"a_texcoord"),zt=ee.createBuffer();ee.bindBuffer(ee.ARRAY_BUFFER,zt),ee.bufferData(ee.ARRAY_BUFFER,new Float32Array(Ot),ee.STATIC_DRAW),ee.vertexAttribPointer(Wt,2,ee.FLOAT,!1,0,0),ee.enableVertexAttribArray(Wt),ee.drawArrays(ee.TRIANGLES,0,St.length/2)}if(rt){const St=createProgram(ee,EDGE_FRAGMENT_SHADER,EDGE_VERTEX_SHADER);ee.useProgram(St);const Ot=orthographic(0,ct,ut,0,-1,1),$t=ee.getUniformLocation(St,"u_matrix");ee.uniformMatrix4fv($t,!1,Ot);const Mt=Array.isArray(rt)?rt:[0,0,0,255],Nt=ee.getUniformLocation(St,"u_val");ee.uniform4fv(Nt,Mt);const Rt=ee.getAttribLocation(St,"a_position"),Pt=ee.createBuffer();ee.bindBuffer(ee.ARRAY_BUFFER,Pt),ee.vertexAttribPointer(Rt,2,ee.FLOAT,!1,0,0),ee.enableVertexAttribArray(Rt);const kt=tt.getTriangles().reduce(function(Wt,zt){const Kt=zt.target,{u1:qt,v1:Xt,u0:an,v0:pn,u2:ln,v2:dn}=wt(Kt);return Wt.concat([qt,Xt,an,pn,an,pn,ln,dn,ln,dn,qt,Xt])},[]);ee.bufferData(ee.ARRAY_BUFFER,new Float32Array(kt),ee.STATIC_DRAW),ee.drawArrays(ee.LINES,0,kt.length/2)}return{width:ct,height:ut,framebuffer:dt,texture:ht}}class ReprojDataTile extends DataTile{constructor(O){super({tileCoord:O.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:O.interpolate,transition:O.transition}),this.renderEdges_=O.renderEdges!==void 0?O.renderEdges:!1,this.pixelRatio_=O.pixelRatio,this.gutter_=O.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=O.sourceTileGrid,this.targetTileGrid_=O.targetTileGrid,this.wrappedTileCoord_=O.wrappedTileCoord||O.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const Y=O.sourceProj,te=Y.getExtent(),ne=O.sourceTileGrid.getExtent();this.clipExtent_=Y.canWrapX()?ne?getIntersection(te,ne):te:ne;const xe=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),et=this.targetTileGrid_.getExtent();let tt=this.sourceTileGrid_.getExtent();const it=et?getIntersection(xe,et):xe;if(getArea$1(it)===0){this.state=TileState.EMPTY;return}te&&(tt?tt=getIntersection(tt,te):tt=te);const st=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),ot=O.targetProj,rt=calculateSourceExtentResolution(Y,ot,it,st);if(!isFinite(rt)||rt<=0){this.state=TileState.EMPTY;return}const nt=O.errorThreshold!==void 0?O.errorThreshold:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(Y,ot,it,tt,rt*nt,st,O.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(rt);let at=this.triangulation_.calculateSourceExtent();if(tt&&(Y.canWrapX()?(at[1]=clamp$1(at[1],tt[1],tt[3]),at[3]=clamp$1(at[3],tt[1],tt[3])):at=getIntersection(at,tt)),!getArea$1(at))this.state=TileState.EMPTY;else{let ct=0,ut=0;Y.canWrapX()&&(ct=getWidth(te),ut=Math.floor((at[0]-te[0])/ct)),wrapAndSliceX(at.slice(),Y,!0).forEach(ht=>{const pt=this.sourceTileGrid_.getTileRangeForExtentAndZ(ht,this.sourceZ_),ft=O.getTileFunction;for(let mt=pt.minX;mt<=pt.maxX;mt++)for(let yt=pt.minY;yt<=pt.maxY;yt++){const bt=ft(this.sourceZ_,mt,yt,this.pixelRatio_);if(bt){const vt=ut*ct;this.sourceTiles_.push({tile:bt,offset:vt})}}++ut}),this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const O=[];let Y=!1;if(this.sourceTiles_.forEach(mt=>{const yt=mt.tile;if(!yt||yt.getState()!==TileState.LOADED)return;const bt=yt.getSize(),vt=this.gutter_;let Et;const wt=asArrayLike(yt.getData());wt?Et=wt:(Y=!0,Et=toArray(asImageLike(yt.getData())));const St=[bt[0]+2*vt,bt[1]+2*vt],Ot=Et instanceof Float32Array,$t=St[0]*St[1],Mt=Ot?Float32Array:Uint8ClampedArray,Nt=new Mt(Et.buffer),Rt=Mt.BYTES_PER_ELEMENT,Pt=Rt*Nt.length/$t,kt=Nt.byteLength/St[1],Wt=Math.floor(kt/Rt/St[0]),zt=this.sourceTileGrid_.getTileCoordExtent(yt.tileCoord);zt[0]+=mt.offset,zt[2]+=mt.offset;const Kt=this.clipExtent_?.slice();Kt&&(Kt[0]+=mt.offset,Kt[2]+=mt.offset),O.push({extent:zt,clipExtent:Kt,data:Nt,dataType:Mt,bytesPerPixel:Pt,pixelSize:St,bandCount:Wt})}),this.sourceTiles_.length=0,O.length===0){this.state=TileState.ERROR,this.changed();return}const te=this.wrappedTileCoord_[0],ne=this.targetTileGrid_.getTileSize(te),xe=typeof ne=="number"?ne:ne[0],et=typeof ne=="number"?ne:ne[1],tt=Math.round(xe*this.pixelRatio_),it=Math.round(et*this.pixelRatio_),st=this.targetTileGrid_.getResolution(te),ot=this.sourceTileGrid_.getResolution(this.sourceZ_),rt=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),nt=O[0].bandCount,at=new O[0].dataType(nt*tt*it),ct=createCanvasContextWebGL(tt,it,canvasGLPool,{premultipliedAlpha:!1,antialias:!1});let ut;const dt=ct.RGBA;let ht;O[0].dataType==Float32Array?(ht=ct.FLOAT,ct.getExtension("WEBGL_color_buffer_float"),ct.getExtension("OES_texture_float"),ct.getExtension("EXT_float_blend"),ut=ct.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(ht=ct.UNSIGNED_BYTE,ut=this.interpolate);const pt=4,ft=Math.ceil(nt/pt);for(let mt=ft-1;mt>=0;--mt){const yt=[];for(let Mt=0,Nt=O.length;Mt<Nt;++Mt){const Rt=O[Mt],Pt=Rt.pixelSize,kt=Pt[0],Wt=Pt[1],zt=new Rt.dataType(pt*kt*Wt),Kt=Rt.data;let qt=mt*pt;for(let an=0,pn=zt.length;an<pn;an+=pt)zt[an]=Kt[qt],zt[an+1]=Kt[qt+1],zt[an+2]=Kt[qt+2],zt[an+3]=Kt[qt+3],qt+=nt;const Xt=ct.createTexture();ct.bindTexture(ct.TEXTURE_2D,Xt),ut?(ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_MIN_FILTER,ct.LINEAR),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_MAG_FILTER,ct.LINEAR)):(ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_MIN_FILTER,ct.NEAREST),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_MAG_FILTER,ct.NEAREST)),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_WRAP_S,ct.CLAMP_TO_EDGE),ct.texParameteri(ct.TEXTURE_2D,ct.TEXTURE_WRAP_T,ct.CLAMP_TO_EDGE),ct.texImage2D(ct.TEXTURE_2D,0,dt,kt,Wt,0,dt,ht,zt),yt.push({extent:Rt.extent,clipExtent:Rt.clipExtent,texture:Xt,width:kt,height:Wt})}const{framebuffer:bt,width:vt,height:Et}=render(ct,xe,et,this.pixelRatio_,ot,st,rt,this.triangulation_,yt,this.gutter_,ht,this.renderEdges_,ut),wt=vt,St=Et*pt,Ot=new O[0].dataType(wt*St);ct.bindFramebuffer(ct.FRAMEBUFFER,bt),ct.readPixels(0,0,vt,Et,ct.RGBA,ht,Ot);let $t=mt*pt;for(let Mt=0,Nt=Ot.length;Mt<Nt;Mt+=pt){const Rt=(wt-1-(Mt/St|0))*St+Mt%St;at[$t]=Ot[Rt],at[$t+1]=Ot[Rt+1],at[$t+2]=Ot[Rt+2],at[$t+3]=Ot[Rt+3],$t+=nt}}if(releaseGLCanvas(ct),canvasGLPool.push(ct.canvas),Y){const mt=createCanvasContext2D(xe,et),yt=new ImageData(at,xe);mt.putImageData(yt,0,0),this.reprojData_=mt.canvas}else this.reprojData_=at;this.reprojSize_=[tt,it],this.state=TileState.LOADED,this.changed()}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();let O=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:Y})=>{const te=Y.getState();if(te!==TileState.IDLE&&te!==TileState.LOADING)return;O++;const ne=listen(Y,EventType.CHANGE,()=>{const xe=Y.getState();(xe==TileState.LOADED||xe==TileState.ERROR||xe==TileState.EMPTY)&&(unlistenByKey(ne),O--,O===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(ne)}),O===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:Y}){Y.getState()==TileState.IDLE&&Y.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}}class DataTileSource extends TileSource{constructor(O){const Y=O.projection===void 0?"EPSG:3857":O.projection;let te=O.tileGrid;te===void 0&&Y&&(te=createXYZ({extent:extentFromProjection(Y),maxResolution:O.maxResolution,maxZoom:O.maxZoom,minZoom:O.minZoom,tileSize:O.tileSize})),super({cacheSize:.1,attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,projection:Y,tileGrid:te,state:O.state,wrapX:O.wrapX,transition:O.transition,interpolate:O.interpolate,key:O.key,zDirection:O.zDirection}),this.gutter_=O.gutter!==void 0?O.gutter:0,this.tileSize_=O.tileSize?toSize(O.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=O.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=O.bandCount===void 0?4:O.bandCount,this.tileGridForProjection_={},this.crossOrigin_=O.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(O){this.tileSizes_=O}getTileSize(O){if(this.tileSizes_)return this.tileSizes_[O];if(this.tileSize_)return this.tileSize_;const Y=this.getTileGrid();return Y?toSize(Y.getTileSize(O)):[256,256]}getGutterForProjection(O){const Y=this.getProjection();return(!Y||equivalent$1(Y,O))&&!this.transformMatrix?this.gutter_:0}setLoader(O){this.loader_=O}getReprojTile_(O,Y,te,ne,xe,et){const tt=this.tileGrid||this.getTileGridForProjection(xe||ne),it=Math.max.apply(null,tt.getResolutions().map((ct,ut)=>{const dt=toSize(tt.getTileSize(ut)),ht=this.getTileSize(ut);return Math.max(ht[0]/dt[0],ht[1]/dt[1])})),st=this.getTileGridForProjection(ne),ot=[O,Y,te],rt=this.getTileCoordForTileUrlFunction(ot,ne),nt=Object.assign({sourceProj:xe||ne,sourceTileGrid:tt,targetProj:ne,targetTileGrid:st,tileCoord:ot,wrappedTileCoord:rt,pixelRatio:it,gutter:this.gutter_,getTileFunction:(ct,ut,dt,ht)=>this.getTile(ct,ut,dt,ht,void 0,et),transformMatrix:this.transformMatrix},this.tileOptions),at=new ReprojDataTile(nt);return at.key=this.getKey(),at}getTile(O,Y,te,ne,xe,et){const tt=this.getProjection();if(xe&&(tt&&!equivalent$1(tt,xe)||this.transformMatrix))return this.getReprojTile_(O,Y,te,xe,tt,et);const it=this.getTileSize(O),st=this.loader_,ot=new AbortController,rt={signal:ot.signal,crossOrigin:this.crossOrigin_},nt=this.getTileCoordForTileUrlFunction([O,Y,te]);if(!nt)return null;const at=this.getKey(),ct=getCacheKey$1(this,at,O,Y,te);if(et&&et.containsKey(ct))return et.get(ct);const ut=nt[0],dt=nt[1],ht=nt[2],pt=this.getTileGrid()?.getFullTileRange(ut);pt&&(rt.maxY=pt.getHeight()-1);function ft(){return toPromise(function(){return st(ut,dt,ht,rt)})}const mt=Object.assign({tileCoord:[O,Y,te],loader:ft,size:it,controller:ot},this.tileOptions),yt=new DataTile(mt);return yt.key=this.getKey(),yt.addEventListener(EventType.CHANGE,this.handleTileChange_),et?.set(ct,yt),yt}handleTileChange_(O){const Y=O.target,te=getUid(Y),ne=Y.getState();let xe;ne==TileState.LOADING?(this.tileLoadingKeys_[te]=!0,xe=TileEventType.TILELOADSTART):te in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[te],xe=ne==TileState.ERROR?TileEventType.TILELOADERROR:ne==TileState.LOADED?TileEventType.TILELOADEND:void 0),xe&&this.dispatchEvent(new TileSourceEvent(xe,Y))}getTileGridForProjection(O){const Y=this.getProjection();if(this.tileGrid&&(!Y||equivalent$1(Y,O))&&!this.transformMatrix)return this.tileGrid;const te=getUid(O);return te in this.tileGridForProjection_||(this.tileGridForProjection_[te]=getForProjection(O)),this.tileGridForProjection_[te]}setTileGridForProjection(O,Y){const te=get$2(O);if(te){const ne=getUid(te);ne in this.tileGridForProjection_||(this.tileGridForProjection_[ne]=Y)}}}function uncurryThis(ee){return(O,...Y)=>ReflectApply(ee,O,Y)}function uncurryThisGetter(ee,O){return uncurryThis(ReflectGetOwnPropertyDescriptor(ee,O).get)}const{apply:ReflectApply,getOwnPropertyDescriptor:ReflectGetOwnPropertyDescriptor,getPrototypeOf:ReflectGetPrototypeOf,ownKeys:ReflectOwnKeys}=Reflect,{iterator:SymbolIterator,toStringTag:SymbolToStringTag}=Symbol,NativeObject=Object,{create:ObjectCreate,defineProperty:ObjectDefineProperty}=NativeObject,NativeArray=Array,ArrayPrototype=NativeArray.prototype,NativeArrayPrototypeSymbolIterator=ArrayPrototype[SymbolIterator],ArrayPrototypeSymbolIterator=uncurryThis(NativeArrayPrototypeSymbolIterator),NativeArrayBuffer=ArrayBuffer,ArrayBufferPrototype=NativeArrayBuffer.prototype;uncurryThisGetter(ArrayBufferPrototype,"byteLength");const NativeSharedArrayBuffer=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;NativeSharedArrayBuffer&&uncurryThisGetter(NativeSharedArrayBuffer.prototype,"byteLength");const TypedArray=ReflectGetPrototypeOf(Uint8Array);TypedArray.from;const TypedArrayPrototype=TypedArray.prototype;TypedArrayPrototype[SymbolIterator];uncurryThis(TypedArrayPrototype.keys);uncurryThis(TypedArrayPrototype.values);uncurryThis(TypedArrayPrototype.entries);uncurryThis(TypedArrayPrototype.set);uncurryThis(TypedArrayPrototype.reverse);uncurryThis(TypedArrayPrototype.fill);uncurryThis(TypedArrayPrototype.copyWithin);uncurryThis(TypedArrayPrototype.sort);uncurryThis(TypedArrayPrototype.slice);uncurryThis(TypedArrayPrototype.subarray);uncurryThisGetter(TypedArrayPrototype,"buffer");uncurryThisGetter(TypedArrayPrototype,"byteOffset");uncurryThisGetter(TypedArrayPrototype,"length");uncurryThisGetter(TypedArrayPrototype,SymbolToStringTag);const NativeUint8Array=Uint8Array,NativeUint16Array=Uint16Array,NativeUint32Array=Uint32Array,NativeFloat32Array=Float32Array,ArrayIteratorPrototype=ReflectGetPrototypeOf([][SymbolIterator]()),ArrayIteratorPrototypeNext=uncurryThis(ArrayIteratorPrototype.next),GeneratorPrototypeNext=uncurryThis((function*(){})().next),IteratorPrototype=ReflectGetPrototypeOf(ArrayIteratorPrototype),DataViewPrototype=DataView.prototype,DataViewPrototypeGetUint16=uncurryThis(DataViewPrototype.getUint16),NativeWeakMap=WeakMap,WeakMapPrototype=NativeWeakMap.prototype,WeakMapPrototypeGet=uncurryThis(WeakMapPrototype.get),WeakMapPrototypeSet=uncurryThis(WeakMapPrototype.set),arrayIterators=new NativeWeakMap,SafeIteratorPrototype=ObjectCreate(null,{next:{value:function ee(){const O=WeakMapPrototypeGet(arrayIterators,this);return ArrayIteratorPrototypeNext(O)}},[SymbolIterator]:{value:function ee(){return this}}});function safeIfNeeded(ee){if(ee[SymbolIterator]===NativeArrayPrototypeSymbolIterator&&ArrayIteratorPrototype.next===ArrayIteratorPrototypeNext)return ee;const O=ObjectCreate(SafeIteratorPrototype);return WeakMapPrototypeSet(arrayIterators,O,ArrayPrototypeSymbolIterator(ee)),O}const generators=new NativeWeakMap,DummyArrayIteratorPrototype=ObjectCreate(IteratorPrototype,{next:{value:function ee(){const O=WeakMapPrototypeGet(generators,this);return GeneratorPrototypeNext(O)},writable:!0,configurable:!0}});for(const ee of ReflectOwnKeys(ArrayIteratorPrototype))ee!=="next"&&ObjectDefineProperty(DummyArrayIteratorPrototype,ee,ReflectGetOwnPropertyDescriptor(ArrayIteratorPrototype,ee));const buffer=new NativeArrayBuffer(4),floatView=new NativeFloat32Array(buffer),uint32View=new NativeUint32Array(buffer),baseTable=new NativeUint16Array(512),shiftTable=new NativeUint8Array(512);for(let ee=0;ee<256;++ee){const O=ee-127;O<-24?(baseTable[ee]=0,baseTable[ee|256]=32768,shiftTable[ee]=24,shiftTable[ee|256]=24):O<-14?(baseTable[ee]=1024>>-O-14,baseTable[ee|256]=1024>>-O-14|32768,shiftTable[ee]=-O-1,shiftTable[ee|256]=-O-1):O<=15?(baseTable[ee]=O+15<<10,baseTable[ee|256]=O+15<<10|32768,shiftTable[ee]=13,shiftTable[ee|256]=13):O<128?(baseTable[ee]=31744,baseTable[ee|256]=64512,shiftTable[ee]=24,shiftTable[ee|256]=24):(baseTable[ee]=31744,baseTable[ee|256]=64512,shiftTable[ee]=13,shiftTable[ee|256]=13)}const mantissaTable=new NativeUint32Array(2048);for(let ee=1;ee<1024;++ee){let O=ee<<13,Y=0;for(;(O&8388608)===0;)O<<=1,Y-=8388608;O&=-8388609,Y+=947912704,mantissaTable[ee]=O|Y}for(let ee=1024;ee<2048;++ee)mantissaTable[ee]=939524096+(ee-1024<<13);const exponentTable=new NativeUint32Array(64);for(let ee=1;ee<31;++ee)exponentTable[ee]=ee<<23;exponentTable[31]=1199570944;exponentTable[32]=2147483648;for(let ee=33;ee<63;++ee)exponentTable[ee]=2147483648+(ee-32<<23);exponentTable[63]=3347054592;const offsetTable=new NativeUint16Array(64);for(let ee=1;ee<64;++ee)ee!==32&&(offsetTable[ee]=1024);function convertToNumber(ee){const O=ee>>10;return uint32View[0]=mantissaTable[offsetTable[O]+(ee&1023)]+exponentTable[O],floatView[0]}function getFloat16(ee,O,...Y){return convertToNumber(DataViewPrototypeGetUint16(ee,O,...safeIfNeeded(Y)))}var getAttribute$1={exports:{}},hasRequiredGetAttribute;function requireGetAttribute(){if(hasRequiredGetAttribute)return getAttribute$1.exports;hasRequiredGetAttribute=1;function ee(O,Y,te){const ne=te&&te.debug||!1;ne&&console.log("[xml-utils] getting "+Y+" in "+O);const xe=typeof O=="object"?O.outer:O,et=xe.slice(0,xe.indexOf(">")+1),tt=['"',"'"];for(let it=0;it<tt.length;it++){const st=tt[it],ot=Y+"\\="+st+"([^"+st+"]*)"+st;ne&&console.log("[xml-utils] pattern:",ot);const nt=new RegExp(ot).exec(et);if(ne&&console.log("[xml-utils] match:",nt),nt)return nt[1]}}return getAttribute$1.exports=ee,getAttribute$1.exports.default=ee,getAttribute$1.exports}var getAttributeExports=requireGetAttribute();const getAttribute=getDefaultExportFromCjs$1(getAttributeExports);var findTagsByName$1={exports:{}},findTagByName={exports:{}},indexOfMatch={exports:{}},hasRequiredIndexOfMatch;function requireIndexOfMatch(){if(hasRequiredIndexOfMatch)return indexOfMatch.exports;hasRequiredIndexOfMatch=1;function ee(O,Y,te){const xe=new RegExp(Y).exec(O.slice(te));return xe?te+xe.index:-1}return indexOfMatch.exports=ee,indexOfMatch.exports.default=ee,indexOfMatch.exports}var indexOfMatchEnd={exports:{}},hasRequiredIndexOfMatchEnd;function requireIndexOfMatchEnd(){if(hasRequiredIndexOfMatchEnd)return indexOfMatchEnd.exports;hasRequiredIndexOfMatchEnd=1;function ee(O,Y,te){const xe=new RegExp(Y).exec(O.slice(te));return xe?te+xe.index+xe[0].length-1:-1}return indexOfMatchEnd.exports=ee,indexOfMatchEnd.exports.default=ee,indexOfMatchEnd.exports}var countSubstring={exports:{}},hasRequiredCountSubstring;function requireCountSubstring(){if(hasRequiredCountSubstring)return countSubstring.exports;hasRequiredCountSubstring=1;function ee(O,Y){const te=new RegExp(Y,"g"),ne=O.match(te);return ne?ne.length:0}return countSubstring.exports=ee,countSubstring.exports.default=ee,countSubstring.exports}var hasRequiredFindTagByName;function requireFindTagByName(){if(hasRequiredFindTagByName)return findTagByName.exports;hasRequiredFindTagByName=1;const ee=requireIndexOfMatch(),O=requireIndexOfMatchEnd(),Y=requireCountSubstring();function te(ne,xe,et){const tt=et&&et.debug||!1,it=!(et&&typeof et.nested===!1),st=et&&et.startIndex||0;tt&&console.log("[xml-utils] starting findTagByName with",xe," and ",et);const ot=ee(ne,`<${xe}[ 
>/]`,st);if(tt&&console.log("[xml-utils] start:",ot),ot===-1)return;const rt=ne.slice(ot+xe.length);let nt=O(rt,"^[^<]*[ /]>",0);const at=nt!==-1&&rt[nt-1]==="/";if(tt&&console.log("[xml-utils] selfClosing:",at),at===!1)if(it){let ht=0,pt=1,ft=0;for(;(nt=O(rt,"[ /]"+xe+">",ht))!==-1;){const mt=rt.substring(ht,nt+1);if(pt+=Y(mt,"<"+xe+`[ 
	>]`),ft+=Y(mt,"</"+xe+">"),ft>=pt)break;ht=nt}}else nt=O(rt,"[ /]"+xe+">",0);const ct=ot+xe.length+nt+1;if(tt&&console.log("[xml-utils] end:",ct),ct===-1)return;const ut=ne.slice(ot,ct);let dt;return at?dt=null:dt=ut.slice(ut.indexOf(">")+1,ut.lastIndexOf("<")),{inner:dt,outer:ut,start:ot,end:ct}}return findTagByName.exports=te,findTagByName.exports.default=te,findTagByName.exports}var hasRequiredFindTagsByName;function requireFindTagsByName(){if(hasRequiredFindTagsByName)return findTagsByName$1.exports;hasRequiredFindTagsByName=1;const ee=requireFindTagByName();function O(Y,te,ne){const xe=[],et=ne&&ne.debug||!1,tt=ne&&typeof ne.nested=="boolean"?ne.nested:!0;let it=ne&&ne.startIndex||0,st;for(;st=ee(Y,te,{debug:et,startIndex:it});)tt?it=st.start+1+te.length:it=st.end,xe.push(st);return et&&console.log("findTagsByName found",xe.length,"tags"),xe}return findTagsByName$1.exports=O,findTagsByName$1.exports.default=O,findTagsByName$1.exports}var findTagsByNameExports=requireFindTagsByName();const findTagsByName=getDefaultExportFromCjs$1(findTagsByNameExports),fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},fieldTags={};for(const ee in fieldTagNames)fieldTagNames.hasOwnProperty(ee)&&(fieldTags[fieldTagNames[ee]]=parseInt(ee,10));const arrayFields=[fieldTags.BitsPerSample,fieldTags.ExtraSamples,fieldTags.SampleFormat,fieldTags.StripByteCounts,fieldTags.StripOffsets,fieldTags.StripRowCounts,fieldTags.TileByteCounts,fieldTags.TileOffsets,fieldTags.SubIFDs],fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},fieldTypes={};for(const ee in fieldTypeNames)fieldTypeNames.hasOwnProperty(ee)&&(fieldTypes[fieldTypeNames[ee]]=parseInt(ee,10));const photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},ExtraSamplesValues={Unspecified:0},LercParameters={AddCompression:1},LercAddCompression={None:0,Deflate:1,Zstandard:2},geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function fromWhiteIsZero(ee,O){const{width:Y,height:te}=ee,ne=new Uint8Array(Y*te*3);let xe;for(let et=0,tt=0;et<ee.length;++et,tt+=3)xe=256-ee[et]/O*256,ne[tt]=xe,ne[tt+1]=xe,ne[tt+2]=xe;return ne}function fromBlackIsZero(ee,O){const{width:Y,height:te}=ee,ne=new Uint8Array(Y*te*3);let xe;for(let et=0,tt=0;et<ee.length;++et,tt+=3)xe=ee[et]/O*256,ne[tt]=xe,ne[tt+1]=xe,ne[tt+2]=xe;return ne}function fromPalette(ee,O){const{width:Y,height:te}=ee,ne=new Uint8Array(Y*te*3),xe=O.length/3,et=O.length/3*2;for(let tt=0,it=0;tt<ee.length;++tt,it+=3){const st=ee[tt];ne[it]=O[st]/65536*256,ne[it+1]=O[st+xe]/65536*256,ne[it+2]=O[st+et]/65536*256}return ne}function fromCMYK(ee){const{width:O,height:Y}=ee,te=new Uint8Array(O*Y*3);for(let ne=0,xe=0;ne<ee.length;ne+=4,xe+=3){const et=ee[ne],tt=ee[ne+1],it=ee[ne+2],st=ee[ne+3];te[xe]=255*((255-et)/256)*((255-st)/256),te[xe+1]=255*((255-tt)/256)*((255-st)/256),te[xe+2]=255*((255-it)/256)*((255-st)/256)}return te}function fromYCbCr(ee){const{width:O,height:Y}=ee,te=new Uint8ClampedArray(O*Y*3);for(let ne=0,xe=0;ne<ee.length;ne+=3,xe+=3){const et=ee[ne],tt=ee[ne+1],it=ee[ne+2];te[xe]=et+1.402*(it-128),te[xe+1]=et-.34414*(tt-128)-.71414*(it-128),te[xe+2]=et+1.772*(tt-128)}return te}const Xn$1=.95047,Yn$1=1,Zn$1=1.08883;function fromCIELab(ee){const{width:O,height:Y}=ee,te=new Uint8Array(O*Y*3);for(let ne=0,xe=0;ne<ee.length;ne+=3,xe+=3){const et=ee[ne+0],tt=ee[ne+1]<<24>>24,it=ee[ne+2]<<24>>24;let st=(et+16)/116,ot=tt/500+st,rt=st-it/200,nt,at,ct;ot=Xn$1*(ot*ot*ot>.008856?ot*ot*ot:(ot-16/116)/7.787),st=Yn$1*(st*st*st>.008856?st*st*st:(st-16/116)/7.787),rt=Zn$1*(rt*rt*rt>.008856?rt*rt*rt:(rt-16/116)/7.787),nt=ot*3.2406+st*-1.5372+rt*-.4986,at=ot*-.9689+st*1.8758+rt*.0415,ct=ot*.0557+st*-.204+rt*1.057,nt=nt>.0031308?1.055*nt**(1/2.4)-.055:12.92*nt,at=at>.0031308?1.055*at**(1/2.4)-.055:12.92*at,ct=ct>.0031308?1.055*ct**(1/2.4)-.055:12.92*ct,te[xe]=Math.max(0,Math.min(1,nt))*255,te[xe+1]=Math.max(0,Math.min(1,at))*255,te[xe+2]=Math.max(0,Math.min(1,ct))*255}return te}const registry=new Map;function addDecoder(ee,O){Array.isArray(ee)||(ee=[ee]),ee.forEach(Y=>registry.set(Y,O))}async function getDecoder(ee){const O=registry.get(ee.Compression);if(!O)throw new Error(`Unknown compression method identifier: ${ee.Compression}`);const Y=await O();return new Y(ee)}addDecoder([void 0,1],()=>__vitePreload(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([26,27])).then(ee=>ee.default));addDecoder(5,()=>__vitePreload(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([28,27])).then(ee=>ee.default));addDecoder(6,()=>{throw new Error("old style JPEG compression is not supported.")});addDecoder(7,()=>__vitePreload(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([29,27])).then(ee=>ee.default));addDecoder([8,32946],()=>__vitePreload(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([30,31,27])).then(ee=>ee.default));addDecoder(32773,()=>__vitePreload(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([32,27])).then(ee=>ee.default));addDecoder(34887,()=>__vitePreload(()=>import("./lerc-EvD1--I0.js"),__vite__mapDeps([33,31,1,27,2])).then(async ee=>(await ee.zstd.init(),ee)).then(ee=>ee.default));addDecoder(50001,()=>__vitePreload(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([34,27])).then(ee=>ee.default));function copyNewSize(ee,O,Y,te=1){return new(Object.getPrototypeOf(ee)).constructor(O*Y*te)}function resampleNearest(ee,O,Y,te,ne){const xe=O/te,et=Y/ne;return ee.map(tt=>{const it=copyNewSize(tt,te,ne);for(let st=0;st<ne;++st){const ot=Math.min(Math.round(et*st),Y-1);for(let rt=0;rt<te;++rt){const nt=Math.min(Math.round(xe*rt),O-1),at=tt[ot*O+nt];it[st*te+rt]=at}}return it})}function lerp(ee,O,Y){return(1-Y)*ee+Y*O}function resampleBilinear(ee,O,Y,te,ne){const xe=O/te,et=Y/ne;return ee.map(tt=>{const it=copyNewSize(tt,te,ne);for(let st=0;st<ne;++st){const ot=et*st,rt=Math.floor(ot),nt=Math.min(Math.ceil(ot),Y-1);for(let at=0;at<te;++at){const ct=xe*at,ut=ct%1,dt=Math.floor(ct),ht=Math.min(Math.ceil(ct),O-1),pt=tt[rt*O+dt],ft=tt[rt*O+ht],mt=tt[nt*O+dt],yt=tt[nt*O+ht],bt=lerp(lerp(pt,ft,ut),lerp(mt,yt,ut),ot%1);it[st*te+at]=bt}}return it})}function resample(ee,O,Y,te,ne,xe="nearest"){switch(xe.toLowerCase()){case"nearest":return resampleNearest(ee,O,Y,te,ne);case"bilinear":case"linear":return resampleBilinear(ee,O,Y,te,ne);default:throw new Error(`Unsupported resampling method: '${xe}'`)}}function resampleNearestInterleaved(ee,O,Y,te,ne,xe){const et=O/te,tt=Y/ne,it=copyNewSize(ee,te,ne,xe);for(let st=0;st<ne;++st){const ot=Math.min(Math.round(tt*st),Y-1);for(let rt=0;rt<te;++rt){const nt=Math.min(Math.round(et*rt),O-1);for(let at=0;at<xe;++at){const ct=ee[ot*O*xe+nt*xe+at];it[st*te*xe+rt*xe+at]=ct}}}return it}function resampleBilinearInterleaved(ee,O,Y,te,ne,xe){const et=O/te,tt=Y/ne,it=copyNewSize(ee,te,ne,xe);for(let st=0;st<ne;++st){const ot=tt*st,rt=Math.floor(ot),nt=Math.min(Math.ceil(ot),Y-1);for(let at=0;at<te;++at){const ct=et*at,ut=ct%1,dt=Math.floor(ct),ht=Math.min(Math.ceil(ct),O-1);for(let pt=0;pt<xe;++pt){const ft=ee[rt*O*xe+dt*xe+pt],mt=ee[rt*O*xe+ht*xe+pt],yt=ee[nt*O*xe+dt*xe+pt],bt=ee[nt*O*xe+ht*xe+pt],vt=lerp(lerp(ft,mt,ut),lerp(yt,bt,ut),ot%1);it[st*te*xe+at*xe+pt]=vt}}}return it}function resampleInterleaved(ee,O,Y,te,ne,xe,et="nearest"){switch(et.toLowerCase()){case"nearest":return resampleNearestInterleaved(ee,O,Y,te,ne,xe);case"bilinear":case"linear":return resampleBilinearInterleaved(ee,O,Y,te,ne,xe);default:throw new Error(`Unsupported resampling method: '${et}'`)}}function sum(ee,O,Y){let te=0;for(let ne=O;ne<Y;++ne)te+=ee[ne];return te}function arrayForType(ee,O,Y){switch(ee){case 1:if(O<=8)return new Uint8Array(Y);if(O<=16)return new Uint16Array(Y);if(O<=32)return new Uint32Array(Y);break;case 2:if(O===8)return new Int8Array(Y);if(O===16)return new Int16Array(Y);if(O===32)return new Int32Array(Y);break;case 3:switch(O){case 16:case 32:return new Float32Array(Y);case 64:return new Float64Array(Y)}break}throw Error("Unsupported data format/bitsPerSample")}function needsNormalization(ee,O){return(ee===1||ee===2)&&O<=32&&O%8===0?!1:!(ee===3&&(O===16||O===32||O===64))}function normalizeArray(ee,O,Y,te,ne,xe,et){const tt=new DataView(ee),it=Y===2?et*xe:et*xe*te,st=Y===2?1:te,ot=arrayForType(O,ne,it),rt=parseInt("1".repeat(ne),2);if(O===1){let nt;Y===1?nt=te*ne:nt=ne;let at=xe*nt;(at&7)!==0&&(at=at+7&-8);for(let ct=0;ct<et;++ct){const ut=ct*at;for(let dt=0;dt<xe;++dt){const ht=ut+dt*st*ne;for(let pt=0;pt<st;++pt){const ft=ht+pt*ne,mt=(ct*xe+dt)*st+pt,yt=Math.floor(ft/8),bt=ft%8;if(bt+ne<=8)ot[mt]=tt.getUint8(yt)>>8-ne-bt&rt;else if(bt+ne<=16)ot[mt]=tt.getUint16(yt)>>16-ne-bt&rt;else if(bt+ne<=24){const vt=tt.getUint16(yt)<<8|tt.getUint8(yt+2);ot[mt]=vt>>24-ne-bt&rt}else ot[mt]=tt.getUint32(yt)>>32-ne-bt&rt}}}}return ot.buffer}class GeoTIFFImage{constructor(O,Y,te,ne,xe,et){this.fileDirectory=O,this.geoKeys=Y,this.dataView=te,this.littleEndian=ne,this.tiles=xe?{}:null,this.isTiled=!O.StripOffsets;const tt=O.PlanarConfiguration;if(this.planarConfiguration=typeof tt>"u"?1:tt,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=et}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(O){return this.isTiled||(O+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-O*this.getTileHeight()}getBytesPerPixel(){let O=0;for(let Y=0;Y<this.fileDirectory.BitsPerSample.length;++Y)O+=this.getSampleByteSize(Y);return O}getSampleByteSize(O){if(O>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${O} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[O]/8)}getReaderForSample(O){const Y=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[O]:1,te=this.fileDirectory.BitsPerSample[O];switch(Y){case 1:if(te<=8)return DataView.prototype.getUint8;if(te<=16)return DataView.prototype.getUint16;if(te<=32)return DataView.prototype.getUint32;break;case 2:if(te<=8)return DataView.prototype.getInt8;if(te<=16)return DataView.prototype.getInt16;if(te<=32)return DataView.prototype.getInt32;break;case 3:switch(te){case 16:return function(ne,xe){return getFloat16(this,ne,xe)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(O=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[O]:1}getBitsPerSample(O=0){return this.fileDirectory.BitsPerSample[O]}getArrayForSample(O,Y){const te=this.getSampleFormat(O),ne=this.getBitsPerSample(O);return arrayForType(te,ne,Y)}async getTileOrStrip(O,Y,te,ne,xe){const et=Math.ceil(this.getWidth()/this.getTileWidth()),tt=Math.ceil(this.getHeight()/this.getTileHeight());let it;const{tiles:st}=this;this.planarConfiguration===1?it=Y*et+O:this.planarConfiguration===2&&(it=te*et*tt+Y*et+O);let ot,rt;this.isTiled?(ot=this.fileDirectory.TileOffsets[it],rt=this.fileDirectory.TileByteCounts[it]):(ot=this.fileDirectory.StripOffsets[it],rt=this.fileDirectory.StripByteCounts[it]);const nt=(await this.source.fetch([{offset:ot,length:rt}],xe))[0];let at;return st===null||!st[it]?(at=(async()=>{let ct=await ne.decode(this.fileDirectory,nt);const ut=this.getSampleFormat(),dt=this.getBitsPerSample();return needsNormalization(ut,dt)&&(ct=normalizeArray(ct,ut,this.planarConfiguration,this.getSamplesPerPixel(),dt,this.getTileWidth(),this.getBlockHeight(Y))),ct})(),st!==null&&(st[it]=at)):at=st[it],{x:O,y:Y,sample:te,data:await at}}async _readRaster(O,Y,te,ne,xe,et,tt,it,st){const ot=this.getTileWidth(),rt=this.getTileHeight(),nt=this.getWidth(),at=this.getHeight(),ct=Math.max(Math.floor(O[0]/ot),0),ut=Math.min(Math.ceil(O[2]/ot),Math.ceil(nt/ot)),dt=Math.max(Math.floor(O[1]/rt),0),ht=Math.min(Math.ceil(O[3]/rt),Math.ceil(at/rt)),pt=O[2]-O[0];let ft=this.getBytesPerPixel();const mt=[],yt=[];for(let Et=0;Et<Y.length;++Et)this.planarConfiguration===1?mt.push(sum(this.fileDirectory.BitsPerSample,0,Y[Et])/8):mt.push(0),yt.push(this.getReaderForSample(Y[Et]));const bt=[],{littleEndian:vt}=this;for(let Et=dt;Et<ht;++Et)for(let wt=ct;wt<ut;++wt){let St;this.planarConfiguration===1&&(St=this.getTileOrStrip(wt,Et,0,xe,st));for(let Ot=0;Ot<Y.length;++Ot){const $t=Ot,Mt=Y[Ot];this.planarConfiguration===2&&(ft=this.getSampleByteSize(Mt),St=this.getTileOrStrip(wt,Et,Mt,xe,st));const Nt=St.then(Rt=>{const Pt=Rt.data,kt=new DataView(Pt),Wt=this.getBlockHeight(Rt.y),zt=Rt.y*rt,Kt=Rt.x*ot,qt=zt+Wt,Xt=(Rt.x+1)*ot,an=yt[$t],pn=Math.min(Wt,Wt-(qt-O[3]),at-zt),ln=Math.min(ot,ot-(Xt-O[2]),nt-Kt);for(let dn=Math.max(0,O[1]-zt);dn<pn;++dn)for(let un=Math.max(0,O[0]-Kt);un<ln;++un){const Tn=(dn*ot+un)*ft,Sn=an.call(kt,Tn+mt[$t],vt);let bn;ne?(bn=(dn+zt-O[1])*pt*Y.length+(un+Kt-O[0])*Y.length+$t,te[bn]=Sn):(bn=(dn+zt-O[1])*pt+un+Kt-O[0],te[$t][bn]=Sn)}});bt.push(Nt)}}if(await Promise.all(bt),et&&O[2]-O[0]!==et||tt&&O[3]-O[1]!==tt){let Et;return ne?Et=resampleInterleaved(te,O[2]-O[0],O[3]-O[1],et,tt,Y.length,it):Et=resample(te,O[2]-O[0],O[3]-O[1],et,tt,it),Et.width=et,Et.height=tt,Et}return te.width=et||O[2]-O[0],te.height=tt||O[3]-O[1],te}async readRasters({window:O,samples:Y=[],interleave:te,pool:ne=null,width:xe,height:et,resampleMethod:tt,fillValue:it,signal:st}={}){const ot=O||[0,0,this.getWidth(),this.getHeight()];if(ot[0]>ot[2]||ot[1]>ot[3])throw new Error("Invalid subsets");const rt=ot[2]-ot[0],nt=ot[3]-ot[1],at=rt*nt,ct=this.getSamplesPerPixel();if(!Y||!Y.length)for(let pt=0;pt<ct;++pt)Y.push(pt);else for(let pt=0;pt<Y.length;++pt)if(Y[pt]>=ct)return Promise.reject(new RangeError(`Invalid sample index '${Y[pt]}'.`));let ut;if(te){const pt=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,ft=Math.max.apply(null,this.fileDirectory.BitsPerSample);ut=arrayForType(pt,ft,at*Y.length),it&&ut.fill(it)}else{ut=[];for(let pt=0;pt<Y.length;++pt){const ft=this.getArrayForSample(Y[pt],at);Array.isArray(it)&&pt<it.length?ft.fill(it[pt]):it&&!Array.isArray(it)&&ft.fill(it),ut.push(ft)}}const dt=ne||await getDecoder(this.fileDirectory);return await this._readRaster(ot,Y,ut,te,dt,xe,et,tt,st)}async readRGB({window:O,interleave:Y=!0,pool:te=null,width:ne,height:xe,resampleMethod:et,enableAlpha:tt=!1,signal:it}={}){const st=O||[0,0,this.getWidth(),this.getHeight()];if(st[0]>st[2]||st[1]>st[3])throw new Error("Invalid subsets");const ot=this.fileDirectory.PhotometricInterpretation;if(ot===photometricInterpretations.RGB){let ht=[0,1,2];if(this.fileDirectory.ExtraSamples!==ExtraSamplesValues.Unspecified&&tt){ht=[];for(let pt=0;pt<this.fileDirectory.BitsPerSample.length;pt+=1)ht.push(pt)}return this.readRasters({window:O,interleave:Y,samples:ht,pool:te,width:ne,height:xe,resampleMethod:et,signal:it})}let rt;switch(ot){case photometricInterpretations.WhiteIsZero:case photometricInterpretations.BlackIsZero:case photometricInterpretations.Palette:rt=[0];break;case photometricInterpretations.CMYK:rt=[0,1,2,3];break;case photometricInterpretations.YCbCr:case photometricInterpretations.CIELab:rt=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const nt={window:st,interleave:!0,samples:rt,pool:te,width:ne,height:xe,resampleMethod:et,signal:it},{fileDirectory:at}=this,ct=await this.readRasters(nt),ut=2**this.fileDirectory.BitsPerSample[0];let dt;switch(ot){case photometricInterpretations.WhiteIsZero:dt=fromWhiteIsZero(ct,ut);break;case photometricInterpretations.BlackIsZero:dt=fromBlackIsZero(ct,ut);break;case photometricInterpretations.Palette:dt=fromPalette(ct,at.ColorMap);break;case photometricInterpretations.CMYK:dt=fromCMYK(ct);break;case photometricInterpretations.YCbCr:dt=fromYCbCr(ct);break;case photometricInterpretations.CIELab:dt=fromCIELab(ct);break;default:throw new Error("Unsupported photometric interpretation.")}if(!Y){const ht=new Uint8Array(dt.length/3),pt=new Uint8Array(dt.length/3),ft=new Uint8Array(dt.length/3);for(let mt=0,yt=0;mt<dt.length;mt+=3,++yt)ht[yt]=dt[mt],pt[yt]=dt[mt+1],ft[yt]=dt[mt+2];dt=[ht,pt,ft]}return dt.width=ct.width,dt.height=ct.height,dt}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const O=[];for(let Y=0;Y<this.fileDirectory.ModelTiepoint.length;Y+=6)O.push({i:this.fileDirectory.ModelTiepoint[Y],j:this.fileDirectory.ModelTiepoint[Y+1],k:this.fileDirectory.ModelTiepoint[Y+2],x:this.fileDirectory.ModelTiepoint[Y+3],y:this.fileDirectory.ModelTiepoint[Y+4],z:this.fileDirectory.ModelTiepoint[Y+5]});return O}getGDALMetadata(O=null){const Y={};if(!this.fileDirectory.GDAL_METADATA)return null;const te=this.fileDirectory.GDAL_METADATA;let ne=findTagsByName(te,"Item");O===null?ne=ne.filter(xe=>getAttribute(xe,"sample")===void 0):ne=ne.filter(xe=>Number(getAttribute(xe,"sample"))===O);for(let xe=0;xe<ne.length;++xe){const et=ne[xe];Y[getAttribute(et,"name")]=et.inner}return Y}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const O=this.fileDirectory.GDAL_NODATA;return Number(O.substring(0,O.length-1))}getOrigin(){const O=this.fileDirectory.ModelTiepoint,Y=this.fileDirectory.ModelTransformation;if(O&&O.length===6)return[O[3],O[4],O[5]];if(Y)return[Y[3],Y[7],Y[11]];throw new Error("The image does not have an affine transformation.")}getResolution(O=null){const Y=this.fileDirectory.ModelPixelScale,te=this.fileDirectory.ModelTransformation;if(Y)return[Y[0],-Y[1],Y[2]];if(te)return te[1]===0&&te[4]===0?[te[0],-te[5],te[10]]:[Math.sqrt(te[0]*te[0]+te[4]*te[4]),-Math.sqrt(te[1]*te[1]+te[5]*te[5]),te[10]];if(O){const[ne,xe,et]=O.getResolution();return[ne*O.getWidth()/this.getWidth(),xe*O.getHeight()/this.getHeight(),et*O.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(O=!1){const Y=this.getHeight(),te=this.getWidth();if(this.fileDirectory.ModelTransformation&&!O){const[ne,xe,et,tt,it,st,ot,rt]=this.fileDirectory.ModelTransformation,at=[[0,0],[0,Y],[te,0],[te,Y]].map(([dt,ht])=>[tt+ne*dt+xe*ht,rt+it*dt+st*ht]),ct=at.map(dt=>dt[0]),ut=at.map(dt=>dt[1]);return[Math.min(...ct),Math.min(...ut),Math.max(...ct),Math.max(...ut)]}else{const ne=this.getOrigin(),xe=this.getResolution(),et=ne[0],tt=ne[1],it=et+xe[0]*te,st=tt+xe[1]*Y;return[Math.min(et,it),Math.min(tt,st),Math.max(et,it),Math.max(tt,st)]}}}class DataView64{constructor(O){this._dataView=new DataView(O)}get buffer(){return this._dataView.buffer}getUint64(O,Y){const te=this.getUint32(O,Y),ne=this.getUint32(O+4,Y);let xe;if(Y){if(xe=te+2**32*ne,!Number.isSafeInteger(xe))throw new Error(`${xe} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return xe}if(xe=2**32*te+ne,!Number.isSafeInteger(xe))throw new Error(`${xe} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return xe}getInt64(O,Y){let te=0;const ne=(this._dataView.getUint8(O+(Y?7:0))&128)>0;let xe=!0;for(let et=0;et<8;et++){let tt=this._dataView.getUint8(O+(Y?et:7-et));ne&&(xe?tt!==0&&(tt=~(tt-1)&255,xe=!1):tt=~tt&255),te+=tt*256**et}return ne&&(te=-te),te}getUint8(O,Y){return this._dataView.getUint8(O,Y)}getInt8(O,Y){return this._dataView.getInt8(O,Y)}getUint16(O,Y){return this._dataView.getUint16(O,Y)}getInt16(O,Y){return this._dataView.getInt16(O,Y)}getUint32(O,Y){return this._dataView.getUint32(O,Y)}getInt32(O,Y){return this._dataView.getInt32(O,Y)}getFloat16(O,Y){return getFloat16(this._dataView,O,Y)}getFloat32(O,Y){return this._dataView.getFloat32(O,Y)}getFloat64(O,Y){return this._dataView.getFloat64(O,Y)}}class DataSlice{constructor(O,Y,te,ne){this._dataView=new DataView(O),this._sliceOffset=Y,this._littleEndian=te,this._bigTiff=ne}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(O,Y){return this.sliceOffset<=O&&this.sliceTop>=O+Y}readUint8(O){return this._dataView.getUint8(O-this._sliceOffset,this._littleEndian)}readInt8(O){return this._dataView.getInt8(O-this._sliceOffset,this._littleEndian)}readUint16(O){return this._dataView.getUint16(O-this._sliceOffset,this._littleEndian)}readInt16(O){return this._dataView.getInt16(O-this._sliceOffset,this._littleEndian)}readUint32(O){return this._dataView.getUint32(O-this._sliceOffset,this._littleEndian)}readInt32(O){return this._dataView.getInt32(O-this._sliceOffset,this._littleEndian)}readFloat32(O){return this._dataView.getFloat32(O-this._sliceOffset,this._littleEndian)}readFloat64(O){return this._dataView.getFloat64(O-this._sliceOffset,this._littleEndian)}readUint64(O){const Y=this.readUint32(O),te=this.readUint32(O+4);let ne;if(this._littleEndian){if(ne=Y+2**32*te,!Number.isSafeInteger(ne))throw new Error(`${ne} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return ne}if(ne=2**32*Y+te,!Number.isSafeInteger(ne))throw new Error(`${ne} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return ne}readInt64(O){let Y=0;const te=(this._dataView.getUint8(O+(this._littleEndian?7:0))&128)>0;let ne=!0;for(let xe=0;xe<8;xe++){let et=this._dataView.getUint8(O+(this._littleEndian?xe:7-xe));te&&(ne?et!==0&&(et=~(et-1)&255,ne=!1):et=~et&255),Y+=et*256**xe}return te&&(Y=-Y),Y}readOffset(O){return this._bigTiff?this.readUint64(O):this.readUint32(O)}}const defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Pool{constructor(O=defaultPoolSize,Y){this.workers=null,this._awaitingDecoder=null,this.size=O,this.messageId=0,O&&(this._awaitingDecoder=Y?Promise.resolve(Y):new Promise(te=>{__vitePreload(()=>import("./decoder-tqM1uIvc.js"),[]).then(ne=>{te(ne.create)})}),this._awaitingDecoder.then(te=>{this._awaitingDecoder=null,this.workers=[];for(let ne=0;ne<O;ne++)this.workers.push({worker:te(),idle:!0})}))}async decode(O,Y){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?getDecoder(O).then(te=>te.decode(O,Y)):new Promise(te=>{const ne=this.workers.find(tt=>tt.idle)||this.workers[Math.floor(Math.random()*this.size)];ne.idle=!1;const xe=this.messageId++,et=tt=>{tt.data.id===xe&&(ne.idle=!0,te(tt.data.decoded),ne.worker.removeEventListener("message",et))};ne.worker.addEventListener("message",et),ne.worker.postMessage({fileDirectory:O,buffer:Y,id:xe},[Y])})}destroy(){this.workers&&(this.workers.forEach(O=>{O.worker.terminate()}),this.workers=null)}}const CRLFCRLF=`\r
\r
`;function itemsToObject(ee){if(typeof Object.fromEntries<"u")return Object.fromEntries(ee);const O={};for(const[Y,te]of ee)O[Y.toLowerCase()]=te;return O}function parseHeaders(ee){const O=ee.split(`\r
`).map(Y=>{const te=Y.split(":").map(ne=>ne.trim());return te[0]=te[0].toLowerCase(),te});return itemsToObject(O)}function parseContentType(ee){const[O,...Y]=ee.split(";").map(ne=>ne.trim()),te=Y.map(ne=>ne.split("="));return{type:O,params:itemsToObject(te)}}function parseContentRange(ee){let O,Y,te;return ee&&([,O,Y,te]=ee.match(/bytes (\d+)-(\d+)\/(\d+)/),O=parseInt(O,10),Y=parseInt(Y,10),te=parseInt(te,10)),{start:O,end:Y,total:te}}function parseByteRanges(ee,O){let Y=null;const te=new TextDecoder("ascii"),ne=[],xe=`--${O}`,et=`${xe}--`;for(let tt=0;tt<10;++tt)te.decode(new Uint8Array(ee,tt,xe.length))===xe&&(Y=tt);if(Y===null)throw new Error("Could not find initial boundary");for(;Y<ee.byteLength;){const tt=te.decode(new Uint8Array(ee,Y,Math.min(xe.length+1024,ee.byteLength-Y)));if(tt.length===0||tt.startsWith(et))break;if(!tt.startsWith(xe))throw new Error("Part does not start with boundary");const it=tt.substr(xe.length+2);if(it.length===0)break;const st=it.indexOf(CRLFCRLF),ot=parseHeaders(it.substr(0,st)),{start:rt,end:nt,total:at}=parseContentRange(ot["content-range"]),ct=Y+xe.length+st+CRLFCRLF.length,ut=parseInt(nt,10)+1-parseInt(rt,10);ne.push({headers:ot,data:ee.slice(ct,ct+ut),offset:rt,length:ut,fileSize:at}),Y=ct+ut+4}return ne}class BaseSource{async fetch(O,Y=void 0){return Promise.all(O.map(te=>this.fetchSlice(te,Y)))}async fetchSlice(O){throw new Error(`fetching of slice ${O} not possible, not implemented`)}get fileSize(){return null}async close(){}}class QuickLRU extends Map{constructor(O={}){if(super(),!(O.maxSize&&O.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof O.maxAge=="number"&&O.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=O.maxSize,this.maxAge=O.maxAge||Number.POSITIVE_INFINITY,this.onEviction=O.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(O){if(typeof this.onEviction=="function")for(const[Y,te]of O)this.onEviction(Y,te.value)}_deleteIfExpired(O,Y){return typeof Y.expiry=="number"&&Y.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(O,Y.value),this.delete(O)):!1}_getOrDeleteIfExpired(O,Y){if(this._deleteIfExpired(O,Y)===!1)return Y.value}_getItemValue(O,Y){return Y.expiry?this._getOrDeleteIfExpired(O,Y):Y.value}_peek(O,Y){const te=Y.get(O);return this._getItemValue(O,te)}_set(O,Y){this.cache.set(O,Y),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(O,Y){this.oldCache.delete(O),this._set(O,Y)}*_entriesAscending(){for(const O of this.oldCache){const[Y,te]=O;this.cache.has(Y)||this._deleteIfExpired(Y,te)===!1&&(yield O)}for(const O of this.cache){const[Y,te]=O;this._deleteIfExpired(Y,te)===!1&&(yield O)}}get(O){if(this.cache.has(O)){const Y=this.cache.get(O);return this._getItemValue(O,Y)}if(this.oldCache.has(O)){const Y=this.oldCache.get(O);if(this._deleteIfExpired(O,Y)===!1)return this._moveToRecent(O,Y),Y.value}}set(O,Y,{maxAge:te=this.maxAge}={}){const ne=typeof te=="number"&&te!==Number.POSITIVE_INFINITY?Date.now()+te:void 0;return this.cache.has(O)?this.cache.set(O,{value:Y,expiry:ne}):this._set(O,{value:Y,expiry:ne}),this}has(O){return this.cache.has(O)?!this._deleteIfExpired(O,this.cache.get(O)):this.oldCache.has(O)?!this._deleteIfExpired(O,this.oldCache.get(O)):!1}peek(O){if(this.cache.has(O))return this._peek(O,this.cache);if(this.oldCache.has(O))return this._peek(O,this.oldCache)}delete(O){const Y=this.cache.delete(O);return Y&&this._size--,this.oldCache.delete(O)||Y}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(O){if(!(O&&O>0))throw new TypeError("`maxSize` must be a number greater than 0");const Y=[...this._entriesAscending()],te=Y.length-O;te<0?(this.cache=new Map(Y),this.oldCache=new Map,this._size=Y.length):(te>0&&this._emitEvictions(Y.slice(0,te)),this.oldCache=new Map(Y.slice(te)),this.cache=new Map,this._size=0),this.maxSize=O}*keys(){for(const[O]of this)yield O}*values(){for(const[,O]of this)yield O}*[Symbol.iterator](){for(const O of this.cache){const[Y,te]=O;this._deleteIfExpired(Y,te)===!1&&(yield[Y,te.value])}for(const O of this.oldCache){const[Y,te]=O;this.cache.has(Y)||this._deleteIfExpired(Y,te)===!1&&(yield[Y,te.value])}}*entriesDescending(){let O=[...this.cache];for(let Y=O.length-1;Y>=0;--Y){const te=O[Y],[ne,xe]=te;this._deleteIfExpired(ne,xe)===!1&&(yield[ne,xe.value])}O=[...this.oldCache];for(let Y=O.length-1;Y>=0;--Y){const te=O[Y],[ne,xe]=te;this.cache.has(ne)||this._deleteIfExpired(ne,xe)===!1&&(yield[ne,xe.value])}}*entriesAscending(){for(const[O,Y]of this._entriesAscending())yield[O,Y.value]}get size(){if(!this._size)return this.oldCache.size;let O=0;for(const Y of this.oldCache.keys())this.cache.has(Y)||O++;return Math.min(this._size+O,this.maxSize)}entries(){return this.entriesAscending()}forEach(O,Y=this){for(const[te,ne]of this.entriesAscending())O.call(Y,ne,te,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function wait(ee){return new Promise(O=>setTimeout(O,ee))}function zip(ee,O){const Y=Array.isArray(ee)?ee:Array.from(ee),te=Array.isArray(O)?O:Array.from(O);return Y.map((ne,xe)=>[ne,te[xe]])}class AbortError extends Error{constructor(O){super(O),Error.captureStackTrace&&Error.captureStackTrace(this,AbortError),this.name="AbortError"}}class CustomAggregateError extends Error{constructor(O,Y){super(Y),this.errors=O,this.message=Y,this.name="AggregateError"}}const AggregateError=CustomAggregateError;class Block{constructor(O,Y,te=null){this.offset=O,this.length=Y,this.data=te}get top(){return this.offset+this.length}}class BlockGroup{constructor(O,Y,te){this.offset=O,this.length=Y,this.blockIds=te}}class BlockedSource extends BaseSource{constructor(O,{blockSize:Y=65536,cacheSize:te=100}={}){super(),this.source=O,this.blockSize=Y,this.blockCache=new QuickLRU({maxSize:te,onEviction:(ne,xe)=>{this.evictedBlocks.set(ne,xe)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(O,Y){const te=[],ne=[],xe=[];this.evictedBlocks.clear();for(const{offset:nt,length:at}of O){let ct=nt+at;const{fileSize:ut}=this;ut!==null&&(ct=Math.min(ct,ut));const dt=Math.floor(nt/this.blockSize)*this.blockSize;for(let ht=dt;ht<ct;ht+=this.blockSize){const pt=Math.floor(ht/this.blockSize);!this.blockCache.has(pt)&&!this.blockRequests.has(pt)&&(this.blockIdsToFetch.add(pt),ne.push(pt)),this.blockRequests.has(pt)&&te.push(this.blockRequests.get(pt)),xe.push(pt)}}await wait(),this.fetchBlocks(Y);const et=[];for(const nt of ne)this.blockRequests.has(nt)&&et.push(this.blockRequests.get(nt));await Promise.allSettled(te),await Promise.allSettled(et);const tt=[],it=xe.filter(nt=>this.abortedBlockIds.has(nt)||!this.blockCache.has(nt));if(it.forEach(nt=>this.blockIdsToFetch.add(nt)),it.length>0&&Y&&!Y.aborted){this.fetchBlocks(null);for(const nt of it){const at=this.blockRequests.get(nt);if(!at)throw new Error(`Block ${nt} is not in the block requests`);tt.push(at)}await Promise.allSettled(tt)}if(Y&&Y.aborted)throw new AbortError("Request was aborted");const st=xe.map(nt=>this.blockCache.get(nt)||this.evictedBlocks.get(nt)),ot=st.filter(nt=>!nt);if(ot.length)throw new AggregateError(ot,"Request failed");const rt=new Map(zip(xe,st));return this.readSliceData(O,rt)}fetchBlocks(O){if(this.blockIdsToFetch.size>0){const Y=this.groupBlocks(this.blockIdsToFetch),te=this.source.fetch(Y,O);for(let ne=0;ne<Y.length;++ne){const xe=Y[ne];for(const et of xe.blockIds)this.blockRequests.set(et,(async()=>{try{const tt=(await te)[ne],it=et*this.blockSize,st=it-tt.offset,ot=Math.min(st+this.blockSize,tt.data.byteLength),rt=tt.data.slice(st,ot),nt=new Block(it,rt.byteLength,rt,et);this.blockCache.set(et,nt),this.abortedBlockIds.delete(et)}catch(tt){if(tt.name==="AbortError")tt.signal=O,this.blockCache.delete(et),this.abortedBlockIds.add(et);else throw tt}finally{this.blockRequests.delete(et)}})())}this.blockIdsToFetch.clear()}}groupBlocks(O){const Y=Array.from(O).sort((et,tt)=>et-tt);if(Y.length===0)return[];let te=[],ne=null;const xe=[];for(const et of Y)ne===null||ne+1===et?(te.push(et),ne=et):(xe.push(new BlockGroup(te[0]*this.blockSize,te.length*this.blockSize,te)),te=[et],ne=et);return xe.push(new BlockGroup(te[0]*this.blockSize,te.length*this.blockSize,te)),xe}readSliceData(O,Y){return O.map(te=>{let ne=te.offset+te.length;this.fileSize!==null&&(ne=Math.min(this.fileSize,ne));const xe=Math.floor(te.offset/this.blockSize),et=Math.floor(ne/this.blockSize),tt=new ArrayBuffer(te.length),it=new Uint8Array(tt);for(let st=xe;st<=et;++st){const ot=Y.get(st),rt=ot.offset-te.offset,nt=ot.top-ne;let at=0,ct=0,ut;rt<0?at=-rt:rt>0&&(ct=rt),nt<0?ut=ot.length-at:ut=ne-ot.offset-at;const dt=new Uint8Array(ot.data,at,ut);it.set(dt,ct)}return tt})}}class BaseResponse{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(O){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class BaseClient{constructor(O){this.url=O}async request({headers:O,signal:Y}={}){throw new Error("request is not implemented")}}class FetchResponse extends BaseResponse{constructor(O){super(),this.response=O}get status(){return this.response.status}getHeader(O){return this.response.headers.get(O)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class FetchClient extends BaseClient{constructor(O,Y){super(O),this.credentials=Y}async request({headers:O,signal:Y}={}){const te=await fetch(this.url,{headers:O,credentials:this.credentials,signal:Y});return new FetchResponse(te)}}class XHRResponse extends BaseResponse{constructor(O,Y){super(),this.xhr=O,this.data=Y}get status(){return this.xhr.status}getHeader(O){return this.xhr.getResponseHeader(O)}async getData(){return this.data}}class XHRClient extends BaseClient{constructRequest(O,Y){return new Promise((te,ne)=>{const xe=new XMLHttpRequest;xe.open("GET",this.url),xe.responseType="arraybuffer";for(const[et,tt]of Object.entries(O))xe.setRequestHeader(et,tt);xe.onload=()=>{const et=xe.response;te(new XHRResponse(xe,et))},xe.onerror=ne,xe.onabort=()=>ne(new AbortError("Request aborted")),xe.send(),Y&&(Y.aborted&&xe.abort(),Y.addEventListener("abort",()=>xe.abort()))})}async request({headers:O,signal:Y}={}){return await this.constructRequest(O,Y)}}class HttpResponse extends BaseResponse{constructor(O,Y){super(),this.response=O,this.dataPromise=Y}get status(){return this.response.statusCode}getHeader(O){return this.response.headers[O]}async getData(){return await this.dataPromise}}class HttpClient extends BaseClient{constructor(O){super(O),this.parsedUrl=fs.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",fs)}constructRequest(O,Y){return new Promise((te,ne)=>{const xe=this.httpApi.get({...this.parsedUrl,headers:O},et=>{const tt=new Promise(it=>{const st=[];et.on("data",ot=>{st.push(ot)}),et.on("end",()=>{const ot=Buffer.concat(st).buffer;it(ot)}),et.on("error",ne)});te(new HttpResponse(et,tt))});xe.on("error",ne),Y&&(Y.aborted&&xe.destroy(new AbortError("Request aborted")),Y.addEventListener("abort",()=>xe.destroy(new AbortError("Request aborted"))))})}async request({headers:O,signal:Y}={}){return await this.constructRequest(O,Y)}}class RemoteSource extends BaseSource{constructor(O,Y,te,ne){super(),this.client=O,this.headers=Y,this.maxRanges=te,this.allowFullFile=ne,this._fileSize=null}async fetch(O,Y){return this.maxRanges>=O.length?this.fetchSlices(O,Y):(this.maxRanges>0&&O.length>1,Promise.all(O.map(te=>this.fetchSlice(te,Y))))}async fetchSlices(O,Y){const te=await this.client.request({headers:{...this.headers,Range:`bytes=${O.map(({offset:ne,length:xe})=>`${ne}-${ne+xe}`).join(",")}`},signal:Y});if(te.ok)if(te.status===206){const{type:ne,params:xe}=parseContentType(te.getHeader("content-type"));if(ne==="multipart/byteranges"){const rt=parseByteRanges(await te.getData(),xe.boundary);return this._fileSize=rt[0].fileSize||null,rt}const et=await te.getData(),{start:tt,end:it,total:st}=parseContentRange(te.getHeader("content-range"));this._fileSize=st||null;const ot=[{data:et,offset:tt,length:it-tt}];if(O.length>1){const rt=await Promise.all(O.slice(1).map(nt=>this.fetchSlice(nt,Y)));return ot.concat(rt)}return ot}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const ne=await te.getData();return this._fileSize=ne.byteLength,[{data:ne,offset:0,length:ne.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(O,Y){const{offset:te,length:ne}=O,xe=await this.client.request({headers:{...this.headers,Range:`bytes=${te}-${te+ne}`},signal:Y});if(xe.ok)if(xe.status===206){const et=await xe.getData(),{total:tt}=parseContentRange(xe.getHeader("content-range"));return this._fileSize=tt||null,{data:et,offset:te,length:ne}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const et=await xe.getData();return this._fileSize=et.byteLength,{data:et,offset:0,length:et.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function maybeWrapInBlockedSource(ee,{blockSize:O,cacheSize:Y}){return O===null?ee:new BlockedSource(ee,{blockSize:O,cacheSize:Y})}function makeFetchSource(ee,{headers:O={},credentials:Y,maxRanges:te=0,allowFullFile:ne=!1,...xe}={}){const et=new FetchClient(ee,Y),tt=new RemoteSource(et,O,te,ne);return maybeWrapInBlockedSource(tt,xe)}function makeXHRSource(ee,{headers:O={},maxRanges:Y=0,allowFullFile:te=!1,...ne}={}){const xe=new XHRClient(ee),et=new RemoteSource(xe,O,Y,te);return maybeWrapInBlockedSource(et,ne)}function makeHttpSource(ee,{headers:O={},maxRanges:Y=0,allowFullFile:te=!1,...ne}={}){const xe=new HttpClient(ee),et=new RemoteSource(xe,O,Y,te);return maybeWrapInBlockedSource(et,ne)}function makeRemoteSource(ee,{forceXHR:O=!1,...Y}={}){return typeof fetch=="function"&&!O?makeFetchSource(ee,Y):typeof XMLHttpRequest<"u"?makeXHRSource(ee,Y):makeHttpSource(ee,Y)}class FileReaderSource extends BaseSource{constructor(O){super(),this.file=O}async fetchSlice(O,Y){return new Promise((te,ne)=>{const xe=this.file.slice(O.offset,O.offset+O.length),et=new FileReader;et.onload=tt=>te(tt.target.result),et.onerror=ne,et.onabort=ne,et.readAsArrayBuffer(xe),Y&&Y.addEventListener("abort",()=>et.abort())})}}function makeFileReaderSource(ee){return new FileReaderSource(ee)}function getFieldTypeLength(ee){switch(ee){case fieldTypes.BYTE:case fieldTypes.ASCII:case fieldTypes.SBYTE:case fieldTypes.UNDEFINED:return 1;case fieldTypes.SHORT:case fieldTypes.SSHORT:return 2;case fieldTypes.LONG:case fieldTypes.SLONG:case fieldTypes.FLOAT:case fieldTypes.IFD:return 4;case fieldTypes.RATIONAL:case fieldTypes.SRATIONAL:case fieldTypes.DOUBLE:case fieldTypes.LONG8:case fieldTypes.SLONG8:case fieldTypes.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${ee}`)}}function parseGeoKeyDirectory(ee){const O=ee.GeoKeyDirectory;if(!O)return null;const Y={};for(let te=4;te<=O[3]*4;te+=4){const ne=geoKeyNames[O[te]],xe=O[te+1]?fieldTagNames[O[te+1]]:null,et=O[te+2],tt=O[te+3];let it=null;if(!xe)it=tt;else{if(it=ee[xe],typeof it>"u"||it===null)throw new Error(`Could not get value of geoKey '${ne}'.`);typeof it=="string"?it=it.substring(tt,tt+et-1):it.subarray&&(it=it.subarray(tt,tt+et),et===1&&(it=it[0]))}Y[ne]=it}return Y}function getValues(ee,O,Y,te){let ne=null,xe=null;const et=getFieldTypeLength(O);switch(O){case fieldTypes.BYTE:case fieldTypes.ASCII:case fieldTypes.UNDEFINED:ne=new Uint8Array(Y),xe=ee.readUint8;break;case fieldTypes.SBYTE:ne=new Int8Array(Y),xe=ee.readInt8;break;case fieldTypes.SHORT:ne=new Uint16Array(Y),xe=ee.readUint16;break;case fieldTypes.SSHORT:ne=new Int16Array(Y),xe=ee.readInt16;break;case fieldTypes.LONG:case fieldTypes.IFD:ne=new Uint32Array(Y),xe=ee.readUint32;break;case fieldTypes.SLONG:ne=new Int32Array(Y),xe=ee.readInt32;break;case fieldTypes.LONG8:case fieldTypes.IFD8:ne=new Array(Y),xe=ee.readUint64;break;case fieldTypes.SLONG8:ne=new Array(Y),xe=ee.readInt64;break;case fieldTypes.RATIONAL:ne=new Uint32Array(Y*2),xe=ee.readUint32;break;case fieldTypes.SRATIONAL:ne=new Int32Array(Y*2),xe=ee.readInt32;break;case fieldTypes.FLOAT:ne=new Float32Array(Y),xe=ee.readFloat32;break;case fieldTypes.DOUBLE:ne=new Float64Array(Y),xe=ee.readFloat64;break;default:throw new RangeError(`Invalid field type: ${O}`)}if(O===fieldTypes.RATIONAL||O===fieldTypes.SRATIONAL)for(let tt=0;tt<Y;tt+=2)ne[tt]=xe.call(ee,te+tt*et),ne[tt+1]=xe.call(ee,te+(tt*et+4));else for(let tt=0;tt<Y;++tt)ne[tt]=xe.call(ee,te+tt*et);return O===fieldTypes.ASCII?new TextDecoder("utf-8").decode(ne):ne}class ImageFileDirectory{constructor(O,Y,te){this.fileDirectory=O,this.geoKeyDirectory=Y,this.nextIFDByteOffset=te}}class GeoTIFFImageIndexError extends Error{constructor(O){super(`No image at index ${O}`),this.index=O}}class GeoTIFFBase{async readRasters(O={}){const{window:Y,width:te,height:ne}=O;let{resX:xe,resY:et,bbox:tt}=O;const it=await this.getImage();let st=it;const ot=await this.getImageCount(),rt=it.getBoundingBox();if(Y&&tt)throw new Error('Both "bbox" and "window" passed.');if(te||ne){if(Y){const[ct,ut]=it.getOrigin(),[dt,ht]=it.getResolution();tt=[ct+Y[0]*dt,ut+Y[1]*ht,ct+Y[2]*dt,ut+Y[3]*ht]}const at=tt||rt;if(te){if(xe)throw new Error("Both width and resX passed");xe=(at[2]-at[0])/te}if(ne){if(et)throw new Error("Both width and resY passed");et=(at[3]-at[1])/ne}}if(xe||et){const at=[];for(let ct=0;ct<ot;++ct){const ut=await this.getImage(ct),{SubfileType:dt,NewSubfileType:ht}=ut.fileDirectory;(ct===0||dt===2||ht&1)&&at.push(ut)}at.sort((ct,ut)=>ct.getWidth()-ut.getWidth());for(let ct=0;ct<at.length;++ct){const ut=at[ct],dt=(rt[2]-rt[0])/ut.getWidth(),ht=(rt[3]-rt[1])/ut.getHeight();if(st=ut,xe&&xe>dt||et&&et>ht)break}}let nt=Y;if(tt){const[at,ct]=it.getOrigin(),[ut,dt]=st.getResolution(it);nt=[Math.round((tt[0]-at)/ut),Math.round((tt[1]-ct)/dt),Math.round((tt[2]-at)/ut),Math.round((tt[3]-ct)/dt)],nt=[Math.min(nt[0],nt[2]),Math.min(nt[1],nt[3]),Math.max(nt[0],nt[2]),Math.max(nt[1],nt[3])]}return st.readRasters({...O,window:nt})}}class GeoTIFF extends GeoTIFFBase{constructor(O,Y,te,ne,xe={}){super(),this.source=O,this.littleEndian=Y,this.bigTiff=te,this.firstIFDOffset=ne,this.cache=xe.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(O,Y){const te=this.bigTiff?4048:1024;return new DataSlice((await this.source.fetch([{offset:O,length:typeof Y<"u"?Y:te}]))[0],O,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(O){const Y=this.bigTiff?20:12,te=this.bigTiff?8:2;let ne=await this.getSlice(O);const xe=this.bigTiff?ne.readUint64(O):ne.readUint16(O),et=xe*Y+(this.bigTiff?16:6);ne.covers(O,et)||(ne=await this.getSlice(O,et));const tt={};let it=O+(this.bigTiff?8:2);for(let rt=0;rt<xe;it+=Y,++rt){const nt=ne.readUint16(it),at=ne.readUint16(it+2),ct=this.bigTiff?ne.readUint64(it+4):ne.readUint32(it+4);let ut,dt;const ht=getFieldTypeLength(at),pt=it+(this.bigTiff?12:8);if(ht*ct<=(this.bigTiff?8:4))ut=getValues(ne,at,ct,pt);else{const ft=ne.readOffset(pt),mt=getFieldTypeLength(at)*ct;if(ne.covers(ft,mt))ut=getValues(ne,at,ct,ft);else{const yt=await this.getSlice(ft,mt);ut=getValues(yt,at,ct,ft)}}ct===1&&arrayFields.indexOf(nt)===-1&&!(at===fieldTypes.RATIONAL||at===fieldTypes.SRATIONAL)?dt=ut[0]:dt=ut,tt[fieldTagNames[nt]]=dt}const st=parseGeoKeyDirectory(tt),ot=ne.readOffset(O+te+Y*xe);return new ImageFileDirectory(tt,st,ot)}async requestIFD(O){if(this.ifdRequests[O])return this.ifdRequests[O];if(O===0)return this.ifdRequests[O]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[O];if(!this.ifdRequests[O-1])try{this.ifdRequests[O-1]=this.requestIFD(O-1)}catch(Y){throw Y instanceof GeoTIFFImageIndexError?new GeoTIFFImageIndexError(O):Y}return this.ifdRequests[O]=(async()=>{const Y=await this.ifdRequests[O-1];if(Y.nextIFDByteOffset===0)throw new GeoTIFFImageIndexError(O);return this.parseFileDirectoryAt(Y.nextIFDByteOffset)})(),this.ifdRequests[O]}async getImage(O=0){const Y=await this.requestIFD(O);return new GeoTIFFImage(Y.fileDirectory,Y.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let O=0,Y=!0;for(;Y;)try{await this.requestIFD(O),++O}catch(te){if(te instanceof GeoTIFFImageIndexError)Y=!1;else throw te}return O}async getGhostValues(){const O=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const Y="GDAL_STRUCTURAL_METADATA_SIZE=",te=Y.length+100;let ne=await this.getSlice(O,te);if(Y===getValues(ne,fieldTypes.ASCII,Y.length,O)){const et=getValues(ne,fieldTypes.ASCII,te,O).split(`
`)[0],tt=Number(et.split("=")[1].split(" ")[0])+et.length;tt>te&&(ne=await this.getSlice(O,tt));const it=getValues(ne,fieldTypes.ASCII,tt,O);this.ghostValues={},it.split(`
`).filter(st=>st.length>0).map(st=>st.split("=")).forEach(([st,ot])=>{this.ghostValues[st]=ot})}return this.ghostValues}static async fromSource(O,Y,te){const ne=(await O.fetch([{offset:0,length:1024}],te))[0],xe=new DataView64(ne),et=xe.getUint16(0,0);let tt;if(et===18761)tt=!0;else if(et===19789)tt=!1;else throw new TypeError("Invalid byte order value.");const it=xe.getUint16(2,tt);let st;if(it===42)st=!1;else if(it===43){if(st=!0,xe.getUint16(4,tt)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const ot=st?xe.getUint64(8,tt):xe.getUint32(4,tt);return new GeoTIFF(O,tt,st,ot,Y)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class MultiGeoTIFF extends GeoTIFFBase{constructor(O,Y){super(),this.mainFile=O,this.overviewFiles=Y,this.imageFiles=[O].concat(Y),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const O=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(Y=>Y.parseFileDirectoryAt(Y.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(O),this.fileDirectoriesPerFile}async getImage(O=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let Y=0,te=0;for(let ne=0;ne<this.imageFiles.length;ne++){const xe=this.imageFiles[ne];for(let et=0;et<this.imageCounts[ne];et++){if(O===Y){const tt=await xe.requestIFD(te);return new GeoTIFFImage(tt.fileDirectory,tt.geoKeyDirectory,xe.dataView,xe.littleEndian,xe.cache,xe.source)}Y++,te++}te=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const O=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(Y=>Y.getImageCount()));return this.imageCounts=await Promise.all(O),this.imageCount=this.imageCounts.reduce((Y,te)=>Y+te,0),this.imageCount}}async function fromUrl(ee,O={},Y){return GeoTIFF.fromSource(makeRemoteSource(ee,O),Y)}async function fromBlob(ee,O){return GeoTIFF.fromSource(makeFileReaderSource(ee),O)}async function fromUrls(ee,O=[],Y={},te){const ne=await GeoTIFF.fromSource(makeRemoteSource(ee,Y),te),xe=await Promise.all(O.map(et=>GeoTIFF.fromSource(makeRemoteSource(et,Y))));return new MultiGeoTIFF(ne,xe)}function isMask(ee){return((ee.fileDirectory.NewSubfileType||0)&4)===4}function readRGB(ee,O){if(!ee)return!1;if(ee===!0)return!0;if(O.getSamplesPerPixel()!==3)return!1;const Y=O.fileDirectory.PhotometricInterpretation,te=photometricInterpretations;return Y===te.CMYK||Y===te.YCbCr||Y===te.CIELab||Y===te.ICCLab}const STATISTICS_MAXIMUM="STATISTICS_MAXIMUM",STATISTICS_MINIMUM="STATISTICS_MINIMUM",defaultTileSize=256;let workerPool;function getWorkerPool(){return workerPool||(workerPool=new Pool),workerPool}function getBoundingBox(ee){try{return ee.getBoundingBox(!0)}catch{return[0,0,ee.getWidth(),ee.getHeight()]}}function getOrigin(ee){try{return ee.getOrigin().slice(0,2)}catch{return[0,ee.getHeight()]}}function getResolutions(ee,O){try{return ee.getResolution(O)}catch{return[O.getWidth()/ee.getWidth(),O.getHeight()/ee.getHeight()]}}function getProjection(ee){const O=ee.geoKeys;if(!O)return null;if(O.ProjectedCSTypeGeoKey&&O.ProjectedCSTypeGeoKey!==32767){const Y="EPSG:"+O.ProjectedCSTypeGeoKey;let te=get$2(Y);if(!te){const ne=fromCode(O.ProjLinearUnitsGeoKey);ne&&(te=new Projection({code:Y,units:ne}))}return te}if(O.GeographicTypeGeoKey&&O.GeographicTypeGeoKey!==32767){const Y="EPSG:"+O.GeographicTypeGeoKey;let te=get$2(Y);if(!te){const ne=fromCode(O.GeogAngularUnitsGeoKey);ne&&(te=new Projection({code:Y,units:ne}))}return te}return null}function getImagesForTIFF(ee){return ee.getImageCount().then(function(O){const Y=new Array(O);for(let te=0;te<O;++te)Y[te]=ee.getImage(te);return Promise.all(Y)})}function getImagesForSource(ee,O){let Y;return ee.blob?Y=fromBlob(ee.blob):ee.overviews?Y=fromUrls(ee.url,ee.overviews,O):Y=fromUrl(ee.url,O),Y.then(getImagesForTIFF)}function assertEqual(ee,O,Y,te,ne){if(Array.isArray(ee)){const xe=ee.length;if(!Array.isArray(O)||xe!=O.length){const et=new Error(te);throw ne(et),et}for(let et=0;et<xe;++et)assertEqual(ee[et],O[et],Y,te,ne);return}if(O=O,Math.abs(ee-O)>Y*ee)throw new Error(te)}function getMinForDataType(ee){return ee instanceof Int8Array?-128:ee instanceof Int16Array?-32768:ee instanceof Int32Array?-2147483648:ee instanceof Float32Array?12e-39:0}function getMaxForDataType(ee){return ee instanceof Int8Array?127:ee instanceof Uint8Array||ee instanceof Uint8ClampedArray?255:ee instanceof Int16Array?32767:ee instanceof Uint16Array?65535:ee instanceof Int32Array?2147483647:ee instanceof Uint32Array?4294967295:ee instanceof Float32Array?34e37:255}class GeoTIFFSource extends DataTileSource{constructor(O){super({state:"loading",tileGrid:null,projection:O.projection||null,transition:O.transition,interpolate:O.interpolate!==!1,wrapX:O.wrapX}),this.sourceInfo_=O.sources;const Y=this.sourceInfo_.length;this.sourceOptions_=O.sourceOptions,this.sourceImagery_=new Array(Y),this.sourceMasks_=new Array(Y),this.resolutionFactors_=new Array(Y),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=O.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=O.convertToRGB||!1,this.setKey(this.sourceInfo_.map(xe=>xe.url).join(","));const te=this,ne=new Array(Y);for(let xe=0;xe<Y;++xe)ne[xe]=getImagesForSource(this.sourceInfo_[xe],this.sourceOptions_);Promise.all(ne).then(function(xe){te.configure_(xe)}).catch(function(xe){error$1(xe),te.error_=xe,te.setState("error")})}getError(){return this.error_}determineProjection(O){const Y=O[0];for(let te=Y.length-1;te>=0;--te){const ne=Y[te],xe=getProjection(ne);if(xe){this.projection=xe;break}}}determineTransformMatrix(O){const Y=O[0];for(let te=Y.length-1;te>=0;--te){const xe=Y[te].fileDirectory.ModelTransformation;if(xe){const[et,tt,it,st,ot,rt,nt,at]=xe,ct=multiply(multiply([1/Math.sqrt(et*et+ot*ot),0,0,-1/Math.sqrt(tt*tt+rt*rt),st,at],[et,ot,tt,rt,0,0]),[1,0,0,1,-st,-at]);this.transformMatrix=ct,this.addAlpha_=!0;break}}}configure_(O){let Y,te,ne,xe,et;const tt=new Array(O.length),it=new Array(O.length),st=new Array(O.length);let ot=0;const rt=O.length;for(let dt=0;dt<rt;++dt){const ht=[],pt=[];O[dt].forEach(wt=>{isMask(wt)?pt.push(wt):ht.push(wt)});const ft=ht.length;if(pt.length>0&&pt.length!==ft)throw new Error(`Expected one mask per image found ${pt.length} masks and ${ft} images`);let mt,yt;const bt=new Array(ft),vt=new Array(ft),Et=new Array(ft);it[dt]=new Array(ft),st[dt]=new Array(ft);for(let wt=0;wt<ft;++wt){const St=ht[wt],Ot=St.getGDALNoData();st[dt][wt]=St.getGDALMetadata(0),it[dt][wt]=Ot;const $t=this.sourceInfo_[dt].bands;tt[dt]=$t?$t.length:St.getSamplesPerPixel();const Mt=ft-(wt+1);mt||(mt=getBoundingBox(St)),yt||(yt=getOrigin(St));const Nt=getResolutions(St,ht[0]);Et[Mt]=Nt[0];const Rt=[St.getTileWidth(),St.getTileHeight()];Rt[0]!==Rt[1]&&Rt[1]<defaultTileSize&&(Rt[0]=defaultTileSize,Rt[1]=defaultTileSize),bt[Mt]=Rt;const Pt=Nt[0]/Math.abs(Nt[1]);vt[Mt]=[Rt[0],Rt[1]/Pt]}if(Y?getIntersection(Y,mt,Y):Y=mt,!te)te=yt;else{const wt=`Origin mismatch for source ${dt}, got [${yt}] but expected [${te}]`;assertEqual(te,yt,0,wt,this.viewRejector)}if(!et)et=Et,this.resolutionFactors_[dt]=1;else{et.length-ot>Et.length&&(ot=et.length-Et.length);const wt=et[et.length-1]/Et[Et.length-1];this.resolutionFactors_[dt]=wt;const St=Et.map($t=>$t*=wt),Ot=`Resolution mismatch for source ${dt}, got [${St}] but expected [${et}]`;assertEqual(et.slice(ot,et.length),St,.02,Ot,this.viewRejector)}ne?assertEqual(ne.slice(ot,ne.length),vt,.01,`Tile size mismatch for source ${dt}`,this.viewRejector):ne=vt,xe?assertEqual(xe.slice(ot,xe.length),bt,0,`Tile size mismatch for source ${dt}`,this.viewRejector):xe=bt,this.sourceImagery_[dt]=ht.reverse(),this.sourceMasks_[dt]=pt.reverse()}for(let dt=0,ht=this.sourceImagery_.length;dt<ht;++dt){const pt=this.sourceImagery_[dt];for(;pt.length<et.length;)pt.unshift(void 0)}this.getProjection()||this.determineProjection(O),this.determineTransformMatrix(O),this.samplesPerPixel_=tt,this.nodataValues_=it,this.metadata_=st;e:for(let dt=0;dt<rt;++dt){if(this.sourceInfo_[dt].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[dt].length){this.addAlpha_=!0;break}const ht=it[dt],pt=this.sourceInfo_[dt].bands;if(pt){for(let ft=0;ft<pt.length;++ft)if(ht[pt[ft]-1]!==null){this.addAlpha_=!0;break e}continue}for(let ft=0;ft<ht.length;++ft)if(ht[ft]!==null){this.addAlpha_=!0;break e}}let nt=this.addAlpha_?1:0;for(let dt=0;dt<rt;++dt)nt+=tt[dt];this.bandCount=nt;const at=new TileGrid({extent:Y,minZoom:ot,origin:te,resolutions:et,tileSizes:ne});this.tileGrid=at,this.setTileSizes(xe),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const ct=1;et.length===2?et=[et[0],et[1],et[1]/2]:et.length===1&&(et=[et[0]*2,et[0],et[0]/2]);let ut=Y;if(this.transformMatrix){const dt=makeInverse(create$2(),this.transformMatrix.slice()),ht=createTransformFromCoordinateTransform(pt=>apply$1(dt,pt));ut=applyTransform(Y,ht)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:et,center:toUserCoordinate(getCenter(ut),this.projection),extent:toUserExtent(ut,this.projection),zoom:ct})}loadTile_(O,Y,te,ne){const xe=this.getTileSize(O),et=this.sourceImagery_.length,tt=new Array(et*2),it=this.nodataValues_,st=this.sourceInfo_,ot=getWorkerPool();for(let rt=0;rt<et;++rt){const nt=st[rt],at=this.resolutionFactors_[rt],ct=[Math.round(Y*(xe[0]*at)),Math.round(te*(xe[1]*at)),Math.round((Y+1)*(xe[0]*at)),Math.round((te+1)*(xe[1]*at))],ut=this.sourceImagery_[rt][O];let dt;nt.bands&&(dt=nt.bands.map(function(yt){return yt-1}));let ht;"nodata"in nt&&nt.nodata!==null?ht=nt.nodata:dt?ht=dt.map(function(yt){return it[rt][yt]}):ht=it[rt];const pt={window:ct,width:xe[0],height:xe[1],samples:dt,fillValue:ht,pool:ot,interleave:!1,signal:ne.signal};readRGB(this.convertToRGB_,ut)?tt[rt]=ut.readRGB(pt):tt[rt]=ut.readRasters(pt);const ft=et+rt,mt=this.sourceMasks_[rt][O];if(!mt){tt[ft]=Promise.resolve(null);continue}tt[ft]=mt.readRasters({window:ct,width:xe[0],height:xe[1],samples:[0],pool:ot,interleave:!1})}return Promise.all(tt).then(this.composeTile_.bind(this,xe)).catch(function(rt){throw error$1(rt),rt})}composeTile_(O,Y){const te=this.metadata_,ne=this.sourceInfo_,xe=this.sourceImagery_.length,et=this.bandCount,tt=this.samplesPerPixel_,it=this.nodataValues_,st=this.normalize_,ot=this.addAlpha_,rt=O[0]*O[1],nt=rt*et;let at;st?at=new Uint8Array(nt):at=new Float32Array(nt);let ct=0;for(let ut=0;ut<rt;++ut){let dt=ot;for(let ht=0;ht<xe;++ht){const pt=ne[ht];let ft=pt.min,mt=pt.max,yt,bt;if(st){const vt=te[ht][0];ft===void 0&&(vt&&STATISTICS_MINIMUM in vt?ft=parseFloat(vt[STATISTICS_MINIMUM]):ft=getMinForDataType(Y[ht][0])),mt===void 0&&(vt&&STATISTICS_MAXIMUM in vt?mt=parseFloat(vt[STATISTICS_MAXIMUM]):mt=getMaxForDataType(Y[ht][0])),yt=255/(mt-ft),bt=-ft*yt}for(let vt=0;vt<tt[ht];++vt){const Et=Y[ht][vt][ut];let wt;if(st?wt=clamp$1(yt*Et+bt,0,255):wt=Et,!ot)at[ct]=wt;else{let St=pt.nodata;if(St===void 0){let $t;pt.bands?$t=pt.bands[vt]-1:$t=vt,St=it[ht][$t]}const Ot=isNaN(St);(!Ot&&Et!==St||Ot&&!isNaN(Et))&&(dt=!1,at[ct]=wt)}ct++}if(!dt){const vt=xe+ht,Et=Y[vt];Et&&!Et[0][ut]&&(dt=!0)}}ot&&(dt||(at[ct]=255),ct++)}return at}}GeoTIFFSource.prototype.getView;const maxZoom=22;class Google extends TileImage{constructor(O){const Y=!!O.highDpi;super({attributionsCollapsible:O.attributionsCollapsible,cacheSize:O.cacheSize,crossOrigin:"anonymous",interpolate:O.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:O.reprojectionErrorThreshold,state:"loading",tileLoadFunction:O.tileLoadFunction,tilePixelRatio:Y?2:1,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition,zDirection:O.zDirection}),this.apiKey_=O.key,this.error_=null;const te={mapType:O.mapType||"roadmap",language:O.language||"en-US",region:O.region||"US"};O.imageFormat&&(te.imageFormat=O.imageFormat),O.scale&&(te.scale=O.scale),Y&&(te.highDpi=!0),O.layerTypes&&(te.layerTypes=O.layerTypes),O.styles&&(te.styles=O.styles),O.overlay===!0&&(te.overlay=!0),O.apiOptions&&(te.apiOptions=O.apiOptions),this.sessionTokenRequest_=te,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_;const ne=O.url||"https://tile.googleapis.com/";this.createSessionUrl_=ne+"v1/createSession",this.tileUrl_=ne+"v1/2dtiles",this.attributionUrl_=ne+"tile/v1/viewport",this.createSession_()}getError(){return this.error_}fetchSessionToken(O,Y){return fetch(O,Y)}async createSession_(){const O=this.createSessionUrl_+"?key="+this.apiKey_,Y={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},te=await this.fetchSessionToken(O,Y);if(!te.ok){try{const nt=await te.json();this.error_=new Error(nt.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const ne=await te.json(),xe=this.getTilePixelRatio(1),et=[ne.tileWidth/xe,ne.tileHeight/xe];this.tileGrid=createXYZ({extent:extentFromProjection(this.getProjection()),maxZoom,tileSize:et});const tt=ne.session;this.sessionTokenValue_=tt;const it=this.apiKey_,st=this.tileUrl_;this.tileUrlFunction=function(nt,at,ct){const ut=nt[0],dt=nt[1],ht=nt[2];return`${st}/${ut}/${dt}/${ht}?session=${tt}&key=${it}`};const ot=parseInt(ne.expiry,10)*1e3,rt=Math.max(ot-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),rt),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(O){if(O.viewHints[ViewHint.ANIMATING]||O.viewHints[ViewHint.INTERACTING]||O.animate)return this.previousViewportAttribution_;const[Y,te]=toLonLat(getBottomLeft(O.extent),O.viewState.projection),[ne,xe]=toLonLat(getTopRight(O.extent),O.viewState.projection),it=`zoom=${this.getTileGrid().getZForResolution(O.viewState.resolution,this.zDirection)}&north=${xe}&south=${te}&east=${ne}&west=${Y}`;if(this.previousViewportExtent_==it)return this.previousViewportAttribution_;this.previousViewportExtent_=it;const st=this.sessionTokenValue_,ot=this.apiKey_,nt=`${this.attributionUrl_}?session=${st}&key=${ot}&${it}`;return this.previousViewportAttribution_=await fetch(nt).then(at=>at.json()).then(at=>at.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}const Versions={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},IIIF_PROFILE_VALUES={};IIIF_PROFILE_VALUES[Versions.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};IIIF_PROFILE_VALUES[Versions.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};IIIF_PROFILE_VALUES[Versions.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};IIIF_PROFILE_VALUES.none={none:{supports:[],formats:[],qualities:[]}};const COMPLIANCE_VERSION1=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,COMPLIANCE_VERSION2=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,COMPLIANCE_VERSION3=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function generateVersion1Options(ee){let O=ee.getComplianceLevelSupportedFeatures();return O===void 0&&(O=IIIF_PROFILE_VALUES[Versions.VERSION1].level0),{url:ee.imageInfo["@id"]===void 0?void 0:ee.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:O.supports,formats:[...O.formats,ee.imageInfo.formats===void 0?[]:ee.imageInfo.formats],qualities:[...O.qualities,ee.imageInfo.qualities===void 0?[]:ee.imageInfo.qualities],resolutions:ee.imageInfo.scale_factors,tileSize:ee.imageInfo.tile_width!==void 0?ee.imageInfo.tile_height!==void 0?[ee.imageInfo.tile_width,ee.imageInfo.tile_height]:[ee.imageInfo.tile_width,ee.imageInfo.tile_width]:ee.imageInfo.tile_height!=null?[ee.imageInfo.tile_height,ee.imageInfo.tile_height]:void 0}}function generateVersion2Options(ee){const O=ee.getComplianceLevelSupportedFeatures(),Y=Array.isArray(ee.imageInfo.profile)&&ee.imageInfo.profile.length>1,te=Y&&ee.imageInfo.profile[1].supports?ee.imageInfo.profile[1].supports:[],ne=Y&&ee.imageInfo.profile[1].formats?ee.imageInfo.profile[1].formats:[],xe=Y&&ee.imageInfo.profile[1].qualities?ee.imageInfo.profile[1].qualities:[];return{url:ee.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:ee.imageInfo.sizes===void 0?void 0:ee.imageInfo.sizes.map(function(et){return[et.width,et.height]}),tileSize:ee.imageInfo.tiles===void 0?void 0:[ee.imageInfo.tiles.map(function(et){return et.width})[0],ee.imageInfo.tiles.map(function(et){return et.height===void 0?et.width:et.height})[0]],resolutions:ee.imageInfo.tiles===void 0?void 0:ee.imageInfo.tiles.map(function(et){return et.scaleFactors})[0],supports:[...O.supports,...te],formats:[...O.formats,...ne],qualities:[...O.qualities,...xe]}}function generateVersion3Options(ee){const O=ee.getComplianceLevelSupportedFeatures(),Y=ee.imageInfo.extraFormats===void 0?O.formats:[...O.formats,...ee.imageInfo.extraFormats],te=ee.imageInfo.preferredFormats!==void 0&&Array.isArray(ee.imageInfo.preferredFormats)&&ee.imageInfo.preferredFormats.length>0?ee.imageInfo.preferredFormats.filter(function(ne){return["jpg","png","gif"].includes(ne)}).reduce(function(ne,xe){return ne===void 0&&Y.includes(xe)?xe:ne},void 0):void 0;return{url:ee.imageInfo.id,sizes:ee.imageInfo.sizes===void 0?void 0:ee.imageInfo.sizes.map(function(ne){return[ne.width,ne.height]}),tileSize:ee.imageInfo.tiles===void 0?void 0:[ee.imageInfo.tiles.map(function(ne){return ne.width})[0],ee.imageInfo.tiles.map(function(ne){return ne.height})[0]],resolutions:ee.imageInfo.tiles===void 0?void 0:ee.imageInfo.tiles.map(function(ne){return ne.scaleFactors})[0],supports:ee.imageInfo.extraFeatures===void 0?O.supports:[...O.supports,...ee.imageInfo.extraFeatures],formats:Y,qualities:ee.imageInfo.extraQualities===void 0?O.qualities:[...O.qualities,...ee.imageInfo.extraQualities],preferredFormat:te}}const versionFunctions={};versionFunctions[Versions.VERSION1]=generateVersion1Options;versionFunctions[Versions.VERSION2]=generateVersion2Options;versionFunctions[Versions.VERSION3]=generateVersion3Options;class IIIFInfo{constructor(O){this.setImageInfo(O)}setImageInfo(O){typeof O=="string"?this.imageInfo=JSON.parse(O):this.imageInfo=O}getImageApiVersion(){if(this.imageInfo===void 0)return;let O=this.imageInfo["@context"]||"ol-no-context";typeof O=="string"&&(O=[O]);for(let Y=0;Y<O.length;Y++)switch(O[Y]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Versions.VERSION1;case"http://iiif.io/api/image/2/context.json":return Versions.VERSION2;case"http://iiif.io/api/image/3/context.json":return Versions.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Versions.VERSION1)&&this.imageInfo.identifier)return Versions.VERSION1;break}assert(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(O){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(O===void 0&&(O=this.getImageApiVersion()),O){case Versions.VERSION1:if(COMPLIANCE_VERSION1.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Versions.VERSION3:if(COMPLIANCE_VERSION3.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Versions.VERSION2:if(typeof this.imageInfo.profile=="string"&&COMPLIANCE_VERSION2.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&COMPLIANCE_VERSION2.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(O){const Y=this.getComplianceLevelEntryFromProfile(O);if(Y===void 0)return;const te=Y.match(/level[0-2](?:\.json)?$/g);return Array.isArray(te)?te[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const O=this.getImageApiVersion(),Y=this.getComplianceLevelFromProfile(O);return Y===void 0?IIIF_PROFILE_VALUES.none.none:IIIF_PROFILE_VALUES[O][Y]}getTileSourceOptions(O){const Y=O||{},te=this.getImageApiVersion();if(te===void 0)return;const ne=te===void 0?void 0:versionFunctions[te](this);if(ne!==void 0)return{url:ne.url,version:te,size:[this.imageInfo.width,this.imageInfo.height],sizes:ne.sizes,format:Y.format!==void 0&&ne.formats.includes(Y.format)?Y.format:ne.preferredFormat!==void 0?ne.preferredFormat:"jpg",supports:ne.supports,quality:Y.quality&&ne.qualities.includes(Y.quality)?Y.quality:ne.qualities.includes("native")?"native":"default",resolutions:Array.isArray(ne.resolutions)?ne.resolutions.sort(function(xe,et){return et-xe}):void 0,tileSize:ne.tileSize}}}let CustomTile$1=class extends ImageTile{constructor(O,Y,te,ne,xe,et,tt){super(Y,te,ne,xe,et,tt),this.zoomifyImage_=null,this.tileSize_=O}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const O=super.getImage();if(this.state==TileState.LOADED){const Y=this.tileSize_;if(O.width==Y[0]&&O.height==Y[1])return this.zoomifyImage_=O,O;const te=createCanvasContext2D(Y[0],Y[1]);return te.drawImage(O,0,0),this.zoomifyImage_=te.canvas,te.canvas}return O}};class Zoomify extends TileImage{constructor(O){const Y=O.size,te=O.tierSizeCalculation!==void 0?O.tierSizeCalculation:"default",ne=O.tilePixelRatio||1,xe=Y[0],et=Y[1],tt=[],it=O.tileSize||DEFAULT_TILE_SIZE;let st=it*ne;switch(te){case"default":for(;xe>st||et>st;)tt.push([Math.ceil(xe/st),Math.ceil(et/st)]),st+=st;break;case"truncated":let bt=xe,vt=et;for(;bt>st||vt>st;)tt.push([Math.ceil(bt/st),Math.ceil(vt/st)]),bt>>=1,vt>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}tt.push([1,1]),tt.reverse();const ot=[ne],rt=[0];for(let bt=1,vt=tt.length;bt<vt;bt++)ot.push(ne<<bt),rt.push(tt[bt-1][0]*tt[bt-1][1]+rt[bt-1]);ot.reverse();const nt=new TileGrid({tileSize:it,extent:O.extent||[0,-et,xe,0],resolutions:ot});let at=O.url;at&&!at.includes("{TileGroup}")&&!at.includes("{tileIndex}")&&(at+="{TileGroup}/{z}-{x}-{y}.jpg");const ct=expandUrl(at);let ut=it*ne;function dt(bt){return(function(vt,Et,wt){if(!vt)return;const St=vt[0],Ot=vt[1],$t=vt[2],Mt=Ot+$t*tt[St][0],Nt=(Mt+rt[St])/ut|0,Rt={z:St,x:Ot,y:$t,tileIndex:Mt,TileGroup:"TileGroup"+Nt};return bt.replace(/\{(\w+?)\}/g,function(Pt,kt){return Rt[kt]})})}const ht=createFromTileUrlFunctions(ct.map(dt)),pt=CustomTile$1.bind(null,toSize(it*ne));super({attributions:O.attributions,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:O.projection,tilePixelRatio:ne,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileClass:pt,tileGrid:nt,tileUrlFunction:ht,transition:O.transition}),this.zDirection=O.zDirection;const ft=nt.getTileCoordForCoordAndResolution(getCenter(nt.getExtent()),ot[ot.length-1]),mt=ht(ft,1,null),yt=new Image;yt.addEventListener("error",()=>{ut=it,this.changed()}),yt.src=mt}}function formatPercentage(ee){return ee.toLocaleString("en",{maximumFractionDigits:10})}class IIIF extends TileImage{constructor(O){const Y=O||{};let te=Y.url||"";te=te+(te.lastIndexOf("/")===te.length-1||te===""?"":"/");const ne=Y.version||Versions.VERSION2,xe=Y.sizes||[],et=Y.size;assert(et!=null&&Array.isArray(et)&&et.length==2&&!isNaN(et[0])&&et[0]>0&&!isNaN(et[1])&&et[1]>0,"Missing or invalid `size`");const tt=et[0],it=et[1],st=Y.tileSize,ot=Y.tilePixelRatio||1,rt=Y.format||"jpg",nt=Y.quality||(Y.version==Versions.VERSION1?"native":"default");let at=Y.resolutions||[];const ct=Y.supports||[],ut=Y.extent||[0,-it,tt,0],dt=xe!=null&&Array.isArray(xe)&&xe.length>0,ht=st!==void 0&&(typeof st=="number"&&Number.isInteger(st)&&st>0||Array.isArray(st)&&st.length>0),pt=ct!=null&&Array.isArray(ct)&&(ct.includes("regionByPx")||ct.includes("regionByPct"))&&(ct.includes("sizeByWh")||ct.includes("sizeByH")||ct.includes("sizeByW")||ct.includes("sizeByPct"));let ft,mt,yt;if(at.sort(function(wt,St){return St-wt}),ht||pt)if(st!=null&&(typeof st=="number"&&Number.isInteger(st)&&st>0?(ft=st,mt=st):Array.isArray(st)&&st.length>0&&((st.length==1||st[1]==null&&Number.isInteger(st[0]))&&(ft=st[0],mt=st[0]),st.length==2&&(Number.isInteger(st[0])&&Number.isInteger(st[1])?(ft=st[0],mt=st[1]):st[0]==null&&Number.isInteger(st[1])&&(ft=st[1],mt=st[1])))),(ft===void 0||mt===void 0)&&(ft=DEFAULT_TILE_SIZE,mt=DEFAULT_TILE_SIZE),at.length==0){yt=Math.max(Math.ceil(Math.log(tt/ft)/Math.LN2),Math.ceil(Math.log(it/mt)/Math.LN2));for(let wt=yt;wt>=0;wt--)at.push(Math.pow(2,wt))}else{const wt=Math.max(...at);yt=Math.round(Math.log(wt)/Math.LN2)}else if(ft=tt,mt=it,at=[],dt){xe.sort(function(St,Ot){return St[0]-Ot[0]}),yt=-1;const wt=[];for(let St=0;St<xe.length;St++){const Ot=tt/xe[St][0];if(at.length>0&&at[at.length-1]==Ot){wt.push(St);continue}at.push(Ot),yt++}if(wt.length>0)for(let St=0;St<wt.length;St++)xe.splice(wt[St]-St,1)}else at.push(1),xe.push([tt,it]),yt=0;const bt=new TileGrid({tileSize:[ft,mt],extent:ut,origin:getTopLeft(ut),resolutions:at}),vt=function(wt,St,Ot){let $t,Mt;const Nt=wt[0];if(Nt>yt)return;const Rt=wt[1],Pt=wt[2],kt=at[Nt];if(!(Rt===void 0||Pt===void 0||kt===void 0||Rt<0||Math.ceil(tt/kt/ft)<=Rt||Pt<0||Math.ceil(it/kt/mt)<=Pt)){if(pt||ht){const Wt=Rt*ft*kt,zt=Pt*mt*kt;let Kt=ft*kt,qt=mt*kt,Xt=ft,an=mt;if(Wt+Kt>tt&&(Kt=tt-Wt),zt+qt>it&&(qt=it-zt),Wt+ft*kt>tt&&(Xt=Math.floor((tt-Wt+kt-1)/kt)),zt+mt*kt>it&&(an=Math.floor((it-zt+kt-1)/kt)),Wt==0&&Kt==tt&&zt==0&&qt==it)$t="full";else if(!pt||ct.includes("regionByPx"))$t=Wt+","+zt+","+Kt+","+qt;else if(ct.includes("regionByPct")){const pn=formatPercentage(Wt/tt*100),ln=formatPercentage(zt/it*100),dn=formatPercentage(Kt/tt*100),un=formatPercentage(qt/it*100);$t="pct:"+pn+","+ln+","+dn+","+un}ne==Versions.VERSION3&&(!pt||ct.includes("sizeByWh"))?Mt=Xt+","+an:!pt||ct.includes("sizeByW")?Mt=Xt+",":ct.includes("sizeByH")?Mt=","+an:ct.includes("sizeByWh")?Mt=Xt+","+an:ct.includes("sizeByPct")&&(Mt="pct:"+formatPercentage(100/kt))}else if($t="full",dt){const Wt=xe[Nt][0],zt=xe[Nt][1];ne==Versions.VERSION3?Wt==tt&&zt==it?Mt="max":Mt=Wt+","+zt:Wt==tt?Mt="full":Mt=Wt+","}else Mt=ne==Versions.VERSION3?"max":"full";return te+$t+"/"+Mt+"/0/"+nt+"."+rt}},Et=CustomTile$1.bind(null,toSize(st||256).map(function(wt){return wt*ot}));super({attributions:Y.attributions,attributionsCollapsible:Y.attributionsCollapsible,cacheSize:Y.cacheSize,crossOrigin:Y.crossOrigin,interpolate:Y.interpolate,projection:Y.projection,reprojectionErrorThreshold:Y.reprojectionErrorThreshold,state:Y.state,tileClass:Et,tileGrid:bt,tilePixelRatio:Y.tilePixelRatio,tileUrlFunction:vt,transition:Y.transition}),this.zDirection=Y.zDirection}}function fromResolutionLike(ee){return Array.isArray(ee)?Math.min(...ee):ee}class ReprojImage extends ImageWrapper{constructor(O,Y,te,ne,xe,et,tt){let it=O.getExtent();it&&O.canWrapX()&&(it=it.slice(),it[0]=-1/0,it[2]=1/0);let st=Y.getExtent();st&&Y.canWrapX()&&(st=st.slice(),st[0]=-1/0,st[2]=1/0);const ot=st?getIntersection(te,st):te,rt=getCenter(ot),nt=calculateSourceResolution(O,Y,rt,ne),at=ERROR_THRESHOLD,ct=new Triangulation(O,Y,ot,it,nt*at,ne),ut=ct.calculateSourceExtent(),dt=isEmpty(ut)?null:et(ut,nt,xe),ht=dt?ImageState.IDLE:ImageState.EMPTY,pt=dt?dt.getPixelRatio():1;super(te,ne,pt,ht),this.targetProj_=Y,this.maxSourceExtent_=it,this.triangulation_=ct,this.targetResolution_=ne,this.targetExtent_=te,this.sourceImage_=dt,this.sourcePixelRatio_=pt,this.interpolate_=tt,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ImageState.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const O=this.sourceImage_.getState();if(O==ImageState.LOADED){const Y=getWidth(this.targetExtent_)/this.targetResolution_,te=getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=render$1(Y,te,this.sourcePixelRatio_,fromResolutionLike(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=O,this.changed()}load(){if(this.state==ImageState.IDLE){this.state=ImageState.LOADING,this.changed();const O=this.sourceImage_.getState();O==ImageState.LOADED||O==ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=listen(this.sourceImage_,EventType.CHANGE,Y=>{const te=this.sourceImage_.getState();(te==ImageState.LOADED||te==ImageState.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null}}const DECIMALS=4,ImageSourceEventType={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class ImageSourceEvent extends BaseEvent{constructor(O,Y){super(O),this.image=Y}}class ImageSource extends Source{constructor(O){super({attributions:O.attributions,projection:O.projection,state:O.state,interpolate:O.interpolate!==void 0?O.interpolate:!0}),this.on,this.once,this.un,this.loader=O.loader||null,this.resolutions_=O.resolutions!==void 0?O.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=O.loader?O.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(O){this.resolutions_=O}findNearestResolution(O){const Y=this.getResolutions();if(Y){const te=linearFindNearest(Y,O,0);O=Y[te]}return O}getImage(O,Y,te,ne){const xe=this.getProjection();if(!xe||!ne||equivalent$1(xe,ne))return xe&&(ne=xe),this.getImageInternal(O,Y,te,ne);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&equivalent$1(this.reprojectedImage_.getProjection(),ne)&&this.reprojectedImage_.getResolution()==Y&&equals$1(this.reprojectedImage_.getExtent(),O))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new ReprojImage(xe,ne,O,Y,te,(et,tt,it)=>this.getImageInternal(et,tt,it,xe),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(O,Y,te,ne){if(this.loader){const xe=getRequestExtent(O,Y,te,1),et=this.findNearestResolution(Y);if(this.image&&(this.static_||this.wantedProjection_===ne&&(this.wantedExtent_&&containsExtent(this.wantedExtent_,xe)||containsExtent(this.image.getExtent(),xe))&&(this.wantedResolution_&&fromResolutionLike(this.wantedResolution_)===et||fromResolutionLike(this.image.getResolution())===et)))return this.image;this.wantedProjection_=ne,this.wantedExtent_=xe,this.wantedResolution_=et,this.image=new ImageWrapper(xe,et,te,this.loader),this.image.addEventListener(EventType.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(O){const Y=O.target;let te;switch(Y.getState()){case ImageState.LOADING:this.loading=!0,te=ImageSourceEventType.IMAGELOADSTART;break;case ImageState.LOADED:this.loading=!1,te=ImageSourceEventType.IMAGELOADEND;break;case ImageState.ERROR:this.loading=!1,te=ImageSourceEventType.IMAGELOADERROR;break;default:return}this.hasListener(te)&&this.dispatchEvent(new ImageSourceEvent(te,Y))}}function defaultImageLoadFunction(ee,O){ee.getImage().src=O}function getRequestExtent(ee,O,Y,te){const ne=O/Y,xe=getCenter(ee),et=ceil(getWidth(ee)/ne,DECIMALS),tt=ceil(getHeight(ee)/ne,DECIMALS),it=ceil((te-1)*et/2,DECIMALS),st=et+2*it,ot=ceil((te-1)*tt/2,DECIMALS),rt=tt+2*ot;return getForViewAndSize(xe,ne,0,[st,rt])}function getRequestUrl$1(ee,O,Y,te,ne,xe){const et=ne.getCode().split(/:(?=\d+$)/).pop(),tt=Y/te,it=[round(getWidth(O)/tt,DECIMALS),round(getHeight(O)/tt,DECIMALS)];xe.SIZE=it[0]+","+it[1],xe.BBOX=O.join(","),xe.BBOXSR=et,xe.IMAGESR=et,xe.DPI=Math.round(xe.DPI?xe.DPI*te:90*te);const st=ee.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return appendParams(st,xe)}function createLoader$3(ee){const O=ee.load?ee.load:decode,Y=get$2(ee.projection||"EPSG:3857"),te=ee.ratio??1.5,ne=ee.crossOrigin??null;return function(xe,et,tt){tt=ee.hidpi?tt:1;const it={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(it,ee.params),xe=getRequestExtent(xe,et,tt,te);const st=getRequestUrl$1(ee.url,xe,et,tt,Y,it),ot=new Image;return ot.crossOrigin=ne,O(ot,st).then(rt=>{const nt=getWidth(xe)/rt.width*tt;return{image:rt,extent:xe,resolution:nt,pixelRatio:tt}})}}class ImageArcGISRest extends ImageSource{constructor(O){O=O||{},super({attributions:O.attributions,interpolate:O.interpolate,projection:O.projection,resolutions:O.resolutions}),this.crossOrigin_=O.crossOrigin!==void 0?O.crossOrigin:null,this.hidpi_=O.hidpi!==void 0?O.hidpi:!0,this.url_=O.url,this.imageLoadFunction_=O.imageLoadFunction!==void 0?O.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},O.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=O.ratio!==void 0?O.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(O,Y,te,ne){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==ne)&&(this.loaderProjection_=ne,this.loader=createLoader$3({crossOrigin:this.crossOrigin_,params:this.params_,projection:ne,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(xe,et)=>(this.image.setImage(xe),this.imageLoadFunction_(this.image,et),decode(xe))})),super.getImageInternal(O,Y,te,ne))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(O){this.imageLoadFunction_=O,this.changed()}setUrl(O){O!=this.url_&&(this.url_=O,this.loader=null,this.changed())}setParams(O){this.params_=Object.assign({},O),this.changed()}updateParams(O){Object.assign(this.params_,O),this.changed()}changed(){this.image=null,super.changed()}}class ImageCanvasSource extends ImageSource{constructor(O){O=O||{},super({attributions:O.attributions,interpolate:O.interpolate,projection:O.projection,resolutions:O.resolutions,state:O.state}),this.canvasFunction_=O.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=O.ratio!==void 0?O.ratio:1.5}getImageInternal(O,Y,te,ne){Y=this.findNearestResolution(Y);let xe=this.canvas_;if(xe&&this.renderedRevision_==this.getRevision()&&xe.getResolution()==Y&&xe.getPixelRatio()==te&&containsExtent(xe.getExtent(),O))return xe;O=O.slice(),scaleFromCenter(O,this.ratio_);const et=getWidth(O)/Y,tt=getHeight(O)/Y,it=[et*te,tt*te],st=this.canvasFunction_.call(this,O,Y,te,it,ne);return st&&(xe=new ImageCanvas(O,Y,te,st)),this.canvas_=xe,this.renderedRevision_=this.getRevision(),xe}}function getScale(ee,O,Y,te){const ne=getWidth(ee),xe=getHeight(ee),et=O[0],tt=O[1],it=.0254/te;return tt*ne>et*xe?ne*Y/(et*it):xe*Y/(tt*it)}function getUrl(ee,O,Y,te,ne,xe,et){const tt=getScale(Y,te,xe,et),it=getCenter(Y),st={OPERATION:ne?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:et,SETDISPLAYWIDTH:Math.round(te[0]),SETDISPLAYHEIGHT:Math.round(te[1]),SETVIEWSCALE:tt,SETVIEWCENTERX:it[0],SETVIEWCENTERY:it[1]};return Object.assign(st,O),appendParams(ee,st)}function createLoader$2(ee){const O=ee.load||decode,Y=ee.useOverlay??!1,te=ee.metersPerUnit||1,ne=ee.displayDpi||96,xe=ee.ratio??1,et=ee.crossOrigin??null;return function(tt,it,st){const ot=new Image;ot.crossOrigin=et,tt=getRequestExtent(tt,it,st,xe);const rt=getWidth(tt)/it,nt=getHeight(tt)/it,at=[rt*st,nt*st],ct=getUrl(ee.url,ee.params,tt,at,Y,te,ne);return O(ot,ct).then(ut=>({image:ut,extent:tt,pixelRatio:st}))}}class ImageMapGuide extends ImageSource{constructor(O){super({interpolate:O.interpolate,projection:O.projection,resolutions:O.resolutions}),this.crossOrigin_=O.crossOrigin!==void 0?O.crossOrigin:null,this.displayDpi_=O.displayDpi!==void 0?O.displayDpi:96,this.params_=Object.assign({},O.params),this.url_=O.url,this.imageLoadFunction_=O.imageLoadFunction!==void 0?O.imageLoadFunction:defaultImageLoadFunction,this.hidpi_=O.hidpi!==void 0?O.hidpi:!0,this.metersPerUnit_=O.metersPerUnit!==void 0?O.metersPerUnit:1,this.ratio_=O.ratio!==void 0?O.ratio:1,this.useOverlay_=O.useOverlay!==void 0?O.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(O,Y,te,ne){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==ne)&&(this.loaderProjection_=ne,this.loader=createLoader$2({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(xe,et)=>(this.image.setImage(xe),this.imageLoadFunction_(this.image,et),decode(xe))})),super.getImageInternal(O,Y,te,ne))}getImageLoadFunction(){return this.imageLoadFunction_}setParams(O){this.params_=Object.assign({},O),this.changed()}updateParams(O){Object.assign(this.params_,O),this.changed()}setImageLoadFunction(O){this.imageLoadFunction_=O,this.changed()}changed(){this.image=null,super.changed()}}function createLoader$1(ee){const O=ee.load||decode,Y=ee.imageExtent,te=ee.crossOrigin??null;return()=>{const ne=new Image;return ne.crossOrigin=te,O(ne,ee.url).then(xe=>{const et=getWidth(Y)/xe.width,tt=getHeight(Y)/xe.height;return{image:xe,extent:Y,resolution:et!==tt?[et,tt]:tt,pixelRatio:1}})}}class Static extends ImageSource{constructor(O){const Y=O.crossOrigin!==void 0?O.crossOrigin:null,te=O.imageLoadFunction!==void 0?O.imageLoadFunction:defaultImageLoadFunction;super({attributions:O.attributions,interpolate:O.interpolate,projection:get$2(O.projection)}),this.url_=O.url,this.imageExtent_=O.imageExtent,this.image=null,this.image=new ImageWrapper(this.imageExtent_,void 0,1,createLoader$1({url:O.url,imageExtent:O.imageExtent,crossOrigin:Y,load:(ne,xe)=>(this.image.setImage(ne),te(this.image,xe),decode(ne))})),this.image.addEventListener(EventType.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(O,Y,te,ne){return intersects$1(O,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const loadError=new Error("Image failed to load");function loadImage(ee,O,Y,te,ne){return new Promise((xe,et)=>{const tt=new Image;tt.crossOrigin=ne.crossOrigin??null,tt.addEventListener("load",()=>xe(tt)),tt.addEventListener("error",()=>et(loadError)),tt.src=renderXYZTemplate(ee,O,Y,te,ne.maxY)})}function makeLoaderFromTemplates(ee){return function(O,Y,te,ne){const xe=pickUrl(ee,O,Y,te);return loadImage(xe,O,Y,te,ne)}}function makeLoaderFromGetter(ee){return function(O,Y,te,ne){const xe=ee(O,Y,te,ne);return loadImage(xe,O,Y,te,ne)}}function makeLoaderFromUrlLike(ee){let O;if(Array.isArray(ee))O=makeLoaderFromTemplates(ee);else if(typeof ee=="string"){const Y=expandUrl(ee);O=makeLoaderFromTemplates(Y)}else if(typeof ee=="function")O=makeLoaderFromGetter(ee);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return O}let keyCount=0;function keyFromUrlLike(ee){return Array.isArray(ee)?ee.join(`
`):typeof ee=="string"?ee:(++keyCount,"url-function-key-"+keyCount)}class ImageTileSource extends DataTileSource{constructor(O){O=O||{};let Y=O.loader,te;O.url&&(Y=makeLoaderFromUrlLike(O.url),te=keyFromUrlLike(O.url));const ne=Y?O.state:"loading",xe=O.wrapX===void 0?!0:O.wrapX;super({loader:Y,key:te,attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,maxZoom:O.maxZoom,minZoom:O.minZoom,tileSize:O.tileSize,gutter:O.gutter,maxResolution:O.maxResolution,projection:O.projection,tileGrid:O.tileGrid,state:ne,wrapX:xe,transition:O.transition,interpolate:O.interpolate!==!1,crossOrigin:O.crossOrigin,zDirection:O.zDirection})}setUrl(O){const Y=makeLoaderFromUrlLike(O);this.setLoader(Y),this.setKey(keyFromUrlLike(O)),this.getState()!=="ready"&&this.setState("ready")}}const DEFAULT_VERSION$1="1.3.0",GETFEATUREINFO_IMAGE_SIZE=[101,101];function getRequestUrl(ee,O,Y,te,ne){ne.WIDTH=Y[0],ne.HEIGHT=Y[1];const xe=te.getAxisOrientation(),et=compareVersions(ne.VERSION,"1.3")>=0;ne[et?"CRS":"SRS"]=te.getCode();const tt=et&&xe.startsWith("ne")?[O[1],O[0],O[3],O[2]]:O;return ne.BBOX=tt.join(","),appendParams(ee,ne)}function getImageSrc(ee,O,Y,te,ne,xe,et){xe=Object.assign({REQUEST:"GetMap"},xe);const tt=O/Y,it=[round(getWidth(ee)/tt,DECIMALS),round(getHeight(ee)/tt,DECIMALS)];if(Y!=1)switch(et){case"geoserver":const ot=90*Y+.5|0;"FORMAT_OPTIONS"in xe?xe.FORMAT_OPTIONS+=";dpi:"+ot:xe.FORMAT_OPTIONS="dpi:"+ot;break;case"mapserver":xe.MAP_RESOLUTION=90*Y;break;case"carmentaserver":case"qgis":xe.DPI=90*Y;break;default:throw new Error("Unknown `serverType` configured")}return getRequestUrl(ne,ee,it,te,xe)}function getRequestParams(ee,O){return Object.assign({REQUEST:O,SERVICE:"WMS",VERSION:DEFAULT_VERSION$1,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},ee)}function createLoader(ee){const O=ee.hidpi===void 0?!0:ee.hidpi,Y=get$2(ee.projection||"EPSG:3857"),te=ee.ratio||1.5,ne=ee.load||decode,xe=ee.crossOrigin??null;return(et,tt,it)=>{et=getRequestExtent(et,tt,it,te),it!=1&&(!O||ee.serverType===void 0)&&(it=1);const st=getImageSrc(et,tt,it,Y,ee.url,getRequestParams(ee.params,"GetMap"),ee.serverType),ot=new Image;return ot.crossOrigin=xe,ne(ot,st).then(rt=>({image:rt,extent:et,pixelRatio:it}))}}function getFeatureInfoUrl(ee,O,Y){if(ee.url===void 0)return;const te=get$2(ee.projection||"EPSG:3857"),ne=getForViewAndSize(O,Y,0,GETFEATUREINFO_IMAGE_SIZE),xe={QUERY_LAYERS:ee.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(xe,getRequestParams(ee.params,"GetFeatureInfo"),ee.params);const et=floor((O[0]-ne[0])/Y,DECIMALS),tt=floor((ne[3]-O[1])/Y,DECIMALS),it=compareVersions(xe.VERSION,"1.3")>=0;return xe[it?"I":"X"]=et,xe[it?"J":"Y"]=tt,getRequestUrl(ee.url,ne,GETFEATUREINFO_IMAGE_SIZE,te,xe)}function getLegendUrl(ee,O){if(ee.url===void 0)return;const Y={SERVICE:"WMS",VERSION:DEFAULT_VERSION$1,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(O!==void 0){const te=get$2(ee.projection||"EPSG:3857").getMetersPerUnit()||1,ne=28e-5;Y.SCALE=O*te/ne}if(Object.assign(Y,ee.params),ee.params!==void 0&&Y.LAYER===void 0){const te=Y.LAYERS;if(!(!Array.isArray(te)||te.length!==1))return;Y.LAYER=te}return appendParams(ee.url,Y)}class ImageWMS extends ImageSource{constructor(O){O=O||{},super({attributions:O.attributions,interpolate:O.interpolate,projection:O.projection,resolutions:O.resolutions}),this.crossOrigin_=O.crossOrigin!==void 0?O.crossOrigin:null,this.url_=O.url,this.imageLoadFunction_=O.imageLoadFunction!==void 0?O.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},O.params),this.serverType_=O.serverType,this.hidpi_=O.hidpi!==void 0?O.hidpi:!0,this.renderedRevision_=0,this.ratio_=O.ratio!==void 0?O.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(O,Y,te,ne){const xe=get$2(te),et=this.getProjection();et&&et!==xe&&(Y=calculateSourceResolution(et,xe,O,Y),O=transform(O,xe,et));const tt={url:this.url_,params:{...this.params_,...ne},projection:et||xe};return getFeatureInfoUrl(tt,O,Y)}getLegendUrl(O,Y){return getLegendUrl({url:this.url_,params:{...this.params_,...Y}},O)}getParams(){return this.params_}getImageInternal(O,Y,te,ne){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==ne)&&(this.loaderProjection_=ne,this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:ne,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(xe,et)=>(this.image.setImage(xe),this.imageLoadFunction_(this.image,et),decode(xe))})),super.getImageInternal(O,Y,te,ne))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(O){this.imageLoadFunction_=O,this.changed()}setUrl(O){O!=this.url_&&(this.url_=O,this.loader=null,this.changed())}setParams(O){this.params_=Object.assign({},O),this.changed()}updateParams(O){Object.assign(this.params_,O),this.changed()}changed(){this.image=null,super.changed()}}function jsonp(ee,O,Y,te){const ne=document.createElement("script"),xe="olc_"+getUid(O);function et(){delete window[xe],ne.parentNode.removeChild(ne)}ne.async=!0,ne.src=ee+(ee.includes("?")?"&":"?")+"callback="+xe;const tt=setTimeout(function(){et(),Y&&Y()},1e4);window[xe]=function(it){clearTimeout(tt),et(),O(it)},document.head.appendChild(ne)}class ResponseError extends Error{constructor(O){const Y="Unexpected response status: "+O.status;super(Y),this.name="ResponseError",this.response=O}}class ClientError extends Error{constructor(O){super("Failed to issue request"),this.name="ClientError",this.client=O}}function getJSON(ee){return new Promise(function(O,Y){function te(et){const tt=et.target;if(!tt.status||tt.status>=200&&tt.status<300){let it;try{it=JSON.parse(tt.responseText)}catch(st){const ot="Error parsing response text as JSON: "+st.message;Y(new Error(ot));return}O(it);return}Y(new ResponseError(tt))}function ne(et){Y(new ClientError(et.target))}const xe=new XMLHttpRequest;xe.addEventListener("load",te),xe.addEventListener("error",ne),xe.open("GET",ee),xe.setRequestHeader("Accept","application/json"),xe.send()})}function resolveUrl(ee,O){return O.includes("://")?O:new URL(O,ee).href}const knownMapMediaTypes={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},knownVectorMediaTypes={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function appendCollectionsQueryParam(ee,O){if(!O.length)return ee;const Y=new URL(ee,"file:/");if(Y.pathname.split("/").includes("collections"))return error$1('The "collections" query parameter cannot be added to collection endpoints'),ee;const te=O.map(et=>encodeURIComponent(et)).join(",");Y.searchParams.append("collections",te);const ne=ee.split("?")[0],xe=decodeURIComponent(Y.searchParams.toString());return`${ne}?${xe}`}function getMapTileUrlTemplate(ee,O,Y){let te,ne;for(let xe=0;xe<ee.length;++xe){const et=ee[xe];if(et.rel==="item"){if(et.type===O){te=et.href;break}(knownMapMediaTypes[et.type]||!ne&&et.type.startsWith("image/"))&&(ne=et.href)}}if(!te)if(ne)te=ne;else throw new Error('Could not find "item" link');return Y&&(te=appendCollectionsQueryParam(te,Y)),te}function getVectorTileUrlTemplate(ee,O,Y,te){let ne,xe;const et={};for(let tt=0;tt<ee.length;++tt){const it=ee[tt];if(et[it.type]=it.href,it.rel==="item"){if(it.type===O){ne=it.href;break}knownVectorMediaTypes[it.type]&&(xe=it.href)}}if(!ne&&Y)for(let tt=0;tt<Y.length;++tt){const it=Y[tt];if(et[it]){ne=et[it];break}}if(!ne)if(xe)ne=xe;else throw new Error('Could not find "item" link');return te&&(ne=appendCollectionsQueryParam(ne,te)),ne}function parseTileMatrixSet(ee,O,Y,te){let ne=ee.projection;if(!ne&&(typeof O.crs=="string"?ne=get$2(O.crs):"uri"in O.crs&&(ne=get$2(O.crs.uri)),!ne))throw new Error(`Unsupported CRS: ${JSON.stringify(O.crs)}`);const xe=O.orderedAxes,tt=!(xe?xe.slice(0,2).map(bt=>bt.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):ne.getAxisOrientation()).startsWith("en"),it=O.tileMatrices,st={};for(let bt=0;bt<it.length;++bt){const vt=it[bt];st[vt.id]=vt}const ot={},rt=[];if(te)for(let bt=0;bt<te.length;++bt){const vt=te[bt],Et=vt.tileMatrix;rt.push(Et),ot[Et]=vt}else for(let bt=0;bt<it.length;++bt){const vt=it[bt].id;rt.push(vt)}const nt=rt.length,at=new Array(nt),ct=new Array(nt),ut=new Array(nt),dt=new Array(nt),ht=[-1/0,-1/0,1/0,1/0];for(let bt=0;bt<nt;++bt){const vt=rt[bt],Et=st[vt],wt=Et.pointOfOrigin;tt?at[bt]=[wt[1],wt[0]]:at[bt]=wt,ct[bt]=Et.cellSize,ut[bt]=[Et.matrixWidth,Et.matrixHeight],dt[bt]=[Et.tileWidth,Et.tileHeight];const St=ot[vt];if(St){const Ot=Et.cellSize*Et.tileWidth,$t=at[bt][0]+St.minTileCol*Ot,Mt=at[bt][0]+(St.maxTileCol+1)*Ot,Nt=Et.cellSize*Et.tileHeight,Rt=Et.cornerOfOrigin==="bottomLeft";let Pt,kt;Rt?(Pt=at[bt][1]+St.minTileRow*Nt,kt=at[bt][1]+(St.maxTileRow+1)*Nt):(Pt=at[bt][1]-(St.maxTileRow+1)*Nt,kt=at[bt][1]-St.minTileRow*Nt),getIntersection(ht,[$t,Pt,Mt,kt],ht)}}const pt=new TileGrid({origins:at,resolutions:ct,sizes:ut,tileSizes:dt,extent:te?ht:void 0}),ft=ee.context,mt=ee.url;function yt(bt,vt,Et){if(!bt)return;const wt=rt[bt[0]],St=st[wt],Ot=St.cornerOfOrigin==="bottomLeft",$t={tileMatrix:wt,tileCol:bt[1],tileRow:Ot?-bt[2]-1:bt[2]};if(te){const Nt=ot[St.id];if($t.tileCol<Nt.minTileCol||$t.tileCol>Nt.maxTileCol||$t.tileRow<Nt.minTileRow||$t.tileRow>Nt.maxTileRow)return}Object.assign($t,{z:$t.tileMatrix,x:$t.tileCol,y:$t.tileRow},ft);const Mt=Y.replace(/\{(\w+?)\}/g,function(Nt,Rt){return $t[Rt]});return resolveUrl(mt,Mt)}return{grid:pt,projection:ne,urlTemplate:Y,urlFunction:yt}}function parseTileSetMetadata(ee,O){const Y=O.tileMatrixSetLimits;let te;if(O.dataType==="map")te=getMapTileUrlTemplate(O.links,ee.mediaType,ee.collections);else if(O.dataType==="vector")te=getVectorTileUrlTemplate(O.links,ee.mediaType,ee.supportedMediaTypes,ee.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(O.tileMatrixSet)return parseTileMatrixSet(ee,O.tileMatrixSet,te,Y);const ne=O.links.find(tt=>tt.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!ne)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const xe=ne.href,et=resolveUrl(ee.url,xe);return getJSON(et).then(function(tt){return parseTileMatrixSet(ee,tt,te,Y)})}function getTileSetInfo(ee){return getJSON(ee.url).then(function(O){return parseTileSetMetadata(ee,O)})}class OGCMapTile extends TileImage{constructor(O){super({attributions:O.attributions,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:O.projection,reprojectionErrorThreshold:O.reprojectionErrorThreshold,state:"loading",tileLoadFunction:O.tileLoadFunction,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition});const Y={url:O.url,projection:this.getProjection(),mediaType:O.mediaType,context:O.context||null,collections:O.collections};getTileSetInfo(Y).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(O){this.tileGrid=O.grid,this.projection=O.projection,this.setTileUrlFunction(O.urlFunction,O.urlTemplate),this.setState("ready")}handleError_(O){error$1(O),this.setState("error")}}class VectorTile extends UrlTile{constructor(O){const Y=O.projection||"EPSG:3857",te=O.extent||extentFromProjection(Y),ne=O.tileGrid||createXYZ({extent:te,maxResolution:O.maxResolution,maxZoom:O.maxZoom!==void 0?O.maxZoom:22,minZoom:O.minZoom,tileSize:O.tileSize||512});super({attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,cacheSize:O.cacheSize,interpolate:!0,projection:Y,state:O.state,tileGrid:ne,tileLoadFunction:O.tileLoadFunction?O.tileLoadFunction:defaultLoadFunction,tileUrlFunction:O.tileUrlFunction,url:O.url,urls:O.urls,wrapX:O.wrapX===void 0?!0:O.wrapX,transition:O.transition,zDirection:O.zDirection===void 0?1:O.zDirection}),this.format_=O.format?O.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=O.overlaps==null?!0:O.overlaps,this.tileClass=O.tileClass?O.tileClass:VectorTile$1,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(O,Y,te){if(te.getState()===TileState.IDLE){te.setState(TileState.LOADING);const ne=te.wrappedTileCoord,xe=this.getTileGridForProjection(Y);let et=xe.getTileCoordExtent(ne);const tt=ne[0],it=xe.getResolution(tt);buffer$1(et,-it,et);const st=this.projection;Y&&this.projection&&!equivalent$1(Y,st)&&(et=transformExtent(et,Y,st));const ot=this.tileGrid,rt=ot.getExtent();rt&&getIntersection(et,rt,et);let nt=it;Y&&st&&!equivalent$1(Y,st)&&(nt=it/st.getMetersPerUnit()/Y.getMetersPerUnit());const at=ot.getZForResolution(nt,this.zDirection);ot.forEachTileCoord(et,at,ct=>{const ut=this.tileUrlFunction(ct,O,Y);this.sourceTiles_[ut]||(this.sourceTiles_[ut]=new this.tileClass(ct,ut?TileState.IDLE:TileState.EMPTY,ut,this.format_,this.tileLoadFunction));const dt=this.sourceTiles_[ut];te.sourceTiles.push(dt),this.tileKeysBySourceTileUrl_[ut]||(this.tileKeysBySourceTileUrl_[ut]=[]),this.tileKeysBySourceTileUrl_[ut].push(te.getKey());const ht=dt.getState();if(ht<TileState.LOADED){const pt=ft=>{this.handleTileChange(ft);const mt=dt.getState();if(mt===TileState.LOADED||mt===TileState.ERROR){const yt=dt.getKey();yt in te.errorTileKeys?dt.getState()===TileState.LOADED&&delete te.errorTileKeys[yt]:te.loadingSourceTiles--,mt===TileState.ERROR?te.errorTileKeys[yt]=!0:dt.removeEventListener(EventType.CHANGE,pt),te.loadingSourceTiles===0&&te.setState(isEmpty$1(te.errorTileKeys)?TileState.LOADED:TileState.ERROR)}};dt.addEventListener(EventType.CHANGE,pt),te.loadingSourceTiles++}ht===TileState.IDLE&&(dt.extent=ot.getTileCoordExtent(ct),dt.projection=this.projection,dt.resolution=ot.getResolution(ct[0]),dt.load())}),te.loadingSourceTiles||te.setState(te.sourceTiles.some(ct=>ct.getState()===TileState.ERROR)?TileState.ERROR:TileState.LOADED)}return te.sourceTiles}removeSourceTiles(O){const Y=O.getKey(),te=O.sourceTiles;for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne].getTileUrl();if(!this.tileKeysBySourceTileUrl_[et])return;const tt=this.tileKeysBySourceTileUrl_[et].indexOf(Y);tt!==-1&&(this.tileKeysBySourceTileUrl_[et].splice(tt,1),this.tileKeysBySourceTileUrl_[et].length===0&&(delete this.tileKeysBySourceTileUrl_[et],delete this.sourceTiles_[et]))}}getTile(O,Y,te,ne,xe){const et=[O,Y,te];let tt=this.getTileCoordForTileUrlFunction(et,xe);const it=this.getTileGrid().getExtent(),st=this.projection,ot=this.getTileGridForProjection(xe);if(tt&&it){const at=ot.getTileCoordExtent(tt);buffer$1(at,-ot.getResolution(O),at),intersects$1(it,!xe||!st||equivalent$1(xe,st)?at:transformExtent(at,xe,st))||(tt=null)}let rt=!0;if(tt!==null){const at=this.tileGrid,ct=ot.getResolution(O);let ut=ct;xe&&st&&!equivalent$1(xe,st)&&(ut=ct/st.getMetersPerUnit()/xe.getMetersPerUnit());const dt=at.getZForResolution(ut,1),ht=ot.getTileCoordExtent(tt);buffer$1(ht,-ct,ht),at.forEachTileCoord(!xe||!st||equivalent$1(xe,st)?ht:transformExtent(ht,xe,st),dt,pt=>{rt=rt&&!this.tileUrlFunction(pt,ne,st)})}const nt=new VectorRenderTile(et,rt?TileState.EMPTY:TileState.IDLE,tt,this.getSourceTiles.bind(this,ne,xe),this.removeSourceTiles.bind(this));return nt.key=this.getKey(),nt}getTileGridForProjection(O){const Y=O.getCode();let te=this.tileGrids_[Y];if(!te){const ne=this.projection;if(ne!==null&&!equivalent$1(ne,O))return getForProjection(O);const xe=this.tileGrid,et=xe.getResolutions().slice(),tt=et.map(function(ot,rt){return xe.getOrigin(rt)}),it=et.map(function(ot,rt){return xe.getTileSize(rt)}),st=DEFAULT_MAX_ZOOM+1;for(let ot=et.length;ot<st;++ot)et.push(et[ot-1]/2),tt.push(tt[ot-1]),it.push(it[ot-1]);te=new TileGrid({extent:xe.getExtent(),origins:tt,resolutions:et,tileSizes:it}),this.tileGrids_[Y]=te}return te}getTilePixelRatio(O){return O}getTilePixelSize(O,Y,te){const ne=this.getTileGridForProjection(te),xe=toSize(ne.getTileSize(O),this.tmpSize);return[Math.round(xe[0]*Y),Math.round(xe[1]*Y)]}setOverlaps(O){this.overlaps_=O,this.changed()}}function defaultLoadFunction(ee,O){ee.setLoader(function(Y,te,ne){loadFeaturesXhr(O,ee.getFormat(),Y,te,ne,ee.onLoad.bind(ee),ee.onError.bind(ee))})}class OGCVectorTile extends VectorTile{constructor(O){super({attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,cacheSize:O.cacheSize,format:O.format,overlaps:O.overlaps,projection:O.projection,tileClass:O.tileClass,transition:O.transition,wrapX:O.wrapX,zDirection:O.zDirection,state:"loading"});const Y={url:O.url,projection:this.getProjection(),mediaType:O.mediaType,supportedMediaTypes:O.format.supportedMediaTypes,context:O.context||null,collections:O.collections};getTileSetInfo(Y).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(O){this.tileGrid=O.grid,this.projection=O.projection,this.setTileUrlFunction(O.urlFunction,O.urlTemplate),this.setState("ready")}handleError_(O){error$1(O),this.setState("error")}}const ATTRIBUTION='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class OSM extends XYZ{constructor(O){O=O||{};let Y;O.attributions!==void 0?Y=O.attributions:Y=[ATTRIBUTION];const te=O.crossOrigin!==void 0?O.crossOrigin:"anonymous",ne=O.url!==void 0?O.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:Y,attributionsCollapsible:!1,cacheSize:O.cacheSize,crossOrigin:te,interpolate:O.interpolate,maxZoom:O.maxZoom!==void 0?O.maxZoom:19,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileLoadFunction:(xe,et)=>{const tt=xe.getImage();!WORKER_OFFSCREEN_CANVAS&&tt instanceof HTMLImageElement&&(tt.referrerPolicy="origin-when-cross-origin"),(O.tileLoadFunction||defaultTileLoadFunction)(xe,et)},transition:O.transition,url:ne,wrapX:O.wrapX,zDirection:O.zDirection})}}class CanvasImageLayerRenderer extends CanvasLayerRenderer{constructor(O){super(O),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(O){const Y=O.layerStatesArray[O.layerIndex],te=O.pixelRatio,ne=O.viewState,xe=ne.resolution,et=this.getLayer().getSource(),tt=O.viewHints;let it=O.extent;if(Y.extent!==void 0&&(it=getIntersection(it,fromUserExtent(Y.extent,ne.projection))),!tt[ViewHint.ANIMATING]&&!tt[ViewHint.INTERACTING]&&!isEmpty(it))if(et){const st=ne.projection,ot=et.getImage(it,xe,te,st);ot&&(this.loadImage(ot)?this.image=ot:ot.getState()===ImageState.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(O){const Y=this.frameState;if(!Y)return null;const te=this.getLayer(),ne=apply$1(Y.pixelToCoordinateTransform,O.slice()),xe=te.getExtent();if(xe&&!containsCoordinate(xe,ne))return null;const et=this.image.getExtent(),tt=this.image.getImage(),it=getWidth(et),st=Math.floor(tt.width*((ne[0]-et[0])/it));if(st<0||st>=tt.width)return null;const ot=getHeight(et),rt=Math.floor(tt.height*((et[3]-ne[1])/ot));return rt<0||rt>=tt.height?null:this.getImageData(tt,st,rt)}renderFrame(O,Y){const te=this.image,ne=te.getExtent(),xe=te.getResolution(),[et,tt]=Array.isArray(xe)?xe:[xe,xe],it=te.getPixelRatio(),st=O.layerStatesArray[O.layerIndex],ot=O.pixelRatio,rt=O.viewState,nt=rt.center,at=rt.resolution,ct=ot*et/(at*it),ut=ot*tt/(at*it);this.prepareContainer(O,Y);const dt=this.context.canvas.width,ht=this.context.canvas.height,pt=this.getRenderContext(O);let ft=!1,mt=!0;if(st.extent){const wt=fromUserExtent(st.extent,rt.projection);mt=intersects$1(wt,O.extent),ft=mt&&!containsExtent(wt,O.extent),ft&&this.clipUnrotated(pt,O,wt)}const yt=te.getImage(),bt=compose(this.tempTransform,dt/2,ht/2,ct,ut,0,it*(ne[0]-nt[0])/et,it*(nt[1]-ne[3])/tt);this.renderedResolution=tt*ot/it;const vt=yt.width*bt[0],Et=yt.height*bt[3];if(this.getLayer().getSource().getInterpolate()||(pt.imageSmoothingEnabled=!1),this.preRender(pt,O),mt&&vt>=.5&&Et>=.5){const wt=bt[4],St=bt[5],Ot=st.opacity;Ot!==1&&(pt.save(),pt.globalAlpha=Ot),pt.drawImage(yt,0,0,+yt.width,+yt.height,wt,St,vt,Et),Ot!==1&&pt.restore()}return this.postRender(this.context,O),ft&&pt.restore(),pt.imageSmoothingEnabled=!0,this.container}}class BaseImageLayer extends Layer{constructor(O){O=O||{},super(O)}}class ImageLayer extends BaseImageLayer{constructor(O){super(O)}createRenderer(){return new CanvasImageLayerRenderer(this)}getData(O){return super.getData(O)}}function addTileToLookup(ee,O,Y){if(!(Y in ee))return ee[Y]=new Set([O]),!0;const te=ee[Y],ne=te.has(O);return ne||te.add(O),!ne}function removeTileFromLookup(ee,O,Y){const te=ee[Y];return te?te.delete(O):!1}function getRenderExtent$1(ee,O){const Y=ee.layerStatesArray[ee.layerIndex];Y.extent&&(O=getIntersection(O,fromUserExtent(Y.extent,ee.viewState.projection)));const te=Y.layer.getRenderSource();if(!te.getWrapX()){const ne=te.getTileGridForProjection(ee.viewState.projection).getExtent();ne&&(O=getIntersection(O,ne))}return O}class CanvasTileLayerRenderer extends CanvasLayerRenderer{constructor(O,Y){super(O),Y=Y||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=createEmpty(),this.tempTileRange_=new TileRange(0,0,0,0),this.tempTileCoord_=createOrUpdate(0,0,0);const te=Y.cacheSize!==void 0?Y.cacheSize:512;this.tileCache_=new LRUCache(te),this.sourceTileCache_=null,this.maxStaleKeys=te*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new LRUCache(512)),this.sourceTileCache_}getOrCreateTile(O,Y,te,ne){const xe=this.tileCache_,tt=this.getLayer().getSource(),it=getCacheKey$1(tt,tt.getKey(),O,Y,te);let st;if(xe.containsKey(it))st=xe.get(it);else{const ot=ne.viewState.projection,rt=tt.getProjection();if(st=tt.getTile(O,Y,te,ne.pixelRatio,ot,!rt||equivalent$1(rt,ot)?void 0:this.getSourceTileCache()),!st)return null;xe.set(it,st)}return st}getTile(O,Y,te,ne){const xe=this.getOrCreateTile(O,Y,te,ne);return xe||null}getData(O){const Y=this.frameState;if(!Y)return null;const te=this.getLayer(),ne=apply$1(Y.pixelToCoordinateTransform,O.slice()),xe=te.getExtent();if(xe&&!containsCoordinate(xe,ne))return null;const et=Y.viewState,tt=te.getRenderSource(),it=tt.getTileGridForProjection(et.projection),st=tt.getTilePixelRatio(Y.pixelRatio);for(let ot=it.getZForResolution(et.resolution);ot>=it.getMinZoom();--ot){const rt=it.getTileCoordForCoordAndZ(ne,ot),nt=this.getTile(ot,rt[1],rt[2],Y);if(!nt||nt.getState()!==TileState.LOADED)continue;const at=it.getOrigin(ot),ct=toSize(it.getTileSize(ot)),ut=it.getResolution(ot);let dt;if(nt instanceof ImageTile||nt instanceof ReprojTile)dt=nt.getImage();else if(nt instanceof DataTile){if(dt=asImageLike(nt.getData()),!dt)continue}else continue;const ht=Math.floor(st*((ne[0]-at[0])/ut-rt[1]*ct[0])),pt=Math.floor(st*((at[1]-ne[1])/ut-rt[2]*ct[1])),ft=Math.round(st*tt.getGutterForProjection(et.projection));return this.getImageData(dt,ht+ft,pt+ft)}return null}prepareFrame(O){this.renderedProjection?O.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=O.viewState.projection):this.renderedProjection=O.viewState.projection;const Y=this.getLayer().getSource();if(!Y)return!1;const te=Y.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==te&&(this.renderedSourceRevision_=te,this.renderedSourceKey_===Y.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=te,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(O,Y,te,ne,xe){const et=O.viewState,tt=this.getLayer(),it=tt.getRenderSource(),st=it.getTileGridForProjection(et.projection),ot=getUid(it);ot in O.wantedTiles||(O.wantedTiles[ot]={});const rt=O.wantedTiles[ot],nt=tt.getMapInternal(),at=Math.max(te-xe,st.getMinZoom(),st.getZForResolution(Math.min(tt.getMaxResolution(),nt?nt.getView().getResolutionForZoom(Math.max(tt.getMinZoom(),0)):st.getResolution(0)),it.zDirection)),ct=et.rotation,ut=ct?getRotatedViewport(et.center,et.resolution,ct,O.size):void 0;for(let dt=te;dt>=at;--dt){const ht=st.getTileRangeForExtentAndZ(Y,dt,this.tempTileRange_),pt=st.getResolution(dt);for(let ft=ht.minX;ft<=ht.maxX;++ft)for(let mt=ht.minY;mt<=ht.maxY;++mt){if(ct&&!st.tileCoordIntersectsViewport([dt,ft,mt],ut))continue;const yt=this.getTile(dt,ft,mt,O);if(!yt||!addTileToLookup(ne,yt,dt))continue;const vt=yt.getKey();if(rt[vt]=!0,yt.getState()===TileState.IDLE&&!O.tileQueue.isKeyQueued(vt)){const Et=createOrUpdate(dt,ft,mt,this.tempTileCoord_);O.tileQueue.enqueue([yt,ot,st.getTileCoordCenter(Et),pt])}}}}findStaleTile_(O,Y){const te=this.tileCache_,ne=O[0],xe=O[1],et=O[2],tt=this.getStaleKeys();for(let it=0;it<tt.length;++it){const st=getCacheKey$1(this.getLayer().getSource(),tt[it],ne,xe,et);if(te.containsKey(st)){const ot=te.peek(st);if(ot.getState()===TileState.LOADED)return ot.endTransition(getUid(this)),addTileToLookup(Y,ot,ne),!0}}return!1}findAltTiles_(O,Y,te,ne){const xe=O.getTileRangeForTileCoordAndZ(Y,te,this.tempTileRange_);if(!xe)return!1;let et=!0;const tt=this.tileCache_,it=this.getLayer().getRenderSource(),st=it.getKey();for(let ot=xe.minX;ot<=xe.maxX;++ot)for(let rt=xe.minY;rt<=xe.maxY;++rt){const nt=getCacheKey$1(it,st,te,ot,rt);let at=!1;if(tt.containsKey(nt)){const ct=tt.peek(nt);ct.getState()===TileState.LOADED&&(addTileToLookup(ne,ct,te),at=!0)}at||(et=!1)}return et}renderFrame(O,Y){this.renderComplete=!0;const te=O.layerStatesArray[O.layerIndex],ne=O.viewState,xe=ne.projection,et=ne.resolution,tt=ne.center,it=O.pixelRatio,st=this.getLayer(),ot=st.getSource(),rt=ot.getTileGridForProjection(xe),nt=rt.getZForResolution(et,ot.zDirection),at=rt.getResolution(nt),ct=ot.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==ct&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=ct):this.renderedSourceKey_=ct;let ut=O.extent;const dt=ot.getTilePixelRatio(it);this.prepareContainer(O,Y);const ht=this.context.canvas.width,pt=this.context.canvas.height,ft=te.extent&&fromUserExtent(te.extent,xe);ft&&(ut=getIntersection(ut,fromUserExtent(te.extent,xe)));const mt=at*ht/2/dt,yt=at*pt/2/dt,bt=[tt[0]-mt,tt[1]-yt,tt[0]+mt,tt[1]+yt],vt={};this.renderedTiles.length=0;const Et=st.getPreload();if(O.nextExtent&&this.enqueueTilesForNextExtent()){const Wt=rt.getZForResolution(ne.nextResolution,ot.zDirection),zt=getRenderExtent$1(O,O.nextExtent);this.enqueueTiles(O,zt,Wt,vt,Et)}const wt=getRenderExtent$1(O,ut);if(this.enqueueTiles(O,wt,nt,vt,0),Et>0&&setTimeout(()=>{this.enqueueTiles(O,wt,nt-1,vt,Et-1)},0),!(nt in vt))return this.container;const St=getUid(this),Ot=O.time;for(const Wt of vt[nt]){const zt=Wt.getState();if(zt===TileState.EMPTY)continue;const Kt=Wt.tileCoord;if(zt===TileState.LOADED&&Wt.getAlpha(St,Ot)===1){Wt.endTransition(St);continue}if(zt!==TileState.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Kt,vt)){removeTileFromLookup(vt,Wt,nt),O.animate=!0;continue}if(this.findAltTiles_(rt,Kt,nt+1,vt))continue;const an=rt.getMinZoom();for(let pn=nt-1;pn>=an&&!this.findAltTiles_(rt,Kt,pn,vt);--pn);}const $t=at/et*it/dt,Mt=this.getRenderContext(O);compose(this.tempTransform,ht/2,pt/2,$t,$t,0,-ht/2,-pt/2),te.extent&&this.clipUnrotated(Mt,O,ft),ot.getInterpolate()||(Mt.imageSmoothingEnabled=!1),this.preRender(Mt,O);const Nt=Object.keys(vt).map(Number);Nt.sort(ascending);let Rt;const Pt=[],kt=[];for(let Wt=Nt.length-1;Wt>=0;--Wt){const zt=Nt[Wt],Kt=ot.getTilePixelSize(zt,it,xe),Xt=rt.getResolution(zt)/at,an=Kt[0]*Xt*$t,pn=Kt[1]*Xt*$t,ln=rt.getTileCoordForCoordAndZ(getTopLeft(bt),zt),dn=rt.getTileCoordExtent(ln),un=apply$1(this.tempTransform,[dt*(dn[0]-bt[0])/at,dt*(bt[3]-dn[3])/at]),Tn=dt*ot.getGutterForProjection(xe);for(const Sn of vt[zt]){if(Sn.getState()!==TileState.LOADED)continue;const bn=Sn.tileCoord,on=ln[1]-bn[1],zn=Math.round(un[0]-(on-1)*an),Ln=ln[2]-bn[2],hn=Math.round(un[1]-(Ln-1)*pn),Hn=Math.round(un[0]-on*an),Wn=Math.round(un[1]-Ln*pn),Gn=zn-Hn,gr=hn-Wn,Qn=Nt.length===1;let sr=!1;Rt=[Hn,Wn,Hn+Gn,Wn,Hn+Gn,Wn+gr,Hn,Wn+gr];for(let cr=0,On=Pt.length;cr<On;++cr)if(!Qn&&zt<kt[cr]){const kn=Pt[cr];intersects$1([Hn,Wn,Hn+Gn,Wn+gr],[kn[0],kn[3],kn[4],kn[7]])&&(sr||(Mt.save(),sr=!0),Mt.beginPath(),Mt.moveTo(Rt[0],Rt[1]),Mt.lineTo(Rt[2],Rt[3]),Mt.lineTo(Rt[4],Rt[5]),Mt.lineTo(Rt[6],Rt[7]),Mt.moveTo(kn[6],kn[7]),Mt.lineTo(kn[4],kn[5]),Mt.lineTo(kn[2],kn[3]),Mt.lineTo(kn[0],kn[1]),Mt.clip())}Pt.push(Rt),kt.push(zt),this.drawTile(Sn,O,Hn,Wn,Gn,gr,Tn,Qn),sr&&Mt.restore(),this.renderedTiles.unshift(Sn),this.updateUsedTiles(O.usedTiles,ot,Sn)}}if(this.renderedResolution=at,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,bt),this.renderedExtent_=bt,this.renderedPixelRatio=it,this.postRender(this.context,O),te.extent&&Mt.restore(),Mt.imageSmoothingEnabled=!0,this.renderComplete){const Wt=(zt,Kt)=>{const qt=getUid(ot),Xt=Kt.wantedTiles[qt],an=Xt?Object.keys(Xt).length:0;this.updateCacheSize(an),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};O.postRenderFunctions.push(Wt)}return this.container}updateCacheSize(O){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,O*2)}drawTile(O,Y,te,ne,xe,et,tt,it){let st;if(O instanceof DataTile){if(st=asImageLike(O.getData()),!st)throw new Error("Rendering array data is not yet supported")}else st=this.getTileImage(O);if(!st)return;const ot=this.getRenderContext(Y),rt=getUid(this),nt=Y.layerStatesArray[Y.layerIndex],at=nt.opacity*(it?O.getAlpha(rt,Y.time):1),ct=at!==ot.globalAlpha;ct&&(ot.save(),ot.globalAlpha=at),ot.drawImage(st,tt,tt,st.width-2*tt,st.height-2*tt,te,ne,xe,et),ct&&ot.restore(),at!==nt.opacity?Y.animate=!0:it&&O.endTransition(rt)}getImage(){const O=this.context;return O?O.canvas:null}getTileImage(O){return O.getImage()}updateUsedTiles(O,Y,te){const ne=getUid(Y);ne in O||(O[ne]={}),O[ne][te.getKey()]=!0}}const TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class BaseTileLayer extends Layer{constructor(O){O=O||{};const Y=Object.assign({},O),te=O.cacheSize;delete O.cacheSize,delete Y.preload,delete Y.useInterimTilesOnError,super(Y),this.on,this.once,this.un,this.cacheSize_=te,this.setPreload(O.preload!==void 0?O.preload:0),this.setUseInterimTilesOnError(O.useInterimTilesOnError!==void 0?O.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(TileProperty.PRELOAD)}setPreload(O){this.set(TileProperty.PRELOAD,O)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(O){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,O)}getData(O){return super.getData(O)}}class TileLayer extends BaseTileLayer{constructor(O){super(O)}createRenderer(){return new CanvasTileLayerRenderer(this,{cacheSize:this.getCacheSize()})}}function createMinion(ee){return function(O){const Y=O.buffers,te=O.meta,ne=O.imageOps,xe=O.width,et=O.height,tt=Y.length,it=Y[0].byteLength;if(ne){const nt=new Array(tt);for(let ct=0;ct<tt;++ct)nt[ct]=new ImageData(new Uint8ClampedArray(Y[ct]),xe,et);return ee(nt,te).data.buffer}const st=new Uint8ClampedArray(it),ot=new Array(tt),rt=new Array(tt);for(let nt=0;nt<tt;++nt)ot[nt]=new Uint8ClampedArray(Y[nt]),rt[nt]=[0,0,0,0];for(let nt=0;nt<it;nt+=4){for(let ct=0;ct<tt;++ct){const ut=ot[ct];rt[ct][0]=ut[nt],rt[ct][1]=ut[nt+1],rt[ct][2]=ut[nt+2],rt[ct][3]=ut[nt+3]}const at=ee(rt,te);st[nt]=at[0],st[nt+1]=at[1],st[nt+2]=at[2],st[nt+3]=at[3]}return st.buffer}}function createWorker(ee,O){const te=Object.keys(ee.lib||{}).map(function(xe){return"const "+xe+" = "+ee.lib[xe].toString()+";"}).concat(["const __minion__ = ("+createMinion.toString()+")(",ee.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),ne=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(te.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(te,{type:"text/javascript"})));return ne.addEventListener("message",O),ne}function createFauxWorker(ee,O){const Y=createMinion(ee.operation);let te=!1;return{postMessage:function(ne){setTimeout(function(){te||O({data:{buffer:Y(ne),meta:ne.meta}})},0)},terminate:function(){te=!0}}}class Processor extends Disposable{constructor(O){super(),this.imageOps_=!!O.imageOps;let Y;O.threads===0?Y=0:this.imageOps_?Y=1:Y=O.threads||1;const te=new Array(Y);if(Y)for(let ne=0;ne<Y;++ne)te[ne]=createWorker(O,this.onWorkerMessage_.bind(this,ne));else te[0]=createFauxWorker(O,this.onWorkerMessage_.bind(this,0));this.workers_=te,this.queue_=[],this.maxQueueLength_=O.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(O,Y,te){this.enqueue_({inputs:O,meta:Y,callback:te}),this.dispatch_()}enqueue_(O){for(this.queue_.push(O);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const O=this.queue_.shift();this.job_=O;const Y=O.inputs[0].width,te=O.inputs[0].height,ne=O.inputs.map(function(it){return it.data.buffer}),xe=this.workers_.length;if(this.running_=xe,xe===1){this.workers_[0].postMessage({buffers:ne,meta:O.meta,imageOps:this.imageOps_,width:Y,height:te},ne);return}const et=O.inputs[0].data.length,tt=4*Math.ceil(et/4/xe);for(let it=0;it<xe;++it){const st=it*tt,ot=[];for(let rt=0,nt=ne.length;rt<nt;++rt)ot.push(ne[rt].slice(st,st+tt));this.workers_[it].postMessage({buffers:ot,meta:O.meta,imageOps:this.imageOps_,width:Y,height:te},ot)}}onWorkerMessage_(O,Y){this.disposed||(this.dataLookup_[O]=Y.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const O=this.job_,Y=this.workers_.length;let te,ne;if(Y===1)te=new Uint8ClampedArray(this.dataLookup_[0].buffer),ne=this.dataLookup_[0].meta;else{const xe=O.inputs[0].data.length;te=new Uint8ClampedArray(xe),ne=new Array(Y);const et=4*Math.ceil(xe/4/Y);for(let tt=0;tt<Y;++tt){const it=this.dataLookup_[tt].buffer,st=tt*et;te.set(new Uint8ClampedArray(it),st),ne[tt]=this.dataLookup_[tt].meta}}this.job_=null,this.dataLookup_={},O.callback(null,new ImageData(te,O.inputs[0].width,O.inputs[0].height),ne),this.dispatch_()}disposeInternal(){for(let O=0;O<this.workers_.length;++O)this.workers_[O].terminate();this.workers_.length=0}}const RasterEventType={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class RasterSourceEvent extends BaseEvent{constructor(O,Y,te){super(O),this.extent=Y.extent,this.resolution=Y.viewState.resolution/Y.pixelRatio,this.data=te}}class RasterSource extends ImageSource{constructor(O){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=O.operationType!==void 0?O.operationType:"pixel",this.threads_=O.threads!==void 0?O.threads:1,this.layers_=createLayers(O.sources);const Y=this.changed.bind(this);for(let te=0,ne=this.layers_.length;te<ne;++te)this.layers_[te].addEventListener(EventType.CHANGE,Y);this.useResolutions_=O.resolutions!==null,this.tileQueue_=new TileQueue(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:create$2(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:getLayerStatesArray(this.layers_),pixelRatio:1,pixelToCoordinateTransform:create$2(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:getUid(this),renderTargets:{}},this.setAttributions(function(te){const ne=[];for(let xe=0,et=O.sources.length;xe<et;++xe){const tt=O.sources[xe],it=tt instanceof Source?tt:tt.getSource();if(!it)continue;const st=it.getAttributions()?.(te);typeof st=="string"?ne.push(st):st!==void 0&&ne.push(...st)}return ne}),O.operation!==void 0&&this.setOperation(O.operation,O.lib)}setOperation(O,Y){this.processor_&&this.processor_.dispose(),this.processor_=new Processor({operation:O,imageOps:this.operationType_==="image",queue:1,lib:Y,threads:this.threads_}),this.changed()}updateFrameState_(O,Y,te){const ne=Object.assign({},this.frameState_);ne.viewState=Object.assign({},ne.viewState);const xe=getCenter(O);ne.size[0]=Math.ceil(getWidth(O)/Y),ne.size[1]=Math.ceil(getHeight(O)/Y),ne.extent=[xe[0]-ne.size[0]*Y/2,xe[1]-ne.size[1]*Y/2,xe[0]+ne.size[0]*Y/2,xe[1]+ne.size[1]*Y/2],ne.time=Date.now();const et=ne.viewState;return et.center=xe,et.projection=te,et.resolution=Y,ne}allSourcesReady_(){let O=!0,Y;for(let te=0,ne=this.layers_.length;te<ne;++te)if(Y=this.layers_[te].getSource(),!Y||Y.getState()!=="ready"){O=!1;break}return O}getImage(O,Y,te,ne){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),Y=this.findNearestResolution(Y);const xe=this.updateFrameState_(O,Y,ne);if(this.requestedFrameState_=xe,this.renderedImageCanvas_){const et=this.renderedImageCanvas_.getResolution(),tt=this.renderedImageCanvas_.getExtent();(Y!==et||!equals$1(xe.extent,tt))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),xe.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const O=this.requestedFrameState_,Y=this.layers_.length,te=new Array(Y);for(let xe=0;xe<Y;++xe){O.layerIndex=xe,O.renderTargets={};const et=getImageData(this.layers_[xe],O);if(et)te[xe]=et;else return}const ne={};this.dispatchEvent(new RasterSourceEvent(RasterEventType.BEFOREOPERATIONS,O,ne)),this.processor_.process(te,ne,this.onWorkerComplete_.bind(this,O))}onWorkerComplete_(O,Y,te,ne){if(Y||!te)return;const xe=O.extent,et=O.viewState.resolution;if(et!==this.requestedFrameState_.viewState.resolution||!equals$1(xe,this.requestedFrameState_.extent))return;let tt;if(this.renderedImageCanvas_)tt=this.renderedImageCanvas_.getImage().getContext("2d");else{const it=Math.round(getWidth(xe)/et),st=Math.round(getHeight(xe)/et);tt=createCanvasContext2D(it,st),this.renderedImageCanvas_=new ImageCanvas(xe,et,1,tt.canvas)}tt.putImageData(te,0,0),O.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new RasterSourceEvent(RasterEventType.AFTEROPERATIONS,O,ne))}getResolutions(O){if(!this.useResolutions_)return null;let Y=super.getResolutions();if(!Y)for(let te=0,ne=this.layers_.length;te<ne&&(Y=this.layers_[te].getSource().getResolutions(O),!Y);++te);return Y}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}RasterSource.prototype.dispose;let sharedContext=null;function getImageData(ee,O){const Y=ee.getRenderer();if(!Y)throw new Error("Unsupported layer type: "+ee);if(!Y.prepareFrame(O))return null;const te=O.size[0],ne=O.size[1];if(te===0||ne===0)return null;const xe=Y.renderFrame(O,null);let et;if(xe instanceof HTMLCanvasElement)et=xe;else{if(xe&&(et=xe.firstElementChild),!(et instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+et);if(et.width===te&&et.height===ne)return et.getContext("2d").getImageData(0,0,te,ne)}if(!sharedContext)sharedContext=createCanvasContext2D(te,ne,void 0,{willReadFrequently:!0});else{const tt=sharedContext.canvas;tt.width!==te||tt.height!==ne?sharedContext=createCanvasContext2D(te,ne,void 0,{willReadFrequently:!0}):sharedContext.clearRect(0,0,te,ne)}return sharedContext.drawImage(et,0,0,te,ne),sharedContext.getImageData(0,0,te,ne)}function getLayerStatesArray(ee){return ee.map(function(O){return O.getLayerState()})}function createLayers(ee){const O=ee.length,Y=new Array(O);for(let te=0;te<O;++te)Y[te]=createLayer(ee[te]);return Y}function createLayer(ee){let O;return ee instanceof Source?ee instanceof TileSource?O=new TileLayer({source:ee}):ee instanceof ImageSource&&(O=new ImageLayer({source:ee})):O=ee,O}const STADIA_ATTRIBUTION='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',OMT_ATTRIBUTION='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',STAMEN_ATTRIBUTION='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',LayerConfig={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_toner_dark:{extension:"png"},stamen_toner_blacklite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},ProviderConfig={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_dark:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_blacklite:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class StadiaMaps extends XYZ{constructor(O){const Y=O.layer.indexOf("-"),te=Y==-1?O.layer:O.layer.slice(0,Y),ne=ProviderConfig[te]||{minZoom:0,maxZoom:20,retina:!0},xe=LayerConfig[O.layer],et=O.apiKey?"?api_key="+O.apiKey:"",tt=ne.retina&&O.retina?"@2x":"",it=O.url!==void 0?O.url:"https://tiles.stadiamaps.com/tiles/"+O.layer+"/{z}/{x}/{y}"+tt+"."+xe.extension+et,st=[STADIA_ATTRIBUTION,OMT_ATTRIBUTION,ATTRIBUTION];O.layer.startsWith("stamen_")&&st.splice(1,0,STAMEN_ATTRIBUTION),super({attributions:st,cacheSize:O.cacheSize,crossOrigin:"anonymous",interpolate:O.interpolate,maxZoom:O.maxZoom!==void 0?O.maxZoom:ne.maxZoom,minZoom:O.minZoom!==void 0?O.minZoom:ne.minZoom,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileLoadFunction:O.tileLoadFunction,transition:O.transition,url:it,tilePixelRatio:tt?2:1,wrapX:O.wrapX,zDirection:O.zDirection})}}class TileArcGISRest extends TileImage{constructor(O){O=O||{},super({attributions:O.attributions,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:O.projection,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileGrid:O.tileGrid,tileLoadFunction:O.tileLoadFunction,url:O.url,urls:O.urls,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition,zDirection:O.zDirection}),this.params_=Object.assign({},O.params),this.hidpi_=O.hidpi!==void 0?O.hidpi:!0,this.tmpExtent_=createEmpty(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let O=0;const Y=[];for(const te in this.params_)Y[O++]=te+"-"+this.params_[te];return Y.join("/")}getParams(){return this.params_}getRequestUrl_(O,Y,te,ne,xe,et){const tt=this.urls;if(!tt)return;let it;if(tt.length==1)it=tt[0];else{const st=modulo(hash(O),tt.length);it=tt[st]}return getRequestUrl$1(it,te,(this.tileGrid||this.getTileGridForProjection(xe)).getResolution(O[0]),ne,xe,et)}getTilePixelRatio(O){return this.hidpi_?O:1}setParams(O){this.params_=Object.assign({},O),this.setKey(this.getKeyForParams_())}updateParams(O){Object.assign(this.params_,O),this.setKey(this.getKeyForParams_())}tileUrlFunction(O,Y,te){let ne=this.getTileGrid();if(ne||(ne=this.getTileGridForProjection(te)),ne.getResolutions().length<=O[0])return;Y!=1&&!this.hidpi_&&(Y=1);const xe=ne.getTileCoordExtent(O,this.tmpExtent_);let et=toSize(ne.getTileSize(O[0]),this.tmpSize);Y!=1&&(et=scale$1(et,Y,this.tmpSize));const tt={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(tt,this.params_),this.getRequestUrl_(O,et,xe,Y,te,tt)}}class TileDebug extends ImageTileSource{constructor(O){O=O||{};const Y=O.template||"z:{z} x:{x} y:{y}",te=O.source,ne=O.color||"grey";super({transition:0,wrapX:O.wrapX!==void 0?O.wrapX:te!==void 0?te.getWrapX():void 0});const xe=()=>{this.projection=O.projection!==void 0?get$2(O.projection):te!==void 0?te.getProjection():this.projection,this.tileGrid=O.tileGrid!==void 0?O.tileGrid:te!==void 0?te.getTileGrid():this.tileGrid,this.zDirection=O.zDirection!==void 0?O.zDirection:te!==void 0?te.zDirection:this.zDirection,te instanceof DataTileSource&&(this.transformMatrix=te.transformMatrix?.slice()||null);const et=this.tileGrid;et&&this.setTileSizes(et.getResolutions().map((tt,it)=>toSize(et.getTileSize(it)).map(st=>Math.max(Math.floor(st),1)))),this.setLoader((tt,it,st,ot)=>{const rt=renderXYZTemplate(Y,tt,it,st,ot.maxY),[nt,at]=this.getTileSize(tt),ct=createCanvasContext2D(nt,at);return ct.strokeStyle=ne,ct.strokeRect(.5,.5,nt+.5,at+.5),ct.fillStyle=ne,ct.strokeStyle="white",ct.textAlign="center",ct.textBaseline="middle",ct.font="24px sans-serif",ct.lineWidth=4,ct.strokeText(rt,nt/2,at/2,nt),ct.fillText(rt,nt/2,at/2,nt),Promise.resolve(ct.canvas)}),this.setState("ready")};if(te===void 0||te.getState()==="ready")xe();else{const et=()=>{te.getState()==="ready"&&(te.removeEventListener(EventType.CHANGE,et),xe())};te.addEventListener(EventType.CHANGE,et)}}}class TileJSON extends TileImage{constructor(O){if(super({attributions:O.attributions,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:get$2("EPSG:3857"),reprojectionErrorThreshold:O.reprojectionErrorThreshold,state:"loading",tileLoadFunction:O.tileLoadFunction,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition,zDirection:O.zDirection}),this.tileJSON_=null,this.tileSize_=O.tileSize,O.url)if(O.jsonp)jsonp(O.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const Y=new XMLHttpRequest;Y.addEventListener("load",this.onXHRLoad_.bind(this)),Y.addEventListener("error",this.onXHRError_.bind(this)),Y.open("GET",O.url),Y.send()}else if(O.tileJSON)this.handleTileJSONResponse(O.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(O){const Y=O.target;if(!Y.status||Y.status>=200&&Y.status<300){let te;try{te=JSON.parse(Y.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(te)}else this.handleTileJSONError()}onXHRError_(O){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(O){const Y=get$2("EPSG:4326"),te=this.getProjection();let ne;if(O.bounds!==void 0){const st=getTransformFromProjections(Y,te);ne=applyTransform(O.bounds,st)}const xe=extentFromProjection(te),et=O.minzoom||0,tt=O.maxzoom||22,it=createXYZ({extent:xe,maxZoom:tt,minZoom:et,tileSize:this.tileSize_});if(this.tileGrid=it,this.tileUrlFunction=createFromTemplates(O.tiles,it),O.attribution&&!this.getAttributions()){const st=ne!==void 0?ne:xe;this.setAttributions(function(ot){return intersects$1(st,ot.extent)?[O.attribution]:null})}this.tileJSON_=O,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class TileWMS extends TileImage{constructor(O){O=O||{};const Y=Object.assign({},O.params);super({attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:O.projection,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileClass:O.tileClass,tileGrid:O.tileGrid,tileLoadFunction:O.tileLoadFunction,url:O.url,urls:O.urls,wrapX:O.wrapX!==void 0?O.wrapX:!0,transition:O.transition,zDirection:O.zDirection}),this.gutter_=O.gutter!==void 0?O.gutter:0,this.params_=Y,this.v13_=!0,this.serverType_=O.serverType,this.hidpi_=O.hidpi!==void 0?O.hidpi:!0,this.tmpExtent_=createEmpty(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(O,Y,te,ne){const xe=get$2(te),et=this.getProjection()||xe;let tt=this.getTileGrid();tt||(tt=this.getTileGridForProjection(et));const it=transform(O,xe,et),st=calculateSourceResolution(et,xe,O,Y),ot=tt.getZForResolution(st,this.zDirection),rt=tt.getResolution(ot),nt=tt.getTileCoordForCoordAndZ(it,ot);if(tt.getResolutions().length<=nt[0])return;let at=tt.getTileCoordExtent(nt,this.tmpExtent_);const ct=this.gutter_;ct!==0&&(at=buffer$1(at,rt*ct,at));const ut={QUERY_LAYERS:this.params_.LAYERS};Object.assign(ut,getRequestParams(this.params_,"GetFeatureInfo"),ne);const dt=Math.floor((it[0]-at[0])/rt),ht=Math.floor((at[3]-it[1])/rt);return ut[this.v13_?"I":"X"]=dt,ut[this.v13_?"J":"Y"]=ht,this.getRequestUrl_(nt,at,1,et||xe,ut)}getLegendUrl(O,Y){if(this.urls[0]===void 0)return;const te={SERVICE:"WMS",VERSION:DEFAULT_VERSION$1,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(Y===void 0||Y.LAYER===void 0){const ne=this.params_.LAYERS;if(!(!Array.isArray(ne)||ne.length===1))return;te.LAYER=ne}if(O!==void 0){const ne=this.getProjection()?this.getProjection().getMetersPerUnit():1,xe=28e-5;te.SCALE=O*ne/xe}return Object.assign(te,Y),appendParams(this.urls[0],te)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(O,Y,te,ne,xe){const et=this.urls;if(!et)return;let tt;if(et.length==1)tt=et[0];else{const it=modulo(hash(O),et.length);tt=et[it]}return getImageSrc(Y,(this.tileGrid||this.getTileGridForProjection(ne)).getResolution(O[0]),te,ne,tt,xe,this.serverType_)}getTilePixelRatio(O){return!this.hidpi_||this.serverType_===void 0?1:O}getKeyForParams_(){let O=0;const Y=[];for(const te in this.params_)Y[O++]=te+"-"+this.params_[te];return Y.join("/")}setParams_(O){this.params_=O,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(O){this.setParams_(Object.assign({},O))}updateParams(O){this.setParams_(Object.assign(this.params_,O))}updateV13_(){const O=this.params_.VERSION||DEFAULT_VERSION$1;this.v13_=compareVersions(O,"1.3")>=0}tileUrlFunction(O,Y,te){let ne=this.getTileGrid();if(ne||(ne=this.getTileGridForProjection(te)),ne.getResolutions().length<=O[0])return;Y!=1&&(!this.hidpi_||this.serverType_===void 0)&&(Y=1);const xe=ne.getResolution(O[0]);let et=ne.getTileCoordExtent(O,this.tmpExtent_);const tt=this.gutter_;tt!==0&&(et=buffer$1(et,xe*tt,et));const it=Object.assign({},getRequestParams(this.params_,"GetMap"));return this.getRequestUrl_(O,et,Y,te,it)}}class CustomTile extends Tile{constructor(O,Y,te,ne,xe,et){super(O,Y),this.src_=te,this.extent_=ne,this.preemptive_=xe,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=et}getImage(){return null}getData(O){if(!this.grid_||!this.keys_)return null;const Y=(O[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),te=(O[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),ne=this.grid_[Math.floor((1-te)*this.grid_.length)];if(typeof ne!="string")return null;let xe=ne.charCodeAt(Math.floor(Y*ne.length));xe>=93&&xe--,xe>=35&&xe--,xe-=32;let et=null;if(xe in this.keys_){const tt=this.keys_[xe];this.data_&&tt in this.data_?et=this.data_[tt]:et=tt}return et}forDataAtCoordinate(O,Y,te){this.state==TileState.EMPTY&&te===!0?(this.state=TileState.IDLE,listenOnce(this,EventType.CHANGE,ne=>{Y(this.getData(O))}),this.loadInternal_()):te===!0?setTimeout(()=>{Y(this.getData(O))},0):Y(this.getData(O))}getKey(){return this.src_}handleError_(){this.state=TileState.ERROR,this.changed()}handleLoad_(O){this.grid_=O.grid,this.keys_=O.keys,this.data_=O.data,this.state=TileState.LOADED,this.changed()}loadInternal_(){if(this.state==TileState.IDLE)if(this.state=TileState.LOADING,this.jsonp_)jsonp(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const O=new XMLHttpRequest;O.addEventListener("load",this.onXHRLoad_.bind(this)),O.addEventListener("error",this.onXHRError_.bind(this)),O.open("GET",this.src_),O.send()}}onXHRLoad_(O){const Y=O.target;if(!Y.status||Y.status>=200&&Y.status<300){let te;try{te=JSON.parse(Y.responseText)}catch{this.handleError_();return}this.handleLoad_(te)}else this.handleError_()}onXHRError_(O){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(TileState.EMPTY)}}class UTFGrid extends TileSource{constructor(O){if(super({projection:get$2("EPSG:3857"),state:"loading",wrapX:O.wrapX!==void 0?O.wrapX:!0,zDirection:O.zDirection}),this.preemptive_=O.preemptive!==void 0?O.preemptive:!0,this.tileUrlFunction_=nullTileUrlFunction,this.template_=void 0,this.jsonp_=O.jsonp||!1,this.tileCache_=new LRUCache(512),O.url)if(this.jsonp_)jsonp(O.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const Y=new XMLHttpRequest;Y.addEventListener("load",this.onXHRLoad_.bind(this)),Y.addEventListener("error",this.onXHRError_.bind(this)),Y.open("GET",O.url),Y.send()}else if(O.tileJSON)this.handleTileJSONResponse(O.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(O){const Y=O.target;if(!Y.status||Y.status>=200&&Y.status<300){let te;try{te=JSON.parse(Y.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(te)}else this.handleTileJSONError()}onXHRError_(O){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(O,Y,te,ne){if(this.tileGrid){const xe=this.tileGrid.getZForResolution(Y,this.zDirection),et=this.tileGrid.getTileCoordForCoordAndZ(O,xe),tt=this.getTile(et[0],et[1],et[2],1,this.getProjection());tt.getState()==TileState.IDLE&&tt.load(),tt.forDataAtCoordinate(O,te,ne)}else ne===!0?setTimeout(function(){te(null)},0):te(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(O){const Y=get$2("EPSG:4326"),te=this.getProjection();let ne;if(O.bounds!==void 0){const ot=getTransformFromProjections(Y,te);ne=applyTransform(O.bounds,ot)}const xe=extentFromProjection(te),et=O.minzoom||0,tt=O.maxzoom||22,it=createXYZ({extent:xe,maxZoom:tt,minZoom:et});this.tileGrid=it,this.template_=O.template;const st=O.grids;if(!st){this.setState("error");return}if(this.tileUrlFunction_=createFromTemplates(st,it),O.attribution){const ot=ne!==void 0?ne:xe;this.setAttributions(function(rt){return intersects$1(ot,rt.extent)?[O.attribution]:null})}this.setState("ready")}getTile(O,Y,te,ne,xe){const et=[O,Y,te],tt=this.getTileCoordForTileUrlFunction(et,xe),it=this.tileUrlFunction_(tt,ne,xe),st=`${this.getKey()},${getKeyZXY(O,Y,te)}`;if(this.tileCache_.containsKey(st))return this.tileCache_.get(st);this.tileCache_.expireCache();const ot=new CustomTile(et,it!==void 0?TileState.IDLE:TileState.EMPTY,it!==void 0?it:"",this.tileGrid.getTileCoordExtent(et),this.preemptive_,this.jsonp_);return this.tileCache_.set(st,ot),ot}}class WMTS extends TileImage{constructor(O){const Y=O.requestEncoding!==void 0?O.requestEncoding:"KVP",te=O.tileGrid;let ne=O.urls;ne===void 0&&O.url!==void 0&&(ne=expandUrl(O.url)),super({attributions:O.attributions,attributionsCollapsible:O.attributionsCollapsible,cacheSize:O.cacheSize,crossOrigin:O.crossOrigin,interpolate:O.interpolate,projection:O.projection,reprojectionErrorThreshold:O.reprojectionErrorThreshold,tileClass:O.tileClass,tileGrid:te,tileLoadFunction:O.tileLoadFunction,tilePixelRatio:O.tilePixelRatio,urls:ne,wrapX:O.wrapX!==void 0?O.wrapX:!1,transition:O.transition,zDirection:O.zDirection}),this.version_=O.version!==void 0?O.version:"1.0.0",this.format_=O.format!==void 0?O.format:"image/jpeg",this.dimensions_=O.dimensions!==void 0?O.dimensions:{},this.layer_=O.layer,this.matrixSet_=O.matrixSet,this.style_=O.style,this.requestEncoding_=Y,this.setKey(this.getKeyForDimensions_()),ne&&ne.length>0&&(this.tileUrlFunction=createFromTileUrlFunctions(ne.map(this.createFromWMTSTemplate.bind(this))))}setUrls(O){this.urls=O;const Y=O.join(`
`);this.setTileUrlFunction(createFromTileUrlFunctions(O.map(this.createFromWMTSTemplate.bind(this))),Y)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const O=this.urls?this.urls.slice(0):[];for(const Y in this.dimensions_)O.push(Y+"-"+this.dimensions_[Y]);return O.join("/")}updateDimensions(O){Object.assign(this.dimensions_,O),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(O){const Y=this.requestEncoding_,te={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};Y=="KVP"&&Object.assign(te,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),O=Y=="KVP"?appendParams(O,te):O.replace(/\{(\w+?)\}/g,function(et,tt){return tt.toLowerCase()in te?te[tt.toLowerCase()]:et});const ne=this.tileGrid,xe=this.dimensions_;return(function(et,tt,it){if(!et)return;const st={TileMatrix:ne.getMatrixId(et[0]),TileCol:et[1],TileRow:et[2]};Object.assign(st,xe);let ot=O;return Y=="KVP"?ot=appendParams(ot,st):ot=ot.replace(/\{(\w+?)\}/g,function(rt,nt){return encodeURIComponent(st[nt])}),ot})}}function optionsFromCapabilities(ee,O){const te=ee.Contents.Layer?.find(function(Mt){return Mt.Identifier==O.layer});if(!te)return null;const ne=ee.Contents.TileMatrixSet;let xe;te.TileMatrixSetLink.length>1?"projection"in O?xe=te.TileMatrixSetLink.findIndex(function(Mt){const Rt=ne.find(function(Wt){return Wt.Identifier==Mt.TileMatrixSet}).SupportedCRS,Pt=get$2(Rt),kt=get$2(O.projection);return Pt&&kt?equivalent$1(Pt,kt):Rt==O.projection}):xe=te.TileMatrixSetLink.findIndex(function(Mt){return Mt.TileMatrixSet==O.matrixSet}):xe=0,xe<0&&(xe=0);const et=te.TileMatrixSetLink[xe].TileMatrixSet,tt=te.TileMatrixSetLink[xe].TileMatrixSetLimits;let it=te.Format[0];"format"in O&&(it=O.format),xe=te.Style.findIndex(function(Mt){return"style"in O?Mt.Title==O.style:Mt.isDefault}),xe<0&&(xe=0);const st=te.Style[xe].Identifier,ot={};"Dimension"in te&&te.Dimension.forEach(function(Mt,Nt,Rt){const Pt=Mt.Identifier;let kt=Mt.Default;kt===void 0&&(kt=Mt.Value[0]),ot[Pt]=kt});const nt=ee.Contents.TileMatrixSet.find(function(Mt){return Mt.Identifier==et});let at;const ct=nt.SupportedCRS;if(ct&&(at=get$2(ct)),"projection"in O){const Mt=get$2(O.projection);Mt&&(!at||equivalent$1(Mt,at))&&(at=Mt)}let ut=!1;const dt=at.getAxisOrientation().startsWith("ne");let ht=nt.TileMatrix[0],pt={MinTileCol:0,MinTileRow:0,MaxTileCol:ht.MatrixWidth-1,MaxTileRow:ht.MatrixHeight-1};if(tt){pt=tt[tt.length-1];const Mt=nt.TileMatrix.find(Nt=>Nt.Identifier===pt.TileMatrix||nt.Identifier+":"+Nt.Identifier===pt.TileMatrix);Mt&&(ht=Mt)}const ft=te.BoundingBox?.find(Mt=>get$2(Mt.crs)&&equivalent$1(get$2(Mt.crs),at)),mt=ht.ScaleDenominator*28e-5/at.getMetersPerUnit(),yt=dt?[ht.TopLeftCorner[1],ht.TopLeftCorner[0]]:ht.TopLeftCorner,bt=ht.TileWidth*mt,vt=ht.TileHeight*mt;let Et=ft?.extent??nt.BoundingBox;Et&&dt&&(Et=[Et[1],Et[0],Et[3],Et[2]]);let wt=[yt[0]+bt*pt.MinTileCol,yt[1]-vt*(1+pt.MaxTileRow),yt[0]+bt*(1+pt.MaxTileCol),yt[1]-vt*pt.MinTileRow];if(Et!==void 0&&!containsExtent(Et,wt)){const Mt=te.WGS84BoundingBox,Nt=get$2("EPSG:4326").getExtent();if(wt=Et,Mt)ut=Mt[0]===Nt[0]&&Mt[2]===Nt[2];else{const Rt=transformExtent(Et,nt.SupportedCRS,"EPSG:4326");ut=Rt[0]-1e-10<=Nt[0]&&Rt[2]+1e-10>=Nt[2]}}const St=createFromCapabilitiesMatrixSet(nt,wt,tt),Ot=[];let $t=O.requestEncoding;if($t=$t!==void 0?$t:"","OperationsMetadata"in ee&&"GetTile"in ee.OperationsMetadata){const Mt=ee.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let Nt=0,Rt=Mt.length;Nt<Rt;++Nt)if(Mt[Nt].Constraint){const kt=Mt[Nt].Constraint.find(function(Wt){return Wt.name=="GetEncoding"}).AllowedValues.Value;if($t===""&&($t=kt[0]),$t==="KVP")kt.includes("KVP")&&Ot.push(Mt[Nt].href);else break}else Mt[Nt].href&&($t="KVP",Ot.push(Mt[Nt].href))}return Ot.length===0&&($t="REST",te.ResourceURL.forEach(function(Mt){Mt.resourceType==="tile"&&(it=Mt.format,Ot.push(Mt.template))})),{urls:Ot,layer:O.layer,matrixSet:et,format:it,projection:at,requestEncoding:$t,tileGrid:St,style:st,dimensions:ot,wrapX:ut,crossOrigin:O.crossOrigin}}function sourcesFromTileGrid(ee,O){const Y=new LRUCache(32),te=ee.getExtent();return function(ne,xe){Y.expireCache(),te&&(ne=getIntersection(te,ne));const et=ee.getZForResolution(xe),tt=[];return ee.forEachTileCoord(ne,et,it=>{const st=it.toString();if(!Y.containsKey(st)){const ot=O(it);Y.set(st,ot)}tt.push(Y.get(st))}),tt}}const source$1=Object.freeze(Object.defineProperty({__proto__:null,BingMaps,CartoDB,Cluster,DataTile:DataTileSource,GeoTIFF:GeoTIFFSource,Google,IIIF,Image:ImageSource,ImageArcGISRest,ImageCanvas:ImageCanvasSource,ImageMapGuide,ImageStatic:Static,ImageTile:ImageTileSource,ImageWMS,OGCMapTile,OGCVectorTile,OSM,Raster:RasterSource,Source,StadiaMaps,Tile:TileSource,TileArcGISRest,TileDebug,TileImage,TileJSON,TileWMS,UTFGrid,UrlTile,Vector:VectorSource,VectorTile,WMTS,XYZ,Zoomify,createArcGISRestLoader:createLoader$3,createMapGuideLoader:createLoader$2,createStaticLoader:createLoader$1,createWMSLoader:createLoader,sourcesFromTileGrid},Symbol.toStringTag,{value:"Module"})),XML_SCHEMA_INSTANCE_URI="http://www.w3.org/2001/XMLSchema-instance";function createElementNS(ee,O){return getDocument().createElementNS(ee,O)}function getAllTextContent(ee,O){return getAllTextContent_(ee,O,[]).join("")}function getAllTextContent_(ee,O,Y){if(ee.nodeType==Node.CDATA_SECTION_NODE||ee.nodeType==Node.TEXT_NODE)Y.push(ee.nodeValue);else{let te;for(te=ee.firstChild;te;te=te.nextSibling)getAllTextContent_(te,O,Y)}return Y}function isDocument(ee){return"documentElement"in ee}function getAttributeNS(ee,O,Y){return ee.getAttributeNS(O,Y)||""}function parse(ee){return new DOMParser().parseFromString(ee,"application/xml")}function makeArrayExtender(ee,O){return(function(Y,te){const ne=ee.call(O??this,Y,te);if(ne!==void 0){const xe=te[te.length-1];extend$2(xe,ne)}})}function makeArrayPusher(ee,O){return(function(Y,te){const ne=ee.call(O??this,Y,te);ne!==void 0&&te[te.length-1].push(ne)})}function makeReplacer(ee,O){return(function(Y,te){const ne=ee.call(O??this,Y,te);ne!==void 0&&(te[te.length-1]=ne)})}function makeObjectPropertyPusher(ee,O,Y){return(function(te,ne){const xe=ee.call(this,te,ne);if(xe!==void 0){const et=ne[ne.length-1],tt=te.localName;let it;tt in et?it=et[tt]:(it=[],et[tt]=it),it.push(xe)}})}function makeObjectPropertySetter(ee,O,Y){return(function(te,ne){const xe=ee.call(this,te,ne);if(xe!==void 0){const et=ne[ne.length-1],tt=O!==void 0?O:te.localName;et[tt]=xe}})}function makeChildAppender(ee,O){return(function(Y,te,ne){ee.call(O??this,Y,te,ne),ne[ne.length-1].node.appendChild(Y)})}function makeArraySerializer(ee,O){let Y,te;return function(ne,xe,et){if(Y===void 0){Y={};const tt={};tt[ne.localName]=ee,Y[ne.namespaceURI]=tt,te=makeSimpleNodeFactory(ne.localName)}serialize(Y,te,xe,et)}}function makeSimpleNodeFactory(ee,O){return(function(Y,te,ne){const et=te[te.length-1].node;let tt=ee;tt===void 0&&(tt=ne);const it=O!==void 0?O:et.namespaceURI;return createElementNS(it,tt)})}const OBJECT_PROPERTY_NODE_FACTORY=makeSimpleNodeFactory();function makeSequence(ee,O){const Y=O.length,te=new Array(Y);for(let ne=0;ne<Y;++ne)te[ne]=ee[O[ne]];return te}function makeStructureNS(ee,O,Y){Y=Y!==void 0?Y:{};let te,ne;for(te=0,ne=ee.length;te<ne;++te)Y[ee[te]]=O;return Y}function parseNode(ee,O,Y,te){let ne;for(ne=O.firstElementChild;ne;ne=ne.nextElementSibling){const xe=ee[ne.namespaceURI];if(xe!==void 0){const et=xe[ne.localName];et!==void 0&&et.call(te,ne,Y)}}}function pushParseAndPop(ee,O,Y,te,ne){return te.push(ee),parseNode(O,Y,te,ne),te.pop()}function serialize(ee,O,Y,te,ne,xe){const et=(ne!==void 0?ne:Y).length;let tt,it;for(let st=0;st<et;++st)tt=Y[st],tt!==void 0&&(it=O.call(xe,tt,te,ne!==void 0?ne[st]:void 0),it!==void 0&&ee[it.namespaceURI][it.localName].call(xe,it,tt,te))}function pushSerializeAndPop(ee,O,Y,te,ne,xe,et){return ne.push(ee),serialize(O,Y,te,ne,xe,et),ne.pop()}let xmlSerializer_;function getXMLSerializer(){return xmlSerializer_===void 0&&typeof XMLSerializer<"u"&&(xmlSerializer_=new XMLSerializer),xmlSerializer_}let document_;function getDocument(){return document_===void 0&&typeof document<"u"&&(document_=document.implementation.createDocument("","",null)),document_}class XML{read(O){if(!O)return null;if(typeof O=="string"){const Y=parse(O);return this.readFromDocument(Y)}return isDocument(O)?this.readFromDocument(O):this.readFromNode(O)}readFromDocument(O){for(let Y=O.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType==Node.ELEMENT_NODE)return this.readFromNode(Y);return null}readFromNode(O){abstract()}}const NAMESPACE_URI="http://www.w3.org/1999/xlink";function readHref(ee){return ee.getAttributeNS(NAMESPACE_URI,"href")}function readBoolean(ee){const O=getAllTextContent(ee,!1);return readBooleanString(O)}function readBooleanString(ee){const O=/^\s*(true|1)|(false|0)\s*$/.exec(ee);if(O)return O[1]!==void 0||!1}function readDateTime(ee){const O=getAllTextContent(ee,!1),Y=Date.parse(O);return isNaN(Y)?void 0:Y/1e3}function readDecimal(ee){const O=getAllTextContent(ee,!1);return readDecimalString(O)}function readDecimalString(ee){const O=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(ee);if(O)return parseFloat(O[1])}function readPositiveInteger(ee){const O=getAllTextContent(ee,!1);return readNonNegativeIntegerString(O)}function readNonNegativeIntegerString(ee){const O=/^\s*(\d+)\s*$/.exec(ee);if(O)return parseInt(O[1],10)}function readString(ee){return getAllTextContent(ee,!1).trim()}function writeBooleanTextNode(ee,O){writeStringTextNode(ee,O?"1":"0")}function writeCDATASection(ee,O){ee.appendChild(getDocument().createCDATASection(O))}function writeDateTimeTextNode(ee,O){const Y=new Date(O*1e3),te=Y.getUTCFullYear()+"-"+padNumber(Y.getUTCMonth()+1,2)+"-"+padNumber(Y.getUTCDate(),2)+"T"+padNumber(Y.getUTCHours(),2)+":"+padNumber(Y.getUTCMinutes(),2)+":"+padNumber(Y.getUTCSeconds(),2)+"Z";ee.appendChild(getDocument().createTextNode(te))}function writeDecimalTextNode(ee,O){const Y=O.toPrecision();ee.appendChild(getDocument().createTextNode(Y))}function writeNonNegativeIntegerTextNode(ee,O){const Y=O.toString();ee.appendChild(getDocument().createTextNode(Y))}const whiteSpaceStart=/^\s/,whiteSpaceEnd=/\s$/,cdataCharacters=/(\n|\t|\r|<|&| {2})/;function writeStringTextNode(ee,O){typeof O=="string"&&(whiteSpaceStart.test(O)||whiteSpaceEnd.test(O)||cdataCharacters.test(O))?O.split("]]>").forEach((Y,te,ne)=>{te<ne.length-1&&(Y+="]]"),te>0&&(Y=">"+Y),writeCDATASection(ee,Y)}):ee.appendChild(getDocument().createTextNode(O))}const NAMESPACE_URIS$4=[null,"http://www.opengis.net/ows/1.1"],PARSERS$2=makeStructureNS(NAMESPACE_URIS$4,{ServiceIdentification:makeObjectPropertySetter(readServiceIdentification),ServiceProvider:makeObjectPropertySetter(readServiceProvider),OperationsMetadata:makeObjectPropertySetter(readOperationsMetadata)});class OWS extends XML{constructor(){super()}readFromNode(O){const Y=pushParseAndPop({},PARSERS$2,O,[]);return Y||null}}const ADDRESS_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{DeliveryPoint:makeObjectPropertySetter(readString),City:makeObjectPropertySetter(readString),AdministrativeArea:makeObjectPropertySetter(readString),PostalCode:makeObjectPropertySetter(readString),Country:makeObjectPropertySetter(readString),ElectronicMailAddress:makeObjectPropertySetter(readString)}),ALLOWED_VALUES_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Value:makeObjectPropertyPusher(readValue)}),CONSTRAINT_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{AllowedValues:makeObjectPropertySetter(readAllowedValues)}),CONTACT_INFO_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Phone:makeObjectPropertySetter(readPhone),Address:makeObjectPropertySetter(readAddress)}),DCP_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{HTTP:makeObjectPropertySetter(readHttp)}),HTTP_PARSERS$1=makeStructureNS(NAMESPACE_URIS$4,{Get:makeObjectPropertyPusher(readGet),Post:void 0}),OPERATION_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{DCP:makeObjectPropertySetter(readDcp)}),OPERATIONS_METADATA_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Operation:readOperation}),PHONE_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Voice:makeObjectPropertySetter(readString),Facsimile:makeObjectPropertySetter(readString)}),REQUEST_METHOD_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Constraint:makeObjectPropertyPusher(readConstraint)}),SERVICE_CONTACT_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{IndividualName:makeObjectPropertySetter(readString),PositionName:makeObjectPropertySetter(readString),ContactInfo:makeObjectPropertySetter(readContactInfo)}),SERVICE_IDENTIFICATION_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{Abstract:makeObjectPropertySetter(readString),AccessConstraints:makeObjectPropertySetter(readString),Fees:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),ServiceTypeVersion:makeObjectPropertySetter(readString),ServiceType:makeObjectPropertySetter(readString)}),SERVICE_PROVIDER_PARSERS=makeStructureNS(NAMESPACE_URIS$4,{ProviderName:makeObjectPropertySetter(readString),ProviderSite:makeObjectPropertySetter(readHref),ServiceContact:makeObjectPropertySetter(readServiceContact)});function readAddress(ee,O){return pushParseAndPop({},ADDRESS_PARSERS,ee,O)}function readAllowedValues(ee,O){return pushParseAndPop({},ALLOWED_VALUES_PARSERS,ee,O)}function readConstraint(ee,O){const Y=ee.getAttribute("name");if(Y)return pushParseAndPop({name:Y},CONSTRAINT_PARSERS,ee,O)}function readContactInfo(ee,O){return pushParseAndPop({},CONTACT_INFO_PARSERS,ee,O)}function readDcp(ee,O){return pushParseAndPop({},DCP_PARSERS,ee,O)}function readGet(ee,O){const Y=readHref(ee);if(Y)return pushParseAndPop({href:Y},REQUEST_METHOD_PARSERS,ee,O)}function readHttp(ee,O){return pushParseAndPop({},HTTP_PARSERS$1,ee,O)}function readOperation(ee,O){const Y=ee.getAttribute("name"),te=pushParseAndPop({},OPERATION_PARSERS,ee,O);if(!te)return;const ne=O[O.length-1];ne[Y]=te}function readOperationsMetadata(ee,O){return pushParseAndPop({},OPERATIONS_METADATA_PARSERS,ee,O)}function readPhone(ee,O){return pushParseAndPop({},PHONE_PARSERS,ee,O)}function readServiceIdentification(ee,O){return pushParseAndPop({},SERVICE_IDENTIFICATION_PARSERS,ee,O)}function readServiceContact(ee,O){return pushParseAndPop({},SERVICE_CONTACT_PARSERS,ee,O)}function readServiceProvider(ee,O){return pushParseAndPop({},SERVICE_PROVIDER_PARSERS,ee,O)}function readValue(ee,O){return readString(ee)}const NAMESPACE_URIS$3=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS$1=makeStructureNS(NAMESPACE_URIS$3,{Contents:makeObjectPropertySetter(readContents)});class WMTSCapabilities extends XML{constructor(){super(),this.owsParser_=new OWS}readFromNode(O){let Y=O.getAttribute("version");Y&&(Y=Y.trim());let te=this.owsParser_.readFromNode(O);return te?(te.version=Y,te=pushParseAndPop(te,PARSERS$1,O,[]),te||null):null}}const CONTENTS_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{Layer:makeObjectPropertyPusher(readLayer$1),TileMatrixSet:makeObjectPropertyPusher(readTileMatrixSet)}),LAYER_PARSERS$1=makeStructureNS(NAMESPACE_URIS$3,{Style:makeObjectPropertyPusher(readStyle$2),Format:makeObjectPropertyPusher(readString),TileMatrixSetLink:makeObjectPropertyPusher(readTileMatrixSetLink),Dimension:makeObjectPropertyPusher(readDimensions),ResourceURL:makeObjectPropertyPusher(readResourceUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),WGS84BoundingBox:makeObjectPropertySetter(readBoundingBox$1),BoundingBox:makeObjectPropertyPusher(readBoundingBoxWithCrs),Identifier:makeObjectPropertySetter(readString)})),STYLE_PARSERS$2=makeStructureNS(NAMESPACE_URIS$3,{LegendURL:makeObjectPropertyPusher(readLegendUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TMS_LINKS_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{TileMatrixSet:makeObjectPropertySetter(readString),TileMatrixSetLimits:makeObjectPropertySetter(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{TileMatrixLimits:makeArrayPusher(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{TileMatrix:makeObjectPropertySetter(readString),MinTileRow:makeObjectPropertySetter(readPositiveInteger),MaxTileRow:makeObjectPropertySetter(readPositiveInteger),MinTileCol:makeObjectPropertySetter(readPositiveInteger),MaxTileCol:makeObjectPropertySetter(readPositiveInteger)}),DIMENSION_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{Default:makeObjectPropertySetter(readString),Value:makeObjectPropertyPusher(readString)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)})),WGS84_BBOX_READERS=makeStructureNS(OWS_NAMESPACE_URIS,{LowerCorner:makeArrayPusher(readCoordinates),UpperCorner:makeArrayPusher(readCoordinates)}),TMS_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{WellKnownScaleSet:makeObjectPropertySetter(readString),TileMatrix:makeObjectPropertyPusher(readTileMatrix)},makeStructureNS(OWS_NAMESPACE_URIS,{SupportedCRS:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString),BoundingBox:makeObjectPropertySetter(readBoundingBox$1)})),TM_PARSERS=makeStructureNS(NAMESPACE_URIS$3,{TopLeftCorner:makeObjectPropertySetter(readCoordinates),ScaleDenominator:makeObjectPropertySetter(readDecimal),TileWidth:makeObjectPropertySetter(readPositiveInteger),TileHeight:makeObjectPropertySetter(readPositiveInteger),MatrixWidth:makeObjectPropertySetter(readPositiveInteger),MatrixHeight:makeObjectPropertySetter(readPositiveInteger)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)}));function readContents(ee,O){return pushParseAndPop({},CONTENTS_PARSERS,ee,O)}function readLayer$1(ee,O){return pushParseAndPop({},LAYER_PARSERS$1,ee,O)}function readTileMatrixSet(ee,O){return pushParseAndPop({},TMS_PARSERS,ee,O)}function readStyle$2(ee,O){const Y=pushParseAndPop({},STYLE_PARSERS$2,ee,O);if(!Y)return;const te=ee.getAttribute("isDefault")==="true";return Y.isDefault=te,Y}function readTileMatrixSetLink(ee,O){return pushParseAndPop({},TMS_LINKS_PARSERS,ee,O)}function readDimensions(ee,O){return pushParseAndPop({},DIMENSION_PARSERS,ee,O)}function readResourceUrl(ee,O){const Y=ee.getAttribute("format"),te=ee.getAttribute("template"),ne=ee.getAttribute("resourceType"),xe={};return Y&&(xe.format=Y),te&&(xe.template=te),ne&&(xe.resourceType=ne),xe}function readBoundingBox$1(ee,O){const Y=pushParseAndPop([],WGS84_BBOX_READERS,ee,O);if(Y.length==2)return boundingExtent(Y)}function readBoundingBoxWithCrs(ee,O){const Y=ee.getAttribute("crs"),te=pushParseAndPop([],WGS84_BBOX_READERS,ee,O);if(te.length==2)return{extent:boundingExtent(te),crs:Y}}function readLegendUrl(ee,O){const Y={};return Y.format=ee.getAttribute("format"),Y.href=readHref(ee),Y}function readCoordinates(ee,O){const Y=readString(ee).split(/\s+/);if(!Y||Y.length!=2)return;const te=+Y[0],ne=+Y[1];if(!(isNaN(te)||isNaN(ne)))return[te,ne]}function readTileMatrix(ee,O){return pushParseAndPop({},TM_PARSERS,ee,O)}function readTileMatrixLimitsList(ee,O){return pushParseAndPop([],TMS_LIMITS_LIST_PARSERS,ee,O)}function readTileMatrixLimits(ee,O){return pushParseAndPop({},TMS_LIMITS_PARSERS,ee,O)}class FeatureFormat{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Feature,this.supportedMediaTypes=null}getReadOptions(O,Y){if(Y){let te=Y.dataProjection?get$2(Y.dataProjection):this.readProjection(O);Y.extent&&te&&te.getUnits()==="tile-pixels"&&(te=get$2(te),te.setWorldExtent(Y.extent)),Y={dataProjection:te,featureProjection:Y.featureProjection}}return this.adaptOptions(Y)}adaptOptions(O){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},O)}getType(){return abstract()}readFeature(O,Y){return abstract()}readFeatures(O,Y){return abstract()}readGeometry(O,Y){return abstract()}readProjection(O){return abstract()}writeFeature(O,Y){return abstract()}writeFeatures(O,Y){return abstract()}writeGeometry(O,Y){return abstract()}}function transformGeometryWithOptions(ee,O,Y){const te=Y?get$2(Y.featureProjection):null,ne=Y?get$2(Y.dataProjection):null;let xe=ee;if(te&&ne&&!equivalent$1(te,ne)){O&&(xe=ee.clone());const et=O?te:ne,tt=O?ne:te;et.getUnits()==="tile-pixels"?xe.transform(et,tt):xe.applyTransform(getTransform(et,tt))}if(O&&Y&&Y.decimals!==void 0){const et=Math.pow(10,Y.decimals),tt=function(it){for(let st=0,ot=it.length;st<ot;++st)it[st]=Math.round(it[st]*et)/et;return it};xe===ee&&(xe=ee.clone()),xe.applyTransform(tt)}return xe}function transformExtentWithOptions(ee,O){const Y=O?get$2(O.featureProjection):null,te=O?get$2(O.dataProjection):null;return Y&&te&&!equivalent$1(Y,te)?transformExtent(ee,te,Y):ee}const GeometryConstructor$1={Point,LineString,Polygon,MultiPoint,MultiLineString,MultiPolygon};function orientFlatCoordinates(ee,O,Y){return Array.isArray(O[0])?(linearRingssAreOriented(ee,0,O,Y)||(ee=ee.slice(),orientLinearRingsArray(ee,0,O,Y)),ee):(linearRingsAreOriented(ee,0,O,Y)||(ee=ee.slice(),orientLinearRings(ee,0,O,Y)),ee)}function createRenderFeature(ee,O){const Y=ee.geometry;if(!Y)return[];if(Array.isArray(Y))return Y.map(xe=>createRenderFeature({...ee,geometry:xe})).flat();const te=Y.type==="MultiPolygon"?"Polygon":Y.type;if(te==="GeometryCollection"||te==="Circle")throw new Error("Unsupported geometry type: "+te);const ne=Y.layout.length;return transformGeometryWithOptions(new RenderFeature(te,te==="Polygon"?orientFlatCoordinates(Y.flatCoordinates,Y.ends,ne):Y.flatCoordinates,Y.ends?.flat(),ne,ee.properties||{},ee.id).enableSimplifyTransformed(),!1,O)}function createGeometry(ee,O){if(!ee)return null;if(Array.isArray(ee)){const te=ee.map(ne=>createGeometry(ne,O));return new GeometryCollection(te)}const Y=GeometryConstructor$1[ee.type];return transformGeometryWithOptions(new Y(ee.flatCoordinates,ee.layout||"XY",ee.ends),!1,O)}class JSONFeature extends FeatureFormat{constructor(){super()}getType(){return"json"}readFeature(O,Y){return this.readFeatureFromObject(getObject(O),this.getReadOptions(O,Y))}readFeatures(O,Y){return this.readFeaturesFromObject(getObject(O),this.getReadOptions(O,Y))}readFeatureFromObject(O,Y){return abstract()}readFeaturesFromObject(O,Y){return abstract()}readGeometry(O,Y){return this.readGeometryFromObject(getObject(O),this.getReadOptions(O,Y))}readGeometryFromObject(O,Y){return abstract()}readProjection(O){return this.readProjectionFromObject(getObject(O))}readProjectionFromObject(O){return abstract()}writeFeature(O,Y){return JSON.stringify(this.writeFeatureObject(O,Y))}writeFeatureObject(O,Y){return abstract()}writeFeatures(O,Y){return JSON.stringify(this.writeFeaturesObject(O,Y))}writeFeaturesObject(O,Y){return abstract()}writeGeometry(O,Y){return JSON.stringify(this.writeGeometryObject(O,Y))}writeGeometryObject(O,Y){return abstract()}}function getObject(ee){if(typeof ee=="string"){const O=JSON.parse(ee);return O||null}return ee!==null?ee:null}const GEOMETRY_READERS$1={Point:readPointGeometry$2,LineString:readLineStringGeometry$2,Polygon:readPolygonGeometry$2,MultiPoint:readMultiPointGeometry$2,MultiLineString:readMultiLineStringGeometry$2,MultiPolygon:readMultiPolygonGeometry$2},GEOMETRY_WRITERS={Point:writePointGeometry$1,LineString:writeLineStringGeometry$1,Polygon:writePolygonGeometry$1,MultiPoint:writeMultiPointGeometry$1,MultiLineString:writeMultiLineStringGeometry$1,MultiPolygon:writeMultiPolygonGeometry$1};class EsriJSON extends JSONFeature{constructor(O){O=O||{},super(),this.geometryName_=O.geometryName}readFeatureFromObject(O,Y,te){const ne=O,xe=readGeometry$1(ne.geometry,Y),et=new Feature;if(this.geometryName_&&et.setGeometryName(this.geometryName_),et.setGeometry(xe),ne.attributes){et.setProperties(ne.attributes,!0);const tt=ne.attributes[te];tt!==void 0&&et.setId(tt)}return et}readFeaturesFromObject(O,Y){if(Y=Y||{},O.features){const te=O,ne=[],xe=te.features;for(let et=0,tt=xe.length;et<tt;++et)ne.push(this.readFeatureFromObject(xe[et],Y,O.objectIdFieldName));return ne}return[this.readFeatureFromObject(O,Y)]}readGeometryFromObject(O,Y){return readGeometry$1(O,Y)}readProjectionFromObject(O){if(O.spatialReference&&O.spatialReference.wkid!==void 0){const te=O.spatialReference.wkid;return get$2("EPSG:"+te)}return null}writeGeometryObject(O,Y){return writeGeometry$1(O,this.adaptOptions(Y))}writeFeatureObject(O,Y){Y=this.adaptOptions(Y);const te={};if(!O.hasProperties())return te.attributes={},te;const ne=O.getProperties(),xe=O.getGeometry();if(xe){te.geometry=writeGeometry$1(xe,Y);const et=Y&&(Y.dataProjection||Y.featureProjection);et&&(te.geometry.spatialReference={wkid:Number(get$2(et).getCode().split(":").pop())}),delete ne[O.getGeometryName()]}return isEmpty$1(ne)?te.attributes={}:te.attributes=ne,te}writeFeaturesObject(O,Y){Y=this.adaptOptions(Y);const te=[];for(let ne=0,xe=O.length;ne<xe;++ne)te.push(this.writeFeatureObject(O[ne],Y));return{features:te}}}function readGeometry$1(ee,O){if(!ee)return null;let Y;if(typeof ee.x=="number"&&typeof ee.y=="number")Y="Point";else if(ee.points)Y="MultiPoint";else if(ee.paths)ee.paths.length===1?Y="LineString":Y="MultiLineString";else if(ee.rings){const ne=ee,xe=getGeometryLayout(ne),et=convertRings(ne.rings,xe);et.length===1?(Y="Polygon",ee=Object.assign({},ee,{rings:et[0]})):(Y="MultiPolygon",ee=Object.assign({},ee,{rings:et}))}const te=GEOMETRY_READERS$1[Y];return transformGeometryWithOptions(te(ee),!1,O)}function convertRings(ee,O){const Y=[],te=[],ne=[];let xe,et;for(xe=0,et=ee.length;xe<et;++xe)Y.length=0,deflateCoordinates(Y,0,ee[xe],O.length),linearRingIsClockwise(Y,0,Y.length,O.length)?te.push([ee[xe]]):ne.push(ee[xe]);for(;ne.length;){const tt=ne.shift();let it=!1;for(xe=te.length-1;xe>=0;xe--){const st=te[xe][0];if(containsExtent(new LinearRing(st).getExtent(),new LinearRing(tt).getExtent())){te[xe].push(tt),it=!0;break}}it||te.push([tt.reverse()])}return te}function readPointGeometry$2(ee){let O;return ee.m!==void 0&&ee.z!==void 0?O=new Point([ee.x,ee.y,ee.z,ee.m],"XYZM"):ee.z!==void 0?O=new Point([ee.x,ee.y,ee.z],"XYZ"):ee.m!==void 0?O=new Point([ee.x,ee.y,ee.m],"XYM"):O=new Point([ee.x,ee.y]),O}function readLineStringGeometry$2(ee){const O=getGeometryLayout(ee);return new LineString(ee.paths[0],O)}function readMultiLineStringGeometry$2(ee){const O=getGeometryLayout(ee);return new MultiLineString(ee.paths,O)}function getGeometryLayout(ee){let O="XY";return ee.hasZ===!0&&ee.hasM===!0?O="XYZM":ee.hasZ===!0?O="XYZ":ee.hasM===!0&&(O="XYM"),O}function readMultiPointGeometry$2(ee){const O=getGeometryLayout(ee);return new MultiPoint(ee.points,O)}function readMultiPolygonGeometry$2(ee){const O=getGeometryLayout(ee);return new MultiPolygon(ee.rings,O)}function readPolygonGeometry$2(ee){const O=getGeometryLayout(ee);return new Polygon(ee.rings,O)}function writePointGeometry$1(ee,O){const Y=ee.getCoordinates();let te;const ne=ee.getLayout();if(ne==="XYZ")te={x:Y[0],y:Y[1],z:Y[2]};else if(ne==="XYM")te={x:Y[0],y:Y[1],m:Y[2]};else if(ne==="XYZM")te={x:Y[0],y:Y[1],z:Y[2],m:Y[3]};else if(ne==="XY")te={x:Y[0],y:Y[1]};else throw new Error("Invalid geometry layout");return te}function getHasZM(ee){const O=ee.getLayout();return{hasZ:O==="XYZ"||O==="XYZM",hasM:O==="XYM"||O==="XYZM"}}function writeLineStringGeometry$1(ee,O){const Y=getHasZM(ee);return{hasZ:Y.hasZ,hasM:Y.hasM,paths:[ee.getCoordinates()]}}function writePolygonGeometry$1(ee,O){const Y=getHasZM(ee);return{hasZ:Y.hasZ,hasM:Y.hasM,rings:ee.getCoordinates(!1)}}function writeMultiLineStringGeometry$1(ee,O){const Y=getHasZM(ee);return{hasZ:Y.hasZ,hasM:Y.hasM,paths:ee.getCoordinates()}}function writeMultiPointGeometry$1(ee,O){const Y=getHasZM(ee);return{hasZ:Y.hasZ,hasM:Y.hasM,points:ee.getCoordinates()}}function writeMultiPolygonGeometry$1(ee,O){const Y=getHasZM(ee),te=ee.getCoordinates(!1),ne=[];for(let xe=0;xe<te.length;xe++)for(let et=te[xe].length-1;et>=0;et--)ne.push(te[xe][et]);return{hasZ:Y.hasZ,hasM:Y.hasM,rings:ne}}function writeGeometry$1(ee,O){const Y=GEOMETRY_WRITERS[ee.getType()];return Y(transformGeometryWithOptions(ee,!0,O),O)}class GeoJSON extends JSONFeature{constructor(O){O=O||{},super(),this.dataProjection=get$2(O.dataProjection?O.dataProjection:"EPSG:4326"),O.featureProjection&&(this.defaultFeatureProjection=get$2(O.featureProjection)),O.featureClass&&(this.featureClass=O.featureClass),this.geometryName_=O.geometryName,this.extractGeometryName_=O.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(O,Y){let te=null;O.type==="Feature"?te=O:te={type:"Feature",geometry:O,properties:null};const ne=readGeometryInternal(te.geometry);if(this.featureClass===RenderFeature)return createRenderFeature({geometry:ne,id:te.id,properties:te.properties},Y);const xe=new Feature;return this.geometryName_?xe.setGeometryName(this.geometryName_):this.extractGeometryName_&&te.geometry_name&&xe.setGeometryName(te.geometry_name),xe.setGeometry(createGeometry(ne,Y)),"id"in te&&xe.setId(te.id),te.properties&&xe.setProperties(te.properties,!0),xe}readFeaturesFromObject(O,Y){const te=O;let ne=null;if(te.type==="FeatureCollection"){const xe=O;ne=[];const et=xe.features;for(let tt=0,it=et.length;tt<it;++tt){const st=this.readFeatureFromObject(et[tt],Y);st&&ne.push(st)}}else ne=[this.readFeatureFromObject(O,Y)];return ne.flat()}readGeometryFromObject(O,Y){return readGeometry(O,Y)}readProjectionFromObject(O){const Y=O.crs;let te;if(Y)if(Y.type=="name")te=get$2(Y.properties.name);else if(Y.type==="EPSG")te=get$2("EPSG:"+Y.properties.code);else throw new Error("Unknown SRS type");else te=this.dataProjection;return te}writeFeatureObject(O,Y){Y=this.adaptOptions(Y);const te={type:"Feature",geometry:null,properties:null},ne=O.getId();if(ne!==void 0&&(te.id=ne),!O.hasProperties())return te;const xe=O.getProperties(),et=O.getGeometry();return et&&(te.geometry=writeGeometry(et,Y),delete xe[O.getGeometryName()]),isEmpty$1(xe)||(te.properties=xe),te}writeFeaturesObject(O,Y){Y=this.adaptOptions(Y);const te=[];for(let ne=0,xe=O.length;ne<xe;++ne)te.push(this.writeFeatureObject(O[ne],Y));return{type:"FeatureCollection",features:te}}writeGeometryObject(O,Y){return writeGeometry(O,this.adaptOptions(Y))}}function readGeometryInternal(ee,O){if(!ee)return null;let Y;switch(ee.type){case"Point":{Y=readPointGeometry$1(ee);break}case"LineString":{Y=readLineStringGeometry$1(ee);break}case"Polygon":{Y=readPolygonGeometry$1(ee);break}case"MultiPoint":{Y=readMultiPointGeometry$1(ee);break}case"MultiLineString":{Y=readMultiLineStringGeometry$1(ee);break}case"MultiPolygon":{Y=readMultiPolygonGeometry$1(ee);break}case"GeometryCollection":{Y=readGeometryCollectionGeometry(ee);break}default:throw new Error("Unsupported GeoJSON type: "+ee.type)}return Y}function readGeometry(ee,O){const Y=readGeometryInternal(ee);return createGeometry(Y,O)}function readGeometryCollectionGeometry(ee,O){return ee.geometries.map(function(te){return readGeometryInternal(te)})}function readPointGeometry$1(ee){const O=ee.coordinates;return{type:"Point",flatCoordinates:O,layout:getLayoutForStride(O.length)}}function readLineStringGeometry$1(ee){const O=ee.coordinates,Y=O.flat();return{type:"LineString",flatCoordinates:Y,ends:[Y.length],layout:getLayoutForStride(O[0]?.length||2)}}function readMultiLineStringGeometry$1(ee){const O=ee.coordinates,Y=O[0]?.[0]?.length||2,te=[],ne=deflateCoordinatesArray(te,0,O,Y);return{type:"MultiLineString",flatCoordinates:te,ends:ne,layout:getLayoutForStride(Y)}}function readMultiPointGeometry$1(ee){const O=ee.coordinates;return{type:"MultiPoint",flatCoordinates:O.flat(),layout:getLayoutForStride(O[0]?.length||2)}}function readMultiPolygonGeometry$1(ee){const O=ee.coordinates,Y=[],te=O[0]?.[0]?.[0].length||2,ne=deflateMultiCoordinatesArray(Y,0,O,te);return{type:"MultiPolygon",flatCoordinates:Y,ends:ne,layout:getLayoutForStride(te)}}function readPolygonGeometry$1(ee){const O=ee.coordinates,Y=[],te=O[0]?.[0]?.length,ne=deflateCoordinatesArray(Y,0,O,te);return{type:"Polygon",flatCoordinates:Y,ends:ne,layout:getLayoutForStride(te)}}function writeGeometry(ee,O){ee=transformGeometryWithOptions(ee,!0,O);const Y=ee.getType();let te;switch(Y){case"Point":{te=writePointGeometry(ee);break}case"LineString":{te=writeLineStringGeometry(ee);break}case"Polygon":{te=writePolygonGeometry(ee,O);break}case"MultiPoint":{te=writeMultiPointGeometry(ee);break}case"MultiLineString":{te=writeMultiLineStringGeometry(ee);break}case"MultiPolygon":{te=writeMultiPolygonGeometry(ee,O);break}case"GeometryCollection":{te=writeGeometryCollectionGeometry(ee,O);break}case"Circle":{te={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+Y)}return te}function writeGeometryCollectionGeometry(ee,O){return O=Object.assign({},O),delete O.featureProjection,{type:"GeometryCollection",geometries:ee.getGeometriesArray().map(function(te){return writeGeometry(te,O)})}}function writeLineStringGeometry(ee,O){return{type:"LineString",coordinates:ee.getCoordinates()}}function writeMultiLineStringGeometry(ee,O){return{type:"MultiLineString",coordinates:ee.getCoordinates()}}function writeMultiPointGeometry(ee,O){return{type:"MultiPoint",coordinates:ee.getCoordinates()}}function writeMultiPolygonGeometry(ee,O){let Y;return O&&(Y=O.rightHanded),{type:"MultiPolygon",coordinates:ee.getCoordinates(Y)}}function writePointGeometry(ee,O){return{type:"Point",coordinates:ee.getCoordinates()}}function writePolygonGeometry(ee,O){let Y;return O&&(Y=O.rightHanded),{type:"Polygon",coordinates:ee.getCoordinates(Y)}}class XMLFeature extends FeatureFormat{constructor(){super(),this.xmlSerializer_=getXMLSerializer()}getType(){return"xml"}readFeature(O,Y){if(!O)return null;if(typeof O=="string"){const te=parse(O);return this.readFeatureFromDocument(te,Y)}return isDocument(O)?this.readFeatureFromDocument(O,Y):this.readFeatureFromNode(O,Y)}readFeatureFromDocument(O,Y){const te=this.readFeaturesFromDocument(O,Y);return te.length>0?te[0]:null}readFeatureFromNode(O,Y){return null}readFeatures(O,Y){if(!O)return[];if(typeof O=="string"){const te=parse(O);return this.readFeaturesFromDocument(te,Y)}return isDocument(O)?this.readFeaturesFromDocument(O,Y):this.readFeaturesFromNode(O,Y)}readFeaturesFromDocument(O,Y){const te=[];for(let ne=O.firstChild;ne;ne=ne.nextSibling)ne.nodeType==Node.ELEMENT_NODE&&extend$2(te,this.readFeaturesFromNode(ne,Y));return te}readFeaturesFromNode(O,Y){return abstract()}readGeometry(O,Y){if(!O)return null;if(typeof O=="string"){const te=parse(O);return this.readGeometryFromDocument(te,Y)}return isDocument(O)?this.readGeometryFromDocument(O,Y):this.readGeometryFromNode(O,Y)}readGeometryFromDocument(O,Y){return null}readGeometryFromNode(O,Y){return null}readProjection(O){if(!O)return null;if(typeof O=="string"){const Y=parse(O);return this.readProjectionFromDocument(Y)}return isDocument(O)?this.readProjectionFromDocument(O):this.readProjectionFromNode(O)}readProjectionFromDocument(O){return this.dataProjection}readProjectionFromNode(O){return this.dataProjection}writeFeature(O,Y){const te=this.writeFeatureNode(O,Y);return this.xmlSerializer_.serializeToString(te)}writeFeatureNode(O,Y){return null}writeFeatures(O,Y){const te=this.writeFeaturesNode(O,Y);return this.xmlSerializer_.serializeToString(te)}writeFeaturesNode(O,Y){return null}writeGeometry(O,Y){const te=this.writeGeometryNode(O,Y);return this.xmlSerializer_.serializeToString(te)}writeGeometryNode(O,Y){return null}}const GMLNS="http://www.opengis.net/gml",ONLY_WHITESPACE_RE=/^\s*$/;class GMLBase extends XMLFeature{constructor(O){super(),O=O||{},this.featureType=O.featureType,this.featureNS=O.featureNS,this.srsName=O.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:makeArrayPusher(this.readFeaturesInternal),featureMembers:makeReplacer(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(O,Y){const te=O.localName;let ne=null;if(te=="FeatureCollection")ne=pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,O,Y,this);else if(te=="featureMembers"||te=="featureMember"||te=="member"){const xe=Y[0];let et=xe.featureType,tt=xe.featureNS;const it="p",st="p0";if(!et&&O.childNodes){et=[],tt={};for(let nt=0,at=O.childNodes.length;nt<at;++nt){const ct=O.childNodes[nt];if(ct.nodeType===1){const ut=ct.nodeName.split(":").pop();if(!et.includes(ut)){let dt="",ht=0;const pt=ct.namespaceURI;for(const ft in tt){if(tt[ft]===pt){dt=ft;break}++ht}dt||(dt=it+ht,tt[dt]=pt),et.push(dt+":"+ut)}}}te!="featureMember"&&(xe.featureType=et,xe.featureNS=tt)}if(typeof tt=="string"){const nt=tt;tt={},tt[st]=nt}const ot={},rt=Array.isArray(et)?et:[et];for(const nt in tt){const at={};for(let ct=0,ut=rt.length;ct<ut;++ct)(rt[ct].includes(":")?rt[ct].split(":")[0]:st)===nt&&(at[rt[ct].split(":").pop()]=te=="featureMembers"?makeArrayPusher(this.readFeatureElement,this):makeReplacer(this.readFeatureElement,this));ot[tt[nt]]=at}te=="featureMember"||te=="member"?ne=pushParseAndPop(void 0,ot,O,Y):ne=pushParseAndPop([],ot,O,Y)}return ne===null&&(ne=[]),ne}readGeometryOrExtent(O,Y){const te=Y[0];return te.srsName=O.firstElementChild.getAttribute("srsName"),te.srsDimension=O.firstElementChild.getAttribute("srsDimension"),pushParseAndPop(null,this.GEOMETRY_PARSERS,O,Y,this)}readExtentElement(O,Y){const te=Y[0],ne=this.readGeometryOrExtent(O,Y);return ne?transformExtentWithOptions(ne,te):void 0}readGeometryElement(O,Y){const te=Y[0],ne=this.readGeometryOrExtent(O,Y);return ne?transformGeometryWithOptions(ne,!1,te):void 0}readFeatureElementInternal(O,Y,te){let ne;const xe={};for(let it=O.firstElementChild;it;it=it.nextElementSibling){let st;const ot=it.localName;it.childNodes.length===0||it.childNodes.length===1&&(it.firstChild.nodeType===3||it.firstChild.nodeType===4)?(st=getAllTextContent(it,!1),ONLY_WHITESPACE_RE.test(st)&&(st=void 0)):(te&&(st=ot==="boundedBy"?this.readExtentElement(it,Y):this.readGeometryElement(it,Y)),st?ot!=="boundedBy"&&(ne=ot):st=this.readFeatureElementInternal(it,Y,!1));const rt=it.attributes.length;if(rt>0&&!(st instanceof Geometry)){st={_content_:st};for(let nt=0;nt<rt;nt++){const at=it.attributes[nt].name;st[at]=it.attributes[nt].value}}xe[ot]?(xe[ot]instanceof Array||(xe[ot]=[xe[ot]]),xe[ot].push(st)):xe[ot]=st}if(!te)return xe;const et=new Feature(xe);ne&&et.setGeometryName(ne);const tt=O.getAttribute("fid")||getAttributeNS(O,this.namespace,"id");return tt&&et.setId(tt),et}readFeatureElement(O,Y){return this.readFeatureElementInternal(O,Y,!0)}readPoint(O,Y){const te=this.readFlatCoordinatesFromNode(O,Y);if(te)return new Point(te,"XYZ")}readMultiPoint(O,Y){const te=pushParseAndPop([],this.MULTIPOINT_PARSERS,O,Y,this);if(te)return new MultiPoint(te)}readMultiLineString(O,Y){const te=pushParseAndPop([],this.MULTILINESTRING_PARSERS,O,Y,this);if(te)return new MultiLineString(te)}readMultiPolygon(O,Y){const te=pushParseAndPop([],this.MULTIPOLYGON_PARSERS,O,Y,this);if(te)return new MultiPolygon(te)}pointMemberParser(O,Y){parseNode(this.POINTMEMBER_PARSERS,O,Y,this)}lineStringMemberParser(O,Y){parseNode(this.LINESTRINGMEMBER_PARSERS,O,Y,this)}polygonMemberParser(O,Y){parseNode(this.POLYGONMEMBER_PARSERS,O,Y,this)}readLineString(O,Y){const te=this.readFlatCoordinatesFromNode(O,Y);if(te)return new LineString(te,"XYZ")}readFlatLinearRing(O,Y){const te=pushParseAndPop(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,O,Y,this);if(te)return te}readLinearRing(O,Y){const te=this.readFlatCoordinatesFromNode(O,Y);if(te)return new LinearRing(te,"XYZ")}readPolygon(O,Y){const te=pushParseAndPop([null],this.FLAT_LINEAR_RINGS_PARSERS,O,Y,this);if(te&&te[0]){const ne=te[0],xe=[ne.length];let et,tt;for(et=1,tt=te.length;et<tt;++et)extend$2(ne,te[et]),xe.push(ne.length);return new Polygon(ne,"XYZ",xe)}}readFlatCoordinatesFromNode(O,Y){return pushParseAndPop(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,O,Y,this)}readGeometryFromNode(O,Y){const te=this.readGeometryElement(O,[this.getReadOptions(O,Y||{})]);return te||null}readFeaturesFromNode(O,Y){const te={featureType:this.featureType,featureNS:this.featureNS};return te&&Object.assign(te,this.getReadOptions(O,Y)),this.readFeaturesInternal(O,[te])||[]}readProjectionFromNode(O){return get$2(this.srsName?this.srsName:O.firstElementChild.getAttribute("srsName"))}}GMLBase.prototype.namespace=GMLNS;GMLBase.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};GMLBase.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};GMLBase.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};GMLBase.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:makeArrayPusher(GMLBase.prototype.pointMemberParser),pointMembers:makeArrayPusher(GMLBase.prototype.pointMemberParser)}};GMLBase.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:makeArrayPusher(GMLBase.prototype.lineStringMemberParser),lineStringMembers:makeArrayPusher(GMLBase.prototype.lineStringMemberParser)}};GMLBase.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:makeArrayPusher(GMLBase.prototype.polygonMemberParser),polygonMembers:makeArrayPusher(GMLBase.prototype.polygonMemberParser)}};GMLBase.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:makeArrayPusher(GMLBase.prototype.readFlatCoordinatesFromNode)}};GMLBase.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:makeArrayPusher(GMLBase.prototype.readLineString)}};GMLBase.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:makeArrayPusher(GMLBase.prototype.readPolygon)}};GMLBase.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:makeReplacer(GMLBase.prototype.readFlatLinearRing)}};const schemaLocation$1=GMLNS+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",MULTIGEOMETRY_TO_MEMBER_NODENAME$1={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class GML2 extends GMLBase{constructor(O){O=O||{},super(O),this.FEATURE_COLLECTION_PARSERS[GMLNS].featureMember=makeArrayPusher(this.readFeaturesInternal),this.schemaLocation=O.schemaLocation?O.schemaLocation:schemaLocation$1}readFlatCoordinates(O,Y){const te=getAllTextContent(O,!1).replace(/^\s*|\s*$/g,""),xe=Y[0].srsName;let et="enu";if(xe){const st=get$2(xe);st&&(et=st.getAxisOrientation())}const tt=te.trim().split(/\s+/),it=[];for(let st=0,ot=tt.length;st<ot;st++){const rt=tt[st].split(/,+/),nt=parseFloat(rt[0]),at=parseFloat(rt[1]),ct=rt.length===3?parseFloat(rt[2]):0;et.startsWith("en")?it.push(nt,at,ct):it.push(at,nt,ct)}return it}readBox(O,Y){const te=pushParseAndPop([null],this.BOX_PARSERS_,O,Y,this);return createOrUpdate$2(te[1][0],te[1][1],te[1][3],te[1][4])}innerBoundaryIsParser(O,Y){const te=pushParseAndPop(void 0,this.RING_PARSERS,O,Y,this);te&&Y[Y.length-1].push(te)}outerBoundaryIsParser(O,Y){const te=pushParseAndPop(void 0,this.RING_PARSERS,O,Y,this);if(te){const ne=Y[Y.length-1];ne[0]=te}}GEOMETRY_NODE_FACTORY_(O,Y,te){const ne=Y[Y.length-1],xe=ne.multiSurface,et=ne.surface,tt=ne.multiCurve;return Array.isArray(O)?te="Envelope":(te=O.getType(),te==="MultiPolygon"&&xe===!0?te="MultiSurface":te==="Polygon"&&et===!0?te="Surface":te==="MultiLineString"&&tt===!0&&(te="MultiCurve")),createElementNS("http://www.opengis.net/gml",te)}writeFeatureElement(O,Y,te){const ne=Y.getId();ne&&O.setAttribute("fid",ne);const xe=te[te.length-1],et=xe.featureNS,tt=Y.getGeometryName();xe.serializers||(xe.serializers={},xe.serializers[et]={});const it=[],st=[];if(Y.hasProperties()){const rt=Y.getProperties();for(const nt in rt){const at=rt[nt];at!=null&&(it.push(nt),st.push(at),nt==tt||typeof at.getSimplifiedGeometry=="function"?nt in xe.serializers[et]||(xe.serializers[et][nt]=makeChildAppender(this.writeGeometryElement,this)):nt in xe.serializers[et]||(xe.serializers[et][nt]=makeChildAppender(writeStringTextNode)))}}const ot=Object.assign({},xe);ot.node=O,pushSerializeAndPop(ot,xe.serializers,makeSimpleNodeFactory(void 0,et),st,te,it)}writeCurveOrLineString(O,Y,te){const xe=te[te.length-1].srsName;if(O.nodeName!=="LineStringSegment"&&xe&&O.setAttribute("srsName",xe),O.nodeName==="LineString"||O.nodeName==="LineStringSegment"){const et=this.createCoordinatesNode_(O.namespaceURI);O.appendChild(et),this.writeCoordinates_(et,Y,te)}else if(O.nodeName==="Curve"){const et=createElementNS(O.namespaceURI,"segments");O.appendChild(et),this.writeCurveSegments_(et,Y,te)}}writeLineStringOrCurveMember(O,Y,te){const ne=this.GEOMETRY_NODE_FACTORY_(Y,te);ne&&(O.appendChild(ne),this.writeCurveOrLineString(ne,Y,te))}writeMultiCurveOrLineString(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName,tt=ne.curve;et&&O.setAttribute("srsName",et);const it=Y.getLineStrings();pushSerializeAndPop({node:O,hasZ:xe,srsName:et,curve:tt},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,it,te,void 0,this)}writeGeometryElement(O,Y,te){const ne=te[te.length-1],xe=Object.assign({},ne);xe.node=O;let et;Array.isArray(Y)?et=transformExtentWithOptions(Y,ne):et=transformGeometryWithOptions(Y,!0,ne),pushSerializeAndPop(xe,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[et],te,void 0,this)}createCoordinatesNode_(O){const Y=createElementNS(O,"coordinates");return Y.setAttribute("decimal","."),Y.setAttribute("cs",","),Y.setAttribute("ts"," "),Y}writeCoordinates_(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName,tt=Y.getCoordinates(),it=tt.length,st=new Array(it);for(let ot=0;ot<it;++ot){const rt=tt[ot];st[ot]=this.getCoords_(rt,et,xe)}writeStringTextNode(O,st.join(" "))}writeCurveSegments_(O,Y,te){const ne=createElementNS(O.namespaceURI,"LineStringSegment");O.appendChild(ne),this.writeCurveOrLineString(ne,Y,te)}writeSurfaceOrPolygon(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName;if(O.nodeName!=="PolygonPatch"&&et&&O.setAttribute("srsName",et),O.nodeName==="Polygon"||O.nodeName==="PolygonPatch"){const tt=Y.getLinearRings();pushSerializeAndPop({node:O,hasZ:xe,srsName:et},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,tt,te,void 0,this)}else if(O.nodeName==="Surface"){const tt=createElementNS(O.namespaceURI,"patches");O.appendChild(tt),this.writeSurfacePatches_(tt,Y,te)}}RING_NODE_FACTORY_(O,Y,te){const ne=Y[Y.length-1],xe=ne.node,et=ne.exteriorWritten;return et===void 0&&(ne.exteriorWritten=!0),createElementNS(xe.namespaceURI,et!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(O,Y,te){const ne=createElementNS(O.namespaceURI,"PolygonPatch");O.appendChild(ne),this.writeSurfaceOrPolygon(ne,Y,te)}writeRing(O,Y,te){const ne=createElementNS(O.namespaceURI,"LinearRing");O.appendChild(ne),this.writeLinearRing(ne,Y,te)}getCoords_(O,Y,te){let xe=(Y?get$2(Y).getAxisOrientation():"enu").startsWith("en")?O[0]+","+O[1]:O[1]+","+O[0];if(te){const et=O[2]||0;xe+=","+et}return xe}writePoint(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName;et&&O.setAttribute("srsName",et);const tt=this.createCoordinatesNode_(O.namespaceURI);O.appendChild(tt);const it=Y.getCoordinates(),st=this.getCoords_(it,et,xe);writeStringTextNode(tt,st)}writeMultiPoint(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName;et&&O.setAttribute("srsName",et);const tt=Y.getPoints();pushSerializeAndPop({node:O,hasZ:xe,srsName:et},this.POINTMEMBER_SERIALIZERS,makeSimpleNodeFactory("pointMember"),tt,te,void 0,this)}writePointMember(O,Y,te){const ne=createElementNS(O.namespaceURI,"Point");O.appendChild(ne),this.writePoint(ne,Y,te)}writeLinearRing(O,Y,te){const xe=te[te.length-1].srsName;xe&&O.setAttribute("srsName",xe);const et=this.createCoordinatesNode_(O.namespaceURI);O.appendChild(et),this.writeCoordinates_(et,Y,te)}writeMultiSurfaceOrPolygon(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName,tt=ne.surface;et&&O.setAttribute("srsName",et);const it=Y.getPolygons();pushSerializeAndPop({node:O,hasZ:xe,srsName:et,surface:tt},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,it,te,void 0,this)}writeSurfaceOrPolygonMember(O,Y,te){const ne=this.GEOMETRY_NODE_FACTORY_(Y,te);ne&&(O.appendChild(ne),this.writeSurfaceOrPolygon(ne,Y,te))}writeEnvelope(O,Y,te){const xe=te[te.length-1].srsName;xe&&O.setAttribute("srsName",xe);const et=["lowerCorner","upperCorner"],tt=[Y[0]+" "+Y[1],Y[2]+" "+Y[3]];pushSerializeAndPop({node:O},this.ENVELOPE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,tt,te,et,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(O,Y,te){const ne=Y[Y.length-1].node;return createElementNS("http://www.opengis.net/gml",MULTIGEOMETRY_TO_MEMBER_NODENAME$1[ne.nodeName])}}GML2.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:makeReplacer(GML2.prototype.readFlatCoordinates)}};GML2.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:GML2.prototype.innerBoundaryIsParser,outerBoundaryIs:GML2.prototype.outerBoundaryIsParser}};GML2.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:makeArrayPusher(GML2.prototype.readFlatCoordinates)}};GML2.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:makeReplacer(GMLBase.prototype.readPoint),MultiPoint:makeReplacer(GMLBase.prototype.readMultiPoint),LineString:makeReplacer(GMLBase.prototype.readLineString),MultiLineString:makeReplacer(GMLBase.prototype.readMultiLineString),LinearRing:makeReplacer(GMLBase.prototype.readLinearRing),Polygon:makeReplacer(GMLBase.prototype.readPolygon),MultiPolygon:makeReplacer(GMLBase.prototype.readMultiPolygon),Box:makeReplacer(GML2.prototype.readBox)}};GML2.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:makeChildAppender(GML2.prototype.writeCurveOrLineString),MultiCurve:makeChildAppender(GML2.prototype.writeMultiCurveOrLineString),Point:makeChildAppender(GML2.prototype.writePoint),MultiPoint:makeChildAppender(GML2.prototype.writeMultiPoint),LineString:makeChildAppender(GML2.prototype.writeCurveOrLineString),MultiLineString:makeChildAppender(GML2.prototype.writeMultiCurveOrLineString),LinearRing:makeChildAppender(GML2.prototype.writeLinearRing),Polygon:makeChildAppender(GML2.prototype.writeSurfaceOrPolygon),MultiPolygon:makeChildAppender(GML2.prototype.writeMultiSurfaceOrPolygon),Surface:makeChildAppender(GML2.prototype.writeSurfaceOrPolygon),MultiSurface:makeChildAppender(GML2.prototype.writeMultiSurfaceOrPolygon),Envelope:makeChildAppender(GML2.prototype.writeEnvelope)}};GML2.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:makeChildAppender(GML2.prototype.writeLineStringOrCurveMember),curveMember:makeChildAppender(GML2.prototype.writeLineStringOrCurveMember)}};GML2.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:makeChildAppender(GML2.prototype.writeRing),innerBoundaryIs:makeChildAppender(GML2.prototype.writeRing)}};GML2.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:makeChildAppender(GML2.prototype.writePointMember)}};GML2.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:makeChildAppender(GML2.prototype.writeSurfaceOrPolygonMember),polygonMember:makeChildAppender(GML2.prototype.writeSurfaceOrPolygonMember)}};GML2.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:makeChildAppender(writeStringTextNode),upperCorner:makeChildAppender(writeStringTextNode)}};const schemaLocation=GMLNS+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",MULTIGEOMETRY_TO_MEMBER_NODENAME={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class GML3 extends GMLBase{constructor(O){O=O||{},super(O),this.surface_=O.surface!==void 0?O.surface:!1,this.curve_=O.curve!==void 0?O.curve:!1,this.multiCurve_=O.multiCurve!==void 0?O.multiCurve:!0,this.multiSurface_=O.multiSurface!==void 0?O.multiSurface:!0,this.schemaLocation=O.schemaLocation?O.schemaLocation:schemaLocation,this.hasZ=O.hasZ!==void 0?O.hasZ:!1}readMultiCurve(O,Y){const te=pushParseAndPop([],this.MULTICURVE_PARSERS,O,Y,this);if(te)return new MultiLineString(te)}readFlatCurveRing(O,Y){const te=pushParseAndPop([],this.MULTICURVE_PARSERS,O,Y,this),ne=[];for(let xe=0,et=te.length;xe<et;++xe)extend$2(ne,te[xe].getFlatCoordinates());return ne}readMultiSurface(O,Y){const te=pushParseAndPop([],this.MULTISURFACE_PARSERS,O,Y,this);if(te)return new MultiPolygon(te)}curveMemberParser(O,Y){parseNode(this.CURVEMEMBER_PARSERS,O,Y,this)}surfaceMemberParser(O,Y){parseNode(this.SURFACEMEMBER_PARSERS,O,Y,this)}readPatch(O,Y){return pushParseAndPop([null],this.PATCHES_PARSERS,O,Y,this)}readSegment(O,Y){return pushParseAndPop([],this.SEGMENTS_PARSERS,O,Y,this)}readPolygonPatch(O,Y){return pushParseAndPop([null],this.FLAT_LINEAR_RINGS_PARSERS,O,Y,this)}readLineStringSegment(O,Y){return pushParseAndPop([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,O,Y,this)}interiorParser(O,Y){const te=pushParseAndPop(void 0,this.RING_PARSERS,O,Y,this);te&&Y[Y.length-1].push(te)}exteriorParser(O,Y){const te=pushParseAndPop(void 0,this.RING_PARSERS,O,Y,this);if(te){const ne=Y[Y.length-1];ne[0]=te}}readSurface(O,Y){const te=pushParseAndPop([null],this.SURFACE_PARSERS,O,Y,this);if(te&&te[0]){const ne=te[0],xe=[ne.length];let et,tt;for(et=1,tt=te.length;et<tt;++et)extend$2(ne,te[et]),xe.push(ne.length);return new Polygon(ne,"XYZ",xe)}}readCurve(O,Y){const te=pushParseAndPop([null],this.CURVE_PARSERS,O,Y,this);if(te)return new LineString(te,"XYZ")}readEnvelope(O,Y){const te=pushParseAndPop([null],this.ENVELOPE_PARSERS,O,Y,this);return createOrUpdate$2(te[1][0],te[1][1],te[2][0],te[2][1])}readFlatPos(O,Y){let te=getAllTextContent(O,!1);const ne=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,xe=[];let et;for(;et=ne.exec(te);)xe.push(parseFloat(et[1])),te=te.substr(et[0].length);if(te!=="")return;const it=Y[0].srsName;if((it?get$2(it).getAxisOrientation():"enu")==="neu")for(let rt=0,nt=xe.length;rt<nt;rt+=3){const at=xe[rt],ct=xe[rt+1];xe[rt]=ct,xe[rt+1]=at}const ot=xe.length;if(ot==2&&xe.push(0),ot!==0)return xe}readFlatPosList(O,Y){const te=getAllTextContent(O,!1).replace(/^\s*|\s*$/g,""),ne=Y[0],xe=ne.srsName,et=ne.srsDimension,tt=xe?get$2(xe).getAxisOrientation():"enu",it=te.split(/\s+/);let st=2;O.getAttribute("srsDimension")?st=readNonNegativeIntegerString(O.getAttribute("srsDimension")):O.getAttribute("dimension")?st=readNonNegativeIntegerString(O.getAttribute("dimension")):O.parentNode.getAttribute("srsDimension")?st=readNonNegativeIntegerString(O.parentNode.getAttribute("srsDimension")):et&&(st=readNonNegativeIntegerString(et));const ot=tt.startsWith("en");let rt,nt,at;const ct=[];for(let ut=0,dt=it.length;ut<dt;ut+=st)rt=parseFloat(it[ut]),nt=parseFloat(it[ut+1]),at=st===3?parseFloat(it[ut+2]):0,ot?ct.push(rt,nt,at):ct.push(nt,rt,at);return ct}writePos_(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=xe?"3":"2";O.setAttribute("srsDimension",et);const tt=ne.srsName,it=tt?get$2(tt).getAxisOrientation():"enu",st=Y.getCoordinates();let ot=it.startsWith("en")?st[0]+" "+st[1]:st[1]+" "+st[0];if(xe){const rt=st[2]||0;ot+=" "+rt}writeStringTextNode(O,ot)}getCoords_(O,Y,te){let xe=(Y?get$2(Y).getAxisOrientation():"enu").startsWith("en")?O[0]+" "+O[1]:O[1]+" "+O[0];if(te){const et=O[2]||0;xe+=" "+et}return xe}writePosList_(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=xe?"3":"2";O.setAttribute("srsDimension",et);const tt=ne.srsName,it=Y.getCoordinates(),st=it.length,ot=new Array(st);let rt;for(let nt=0;nt<st;++nt)rt=it[nt],ot[nt]=this.getCoords_(rt,tt,xe);writeStringTextNode(O,ot.join(" "))}writePoint(O,Y,te){const xe=te[te.length-1].srsName;xe&&O.setAttribute("srsName",xe);const et=createElementNS(O.namespaceURI,"pos");O.appendChild(et),this.writePos_(et,Y,te)}writeEnvelope(O,Y,te){const xe=te[te.length-1].srsName;xe&&O.setAttribute("srsName",xe);const et=["lowerCorner","upperCorner"],tt=[Y[0]+" "+Y[1],Y[2]+" "+Y[3]];pushSerializeAndPop({node:O},this.ENVELOPE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,tt,te,et,this)}writeLinearRing(O,Y,te){const xe=te[te.length-1].srsName;xe&&O.setAttribute("srsName",xe);const et=createElementNS(O.namespaceURI,"posList");O.appendChild(et),this.writePosList_(et,Y,te)}RING_NODE_FACTORY_(O,Y,te){const ne=Y[Y.length-1],xe=ne.node,et=ne.exteriorWritten;return et===void 0&&(ne.exteriorWritten=!0),createElementNS(xe.namespaceURI,et!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName;if(O.nodeName!=="PolygonPatch"&&et&&O.setAttribute("srsName",et),O.nodeName==="Polygon"||O.nodeName==="PolygonPatch"){const tt=Y.getLinearRings();pushSerializeAndPop({node:O,hasZ:xe,srsName:et},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,tt,te,void 0,this)}else if(O.nodeName==="Surface"){const tt=createElementNS(O.namespaceURI,"patches");O.appendChild(tt),this.writeSurfacePatches_(tt,Y,te)}}writeCurveOrLineString(O,Y,te){const xe=te[te.length-1].srsName;if(O.nodeName!=="LineStringSegment"&&xe&&O.setAttribute("srsName",xe),O.nodeName==="LineString"||O.nodeName==="LineStringSegment"){const et=createElementNS(O.namespaceURI,"posList");O.appendChild(et),this.writePosList_(et,Y,te)}else if(O.nodeName==="Curve"){const et=createElementNS(O.namespaceURI,"segments");O.appendChild(et),this.writeCurveSegments_(et,Y,te)}}writeMultiSurfaceOrPolygon(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName,tt=ne.surface;et&&O.setAttribute("srsName",et);const it=Y.getPolygons();pushSerializeAndPop({node:O,hasZ:xe,srsName:et,surface:tt},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,it,te,void 0,this)}writeMultiPoint(O,Y,te){const ne=te[te.length-1],xe=ne.srsName,et=ne.hasZ;xe&&O.setAttribute("srsName",xe);const tt=Y.getPoints();pushSerializeAndPop({node:O,hasZ:et,srsName:xe},this.POINTMEMBER_SERIALIZERS,makeSimpleNodeFactory("pointMember"),tt,te,void 0,this)}writeMultiCurveOrLineString(O,Y,te){const ne=te[te.length-1],xe=ne.hasZ,et=ne.srsName,tt=ne.curve;et&&O.setAttribute("srsName",et);const it=Y.getLineStrings();pushSerializeAndPop({node:O,hasZ:xe,srsName:et,curve:tt},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,it,te,void 0,this)}writeRing(O,Y,te){const ne=createElementNS(O.namespaceURI,"LinearRing");O.appendChild(ne),this.writeLinearRing(ne,Y,te)}writeSurfaceOrPolygonMember(O,Y,te){const ne=this.GEOMETRY_NODE_FACTORY_(Y,te);ne&&(O.appendChild(ne),this.writeSurfaceOrPolygon(ne,Y,te))}writePointMember(O,Y,te){const ne=createElementNS(O.namespaceURI,"Point");O.appendChild(ne),this.writePoint(ne,Y,te)}writeLineStringOrCurveMember(O,Y,te){const ne=this.GEOMETRY_NODE_FACTORY_(Y,te);ne&&(O.appendChild(ne),this.writeCurveOrLineString(ne,Y,te))}writeSurfacePatches_(O,Y,te){const ne=createElementNS(O.namespaceURI,"PolygonPatch");O.appendChild(ne),this.writeSurfaceOrPolygon(ne,Y,te)}writeCurveSegments_(O,Y,te){const ne=createElementNS(O.namespaceURI,"LineStringSegment");O.appendChild(ne),this.writeCurveOrLineString(ne,Y,te)}writeGeometryElement(O,Y,te){const ne=te[te.length-1],xe=Object.assign({},ne);xe.node=O;let et;Array.isArray(Y)?et=transformExtentWithOptions(Y,ne):et=transformGeometryWithOptions(Y,!0,ne),pushSerializeAndPop(xe,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[et],te,void 0,this)}writeFeatureElement(O,Y,te){const ne=Y.getId();ne&&O.setAttribute("fid",ne);const xe=te[te.length-1],et=xe.featureNS,tt=Y.getGeometryName();xe.serializers||(xe.serializers={},xe.serializers[et]={});const it=[],st=[];if(Y.hasProperties()){const rt=Y.getProperties();for(const nt in rt){const at=rt[nt];at!=null&&(it.push(nt),st.push(at),nt==tt||typeof at.getSimplifiedGeometry=="function"?nt in xe.serializers[et]||(xe.serializers[et][nt]=makeChildAppender(this.writeGeometryElement,this)):nt in xe.serializers[et]||(xe.serializers[et][nt]=makeChildAppender(writeStringTextNode)))}}const ot=Object.assign({},xe);ot.node=O,pushSerializeAndPop(ot,xe.serializers,makeSimpleNodeFactory(void 0,et),st,te,it)}writeFeatureMembers_(O,Y,te){const ne=te[te.length-1],xe=ne.featureType,et=ne.featureNS,tt={};tt[et]={},tt[et][xe]=makeChildAppender(this.writeFeatureElement,this);const it=Object.assign({},ne);it.node=O,pushSerializeAndPop(it,tt,makeSimpleNodeFactory(xe,et),Y,te)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(O,Y,te){const ne=Y[Y.length-1].node;return createElementNS(this.namespace,MULTIGEOMETRY_TO_MEMBER_NODENAME[ne.nodeName])}GEOMETRY_NODE_FACTORY_(O,Y,te){const ne=Y[Y.length-1],xe=ne.multiSurface,et=ne.surface,tt=ne.curve,it=ne.multiCurve;return Array.isArray(O)?te="Envelope":(te=O.getType(),te==="MultiPolygon"&&xe===!0?te="MultiSurface":te==="Polygon"&&et===!0?te="Surface":te==="LineString"&&tt===!0?te="Curve":te==="MultiLineString"&&it===!0&&(te="MultiCurve")),createElementNS(this.namespace,te)}writeGeometryNode(O,Y){Y=this.adaptOptions(Y);const te=createElementNS(this.namespace,"geom"),ne={node:te,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return Y&&Object.assign(ne,Y),this.writeGeometryElement(te,O,[ne]),te}writeFeaturesNode(O,Y){Y=this.adaptOptions(Y);const te=createElementNS(this.namespace,"featureMembers");te.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",this.schemaLocation);const ne={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return Y&&Object.assign(ne,Y),this.writeFeatureMembers_(te,O,[ne]),te}}GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:makeReplacer(GML3.prototype.readFlatPos),posList:makeReplacer(GML3.prototype.readFlatPosList),coordinates:makeReplacer(GML2.prototype.readFlatCoordinates)}};GML3.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:GML3.prototype.interiorParser,exterior:GML3.prototype.exteriorParser}};GML3.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:makeReplacer(GMLBase.prototype.readPoint),MultiPoint:makeReplacer(GMLBase.prototype.readMultiPoint),LineString:makeReplacer(GMLBase.prototype.readLineString),MultiLineString:makeReplacer(GMLBase.prototype.readMultiLineString),LinearRing:makeReplacer(GMLBase.prototype.readLinearRing),Polygon:makeReplacer(GMLBase.prototype.readPolygon),MultiPolygon:makeReplacer(GMLBase.prototype.readMultiPolygon),Surface:makeReplacer(GML3.prototype.readSurface),MultiSurface:makeReplacer(GML3.prototype.readMultiSurface),Curve:makeReplacer(GML3.prototype.readCurve),MultiCurve:makeReplacer(GML3.prototype.readMultiCurve),Envelope:makeReplacer(GML3.prototype.readEnvelope)}};GML3.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:makeArrayPusher(GML3.prototype.curveMemberParser),curveMembers:makeArrayPusher(GML3.prototype.curveMemberParser)}};GML3.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:makeArrayPusher(GML3.prototype.surfaceMemberParser),surfaceMembers:makeArrayPusher(GML3.prototype.surfaceMemberParser)}};GML3.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:makeArrayPusher(GMLBase.prototype.readLineString),Curve:makeArrayPusher(GML3.prototype.readCurve)}};GML3.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:makeArrayPusher(GMLBase.prototype.readPolygon),Surface:makeArrayPusher(GML3.prototype.readSurface)}};GML3.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:makeReplacer(GML3.prototype.readPatch)}};GML3.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:makeReplacer(GML3.prototype.readSegment)}};GML3.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:makeArrayPusher(GML3.prototype.readFlatPosList),upperCorner:makeArrayPusher(GML3.prototype.readFlatPosList)}};GML3.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:makeReplacer(GML3.prototype.readPolygonPatch)}};GML3.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:makeArrayExtender(GML3.prototype.readLineStringSegment)}};GMLBase.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:makeReplacer(GMLBase.prototype.readFlatLinearRing),Ring:makeReplacer(GML3.prototype.readFlatCurveRing)}};GML3.prototype.writeFeatures;GML3.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:makeChildAppender(GML3.prototype.writeRing),interior:makeChildAppender(GML3.prototype.writeRing)}};GML3.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:makeChildAppender(writeStringTextNode),upperCorner:makeChildAppender(writeStringTextNode)}};GML3.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:makeChildAppender(GML3.prototype.writeSurfaceOrPolygonMember),polygonMember:makeChildAppender(GML3.prototype.writeSurfaceOrPolygonMember)}};GML3.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:makeChildAppender(GML3.prototype.writePointMember)}};GML3.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:makeChildAppender(GML3.prototype.writeLineStringOrCurveMember),curveMember:makeChildAppender(GML3.prototype.writeLineStringOrCurveMember)}};GML3.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:makeChildAppender(GML3.prototype.writeCurveOrLineString),MultiCurve:makeChildAppender(GML3.prototype.writeMultiCurveOrLineString),Point:makeChildAppender(GML3.prototype.writePoint),MultiPoint:makeChildAppender(GML3.prototype.writeMultiPoint),LineString:makeChildAppender(GML3.prototype.writeCurveOrLineString),MultiLineString:makeChildAppender(GML3.prototype.writeMultiCurveOrLineString),LinearRing:makeChildAppender(GML3.prototype.writeLinearRing),Polygon:makeChildAppender(GML3.prototype.writeSurfaceOrPolygon),MultiPolygon:makeChildAppender(GML3.prototype.writeMultiSurfaceOrPolygon),Surface:makeChildAppender(GML3.prototype.writeSurfaceOrPolygon),MultiSurface:makeChildAppender(GML3.prototype.writeMultiSurfaceOrPolygon),Envelope:makeChildAppender(GML3.prototype.writeEnvelope)}};const GML=GML3;GML.prototype.writeFeatures;GML.prototype.writeFeaturesNode;const NAMESPACE_URIS$2=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],SCHEMA_LOCATION$1="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",FEATURE_READER={rte:readRte,trk:readTrk,wpt:readWpt},GPX_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{rte:makeArrayPusher(readRte),trk:makeArrayPusher(readTrk),wpt:makeArrayPusher(readWpt)}),LINK_PARSERS$1=makeStructureNS(NAMESPACE_URIS$2,{text:makeObjectPropertySetter(readString,"linkText"),type:makeObjectPropertySetter(readString,"linkType")}),AUTHOR_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{name:makeObjectPropertySetter(readString),email:parseEmail,link:parseLink}),METADATA_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{name:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),author:makeObjectPropertySetter(readAuthor),copyright:makeObjectPropertySetter(readCopyright),link:parseLink,time:makeObjectPropertySetter(readDateTime),keywords:makeObjectPropertySetter(readString),bounds:parseBounds,extensions:parseExtensions}),COPYRIGHT_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{year:makeObjectPropertySetter(readPositiveInteger),license:makeObjectPropertySetter(readString)}),GPX_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$2,{rte:makeChildAppender(writeRte),trk:makeChildAppender(writeTrk),wpt:makeChildAppender(writeWpt)});class GPX extends XMLFeature{constructor(O){super(),O=O||{},this.dataProjection=get$2("EPSG:4326"),this.readExtensions_=O.readExtensions}handleReadExtensions_(O){O||(O=[]);for(let Y=0,te=O.length;Y<te;++Y){const ne=O[Y];if(this.readExtensions_){const xe=ne.get("extensionsNode_")||null;this.readExtensions_(ne,xe)}ne.set("extensionsNode_",void 0)}}readMetadata(O){return O?typeof O=="string"?this.readMetadataFromDocument(parse(O)):isDocument(O)?this.readMetadataFromDocument(O):this.readMetadataFromNode(O):null}readMetadataFromDocument(O){for(let Y=O.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType===Node.ELEMENT_NODE){const te=this.readMetadataFromNode(Y);if(te)return te}return null}readMetadataFromNode(O){if(!NAMESPACE_URIS$2.includes(O.namespaceURI))return null;for(let Y=O.firstElementChild;Y;Y=Y.nextElementSibling)if(NAMESPACE_URIS$2.includes(Y.namespaceURI)&&Y.localName==="metadata")return pushParseAndPop({},METADATA_PARSERS,Y,[]);return null}readFeatureFromNode(O,Y){if(!NAMESPACE_URIS$2.includes(O.namespaceURI))return null;const te=FEATURE_READER[O.localName];if(!te)return null;const ne=te(O,[this.getReadOptions(O,Y)]);return ne?(this.handleReadExtensions_([ne]),ne):null}readFeaturesFromNode(O,Y){if(!NAMESPACE_URIS$2.includes(O.namespaceURI))return[];if(O.localName=="gpx"){const te=pushParseAndPop([],GPX_PARSERS,O,[this.getReadOptions(O,Y)]);return te?(this.handleReadExtensions_(te),te):[]}return[]}writeFeaturesNode(O,Y){Y=this.adaptOptions(Y);const te=createElementNS("http://www.topografix.com/GPX/1/1","gpx");return te.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",XML_SCHEMA_INSTANCE_URI),te.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION$1),te.setAttribute("version","1.1"),te.setAttribute("creator","OpenLayers"),pushSerializeAndPop({node:te},GPX_SERIALIZERS,GPX_NODE_FACTORY,O,[Y]),te}}const RTE_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,number:makeObjectPropertySetter(readPositiveInteger),extensions:parseExtensions,type:makeObjectPropertySetter(readString),rtept:parseRtePt}),RTEPT_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime)}),TRK_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,number:makeObjectPropertySetter(readPositiveInteger),type:makeObjectPropertySetter(readString),extensions:parseExtensions,trkseg:parseTrkSeg}),TRKSEG_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{trkpt:parseTrkPt}),TRKPT_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime)}),WPT_PARSERS=makeStructureNS(NAMESPACE_URIS$2,{ele:makeObjectPropertySetter(readDecimal),time:makeObjectPropertySetter(readDateTime),magvar:makeObjectPropertySetter(readDecimal),geoidheight:makeObjectPropertySetter(readDecimal),name:makeObjectPropertySetter(readString),cmt:makeObjectPropertySetter(readString),desc:makeObjectPropertySetter(readString),src:makeObjectPropertySetter(readString),link:parseLink,sym:makeObjectPropertySetter(readString),type:makeObjectPropertySetter(readString),fix:makeObjectPropertySetter(readString),sat:makeObjectPropertySetter(readPositiveInteger),hdop:makeObjectPropertySetter(readDecimal),vdop:makeObjectPropertySetter(readDecimal),pdop:makeObjectPropertySetter(readDecimal),ageofdgpsdata:makeObjectPropertySetter(readDecimal),dgpsid:makeObjectPropertySetter(readPositiveInteger),extensions:parseExtensions}),LINK_SEQUENCE=["text","type"],LINK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$2,{text:makeChildAppender(writeStringTextNode),type:makeChildAppender(writeStringTextNode)}),RTE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$2,["name","cmt","desc","src","link","number","type","rtept"]),RTE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$2,{name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),number:makeChildAppender(writeNonNegativeIntegerTextNode),type:makeChildAppender(writeStringTextNode),rtept:makeArraySerializer(makeChildAppender(writeWptType))}),RTEPT_TYPE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$2,["ele","time"]),TRK_SEQUENCE=makeStructureNS(NAMESPACE_URIS$2,["name","cmt","desc","src","link","number","type","trkseg"]),TRK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$2,{name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),number:makeChildAppender(writeNonNegativeIntegerTextNode),type:makeChildAppender(writeStringTextNode),trkseg:makeArraySerializer(makeChildAppender(writeTrkSeg))}),TRKSEG_NODE_FACTORY=makeSimpleNodeFactory("trkpt"),TRKSEG_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$2,{trkpt:makeChildAppender(writeWptType)}),WPT_TYPE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$2,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),WPT_TYPE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$2,{ele:makeChildAppender(writeDecimalTextNode),time:makeChildAppender(writeDateTimeTextNode),magvar:makeChildAppender(writeDecimalTextNode),geoidheight:makeChildAppender(writeDecimalTextNode),name:makeChildAppender(writeStringTextNode),cmt:makeChildAppender(writeStringTextNode),desc:makeChildAppender(writeStringTextNode),src:makeChildAppender(writeStringTextNode),link:makeChildAppender(writeLink),sym:makeChildAppender(writeStringTextNode),type:makeChildAppender(writeStringTextNode),fix:makeChildAppender(writeStringTextNode),sat:makeChildAppender(writeNonNegativeIntegerTextNode),hdop:makeChildAppender(writeDecimalTextNode),vdop:makeChildAppender(writeDecimalTextNode),pdop:makeChildAppender(writeDecimalTextNode),ageofdgpsdata:makeChildAppender(writeDecimalTextNode),dgpsid:makeChildAppender(writeNonNegativeIntegerTextNode)}),GEOMETRY_TYPE_TO_NODENAME$1={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function GPX_NODE_FACTORY(ee,O,Y){const te=ee.getGeometry();if(te){const ne=GEOMETRY_TYPE_TO_NODENAME$1[te.getType()];if(ne){const xe=O[O.length-1].node;return createElementNS(xe.namespaceURI,ne)}}}function appendCoordinate(ee,O,Y,te){return ee.push(parseFloat(Y.getAttribute("lon")),parseFloat(Y.getAttribute("lat"))),"ele"in te?(ee.push(te.ele),delete te.ele,O.hasZ=!0):ee.push(0),"time"in te?(ee.push(te.time),delete te.time,O.hasM=!0):ee.push(0),ee}function applyLayoutOptions(ee,O,Y){let te="XY",ne=2;if(ee.hasZ&&ee.hasM?(te="XYZM",ne=4):ee.hasZ?(te="XYZ",ne=3):ee.hasM&&(te="XYM",ne=3),ne!==4){for(let xe=0,et=O.length/4;xe<et;xe++)O[xe*ne]=O[xe*4],O[xe*ne+1]=O[xe*4+1],ee.hasZ&&(O[xe*ne+2]=O[xe*4+2]),ee.hasM&&(O[xe*ne+2]=O[xe*4+3]);if(O.length=O.length/4*ne,Y)for(let xe=0,et=Y.length;xe<et;xe++)Y[xe]=Y[xe]/4*ne}return te}function readAuthor(ee,O){const Y=pushParseAndPop({},AUTHOR_PARSERS,ee,O);if(Y)return Y}function readCopyright(ee,O){const Y=pushParseAndPop({},COPYRIGHT_PARSERS,ee,O);if(Y){const te=ee.getAttribute("author");return te!==null&&(Y.author=te),Y}}function parseBounds(ee,O){const Y=O[O.length-1],te=ee.getAttribute("minlat"),ne=ee.getAttribute("minlon"),xe=ee.getAttribute("maxlat"),et=ee.getAttribute("maxlon");ne!==null&&te!==null&&et!==null&&xe!==null&&(Y.bounds=[[parseFloat(ne),parseFloat(te)],[parseFloat(et),parseFloat(xe)]])}function parseEmail(ee,O){const Y=O[O.length-1],te=ee.getAttribute("id"),ne=ee.getAttribute("domain");te!==null&&ne!==null&&(Y.email=`${te}@${ne}`)}function parseLink(ee,O){const Y=O[O.length-1],te=ee.getAttribute("href");te!==null&&(Y.link=te),parseNode(LINK_PARSERS$1,ee,O)}function parseExtensions(ee,O){const Y=O[O.length-1];Y.extensionsNode_=ee}function parseRtePt(ee,O){const Y=pushParseAndPop({},RTEPT_PARSERS,ee,O);if(Y){const te=O[O.length-1],ne=te.flatCoordinates,xe=te.layoutOptions;appendCoordinate(ne,xe,ee,Y)}}function parseTrkPt(ee,O){const Y=pushParseAndPop({},TRKPT_PARSERS,ee,O);if(Y){const te=O[O.length-1],ne=te.flatCoordinates,xe=te.layoutOptions;appendCoordinate(ne,xe,ee,Y)}}function parseTrkSeg(ee,O){const Y=O[O.length-1];parseNode(TRKSEG_PARSERS,ee,O);const te=Y.flatCoordinates;Y.ends.push(te.length)}function readRte(ee,O){const Y=O[0],te=pushParseAndPop({flatCoordinates:[],layoutOptions:{}},RTE_PARSERS,ee,O);if(!te)return;const ne=te.flatCoordinates;delete te.flatCoordinates;const xe=te.layoutOptions;delete te.layoutOptions;const et=applyLayoutOptions(xe,ne),tt=new LineString(ne,et);transformGeometryWithOptions(tt,!1,Y);const it=new Feature(tt);return it.setProperties(te,!0),it}function readTrk(ee,O){const Y=O[0],te=pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},TRK_PARSERS,ee,O);if(!te)return;const ne=te.flatCoordinates;delete te.flatCoordinates;const xe=te.ends;delete te.ends;const et=te.layoutOptions;delete te.layoutOptions;const tt=applyLayoutOptions(et,ne,xe),it=new MultiLineString(ne,tt,xe);transformGeometryWithOptions(it,!1,Y);const st=new Feature(it);return st.setProperties(te,!0),st}function readWpt(ee,O){const Y=O[0],te=pushParseAndPop({},WPT_PARSERS,ee,O);if(!te)return;const ne={},xe=appendCoordinate([],ne,ee,te),et=applyLayoutOptions(ne,xe),tt=new Point(xe,et);transformGeometryWithOptions(tt,!1,Y);const it=new Feature(tt);return it.setProperties(te,!0),it}function writeLink(ee,O,Y){ee.setAttribute("href",O);const ne=Y[Y.length-1].properties,xe=[ne.linkText,ne.linkType];pushSerializeAndPop({node:ee},LINK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,xe,Y,LINK_SEQUENCE)}function writeWptType(ee,O,Y){const te=Y[Y.length-1],xe=te.node.namespaceURI,et=te.properties;switch(ee.setAttributeNS(null,"lat",String(O[1])),ee.setAttributeNS(null,"lon",String(O[0])),te.geometryLayout){case"XYZM":O[3]!==0&&(et.time=O[3]);case"XYZ":O[2]!==0&&(et.ele=O[2]);break;case"XYM":O[2]!==0&&(et.time=O[2]);break}const it=ee.nodeName=="rtept"?RTEPT_TYPE_SEQUENCE[xe]:WPT_TYPE_SEQUENCE[xe],st=makeSequence(et,it);pushSerializeAndPop({node:ee,properties:et},WPT_TYPE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,st,Y,it)}function writeRte(ee,O,Y){const te=Y[0],ne=O.getProperties(),xe={node:ee};xe.properties=ne;const et=O.getGeometry();if(et.getType()=="LineString"){const ot=transformGeometryWithOptions(et,!0,te);xe.geometryLayout=ot.getLayout(),ne.rtept=ot.getCoordinates()}const tt=Y[Y.length-1].node,it=RTE_SEQUENCE[tt.namespaceURI],st=makeSequence(ne,it);pushSerializeAndPop(xe,RTE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,st,Y,it)}function writeTrk(ee,O,Y){const te=Y[0],ne=O.getProperties(),xe={node:ee};xe.properties=ne;const et=O.getGeometry();if(et.getType()=="MultiLineString"){const ot=transformGeometryWithOptions(et,!0,te);ne.trkseg=ot.getLineStrings()}const tt=Y[Y.length-1].node,it=TRK_SEQUENCE[tt.namespaceURI],st=makeSequence(ne,it);pushSerializeAndPop(xe,TRK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,st,Y,it)}function writeTrkSeg(ee,O,Y){const te={node:ee};te.geometryLayout=O.getLayout(),te.properties={},pushSerializeAndPop(te,TRKSEG_SERIALIZERS,TRKSEG_NODE_FACTORY,O.getCoordinates(),Y)}function writeWpt(ee,O,Y){const te=Y[0],ne=Y[Y.length-1];ne.properties=O.getProperties();const xe=O.getGeometry();if(xe.getType()=="Point"){const et=transformGeometryWithOptions(xe,!0,te);ne.geometryLayout=et.getLayout(),writeWptType(ee,et.getCoordinates(),Y)}}class TextFeature extends FeatureFormat{constructor(){super()}getType(){return"text"}readFeature(O,Y){return this.readFeatureFromText(getText(O),this.adaptOptions(Y))}readFeatureFromText(O,Y){return abstract()}readFeatures(O,Y){return this.readFeaturesFromText(getText(O),this.adaptOptions(Y))}readFeaturesFromText(O,Y){return abstract()}readGeometry(O,Y){return this.readGeometryFromText(getText(O),this.adaptOptions(Y))}readGeometryFromText(O,Y){return abstract()}readProjection(O){return this.readProjectionFromText(getText(O))}readProjectionFromText(O){return this.dataProjection}writeFeature(O,Y){return this.writeFeatureText(O,this.adaptOptions(Y))}writeFeatureText(O,Y){return abstract()}writeFeatures(O,Y){return this.writeFeaturesText(O,this.adaptOptions(Y))}writeFeaturesText(O,Y){return abstract()}writeGeometry(O,Y){return this.writeGeometryText(O,this.adaptOptions(Y))}writeGeometryText(O,Y){return abstract()}}function getText(ee){return typeof ee=="string"?ee:""}const B_RECORD_RE=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,H_RECORD_RE=/^H.([A-Z]{3}).*?:(.*)/,HFDTE_RECORD_RE=/^HFDTE(\d{2})(\d{2})(\d{2})/,HFDTEDATE_RECORD_RE=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,NEWLINE_RE=/\r\n|\r|\n/;class IGC extends TextFeature{constructor(O){super(),O=O||{},this.dataProjection=get$2("EPSG:4326"),this.altitudeMode_=O.altitudeMode?O.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(O,Y){const te=this.altitudeMode_,ne=O.split(NEWLINE_RE),xe={},et=[];let tt=2e3,it=0,st=1,ot=-1,rt,nt;for(rt=0,nt=ne.length;rt<nt;++rt){const dt=ne[rt];let ht;if(dt.charAt(0)=="B"){if(ht=B_RECORD_RE.exec(dt),ht){const pt=parseInt(ht[1],10),ft=parseInt(ht[2],10),mt=parseInt(ht[3],10);let yt=parseInt(ht[4],10)+parseInt(ht[5],10)/6e4;this.lad_&&(yt+=parseInt(dt.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),ht[6]=="S"&&(yt=-yt);let bt=parseInt(ht[7],10)+parseInt(ht[8],10)/6e4;if(this.lod_&&(bt+=parseInt(dt.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),ht[9]=="W"&&(bt=-bt),et.push(bt,yt),te!="none"){let Et;te=="gps"?Et=parseInt(ht[11],10):te=="barometric"?Et=parseInt(ht[12],10):Et=0,et.push(Et)}let vt=Date.UTC(tt,it,st,pt,ft,mt);vt<ot&&(vt=Date.UTC(tt,it,st+1,pt,ft,mt)),et.push(vt/1e3),ot=vt}}else if(dt.charAt(0)=="H")ht=HFDTEDATE_RECORD_RE.exec(dt),ht?(st=parseInt(ht[1],10),it=parseInt(ht[2],10)-1,tt=2e3+parseInt(ht[3],10)):(ht=HFDTE_RECORD_RE.exec(dt),ht?(st=parseInt(ht[1],10),it=parseInt(ht[2],10)-1,tt=2e3+parseInt(ht[3],10)):(ht=H_RECORD_RE.exec(dt),ht&&(xe[ht[1]]=ht[2].trim())));else if(dt.charAt(0)=="I"){const pt=parseInt(dt.slice(1,3),10);for(let ft=0;ft<pt;ft++){const mt=dt.slice(7+ft*7,10+ft*7);if(mt==="LAD"||mt==="LOD"){const yt=parseInt(dt.slice(3+ft*7,5+ft*7),10)-1,bt=parseInt(dt.slice(5+ft*7,7+ft*7),10);mt==="LAD"?(this.lad_=!0,this.ladStart_=yt,this.ladStop_=bt):mt==="LOD"&&(this.lod_=!0,this.lodStart_=yt,this.lodStop_=bt)}}}}if(et.length===0)return null;const at=te=="none"?"XYM":"XYZM",ct=new LineString(et,at),ut=new Feature(transformGeometryWithOptions(ct,!1,Y));return ut.setProperties(xe,!0),ut}readFeaturesFromText(O,Y){const te=this.readFeatureFromText(O,Y);return te?[te]:[]}}const GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS$1=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},PLACEMARK_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:makeObjectPropertySetter(readMultiGeometry,"geometry"),LineString:makeObjectPropertySetter(readLineString,"geometry"),LinearRing:makeObjectPropertySetter(readLinearRing,"geometry"),Point:makeObjectPropertySetter(readPoint,"geometry"),Polygon:makeObjectPropertySetter(readPolygon,"geometry"),Style:makeObjectPropertySetter(readStyle$1),StyleMap:placemarkStyleMapParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL),visibility:makeObjectPropertySetter(readBoolean)},makeStructureNS(GX_NAMESPACE_URIS,{MultiTrack:makeObjectPropertySetter(readGxMultiTrack,"geometry"),Track:makeObjectPropertySetter(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),visibility:makeObjectPropertySetter(readBoolean)}),LINK_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{href:makeObjectPropertySetter(readURI)}),CAMERA_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Altitude:makeObjectPropertySetter(readDecimal),Longitude:makeObjectPropertySetter(readDecimal),Latitude:makeObjectPropertySetter(readDecimal),Tilt:makeObjectPropertySetter(readDecimal),AltitudeMode:makeObjectPropertySetter(readString),Heading:makeObjectPropertySetter(readDecimal),Roll:makeObjectPropertySetter(readDecimal)}),REGION_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["Document","Placemark"]),KML_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{Document:makeChildAppender(writeDocument),Placemark:makeChildAppender(writePlacemark)});let DEFAULT_COLOR,DEFAULT_FILL_STYLE=null,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,DEFAULT_IMAGE_STYLE=null,DEFAULT_NO_IMAGE_STYLE,DEFAULT_STROKE_STYLE=null,DEFAULT_TEXT_STROKE_STYLE,DEFAULT_TEXT_STYLE=null,DEFAULT_STYLE$1=null,DEFAULT_STYLE_ARRAY=null;function scaleForSize(ee){return 32/Math.min(ee[0],ee[1])}function createStyleDefaults(){DEFAULT_COLOR=[255,255,255,1],DEFAULT_FILL_STYLE=new Fill({color:DEFAULT_COLOR}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS="pixels",DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS="pixels",DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_STYLE=new Icon({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:"bottom-left",anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:scaleForSize(DEFAULT_IMAGE_STYLE_SIZE),size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new Stroke({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new Stroke({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new Text({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE$1=new Style({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE$1]}let TEXTAREA;function defaultIconUrlFunction(ee){return ee}class KML extends XMLFeature{constructor(O){super(),O=O||{},DEFAULT_STYLE_ARRAY||createStyleDefaults(),this.dataProjection=get$2("EPSG:4326"),this.defaultStyle_=O.defaultStyle?O.defaultStyle:DEFAULT_STYLE_ARRAY,this.extractStyles_=O.extractStyles!==void 0?O.extractStyles:!0,this.writeStyles_=O.writeStyles!==void 0?O.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=O.showPointNames!==void 0?O.showPointNames:!0,this.crossOrigin_=O.crossOrigin!==void 0?O.crossOrigin:"anonymous",this.iconUrlFunction_=O.iconUrlFunction?O.iconUrlFunction:defaultIconUrlFunction,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(O,Y){const te=makeStructureNS(NAMESPACE_URIS$1,{Document:makeArrayExtender(this.readDocumentOrFolder_,this),Folder:makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),ne=pushParseAndPop([],te,O,Y,this);if(ne)return ne}readPlacemark_(O,Y){const te=pushParseAndPop({geometry:null},PLACEMARK_PARSERS,O,Y,this);if(!te)return;const ne=new Feature,xe=O.getAttribute("id");xe!==null&&ne.setId(xe);const et=Y[0],tt=te.geometry;if(tt&&transformGeometryWithOptions(tt,!1,et),ne.setGeometry(tt),delete te.geometry,this.extractStyles_){const it=te.Style,st=te.styleUrl,ot=createFeatureStyleFunction(it,st,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);ne.setStyle(ot)}return delete te.Style,ne.setProperties(te,!0),ne}readSharedStyle_(O,Y){const te=O.getAttribute("id");if(te!==null){const ne=readStyle$1.call(this,O,Y);if(ne){let xe,et=O.baseURI;(!et||et=="about:blank")&&(et=window.location.href),et?xe=new URL("#"+te,et).href:xe="#"+te,this.sharedStyles_[xe]=ne}}}readSharedStyleMap_(O,Y){const te=O.getAttribute("id");if(te===null)return;const ne=readStyleMapValue.call(this,O,Y);if(!ne)return;let xe,et=O.baseURI;(!et||et=="about:blank")&&(et=window.location.href),et?xe=new URL("#"+te,et).href:xe="#"+te,this.sharedStyles_[xe]=ne}readFeatureFromNode(O,Y){if(!NAMESPACE_URIS$1.includes(O.namespaceURI))return null;const te=this.readPlacemark_(O,[this.getReadOptions(O,Y)]);return te||null}readFeaturesFromNode(O,Y){if(!NAMESPACE_URIS$1.includes(O.namespaceURI))return[];let te;const ne=O.localName;if(ne=="Document"||ne=="Folder")return te=this.readDocumentOrFolder_(O,[this.getReadOptions(O,Y)]),te||[];if(ne=="Placemark"){const xe=this.readPlacemark_(O,[this.getReadOptions(O,Y)]);return xe?[xe]:[]}if(ne=="kml"){te=[];for(let xe=O.firstElementChild;xe;xe=xe.nextElementSibling){const et=this.readFeaturesFromNode(xe,Y);et&&extend$2(te,et)}return te}return[]}readName(O){if(O){if(typeof O=="string"){const Y=parse(O);return this.readNameFromDocument(Y)}return isDocument(O)?this.readNameFromDocument(O):this.readNameFromNode(O)}}readNameFromDocument(O){for(let Y=O.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType==Node.ELEMENT_NODE){const te=this.readNameFromNode(Y);if(te)return te}}readNameFromNode(O){for(let Y=O.firstElementChild;Y;Y=Y.nextElementSibling)if(NAMESPACE_URIS$1.includes(Y.namespaceURI)&&Y.localName=="name")return readString(Y);for(let Y=O.firstElementChild;Y;Y=Y.nextElementSibling){const te=Y.localName;if(NAMESPACE_URIS$1.includes(Y.namespaceURI)&&(te=="Document"||te=="Folder"||te=="Placemark"||te=="kml")){const ne=this.readNameFromNode(Y);if(ne)return ne}}}readNetworkLinks(O){const Y=[];if(typeof O=="string"){const te=parse(O);extend$2(Y,this.readNetworkLinksFromDocument(te))}else isDocument(O)?extend$2(Y,this.readNetworkLinksFromDocument(O)):extend$2(Y,this.readNetworkLinksFromNode(O));return Y}readNetworkLinksFromDocument(O){const Y=[];for(let te=O.firstChild;te;te=te.nextSibling)te.nodeType==Node.ELEMENT_NODE&&extend$2(Y,this.readNetworkLinksFromNode(te));return Y}readNetworkLinksFromNode(O){const Y=[];for(let te=O.firstElementChild;te;te=te.nextElementSibling)if(NAMESPACE_URIS$1.includes(te.namespaceURI)&&te.localName=="NetworkLink"){const ne=pushParseAndPop({},NETWORK_LINK_PARSERS,te,[]);Y.push(ne)}for(let te=O.firstElementChild;te;te=te.nextElementSibling){const ne=te.localName;NAMESPACE_URIS$1.includes(te.namespaceURI)&&(ne=="Document"||ne=="Folder"||ne=="kml")&&extend$2(Y,this.readNetworkLinksFromNode(te))}return Y}readRegion(O){const Y=[];if(typeof O=="string"){const te=parse(O);extend$2(Y,this.readRegionFromDocument(te))}else isDocument(O)?extend$2(Y,this.readRegionFromDocument(O)):extend$2(Y,this.readRegionFromNode(O));return Y}readRegionFromDocument(O){const Y=[];for(let te=O.firstChild;te;te=te.nextSibling)te.nodeType==Node.ELEMENT_NODE&&extend$2(Y,this.readRegionFromNode(te));return Y}readRegionFromNode(O){const Y=[];for(let te=O.firstElementChild;te;te=te.nextElementSibling)if(NAMESPACE_URIS$1.includes(te.namespaceURI)&&te.localName=="Region"){const ne=pushParseAndPop({},REGION_PARSERS,te,[]);Y.push(ne)}for(let te=O.firstElementChild;te;te=te.nextElementSibling){const ne=te.localName;NAMESPACE_URIS$1.includes(te.namespaceURI)&&(ne=="Document"||ne=="Folder"||ne=="kml")&&extend$2(Y,this.readRegionFromNode(te))}return Y}readCamera(O){const Y=[];if(typeof O=="string"){const te=parse(O);extend$2(Y,this.readCameraFromDocument(te))}else isDocument(O)?extend$2(Y,this.readCameraFromDocument(O)):extend$2(Y,this.readCameraFromNode(O));return Y}readCameraFromDocument(O){const Y=[];for(let te=O.firstChild;te;te=te.nextSibling)te.nodeType===Node.ELEMENT_NODE&&extend$2(Y,this.readCameraFromNode(te));return Y}readCameraFromNode(O){const Y=[];for(let te=O.firstElementChild;te;te=te.nextElementSibling)if(NAMESPACE_URIS$1.includes(te.namespaceURI)&&te.localName==="Camera"){const ne=pushParseAndPop({},CAMERA_PARSERS,te,[]);Y.push(ne)}for(let te=O.firstElementChild;te;te=te.nextElementSibling){const ne=te.localName;NAMESPACE_URIS$1.includes(te.namespaceURI)&&(ne==="Document"||ne==="Folder"||ne==="Placemark"||ne==="kml")&&extend$2(Y,this.readCameraFromNode(te))}return Y}writeFeaturesNode(O,Y){Y=this.adaptOptions(Y);const te=createElementNS(NAMESPACE_URIS$1[4],"kml"),ne="http://www.w3.org/2000/xmlns/";te.setAttributeNS(ne,"xmlns:gx",GX_NAMESPACE_URIS[0]),te.setAttributeNS(ne,"xmlns:xsi",XML_SCHEMA_INSTANCE_URI),te.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION);const xe={node:te},et={};O.length>1?et.Document=O:O.length==1&&(et.Placemark=O[0]);const tt=KML_SEQUENCE[te.namespaceURI],it=makeSequence(et,tt);return pushSerializeAndPop(xe,KML_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,it,[Y],tt,this),te}}function createNameStyleFunction(ee,O){const Y=[0,0];let te="start";const ne=ee.getImage();if(ne){const tt=ne.getSize();if(tt&&tt.length==2){const it=ne.getScaleArray(),st=ne.getAnchor();Y[0]=it[0]*(tt[0]-st[0]),Y[1]=it[1]*(tt[1]/2-st[1]),te="left"}}let xe=ee.getText();return xe?(xe=xe.clone(),xe.setFont(xe.getFont()||DEFAULT_TEXT_STYLE.getFont()),xe.setScale(xe.getScale()||DEFAULT_TEXT_STYLE.getScale()),xe.setFill(xe.getFill()||DEFAULT_TEXT_STYLE.getFill()),xe.setStroke(xe.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):xe=DEFAULT_TEXT_STYLE.clone(),xe.setText(O),xe.setOffsetX(Y[0]),xe.setOffsetY(Y[1]),xe.setTextAlign(te),new Style({image:ne,text:xe})}function createFeatureStyleFunction(ee,O,Y,te,ne){return(function(xe,et){let tt=ne,it="",st=[];if(tt){const rt=xe.getGeometry();if(rt)if(rt instanceof GeometryCollection)st=rt.getGeometriesArrayRecursive().filter(function(nt){const at=nt.getType();return at==="Point"||at==="MultiPoint"}),tt=st.length>0;else{const nt=rt.getType();tt=nt==="Point"||nt==="MultiPoint"}}tt&&(it=xe.get("name"),tt=tt&&!!it,tt&&/&[^&]+;/.test(it)&&(TEXTAREA||(TEXTAREA=document.createElement("textarea")),TEXTAREA.innerHTML=it,it=TEXTAREA.value));let ot=Y;if(ee?ot=ee:O&&(ot=findStyle(O,Y,te)),tt){const rt=createNameStyleFunction(ot[0],it);if(st.length>0){rt.setGeometry(new GeometryCollection(st));const nt=new Style({geometry:ot[0].getGeometry(),image:null,fill:ot[0].getFill(),stroke:ot[0].getStroke(),text:null});return[rt,nt].concat(ot.slice(1))}return rt}return ot})}function findStyle(ee,O,Y){return Array.isArray(ee)?ee:typeof ee=="string"?findStyle(Y[ee],O,Y):O}function readColor(ee){const O=getAllTextContent(ee,!1),Y=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(O);if(Y){const te=Y[1];return[parseInt(te.substr(6,2),16),parseInt(te.substr(4,2),16),parseInt(te.substr(2,2),16),parseInt(te.substr(0,2),16)/255]}}function readFlatCoordinates(ee){let O=getAllTextContent(ee,!1);const Y=[];O=O.replace(/\s*,\s*/g,",");const te=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let ne;for(;ne=te.exec(O);){const xe=parseFloat(ne[1]),et=parseFloat(ne[2]),tt=ne[3]?parseFloat(ne[3]):0;Y.push(xe,et,tt),O=O.substr(ne[0].length)}if(O==="")return Y}function readURI(ee){const O=getAllTextContent(ee,!1).trim();let Y=ee.baseURI;return(!Y||Y=="about:blank")&&(Y=window.location.href),Y?new URL(O,Y).href:O}function readStyleURL(ee){const O=getAllTextContent(ee,!1).trim().replace(/^(?!.*#)/,"#");let Y=ee.baseURI;return(!Y||Y=="about:blank")&&(Y=window.location.href),Y?new URL(O,Y).href:O}function readVec2(ee){const O=ee.getAttribute("xunits"),Y=ee.getAttribute("yunits");let te;return O!=="insetPixels"?Y!=="insetPixels"?te="bottom-left":te="top-left":Y!=="insetPixels"?te="bottom-right":te="top-right",{x:parseFloat(ee.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[O],y:parseFloat(ee.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[Y],origin:te}}function readScale(ee){return readDecimal(ee)}const STYLE_MAP_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Pair:pairDataParser});function readStyleMapValue(ee,O){return pushParseAndPop(void 0,STYLE_MAP_PARSERS,ee,O,this)}const ICON_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Icon:makeObjectPropertySetter(readIcon),color:makeObjectPropertySetter(readColor),heading:makeObjectPropertySetter(readDecimal),hotSpot:makeObjectPropertySetter(readVec2),scale:makeObjectPropertySetter(readScale)});function iconStyleParser(ee,O){const Y=pushParseAndPop({},ICON_STYLE_PARSERS,ee,O);if(!Y)return;const te=O[O.length-1],ne="Icon"in Y?Y.Icon:{},xe=!("Icon"in Y)||Object.keys(ne).length>0;let et;const tt=ne.href;tt?et=tt:xe&&(et=DEFAULT_IMAGE_STYLE_SRC);let it,st,ot,rt="bottom-left";const nt=Y.hotSpot;nt?(it=[nt.x,nt.y],st=nt.xunits,ot=nt.yunits,rt=nt.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(et)&&(et.includes("pushpin")?(it=DEFAULT_IMAGE_STYLE_ANCHOR,st=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,ot=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):et.includes("arrow-reverse")?(it=[54,42],st=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,ot=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):et.includes("paddle")&&(it=[32,1],st=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,ot=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS));let at;const ct=ne.x,ut=ne.y;ct!==void 0&&ut!==void 0&&(at=[ct,ut]);let dt;const ht=ne.w,pt=ne.h;ht!==void 0&&pt!==void 0&&(dt=[ht,pt]);let ft;const mt=Y.heading;mt!==void 0&&(ft=toRadians(mt));const yt=Y.scale,bt=Y.color;if(xe){et==DEFAULT_IMAGE_STYLE_SRC&&(dt=DEFAULT_IMAGE_STYLE_SIZE);const vt=new Icon({anchor:it,anchorOrigin:rt,anchorXUnits:st,anchorYUnits:ot,crossOrigin:this.crossOrigin_,offset:at,offsetOrigin:"bottom-left",rotation:ft,scale:yt,size:dt,src:this.iconUrlFunction_(et),color:bt}),Et=vt.getScaleArray()[0],wt=vt.getSize();if(wt===null){const St=vt.getImageState();if(St===ImageState.IDLE||St===ImageState.LOADING){const Ot=function(){const $t=vt.getImageState();if(!($t===ImageState.IDLE||$t===ImageState.LOADING)){const Mt=vt.getSize();if(Mt&&Mt.length==2){const Nt=scaleForSize(Mt);vt.setScale(Et*Nt)}vt.unlistenImageChange(Ot)}};vt.listenImageChange(Ot),St===ImageState.IDLE&&vt.load()}}else if(wt.length==2){const St=scaleForSize(wt);vt.setScale(Et*St)}te.imageStyle=vt}else te.imageStyle=DEFAULT_NO_IMAGE_STYLE}const LABEL_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{color:makeObjectPropertySetter(readColor),scale:makeObjectPropertySetter(readScale)});function labelStyleParser(ee,O){const Y=pushParseAndPop({},LABEL_STYLE_PARSERS,ee,O);if(!Y)return;const te=O[O.length-1],ne=new Text({fill:new Fill({color:"color"in Y?Y.color:DEFAULT_COLOR}),scale:Y.scale});te.textStyle=ne}const LINE_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{color:makeObjectPropertySetter(readColor),width:makeObjectPropertySetter(readDecimal)});function lineStyleParser(ee,O){const Y=pushParseAndPop({},LINE_STYLE_PARSERS,ee,O);if(!Y)return;const te=O[O.length-1],ne=new Stroke({color:"color"in Y?Y.color:DEFAULT_COLOR,width:"width"in Y?Y.width:1});te.strokeStyle=ne}const POLY_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{color:makeObjectPropertySetter(readColor),fill:makeObjectPropertySetter(readBoolean),outline:makeObjectPropertySetter(readBoolean)});function polyStyleParser(ee,O){const Y=pushParseAndPop({},POLY_STYLE_PARSERS,ee,O);if(!Y)return;const te=O[O.length-1],ne=new Fill({color:"color"in Y?Y.color:DEFAULT_COLOR});te.fillStyle=ne;const xe=Y.fill;xe!==void 0&&(te.fill=xe);const et=Y.outline;et!==void 0&&(te.outline=et)}const FLAT_LINEAR_RING_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatLinearRing(ee,O){return pushParseAndPop(null,FLAT_LINEAR_RING_PARSERS,ee,O)}function gxCoordParser(ee,O){const te=O[O.length-1].coordinates,ne=getAllTextContent(ee,!1),et=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(ne);if(et){const tt=parseFloat(et[1]),it=parseFloat(et[2]),st=parseFloat(et[3]);te.push([tt,it,st])}else te.push([])}const GX_MULTITRACK_GEOMETRY_PARSERS=makeStructureNS(GX_NAMESPACE_URIS,{Track:makeArrayPusher(readGxTrack)});function readGxMultiTrack(ee,O){const Y=pushParseAndPop([],GX_MULTITRACK_GEOMETRY_PARSERS,ee,O);if(Y)return new MultiLineString(Y)}const GX_TRACK_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{when:whenParser},makeStructureNS(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(ee,O){const Y=pushParseAndPop({coordinates:[],whens:[]},GX_TRACK_PARSERS,ee,O);if(!Y)return;const te=[],ne=Y.coordinates,xe=Y.whens;for(let et=0,tt=Math.min(ne.length,xe.length);et<tt;++et)ne[et].length==3&&te.push(ne[et][0],ne[et][1],ne[et][2],xe[et]);return new LineString(te,"XYZM")}const ICON_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{href:makeObjectPropertySetter(readURI)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeObjectPropertySetter(readDecimal),y:makeObjectPropertySetter(readDecimal),w:makeObjectPropertySetter(readDecimal),h:makeObjectPropertySetter(readDecimal)}));function readIcon(ee,O){const Y=pushParseAndPop({},ICON_PARSERS,ee,O);return Y||null}const GEOMETRY_FLAT_COORDINATES_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatCoordinatesFromNode(ee,O){return pushParseAndPop(null,GEOMETRY_FLAT_COORDINATES_PARSERS,ee,O)}const EXTRUDE_AND_ALTITUDE_MODE_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{extrude:makeObjectPropertySetter(readBoolean),tessellate:makeObjectPropertySetter(readBoolean),altitudeMode:makeObjectPropertySetter(readString)});function readLineString(ee,O){const Y=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,ee,O),te=readFlatCoordinatesFromNode(ee,O);if(te){const ne=new LineString(te,"XYZ");return ne.setProperties(Y,!0),ne}}function readLinearRing(ee,O){const Y=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,ee,O),te=readFlatCoordinatesFromNode(ee,O);if(te){const ne=new Polygon(te,"XYZ",[te.length]);return ne.setProperties(Y,!0),ne}}const MULTI_GEOMETRY_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{LineString:makeArrayPusher(readLineString),LinearRing:makeArrayPusher(readLinearRing),MultiGeometry:makeArrayPusher(readMultiGeometry),Point:makeArrayPusher(readPoint),Polygon:makeArrayPusher(readPolygon)});function readMultiGeometry(ee,O){const Y=pushParseAndPop([],MULTI_GEOMETRY_PARSERS,ee,O);if(!Y)return null;if(Y.length===0)return new GeometryCollection(Y);let te,ne=!0;const xe=Y[0].getType();let et;for(let tt=1,it=Y.length;tt<it;++tt)if(et=Y[tt],et.getType()!=xe){ne=!1;break}if(ne){let tt,it;if(xe=="Point"){const st=Y[0];tt=st.getLayout(),it=st.getFlatCoordinates();for(let ot=1,rt=Y.length;ot<rt;++ot)et=Y[ot],extend$2(it,et.getFlatCoordinates());te=new MultiPoint(it,tt),setCommonGeometryProperties(te,Y)}else if(xe=="LineString")te=new MultiLineString(Y),setCommonGeometryProperties(te,Y);else if(xe=="Polygon")te=new MultiPolygon(Y),setCommonGeometryProperties(te,Y);else if(xe=="GeometryCollection"||xe.startsWith("Multi"))te=new GeometryCollection(Y);else throw new Error("Unknown geometry type found")}else te=new GeometryCollection(Y);return te}function readPoint(ee,O){const Y=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,ee,O),te=readFlatCoordinatesFromNode(ee,O);if(te){const ne=new Point(te,"XYZ");return ne.setProperties(Y,!0),ne}}const FLAT_LINEAR_RINGS_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(ee,O){const Y=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,ee,O),te=pushParseAndPop([null],FLAT_LINEAR_RINGS_PARSERS,ee,O);if(te&&te[0]){const ne=te[0],xe=[ne.length];for(let tt=1,it=te.length;tt<it;++tt)extend$2(ne,te[tt]),xe.push(ne.length);const et=new Polygon(ne,"XYZ",xe);return et.setProperties(Y,!0),et}}const STYLE_PARSERS$1=makeStructureNS(NAMESPACE_URIS$1,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle$1(ee,O){const Y=pushParseAndPop({},STYLE_PARSERS$1,ee,O,this);if(!Y)return null;let te="fillStyle"in Y?Y.fillStyle:DEFAULT_FILL_STYLE;const ne=Y.fill;ne!==void 0&&!ne&&(te=null);let xe;"imageStyle"in Y?Y.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(xe=Y.imageStyle):xe=DEFAULT_IMAGE_STYLE;const et="textStyle"in Y?Y.textStyle:DEFAULT_TEXT_STYLE,tt="strokeStyle"in Y?Y.strokeStyle:DEFAULT_STROKE_STYLE,it=Y.outline;return it!==void 0&&!it?[new Style({geometry:function(st){const ot=st.getGeometry(),rt=ot.getType();if(rt==="GeometryCollection"){const nt=ot;return new GeometryCollection(nt.getGeometriesArrayRecursive().filter(function(at){const ct=at.getType();return ct!=="Polygon"&&ct!=="MultiPolygon"}))}if(rt!=="Polygon"&&rt!=="MultiPolygon")return ot},fill:te,image:xe,stroke:tt,text:et,zIndex:void 0}),new Style({geometry:function(st){const ot=st.getGeometry(),rt=ot.getType();if(rt==="GeometryCollection"){const nt=ot;return new GeometryCollection(nt.getGeometriesArrayRecursive().filter(function(at){const ct=at.getType();return ct==="Polygon"||ct==="MultiPolygon"}))}if(rt==="Polygon"||rt==="MultiPolygon")return ot},fill:te,stroke:null,zIndex:void 0})]:[new Style({fill:te,image:xe,stroke:tt,text:et,zIndex:void 0})]}function setCommonGeometryProperties(ee,O){const Y=O.length,te=new Array(O.length),ne=new Array(O.length),xe=new Array(O.length);let et,tt,it;et=!1,tt=!1,it=!1;for(let st=0;st<Y;++st){const ot=O[st];te[st]=ot.get("extrude"),ne[st]=ot.get("tessellate"),xe[st]=ot.get("altitudeMode"),et=et||te[st]!==void 0,tt=tt||ne[st]!==void 0,it=it||xe[st]}et&&ee.set("extrude",te),tt&&ee.set("tessellate",ne),it&&ee.set("altitudeMode",xe)}const DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{displayName:makeObjectPropertySetter(readString),value:makeObjectPropertySetter(readString)});function dataParser(ee,O){const Y=ee.getAttribute("name");parseNode(DATA_PARSERS,ee,O);const te=O[O.length-1];Y&&te.displayName?te[Y]={value:te.value,displayName:te.displayName,toString:function(){return te.value}}:Y!==null?te[Y]=te.value:te.displayName!==null&&(te[te.displayName]=te.value),delete te.value}const EXTENDED_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(ee,O){parseNode(EXTENDED_DATA_PARSERS,ee,O)}function regionParser(ee,O){parseNode(REGION_PARSERS,ee,O)}const PAIR_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{Style:makeObjectPropertySetter(readStyle$1),key:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL)});function pairDataParser(ee,O){const Y=pushParseAndPop({},PAIR_PARSERS,ee,O,this);if(!Y)return;const te=Y.key;if(te&&te=="normal"){const ne=Y.styleUrl;ne&&(O[O.length-1]=ne);const xe=Y.Style;xe&&(O[O.length-1]=xe)}}function placemarkStyleMapParser(ee,O){const Y=readStyleMapValue.call(this,ee,O);if(!Y)return;const te=O[O.length-1];if(Array.isArray(Y))te.Style=Y;else if(typeof Y=="string")te.styleUrl=Y;else throw new Error("`styleMapValue` has an unknown type")}const SCHEMA_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{SimpleData:simpleDataParser});function schemaDataParser(ee,O){parseNode(SCHEMA_DATA_PARSERS,ee,O)}function simpleDataParser(ee,O){const Y=ee.getAttribute("name");if(Y!==null){const te=readString(ee),ne=O[O.length-1];ne[Y]=te}}const LAT_LON_ALT_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{altitudeMode:makeObjectPropertySetter(readString),minAltitude:makeObjectPropertySetter(readDecimal),maxAltitude:makeObjectPropertySetter(readDecimal),north:makeObjectPropertySetter(readDecimal),south:makeObjectPropertySetter(readDecimal),east:makeObjectPropertySetter(readDecimal),west:makeObjectPropertySetter(readDecimal)});function latLonAltBoxParser(ee,O){const Y=pushParseAndPop({},LAT_LON_ALT_BOX_PARSERS,ee,O);if(!Y)return;const te=O[O.length-1],ne=[parseFloat(Y.west),parseFloat(Y.south),parseFloat(Y.east),parseFloat(Y.north)];te.extent=ne,te.altitudeMode=Y.altitudeMode,te.minAltitude=parseFloat(Y.minAltitude),te.maxAltitude=parseFloat(Y.maxAltitude)}const LOD_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{minLodPixels:makeObjectPropertySetter(readDecimal),maxLodPixels:makeObjectPropertySetter(readDecimal),minFadeExtent:makeObjectPropertySetter(readDecimal),maxFadeExtent:makeObjectPropertySetter(readDecimal)});function lodParser(ee,O){const Y=pushParseAndPop({},LOD_PARSERS,ee,O);if(!Y)return;const te=O[O.length-1];te.minLodPixels=parseFloat(Y.minLodPixels),te.maxLodPixels=parseFloat(Y.maxLodPixels),te.minFadeExtent=parseFloat(Y.minFadeExtent),te.maxFadeExtent=parseFloat(Y.maxFadeExtent)}const INNER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{LinearRing:makeArrayPusher(readFlatLinearRing)});function innerBoundaryIsParser(ee,O){const Y=pushParseAndPop([],INNER_BOUNDARY_IS_PARSERS,ee,O);Y.length>0&&O[O.length-1].push(...Y)}const OUTER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS$1,{LinearRing:makeReplacer(readFlatLinearRing)});function outerBoundaryIsParser(ee,O){const Y=pushParseAndPop(void 0,OUTER_BOUNDARY_IS_PARSERS,ee,O);if(Y){const te=O[O.length-1];te[0]=Y}}function linkParser(ee,O){parseNode(LINK_PARSERS,ee,O)}function whenParser(ee,O){const te=O[O.length-1].whens,ne=getAllTextContent(ee,!1),xe=Date.parse(ne);te.push(isNaN(xe)?0:xe)}function writeColorTextNode(ee,O){const Y=asArray(O),ne=[(Y.length==4?Y[3]:1)*255,Y[2],Y[1],Y[0]];for(let xe=0;xe<4;++xe){const et=Math.floor(ne[xe]).toString(16);ne[xe]=et.length==1?"0"+et:et}writeStringTextNode(ee,ne.join(""))}function writeCoordinatesTextNode(ee,O,Y){const te=Y[Y.length-1],ne=te.layout,xe=te.stride;let et;if(ne=="XY"||ne=="XYM")et=2;else if(ne=="XYZ"||ne=="XYZM")et=3;else throw new Error("Invalid geometry layout");const tt=O.length;let it="";if(tt>0){it+=O[0];for(let st=1;st<et;++st)it+=","+O[st];for(let st=xe;st<tt;st+=xe){it+=" "+O[st];for(let ot=1;ot<et;++ot)it+=","+O[st+ot]}}writeStringTextNode(ee,it)}const EXTENDEDDATA_NODE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{Data:makeChildAppender(writeDataNode),value:makeChildAppender(writeDataNodeValue),displayName:makeChildAppender(writeDataNodeName)});function writeDataNode(ee,O,Y){ee.setAttribute("name",O.name);const te={node:ee},ne=O.value;typeof ne=="object"?(ne!==null&&ne.displayName&&pushSerializeAndPop(te,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[ne.displayName],Y,["displayName"]),ne!==null&&ne.value&&pushSerializeAndPop(te,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[ne.value],Y,["value"])):pushSerializeAndPop(te,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[ne],Y,["value"])}function writeDataNodeName(ee,O){writeStringTextNode(ee,O)}function writeDataNodeValue(ee,O){writeStringTextNode(ee,O)}const DOCUMENT_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{Placemark:makeChildAppender(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(ee,O,Y){const te=O[O.length-1].node;return createElementNS(te.namespaceURI,"Placemark")};function writeDocument(ee,O,Y){pushSerializeAndPop({node:ee},DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,O,Y,void 0,this)}const DATA_NODE_FACTORY=makeSimpleNodeFactory("Data");function writeExtendedData(ee,O,Y){const te={node:ee},ne=O.names,xe=O.values,et=ne.length;for(let tt=0;tt<et;tt++)pushSerializeAndPop(te,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:ne[tt],value:xe[tt]}],Y)}const ICON_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["href"],makeStructureNS(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{href:makeChildAppender(writeStringTextNode)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeChildAppender(writeDecimalTextNode),y:makeChildAppender(writeDecimalTextNode),w:makeChildAppender(writeDecimalTextNode),h:makeChildAppender(writeDecimalTextNode)})),GX_NODE_FACTORY=function(ee,O,Y){return createElementNS(GX_NAMESPACE_URIS[0],"gx:"+Y)};function writeIcon(ee,O,Y){const te={node:ee},ne=Y[Y.length-1].node;let xe=ICON_SEQUENCE[ne.namespaceURI],et=makeSequence(O,xe);pushSerializeAndPop(te,ICON_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,et,Y,xe),xe=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],et=makeSequence(O,xe),pushSerializeAndPop(te,ICON_SERIALIZERS,GX_NODE_FACTORY,et,Y,xe)}const ICON_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["scale","heading","Icon","color","hotSpot"]),ICON_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{Icon:makeChildAppender(writeIcon),color:makeChildAppender(writeColorTextNode),heading:makeChildAppender(writeDecimalTextNode),hotSpot:makeChildAppender(writeVec2),scale:makeChildAppender(writeScaleTextNode)});function writeIconStyle(ee,O,Y){const te={node:ee},ne={},xe=O.getSrc(),et=O.getSize(),tt=O.getImageSize(),it={href:xe};if(et){it.w=et[0],it.h=et[1];const dt=O.getAnchor(),ht=O.getOrigin();if(ht&&tt&&ht[0]!==0&&ht[1]!==et[1]&&(it.x=ht[0],it.y=tt[1]-(ht[1]+et[1])),dt&&(dt[0]!==et[0]/2||dt[1]!==et[1]/2)){const pt={x:dt[0],xunits:"pixels",y:et[1]-dt[1],yunits:"pixels"};ne.hotSpot=pt}}ne.Icon=it;let st=O.getScaleArray()[0],ot=et;if(ot===null&&(ot=DEFAULT_IMAGE_STYLE_SIZE),ot.length==2){const dt=scaleForSize(ot);st=st/dt}st!==1&&(ne.scale=st);const rt=O.getRotation();rt!==0&&(ne.heading=rt);const nt=O.getColor();nt&&(ne.color=nt);const at=Y[Y.length-1].node,ct=ICON_STYLE_SEQUENCE[at.namespaceURI],ut=makeSequence(ne,ct);pushSerializeAndPop(te,ICON_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,ut,Y,ct)}const LABEL_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["color","scale"]),LABEL_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{color:makeChildAppender(writeColorTextNode),scale:makeChildAppender(writeScaleTextNode)});function writeLabelStyle(ee,O,Y){const te={node:ee},ne={},xe=O.getFill();xe&&(ne.color=xe.getColor());const et=O.getScale();et&&et!==1&&(ne.scale=et);const tt=Y[Y.length-1].node,it=LABEL_STYLE_SEQUENCE[tt.namespaceURI],st=makeSequence(ne,it);pushSerializeAndPop(te,LABEL_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,st,Y,it)}const LINE_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["color","width"]),LINE_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{color:makeChildAppender(writeColorTextNode),width:makeChildAppender(writeDecimalTextNode)});function writeLineStyle(ee,O,Y){const te={node:ee},ne={color:O.getColor(),width:Number(O.getWidth())||1},xe=Y[Y.length-1].node,et=LINE_STYLE_SEQUENCE[xe.namespaceURI],tt=makeSequence(ne,et);pushSerializeAndPop(te,LINE_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,tt,Y,et)}const GEOMETRY_TYPE_TO_NODENAME={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(ee,O,Y){if(ee){const te=O[O.length-1].node;return createElementNS(te.namespaceURI,GEOMETRY_TYPE_TO_NODENAME[ee.getType()])}},POINT_NODE_FACTORY=makeSimpleNodeFactory("Point"),LINE_STRING_NODE_FACTORY=makeSimpleNodeFactory("LineString"),LINEAR_RING_NODE_FACTORY=makeSimpleNodeFactory("LinearRing"),POLYGON_NODE_FACTORY=makeSimpleNodeFactory("Polygon"),MULTI_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{LineString:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),GeometryCollection:makeChildAppender(writeMultiGeometry)});function writeMultiGeometry(ee,O,Y){const te={node:ee},ne=O.getType();let xe=[],et;if(ne==="GeometryCollection")O.getGeometriesArrayRecursive().forEach(function(tt){const it=tt.getType();if(it==="MultiPoint")xe=xe.concat(tt.getPoints());else if(it==="MultiLineString")xe=xe.concat(tt.getLineStrings());else if(it==="MultiPolygon")xe=xe.concat(tt.getPolygons());else if(it==="Point"||it==="LineString"||it==="Polygon")xe.push(tt);else throw new Error("Unknown geometry type")}),et=GEOMETRY_NODE_FACTORY;else if(ne==="MultiPoint")xe=O.getPoints(),et=POINT_NODE_FACTORY;else if(ne==="MultiLineString")xe=O.getLineStrings(),et=LINE_STRING_NODE_FACTORY;else if(ne==="MultiPolygon")xe=O.getPolygons(),et=POLYGON_NODE_FACTORY;else throw new Error("Unknown geometry type");pushSerializeAndPop(te,MULTI_GEOMETRY_SERIALIZERS,et,xe,Y)}const BOUNDARY_IS_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{LinearRing:makeChildAppender(writePrimitiveGeometry)});function writeBoundaryIs(ee,O,Y){pushSerializeAndPop({node:ee},BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[O],Y)}const PLACEMARK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{ExtendedData:makeChildAppender(writeExtendedData),MultiGeometry:makeChildAppender(writeMultiGeometry),LineString:makeChildAppender(writePrimitiveGeometry),LinearRing:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),Style:makeChildAppender(writeStyle),address:makeChildAppender(writeStringTextNode),description:makeChildAppender(writeStringTextNode),name:makeChildAppender(writeStringTextNode),open:makeChildAppender(writeBooleanTextNode),phoneNumber:makeChildAppender(writeStringTextNode),styleUrl:makeChildAppender(writeStringTextNode),visibility:makeChildAppender(writeBooleanTextNode)}),PLACEMARK_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=makeSimpleNodeFactory("ExtendedData");function writePlacemark(ee,O,Y){const te={node:ee};O.getId()&&ee.setAttribute("id",O.getId());const ne=O.getProperties(),xe={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};xe[O.getGeometryName()]=1;const et=Object.keys(ne||{}).sort().filter(function(at){return!xe[at]}),tt=O.getStyleFunction();if(tt){const at=tt(O,0);if(at){const ct=Array.isArray(at)?at:[at];let ut=ct;if(O.getGeometry()&&(ut=ct.filter(function(dt){const ht=dt.getGeometryFunction()(O);if(ht){const pt=ht.getType();return pt==="GeometryCollection"?ht.getGeometriesArrayRecursive().filter(function(ft){const mt=ft.getType();return mt==="Point"||mt==="MultiPoint"}).length:pt==="Point"||pt==="MultiPoint"}})),this.writeStyles_){let dt=ct,ht=ct;O.getGeometry()&&(dt=ct.filter(function(pt){const ft=pt.getGeometryFunction()(O);if(ft){const mt=ft.getType();return mt==="GeometryCollection"?ft.getGeometriesArrayRecursive().filter(function(yt){const bt=yt.getType();return bt==="LineString"||bt==="MultiLineString"}).length:mt==="LineString"||mt==="MultiLineString"}}),ht=ct.filter(function(pt){const ft=pt.getGeometryFunction()(O);if(ft){const mt=ft.getType();return mt==="GeometryCollection"?ft.getGeometriesArrayRecursive().filter(function(yt){const bt=yt.getType();return bt==="Polygon"||bt==="MultiPolygon"}).length:mt==="Polygon"||mt==="MultiPolygon"}})),ne.Style={pointStyles:ut,lineStyles:dt,polyStyles:ht}}if(ut.length&&ne.name===void 0){const dt=ut[0].getText();dt&&(ne.name=dt.getText())}}}const it=Y[Y.length-1].node,st=PLACEMARK_SEQUENCE[it.namespaceURI],ot=makeSequence(ne,st);if(pushSerializeAndPop(te,PLACEMARK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,ot,Y,st),et.length>0){const at=makeSequence(ne,et);pushSerializeAndPop(te,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[{names:et,values:at}],Y)}const rt=Y[0];let nt=O.getGeometry();nt&&(nt=transformGeometryWithOptions(nt,!0,rt)),pushSerializeAndPop(te,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[nt],Y)}const PRIMITIVE_GEOMETRY_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{extrude:makeChildAppender(writeBooleanTextNode),tessellate:makeChildAppender(writeBooleanTextNode),altitudeMode:makeChildAppender(writeStringTextNode),coordinates:makeChildAppender(writeCoordinatesTextNode)});function writePrimitiveGeometry(ee,O,Y){const te=O.getFlatCoordinates(),ne={node:ee};ne.layout=O.getLayout(),ne.stride=O.getStride();const xe=O.getProperties();xe.coordinates=te;const et=Y[Y.length-1].node,tt=PRIMITIVE_GEOMETRY_SEQUENCE[et.namespaceURI],it=makeSequence(xe,tt);pushSerializeAndPop(ne,PRIMITIVE_GEOMETRY_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,it,Y,tt)}const POLY_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["color","fill","outline"]),POLYGON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{outerBoundaryIs:makeChildAppender(writeBoundaryIs),innerBoundaryIs:makeChildAppender(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("outerBoundaryIs");function writePolygon(ee,O,Y){const te=O.getLinearRings(),ne=te.shift(),xe={node:ee};pushSerializeAndPop(xe,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,te,Y),pushSerializeAndPop(xe,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[ne],Y)}const POLY_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{color:makeChildAppender(writeColorTextNode),fill:makeChildAppender(writeBooleanTextNode),outline:makeChildAppender(writeBooleanTextNode)});function writePolyStyle(ee,O,Y){const te={node:ee},ne=O.getFill(),xe=O.getStroke(),et={color:ne?ne.getColor():void 0,fill:ne?void 0:!1,outline:xe?void 0:!1},tt=Y[Y.length-1].node,it=POLY_STYLE_SEQUENCE[tt.namespaceURI],st=makeSequence(et,it);pushSerializeAndPop(te,POLY_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,st,Y,it)}function writeScaleTextNode(ee,O){writeDecimalTextNode(ee,Math.round(O*1e6)/1e6)}const STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS$1,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS$1,{IconStyle:makeChildAppender(writeIconStyle),LabelStyle:makeChildAppender(writeLabelStyle),LineStyle:makeChildAppender(writeLineStyle),PolyStyle:makeChildAppender(writePolyStyle)});function writeStyle(ee,O,Y){const te={node:ee},ne={};if(O.pointStyles.length){const it=O.pointStyles[0].getText();it&&(ne.LabelStyle=it);const st=O.pointStyles[0].getImage();st&&typeof st.getSrc=="function"&&(ne.IconStyle=st)}if(O.lineStyles.length){const it=O.lineStyles[0].getStroke();it&&(ne.LineStyle=it)}if(O.polyStyles.length){const it=O.polyStyles[0].getStroke();it&&!ne.LineStyle&&(ne.LineStyle=it),ne.PolyStyle=O.polyStyles[0]}const xe=Y[Y.length-1].node,et=STYLE_SEQUENCE[xe.namespaceURI],tt=makeSequence(ne,et);pushSerializeAndPop(te,STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,tt,Y,et)}function writeVec2(ee,O){ee.setAttribute("x",String(O.x)),ee.setAttribute("y",String(O.y)),ee.setAttribute("xunits",O.xunits),ee.setAttribute("yunits",O.yunits)}const SHIFT_LEFT_32=65536*65536,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),PBF_VARINT=0,PBF_FIXED64=1,PBF_BYTES=2,PBF_FIXED32=5;class Pbf{constructor(O=new Uint8Array(16)){this.buf=ArrayBuffer.isView(O)?O:new Uint8Array(O),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(O,Y,te=this.length){for(;this.pos<te;){const ne=this.readVarint(),xe=ne>>3,et=this.pos;this.type=ne&7,O(xe,Y,this),this.pos===et&&this.skip(ne)}return Y}readMessage(O,Y){return this.readFields(O,Y,this.readVarint()+this.pos)}readFixed32(){const O=this.dataView.getUint32(this.pos,!0);return this.pos+=4,O}readSFixed32(){const O=this.dataView.getInt32(this.pos,!0);return this.pos+=4,O}readFixed64(){const O=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*SHIFT_LEFT_32;return this.pos+=8,O}readSFixed64(){const O=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*SHIFT_LEFT_32;return this.pos+=8,O}readFloat(){const O=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,O}readDouble(){const O=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,O}readVarint(O){const Y=this.buf;let te,ne;return ne=Y[this.pos++],te=ne&127,ne<128||(ne=Y[this.pos++],te|=(ne&127)<<7,ne<128)||(ne=Y[this.pos++],te|=(ne&127)<<14,ne<128)||(ne=Y[this.pos++],te|=(ne&127)<<21,ne<128)?te:(ne=Y[this.pos],te|=(ne&15)<<28,readVarintRemainder(te,O,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const O=this.readVarint();return O%2===1?(O+1)/-2:O/2}readBoolean(){return!!this.readVarint()}readString(){const O=this.readVarint()+this.pos,Y=this.pos;return this.pos=O,O-Y>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?utf8TextDecoder.decode(this.buf.subarray(Y,O)):readUtf8(this.buf,Y,O)}readBytes(){const O=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,O);return this.pos=O,Y}readPackedVarint(O=[],Y){const te=this.readPackedEnd();for(;this.pos<te;)O.push(this.readVarint(Y));return O}readPackedSVarint(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readSVarint());return O}readPackedBoolean(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readBoolean());return O}readPackedFloat(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readFloat());return O}readPackedDouble(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readDouble());return O}readPackedFixed32(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readFixed32());return O}readPackedSFixed32(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readSFixed32());return O}readPackedFixed64(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readFixed64());return O}readPackedSFixed64(O=[]){const Y=this.readPackedEnd();for(;this.pos<Y;)O.push(this.readSFixed64());return O}readPackedEnd(){return this.type===PBF_BYTES?this.readVarint()+this.pos:this.pos+1}skip(O){const Y=O&7;if(Y===PBF_VARINT)for(;this.buf[this.pos++]>127;);else if(Y===PBF_BYTES)this.pos=this.readVarint()+this.pos;else if(Y===PBF_FIXED32)this.pos+=4;else if(Y===PBF_FIXED64)this.pos+=8;else throw new Error(`Unimplemented type: ${Y}`)}writeTag(O,Y){this.writeVarint(O<<3|Y)}realloc(O){let Y=this.length||16;for(;Y<this.pos+O;)Y*=2;if(Y!==this.length){const te=new Uint8Array(Y);te.set(this.buf),this.buf=te,this.dataView=new DataView(te.buffer),this.length=Y}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(O){this.realloc(4),this.dataView.setInt32(this.pos,O,!0),this.pos+=4}writeSFixed32(O){this.realloc(4),this.dataView.setInt32(this.pos,O,!0),this.pos+=4}writeFixed64(O){this.realloc(8),this.dataView.setInt32(this.pos,O&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(O*SHIFT_RIGHT_32),!0),this.pos+=8}writeSFixed64(O){this.realloc(8),this.dataView.setInt32(this.pos,O&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(O*SHIFT_RIGHT_32),!0),this.pos+=8}writeVarint(O){if(O=+O||0,O>268435455||O<0){writeBigVarint(O,this);return}this.realloc(4),this.buf[this.pos++]=O&127|(O>127?128:0),!(O<=127)&&(this.buf[this.pos++]=(O>>>=7)&127|(O>127?128:0),!(O<=127)&&(this.buf[this.pos++]=(O>>>=7)&127|(O>127?128:0),!(O<=127)&&(this.buf[this.pos++]=O>>>7&127)))}writeSVarint(O){this.writeVarint(O<0?-O*2-1:O*2)}writeBoolean(O){this.writeVarint(+O)}writeString(O){O=String(O),this.realloc(O.length*4),this.pos++;const Y=this.pos;this.pos=writeUtf8(this.buf,O,this.pos);const te=this.pos-Y;te>=128&&makeRoomForExtraLength(Y,te,this),this.pos=Y-1,this.writeVarint(te),this.pos+=te}writeFloat(O){this.realloc(4),this.dataView.setFloat32(this.pos,O,!0),this.pos+=4}writeDouble(O){this.realloc(8),this.dataView.setFloat64(this.pos,O,!0),this.pos+=8}writeBytes(O){const Y=O.length;this.writeVarint(Y),this.realloc(Y);for(let te=0;te<Y;te++)this.buf[this.pos++]=O[te]}writeRawMessage(O,Y){this.pos++;const te=this.pos;O(Y,this);const ne=this.pos-te;ne>=128&&makeRoomForExtraLength(te,ne,this),this.pos=te-1,this.writeVarint(ne),this.pos+=ne}writeMessage(O,Y,te){this.writeTag(O,PBF_BYTES),this.writeRawMessage(Y,te)}writePackedVarint(O,Y){Y.length&&this.writeMessage(O,writePackedVarint,Y)}writePackedSVarint(O,Y){Y.length&&this.writeMessage(O,writePackedSVarint,Y)}writePackedBoolean(O,Y){Y.length&&this.writeMessage(O,writePackedBoolean,Y)}writePackedFloat(O,Y){Y.length&&this.writeMessage(O,writePackedFloat,Y)}writePackedDouble(O,Y){Y.length&&this.writeMessage(O,writePackedDouble,Y)}writePackedFixed32(O,Y){Y.length&&this.writeMessage(O,writePackedFixed32,Y)}writePackedSFixed32(O,Y){Y.length&&this.writeMessage(O,writePackedSFixed32,Y)}writePackedFixed64(O,Y){Y.length&&this.writeMessage(O,writePackedFixed64,Y)}writePackedSFixed64(O,Y){Y.length&&this.writeMessage(O,writePackedSFixed64,Y)}writeBytesField(O,Y){this.writeTag(O,PBF_BYTES),this.writeBytes(Y)}writeFixed32Field(O,Y){this.writeTag(O,PBF_FIXED32),this.writeFixed32(Y)}writeSFixed32Field(O,Y){this.writeTag(O,PBF_FIXED32),this.writeSFixed32(Y)}writeFixed64Field(O,Y){this.writeTag(O,PBF_FIXED64),this.writeFixed64(Y)}writeSFixed64Field(O,Y){this.writeTag(O,PBF_FIXED64),this.writeSFixed64(Y)}writeVarintField(O,Y){this.writeTag(O,PBF_VARINT),this.writeVarint(Y)}writeSVarintField(O,Y){this.writeTag(O,PBF_VARINT),this.writeSVarint(Y)}writeStringField(O,Y){this.writeTag(O,PBF_BYTES),this.writeString(Y)}writeFloatField(O,Y){this.writeTag(O,PBF_FIXED32),this.writeFloat(Y)}writeDoubleField(O,Y){this.writeTag(O,PBF_FIXED64),this.writeDouble(Y)}writeBooleanField(O,Y){this.writeVarintField(O,+Y)}}function readVarintRemainder(ee,O,Y){const te=Y.buf;let ne,xe;if(xe=te[Y.pos++],ne=(xe&112)>>4,xe<128||(xe=te[Y.pos++],ne|=(xe&127)<<3,xe<128)||(xe=te[Y.pos++],ne|=(xe&127)<<10,xe<128)||(xe=te[Y.pos++],ne|=(xe&127)<<17,xe<128)||(xe=te[Y.pos++],ne|=(xe&127)<<24,xe<128)||(xe=te[Y.pos++],ne|=(xe&1)<<31,xe<128))return toNum(ee,ne,O);throw new Error("Expected varint not more than 10 bytes")}function toNum(ee,O,Y){return Y?O*4294967296+(ee>>>0):(O>>>0)*4294967296+(ee>>>0)}function writeBigVarint(ee,O){let Y,te;if(ee>=0?(Y=ee%4294967296|0,te=ee/4294967296|0):(Y=~(-ee%4294967296),te=~(-ee/4294967296),Y^4294967295?Y=Y+1|0:(Y=0,te=te+1|0)),ee>=18446744073709552e3||ee<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");O.realloc(10),writeBigVarintLow(Y,te,O),writeBigVarintHigh(te,O)}function writeBigVarintLow(ee,O,Y){Y.buf[Y.pos++]=ee&127|128,ee>>>=7,Y.buf[Y.pos++]=ee&127|128,ee>>>=7,Y.buf[Y.pos++]=ee&127|128,ee>>>=7,Y.buf[Y.pos++]=ee&127|128,ee>>>=7,Y.buf[Y.pos]=ee&127}function writeBigVarintHigh(ee,O){const Y=(ee&7)<<4;O.buf[O.pos++]|=Y|((ee>>>=3)?128:0),ee&&(O.buf[O.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(O.buf[O.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(O.buf[O.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(O.buf[O.pos++]=ee&127|((ee>>>=7)?128:0),ee&&(O.buf[O.pos++]=ee&127)))))}function makeRoomForExtraLength(ee,O,Y){const te=O<=16383?1:O<=2097151?2:O<=268435455?3:Math.floor(Math.log(O)/(Math.LN2*7));Y.realloc(te);for(let ne=Y.pos-1;ne>=ee;ne--)Y.buf[ne+te]=Y.buf[ne]}function writePackedVarint(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeVarint(ee[Y])}function writePackedSVarint(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeSVarint(ee[Y])}function writePackedFloat(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeFloat(ee[Y])}function writePackedDouble(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeDouble(ee[Y])}function writePackedBoolean(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeBoolean(ee[Y])}function writePackedFixed32(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeFixed32(ee[Y])}function writePackedSFixed32(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeSFixed32(ee[Y])}function writePackedFixed64(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeFixed64(ee[Y])}function writePackedSFixed64(ee,O){for(let Y=0;Y<ee.length;Y++)O.writeSFixed64(ee[Y])}function readUtf8(ee,O,Y){let te="",ne=O;for(;ne<Y;){const xe=ee[ne];let et=null,tt=xe>239?4:xe>223?3:xe>191?2:1;if(ne+tt>Y)break;let it,st,ot;tt===1?xe<128&&(et=xe):tt===2?(it=ee[ne+1],(it&192)===128&&(et=(xe&31)<<6|it&63,et<=127&&(et=null))):tt===3?(it=ee[ne+1],st=ee[ne+2],(it&192)===128&&(st&192)===128&&(et=(xe&15)<<12|(it&63)<<6|st&63,(et<=2047||et>=55296&&et<=57343)&&(et=null))):tt===4&&(it=ee[ne+1],st=ee[ne+2],ot=ee[ne+3],(it&192)===128&&(st&192)===128&&(ot&192)===128&&(et=(xe&15)<<18|(it&63)<<12|(st&63)<<6|ot&63,(et<=65535||et>=1114112)&&(et=null))),et===null?(et=65533,tt=1):et>65535&&(et-=65536,te+=String.fromCharCode(et>>>10&1023|55296),et=56320|et&1023),te+=String.fromCharCode(et),ne+=tt}return te}function writeUtf8(ee,O,Y){for(let te=0,ne,xe;te<O.length;te++){if(ne=O.charCodeAt(te),ne>55295&&ne<57344)if(xe)if(ne<56320){ee[Y++]=239,ee[Y++]=191,ee[Y++]=189,xe=ne;continue}else ne=xe-55296<<10|ne-56320|65536,xe=null;else{ne>56319||te+1===O.length?(ee[Y++]=239,ee[Y++]=191,ee[Y++]=189):xe=ne;continue}else xe&&(ee[Y++]=239,ee[Y++]=191,ee[Y++]=189,xe=null);ne<128?ee[Y++]=ne:(ne<2048?ee[Y++]=ne>>6|192:(ne<65536?ee[Y++]=ne>>12|224:(ee[Y++]=ne>>18|240,ee[Y++]=ne>>12&63|128),ee[Y++]=ne>>6&63|128),ee[Y++]=ne&63|128)}return Y}class MVT extends FeatureFormat{constructor(O){super(),O=O||{},this.dataProjection=new Projection({code:"",units:"tile-pixels"}),this.featureClass=O.featureClass?O.featureClass:RenderFeature,this.geometryName_=O.geometryName,this.layerName_=O.layerName?O.layerName:"layer",this.layers_=O.layers?O.layers:null,this.idProperty_=O.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(O,Y,te,ne){O.pos=Y.geometry;const xe=O.readVarint()+O.pos;let et=1,tt=0,it=0,st=0,ot=0,rt=0;for(;O.pos<xe;){if(!tt){const nt=O.readVarint();et=nt&7,tt=nt>>3}if(tt--,et===1||et===2)it+=O.readSVarint(),st+=O.readSVarint(),et===1&&ot>rt&&(ne.push(ot),rt=ot),te.push(it,st),ot+=2;else if(et===7)ot>rt&&(te.push(te[rt],te[rt+1]),ot+=2);else throw new Error("Invalid command found in the PBF")}ot>rt&&(ne.push(ot),rt=ot)}createFeature_(O,Y,te){const ne=Y.type;if(ne===0)return null;let xe;const et=Y.properties;let tt;this.idProperty_?(tt=et[this.idProperty_],delete et[this.idProperty_]):tt=Y.id,et[this.layerName_]=Y.layer.name;const it=[],st=[];this.readRawGeometry_(O,Y,it,st);const ot=getGeometryType(ne,st.length);if(this.featureClass===RenderFeature)xe=new this.featureClass(ot,it,st,2,et,tt),xe.transform(te.dataProjection);else{let rt;if(ot=="Polygon"){const ct=inflateEnds(it,st);rt=ct.length>1?new MultiPolygon(it,"XY",ct):new Polygon(it,"XY",st)}else rt=ot==="Point"?new Point(it,"XY"):ot==="LineString"?new LineString(it,"XY"):ot==="MultiPoint"?new MultiPoint(it,"XY"):ot==="MultiLineString"?new MultiLineString(it,"XY",st):null;const nt=this.featureClass;xe=new nt,this.geometryName_&&xe.setGeometryName(this.geometryName_);const at=transformGeometryWithOptions(rt,!1,te);xe.setGeometry(at),tt!==void 0&&xe.setId(tt),xe.setProperties(et,!0)}return xe}getType(){return"arraybuffer"}readFeatures(O,Y){const te=this.layers_;Y=this.adaptOptions(Y);const ne=get$2(Y.dataProjection);ne.setWorldExtent(Y.extent),Y.dataProjection=ne;const xe=new Pbf(O),et=xe.readFields(layersPBFReader,{}),tt=[];for(const it in et){if(te&&!te.includes(it))continue;const st=et[it],ot=st?[0,0,st.extent,st.extent]:null;ne.setExtent(ot);for(let rt=0,nt=st.length;rt<nt;++rt){const at=readRawFeature(xe,st,rt),ct=this.createFeature_(xe,at,Y);ct!==null&&tt.push(ct)}}return tt}readProjection(O){return this.dataProjection}setLayers(O){this.layers_=O}}function layersPBFReader(ee,O,Y){if(ee===3){const te={keys:[],values:[],features:[]},ne=Y.readVarint()+Y.pos;Y.readFields(layerPBFReader,te,ne),te.length=te.features.length,te.length&&(O[te.name]=te)}}function layerPBFReader(ee,O,Y){if(ee===15)O.version=Y.readVarint();else if(ee===1)O.name=Y.readString();else if(ee===5)O.extent=Y.readVarint();else if(ee===2)O.features.push(Y.pos);else if(ee===3)O.keys.push(Y.readString());else if(ee===4){let te=null;const ne=Y.readVarint()+Y.pos;for(;Y.pos<ne;)ee=Y.readVarint()>>3,te=ee===1?Y.readString():ee===2?Y.readFloat():ee===3?Y.readDouble():ee===4?Y.readVarint64():ee===5?Y.readVarint():ee===6?Y.readSVarint():ee===7?Y.readBoolean():null;O.values.push(te)}}function featurePBFReader(ee,O,Y){if(ee==1)O.id=Y.readVarint();else if(ee==2){const te=Y.readVarint()+Y.pos;for(;Y.pos<te;){const ne=O.layer.keys[Y.readVarint()],xe=O.layer.values[Y.readVarint()];O.properties[ne]=xe}}else ee==3?O.type=Y.readVarint():ee==4&&(O.geometry=Y.pos)}function readRawFeature(ee,O,Y){ee.pos=O.features[Y];const te=ee.readVarint()+ee.pos,ne={layer:O,type:0,properties:{}};return ee.readFields(featurePBFReader,ne,te),ne}function getGeometryType(ee,O){let Y;return ee===1?Y=O===1?"Point":"MultiPoint":ee===2?Y=O===1?"LineString":"MultiLineString":ee===3&&(Y="Polygon"),Y}function flipXY(ee,O,Y,te,ne,xe){ne!==void 0?(ne=ne,xe=xe!==void 0?xe:0):(ne=[],xe=0);let et=O;for(;et<Y;){const tt=ee[et++];ne[xe++]=ee[et++],ne[xe++]=tt;for(let it=2;it<te;++it)ne[xe++]=ee[et++]}return ne.length=xe,ne}class Polyline extends TextFeature{constructor(O){super(),O=O||{},this.dataProjection=get$2("EPSG:4326"),this.factor_=O.factor?O.factor:1e5,this.geometryLayout_=O.geometryLayout?O.geometryLayout:"XY"}readFeatureFromText(O,Y){const te=this.readGeometryFromText(O,Y);return new Feature(te)}readFeaturesFromText(O,Y){return[this.readFeatureFromText(O,Y)]}readGeometryFromText(O,Y){const te=getStrideForLayout(this.geometryLayout_),ne=decodeDeltas(O,te,this.factor_);flipXY(ne,0,ne.length,te,ne);const xe=new LineString(ne,this.geometryLayout_);return transformGeometryWithOptions(xe,!1,this.adaptOptions(Y))}writeFeatureText(O,Y){const te=O.getGeometry();if(te)return this.writeGeometryText(te,Y);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(O,Y){return this.writeFeatureText(O[0],Y)}writeGeometryText(O,Y){O=transformGeometryWithOptions(O,!0,this.adaptOptions(Y));const te=O.getFlatCoordinates(),ne=O.getStride();return flipXY(te,0,te.length,ne,te),encodeDeltas(te,ne,this.factor_)}}function encodeDeltas(ee,O,Y){Y=Y||1e5;const te=new Array(O).fill(0);for(let ne=0,xe=ee.length;ne<xe;)for(let et=0;et<O;++et,++ne){const tt=ee[ne]*Y,it=tt<0?Math.ceil(tt-.5):Math.round(tt),st=it-te[et];te[et]=it,ee[ne]=st}return encodeSignedIntegers(ee)}function decodeDeltas(ee,O,Y){Y=Y||1e5;const te=new Array(O).fill(0),ne=decodeSignedIntegers(ee);for(let xe=0,et=ne.length;xe<et;)for(let tt=0;tt<O;++tt,++xe)te[tt]+=ne[xe],ne[xe]=te[tt]/Y;return ne}function encodeSignedIntegers(ee){for(let O=0,Y=ee.length;O<Y;++O){const te=ee[O];ee[O]=te<0?~(te<<1):te<<1}return encodeUnsignedIntegers(ee)}function decodeSignedIntegers(ee){const O=decodeUnsignedIntegers(ee);for(let Y=0,te=O.length;Y<te;++Y){const ne=O[Y];O[Y]=ne&1?~(ne>>1):ne>>1}return O}function encodeUnsignedIntegers(ee){let O="";for(let Y=0,te=ee.length;Y<te;++Y)O+=encodeUnsignedInteger(ee[Y]);return O}function decodeUnsignedIntegers(ee){const O=[];let Y=0,te=0;for(let ne=0,xe=ee.length;ne<xe;++ne){const et=ee.charCodeAt(ne)-63;Y|=(et&31)<<te,et<32?(O.push(Y),Y=0,te=0):te+=5}return O}function encodeUnsignedInteger(ee){let O,Y="";for(;ee>=32;)O=(32|ee&31)+63,Y+=String.fromCharCode(O),ee>>=5;return O=ee+63,Y+=String.fromCharCode(O),Y}class TopoJSON extends JSONFeature{constructor(O){super(),O=O||{},this.layerName_=O.layerName,this.layers_=O.layers?O.layers:null,this.dataProjection=get$2(O.dataProjection?O.dataProjection:"EPSG:4326")}readFeaturesFromObject(O,Y){if(O.type=="Topology"){const te=O;let ne,xe=null,et=null;te.transform&&(ne=te.transform,xe=ne.scale,et=ne.translate);const tt=te.arcs;ne&&transformArcs(tt,xe,et);const it=[],st=te.objects,ot=this.layerName_;let rt;for(const nt in st)this.layers_&&!this.layers_.includes(nt)||(st[nt].type==="GeometryCollection"?(rt=st[nt],it.push.apply(it,readFeaturesFromGeometryCollection(rt,tt,xe,et,ot,nt,Y))):(rt=st[nt],it.push(readFeatureFromGeometry(rt,tt,xe,et,ot,nt,Y))));return it}return[]}readProjectionFromObject(O){return this.dataProjection}}const GEOMETRY_READERS={Point:readPointGeometry,LineString:readLineStringGeometry,Polygon:readPolygonGeometry,MultiPoint:readMultiPointGeometry,MultiLineString:readMultiLineStringGeometry,MultiPolygon:readMultiPolygonGeometry};function concatenateArcs(ee,O){const Y=[];let te;for(let ne=0,xe=ee.length;ne<xe;++ne)if(te=ee[ne],ne>0&&Y.pop(),te>=0){const et=O[te];for(let tt=0,it=et.length;tt<it;++tt)Y.push(et[tt].slice(0))}else{const et=O[~te];for(let tt=et.length-1;tt>=0;--tt)Y.push(et[tt].slice(0))}return Y}function readPointGeometry(ee,O,Y){const te=ee.coordinates;return O&&Y&&transformVertex(te,O,Y),new Point(te)}function readMultiPointGeometry(ee,O,Y){const te=ee.coordinates;if(O&&Y)for(let ne=0,xe=te.length;ne<xe;++ne)transformVertex(te[ne],O,Y);return new MultiPoint(te)}function readLineStringGeometry(ee,O){const Y=concatenateArcs(ee.arcs,O);return new LineString(Y)}function readMultiLineStringGeometry(ee,O){const Y=[];for(let te=0,ne=ee.arcs.length;te<ne;++te)Y[te]=concatenateArcs(ee.arcs[te],O);return new MultiLineString(Y)}function readPolygonGeometry(ee,O){const Y=[];for(let te=0,ne=ee.arcs.length;te<ne;++te)Y[te]=concatenateArcs(ee.arcs[te],O);return new Polygon(Y)}function readMultiPolygonGeometry(ee,O){const Y=[];for(let te=0,ne=ee.arcs.length;te<ne;++te){const xe=ee.arcs[te],et=[];for(let tt=0,it=xe.length;tt<it;++tt)et[tt]=concatenateArcs(xe[tt],O);Y[te]=et}return new MultiPolygon(Y)}function readFeaturesFromGeometryCollection(ee,O,Y,te,ne,xe,et){const tt=ee.geometries,it=[];for(let st=0,ot=tt.length;st<ot;++st)it[st]=readFeatureFromGeometry(tt[st],O,Y,te,ne,xe,et);return it}function readFeatureFromGeometry(ee,O,Y,te,ne,xe,et){let tt=null;const it=ee.type;if(it){const rt=GEOMETRY_READERS[it];it==="Point"||it==="MultiPoint"?tt=rt(ee,Y,te):tt=rt(ee,O),tt=transformGeometryWithOptions(tt,!1,et)}const st=new Feature({geometry:tt});ee.id!==void 0&&st.setId(ee.id);let ot=ee.properties;return ne&&(ot||(ot={}),ot[ne]=xe),ot&&st.setProperties(ot,!0),st}function transformArcs(ee,O,Y){for(let te=0,ne=ee.length;te<ne;++te)transformArc(ee[te],O,Y)}function transformArc(ee,O,Y){let te=0,ne=0;for(let xe=0,et=ee.length;xe<et;++xe){const tt=ee[xe];te+=tt[0],ne+=tt[1],tt[0]=te,tt[1]=ne,transformVertex(tt,O,Y)}}function transformVertex(ee,O,Y){ee[0]=ee[0]*O[0]+Y[0],ee[1]=ee[1]*O[1]+Y[1]}class GML32 extends GML3{constructor(O){O=O||{},super(O),this.schemaLocation=O.schemaLocation?O.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(O,Y,te){const ne=te[te.length-1];te[te.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},ne),super.writeGeometryElement(O,Y,te)}}GML32.prototype.namespace="http://www.opengis.net/gml/3.2";GML32.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:makeReplacer(GML3.prototype.readFlatPos),posList:makeReplacer(GML3.prototype.readFlatPosList),coordinates:makeReplacer(GML2.prototype.readFlatCoordinates)}};GML32.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:GML3.prototype.interiorParser,exterior:GML3.prototype.exteriorParser}};GML32.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:makeReplacer(GMLBase.prototype.readPoint),MultiPoint:makeReplacer(GMLBase.prototype.readMultiPoint),LineString:makeReplacer(GMLBase.prototype.readLineString),MultiLineString:makeReplacer(GMLBase.prototype.readMultiLineString),LinearRing:makeReplacer(GMLBase.prototype.readLinearRing),Polygon:makeReplacer(GMLBase.prototype.readPolygon),MultiPolygon:makeReplacer(GMLBase.prototype.readMultiPolygon),Surface:makeReplacer(GML32.prototype.readSurface),MultiSurface:makeReplacer(GML3.prototype.readMultiSurface),Curve:makeReplacer(GML32.prototype.readCurve),MultiCurve:makeReplacer(GML3.prototype.readMultiCurve),Envelope:makeReplacer(GML32.prototype.readEnvelope)}};GML32.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:makeArrayPusher(GML3.prototype.curveMemberParser),curveMembers:makeArrayPusher(GML3.prototype.curveMemberParser)}};GML32.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:makeArrayPusher(GML3.prototype.surfaceMemberParser),surfaceMembers:makeArrayPusher(GML3.prototype.surfaceMemberParser)}};GML32.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:makeArrayPusher(GMLBase.prototype.readLineString),Curve:makeArrayPusher(GML3.prototype.readCurve)}};GML32.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:makeArrayPusher(GMLBase.prototype.readPolygon),Surface:makeArrayPusher(GML3.prototype.readSurface)}};GML32.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:makeReplacer(GML3.prototype.readPatch)}};GML32.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:makeReplacer(GML3.prototype.readSegment)}};GML32.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:makeArrayPusher(GML3.prototype.readFlatPosList),upperCorner:makeArrayPusher(GML3.prototype.readFlatPosList)}};GML32.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:makeReplacer(GML3.prototype.readPolygonPatch)}};GML32.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:makeArrayExtender(GML3.prototype.readLineStringSegment)}};GML32.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:makeArrayPusher(GMLBase.prototype.pointMemberParser),pointMembers:makeArrayPusher(GMLBase.prototype.pointMemberParser)}};GML32.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:makeArrayPusher(GMLBase.prototype.lineStringMemberParser),lineStringMembers:makeArrayPusher(GMLBase.prototype.lineStringMemberParser)}};GML32.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:makeArrayPusher(GMLBase.prototype.polygonMemberParser),polygonMembers:makeArrayPusher(GMLBase.prototype.polygonMemberParser)}};GML32.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:makeArrayPusher(GMLBase.prototype.readFlatCoordinatesFromNode)}};GML32.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:makeArrayPusher(GMLBase.prototype.readLineString)}};GML32.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:makeArrayPusher(GMLBase.prototype.readPolygon)}};GML32.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:makeReplacer(GMLBase.prototype.readFlatLinearRing),Ring:makeReplacer(GML32.prototype.readFlatCurveRing)}};GML32.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:makeChildAppender(GML3.prototype.writeRing),interior:makeChildAppender(GML3.prototype.writeRing)}};GML32.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:makeChildAppender(writeStringTextNode),upperCorner:makeChildAppender(writeStringTextNode)}};GML32.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:makeChildAppender(GML3.prototype.writeSurfaceOrPolygonMember),polygonMember:makeChildAppender(GML3.prototype.writeSurfaceOrPolygonMember)}};GML32.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:makeChildAppender(GML3.prototype.writePointMember)}};GML32.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:makeChildAppender(GML3.prototype.writeLineStringOrCurveMember),curveMember:makeChildAppender(GML3.prototype.writeLineStringOrCurveMember)}};GML32.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:makeChildAppender(GML3.prototype.writeCurveOrLineString),MultiCurve:makeChildAppender(GML3.prototype.writeMultiCurveOrLineString),Point:makeChildAppender(GML32.prototype.writePoint),MultiPoint:makeChildAppender(GML3.prototype.writeMultiPoint),LineString:makeChildAppender(GML3.prototype.writeCurveOrLineString),MultiLineString:makeChildAppender(GML3.prototype.writeMultiCurveOrLineString),LinearRing:makeChildAppender(GML3.prototype.writeLinearRing),Polygon:makeChildAppender(GML3.prototype.writeSurfaceOrPolygon),MultiPolygon:makeChildAppender(GML3.prototype.writeMultiSurfaceOrPolygon),Surface:makeChildAppender(GML3.prototype.writeSurfaceOrPolygon),MultiSurface:makeChildAppender(GML3.prototype.writeMultiSurfaceOrPolygon),Envelope:makeChildAppender(GML3.prototype.writeEnvelope)}};class Filter{constructor(O){this.tagName_=O}getTagName(){return this.tagName_}}class LogicalNary extends Filter{constructor(O,Y){super(O),this.conditions=Y,assert(this.conditions.length>=2,"At least 2 conditions are required")}}class And extends LogicalNary{constructor(O){super("And",Array.prototype.slice.call(arguments))}}class Bbox extends Filter{constructor(O,Y,te){if(super("BBOX"),this.geometryName=O,this.extent=Y,Y.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=te}}function and(ee){const O=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(And,O))}function bbox(ee,O,Y){return new Bbox(ee,O,Y)}const FEATURE_COLLECTION_PARSERS={"http://www.opengis.net/gml":{boundedBy:makeObjectPropertySetter(GMLBase.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:makeArrayPusher(GMLBase.prototype.readFeaturesInternal)}},TRANSACTION_SUMMARY_PARSERS={"http://www.opengis.net/wfs":{totalInserted:makeObjectPropertySetter(readPositiveInteger),totalUpdated:makeObjectPropertySetter(readPositiveInteger),totalDeleted:makeObjectPropertySetter(readPositiveInteger)},"http://www.opengis.net/wfs/2.0":{totalInserted:makeObjectPropertySetter(readPositiveInteger),totalUpdated:makeObjectPropertySetter(readPositiveInteger),totalDeleted:makeObjectPropertySetter(readPositiveInteger)}},TRANSACTION_RESPONSE_PARSERS={"http://www.opengis.net/wfs":{TransactionSummary:makeObjectPropertySetter(readTransactionSummary,"transactionSummary"),InsertResults:makeObjectPropertySetter(readInsertResults,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:makeObjectPropertySetter(readTransactionSummary,"transactionSummary"),InsertResults:makeObjectPropertySetter(readInsertResults,"insertIds")}},QUERY_SERIALIZERS={"http://www.opengis.net/wfs":{PropertyName:makeChildAppender(writeStringTextNode)},"http://www.opengis.net/wfs/2.0":{PropertyName:makeChildAppender(writeStringTextNode)}},TRANSACTION_SERIALIZERS={"http://www.opengis.net/wfs":{Insert:makeChildAppender(writeFeature),Update:makeChildAppender(writeUpdate),Delete:makeChildAppender(writeDelete),Property:makeChildAppender(writeProperty),Native:makeChildAppender(writeNative)},"http://www.opengis.net/wfs/2.0":{Insert:makeChildAppender(writeFeature),Update:makeChildAppender(writeUpdate),Delete:makeChildAppender(writeDelete),Property:makeChildAppender(writeProperty),Native:makeChildAppender(writeNative)}},FEATURE_PREFIX="feature",XMLNS="http://www.w3.org/2000/xmlns/",OGCNS={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},WFSNS={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},FESNS={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},SCHEMA_LOCATIONS={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},GML_FORMATS={"2.0.0":GML32,"1.1.0":GML3,"1.0.0":GML2},DEFAULT_VERSION="1.1.0";class WFS extends XMLFeature{constructor(O){super(),O=O||{},this.version_=O.version?O.version:DEFAULT_VERSION,this.featureType_=O.featureType,this.featureNS_=O.featureNS,this.gmlFormat_=O.gmlFormat?O.gmlFormat:new GML_FORMATS[this.version_],this.schemaLocation_=O.schemaLocation?O.schemaLocation:SCHEMA_LOCATIONS[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(O){this.featureType_=O}readFeaturesFromNode(O,Y){const te={node:O};Object.assign(te,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(te,this.getReadOptions(O,Y||{}));const ne=[te];let xe;this.version_==="2.0.0"?xe=FEATURE_COLLECTION_PARSERS:xe=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let et=pushParseAndPop([],xe,O,ne,this.gmlFormat_);return et||(et=[]),et}readTransactionResponse(O){if(O){if(typeof O=="string"){const Y=parse(O);return this.readTransactionResponseFromDocument(Y)}return isDocument(O)?this.readTransactionResponseFromDocument(O):this.readTransactionResponseFromNode(O)}}readFeatureCollectionMetadata(O){if(O){if(typeof O=="string"){const Y=parse(O);return this.readFeatureCollectionMetadataFromDocument(Y)}return isDocument(O)?this.readFeatureCollectionMetadataFromDocument(O):this.readFeatureCollectionMetadataFromNode(O)}}readFeatureCollectionMetadataFromDocument(O){for(let Y=O.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(Y)}readFeatureCollectionMetadataFromNode(O){const Y={},te=readNonNegativeIntegerString(O.getAttribute("numberOfFeatures"));return Y.numberOfFeatures=te,pushParseAndPop(Y,FEATURE_COLLECTION_PARSERS,O,[],this.gmlFormat_)}readTransactionResponseFromDocument(O){for(let Y=O.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(Y)}readTransactionResponseFromNode(O){return pushParseAndPop({},TRANSACTION_RESPONSE_PARSERS,O,[])}writeGetFeature(O){const Y=createElementNS(WFSNS[this.version_],"GetFeature");Y.setAttribute("service","WFS"),Y.setAttribute("version",this.version_),O.handle&&Y.setAttribute("handle",O.handle),O.outputFormat&&Y.setAttribute("outputFormat",O.outputFormat),O.maxFeatures!==void 0&&Y.setAttribute("maxFeatures",String(O.maxFeatures)),O.resultType&&Y.setAttribute("resultType",O.resultType),O.startIndex!==void 0&&Y.setAttribute("startIndex",String(O.startIndex)),O.count!==void 0&&Y.setAttribute("count",String(O.count)),O.viewParams!==void 0&&Y.setAttribute("viewParams",O.viewParams),Y.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",this.schemaLocation_);const te={node:Y};if(Object.assign(te,{version:this.version_,srsName:O.srsName,featureNS:O.featureNS?O.featureNS:this.featureNS_,featurePrefix:O.featurePrefix,propertyNames:O.propertyNames?O.propertyNames:[]}),assert(Array.isArray(O.featureTypes),"`options.featureTypes` must be an Array"),typeof O.featureTypes[0]=="string"){let ne=O.filter;O.bbox&&(assert(O.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),ne=this.combineBboxAndFilter(O.geometryName,O.bbox,O.srsName,ne)),Object.assign(te,{geometryName:O.geometryName,filter:ne}),writeGetFeature(Y,O.featureTypes,[te])}else O.featureTypes.forEach(ne=>{const xe=this.combineBboxAndFilter(ne.geometryName,ne.bbox,O.srsName,O.filter);Object.assign(te,{geometryName:ne.geometryName,filter:xe}),writeGetFeature(Y,[ne.name],[te])});return Y}combineBboxAndFilter(O,Y,te,ne){const xe=bbox(O,Y,te);return ne?and(ne,xe):xe}writeTransaction(O,Y,te,ne){const xe=[],et=ne.version?ne.version:this.version_,tt=createElementNS(WFSNS[et],"Transaction");tt.setAttribute("service","WFS"),tt.setAttribute("version",et);let it;ne&&(it=ne.gmlOptions?ne.gmlOptions:{},ne.handle&&tt.setAttribute("handle",ne.handle)),tt.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATIONS[et]);const st=createTransactionRequest(tt,it,et,ne);return O&&serializeTransactionRequest("Insert",O,xe,st),Y&&serializeTransactionRequest("Update",Y,xe,st),te&&serializeTransactionRequest("Delete",te,xe,st),ne.nativeElements&&serializeTransactionRequest("Native",ne.nativeElements,xe,st),tt}readProjectionFromDocument(O){for(let Y=O.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(Y);return null}readProjectionFromNode(O){if(O.firstElementChild&&O.firstElementChild.firstElementChild){O=O.firstElementChild.firstElementChild;for(let Y=O.firstElementChild;Y;Y=Y.nextElementSibling)if(!(Y.childNodes.length===0||Y.childNodes.length===1&&Y.firstChild.nodeType===3)){const te=[{}];return this.gmlFormat_.readGeometryElement(Y,te),get$2(te.pop().srsName)}}return null}}function createTransactionRequest(ee,O,Y,te){const ne=te.featurePrefix?te.featurePrefix:FEATURE_PREFIX;let xe;return Y==="1.0.0"?xe=2:Y==="1.1.0"?xe=3:Y==="2.0.0"&&(xe=3.2),Object.assign({node:ee},{version:Y,featureNS:te.featureNS,featureType:te.featureType,featurePrefix:ne,gmlVersion:xe,hasZ:te.hasZ,srsName:te.srsName},O)}function serializeTransactionRequest(ee,O,Y,te){pushSerializeAndPop(te,TRANSACTION_SERIALIZERS,makeSimpleNodeFactory(ee),O,Y)}function readTransactionSummary(ee,O){return pushParseAndPop({},TRANSACTION_SUMMARY_PARSERS,ee,O)}const OGC_FID_PARSERS={"http://www.opengis.net/ogc":{FeatureId:makeArrayPusher(function(ee,O){return ee.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:makeArrayPusher(function(ee,O){return ee.getAttribute("fid")})}};function fidParser(ee,O){parseNode(OGC_FID_PARSERS,ee,O)}const INSERT_RESULTS_PARSERS={"http://www.opengis.net/wfs":{Feature:fidParser},"http://www.opengis.net/wfs/2.0":{Feature:fidParser}};function readInsertResults(ee,O){return pushParseAndPop([],INSERT_RESULTS_PARSERS,ee,O)}function writeFeature(ee,O,Y){const te=Y[Y.length-1],ne=te.featureType,xe=te.featureNS,et=te.gmlVersion,tt=createElementNS(xe,ne);ee.appendChild(tt),et===2?GML2.prototype.writeFeatureElement(tt,O,Y):et===3?GML3.prototype.writeFeatureElement(tt,O,Y):GML32.prototype.writeFeatureElement(tt,O,Y)}function writeOgcFidFilter(ee,O,Y){const ne=Y[Y.length-1].version,xe=OGCNS[ne],et=createElementNS(xe,"Filter"),tt=createElementNS(xe,"FeatureId");et.appendChild(tt),tt.setAttribute("fid",O),ee.appendChild(et)}function getTypeName(ee,O){ee=ee||FEATURE_PREFIX;const Y=ee+":";return O.startsWith(Y)?O:Y+O}function writeDelete(ee,O,Y){const te=Y[Y.length-1];assert(O.getId()!==void 0,"Features must have an id set");const ne=te.featureType,xe=te.featurePrefix,et=te.featureNS,tt=getTypeName(xe,ne);ee.setAttribute("typeName",tt),ee.setAttributeNS(XMLNS,"xmlns:"+xe,et);const it=O.getId();it!==void 0&&writeOgcFidFilter(ee,it,Y)}function writeUpdate(ee,O,Y){const te=Y[Y.length-1];assert(O.getId()!==void 0,"Features must have an id set");const ne=te.version,xe=te.featureType,et=te.featurePrefix,tt=te.featureNS,it=getTypeName(et,xe),st=O.getGeometryName();ee.setAttribute("typeName",it),ee.setAttributeNS(XMLNS,"xmlns:"+et,tt);const ot=O.getId();if(ot!==void 0){const rt=O.getKeys(),nt=[];for(let at=0,ct=rt.length;at<ct;at++){const ut=O.get(rt[at]);if(ut!==void 0){let dt=rt[at];ut&&typeof ut.getSimplifiedGeometry=="function"&&(dt=st),nt.push({name:dt,value:ut})}}pushSerializeAndPop({version:ne,gmlVersion:te.gmlVersion,node:ee,hasZ:te.hasZ,srsName:te.srsName},TRANSACTION_SERIALIZERS,makeSimpleNodeFactory("Property"),nt,Y),writeOgcFidFilter(ee,ot,Y)}}function writeProperty(ee,O,Y){const te=Y[Y.length-1],ne=te.version,xe=WFSNS[ne],tt=createElementNS(xe,ne==="2.0.0"?"ValueReference":"Name"),it=te.gmlVersion;if(ee.appendChild(tt),writeStringTextNode(tt,O.name),O.value!==void 0&&O.value!==null){const st=createElementNS(xe,"Value");ee.appendChild(st),O.value&&typeof O.value.getSimplifiedGeometry=="function"?it===2?GML2.prototype.writeGeometryElement(st,O.value,Y):it===3?GML3.prototype.writeGeometryElement(st,O.value,Y):GML32.prototype.writeGeometryElement(st,O.value,Y):writeStringTextNode(st,O.value)}}function writeNative(ee,O,Y){O.vendorId&&ee.setAttribute("vendorId",O.vendorId),O.safeToIgnore!==void 0&&ee.setAttribute("safeToIgnore",String(O.safeToIgnore)),O.value!==void 0&&writeStringTextNode(ee,O.value)}const GETFEATURE_SERIALIZERS={"http://www.opengis.net/wfs":{Query:makeChildAppender(writeQuery)},"http://www.opengis.net/wfs/2.0":{Query:makeChildAppender(writeQuery)},"http://www.opengis.net/ogc":{During:makeChildAppender(writeDuringFilter),And:makeChildAppender(writeLogicalFilter),Or:makeChildAppender(writeLogicalFilter),Not:makeChildAppender(writeNotFilter),BBOX:makeChildAppender(writeBboxFilter),Contains:makeChildAppender(writeSpatialFilter),Intersects:makeChildAppender(writeSpatialFilter),Within:makeChildAppender(writeSpatialFilter),DWithin:makeChildAppender(writeDWithinFilter),PropertyIsEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNotEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsLessThan:makeChildAppender(writeComparisonFilter),PropertyIsLessThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThan:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNull:makeChildAppender(writeIsNullFilter),PropertyIsBetween:makeChildAppender(writeIsBetweenFilter),PropertyIsLike:makeChildAppender(writeIsLikeFilter)},"http://www.opengis.net/fes/2.0":{During:makeChildAppender(writeDuringFilter),And:makeChildAppender(writeLogicalFilter),Or:makeChildAppender(writeLogicalFilter),Not:makeChildAppender(writeNotFilter),BBOX:makeChildAppender(writeBboxFilter),Contains:makeChildAppender(writeSpatialFilter),Disjoint:makeChildAppender(writeSpatialFilter),Intersects:makeChildAppender(writeSpatialFilter),ResourceId:makeChildAppender(writeResourceIdFilter),Within:makeChildAppender(writeSpatialFilter),DWithin:makeChildAppender(writeDWithinFilter),PropertyIsEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNotEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsLessThan:makeChildAppender(writeComparisonFilter),PropertyIsLessThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThan:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNull:makeChildAppender(writeIsNullFilter),PropertyIsBetween:makeChildAppender(writeIsBetweenFilter),PropertyIsLike:makeChildAppender(writeIsLikeFilter)}};function writeQuery(ee,O,Y){const te=Y[Y.length-1],ne=te.version,xe=te.featurePrefix,et=te.featureNS,tt=te.propertyNames,it=te.srsName;let st;xe?st=getTypeName(xe,O):st=O;let ot;ne==="2.0.0"?ot="typeNames":ot="typeName",ee.setAttribute(ot,st),it&&ee.setAttribute("srsName",it),et&&ee.setAttributeNS(XMLNS,"xmlns:"+xe,et);const rt=Object.assign({},te);rt.node=ee,pushSerializeAndPop(rt,QUERY_SERIALIZERS,makeSimpleNodeFactory("PropertyName"),tt,Y);const nt=te.filter;if(nt){const at=createElementNS(getFilterNS(ne),"Filter");ee.appendChild(at),writeFilterCondition(at,nt,Y)}}function writeFilterCondition(ee,O,Y){const te=Y[Y.length-1],ne={node:ee};Object.assign(ne,{context:te}),pushSerializeAndPop(ne,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(O.getTagName()),[O],Y)}function writeBboxFilter(ee,O,Y){const te=Y[Y.length-1],xe=te.context.version;te.srsName=O.srsName;const et=GML_FORMATS[xe];writePropertyName(xe,ee,O.geometryName),et.prototype.writeGeometryElement(ee,O.extent,Y)}function writeResourceIdFilter(ee,O,Y){ee.setAttribute("rid",O.rid)}function writeSpatialFilter(ee,O,Y){const te=Y[Y.length-1],xe=te.context.version;te.srsName=O.srsName;const et=GML_FORMATS[xe];writePropertyName(xe,ee,O.geometryName),et.prototype.writeGeometryElement(ee,O.geometry,Y)}function writeDWithinFilter(ee,O,Y){const xe=Y[Y.length-1].context.version;writeSpatialFilter(ee,O,Y);const et=createElementNS(getFilterNS(xe),"Distance");writeStringTextNode(et,O.distance.toString()),xe==="2.0.0"?et.setAttribute("uom",O.unit):et.setAttribute("units",O.unit),ee.appendChild(et)}function writeDuringFilter(ee,O,Y){const xe=Y[Y.length-1].context.version;writeExpression(FESNS[xe],"ValueReference",ee,O.propertyName);const et=createElementNS(GMLNS,"TimePeriod");ee.appendChild(et);const tt=createElementNS(GMLNS,"begin");et.appendChild(tt),writeTimeInstant(tt,O.begin);const it=createElementNS(GMLNS,"end");et.appendChild(it),writeTimeInstant(it,O.end)}function writeLogicalFilter(ee,O,Y){const ne=Y[Y.length-1].context,xe={node:ee};Object.assign(xe,{context:ne});const et=O.conditions;for(let tt=0,it=et.length;tt<it;++tt){const st=et[tt];pushSerializeAndPop(xe,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(st.getTagName()),[st],Y)}}function writeNotFilter(ee,O,Y){const ne=Y[Y.length-1].context,xe={node:ee};Object.assign(xe,{context:ne});const et=O.condition;pushSerializeAndPop(xe,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(et.getTagName()),[et],Y)}function writeComparisonFilter(ee,O,Y){const xe=Y[Y.length-1].context.version;O.matchCase!==void 0&&ee.setAttribute("matchCase",O.matchCase.toString()),writePropertyName(xe,ee,O.propertyName),writeLiteral(xe,ee,""+O.expression)}function writeIsNullFilter(ee,O,Y){const xe=Y[Y.length-1].context.version;writePropertyName(xe,ee,O.propertyName)}function writeIsBetweenFilter(ee,O,Y){const xe=Y[Y.length-1].context.version,et=getFilterNS(xe);writePropertyName(xe,ee,O.propertyName);const tt=createElementNS(et,"LowerBoundary");ee.appendChild(tt),writeLiteral(xe,tt,""+O.lowerBoundary);const it=createElementNS(et,"UpperBoundary");ee.appendChild(it),writeLiteral(xe,it,""+O.upperBoundary)}function writeIsLikeFilter(ee,O,Y){const xe=Y[Y.length-1].context.version;ee.setAttribute("wildCard",O.wildCard),ee.setAttribute("singleChar",O.singleChar),ee.setAttribute("escapeChar",O.escapeChar),O.matchCase!==void 0&&ee.setAttribute("matchCase",O.matchCase.toString()),writePropertyName(xe,ee,O.propertyName),writeLiteral(xe,ee,""+O.pattern)}function writeExpression(ee,O,Y,te){const ne=createElementNS(ee,O);writeStringTextNode(ne,te),Y.appendChild(ne)}function writeLiteral(ee,O,Y){writeExpression(getFilterNS(ee),"Literal",O,Y)}function writePropertyName(ee,O,Y){ee==="2.0.0"?writeExpression(FESNS[ee],"ValueReference",O,Y):writeExpression(OGCNS[ee],"PropertyName",O,Y)}function writeTimeInstant(ee,O){const Y=createElementNS(GMLNS,"TimeInstant");ee.appendChild(Y);const te=createElementNS(GMLNS,"timePosition");Y.appendChild(te),writeStringTextNode(te,O)}function writeGetFeature(ee,O,Y){const te=Y[Y.length-1],ne=Object.assign({},te);ne.node=ee,pushSerializeAndPop(ne,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory("Query"),O,Y)}function getFilterNS(ee){let O;return ee==="2.0.0"?O=FESNS[ee]:O=OGCNS[ee],O}const WKBGeometryType={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class WkbReader{constructor(O){this.view_=O,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(O){return this.view_.getUint32((this.pos_+=4)-4,O!==void 0?O:this.isLittleEndian_)}readDouble(O){return this.view_.getFloat64((this.pos_+=8)-8,O!==void 0?O:this.isLittleEndian_)}readPoint(){const O=[];return O.push(this.readDouble()),O.push(this.readDouble()),this.hasZ_&&O.push(this.readDouble()),this.hasM_&&O.push(this.readDouble()),O}readLineString(){const O=this.readUint32(),Y=[];for(let te=0;te<O;te++)Y.push(this.readPoint());return Y}readPolygon(){const O=this.readUint32(),Y=[];for(let te=0;te<O;te++)Y.push(this.readLineString());return Y}readWkbHeader(O){const te=this.readUint8()>0,ne=this.readUint32(te),xe=Math.floor((ne&268435455)/1e3),et=!!(ne&2147483648)||xe===1||xe===3,tt=!!(ne&1073741824)||xe===2||xe===3,it=!!(ne&536870912),st=(ne&268435455)%1e3,ot=["XY",et?"Z":"",tt?"M":""].join(""),rt=it?this.readUint32(te):null;if(O!==void 0&&O!==st)throw new Error("Unexpected WKB geometry type "+st);if(this.initialized_){if(this.isLittleEndian_!==te)throw new Error("Inconsistent endian");if(this.layout_!==ot)throw new Error("Inconsistent geometry layout");if(rt&&this.srid_!==rt)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=te,this.hasZ_=et,this.hasM_=tt,this.layout_=ot,this.srid_=rt,this.initialized_=!0;return st}readWkbPayload(O){switch(O){case WKBGeometryType.POINT:return this.readPoint();case WKBGeometryType.LINE_STRING:return this.readLineString();case WKBGeometryType.POLYGON:case WKBGeometryType.TRIANGLE:return this.readPolygon();case WKBGeometryType.MULTI_POINT:return this.readMultiPoint();case WKBGeometryType.MULTI_LINE_STRING:return this.readMultiLineString();case WKBGeometryType.MULTI_POLYGON:case WKBGeometryType.POLYHEDRAL_SURFACE:case WKBGeometryType.TIN:return this.readMultiPolygon();case WKBGeometryType.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+O+" is found")}}readWkbBlock(O){return this.readWkbPayload(this.readWkbHeader(O))}readWkbCollection(O,Y){const te=this.readUint32(),ne=[];for(let xe=0;xe<te;xe++){const et=O.call(this,Y);et&&ne.push(et)}return ne}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,WKBGeometryType.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,WKBGeometryType.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,WKBGeometryType.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const O=this.readWkbHeader(),Y=this.readWkbPayload(O);switch(O){case WKBGeometryType.POINT:return new Point(Y,this.layout_);case WKBGeometryType.LINE_STRING:return new LineString(Y,this.layout_);case WKBGeometryType.POLYGON:case WKBGeometryType.TRIANGLE:return new Polygon(Y,this.layout_);case WKBGeometryType.MULTI_POINT:return new MultiPoint(Y,this.layout_);case WKBGeometryType.MULTI_LINE_STRING:return new MultiLineString(Y,this.layout_);case WKBGeometryType.MULTI_POLYGON:case WKBGeometryType.POLYHEDRAL_SURFACE:case WKBGeometryType.TIN:return new MultiPolygon(Y,this.layout_);case WKBGeometryType.GEOMETRY_COLLECTION:return new GeometryCollection(Y);default:return null}}getSrid(){return this.srid_}}class WkbWriter{constructor(O){O=O||{},this.layout_=O.layout,this.isLittleEndian_=O.littleEndian!==!1,this.isEWKB_=O.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},O.nodata)}writeUint8(O){this.writeQueue_.push([1,O])}writeUint32(O){this.writeQueue_.push([4,O])}writeDouble(O){this.writeQueue_.push([8,O])}writePoint(O,Y){const te=Object.assign.apply(null,Y.split("").map((ne,xe)=>({[ne]:O[xe]})));for(const ne of this.layout_)this.writeDouble(ne in te?te[ne]:this.nodata_[ne])}writeLineString(O,Y){this.writeUint32(O.length);for(let te=0;te<O.length;te++)this.writePoint(O[te],Y)}writePolygon(O,Y){this.writeUint32(O.length);for(let te=0;te<O.length;te++)this.writeLineString(O[te],Y)}writeWkbHeader(O,Y){O%=1e3,this.layout_.includes("Z")&&(O+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(O+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(Y)&&(O|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(O),this.isEWKB_&&Number.isInteger(Y)&&this.writeUint32(Y)}writeMultiPoint(O,Y){this.writeUint32(O.length);for(let te=0;te<O.length;te++)this.writeWkbHeader(1),this.writePoint(O[te],Y)}writeMultiLineString(O,Y){this.writeUint32(O.length);for(let te=0;te<O.length;te++)this.writeWkbHeader(2),this.writeLineString(O[te],Y)}writeMultiPolygon(O,Y){this.writeUint32(O.length);for(let te=0;te<O.length;te++)this.writeWkbHeader(3),this.writePolygon(O[te],Y)}writeGeometryCollection(O){this.writeUint32(O.length);for(let Y=0;Y<O.length;Y++)this.writeGeometry(O[Y])}findMinimumLayout(O,Y="XYZM"){const te=(ne,xe)=>ne===xe?ne:ne==="XYZM"?xe:xe==="XYZM"?ne:"XY";if(O instanceof SimpleGeometry)return te(O.getLayout(),Y);if(O instanceof GeometryCollection){const ne=O.getGeometriesArray();for(let xe=0;xe<ne.length&&Y!=="XY";xe++)Y=this.findMinimumLayout(ne[xe],Y)}return Y}writeGeometry(O,Y){const te={Point:WKBGeometryType.POINT,LineString:WKBGeometryType.LINE_STRING,Polygon:WKBGeometryType.POLYGON,MultiPoint:WKBGeometryType.MULTI_POINT,MultiLineString:WKBGeometryType.MULTI_LINE_STRING,MultiPolygon:WKBGeometryType.MULTI_POLYGON,GeometryCollection:WKBGeometryType.GEOMETRY_COLLECTION},ne=O.getType(),xe=te[ne];if(!xe)throw new Error("GeometryType "+ne+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(O)),this.writeWkbHeader(xe,Y),O instanceof SimpleGeometry?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[ne].call(this,O.getCoordinates(),O.getLayout()):O instanceof GeometryCollection&&this.writeGeometryCollection(O.getGeometriesArray())}getBuffer(){const O=this.writeQueue_.reduce((xe,et)=>xe+et[0],0),Y=new ArrayBuffer(O),te=new DataView(Y);let ne=0;return this.writeQueue_.forEach(xe=>{switch(xe[0]){case 1:te.setUint8(ne,xe[1]);break;case 4:te.setUint32(ne,xe[1],this.isLittleEndian_);break;case 8:te.setFloat64(ne,xe[1],this.isLittleEndian_);break}ne+=xe[0]}),Y}}class WKB extends FeatureFormat{constructor(O){super(),O=O||{},this.splitCollection=!!O.splitCollection,this.viewCache_=null,this.hex_=O.hex!==!1,this.littleEndian_=O.littleEndian!==!1,this.ewkb_=O.ewkb!==!1,this.layout_=O.geometryLayout,this.nodataZ_=O.nodataZ||0,this.nodataM_=O.nodataM||0,this.srid_=O.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(O,Y){return new Feature({geometry:this.readGeometry(O,Y)})}readFeatures(O,Y){let te=[];const ne=this.readGeometry(O,Y);return this.splitCollection&&ne instanceof GeometryCollection?te=ne.getGeometriesArray():te=[ne],te.map(xe=>new Feature({geometry:xe}))}readGeometry(O,Y){const te=getDataView(O);if(!te)return null;const xe=new WkbReader(te).readGeometry();return this.viewCache_=te,Y=this.getReadOptions(O,Y),this.viewCache_=null,transformGeometryWithOptions(xe,!1,Y)}readProjection(O){const Y=this.viewCache_||getDataView(O);if(!Y)return;const te=new WkbReader(Y);return te.readWkbHeader(),te.getSrid()&&get$2("EPSG:"+te.getSrid())||void 0}writeFeature(O,Y){return this.writeGeometry(O.getGeometry(),Y)}writeFeatures(O,Y){return this.writeGeometry(new GeometryCollection(O.map(te=>te.getGeometry())),Y)}writeGeometry(O,Y){Y=this.adaptOptions(Y);const te=new WkbWriter({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let ne=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const et=Y.dataProjection&&get$2(Y.dataProjection);if(et){const tt=et.getCode();tt.startsWith("EPSG:")&&(ne=Number(tt.substring(5)))}}te.writeGeometry(transformGeometryWithOptions(O,!0,Y),ne);const xe=te.getBuffer();return this.hex_?encodeHexString(xe):xe}}function encodeHexString(ee){const O=new Uint8Array(ee);return Array.from(O.values()).map(Y=>(Y<16?"0":"")+Number(Y).toString(16).toUpperCase()).join("")}function decodeHexString(ee){const O=new Uint8Array(ee.length/2);for(let Y=0;Y<ee.length/2;Y++)O[Y]=parseInt(ee.substr(Y*2,2),16);return new DataView(O.buffer)}function getDataView(ee){return typeof ee=="string"?decodeHexString(ee):ArrayBuffer.isView(ee)?ee instanceof DataView?ee:new DataView(ee.buffer,ee.byteOffset,ee.byteLength):ee instanceof ArrayBuffer?new DataView(ee):null}const GeometryConstructor={POINT:Point,LINESTRING:LineString,POLYGON:Polygon,MULTIPOINT:MultiPoint,MULTILINESTRING:MultiLineString,MULTIPOLYGON:MultiPolygon},EMPTY="EMPTY",Z="Z",M="M",ZM="ZM",TokenType={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},wktTypeLookup={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Lexer{constructor(O){this.wkt=O,this.index_=-1}isAlpha_(O){return O>="a"&&O<="z"||O>="A"&&O<="Z"}isNumeric_(O,Y){return Y=Y!==void 0?Y:!1,O>="0"&&O<="9"||O=="."&&!Y}isWhiteSpace_(O){return O==" "||O=="	"||O=="\r"||O==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const O=this.nextChar_(),Y=this.index_;let te=O,ne;if(O=="(")ne=TokenType.LEFT_PAREN;else if(O==",")ne=TokenType.COMMA;else if(O==")")ne=TokenType.RIGHT_PAREN;else if(this.isNumeric_(O)||O=="-")ne=TokenType.NUMBER,te=this.readNumber_();else if(this.isAlpha_(O))ne=TokenType.TEXT,te=this.readText_();else{if(this.isWhiteSpace_(O))return this.nextToken();if(O==="")ne=TokenType.EOF;else throw new Error("Unexpected character: "+O)}return{position:Y,value:te,type:ne}}readNumber_(){let O;const Y=this.index_;let te=!1,ne=!1;do O=="."?te=!0:(O=="e"||O=="E")&&(ne=!0),O=this.nextChar_();while(this.isNumeric_(O,te)||!ne&&(O=="e"||O=="E")||ne&&(O=="-"||O=="+"));return parseFloat(this.wkt.substring(Y,this.index_--))}readText_(){let O;const Y=this.index_;do O=this.nextChar_();while(this.isAlpha_(O));return this.wkt.substring(Y,this.index_--).toUpperCase()}}class Parser{constructor(O){this.lexer_=O,this.token_={position:0,type:TokenType.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(O){return this.token_.type==O}match(O){const Y=this.isTokenType(O);return Y&&this.consume_(),Y}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let O="XY";const Y=this.token_;if(this.isTokenType(TokenType.TEXT)){const te=Y.value;te===Z?O="XYZ":te===M?O="XYM":te===ZM&&(O="XYZM"),O!=="XY"&&this.consume_()}return O}parseGeometryCollectionText_(){if(this.match(TokenType.LEFT_PAREN)){const O=[];do O.push(this.parseGeometry_());while(this.match(TokenType.COMMA));if(this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(TokenType.LEFT_PAREN)){const O=this.parsePoint_();if(this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(TokenType.LEFT_PAREN)){const O=this.parsePointList_();if(this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(TokenType.LEFT_PAREN)){const O=this.parseLineStringTextList_();if(this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(TokenType.LEFT_PAREN)){let O;if(this.token_.type==TokenType.LEFT_PAREN?O=this.parsePointTextList_():O=this.parsePointList_(),this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(TokenType.LEFT_PAREN)){const O=this.parseLineStringTextList_();if(this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(TokenType.LEFT_PAREN)){const O=this.parsePolygonTextList_();if(this.match(TokenType.RIGHT_PAREN))return O}throw new Error(this.formatErrorMessage_())}parsePoint_(){const O=[],Y=this.layout_.length;for(let te=0;te<Y;++te){const ne=this.token_;if(this.match(TokenType.NUMBER))O.push(ne.value);else break}if(O.length==Y)return O;throw new Error(this.formatErrorMessage_())}parsePointList_(){const O=[this.parsePoint_()];for(;this.match(TokenType.COMMA);)O.push(this.parsePoint_());return O}parsePointTextList_(){const O=[this.parsePointText_()];for(;this.match(TokenType.COMMA);)O.push(this.parsePointText_());return O}parseLineStringTextList_(){const O=[this.parseLineStringText_()];for(;this.match(TokenType.COMMA);)O.push(this.parseLineStringText_());return O}parsePolygonTextList_(){const O=[this.parsePolygonText_()];for(;this.match(TokenType.COMMA);)O.push(this.parsePolygonText_());return O}isEmptyGeometry_(){const O=this.isTokenType(TokenType.TEXT)&&this.token_.value==EMPTY;return O&&this.consume_(),O}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const O=this.token_;if(this.match(TokenType.TEXT)){const Y=O.value;this.layout_=this.parseGeometryLayout_();const te=this.isEmptyGeometry_();if(Y=="GEOMETRYCOLLECTION"){if(te)return new GeometryCollection([]);const et=this.parseGeometryCollectionText_();return new GeometryCollection(et)}const ne=GeometryConstructor[Y];if(!ne)throw new Error("Invalid geometry type: "+Y);let xe;if(te)Y=="POINT"?xe=[NaN,NaN]:xe=[];else switch(Y){case"POINT":{xe=this.parsePointText_();break}case"LINESTRING":{xe=this.parseLineStringText_();break}case"POLYGON":{xe=this.parsePolygonText_();break}case"MULTIPOINT":{xe=this.parseMultiPointText_();break}case"MULTILINESTRING":{xe=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{xe=this.parseMultiPolygonText_();break}}return new ne(xe,this.layout_)}throw new Error(this.formatErrorMessage_())}}class WKT extends TextFeature{constructor(O){super(),O=O||{},this.splitCollection_=O.splitCollection!==void 0?O.splitCollection:!1}parse_(O){const Y=new Lexer(O);return new Parser(Y).parse()}readFeatureFromText(O,Y){const te=this.readGeometryFromText(O,Y),ne=new Feature;return ne.setGeometry(te),ne}readFeaturesFromText(O,Y){let te=[];const ne=this.readGeometryFromText(O,Y);this.splitCollection_&&ne.getType()=="GeometryCollection"?te=ne.getGeometriesArray():te=[ne];const xe=[];for(let et=0,tt=te.length;et<tt;++et){const it=new Feature;it.setGeometry(te[et]),xe.push(it)}return xe}readGeometryFromText(O,Y){const te=this.parse_(O);return transformGeometryWithOptions(te,!1,Y)}writeFeatureText(O,Y){const te=O.getGeometry();return te?this.writeGeometryText(te,Y):""}writeFeaturesText(O,Y){if(O.length==1)return this.writeFeatureText(O[0],Y);const te=[];for(let xe=0,et=O.length;xe<et;++xe)te.push(O[xe].getGeometry());const ne=new GeometryCollection(te);return this.writeGeometryText(ne,Y)}writeGeometryText(O,Y){return encode(transformGeometryWithOptions(O,!0,Y))}}function encodePointGeometry(ee){const O=ee.getCoordinates();return O.length===0?"":O.join(" ")}function encodeMultiPointGeometry(ee){const O=[],Y=ee.getPoints();for(let te=0,ne=Y.length;te<ne;++te)O.push("("+encodePointGeometry(Y[te])+")");return O.join(",")}function encodeGeometryCollectionGeometry(ee){const O=[],Y=ee.getGeometries();for(let te=0,ne=Y.length;te<ne;++te)O.push(encode(Y[te]));return O.join(",")}function encodeLineStringGeometry(ee){const O=ee.getCoordinates(),Y=[];for(let te=0,ne=O.length;te<ne;++te)Y.push(O[te].join(" "));return Y.join(",")}function encodeMultiLineStringGeometry(ee){const O=[],Y=ee.getLineStrings();for(let te=0,ne=Y.length;te<ne;++te)O.push("("+encodeLineStringGeometry(Y[te])+")");return O.join(",")}function encodePolygonGeometry(ee){const O=[],Y=ee.getLinearRings();for(let te=0,ne=Y.length;te<ne;++te)O.push("("+encodeLineStringGeometry(Y[te])+")");return O.join(",")}function encodeMultiPolygonGeometry(ee){const O=[],Y=ee.getPolygons();for(let te=0,ne=Y.length;te<ne;++te)O.push("("+encodePolygonGeometry(Y[te])+")");return O.join(",")}function encodeGeometryLayout(ee){const O=ee.getLayout();let Y="";return(O==="XYZ"||O==="XYZM")&&(Y+=Z),(O==="XYM"||O==="XYZM")&&(Y+=M),Y}const GeometryEncoder={Point:encodePointGeometry,LineString:encodeLineStringGeometry,Polygon:encodePolygonGeometry,MultiPoint:encodeMultiPointGeometry,MultiLineString:encodeMultiLineStringGeometry,MultiPolygon:encodeMultiPolygonGeometry,GeometryCollection:encodeGeometryCollectionGeometry};function encode(ee){const O=ee.getType(),Y=GeometryEncoder[O],te=Y(ee);let ne=wktTypeLookup[O];if(typeof ee.getFlatCoordinates=="function"){const xe=encodeGeometryLayout(ee);xe.length>0&&(ne+=" "+xe)}return te.length===0?ne+" "+EMPTY:ne+"("+te+")"}const NAMESPACE_URIS=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function isV13(ee){return compareVersions(ee[0].version,"1.3")>=0}const PARSERS=makeStructureNS(NAMESPACE_URIS,{Service:makeObjectPropertySetter(readService),Capability:makeObjectPropertySetter(readCapability)}),CAPABILITY_PARSERS=makeStructureNS(NAMESPACE_URIS,{Request:makeObjectPropertySetter(readRequest),Exception:makeObjectPropertySetter(readException),Layer:makeObjectPropertySetter(readCapabilityLayer),UserDefinedSymbolization:makeObjectPropertySetter(readUserDefinedSymbolization)});class WMSCapabilities extends XML{constructor(){super(),this.version=void 0}readFromNode(O){this.version=O.getAttribute("version").trim();const Y=pushParseAndPop({version:this.version},PARSERS,O,[]);return Y||null}}const COMMON_SERVICE_PARSERS={Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),KeywordList:makeObjectPropertySetter(readKeywordList),OnlineResource:makeObjectPropertySetter(readHref),ContactInformation:makeObjectPropertySetter(readContactInformation),Fees:makeObjectPropertySetter(readString),AccessConstraints:makeObjectPropertySetter(readString)},SERVICE_PARSERS=makeStructureNS(NAMESPACE_URIS,COMMON_SERVICE_PARSERS),SERVICE_PARSERS_V13=makeStructureNS(NAMESPACE_URIS,{...COMMON_SERVICE_PARSERS,LayerLimit:makeObjectPropertySetter(readPositiveInteger),MaxWidth:makeObjectPropertySetter(readPositiveInteger),MaxHeight:makeObjectPropertySetter(readPositiveInteger)}),CONTACT_INFORMATION_PARSERS=makeStructureNS(NAMESPACE_URIS,{ContactPersonPrimary:makeObjectPropertySetter(readContactPersonPrimary),ContactPosition:makeObjectPropertySetter(readString),ContactAddress:makeObjectPropertySetter(readContactAddress),ContactVoiceTelephone:makeObjectPropertySetter(readString),ContactFacsimileTelephone:makeObjectPropertySetter(readString),ContactElectronicMailAddress:makeObjectPropertySetter(readString)}),CONTACT_PERSON_PARSERS=makeStructureNS(NAMESPACE_URIS,{ContactPerson:makeObjectPropertySetter(readString),ContactOrganization:makeObjectPropertySetter(readString)}),CONTACT_ADDRESS_PARSERS=makeStructureNS(NAMESPACE_URIS,{AddressType:makeObjectPropertySetter(readString),Address:makeObjectPropertySetter(readString),City:makeObjectPropertySetter(readString),StateOrProvince:makeObjectPropertySetter(readString),PostCode:makeObjectPropertySetter(readString),Country:makeObjectPropertySetter(readString)}),EXCEPTION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Format:makeArrayPusher(readString)}),COMMON_LAYER_PARSERS={Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),KeywordList:makeObjectPropertySetter(readKeywordList),BoundingBox:makeObjectPropertyPusher(readBoundingBox),Dimension:makeObjectPropertyPusher(readDimension),Attribution:makeObjectPropertySetter(readAttribution),AuthorityURL:makeObjectPropertyPusher(readAuthorityURL),Identifier:makeObjectPropertyPusher(readString),MetadataURL:makeObjectPropertyPusher(readMetadataURL),DataURL:makeObjectPropertyPusher(readFormatOnlineresource),FeatureListURL:makeObjectPropertyPusher(readFormatOnlineresource),Style:makeObjectPropertyPusher(readStyle),Layer:makeObjectPropertyPusher(readLayer)},LAYER_PARSERS=makeStructureNS(NAMESPACE_URIS,{...COMMON_LAYER_PARSERS,SRS:makeObjectPropertyPusher(readString),Extent:makeObjectPropertySetter(readExtent),ScaleHint:makeObjectPropertyPusher(readScaleHint),LatLonBoundingBox:makeObjectPropertySetter((ee,O)=>readBoundingBox(ee,O,!1)),Layer:makeObjectPropertyPusher(readLayer)}),LAYER_PARSERS_V13=makeStructureNS(NAMESPACE_URIS,{...COMMON_LAYER_PARSERS,CRS:makeObjectPropertyPusher(readString),EX_GeographicBoundingBox:makeObjectPropertySetter(readEXGeographicBoundingBox),MinScaleDenominator:makeObjectPropertySetter(readDecimal),MaxScaleDenominator:makeObjectPropertySetter(readDecimal),Layer:makeObjectPropertyPusher(readLayer)}),ATTRIBUTION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),OnlineResource:makeObjectPropertySetter(readHref),LogoURL:makeObjectPropertySetter(readSizedFormatOnlineresource)}),EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS,{westBoundLongitude:makeObjectPropertySetter(readDecimal),eastBoundLongitude:makeObjectPropertySetter(readDecimal),southBoundLatitude:makeObjectPropertySetter(readDecimal),northBoundLatitude:makeObjectPropertySetter(readDecimal)}),REQUEST_PARSERS=makeStructureNS(NAMESPACE_URIS,{GetCapabilities:makeObjectPropertySetter(readOperationType),GetMap:makeObjectPropertySetter(readOperationType),GetFeatureInfo:makeObjectPropertySetter(readOperationType),DescribeLayer:makeObjectPropertySetter(readOperationType),GetLegendGraphic:makeObjectPropertySetter(readOperationType)}),OPERATIONTYPE_PARSERS=makeStructureNS(NAMESPACE_URIS,{Format:makeObjectPropertyPusher(readString),DCPType:makeObjectPropertyPusher(readDCPType)}),DCPTYPE_PARSERS=makeStructureNS(NAMESPACE_URIS,{HTTP:makeObjectPropertySetter(readHTTP)}),HTTP_PARSERS=makeStructureNS(NAMESPACE_URIS,{Get:makeObjectPropertySetter(readFormatOnlineresource),Post:makeObjectPropertySetter(readFormatOnlineresource)}),STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{Name:makeObjectPropertySetter(readString),Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),LegendURL:makeObjectPropertyPusher(readSizedFormatOnlineresource),StyleSheetURL:makeObjectPropertySetter(readFormatOnlineresource),StyleURL:makeObjectPropertySetter(readFormatOnlineresource)}),FORMAT_ONLINERESOURCE_PARSERS=makeStructureNS(NAMESPACE_URIS,{Format:makeObjectPropertySetter(readString),OnlineResource:makeObjectPropertySetter(readHref)}),KEYWORDLIST_PARSERS=makeStructureNS(NAMESPACE_URIS,{Keyword:makeArrayPusher(readString)});function readAttribution(ee,O){return pushParseAndPop({},ATTRIBUTION_PARSERS,ee,O)}function readUserDefinedSymbolization(ee,O){return{SupportSLD:!!readBooleanString(ee.getAttribute("SupportSLD")),UserLayer:!!readBooleanString(ee.getAttribute("UserLayer")),UserStyle:!!readBooleanString(ee.getAttribute("UserStyle")),RemoteWFS:!!readBooleanString(ee.getAttribute("RemoteWFS")),InlineFeatureData:!!readBooleanString(ee.getAttribute("InlineFeatureData")),RemoteWCS:!!readBooleanString(ee.getAttribute("RemoteWCS"))}}function readBoundingBox(ee,O,Y=!0){const te=[readDecimalString(ee.getAttribute("minx")),readDecimalString(ee.getAttribute("miny")),readDecimalString(ee.getAttribute("maxx")),readDecimalString(ee.getAttribute("maxy"))],ne=[readDecimalString(ee.getAttribute("resx")),readDecimalString(ee.getAttribute("resy"))],xe={extent:te,res:ne};return Y&&(isV13(O)?xe.crs=ee.getAttribute("CRS"):xe.srs=ee.getAttribute("SRS")),xe}function readEXGeographicBoundingBox(ee,O){const Y=pushParseAndPop({},EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS,ee,O);if(!Y)return;const te=Y.westBoundLongitude,ne=Y.southBoundLatitude,xe=Y.eastBoundLongitude,et=Y.northBoundLatitude;if(!(te===void 0||ne===void 0||xe===void 0||et===void 0))return[te,ne,xe,et]}function readCapability(ee,O){return pushParseAndPop({},CAPABILITY_PARSERS,ee,O)}function readService(ee,O){return pushParseAndPop({},isV13(O)?SERVICE_PARSERS_V13:SERVICE_PARSERS,ee,O)}function readContactInformation(ee,O){return pushParseAndPop({},CONTACT_INFORMATION_PARSERS,ee,O)}function readContactPersonPrimary(ee,O){return pushParseAndPop({},CONTACT_PERSON_PARSERS,ee,O)}function readContactAddress(ee,O){return pushParseAndPop({},CONTACT_ADDRESS_PARSERS,ee,O)}function readException(ee,O){return pushParseAndPop([],EXCEPTION_PARSERS,ee,O)}function readCapabilityLayer(ee,O){const Y=pushParseAndPop({},isV13(O)?LAYER_PARSERS_V13:LAYER_PARSERS,ee,O);return Y.Layer===void 0?Object.assign(Y,readLayer(ee,O)):Y}function readLayer(ee,O){const Y=isV13(O),te=O[O.length-1],ne=pushParseAndPop({},Y?LAYER_PARSERS_V13:LAYER_PARSERS,ee,O);if(!ne)return;let xe=readBooleanString(ee.getAttribute("queryable"));xe===void 0&&(xe=te.queryable),ne.queryable=xe!==void 0?xe:!1;let et=readNonNegativeIntegerString(ee.getAttribute("cascaded"));et===void 0&&(et=te.cascaded),ne.cascaded=et;let tt=readBooleanString(ee.getAttribute("opaque"));tt===void 0&&(tt=te.opaque),ne.opaque=tt!==void 0?tt:!1;let it=readBooleanString(ee.getAttribute("noSubsets"));it===void 0&&(it=te.noSubsets),ne.noSubsets=it!==void 0?it:!1;let st=readDecimalString(ee.getAttribute("fixedWidth"));st||(st=te.fixedWidth),ne.fixedWidth=st;let ot=readDecimalString(ee.getAttribute("fixedHeight"));ot||(ot=te.fixedHeight),ne.fixedHeight=ot;const rt=["Style","AuthorityURL"];Y?rt.push("CRS"):rt.push("SRS","Dimension"),rt.forEach(function(at){if(at in te){const ct=ne[at]||[];ne[at]=ct.concat(te[at])}});const nt=["BoundingBox","Attribution"];return Y?nt.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):nt.push("LatLonBoundingBox","ScaleHint","Extent"),nt.forEach(function(at){if(!(at in ne)){const ct=te[at];ne[at]=ct}}),ne}function readDimension(ee,O){const Y={name:ee.getAttribute("name"),units:ee.getAttribute("units"),unitSymbol:ee.getAttribute("unitSymbol")};return isV13(O)&&Object.assign(Y,{default:ee.getAttribute("default"),multipleValues:readBooleanString(ee.getAttribute("multipleValues")),nearestValue:readBooleanString(ee.getAttribute("nearestValue")),current:readBooleanString(ee.getAttribute("current")),values:readString(ee)}),Y}function readExtent(ee,O){return{name:ee.getAttribute("name"),default:ee.getAttribute("default"),nearestValue:readBooleanString(ee.getAttribute("nearestValue"))}}function readScaleHint(ee,O){return{min:readDecimalString(ee.getAttribute("min")),max:readDecimalString(ee.getAttribute("max"))}}function readFormatOnlineresource(ee,O){return pushParseAndPop({},FORMAT_ONLINERESOURCE_PARSERS,ee,O)}function readRequest(ee,O){return pushParseAndPop({},REQUEST_PARSERS,ee,O)}function readDCPType(ee,O){return pushParseAndPop({},DCPTYPE_PARSERS,ee,O)}function readHTTP(ee,O){return pushParseAndPop({},HTTP_PARSERS,ee,O)}function readOperationType(ee,O){return pushParseAndPop({},OPERATIONTYPE_PARSERS,ee,O)}function readSizedFormatOnlineresource(ee,O){const Y=readFormatOnlineresource(ee,O);if(Y){const te=[readNonNegativeIntegerString(ee.getAttribute("width")),readNonNegativeIntegerString(ee.getAttribute("height"))];return Y.size=te,Y}}function readAuthorityURL(ee,O){const Y=readFormatOnlineresource(ee,O);if(Y)return Y.name=ee.getAttribute("name"),Y}function readMetadataURL(ee,O){const Y=readFormatOnlineresource(ee,O);if(Y)return Y.type=ee.getAttribute("type"),Y}function readStyle(ee,O){return pushParseAndPop({},STYLE_PARSERS,ee,O)}function readKeywordList(ee,O){return pushParseAndPop([],KEYWORDLIST_PARSERS,ee,O)}const featureIdentifier="_feature",layerIdentifier="_layer";class WMSGetFeatureInfo extends XMLFeature{constructor(O){super(),O=O||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new GML2,this.layers_=O.layers?O.layers:null}getLayers(){return this.layers_}setLayers(O){this.layers_=O}readFeatures_(O,Y){O.setAttribute("namespaceURI",this.featureNS_);const te=O.localName;let ne=[];if(O.childNodes.length===0)return ne;if(te=="msGMLOutput")for(let xe=0,et=O.childNodes.length;xe<et;xe++){const tt=O.childNodes[xe];if(tt.nodeType!==Node.ELEMENT_NODE)continue;const it=tt,st=Y[0],ot=layerIdentifier,rt=it.localName.replace(ot,"");if(this.layers_&&!this.layers_.includes(rt))continue;const nt=rt+featureIdentifier;st.featureType=nt,st.featureNS=this.featureNS_;const at={};at[nt]=makeArrayPusher(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const ct=makeStructureNS([st.featureNS,null],at);it.setAttribute("namespaceURI",this.featureNS_);const ut=pushParseAndPop([],ct,it,Y,this.gmlFormat_);ut&&extend$2(ne,ut)}if(te=="FeatureCollection"){const xe=pushParseAndPop([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,O,[{}],this.gmlFormat_);xe&&(ne=xe)}return ne}readFeaturesFromNode(O,Y){const te={};return Y&&Object.assign(te,this.getReadOptions(O,Y)),this.readFeatures_(O,[te])}}const format=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON,GML,GPX,GeoJSON,IGC,IIIFInfo,KML,MVT,OWS,Polyline,TopoJSON,WFS,WKB,WKT,WMSCapabilities,WMSGetFeatureInfo,WMTSCapabilities},Symbol.toStringTag,{value:"Module"}));var $version=8,$root={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources={"*":{type:"source"}},source=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer$1={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter={type:"array",value:"*"},filter_operator={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression$1={type:"array",value:"*",minimum:1},light={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},paint_line={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},promoteId={"*":{type:"string"}},v8Spec={$version,$root,sources,source,source_vector,source_raster,source_raster_dem,source_geojson,source_video,source_image,layer:layer$1,layout,layout_background,layout_fill,layout_circle,layout_heatmap,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line,layout_symbol,layout_raster,layout_hillshade,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter,filter_operator,geometry_type,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop,expression:expression$1,light,sky,terrain,projection,paint,paint_fill,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line,paint_circle,paint_heatmap,paint_symbol,paint_raster,paint_hillshade,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background,transition,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId};const refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function deref(ee,O){const Y={};for(const te in ee)te!=="ref"&&(Y[te]=ee[te]);return refProperties.forEach(te=>{te in O&&(Y[te]=O[te])}),Y}function derefLayers(ee){ee=ee.slice();const O=Object.create(null);for(let Y=0;Y<ee.length;Y++)O[ee[Y].id]=ee[Y];for(let Y=0;Y<ee.length;Y++)"ref"in ee[Y]&&(ee[Y]=deref(ee[Y],O[ee[Y].ref]));return ee}class ExpressionParsingError extends Error{constructor(O,Y){super(Y),this.message=Y,this.key=O}}class Scope{constructor(O,Y=[]){this.parent=O,this.bindings={};for(const[te,ne]of Y)this.bindings[te]=ne}concat(O){return new Scope(this,O)}get(O){if(this.bindings[O])return this.bindings[O];if(this.parent)return this.parent.get(O);throw new Error(`${O} not found in scope.`)}has(O){return this.bindings[O]?!0:this.parent?this.parent.has(O):!1}}const NullType={kind:"null"},NumberType={kind:"number"},StringType={kind:"string"},BooleanType={kind:"boolean"},ColorType={kind:"color"},ProjectionDefinitionType={kind:"projectionDefinition"},ObjectType={kind:"object"},ValueType={kind:"value"},ErrorType={kind:"error"},CollatorType={kind:"collator"},FormattedType={kind:"formatted"},PaddingType={kind:"padding"},ColorArrayType={kind:"colorArray"},NumberArrayType={kind:"numberArray"},ResolvedImageType={kind:"resolvedImage"},VariableAnchorOffsetCollectionType={kind:"variableAnchorOffsetCollection"};function array(ee,O){return{kind:"array",itemType:ee,N:O}}function typeToString(ee){if(ee.kind==="array"){const O=typeToString(ee.itemType);return typeof ee.N=="number"?`array<${O}, ${ee.N}>`:ee.itemType.kind==="value"?"array":`array<${O}>`}else return ee.kind}const valueMemberTypes=[NullType,NumberType,StringType,BooleanType,ColorType,ProjectionDefinitionType,FormattedType,ObjectType,array(ValueType),PaddingType,NumberArrayType,ColorArrayType,ResolvedImageType,VariableAnchorOffsetCollectionType];function checkSubtype(ee,O){if(O.kind==="error")return null;if(ee.kind==="array"){if(O.kind==="array"&&(O.N===0&&O.itemType.kind==="value"||!checkSubtype(ee.itemType,O.itemType))&&(typeof ee.N!="number"||ee.N===O.N))return null}else{if(ee.kind===O.kind)return null;if(ee.kind==="value"){for(const Y of valueMemberTypes)if(!checkSubtype(Y,O))return null}}return`Expected ${typeToString(ee)} but found ${typeToString(O)} instead.`}function isValidType(ee,O){return O.some(Y=>Y.kind===ee.kind)}function isValidNativeType(ee,O){return O.some(Y=>Y==="null"?ee===null:Y==="array"?Array.isArray(ee):Y==="object"?ee&&!Array.isArray(ee)&&typeof ee=="object":Y===typeof ee)}function verifyType(ee,O){return ee.kind==="array"&&O.kind==="array"?ee.itemType.kind===O.itemType.kind&&typeof ee.N=="number":ee.kind===O.kind}const Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad$1=Math.PI/180,rad2deg=180/Math.PI;function constrainAngle(ee){return ee=ee%360,ee<0&&(ee+=360),ee}function rgbToLab([ee,O,Y,te]){ee=rgb2xyz(ee),O=rgb2xyz(O),Y=rgb2xyz(Y);let ne,xe;const et=xyz2lab((.2225045*ee+.7168786*O+.0606169*Y)/Yn);ee===O&&O===Y?ne=xe=et:(ne=xyz2lab((.4360747*ee+.3850649*O+.1430804*Y)/Xn),xe=xyz2lab((.0139322*ee+.0971045*O+.7141733*Y)/Zn));const tt=116*et-16;return[tt<0?0:tt,500*(ne-et),200*(et-xe),te]}function rgb2xyz(ee){return ee<=.04045?ee/12.92:Math.pow((ee+.055)/1.055,2.4)}function xyz2lab(ee){return ee>t3?Math.pow(ee,1/3):ee/t2+t0}function labToRgb([ee,O,Y,te]){let ne=(ee+16)/116,xe=isNaN(O)?ne:ne+O/500,et=isNaN(Y)?ne:ne-Y/200;return ne=Yn*lab2xyz(ne),xe=Xn*lab2xyz(xe),et=Zn*lab2xyz(et),[xyz2rgb(3.1338561*xe-1.6168667*ne-.4906146*et),xyz2rgb(-.9787684*xe+1.9161415*ne+.033454*et),xyz2rgb(.0719453*xe-.2289914*ne+1.4052427*et),te]}function xyz2rgb(ee){return ee=ee<=.00304?12.92*ee:1.055*Math.pow(ee,1/2.4)-.055,ee<0?0:ee>1?1:ee}function lab2xyz(ee){return ee>t1?ee*ee*ee:t2*(ee-t0)}function rgbToHcl(ee){const[O,Y,te,ne]=rgbToLab(ee),xe=Math.sqrt(Y*Y+te*te);return[Math.round(xe*1e4)?constrainAngle(Math.atan2(te,Y)*rad2deg):NaN,xe,O,ne]}function hclToRgb([ee,O,Y,te]){return ee=isNaN(ee)?0:ee*deg2rad$1,labToRgb([Y,Math.cos(ee)*O,Math.sin(ee)*O,te])}function hslToRgb([ee,O,Y,te]){ee=constrainAngle(ee),O/=100,Y/=100;function ne(xe){const et=(xe+ee/30)%12,tt=O*Math.min(Y,1-Y);return Y-tt*Math.max(-1,Math.min(et-3,9-et,1))}return[ne(0),ne(8),ne(4),te]}const hasOwnProperty=Object.hasOwn||function ee(O,Y){return Object.prototype.hasOwnProperty.call(O,Y)};function getOwn(ee,O){return hasOwnProperty(ee,O)?ee[O]:void 0}function parseCssColor(ee){if(ee=ee.toLowerCase().trim(),ee==="transparent")return[0,0,0,0];const O=getOwn(namedColors,ee);if(O){const[ne,xe,et]=O;return[ne/255,xe/255,et/255,1]}if(ee.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(ee)){const xe=ee.length<6?1:2;let et=1;return[parseHex(ee.slice(et,et+=xe)),parseHex(ee.slice(et,et+=xe)),parseHex(ee.slice(et,et+=xe)),parseHex(ee.slice(et,et+xe)||"ff")]}if(ee.startsWith("rgb")){const ne=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,xe=ee.match(ne);if(xe){const[et,tt,it,st,ot,rt,nt,at,ct,ut,dt,ht]=xe,pt=[st||" ",nt||" ",ut].join("");if(pt==="  "||pt==="  /"||pt===",,"||pt===",,,"){const ft=[it,rt,ct].join(""),mt=ft==="%%%"?100:ft===""?255:0;if(mt){const yt=[clamp(+tt/mt,0,1),clamp(+ot/mt,0,1),clamp(+at/mt,0,1),dt?parseAlpha(+dt,ht):1];if(validateNumbers(yt))return yt}}return}}const Y=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,te=ee.match(Y);if(te){const[ne,xe,et,tt,it,st,ot,rt,nt]=te,at=[et||" ",it||" ",ot].join("");if(at==="  "||at==="  /"||at===",,"||at===",,,"){const ct=[+xe,clamp(+tt,0,100),clamp(+st,0,100),rt?parseAlpha(+rt,nt):1];if(validateNumbers(ct))return hslToRgb(ct)}}}function parseHex(ee){return parseInt(ee.padEnd(2,ee),16)/255}function parseAlpha(ee,O){return clamp(O?ee/100:ee,0,1)}function clamp(ee,O,Y){return Math.min(Math.max(O,ee),Y)}function validateNumbers(ee){return!ee.some(Number.isNaN)}const namedColors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function interpolateNumber(ee,O,Y){return ee+Y*(O-ee)}function interpolateArray(ee,O,Y){return ee.map((te,ne)=>interpolateNumber(te,O[ne],Y))}class Color{constructor(O,Y,te,ne=1,xe=!0){this.r=O,this.g=Y,this.b=te,this.a=ne,xe||(this.r*=ne,this.g*=ne,this.b*=ne,ne||this.overwriteGetter("rgb",[O,Y,te,ne]))}static parse(O){if(O instanceof Color)return O;if(typeof O!="string")return;const Y=parseCssColor(O);if(Y)return new Color(...Y,!1)}get rgb(){const{r:O,g:Y,b:te,a:ne}=this,xe=ne||1/0;return this.overwriteGetter("rgb",[O/xe,Y/xe,te/xe,ne])}get hcl(){return this.overwriteGetter("hcl",rgbToHcl(this.rgb))}get lab(){return this.overwriteGetter("lab",rgbToLab(this.rgb))}overwriteGetter(O,Y){return Object.defineProperty(this,O,{value:Y}),Y}toString(){const[O,Y,te,ne]=this.rgb;return`rgba(${[O,Y,te].map(xe=>Math.round(xe*255)).join(",")},${ne})`}static interpolate(O,Y,te,ne="rgb"){switch(ne){case"rgb":{const[xe,et,tt,it]=interpolateArray(O.rgb,Y.rgb,te);return new Color(xe,et,tt,it,!1)}case"hcl":{const[xe,et,tt,it]=O.hcl,[st,ot,rt,nt]=Y.hcl;let at,ct;if(!isNaN(xe)&&!isNaN(st)){let ft=st-xe;st>xe&&ft>180?ft-=360:st<xe&&xe-st>180&&(ft+=360),at=xe+te*ft}else isNaN(xe)?isNaN(st)?at=NaN:(at=st,(tt===1||tt===0)&&(ct=ot)):(at=xe,(rt===1||rt===0)&&(ct=et));const[ut,dt,ht,pt]=hclToRgb([at,ct??interpolateNumber(et,ot,te),interpolateNumber(tt,rt,te),interpolateNumber(it,nt,te)]);return new Color(ut,dt,ht,pt,!1)}case"lab":{const[xe,et,tt,it]=labToRgb(interpolateArray(O.lab,Y.lab,te));return new Color(xe,et,tt,it,!1)}}}}Color.black=new Color(0,0,0,1);Color.white=new Color(1,1,1,1);Color.transparent=new Color(0,0,0,0);Color.red=new Color(1,0,0,1);class Collator{constructor(O,Y,te){O?this.sensitivity=Y?"variant":"case":this.sensitivity=Y?"accent":"base",this.locale=te,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(O,Y){return this.collator.compare(O,Y)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const VERTICAL_ALIGN_OPTIONS=["bottom","center","top"];class FormattedSection{constructor(O,Y,te,ne,xe,et){this.text=O,this.image=Y,this.scale=te,this.fontStack=ne,this.textColor=xe,this.verticalAlign=et}}class Formatted{constructor(O){this.sections=O}static fromString(O){return new Formatted([new FormattedSection(O,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(O=>O.text.length!==0||O.image&&O.image.name.length!==0)}static factory(O){return O instanceof Formatted?O:Formatted.fromString(O)}toString(){return this.sections.length===0?"":this.sections.map(O=>O.text).join("")}}class Padding{constructor(O){this.values=O.slice()}static parse(O){if(O instanceof Padding)return O;if(typeof O=="number")return new Padding([O,O,O,O]);if(Array.isArray(O)&&!(O.length<1||O.length>4)){for(const Y of O)if(typeof Y!="number")return;switch(O.length){case 1:O=[O[0],O[0],O[0],O[0]];break;case 2:O=[O[0],O[1],O[0],O[1]];break;case 3:O=[O[0],O[1],O[2],O[1]];break}return new Padding(O)}}toString(){return JSON.stringify(this.values)}static interpolate(O,Y,te){return new Padding(interpolateArray(O.values,Y.values,te))}}class NumberArray{constructor(O){this.values=O.slice()}static parse(O){if(O instanceof NumberArray)return O;if(typeof O=="number")return new NumberArray([O]);if(Array.isArray(O)){for(const Y of O)if(typeof Y!="number")return;return new NumberArray(O)}}toString(){return JSON.stringify(this.values)}static interpolate(O,Y,te){return new NumberArray(interpolateArray(O.values,Y.values,te))}}class ColorArray{constructor(O){this.values=O.slice()}static parse(O){if(O instanceof ColorArray)return O;if(typeof O=="string"){const te=Color.parse(O);return te?new ColorArray([te]):void 0}if(!Array.isArray(O))return;const Y=[];for(const te of O){if(typeof te!="string")return;const ne=Color.parse(te);if(!ne)return;Y.push(ne)}return new ColorArray(Y)}toString(){return JSON.stringify(this.values)}static interpolate(O,Y,te,ne="rgb"){const xe=[];if(O.values.length!=Y.values.length)throw new Error(`colorArray: Arrays have mismatched length (${O.values.length} vs. ${Y.values.length}), cannot interpolate.`);for(let et=0;et<O.values.length;et++)xe.push(Color.interpolate(O.values[et],Y.values[et],te,ne));return new ColorArray(xe)}}class RuntimeError extends Error{constructor(O){super(O),this.name="RuntimeError"}toJSON(){return this.message}}const anchors=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class VariableAnchorOffsetCollection{constructor(O){this.values=O.slice()}static parse(O){if(O instanceof VariableAnchorOffsetCollection)return O;if(!(!Array.isArray(O)||O.length<1||O.length%2!==0)){for(let Y=0;Y<O.length;Y+=2){const te=O[Y],ne=O[Y+1];if(typeof te!="string"||!anchors.has(te)||!Array.isArray(ne)||ne.length!==2||typeof ne[0]!="number"||typeof ne[1]!="number")return}return new VariableAnchorOffsetCollection(O)}}toString(){return JSON.stringify(this.values)}static interpolate(O,Y,te){const ne=O.values,xe=Y.values;if(ne.length!==xe.length)throw new RuntimeError(`Cannot interpolate values of different length. from: ${O.toString()}, to: ${Y.toString()}`);const et=[];for(let tt=0;tt<ne.length;tt+=2){if(ne[tt]!==xe[tt])throw new RuntimeError(`Cannot interpolate values containing mismatched anchors. from[${tt}]: ${ne[tt]}, to[${tt}]: ${xe[tt]}`);et.push(ne[tt]);const[it,st]=ne[tt+1],[ot,rt]=xe[tt+1];et.push([interpolateNumber(it,ot,te),interpolateNumber(st,rt,te)])}return new VariableAnchorOffsetCollection(et)}}class ResolvedImage{constructor(O){this.name=O.name,this.available=O.available}toString(){return this.name}static fromString(O){return O?new ResolvedImage({name:O,available:!1}):null}}class ProjectionDefinition{constructor(O,Y,te){this.from=O,this.to=Y,this.transition=te}static interpolate(O,Y,te){return new ProjectionDefinition(O,Y,te)}static parse(O){if(O instanceof ProjectionDefinition)return O;if(Array.isArray(O)&&O.length===3&&typeof O[0]=="string"&&typeof O[1]=="string"&&typeof O[2]=="number")return new ProjectionDefinition(O[0],O[1],O[2]);if(typeof O=="object"&&typeof O.from=="string"&&typeof O.to=="string"&&typeof O.transition=="number")return new ProjectionDefinition(O.from,O.to,O.transition);if(typeof O=="string")return new ProjectionDefinition(O,O,1)}}function validateRGBA(ee,O,Y,te){return typeof ee=="number"&&ee>=0&&ee<=255&&typeof O=="number"&&O>=0&&O<=255&&typeof Y=="number"&&Y>=0&&Y<=255?typeof te>"u"||typeof te=="number"&&te>=0&&te<=1?null:`Invalid rgba value [${[ee,O,Y,te].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof te=="number"?[ee,O,Y,te]:[ee,O,Y]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function isValue(ee){if(ee===null||typeof ee=="string"||typeof ee=="boolean"||typeof ee=="number"||ee instanceof ProjectionDefinition||ee instanceof Color||ee instanceof Collator||ee instanceof Formatted||ee instanceof Padding||ee instanceof NumberArray||ee instanceof ColorArray||ee instanceof VariableAnchorOffsetCollection||ee instanceof ResolvedImage)return!0;if(Array.isArray(ee)){for(const O of ee)if(!isValue(O))return!1;return!0}else if(typeof ee=="object"){for(const O in ee)if(!isValue(ee[O]))return!1;return!0}else return!1}function typeOf(ee){if(ee===null)return NullType;if(typeof ee=="string")return StringType;if(typeof ee=="boolean")return BooleanType;if(typeof ee=="number")return NumberType;if(ee instanceof Color)return ColorType;if(ee instanceof ProjectionDefinition)return ProjectionDefinitionType;if(ee instanceof Collator)return CollatorType;if(ee instanceof Formatted)return FormattedType;if(ee instanceof Padding)return PaddingType;if(ee instanceof NumberArray)return NumberArrayType;if(ee instanceof ColorArray)return ColorArrayType;if(ee instanceof VariableAnchorOffsetCollection)return VariableAnchorOffsetCollectionType;if(ee instanceof ResolvedImage)return ResolvedImageType;if(Array.isArray(ee)){const O=ee.length;let Y;for(const te of ee){const ne=typeOf(te);if(!Y)Y=ne;else{if(Y===ne)continue;Y=ValueType;break}}return array(Y||ValueType,O)}else return ObjectType}function valueToString(ee){const O=typeof ee;return ee===null?"":O==="string"||O==="number"||O==="boolean"?String(ee):ee instanceof Color||ee instanceof ProjectionDefinition||ee instanceof Formatted||ee instanceof Padding||ee instanceof NumberArray||ee instanceof ColorArray||ee instanceof VariableAnchorOffsetCollection||ee instanceof ResolvedImage?ee.toString():JSON.stringify(ee)}class Literal{constructor(O,Y){this.type=O,this.value=Y}static parse(O,Y){if(O.length!==2)return Y.error(`'literal' expression requires exactly one argument, but found ${O.length-1} instead.`);if(!isValue(O[1]))return Y.error("invalid value");const te=O[1];let ne=typeOf(te);const xe=Y.expectedType;return ne.kind==="array"&&ne.N===0&&xe&&xe.kind==="array"&&(typeof xe.N!="number"||xe.N===0)&&(ne=xe),new Literal(ne,te)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const types$1={string:StringType,number:NumberType,boolean:BooleanType,object:ObjectType};class Assertion{constructor(O,Y){this.type=O,this.args=Y}static parse(O,Y){if(O.length<2)return Y.error("Expected at least one argument.");let te=1,ne;const xe=O[0];if(xe==="array"){let tt;if(O.length>2){const st=O[1];if(typeof st!="string"||!(st in types$1)||st==="object")return Y.error('The item type argument of "array" must be one of string, number, boolean',1);tt=types$1[st],te++}else tt=ValueType;let it;if(O.length>3){if(O[2]!==null&&(typeof O[2]!="number"||O[2]<0||O[2]!==Math.floor(O[2])))return Y.error('The length argument to "array" must be a positive integer literal',2);it=O[2],te++}ne=array(tt,it)}else{if(!types$1[xe])throw new Error(`Types doesn't contain name = ${xe}`);ne=types$1[xe]}const et=[];for(;te<O.length;te++){const tt=Y.parse(O[te],te,ValueType);if(!tt)return null;et.push(tt)}return new Assertion(ne,et)}evaluate(O){for(let Y=0;Y<this.args.length;Y++){const te=this.args[Y].evaluate(O);if(checkSubtype(this.type,typeOf(te))){if(Y===this.args.length-1)throw new RuntimeError(`Expected value to be of type ${typeToString(this.type)}, but found ${typeToString(typeOf(te))} instead.`)}else return te}throw new Error}eachChild(O){this.args.forEach(O)}outputDefined(){return this.args.every(O=>O.outputDefined())}}const types$2={"to-boolean":BooleanType,"to-color":ColorType,"to-number":NumberType,"to-string":StringType};class Coercion{constructor(O,Y){this.type=O,this.args=Y}static parse(O,Y){if(O.length<2)return Y.error("Expected at least one argument.");const te=O[0];if(!types$2[te])throw new Error(`Can't parse ${te} as it is not part of the known types`);if((te==="to-boolean"||te==="to-string")&&O.length!==2)return Y.error("Expected one argument.");const ne=types$2[te],xe=[];for(let et=1;et<O.length;et++){const tt=Y.parse(O[et],et,ValueType);if(!tt)return null;xe.push(tt)}return new Coercion(ne,xe)}evaluate(O){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(O);case"color":{let Y,te;for(const ne of this.args){if(Y=ne.evaluate(O),te=null,Y instanceof Color)return Y;if(typeof Y=="string"){const xe=O.parseColor(Y);if(xe)return xe}else if(Array.isArray(Y)&&(Y.length<3||Y.length>4?te=`Invalid rgba value ${JSON.stringify(Y)}: expected an array containing either three or four numeric values.`:te=validateRGBA(Y[0],Y[1],Y[2],Y[3]),!te))return new Color(Y[0]/255,Y[1]/255,Y[2]/255,Y[3])}throw new RuntimeError(te||`Could not parse color from value '${typeof Y=="string"?Y:JSON.stringify(Y)}'`)}case"padding":{let Y;for(const te of this.args){Y=te.evaluate(O);const ne=Padding.parse(Y);if(ne)return ne}throw new RuntimeError(`Could not parse padding from value '${typeof Y=="string"?Y:JSON.stringify(Y)}'`)}case"numberArray":{let Y;for(const te of this.args){Y=te.evaluate(O);const ne=NumberArray.parse(Y);if(ne)return ne}throw new RuntimeError(`Could not parse numberArray from value '${typeof Y=="string"?Y:JSON.stringify(Y)}'`)}case"colorArray":{let Y;for(const te of this.args){Y=te.evaluate(O);const ne=ColorArray.parse(Y);if(ne)return ne}throw new RuntimeError(`Could not parse colorArray from value '${typeof Y=="string"?Y:JSON.stringify(Y)}'`)}case"variableAnchorOffsetCollection":{let Y;for(const te of this.args){Y=te.evaluate(O);const ne=VariableAnchorOffsetCollection.parse(Y);if(ne)return ne}throw new RuntimeError(`Could not parse variableAnchorOffsetCollection from value '${typeof Y=="string"?Y:JSON.stringify(Y)}'`)}case"number":{let Y=null;for(const te of this.args){if(Y=te.evaluate(O),Y===null)return 0;const ne=Number(Y);if(!isNaN(ne))return ne}throw new RuntimeError(`Could not convert ${JSON.stringify(Y)} to number.`)}case"formatted":return Formatted.fromString(valueToString(this.args[0].evaluate(O)));case"resolvedImage":return ResolvedImage.fromString(valueToString(this.args[0].evaluate(O)));case"projectionDefinition":return this.args[0].evaluate(O);default:return valueToString(this.args[0].evaluate(O))}}eachChild(O){this.args.forEach(O)}outputDefined(){return this.args.every(O=>O.outputDefined())}}const geometryTypes=["Unknown","Point","LineString","Polygon"];class EvaluationContext{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?geometryTypes[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(O){let Y=this._parseColorCache.get(O);return Y||(Y=Color.parse(O),this._parseColorCache.set(O,Y)),Y}}class ParsingContext{constructor(O,Y,te=[],ne,xe=new Scope,et=[]){this.registry=O,this.path=te,this.key=te.map(tt=>`[${tt}]`).join(""),this.scope=xe,this.errors=et,this.expectedType=ne,this._isConstant=Y}parse(O,Y,te,ne,xe={}){return Y?this.concat(Y,te,ne)._parse(O,xe):this._parse(O,xe)}_parse(O,Y){(O===null||typeof O=="string"||typeof O=="boolean"||typeof O=="number")&&(O=["literal",O]);function te(ne,xe,et){return et==="assert"?new Assertion(xe,[ne]):et==="coerce"?new Coercion(xe,[ne]):ne}if(Array.isArray(O)){if(O.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ne=O[0];if(typeof ne!="string")return this.error(`Expression name must be a string, but found ${typeof ne} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const xe=this.registry[ne];if(xe){let et=xe.parse(O,this);if(!et)return null;if(this.expectedType){const tt=this.expectedType,it=et.type;if((tt.kind==="string"||tt.kind==="number"||tt.kind==="boolean"||tt.kind==="object"||tt.kind==="array")&&it.kind==="value")et=te(et,tt,Y.typeAnnotation||"assert");else if(tt.kind==="projectionDefinition"&&["string","array"].includes(it.kind)||["color","formatted","resolvedImage"].includes(tt.kind)&&["value","string"].includes(it.kind)||["padding","numberArray"].includes(tt.kind)&&["value","number","array"].includes(it.kind)||tt.kind==="colorArray"&&["value","string","array"].includes(it.kind)||tt.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(it.kind))et=te(et,tt,Y.typeAnnotation||"coerce");else if(this.checkSubtype(tt,it))return null}if(!(et instanceof Literal)&&et.type.kind!=="resolvedImage"&&this._isConstant(et)){const tt=new EvaluationContext;try{et=new Literal(et.type,et.evaluate(tt))}catch(it){return this.error(it.message),null}}return et}return this.error(`Unknown expression "${ne}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof O>"u"?this.error("'undefined' value invalid. Use null instead."):typeof O=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof O} instead.`)}concat(O,Y,te){const ne=typeof O=="number"?this.path.concat(O):this.path,xe=te?this.scope.concat(te):this.scope;return new ParsingContext(this.registry,this._isConstant,ne,Y||null,xe,this.errors)}error(O,...Y){const te=`${this.key}${Y.map(ne=>`[${ne}]`).join("")}`;this.errors.push(new ExpressionParsingError(te,O))}checkSubtype(O,Y){const te=checkSubtype(O,Y);return te&&this.error(te),te}}class Let{constructor(O,Y){this.type=Y.type,this.bindings=[].concat(O),this.result=Y}evaluate(O){return this.result.evaluate(O)}eachChild(O){for(const Y of this.bindings)O(Y[1]);O(this.result)}static parse(O,Y){if(O.length<4)return Y.error(`Expected at least 3 arguments, but found ${O.length-1} instead.`);const te=[];for(let xe=1;xe<O.length-1;xe+=2){const et=O[xe];if(typeof et!="string")return Y.error(`Expected string, but found ${typeof et} instead.`,xe);if(/[^a-zA-Z0-9_]/.test(et))return Y.error("Variable names must contain only alphanumeric characters or '_'.",xe);const tt=Y.parse(O[xe+1],xe+1);if(!tt)return null;te.push([et,tt])}const ne=Y.parse(O[O.length-1],O.length-1,Y.expectedType,te);return ne?new Let(te,ne):null}outputDefined(){return this.result.outputDefined()}}class Var{constructor(O,Y){this.type=Y.type,this.name=O,this.boundExpression=Y}static parse(O,Y){if(O.length!==2||typeof O[1]!="string")return Y.error("'var' expression requires exactly one string literal argument.");const te=O[1];return Y.scope.has(te)?new Var(te,Y.scope.get(te)):Y.error(`Unknown variable "${te}". Make sure "${te}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(O){return this.boundExpression.evaluate(O)}eachChild(){}outputDefined(){return!1}}class At{constructor(O,Y,te){this.type=O,this.index=Y,this.input=te}static parse(O,Y){if(O.length!==3)return Y.error(`Expected 2 arguments, but found ${O.length-1} instead.`);const te=Y.parse(O[1],1,NumberType),ne=Y.parse(O[2],2,array(Y.expectedType||ValueType));if(!te||!ne)return null;const xe=ne.type;return new At(xe.itemType,te,ne)}evaluate(O){const Y=this.index.evaluate(O),te=this.input.evaluate(O);if(Y<0)throw new RuntimeError(`Array index out of bounds: ${Y} < 0.`);if(Y>=te.length)throw new RuntimeError(`Array index out of bounds: ${Y} > ${te.length-1}.`);if(Y!==Math.floor(Y))throw new RuntimeError(`Array index must be an integer, but found ${Y} instead.`);return te[Y]}eachChild(O){O(this.index),O(this.input)}outputDefined(){return!1}}class In{constructor(O,Y){this.type=BooleanType,this.needle=O,this.haystack=Y}static parse(O,Y){if(O.length!==3)return Y.error(`Expected 2 arguments, but found ${O.length-1} instead.`);const te=Y.parse(O[1],1,ValueType),ne=Y.parse(O[2],2,ValueType);return!te||!ne?null:isValidType(te.type,[BooleanType,StringType,NumberType,NullType,ValueType])?new In(te,ne):Y.error(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(te.type)} instead`)}evaluate(O){const Y=this.needle.evaluate(O),te=this.haystack.evaluate(O);if(!te)return!1;if(!isValidNativeType(Y,["boolean","string","number","null"]))throw new RuntimeError(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(typeOf(Y))} instead.`);if(!isValidNativeType(te,["string","array"]))throw new RuntimeError(`Expected second argument to be of type array or string, but found ${typeToString(typeOf(te))} instead.`);return te.indexOf(Y)>=0}eachChild(O){O(this.needle),O(this.haystack)}outputDefined(){return!0}}class IndexOf{constructor(O,Y,te){this.type=NumberType,this.needle=O,this.haystack=Y,this.fromIndex=te}static parse(O,Y){if(O.length<=2||O.length>=5)return Y.error(`Expected 3 or 4 arguments, but found ${O.length-1} instead.`);const te=Y.parse(O[1],1,ValueType),ne=Y.parse(O[2],2,ValueType);if(!te||!ne)return null;if(!isValidType(te.type,[BooleanType,StringType,NumberType,NullType,ValueType]))return Y.error(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(te.type)} instead`);if(O.length===4){const xe=Y.parse(O[3],3,NumberType);return xe?new IndexOf(te,ne,xe):null}else return new IndexOf(te,ne)}evaluate(O){const Y=this.needle.evaluate(O),te=this.haystack.evaluate(O);if(!isValidNativeType(Y,["boolean","string","number","null"]))throw new RuntimeError(`Expected first argument to be of type boolean, string, number or null, but found ${typeToString(typeOf(Y))} instead.`);let ne;if(this.fromIndex&&(ne=this.fromIndex.evaluate(O)),isValidNativeType(te,["string"])){const xe=te.indexOf(Y,ne);return xe===-1?-1:[...te.slice(0,xe)].length}else{if(isValidNativeType(te,["array"]))return te.indexOf(Y,ne);throw new RuntimeError(`Expected second argument to be of type array or string, but found ${typeToString(typeOf(te))} instead.`)}}eachChild(O){O(this.needle),O(this.haystack),this.fromIndex&&O(this.fromIndex)}outputDefined(){return!1}}class Match{constructor(O,Y,te,ne,xe,et){this.inputType=O,this.type=Y,this.input=te,this.cases=ne,this.outputs=xe,this.otherwise=et}static parse(O,Y){if(O.length<5)return Y.error(`Expected at least 4 arguments, but found only ${O.length-1}.`);if(O.length%2!==1)return Y.error("Expected an even number of arguments.");let te,ne;Y.expectedType&&Y.expectedType.kind!=="value"&&(ne=Y.expectedType);const xe={},et=[];for(let st=2;st<O.length-1;st+=2){let ot=O[st];const rt=O[st+1];Array.isArray(ot)||(ot=[ot]);const nt=Y.concat(st);if(ot.length===0)return nt.error("Expected at least one branch label.");for(const ct of ot){if(typeof ct!="number"&&typeof ct!="string")return nt.error("Branch labels must be numbers or strings.");if(typeof ct=="number"&&Math.abs(ct)>Number.MAX_SAFE_INTEGER)return nt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ct=="number"&&Math.floor(ct)!==ct)return nt.error("Numeric branch labels must be integer values.");if(!te)te=typeOf(ct);else if(nt.checkSubtype(te,typeOf(ct)))return null;if(typeof xe[String(ct)]<"u")return nt.error("Branch labels must be unique.");xe[String(ct)]=et.length}const at=Y.parse(rt,st,ne);if(!at)return null;ne=ne||at.type,et.push(at)}const tt=Y.parse(O[1],1,ValueType);if(!tt)return null;const it=Y.parse(O[O.length-1],O.length-1,ne);return!it||tt.type.kind!=="value"&&Y.concat(1).checkSubtype(te,tt.type)?null:new Match(te,ne,tt,xe,et,it)}evaluate(O){const Y=this.input.evaluate(O);return(typeOf(Y)===this.inputType&&this.outputs[this.cases[Y]]||this.otherwise).evaluate(O)}eachChild(O){O(this.input),this.outputs.forEach(O),O(this.otherwise)}outputDefined(){return this.outputs.every(O=>O.outputDefined())&&this.otherwise.outputDefined()}}class Case{constructor(O,Y,te){this.type=O,this.branches=Y,this.otherwise=te}static parse(O,Y){if(O.length<4)return Y.error(`Expected at least 3 arguments, but found only ${O.length-1}.`);if(O.length%2!==0)return Y.error("Expected an odd number of arguments.");let te;Y.expectedType&&Y.expectedType.kind!=="value"&&(te=Y.expectedType);const ne=[];for(let et=1;et<O.length-1;et+=2){const tt=Y.parse(O[et],et,BooleanType);if(!tt)return null;const it=Y.parse(O[et+1],et+1,te);if(!it)return null;ne.push([tt,it]),te=te||it.type}const xe=Y.parse(O[O.length-1],O.length-1,te);if(!xe)return null;if(!te)throw new Error("Can't infer output type");return new Case(te,ne,xe)}evaluate(O){for(const[Y,te]of this.branches)if(Y.evaluate(O))return te.evaluate(O);return this.otherwise.evaluate(O)}eachChild(O){for(const[Y,te]of this.branches)O(Y),O(te);O(this.otherwise)}outputDefined(){return this.branches.every(([O,Y])=>Y.outputDefined())&&this.otherwise.outputDefined()}}class Slice{constructor(O,Y,te,ne){this.type=O,this.input=Y,this.beginIndex=te,this.endIndex=ne}static parse(O,Y){if(O.length<=2||O.length>=5)return Y.error(`Expected 3 or 4 arguments, but found ${O.length-1} instead.`);const te=Y.parse(O[1],1,ValueType),ne=Y.parse(O[2],2,NumberType);if(!te||!ne)return null;if(!isValidType(te.type,[array(ValueType),StringType,ValueType]))return Y.error(`Expected first argument to be of type array or string, but found ${typeToString(te.type)} instead`);if(O.length===4){const xe=Y.parse(O[3],3,NumberType);return xe?new Slice(te.type,te,ne,xe):null}else return new Slice(te.type,te,ne)}evaluate(O){const Y=this.input.evaluate(O),te=this.beginIndex.evaluate(O);let ne;if(this.endIndex&&(ne=this.endIndex.evaluate(O)),isValidNativeType(Y,["string"]))return[...Y].slice(te,ne).join("");if(isValidNativeType(Y,["array"]))return Y.slice(te,ne);throw new RuntimeError(`Expected first argument to be of type array or string, but found ${typeToString(typeOf(Y))} instead.`)}eachChild(O){O(this.input),O(this.beginIndex),this.endIndex&&O(this.endIndex)}outputDefined(){return!1}}function findStopLessThanOrEqualTo(ee,O){const Y=ee.length-1;let te=0,ne=Y,xe=0,et,tt;for(;te<=ne;)if(xe=Math.floor((te+ne)/2),et=ee[xe],tt=ee[xe+1],et<=O){if(xe===Y||O<tt)return xe;te=xe+1}else if(et>O)ne=xe-1;else throw new RuntimeError("Input is not a number.");return 0}class Step{constructor(O,Y,te){this.type=O,this.input=Y,this.labels=[],this.outputs=[];for(const[ne,xe]of te)this.labels.push(ne),this.outputs.push(xe)}static parse(O,Y){if(O.length-1<4)return Y.error(`Expected at least 4 arguments, but found only ${O.length-1}.`);if((O.length-1)%2!==0)return Y.error("Expected an even number of arguments.");const te=Y.parse(O[1],1,NumberType);if(!te)return null;const ne=[];let xe=null;Y.expectedType&&Y.expectedType.kind!=="value"&&(xe=Y.expectedType);for(let et=1;et<O.length;et+=2){const tt=et===1?-1/0:O[et],it=O[et+1],st=et,ot=et+1;if(typeof tt!="number")return Y.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',st);if(ne.length&&ne[ne.length-1][0]>=tt)return Y.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',st);const rt=Y.parse(it,ot,xe);if(!rt)return null;xe=xe||rt.type,ne.push([tt,rt])}return new Step(xe,te,ne)}evaluate(O){const Y=this.labels,te=this.outputs;if(Y.length===1)return te[0].evaluate(O);const ne=this.input.evaluate(O);if(ne<=Y[0])return te[0].evaluate(O);const xe=Y.length;if(ne>=Y[xe-1])return te[xe-1].evaluate(O);const et=findStopLessThanOrEqualTo(Y,ne);return te[et].evaluate(O)}eachChild(O){O(this.input);for(const Y of this.outputs)O(Y)}outputDefined(){return this.outputs.every(O=>O.outputDefined())}}function getDefaultExportFromCjs(ee){return ee&&ee.__esModule&&Object.prototype.hasOwnProperty.call(ee,"default")?ee.default:ee}var unitbezier,hasRequiredUnitbezier;function requireUnitbezier(){if(hasRequiredUnitbezier)return unitbezier;hasRequiredUnitbezier=1,unitbezier=ee;function ee(O,Y,te,ne){this.cx=3*O,this.bx=3*(te-O)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*Y,this.by=3*(ne-Y)-this.cy,this.ay=1-this.cy-this.by,this.p1x=O,this.p1y=Y,this.p2x=te,this.p2y=ne}return ee.prototype={sampleCurveX:function(O){return((this.ax*O+this.bx)*O+this.cx)*O},sampleCurveY:function(O){return((this.ay*O+this.by)*O+this.cy)*O},sampleCurveDerivativeX:function(O){return(3*this.ax*O+2*this.bx)*O+this.cx},solveCurveX:function(O,Y){if(Y===void 0&&(Y=1e-6),O<0)return 0;if(O>1)return 1;for(var te=O,ne=0;ne<8;ne++){var xe=this.sampleCurveX(te)-O;if(Math.abs(xe)<Y)return te;var et=this.sampleCurveDerivativeX(te);if(Math.abs(et)<1e-6)break;te=te-xe/et}var tt=0,it=1;for(te=O,ne=0;ne<20&&(xe=this.sampleCurveX(te),!(Math.abs(xe-O)<Y));ne++)O>xe?tt=te:it=te,te=(it-tt)*.5+tt;return te},solve:function(O,Y){return this.sampleCurveY(this.solveCurveX(O,Y))}},unitbezier}var unitbezierExports=requireUnitbezier(),UnitBezier=getDefaultExportFromCjs(unitbezierExports);class Interpolate{constructor(O,Y,te,ne,xe){this.type=O,this.operator=Y,this.interpolation=te,this.input=ne,this.labels=[],this.outputs=[];for(const[et,tt]of xe)this.labels.push(et),this.outputs.push(tt)}static interpolationFactor(O,Y,te,ne){let xe=0;if(O.name==="exponential")xe=exponentialInterpolation(Y,O.base,te,ne);else if(O.name==="linear")xe=exponentialInterpolation(Y,1,te,ne);else if(O.name==="cubic-bezier"){const et=O.controlPoints;xe=new UnitBezier(et[0],et[1],et[2],et[3]).solve(exponentialInterpolation(Y,1,te,ne))}return xe}static parse(O,Y){let[te,ne,xe,...et]=O;if(!Array.isArray(ne)||ne.length===0)return Y.error("Expected an interpolation type expression.",1);if(ne[0]==="linear")ne={name:"linear"};else if(ne[0]==="exponential"){const st=ne[1];if(typeof st!="number")return Y.error("Exponential interpolation requires a numeric base.",1,1);ne={name:"exponential",base:st}}else if(ne[0]==="cubic-bezier"){const st=ne.slice(1);if(st.length!==4||st.some(ot=>typeof ot!="number"||ot<0||ot>1))return Y.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ne={name:"cubic-bezier",controlPoints:st}}else return Y.error(`Unknown interpolation type ${String(ne[0])}`,1,0);if(O.length-1<4)return Y.error(`Expected at least 4 arguments, but found only ${O.length-1}.`);if((O.length-1)%2!==0)return Y.error("Expected an even number of arguments.");if(xe=Y.parse(xe,2,NumberType),!xe)return null;const tt=[];let it=null;(te==="interpolate-hcl"||te==="interpolate-lab")&&Y.expectedType!=ColorArrayType?it=ColorType:Y.expectedType&&Y.expectedType.kind!=="value"&&(it=Y.expectedType);for(let st=0;st<et.length;st+=2){const ot=et[st],rt=et[st+1],nt=st+3,at=st+4;if(typeof ot!="number")return Y.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',nt);if(tt.length&&tt[tt.length-1][0]>=ot)return Y.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',nt);const ct=Y.parse(rt,at,it);if(!ct)return null;it=it||ct.type,tt.push([ot,ct])}return!verifyType(it,NumberType)&&!verifyType(it,ProjectionDefinitionType)&&!verifyType(it,ColorType)&&!verifyType(it,PaddingType)&&!verifyType(it,NumberArrayType)&&!verifyType(it,ColorArrayType)&&!verifyType(it,VariableAnchorOffsetCollectionType)&&!verifyType(it,array(NumberType))?Y.error(`Type ${typeToString(it)} is not interpolatable.`):new Interpolate(it,te,ne,xe,tt)}evaluate(O){const Y=this.labels,te=this.outputs;if(Y.length===1)return te[0].evaluate(O);const ne=this.input.evaluate(O);if(ne<=Y[0])return te[0].evaluate(O);const xe=Y.length;if(ne>=Y[xe-1])return te[xe-1].evaluate(O);const et=findStopLessThanOrEqualTo(Y,ne),tt=Y[et],it=Y[et+1],st=Interpolate.interpolationFactor(this.interpolation,ne,tt,it),ot=te[et].evaluate(O),rt=te[et+1].evaluate(O);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return interpolateNumber(ot,rt,st);case"color":return Color.interpolate(ot,rt,st);case"padding":return Padding.interpolate(ot,rt,st);case"colorArray":return ColorArray.interpolate(ot,rt,st);case"numberArray":return NumberArray.interpolate(ot,rt,st);case"variableAnchorOffsetCollection":return VariableAnchorOffsetCollection.interpolate(ot,rt,st);case"array":return interpolateArray(ot,rt,st);case"projectionDefinition":return ProjectionDefinition.interpolate(ot,rt,st)}case"interpolate-hcl":switch(this.type.kind){case"color":return Color.interpolate(ot,rt,st,"hcl");case"colorArray":return ColorArray.interpolate(ot,rt,st,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Color.interpolate(ot,rt,st,"lab");case"colorArray":return ColorArray.interpolate(ot,rt,st,"lab")}}}eachChild(O){O(this.input);for(const Y of this.outputs)O(Y)}outputDefined(){return this.outputs.every(O=>O.outputDefined())}}function exponentialInterpolation(ee,O,Y,te){const ne=te-Y,xe=ee-Y;return ne===0?0:O===1?xe/ne:(Math.pow(O,xe)-1)/(Math.pow(O,ne)-1)}class Coalesce{constructor(O,Y){this.type=O,this.args=Y}static parse(O,Y){if(O.length<2)return Y.error("Expected at least one argument.");let te=null;const ne=Y.expectedType;ne&&ne.kind!=="value"&&(te=ne);const xe=[];for(const tt of O.slice(1)){const it=Y.parse(tt,1+xe.length,te,void 0,{typeAnnotation:"omit"});if(!it)return null;te=te||it.type,xe.push(it)}if(!te)throw new Error("No output type");return ne&&xe.some(tt=>checkSubtype(ne,tt.type))?new Coalesce(ValueType,xe):new Coalesce(te,xe)}evaluate(O){let Y=null,te=0,ne;for(const xe of this.args)if(te++,Y=xe.evaluate(O),Y&&Y instanceof ResolvedImage&&!Y.available&&(ne||(ne=Y.name),Y=null,te===this.args.length&&(Y=ne)),Y!==null)break;return Y}eachChild(O){this.args.forEach(O)}outputDefined(){return this.args.every(O=>O.outputDefined())}}function isComparableType(ee,O){return ee==="=="||ee==="!="?O.kind==="boolean"||O.kind==="string"||O.kind==="number"||O.kind==="null"||O.kind==="value":O.kind==="string"||O.kind==="number"||O.kind==="value"}function eq(ee,O,Y){return O===Y}function neq(ee,O,Y){return O!==Y}function lt(ee,O,Y){return O<Y}function gt(ee,O,Y){return O>Y}function lteq(ee,O,Y){return O<=Y}function gteq(ee,O,Y){return O>=Y}function eqCollate(ee,O,Y,te){return te.compare(O,Y)===0}function neqCollate(ee,O,Y,te){return!eqCollate(ee,O,Y,te)}function ltCollate(ee,O,Y,te){return te.compare(O,Y)<0}function gtCollate(ee,O,Y,te){return te.compare(O,Y)>0}function lteqCollate(ee,O,Y,te){return te.compare(O,Y)<=0}function gteqCollate(ee,O,Y,te){return te.compare(O,Y)>=0}function makeComparison(ee,O,Y){const te=ee!=="=="&&ee!=="!=";return class bi{constructor(xe,et,tt){this.type=BooleanType,this.lhs=xe,this.rhs=et,this.collator=tt,this.hasUntypedArgument=xe.type.kind==="value"||et.type.kind==="value"}static parse(xe,et){if(xe.length!==3&&xe.length!==4)return et.error("Expected two or three arguments.");const tt=xe[0];let it=et.parse(xe[1],1,ValueType);if(!it)return null;if(!isComparableType(tt,it.type))return et.concat(1).error(`"${tt}" comparisons are not supported for type '${typeToString(it.type)}'.`);let st=et.parse(xe[2],2,ValueType);if(!st)return null;if(!isComparableType(tt,st.type))return et.concat(2).error(`"${tt}" comparisons are not supported for type '${typeToString(st.type)}'.`);if(it.type.kind!==st.type.kind&&it.type.kind!=="value"&&st.type.kind!=="value")return et.error(`Cannot compare types '${typeToString(it.type)}' and '${typeToString(st.type)}'.`);te&&(it.type.kind==="value"&&st.type.kind!=="value"?it=new Assertion(st.type,[it]):it.type.kind!=="value"&&st.type.kind==="value"&&(st=new Assertion(it.type,[st])));let ot=null;if(xe.length===4){if(it.type.kind!=="string"&&st.type.kind!=="string"&&it.type.kind!=="value"&&st.type.kind!=="value")return et.error("Cannot use collator to compare non-string types.");if(ot=et.parse(xe[3],3,CollatorType),!ot)return null}return new bi(it,st,ot)}evaluate(xe){const et=this.lhs.evaluate(xe),tt=this.rhs.evaluate(xe);if(te&&this.hasUntypedArgument){const it=typeOf(et),st=typeOf(tt);if(it.kind!==st.kind||!(it.kind==="string"||it.kind==="number"))throw new RuntimeError(`Expected arguments for "${ee}" to be (string, string) or (number, number), but found (${it.kind}, ${st.kind}) instead.`)}if(this.collator&&!te&&this.hasUntypedArgument){const it=typeOf(et),st=typeOf(tt);if(it.kind!=="string"||st.kind!=="string")return O(xe,et,tt)}return this.collator?Y(xe,et,tt,this.collator.evaluate(xe)):O(xe,et,tt)}eachChild(xe){xe(this.lhs),xe(this.rhs),this.collator&&xe(this.collator)}outputDefined(){return!0}}}const Equals=makeComparison("==",eq,eqCollate),NotEquals=makeComparison("!=",neq,neqCollate),LessThan=makeComparison("<",lt,ltCollate),GreaterThan=makeComparison(">",gt,gtCollate),LessThanOrEqual=makeComparison("<=",lteq,lteqCollate),GreaterThanOrEqual=makeComparison(">=",gteq,gteqCollate);class CollatorExpression{constructor(O,Y,te){this.type=CollatorType,this.locale=te,this.caseSensitive=O,this.diacriticSensitive=Y}static parse(O,Y){if(O.length!==2)return Y.error("Expected one argument.");const te=O[1];if(typeof te!="object"||Array.isArray(te))return Y.error("Collator options argument must be an object.");const ne=Y.parse(te["case-sensitive"]===void 0?!1:te["case-sensitive"],1,BooleanType);if(!ne)return null;const xe=Y.parse(te["diacritic-sensitive"]===void 0?!1:te["diacritic-sensitive"],1,BooleanType);if(!xe)return null;let et=null;return te.locale&&(et=Y.parse(te.locale,1,StringType),!et)?null:new CollatorExpression(ne,xe,et)}evaluate(O){return new Collator(this.caseSensitive.evaluate(O),this.diacriticSensitive.evaluate(O),this.locale?this.locale.evaluate(O):null)}eachChild(O){O(this.caseSensitive),O(this.diacriticSensitive),this.locale&&O(this.locale)}outputDefined(){return!1}}class NumberFormat{constructor(O,Y,te,ne,xe){this.type=StringType,this.number=O,this.locale=Y,this.currency=te,this.minFractionDigits=ne,this.maxFractionDigits=xe}static parse(O,Y){if(O.length!==3)return Y.error("Expected two arguments.");const te=Y.parse(O[1],1,NumberType);if(!te)return null;const ne=O[2];if(typeof ne!="object"||Array.isArray(ne))return Y.error("NumberFormat options argument must be an object.");let xe=null;if(ne.locale&&(xe=Y.parse(ne.locale,1,StringType),!xe))return null;let et=null;if(ne.currency&&(et=Y.parse(ne.currency,1,StringType),!et))return null;let tt=null;if(ne["min-fraction-digits"]&&(tt=Y.parse(ne["min-fraction-digits"],1,NumberType),!tt))return null;let it=null;return ne["max-fraction-digits"]&&(it=Y.parse(ne["max-fraction-digits"],1,NumberType),!it)?null:new NumberFormat(te,xe,et,tt,it)}evaluate(O){return new Intl.NumberFormat(this.locale?this.locale.evaluate(O):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(O):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(O):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(O):void 0}).format(this.number.evaluate(O))}eachChild(O){O(this.number),this.locale&&O(this.locale),this.currency&&O(this.currency),this.minFractionDigits&&O(this.minFractionDigits),this.maxFractionDigits&&O(this.maxFractionDigits)}outputDefined(){return!1}}class FormatExpression{constructor(O){this.type=FormattedType,this.sections=O}static parse(O,Y){if(O.length<2)return Y.error("Expected at least one argument.");const te=O[1];if(!Array.isArray(te)&&typeof te=="object")return Y.error("First argument must be an image or text section.");const ne=[];let xe=!1;for(let et=1;et<=O.length-1;++et){const tt=O[et];if(xe&&typeof tt=="object"&&!Array.isArray(tt)){xe=!1;let it=null;if(tt["font-scale"]&&(it=Y.parse(tt["font-scale"],1,NumberType),!it))return null;let st=null;if(tt["text-font"]&&(st=Y.parse(tt["text-font"],1,array(StringType)),!st))return null;let ot=null;if(tt["text-color"]&&(ot=Y.parse(tt["text-color"],1,ColorType),!ot))return null;let rt=null;if(tt["vertical-align"]){if(typeof tt["vertical-align"]=="string"&&!VERTICAL_ALIGN_OPTIONS.includes(tt["vertical-align"]))return Y.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${tt["vertical-align"]}' instead.`);if(rt=Y.parse(tt["vertical-align"],1,StringType),!rt)return null}const nt=ne[ne.length-1];nt.scale=it,nt.font=st,nt.textColor=ot,nt.verticalAlign=rt}else{const it=Y.parse(O[et],1,ValueType);if(!it)return null;const st=it.type.kind;if(st!=="string"&&st!=="value"&&st!=="null"&&st!=="resolvedImage")return Y.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");xe=!0,ne.push({content:it,scale:null,font:null,textColor:null,verticalAlign:null})}}return new FormatExpression(ne)}evaluate(O){const Y=te=>{const ne=te.content.evaluate(O);return typeOf(ne)===ResolvedImageType?new FormattedSection("",ne,null,null,null,te.verticalAlign?te.verticalAlign.evaluate(O):null):new FormattedSection(valueToString(ne),null,te.scale?te.scale.evaluate(O):null,te.font?te.font.evaluate(O).join(","):null,te.textColor?te.textColor.evaluate(O):null,te.verticalAlign?te.verticalAlign.evaluate(O):null)};return new Formatted(this.sections.map(Y))}eachChild(O){for(const Y of this.sections)O(Y.content),Y.scale&&O(Y.scale),Y.font&&O(Y.font),Y.textColor&&O(Y.textColor),Y.verticalAlign&&O(Y.verticalAlign)}outputDefined(){return!1}}class ImageExpression{constructor(O){this.type=ResolvedImageType,this.input=O}static parse(O,Y){if(O.length!==2)return Y.error("Expected two arguments.");const te=Y.parse(O[1],1,StringType);return te?new ImageExpression(te):Y.error("No image name provided.")}evaluate(O){const Y=this.input.evaluate(O),te=ResolvedImage.fromString(Y);return te&&O.availableImages&&(te.available=O.availableImages.indexOf(Y)>-1),te}eachChild(O){O(this.input)}outputDefined(){return!1}}class Length{constructor(O){this.type=NumberType,this.input=O}static parse(O,Y){if(O.length!==2)return Y.error(`Expected 1 argument, but found ${O.length-1} instead.`);const te=Y.parse(O[1],1);return te?te.type.kind!=="array"&&te.type.kind!=="string"&&te.type.kind!=="value"?Y.error(`Expected argument of type string or array, but found ${typeToString(te.type)} instead.`):new Length(te):null}evaluate(O){const Y=this.input.evaluate(O);if(typeof Y=="string")return[...Y].length;if(Array.isArray(Y))return Y.length;throw new RuntimeError(`Expected value to be of type string or array, but found ${typeToString(typeOf(Y))} instead.`)}eachChild(O){O(this.input)}outputDefined(){return!1}}const EXTENT=8192;function getTileCoordinates(ee,O){const Y=mercatorXfromLng(ee[0]),te=mercatorYfromLat(ee[1]),ne=Math.pow(2,O.z);return[Math.round(Y*ne*EXTENT),Math.round(te*ne*EXTENT)]}function getLngLatFromTileCoord(ee,O){const Y=Math.pow(2,O.z),te=(ee[0]/EXTENT+O.x)/Y,ne=(ee[1]/EXTENT+O.y)/Y;return[lngFromMercatorXfromLng(te),latFromMercatorY(ne)]}function mercatorXfromLng(ee){return(180+ee)/360}function lngFromMercatorXfromLng(ee){return ee*360-180}function mercatorYfromLat(ee){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+ee*Math.PI/360)))/360}function latFromMercatorY(ee){return 360/Math.PI*Math.atan(Math.exp((180-ee*360)*Math.PI/180))-90}function updateBBox(ee,O){ee[0]=Math.min(ee[0],O[0]),ee[1]=Math.min(ee[1],O[1]),ee[2]=Math.max(ee[2],O[0]),ee[3]=Math.max(ee[3],O[1])}function boxWithinBox(ee,O){return!(ee[0]<=O[0]||ee[2]>=O[2]||ee[1]<=O[1]||ee[3]>=O[3])}function rayIntersect(ee,O,Y){return O[1]>ee[1]!=Y[1]>ee[1]&&ee[0]<(Y[0]-O[0])*(ee[1]-O[1])/(Y[1]-O[1])+O[0]}function pointOnBoundary(ee,O,Y){const te=ee[0]-O[0],ne=ee[1]-O[1],xe=ee[0]-Y[0],et=ee[1]-Y[1];return te*et-xe*ne===0&&te*xe<=0&&ne*et<=0}function segmentIntersectSegment(ee,O,Y,te){const ne=[O[0]-ee[0],O[1]-ee[1]],xe=[te[0]-Y[0],te[1]-Y[1]];return perp(xe,ne)===0?!1:!!(twoSided(ee,O,Y,te)&&twoSided(Y,te,ee,O))}function lineIntersectPolygon(ee,O,Y){for(const te of Y)for(let ne=0;ne<te.length-1;++ne)if(segmentIntersectSegment(ee,O,te[ne],te[ne+1]))return!0;return!1}function pointWithinPolygon(ee,O,Y=!1){let te=!1;for(const ne of O)for(let xe=0;xe<ne.length-1;xe++){if(pointOnBoundary(ee,ne[xe],ne[xe+1]))return Y;rayIntersect(ee,ne[xe],ne[xe+1])&&(te=!te)}return te}function pointWithinPolygons(ee,O){for(const Y of O)if(pointWithinPolygon(ee,Y))return!0;return!1}function lineStringWithinPolygon(ee,O){for(const Y of ee)if(!pointWithinPolygon(Y,O))return!1;for(let Y=0;Y<ee.length-1;++Y)if(lineIntersectPolygon(ee[Y],ee[Y+1],O))return!1;return!0}function lineStringWithinPolygons(ee,O){for(const Y of O)if(lineStringWithinPolygon(ee,Y))return!0;return!1}function perp(ee,O){return ee[0]*O[1]-ee[1]*O[0]}function twoSided(ee,O,Y,te){const ne=ee[0]-Y[0],xe=ee[1]-Y[1],et=O[0]-Y[0],tt=O[1]-Y[1],it=te[0]-Y[0],st=te[1]-Y[1],ot=ne*st-it*xe,rt=et*st-it*tt;return ot>0&&rt<0||ot<0&&rt>0}function getTilePolygon(ee,O,Y){const te=[];for(let ne=0;ne<ee.length;ne++){const xe=[];for(let et=0;et<ee[ne].length;et++){const tt=getTileCoordinates(ee[ne][et],Y);updateBBox(O,tt),xe.push(tt)}te.push(xe)}return te}function getTilePolygons(ee,O,Y){const te=[];for(let ne=0;ne<ee.length;ne++){const xe=getTilePolygon(ee[ne],O,Y);te.push(xe)}return te}function updatePoint(ee,O,Y,te){if(ee[0]<Y[0]||ee[0]>Y[2]){const ne=te*.5;let xe=ee[0]-Y[0]>ne?-te:Y[0]-ee[0]>ne?te:0;xe===0&&(xe=ee[0]-Y[2]>ne?-te:Y[2]-ee[0]>ne?te:0),ee[0]+=xe}updateBBox(O,ee)}function resetBBox(ee){ee[0]=ee[1]=1/0,ee[2]=ee[3]=-1/0}function getTilePoints(ee,O,Y,te){const ne=Math.pow(2,te.z)*EXTENT,xe=[te.x*EXTENT,te.y*EXTENT],et=[];for(const tt of ee)for(const it of tt){const st=[it.x+xe[0],it.y+xe[1]];updatePoint(st,O,Y,ne),et.push(st)}return et}function getTileLines(ee,O,Y,te){const ne=Math.pow(2,te.z)*EXTENT,xe=[te.x*EXTENT,te.y*EXTENT],et=[];for(const tt of ee){const it=[];for(const st of tt){const ot=[st.x+xe[0],st.y+xe[1]];updateBBox(O,ot),it.push(ot)}et.push(it)}if(O[2]-O[0]<=ne/2){resetBBox(O);for(const tt of et)for(const it of tt)updatePoint(it,O,Y,ne)}return et}function pointsWithinPolygons(ee,O){const Y=[1/0,1/0,-1/0,-1/0],te=[1/0,1/0,-1/0,-1/0],ne=ee.canonicalID();if(O.type==="Polygon"){const xe=getTilePolygon(O.coordinates,te,ne),et=getTilePoints(ee.geometry(),Y,te,ne);if(!boxWithinBox(Y,te))return!1;for(const tt of et)if(!pointWithinPolygon(tt,xe))return!1}if(O.type==="MultiPolygon"){const xe=getTilePolygons(O.coordinates,te,ne),et=getTilePoints(ee.geometry(),Y,te,ne);if(!boxWithinBox(Y,te))return!1;for(const tt of et)if(!pointWithinPolygons(tt,xe))return!1}return!0}function linesWithinPolygons(ee,O){const Y=[1/0,1/0,-1/0,-1/0],te=[1/0,1/0,-1/0,-1/0],ne=ee.canonicalID();if(O.type==="Polygon"){const xe=getTilePolygon(O.coordinates,te,ne),et=getTileLines(ee.geometry(),Y,te,ne);if(!boxWithinBox(Y,te))return!1;for(const tt of et)if(!lineStringWithinPolygon(tt,xe))return!1}if(O.type==="MultiPolygon"){const xe=getTilePolygons(O.coordinates,te,ne),et=getTileLines(ee.geometry(),Y,te,ne);if(!boxWithinBox(Y,te))return!1;for(const tt of et)if(!lineStringWithinPolygons(tt,xe))return!1}return!0}class Within{constructor(O,Y){this.type=BooleanType,this.geojson=O,this.geometries=Y}static parse(O,Y){if(O.length!==2)return Y.error(`'within' expression requires exactly one argument, but found ${O.length-1} instead.`);if(isValue(O[1])){const te=O[1];if(te.type==="FeatureCollection"){const ne=[];for(const xe of te.features){const{type:et,coordinates:tt}=xe.geometry;et==="Polygon"&&ne.push(tt),et==="MultiPolygon"&&ne.push(...tt)}if(ne.length){const xe={type:"MultiPolygon",coordinates:ne};return new Within(te,xe)}}else if(te.type==="Feature"){const ne=te.geometry.type;if(ne==="Polygon"||ne==="MultiPolygon")return new Within(te,te.geometry)}else if(te.type==="Polygon"||te.type==="MultiPolygon")return new Within(te,te)}return Y.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(O){if(O.geometry()!=null&&O.canonicalID()!=null){if(O.geometryType()==="Point")return pointsWithinPolygons(O,this.geometries);if(O.geometryType()==="LineString")return linesWithinPolygons(O,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class TinyQueue{constructor(O=[],Y=(te,ne)=>te<ne?-1:te>ne?1:0){if(this.data=O,this.length=this.data.length,this.compare=Y,this.length>0)for(let te=(this.length>>1)-1;te>=0;te--)this._down(te)}push(O){this.data.push(O),this._up(this.length++)}pop(){if(this.length===0)return;const O=this.data[0],Y=this.data.pop();return--this.length>0&&(this.data[0]=Y,this._down(0)),O}peek(){return this.data[0]}_up(O){const{data:Y,compare:te}=this,ne=Y[O];for(;O>0;){const xe=O-1>>1,et=Y[xe];if(te(ne,et)>=0)break;Y[O]=et,O=xe}Y[O]=ne}_down(O){const{data:Y,compare:te}=this,ne=this.length>>1,xe=Y[O];for(;O<ne;){let et=(O<<1)+1;const tt=et+1;if(tt<this.length&&te(Y[tt],Y[et])<0&&(et=tt),te(Y[et],xe)>=0)break;Y[O]=Y[et],O=et}Y[O]=xe}}function classifyRings(ee,O){if(ee.length<=1)return[ee];const te=[];let ne,xe;for(const et of ee){const tt=calculateSignedArea(et);tt!==0&&(et.area=Math.abs(tt),xe===void 0&&(xe=tt<0),xe===tt<0?(ne&&te.push(ne),ne=[et]):ne.push(et))}return ne&&te.push(ne),te}function calculateSignedArea(ee){let O=0;for(let Y=0,te=ee.length,ne=te-1,xe,et;Y<te;ne=Y++)xe=ee[Y],et=ee[ne],O+=(et.x-xe.x)*(xe.y+et.y);return O}const RE=6378.137,FE=1/298.257223563,E2=FE*(2-FE),RAD=Math.PI/180;class CheapRuler{constructor(O){const Y=RAD*RE*1e3,te=Math.cos(O*RAD),ne=1/(1-E2*(1-te*te)),xe=Math.sqrt(ne);this.kx=Y*xe*te,this.ky=Y*xe*ne*(1-E2)}distance(O,Y){const te=this.wrap(O[0]-Y[0])*this.kx,ne=(O[1]-Y[1])*this.ky;return Math.sqrt(te*te+ne*ne)}pointOnLine(O,Y){let te=1/0,ne,xe,et,tt;for(let it=0;it<O.length-1;it++){let st=O[it][0],ot=O[it][1],rt=this.wrap(O[it+1][0]-st)*this.kx,nt=(O[it+1][1]-ot)*this.ky,at=0;(rt!==0||nt!==0)&&(at=(this.wrap(Y[0]-st)*this.kx*rt+(Y[1]-ot)*this.ky*nt)/(rt*rt+nt*nt),at>1?(st=O[it+1][0],ot=O[it+1][1]):at>0&&(st+=rt/this.kx*at,ot+=nt/this.ky*at)),rt=this.wrap(Y[0]-st)*this.kx,nt=(Y[1]-ot)*this.ky;const ct=rt*rt+nt*nt;ct<te&&(te=ct,ne=st,xe=ot,et=it,tt=at)}return{point:[ne,xe],index:et,t:Math.max(0,Math.min(1,tt))}}wrap(O){for(;O<-180;)O+=360;for(;O>180;)O-=360;return O}}const MinPointsSize=100,MinLinePointsSize=50;function compareDistPair(ee,O){return O[0]-ee[0]}function getRangeSize(ee){return ee[1]-ee[0]+1}function isRangeSafe(ee,O){return ee[1]>=ee[0]&&ee[1]<O}function splitRange(ee,O){if(ee[0]>ee[1])return[null,null];const Y=getRangeSize(ee);if(O){if(Y===2)return[ee,null];const ne=Math.floor(Y/2);return[[ee[0],ee[0]+ne],[ee[0]+ne,ee[1]]]}if(Y===1)return[ee,null];const te=Math.floor(Y/2)-1;return[[ee[0],ee[0]+te],[ee[0]+te+1,ee[1]]]}function getBBox(ee,O){if(!isRangeSafe(O,ee.length))return[1/0,1/0,-1/0,-1/0];const Y=[1/0,1/0,-1/0,-1/0];for(let te=O[0];te<=O[1];++te)updateBBox(Y,ee[te]);return Y}function getPolygonBBox(ee){const O=[1/0,1/0,-1/0,-1/0];for(const Y of ee)for(const te of Y)updateBBox(O,te);return O}function isValidBBox(ee){return ee[0]!==-1/0&&ee[1]!==-1/0&&ee[2]!==1/0&&ee[3]!==1/0}function bboxToBBoxDistance(ee,O,Y){if(!isValidBBox(ee)||!isValidBBox(O))return NaN;let te=0,ne=0;return ee[2]<O[0]&&(te=O[0]-ee[2]),ee[0]>O[2]&&(te=ee[0]-O[2]),ee[1]>O[3]&&(ne=ee[1]-O[3]),ee[3]<O[1]&&(ne=O[1]-ee[3]),Y.distance([0,0],[te,ne])}function pointToLineDistance(ee,O,Y){const te=Y.pointOnLine(O,ee);return Y.distance(ee,te.point)}function segmentToSegmentDistance(ee,O,Y,te,ne){const xe=Math.min(pointToLineDistance(ee,[Y,te],ne),pointToLineDistance(O,[Y,te],ne)),et=Math.min(pointToLineDistance(Y,[ee,O],ne),pointToLineDistance(te,[ee,O],ne));return Math.min(xe,et)}function lineToLineDistance(ee,O,Y,te,ne){if(!(isRangeSafe(O,ee.length)&&isRangeSafe(te,Y.length)))return 1/0;let et=1/0;for(let tt=O[0];tt<O[1];++tt){const it=ee[tt],st=ee[tt+1];for(let ot=te[0];ot<te[1];++ot){const rt=Y[ot],nt=Y[ot+1];if(segmentIntersectSegment(it,st,rt,nt))return 0;et=Math.min(et,segmentToSegmentDistance(it,st,rt,nt,ne))}}return et}function pointsToPointsDistance(ee,O,Y,te,ne){if(!(isRangeSafe(O,ee.length)&&isRangeSafe(te,Y.length)))return NaN;let et=1/0;for(let tt=O[0];tt<=O[1];++tt)for(let it=te[0];it<=te[1];++it)if(et=Math.min(et,ne.distance(ee[tt],Y[it])),et===0)return et;return et}function pointToPolygonDistance(ee,O,Y){if(pointWithinPolygon(ee,O,!0))return 0;let te=1/0;for(const ne of O){const xe=ne[0],et=ne[ne.length-1];if(xe!==et&&(te=Math.min(te,pointToLineDistance(ee,[et,xe],Y)),te===0))return te;const tt=Y.pointOnLine(ne,ee);if(te=Math.min(te,Y.distance(ee,tt.point)),te===0)return te}return te}function lineToPolygonDistance(ee,O,Y,te){if(!isRangeSafe(O,ee.length))return NaN;for(let xe=O[0];xe<=O[1];++xe)if(pointWithinPolygon(ee[xe],Y,!0))return 0;let ne=1/0;for(let xe=O[0];xe<O[1];++xe){const et=ee[xe],tt=ee[xe+1];for(const it of Y)for(let st=0,ot=it.length,rt=ot-1;st<ot;rt=st++){const nt=it[rt],at=it[st];if(segmentIntersectSegment(et,tt,nt,at))return 0;ne=Math.min(ne,segmentToSegmentDistance(et,tt,nt,at,te))}}return ne}function polygonIntersect(ee,O){for(const Y of ee)for(const te of Y)if(pointWithinPolygon(te,O,!0))return!0;return!1}function polygonToPolygonDistance(ee,O,Y,te=1/0){const ne=getPolygonBBox(ee),xe=getPolygonBBox(O);if(te!==1/0&&bboxToBBoxDistance(ne,xe,Y)>=te)return te;if(boxWithinBox(ne,xe)){if(polygonIntersect(ee,O))return 0}else if(polygonIntersect(O,ee))return 0;let et=1/0;for(const tt of ee)for(let it=0,st=tt.length,ot=st-1;it<st;ot=it++){const rt=tt[ot],nt=tt[it];for(const at of O)for(let ct=0,ut=at.length,dt=ut-1;ct<ut;dt=ct++){const ht=at[dt],pt=at[ct];if(segmentIntersectSegment(rt,nt,ht,pt))return 0;et=Math.min(et,segmentToSegmentDistance(rt,nt,ht,pt,Y))}}return et}function updateQueue(ee,O,Y,te,ne,xe){if(!xe)return;const et=bboxToBBoxDistance(getBBox(te,xe),ne,Y);et<O&&ee.push([et,xe,[0,0]])}function updateQueueTwoSets(ee,O,Y,te,ne,xe,et){if(!xe||!et)return;const tt=bboxToBBoxDistance(getBBox(te,xe),getBBox(ne,et),Y);tt<O&&ee.push([tt,xe,et])}function pointsToPolygonDistance(ee,O,Y,te,ne=1/0){let xe=Math.min(te.distance(ee[0],Y[0][0]),ne);if(xe===0)return xe;const et=new TinyQueue([[0,[0,ee.length-1],[0,0]]],compareDistPair),tt=getPolygonBBox(Y);for(;et.length>0;){const it=et.pop();if(it[0]>=xe)continue;const st=it[1],ot=O?MinLinePointsSize:MinPointsSize;if(getRangeSize(st)<=ot){if(!isRangeSafe(st,ee.length))return NaN;if(O){const rt=lineToPolygonDistance(ee,st,Y,te);if(isNaN(rt)||rt===0)return rt;xe=Math.min(xe,rt)}else for(let rt=st[0];rt<=st[1];++rt){const nt=pointToPolygonDistance(ee[rt],Y,te);if(xe=Math.min(xe,nt),xe===0)return 0}}else{const rt=splitRange(st,O);updateQueue(et,xe,te,ee,tt,rt[0]),updateQueue(et,xe,te,ee,tt,rt[1])}}return xe}function pointSetToPointSetDistance(ee,O,Y,te,ne,xe=1/0){let et=Math.min(xe,ne.distance(ee[0],Y[0]));if(et===0)return et;const tt=new TinyQueue([[0,[0,ee.length-1],[0,Y.length-1]]],compareDistPair);for(;tt.length>0;){const it=tt.pop();if(it[0]>=et)continue;const st=it[1],ot=it[2],rt=O?MinLinePointsSize:MinPointsSize,nt=te?MinLinePointsSize:MinPointsSize;if(getRangeSize(st)<=rt&&getRangeSize(ot)<=nt){if(!isRangeSafe(st,ee.length)&&isRangeSafe(ot,Y.length))return NaN;let at;if(O&&te)at=lineToLineDistance(ee,st,Y,ot,ne),et=Math.min(et,at);else if(O&&!te){const ct=ee.slice(st[0],st[1]+1);for(let ut=ot[0];ut<=ot[1];++ut)if(at=pointToLineDistance(Y[ut],ct,ne),et=Math.min(et,at),et===0)return et}else if(!O&&te){const ct=Y.slice(ot[0],ot[1]+1);for(let ut=st[0];ut<=st[1];++ut)if(at=pointToLineDistance(ee[ut],ct,ne),et=Math.min(et,at),et===0)return et}else at=pointsToPointsDistance(ee,st,Y,ot,ne),et=Math.min(et,at)}else{const at=splitRange(st,O),ct=splitRange(ot,te);updateQueueTwoSets(tt,et,ne,ee,Y,at[0],ct[0]),updateQueueTwoSets(tt,et,ne,ee,Y,at[0],ct[1]),updateQueueTwoSets(tt,et,ne,ee,Y,at[1],ct[0]),updateQueueTwoSets(tt,et,ne,ee,Y,at[1],ct[1])}}return et}function pointToGeometryDistance(ee,O){const Y=ee.geometry(),te=Y.flat().map(et=>getLngLatFromTileCoord([et.x,et.y],ee.canonical));if(Y.length===0)return NaN;const ne=new CheapRuler(te[0][1]);let xe=1/0;for(const et of O){switch(et.type){case"Point":xe=Math.min(xe,pointSetToPointSetDistance(te,!1,[et.coordinates],!1,ne,xe));break;case"LineString":xe=Math.min(xe,pointSetToPointSetDistance(te,!1,et.coordinates,!0,ne,xe));break;case"Polygon":xe=Math.min(xe,pointsToPolygonDistance(te,!1,et.coordinates,ne,xe));break}if(xe===0)return xe}return xe}function lineStringToGeometryDistance(ee,O){const Y=ee.geometry(),te=Y.flat().map(et=>getLngLatFromTileCoord([et.x,et.y],ee.canonical));if(Y.length===0)return NaN;const ne=new CheapRuler(te[0][1]);let xe=1/0;for(const et of O){switch(et.type){case"Point":xe=Math.min(xe,pointSetToPointSetDistance(te,!0,[et.coordinates],!1,ne,xe));break;case"LineString":xe=Math.min(xe,pointSetToPointSetDistance(te,!0,et.coordinates,!0,ne,xe));break;case"Polygon":xe=Math.min(xe,pointsToPolygonDistance(te,!0,et.coordinates,ne,xe));break}if(xe===0)return xe}return xe}function polygonToGeometryDistance(ee,O){const Y=ee.geometry();if(Y.length===0||Y[0].length===0)return NaN;const te=classifyRings(Y).map(et=>et.map(tt=>tt.map(it=>getLngLatFromTileCoord([it.x,it.y],ee.canonical)))),ne=new CheapRuler(te[0][0][0][1]);let xe=1/0;for(const et of O)for(const tt of te){switch(et.type){case"Point":xe=Math.min(xe,pointsToPolygonDistance([et.coordinates],!1,tt,ne,xe));break;case"LineString":xe=Math.min(xe,pointsToPolygonDistance(et.coordinates,!0,tt,ne,xe));break;case"Polygon":xe=Math.min(xe,polygonToPolygonDistance(tt,et.coordinates,ne,xe));break}if(xe===0)return xe}return xe}function toSimpleGeometry(ee){return ee.type==="MultiPolygon"?ee.coordinates.map(O=>({type:"Polygon",coordinates:O})):ee.type==="MultiLineString"?ee.coordinates.map(O=>({type:"LineString",coordinates:O})):ee.type==="MultiPoint"?ee.coordinates.map(O=>({type:"Point",coordinates:O})):[ee]}class Distance{constructor(O,Y){this.type=NumberType,this.geojson=O,this.geometries=Y}static parse(O,Y){if(O.length!==2)return Y.error(`'distance' expression requires exactly one argument, but found ${O.length-1} instead.`);if(isValue(O[1])){const te=O[1];if(te.type==="FeatureCollection")return new Distance(te,te.features.map(ne=>toSimpleGeometry(ne.geometry)).flat());if(te.type==="Feature")return new Distance(te,toSimpleGeometry(te.geometry));if("type"in te&&"coordinates"in te)return new Distance(te,toSimpleGeometry(te))}return Y.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(O){if(O.geometry()!=null&&O.canonicalID()!=null){if(O.geometryType()==="Point")return pointToGeometryDistance(O,this.geometries);if(O.geometryType()==="LineString")return lineStringToGeometryDistance(O,this.geometries);if(O.geometryType()==="Polygon")return polygonToGeometryDistance(O,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class GlobalState{constructor(O){this.type=ValueType,this.key=O}static parse(O,Y){if(O.length!==2)return Y.error(`Expected 1 argument, but found ${O.length-1} instead.`);const te=O[1];return te==null?Y.error("Global state property must be defined."):typeof te!="string"?Y.error(`Global state property must be string, but found ${typeof O[1]} instead.`):new GlobalState(te)}evaluate(O){var Y;const te=(Y=O.globals)===null||Y===void 0?void 0:Y.globalState;return!te||Object.keys(te).length===0?null:getOwn(te,this.key)}eachChild(){}outputDefined(){return!1}}const expressions$1={"==":Equals,"!=":NotEquals,">":GreaterThan,"<":LessThan,">=":GreaterThanOrEqual,"<=":LessThanOrEqual,array:Assertion,at:At,boolean:Assertion,case:Case,coalesce:Coalesce,collator:CollatorExpression,format:FormatExpression,image:ImageExpression,in:In,"index-of":IndexOf,interpolate:Interpolate,"interpolate-hcl":Interpolate,"interpolate-lab":Interpolate,length:Length,let:Let,literal:Literal,match:Match,number:Assertion,"number-format":NumberFormat,object:Assertion,slice:Slice,step:Step,string:Assertion,"to-boolean":Coercion,"to-color":Coercion,"to-number":Coercion,"to-string":Coercion,var:Var,within:Within,distance:Distance,"global-state":GlobalState};class CompoundExpression{constructor(O,Y,te,ne){this.name=O,this.type=Y,this._evaluate=te,this.args=ne}evaluate(O){return this._evaluate(O,this.args)}eachChild(O){this.args.forEach(O)}outputDefined(){return!1}static parse(O,Y){const te=O[0],ne=CompoundExpression.definitions[te];if(!ne)return Y.error(`Unknown expression "${te}". If you wanted a literal array, use ["literal", [...]].`,0);const xe=Array.isArray(ne)?ne[0]:ne.type,et=Array.isArray(ne)?[[ne[1],ne[2]]]:ne.overloads,tt=et.filter(([st])=>!Array.isArray(st)||st.length===O.length-1);let it=null;for(const[st,ot]of tt){it=new ParsingContext(Y.registry,isExpressionConstant,Y.path,null,Y.scope);const rt=[];let nt=!1;for(let at=1;at<O.length;at++){const ct=O[at],ut=Array.isArray(st)?st[at-1]:st.type,dt=it.parse(ct,1+rt.length,ut);if(!dt){nt=!0;break}rt.push(dt)}if(!nt){if(Array.isArray(st)&&st.length!==rt.length){it.error(`Expected ${st.length} arguments, but found ${rt.length} instead.`);continue}for(let at=0;at<rt.length;at++){const ct=Array.isArray(st)?st[at]:st.type,ut=rt[at];it.concat(at+1).checkSubtype(ct,ut.type)}if(it.errors.length===0)return new CompoundExpression(te,xe,ot,rt)}}if(tt.length===1)Y.errors.push(...it.errors);else{const ot=(tt.length?tt:et).map(([nt])=>stringifySignature(nt)).join(" | "),rt=[];for(let nt=1;nt<O.length;nt++){const at=Y.parse(O[nt],1+rt.length);if(!at)return null;rt.push(typeToString(at.type))}Y.error(`Expected arguments of type ${ot}, but found (${rt.join(", ")}) instead.`)}return null}static register(O,Y){CompoundExpression.definitions=Y;for(const te in Y)O[te]=CompoundExpression}}function rgba(ee,[O,Y,te,ne]){O=O.evaluate(ee),Y=Y.evaluate(ee),te=te.evaluate(ee);const xe=ne?ne.evaluate(ee):1,et=validateRGBA(O,Y,te,xe);if(et)throw new RuntimeError(et);return new Color(O/255,Y/255,te/255,xe,!1)}function has(ee,O){return ee in O}function get(ee,O){const Y=O[ee];return typeof Y>"u"?null:Y}function binarySearch(ee,O,Y,te){for(;Y<=te;){const ne=Y+te>>1;if(O[ne]===ee)return!0;O[ne]>ee?te=ne-1:Y=ne+1}return!1}function varargs(ee){return{type:ee}}CompoundExpression.register(expressions$1,{error:[ErrorType,[StringType],(ee,[O])=>{throw new RuntimeError(O.evaluate(ee))}],typeof:[StringType,[ValueType],(ee,[O])=>typeToString(typeOf(O.evaluate(ee)))],"to-rgba":[array(NumberType,4),[ColorType],(ee,[O])=>{const[Y,te,ne,xe]=O.evaluate(ee).rgb;return[Y*255,te*255,ne*255,xe]}],rgb:[ColorType,[NumberType,NumberType,NumberType],rgba],rgba:[ColorType,[NumberType,NumberType,NumberType,NumberType],rgba],has:{type:BooleanType,overloads:[[[StringType],(ee,[O])=>has(O.evaluate(ee),ee.properties())],[[StringType,ObjectType],(ee,[O,Y])=>has(O.evaluate(ee),Y.evaluate(ee))]]},get:{type:ValueType,overloads:[[[StringType],(ee,[O])=>get(O.evaluate(ee),ee.properties())],[[StringType,ObjectType],(ee,[O,Y])=>get(O.evaluate(ee),Y.evaluate(ee))]]},"feature-state":[ValueType,[StringType],(ee,[O])=>get(O.evaluate(ee),ee.featureState||{})],properties:[ObjectType,[],ee=>ee.properties()],"geometry-type":[StringType,[],ee=>ee.geometryType()],id:[ValueType,[],ee=>ee.id()],zoom:[NumberType,[],ee=>ee.globals.zoom],"heatmap-density":[NumberType,[],ee=>ee.globals.heatmapDensity||0],elevation:[NumberType,[],ee=>ee.globals.elevation||0],"line-progress":[NumberType,[],ee=>ee.globals.lineProgress||0],accumulated:[ValueType,[],ee=>ee.globals.accumulated===void 0?null:ee.globals.accumulated],"+":[NumberType,varargs(NumberType),(ee,O)=>{let Y=0;for(const te of O)Y+=te.evaluate(ee);return Y}],"*":[NumberType,varargs(NumberType),(ee,O)=>{let Y=1;for(const te of O)Y*=te.evaluate(ee);return Y}],"-":{type:NumberType,overloads:[[[NumberType,NumberType],(ee,[O,Y])=>O.evaluate(ee)-Y.evaluate(ee)],[[NumberType],(ee,[O])=>-O.evaluate(ee)]]},"/":[NumberType,[NumberType,NumberType],(ee,[O,Y])=>O.evaluate(ee)/Y.evaluate(ee)],"%":[NumberType,[NumberType,NumberType],(ee,[O,Y])=>O.evaluate(ee)%Y.evaluate(ee)],ln2:[NumberType,[],()=>Math.LN2],pi:[NumberType,[],()=>Math.PI],e:[NumberType,[],()=>Math.E],"^":[NumberType,[NumberType,NumberType],(ee,[O,Y])=>Math.pow(O.evaluate(ee),Y.evaluate(ee))],sqrt:[NumberType,[NumberType],(ee,[O])=>Math.sqrt(O.evaluate(ee))],log10:[NumberType,[NumberType],(ee,[O])=>Math.log(O.evaluate(ee))/Math.LN10],ln:[NumberType,[NumberType],(ee,[O])=>Math.log(O.evaluate(ee))],log2:[NumberType,[NumberType],(ee,[O])=>Math.log(O.evaluate(ee))/Math.LN2],sin:[NumberType,[NumberType],(ee,[O])=>Math.sin(O.evaluate(ee))],cos:[NumberType,[NumberType],(ee,[O])=>Math.cos(O.evaluate(ee))],tan:[NumberType,[NumberType],(ee,[O])=>Math.tan(O.evaluate(ee))],asin:[NumberType,[NumberType],(ee,[O])=>Math.asin(O.evaluate(ee))],acos:[NumberType,[NumberType],(ee,[O])=>Math.acos(O.evaluate(ee))],atan:[NumberType,[NumberType],(ee,[O])=>Math.atan(O.evaluate(ee))],min:[NumberType,varargs(NumberType),(ee,O)=>Math.min(...O.map(Y=>Y.evaluate(ee)))],max:[NumberType,varargs(NumberType),(ee,O)=>Math.max(...O.map(Y=>Y.evaluate(ee)))],abs:[NumberType,[NumberType],(ee,[O])=>Math.abs(O.evaluate(ee))],round:[NumberType,[NumberType],(ee,[O])=>{const Y=O.evaluate(ee);return Y<0?-Math.round(-Y):Math.round(Y)}],floor:[NumberType,[NumberType],(ee,[O])=>Math.floor(O.evaluate(ee))],ceil:[NumberType,[NumberType],(ee,[O])=>Math.ceil(O.evaluate(ee))],"filter-==":[BooleanType,[StringType,ValueType],(ee,[O,Y])=>ee.properties()[O.value]===Y.value],"filter-id-==":[BooleanType,[ValueType],(ee,[O])=>ee.id()===O.value],"filter-type-==":[BooleanType,[StringType],(ee,[O])=>ee.geometryType()===O.value],"filter-<":[BooleanType,[StringType,ValueType],(ee,[O,Y])=>{const te=ee.properties()[O.value],ne=Y.value;return typeof te==typeof ne&&te<ne}],"filter-id-<":[BooleanType,[ValueType],(ee,[O])=>{const Y=ee.id(),te=O.value;return typeof Y==typeof te&&Y<te}],"filter->":[BooleanType,[StringType,ValueType],(ee,[O,Y])=>{const te=ee.properties()[O.value],ne=Y.value;return typeof te==typeof ne&&te>ne}],"filter-id->":[BooleanType,[ValueType],(ee,[O])=>{const Y=ee.id(),te=O.value;return typeof Y==typeof te&&Y>te}],"filter-<=":[BooleanType,[StringType,ValueType],(ee,[O,Y])=>{const te=ee.properties()[O.value],ne=Y.value;return typeof te==typeof ne&&te<=ne}],"filter-id-<=":[BooleanType,[ValueType],(ee,[O])=>{const Y=ee.id(),te=O.value;return typeof Y==typeof te&&Y<=te}],"filter->=":[BooleanType,[StringType,ValueType],(ee,[O,Y])=>{const te=ee.properties()[O.value],ne=Y.value;return typeof te==typeof ne&&te>=ne}],"filter-id->=":[BooleanType,[ValueType],(ee,[O])=>{const Y=ee.id(),te=O.value;return typeof Y==typeof te&&Y>=te}],"filter-has":[BooleanType,[ValueType],(ee,[O])=>O.value in ee.properties()],"filter-has-id":[BooleanType,[],ee=>ee.id()!==null&&ee.id()!==void 0],"filter-type-in":[BooleanType,[array(StringType)],(ee,[O])=>O.value.indexOf(ee.geometryType())>=0],"filter-id-in":[BooleanType,[array(ValueType)],(ee,[O])=>O.value.indexOf(ee.id())>=0],"filter-in-small":[BooleanType,[StringType,array(ValueType)],(ee,[O,Y])=>Y.value.indexOf(ee.properties()[O.value])>=0],"filter-in-large":[BooleanType,[StringType,array(ValueType)],(ee,[O,Y])=>binarySearch(ee.properties()[O.value],Y.value,0,Y.value.length-1)],all:{type:BooleanType,overloads:[[[BooleanType,BooleanType],(ee,[O,Y])=>O.evaluate(ee)&&Y.evaluate(ee)],[varargs(BooleanType),(ee,O)=>{for(const Y of O)if(!Y.evaluate(ee))return!1;return!0}]]},any:{type:BooleanType,overloads:[[[BooleanType,BooleanType],(ee,[O,Y])=>O.evaluate(ee)||Y.evaluate(ee)],[varargs(BooleanType),(ee,O)=>{for(const Y of O)if(Y.evaluate(ee))return!0;return!1}]]},"!":[BooleanType,[BooleanType],(ee,[O])=>!O.evaluate(ee)],"is-supported-script":[BooleanType,[StringType],(ee,[O])=>{const Y=ee.globals&&ee.globals.isSupportedScript;return Y?Y(O.evaluate(ee)):!0}],upcase:[StringType,[StringType],(ee,[O])=>O.evaluate(ee).toUpperCase()],downcase:[StringType,[StringType],(ee,[O])=>O.evaluate(ee).toLowerCase()],concat:[StringType,varargs(ValueType),(ee,O)=>O.map(Y=>valueToString(Y.evaluate(ee))).join("")],"resolved-locale":[StringType,[CollatorType],(ee,[O])=>O.evaluate(ee).resolvedLocale()]});function stringifySignature(ee){return Array.isArray(ee)?`(${ee.map(typeToString).join(", ")})`:`(${typeToString(ee.type)}...)`}function isExpressionConstant(ee){if(ee instanceof Var)return isExpressionConstant(ee.boundExpression);if(ee instanceof CompoundExpression&&ee.name==="error")return!1;if(ee instanceof CollatorExpression)return!1;if(ee instanceof Within)return!1;if(ee instanceof Distance)return!1;if(ee instanceof GlobalState)return!1;const O=ee instanceof Coercion||ee instanceof Assertion;let Y=!0;return ee.eachChild(te=>{O?Y=Y&&isExpressionConstant(te):Y=Y&&te instanceof Literal}),Y?isFeatureConstant(ee)&&isGlobalPropertyConstant(ee,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function isFeatureConstant(ee){if(ee instanceof CompoundExpression){if(ee.name==="get"&&ee.args.length===1)return!1;if(ee.name==="feature-state")return!1;if(ee.name==="has"&&ee.args.length===1)return!1;if(ee.name==="properties"||ee.name==="geometry-type"||ee.name==="id")return!1;if(/^filter-/.test(ee.name))return!1}if(ee instanceof Within||ee instanceof Distance)return!1;let O=!0;return ee.eachChild(Y=>{O&&!isFeatureConstant(Y)&&(O=!1)}),O}function isStateConstant(ee){if(ee instanceof CompoundExpression&&ee.name==="feature-state")return!1;let O=!0;return ee.eachChild(Y=>{O&&!isStateConstant(Y)&&(O=!1)}),O}function isGlobalPropertyConstant(ee,O){if(ee instanceof CompoundExpression&&O.indexOf(ee.name)>=0)return!1;let Y=!0;return ee.eachChild(te=>{Y&&!isGlobalPropertyConstant(te,O)&&(Y=!1)}),Y}function success(ee){return{result:"success",value:ee}}function error(ee){return{result:"error",value:ee}}function supportsPropertyExpression(ee){return ee["property-type"]==="data-driven"||ee["property-type"]==="cross-faded-data-driven"}function supportsZoomExpression(ee){return!!ee.expression&&ee.expression.parameters.indexOf("zoom")>-1}function supportsInterpolation(ee){return!!ee.expression&&ee.expression.interpolated}function isFunction$1(ee){return typeof ee=="object"&&ee!==null&&!Array.isArray(ee)&&typeOf(ee)===ObjectType}class StyleExpression{constructor(O,Y){this.expression=O,this._warningHistory={},this._evaluator=new EvaluationContext,this._defaultValue=Y?getDefaultValue(Y):null,this._enumValues=Y&&Y.type==="enum"?Y.values:null}evaluateWithoutErrorHandling(O,Y,te,ne,xe,et){return this._evaluator.globals=O,this._evaluator.feature=Y,this._evaluator.featureState=te,this._evaluator.canonical=ne,this._evaluator.availableImages=xe||null,this._evaluator.formattedSection=et,this.expression.evaluate(this._evaluator)}evaluate(O,Y,te,ne,xe,et){this._evaluator.globals=O,this._evaluator.feature=Y||null,this._evaluator.featureState=te||null,this._evaluator.canonical=ne,this._evaluator.availableImages=xe||null,this._evaluator.formattedSection=et||null;try{const tt=this.expression.evaluate(this._evaluator);if(tt==null||typeof tt=="number"&&tt!==tt)return this._defaultValue;if(this._enumValues&&!(tt in this._enumValues))throw new RuntimeError(`Expected value to be one of ${Object.keys(this._enumValues).map(it=>JSON.stringify(it)).join(", ")}, but found ${JSON.stringify(tt)} instead.`);return tt}catch(tt){return this._warningHistory[tt.message]||(this._warningHistory[tt.message]=!0,typeof console<"u"&&console.warn(tt.message)),this._defaultValue}}}function isExpression(ee){return Array.isArray(ee)&&ee.length>0&&typeof ee[0]=="string"&&ee[0]in expressions$1}function createExpression(ee,O){const Y=new ParsingContext(expressions$1,isExpressionConstant,[],O?getExpectedType(O):void 0),te=Y.parse(ee,void 0,void 0,void 0,O&&O.type==="string"?{typeAnnotation:"coerce"}:void 0);return te?success(new StyleExpression(te,O)):error(Y.errors)}class ZoomConstantExpression{constructor(O,Y){this.kind=O,this._styleExpression=Y,this.isStateDependent=O!=="constant"&&!isStateConstant(Y.expression),this.globalStateRefs=findGlobalStateRefs(Y.expression)}evaluateWithoutErrorHandling(O,Y,te,ne,xe,et){return this._styleExpression.evaluateWithoutErrorHandling(O,Y,te,ne,xe,et)}evaluate(O,Y,te,ne,xe,et){return this._styleExpression.evaluate(O,Y,te,ne,xe,et)}}class ZoomDependentExpression{constructor(O,Y,te,ne){this.kind=O,this.zoomStops=te,this._styleExpression=Y,this.isStateDependent=O!=="camera"&&!isStateConstant(Y.expression),this.globalStateRefs=findGlobalStateRefs(Y.expression),this.interpolationType=ne}evaluateWithoutErrorHandling(O,Y,te,ne,xe,et){return this._styleExpression.evaluateWithoutErrorHandling(O,Y,te,ne,xe,et)}evaluate(O,Y,te,ne,xe,et){return this._styleExpression.evaluate(O,Y,te,ne,xe,et)}interpolationFactor(O,Y,te){return this.interpolationType?Interpolate.interpolationFactor(this.interpolationType,O,Y,te):0}}function createPropertyExpression(ee,O){const Y=createExpression(ee,O);if(Y.result==="error")return Y;const te=Y.value.expression,ne=isFeatureConstant(te);if(!ne&&!supportsPropertyExpression(O))return error([new ExpressionParsingError("","data expressions not supported")]);const xe=isGlobalPropertyConstant(te,["zoom"]);if(!xe&&!supportsZoomExpression(O))return error([new ExpressionParsingError("","zoom expressions not supported")]);const et=findZoomCurve(te);if(!et&&!xe)return error([new ExpressionParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(et instanceof ExpressionParsingError)return error([et]);if(et instanceof Interpolate&&!supportsInterpolation(O))return error([new ExpressionParsingError("",'"interpolate" expressions cannot be used with this property')]);if(!et)return success(ne?new ZoomConstantExpression("constant",Y.value):new ZoomConstantExpression("source",Y.value));const tt=et instanceof Interpolate?et.interpolation:void 0;return success(ne?new ZoomDependentExpression("camera",Y.value,et.labels,tt):new ZoomDependentExpression("composite",Y.value,et.labels,tt))}function findZoomCurve(ee){let O=null;if(ee instanceof Let)O=findZoomCurve(ee.result);else if(ee instanceof Coalesce){for(const Y of ee.args)if(O=findZoomCurve(Y),O)break}else(ee instanceof Step||ee instanceof Interpolate)&&ee.input instanceof CompoundExpression&&ee.input.name==="zoom"&&(O=ee);return O instanceof ExpressionParsingError||ee.eachChild(Y=>{const te=findZoomCurve(Y);te instanceof ExpressionParsingError?O=te:!O&&te?O=new ExpressionParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):O&&te&&O!==te&&(O=new ExpressionParsingError("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),O}function findGlobalStateRefs(ee,O=new Set){return ee instanceof GlobalState&&O.add(ee.key),ee.eachChild(Y=>{findGlobalStateRefs(Y,O)}),O}function getExpectedType(ee){const O={color:ColorType,string:StringType,number:NumberType,enum:StringType,boolean:BooleanType,formatted:FormattedType,padding:PaddingType,numberArray:NumberArrayType,colorArray:ColorArrayType,projectionDefinition:ProjectionDefinitionType,resolvedImage:ResolvedImageType,variableAnchorOffsetCollection:VariableAnchorOffsetCollectionType};return ee.type==="array"?array(O[ee.value]||ValueType,ee.length):O[ee.type]}function getDefaultValue(ee){if(ee.type==="color"&&isFunction$1(ee.default))return new Color(0,0,0,0);switch(ee.type){case"color":return Color.parse(ee.default)||null;case"padding":return Padding.parse(ee.default)||null;case"numberArray":return NumberArray.parse(ee.default)||null;case"colorArray":return ColorArray.parse(ee.default)||null;case"variableAnchorOffsetCollection":return VariableAnchorOffsetCollection.parse(ee.default)||null;case"projectionDefinition":return ProjectionDefinition.parse(ee.default)||null;default:return ee.default===void 0?null:ee.default}}function isExpressionFilter(ee){if(ee===!0||ee===!1)return!0;if(!Array.isArray(ee)||ee.length===0)return!1;switch(ee[0]){case"has":return ee.length>=2&&ee[1]!=="$id"&&ee[1]!=="$type";case"in":return ee.length>=3&&(typeof ee[1]!="string"||Array.isArray(ee[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return ee.length!==3||Array.isArray(ee[1])||Array.isArray(ee[2]);case"any":case"all":for(const O of ee.slice(1))if(!isExpressionFilter(O)&&typeof O!="boolean")return!1;return!0;default:return!0}}const filterSpec={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function featureFilter(ee){if(ee==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};isExpressionFilter(ee)||(ee=convertFilter$1(ee));const O=createExpression(ee,filterSpec);if(O.result==="error")throw new Error(O.value.map(Y=>`${Y.key}: ${Y.message}`).join(", "));{const Y=geometryNeeded(ee);return{filter:(te,ne,xe)=>O.value.evaluate(te,ne,{},xe),needGeometry:Y,getGlobalStateRefs:()=>findGlobalStateRefs(O.value.expression)}}}function compare(ee,O){return ee<O?-1:ee>O?1:0}function geometryNeeded(ee){if(!Array.isArray(ee))return!1;if(ee[0]==="within"||ee[0]==="distance")return!0;for(let O=1;O<ee.length;O++)if(geometryNeeded(ee[O]))return!0;return!1}function convertFilter$1(ee){if(!ee)return!0;const O=ee[0];return ee.length<=1?O!=="any":O==="=="?convertComparisonOp$1(ee[1],ee[2],"=="):O==="!="?convertNegation(convertComparisonOp$1(ee[1],ee[2],"==")):O==="<"||O===">"||O==="<="||O===">="?convertComparisonOp$1(ee[1],ee[2],O):O==="any"?convertDisjunctionOp(ee.slice(1)):O==="all"?["all"].concat(ee.slice(1).map(convertFilter$1)):O==="none"?["all"].concat(ee.slice(1).map(convertFilter$1).map(convertNegation)):O==="in"?convertInOp$1(ee[1],ee.slice(2)):O==="!in"?convertNegation(convertInOp$1(ee[1],ee.slice(2))):O==="has"?convertHasOp$1(ee[1]):O==="!has"?convertNegation(convertHasOp$1(ee[1])):!0}function convertComparisonOp$1(ee,O,Y){switch(ee){case"$type":return[`filter-type-${Y}`,O];case"$id":return[`filter-id-${Y}`,O];default:return[`filter-${Y}`,ee,O]}}function convertDisjunctionOp(ee){return["any"].concat(ee.map(convertFilter$1))}function convertInOp$1(ee,O){if(O.length===0)return!1;switch(ee){case"$type":return["filter-type-in",["literal",O]];case"$id":return["filter-id-in",["literal",O]];default:return O.length>200&&!O.some(Y=>typeof Y!=typeof O[0])?["filter-in-large",ee,["literal",O.sort(compare)]]:["filter-in-small",ee,["literal",O]]}}function convertHasOp$1(ee){switch(ee){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",ee]}}function convertNegation(ee){return["!",ee]}function convertLiteral(ee){return typeof ee=="object"?["literal",ee]:ee}function convertFunction(ee,O){let Y=ee.stops;if(!Y)return convertIdentityFunction(ee,O);const te=Y&&typeof Y[0][0]=="object",ne=te||ee.property!==void 0,xe=te||!ne;return Y=Y.map(et=>!ne&&O.tokens&&typeof et[1]=="string"?[et[0],convertTokenString(et[1])]:[et[0],convertLiteral(et[1])]),te?convertZoomAndPropertyFunction(ee,O,Y):xe?convertZoomFunction(ee,O,Y):convertPropertyFunction(ee,O,Y)}function convertIdentityFunction(ee,O){const Y=["get",ee.property];if(ee.default===void 0)return O.type==="string"?["string",Y]:Y;if(O.type==="enum")return["match",Y,Object.keys(O.values),Y,ee.default];{const te=[O.type==="color"?"to-color":O.type,Y,convertLiteral(ee.default)];return O.type==="array"&&te.splice(1,0,O.value,O.length||null),te}}function getInterpolateOperator(ee){switch(ee.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function convertZoomAndPropertyFunction(ee,O,Y){const te={},ne={},xe=[];for(let tt=0;tt<Y.length;tt++){const it=Y[tt],st=it[0].zoom;te[st]===void 0&&(te[st]={zoom:st,type:ee.type,property:ee.property,default:ee.default},ne[st]=[],xe.push(st)),ne[st].push([it[0].value,it[1]])}if(getFunctionType({},O)==="exponential"){const tt=[getInterpolateOperator(ee),["linear"],["zoom"]];for(const it of xe){const st=convertPropertyFunction(te[it],O,ne[it]);appendStopPair(tt,it,st,!1)}return tt}else{const tt=["step",["zoom"]];for(const it of xe){const st=convertPropertyFunction(te[it],O,ne[it]);appendStopPair(tt,it,st,!0)}return fixupDegenerateStepCurve(tt),tt}}function coalesce(ee,O){if(ee!==void 0)return ee;if(O!==void 0)return O}function getFallback(ee,O){const Y=convertLiteral(coalesce(ee.default,O.default));return Y===void 0&&O.type==="resolvedImage"?"":Y}function convertPropertyFunction(ee,O,Y){const te=getFunctionType(ee,O),ne=["get",ee.property];if(te==="categorical"&&typeof Y[0][0]=="boolean"){const xe=["case"];for(const et of Y)xe.push(["==",ne,et[0]],et[1]);return xe.push(getFallback(ee,O)),xe}else if(te==="categorical"){const xe=["match",ne];for(const et of Y)appendStopPair(xe,et[0],et[1],!1);return xe.push(getFallback(ee,O)),xe}else if(te==="interval"){const xe=["step",["number",ne]];for(const et of Y)appendStopPair(xe,et[0],et[1],!0);return fixupDegenerateStepCurve(xe),ee.default===void 0?xe:["case",["==",["typeof",ne],"number"],xe,convertLiteral(ee.default)]}else if(te==="exponential"){const xe=ee.base!==void 0?ee.base:1,et=[getInterpolateOperator(ee),xe===1?["linear"]:["exponential",xe],["number",ne]];for(const tt of Y)appendStopPair(et,tt[0],tt[1],!1);return ee.default===void 0?et:["case",["==",["typeof",ne],"number"],et,convertLiteral(ee.default)]}else throw new Error(`Unknown property function type ${te}`)}function convertZoomFunction(ee,O,Y,te=["zoom"]){const ne=getFunctionType(ee,O);let xe,et=!1;if(ne==="interval")xe=["step",te],et=!0;else if(ne==="exponential"){const tt=ee.base!==void 0?ee.base:1;xe=[getInterpolateOperator(ee),tt===1?["linear"]:["exponential",tt],te]}else throw new Error(`Unknown zoom function type "${ne}"`);for(const tt of Y)appendStopPair(xe,tt[0],tt[1],et);return fixupDegenerateStepCurve(xe),xe}function fixupDegenerateStepCurve(ee){ee[0]==="step"&&ee.length===3&&(ee.push(0),ee.push(ee[3]))}function appendStopPair(ee,O,Y,te){ee.length>3&&O===ee[ee.length-2]||(te&&ee.length===2||ee.push(O),ee.push(Y))}function getFunctionType(ee,O){return ee.type?ee.type:O.expression.interpolated?"exponential":"interval"}function convertTokenString(ee){const O=["concat"],Y=/{([^{}]+)}/g;let te=0;for(let ne=Y.exec(ee);ne!==null;ne=Y.exec(ee)){const xe=ee.slice(te,Y.lastIndex-ne[0].length);te=Y.lastIndex,xe.length>0&&O.push(xe),O.push(["get",ne[1]])}if(O.length===1)return ee;if(te<ee.length)O.push(ee.slice(te));else if(O.length===2)return["to-string",O[1]];return O}const v8=v8Spec;var fontWeights={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},sp=" ",italicRE=/(italic|oblique)$/i,fontCache={};function mb2css(ee,O,Y){var te=fontCache[ee];if(!te){Array.isArray(ee)||(ee=[ee]);for(var ne=400,xe="normal",et=[],tt,it,st=0,ot=ee.length;st<ot;++st){var rt=ee[st],nt=rt.split(" "),at=nt[nt.length-1].toLowerCase();at=="normal"||at=="italic"||at=="oblique"?(xe=it?xe:at,it=!0,nt.pop(),at=nt[nt.length-1].toLowerCase()):italicRE.test(at)&&(at=at.replace(italicRE,""),xe=it?xe:nt[nt.length-1].replace(at,""),it=!0);for(var ct in fontWeights){var ut=nt.length>1?nt[nt.length-2].toLowerCase():"";if(at==ct||at==ct.replace("-","")||ut+"-"+at==ct){ne=tt?ne:fontWeights[ct],nt.pop(),ut&&ct.startsWith(ut)&&nt.pop();break}}!tt&&typeof at=="number"&&(ne=at,tt=!0);var dt=nt.join(sp).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");dt.indexOf(sp)!==-1&&(dt='"'+dt+'"'),et.push(dt)}te=fontCache[ee]=[xe,ne,et]}return te[0]+sp+te[1]+sp+O+"px"+(Y?"/"+Y:"")+sp+te[2]}const mapboxBaseUrl="https://api.mapbox.com";function getMapboxPath(ee){const O="mapbox://";return ee.indexOf(O)!==0?"":ee.slice(O.length)}function normalizeSpriteDefinition(ee,O,Y){if(typeof ee=="string")return[{id:"default",url:normalizeSpriteUrl(ee,O,Y)}];for(const te of ee)te.url=normalizeSpriteUrl(te.url,O,Y);return ee}function normalizeSpriteUrl(ee,O,Y){const te=getMapboxPath(ee);if(!te)return decodeURI(new URL(ee,Y).href);const ne="sprites/";if(te.indexOf(ne)!==0)throw new Error(`unexpected sprites url: ${ee}`);const xe=te.slice(ne.length);return`${mapboxBaseUrl}/styles/v1/${xe}/sprite?access_token=${O}`}function normalizeStyleUrl(ee,O){const Y=getMapboxPath(ee);if(!Y)return decodeURI(new URL(ee,location.href).href);const te="styles/";if(Y.indexOf(te)!==0)throw new Error(`unexpected style url: ${ee}`);const ne=Y.slice(te.length);return`${mapboxBaseUrl}/styles/v1/${ne}?&access_token=${O}`}const mapboxSubdomains=["a","b","c","d"];function normalizeSourceUrl(ee,O,Y,te){const ne=new URL(ee,te||location.href),xe=getMapboxPath(ee);if(!xe)return O?(ne.searchParams.has(Y)||ne.searchParams.set(Y,O),[decodeURI(ne.href)]):[decodeURI(ne.href)];if(xe==="mapbox.satellite"){const et=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${xe}/{z}/{x}/{y}${et}.webp?access_token=${O}`]}return mapboxSubdomains.map(et=>`https://${et}.tiles.mapbox.com/v4/${xe}/{z}/{x}/{y}.vector.pbf?access_token=${O}`)}const emptyObj=Object.freeze({}),functionCacheByStyleId={},filterCacheByStyleId={};let styleId=0;function getStyleId(ee){return ee.id||(ee.id=styleId++),ee.id}function getStyleFunctionKey(ee,O){return getStyleId(ee)+"."+getUid(O)}function getFunctionCache(ee){let O=functionCacheByStyleId[ee.id];return O||(O={},functionCacheByStyleId[getStyleId(ee)]=O),O}function getFilterCache(ee){let O=filterCacheByStyleId[ee.id];return O||(O={},filterCacheByStyleId[getStyleId(ee)]=O),O}function deg2rad(ee){return ee*Math.PI/180}const defaultResolutions=(function(){const ee=[];for(let O=78271.51696402048;ee.length<=24;O/=2)ee.push(O);return ee})();function createCanvas(ee,O){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(ee,O);const Y=document.createElement("canvas");return Y.width=ee,Y.height=O,Y}function getZoomForResolution(ee,O){let Y=0;const te=O.length;for(;Y<te;++Y)if(O[Y]<ee&&Y+1<te){const xe=O[Y]/O[Y+1];return Y+Math.log(O[Y]/ee)/Math.log(xe)}return te-1}function getResolutionForZoom(ee,O){const Y=Math.floor(ee),te=Math.pow(2,ee-Y);return O[Y]/te}const pendingRequests={};function fetchResource(ee,O,Y={},te){if(O in pendingRequests)return te&&(te.url=pendingRequests[O][0].url),pendingRequests[O][1];const ne=Y.transformRequest&&Y.transformRequest(O,ee)||O,xe=function(it){return delete pendingRequests[O],Promise.reject(new Error("Error fetching source "+O))},et=function(it){return delete pendingRequests[O],it.ok?it.json():Promise.reject(new Error("Error fetching source "+O))},tt=toPromise(()=>ne).then(it=>it instanceof Response?(te&&(te.url=it.url),et(it)):(it instanceof Request||(it=new Request(it)),it.headers.get("Accept")||it.headers.set("Accept","application/json"),te&&(te.url=it.url),fetch(it).then(et).catch(xe))).catch(xe);return pendingRequests[O]=[ne,tt],tt}function getGlStyle(ee,O){if(typeof ee=="string")if(ee.trim().startsWith("{"))try{const Y=JSON.parse(ee);return Promise.resolve(Y)}catch(Y){return Promise.reject(Y)}else return ee=normalizeStyleUrl(ee,O.accessToken),fetchResource("Style",ee,O);else return Promise.resolve(ee)}const tilejsonCache={};function getTileJson(ee,O,Y={}){const te=[O,JSON.stringify(ee)].toString();let ne=tilejsonCache[te];if(!ne||Y.transformRequest){let xe;Y.transformRequest&&(xe=(tt,it)=>{const st=Y.transformRequest&&Y.transformRequest(it,"Tiles")||it;if(tt instanceof VectorTile$1)tt.setLoader((ot,rt,nt)=>{const at=function(ct){ct.arrayBuffer().then(ut=>{const ht=tt.getFormat().readFeatures(ut,{extent:ot,featureProjection:nt});tt.setFeatures(ht)})};toPromise(()=>st).then(ct=>{if(ct instanceof Response)return at(ct);fetch(ct).then(at).catch(ut=>tt.setState(TileState.ERROR))}).catch(ct=>tt.setState(TileState.ERROR))});else{const ot=tt.getImage();toPromise(()=>st).then(rt=>{if(typeof rt=="string"){ot.src=rt;return}const nt=at=>at.blob().then(ct=>{const ut=URL.createObjectURL(ct);ot.addEventListener("load",()=>URL.revokeObjectURL(ut)),ot.addEventListener("error",()=>URL.revokeObjectURL(ut)),ot.src=ut});if(rt instanceof Response)return nt(rt);fetch(rt).then(nt).catch(at=>tt.setState(TileState.ERROR))}).catch(rt=>tt.setState(TileState.ERROR))}});const et=ee.url;if(et&&!ee.tiles){const tt=normalizeSourceUrl(et,Y.accessToken,Y.accessTokenParam||"access_token",O||location.href);if(et.startsWith("mapbox://"))ne=Promise.resolve({tileJson:Object.assign({},ee,{url:void 0,tiles:tt}),tileLoadFunction:xe});else{const it={};ne=fetchResource("Source",tt[0],Y,it).then(function(st){return st.tiles=st.tiles.map(function(ot){return st.scheme==="tms"&&(ot=ot.replace("{y}","{-y}")),normalizeSourceUrl(ot,Y.accessToken,Y.accessTokenParam||"access_token",it.url)[0]}),Promise.resolve({tileJson:st,tileLoadFunction:xe})})}}else ee.tiles?(ee=Object.assign({},ee,{tiles:ee.tiles.map(function(tt){return ee.scheme==="tms"&&(tt=tt.replace("{y}","{-y}")),normalizeSourceUrl(tt,Y.accessToken,Y.accessTokenParam||"access_token",O||location.href)[0]})}),ne=Promise.resolve({tileJson:Object.assign({},ee),tileLoadFunction:xe})):ne=Promise.reject(new Error("source has no `tiles` nor `url`"));tilejsonCache[te]=ne}return ne}function drawIconHalo(ee,O,Y,te){const ne=[2*Y*O.pixelRatio+O.width,2*Y*O.pixelRatio+O.height],xe=createCanvas(ne[0],ne[1]),et=xe.getContext("2d");et.drawImage(ee,O.x,O.y,O.width,O.height,Y*O.pixelRatio,Y*O.pixelRatio,O.width,O.height);const tt=et.getImageData(0,0,ne[0],ne[1]);et.globalCompositeOperation="destination-over",et.fillStyle=`rgba(${te.r*255},${te.g*255},${te.b*255},${te.a})`;const it=tt.data;for(let st=0,ot=tt.width;st<ot;++st)for(let rt=0,nt=tt.height;rt<nt;++rt){const at=(rt*ot+st)*4;it[at+3]>0&&et.arc(st,rt,Y*O.pixelRatio,0,2*Math.PI)}return et.fill(),xe}function smoothstep(ee,O,Y){const te=Math.max(0,Math.min(1,(Y-ee)/(O-ee)));return te*te*(3-2*te)}function drawSDF(ee,O,Y){const te=createCanvas(O.width,O.height),ne=te.getContext("2d");ne.drawImage(ee,O.x,O.y,O.width,O.height,0,0,O.width,O.height);const xe=ne.getImageData(0,0,O.width,O.height),et=xe.data;for(let tt=0,it=xe.width;tt<it;++tt)for(let st=0,ot=xe.height;st<ot;++st){const rt=(st*it+tt)*4,nt=et[rt+3]/255,at=.75,ct=.1,ut=smoothstep(at-ct,at+ct,nt);ut>0?(et[rt+0]=Math.round(255*Y.r*ut),et[rt+1]=Math.round(255*Y.g*ut),et[rt+2]=Math.round(255*Y.b*ut),et[rt+3]=Math.round(255*ut)):et[rt+3]=0}return ne.putImageData(xe,0,0),te}const hairSpacePool=Array(256).join("");function applyLetterSpacing(ee,O){if(O>=.05){let Y="";const te=ee.split(`
`),ne=hairSpacePool.slice(0,Math.round(O/.1));for(let xe=0,et=te.length;xe<et;++xe)xe>0&&(Y+=`
`),Y+=te[xe].split("").join(ne);return Y}return ee}let measureContext;function getMeasureContext(){return measureContext||(measureContext=createCanvas(1,1).getContext("2d")),measureContext}function measureText(ee,O){return getMeasureContext().measureText(ee).width+(ee.length-1)*O}const measureCache={};checkedFonts.on("propertychange",()=>{for(const ee in measureCache)delete measureCache[ee]});function wrapText(ee,O,Y,te){if(ee.indexOf(`
`)!==-1){const et=ee.split(`
`),tt=[];for(let it=0,st=et.length;it<st;++it)tt.push(wrapText(et[it],O,Y,te));return tt.join(`
`)}const ne=Y+","+O+","+ee+","+te;let xe=measureCache[ne];if(!xe){const et=ee.split(" ");if(et.length>1){const tt=getMeasureContext();tt.font=O;const st=tt.measureText("M").width*Y;let ot="";const rt=[];for(let nt=0,at=et.length;nt<at;++nt){const ct=et[nt],ut=ot+(ot?" ":"")+ct;measureText(ut,te)<=st?ot=ut:(ot&&rt.push(ot),ot=ct)}ot&&rt.push(ot);for(let nt=0,at=rt.length;nt<at&&at>1;++nt){const ct=rt[nt];if(measureText(ct,te)<st*.35){const ut=nt>0?measureText(rt[nt-1],te):1/0,dt=nt<at-1?measureText(rt[nt+1],te):1/0;rt.splice(nt,1),at-=1,ut<dt?(rt[nt-1]+=" "+ct,nt-=1):rt[nt]=ct+" "+rt[nt]}}for(let nt=0,at=rt.length-1;nt<at;++nt){const ct=rt[nt],ut=rt[nt+1];if(measureText(ct,te)>st*.7&&measureText(ut,te)<st*.6){const dt=ct.split(" "),ht=dt.pop();measureText(ht,te)<st*.2&&(rt[nt]=dt.join(" "),rt[nt+1]=ht+" "+ut),at-=1}}xe=rt.join(`
`)}else xe=ee;xe=applyLetterSpacing(xe,te),measureCache[ne]=xe}return xe}const webSafeFonts=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],processedFontFamilies={};function getFonts(ee,O="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(WORKER_OFFSCREEN_CANVAS)return ee;let Y;for(let te=0,ne=ee.length;te<ne;++te){const xe=ee[te];if(xe in processedFontFamilies)continue;processedFontFamilies[xe]=!0;const tt=mb2css(xe,16).split(" ");Y||(Y=[]),Y.push([tt.slice(3).join(" ").replace(/"/g,""),tt[1],tt[0]])}return Y&&(async()=>{await document.fonts.ready;for(let te=0,ne=Y.length;te<ne;++te){const xe=Y[te],et=xe[0];if(webSafeFonts.includes(et))continue;const tt=xe[1],it=xe[2];if(!(await document.fonts.load(`${it} ${tt} 16px "${et}"`)).some(ot=>ot.family.replace(/^['"]|['"]$/g,"").toLowerCase()===et.toLowerCase()&&ot.weight==tt&&ot.style===it)){const ot=O.replace("{font-family}",et.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",et.replace(/ /g,"+")).replace("{fontweight}",tt).replace("{-fontstyle}",it.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",it);if(!document.querySelector('link[href="'+ot+'"]')){const rt=document.createElement("link");rt.href=ot,rt.rel="stylesheet",document.head.appendChild(rt)}}}})(),ee}const types={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},anchor={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},expressionData=function(ee,O){const Y=createPropertyExpression(ee,O);if(Y.result==="error")throw new Error(Y.value.map(te=>`${te.key}: ${te.message}`).join(", "));return Y.value},cameraObj={zoom:0,distanceFromCenter:0};CompoundExpression.register(expressions$1,{...CompoundExpression.definitions,pitch:[{kind:"number"},[],ee=>cameraObj.pitch||90],"distance-from-center":[{kind:"number"},[],ee=>cameraObj.distanceFromCenter||0]});let renderFeatureCoordinates,renderFeature;function getValue(ee,O,Y,te,ne,xe){const et=ee.id;ne||(ne={},console.warn("No functionCache provided to getValue()")),ne[et]||(ne[et]={});const tt=ne[et];if(!tt[Y]){let it=(ee[O]||emptyObj)[Y];const st=v8[`${O}_${ee.type}`][Y];it===void 0&&(it=st.default);let ot=isExpression(it);if(!ot&&isFunction$1(it)&&(it=convertFunction(it,st),ot=!0),ot){const rt=expressionData(it,st);tt[Y]=rt.evaluate.bind(rt)}else st.type=="color"&&(it=Color.parse(it)),tt[Y]=function(){return it}}return tt[Y](cameraObj,te,xe)}function getDeclutterMode(ee,O,Y,te){return getValue(ee,"layout",`${Y}-allow-overlap`,O,te)?getValue(ee,"layout",`${Y}-ignore-placement`,O,te)?"none":"obstacle":"declutter"}function evaluateFilter(ee,O,Y,te){if(te||console.warn("No filterCache provided to evaluateFilter()"),!(ee in te))try{te[ee]=featureFilter(O).filter}catch(ne){console.warn("Filter will evaluate to false: "+ne.message),te[ee]=function(){return!1}}return te[ee](cameraObj,Y)}function colorWithOpacity(ee,O){if(ee){if(ee.a===0||O===0)return;const Y=ee.a;return O=O===void 0?1:O,Y===0?"transparent":"rgba("+Math.round(ee.r*255/Y)+","+Math.round(ee.g*255/Y)+","+Math.round(ee.b*255/Y)+","+Y*O+")"}return ee}const templateRegEx=/\{[^{}}]*\}/g;function fromTemplate(ee,O){return ee.replace(templateRegEx,function(Y){return O[Y.slice(1,-1)]||""})}function getSpriteImageForIcon(ee,O){let Y=ee.split(":")[0];return Y===ee&&(Y="default"),O[Y]}const styleFunctionArgs={};function stylefunction(ee,O,Y,te=defaultResolutions,ne=void 0,xe=void 0,et=void 0,tt=void 0){if(typeof O=="string"&&(O=JSON.parse(O)),O.version!=8)throw new Error("glStyle version 8 required.");styleFunctionArgs[getStyleFunctionKey(O,ee)]=Array.from(arguments);const it={};(typeof xe=="string"||xe instanceof Request||xe instanceof Response||xe instanceof Promise)&&(xe={default:xe});for(const yt in xe){const bt=xe[yt];toPromise(()=>bt).then(async vt=>{let Et;if(typeof Image<"u"){const wt=new Image;if(typeof vt=="string")wt.crossOrigin="anonymous",wt.src=vt;else{let St;vt instanceof Request?St=await fetch(vt):vt instanceof Response&&(St=vt);const Ot=await St.blob();Et=URL.createObjectURL(Ot),wt.src=Et}wt.addEventListener("load",function St(){wt.removeEventListener("load",St),it[yt]={image:wt,size:[wt.width,wt.height]},ee.changed(),Et&&URL.revokeObjectURL(Et)}),wt.addEventListener("error",function St(){URL.revokeObjectURL(Et),wt.removeEventListener("error",St)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const wt=self;wt.postMessage({action:"loadImage",src:vt}),wt.addEventListener("message",function(Ot){Ot.data.action==="imageLoaded"&&Ot.data.src===vt&&(it[yt]={image:Ot.data.image,size:[Ot.data.image.width,Ot.data.image.height]})})}})}const st=derefLayers(O.layers),ot={},rt=[],nt={},at={},ct=getFunctionCache(O),ut=getFilterCache(O);let dt;for(let yt=0,bt=st.length;yt<bt;++yt){const vt=st[yt],Et=vt.id;if(typeof Y=="string"&&vt.source==Y||Array.isArray(Y)&&Y.indexOf(Et)!==-1){const wt=vt["source-layer"];if(dt){if(vt.source!==dt)throw new Error(`Layer "${Et}" does not use source "${dt}`)}else{dt=vt.source;const Ot=O.sources[dt];if(!Ot)throw new Error(`Source "${dt}" is not defined`);const $t=Ot.type;if($t!=="vector"&&$t!=="geojson")throw new Error(`Source "${dt}" is not of type "vector" or "geojson", but "${$t}"`)}let St=ot[wt];St||(St=[],ot[wt]=St),St.push({layer:vt,index:yt}),rt.push(Et)}}const ht=new Stroke,pt=new Fill,ft=[],mt=function(yt,bt,vt){const Et=ee.getSource?.()?.format_?.layerName_??"mvt:layer",wt=yt.getProperties(),St=ot[wt[Et]];if(!St)return;let Ot=te.indexOf(bt);Ot==-1&&(Ot=getZoomForResolution(bt,te)),cameraObj.zoom=Ot,cameraObj.distanceFromCenter=0;const $t=yt.getGeometry(),Mt=types[$t.getType()],Nt=ee.get("map");if(Nt&&Nt instanceof Map$1&&Mt===1){const Wt=Nt.getSize();if(Wt){const zt=Nt.getView().getCenter(),Kt=getCenter($t.getExtent());cameraObj.distanceFromCenter=distance(zt,Kt)/bt/Wt[1]}}const Rt={id:yt.getId(),properties:wt,type:Mt},Pt=ee.get("mapbox-featurestate")[yt.getId()];let kt=-1;for(let Wt=0,zt=St.length;Wt<zt;++Wt){const Kt=St[Wt],qt=Kt.layer,Xt=qt.id;if(vt!==void 0&&vt!==Xt)continue;const an=qt.layout||emptyObj,pn=qt.paint||emptyObj;if(an.visibility==="none"||"minzoom"in qt&&Ot<qt.minzoom||"maxzoom"in qt&&Ot>=qt.maxzoom)continue;const ln=qt.filter;if(!ln||evaluateFilter(Xt,ln,Rt,ut)){let dn,un,Tn,Sn,bn,on;const zn=Kt.index;if(Mt==3&&(qt.type=="fill"||qt.type=="fill-extrusion"))if(un=getValue(qt,"paint",qt.type+"-opacity",Rt,ct,Pt),qt.type+"-pattern"in pn){const mn=getValue(qt,"paint",qt.type+"-pattern",Rt,ct,Pt);if(mn){const jn=typeof mn=="string"?fromTemplate(mn,wt):mn.toString(),Un=getSpriteImageForIcon(jn,it);if(ne&&ne[jn]&&Un){++kt,on=ft[kt],(!on||!on.getFill()||on.getStroke()||on.getText())&&(on=new Style({fill:new Fill}),ft[kt]=on),Tn=on.getFill(),on.setZIndex(zn);const qn=jn+"."+un;let er=at[qn];if(!er){const Pn=ne[jn],Rn=createCanvas(Pn.width,Pn.height),Dn=Rn.getContext("2d");Dn.globalAlpha=un,Dn.drawImage(Un.image,Pn.x,Pn.y,Pn.width,Pn.height,0,0,Pn.width,Pn.height),er=Dn.createPattern(Rn,"repeat"),at[qn]=er}Tn.setColor(er)}}}else dn=colorWithOpacity(getValue(qt,"paint",qt.type+"-color",Rt,ct,Pt),un),qt.type+"-outline-color"in pn&&(bn=colorWithOpacity(getValue(qt,"paint",qt.type+"-outline-color",Rt,ct,Pt),un)),bn||(bn=dn),(dn||bn)&&(++kt,on=ft[kt],(!on||dn&&!on.getFill()||!dn&&on.getFill()||bn&&!on.getStroke()||!bn&&on.getStroke()||on.getText())&&(on=new Style({fill:dn?new Fill:void 0,stroke:bn?new Stroke:void 0}),ft[kt]=on),dn&&(Tn=on.getFill(),Tn.setColor(dn)),bn&&(Sn=on.getStroke(),Sn.setColor(bn),Sn.setWidth(.5)),on.setZIndex(zn));if(Mt!=1&&qt.type=="line"){"line-pattern"in pn?dn=void 0:dn=colorWithOpacity(getValue(qt,"paint","line-color",Rt,ct,Pt),getValue(qt,"paint","line-opacity",Rt,ct,Pt));const mn=getValue(qt,"paint","line-width",Rt,ct,Pt);dn&&mn>0&&(++kt,on=ft[kt],(!on||!on.getStroke()||on.getFill()||on.getText())&&(on=new Style({stroke:new Stroke}),ft[kt]=on),Sn=on.getStroke(),Sn.setLineCap(getValue(qt,"layout","line-cap",Rt,ct,Pt)),Sn.setLineJoin(getValue(qt,"layout","line-join",Rt,ct,Pt)),Sn.setMiterLimit(getValue(qt,"layout","line-miter-limit",Rt,ct,Pt)),Sn.setColor(dn),Sn.setWidth(mn),Sn.setLineDash(pn["line-dasharray"]?getValue(qt,"paint","line-dasharray",Rt,ct,Pt).map(function(jn){return jn*mn}):null),on.setZIndex(zn))}let Ln=!1,hn=null,Hn=0,Wn,Gn,gr;if((Mt==1||Mt==2)&&"icon-image"in an){const mn=getValue(qt,"layout","icon-image",Rt,ct,Pt);if(mn){Wn=typeof mn=="string"?fromTemplate(mn,wt):mn.toString();let jn;const Un=tt?tt(ee,Wn):void 0,qn=getSpriteImageForIcon(Wn,it);if(ne&&ne[Wn]&&qn||Un){const er=getValue(qt,"layout","icon-rotation-alignment",Rt,ct,Pt);if(Mt==2){const Pn=yt.getGeometry();if(Pn.getFlatMidpoint||Pn.getFlatMidpoints){const Rn=Pn.getExtent();if(Math.sqrt(Math.max(Math.pow((Rn[2]-Rn[0])/bt,2),Math.pow((Rn[3]-Rn[1])/bt,2)))>150){const or=Pn.getType()==="MultiLineString"?Pn.getFlatMidpoints():Pn.getFlatMidpoint();if(renderFeature||(renderFeatureCoordinates=[NaN,NaN],renderFeature=new RenderFeature("Point",renderFeatureCoordinates,[],2,{},void 0)),jn=renderFeature,renderFeatureCoordinates[0]=or[0],renderFeatureCoordinates[1]=or[1],getValue(qt,"layout","symbol-placement",Rt,ct,Pt)==="line"&&er==="map"){const ur=Pn.getStride(),dr=Pn.getFlatCoordinates();for(let Vn=0,Kn=dr.length-ur;Vn<Kn;Vn+=ur){const wn=dr[Vn],ar=dr[Vn+1],Jn=dr[Vn+ur],hr=dr[Vn+ur+1],An=Math.min(wn,Jn),xn=Math.max(wn,Jn),_n=or[0],Sr=or[1],pr=(hr-ar)*(_n-wn)-(Jn-wn)*(Sr-ar);if(Math.abs(pr)<.001&&_n<=xn&&_n>=An){Hn=Math.atan2(ar-hr,Jn-wn);break}}}}}}if(Mt!==2||jn){const Pn=getValue(qt,"layout","icon-size",Rt,ct,Pt),Rn=pn["icon-color"]!==void 0?getValue(qt,"paint","icon-color",Rt,ct,Pt):null;if(!Rn||Rn.a!==0){const Dn=getValue(qt,"paint","icon-halo-color",Rt,ct,Pt),or=getValue(qt,"paint","icon-halo-width",Rt,ct,Pt);let yn=`${Wn}.${Pn}.${or}.${Dn}`;if(Rn!==null&&(yn+=`.${Rn}`),Gn=nt[yn],!Gn){const ur=getDeclutterMode(qt,Rt,"icon",ct);let dr;"icon-offset"in an&&(dr=getValue(qt,"layout","icon-offset",Rt,ct,Pt).slice(0),dr[0]*=Pn,dr[1]*=-Pn);let Vn=Rn?[Rn.r*255,Rn.g*255,Rn.b*255,Rn.a]:void 0;if(Un){const Kn={color:Vn,rotateWithView:er==="map",displacement:dr,declutterMode:ur,scale:Pn};typeof Un=="string"?Kn.src=Un:(Kn.img=Un,Kn.imgSize=[Un.width,Un.height]),Gn=new Icon(Kn)}else{const Kn=ne[Wn];let wn,ar,Jn;if(or)Kn.sdf?(wn=drawIconHalo(drawSDF(qn.image,Kn,Rn||[0,0,0,1]),{x:0,y:0,width:Kn.width,height:Kn.height,pixelRatio:Kn.pixelRatio},or,Dn),Vn=void 0):wn=drawIconHalo(qn.image,Kn,or,Dn);else{if(Kn.sdf&&!qn.unSDFed){const hr=drawSDF(qn.image,{x:0,y:0,width:qn.size[0],height:qn.size[1]},{r:1,g:1,b:1});qn.image=hr,qn.unSDFed=!0}wn=qn.image,ar=[Kn.width,Kn.height],Jn=[Kn.x,Kn.y]}Gn=new Icon({color:Vn,img:wn,imgSize:qn.size,size:ar,offset:Jn,rotateWithView:er==="map",scale:Pn/Kn.pixelRatio,displacement:dr,declutterMode:ur})}nt[yn]=Gn}}Gn&&(++kt,on=ft[kt],(!on||!on.getImage()||on.getFill()||on.getStroke())&&(on=new Style,ft[kt]=on),on.setGeometry(jn),Gn.setRotation(Hn+deg2rad(getValue(qt,"layout","icon-rotate",Rt,ct,Pt))),Gn.setOpacity(getValue(qt,"paint","icon-opacity",Rt,ct,Pt)),Gn.setAnchor(anchor[getValue(qt,"layout","icon-anchor",Rt,ct,Pt)]),on.setImage(Gn),hn=on.getText(),on.setText(void 0),on.setZIndex(zn),Ln=!0,gr=!1)}else gr=!0}}}if(Mt==1&&qt.type==="circle"){++kt,on=ft[kt],(!on||!on.getImage()||on.getFill()||on.getStroke())&&(on=new Style,ft[kt]=on);const mn="circle-radius"in pn?getValue(qt,"paint","circle-radius",Rt,ct,Pt):5,jn=colorWithOpacity(getValue(qt,"paint","circle-stroke-color",Rt,ct,Pt),getValue(qt,"paint","circle-stroke-opacity",Rt,ct,Pt)),Un=getValue(qt,"paint","circle-translate",Rt,ct,Pt),qn=colorWithOpacity(getValue(qt,"paint","circle-color",Rt,ct,Pt),getValue(qt,"paint","circle-opacity",Rt,ct,Pt)),er=getValue(qt,"paint","circle-stroke-width",Rt,ct,Pt),Pn=mn+"."+jn+"."+qn+"."+er+"."+Un[0]+"."+Un[1];Gn=nt[Pn],Gn||(Gn=new CircleStyle({radius:mn,displacement:[Un[0],-Un[1]],stroke:jn&&er>0?new Stroke({width:er,color:jn}):void 0,fill:qn?new Fill({color:qn}):void 0,declutterMode:"none"}),nt[Pn]=Gn),on.setImage(Gn),hn=on.getText(),on.setText(void 0),on.setGeometry(void 0),on.setZIndex(zn),Ln=!0}let Qn,sr,cr,On,kn,br;if("text-field"in an){On=Math.round(getValue(qt,"layout","text-size",Rt,ct,Pt));const mn=getValue(qt,"layout","text-font",Rt,ct,Pt);cr=getValue(qt,"layout","text-line-height",Rt,ct,Pt),sr=mb2css(et?et(mn,O.metadata?O.metadata["ol:webfonts"]:void 0):mn,On,cr),sr.includes("sans-serif")||(sr+=",sans-serif"),kn=getValue(qt,"layout","text-letter-spacing",Rt,ct,Pt),br=getValue(qt,"layout","text-max-width",Rt,ct,Pt);const jn=getValue(qt,"layout","text-field",Rt,ct,Pt);typeof jn=="object"&&jn.sections?jn.sections.length===1?Qn=jn.toString():Qn=jn.sections.reduce((Un,qn,er)=>{const Pn=qn.fontStack?qn.fontStack.split(","):mn,Rn=mb2css(et?et(Pn):Pn,On*(qn.scale||1),cr);let Dn=qn.text;if(Dn===`
`)return Un.push(`
`,""),Un;if(Mt==2)return Un.push(applyLetterSpacing(Dn,kn),Rn),Un;Dn=wrapText(Dn,Rn,br,kn).split(`
`);for(let or=0,yn=Dn.length;or<yn;++or)or>0&&Un.push(`
`,""),Un.push(Dn[or],Rn);return Un},[]):Qn=fromTemplate(jn,wt).trim(),un=getValue(qt,"paint","text-opacity",Rt,ct,Pt)}if(Qn&&un&&!gr){Ln||(++kt,on=ft[kt],(!on||!on.getText()||on.getFill()||on.getStroke())&&(on=new Style,ft[kt]=on),on.setImage(void 0),on.setGeometry(void 0));const mn=getDeclutterMode(qt,Rt,"text",ct);on.getText()||on.setText(hn),hn=on.getText(),(!hn||"getDeclutterMode"in hn&&hn.getDeclutterMode()!==mn)&&(hn=new Text({padding:[2,2,2,2],declutterMode:mn}),on.setText(hn));const jn=getValue(qt,"layout","text-transform",Rt,ct,Pt);jn=="uppercase"?Qn=Array.isArray(Qn)?Qn.map((Jn,hr)=>hr%2?Jn:Jn.toUpperCase()):Qn.toUpperCase():jn=="lowercase"&&(Qn=Array.isArray(Qn)?Qn.map((Jn,hr)=>hr%2?Jn:Jn.toLowerCase()):Qn.toLowerCase());const Un=Array.isArray(Qn)?Qn:Mt==2?applyLetterSpacing(Qn,kn):wrapText(Qn,sr,br,kn);if(hn.setText(Un),hn.setFont(sr),hn.setRotation(deg2rad(getValue(qt,"layout","text-rotate",Rt,ct,Pt))),typeof hn.setKeepUpright=="function"){const Jn=getValue(qt,"layout","text-keep-upright",Rt,ct,Pt);hn.setKeepUpright(Jn)}const qn=getValue(qt,"layout","text-anchor",Rt,ct,Pt),er=Ln||Mt==1?"point":getValue(qt,"layout","symbol-placement",Rt,ct,Pt);let Pn;if(er==="line-center"?(hn.setPlacement("line"),Pn="center"):hn.setPlacement(er),er==="line"&&typeof hn.setRepeat=="function"){const Jn=getValue(qt,"layout","symbol-spacing",Rt,ct,Pt);hn.setRepeat(Jn*2)}hn.setOverflow(er==="point");let Rn=getValue(qt,"paint","text-halo-width",Rt,ct,Pt);const Dn=getValue(qt,"layout","text-offset",Rt,ct,Pt),or=getValue(qt,"paint","text-translate",Rt,ct,Pt);let yn=0,ur=0;if(er=="point"){Pn="center",qn.indexOf("left")!==-1?(Pn="left",ur=Rn):qn.indexOf("right")!==-1&&(Pn="right",ur=-Rn);const Jn=getValue(qt,"layout","text-rotation-alignment",Rt,ct,Pt);hn.setRotateWithView(Jn=="map")}else hn.setMaxAngle(deg2rad(getValue(qt,"layout","text-max-angle",Rt,ct,Pt))*Qn.length/Un.length),hn.setRotateWithView(!1);hn.setTextAlign(Pn);let dr="middle";qn.indexOf("bottom")==0?(dr="bottom",yn=-Rn-.5*(cr-1)*On):qn.indexOf("top")==0&&(dr="top",yn=Rn+.5*(cr-1)*On),hn.setTextBaseline(dr);const Vn=getValue(qt,"layout","text-justify",Rt,ct,Pt);hn.setJustify(Vn==="auto"?void 0:Vn),hn.setOffsetX(Dn[0]*On+ur+or[0]),hn.setOffsetY(Dn[1]*On+yn+or[1]),pt.setColor(colorWithOpacity(getValue(qt,"paint","text-color",Rt,ct,Pt),un)),hn.setFill(pt);const Kn=colorWithOpacity(getValue(qt,"paint","text-halo-color",Rt,ct,Pt),un);if(Kn&&Rn>0){ht.setColor(Kn),Rn*=2;const Jn=.5*On;ht.setWidth(Rn<=Jn?Rn:Jn),hn.setStroke(ht)}else hn.setStroke(void 0);const wn=getValue(qt,"layout","text-padding",Rt,ct,Pt),ar=hn.getPadding();wn!==ar[0]&&(ar[0]=wn,ar[1]=wn,ar[2]=wn,ar[3]=wn),on.setZIndex(zn)}}}if(kt>-1)return ft.length=kt+1,ft};return ee.setStyle(mt),ee.set("mapbox-layers",rt),ee.set("mapbox-source",dt),ee.set("mapbox-featurestate",ee.get("mapbox-featurestate")||{}),mt}const IMAGE_REPLAYS={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},VECTOR_REPLAYS={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class CanvasVectorTileLayerRenderer extends CanvasTileLayerRenderer{constructor(O,Y){super(O,Y),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=create$2(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(O,Y,te,ne,xe,et,tt,it){this.updateExecutorGroup_(O,Y.pixelRatio,Y.viewState.projection),this.tileImageNeedsRender_(O)&&this.renderTileImage_(O,Y),super.drawTile(O,Y,te,ne,xe,et,tt,it)}getTile(O,Y,te,ne){const xe=this.getOrCreateTile(O,Y,te,ne);if(!xe)return null;const et=ne.viewState,tt=et.resolution,it=ne.viewHints,st=this.getLayer().getSource(),ot=st.getTileGridForProjection(et.projection),rt=!(it[ViewHint.ANIMATING]||it[ViewHint.INTERACTING]),nt=ot.getZForResolution(tt,st.zDirection)===O;return rt&&nt?xe.wantedResolution=tt:xe.wantedResolution||(xe.wantedResolution=ot.getResolution(O)),xe}prepareFrame(O){const Y=this.getLayer().getRevision();return this.renderedLayerRevision_!==Y&&(this.renderedLayerRevision_=Y,this.renderedTiles.length=0),super.prepareFrame(O)}updateExecutorGroup_(O,Y,te){const ne=this.getLayer(),xe=ne.getRevision(),et=ne.getRenderOrder()||null,tt=O.wantedResolution,it=O.getReplayState(ne);if(!it.dirty&&it.renderedResolution===tt&&it.renderedRevision==xe&&it.renderedRenderOrder==et)return;const st=ne.getSource(),ot=!!ne.getDeclutter(),rt=st.getTileGrid(),at=st.getTileGridForProjection(te).getTileCoordExtent(O.wrappedTileCoord),ct=st.getSourceTiles(Y,te,O),ut=getUid(ne);delete O.hitDetectionImageData[ut],O.executorGroups[ut]=[],it.dirty=!1;for(let dt=0,ht=ct.length;dt<ht;++dt){const pt=ct[dt];if(pt.getState()!=TileState.LOADED)continue;const ft=st.getProjection(),mt=pt.tileCoord;let yt=rt.getTileCoordExtent(mt);te&&ft&&!equivalent$1(te,ft)&&(yt=transformExtent(yt,ft,te,32));const bt=getIntersection(at,yt),vt=buffer$1(bt,ne.getRenderBuffer()*tt,this.tempExtent),Et=equals$1(yt,bt)?null:vt,wt=new BuilderGroup(0,bt,tt,Y),St=getSquaredTolerance(tt,Y),Ot=function(Pt,kt){let Wt;const zt=Pt.getStyleFunction()||ne.getStyleFunction();if(zt&&(Wt=zt(Pt,tt)),Wt){const Kt=this.renderFeature(Pt,St,Wt,wt,ot,kt);it.dirty=it.dirty||Kt}},$t=pt.getFeatures();et&&et!==it.renderedRenderOrder&&$t.sort(et);for(let Pt=0,kt=$t.length;Pt<kt;++Pt){let Wt=$t[Pt];te&&pt.projection&&!equivalent$1(te,pt.projection)&&(Wt=Wt.clone(),Wt.getGeometry().applyTransform(getTransform(pt.projection,te))),(!Et||intersects$1(Et,Wt.getGeometry().getExtent()))&&Ot.call(this,Wt,Pt)}const Mt=wt.finish(),Nt=ne.getRenderMode()!=="vector"&&ot&&ct.length===1?null:bt,Rt=new ExecutorGroup(Nt,tt,Y,st.getOverlaps(),Mt,ne.getRenderBuffer(),!0);O.executorGroups[ut].push(Rt)}it.renderedRevision=xe,it.renderedRenderOrder=et,it.renderedResolution=tt}forEachFeatureAtCoordinate(O,Y,te,ne,xe){const et=Y.viewState.resolution,tt=Y.viewState.rotation;te=te??0;const it=this.getLayer(),ot=it.getSource().getTileGridForProjection(Y.viewState.projection),rt=boundingExtent([O]);buffer$1(rt,et*te,rt);const nt={},at=function(ft,mt,yt){let bt=ft.getId();bt===void 0&&(bt=getUid(ft));const vt=nt[bt];if(vt){if(vt!==!0&&yt<vt.distanceSq){if(yt===0)return nt[bt]=!0,xe.splice(xe.lastIndexOf(vt),1),ne(ft,it,mt);vt.geometry=mt,vt.distanceSq=yt}}else{if(yt===0)return nt[bt]=!0,ne(ft,it,mt);xe.push(nt[bt]={feature:ft,layer:it,geometry:mt,distanceSq:yt,callback:ne})}},ct=this.renderedTiles,ut=getUid(it),dt=it.getDeclutter(),ht=dt?Y.declutter?.[dt]?.all().map(ft=>ft.value):null;let pt;e:for(let ft=0,mt=ct.length;ft<mt;++ft){const yt=ct[ft],bt=ot.getTileCoordExtent(yt.wrappedTileCoord);if(!intersects$1(bt,rt))continue;const vt=yt.executorGroups[ut];for(let Et=0,wt=vt.length;Et<wt;++Et)if(pt=vt[Et].forEachFeatureAtCoordinate(O,et,tt,te,at,ht),pt)break e}return pt}getFeatures(O){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((Y,te)=>{const ne=this.getLayer(),xe=ne.getSource(),et=this.renderedProjection,tt=et.getExtent(),it=this.renderedResolution,st=xe.getTileGridForProjection(et),ot=apply$1(this.renderedPixelToCoordinateTransform_,O.slice()),rt=st.getTileCoordForCoordAndResolution(ot,it).toString(),nt=this.renderedTiles.find(ft=>ft.tileCoord.toString()===rt&&ft.getState()===TileState.LOADED);if(!nt||nt.loadingSourceTiles>0){Y([]);return}xe.getWrapX()&&et.canWrapX()&&!containsExtent(tt,st.getTileCoordExtent(nt.tileCoord))&&wrapX$1(ot,et);const at=getUid(ne),ct=st.getTileCoordExtent(nt.wrappedTileCoord),ut=getTopLeft(ct),dt=[(ot[0]-ut[0])/it,(ut[1]-ot[1])/it],ht=nt.getSourceTiles().reduce((ft,mt)=>ft.concat(mt.getFeatures()),[]);let pt=nt.hitDetectionImageData[at];if(!pt){const ft=toSize(st.getTileSize(st.getZForResolution(it,xe.zDirection))),mt=this.renderedRotation_,yt=[this.getRenderTransform(st.getTileCoordCenter(nt.wrappedTileCoord),it,0,HIT_DETECT_RESOLUTION,ft[0]*HIT_DETECT_RESOLUTION,ft[1]*HIT_DETECT_RESOLUTION,0)];pt=createHitDetectionImageData(ft,yt,ht,ne.getStyleFunction(),st.getTileCoordExtent(nt.wrappedTileCoord),nt.getReplayState(ne).renderedResolution,mt),nt.hitDetectionImageData[at]=pt}Y(hitDetect(dt,ht,pt))})}getFeaturesInExtent(O){const Y=[],te=this.getTileCache();if(te.getCount()===0)return Y;const xe=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),et=xe.getZForResolution(this.renderedResolution),tt={};return te.forEach(it=>{if(it.tileCoord[0]!==et||it.getState()!==TileState.LOADED)return;const st=it.getSourceTiles();for(let ot=0,rt=st.length;ot<rt;++ot){const nt=st[ot],at=nt.getKey();if(at in tt)continue;tt[at]=!0;const ct=nt.tileCoord;if(intersects$1(O,xe.getTileCoordExtent(ct))){const ut=nt.getFeatures();if(ut)for(let dt=0,ht=ut.length;dt<ht;++dt){const pt=ut[dt],ft=pt.getGeometry();intersects$1(O,ft.getExtent())&&Y.push(pt)}}}}),Y}handleFontsChanged(){const O=this.getLayer();O.getVisible()&&this.renderedLayerRevision_!==void 0&&O.changed()}handleStyleImageChange_(O){this.renderIfReadyAndVisible()}renderDeclutter(O,Y){const te=this.context,ne=te.globalAlpha;te.globalAlpha=Y.opacity;const xe=O.viewHints,et=!(xe[ViewHint.ANIMATING]||xe[ViewHint.INTERACTING]),tt=[this.context.canvas.width,this.context.canvas.height],it=this.getLayer().getDeclutter(),st=it?O.declutter?.[it]:void 0,ot=getUid(this.getLayer()),rt=this.renderedTiles;for(let nt=0,at=rt.length;nt<at;++nt){const ct=rt[nt],ut=ct.executorGroups[ot];if(ut)for(let dt=ut.length-1;dt>=0;--dt)ut[dt].execute(this.context,tt,this.getTileRenderTransform(ct,O),O.viewState.rotation,et,DECLUTTER,st)}te.globalAlpha=ne}renderDeferredInternal(O){const Y=this.renderedTiles,te=getUid(this.getLayer()),ne=Y.reduce((it,st,ot)=>(st.executorGroups[te].forEach(rt=>it.push({executorGroup:rt,index:ot})),it),[]),xe=ne.map(({executorGroup:it})=>it.getDeferredZIndexContexts()),et={};for(let it=0,st=ne.length;it<st;++it){const ot=ne[it].executorGroup.getDeferredZIndexContexts();for(const rt in ot)et[rt]=!0}Object.keys(et).map(Number).sort(ascending).forEach(it=>{xe.forEach((st,ot)=>{st[it]&&(st[it].forEach(rt=>{const{executorGroup:nt,index:at}=ne[ot],ct=nt.getRenderedContext(),ut=ct.globalAlpha;ct.globalAlpha=this.renderedOpacity_;const dt=this.tileClipContexts_[at];dt&&dt.draw(ct),rt.draw(ct),dt&&ct.restore(),ct.globalAlpha=ut,rt.clear()}),st[it].length=0)})})}getTileRenderTransform(O,Y){const te=Y.pixelRatio,ne=Y.viewState,xe=ne.center,et=ne.resolution,tt=ne.rotation,it=Y.size,st=Math.round(it[0]*te),ot=Math.round(it[1]*te),nt=this.getLayer().getSource().getTileGridForProjection(Y.viewState.projection),at=O.tileCoord,ct=nt.getTileCoordExtent(O.wrappedTileCoord),ut=nt.getTileCoordExtent(at,this.tempExtent)[0]-ct[0];return multiply(scale$3(this.inversePixelTransform.slice(),1/te,1/te),this.getRenderTransform(xe,et,tt,te,st,ot,ut))}postRender(O,Y){const te=Y.viewHints,ne=!(te[ViewHint.ANIMATING]||te[ViewHint.INTERACTING]);this.renderedPixelToCoordinateTransform_=Y.pixelToCoordinateTransform.slice(),this.renderedRotation_=Y.viewState.rotation,this.renderedOpacity_=Y.layerStatesArray[Y.layerIndex].opacity;const xe=this.getLayer(),et=xe.getRenderMode(),tt=O.globalAlpha;O.globalAlpha=this.renderedOpacity_;const it=xe.getDeclutter(),st=it?VECTOR_REPLAYS[et].filter(yt=>!DECLUTTER.includes(yt)):VECTOR_REPLAYS[et],ot=Y.viewState,rt=ot.rotation,nt=xe.getSource(),ct=nt.getTileGridForProjection(ot.projection).getZForResolution(ot.resolution,nt.zDirection),ut=this.renderedTiles,dt=[],ht=[],pt=[],ft=getUid(xe);let mt=!0;for(let yt=ut.length-1;yt>=0;--yt){const bt=ut[yt];mt=mt&&!bt.getReplayState(xe).dirty;const vt=bt.executorGroups[ft].filter(Nt=>Nt.hasExecutors(st));if(vt.length===0)continue;const Et=this.getTileRenderTransform(bt,Y),wt=bt.tileCoord[0];let St=!1;const Ot=vt[0].getClipCoords(Et);let $t=O,Mt;if(Ot){Mt=new ZIndexContext,$t=Mt.getContext();for(let Nt=0,Rt=dt.length;Nt<Rt;++Nt)if(ct!==wt&&wt<ht[Nt]){const Pt=dt[Nt];intersects$1([Ot[0],Ot[3],Ot[4],Ot[7]],[Pt[0],Pt[3],Pt[4],Pt[7]])&&(St||($t.save(),St=!0),$t.beginPath(),$t.moveTo(Ot[0],Ot[1]),$t.lineTo(Ot[2],Ot[3]),$t.lineTo(Ot[4],Ot[5]),$t.lineTo(Ot[6],Ot[7]),$t.moveTo(Pt[6],Pt[7]),$t.lineTo(Pt[4],Pt[5]),$t.lineTo(Pt[2],Pt[3]),$t.lineTo(Pt[0],Pt[1]),$t.clip())}dt.push(Ot),ht.push(wt)}for(let Nt=0,Rt=vt.length;Nt<Rt;++Nt)vt[Nt].execute(O,[O.canvas.width,O.canvas.height],Et,rt,ne,st,Y.declutter?.[it]);St&&($t===O?$t.restore():pt[yt]=Mt)}O.globalAlpha=tt,this.ready=mt,this.tileClipContexts_=pt,Y.declutter||this.renderDeferredInternal(Y),super.postRender(O,Y)}renderFeature(O,Y,te,ne,xe,et){if(!te)return!1;let tt=!1;if(Array.isArray(te))for(let it=0,st=te.length;it<st;++it)tt=renderFeature$1(ne,O,te[it],Y,this.boundHandleStyleImageChange_,void 0,xe,et)||tt;else tt=renderFeature$1(ne,O,te,Y,this.boundHandleStyleImageChange_,void 0,xe,et);return tt}tileImageNeedsRender_(O){const Y=this.getLayer();if(Y.getRenderMode()==="vector")return!1;const te=O.getReplayState(Y),ne=Y.getRevision(),xe=O.wantedResolution;return te.renderedTileResolution!==xe||te.renderedTileRevision!==ne}renderTileImage_(O,Y){const te=this.getLayer(),ne=O.getReplayState(te),xe=te.getRevision(),et=O.executorGroups[getUid(te)];ne.renderedTileRevision=xe;const tt=O.wrappedTileCoord,it=tt[0],st=te.getSource();let ot=Y.pixelRatio;const nt=Y.viewState.projection,at=st.getTileGridForProjection(nt),ct=at.getResolution(O.tileCoord[0]),ut=Y.pixelRatio/O.wantedResolution*ct,dt=at.getResolution(it),ht=O.getContext();ot=Math.round(Math.max(ot,ut/ot));const pt=st.getTilePixelSize(it,ot,nt);ht.canvas.width=pt[0],ht.canvas.height=pt[1];const ft=ot/ut;if(ft!==1){const vt=reset(this.tmpTransform_);scale$3(vt,ft,ft),ht.setTransform.apply(ht,vt)}const mt=at.getTileCoordExtent(tt,this.tempExtent),yt=ut/dt,bt=reset(this.tmpTransform_);scale$3(bt,yt,-yt),translate$2(bt,-mt[0],-mt[3]);for(let vt=0,Et=et.length;vt<Et;++vt)et[vt].execute(ht,[ht.canvas.width*ft,ht.canvas.height*ft],bt,0,!0,IMAGE_REPLAYS[te.getRenderMode()],null);ne.renderedTileResolution=O.wantedResolution}}class VectorTileLayer extends BaseVectorLayer{constructor(O){O=O||{};const Y=Object.assign({},O);delete Y.preload;const te=O.cacheSize===void 0?0:O.cacheSize;delete O.cacheSize,delete Y.useInterimTilesOnError,super(Y),this.on,this.once,this.un,this.cacheSize_=te;const ne=O.renderMode||"hybrid";assert(ne=="hybrid"||ne=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=ne,this.setPreload(O.preload?O.preload:0),this.setUseInterimTilesOnError(O.useInterimTilesOnError!==void 0?O.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new CanvasVectorTileLayerRenderer(this,{cacheSize:this.cacheSize_})}getFeatures(O){return super.getFeatures(O)}getFeaturesInExtent(O){return this.getRenderer().getFeaturesInExtent(O)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(TileProperty.PRELOAD)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setPreload(O){this.set(TileProperty.PRELOAD,O)}setUseInterimTilesOnError(O){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,O)}}function hillshade(ee,O){const Y=ee[0],te=Y.width,ne=Y.height,xe=Y.data,et=new Uint8ClampedArray(xe.length),tt=O.resolution*2,it=te-1,st=ne-1,ot=[0,0,0,0],rt=2*Math.PI,nt=Math.PI/2,at=Math.PI*O.sunEl/180,ct=Math.PI*O.sunAz/180,ut=Math.cos(at),dt=Math.sin(at),ht=O.highlightColor,pt=O.shadowColor,ft=O.accentColor,mt=O.encoding;let yt,bt,vt,Et,wt,St,Ot,$t,Mt,Nt,Rt,Pt,kt,Wt,zt,Kt,qt,Xt,an,pn,ln,dn;function un(Tn,Sn="mapbox"){if(Sn==="mapbox")return(Tn[0]*256*256+Tn[1]*256+Tn[2])*.1-1e4;if(Sn==="terrarium")return Tn[0]*256+Tn[1]+Tn[2]/256-32768}for(bt=0;bt<=st;++bt)for(wt=bt===0?0:bt-1,St=bt===st?st:bt+1,yt=0;yt<=it;++yt)vt=yt===0?0:yt-1,Et=yt===it?it:yt+1,Ot=(bt*te+vt)*4,ot[0]=xe[Ot],ot[1]=xe[Ot+1],ot[2]=xe[Ot+2],ot[3]=xe[Ot+3],$t=O.vert*un(ot,mt),Ot=(bt*te+Et)*4,ot[0]=xe[Ot],ot[1]=xe[Ot+1],ot[2]=xe[Ot+2],ot[3]=xe[Ot+3],Mt=O.vert*un(ot,mt),Nt=(Mt-$t)/tt,Ot=(wt*te+yt)*4,ot[0]=xe[Ot],ot[1]=xe[Ot+1],ot[2]=xe[Ot+2],ot[3]=xe[Ot+3],$t=O.vert*un(ot,mt),Ot=(St*te+yt)*4,ot[0]=xe[Ot],ot[1]=xe[Ot+1],ot[2]=xe[Ot+2],ot[3]=xe[Ot+3],Mt=O.vert*un(ot,mt),Rt=(Mt-$t)/tt,kt=Math.atan2(Rt,-Nt),kt<0?kt=nt-kt:kt>nt?kt=rt-kt+nt:kt=nt-kt,Pt=Math.atan(Math.sqrt(Nt*Nt+Rt*Rt)),dn=dt*Math.cos(Pt)+ut*Math.sin(Pt)*Math.cos(ct-kt),Wt=Math.cos(Pt),zt=255*dn,an=Math.min(Math.max(2*O.sunEl,0),1),pn=1.875-O.opacity*1.75,ln=O.opacity!==.5?nt*((Math.pow(pn,Pt)-1)/(Math.pow(pn,nt)-1)):Pt,qt={r:(1-Wt)*ft.r*an*255,g:(1-Wt)*ft.g*an*255,b:(1-Wt)*ft.b*an*255,a:(1-Wt)*ft.a*an*255},Kt=Math.abs(((kt+ct)/Math.PI+.5)%2-1),Xt={r:(ht.r*(1-Kt)+pt.r*Kt)*zt,g:(ht.g*(1-Kt)+pt.g*Kt)*zt,b:(ht.b*(1-Kt)+pt.b*Kt)*zt,a:(ht.a*(1-Kt)+pt.a*Kt)*zt},Ot=(bt*te+yt)*4,et[Ot]=qt.r*(1-Kt)+Xt.r,et[Ot+1]=qt.g*(1-Kt)+Xt.g,et[Ot+2]=qt.b*(1-Kt)+Xt.b,et[Ot+3]=xe[Ot+3]*O.opacity*an*Math.sin(ln);return new ImageData(et,te,ne)}function getTileResolutions(ee,O=512){return ee.getExtent()?createXYZ({extent:ee.getExtent(),tileSize:O,maxZoom:22}).getResolutions():defaultResolutions}function completeOptions(ee,O){return O.accessToken||(O=Object.assign({},O),new URL(ee).searchParams.forEach((te,ne)=>{O.accessToken=te,O.accessTokenParam=ne})),O}function applyStyle(ee,O,Y="",te={},ne=void 0){let xe,et,tt,it,st=!0;return typeof Y!="string"&&!Array.isArray(Y)?(tt=Y,it=tt.source||tt.layers,te=tt):it=Y,typeof te=="string"?(xe=te,tt={}):(xe=te.styleUrl,tt=te),tt.updateSource===!1&&(st=!1),ne||(ne=tt.resolutions),!xe&&typeof O=="string"&&!O.trim().startsWith("{")&&(xe=O),xe&&(xe=xe.startsWith("data:")?location.href:normalizeStyleUrl(xe,tt.accessToken),tt=completeOptions(xe,tt)),new Promise(function(ot,rt){getGlStyle(O,tt).then(function(nt){if(nt.version!=8)return rt(new Error("glStyle version 8 required."));if(!(ee instanceof VectorLayer||ee instanceof VectorTileLayer))return rt(new Error("Can only apply to VectorLayer or VectorTileLayer"));const at=ee instanceof VectorTileLayer?"vector":"geojson";if(it?Array.isArray(it)?et=nt.layers.find(function(mt){return mt.id===it[0]}).source:et=it:(et=nt.layers.find(function(mt){return mt.source&&nt.sources[mt.source].type===at}).source,it=et),!et)return rt(new Error(`No ${at} source found in the glStyle.`));function ct(){if(!st)return Promise.resolve();if(ee instanceof VectorTileLayer)return setupVectorSource(nt.sources[et],xe,tt).then(function(vt){const Et=ee.getSource();Et?vt!==Et&&(Et.setTileUrlFunction(vt.getTileUrlFunction()),typeof Et.setUrls=="function"&&typeof vt.getUrls=="function"&&Et.setUrls(vt.getUrls()),Et.format_||(Et.format_=vt.format_),Et.getAttributions()||Et.setAttributions(vt.getAttributions()),Et.getTileLoadFunction()===defaultLoadFunction&&Et.setTileLoadFunction(vt.getTileLoadFunction()),equivalent$1(Et.getProjection(),vt.getProjection())&&(Et.tileGrid=vt.getTileGrid())):ee.setSource(vt);const wt=ee.getSource().getTileGrid();!isFinite(ee.getMaxResolution())&&!isFinite(ee.getMinZoom())&&wt.getMinZoom()>0&&ee.setMaxResolution(getResolutionForZoom(Math.max(0,wt.getMinZoom()-1e-12),wt.getResolutions()))});const mt=nt.sources[et];let yt=ee.getSource();(!yt||yt.get("mapbox-source")!==mt)&&(yt=setupGeoJSONSource(mt,xe,tt));const bt=ee.getSource();return bt?yt!==bt&&(bt.getAttributions()||bt.setAttributions(yt.getAttributions()),bt.format_||(bt.format_=yt.getFormat()),bt.url_=yt.getUrl()):ee.setSource(yt),Promise.resolve()}let ut,dt;const ht={},pt={};function ft(){if(!dt&&(!nt.sprite||ht)){if(tt.projection&&!ne){const vt=get$2(tt.projection).getUnits();vt!=="m"&&(ne=defaultResolutions.map(Et=>Et/METERS_PER_UNIT$1[vt]))}let mt;const yt=ee.getSource();yt instanceof VectorTile&&yt.format_ instanceof MVT&&(mt=yt.format_.layerName_),dt=stylefunction(ee,nt,it,ne,ht,pt,(bt,vt=tt.webfonts)=>getFonts(bt,vt),tt.getImage,mt),ee.getStyle()?ct().then(ot).catch(rt):rt(new Error(`Nothing to show for source [${et}]`))}else dt?(ee.setStyle(dt),ct().then(ot).catch(rt)):rt(new Error("Something went wrong trying to apply style."))}if(nt.sprite){const mt=normalizeSpriteDefinition(nt.sprite,tt.accessToken,xe||location.href);ut=WORKER_OFFSCREEN_CANVAS?1:window.devicePixelRatio>=1.5?.5:1;const yt=ut==.5?"@2x":"";Promise.all(mt.map(function(bt){const vt=new URL(bt.url);let Et=vt.origin+vt.pathname+yt+".json"+vt.search;return new Promise(function(wt,St){fetchResource("Sprite",Et,tt).then(wt).catch(function(Ot){Et=vt.origin+vt.pathname+".json"+vt.search,fetchResource("Sprite",Et,tt).then(wt).catch(St)})}).then(function(wt){wt===void 0&&rt(new Error("No sprites found."));let St;if(St=vt.origin+vt.pathname+yt+".png"+vt.search,tt.transformRequest){const Ot=tt.transformRequest(St,"SpriteImage")||St;(Ot instanceof Request||Ot instanceof Promise)&&(St=Ot)}pt[bt.id]=St;for(const Ot in wt){const $t=bt.id=="default"?Ot:`${bt.id}:${Ot}`;ht[$t]=wt[Ot]}}).catch(function(wt){rt(new Error(`Sprites cannot be loaded: ${Et}: ${wt.message}`))})})).then(ft).catch(rt)}else ft()}).catch(rt)})}function getSourceIdByRef(ee,O){let Y;return ee.some(function(te){if(te.id==O)return Y=te.source,!0}),Y}function extentFromTileJSON(ee,O){const Y=ee.bounds;if(Y){const te=fromLonLat([Y[0],Y[1]],O),ne=fromLonLat([Y[2],Y[3]],O);return[te[0],te[1],ne[0],ne[1]]}return get$2(O).getExtent()}function sourceOptionsFromTileJSON(ee,O,Y){const te=new TileJSON({tileJSON:O,tileSize:ee.tileSize||O.tileSize||512}),ne=te.getTileJSON(),xe=te.getTileGrid(),et=get$2(Y.projection||"EPSG:3857"),tt=extentFromTileJSON(ne,et),it=et.getExtent(),st=ne.minzoom||0,ot=ne.maxzoom||22,rt={attributions:te.getAttributions(),projection:et,tileGrid:new TileGrid({origin:it?getTopLeft(it):xe.getOrigin(0),extent:tt||xe.getExtent(),minZoom:st,resolutions:getTileResolutions(et,O.tileSize).slice(0,ot+1),tileSize:xe.getTileSize(0)})};return Array.isArray(ne.tiles)?rt.urls=ne.tiles:rt.url=ne.tiles,rt}function getBackgroundColor(ee,O,Y,te){const ne={id:ee.id,type:ee.type},xe=ee.layout||{},et=ee.paint||{};ne.paint=et,cameraObj.zoom=getZoomForResolution(O,Y.resolutions||defaultResolutions),cameraObj.distanceFromCenter=0;let tt;const it=getValue(ne,"paint","background-color",emptyObj,te);return et["background-opacity"]!==void 0&&(tt=getValue(ne,"paint","background-opacity",emptyObj,te)),xe.visibility=="none"?void 0:colorWithOpacity(it,tt)}function setupBackgroundLayer(ee,O,Y){const te=WORKER_OFFSCREEN_CANVAS?{style:{}}:document.createElement("div");return te.className="ol-mapbox-style-background",te.style.position="absolute",te.style.width="100%",te.style.height="100%",new Layer({source:new Source({}),render(ne){const xe=getBackgroundColor(ee,ne.viewState.resolution,O,Y);return te.style.backgroundColor=xe,te}})}function setupVectorSource(ee,O,Y){return new Promise(function(te,ne){getTileJson(ee,O,Y).then(function({tileJson:xe,tileLoadFunction:et}){const tt=sourceOptionsFromTileJSON(ee,xe,Y);tt.tileLoadFunction=et,tt.format=new MVT({layerName:"mvt:layer"});const it=new VectorTile(tt);it.set("mapbox-source",ee),te(it)}).catch(ne)})}function setupVectorLayer(ee,O,Y){const te=new VectorTileLayer({declutter:!0,visible:!1});return setupVectorSource(ee,O,Y).then(function(ne){te.setSource(ne)}).catch(function(ne){te.setSource(void 0)}),te}function getBboxTemplate(ee){return`{bbox-${(ee?ee.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function setupRasterSource(ee,O,Y){return new Promise(function(te,ne){getTileJson(ee,O,Y).then(function({tileJson:xe,tileLoadFunction:et}){const tt=new TileJSON({interpolate:Y.interpolate===void 0?!0:Y.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:xe});tt.tileGrid=sourceOptionsFromTileJSON(ee,xe,Y).tileGrid,Y.projection&&(tt.projection=get$2(Y.projection));const it=tt.getTileUrlFunction();et&&tt.setTileLoadFunction(et),tt.setTileUrlFunction(function(st,ot,rt){const nt=getBboxTemplate(rt);let at=it(st,ot,rt);if(at.indexOf(nt)!=-1){const ct=tt.getTileGrid().getTileCoordExtent(st);at=at.replace(nt,ct.toString())}return at}),tt.set("mapbox-source",ee),te(tt)}).catch(function(xe){ne(xe)})})}function setupRasterLayer(ee,O,Y){const te=new TileLayer;return setupRasterSource(ee,O,Y).then(function(ne){te.setSource(ne)}).catch(function(){te.setSource(void 0)}),te}function setupHillshadeLayer(ee,O,Y){const te=setupRasterLayer(ee,O,Y);return new ImageLayer({source:new RasterSource({operationType:"image",operation:hillshade,sources:[te]})})}function setupGeoJSONSource(ee,O,Y){const te=Y.projection?new GeoJSON({dataProjection:Y.projection}):new GeoJSON,ne=ee.data,xe={};if(typeof ne=="string"){const[tt]=normalizeSourceUrl(ne,Y.accessToken,Y.accessTokenParam||"access_token",O||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(tt)){const st=(rt,nt,at)=>{const ct=getBboxTemplate(at);return tt.replace(ct,`${rt.join(",")}`)},ot=new VectorSource({attributions:ee.attribution,format:te,loader:(rt,nt,at,ct,ut)=>{const dt=typeof st=="function"?st(rt,nt,at):st;fetchResource("GeoJSON",dt,Y).then(ht=>{const pt=ot.getFormat().readFeatures(ht,{featureProjection:at});ot.addFeatures(pt),ct(pt)}).catch(ht=>{ot.removeLoadedExtent(rt),ut()})},strategy:bbox$1});return ot.set("mapbox-source",ee),ot}const it=new VectorSource({attributions:ee.attribution,format:te,url:tt,loader:(st,ot,rt,nt,at)=>{fetchResource("GeoJSON",tt,Y).then(ct=>{const ut=it.getFormat().readFeatures(ct,{featureProjection:rt});it.addFeatures(ut),nt(ut)}).catch(ct=>{it.removeLoadedExtent(st),at()})}});return it}xe.features=te.readFeatures(ne,{featureProjection:getUserProjection()||"EPSG:3857"});const et=new VectorSource(Object.assign({attributions:ee.attribution,format:te},xe));return et.set("mapbox-source",ee),et}function setupGeoJSONLayer(ee,O,Y){return new VectorLayer({declutter:!0,source:setupGeoJSONSource(ee,O,Y),visible:!1})}function prerenderRasterLayer(ee,O,Y){let te=null;return function(ne){ee.paint&&"raster-opacity"in ee.paint&&ne.frameState.viewState.zoom!==te&&(te=ne.frameState.viewState.zoom,delete Y[ee.id],updateRasterLayerProperties(ee,O,te,Y))}}function updateRasterLayerProperties(ee,O,Y,te){cameraObj.zoom=Y,cameraObj.distanceFromCenter=0;const ne=getValue(ee,"paint","raster-opacity",emptyObj,te);O.setOpacity(ne)}function manageVisibility(ee,O){function Y(){const te=O.get("mapbox-style");if(!te)return;const ne=derefLayers(te.layers),xe=ee.get("mapbox-layers"),et=ne.filter(function(tt){return xe.includes(tt.id)}).some(function(tt){return!tt.layout||!tt.layout.visibility||tt.layout.visibility==="visible"});ee.get("visible")!==et&&ee.setVisible(et)}ee.on("change",Y),Y()}function setupLayer(ee,O,Y,te){const ne=getFunctionCache(ee),xe=ee.layers,et=Y.type,tt=Y.source||getSourceIdByRef(xe,Y.ref),it=ee.sources[tt];let st;if(et=="background")st=setupBackgroundLayer(Y,te,ne);else if(it.type=="vector")st=setupVectorLayer(it,O,te);else if(it.type=="raster")st=setupRasterLayer(it,O,te),st.setVisible(Y.layout?Y.layout.visibility!=="none":!0),st.on("prerender",prerenderRasterLayer(Y,st,ne));else if(it.type=="geojson")st=setupGeoJSONLayer(it,O,te);else if(it.type=="raster-dem"&&Y.type=="hillshade"){const rt=setupHillshadeLayer(it,O,te);st=rt,rt.getSource().on("beforeoperations",function(nt){const at=nt.data;at.resolution=getPointResolution(te.projection||"EPSG:3857",nt.resolution,getCenter(nt.extent),"m"),cameraObj.zoom=getZoomForResolution(nt.resolution,te.resolutions||defaultResolutions),cameraObj.distanceFromCenter=0,at.encoding=it.encoding,at.vert=5*getValue(Y,"paint","hillshade-exaggeration",emptyObj,ne),at.sunAz=getValue(Y,"paint","hillshade-illumination-direction",emptyObj,ne),at.sunEl=35,at.opacity=.3,at.highlightColor=getValue(Y,"paint","hillshade-highlight-color",emptyObj,ne),at.shadowColor=getValue(Y,"paint","hillshade-shadow-color",emptyObj,ne),at.accentColor=getValue(Y,"paint","hillshade-accent-color",emptyObj,ne)}),st.setVisible(Y.layout?Y.layout.visibility!=="none":!0)}const ot=tt;return st&&st.set("mapbox-source",ot),st}function processStyle(ee,O,Y,te){const ne=[];let xe=null;if(O instanceof Map$1){if(xe=O.getView(),!xe.isDef()&&!xe.getRotation()&&!xe.getResolutions()){const rt=te.projection?get$2(te.projection):xe.getProjection();xe=new View(Object.assign(xe.getProperties(),{maxResolution:defaultResolutions[0]/METERS_PER_UNIT$1[rt.getUnits()],projection:te.projection||xe.getProjection()})),O.setView(xe)}"center"in ee&&!xe.getCenter()&&xe.setCenter(fromLonLat(ee.center,xe.getProjection())),"zoom"in ee&&xe.getZoom()===void 0&&xe.setResolution(defaultResolutions[0]/METERS_PER_UNIT$1[xe.getProjection().getUnits()]/Math.pow(2,ee.zoom)),(!xe.getCenter()||xe.getZoom()===void 0)&&xe.fit(xe.getProjection().getExtent(),{nearest:!0,size:O.getSize()})}O.set("mapbox-style",ee),O.set("mapbox-metadata",{styleUrl:Y,options:te});const et=ee.layers;let tt=[],it,st,ot;for(let rt=0,nt=et.length;rt<nt;++rt){const at=et[rt],ct=at.type;if(ct=="heatmap"){console.debug(`layers[${rt}].type "${ct}" not supported`);continue}else ot=at.source||getSourceIdByRef(et,at.ref),(!ot||ot!=st)&&(tt.length&&(ne.push(finalizeLayer(it,tt,ee,Y,O,te)),tt=[]),it=setupLayer(ee,Y,at,te),it instanceof VectorLayer||it instanceof VectorTileLayer||(tt=[]),st=it.get("mapbox-source")),tt.push(at.id)}return ne.push(finalizeLayer(it,tt,ee,Y,O,te)),Promise.all(ne)}function apply(ee,O,Y={}){let te,ne;if(WORKER_OFFSCREEN_CANVAS){if(!(ee instanceof Map$1)&&!(ee instanceof LayerGroup))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");ne=ee}else typeof ee=="string"||ee instanceof HTMLElement?ne=new Map$1({target:ee}):ne=ee;if(typeof O=="string"){const xe=O.startsWith("data:")?location.href:normalizeStyleUrl(O,Y.accessToken);Y=completeOptions(xe,Y),te=new Promise(function(et,tt){getGlStyle(O,Y).then(function(it){processStyle(it,ne,xe,Y).then(function(){et(ne)}).catch(tt)}).catch(function(it){tt(new Error(`Could not load ${O}: ${it.message}`))})})}else te=new Promise(function(xe,et){processStyle(O,ne,!Y.styleUrl||Y.styleUrl.startsWith("data:")?location.href:normalizeStyleUrl(Y.styleUrl,Y.accessToken),Y).then(function(){xe(ne)}).catch(et)});return te}function finalizeLayer(ee,O,Y,te,ne,xe={}){let et=24,tt=0;const it=Y.layers;for(let st=0,ot=it.length;st<ot;++st){const rt=it[st];O.indexOf(rt.id)!==-1&&(et=Math.min("minzoom"in rt?rt.minzoom:0,et),tt=Math.max("maxzoom"in rt?rt.maxzoom:24,tt))}return new Promise(function(st,ot){const rt=function(){const at=ee.getSource();if(!at||at.getState()==="error"){ot(new Error("Error accessing data for source "+ee.get("mapbox-source")));return}if("getTileGrid"in at){const ct=at.getTileGrid();if(ct){const ut=ct.getMinZoom();(et>0||ut>0)&&ee.setMaxResolution(Math.min(getResolutionForZoom(Math.max(0,et-1e-12),defaultResolutions),getResolutionForZoom(Math.max(0,ut-1e-12),ct.getResolutions()))),tt<24&&ee.setMinResolution(getResolutionForZoom(tt,defaultResolutions))}}else et>0&&ee.setMaxResolution(getResolutionForZoom(Math.max(0,et-1e-12),defaultResolutions));at instanceof VectorSource||at instanceof VectorTile?applyStyle(ee,Y,O,Object.assign({styleUrl:te},xe)).then(function(){manageVisibility(ee,ne),st()}).catch(ot):st()};ee.set("mapbox-layers",O);const nt=ne.getLayers();nt.getArray().indexOf(ee)===-1&&nt.push(ee),ee.getSource()?rt():ee.once("change:source",rt)})}const ARRAY_BUFFER=34962,ELEMENT_ARRAY_BUFFER=34963,STATIC_DRAW=35044,DYNAMIC_DRAW=35048,UNSIGNED_BYTE=5121,UNSIGNED_SHORT=5123,UNSIGNED_INT=5125,FLOAT=5126,CONTEXT_IDS=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function getContext(ee,O){O=Object.assign({preserveDrawingBuffer:!0,antialias:!SAFARI_BUG_237906},O);const Y=CONTEXT_IDS.length;for(let te=0;te<Y;++te)try{const ne=ee.getContext(CONTEXT_IDS[te],O);if(ne)return ne}catch{}return null}const BufferUsage={STATIC_DRAW};class WebGLArrayBuffer{constructor(O,Y){this.array_=null,this.type_=O,assert(O===ARRAY_BUFFER||O===ELEMENT_ARRAY_BUFFER,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=Y!==void 0?Y:BufferUsage.STATIC_DRAW}ofSize(O){return this.array_=new(getArrayClassForType(this.type_))(O),this}fromArray(O){return this.array_=getArrayClassForType(this.type_).from(O),this}fromArrayBuffer(O){return this.array_=new(getArrayClassForType(this.type_))(O),this}getType(){return this.type_}getArray(){return this.array_}setArray(O){const Y=getArrayClassForType(this.type_);if(!(O instanceof Y))throw new Error(`Expected ${Y}`);this.array_=O}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function getArrayClassForType(ee){switch(ee){case ARRAY_BUFFER:return Float32Array;case ELEMENT_ARRAY_BUFFER:return Uint32Array;default:return Float32Array}}const ContextEventType={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},DEFAULT_VERTEX_SHADER=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,DEFAULT_FRAGMENT_SHADER=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class WebGLPostProcessingPass{constructor(O){this.gl_=O.webGlContext;const Y=this.gl_;this.scaleRatio_=O.scaleRatio||1,this.renderTargetTexture_=Y.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=Y.createFramebuffer(),this.depthBuffer_=Y.createRenderbuffer();const te=Y.createShader(Y.VERTEX_SHADER);Y.shaderSource(te,O.vertexShader||DEFAULT_VERTEX_SHADER),Y.compileShader(te);const ne=Y.createShader(Y.FRAGMENT_SHADER);Y.shaderSource(ne,O.fragmentShader||DEFAULT_FRAGMENT_SHADER),Y.compileShader(ne),this.renderTargetProgram_=Y.createProgram(),Y.attachShader(this.renderTargetProgram_,te),Y.attachShader(this.renderTargetProgram_,ne),Y.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=Y.createBuffer();const xe=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];Y.bindBuffer(Y.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),Y.bufferData(Y.ARRAY_BUFFER,new Float32Array(xe),Y.STATIC_DRAW),this.renderTargetAttribLocation_=Y.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=Y.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=Y.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=Y.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],O.uniforms&&Object.keys(O.uniforms).forEach(et=>{this.uniforms_.push({value:O.uniforms[et],location:Y.getUniformLocation(this.renderTargetProgram_,et)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(O){const Y=this.getGL(),te=[Y.drawingBufferWidth*this.scaleRatio_,Y.drawingBufferHeight*this.scaleRatio_];if(Y.bindFramebuffer(Y.FRAMEBUFFER,this.getFrameBuffer()),Y.bindRenderbuffer(Y.RENDERBUFFER,this.getDepthBuffer()),Y.viewport(0,0,te[0],te[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==te[0]||this.renderTargetTextureSize_[1]!==te[1]){this.renderTargetTextureSize_=te;const ne=0,xe=Y.RGBA,et=0,tt=Y.RGBA,it=Y.UNSIGNED_BYTE,st=null;Y.bindTexture(Y.TEXTURE_2D,this.renderTargetTexture_),Y.texImage2D(Y.TEXTURE_2D,ne,xe,te[0],te[1],et,tt,it,st),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,this.renderTargetTexture_,0),Y.renderbufferStorage(Y.RENDERBUFFER,Y.DEPTH_COMPONENT16,te[0],te[1]),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,this.depthBuffer_)}}apply(O,Y,te,ne){const xe=this.getGL(),et=O.size;if(xe.bindFramebuffer(xe.FRAMEBUFFER,Y?Y.getFrameBuffer():null),xe.activeTexture(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,this.renderTargetTexture_),!Y){const it=getUid(xe.canvas);if(!O.renderTargets[it]){const st=xe.getContextAttributes();st&&st.preserveDrawingBuffer&&(xe.clearColor(0,0,0,0),xe.clearDepth(1),xe.clear(xe.COLOR_BUFFER_BIT|xe.DEPTH_BUFFER_BIT)),O.renderTargets[it]=!0}}xe.disable(xe.DEPTH_TEST),xe.enable(xe.BLEND),xe.blendFunc(xe.ONE,xe.ONE_MINUS_SRC_ALPHA),xe.viewport(0,0,xe.drawingBufferWidth,xe.drawingBufferHeight),xe.bindBuffer(xe.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),xe.useProgram(this.renderTargetProgram_),xe.enableVertexAttribArray(this.renderTargetAttribLocation_),xe.vertexAttribPointer(this.renderTargetAttribLocation_,2,xe.FLOAT,!1,0,0),xe.uniform2f(this.renderTargetUniformLocation_,et[0],et[1]),xe.uniform1i(this.renderTargetTextureLocation_,0);const tt=O.layerStatesArray[O.layerIndex].opacity;xe.uniform1f(this.renderTargetOpacityLocation_,tt),this.applyUniforms(O),te&&te(xe,O),xe.drawArrays(xe.TRIANGLES,0,6),ne&&ne(xe,O)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(O){const Y=this.getGL();let te,ne=1;this.uniforms_.forEach(function(xe){if(te=typeof xe.value=="function"?xe.value(O):xe.value,te instanceof HTMLCanvasElement||te instanceof ImageData)xe.texture||(xe.texture=Y.createTexture()),Y.activeTexture(Y[`TEXTURE${ne}`]),Y.bindTexture(Y.TEXTURE_2D,xe.texture),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),te instanceof ImageData?Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,te.width,te.height,0,Y.UNSIGNED_BYTE,new Uint8Array(te.data)):Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,te),Y.uniform1i(xe.location,ne++);else if(Array.isArray(te))switch(te.length){case 2:Y.uniform2f(xe.location,te[0],te[1]);return;case 3:Y.uniform3f(xe.location,te[0],te[1],te[2]);return;case 4:Y.uniform4f(xe.location,te[0],te[1],te[2],te[3]);return;default:return}else typeof te=="number"&&Y.uniform1f(xe.location,te)})}}const DefaultUniform={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},AttributeType={UNSIGNED_BYTE,UNSIGNED_SHORT,UNSIGNED_INT,FLOAT},canvasCache={};function getSharedCanvasCacheKey(ee){return"shared/"+ee}let uniqueCanvasCacheKeyCount=0;function getUniqueCanvasCacheKey(){const ee="unique/"+uniqueCanvasCacheKeyCount;return uniqueCanvasCacheKeyCount+=1,ee}function getOrCreateContext(ee){let O=canvasCache[ee];if(!O){const Y=document.createElement("canvas");Y.width=1,Y.height=1,Y.style.position="absolute",Y.style.left="0",O={users:0,context:getContext(Y)},canvasCache[ee]=O}return O.users+=1,O.context}function releaseCanvas(ee){const O=canvasCache[ee];if(!O||(O.users-=1,O.users>0))return;const Y=O.context,te=Y.getExtension("WEBGL_lose_context");te&&te.loseContext();const ne=Y.canvas;ne.width=1,ne.height=1,delete canvasCache[ee]}class WebGLHelper extends Disposable{constructor(O){super(),O=O||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=O.canvasCacheKey?getSharedCanvasCacheKey(O.canvasCacheKey):getUniqueCanvasCacheKey(),this.gl_=getOrCreateContext(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const Y=this.gl_.canvas;Y.addEventListener(ContextEventType.LOST,this.boundHandleWebGLContextLost_),Y.addEventListener(ContextEventType.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=create$2(),this.offsetScaleMatrix_=create$2(),this.tmpMat4_=create$1(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],O.uniforms&&this.setUniforms(O.uniforms),this.postProcessPasses_=O.postProcesses?O.postProcesses.map(te=>new WebGLPostProcessingPass({webGlContext:this.gl_,scaleRatio:te.scaleRatio,vertexShader:te.vertexShader,fragmentShader:te.fragmentShader,uniforms:te.uniforms})):[new WebGLPostProcessingPass({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(O){this.uniforms_=[],this.addUniforms(O)}addUniforms(O){for(const Y in O)this.uniforms_.push({name:Y,value:O[Y]})}canvasCacheKeyMatches(O){return this.canvasCacheKey_===getSharedCanvasCacheKey(O)}getExtension(O){if(O in this.extensionCache_)return this.extensionCache_[O];const Y=this.gl_.getExtension(O);return this.extensionCache_[O]=Y,Y}getInstancedRenderingExtension_(){const O=this.getExtension("ANGLE_instanced_arrays");return assert(!!O,"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering"),O}bindBuffer(O){const Y=this.gl_,te=getUid(O);let ne=this.bufferCache_[te];if(!ne){const xe=Y.createBuffer();ne={buffer:O,webGlBuffer:xe},this.bufferCache_[te]=ne}Y.bindBuffer(O.getType(),ne.webGlBuffer)}flushBufferData(O){const Y=this.gl_;this.bindBuffer(O),Y.bufferData(O.getType(),O.getArray(),O.getUsage())}deleteBuffer(O){const Y=getUid(O);delete this.bufferCache_[Y]}disposeInternal(){const O=this.gl_.canvas;O.removeEventListener(ContextEventType.LOST,this.boundHandleWebGLContextLost_),O.removeEventListener(ContextEventType.RESTORED,this.boundHandleWebGLContextRestored_),releaseCanvas(this.canvasCacheKey_),delete this.gl_}prepareDraw(O,Y,te){const ne=this.gl_,xe=this.getCanvas(),et=O.size,tt=O.pixelRatio;(xe.width!==et[0]*tt||xe.height!==et[1]*tt)&&(xe.width=et[0]*tt,xe.height=et[1]*tt,xe.style.width=et[0]+"px",xe.style.height=et[1]+"px");for(let it=this.postProcessPasses_.length-1;it>=0;it--)this.postProcessPasses_[it].init(O);ne.bindTexture(ne.TEXTURE_2D,null),ne.clearColor(0,0,0,0),ne.depthRange(0,1),ne.clearDepth(1),ne.clear(ne.COLOR_BUFFER_BIT|ne.DEPTH_BUFFER_BIT),ne.enable(ne.BLEND),ne.blendFunc(ne.ONE,Y?ne.ZERO:ne.ONE_MINUS_SRC_ALPHA),te?(ne.enable(ne.DEPTH_TEST),ne.depthFunc(ne.LEQUAL)):ne.disable(ne.DEPTH_TEST)}bindFrameBuffer(O,Y){const te=this.getGL();te.bindFramebuffer(te.FRAMEBUFFER,O),Y&&te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,Y,0)}bindInitialFrameBuffer(){const O=this.getGL(),Y=this.postProcessPasses_[0].getFrameBuffer();O.bindFramebuffer(O.FRAMEBUFFER,Y);const te=this.postProcessPasses_[0].getRenderTargetTexture();O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,te,0)}bindTexture(O,Y,te){const ne=this.gl_;ne.activeTexture(ne.TEXTURE0+Y),ne.bindTexture(ne.TEXTURE_2D,O),ne.uniform1i(this.getUniformLocation(te),Y)}bindAttribute(O,Y,te){const ne=this.getGL();this.bindBuffer(O);const xe=this.getAttributeLocation(Y);ne.enableVertexAttribArray(xe),ne.vertexAttribPointer(xe,te,ne.FLOAT,!1,0,0)}prepareDrawToRenderTarget(O,Y,te,ne){const xe=this.gl_,et=Y.getSize();xe.bindFramebuffer(xe.FRAMEBUFFER,Y.getFramebuffer()),xe.bindRenderbuffer(xe.RENDERBUFFER,Y.getDepthbuffer()),xe.viewport(0,0,et[0],et[1]),xe.bindTexture(xe.TEXTURE_2D,Y.getTexture()),xe.clearColor(0,0,0,0),xe.depthRange(0,1),xe.clearDepth(1),xe.clear(xe.COLOR_BUFFER_BIT|xe.DEPTH_BUFFER_BIT),xe.enable(xe.BLEND),xe.blendFunc(xe.ONE,te?xe.ZERO:xe.ONE_MINUS_SRC_ALPHA),ne?(xe.enable(xe.DEPTH_TEST),xe.depthFunc(xe.LEQUAL)):xe.disable(xe.DEPTH_TEST)}drawElements(O,Y){const te=this.gl_;this.getExtension("OES_element_index_uint");const ne=te.UNSIGNED_INT,xe=4,et=Y-O,tt=O*xe;te.drawElements(te.TRIANGLES,et,ne,tt)}drawElementsInstanced(O,Y,te){const ne=this.gl_;this.getExtension("OES_element_index_uint");const xe=this.getInstancedRenderingExtension_(),et=ne.UNSIGNED_INT,tt=4,it=Y-O,st=O*tt;xe.drawElementsInstancedANGLE(ne.TRIANGLES,it,et,st,te);for(let ot=0;ot<this.maxAttributeCount_;ot++)xe.vertexAttribDivisorANGLE(ot,0)}finalizeDraw(O,Y,te){for(let ne=0,xe=this.postProcessPasses_.length;ne<xe;ne++)ne===xe-1?this.postProcessPasses_[ne].apply(O,null,Y,te):this.postProcessPasses_[ne].apply(O,this.postProcessPasses_[ne+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(O){const Y=O.size,te=O.viewState.rotation,ne=O.pixelRatio;this.setUniformFloatValue(DefaultUniform.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(DefaultUniform.ZOOM,O.viewState.zoom),this.setUniformFloatValue(DefaultUniform.RESOLUTION,O.viewState.resolution),this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO,ne),this.setUniformFloatVec2(DefaultUniform.VIEWPORT_SIZE_PX,[Y[0],Y[1]]),this.setUniformFloatValue(DefaultUniform.ROTATION,te)}applyHitDetectionUniform(O){const Y=this.getUniformLocation(DefaultUniform.HIT_DETECTION);this.getGL().uniform1i(Y,O?1:0),O&&this.setUniformFloatValue(DefaultUniform.PIXEL_RATIO,.5)}applyUniforms(O){const Y=this.gl_;let te,ne=0;this.uniforms_.forEach(xe=>{if(te=typeof xe.value=="function"?xe.value(O):xe.value,te instanceof HTMLCanvasElement||te instanceof HTMLImageElement||te instanceof ImageData||te instanceof WebGLTexture){te instanceof WebGLTexture&&!xe.texture?(xe.prevValue=void 0,xe.texture=te):xe.texture||(xe.prevValue=void 0,xe.texture=Y.createTexture()),this.bindTexture(xe.texture,ne,xe.name),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE);const et=!(te instanceof HTMLImageElement)||te.complete;!(te instanceof WebGLTexture)&&et&&xe.prevValue!==te&&(xe.prevValue=te,Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,te)),ne++}else if(Array.isArray(te)&&te.length===6)this.setUniformMatrixValue(xe.name,fromTransform(this.tmpMat4_,te));else if(Array.isArray(te)&&te.length<=4)switch(te.length){case 2:Y.uniform2f(this.getUniformLocation(xe.name),te[0],te[1]);return;case 3:Y.uniform3f(this.getUniformLocation(xe.name),te[0],te[1],te[2]);return;case 4:Y.uniform4f(this.getUniformLocation(xe.name),te[0],te[1],te[2],te[3]);return;default:return}else typeof te=="number"&&Y.uniform1f(this.getUniformLocation(xe.name),te)})}useProgram(O,Y){this.disableAllAttributes_(),this.gl_.useProgram(O),this.currentProgram_=O,Y&&(this.applyFrameState(Y),this.applyUniforms(Y))}compileShader(O,Y){const te=this.gl_,ne=te.createShader(Y);return te.shaderSource(ne,O),te.compileShader(ne),ne}getProgram(O,Y){const te=this.gl_,ne=this.compileShader(O,te.FRAGMENT_SHADER),xe=this.compileShader(Y,te.VERTEX_SHADER),et=te.createProgram();if(te.attachShader(et,ne),te.attachShader(et,xe),te.linkProgram(et),!te.getShaderParameter(ne,te.COMPILE_STATUS)){const tt=`Fragment shader compilation failed: ${te.getShaderInfoLog(ne)}`;throw new Error(tt)}if(te.deleteShader(ne),!te.getShaderParameter(xe,te.COMPILE_STATUS)){const tt=`Vertex shader compilation failed: ${te.getShaderInfoLog(xe)}`;throw new Error(tt)}if(te.deleteShader(xe),!te.getProgramParameter(et,te.LINK_STATUS)){const tt=`GL program linking failed: ${te.getProgramInfoLog(et)}`;throw new Error(tt)}return et}getUniformLocation(O){const Y=getUid(this.currentProgram_);return this.uniformLocationsByProgram_[Y]===void 0&&(this.uniformLocationsByProgram_[Y]={}),this.uniformLocationsByProgram_[Y][O]===void 0&&(this.uniformLocationsByProgram_[Y][O]=this.gl_.getUniformLocation(this.currentProgram_,O)),this.uniformLocationsByProgram_[Y][O]}getAttributeLocation(O){const Y=getUid(this.currentProgram_);return this.attribLocationsByProgram_[Y]===void 0&&(this.attribLocationsByProgram_[Y]={}),this.attribLocationsByProgram_[Y][O]===void 0&&(this.attribLocationsByProgram_[Y][O]=this.gl_.getAttribLocation(this.currentProgram_,O)),this.attribLocationsByProgram_[Y][O]}makeProjectionTransform(O,Y){const te=O.size,ne=O.viewState.rotation,xe=O.viewState.resolution,et=O.viewState.center;return compose(Y,0,0,2/(xe*te[0]),2/(xe*te[1]),-ne,-et[0],-et[1]),Y}setUniformFloatValue(O,Y){this.gl_.uniform1f(this.getUniformLocation(O),Y)}setUniformFloatVec2(O,Y){this.gl_.uniform2fv(this.getUniformLocation(O),Y)}setUniformFloatVec4(O,Y){this.gl_.uniform4fv(this.getUniformLocation(O),Y)}setUniformMatrixValue(O,Y){this.gl_.uniformMatrix4fv(this.getUniformLocation(O),!1,Y)}disableAllAttributes_(){for(let O=0;O<this.maxAttributeCount_;O++)this.gl_.disableVertexAttribArray(O)}enableAttributeArray_(O,Y,te,ne,xe,et){const tt=this.getAttributeLocation(O);tt<0||(this.gl_.enableVertexAttribArray(tt),this.gl_.vertexAttribPointer(tt,Y,te,!1,ne,xe),et&&this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(tt,1))}enableAttributes_(O,Y){const te=computeAttributesStride(O);let ne=0;for(let xe=0;xe<O.length;xe++){const et=O[xe];et.name&&this.enableAttributeArray_(et.name,et.size,et.type||FLOAT,te,ne,Y),ne+=et.size*getByteSizeFromType(et.type)}}enableAttributes(O){this.enableAttributes_(O,!1)}enableAttributesInstanced(O){this.enableAttributes_(O,!0)}handleWebGLContextLost(O){clear$2(this.bufferCache_),this.currentProgram_=null,O.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(O,Y,te,ne){const xe=this.gl_;te=te||xe.createTexture();const et=ne?xe.NEAREST:xe.LINEAR;xe.bindTexture(xe.TEXTURE_2D,te),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,et),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,et),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE);const tt=0,it=xe.RGBA,st=0,ot=xe.RGBA,rt=xe.UNSIGNED_BYTE;return Y instanceof Uint8Array?xe.texImage2D(xe.TEXTURE_2D,tt,it,O[0],O[1],st,ot,rt,Y):Y?xe.texImage2D(xe.TEXTURE_2D,tt,it,ot,rt,Y):xe.texImage2D(xe.TEXTURE_2D,tt,it,O[0],O[1],st,ot,rt,null),te}}function computeAttributesStride(ee){let O=0;for(let Y=0;Y<ee.length;Y++){const te=ee[Y];O+=te.size*getByteSizeFromType(te.type)}return O}function getByteSizeFromType(ee){switch(ee){case AttributeType.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case AttributeType.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class BaseTileRepresentation extends Target{constructor(O){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=O.gutter||0,this.helper=O.helper,this.loaded=!1,this.ready=!1}setTile(O){if(O!==this.tile)if(this.tile&&this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_),this.tile=O,this.loaded=O.getState()===TileState.LOADED,this.loaded)this.uploadTile();else{if(O instanceof ImageTile){const Y=O.getImage();Y instanceof Image&&!Y.crossOrigin&&(Y.crossOrigin="anonymous")}O.addEventListener(EventType.CHANGE,this.handleTileChange_)}}uploadTile(){abstract()}setReady(){this.ready=!0,this.dispatchEvent(EventType.CHANGE)}handleTileChange_(){this.tile.getState()===TileState.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(O){this.helper=O,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_)}}function bindAndConfigure(ee,O,Y){const te=Y?ee.LINEAR:ee.NEAREST;ee.bindTexture(ee.TEXTURE_2D,O),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,te),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,te)}function uploadImageTexture(ee,O,Y,te){bindAndConfigure(ee,O,te),ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ee.RGBA,ee.UNSIGNED_BYTE,Y)}function uploadDataTexture(ee,O,Y,te,ne,xe){const et=ee.getGL();let tt,it;Y instanceof Float32Array?(tt=et.FLOAT,ee.getExtension("OES_texture_float"),it=ee.getExtension("OES_texture_float_linear")!==null):(tt=et.UNSIGNED_BYTE,it=!0),bindAndConfigure(et,O,xe&&it);const st=Y.byteLength/te[1];let ot=1;st%8===0?ot=8:st%4===0?ot=4:st%2===0&&(ot=2);let rt;switch(ne){case 1:{rt=et.LUMINANCE;break}case 2:{rt=et.LUMINANCE_ALPHA;break}case 3:{rt=et.RGB;break}case 4:{rt=et.RGBA;break}default:throw new Error(`Unsupported number of bands: ${ne}`)}const nt=et.getParameter(et.UNPACK_ALIGNMENT);et.pixelStorei(et.UNPACK_ALIGNMENT,ot),et.texImage2D(et.TEXTURE_2D,0,rt,te[0],te[1],0,rt,tt,Y),et.pixelStorei(et.UNPACK_ALIGNMENT,nt)}let pixelContext=null;function createPixelContext(){pixelContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class TileTexture extends BaseTileRepresentation{constructor(O){super(O),this.textures=[],this.renderSize_=toSize(O.grid.getTileSize(O.tile.tileCoord[0])),this.bandCount=NaN;const Y=new WebGLArrayBuffer(ARRAY_BUFFER,STATIC_DRAW);Y.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(Y),this.coords=Y,this.setTile(O.tile)}setHelper(O){const Y=this.helper?.getGL();if(Y){this.helper.deleteBuffer(this.coords);for(let te=0;te<this.textures.length;++te)Y.deleteTexture(this.textures[te])}super.setHelper(O),O&&O.flushBufferData(this.coords)}uploadTile(){const O=this.helper,Y=O.getGL(),te=this.tile;this.textures.length=0;let ne;te instanceof ImageTile||te instanceof ReprojTile?ne=te.getImage():ne=te.getData();const xe=asImageLike(ne);if(xe){const pt=Y.createTexture();this.textures.push(pt),this.bandCount=4,uploadImageTexture(Y,pt,xe,te.interpolate),this.setReady();return}ne=asArrayLike(ne);const et=te.getSize(),tt=[et[0]+2*this.gutter,et[1]+2*this.gutter],it=ne instanceof Float32Array,st=tt[0]*tt[1],ot=it?Float32Array:Uint8Array,rt=ot.BYTES_PER_ELEMENT,nt=ne.byteLength/tt[1];this.bandCount=Math.floor(nt/rt/tt[0]);const at=Math.ceil(this.bandCount/4);if(at===1){const pt=Y.createTexture();this.textures.push(pt),uploadDataTexture(O,pt,ne,tt,this.bandCount,te.interpolate),this.setReady();return}const ct=new Array(at);for(let pt=0;pt<at;++pt){const ft=Y.createTexture();this.textures.push(ft);const mt=pt<at-1?4:(this.bandCount-1)%4+1;ct[pt]=new ot(st*mt)}let ut=0,dt=0;const ht=tt[0]*this.bandCount;for(let pt=0;pt<tt[1];++pt){for(let ft=0;ft<ht;++ft){const mt=ne[dt+ft],yt=Math.floor(ut/this.bandCount),bt=ft%this.bandCount,vt=Math.floor(bt/4),Et=ct[vt],wt=Et.length/st,St=bt%4;Et[yt*wt+St]=mt,++ut}dt+=nt/rt}for(let pt=0;pt<at;++pt){const ft=this.textures[pt],mt=ct[pt],yt=mt.length/st;uploadDataTexture(O,ft,mt,tt,yt,te.interpolate)}this.setReady()}getImagePixelData_(O,Y,te){const ne=this.gutter,xe=this.renderSize_[0],et=this.renderSize_[1];pixelContext||createPixelContext(),pixelContext.clearRect(0,0,1,1);const tt=O.width,it=O.height,st=tt-2*ne,ot=it-2*ne,rt=ne+Math.floor(st*(Y/xe)),nt=ne+Math.floor(ot*(te/et));let at;try{pixelContext.drawImage(O,rt,nt,1,1,0,0,1,1),at=pixelContext.getImageData(0,0,1,1).data}catch{return pixelContext=null,null}return at}getArrayPixelData_(O,Y,te,ne){const xe=this.gutter,et=this.renderSize_[0],tt=this.renderSize_[1],it=Y[0],st=Y[1],ot=it+2*xe,rt=st+2*xe,nt=xe+Math.floor(it*(te/et)),at=xe+Math.floor(st*(ne/tt));if(O instanceof DataView){const ut=O.byteLength/(ot*rt),dt=ut*(at*ot+nt),ht=O.buffer.slice(dt,dt+ut);return new DataView(ht)}const ct=this.bandCount*(at*ot+nt);return O.slice(ct,ct+this.bandCount)}getPixelData(O,Y){if(!this.loaded)return null;if(this.tile instanceof DataTile){const te=this.tile.getData(),ne=asArrayLike(te);if(ne){const xe=this.tile.getSize();return this.getArrayPixelData_(ne,xe,O,Y)}return this.getImagePixelData_(asImageLike(te),O,Y)}return this.getImagePixelData_(this.tile.getImage(),O,Y)}}class WebGLLayerRenderer extends LayerRenderer{constructor(O,Y){super(O),Y=Y||{},this.inversePixelTransform_=create$2(),this.postProcesses_=Y.postProcesses,this.uniforms_=Y.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},O.addChangeListener(LayerProperty.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(O,Y){const te=this.getLayer();if(te.hasListener(RenderEventType.PRECOMPOSE)){const ne=new RenderEvent(RenderEventType.PRECOMPOSE,void 0,Y,O);te.dispatchEvent(ne)}}dispatchPostComposeEvent(O,Y){const te=this.getLayer();if(te.hasListener(RenderEventType.POSTCOMPOSE)){const ne=new RenderEvent(RenderEventType.POSTCOMPOSE,void 0,Y,O);te.dispatchEvent(ne)}}reset(O){this.uniforms_=O.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(O){if(this.getLayer().getRenderSource()){let Y=!0,te=-1,ne;for(let et=0,tt=O.layerStatesArray.length;et<tt;et++){const it=O.layerStatesArray[et].layer,st=it.getRenderer();if(!(st instanceof WebGLLayerRenderer)){Y=!0;continue}const ot=it.getClassName();if((Y||ot!==ne)&&(te+=1,Y=!1),ne=ot,st===this)break}const xe="map/"+O.mapId+"/group/"+te;(!this.helper||!this.helper.canvasCacheKeyMatches(xe)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new WebGLHelper({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:xe}),ne&&(this.helper.getCanvas().className=ne),this.afterHelperCreated())}return this.prepareFrameInternal(O)}afterHelperCreated(){}prepareFrameInternal(O){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(LayerProperty.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(O,Y,te){const ne=this.getLayer();if(ne.hasListener(O)){compose(this.inversePixelTransform_,0,0,te.pixelRatio,-te.pixelRatio,0,0,-te.size[1]);const xe=new RenderEvent(O,this.inversePixelTransform_,te,Y);ne.dispatchEvent(xe)}}preRender(O,Y){this.dispatchRenderEvent_(RenderEventType.PRERENDER,O,Y)}postRender(O,Y){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,O,Y)}}const Uniforms$2={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function depthForZ(ee){return 1/(ee+2)}function newTileRepresentationLookup(){return{tileIds:new Set,representationsByZ:{}}}function lookupHasTile(ee,O){return ee.tileIds.has(getUid(O))}function addTileRepresentationToLookup(ee,O,Y){const te=ee.representationsByZ;Y in te||(te[Y]=new Set),te[Y].add(O),ee.tileIds.add(getUid(O.tile))}function getRenderExtent(ee,O){const Y=ee.layerStatesArray[ee.layerIndex];Y.extent&&(O=getIntersection(O,fromUserExtent(Y.extent,ee.viewState.projection)));const te=Y.layer.getRenderSource();if(!te.getWrapX()){const ne=te.getTileGridForProjection(ee.viewState.projection).getExtent();ne&&(O=getIntersection(O,ne))}return O}function getCacheKey(ee,O){return`${getUid(ee)},${ee.getKey()},${ee.getRevision()},${getKey(O)}`}class WebGLBaseTileLayerRenderer extends WebGLLayerRenderer{constructor(O,Y){super(O,{uniforms:Y.uniforms,postProcesses:Y.postProcesses}),this.renderComplete=!1,this.tileTransform_=create$2(),this.tempMat4=create$1(),this.tempTileRange_=new TileRange(0,0,0,0),this.tempTileCoord_=createOrUpdate(0,0,0),this.tempSize_=[0,0];const te=Y.cacheSize!==void 0?Y.cacheSize:512;this.tileRepresentationCache=new LRUCache(te),this.frameState=null,this.renderedProjection_=void 0}reset(O){super.reset({uniforms:O.uniforms})}prepareFrameInternal(O){this.renderedProjection_?O.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=O.viewState.projection):this.renderedProjection_=O.viewState.projection;const te=this.getLayer().getRenderSource();return!te||isEmpty(getRenderExtent(O,O.extent))?!1:te.getState()==="ready"}createTileRepresentation(O){return abstract()}enqueueTiles(O,Y,te,ne,xe){const et=O.viewState,tt=this.getLayer(),it=tt.getRenderSource(),st=it.getTileGridForProjection(et.projection),ot=it.getGutterForProjection(et.projection),rt=getUid(it);rt in O.wantedTiles||(O.wantedTiles[rt]={});const nt=O.wantedTiles[rt],at=this.tileRepresentationCache,ct=tt.getMapInternal(),ut=Math.max(te-xe,st.getMinZoom(),st.getZForResolution(Math.min(tt.getMaxResolution(),ct?ct.getView().getResolutionForZoom(Math.max(tt.getMinZoom(),0)):st.getResolution(0)),it.zDirection)),dt=et.rotation,ht=dt?getRotatedViewport(et.center,et.resolution,dt,O.size):void 0;for(let pt=te;pt>=ut;--pt){const ft=st.getTileRangeForExtentAndZ(Y,pt,this.tempTileRange_),mt=st.getResolution(pt);for(let yt=ft.minX;yt<=ft.maxX;++yt)for(let bt=ft.minY;bt<=ft.maxY;++bt){if(dt&&!st.tileCoordIntersectsViewport([pt,yt,bt],ht))continue;const vt=createOrUpdate(pt,yt,bt,this.tempTileCoord_),Et=getCacheKey(it,vt);let wt,St;if(at.containsKey(Et)&&(wt=at.get(Et),St=wt.tile),(!wt||wt.tile.key!==it.getKey())&&(St=it.getTile(pt,yt,bt,O.pixelRatio,et.projection),!St)||lookupHasTile(ne,St))continue;wt?wt.setTile(St):(wt=this.createTileRepresentation({tile:St,grid:st,helper:this.helper,gutter:ot}),at.set(Et,wt)),addTileRepresentationToLookup(ne,wt,pt);const Ot=St.getKey();nt[Ot]=!0,St.getState()===TileState.IDLE&&(O.tileQueue.isKeyQueued(Ot)||O.tileQueue.enqueue([St,rt,st.getTileCoordCenter(vt),mt]))}}}beforeTilesRender(O,Y){this.helper.prepareDraw(this.frameState,!Y,!0)}beforeTilesMaskRender(O){return!1}renderTile(O,Y,te,ne,xe,et,tt,it,st,ot,rt){}renderTileMask(O,Y,te,ne){}drawTile_(O,Y,te,ne,xe,et,tt){if(!Y.ready)return;const st=Y.tile.tileCoord,ot=getKey(st),rt=ot in et?et[ot]:1,nt=tt.getResolution(te),at=toSize(tt.getTileSize(te),this.tempSize_),ct=tt.getOrigin(te),ut=tt.getTileCoordExtent(st),dt=rt<1?-1:depthForZ(te);rt<1&&(O.animate=!0);const ht=O.viewState,pt=ht.center[0],ft=ht.center[1],mt=at[0]+2*ne,yt=at[1]+2*ne,bt=mt/yt,vt=(pt-ct[0])/(at[0]*nt),Et=(ct[1]-ft)/(at[1]*nt),wt=ht.resolution/nt,St=st[1],Ot=st[2];reset(this.tileTransform_),scale$3(this.tileTransform_,2/(O.size[0]*wt/mt),-2/(O.size[1]*wt/mt)),rotate$1(this.tileTransform_,ht.rotation),scale$3(this.tileTransform_,1,1/bt),translate$2(this.tileTransform_,(at[0]*(St-vt)-ne)/mt,(at[1]*(Ot-Et)-ne)/yt),this.renderTile(Y,this.tileTransform_,O,xe,nt,at,ct,ut,dt,ne,rt)}renderFrame(O){this.frameState=O,this.renderComplete=!0;const Y=this.helper.getGL();this.preRender(Y,O);const te=O.viewState,ne=this.getLayer(),xe=ne.getRenderSource(),et=xe.getTileGridForProjection(te.projection),tt=xe.getGutterForProjection(te.projection),it=getRenderExtent(O,O.extent),st=et.getZForResolution(te.resolution,xe.zDirection),ot=newTileRepresentationLookup(),rt=ne.getPreload();if(O.nextExtent){const ft=et.getZForResolution(te.nextResolution,xe.zDirection),mt=getRenderExtent(O,O.nextExtent);this.enqueueTiles(O,mt,ft,ot,rt)}this.enqueueTiles(O,it,st,ot,0),rt>0&&setTimeout(()=>{this.enqueueTiles(O,it,st-1,ot,rt-1)},0);const nt={};let at=!1;const ct=ot.representationsByZ;if(st in ct){const ft=getUid(this),mt=O.time;for(const yt of ct[st]){const bt=yt.tile;if(bt.getState()===TileState.EMPTY)continue;const vt=bt.tileCoord;if(yt.ready){const St=bt.getAlpha(ft,mt);if(St===1){bt.endTransition(ft);continue}at=!0;const Ot=getKey(vt);nt[Ot]=St}if(this.renderComplete=!1,this.findAltTiles_(et,vt,st+1,ot))continue;const wt=et.getMinZoom();for(let St=st-1;St>=wt&&!this.findAltTiles_(et,vt,St,ot);--St);}}const ut=Object.keys(ct).map(Number).sort(descending);if(this.beforeTilesMaskRender(O))for(let ft=0,mt=ut.length;ft<mt;++ft){const yt=ut[ft];for(const bt of ct[yt]){const vt=bt.tile.tileCoord;if(getKey(vt)in nt)continue;const wt=et.getTileCoordExtent(vt);this.renderTileMask(bt,yt,wt,depthForZ(yt))}}this.beforeTilesRender(O,at);for(let ft=0,mt=ut.length;ft<mt;++ft){const yt=ut[ft];for(const bt of ct[yt]){const vt=bt.tile.tileCoord;getKey(vt)in nt||this.drawTile_(O,bt,yt,tt,it,nt,et)}}if(st in ct)for(const ft of ct[st]){const mt=ft.tile.tileCoord;getKey(mt)in nt&&this.drawTile_(O,ft,st,tt,it,nt,et)}this.beforeFinalize(O),this.helper.finalizeDraw(O,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const ht=this.helper.getCanvas();return this.tileRepresentationCache.expireCache(),this.postRender(Y,O),ht}beforeFinalize(O){}findAltTiles_(O,Y,te,ne){const xe=O.getTileRangeForTileCoordAndZ(Y,te,this.tempTileRange_);if(!xe)return!1;let et=!0;const tt=this.tileRepresentationCache,it=this.getLayer().getRenderSource();for(let st=xe.minX;st<=xe.maxX;++st)for(let ot=xe.minY;ot<=xe.maxY;++ot){const rt=getCacheKey(it,[te,st,ot]);let nt=!1;if(tt.containsKey(rt)){const at=tt.get(rt);at.ready&&!lookupHasTile(ne,at.tile)&&(addTileRepresentationToLookup(ne,at,te),nt=!0)}nt||(et=!1)}return et}clearCache(){super.clearCache();const O=this.tileRepresentationCache;O.forEach(Y=>Y.dispose()),O.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(O=>O.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Uniforms$1={...Uniforms$2,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Attributes$1={TEXTURE_COORD:"a_textureCoord"},attributeDescriptions=[{name:Attributes$1.TEXTURE_COORD,size:2,type:AttributeType.FLOAT}];class WebGLTileLayerRenderer extends WebGLBaseTileLayerRenderer{constructor(O,Y){super(O,Y),this.program_,this.vertexShader_=Y.vertexShader,this.fragmentShader_=Y.fragmentShader,this.indices_=new WebGLArrayBuffer(ELEMENT_ARRAY_BUFFER,STATIC_DRAW),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=Y.paletteTextures||[]}reset(O){if(super.reset(O),this.helper){const Y=this.helper.getGL();for(const te of this.paletteTextures_)te.delete(Y)}if(this.vertexShader_=O.vertexShader,this.fragmentShader_=O.fragmentShader,this.paletteTextures_=O.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const Y=this.helper.getGL();for(const te of this.paletteTextures_)te.getTexture(Y)}}afterHelperCreated(){super.afterHelperCreated();const O=this.helper.getGL();for(const Y of this.paletteTextures_)Y.getTexture(O);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const O=this.helper.getGL();for(const Y of this.paletteTextures_)Y.delete(O)}super.removeHelper()}createTileRepresentation(O){return new TileTexture(O)}beforeTilesRender(O,Y){super.beforeTilesRender(O,Y),this.helper.useProgram(this.program_,O)}renderTile(O,Y,te,ne,xe,et,tt,it,st,ot,rt){const nt=this.helper.getGL();this.helper.bindBuffer(O.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(attributeDescriptions);let at=0;for(;at<O.textures.length;){const bt=`${Uniforms$1.TILE_TEXTURE_ARRAY}[${at}]`;this.helper.bindTexture(O.textures[at],at,bt),++at}for(let bt=0;bt<this.paletteTextures_.length;++bt){const vt=this.paletteTextures_[bt],Et=vt.getTexture(nt);this.helper.bindTexture(Et,at,vt.name),++at}const ct=te.viewState,ut=et[0]+2*ot,dt=et[1]+2*ot,pt=O.tile.tileCoord,ft=pt[1],mt=pt[2];this.helper.setUniformMatrixValue(Uniforms$1.TILE_TRANSFORM,fromTransform(this.tempMat4,Y)),this.helper.setUniformFloatValue(Uniforms$1.TRANSITION_ALPHA,rt),this.helper.setUniformFloatValue(Uniforms$1.DEPTH,st);let yt=ne;ot>0&&(yt=it,getIntersection(yt,ne,yt)),this.helper.setUniformFloatVec4(Uniforms$1.RENDER_EXTENT,yt),this.helper.setUniformFloatValue(Uniforms$1.RESOLUTION,ct.resolution),this.helper.setUniformFloatValue(Uniforms$1.ZOOM,ct.zoom),this.helper.setUniformFloatValue(Uniforms$1.TEXTURE_PIXEL_WIDTH,ut),this.helper.setUniformFloatValue(Uniforms$1.TEXTURE_PIXEL_HEIGHT,dt),this.helper.setUniformFloatValue(Uniforms$1.TEXTURE_RESOLUTION,xe),this.helper.setUniformFloatValue(Uniforms$1.TEXTURE_ORIGIN_X,tt[0]+ft*et[0]*xe-ot*xe),this.helper.setUniformFloatValue(Uniforms$1.TEXTURE_ORIGIN_Y,tt[1]-mt*et[1]*xe+ot*xe),this.helper.drawElements(0,this.indices_.getSize())}getData(O){if(!this.helper.getGL())return null;const te=this.frameState;if(!te)return null;const ne=this.getLayer(),xe=apply$1(te.pixelToCoordinateTransform,O.slice()),et=te.viewState,tt=ne.getExtent();if(tt&&!containsCoordinate(fromUserExtent(tt,et.projection),xe))return null;const it=ne.getSources(boundingExtent([xe]),et.resolution);let st,ot,rt;for(st=it.length-1;st>=0;--st)if(ot=it[st],ot.getState()==="ready"){if(rt=ot.getTileGridForProjection(et.projection),ot.getWrapX())break;const at=rt.getExtent();if(!at||containsCoordinate(at,xe))break}if(st<0)return null;const nt=this.tileRepresentationCache;for(let at=rt.getZForResolution(et.resolution);at>=rt.getMinZoom();--at){const ct=rt.getTileCoordForCoordAndZ(xe,at),ut=getCacheKey(ot,ct);if(!nt.containsKey(ut))continue;const dt=nt.get(ut);if(dt.tile.getState()===TileState.EMPTY)return null;if(!dt.loaded)continue;const pt=rt.getOrigin(at),ft=toSize(rt.getTileSize(at)),mt=rt.getResolution(at),yt=(xe[0]-pt[0])/mt-ct[1]*ft[0],bt=(pt[1]-xe[1])/mt-ct[2]*ft[1];return dt.getPixelData(yt,bt)}return null}disposeInternal(){const O=this.helper;if(O){const Y=O.getGL();for(const te of this.paletteTextures_)te.delete(Y);this.paletteTextures_.length=0,Y.deleteProgram(this.program_),delete this.program_,O.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class PaletteTexture{constructor(O,Y){this.name=O,this.data=Y,this.texture_=null}getTexture(O){if(!this.texture_){const Y=O.createTexture();O.bindTexture(O.TEXTURE_2D,Y),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.NEAREST),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.NEAREST),O.texImage2D(O.TEXTURE_2D,0,O.RGBA,this.data.length/4,1,0,O.RGBA,O.UNSIGNED_BYTE,this.data),this.texture_=Y}return this.texture_}delete(O){this.texture_&&O.deleteTexture(this.texture_),this.texture_=null}}function computeOperatorFunctionName(ee,O){return`operator_${ee}_${Object.keys(O.functions).length}`}function numberToGlsl(ee){const O=ee.toString();return O.includes(".")?O:O+".0"}function arrayToGlsl(ee){if(ee.length<2||ee.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${ee.length}(${ee.map(numberToGlsl).join(", ")})`}function colorToGlsl(ee){const O=asArray(ee),Y=O.length>3?O[3]:1;return arrayToGlsl([O[0]/255,O[1]/255,O[2]/255,Y])}function sizeToGlsl(ee){const O=toSize(ee);return arrayToGlsl(O)}const stringToFloatMap={};let stringToFloatCounter=0;function getStringNumberEquivalent(ee){return ee in stringToFloatMap||(stringToFloatMap[ee]=stringToFloatCounter++),stringToFloatMap[ee]}function stringToGlsl(ee){return numberToGlsl(getStringNumberEquivalent(ee))}function uniformNameForVariable(ee){return"u_var_"+ee}function newCompilationContext(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const GET_BAND_VALUE_FUNC="getBandValue",PALETTE_TEXTURE_ARRAY="u_paletteTextures",FEATURE_ID_PROPERTY_NAME="featureId",GEOMETRY_TYPE_PROPERTY_NAME="geometryType",UNDEFINED_PROP_VALUE=-9999999;function buildExpression(ee,O,Y,te){const ne=parse$1(ee,O,Y);return compile(ne,O,te)}function createCompiler(ee){return(O,Y,te)=>{const ne=Y.args.length,xe=new Array(ne);for(let et=0;et<ne;++et)xe[et]=compile(Y.args[et],te,O);return ee(xe,O)}}const compilers={[Ops.Get]:(ee,O)=>{const te=O.args[0].value;te in ee.properties||(ee.properties[te]={name:te,type:O.type});let xe="a_prop_"+te;return isType(O.type,BooleanType$1)&&(xe=`(${xe} > 0.0)`),xe},[Ops.Id]:ee=>(ee.featureId=!0,"a_"+FEATURE_ID_PROPERTY_NAME),[Ops.GeometryType]:ee=>(ee.geometryType=!0,"a_"+GEOMETRY_TYPE_PROPERTY_NAME),[Ops.LineMetric]:()=>"currentLineMetric",[Ops.Var]:(ee,O)=>{const te=O.args[0].value;te in ee.variables||(ee.variables[te]={name:te,type:O.type});let xe=uniformNameForVariable(te);return isType(O.type,BooleanType$1)&&(xe=`(${xe} > 0.0)`),xe},[Ops.Has]:(ee,O)=>{const te=O.args[0].value;return te in ee.properties||(ee.properties[te]={name:te,type:O.type}),`(a_prop_${te} != ${numberToGlsl(UNDEFINED_PROP_VALUE)})`},[Ops.Resolution]:()=>"u_resolution",[Ops.Zoom]:()=>"u_zoom",[Ops.Time]:()=>"u_time",[Ops.Any]:createCompiler(ee=>`(${ee.join(" || ")})`),[Ops.All]:createCompiler(ee=>`(${ee.join(" && ")})`),[Ops.Not]:createCompiler(([ee])=>`(!${ee})`),[Ops.Equal]:createCompiler(([ee,O])=>`(${ee} == ${O})`),[Ops.NotEqual]:createCompiler(([ee,O])=>`(${ee} != ${O})`),[Ops.GreaterThan]:createCompiler(([ee,O])=>`(${ee} > ${O})`),[Ops.GreaterThanOrEqualTo]:createCompiler(([ee,O])=>`(${ee} >= ${O})`),[Ops.LessThan]:createCompiler(([ee,O])=>`(${ee} < ${O})`),[Ops.LessThanOrEqualTo]:createCompiler(([ee,O])=>`(${ee} <= ${O})`),[Ops.Multiply]:createCompiler(ee=>`(${ee.join(" * ")})`),[Ops.Divide]:createCompiler(([ee,O])=>`(${ee} / ${O})`),[Ops.Add]:createCompiler(ee=>`(${ee.join(" + ")})`),[Ops.Subtract]:createCompiler(([ee,O])=>`(${ee} - ${O})`),[Ops.Clamp]:createCompiler(([ee,O,Y])=>`clamp(${ee}, ${O}, ${Y})`),[Ops.Mod]:createCompiler(([ee,O])=>`mod(${ee}, ${O})`),[Ops.Pow]:createCompiler(([ee,O])=>`pow(${ee}, ${O})`),[Ops.Abs]:createCompiler(([ee])=>`abs(${ee})`),[Ops.Floor]:createCompiler(([ee])=>`floor(${ee})`),[Ops.Ceil]:createCompiler(([ee])=>`ceil(${ee})`),[Ops.Round]:createCompiler(([ee])=>`floor(${ee} + 0.5)`),[Ops.Sin]:createCompiler(([ee])=>`sin(${ee})`),[Ops.Cos]:createCompiler(([ee])=>`cos(${ee})`),[Ops.Atan]:createCompiler(([ee,O])=>O!==void 0?`atan(${ee}, ${O})`:`atan(${ee})`),[Ops.Sqrt]:createCompiler(([ee])=>`sqrt(${ee})`),[Ops.Match]:createCompiler(ee=>{const O=ee[0],Y=ee[ee.length-1];let te=null;for(let ne=ee.length-3;ne>=1;ne-=2){const xe=ee[ne],et=ee[ne+1];te=`(${O} == ${xe} ? ${et} : ${te||Y})`}return te}),[Ops.Between]:createCompiler(([ee,O,Y])=>`(${ee} >= ${O} && ${ee} <= ${Y})`),[Ops.Interpolate]:createCompiler(([ee,O,...Y])=>{let te="";for(let ne=0;ne<Y.length-2;ne+=2){const xe=Y[ne],et=te||Y[ne+1],tt=Y[ne+2],it=Y[ne+3];let st;ee===numberToGlsl(1)?st=`(${O} - ${xe}) / (${tt} - ${xe})`:st=`(pow(${ee}, (${O} - ${xe})) - 1.0) / (pow(${ee}, (${tt} - ${xe})) - 1.0)`,te=`mix(${et}, ${it}, clamp(${st}, 0.0, 1.0))`}return te}),[Ops.Case]:createCompiler(ee=>{const O=ee[ee.length-1];let Y=null;for(let te=ee.length-3;te>=0;te-=2){const ne=ee[te],xe=ee[te+1];Y=`(${ne} ? ${xe} : ${Y||O})`}return Y}),[Ops.In]:createCompiler(([ee,...O],Y)=>{const te=computeOperatorFunctionName("in",Y),ne=[];for(let xe=0;xe<O.length;xe+=1)ne.push(`  if (inputValue == ${O[xe]}) { return true; }`);return Y.functions[te]=`bool ${te}(float inputValue) {
${ne.join(`
`)}
  return false;
}`,`${te}(${ee})`}),[Ops.Array]:createCompiler(ee=>`vec${ee.length}(${ee.join(", ")})`),[Ops.Color]:createCompiler(ee=>{if(ee.length===1)return`vec4(vec3(${ee[0]} / 255.0), 1.0)`;if(ee.length===2)return`vec4(vec3(${ee[0]} / 255.0), ${ee[1]})`;const O=ee.slice(0,3).map(te=>`${te} / 255.0`);if(ee.length===3)return`vec4(${O.join(", ")}, 1.0)`;const Y=ee[3];return`vec4(${O.join(", ")}, ${Y})`}),[Ops.Band]:createCompiler(([ee,O,Y],te)=>{if(!(GET_BAND_VALUE_FUNC in te.functions)){let ne="";const xe=te.bandCount||1;for(let et=0;et<xe;et++){const tt=Math.floor(et/4);let it=et%4;et===xe-1&&it===1&&(it=3);const st=`${Uniforms$1.TILE_TEXTURE_ARRAY}[${tt}]`;ne+=`  if (band == ${et+1}.0) {
    return texture2D(${st}, v_textureCoord + vec2(dx, dy))[${it}];
  }
`}te.functions[GET_BAND_VALUE_FUNC]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Uniforms$1.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Uniforms$1.TEXTURE_PIXEL_HEIGHT};
${ne}
}`}return`${GET_BAND_VALUE_FUNC}(${ee}, ${O??"0.0"}, ${Y??"0.0"})`}),[Ops.Palette]:(ee,O)=>{const[Y,...te]=O.args,ne=te.length,xe=new Uint8Array(ne*4);for(let st=0;st<te.length;st++){const ot=te[st].value,rt=asArray(ot),nt=st*4;xe[nt]=rt[0],xe[nt+1]=rt[1],xe[nt+2]=rt[2],xe[nt+3]=rt[3]*255}ee.paletteTextures||(ee.paletteTextures=[]);const et=`${PALETTE_TEXTURE_ARRAY}[${ee.paletteTextures.length}]`,tt=new PaletteTexture(et,xe);ee.paletteTextures.push(tt);const it=compile(Y,NumberType$1,ee);return`texture2D(${et}, vec2((${it} + 0.5) / ${ne}.0, 0.5))`}};function compile(ee,O,Y){if(ee instanceof CallExpression){const te=compilers[ee.operator];if(te===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(ee.operator)}`);return te(Y,ee,O)}if((ee.type&NumberType$1)>0)return numberToGlsl(ee.value);if((ee.type&BooleanType$1)>0)return ee.value.toString();if((ee.type&StringType$1)>0)return stringToGlsl(ee.value.toString());if((ee.type&ColorType$1)>0)return colorToGlsl(ee.value);if((ee.type&NumberArrayType$1)>0)return arrayToGlsl(ee.value);if((ee.type&SizeType)>0)return sizeToGlsl(ee.value);throw new Error(`Unexpected expression ${ee.value} (expected type ${typeName(O)})`)}function createDefaultStyle(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const LINESTRING_ANGLE_COSINE_CUTOFF=.985;function expressionToGlsl(ee,O,Y){const te=newParsingContext();return buildExpression(O,Y,te,ee)}function packColor(ee){const O=asArray(ee),Y=O[0]*256,te=O[1],ne=O[2]*256,xe=Math.round(O[3]*255);return[Y+te,ne+xe]}const UNPACK_COLOR_FN=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[0], 256.0) / 255.0, 1.0),
    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[1], 256.0) / 255.0, 1.0)
  );
}`;function getGlslSizeFromType(ee){return ee===ColorType$1||ee===SizeType?2:ee===NumberArrayType$1?4:1}function getGlslTypeFromType(ee){const O=getGlslSizeFromType(ee);return O>1?`vec${O}`:"float"}function applyContextToBuilder(ee,O){for(const Y in O.variables){const te=O.variables[Y],ne=uniformNameForVariable(te.name);let xe=getGlslTypeFromType(te.type);te.type===ColorType$1&&(xe="vec4"),ee.addUniform(ne,xe)}for(const Y in O.properties){const te=O.properties[Y],ne=getGlslTypeFromType(te.type),xe=`a_prop_${te.name}`;te.type===ColorType$1?ee.addAttribute(xe,ne,`unpackColor(${xe})`,"vec4"):ee.addAttribute(xe,ne)}for(const Y in O.functions)ee.addVertexShaderFunction(O.functions[Y]),ee.addFragmentShaderFunction(O.functions[Y])}function generateUniformsFromContext(ee,O){const Y={};for(const te in ee.variables){const ne=ee.variables[te],xe=uniformNameForVariable(ne.name);Y[xe]=()=>{const et=O[ne.name];if(typeof et=="number")return et;if(typeof et=="boolean")return et?1:0;if(ne.type===ColorType$1){const tt=[...asArray(et||"#eee")];return tt[0]/=255,tt[1]/=255,tt[2]/=255,tt[3]??=1,tt}return typeof et=="string"?getStringNumberEquivalent(et):et}}return Y}function generateAttributesFromContext(ee){const O={};for(const Y in ee.properties){const te=ee.properties[Y],ne=xe=>{const et=xe.get(te.name);return te.type===ColorType$1?packColor([...asArray(et||"#eee")]):typeof et=="string"?getStringNumberEquivalent(et):typeof et=="boolean"?et?1:0:et};O[`prop_${te.name}`]={size:getGlslSizeFromType(te.type),callback:ne}}return O}const COMMON_HEADER=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders

${UNPACK_COLOR_FN}
`,DEFAULT_STYLE=createDefaultStyle();class ShaderBuilder{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${numberToGlsl(DEFAULT_STYLE["circle-radius"])} + ${numberToGlsl(DEFAULT_STYLE["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=colorToGlsl(DEFAULT_STYLE["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=numberToGlsl(DEFAULT_STYLE["stroke-width"]),this.strokeColorExpression_=colorToGlsl(DEFAULT_STYLE["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=stringToGlsl("round"),this.strokeJoinExpression_=stringToGlsl("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.strokePatternLengthExpression_=null,this.hasFill_=!1,this.fillColorExpression_=colorToGlsl(DEFAULT_STYLE["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(O,Y){return this.uniforms_.push({name:O,type:Y}),this}addAttribute(O,Y,te,ne){return this.attributes_.push({name:O,type:Y,varyingName:O.replace(/^a_/,"v_"),varyingType:ne??Y,varyingExpression:te??O}),this}setSymbolSizeExpression(O){return this.hasSymbol_=!0,this.symbolSizeExpression_=O,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(O){return this.symbolRotationExpression_=O,this}setSymbolOffsetExpression(O){return this.symbolOffsetExpression_=O,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(O){return this.hasSymbol_=!0,this.symbolColorExpression_=O,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(O){return this.texCoordExpression_=O,this}setFragmentDiscardExpression(O){return this.discardExpression_=O,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(O){return this.symbolRotateWithView_=O,this}setStrokeWidthExpression(O){return this.hasStroke_=!0,this.strokeWidthExpression_=O,this}setStrokeColorExpression(O){return this.hasStroke_=!0,this.strokeColorExpression_=O,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(O){return this.strokeOffsetExpression_=O,this}setStrokeCapExpression(O){return this.strokeCapExpression_=O,this}setStrokeJoinExpression(O){return this.strokeJoinExpression_=O,this}setStrokeMiterLimitExpression(O){return this.strokeMiterLimitExpression_=O,this}setStrokeDistanceFieldExpression(O){return this.strokeDistanceFieldExpression_=O,this}setStrokePatternLengthExpression(O){return this.strokePatternLengthExpression_=O,this}getStrokePatternLengthExpression(){return this.strokePatternLengthExpression_}setFillColorExpression(O){return this.hasFill_=!0,this.fillColorExpression_=O,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(O){return this.vertexShaderFunctions_.includes(O)?this:(this.vertexShaderFunctions_.push(O),this)}addFragmentShaderFunction(O){return this.fragmentShaderFunctions_.includes(O)?this:(this.fragmentShaderFunctions_.push(O),this)}getSymbolVertexShader(){return this.hasSymbol_?`${COMMON_HEADER}
${this.uniforms_.map(O=>`uniform ${O.type} ${O.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_localPosition;
attribute vec2 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(O=>`attribute ${O.type} ${O.name};
varying ${O.varyingType} ${O.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx + a_localPosition * halfSizePx * vec2(1., -1.);
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = mix(texCoord.s, texCoord.p, a_localPosition.x * 0.5 + 0.5);
  float v = mix(texCoord.t, texCoord.q, a_localPosition.y * 0.5 + 0.5);
  v_texCoord = vec2(u, v);
  v_hitColor = unpackColor(a_hitColor);
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(O=>`  ${O.varyingName} = ${O.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${COMMON_HEADER}
${this.uniforms_.map(O=>`uniform ${O.type} ${O.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(O=>`varying ${O.varyingType} ${O.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(O=>`  ${O.varyingType} ${O.name} = ${O.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${COMMON_HEADER}
${this.uniforms_.map(O=>`uniform ${O.type} ${O.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute vec2 a_localPosition;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_angleTangentSum;
attribute float a_distanceLow;
attribute float a_distanceHigh;
attribute vec2 a_joinAngles;
attribute vec2 a_hitColor;

varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(O=>`attribute ${O.type} ${O.name};
varying ${O.varyingType} ${O.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float startEndRatio = a_localPosition.x * 0.5 + 0.5;
  currentLineMetric = mix(a_measureStart, a_measureEnd, startEndRatio);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = -1. * a_localPosition.y;
  float tangentDir = -1. * a_localPosition.x;
  float angle = mix(v_angleStart, v_angleEnd, startEndRatio);
  vec2 joinDirection;
  vec2 positionPx = mix(segmentStartPx, segmentEndPx, startEndRatio);
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${LINESTRING_ANGLE_COSINE_CUTOFF} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStartPx = segmentStartPx;
  v_segmentEndPx = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = unpackColor(a_hitColor);

  v_distancePx = a_distanceLow / u_resolution - (lineOffsetPx * a_angleTangentSum);
  float distanceHighPx = a_distanceHigh / u_resolution;
  ${this.strokePatternLengthExpression_!==null?`v_distancePx = mod(v_distancePx, ${this.strokePatternLengthExpression_});
  distanceHighPx = mod(distanceHighPx, ${this.strokePatternLengthExpression_});
  `:""}v_distancePx += distanceHighPx;

  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(O=>`  ${O.varyingName} = ${O.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${COMMON_HEADER}
${this.uniforms_.map(O=>`uniform ${O.type} ${O.name};`).join(`
`)}
varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(O=>`varying ${O.varyingType} ${O.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${LINESTRING_ANGLE_COSINE_CUTOFF}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${stringToGlsl("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${stringToGlsl("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${stringToGlsl("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${stringToGlsl("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(O=>`  ${O.varyingType} ${O.name} = ${O.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPointPx = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPointPx);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLengthPx = length(v_segmentEndPx - v_segmentStartPx);
  segmentLengthPx = max(segmentLengthPx, 1.17549429e-38); // avoid divide by zero
  vec2 segmentTangent = (v_segmentEndPx - v_segmentStartPx) / segmentLengthPx;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPointPx = currentPointPx - v_segmentStartPx;
  float lengthToPointPx = max(0., min(dot(segmentTangent, startToPointPx), segmentLengthPx));
  float currentLengthPx = lengthToPointPx + v_distancePx;
  float currentRadiusPx = distanceFromSegment(currentPointPx, v_segmentStartPx, v_segmentEndPx);
  float currentRadiusRatio = dot(segmentNormal, startToPointPx) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPointPx / segmentLengthPx);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPointPx, v_segmentEndPx, v_segmentStartPx, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${COMMON_HEADER}
${this.uniforms_.map(O=>`uniform ${O.type} ${O.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(O=>`attribute ${O.type} ${O.name};
varying ${O.varyingType} ${O.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = unpackColor(a_hitColor);
${this.attributes_.map(O=>`  ${O.varyingName} = ${O.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${COMMON_HEADER}
${this.uniforms_.map(O=>`uniform ${O.type} ${O.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(O=>`varying ${O.varyingType} ${O.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(O=>`  ${O.varyingType} ${O.name} = ${O.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}class MixedGeometryBatch{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(O,Y){for(let te=0;te<O.length;te++)this.addFeature(O[te],Y)}addFeature(O,Y){let te=O.getGeometry();te&&(Y&&(te=te.clone(),te.applyTransform(Y)),this.addGeometry_(te,O))}clearFeatureEntryInPointBatch_(O){const Y=getUid(O),te=this.pointBatch.entries[Y];if(te)return this.pointBatch.geometriesCount-=te.flatCoordss.length,delete this.pointBatch.entries[Y],te}clearFeatureEntryInLineStringBatch_(O){const Y=getUid(O),te=this.lineStringBatch.entries[Y];if(te)return this.lineStringBatch.verticesCount-=te.verticesCount,this.lineStringBatch.geometriesCount-=te.flatCoordss.length,delete this.lineStringBatch.entries[Y],te}clearFeatureEntryInPolygonBatch_(O){const Y=getUid(O),te=this.polygonBatch.entries[Y];if(te)return this.polygonBatch.verticesCount-=te.verticesCount,this.polygonBatch.ringsCount-=te.ringsCount,this.polygonBatch.geometriesCount-=te.flatCoordss.length,delete this.polygonBatch.entries[Y],te}addGeometry_(O,Y){const te=O.getType();switch(te){case"GeometryCollection":{const ne=O.getGeometriesArray();for(const xe of ne)this.addGeometry_(xe,Y);break}case"MultiPolygon":{const ne=O;this.addCoordinates_(te,ne.getFlatCoordinates(),ne.getEndss(),Y,getUid(Y),ne.getStride());break}case"MultiLineString":{const ne=O;this.addCoordinates_(te,ne.getFlatCoordinates(),ne.getEnds(),Y,getUid(Y),ne.getStride());break}case"MultiPoint":{const ne=O;this.addCoordinates_(te,ne.getFlatCoordinates(),null,Y,getUid(Y),ne.getStride());break}case"Polygon":{const ne=O;this.addCoordinates_(te,ne.getFlatCoordinates(),ne.getEnds(),Y,getUid(Y),ne.getStride());break}case"Point":{const ne=O;this.addCoordinates_(te,ne.getFlatCoordinates(),null,Y,getUid(Y),ne.getStride());break}case"LineString":case"LinearRing":{const ne=O,xe=ne.getStride();this.addCoordinates_(te,ne.getFlatCoordinates(),null,Y,getUid(Y),xe,ne.getLayout?.());break}}}addCoordinates_(O,Y,te,ne,xe,et,tt){let it;switch(O){case"MultiPolygon":{const st=te;for(let ot=0,rt=st.length;ot<rt;ot++){let nt=st[ot];const at=ot>0?st[ot-1]:null,ct=at?at[at.length-1]:0,ut=nt[nt.length-1];nt=ct>0?nt.map(dt=>dt-ct):nt,this.addCoordinates_("Polygon",Y.slice(ct,ut),nt,ne,xe,et,tt)}break}case"MultiLineString":{const st=te;for(let ot=0,rt=st.length;ot<rt;ot++){const nt=ot>0?st[ot-1]:0;this.addCoordinates_("LineString",Y.slice(nt,st[ot]),null,ne,xe,et,tt)}break}case"MultiPoint":for(let st=0,ot=Y.length;st<ot;st+=et)this.addCoordinates_("Point",Y.slice(st,st+2),null,ne,xe,null,null);break;case"Polygon":{const st=te;if(ne instanceof RenderFeature){const nt=inflateEnds(Y,st);if(nt.length>1){this.addCoordinates_("MultiPolygon",Y,nt,ne,xe,et,tt);return}}this.polygonBatch.entries[xe]||(this.polygonBatch.entries[xe]=this.addRefToEntry_(xe,{feature:ne,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),it=Y.length/et;const ot=te.length,rt=te.map((nt,at,ct)=>at>0?(nt-ct[at-1])/et:nt/et);this.polygonBatch.verticesCount+=it,this.polygonBatch.ringsCount+=ot,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[xe].flatCoordss.push(getFlatCoordinatesXY(Y,et)),this.polygonBatch.entries[xe].ringsVerticesCounts.push(rt),this.polygonBatch.entries[xe].verticesCount+=it,this.polygonBatch.entries[xe].ringsCount+=ot;for(let nt=0,at=st.length;nt<at;nt++){const ct=nt>0?st[nt-1]:0;this.addCoordinates_("LinearRing",Y.slice(ct,st[nt]),null,ne,xe,et,tt)}break}case"Point":this.pointBatch.entries[xe]||(this.pointBatch.entries[xe]=this.addRefToEntry_(xe,{feature:ne,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[xe].flatCoordss.push(Y);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[xe]||(this.lineStringBatch.entries[xe]=this.addRefToEntry_(xe,{feature:ne,flatCoordss:[],verticesCount:0})),it=Y.length/et,this.lineStringBatch.verticesCount+=it,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[xe].flatCoordss.push(getFlatCoordinatesXYM(Y,et,tt)),this.lineStringBatch.entries[xe].verticesCount+=it;break}}addRefToEntry_(O,Y){const te=this.uidToRef_.get(O),ne=te||this.freeGlobalRef_.pop()||++this.globalCounter_;return Y.ref=ne,te||(this.refToFeature_.set(ne,Y.feature),this.uidToRef_.set(O,ne)),Y}removeRef_(O,Y){if(!O)throw new Error("This feature has no ref: "+Y);this.refToFeature_.delete(O),this.uidToRef_.delete(Y),this.freeGlobalRef_.push(O)}changeFeature(O,Y){if(!this.uidToRef_.get(getUid(O)))return;this.removeFeature(O);let te=O.getGeometry();te&&(Y&&(te=te.clone(),te.applyTransform(Y)),this.addGeometry_(te,O))}removeFeature(O){let Y=this.clearFeatureEntryInPointBatch_(O);Y=this.clearFeatureEntryInPolygonBatch_(O)||Y,Y=this.clearFeatureEntryInLineStringBatch_(O)||Y,Y&&this.removeRef_(Y.ref,getUid(Y.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(O){return this.refToFeature_.get(O)}isEmpty(){return this.globalCounter_===0}filter(O){const Y=new MixedGeometryBatch;Y.globalCounter_=this.globalCounter_,Y.uidToRef_=this.uidToRef_,Y.refToFeature_=this.refToFeature_;let te=!0;for(const ne of this.refToFeature_.values())O(ne)&&(Y.addFeature(ne),te=!1);return te?new MixedGeometryBatch:Y}}function getFlatCoordinatesXY(ee,O){return O===2?ee:ee.filter((Y,te)=>te%O<2)}function getFlatCoordinatesXYM(ee,O,Y){return O===3&&Y==="XYM"?ee:O===4?ee.filter((te,ne)=>ne%O!==2):O===3?ee.map((te,ne)=>ne%O!==2?te:0):new Array(ee.length*1.5).fill(0).map((te,ne)=>ne%3===2?0:ee[Math.round(ne/1.5)])}function create(){const ee='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let f=e(t,0,i,x,!0);const l=[];if(!f||f.next===f.prev)return l;let c,y,h;if(o&&(f=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const f=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);f===f.next&&(f.steiner=!0),o.push(a(f))}o.sort(u);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,f,x)),t.length>80*x){c=t[0],y=t[1];let e=c,n=y;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<y&&(y=o),x>e&&(e=x),o>n&&(n=o)}h=Math.max(e-c,n-y),h=0!==h?32767/h:0}return r(f,l,x,c,y,h,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=d(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=d(x/r|0,t[x],t[x+1],o);return o&&b(o,o.next)&&(w(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,u,s,l,a,y){if(!t)return;!y&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,f=0;for(let t=0;t<n&&(f++,i=i.nextZ,i);t++);let u=n;for(;f>0||u>0&&i;)0!==f&&(0===u||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let h=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),w(t),t=p.next,h=p.next;else if((t=p)===h){y?1===y?r(t=i(n(t),e),e,u,s,l,a,2):2===y&&f(t,e,u,s,l,a):r(n(t),e,u,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,f=e.y,u=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(f,u,s),a=Math.max(x,o,i),y=Math.max(f,u,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=y&&h(x,f,o,u,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const f=x.x,u=o.x,s=i.x,l=x.y,a=o.y,y=i.y,p=Math.min(f,u,s),b=Math.min(l,a,y),M=Math.max(f,u,s),m=Math.max(l,a,y),A=c(p,b,e,n,r),g=c(M,m,e,n,r);let Z=t.prevZ,d=t.nextZ;for(;Z&&Z.z>=A&&d&&d.z<=g;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;Z&&Z.z>=A;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;d&&d.z<=g;){if(d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!b(n,x)&&M(n,r,r.next,x)&&g(n,x)&&g(x,n)&&(e.push(n.i,r.i,x.i),w(r),w(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function f(t,e,x,o,i,f){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&p(u,t)){let s=Z(u,t);return u=n(u,u.next),s=n(s,s.next),r(u,e,x,o,i,f,0),void r(s,e,x,o,i,f,0)}t=t.next}u=u.next}while(u!==t)}function u(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(b(t,n))return n;do{if(b(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const f=o,u=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=u&&r!==n.x&&y(x<s?r:i,x,u,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);g(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==f);return o}(t,e);if(!r)return e;const x=Z(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,x,o,i,f){return(x-i)*(e-f)>=(t-i)*(o-f)&&(t-i)*(r-f)>=(n-i)*(e-f)&&(n-i)*(o-f)>=(x-i)*(r-f)}function h(t,e,n,r,x,o,i,f){return!(t===i&&e===f)&&y(t,e,n,r,x,o,i,f)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&M(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(g(t,e)&&g(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||b(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,n,r){const x=A(v(t,e,n)),o=A(v(t,e,r)),i=A(v(n,r,t)),f=A(v(n,r,e));return x!==o&&i!==f||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==i||!m(n,t,r))||!(0!==f||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function g(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function Z(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function I(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],f=e[3],u=e[4],s=e[5];return t[0]=f/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-f*u)/n,t[5]=-(x*s-o*u)/n,t}new Array(6);const z=[],B={vertexAttributesPosition:0,instanceAttributesPosition:0,indicesPosition:0};function P(t,e,n,r,x){const o=t[e++],i=t[e++],f=z;f.length=r;for(let n=0;n<f.length;n++)f[n]=t[e+n];let u=x?x.instanceAttributesPosition:0;return n[u++]=o,n[u++]=i,f.length&&(n.set(f,u),u+=f.length),B.instanceAttributesPosition=u,B}function N(t,e,n,r,x,o,i,f,u,s){const l=[t[e],t[e+1]],c=[t[n],t[n+1]],a=t[e+2],y=t[n+2],h=E(f,[...l]),p=E(f,[...c]);function v(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),f=[(n[0]-t[0])/i,(n[1]-t[1])/i];let u=0===r||0===i?0:Math.acos((s=f[0]*x[0]+f[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;u=Math.max(u,1e-5);return f[0]*o[0]+f[1]*o[1]>0?u:2*Math.PI-u}let b=-1,M=-1,m=s;const A=null!==x;if(null!==r){b=v(h,p,E(f,[...[t[r],t[r+1]]])),Math.cos(b)<=.985&&(m+=Math.tan((b-Math.PI)/2))}if(A){M=v(p,h,E(f,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((Math.PI-M)/2))}const g=Math.pow(2,24),Z=u%g,d=Math.floor(u/g)*g;return o.push(l[0],l[1],a,c[0],c[1],y,b,M,Z,d,s),o.push(...i),{length:u+Math.sqrt((p[0]-h[0])*(p[0]-h[0])+(p[1]-h[1])*(p[1]-h[1])),angle:m}}function R(e,n,r,x,o){const i=2+o;let f=n;const u=e.slice(f,f+o);f+=o;const s=e[f++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[f++],t<s-1&&(c[t]=l);const a=e.slice(f,f+2*l),y=t(a,c,2);for(let t=0;t<y.length;t++)x.push(y[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...u);return f+2*l}const S="GENERATE_POLYGON_BUFFERS",T="GENERATE_POINT_BUFFERS",_="GENERATE_LINE_STRING_BUFFERS",O=self;O.onmessage=t=>{const e=t.data;switch(e.type){case T:{const t=2,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x*(t+r),f=Uint32Array.from([0,1,3,1,2,3]),u=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),s=new Float32Array(i);let l;for(let t=0;t<o.length;t+=x)l=P(o,t,s,r,l);const c=Object.assign({indicesBuffer:f.buffer,vertexAttributesBuffer:u.buffer,instanceAttributesBuffer:s.buffer,renderInstructions:o.buffer},e);O.postMessage(c,[u.buffer,s.buffer,f.buffer,o.buffer]);break}case _:{const t=[],n=e.customAttributesSize,r=3,x=new Float32Array(e.renderInstructions);let o=0;const i=[1,0,0,1,0,0];let f,u;for(I(i,e.renderInstructionsTransform);o<x.length;){u=Array.from(x.slice(o,o+n)),o+=n,f=x[o++];const e=o,s=o+(f-1)*r,l=x[e]===x[s]&&x[e+1]===x[s+1];let c=0,a=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=o+(n-1)*r:l&&(y=s-r);let h=null;n<f-2?h=o+(n+2)*r:l&&(h=e+r);const p=N(x,o+n*r,o+(n+1)*r,y,h,t,u,i,c,a);c=p.length,a=p.angle}o+=f*r}const s=Uint32Array.from([0,1,3,1,2,3]),l=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),c=Float32Array.from(t),a=Object.assign({indicesBuffer:s.buffer,vertexAttributesBuffer:l.buffer,instanceAttributesBuffer:c.buffer,renderInstructions:x.buffer},e);O.postMessage(a,[l.buffer,c.buffer,s.buffer,x.buffer]);break}case S:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=R(x,o,t,n,r);const i=Uint32Array.from(n),f=Float32Array.from(t),u=Float32Array.from([]),s=Object.assign({indicesBuffer:i.buffer,vertexAttributesBuffer:f.buffer,instanceAttributesBuffer:u.buffer,renderInstructions:x.buffer},e);O.postMessage(s,[f.buffer,u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(ee,"binary").toString("base64"):URL.createObjectURL(new Blob([ee],{type:"application/javascript"})))}const WebGLWorkerMessageType={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function colorEncodeIdAndPack(ee,O){O=O||[];const Y=256,te=Y-1,ne=Math.floor(ee/Y/Y/Y)/te,xe=Math.floor(ee/Y/Y)%Y/te,et=Math.floor(ee/Y)%Y/te,tt=ee%Y/te;return O[0]=ne*256*255+xe*255,O[1]=et*256*255+tt*255,O}function colorDecodeId(ee){let O=0;const Y=256,te=Y-1;return O+=Math.round(ee[0]*Y*Y*Y*te),O+=Math.round(ee[1]*Y*Y*te),O+=Math.round(ee[2]*Y*te),O+=Math.round(ee[3]*te),O}function pushCustomAttributesInRenderInstructions(ee,O,Y,te){let ne=0;for(const xe in O){const et=O[xe],tt=et.callback.call(Y,Y.feature);let it=tt?.[0]??tt;it===UNDEFINED_PROP_VALUE&&console.warn('The "has" operator might return false positives.'),it===void 0?it=UNDEFINED_PROP_VALUE:it===null&&(it=0),ee[te+ne++]=it,!(!et.size||et.size===1)&&(ee[te+ne++]=tt[1],!(et.size<3)&&(ee[te+ne++]=tt[2],!(et.size<4)&&(ee[te+ne++]=tt[3])))}return ne}function getCustomAttributesSize(ee){return Object.keys(ee).reduce((O,Y)=>O+(ee[Y].size||1),0)}function generatePointRenderInstructions(ee,O,Y,te){const ne=(2+getCustomAttributesSize(Y))*ee.geometriesCount;(!O||O.length!==ne)&&(O=new Float32Array(ne));const xe=[];let et=0;for(const tt in ee.entries){const it=ee.entries[tt];for(let st=0,ot=it.flatCoordss.length;st<ot;st++)xe[0]=it.flatCoordss[st][0],xe[1]=it.flatCoordss[st][1],apply$1(te,xe),O[et++]=xe[0],O[et++]=xe[1],et+=pushCustomAttributesInRenderInstructions(O,Y,it,et)}return O}function generateLineStringRenderInstructions(ee,O,Y,te){const ne=3*ee.verticesCount+(1+getCustomAttributesSize(Y))*ee.geometriesCount;(!O||O.length!==ne)&&(O=new Float32Array(ne));const xe=[];let et=0;for(const tt in ee.entries){const it=ee.entries[tt];for(let st=0,ot=it.flatCoordss.length;st<ot;st++){xe.length=it.flatCoordss[st].length,transform2D(it.flatCoordss[st],0,xe.length,3,te,xe,3),et+=pushCustomAttributesInRenderInstructions(O,Y,it,et),O[et++]=xe.length/3;for(let rt=0,nt=xe.length;rt<nt;rt+=3)O[et++]=xe[rt],O[et++]=xe[rt+1],O[et++]=xe[rt+2]}}return O}function generatePolygonRenderInstructions(ee,O,Y,te){const ne=2*ee.verticesCount+(1+getCustomAttributesSize(Y))*ee.geometriesCount+ee.ringsCount;(!O||O.length!==ne)&&(O=new Float32Array(ne));const xe=[];let et=0;for(const tt in ee.entries){const it=ee.entries[tt];for(let st=0,ot=it.flatCoordss.length;st<ot;st++){xe.length=it.flatCoordss[st].length,transform2D(it.flatCoordss[st],0,xe.length,2,te,xe),et+=pushCustomAttributesInRenderInstructions(O,Y,it,et),O[et++]=it.ringsVerticesCounts[st].length;for(let rt=0,nt=it.ringsVerticesCounts[st].length;rt<nt;rt++)O[et++]=it.ringsVerticesCounts[st][rt];for(let rt=0,nt=xe.length;rt<nt;rt+=2)O[et++]=xe[rt],O[et++]=xe[rt+1]}}return O}function computeHash(ee){return(JSON.stringify(ee).split("").reduce((Y,te)=>(Y<<5)-Y+te.charCodeAt(0),0)>>>0).toString()}function parseCommonSymbolProperties(ee,O,Y,te){if(`${te}radius`in ee&&te!=="icon-"){let ne=expressionToGlsl(Y,ee[`${te}radius`],NumberType$1);if(`${te}radius2`in ee){const xe=expressionToGlsl(Y,ee[`${te}radius2`],NumberType$1);ne=`max(${ne}, ${xe})`}`${te}stroke-width`in ee&&(ne=`(${ne} + ${expressionToGlsl(Y,ee[`${te}stroke-width`],NumberType$1)} * 0.5)`),O.setSymbolSizeExpression(`vec2(${ne} * 2. + 0.5)`)}if(`${te}scale`in ee){const ne=expressionToGlsl(Y,ee[`${te}scale`],SizeType);O.setSymbolSizeExpression(`${O.getSymbolSizeExpression()} * ${ne}`)}`${te}displacement`in ee&&O.setSymbolOffsetExpression(expressionToGlsl(Y,ee[`${te}displacement`],NumberArrayType$1)),`${te}rotation`in ee&&O.setSymbolRotationExpression(expressionToGlsl(Y,ee[`${te}rotation`],NumberType$1)),`${te}rotate-with-view`in ee&&O.setSymbolRotateWithView(!!ee[`${te}rotate-with-view`])}function getColorFromDistanceField(ee,O,Y,te,ne){let xe="vec4(0.)";if(O!==null&&(xe=O),Y!==null&&te!==null){const it=`smoothstep(-${te} + 0.63, -${te} - 0.58, ${ee})`;xe=`mix(${Y}, ${xe}, ${it})`}const et=`(1.0 - smoothstep(-0.63, 0.58, ${ee}))`;let tt=`${xe} * vec4(1.0, 1.0, 1.0, ${et})`;return ne!==null&&(tt=`${tt} * vec4(1.0, 1.0, 1.0, ${ne})`),tt}function parseImageProperties(ee,O,Y,te,ne){const xe=new Image;xe.crossOrigin=ee[`${te}cross-origin`]===void 0?"anonymous":ee[`${te}cross-origin`],assert(typeof ee[`${te}src`]=="string",`WebGL layers do not support expressions for the ${te}src style property`),xe.src=ee[`${te}src`],Y[`u_texture${ne}_size`]=()=>xe.complete?[xe.width,xe.height]:[0,0],O.addUniform(`u_texture${ne}_size`,"vec2");const et=`u_texture${ne}_size`;return Y[`u_texture${ne}`]=xe,O.addUniform(`u_texture${ne}`,"sampler2D"),et}function parseImageOffsetProperties(ee,O,Y,te,ne){let xe=expressionToGlsl(Y,ee[`${O}offset`],SizeType);if(`${O}offset-origin`in ee)switch(ee[`${O}offset-origin`]){case"top-right":xe=`vec2(${te}.x, 0.) + ${ne} * vec2(-1., 0.) + ${xe} * vec2(-1., 1.)`;break;case"bottom-left":xe=`vec2(0., ${te}.y) + ${ne} * vec2(0., -1.) + ${xe} * vec2(1., -1.)`;break;case"bottom-right":xe=`${te} - ${ne} - ${xe}`;break}return xe}function parseCircleProperties(ee,O,Y,te){te.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,parseCommonSymbolProperties(ee,O,te,"circle-");let ne=null;"circle-opacity"in ee&&(ne=expressionToGlsl(te,ee["circle-opacity"],NumberType$1));let xe="coordsPx";"circle-scale"in ee&&(xe=`coordsPx / ${expressionToGlsl(te,ee["circle-scale"],SizeType)}`);let et=null;"circle-fill-color"in ee&&(et=expressionToGlsl(te,ee["circle-fill-color"],ColorType$1));let tt=null;"circle-stroke-color"in ee&&(tt=expressionToGlsl(te,ee["circle-stroke-color"],ColorType$1));let it=expressionToGlsl(te,ee["circle-radius"],NumberType$1),st=null;"circle-stroke-width"in ee&&(st=expressionToGlsl(te,ee["circle-stroke-width"],NumberType$1),it=`(${it} + ${st} * 0.5)`);const ot=`circleDistanceField(${xe}, ${it})`,rt=getColorFromDistanceField(ot,et,tt,st,ne);O.setSymbolColorExpression(rt)}function parseShapeProperties(ee,O,Y,te){te.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,te.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,te.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,parseCommonSymbolProperties(ee,O,te,"shape-");let ne=null;"shape-opacity"in ee&&(ne=expressionToGlsl(te,ee["shape-opacity"],NumberType$1));let xe="coordsPx";"shape-scale"in ee&&(xe=`coordsPx / ${expressionToGlsl(te,ee["shape-scale"],SizeType)}`);let et=null;"shape-fill-color"in ee&&(et=expressionToGlsl(te,ee["shape-fill-color"],ColorType$1));let tt=null;"shape-stroke-color"in ee&&(tt=expressionToGlsl(te,ee["shape-stroke-color"],ColorType$1));let it=null;"shape-stroke-width"in ee&&(it=expressionToGlsl(te,ee["shape-stroke-width"],NumberType$1));const st=expressionToGlsl(te,ee["shape-points"],NumberType$1);let ot="0.";"shape-angle"in ee&&(ot=expressionToGlsl(te,ee["shape-angle"],NumberType$1));let rt,nt=expressionToGlsl(te,ee["shape-radius"],NumberType$1);if(it!==null&&(nt=`${nt} + ${it} * 0.5`),"shape-radius2"in ee){let ct=expressionToGlsl(te,ee["shape-radius2"],NumberType$1);it!==null&&(ct=`${ct} + ${it} * 0.5`),rt=`starDistanceField(${xe}, ${st}, ${nt}, ${ct}, ${ot})`}else rt=`regularDistanceField(${xe}, ${st}, ${nt}, ${ot})`;const at=getColorFromDistanceField(rt,et,tt,it,ne);O.setSymbolColorExpression(at)}function parseIconProperties(ee,O,Y,te){let ne="vec4(1.0)";"icon-color"in ee&&(ne=expressionToGlsl(te,ee["icon-color"],ColorType$1)),"icon-opacity"in ee&&(ne=`${ne} * vec4(1.0, 1.0, 1.0, ${expressionToGlsl(te,ee["icon-opacity"],NumberType$1)})`);const xe=computeHash(ee["icon-src"]),et=parseImageProperties(ee,O,Y,"icon-",xe);if(O.setSymbolColorExpression(`${ne} * texture2D(u_texture${xe}, v_texCoord)`).setSymbolSizeExpression(et),"icon-width"in ee&&"icon-height"in ee&&O.setSymbolSizeExpression(`vec2(${expressionToGlsl(te,ee["icon-width"],NumberType$1)}, ${expressionToGlsl(te,ee["icon-height"],NumberType$1)})`),"icon-offset"in ee&&"icon-size"in ee){const tt=expressionToGlsl(te,ee["icon-size"],NumberArrayType$1),it=O.getSymbolSizeExpression();O.setSymbolSizeExpression(tt);const st=parseImageOffsetProperties(ee,"icon-",te,"v_quadSizePx",tt);O.setTextureCoordinateExpression(`(vec4((${st}).xyxy) + vec4(0., 0., ${tt})) / (${it}).xyxy`)}if(parseCommonSymbolProperties(ee,O,te,"icon-"),"icon-anchor"in ee){const tt=expressionToGlsl(te,ee["icon-anchor"],NumberArrayType$1);let it="1.0";"icon-scale"in ee&&(it=expressionToGlsl(te,ee["icon-scale"],SizeType));let st;ee["icon-anchor-x-units"]==="pixels"&&ee["icon-anchor-y-units"]==="pixels"?st=`${tt} * ${it}`:ee["icon-anchor-x-units"]==="pixels"?st=`${tt} * vec2(vec2(${it}).x, v_quadSizePx.y)`:ee["icon-anchor-y-units"]==="pixels"?st=`${tt} * vec2(v_quadSizePx.x, vec2(${it}).x)`:st=`${tt} * v_quadSizePx`;let ot=`v_quadSizePx * vec2(0.5, -0.5) + ${st} * vec2(-1., 1.)`;if("icon-anchor-origin"in ee)switch(ee["icon-anchor-origin"]){case"top-right":ot=`v_quadSizePx * -0.5 + ${st}`;break;case"bottom-left":ot=`v_quadSizePx * 0.5 - ${st}`;break;case"bottom-right":ot=`v_quadSizePx * vec2(-0.5, 0.5) + ${st} * vec2(1., -1.)`;break}O.setSymbolOffsetExpression(`${O.getSymbolOffsetExpression()} + ${ot}`)}}function parseStrokeProperties(ee,O,Y,te){if("stroke-color"in ee&&O.setStrokeColorExpression(expressionToGlsl(te,ee["stroke-color"],ColorType$1)),"stroke-pattern-src"in ee){const ne=computeHash(ee["stroke-pattern-src"]),xe=parseImageProperties(ee,O,Y,"stroke-pattern-",ne);let et=xe,tt="vec2(0.)";"stroke-pattern-offset"in ee&&"stroke-pattern-size"in ee&&(et=expressionToGlsl(te,ee["stroke-pattern-size"],NumberArrayType$1),tt=parseImageOffsetProperties(ee,"stroke-pattern-",te,xe,et));let it="0.";"stroke-pattern-spacing"in ee&&(it=expressionToGlsl(te,ee["stroke-pattern-spacing"],NumberType$1));let st="0.";"stroke-pattern-start-offset"in ee&&(st=expressionToGlsl(te,ee["stroke-pattern-start-offset"],NumberType$1)),te.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float startOffsetPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = (currentLengthPx - startOffsetPx) * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  float isInsideOfPattern = step(uCoordPx, sampleSize.x);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  vCoordPx = clamp(vCoordPx, 0.5, sampleSize.y - 0.5);
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord) * vec4(1.0, 1.0, 1.0, isInsideOfPattern);
}`;const ot=`u_texture${ne}`;let rt="1.";"stroke-color"in ee&&(rt=O.getStrokeColorExpression()),O.setStrokeColorExpression(`${rt} * sampleStrokePattern(${ot}, ${xe}, ${tt}, ${et}, ${it}, ${st}, currentLengthPx, currentRadiusRatio, v_width)`),te.functions.computeStrokePatternLength=`float computeStrokePatternLength(vec2 sampleSize, float spacingPx, float lineWidth) {
  float patternLengthPx = sampleSize.x / sampleSize.y * lineWidth;
  return patternLengthPx + spacingPx;
}`,O.setStrokePatternLengthExpression(`computeStrokePatternLength(${et}, ${it}, v_width)`)}if("stroke-width"in ee&&O.setStrokeWidthExpression(expressionToGlsl(te,ee["stroke-width"],NumberType$1)),"stroke-offset"in ee&&O.setStrokeOffsetExpression(expressionToGlsl(te,ee["stroke-offset"],NumberType$1)),"stroke-line-cap"in ee&&O.setStrokeCapExpression(expressionToGlsl(te,ee["stroke-line-cap"],StringType$1)),"stroke-line-join"in ee&&O.setStrokeJoinExpression(expressionToGlsl(te,ee["stroke-line-join"],StringType$1)),"stroke-miter-limit"in ee&&O.setStrokeMiterLimitExpression(expressionToGlsl(te,ee["stroke-miter-limit"],NumberType$1)),"stroke-line-dash"in ee){te.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${stringToGlsl("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${stringToGlsl("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let ne=ee["stroke-line-dash"].map(ct=>expressionToGlsl(te,ct,NumberType$1));ne.length%2===1&&(ne=[...ne,...ne]);let xe="0.";"stroke-line-dash-offset"in ee&&(xe=expressionToGlsl(te,ee["stroke-line-dash-offset"],NumberType$1));const tt=`dashDistanceField_${computeHash(ee["stroke-line-dash"])}`,it=ne.map((ct,ut)=>`float dashLength${ut}`).join(", "),st=ne.map((ct,ut)=>`dashLength${ut}`).join(" + ");let ot="0.",rt=`getSingleDashDistance(distance, radius, ${ot}, dashLength0, totalDashLength, capType, lineWidth)`;for(let ct=2;ct<ne.length;ct+=2)ot=`${ot} + dashLength${ct-2} + dashLength${ct-1}`,rt=`min(${rt}, getSingleDashDistance(distance, radius, ${ot}, dashLength${ct}, totalDashLength, capType, lineWidth))`;te.functions[tt]=`float ${tt}(float distance, float radius, float capType, float lineWidth, ${it}) {
  float totalDashLength = ${st};
  return ${rt};
}`;const nt=ne.map((ct,ut)=>`${ct}`).join(", ");O.setStrokeDistanceFieldExpression(`${tt}(currentLengthPx + ${xe}, currentRadiusPx, capType, v_width, ${nt})`);let at=ne.join(" + ");O.getStrokePatternLengthExpression()&&(te.functions.combinePatternLengths=`float combinePatternLengths(float patternLength1, float patternLength2) {
  return patternLength1 * patternLength2;
}`,at=`combinePatternLengths(${O.getStrokePatternLengthExpression()}, ${at})`),O.setStrokePatternLengthExpression(at)}}function parseFillProperties(ee,O,Y,te){if("fill-color"in ee&&O.setFillColorExpression(expressionToGlsl(te,ee["fill-color"],ColorType$1)),"fill-pattern-src"in ee){const ne=computeHash(ee["fill-pattern-src"]),xe=parseImageProperties(ee,O,Y,"fill-pattern-",ne);let et=xe,tt="vec2(0.)";"fill-pattern-offset"in ee&&"fill-pattern-size"in ee&&(et=expressionToGlsl(te,ee["fill-pattern-size"],NumberArrayType$1),tt=parseImageOffsetProperties(ee,"fill-pattern-",te,xe,et)),te.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const it=`u_texture${ne}`;let st="1.";"fill-color"in ee&&(st=O.getFillColorExpression()),O.setFillColorExpression(`${st} * sampleFillPattern(${it}, ${xe}, ${tt}, ${et}, pxOrigin, pxPos)`)}}function parseLiteralStyle(ee,O,Y){const te=newCompilationContext(),ne=new ShaderBuilder,xe={};if("icon-src"in ee?parseIconProperties(ee,ne,xe,te):"shape-points"in ee?parseShapeProperties(ee,ne,xe,te):"circle-radius"in ee&&parseCircleProperties(ee,ne,xe,te),parseStrokeProperties(ee,ne,xe,te),parseFillProperties(ee,ne,xe,te),Y){const it=expressionToGlsl(te,Y,BooleanType$1);ne.setFragmentDiscardExpression(`!${it}`)}const et={};function tt(it,st,ot,rt){if(!te[it])return;const nt=getGlslTypeFromType(ot),at=getGlslSizeFromType(ot);ne.addAttribute(`a_${st}`,nt),et[st]={size:at,callback:rt}}return tt("geometryType",GEOMETRY_TYPE_PROPERTY_NAME,StringType$1,it=>getStringNumberEquivalent(computeGeometryType(it.getGeometry()))),tt("featureId",FEATURE_ID_PROPERTY_NAME,StringType$1|NumberType$1,it=>{const st=it.getId()??null;return typeof st=="string"?getStringNumberEquivalent(st):st}),applyContextToBuilder(ne,te),{builder:ne,attributes:{...et,...generateAttributesFromContext(te)},uniforms:{...xe,...generateUniformsFromContext(te,O)}}}const tmpColor=[];let WEBGL_WORKER;function getWebGLWorker(){return WEBGL_WORKER||(WEBGL_WORKER=create()),WEBGL_WORKER}let workerMessageCounter=0;const Attributes={POSITION:"a_position",LOCAL_POSITION:"a_localPosition",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",ANGLE_TANGENT_SUM:"a_angleTangentSum",JOIN_ANGLES:"a_joinAngles",DISTANCE_LOW:"a_distanceLow",DISTANCE_HIGH:"a_distanceHigh"};class VectorStyleRenderer{constructor(O,Y,te,ne){this.helper_,this.hitDetectionEnabled_=!!ne,this.styleShaders=convertStyleToShaders(O,Y),this.customAttributes_={},this.uniforms_={},this.hitDetectionEnabled_&&(this.customAttributes_.hitColor={callback(){return colorEncodeIdAndPack(this.ref,tmpColor)},size:2});for(const xe of this.styleShaders){for(const et in xe.attributes)et in this.customAttributes_||(this.customAttributes_[et]=xe.attributes[et]);for(const et in xe.uniforms)et in this.uniforms_||(this.uniforms_[et]=xe.uniforms[et])}this.renderPasses_=this.styleShaders.map(xe=>{const et={},tt=Object.entries(this.customAttributes_).map(([it,st])=>({name:it in xe.attributes||it==="hitColor"?`a_${it}`:null,size:st.size||1,type:AttributeType.FLOAT}));return xe.builder.getFillVertexShader()&&(et.fillRenderPass={vertexShader:xe.builder.getFillVertexShader(),fragmentShader:xe.builder.getFillFragmentShader(),attributesDesc:[{name:Attributes.POSITION,size:2,type:AttributeType.FLOAT},...tt],instancedAttributesDesc:[],instancePrimitiveVertexCount:3}),xe.builder.getStrokeVertexShader()&&(et.strokeRenderPass={vertexShader:xe.builder.getStrokeVertexShader(),fragmentShader:xe.builder.getStrokeFragmentShader(),attributesDesc:[{name:Attributes.LOCAL_POSITION,size:2,type:AttributeType.FLOAT}],instancedAttributesDesc:[{name:Attributes.SEGMENT_START,size:2,type:AttributeType.FLOAT},{name:Attributes.MEASURE_START,size:1,type:AttributeType.FLOAT},{name:Attributes.SEGMENT_END,size:2,type:AttributeType.FLOAT},{name:Attributes.MEASURE_END,size:1,type:AttributeType.FLOAT},{name:Attributes.JOIN_ANGLES,size:2,type:AttributeType.FLOAT},{name:Attributes.DISTANCE_LOW,size:1,type:AttributeType.FLOAT},{name:Attributes.DISTANCE_HIGH,size:1,type:AttributeType.FLOAT},{name:Attributes.ANGLE_TANGENT_SUM,size:1,type:AttributeType.FLOAT},...tt],instancePrimitiveVertexCount:6}),xe.builder.getSymbolVertexShader()&&(et.symbolRenderPass={vertexShader:xe.builder.getSymbolVertexShader(),fragmentShader:xe.builder.getSymbolFragmentShader(),attributesDesc:[{name:Attributes.LOCAL_POSITION,size:2,type:AttributeType.FLOAT}],instancedAttributesDesc:[{name:Attributes.POSITION,size:2,type:AttributeType.FLOAT},...tt],instancePrimitiveVertexCount:6}),et}),this.hasFill_=this.renderPasses_.some(xe=>xe.fillRenderPass),this.hasStroke_=this.renderPasses_.some(xe=>xe.strokeRenderPass),this.hasSymbol_=this.renderPasses_.some(xe=>xe.symbolRenderPass),this.setHelper(te)}async generateBuffers(O,Y){if(O.isEmpty())return null;const te=this.generateRenderInstructions_(O,Y),[ne,xe,et]=await Promise.all([this.generateBuffersForType_(te.polygonInstructions,"Polygon",Y),this.generateBuffersForType_(te.lineStringInstructions,"LineString",Y),this.generateBuffersForType_(te.pointInstructions,"Point",Y)]),tt=makeInverse(create$2(),Y);return{polygonBuffers:ne,lineStringBuffers:xe,pointBuffers:et,invertVerticesTransform:tt}}generateRenderInstructions_(O,Y){const te=this.hasFill_?generatePolygonRenderInstructions(O.polygonBatch,new Float32Array(0),this.customAttributes_,Y):null,ne=this.hasStroke_?generateLineStringRenderInstructions(O.lineStringBatch,new Float32Array(0),this.customAttributes_,Y):null,xe=this.hasSymbol_?generatePointRenderInstructions(O.pointBatch,new Float32Array(0),this.customAttributes_,Y):null;return{polygonInstructions:te,lineStringInstructions:ne,pointInstructions:xe}}generateBuffersForType_(O,Y,te){if(O===null)return null;const ne=workerMessageCounter++;let xe;switch(Y){case"Polygon":xe=WebGLWorkerMessageType.GENERATE_POLYGON_BUFFERS;break;case"LineString":xe=WebGLWorkerMessageType.GENERATE_LINE_STRING_BUFFERS;break;case"Point":xe=WebGLWorkerMessageType.GENERATE_POINT_BUFFERS;break}const et={id:ne,type:xe,renderInstructions:O.buffer,renderInstructionsTransform:te,customAttributesSize:getCustomAttributesSize(this.customAttributes_)},tt=getWebGLWorker();return tt.postMessage(et,[O.buffer]),O=null,new Promise(it=>{const st=ot=>{const rt=ot.data;if(rt.id!==ne||(tt.removeEventListener("message",st),!this.helper_.getGL()))return;const nt=new WebGLArrayBuffer(ELEMENT_ARRAY_BUFFER,DYNAMIC_DRAW).fromArrayBuffer(rt.indicesBuffer),at=new WebGLArrayBuffer(ARRAY_BUFFER,DYNAMIC_DRAW).fromArrayBuffer(rt.vertexAttributesBuffer),ct=new WebGLArrayBuffer(ARRAY_BUFFER,DYNAMIC_DRAW).fromArrayBuffer(rt.instanceAttributesBuffer);this.helper_.flushBufferData(nt),this.helper_.flushBufferData(at),this.helper_.flushBufferData(ct),it([nt,at,ct])};tt.addEventListener("message",st)})}render(O,Y,te){for(const ne of this.renderPasses_)ne.fillRenderPass&&this.renderInternal_(O.polygonBuffers[0],O.polygonBuffers[1],O.polygonBuffers[2],ne.fillRenderPass,Y,te),ne.strokeRenderPass&&this.renderInternal_(O.lineStringBuffers[0],O.lineStringBuffers[1],O.lineStringBuffers[2],ne.strokeRenderPass,Y,te),ne.symbolRenderPass&&this.renderInternal_(O.pointBuffers[0],O.pointBuffers[1],O.pointBuffers[2],ne.symbolRenderPass,Y,te)}renderInternal_(O,Y,te,ne,xe,et){const tt=O.getSize();if(tt===0)return;const it=ne.instancedAttributesDesc.length;if(this.helper_.useProgram(ne.program,xe),this.helper_.bindBuffer(Y),this.helper_.bindBuffer(O),this.helper_.enableAttributes(ne.attributesDesc),this.helper_.bindBuffer(te),this.helper_.enableAttributesInstanced(ne.instancedAttributesDesc),et(),it){const st=ne.instancedAttributesDesc.reduce((rt,nt)=>rt+(nt.size||1),0),ot=te.getSize()/st;this.helper_.drawElementsInstanced(0,tt,ot)}else this.helper_.drawElements(0,tt)}setHelper(O,Y=null){this.helper_=O;for(const te of this.renderPasses_)te.fillRenderPass&&(te.fillRenderPass.program=this.helper_.getProgram(te.fillRenderPass.fragmentShader,te.fillRenderPass.vertexShader)),te.strokeRenderPass&&(te.strokeRenderPass.program=this.helper_.getProgram(te.strokeRenderPass.fragmentShader,te.strokeRenderPass.vertexShader)),te.symbolRenderPass&&(te.symbolRenderPass.program=this.helper_.getProgram(te.symbolRenderPass.fragmentShader,te.symbolRenderPass.vertexShader));this.helper_.addUniforms(this.uniforms_),Y&&(Y.polygonBuffers&&(this.helper_.flushBufferData(Y.polygonBuffers[0]),this.helper_.flushBufferData(Y.polygonBuffers[1]),this.helper_.flushBufferData(Y.polygonBuffers[2])),Y.lineStringBuffers&&(this.helper_.flushBufferData(Y.lineStringBuffers[0]),this.helper_.flushBufferData(Y.lineStringBuffers[1]),this.helper_.flushBufferData(Y.lineStringBuffers[2])),Y.pointBuffers&&(this.helper_.flushBufferData(Y.pointBuffers[0]),this.helper_.flushBufferData(Y.pointBuffers[1]),this.helper_.flushBufferData(Y.pointBuffers[2])))}}function convertStyleToShaders(ee,O){const Y=Array.isArray(ee)?ee:[ee];if("style"in Y[0]){const te=[],ne=Y,xe=[];for(const et of ne){const tt=Array.isArray(et.style)?et.style:[et.style];let it=et.filter;et.else&&xe.length&&(it=["all",...xe.map(ot=>["!",ot])],et.filter&&it.push(et.filter),it.length<3&&(it=it[1])),et.filter&&xe.push(et.filter);const st=tt.map(ot=>parseLiteralStyle(ot,O,it));te.push(...st)}return te}return"builder"in Y[0]?Y:Y.map(te=>parseLiteralStyle(te,O,null))}const tmpArray4=new Uint8Array(4);class WebGLRenderTarget{constructor(O,Y){this.helper_=O;const te=O.getGL();this.texture_=te.createTexture(),this.framebuffer_=te.createFramebuffer(),this.depthbuffer_=te.createRenderbuffer(),this.size_=Y||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(O){equals$2(O,this.size_)||(this.size_[0]=O[0],this.size_[1]=O[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const O=this.size_,Y=this.helper_.getGL();Y.bindFramebuffer(Y.FRAMEBUFFER,this.framebuffer_),Y.readPixels(0,0,O[0],O[1],Y.RGBA,Y.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(O,Y){if(O<0||Y<0||O>this.size_[0]||Y>=this.size_[1])return tmpArray4[0]=0,tmpArray4[1]=0,tmpArray4[2]=0,tmpArray4[3]=0,tmpArray4;this.readAll();const te=Math.floor(O)+(this.size_[1]-Math.floor(Y)-1)*this.size_[0];return tmpArray4[0]=this.data_[te*4],tmpArray4[1]=this.data_[te*4+1],tmpArray4[2]=this.data_[te*4+2],tmpArray4[3]=this.data_[te*4+3],tmpArray4}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const O=this.size_,Y=this.helper_.getGL();this.texture_=this.helper_.createTexture(O,null,this.texture_),Y.bindFramebuffer(Y.FRAMEBUFFER,this.framebuffer_),Y.viewport(0,0,O[0],O[1]),Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,this.texture_,0),Y.bindRenderbuffer(Y.RENDERBUFFER,this.depthbuffer_),Y.renderbufferStorage(Y.RENDERBUFFER,Y.DEPTH_COMPONENT16,O[0],O[1]),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,Y.DEPTH_ATTACHMENT,Y.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(O[0]*O[1]*4)}}function getWorldParameters(ee,O){const Y=ee.viewState.projection,ne=O.getSource().getWrapX()&&Y.canWrapX(),xe=Y.getExtent(),et=ee.extent,tt=ne?getWidth(xe):null,it=ne?Math.ceil((et[2]-xe[2])/tt)+1:1;return[ne?Math.floor((et[0]-xe[0])/tt):0,it,tt]}const Uniforms={...DefaultUniform,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class WebGLVectorLayerRenderer extends WebGLLayerRenderer{constructor(O,Y){const te={[Uniforms.RENDER_EXTENT]:[0,0,0,0],[Uniforms.PATTERN_ORIGIN]:[0,0],[Uniforms.GLOBAL_ALPHA]:1};super(O,{uniforms:te,postProcesses:Y.postProcesses}),this.hitDetectionEnabled_=!Y.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=createEmpty(),this.currentTransform_=create$2(),this.tmpCoords_=[0,0],this.tmpTransform_=create$2(),this.tmpMat4_=create$1(),this.currentFrameStateTransform_=create$2(),this.styleVariables_={},this.style_=[],this.styleRenderer_=null,this.buffers_=null,this.applyOptions_(Y),this.batch_=new MixedGeometryBatch,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(O){const Y=this.getLayer().getSource(),te=getUserProjection();let ne;te&&(ne=getTransformFromProjections(te,O.viewState.projection)),this.batch_.addFeatures(Y.getFeatures(),ne),this.sourceListenKeys_=[listen(Y,VectorEventType.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,ne)),listen(Y,VectorEventType.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,ne),this),listen(Y,VectorEventType.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),listen(Y,VectorEventType.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(O){this.styleVariables_=O.variables,this.style_=O.style}createRenderers_(){this.buffers_=null,this.styleRenderer_=new VectorStyleRenderer(this.style_,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}reset(O){this.applyOptions_(O),this.helper&&this.createRenderers_(),super.reset(O)}afterHelperCreated(){this.styleRenderer_?this.styleRenderer_.setHelper(this.helper,this.buffers_):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new WebGLRenderTarget(this.helper))}handleSourceFeatureAdded_(O,Y){const te=Y.feature;this.batch_.addFeature(te,O)}handleSourceFeatureChanged_(O,Y){const te=Y.feature;this.batch_.changeFeature(te,O)}handleSourceFeatureDelete_(O){const Y=O.feature;this.batch_.removeFeature(Y)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(O){setFromArray(this.tmpTransform_,this.currentFrameStateTransform_),multiply(this.tmpTransform_,O),this.helper.setUniformMatrixValue(Uniforms.PROJECTION_MATRIX,fromTransform(this.tmpMat4_,this.tmpTransform_)),makeInverse(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Uniforms.SCREEN_TO_WORLD_MATRIX,fromTransform(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,makeInverse(this.tmpTransform_,O),apply$1(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Uniforms.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(O){const Y=this.helper.getGL();this.preRender(Y,O);const[te,ne,xe]=getWorldParameters(O,this.getLayer());this.helper.prepareDraw(O),this.renderWorlds(O,!1,te,ne,xe),this.helper.finalizeDraw(O,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const et=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(O,!0,te,ne,xe),this.hitRenderTarget_.clearCachedData()),this.postRender(Y,O),et}prepareFrameInternal(O){this.initialFeaturesAdded_||(this.addInitialFeatures_(O),this.initialFeaturesAdded_=!0);const Y=this.getLayer(),te=Y.getSource(),ne=O.viewState,xe=!O.viewHints[ViewHint.ANIMATING]&&!O.viewHints[ViewHint.INTERACTING],et=!equals$1(this.previousExtent_,O.extent),tt=this.sourceRevision_<te.getRevision();if(tt&&(this.sourceRevision_=te.getRevision()),xe&&(et||tt)){const it=ne.projection,st=ne.resolution,ot=Y instanceof BaseVectorLayer?Y.getRenderBuffer():0,rt=buffer$1(O.extent,ot*st),nt=getUserProjection();nt?te.loadFeatures(toUserExtent(rt,nt),toUserResolution(st,it),nt):te.loadFeatures(rt,st,it),this.ready=!1;const at=this.helper.makeProjectionTransform(O,create$2());this.styleRenderer_.generateBuffers(this.batch_,at).then(ct=>{this.buffers_&&this.disposeBuffers(this.buffers_),this.buffers_=ct,this.ready=!0,this.getLayer().changed()}),this.previousExtent_=O.extent.slice()}return!0}renderWorlds(O,Y,te,ne,xe){let et=te;Y&&(this.hitRenderTarget_.setSize([Math.floor(O.size[0]/2),Math.floor(O.size[1]/2)]),this.helper.prepareDrawToRenderTarget(O,this.hitRenderTarget_,!0));do this.helper.makeProjectionTransform(O,this.currentFrameStateTransform_),translate$2(this.currentFrameStateTransform_,et*xe,0),this.buffers_&&this.styleRenderer_.render(this.buffers_,O,()=>{this.applyUniforms_(this.buffers_.invertVerticesTransform),this.helper.applyHitDetectionUniform(Y)});while(++et<ne)}forEachFeatureAtCoordinate(O,Y,te,ne,xe){if(assert(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderer_||!this.hitDetectionEnabled_)return;const et=apply$1(Y.coordinateToPixelTransform,O.slice()),tt=this.hitRenderTarget_.readPixel(et[0]/2,et[1]/2),it=[tt[0]/255,tt[1]/255,tt[2]/255,tt[3]/255],st=colorDecodeId(it),ot=this.batch_.getFeatureFromRef(st);if(ot)return ne(ot,this.getLayer(),null)}disposeBuffers(O){const Y=te=>{for(const ne of te)ne&&this.helper.deleteBuffer(ne)};O.pointBuffers&&Y(O.pointBuffers),O.lineStringBuffers&&Y(O.lineStringBuffers),O.polygonBuffers&&Y(O.polygonBuffers)}disposeInternal(){this.buffers_&&this.disposeBuffers(this.buffers_),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(O){unlistenByKey(O)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const Property={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"];class Heatmap extends BaseVectorLayer{constructor(O){O=O||{};const Y=Object.assign({},O);delete Y.gradient,delete Y.radius,delete Y.blur,delete Y.weight,super(Y),this.filter_=O.filter??!0,this.styleVariables_=O.variables||{},this.gradient_=null,this.addChangeListener(Property.GRADIENT,this.handleGradientChanged_),this.setGradient(O.gradient?O.gradient:DEFAULT_GRADIENT),this.setBlur(O.blur!==void 0?O.blur:15),this.setRadius(O.radius!==void 0?O.radius:8);const te=O.weight?O.weight:"weight";this.weight_=te,this.setRenderOrder(null)}getBlur(){return this.get(Property.BLUR)}getGradient(){return this.get(Property.GRADIENT)}getRadius(){return this.get(Property.RADIUS)}handleGradientChanged_(){this.gradient_=createGradient(this.getGradient())}setBlur(O){const Y=this.get(Property.BLUR);if(this.set(Property.BLUR,O),typeof O=="number"&&typeof Y=="number"){this.changed();return}this.clearRenderer()}setGradient(O){this.set(Property.GRADIENT,O)}setRadius(O){const Y=this.get(Property.RADIUS);if(this.set(Property.RADIUS,O),typeof O=="number"&&typeof Y=="number"){this.changed();return}this.clearRenderer()}setFilter(O){this.filter_=O,this.changed(),this.clearRenderer()}setWeight(O){this.weight_=O,this.changed(),this.clearRenderer()}createRenderer(){const O=new ShaderBuilder,Y=newCompilationContext(),te=expressionToGlsl(Y,this.filter_,BooleanType$1);let ne=expressionToGlsl(Y,this.getRadius(),NumberType$1),xe=expressionToGlsl(Y,this.getBlur(),NumberType$1);const et={};typeof this.getBlur()=="number"&&(xe="a_blur",et.a_blur=()=>this.getBlur(),O.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(ne="a_radius",et.a_radius=()=>this.getRadius(),O.addUniform("a_radius","float"));const tt={};let it=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const rt=typeof this.weight_=="string"?nt=>nt.get(this.weight_):this.weight_;tt.prop_weight={size:1,callback:nt=>{const at=rt(nt);return at!==void 0?clamp$1(at,0,1):1}},it="a_prop_weight",O.addAttribute("a_prop_weight","float")}else{const rt=["clamp",this.weight_,0,1];it=expressionToGlsl(Y,rt,NumberType$1)}O.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${xe});
  float radius = ${ne};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${ne} + ${xe}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${it})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${it})`).setStrokeWidthExpression(`(${ne} + ${xe}) * 2.`).setFillColorExpression(`vec4(${it})`).setFragmentDiscardExpression(`!${te}`),applyContextToBuilder(O,Y);const st=generateAttributesFromContext(Y),ot=generateUniformsFromContext(Y,this.styleVariables_);return new WebGLVectorLayerRenderer(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:O,attributes:{...st,...tt},uniforms:{...ot,...et}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(O){Object.assign(this.styleVariables_,O),this.changed()}renderDeclutter(){}}function createGradient(ee){const te=createCanvasContext2D(1,256),ne=te.createLinearGradient(0,0,1,256),xe=1/(ee.length-1);for(let et=0,tt=ee.length;et<tt;++et)ne.addColorStop(et*xe,ee[et]);return te.fillStyle=ne,te.fillRect(0,0,1,256),te.canvas}class CanvasVectorImageLayerRenderer extends CanvasImageLayerRenderer{constructor(O){super(O),this.vectorRenderer_=new CanvasVectorLayerRenderer(O),this.layerImageRatio_=O.getImageRatio(),this.coordinateToVectorPixelTransform_=create$2(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(O){if(!this.vectorRenderer_)return Promise.resolve([]);const Y=apply$1(this.coordinateToVectorPixelTransform_,apply$1(this.renderedPixelToCoordinateTransform_,O.slice()));return this.vectorRenderer_.getFeatures(Y)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(O){const Y=O.pixelRatio,te=O.viewState,ne=te.resolution,xe=O.viewHints,et=this.vectorRenderer_;let tt=O.extent;this.layerImageRatio_!==1&&(tt=tt.slice(0),scaleFromCenter(tt,this.layerImageRatio_));const it=getWidth(tt)/ne,st=getHeight(tt)/ne;if(!xe[ViewHint.ANIMATING]&&!xe[ViewHint.INTERACTING]&&!isEmpty(tt)){et.useContainer(null,null);const ot=et.context,rt=O.layerStatesArray[O.layerIndex],nt=Object.assign({},rt,{opacity:1}),at=Object.assign({},O,{extent:tt,size:[it,st],viewState:Object.assign({},O.viewState,{rotation:0}),layerStatesArray:[nt],layerIndex:0,declutter:null}),ct=this.getLayer().getDeclutter();ct&&(at.declutter={[ct]:new RBush$1(9)});const ut=new ImageCanvas(tt,ne,Y,ot.canvas,function(dt){et.prepareFrame(at)&&et.replayGroupChanged&&(et.clipping=!1,et.renderFrame(at,null),et.renderDeclutter(at),et.renderDeferred(at),dt())});ut.addEventListener(EventType.CHANGE,()=>{if(ut.getState()!==ImageState.LOADED)return;this.image=ut;const dt=ut.getPixelRatio(),ht=fromResolutionLike(ut.getResolution())*Y/dt;this.renderedResolution=ht,this.coordinateToVectorPixelTransform_=compose(this.coordinateToVectorPixelTransform_,it/2,st/2,1/ht,-1/ht,0,-te.center[0],-te.center[1])}),ut.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=O.pixelToCoordinateTransform.slice()),!this.getLayer().getSource()?.loading&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(O,Y,te,ne,xe){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(O,Y,te,ne,xe):super.forEachFeatureAtCoordinate(O,Y,te,ne,xe)}}class VectorImageLayer extends BaseVectorLayer{constructor(O){O=O||{};const Y=Object.assign({},O);delete Y.imageRatio,super(Y),this.imageRatio_=O.imageRatio!==void 0?O.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new CanvasVectorImageLayerRenderer(this)}}class WebGLPointsLayerRenderer extends WebGLLayerRenderer{constructor(O,Y){const te=Y.uniforms||{},ne=create$2();te[DefaultUniform.PROJECTION_MATRIX]=ne,super(O,{uniforms:te,postProcesses:Y.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new WebGLArrayBuffer(ARRAY_BUFFER,DYNAMIC_DRAW),this.instanceAttributesBuffer_=new WebGLArrayBuffer(ARRAY_BUFFER,DYNAMIC_DRAW),this.indicesBuffer_=new WebGLArrayBuffer(ELEMENT_ARRAY_BUFFER,DYNAMIC_DRAW),this.vertexShader_=Y.vertexShader,this.fragmentShader_=Y.fragmentShader,this.program_,this.hitDetectionEnabled_=Y.hitDetectionEnabled??!0;const xe=Y.attributes?Y.attributes.map(function(tt){return{name:"a_"+tt.name,size:1,type:AttributeType.FLOAT}}):[];this.attributes=[{name:"a_localPosition",size:2,type:AttributeType.FLOAT}],this.instanceAttributes=[{name:"a_position",size:2,type:AttributeType.FLOAT}],this.hitDetectionEnabled_&&(this.instanceAttributes.push({name:"a_hitColor",size:2,type:AttributeType.FLOAT}),this.instanceAttributes.push({name:"a_featureUid",size:1,type:AttributeType.FLOAT})),this.instanceAttributes.push(...xe),this.customAttributes=Y.attributes?Y.attributes:[],this.previousExtent_=createEmpty(),this.currentTransform_=ne,this.renderTransform_=create$2(),this.invertRenderTransform_=create$2(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=create(),this.worker_.addEventListener("message",tt=>{const it=tt.data;if(it.type===WebGLWorkerMessageType.GENERATE_POINT_BUFFERS){const st=it.projectionTransform;this.verticesBuffer_.fromArrayBuffer(it.vertexAttributesBuffer),this.instanceAttributesBuffer_.fromArrayBuffer(it.instanceAttributesBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.helper.flushBufferData(this.instanceAttributesBuffer_),this.indicesBuffer_.fromArrayBuffer(it.indicesBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=st,makeInverse(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(tt.data.renderInstructions),it.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const et=this.getLayer().getSource();this.sourceListenKeys_=[listen(et,VectorEventType.ADDFEATURE,this.handleSourceFeatureAdded_,this),listen(et,VectorEventType.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),listen(et,VectorEventType.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),listen(et,VectorEventType.CLEAR,this.handleSourceFeatureClear_,this)],et.forEachFeature(tt=>{const it=tt.getGeometry();it&&it.getType()==="Point"&&(this.featureCache_[getUid(tt)]={feature:tt,properties:tt.getProperties(),flatCoordinates:it.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new WebGLRenderTarget(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(O){const Y=O.feature,te=Y.getGeometry();te&&te.getType()==="Point"&&(this.featureCache_[getUid(Y)]={feature:Y,properties:Y.getProperties(),flatCoordinates:te.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(O){const Y=O.feature,te=getUid(Y),ne=this.featureCache_[te],xe=Y.getGeometry();ne?xe&&xe.getType()==="Point"?(ne.properties=Y.getProperties(),ne.flatCoordinates=xe.getFlatCoordinates()):(delete this.featureCache_[te],this.featureCount_--):xe&&xe.getType()==="Point"&&(this.featureCache_[te]={feature:Y,properties:Y.getProperties(),flatCoordinates:xe.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(O){const Y=O.feature,te=getUid(Y);te in this.featureCache_&&(delete this.featureCache_[te],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(O){const Y=this.helper.getGL();this.preRender(Y,O);const[te,ne,xe]=getWorldParameters(O,this.getLayer());return this.renderWorlds(O,!1,te,ne,xe),this.helper.finalizeDraw(O,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(O,!0,te,ne,xe),this.hitRenderTarget_.clearCachedData()),this.postRender(Y,O),this.helper.getCanvas()}prepareFrameInternal(O){const Y=this.getLayer(),te=Y.getSource(),ne=O.viewState,xe=!O.viewHints[ViewHint.ANIMATING]&&!O.viewHints[ViewHint.INTERACTING],et=!equals$1(this.previousExtent_,O.extent),tt=this.sourceRevision_<te.getRevision();if(tt&&(this.sourceRevision_=te.getRevision()),xe&&(et||tt)){const it=ne.projection,st=ne.resolution,ot=Y instanceof BaseVectorLayer?Y.getRenderBuffer():0,rt=buffer$1(O.extent,ot*st);te.loadFeatures(rt,st,it),this.rebuildBuffers_(O),this.previousExtent_=O.extent.slice()}return this.helper.useProgram(this.program_,O),this.helper.prepareDraw(O),!0}rebuildBuffers_(O){const Y=create$2();this.helper.makeProjectionTransform(O,Y);const te=getUserProjection(),xe=(this.hitDetectionEnabled_?5:2)+this.customAttributes.length,et=xe*this.featureCount_,tt=this.renderInstructions_&&this.renderInstructions_.length===et?this.renderInstructions_:new Float32Array(et);this.renderInstructions_=null;let it=[];const st=[];let ot=-1;const rt=O.viewState.projection;for(const at in this.featureCache_){const ct=this.featureCache_[at];if(te?it=fromUserCoordinate(ct.flatCoordinates,rt):(it[0]=ct.flatCoordinates[0],it[1]=ct.flatCoordinates[1]),apply$1(Y,it),tt[++ot]=it[0],tt[++ot]=it[1],this.hitDetectionEnabled_){const ut=colorEncodeIdAndPack(ot+3,st);tt[++ot]=ut[0],tt[++ot]=ut[1],tt[++ot]=Number(at)}for(let ut=0;ut<this.customAttributes.length;ut++){const dt=this.customAttributes[ut].callback(ct.feature,ct.properties);tt[++ot]=dt}}const nt={id:++this.lastSentId,type:WebGLWorkerMessageType.GENERATE_POINT_BUFFERS,renderInstructions:tt.buffer,customAttributesSize:xe-2};nt.projectionTransform=Y,this.ready=!1,this.worker_.postMessage(nt,[tt.buffer])}forEachFeatureAtCoordinate(O,Y,te,ne,xe){if(assert(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const et=apply$1(Y.coordinateToPixelTransform,O.slice()),tt=this.hitRenderTarget_.readPixel(et[0]/2,et[1]/2),it=[tt[0]/255,tt[1]/255,tt[2]/255,tt[3]/255],st=colorDecodeId(it),ot=this.renderInstructions_[st],rt=Math.floor(ot).toString(),at=this.getLayer().getSource().getFeatureByUid(rt);if(at)return ne(at,this.getLayer(),null)}renderWorlds(O,Y,te,ne,xe){let et=te;this.helper.useProgram(this.program_,O),Y&&(this.hitRenderTarget_.setSize([Math.floor(O.size[0]/2),Math.floor(O.size[1]/2)]),this.helper.prepareDrawToRenderTarget(O,this.hitRenderTarget_,!0));const tt=this.instanceAttributes.reduce((st,ot)=>st+(ot.size||1),0),it=this.instanceAttributesBuffer_.getSize()/tt;do{this.helper.bindBuffer(this.indicesBuffer_),this.helper.bindBuffer(this.verticesBuffer_),this.helper.enableAttributes(this.attributes),this.helper.bindBuffer(this.instanceAttributesBuffer_),this.helper.enableAttributesInstanced(this.instanceAttributes),this.helper.makeProjectionTransform(O,this.currentTransform_),translate$2(this.currentTransform_,et*xe,0),multiply(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(O),this.helper.applyHitDetectionUniform(Y);const st=this.indicesBuffer_.getSize();this.helper.drawElementsInstanced(0,st,it)}while(++et<ne)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(O){unlistenByKey(O)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class WebGLPointsLayer extends Layer{constructor(O){const Y=Object.assign({},O);super(Y),this.styleVariables_=O.variables||{},this.parseResult_=parseLiteralStyle(O.style,this.styleVariables_,O.filter),this.hitDetectionDisabled_=!!O.disableHitDetection}createRenderer(){const O=Object.keys(this.parseResult_.attributes).map(Y=>({name:Y,...this.parseResult_.attributes[Y]}));return new WebGLPointsLayerRenderer(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:O})}updateStyleVariables(O){Object.assign(this.styleVariables_,O),this.changed()}}function parseStyle(ee,O){const Y=`
    attribute vec2 ${Attributes$1.TEXTURE_COORD};
    uniform mat4 ${Uniforms$1.TILE_TRANSFORM};
    uniform float ${Uniforms$1.TEXTURE_PIXEL_WIDTH};
    uniform float ${Uniforms$1.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Uniforms$1.TEXTURE_RESOLUTION};
    uniform float ${Uniforms$1.TEXTURE_ORIGIN_X};
    uniform float ${Uniforms$1.TEXTURE_ORIGIN_Y};
    uniform float ${Uniforms$1.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Attributes$1.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Uniforms$1.TEXTURE_ORIGIN_X} + ${Uniforms$1.TEXTURE_RESOLUTION} * ${Uniforms$1.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Uniforms$1.TEXTURE_ORIGIN_Y} - ${Uniforms$1.TEXTURE_RESOLUTION} * ${Uniforms$1.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Uniforms$1.TILE_TRANSFORM} * vec4(${Attributes$1.TEXTURE_COORD}, ${Uniforms$1.DEPTH}, 1.0);
    }
  `,te={...newCompilationContext(),bandCount:O},ne=[];if(ee.color!==void 0){const rt=expressionToGlsl(te,ee.color,ColorType$1);ne.push(`color = ${rt};`)}if(ee.contrast!==void 0){const rt=expressionToGlsl(te,ee.contrast,NumberType$1);ne.push(`color.rgb = clamp((${rt} + 1.0) * color.rgb - (${rt} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(ee.exposure!==void 0){const rt=expressionToGlsl(te,ee.exposure,NumberType$1);ne.push(`color.rgb = clamp((${rt} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(ee.saturation!==void 0){const rt=expressionToGlsl(te,ee.saturation,NumberType$1);ne.push(`
      float saturation = ${rt} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(ee.gamma!==void 0){const rt=expressionToGlsl(te,ee.gamma,NumberType$1);ne.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${rt}));`)}if(ee.brightness!==void 0){const rt=expressionToGlsl(te,ee.brightness,NumberType$1);ne.push(`color.rgb = clamp(color.rgb + ${rt}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const xe={},et=Object.keys(te.variables).length;if(et>1&&!ee.variables)throw new Error(`Missing variables in style (expected ${te.variables})`);for(let rt=0;rt<et;++rt){const nt=te.variables[Object.keys(te.variables)[rt]];if(!(nt.name in ee.variables))throw new Error(`Missing '${nt.name}' in style variables`);const at=uniformNameForVariable(nt.name);xe[at]=function(){let ct=ee.variables[nt.name];return typeof ct=="string"&&(ct=getStringNumberEquivalent(ct)),ct!==void 0?ct:-9999999}}const tt=Object.keys(xe).map(function(rt){return`uniform float ${rt};`}),it=Math.ceil(O/4);tt.push(`uniform sampler2D ${Uniforms$1.TILE_TEXTURE_ARRAY}[${it}];`),te.paletteTextures&&tt.push(`uniform sampler2D ${PALETTE_TEXTURE_ARRAY}[${te.paletteTextures.length}];`);const st=Object.keys(te.functions).map(function(rt){return te.functions[rt]}),ot=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Uniforms$1.RENDER_EXTENT};
    uniform float ${Uniforms$1.TRANSITION_ALPHA};
    uniform float ${Uniforms$1.TEXTURE_PIXEL_WIDTH};
    uniform float ${Uniforms$1.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Uniforms$1.RESOLUTION};
    uniform float ${Uniforms$1.ZOOM};

    ${tt.join(`
`)}

    ${st.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Uniforms$1.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Uniforms$1.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Uniforms$1.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Uniforms$1.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Uniforms$1.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${ne.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Uniforms$1.TRANSITION_ALPHA};
    }`;return{vertexShader:Y,fragmentShader:ot,uniforms:xe,paletteTextures:te.paletteTextures}}class WebGLTileLayer extends BaseTileLayer{constructor(O){O=O?Object.assign({},O):{};const Y=O.style||{};delete O.style,super(O),this.sources_=O.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=Y,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(LayerProperty.SOURCE,this.handleSourceUpdate_)}getSources(O,Y){const te=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(O,Y):this.sources_:te?[te]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const O=this.getRenderSource();return O?O.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const O=this.getSource();if(O)if(O.getState()==="loading"){const Y=()=>{O.getState()==="ready"&&(O.removeEventListener("change",Y),this.setStyle(this.style_))};O.addEventListener("change",Y)}else this.setStyle(this.style_)}getSourceBandCount_(){const O=Number.MAX_SAFE_INTEGER,Y=this.getSources([-O,-O,O,O],O);return Y&&Y.length&&"bandCount"in Y[0]?Y[0].bandCount:4}createRenderer(){const O=parseStyle(this.style_,this.getSourceBandCount_());return new WebGLTileLayerRenderer(this,{vertexShader:O.vertexShader,fragmentShader:O.fragmentShader,uniforms:O.uniforms,cacheSize:this.getCacheSize(),paletteTextures:O.paletteTextures})}renderSources(O,Y){const te=this.getRenderer();let ne;for(let xe=0,et=Y.length;xe<et;++xe)this.renderedSource_=Y[xe],te.prepareFrame(O)&&(ne=te.renderFrame(O));return ne}render(O,Y){this.rendered=!0;const te=O.viewState,ne=this.getSources(O.extent,te.resolution);let xe=!0;for(let tt=0,it=ne.length;tt<it;++tt){const st=ne[tt],ot=st.getState();if(ot=="loading"){const rt=()=>{st.getState()=="ready"&&(st.removeEventListener("change",rt),this.changed())};st.addEventListener("change",rt)}xe=xe&&ot=="ready"}const et=this.renderSources(O,ne);if(this.getRenderer().renderComplete&&xe)return this.renderedResolution_=te.resolution,et;if(this.renderedResolution_>.5*te.resolution){const tt=this.getSources(O.extent,this.renderedResolution_).filter(it=>!ne.includes(it));if(tt.length>0)return this.renderSources(O,tt)}return et}setStyle(O){if(this.styleVariables_=O.variables||{},this.style_=O,this.hasRenderer()){const Y=parseStyle(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:Y.vertexShader,fragmentShader:Y.fragmentShader,uniforms:Y.uniforms,paletteTextures:Y.paletteTextures}),this.changed()}}updateStyleVariables(O){Object.assign(this.styleVariables_,O),this.changed()}}WebGLTileLayer.prototype.dispose;class WebGLVectorLayer extends Layer{constructor(O){const Y=Object.assign({},O);super(Y),this.styleVariables_=O.variables||{},this.style_=O.style,this.hitDetectionDisabled_=!!O.disableHitDetection}createRenderer(){return new WebGLVectorLayerRenderer(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(O){Object.assign(this.styleVariables_,O),this.changed()}setStyle(O){this.style_=O,this.clearRenderer(),this.changed()}}const layer=Object.freeze(Object.defineProperty({__proto__:null,Graticule,Group:LayerGroup,Heatmap,Image:ImageLayer,Layer,Tile:TileLayer,Vector:VectorLayer,VectorImage:VectorImageLayer,VectorTile:VectorTileLayer,WebGLPoints:WebGLPointsLayer,WebGLTile:WebGLTileLayer,WebGLVector:WebGLVectorLayer},Symbol.toStringTag,{value:"Module"}));class DblClickDragZoom extends Interaction{constructor(O){const Y=O||{};super(Y),Y.stopDown&&(this.stopDown=Y.stopDown),this.scaleDeltaByPixel_=Y.delta?Y.delta:.01,this.duration_=Y.duration!==void 0?Y.duration:250,this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0,this.trackedPointers_={},this.down_=null,this.targetPointers=[]}handleEvent(O){if(!O.originalEvent)return!0;let Y=!1;if(this.updateTrackedPointers_(O),this.handlingDownUpSequence_){if(O.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(O),O.originalEvent.preventDefault();else if(O.type==MapBrowserEventType.POINTERUP){const te=this.handleUpEvent(O);this.handlingDownUpSequence_=te}}else if(O.type==MapBrowserEventType.POINTERDOWN)if(this.handlingDoubleDownSequence_){this.handlingDoubleDownSequence_=!1;const te=this.handleDownEvent(O);this.handlingDownUpSequence_=te,Y=this.stopDown(te)}else Y=this.stopDown(!1),this.waitForDblTap_();return!Y}handleDragEvent(O){let Y=1;const te=this.targetPointers[0],ne=this.down_,xe=te.clientY-ne.clientY;this.lastDistance_!==void 0&&(Y=1-(this.lastDistance_-xe)*this.scaleDeltaByPixel_),this.lastDistance_=xe,Y!=1&&(this.lastScaleDelta_=Y);const et=O.map,tt=et.getView();et.render(),tt.adjustResolutionInternal(Y)}handleDownEvent(O){if(this.targetPointers.length==1){const Y=O.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.down_=O.originalEvent,this.handlingDownUpSequence_||Y.getView().beginInteraction(),!0}return!1}handleUpEvent(O){if(this.targetPointers.length==0){const te=O.map.getView(),ne=this.lastScaleDelta_>1?1:-1;return te.endInteraction(this.duration_,ne),this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,!1}return!0}stopDown(O){return O}updateTrackedPointers_(O){if(isPointerDraggingEvent(O)){const Y=O.originalEvent,te=Y.pointerId.toString();O.type==MapBrowserEventType.POINTERUP?delete this.trackedPointers_[te]:O.type==MapBrowserEventType.POINTERDOWN?this.trackedPointers_[te]=Y:te in this.trackedPointers_&&(this.trackedPointers_[te]=Y),this.targetPointers=Object.values(this.trackedPointers_)}}waitForDblTap_(){this.doubleTapTimeoutId_!==void 0?(clearTimeout(this.doubleTapTimeoutId_),this.doubleTapTimeoutId_=void 0):(this.handlingDoubleDownSequence_=!0,this.doubleTapTimeoutId_=setTimeout(this.endInteraction_.bind(this),250))}endInteraction_(){this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0}}function isPointerDraggingEvent(ee){const O=ee.type;return O===MapBrowserEventType.POINTERDOWN||O===MapBrowserEventType.POINTERDRAG||O===MapBrowserEventType.POINTERUP}const DragAndDropEventType={ADD_FEATURES:"addfeatures"};class DragAndDropEvent extends BaseEvent{constructor(O,Y,te,ne){super(O),this.features=te,this.file=Y,this.projection=ne}}class DragAndDrop extends Interaction{constructor(O){O=O||{},super({handleEvent:TRUE}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const Y=O.formatConstructors?O.formatConstructors:[];for(let te=0,ne=Y.length;te<ne;++te){let xe=Y[te];typeof xe=="function"&&(xe=new xe),this.formats_.push(xe),this.readAsBuffer_=this.readAsBuffer_||xe.getType()==="arraybuffer"}this.projection_=O.projection?get$2(O.projection):null,this.dropListenKeys_=null,this.source_=O.source||null,this.target=O.target?O.target:null}handleResult_(O,Y){const te=Y.target.result,ne=this.getMap();let xe=this.projection_;xe||(xe=getUserProjection(),xe||(xe=ne.getView().getProjection()));let et;const tt=this.formats_;for(let it=0,st=tt.length;it<st;++it){const ot=tt[it];let rt=te;this.readAsBuffer_&&ot.getType()!=="arraybuffer"&&(et===void 0&&(et=new TextDecoder().decode(te)),rt=et);const nt=this.tryReadFeatures_(ot,rt,{featureProjection:xe});if(nt&&nt.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(nt)),this.dispatchEvent(new DragAndDropEvent(DragAndDropEventType.ADD_FEATURES,O,nt,xe));break}}}registerListeners_(){const O=this.getMap();if(O){const Y=this.target?this.target:O.getViewport();this.dropListenKeys_=[listen(Y,EventType.DROP,this.handleDrop,this),listen(Y,EventType.DRAGENTER,this.handleStop,this),listen(Y,EventType.DRAGOVER,this.handleStop,this),listen(Y,EventType.DROP,this.handleStop,this)]}}setActive(O){!this.getActive()&&O&&this.registerListeners_(),this.getActive()&&!O&&this.unregisterListeners_(),super.setActive(O)}setMap(O){this.unregisterListeners_(),super.setMap(O),this.getActive()&&this.registerListeners_()}tryReadFeatures_(O,Y,te){try{return O.readFeatures(Y,te)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(unlistenByKey),this.dropListenKeys_=null)}handleDrop(O){const Y=O.dataTransfer.files;for(let te=0,ne=Y.length;te<ne;++te){const xe=Y.item(te),et=new FileReader;et.addEventListener(EventType.LOAD,this.handleResult_.bind(this,xe)),this.readAsBuffer_?et.readAsArrayBuffer(xe):et.readAsText(xe)}}handleStop(O){O.stopPropagation(),O.preventDefault(),O.dataTransfer.dropEffect="copy"}}class DragRotateAndZoom extends PointerInteraction{constructor(O){O=O||{},super(O),this.condition_=O.condition?O.condition:shiftKeyOnly,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=O.duration!==void 0?O.duration:400}handleDragEvent(O){if(!mouseOnly(O))return;const Y=O.map,te=Y.getSize(),ne=O.pixel,xe=ne[0]-te[0]/2,et=te[1]/2-ne[1],tt=Math.atan2(et,xe),it=Math.sqrt(xe*xe+et*et),st=Y.getView();if(this.lastAngle_!==void 0){const ot=this.lastAngle_-tt;st.adjustRotationInternal(ot)}this.lastAngle_=tt,this.lastMagnitude_!==void 0&&st.adjustResolutionInternal(this.lastMagnitude_/it),this.lastMagnitude_!==void 0&&(this.lastScaleDelta_=this.lastMagnitude_/it),this.lastMagnitude_=it}handleUpEvent(O){if(!mouseOnly(O))return!0;const te=O.map.getView(),ne=this.lastScaleDelta_>1?1:-1;return te.endInteraction(this.duration_,ne),this.lastScaleDelta_=0,!1}handleDownEvent(O){return mouseOnly(O)&&this.condition_(O)?(O.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0):!1}}function getCoordinate(ee,O){const Y=ee.length;return O<0?ee[O+Y]:O>=Y?ee[O-Y]:ee[O]}function interpolateCoordinate(ee,O){const Y=ee.length;let te=Math.floor(O);const ne=O-te;te>=Y?te-=Y:te<0&&(te+=Y);let xe=te+1;xe>=Y&&(xe-=Y);const et=ee[te],tt=et[0],it=et[1],st=ee[xe],ot=st[0]-tt,rt=st[1]-it;return[tt+ot*ne,it+rt*ne]}const sharedUpdateInfo={index:-1,endIndex:NaN,closestTargetDistance:1/0};function getTraceTargetUpdate(ee,O,Y,te){const ne=ee[0],xe=ee[1];let et=1/0,tt=-1,it=NaN;for(let rt=0;rt<O.targets.length;++rt){const nt=O.targets[rt],at=nt.coordinates;let ct=1/0,ut;for(let dt=0;dt<at.length-1;++dt){const ht=at[dt],pt=at[dt+1],ft=getPointSegmentRelationship(ne,xe,ht,pt);ft.squaredDistance<ct&&(ct=ft.squaredDistance,ut=dt+ft.along)}ct<et&&(et=ct,nt.ring&&O.targetIndex===rt&&(nt.endIndex>nt.startIndex?ut<nt.startIndex&&(ut+=at.length):nt.endIndex<nt.startIndex&&ut>nt.startIndex&&(ut-=at.length)),it=ut,tt=rt)}const st=O.targets[tt];let ot=st.ring;if(O.targetIndex===tt&&ot){const rt=interpolateCoordinate(st.coordinates,it),nt=Y.getPixelFromCoordinate(rt),at=Y.getPixelFromCoordinate(O.startCoord);distance(nt,at)>te&&(ot=!1)}if(ot){const rt=st.coordinates,nt=rt.length,at=st.startIndex,ct=it;if(at<ct){const ut=getCumulativeSquaredDistance(rt,at,ct);getCumulativeSquaredDistance(rt,at,ct-nt)<ut&&(it-=nt)}else{const ut=getCumulativeSquaredDistance(rt,at,ct);getCumulativeSquaredDistance(rt,at,ct+nt)<ut&&(it+=nt)}}return sharedUpdateInfo.index=tt,sharedUpdateInfo.endIndex=it,sharedUpdateInfo.closestTargetDistance=et,sharedUpdateInfo}function getTraceTargets(ee,O){const Y=[];for(let te=0;te<O.length;++te){const xe=O[te].getGeometry();appendGeometryTraceTargets(ee,xe,Y)}return Y}function appendGeometryTraceTargets(ee,O,Y){if(O instanceof LineString){appendTraceTarget(ee,O.getCoordinates(),!1,Y);return}if(O instanceof MultiLineString){const te=O.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne)appendTraceTarget(ee,te[ne],!1,Y);return}if(O instanceof Polygon){const te=O.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne)appendTraceTarget(ee,te[ne],!0,Y);return}if(O instanceof MultiPolygon){const te=O.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne];for(let tt=0,it=et.length;tt<it;++tt)appendTraceTarget(ee,et[tt],!0,Y)}return}if(O instanceof GeometryCollection){const te=O.getGeometries();for(let ne=0;ne<te.length;++ne)appendGeometryTraceTargets(ee,te[ne],Y);return}}function appendTraceTarget(ee,O,Y,te){const ne=ee[0],xe=ee[1];for(let et=0,tt=O.length-1;et<tt;++et){const it=O[et],st=O[et+1],ot=getPointSegmentRelationship(ne,xe,it,st);if(ot.squaredDistance===0){const rt=et+ot.along;te.push({coordinates:O,ring:Y,startIndex:rt,endIndex:rt});return}}}function getSquaredDistance(ee,O){return squaredDistance$1(ee[0],ee[1],O[0],O[1])}function getCumulativeSquaredDistance(ee,O,Y){let te,ne;O<Y?(te=O,ne=Y):(te=Y,ne=O);const xe=Math.ceil(te),et=Math.floor(ne);if(xe>et){const it=interpolateCoordinate(ee,te),st=interpolateCoordinate(ee,ne);return getSquaredDistance(it,st)}let tt=0;if(te<xe){const it=interpolateCoordinate(ee,te),st=getCoordinate(ee,xe);tt+=getSquaredDistance(it,st)}if(et<ne){const it=getCoordinate(ee,et),st=interpolateCoordinate(ee,ne);tt+=getSquaredDistance(it,st)}for(let it=xe;it<et-1;++it){const st=getCoordinate(ee,it),ot=getCoordinate(ee,it+1);tt+=getSquaredDistance(st,ot)}return tt}const sharedRel={along:0,squaredDistance:0};function getPointSegmentRelationship(ee,O,Y,te){const ne=Y[0],xe=Y[1],et=te[0],tt=te[1],it=et-ne,st=tt-xe;let ot=0,rt=ne,nt=xe;return(it!==0||st!==0)&&(ot=clamp$1(((ee-ne)*it+(O-xe)*st)/(it*it+st*st),0,1),rt+=it*ot,nt+=st*ot),sharedRel.along=ot,sharedRel.squaredDistance=toFixed(squaredDistance$1(ee,O,rt,nt),10),sharedRel}const DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class DrawEvent extends BaseEvent{constructor(O,Y){super(O),this.feature=Y}}class Draw extends PointerInteraction{constructor(O){const Y=O;Y.stopDown||(Y.stopDown=FALSE),super(Y),this.on,this.once,this.un,this.options_=O,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=O.source?O.source:null,this.features_=O.features?O.features:null,this.snapTolerance_=O.snapTolerance?O.snapTolerance:12,this.type_=O.type,this.mode_=getMode(this.type_),this.stopClick_=!!O.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=O.minPoints?O.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:O.maxPoints?O.maxPoints:1/0,this.finishCondition_=O.finishCondition?O.finishCondition:TRUE,this.geometryLayout_=O.geometryLayout?O.geometryLayout:"XY";let te=O.geometryFunction;if(!te){const ne=this.mode_;if(ne==="Circle")te=(xe,et,tt)=>{const it=et||new Circle([NaN,NaN]),st=fromUserCoordinate(xe[0],tt),ot=squaredDistance(st,fromUserCoordinate(xe[xe.length-1],tt));it.setCenterAndRadius(st,Math.sqrt(ot),this.geometryLayout_);const rt=getUserProjection();return rt&&it.transform(tt,rt),it};else{let xe;ne==="Point"?xe=Point:ne==="LineString"?xe=LineString:ne==="Polygon"&&(xe=Polygon),te=(et,tt,it)=>(tt?ne==="Polygon"?et[0].length?tt.setCoordinates([et[0].concat([et[0][0]])],this.geometryLayout_):tt.setCoordinates([],this.geometryLayout_):tt.setCoordinates(et,this.geometryLayout_):tt=new xe(et,this.geometryLayout_),tt)}}this.geometryFunction_=te,this.dragVertexDelay_=O.dragVertexDelay!==void 0?O.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=O.clickTolerance?O.clickTolerance*O.clickTolerance:36,this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:O.wrapX?O.wrapX:!1}),style:O.style?O.style:getDefaultStyleFunction$2(),updateWhileInteracting:!0}),this.geometryName_=O.geometryName,this.condition_=O.condition?O.condition:noModifierKeys,this.freehandCondition_,O.freehand?this.freehandCondition_=always:this.freehandCondition_=O.freehandCondition?O.freehandCondition:shiftKeyOnly,this.traceCondition_,this.setTrace(O.trace||!1),this.traceState_={active:!1},this.traceSource_=O.traceSource||O.source||null,this.addChangeListener(InteractionProperty.ACTIVE,this.updateState_)}setTrace(O){let Y;O?O===!0?Y=always:Y=O:Y=never,this.traceCondition_=Y}setMap(O){super.setMap(O),this.updateState_()}setFreehand(O){this.freehand_=O,this.freehand_?this.freehandCondition_=always:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:shiftKeyOnly}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(O){O.originalEvent.type===EventType.CONTEXTMENU&&O.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(O);let Y=O.type===MapBrowserEventType.POINTERMOVE,te=!0;return!this.freehand_&&this.lastDragTime_&&O.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=O.pixel,this.shouldHandle_=!this.freehand_,Y=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&O.type===MapBrowserEventType.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(O.coordinate),te=!1):this.freehand_&&O.type===MapBrowserEventType.POINTERDOWN?te=!1:Y&&this.getPointerCount()<2?(te=O.type===MapBrowserEventType.POINTERMOVE,te&&this.freehand_?(this.handlePointerMove_(O),this.shouldHandle_&&O.originalEvent.preventDefault()):(O.originalEvent.pointerType==="mouse"||O.type===MapBrowserEventType.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(O)):O.type===MapBrowserEventType.DBLCLICK&&(te=!1),super.handleEvent(O)&&te}handleDownEvent(O){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=O.pixel,this.finishCoordinate_||this.startDrawing_(O.coordinate),!0):this.condition_(O)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,O.map,O.originalEvent,!1,O.frameState))},this.dragVertexDelay_),this.downPx_=O.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(O){if(!this.traceSource_||!this.traceCondition_(O))return;if(this.traceState_.active){this.deactivateTrace_();return}const Y=this.getMap(),te=Y.getCoordinateFromPixel([O.pixel[0]-this.snapTolerance_,O.pixel[1]+this.snapTolerance_]),ne=Y.getCoordinateFromPixel([O.pixel[0]+this.snapTolerance_,O.pixel[1]-this.snapTolerance_]),xe=boundingExtent([te,ne]),et=this.traceSource_.getFeaturesInExtent(xe);if(et.length===0)return;const tt=getTraceTargets(O.coordinate,et);tt.length&&(this.traceState_={active:!0,startCoord:O.coordinate.slice(),targets:tt,targetIndex:-1})}addOrRemoveTracedCoordinates_(O,Y){const te=O.startIndex<=O.endIndex,ne=O.startIndex<=Y;te===ne?te&&Y>O.endIndex||!te&&Y<O.endIndex?this.addTracedCoordinates_(O,O.endIndex,Y):(te&&Y<O.endIndex||!te&&Y>O.endIndex)&&this.removeTracedCoordinates_(Y,O.endIndex):(this.removeTracedCoordinates_(O.startIndex,O.endIndex),this.addTracedCoordinates_(O,O.startIndex,Y))}removeTracedCoordinates_(O,Y){if(O===Y)return;let te=0;if(O<Y){const ne=Math.ceil(O);let xe=Math.floor(Y);xe===Y&&(xe-=1),te=xe-ne+1}else{const ne=Math.floor(O);let xe=Math.ceil(Y);xe===Y&&(xe+=1),te=ne-xe+1}te>0&&this.removeLastPoints_(te)}addTracedCoordinates_(O,Y,te){if(Y===te)return;const ne=[];if(Y<te){const xe=Math.ceil(Y);let et=Math.floor(te);et===te&&(et-=1);for(let tt=xe;tt<=et;++tt)ne.push(getCoordinate(O.coordinates,tt))}else{const xe=Math.floor(Y);let et=Math.ceil(te);et===te&&(et+=1);for(let tt=xe;tt>=et;--tt)ne.push(getCoordinate(O.coordinates,tt))}ne.length&&this.appendCoordinates(ne)}updateTrace_(O){const Y=this.traceState_;if(!Y.active)return;if(Y.targetIndex===-1){const tt=O.map.getPixelFromCoordinate(Y.startCoord);if(distance(tt,O.pixel)<this.snapTolerance_)return}const te=getTraceTargetUpdate(O.coordinate,Y,this.getMap(),this.snapTolerance_);if(Y.targetIndex!==te.index){if(Y.targetIndex!==-1){const it=Y.targets[Y.targetIndex];this.removeTracedCoordinates_(it.startIndex,it.endIndex)}const tt=Y.targets[te.index];this.addTracedCoordinates_(tt,tt.startIndex,te.endIndex)}else{const tt=Y.targets[Y.targetIndex];this.addOrRemoveTracedCoordinates_(tt,te.endIndex)}Y.targetIndex=te.index;const ne=Y.targets[Y.targetIndex];ne.endIndex=te.endIndex;const xe=interpolateCoordinate(ne.coordinates,ne.endIndex),et=this.getMap().getPixelFromCoordinate(xe);O.coordinate=xe,O.pixel=[Math.round(et[0]),Math.round(et[1])]}handleDragEvent(O){this.ignoreNextUpEvent_=!0,super.handleDragEvent(O)}handleUpEvent(O){let Y=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(O);const te=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(O),this.shouldHandle_){const ne=!this.finishCoordinate_;ne&&this.startDrawing_(O.coordinate),!ne&&this.freehand_?this.finishDrawing():!this.freehand_&&(!ne||this.mode_==="Point")&&(this.atFinish_(O.pixel,te)?this.finishCondition_(O)&&this.finishDrawing():this.addToDrawing_(O.coordinate)),Y=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!Y&&this.stopClick_&&O.preventDefault(),Y}handlePointerMove_(O){if(this.pointerType_=O.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const Y=this.downPx_,te=O.pixel,ne=Y[0]-te[0],xe=Y[1]-te[1],et=ne*ne+xe*xe;if(this.shouldHandle_=this.freehand_?et>this.squaredClickTolerance_:et<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(O.coordinate.slice());return}this.updateTrace_(O),this.modifyDrawing_(O.coordinate)}atFinish_(O,Y){let te=!1;if(this.sketchFeature_){let ne=!1,xe=[this.finishCoordinate_];const et=this.mode_;if(et==="Point")te=!0;else if(et==="Circle")te=this.sketchCoords_.length===2;else if(et==="LineString")ne=!Y&&this.sketchCoords_.length>this.minPoints_;else if(et==="Polygon"){const tt=this.sketchCoords_;ne=tt[0].length>this.minPoints_,xe=[tt[0][0],tt[0][tt[0].length-2]],Y?xe=[tt[0][0]]:xe=[tt[0][0],tt[0][tt[0].length-2]]}if(ne){const tt=this.getMap();for(let it=0,st=xe.length;it<st;it++){const ot=xe[it],rt=tt.getPixelFromCoordinate(ot),nt=O[0]-rt[0],at=O[1]-rt[1],ct=this.freehand_?1:this.snapTolerance_;if(te=Math.sqrt(nt*nt+at*at)<=ct,te){this.finishCoordinate_=ot;break}}}}return te}createOrUpdateSketchPoint_(O){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(O):(this.sketchPoint_=new Feature(new Point(O)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(O){this.sketchLine_||(this.sketchLine_=new Feature);const Y=O.getLinearRing(0);let te=this.sketchLine_.getGeometry();te?(te.setFlatCoordinates(Y.getLayout(),Y.getFlatCoordinates()),te.changed()):(te=new LineString(Y.getFlatCoordinates(),Y.getLayout()),this.sketchLine_.setGeometry(te))}startDrawing_(O){const Y=this.getMap().getView().getProjection(),te=getStrideForLayout(this.geometryLayout_);for(;O.length<te;)O.push(0);this.finishCoordinate_=O,this.mode_==="Point"?this.sketchCoords_=O.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[O.slice(),O.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[O.slice(),O.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));const ne=this.geometryFunction_(this.sketchCoords_,void 0,Y);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(ne),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}modifyDrawing_(O){const Y=this.getMap(),te=this.sketchFeature_.getGeometry(),ne=Y.getView().getProjection(),xe=getStrideForLayout(this.geometryLayout_);let et,tt;for(;O.length<xe;)O.push(0);this.mode_==="Point"?tt=this.sketchCoords_:this.mode_==="Polygon"?(et=this.sketchCoords_[0],tt=et[et.length-1],this.atFinish_(Y.getPixelFromCoordinate(O))&&(O=this.finishCoordinate_.slice())):(et=this.sketchCoords_,tt=et[et.length-1]),tt[0]=O[0],tt[1]=O[1],this.geometryFunction_(this.sketchCoords_,te,ne),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(O),te.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(te):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(O){const Y=this.sketchFeature_.getGeometry(),te=this.getMap().getView().getProjection();let ne,xe;const et=this.mode_;return et==="LineString"||et==="Circle"?(this.finishCoordinate_=O.slice(),xe=this.sketchCoords_,xe.length>=this.maxPoints_&&(this.freehand_?xe.pop():ne=!0),xe.push(O.slice()),this.geometryFunction_(xe,Y,te)):et==="Polygon"&&(xe=this.sketchCoords_[0],xe.length>=this.maxPoints_&&(this.freehand_?xe.pop():ne=!0),xe.push(O.slice()),ne&&(this.finishCoordinate_=xe[0]),this.geometryFunction_(this.sketchCoords_,Y,te)),this.createOrUpdateSketchPoint_(O.slice()),this.updateSketchFeatures_(),ne?this.finishDrawing():this.sketchFeature_}removeLastPoints_(O){if(!this.sketchFeature_)return;const Y=this.sketchFeature_.getGeometry(),te=this.getMap().getView().getProjection(),ne=this.mode_;for(let xe=0;xe<O;++xe){let et;if(ne==="LineString"||ne==="Circle"){if(et=this.sketchCoords_,et.splice(-2,1),et.length>=2){this.finishCoordinate_=et[et.length-2].slice();const tt=this.finishCoordinate_.slice();et[et.length-1]=tt,this.createOrUpdateSketchPoint_(tt)}this.geometryFunction_(et,Y,te),Y.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(Y)}else if(ne==="Polygon"){et=this.sketchCoords_[0],et.splice(-2,1);const tt=this.sketchLine_.getGeometry();if(et.length>=2){const it=et[et.length-2].slice();et[et.length-1]=it,this.createOrUpdateSketchPoint_(it)}tt.setCoordinates(et),this.geometryFunction_(this.sketchCoords_,Y,te)}if(et.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const O=this.abortDrawing_();if(!O)return null;let Y=this.sketchCoords_;const te=O.getGeometry(),ne=this.getMap().getView().getProjection();return this.mode_==="LineString"?(Y.pop(),this.geometryFunction_(Y,te,ne)):this.mode_==="Polygon"&&(Y[0].pop(),this.geometryFunction_(Y,te,ne),Y=te.getCoordinates()),this.type_==="MultiPoint"?O.setGeometry(new MultiPoint([Y])):this.type_==="MultiLineString"?O.setGeometry(new MultiLineString([Y])):this.type_==="MultiPolygon"&&O.setGeometry(new MultiPolygon([Y])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,O)),this.features_&&this.features_.push(O),this.source_&&this.source_.addFeature(O),O}abortDrawing_(){this.finishCoordinate_=null;const O=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),O}abortDrawing(){const O=this.abortDrawing_();O&&this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT,O))}appendCoordinates(O){const Y=this.mode_,te=!this.sketchFeature_;te&&this.startDrawing_(O[0]);let ne;if(Y==="LineString"||Y==="Circle")ne=this.sketchCoords_;else if(Y==="Polygon")ne=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;te&&ne.shift(),ne.pop();for(let et=0;et<O.length;et++)this.addToDrawing_(O[et]);const xe=O[O.length-1];this.sketchFeature_=this.addToDrawing_(xe),this.modifyDrawing_(xe)}extend(O){const te=O.getGeometry();this.sketchFeature_=O,this.sketchCoords_=te.getCoordinates();const ne=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=ne.slice(),this.sketchCoords_.push(ne.slice()),this.sketchPoint_=new Feature(new Point(ne)),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const O=[];this.sketchFeature_&&O.push(this.sketchFeature_),this.sketchLine_&&O.push(this.sketchLine_),this.sketchPoint_&&O.push(this.sketchPoint_);const Y=this.overlay_.getSource();Y.clear(!0),Y.addFeatures(O)}updateState_(){const O=this.getMap(),Y=this.getActive();(!O||!Y)&&this.abortDrawing(),this.overlay_.setMap(Y?O:null)}}function getDefaultStyleFunction$2(){const ee=createEditingStyle();return function(O,Y){return ee[O.getGeometry().getType()]}}function getMode(ee){switch(ee){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+ee)}}const ExtentEventType={EXTENTCHANGED:"extentchanged"};class ExtentEvent extends BaseEvent{constructor(O){super(ExtentEventType.EXTENTCHANGED),this.extent=O}}class Extent extends PointerInteraction{constructor(O){O=O||{},super(O),this.on,this.once,this.un,this.condition_=O.condition?O.condition:always,this.createCondition_=O.createCondition||this.condition_,this.drag_=O.drag||!1,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=O.pixelTolerance!==void 0?O.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,O||(O={}),this.extentOverlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!O.wrapX}),style:O.boxStyle?O.boxStyle:getDefaultExtentStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!O.wrapX}),style:O.pointerStyle?O.pointerStyle:getDefaultPointerStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),O.extent&&this.setExtent(O.extent)}snapToVertex_(O,Y){const te=Y.getCoordinateFromPixelInternal(O),ne=function(et,tt){return squaredDistanceToSegment(te,et)-squaredDistanceToSegment(te,tt)},xe=this.getExtentInternal();if(xe){const et=getSegments(xe);et.sort(ne);const tt=et[0];let it=closestOnSegment(te,tt);const st=Y.getPixelFromCoordinateInternal(it);if(distance(O,st)<=this.pixelTolerance_){const ot=Y.getPixelFromCoordinateInternal(tt[0]),rt=Y.getPixelFromCoordinateInternal(tt[1]),nt=squaredDistance(st,ot),at=squaredDistance(st,rt),ct=Math.sqrt(Math.min(nt,at));return this.snappedToVertex_=ct<=this.pixelTolerance_,this.snappedToVertex_&&(it=nt>at?tt[1]:tt[0]),it}}return null}handlePointerMove_(O){const Y=O.pixel,te=O.map,ne=this.drag_&&containsCoordinate(this.extent_,O.coordinate);let xe=this.snapToVertex_(Y,te);return!xe&&this.createCondition_(O)&&!ne&&(xe=te.getCoordinateFromPixelInternal(Y)),ne&&!xe?this.getMap().getViewport().classList.add("ol-grab"):this.getMap().getViewport().classList.remove("ol-grab"),xe?(this.updatePointerFeature_(xe),!0):(this.noVertexFeature_(),!1)}createOrUpdateExtentFeature_(O){let Y=this.extentFeature_;return Y?O?Y.setGeometry(fromExtent(O)):Y.setGeometry(void 0):(O?Y=new Feature(fromExtent(O)):Y=new Feature({}),this.extentFeature_=Y,this.extentOverlay_.getSource().addFeature(Y)),Y}updatePointerFeature_(O,Y=!0){let te=this.vertexFeature_;return Y&&!te&&(te=new Feature(new Point(O)),this.vertexFeature_=te,this.vertexOverlay_.getSource().addFeature(te)),te&&te.getGeometry().setCoordinates(O),te}noVertexFeature_(){this.vertexFeature_&&(this.vertexOverlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}handleEvent(O){if(!O.originalEvent||!this.condition_(O))return this.noVertexFeature_(),!0;let Y=this.handlingDownUpSequence;return O.type==MapBrowserEventType.POINTERMOVE&&!this.handlingDownUpSequence&&(Y=this.handlePointerMove_(O)),super.handleEvent(O),!Y}handleDownEvent(O){const Y=O.pixel,te=O.map,ne=this.getExtentInternal();let xe=this.snapToVertex_(Y,te);const et=function(tt){let it=null,st=null;return tt[0]==ne[0]?it=ne[2]:tt[0]==ne[2]&&(it=ne[0]),tt[1]==ne[1]?st=ne[3]:tt[1]==ne[3]&&(st=ne[1]),it!==null&&st!==null?[it,st]:null};if(xe&&ne){const tt=xe[0]==ne[0]||xe[0]==ne[2]?xe[0]:null,it=xe[1]==ne[1]||xe[1]==ne[3]?xe[1]:null;tt!==null&&it!==null?this.pointerHandler_=getPointHandler(et(xe)):tt!==null?this.pointerHandler_=getEdgeHandler(et([tt,ne[1]]),et([tt,ne[3]])):it!==null&&(this.pointerHandler_=getEdgeHandler(et([ne[0],it]),et([ne[2],it])))}else{xe=te.getCoordinateFromPixelInternal(Y);let tt=!1;this.drag_&&containsCoordinate(ne,xe)&&(this.pointerHandler_=getDragHandler(ne,xe),tt=!0),!tt&&this.createCondition_(O)&&(this.setExtent([xe[0],xe[1],xe[0],xe[1]]),this.pointerHandler_=getPointHandler(xe))}return!!this.pointerHandler_}handleDragEvent(O){if(this.pointerHandler_){const Y=O.coordinate;this.setExtent(this.pointerHandler_(Y)),this.updatePointerFeature_(Y,!1)}}handleUpEvent(O){this.pointerHandler_=null;const Y=this.getExtentInternal();return(!Y||getArea$1(Y)===0)&&this.setExtent(null),!1}setMap(O){this.extentOverlay_.setMap(O),this.vertexOverlay_.setMap(O),super.setMap(O)}getExtent(){return toUserExtent(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(O){this.extent_=O||null,this.createOrUpdateExtentFeature_(O),this.dispatchEvent(new ExtentEvent(this.extent_))}}function getDefaultExtentStyleFunction(){const ee=createEditingStyle();return function(O,Y){return ee.Polygon}}function getDefaultPointerStyleFunction(){const ee=createEditingStyle();return function(O,Y){return ee.Point}}function getPointHandler(ee){return function(O){return boundingExtent([ee,O])}}function getEdgeHandler(ee,O){return ee[0]==O[0]?function(Y){return boundingExtent([ee,[Y[0],O[1]]])}:ee[1]==O[1]?function(Y){return boundingExtent([ee,[O[0],Y[1]]])}:null}function getDragHandler(ee,O){return function(Y){const te=Y[0]-O[0],ne=Y[1]-O[1];return[ee[0]+te,ee[1]+ne,ee[2]+te,ee[3]+ne]}}function getSegments(ee){return[[[ee[0],ee[1]],[ee[0],ee[3]]],[[ee[0],ee[3]],[ee[2],ee[3]]],[[ee[2],ee[3]],[ee[2],ee[1]]],[[ee[2],ee[1]],[ee[0],ee[1]]]]}function to5(ee){return toFixed(ee,5)}function readNumber(ee){return parseFloat(ee)}function writeNumber(ee){return to5(ee).toString()}function differentNumber(ee,O){return isNaN(ee)?!1:ee!==readNumber(writeNumber(O))}function differentArray(ee,O){return differentNumber(ee[0],O[0])||differentNumber(ee[1],O[1])}class Link extends Interaction{constructor(O){super(),O=Object.assign({animate:!0,params:["x","y","z","r","l"],replace:!1,prefix:""},O||{});let Y;O.animate===!0?Y={duration:250}:O.animate?Y=O.animate:Y=null,this.animationOptions_=Y,this.params_=O.params.reduce((te,ne)=>(te[ne]=!0,te),{}),this.replace_=O.replace,this.prefix_=O.prefix,this.listenerKeys_=[],this.initial_=!0,this.updateState_=this.updateState_.bind(this),this.trackedCallbacks_={},this.trackedValues_={}}getParamName_(O){return this.prefix_?this.prefix_+O:O}get_(O,Y){return O.get(this.getParamName_(Y))}set_(O,Y,te){Y in this.params_&&O.set(this.getParamName_(Y),te)}delete_(O,Y){Y in this.params_&&O.delete(this.getParamName_(Y))}setMap(O){const Y=this.getMap();super.setMap(O),O!==Y&&(Y&&this.unregisterListeners_(Y),O&&(this.initial_=!0,this.updateState_(),this.registerListeners_(O)))}registerListeners_(O){this.listenerKeys_.push(listen(O,MapEventType.MOVEEND,this.updateUrl_,this),listen(O.getLayerGroup(),EventType.CHANGE,this.updateUrl_,this),listen(O,"change:layergroup",this.handleChangeLayerGroup_,this)),this.replace_||addEventListener("popstate",this.updateState_)}unregisterListeners_(O){for(let ne=0,xe=this.listenerKeys_.length;ne<xe;++ne)unlistenByKey(this.listenerKeys_[ne]);this.listenerKeys_.length=0,this.replace_||removeEventListener("popstate",this.updateState_);const Y=new URL(window.location.href),te=Y.searchParams;this.delete_(te,"x"),this.delete_(te,"y"),this.delete_(te,"z"),this.delete_(te,"r"),this.delete_(te,"l"),window.history.replaceState(null,"",Y)}handleChangeLayerGroup_(){const O=this.getMap();O&&(this.unregisterListeners_(O),this.registerListeners_(O),this.initial_=!0,this.updateUrl_())}updateState_(){const Y=new URL(window.location.href).searchParams;for(const nt in this.trackedCallbacks_){const at=Y.get(nt);nt in this.trackedCallbacks_&&at!==this.trackedValues_[nt]&&(this.trackedValues_[nt]=at,this.trackedCallbacks_[nt](at))}const te=this.getMap();if(!te)return;const ne=te.getView();if(!ne)return;let xe=!1;const et={},tt=readNumber(this.get_(Y,"z"));"z"in this.params_&&differentNumber(tt,ne.getZoom())&&(xe=!0,et.zoom=tt);const it=readNumber(this.get_(Y,"r"));"r"in this.params_&&differentNumber(it,ne.getRotation())&&(xe=!0,et.rotation=it);const st=[readNumber(this.get_(Y,"x")),readNumber(this.get_(Y,"y"))];("x"in this.params_||"y"in this.params_)&&differentArray(st,ne.getCenter())&&(xe=!0,et.center=st),xe&&(!this.initial_&&this.animationOptions_?ne.animate(Object.assign(et,this.animationOptions_)):(et.center&&ne.setCenter(et.center),"zoom"in et&&ne.setZoom(et.zoom),"rotation"in et&&ne.setRotation(et.rotation)));const ot=te.getAllLayers(),rt=this.get_(Y,"l");if("l"in this.params_&&rt&&rt.length===ot.length)for(let nt=0,at=ot.length;nt<at;++nt){const ct=parseInt(rt[nt]);if(!isNaN(ct)){const ut=!!ct,dt=ot[nt];dt.getVisible()!==ut&&dt.setVisible(ut)}}}track(O,Y){this.trackedCallbacks_[O]=Y;const xe=new URL(window.location.href).searchParams.get(O);return this.trackedValues_[O]=xe,xe}update(O,Y){const te=new URL(window.location.href),ne=te.searchParams;Y===null?ne.delete(O):ne.set(O,Y),O in this.trackedValues_&&(this.trackedValues_[O]=Y),this.updateHistory_(te)}updateUrl_(){const O=this.getMap();if(!O)return;const Y=O.getView();if(!Y)return;const te=Y.getCenter(),ne=Y.getZoom(),xe=Y.getRotation(),et=O.getAllLayers(),tt=new Array(et.length);for(let ot=0,rt=et.length;ot<rt;++ot)tt[ot]=et[ot].getVisible()?"1":"0";const it=new URL(window.location.href),st=it.searchParams;this.set_(st,"x",writeNumber(te[0])),this.set_(st,"y",writeNumber(te[1])),this.set_(st,"z",writeNumber(ne)),this.set_(st,"r",writeNumber(xe)),this.set_(st,"l",tt.join("")),this.updateHistory_(it),this.initial_=!1}updateHistory_(O){O.href!==window.location.href&&(this.initial_||this.replace_?window.history.replaceState(history.state,"",O):window.history.pushState(null,"",O))}}const CIRCLE_CENTER_INDEX=0,CIRCLE_CIRCUMFERENCE_INDEX=1,tempExtent=[0,0,0,0],tempSegment$1=[],ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function getCoordinatesArray(ee,O,Y){let te;switch(O){case"LineString":te=ee;break;case"MultiLineString":case"Polygon":te=ee[Y[0]];break;case"MultiPolygon":te=ee[Y[1]][Y[0]];break}return te}class ModifyEvent extends BaseEvent{constructor(O,Y,te){super(O),this.features=Y,this.mapBrowserEvent=te}}class Modify extends PointerInteraction{constructor(O){super(O),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=O.condition?O.condition:primaryAction,this.defaultDeleteCondition_=function(te){return altKeyOnly(te)&&singleClick(te)},this.deleteCondition_=O.deleteCondition?O.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=O.insertVertexCondition?O.insertVertexCondition:always,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new RBush,this.pixelTolerance_=O.pixelTolerance!==void 0?O.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!O.wrapX}),style:O.style?O.style:getDefaultStyleFunction$1(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=O.traceSource||O.source||null,this.traceCondition_,this.setTrace(O.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let Y;if(O.features?Y=O.features:O.source&&(this.source_=O.source,Y=new Collection(this.source_.getFeatures()),this.source_.addEventListener(VectorEventType.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(VectorEventType.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!Y)throw new Error("The modify interaction requires features, a source or a layer");O.hitDetection&&(this.hitDetection_=O.hitDetection),this.features_=Y,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(CollectionEventType.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(CollectionEventType.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=O.snapToPointer===void 0?!this.hitDetection_:O.snapToPointer}setTrace(O){let Y;O?O===!0?Y=always:Y=O:Y=never,this.traceCondition_=Y}addFeature_(O){const Y=O.getGeometry();if(Y){const ne=this.SEGMENT_WRITERS_[Y.getType()];ne&&ne(O,Y)}const te=this.getMap();te&&te.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),O.addEventListener(EventType.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(O,Y){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Collection;const te=this.featuresBeingModified_.getArray();for(let ne=0,xe=Y.length;ne<xe;++ne){const et=Y[ne].feature;et&&!te.includes(et)&&this.featuresBeingModified_.push(et)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYSTART,this.featuresBeingModified_,O))}}removeFeature_(O){this.removeFeatureSegmentData_(O),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),O.removeEventListener(EventType.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(O){const Y=this.rBush_,te=[];Y.forEach(function(ne){O===ne.feature&&te.push(ne)});for(let ne=te.length-1;ne>=0;--ne){const xe=te[ne];for(let et=this.dragSegments_.length-1;et>=0;--et)this.dragSegments_[et][0]===xe&&this.dragSegments_.splice(et,1);Y.remove(xe)}}setActive(O){this.vertexFeature_&&!O&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(O)}setMap(O){this.overlay_.setMap(O),super.setMap(O)}getOverlay(){return this.overlay_}handleSourceAdd_(O){O.feature&&this.features_.push(O.feature)}handleSourceRemove_(O){O.feature&&this.features_.remove(O.feature)}handleFeatureAdd_(O){this.addFeature_(O.element)}handleFeatureChange_(O){if(!this.changingFeature_){const Y=O.target;this.removeFeature_(Y),this.addFeature_(Y)}}handleFeatureRemove_(O){this.removeFeature_(O.element)}writePointGeometry_(O,Y){const te=Y.getCoordinates(),ne={feature:O,geometry:Y,segment:[te,te]};this.rBush_.insert(Y.getExtent(),ne)}writeMultiPointGeometry_(O,Y){const te=Y.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne],tt={feature:O,geometry:Y,depth:[ne],index:ne,segment:[et,et]};this.rBush_.insert(Y.getExtent(),tt)}}writeLineStringGeometry_(O,Y){const te=Y.getCoordinates();for(let ne=0,xe=te.length-1;ne<xe;++ne){const et=te.slice(ne,ne+2),tt={feature:O,geometry:Y,index:ne,segment:et};this.rBush_.insert(boundingExtent(et),tt)}}writeMultiLineStringGeometry_(O,Y){const te=Y.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne];for(let tt=0,it=et.length-1;tt<it;++tt){const st=et.slice(tt,tt+2),ot={feature:O,geometry:Y,depth:[ne],index:tt,segment:st};this.rBush_.insert(boundingExtent(st),ot)}}}writePolygonGeometry_(O,Y){const te=Y.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne];for(let tt=0,it=et.length-1;tt<it;++tt){const st=et.slice(tt,tt+2),ot={feature:O,geometry:Y,depth:[ne],index:tt,segment:st};this.rBush_.insert(boundingExtent(st),ot)}}}writeMultiPolygonGeometry_(O,Y){const te=Y.getCoordinates();for(let ne=0,xe=te.length;ne<xe;++ne){const et=te[ne];for(let tt=0,it=et.length;tt<it;++tt){const st=et[tt];for(let ot=0,rt=st.length-1;ot<rt;++ot){const nt=st.slice(ot,ot+2),at={feature:O,geometry:Y,depth:[tt,ne],index:ot,segment:nt};this.rBush_.insert(boundingExtent(nt),at)}}}}writeCircleGeometry_(O,Y){const te=Y.getCenter(),ne={feature:O,geometry:Y,index:CIRCLE_CENTER_INDEX,segment:[te,te]},xe={feature:O,geometry:Y,index:CIRCLE_CIRCUMFERENCE_INDEX,segment:[te,te]},et=[ne,xe];ne.featureSegments=et,xe.featureSegments=et,this.rBush_.insert(createOrUpdateFromCoordinate(te),ne);let tt=Y;const it=getUserProjection();if(it&&this.getMap()){const st=this.getMap().getView().getProjection();tt=tt.clone().transform(it,st),tt=fromCircle(tt).transform(st,it)}this.rBush_.insert(tt.getExtent(),xe)}writeGeometryCollectionGeometry_(O,Y){const te=Y.getGeometriesArray();for(let ne=0;ne<te.length;++ne){const xe=te[ne],et=this.SEGMENT_WRITERS_[xe.getType()];et(O,xe)}}createOrUpdateVertexFeature_(O,Y,te,ne){let xe=this.vertexFeature_;return xe?xe.getGeometry().setCoordinates(O):(xe=new Feature(new Point(O)),this.vertexFeature_=xe,this.overlay_.getSource().addFeature(xe)),xe.set("features",Y),xe.set("geometries",te),xe.set("existing",ne),xe}handleEvent(O){if(!O.originalEvent)return!0;this.lastPointerEvent_=O;let Y;return!O.map.getView().getInteracting()&&O.type==MapBrowserEventType.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(O),this.vertexFeature_&&this.deleteCondition_(O)&&(O.type!=MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_?Y=this.removePoint():Y=!0),O.type==MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(O)&&!Y}findInsertVerticesAndUpdateDragSegments_(O){if(this.handlePointerAtPixel_(O),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;const te=this.getMap().getView().getProjection(),ne=[],xe=this.vertexFeature_.getGeometry().getCoordinates(),et=boundingExtent([xe]),tt=this.rBush_.getInExtent(et),it={};tt.sort(compareIndexes);for(let st=0,ot=tt.length;st<ot;++st){const rt=tt[st],nt=rt.segment;let at=getUid(rt.geometry);const ct=rt.depth;if(ct&&(at+="-"+ct.join("-")),it[at]||(it[at]=new Array(2)),rt.geometry.getType()==="Circle"&&rt.index===CIRCLE_CIRCUMFERENCE_INDEX){const ut=closestOnSegmentData(O,rt,te);equals(ut,xe)&&!it[at][0]&&(this.dragSegments_.push([rt,0]),it[at][0]=rt);continue}if(equals(nt[0],xe)&&!it[at][0]){this.dragSegments_.push([rt,0]),it[at][0]=rt;continue}if(equals(nt[1],xe)&&!it[at][1]){if(it[at][0]&&it[at][0].index===0){let ut=rt.geometry.getCoordinates();switch(rt.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":ut=ut[ct[1]];case"Polygon":if(rt.index!==ut[ct[0]].length-2)continue;break}}this.dragSegments_.push([rt,1]),it[at][1]=rt;continue}getUid(nt)in this.vertexSegments_&&!it[at][0]&&!it[at][1]&&ne.push(rt)}return ne}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(O){const Y=this.traceState_;if(!Y.active)return;if(Y.targetIndex===-1){const xe=O.map.getPixelFromCoordinate(Y.startCoord);if(distance(xe,O.pixel)<this.pixelTolerance_)return}const te=getTraceTargetUpdate(O.coordinate,Y,O.map,this.pixelTolerance_);if(Y.targetIndex===-1&&Math.sqrt(te.closestTargetDistance)/O.map.getView().getResolution()>this.pixelTolerance_)return;if(Y.targetIndex!==te.index){if(Y.targetIndex!==-1){const et=Y.targets[Y.targetIndex];this.removeTracedCoordinates_(et.startIndex,et.endIndex)}else for(const et of this.traceSegments_){const tt=et[0],it=tt.geometry,st=et[1],ot=it.getCoordinates();getCoordinatesArray(ot,it.getType(),tt.depth).splice(tt.index+st,1),it.setCoordinates(ot),st===0&&(tt.index-=1)}const xe=Y.targets[te.index];this.addTracedCoordinates_(xe,xe.startIndex,te.endIndex)}else{const xe=Y.targets[Y.targetIndex];this.addOrRemoveTracedCoordinates_(xe,te.endIndex)}Y.targetIndex=te.index;const ne=Y.targets[Y.targetIndex];ne.endIndex=te.endIndex}getTraceCandidates_(O){const Y=this.getMap(),te=this.pixelTolerance_,ne=Y.getCoordinateFromPixel([O.pixel[0]-te,O.pixel[1]+te]),xe=Y.getCoordinateFromPixel([O.pixel[0]+te,O.pixel[1]-te]),et=boundingExtent([ne,xe]);return this.traceSource_.getFeaturesInExtent(et)}toggleTraceState_(O){if(!this.traceSource_||!this.traceCondition_(O))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const Y=this.getTraceCandidates_(O);if(Y.length===0)return;const te=getTraceTargets(O.coordinate,Y);te.length&&(this.traceState_={active:!0,startCoord:O.coordinate.slice(),targets:te,targetIndex:-1})}addOrRemoveTracedCoordinates_(O,Y){const te=O.startIndex<=O.endIndex,ne=O.startIndex<=Y;te===ne?te&&Y>O.endIndex||!te&&Y<O.endIndex?this.addTracedCoordinates_(O,O.endIndex,Y):(te&&Y<O.endIndex||!te&&Y>O.endIndex)&&this.removeTracedCoordinates_(Y,O.endIndex):(this.removeTracedCoordinates_(O.startIndex,O.endIndex),this.addTracedCoordinates_(O,O.startIndex,Y))}removeTracedCoordinates_(O,Y){if(O===Y)return;let te=0;if(O<Y){const ne=Math.ceil(O);let xe=Math.floor(Y);xe===Y&&(xe-=1),te=xe-ne+1}else{const ne=Math.floor(O);let xe=Math.ceil(Y);xe===Y&&(xe+=1),te=ne-xe+1}if(te>0)for(const ne of this.traceSegments_){const xe=ne[0],et=xe.geometry,tt=ne[1];let it=ne[0].index+1;tt===1&&(it-=te);const st=et.getCoordinates();getCoordinatesArray(st,et.getType(),xe.depth).splice(it,te),et.setCoordinates(st),tt===1&&(xe.index-=te)}}addTracedCoordinates_(O,Y,te){if(Y===te)return;const ne=[];if(Y<te){const xe=Math.ceil(Y);let et=Math.floor(te);et===te&&(et-=1);for(let tt=xe;tt<=et;++tt)ne.push(getCoordinate(O.coordinates,tt))}else{const xe=Math.floor(Y);let et=Math.ceil(te);et===te&&(et+=1);for(let tt=xe;tt>=et;--tt)ne.push(getCoordinate(O.coordinates,tt))}if(ne.length)for(const xe of this.traceSegments_){const et=xe[0],tt=et.geometry,it=xe[1],st=et.index+1;it===0&&ne.reverse();const ot=tt.getCoordinates();getCoordinatesArray(ot,tt.getType(),et.depth).splice(st,0,...ne),tt.setCoordinates(ot),it===1&&(et.index+=ne.length)}}updateGeometry_(O,Y){const te=Y[0],ne=te.depth;let xe;const et=te.segment,tt=te.geometry,it=Y[1];for(;O.length<tt.getStride();)O.push(et[it][O.length]);switch(tt.getType()){case"Point":xe=O,et[0]=O,et[1]=O;break;case"MultiPoint":xe=tt.getCoordinates(),xe[te.index]=O,et[0]=O,et[1]=O;break;case"LineString":xe=tt.getCoordinates(),xe[te.index+it]=O,et[it]=O;break;case"MultiLineString":xe=tt.getCoordinates(),xe[ne[0]][te.index+it]=O,et[it]=O;break;case"Polygon":xe=tt.getCoordinates(),xe[ne[0]][te.index+it]=O,et[it]=O;break;case"MultiPolygon":xe=tt.getCoordinates(),xe[ne[1]][ne[0]][te.index+it]=O,et[it]=O;break;case"Circle":const st=tt;if(et[0]=O,et[1]=O,te.index===CIRCLE_CENTER_INDEX)this.changingFeature_=!0,st.setCenter(O),this.changingFeature_=!1;else{this.changingFeature_=!0;const ot=this.getMap().getView().getProjection();let rt=distance(fromUserCoordinate(st.getCenter(),ot),fromUserCoordinate(O,ot));const nt=getUserProjection();if(nt){const at=st.clone().transform(nt,ot);at.setRadius(rt),rt=at.transform(ot,nt).getRadius()}st.setRadius(rt),this.changingFeature_=!1}break}xe&&this.setGeometryCoordinates_(tt,xe)}handleDragEvent(O){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(O,this.dragSegments_.map(([et])=>et));const Y=[O.coordinate[0]+this.delta_[0],O.coordinate[1]+this.delta_[1]],te=[],ne=[],xe=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(xe){this.traceSegments_=[];for(const et of this.dragSegments_){const tt=et[0];distance(closestOnSegment(xe,tt.segment),xe)/O.map.getView().getResolution()<1&&this.traceSegments_.push(et)}}for(let et=0,tt=this.dragSegments_.length;et<tt;++et){const it=this.dragSegments_[et],st=it[0],ot=st.feature;te.includes(ot)||te.push(ot);const rt=st.geometry;ne.includes(rt)||ne.push(rt),this.updateGeometry_(Y,it)}this.updateTrace_(O),this.createOrUpdateVertexFeature_(Y,te,ne,!0)}handleDownEvent(O){if(!this.condition_(O))return!1;const Y=O.coordinate,te=this.findInsertVerticesAndUpdateDragSegments_(Y);if(te?.length&&this.insertVertexCondition_(O)&&(this.willModifyFeatures_(O,te),this.vertexFeature_)){const ne=this.vertexFeature_.getGeometry().getCoordinates();for(let xe=te.length-1;xe>=0;--xe)this.insertVertex_(te[xe],ne);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(O){for(let Y=this.dragSegments_.length-1;Y>=0;--Y){const te=this.dragSegments_[Y][0],ne=te.geometry;if(ne.getType()==="Circle"){const xe=ne,et=xe.getCenter(),tt=te.featureSegments[0],it=te.featureSegments[1];tt.segment[0]=et,tt.segment[1]=et,it.segment[0]=et,it.segment[1]=et,this.rBush_.update(createOrUpdateFromCoordinate(et),tt);let st=xe;const ot=getUserProjection();if(ot){const rt=O.map.getView().getProjection();st=st.clone().transform(ot,rt),st=fromCircle(st).transform(rt,ot)}this.rBush_.update(st.getExtent(),it)}else this.rBush_.update(boundingExtent(te.segment),te)}return this.featuresBeingModified_&&(this.toggleTraceState_(O),this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,O)),this.featuresBeingModified_=null),!1}handlePointerMove_(O){this.lastCoordinate_=O.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(O){const Y=this.getMap(),te=Y.getPixelFromCoordinate(O),ne=Y.getView().getProjection(),xe=function(it,st){return projectedDistanceToSegmentDataSquared(O,it,ne)-projectedDistanceToSegmentDataSquared(O,st,ne)};let et,tt;if(this.hitDetection_){const it=typeof this.hitDetection_=="object"?st=>st===this.hitDetection_:void 0;Y.forEachFeatureAtPixel(te,(st,ot,rt)=>{rt&&rt.getType()==="Point"&&(rt=new Point(toUserCoordinate(rt.getCoordinates(),ne)));const nt=rt||st.getGeometry();if(nt&&nt.getType()==="Point"&&st instanceof Feature&&this.features_.getArray().includes(st)){tt=nt;const at=st.getGeometry().getFlatCoordinates().slice(0,2);et=[{feature:st,geometry:tt,segment:[at,at]}]}return!0},{layerFilter:it})}if(!et){const it=fromUserExtent(createOrUpdateFromCoordinate(O,tempExtent),ne),st=Y.getView().getResolution()*this.pixelTolerance_,ot=toUserExtent(buffer$1(it,st,tempExtent),ne);et=this.rBush_.getInExtent(ot)}if(et&&et.length>0){const it=et.sort(xe)[0],st=it.segment;let ot=closestOnSegmentData(O,it,ne);const rt=Y.getPixelFromCoordinate(ot);let nt=distance(te,rt);if(tt||nt<=this.pixelTolerance_){const at={};if(at[getUid(st)]=!0,this.snapToPointer_||(this.delta_[0]=ot[0]-O[0],this.delta_[1]=ot[1]-O[1]),it.geometry.getType()==="Circle"&&it.index===CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(ot,[it.feature],[it.geometry],this.snappedToVertex_);else{const ct=Y.getPixelFromCoordinate(st[0]),ut=Y.getPixelFromCoordinate(st[1]),dt=squaredDistance(rt,ct),ht=squaredDistance(rt,ut);if(nt=Math.sqrt(Math.min(dt,ht)),this.snappedToVertex_=nt<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(ot=dt>ht?st[1]:st[0]),this.createOrUpdateVertexFeature_(ot,[it.feature],[it.geometry],this.snappedToVertex_);const pt={};pt[getUid(it.geometry)]=!0;for(let ft=1,mt=et.length;ft<mt;++ft){const yt=et[ft].segment;if(equals(st[0],yt[0])&&equals(st[1],yt[1])||equals(st[0],yt[1])&&equals(st[1],yt[0])){const bt=getUid(et[ft].geometry);bt in pt||(pt[bt]=!0,at[getUid(yt)]=!0)}else break}}this.vertexSegments_=at;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(O,Y){const te=O.segment,ne=O.feature,xe=O.geometry,et=O.depth,tt=O.index;let it;for(;Y.length<xe.getStride();)Y.push(0);switch(xe.getType()){case"MultiLineString":it=xe.getCoordinates(),it[et[0]].splice(tt+1,0,Y);break;case"Polygon":it=xe.getCoordinates(),it[et[0]].splice(tt+1,0,Y);break;case"MultiPolygon":it=xe.getCoordinates(),it[et[1]][et[0]].splice(tt+1,0,Y);break;case"LineString":it=xe.getCoordinates(),it.splice(tt+1,0,Y);break;default:return!1}this.setGeometryCoordinates_(xe,it);const st=this.rBush_;st.remove(O),this.updateSegmentIndices_(xe,tt,et,1);const ot={segment:[te[0],Y],feature:ne,geometry:xe,depth:et,index:tt};st.insert(boundingExtent(ot.segment),ot),this.dragSegments_.push([ot,1]);const rt={segment:[Y,te[1]],feature:ne,geometry:xe,depth:et,index:tt+1};return st.insert(boundingExtent(rt.segment),rt),this.dragSegments_.push([rt,0]),!0}updatePointer_(O){return O&&this.findInsertVerticesAndUpdateDragSegments_(O),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const O=this.vertexFeature_?.getGeometry().getCoordinates();return O?toUserCoordinate(O,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(te=>te.getType()==="Circle"||te.getType().endsWith("Point")))return!1;const O=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([O])).some(({segment:te})=>equals(te[0],O)||equals(te[1],O))}removePoint(O){if(O&&(O=fromUserCoordinate(O,this.getMap().getView().getProjection()),this.updatePointer_(O)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=MapBrowserEventType.POINTERDRAG){const Y=this.lastPointerEvent_;this.willModifyFeatures_(Y,this.dragSegments_.map(([ne])=>ne));const te=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,Y)),this.featuresBeingModified_=null,te}return!1}removeVertex_(){const O=this.dragSegments_,Y={};let te=!1,ne,xe,et,tt,it,st,ot,rt,nt,at,ct;for(it=O.length-1;it>=0;--it)et=O[it],at=et[0],ct=getUid(at.feature),at.depth&&(ct+="-"+at.depth.join("-")),ct in Y||(Y[ct]={}),et[1]===0?(Y[ct].right=at,Y[ct].index=at.index):et[1]==1&&(Y[ct].left=at,Y[ct].index=at.index+1);for(ct in Y){switch(nt=Y[ct].right,ot=Y[ct].left,st=Y[ct].index,rt=st-1,ot!==void 0?at=ot:at=nt,rt<0&&(rt=0),tt=at.geometry,xe=tt.getCoordinates(),ne=xe,te=!1,tt.getType()){case"MultiLineString":xe[at.depth[0]].length>2&&(xe[at.depth[0]].splice(st,1),te=!0);break;case"LineString":xe.length>2&&(xe.splice(st,1),te=!0);break;case"MultiPolygon":ne=ne[at.depth[1]];case"Polygon":ne=ne[at.depth[0]],ne.length>4&&(st==ne.length-1&&(st=0),ne.splice(st,1),te=!0,st===0&&(ne.pop(),ne.push(ne[0]),rt=ne.length-1));break}if(te){this.setGeometryCoordinates_(tt,xe);const ut=[];if(ot!==void 0&&(this.rBush_.remove(ot),ut.push(ot.segment[0])),nt!==void 0&&(this.rBush_.remove(nt),ut.push(nt.segment[1])),ot!==void 0&&nt!==void 0){const dt={depth:at.depth,feature:at.feature,geometry:at.geometry,index:rt,segment:ut};this.rBush_.insert(boundingExtent(dt.segment),dt)}this.updateSegmentIndices_(tt,st,at.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),O.length=0}}return te}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(te=>te.getType()==="Circle"||te.getType().endsWith("Point")))return!1;const O=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([O])).some(({segment:te})=>!(equals(te[0],O)||equals(te[1],O)))}insertPoint(O){const Y=O?fromUserCoordinate(O,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return Y?this.findInsertVerticesAndUpdateDragSegments_(Y).reduce((ne,xe)=>ne||this.insertVertex_(xe,Y),!1):!1}setGeometryCoordinates_(O,Y){this.changingFeature_=!0,O.setCoordinates(Y),this.changingFeature_=!1}updateSegmentIndices_(O,Y,te,ne){this.rBush_.forEachInExtent(O.getExtent(),function(xe){xe.geometry===O&&(te===void 0||xe.depth===void 0||equals$2(xe.depth,te))&&xe.index>Y&&(xe.index+=ne)})}}function compareIndexes(ee,O){return ee.index-O.index}function projectedDistanceToSegmentDataSquared(ee,O,Y){const te=O.geometry;if(te.getType()==="Circle"){let xe=te;if(O.index===CIRCLE_CIRCUMFERENCE_INDEX){const et=getUserProjection();et&&(xe=xe.clone().transform(et,Y));const tt=squaredDistance(xe.getCenter(),fromUserCoordinate(ee,Y)),it=Math.sqrt(tt)-xe.getRadius();return it*it}}const ne=fromUserCoordinate(ee,Y);return tempSegment$1[0]=fromUserCoordinate(O.segment[0],Y),tempSegment$1[1]=fromUserCoordinate(O.segment[1],Y),squaredDistanceToSegment(ne,tempSegment$1)}function closestOnSegmentData(ee,O,Y){const te=O.geometry;if(te.getType()==="Circle"&&O.index===CIRCLE_CIRCUMFERENCE_INDEX){let xe=te;const et=getUserProjection();return et&&(xe=xe.clone().transform(et,Y)),toUserCoordinate(xe.getClosestPoint(fromUserCoordinate(ee,Y)),Y)}const ne=fromUserCoordinate(ee,Y);return tempSegment$1[0]=fromUserCoordinate(O.segment[0],Y),tempSegment$1[1]=fromUserCoordinate(O.segment[1],Y),toUserCoordinate(closestOnSegment(ne,tempSegment$1),Y)}function getDefaultStyleFunction$1(){const ee=createEditingStyle();return function(O,Y){return ee.Point}}const SelectEventType={SELECT:"select"};class SelectEvent extends BaseEvent{constructor(O,Y,te,ne){super(O),this.selected=Y,this.deselected=te,this.mapBrowserEvent=ne}}const originalFeatureStyles={};class Select extends Interaction{constructor(O){super(),this.on,this.once,this.un,O=O||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=O.condition?O.condition:singleClick,this.addCondition_=O.addCondition?O.addCondition:never,this.removeCondition_=O.removeCondition?O.removeCondition:never,this.toggleCondition_=O.toggleCondition?O.toggleCondition:shiftKeyOnly,this.multi_=O.multi?O.multi:!1,this.filter_=O.filter?O.filter:TRUE,this.hitTolerance_=O.hitTolerance?O.hitTolerance:0,this.style_=O.style!==void 0?O.style:getDefaultStyleFunction(),this.features_=O.features||new Collection;let Y;if(O.layers)if(typeof O.layers=="function")Y=O.layers;else{const te=O.layers;Y=function(ne){return te.includes(ne)}}else Y=TRUE;this.layerFilter_=Y,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(O,Y){this.featureLayerAssociation_[getUid(O)]=Y}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(O){return this.featureLayerAssociation_[getUid(O)]}setHitTolerance(O){this.hitTolerance_=O}setMap(O){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(O),O?(this.features_.addEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.addEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.removeEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_))}addFeature_(O){const Y=O.element;if(this.style_&&this.applySelectedStyle_(Y),!this.getLayer(Y)){const te=this.findLayerOfFeature_(Y);te&&this.addFeatureLayerAssociation_(Y,te)}}removeFeature_(O){this.style_&&this.restorePreviousStyle_(O.element)}findLayerOfFeature_(O){return this.getMap().getAllLayers().find(function(te){if(te instanceof VectorLayer&&te.getSource()&&te.getSource().hasFeature(O))return te})}getStyle(){return this.style_}applySelectedStyle_(O){const Y=getUid(O);Y in originalFeatureStyles||(originalFeatureStyles[Y]=O.getStyle()),O.setStyle(this.style_)}restorePreviousStyle_(O){const Y=this.getMap().getInteractions().getArray();for(let ne=Y.length-1;ne>=0;--ne){const xe=Y[ne];if(xe!==this&&xe instanceof Select&&xe.getStyle()&&xe.getFeatures().getArray().lastIndexOf(O)!==-1){O.setStyle(xe.getStyle());return}}const te=getUid(O);O.setStyle(originalFeatureStyles[te]),delete originalFeatureStyles[te]}removeFeatureLayerAssociation_(O){delete this.featureLayerAssociation_[getUid(O)]}selectFeatureInternal_(O,Y,te){if(!(O instanceof Feature)||!this.filter_(O,Y))return;const ne=this.getFeatures();return ne.getArray().includes(O)||(this.addFeatureLayerAssociation_(O,Y),ne.push(O),te?.push(O)),O}selectFeature(O){const Y=this.findLayerOfFeature_(O);if(!this.layerFilter_(Y))return!1;const te=this.selectFeatureInternal_(O,Y);return te&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,[te],[],void 0)),!!te}removeFeatureInternal_(O,Y){const te=this.getFeatures();if(!(!(O instanceof Feature)||!te.getArray().includes(O)))return te.remove(O),this.removeFeatureLayerAssociation_(O),Y?.push(O),O}deselectFeature(O){const Y=this.removeFeatureInternal_(O);return Y&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,[],[Y],void 0)),!!Y}toggleFeature(O){this.deselectFeature(O)||this.selectFeature(O)}clearSelection(){clear$2(this.featureLayerAssociation_);const O=this.getFeatures(),Y=O.getArray().slice();O.clear(),Y.length!==0&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,[],Y,void 0))}handleEvent(O){if(!this.condition_(O))return!0;const Y=this.addCondition_(O),te=this.removeCondition_(O),ne=this.toggleCondition_(O),xe=!Y&&!te&&!ne,et=O.map,tt=this.getFeatures(),it=[],st=[];if(xe){let ot=!1;et.forEachFeatureAtPixel(O.pixel,(rt,nt)=>{if(ot=!0,!!this.selectFeatureInternal_(rt,nt,st))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let rt=tt.getLength()-1;rt>=0;--rt){const nt=tt.item(rt);(st.length>0&&!st.includes(nt)||!ot)&&this.removeFeatureInternal_(nt,it)}}else et.forEachFeatureAtPixel(O.pixel,(ot,rt)=>{let nt;if((te||ne)&&(nt=this.removeFeatureInternal_(ot,it)),(Y||ne)&&!nt&&(nt=this.selectFeatureInternal_(ot,rt,st)),!!nt)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(st.length>0||it.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,st,it,O)),!0}}function getDefaultStyleFunction(){const ee=createEditingStyle();return extend$2(ee.Polygon,ee.LineString),extend$2(ee.GeometryCollection,ee.LineString),function(O){return O.getGeometry()?ee[O.getGeometry().getType()]:null}}const SnapEventType={SNAP:"snap",UNSNAP:"unsnap"};class SnapEvent extends BaseEvent{constructor(O,Y){super(O),this.vertex=Y.vertex,this.vertexPixel=Y.vertexPixel,this.feature=Y.feature,this.segment=Y.segment}}const GEOMETRY_SEGMENTERS={Circle(ee,O){let Y=ee;const te=getUserProjection();te&&(Y=Y.clone().transform(te,O));const ne=fromCircle(Y);return te&&ne.transform(O,te),GEOMETRY_SEGMENTERS.Polygon(ne)},GeometryCollection(ee,O){const Y=[],te=ee.getGeometriesArray();for(let ne=0;ne<te.length;++ne){const xe=this[te[ne].getType()];xe&&Y.push(xe(te[ne],O))}return Y.flat()},LineString(ee){const O=[],Y=ee.getFlatCoordinates(),te=ee.getStride();for(let ne=0,xe=Y.length-te;ne<xe;ne+=te)O.push([Y.slice(ne,ne+2),Y.slice(ne+te,ne+te+2)]);return O},MultiLineString(ee){const O=[],Y=ee.getFlatCoordinates(),te=ee.getStride(),ne=ee.getEnds();let xe=0;for(let et=0,tt=ne.length;et<tt;++et){const it=ne[et];for(let st=xe,ot=it-te;st<ot;st+=te)O.push([Y.slice(st,st+2),Y.slice(st+te,st+te+2)]);xe=it}return O},MultiPoint(ee){const O=[],Y=ee.getFlatCoordinates(),te=ee.getStride();for(let ne=0,xe=Y.length;ne<xe;ne+=te)O.push([Y.slice(ne,ne+2)]);return O},MultiPolygon(ee){const O=[],Y=ee.getFlatCoordinates(),te=ee.getStride(),ne=ee.getEndss();let xe=0;for(let et=0,tt=ne.length;et<tt;++et){const it=ne[et];for(let st=0,ot=it.length;st<ot;++st){const rt=it[st];for(let nt=xe,at=rt-te;nt<at;nt+=te)O.push([Y.slice(nt,nt+2),Y.slice(nt+te,nt+te+2)]);xe=rt}}return O},Point(ee){return[[ee.getFlatCoordinates().slice(0,2)]]},Polygon(ee){const O=[],Y=ee.getFlatCoordinates(),te=ee.getStride(),ne=ee.getEnds();let xe=0;for(let et=0,tt=ne.length;et<tt;++et){const it=ne[et];for(let st=xe,ot=it-te;st<ot;st+=te)O.push([Y.slice(st,st+2),Y.slice(st+te,st+te+2)]);xe=it}return O}};function getFeatureFromEvent(ee){return ee.feature?ee.feature:ee.element?ee.element:null}const tempSegment=[],tempExtents=[],tempSegmentData=[];class Snap extends PointerInteraction{constructor(O){O=O||{},super({handleDownEvent:TRUE,stopDown:FALSE}),this.on,this.once,this.un,this.source_=O.source?O.source:null,this.vertex_=O.vertex!==void 0?O.vertex:!0,this.edge_=O.edge!==void 0?O.edge:!0,this.intersection_=O.intersection!==void 0?O.intersection:!1,this.features_=O.features?O.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=O.pixelTolerance!==void 0?O.pixelTolerance:10,this.rBush_=new RBush,this.snapped_=null,this.segmenters_=Object.assign({},GEOMETRY_SEGMENTERS,O.segmenters)}addFeature(O,Y){Y=Y!==void 0?Y:!0;const te=getUid(O),ne=O.getGeometry();if(ne){const xe=this.segmenters_[ne.getType()];if(xe){this.indexedFeaturesExtents_[te]=ne.getExtent(createEmpty());const et=xe.call(this.segmenters_,ne,this.getMap().getView().getProjection());let tt=et.length;for(let it=0;it<tt;++it){const st=et[it];tempExtents[it]=boundingExtent(st),tempSegmentData[it]={feature:O,segment:st}}if(this.intersection_)for(let it=0,st=et.length;it<st;++it){const ot=et[it];if(ot.length===1)continue;const rt=tempExtents[it];for(let at=0,ct=it-1;at<ct;++at){const ut=et[at];if(!intersects$1(rt,tempExtents[at]))continue;const dt=getIntersectionPoint(ot,ut);if(!dt)continue;const ht=[dt];tempExtents[tt]=boundingExtent(ht),tempSegmentData[tt++]={feature:O,intersectionFeature:O,segment:ht}}const nt=this.rBush_.getInExtent(tempExtents[it]);for(let at=0,ct=nt.length;at<ct;++at){const ut=nt[at].segment;if(ut.length===1)continue;const dt=getIntersectionPoint(ot,ut);if(!dt)continue;const ht=[dt];tempExtents[tt]=boundingExtent(ht),tempSegmentData[tt++]={feature:O,intersectionFeature:nt[at].feature,segment:ht}}}tt===1?this.rBush_.insert(tempExtents[0],tempSegmentData[0]):(tempExtents.length=tt,tempSegmentData.length=tt,this.rBush_.load(tempExtents,tempSegmentData))}}Y&&(this.featureChangeListenerKeys_[te]&&unlistenByKey(this.featureChangeListenerKeys_[te]),this.featureChangeListenerKeys_[te]=listen(O,EventType.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let O;return this.features_?O=this.features_:this.source_&&(O=this.source_.getFeatures()),O}areSnapDataEqual_(O,Y){return O.segment===Y.segment&&O.feature===Y.feature}handleEvent(O){const Y=this.snapTo(O.pixel,O.coordinate,O.map);return Y?(O.coordinate=Y.vertex.slice(0,2),O.pixel=Y.vertexPixel,this.snapped_&&!this.areSnapDataEqual_(this.snapped_,Y)&&this.dispatchEvent(new SnapEvent(SnapEventType.UNSNAP,this.snapped_)),this.snapped_={vertex:O.coordinate,vertexPixel:O.pixel,feature:Y.feature,segment:Y.segment},this.dispatchEvent(new SnapEvent(SnapEventType.SNAP,this.snapped_))):this.snapped_&&(this.dispatchEvent(new SnapEvent(SnapEventType.UNSNAP,this.snapped_)),this.snapped_=null),super.handleEvent(O)}handleFeatureAdd_(O){const Y=getFeatureFromEvent(O);Y&&this.addFeature(Y)}handleFeatureRemove_(O){const Y=getFeatureFromEvent(O);Y&&(this.removeFeature(Y),delete this.pendingFeatures_[getUid(Y)])}handleFeatureChange_(O){const Y=O.target;this.handlingDownUpSequence?this.pendingFeatures_[getUid(Y)]=Y:this.updateFeature_(Y)}handleUpEvent(O){const Y=Object.values(this.pendingFeatures_);if(Y.length){for(const te of Y)this.updateFeature_(te);clear$2(this.pendingFeatures_)}return!1}removeFeature(O,Y){const te=Y!==void 0?Y:!0,ne=getUid(O),xe=this.indexedFeaturesExtents_[ne];if(xe){const et=this.rBush_;et.getInExtent(xe).forEach(tt=>{(O===tt.feature||O===tt.intersectionFeature)&&et.remove(tt)})}te&&(unlistenByKey(this.featureChangeListenerKeys_[ne]),delete this.featureChangeListenerKeys_[ne])}setMap(O){const Y=this.getMap(),te=this.featuresListenerKeys_;let ne=this.getFeatures_();if(Array.isArray(ne)||(ne=ne.getArray()),Y&&(te.forEach(unlistenByKey),te.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(unlistenByKey),this.featureChangeListenerKeys_={}),super.setMap(O),O){this.features_?te.push(listen(this.features_,CollectionEventType.ADD,this.handleFeatureAdd_,this),listen(this.features_,CollectionEventType.REMOVE,this.handleFeatureRemove_,this)):this.source_&&te.push(listen(this.source_,VectorEventType.ADDFEATURE,this.handleFeatureAdd_,this),listen(this.source_,VectorEventType.REMOVEFEATURE,this.handleFeatureRemove_,this));for(const xe of ne)this.addFeature(xe)}}snapTo(O,Y,te){const ne=te.getView().getProjection(),xe=fromUserCoordinate(Y,ne),et=toUserExtent(buffer$1(boundingExtent([xe]),te.getView().getResolution()*this.pixelTolerance_),ne),tt=this.rBush_.getInExtent(et),it=tt.length;if(it===0)return null;let st,ot=1/0,rt,nt=null;const at=this.pixelTolerance_*this.pixelTolerance_,ct=()=>{if(!st)return null;const ut=te.getPixelFromCoordinate(st);return squaredDistance(O,ut)>at?null:{vertex:st,vertexPixel:[Math.round(ut[0]),Math.round(ut[1])],feature:rt,segment:nt}};if(this.vertex_||this.intersection_){for(let dt=0;dt<it;++dt){const ht=tt[dt];if(ht.feature.getGeometry().getType()!=="Circle")for(const pt of ht.segment){const ft=fromUserCoordinate(pt,ne),mt=squaredDistance(xe,ft);mt<ot&&(this.intersection_&&ht.intersectionFeature||this.vertex_&&!ht.intersectionFeature)&&(st=pt,ot=mt,rt=ht.feature)}}const ut=ct();if(ut)return ut}if(this.edge_){for(let dt=0;dt<it;++dt){let ht=null;const pt=tt[dt];if(pt.feature.getGeometry().getType()==="Circle"){let ft=pt.feature.getGeometry();const mt=getUserProjection();mt&&(ft=ft.clone().transform(mt,ne)),ht=closestOnCircle(xe,ft)}else{const[ft,mt]=pt.segment;mt&&(tempSegment[0]=fromUserCoordinate(ft,ne),tempSegment[1]=fromUserCoordinate(mt,ne),ht=closestOnSegment(xe,tempSegment))}if(ht){const ft=squaredDistance(xe,ht);ft<ot&&(st=toUserCoordinate(ht,ne),nt=pt.feature.getGeometry().getType()==="Circle"?null:pt.segment,ot=ft,rt=pt.feature)}}const ut=ct();if(ut)return ut}return null}updateFeature_(O){this.removeFeature(O,!1),this.addFeature(O,!1)}}const TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class TranslateEvent extends BaseEvent{constructor(O,Y,te,ne,xe){super(O),this.features=Y,this.coordinate=te,this.startCoordinate=ne,this.mapBrowserEvent=xe}}class Translate extends PointerInteraction{constructor(O){O=O||{},super(O),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=O.features!==void 0?O.features:null;let Y;if(O.layers&&!this.features_)if(typeof O.layers=="function")Y=O.layers;else{const te=O.layers;Y=function(ne){return te.includes(ne)}}else Y=TRUE;this.layerFilter_=Y,this.filter_=O.filter&&!this.features_?O.filter:TRUE,this.hitTolerance_=O.hitTolerance?O.hitTolerance:0,this.condition_=O.condition?O.condition:always,this.lastFeature_=null,this.addChangeListener(InteractionProperty.ACTIVE,this.handleActiveChanged_)}handleDownEvent(O){if(!O.originalEvent||!this.condition_(O))return!1;if(this.lastFeature_=this.featuresAtPixel_(O.pixel,O.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=O.coordinate,this.lastCoordinate_=O.coordinate,this.handleMoveEvent(O);const Y=this.features_||new Collection([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATESTART,Y,O.coordinate,this.startCoordinate_,O)),!0}return!1}handleUpEvent(O){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(O);const Y=this.features_||new Collection([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATEEND,Y,O.coordinate,this.startCoordinate_,O)),this.startCoordinate_=null,!0}return!1}handleDragEvent(O){if(this.lastCoordinate_){const Y=O.coordinate,te=O.map.getView().getProjection(),ne=fromUserCoordinate(Y,te),xe=fromUserCoordinate(this.lastCoordinate_,te),et=ne[0]-xe[0],tt=ne[1]-xe[1],it=this.features_||new Collection([this.lastFeature_]),st=getUserProjection();it.forEach(function(ot){const rt=ot.getGeometry();st?(rt.transform(st,te),rt.translate(et,tt),rt.transform(te,st)):rt.translate(et,tt),ot.setGeometry(rt)}),this.lastCoordinate_=Y,this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATING,it,Y,this.startCoordinate_,O))}}handleMoveEvent(O){const Y=O.map.getViewport();this.featuresAtPixel_(O.pixel,O.map)?(Y.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),Y.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):Y.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(O,Y){return Y.forEachFeatureAtPixel(O,(te,ne)=>{if(!(!(te instanceof Feature)||!this.filter_(te,ne))&&!(this.features_&&!this.features_.getArray().includes(te)))return te},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(O){this.hitTolerance_=O}setMap(O){const Y=this.getMap();super.setMap(O),this.updateState_(Y)}handleActiveChanged_(){this.updateState_(null)}updateState_(O){let Y=this.getMap();const te=this.getActive();(!Y||!te)&&(Y=Y||O,Y&&Y.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const interaction=Object.freeze(Object.defineProperty({__proto__:null,DblClickDragZoom,DoubleClickZoom,DragAndDrop,DragBox,DragPan,DragRotate,DragRotateAndZoom,DragZoom,Draw,Extent,Interaction,KeyboardPan,KeyboardZoom,Link,Modify,MouseWheelZoom,PinchRotate,PinchZoom,Pointer:PointerInteraction,Select,Snap,Translate,defaults},Symbol.toStringTag,{value:"Module"})),ol=Object.freeze(Object.defineProperty({__proto__:null,BaseLayer,Collection,Disposable,Feature,Geolocation,Graticule,Image:ImageWrapper,ImageCanvas,ImageTile,ImageWrapper,Kinetic,Map:Map$1,MapBrowserEvent,MapBrowserEventHandler,MapEvent,Object:BaseObject,Observable,Overlay,Tile,TileQueue,TileRange,VERSION,VectorRenderTile,VectorTile:VectorTile$1,View,applyMapboxStyle:apply,defaultControls:defaults$1,defaultInteractions:defaults,events,eventsCondition:condition,extent,format,geom:olGeom,getUid,interaction,layer,proj,source:source$1,sphere,style},Symbol.toStringTag,{value:"Module"}));class GsOlAdapter{constructor(O){this.map=O.getMap(),this.olObject=O}getMap(){return this.map}getElement(){return this.olObject.getElement()}render(O){O===void 0&&this.templateFunction?O=this.templateFunction():O instanceof Function&&(this.templateFunction=O,O=this.templateFunction()),O&&B$1(O,this.getElement())}onRendered(){}style(O){const Y=this.getElement().style;for(const te in O){const ne=O[te];Y.setProperty(te,ne)}}}class GsControlAdapter extends GsOlAdapter{style(O){super.style(O),"--gs-contribution"in O&&(this.retargetSelector=O["--gs-contribution"])}rendered(){if(this.retargetSelector){const[O,Y]=this.retargetSelector.split("?"),te=this.map.getTargetElement().querySelector(O);if(te){const ne=this.olObject.getElement();if(Y){const xe=new URLSearchParams(Y),et=te.querySelector(`[name='${xe.get("before")}']`);et&&te.insertBefore(ne,et)}else te.appendChild(ne);this.olObject.setTarget(ne),this.render()}}}}class GsOverlayAdapter extends GsOlAdapter{show(O){this.getElement().style.display="block",this.olObject.setPosition(O)}hide(){this.getElement().style.display="none"}}const withState=(ee,O)=>{if(ee.uuid&&O.set(KEY_UUID,ee.uuid),ee.state){for(let Y in ee.state)O.set(Y,ee.state[Y]);O.set(KEY_STATE,ee.state)}return O},toOLGeometry=ee=>withState(ee,new olGeom[ee.type](ee.coordinates)),toOlStroke=ee=>new Stroke({color:ee.color,width:ee.width,lineDash:ee.lineDash,lineCap:ee.lineCap,lineJoin:ee.lineJoin,miterLimit:ee.miterLimit}),toOlFill=ee=>new Fill({color:ee.color}),toOlCircleImage=ee=>new CircleStyle({radius:ee.radius||5,fill:ee.fill?toOlFill(ee.fill):void 0,stroke:ee.stroke?toOlStroke(ee.stroke):void 0,displacement:ee.displacement,scale:ee.scale,rotation:ee.rotation,rotateWithView:ee.rotateWithView,declutterMode:void 0}),toOlIconImage=ee=>{if(!ee.src)throw new Error("Icon image requires src property");return new Icon({src:ee.src,anchor:ee.anchor||[.5,1],anchorXUnits:ee.anchorXUnits||"fraction",anchorYUnits:ee.anchorYUnits||"fraction",anchorOrigin:ee.anchorOrigin,scale:ee.scale||1,opacity:ee.opacity,rotation:ee.rotation,rotateWithView:ee.rotateWithView,displacement:ee.displacement,offset:ee.offset,offsetOrigin:ee.offsetOrigin,size:ee.size,color:ee.color,crossOrigin:ee.crossOrigin,declutterMode:void 0})},toOlRegularShapeImage=ee=>new RegularShape({points:ee.points||3,radius:ee.radius||ee.radius1||5,radius2:ee.radius2,angle:ee.angle||0,displacement:ee.displacement,fill:ee.fill?toOlFill(ee.fill):void 0,stroke:ee.stroke?toOlStroke(ee.stroke):void 0,rotation:ee.rotation,rotateWithView:ee.rotateWithView,scale:ee.scale,declutterMode:void 0}),toOlImage=ee=>{switch(ee.type){case"circle":return toOlCircleImage(ee);case"icon":return toOlIconImage(ee);case"regular-shape":return toOlRegularShapeImage(ee);default:throw new Error(`Unknown image type: ${ee.type}`)}},toOlText=ee=>new Text({text:ee.text,font:ee.font,maxAngle:ee.maxAngle,offsetX:ee.offsetX,offsetY:ee.offsetY,overflow:ee.overflow,placement:ee.placement,repeat:ee.repeat,scale:ee.scale,rotateWithView:ee.rotateWithView,rotation:ee.rotation,textAlign:ee.textAlign,justify:ee.justify,textBaseline:ee.textBaseline,fill:ee.fill?toOlFill(ee.fill):void 0,stroke:ee.stroke?toOlStroke(ee.stroke):void 0,backgroundFill:ee.backgroundFill?toOlFill(ee.backgroundFill):void 0,backgroundStroke:ee.backgroundStroke?toOlStroke(ee.backgroundStroke):void 0,padding:ee.padding,declutterMode:void 0}),toOlStyle=ee=>{const O={};return ee.stroke&&(O.stroke=toOlStroke(ee.stroke)),ee.fill&&(O.fill=toOlFill(ee.fill)),ee.image&&(O.image=toOlImage(ee.image)),ee.text&&(O.text=toOlText(ee.text)),ee.zIndex!==void 0&&(O.zIndex=ee.zIndex),new Style(O)},toOlFeature=ee=>withState(ee,new Feature({geometry:toOLGeometry(ee.geometry)})),OL_SOURCES={};OL_SOURCES[GsSourceType.OSM]=ee=>{const O=new OSM;return O.set(KEY_LABEL,ee.type),O};OL_SOURCES[GsSourceType.XYZ]=ee=>{const O=new XYZ({url:ee.url,crossOrigin:"anonymous"});return O.set(KEY_URL,ee.url),O.set(KEY_LABEL,`${ee.type}@${ee.url}`),O};OL_SOURCES[GsSourceType.WMS]=ee=>{const O=new TileWMS({url:ee.url,params:{LAYERS:"",...ee.state||{}},crossOrigin:"anonymous"});return O.set(KEY_URL,ee.url),O.set(KEY_LABEL,`${ee.type}@${ee.url}`),O};OL_SOURCES[GsSourceType.WMTS]=(ee,O)=>{const Y=ee.state||{},te=new WMTSCapabilities,ne=new WMTS({url:ee.url,layer:Y.LAYER||"",matrixSet:Y.MATRIXSET||"GLOBAL_WEBMERCATOR",style:Y.STYLE||"default",crossOrigin:"anonymous"});return fetch(ee.url).then(xe=>xe.text()).then(xe=>{const et=te.read(xe),tt=optionsFromCapabilities(et,{layer:Y.LAYER||"",matrixSet:Y.MATRIXSET||"GLOBAL_WEBMERCATOR"});if(tt){const it=new WMTS({...tt,crossOrigin:"anonymous"});it.set(KEY_URL,ee.url),it.set(KEY_LABEL,`${ee.type}@${ee.url}`),O&&O.setSource&&O.setSource(it)}}).catch(xe=>{console.error("Failed to fetch WMTS capabilities:",xe)}),ne.set(KEY_URL,ee.url),ne.set(KEY_LABEL,`${ee.type}@${ee.url}`),ne};const formatSource=(ee,O)=>{const Y=new VectorSource({format:O,url:ee.url});return Y.set(KEY_FORMAT,ee.type),Y.set(KEY_URL,ee.url),Y.set(KEY_LABEL,`${ee.type}@${ee.url}`),Y};OL_SOURCES[GsSourceType.GeoJSON]=ee=>formatSource(ee,new GeoJSON);OL_SOURCES[GsSourceType.GPX]=ee=>formatSource(ee,new GPX);OL_SOURCES[GsSourceType.GeoTIFF]=ee=>{const O=new GeoTIFFSource({sources:[{url:ee.url}]});return O.set(KEY_URL,ee.url),O.set(KEY_LABEL,`${ee.type}@${ee.url}`),O};OL_SOURCES[GsSourceType.Features]=ee=>{const O=(ee.features||[]).map(te=>toOlFeature(te)),Y=new VectorSource({features:O});return Y.set(KEY_LABEL,ee.type),Y};const toOlSource=(ee,O)=>withState(ee,OL_SOURCES[ee.type](ee,O)),OL_LAYERS={};OL_LAYERS[GsLayerType.TILE]=ee=>{const O=new TileLayer,Y=toOlSource(ee.source,O);return O.setSource(Y),O};OL_LAYERS[GsLayerType.VECTOR]=ee=>new VectorLayer({source:toOlSource(ee.source)});OL_LAYERS[GsLayerType.GROUP]=ee=>{const O=new LayerGroup;return O.set(KEY_URL,ee.source.url),O.set(KEY_SOURCETYPE,ee.source.type),apply(O,ee.source.url).then(),O};const toOlLayer=ee=>{const O=withState(ee,OL_LAYERS[ee.type](ee));return O.set(KEY_LABEL,ee.type),O.set(KEY_NAME,ee.name),O.set(KEY_GS_MANAGED,!0),O.setVisible(ee.visible??!0),O};class GsOlControl extends Control{constructor(O){const Y=document.createElement("div");Y.style.margin="0",Y.style.padding="0",super({...O,element:Y})}getElement(){return this.element}}class GsOlOverlay extends Overlay{constructor(O){const Y=document.createElement("div");Y.style.margin="0",Y.style.padding="0",super({...O})}getElement(){return this.element}}const toOlOverlay=ee=>{const O=withState(ee,new GsOlOverlay({positioning:ee.position,stopEvent:!0}));return O.set(KEY_SRC,ee.src),O},toOlControl=ee=>{const O=withState(ee,new GsOlControl);return O.set(KEY_SRC,ee.src),O},importSrc=async(ee,O,Y)=>{const te=ee.getMap();return(Y||DefaultImporter)(O).then(ne=>{const xe=()=>{te.removeEventListener("rendercomplete",xe);const et={...lit,lit,style:ee.style.bind(ee),render:ee.render.bind(ee),map:te,element:ee.getElement(),querySelector:ee.getElement().querySelector.bind(ee.getElement()),querySelectorAll:ee.getElement().querySelector.bind(ee.getElement()),ol,env:te.get(KEY_ENV)||{},utils:{uuid:v4},asset:st=>rtUtils.resolveUrl(`assets/${st}`),signal:st=>{},events:(st,ot)=>{if(ot instanceof Function){const rt=subscribe(st,ot);let nt=te.get(KEY_EVENT_SUBSCRIPTIONS);return nt||(nt=[],te.set(KEY_EVENT_SUBSCRIPTIONS,nt)),nt.push(rt),rt}else return publish(st,ot)},settings:(st,ot)=>{const rt=te.get(KEY_UUID),nt=rt?`gs-settings-${rt}`:"gs-settings",at=()=>{try{const dt=localStorage.getItem(nt);return dt?JSON.parse(dt):{}}catch{return{}}},ct=dt=>{try{localStorage.setItem(nt,JSON.stringify(dt))}catch(ht){console.error("Failed to save settings to localStorage:",ht)}},ut=at();return ot===void 0?ut[st]:ot instanceof Function?(et.events(st,ot),ot(ut[st]),ut[st]):(ut[st]=ot,ct(ut),publish(st,ot))}},tt=ee instanceof GsControlAdapter?"control":"overlay";et[tt]=ee;const it=ne instanceof Function?ne:ne.default;if(it){et.state=ot=>{const rt=(nt,at,ct,ut)=>{Object.defineProperty(nt,at,{get(){return ct()},set(dt){ct()!==dt&&(ut(dt),ee.render())},enumerable:!0,configurable:!0})};if(typeof ot=="object"&&ot!==null&&!Array.isArray(ot)){const nt={...ot};return new Proxy({},{get(at,ct){return nt[ct]},set(at,ct,ut){return nt[ct]!==ut&&(nt[ct]=ut,ee.render()),!0},has(at,ct){return ct in nt},ownKeys(at){return Object.keys(nt)},getOwnPropertyDescriptor(at,ct){if(ct in nt)return{enumerable:!0,configurable:!0,value:nt[ct]}}})}else{const nt={};let at=ot;return rt(nt,"value",()=>at,ct=>{at=ct}),nt}};const st=it(et);st instanceof Function,ee.render(st)}ee instanceof GsControlAdapter&&ee.rendered(),te.render()};te.on("rendercomplete",xe)})},importOverlaySource=async(ee,O,Y)=>{const te=new GsOverlayAdapter(ee);return importSrc(te,O,Y)},importControlSource=async(ee,O,Y)=>{const te=new GsControlAdapter(ee);return importSrc(te,O,Y)},DefaultImporter=ee=>import(ee),cleanupEventSubscriptions=ee=>{const O=ee.get(KEY_EVENT_SUBSCRIPTIONS);O&&(O.forEach(Y=>unsubscribe(Y)),ee.set(KEY_EVENT_SUBSCRIPTIONS,[]))},toOlMap=async(ee,O,Y,te)=>{const ne=withState(ee,new Map$1(O));ne.set(KEY_ENV,Y),ne.setView(new View({center:ee.view.center&&ee.view.center.length==2?ee.view.center:DEFAULT_GSMAP.view.center,zoom:ee.view.zoom||DEFAULT_GSMAP.view.zoom,projection:ee.view.projection||DEFAULT_GSMAP.view.projection}));for(const xe of ee.layers||[]){const et=toOlLayer(xe);ne.addLayer(et)}for(const xe of ee.overlays||[]){const et=toOlOverlay(xe);ne.addOverlay(et),await importOverlaySource(et,xe.src,te)}for(const xe of ee.controls||[]){const et=toOlControl(xe);ne.addControl(et),await importControlSource(et,xe.src,te)}return ne},toGsLayerType=ee=>{switch(ee?.toLowerCase()){case"osm":case"bing":case"google":case"geotiff":case"wms":case"wmts":case"xyz":return GsLayerType.TILE;case"bm":case"basemap.de":return GsLayerType.GROUP;default:return GsLayerType.VECTOR}},toGsSourceType=ee=>{if(ee){ee=ee.toLowerCase();const Y=Object.values(GsSourceType).find(te=>ee===te.toLowerCase());if(Y)return Y}throw new Error("Unsupported source type: "+ee)},toSourceUrl=ee=>{switch(ee){case GsSourceType.BM:return"https://sgx.geodatenzentrum.de/gdz_basemapworld_vektor/styles/bm_web_wld_col.json"}},withGsState=(ee,O)=>{const Y=ee.get(KEY_STATE);if(O.state=Y,Y?.uuid)O.uuid=Y.uuid;else{const te=ee.get(KEY_UUID);te&&(O.uuid=te)}return O};function toGsGeometry(ee){return withGsState(ee,{type:ee.getType(),coordinates:ee.getCoordinates()})}function toGsFeature(ee){return withGsState(ee,{geometry:toGsGeometry(ee.getGeometry())})}const rtUtils={async resolveUrl(ee){return ee}};export{n$7 as $,e$2 as A,CommandStack as B,CircleStyle as C,Draw as D,EMPTY_SIGNALPORT as E,Feature as F,GsSourceType as G,GsLayerType as H,n$5 as I,i$6 as J,KEY_NAME as K,LineString as L,activePartSignal as M,DEFAULT_GSMAP as N,ensureUuidsRecursive as O,toastError as P,DEFAULT_STYLES as Q,DEFAULT_STYLE_RULES as R,Stroke as S,toastInfo as T,createLogger as U,VectorLayer as V,promptDialog as W,n$1 as X,r$a as Y,i$c as Z,__viteBrowserExternal as _,defaults as a,LercParameters as a$,t$b as a0,r$6 as a1,activeEditorSignal as a2,confirmDialog as a3,commandRegistry as a4,activeSelectionSignal as a5,registerAll as a6,FileContentType as a7,fromLonLat as a8,toGsSourceType as a9,TOOLBAR_BOTTOM as aA,Directory as aB,publish as aC,TOPIC_WORKSPACE_CHANGED as aD,B$1 as aE,TOPIC_SETTINGS_CHANGED as aF,appSettings as aG,inBrowserMLService as aH,CID_AGENTS as aI,KEY_AI_CONFIG as aJ,e$9 as aK,TOPIC_AICONFIG_CHANGED as aL,uiContext as aM,TOPIC_AI_STREAM_COMPLETE as aN,tokenUsageTracker as aO,ProviderFactory as aP,CID_CHAT_PROVIDERS as aQ,TOPIC_WORKSPACE_CONNECTED as aR,toastWarning as aS,pipeline as aT,env$1 as aU,E$2 as aV,howToService as aW,TOOLBAR_BOTTOM_END as aX,KWidget as aY,HOWTO_CONTRIBUTION_TARGET as aZ,TOPIC_CONTRIBUTEIONS_CHANGED as a_,toGsLayerType as aa,toSourceUrl as ab,transformExtent as ac,taskService as ad,CID_PROMPT_ENHANCERS as ae,TOOLBAR_MAIN as af,SIDEBAR_MAIN_BOTTOM as ag,packageInfoService as ah,TOOLBAR_MAIN_RIGHT as ai,StringFile as aj,appLoaderService as ak,PANEL_BOTTOM as al,KElement as am,PyEnv as an,aiService as ao,o$7 as ap,k as aq,o$5 as ar,c$2 as as,subscribe as at,i18n as au,SYSTEM_LANGUAGE_BUNDLES as av,TOOLBAR_MAIN_CENTER as aw,defaultLogger as ax,i$9 as ay,rootContext as az,KEY_UUID as b,LercAddCompression as b0,settingsservice_RRkTsDV as b1,commandregistryCeQZw2S as b2,aiServiceBDom9KD1 as b3,toGsFeature as c,defaults$1 as d,cleanupEventSubscriptions as e,toOlStyle as f,getStyleForFeature as g,toOlLayer as h,Fill as i,Style as j,Select as k,click as l,getLength as m,getArea as n,ensureUuid as o,KEY_STATE as p,contributionRegistry as q,rtUtils as r,editorRegistry as s,toOlMap as t,File as u,v4 as v,workspaceService as w,x$1 as x,r$1 as y,KPart as z};
